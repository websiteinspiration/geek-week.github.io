<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙉 ♂️ 🤳 Unidade Terrane e mistura de malha 👦🏻 🙌🏿 🐉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá pessoal, em junho, a OTUS está lançando o curso Unity Games Developer novamente . Antecipando o início do curso, preparamos uma tradução de materi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unidade Terrane e mistura de malha</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/504554/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olá pessoal, em junho, a OTUS está lançando o curso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity Games Developer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> novamente </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Antecipando o início do curso, preparamos uma tradução de material interessante sobre o tema.</font></font></b></i><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje, falaremos sobre como mesclar uma malha terrestre (ou outra malha) no Unity. </font><font style="vertical-align: inherit;">Este guia é bastante avançado, mas tentei dividi-lo em etapas separadas. </font><font style="vertical-align: inherit;">Supõe-se que você tenha habilidades gerais do Unity e conhecimentos básicos de C #. </font><font style="vertical-align: inherit;">O guia foi desenvolvido para amplificação, mas acho que também pode ser aplicado ao Shader Graph. </font><font style="vertical-align: inherit;">Este é o meu primeiro guia, por isso espero que seja claro o suficiente. </font><font style="vertical-align: inherit;">Se você quiser adicionar algo, me avise. </font><font style="vertical-align: inherit;">Incluí aqui um kit inicial, que possui alguns shaders adicionais para este projeto, além de um kit básico para começar. </font><font style="vertical-align: inherit;">Todos os arquivos de projeto do manual de hoje estão disponíveis para meus clientes por US $ 5, mas em um futuro próximo, eles estarão disponíveis para todos.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kit inicial</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O projeto inteiro</font></font></a><br>
<br>
<blockquote><i><b>:</b>    ,    ,         .       .      ,        ,  ,      .                (      )     unity    .       ,       ,      .</i> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, vamos começar. </font><font style="vertical-align: inherit;">Para começar, vou destacar o problema e me aprofundar na teoria em que a solução será baseada. </font><font style="vertical-align: inherit;">Para fazer a mistura entre o terrane e outras malhas, é necessário dizer de alguma forma ao sombreador onde ocorre a interseção com o terrane. </font><font style="vertical-align: inherit;">Dizer é mais fácil do que fazer, mas existe um caminho. </font><font style="vertical-align: inherit;">E em que consiste? </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render Texture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos ajudará </font><font style="vertical-align: inherit;">!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que é uma textura de renderização?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Render Texture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é, de fato, a posição da câmera, que é salva no arquivo de ativos. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Textura de renderização</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos jogos é usada com mais frequência em coisas como a criação de telas de vigilância por vídeo. </font><font style="vertical-align: inherit;">Podemos usar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Textura de renderização</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para salvar a visualização da câmera no editor, para que essa textura possa ser usada como um sombreador. </font><font style="vertical-align: inherit;">Isso é útil porque podemos incluir informações sobre nosso terreno, como altura, normais e cores, em uma textura que pode ser usada em tempo de execução para se misturar entre malhas e terran.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/iw/e8/hviwe8looo3tctln-egumqcolwu.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renderização de textura usada para exibir imagens de ganso em TVs no jogo Untitled Goose</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Costumização</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar, vamos criar uma nova cena e terrane. Defina um tamanho conveniente para o trabalho, por exemplo, 200 x 200. Agora você pode organizar o terrane como quiser. Em seguida, crie uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nova camada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e nomeie-a como “Terreno” e atribua um terreno a essa camada. Isso é necessário para que a máscara da câmera possa gravar terrane na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Textura de renderização</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2u/h9/gt/2uh9gtaovl48lp8cvi2sswsnvc8.jpeg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minha obra-prima terrane</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Os arquivos de origem do projeto têm uma pré-fabricada chamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“BlendBakingCamera”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - arraste-a para o palco. </font><font style="vertical-align: inherit;">Você receberá uma câmera ortográfica simples. </font><font style="vertical-align: inherit;">Na câmera, você precisa colocar uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">máscara de seleção</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em uma nova camada de terrane. </font><font style="vertical-align: inherit;">Posicione a câmera no centro do terreno, ligeiramente acima do ponto mais alto do terreno. </font><font style="vertical-align: inherit;">Em seguida, ajuste o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plano do clipe distante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que a câmera veja o piso terrestre. </font><font style="vertical-align: inherit;">No final, a cena deve se parecer com isso:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5b/u_/kr/5bu_krp8iertv5bgpzy0vtsuki4.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de substituição</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Agora que a câmera está configurada, você precisa encontrar uma maneira de gravar dados terrestres. Para isso, precisamos de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shaders de substituição. O Shader de substituição</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parece uma perspectiva duvidosa; eu mesmo não entendo como funciona há muito tempo. Mas, de fato, tudo é muito simples e eficaz. Usar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de substituição</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa essencialmente renderizar cada objeto no campo de visão da câmera com um único shader, independentemente de qual shader esteja sobreposto aos objetos. Como resultado, todos os objetos serão renderizados usando o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de substituição</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selecionado </font><font style="vertical-align: inherit;">, que na verdade é apenas um shader comum.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O shader necessário para a mistura é o shader de profundidade. </font><font style="vertical-align: inherit;">Ele cria a profundidade da cena e é um componente-chave na criação de nosso efeito de mesclagem, pois grava os valores de profundidade de nossa câmera na textura para que possamos lê-los mais tarde. </font><font style="vertical-align: inherit;">Para saber mais sobre esse shader e o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader de substituição</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em geral, recomendo que você leia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este manual em Como tornar as coisas com bom aspecto no Unity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rc/71/5e/rc715exr4enoh7vf-lmhx3b9oei.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de Shader de profundidade</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos começar a assar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Vamos criar uma nova classe e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denominá-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la </font><i><font style="vertical-align: inherit;">"TerrainBlendingBaker"</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos começar implementando uma máscara de profundidade para o terrane de base. </font><font style="vertical-align: inherit;">Mais tarde, retornaremos a esse script para adicionar cores e normais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defina várias variáveis.</font></font><br>
 <br>
<pre><code class="cs hljs"><span class="hljs-comment">//Shader that renders object based on distance to camera</span>
<span class="hljs-keyword">public</span> Shader depthShader;
<span class="hljs-comment">//The render texture which will store the depth of our terrain</span>
<span class="hljs-keyword">public</span> RenderTexture depthTexture;
<span class="hljs-comment">//The camera this script is attached to</span>
<span class="hljs-keyword">private</span> Camera cam;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Agora vamos criar um novo método e chamá-lo de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"UpdateBakingCamera"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Neste método, determinaremos os dados da câmera que o shader pode precisar para tornar a mistura em variáveis ​​globais.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UpdateBakingCamera</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//if the camera hasn't been assigned then assign it</span>
        <span class="hljs-keyword">if</span> (cam == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            cam = GetComponent&lt;Camera&gt;();<font></font>
        }<font></font>
 <font></font>
        <span class="hljs-comment">//the total width of the bounding box of our cameras view</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_SCALE"</span>, GetComponent&lt;Camera&gt;().orthographicSize * <span class="hljs-number">2</span>);
        <span class="hljs-comment">//find the bottom corner of the texture in world scale by subtracting the size of the camera from its x and z position</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_OFFSET_X"</span>, cam.transform.position.x - cam.orthographicSize);<font></font>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_OFFSET_Z"</span>, cam.transform.position.z - cam.orthographicSize);
        <span class="hljs-comment">//we'll also need the relative y position of the camera, lets get this by subtracting the far clip plane from the camera y position</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_OFFSET_Y"</span>, cam.transform.position.y - cam.farClipPlane);
        <span class="hljs-comment">//we'll also need the far clip plane itself to know the range of y values in the depth texture</span>
        Shader.SetGlobalFloat(<span class="hljs-string">"TB_FARCLIP"</span>, cam.farClipPlane);<font></font>
 <font></font>
        <span class="hljs-comment">//<span class="hljs-doctag">NOTE:</span> some of the arithmatic here could be moved to the shader but keeping it here makes the shader cleaner so ¯\_(ツ)_/¯</span>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Agora vamos assar a profundidade do terrane na textura.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">// The context menu tag allows us to run methods from the inspector (https://docs.unity3d.com/ScriptReference/ContextMenu.html)</span>
[<span class="hljs-meta">ContextMenu(<span class="hljs-meta-string">"Bake Depth Texture"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BakeTerrainDepth</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-comment">//call our update camera method </span><font></font>
    UpdateBakingCamera();<font></font>
 <font></font>
    <span class="hljs-comment">//Make sure the shader and texture are assigned in the inspector</span>
    <span class="hljs-keyword">if</span> (depthShader != <span class="hljs-literal">null</span> &amp;&amp; depthTexture != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-comment">//Set the camera replacment shader to the depth shader that we will assign in the inspector </span>
        cam.SetReplacementShader(depthShader, <span class="hljs-string">"RenderType"</span>);
        <span class="hljs-comment">//set the target render texture of the camera to the depth texture </span><font></font>
        cam.targetTexture = depthTexture;<font></font>
        <span class="hljs-comment">//set the render texture we just created as a global shader texture variable</span>
        Shader.SetGlobalTexture(<span class="hljs-string">"TB_DEPTH"</span>, depthTexture);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">"You need to assign the depth shader and depth texture in the inspector"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Os valores ficarão mais claros quando começarmos a trabalhar com o shader. </font><font style="vertical-align: inherit;">Aqui está uma pequena figura que pode lançar alguma luz:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pm/hj/i2/pmhji2hicayyxh7plycoopbx1x4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos transferir o terrane para a textura de profundidade, para depois ler e entender onde fazer a mistura</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Agora temos tudo o que precisamos para criar o efeito básico de mistura no shader. Neste ponto, o script se parece com: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pastebin.com/xNusLJfh</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ok, agora que temos o script, podemos adicioná-lo à câmera de cozimento que adicionamos anteriormente. Os ativos iniciais têm um sombreador chamado </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'DepthShader' (Inresin / Shaders / DepthShader)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Textura de renderização</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'DepthTerrainRT' (Inresin / RenderTextures / DepthTextureRT)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , você precisa colocá-los nos campos apropriados no inspetor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois disso, basta executar o método no menu de contexto para definir a profundidade do terreno na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Textura de renderização</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qh/dl/tm/qhdltmjap9-flgdtvl0twazylyi.gif"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Vamos finalmente criar um shader para a mistura. Crie um novo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader de amplificação</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> padrão </font><font style="vertical-align: inherit;">e abra-o, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chame</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -o de </font><i><font style="vertical-align: inherit;">'TerrainBlending'</font></i><font style="vertical-align: inherit;"> ou algo assim. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora precisamos criar um UV para a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">textura de renderização</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Essa será a diferença entre o ponto que está sendo renderizado e a posição da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">câmera de cozimento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dimensionada em relação à área total. As três variáveis ​​globais aqui são as que acabamos de declarar no código. Também definimos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worldY</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como uma variável local, precisaremos mais tarde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ei/ml/lm/eimllmdyi94c2_9tdwv_8orv9u8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos pegar a textura de profundidade, que atribuímos como uma variável global (para este </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nó de amostra de textura</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicional </font><font style="vertical-align: inherit;">, torne-o global e nomeie-o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'TB_DEPTH'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), se colocarmos a saída no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debug amplify shader</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'a </font><font style="vertical-align: inherit;">field </font><font style="vertical-align: inherit;">, podemos ver o que acontece. Crie um plano com o material ao qual nosso novo shader será aplicado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/pz/hu/_i/pzhu_i59oxdberrgviej7cvbvci.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Portanto, no shader, temos informações sobre a profundidade, agora precisamos adicionar um deslocamento em y para obter a mistura. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ly/jy/lf/lyjylfsocd6cjfm46nu0z1xmjvg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse bloco dimensiona a posição y da máscara do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plano do clipe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remoto </font><font style="vertical-align: inherit;">, subtrai esse valor da posição mundial ao longo do eixo y do ponto que está sendo renderizado e, finalmente, o desloca para o lado inferior da caixa delimitadora da câmera (posição y da câmera menos o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plano</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><i><font style="vertical-align: inherit;">clipe distante</font></i><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Já alguma coisa! Vemos como as arestas do avião se fundem com o terrano. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/fv/zu/rbfvzuc3sccy_dtknu6uitu-wns.gif"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ok, vamos tornar a mistura mais controlada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uq/0o/1p/uq0o1prljhkkeiuxii5xmsnk5hm.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Agora podemos controlar a espessura e a área do terrane de mistura. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zc/tv/_b/zctv_bwpjihiwxpehsdokdbidry.gif"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Acho que podemos adicionar um pouco de barulho. Vamos usar a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posição mundial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para gerar ruído a partir da textura.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xk/cv/po/xkcvpov6owwyfc7nxehrcmtyhiq.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 As texturas de ruído estão na pasta de textura no projeto de inicialização, elas podem ser atribuídas no inspetor ou como uma constante no próprio sombreador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, é hora de adicionar algumas texturas! Para começar, vamos usar algumas texturas simples de uma cor; adicionei duas texturas à pasta com ativos de textura. Torne a </font><font style="vertical-align: inherit;">textura </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'SingleColorGrass'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma textura terrane. Em seguida, no shader, é necessário criar uma textura terrane e um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nó de textura do objeto</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vamos alternar entre eles no canal vermelho da máscara que acabamos de criar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4f/ny/8d/4fny8dg2v4godrj_khbragcc62s.png"><br>
<img src="https://habrastorage.org/webt/mw/6a/_v/mw6a_vyko0crhqvwgmqodlk46xa.png"><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E aqui é o shader completa.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/cf/lr/ut/cflrutnc9-qxa2e9v3kpxnidta0.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 Adicionando personalizado </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iluminação </font><font style="vertical-align: inherit;">ou </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iluminação apagadas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modelos </font><i><font style="vertical-align: inherit;">irá</font></i><font style="vertical-align: inherit;"> fornecer os melhores resultados para este shader. Liguei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apagado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terrane shader e </font><font style="vertical-align: inherit;">versão </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apagada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do shader no pacote completo disponível para os patrocinadores.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vn/to/17/vnto17ss8bwcmfk3o_e0iguuxh8.png"></div> <br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrane e malhas</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
apagadas Eu também recomendo adicionar um shader triplanar ao terrane e possivelmente a outras malhas. </font><font style="vertical-align: inherit;">Eu posso considerar esse problema no próximo guia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, estamos quase terminando o tema principal do guia de hoje. </font><font style="vertical-align: inherit;">Adicionei algumas seções que podem ajudar na extensão do sombreador.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extensão de Shader - Normal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Eu adicionei um sombreador regular aos arquivos, você pode usá-lo para escrever normais na superfície terrane e também usar blending. Para o meu jogo, não preciso de misturas normais, então experimentei um pouco e parece que o experimento foi um sucesso, e minha ideia funciona bem para terrenos sem um alto grau de alteração de altura. Incluí o shader de mapeamento normal no diretório com os shaders do conjunto inicial. Aqui você pode ver minha implementação básica do mapa normal: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vw/lt/l1/vwltl1vedanxqwo5w0ofn4puf7k.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 O código é quase o mesmo do mapa de profundidade, mas desta vez usaremos o mapa normal como um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shader de substituição</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Também adicionei um conjunto de textura de renderização para gravação normal (aqui você pode precisar de uma configuração adicional).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que os normais funcionem bem, pode ser necessário um pouco mais de esforço relacionado ao ajuste, e também pode haver uma restrição associada aos terrenos de baixo nível (mas eu não realizei testes suficientes para confirmar isso).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extensão de Shader - Todas as Cores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Não vou me aprofundar nos detalhes deste tópico, pois ele vai além do necessário para o meu jogo, mas pensei nisso enquanto escrevia este guia. Para adicionar a mistura de várias cores, podemos selecionar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apagadas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cores terrane e guardá-las como texturas. Nesse caso, somos limitados por uma resolução bastante baixa, mas esse método funciona bem ao usar texturas de terreno de uma cor e texturas de baixa resolução ou ao usar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sangramento fraco</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Com pequenos ajustes, eles também podem ser aplicados em malhas terrane. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está o código para a opção multicolorida:</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Header(<span class="hljs-meta-string">"The following settings are only if using the multi-color terrain shader"</span>)</span>]
<span class="hljs-comment">//Shader that renders the unlit terraom of an object</span>
<span class="hljs-keyword">public</span> Shader unlitTerrainShader;
<span class="hljs-comment">//The render texture which will store the normals of our terrain</span>
<span class="hljs-keyword">public</span> RenderTexture surfaceTexture;
<span class="hljs-comment">//An unlit terrain material used to capture the texture of our terrain without any lighting</span>
<span class="hljs-keyword">public</span> Material unlitTerrainMaterial;
<span class="hljs-comment">//The terrain you want to capture the textures of</span>
<span class="hljs-keyword">public</span> Terrain yourTerrain;<font></font>
 <font></font>
[<span class="hljs-meta">ContextMenu(<span class="hljs-meta-string">"Bake Surface Texture"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BakeTerrainSurface</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    UpdateBakingCamera();<font></font>
 <font></font>
    <span class="hljs-comment">//return if there is no terrain assigned</span>
    <span class="hljs-keyword">if</span> (yourTerrain == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        Debug.Log(<span class="hljs-string">"You need to assign a terrain to capture surface texture"</span>);
        <span class="hljs-keyword">return</span>;<font></font>
    }<font></font>
 <font></font>
    StartCoroutine(BakeColors());<font></font>
}<font></font>
 <font></font>
<span class="hljs-function">IEnumerator <span class="hljs-title">BakeColors</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    Material tempTerrainMaterial = yourTerrain.materialTemplate;<font></font>
 <font></font>
    yourTerrain.materialTemplate = unlitTerrainMaterial;<font></font>
 <font></font>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
 <font></font>
    cam.SetReplacementShader(unlitTerrainShader, <span class="hljs-string">"RenderType"</span>);<font></font>
    cam.targetTexture = surfaceTexture;<font></font>
    Shader.SetGlobalTexture(<span class="hljs-string">"TB_SURFACE"</span>, surfaceTexture);<font></font>
 <font></font>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
 <font></font>
    cam.targetTexture = <span class="hljs-literal">null</span>;<font></font>
    yourTerrain.materialTemplate = tempTerrainMaterial;<font></font>
 <font></font>
    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
 <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 A única mudança no shader é que, em vez de usar uma textura predefinida, usamos uma textura de superfície de terreno definida globalmente que usará a posição relativa como UV. </font><font style="vertical-align: inherit;">Uma extensão adicional permite obter uma mistura mais agradável de texturas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wl/ts/xe/wltsxewq-f-2ymxewxjfuew5wk4.png"> <br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Misturando várias texturas </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui está um gráfico multicolorido completo com um sombreador de mesclagem normal:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/jw/bx/vp/jwbxvprh_o3wt9iaw7mmh6vjufa.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Parabéns se você leu até este ponto! </font><font style="vertical-align: inherit;">Como eu disse, este é o meu primeiro guia, então eu realmente aprecio o feedback. </font><font style="vertical-align: inherit;">Se você quiser me apoiar na criação de jogos e tutoriais, dê uma olhada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou assine o meu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saiba mais sobre o curso</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt504510/index.html">Programe-se. Como encontrar um emprego em TI</a></li>
<li><a href="../pt504516/index.html">Táticas de hackers favoritas</a></li>
<li><a href="../pt504520/index.html">Como criar 70 publicações gratuitas sobre um projeto desconhecido em uma semana</a></li>
<li><a href="../pt504522/index.html">O que ver em quarentena? Uma seleção de materiais da Technostream (parte 6)</a></li>
<li><a href="../pt504524/index.html">Modelo de desenvolvimento epidêmico típico do COVID-19</a></li>
<li><a href="../zh-CN486176/index.html">企业电子邮件通讯备忘录</a></li>
<li><a href="../zh-CN486178/index.html">FOSS新闻1-2020年1月27日至2月2日免费和开源新闻的回顾</a></li>
<li><a href="../zh-CN486180/index.html">创建无服务器应用程序的提示和资源</a></li>
<li><a href="../zh-CN486184/index.html">如何有效使用搜索</a></li>
<li><a href="../zh-CN486186/index.html">灾难性云：如何工作</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>