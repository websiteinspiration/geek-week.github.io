<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•â üßëüèª üôåüèø Warum wir Kotlin als eine unserer Zielsprachen gew√§hlt haben. Teil 2: Kotlin Multiplattform üåú üî† üôãüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir setzen die Artikelserie zur Einf√ºhrung der Kotlin-Sprache in unseren Entwicklungsprozess fort. Suchen Sie nach dem ersten Teil hier . 
 
 2017 erb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Warum wir Kotlin als eine unserer Zielsprachen gew√§hlt haben. Teil 2: Kotlin Multiplattform</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/domclick/blog/499820/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir setzen die Artikelserie zur Einf√ºhrung der Kotlin-Sprache in unseren Entwicklungsprozess fort. Suchen Sie </font><font style="vertical-align: inherit;">nach dem ersten Teil </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2017 erblickte das ehrgeizige Projekt von Jetbrains das Licht der Welt und bot eine neue Perspektive f√ºr die plattform√ºbergreifende Entwicklung. Kompilieren von Kotlin-Code in nativen Code verschiedener Plattformen! Wir in Domklik wiederum suchen immer nach M√∂glichkeiten, den Entwicklungsprozess zu optimieren. Was k√∂nnte besser sein, als Code wiederzuverwenden, dachten wir? Das ist richtig - schreiben Sie √ºberhaupt keinen Code. Und damit alles so funktioniert, wie Sie es wollen. Aber w√§hrend dies nicht passiert. Und wenn es eine L√∂sung gibt, mit der wir ohne gro√üen Aufwand eine einzige Codebasis f√ºr verschiedene Plattformen verwenden k√∂nnen, warum nicht versuchen?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also hallo alle zusammen! </font><font style="vertical-align: inherit;">Mein Name ist Gennady Vasilkov, ich bin ein Android-Entwickler bei Domklik und heute m√∂chte ich Ihnen unsere Erfahrungen bei der Entwicklung der Kotlin Multiplatform f√ºr mobile Ger√§te mitteilen und uns mitteilen, auf welche Schwierigkeiten wir gesto√üen sind, wie wir sie gel√∂st haben und was wir am Ende hatten. </font><font style="vertical-align: inherit;">Das Thema wird sicherlich f√ºr diejenigen von Interesse sein, die Kotlin MPP (Multiplatform-Projekte) ausprobieren m√∂chten oder es bereits ausprobiert haben, aber die Produktion noch nicht abgeschlossen haben. </font><font style="vertical-align: inherit;">Oder gebracht, aber nicht so, wie ich es gerne h√§tte. </font><font style="vertical-align: inherit;">Ich werde versuchen, unsere Vision zu vermitteln, wie der Entwicklungs- und Bereitstellungsprozess von entwickelten Bibliotheken gestaltet werden sollte (anhand eines Beispiels m√∂chte ich Ihnen den Beginn unseres Entwicklungspfads in Kotlin MPP erl√§utern). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√∂chten Sie Geschichten dar√ºber, wie wir es gemacht haben? </font><font style="vertical-align: inherit;">Wir haben sie!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/yh/d9/axyhd9vvdn715-ifysok3lk0gpg.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurz √ºber Technologie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr diejenigen, die das Thema noch nicht geh√∂rt oder noch nicht kennengelernt haben, h√§ngt es in der Java-Welt und geht einfach in die Kotlin-Welt (oder geht nicht, aber guckt): Kotlin MPP ist eine Technologie, mit der Sie einmal geschriebenen Code auf vielen Plattformen gleichzeitig verwenden k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Entwicklung erfolgt nicht √ºberraschend in der Kotlin-Sprache in IntelliJ IDEA oder Android Studio. Das Plus ist, dass alle Android-Entwickler (zumindest bei uns) sowohl die Sprache als auch diese wunderbaren Entwicklungsumgebungen kennen und lieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch ein gro√ües Plus beim Kompilieren des resultierenden Codes in Sprachen, die f√ºr jede Plattform nativ sind (OBJ-C, JS, mit JVM ist alles klar).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das hei√üt, alles ist cool. </font><font style="vertical-align: inherit;">Meiner Meinung nach ist Kotlin Multiplatform ideal, um Gesch√§ftslogik in Bibliotheken zu bringen. </font><font style="vertical-align: inherit;">Es ist auch m√∂glich, eine Anwendung vollst√§ndig zu schreiben, aber im Moment sieht sie zu extrem aus, aber die Bibliotheksentwicklung eignet sich f√ºr so gro√üe Projekte wie unsere.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein wenig technisch, um zu verstehen, wie das Projekt auf dem Kotlin MPP funktioniert</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Build-System ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und unterst√ºtzt die Syntax in Groovy- und Kotlin-Skripten (kts).</font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kotlin MPP hat das Konzept von Zielen - Zielplattformen. </font><font style="vertical-align: inherit;">In diesen Bl√∂cken werden die von uns ben√∂tigten Betriebssysteme konfiguriert, deren nativer Code unseren Code auf Kotlin kompiliert. </font><font style="vertical-align: inherit;">In der Abbildung unten sind 2 Ziele implementiert, jvm und js (das Bild stammt teilweise von der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): Die </font></font><br>
<img src="https://habrastorage.org/webt/xw/sd/qk/xwsdqkspxy9vbirtocrlj0cf2n8.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unterst√ºtzung f√ºr andere Plattformen wird auf die gleiche Weise implementiert.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellens√§tze - Der Name selbst ist klar, dass hier Quellcodes f√ºr Plattformen gespeichert sind. </font><font style="vertical-align: inherit;">Es gibt einen gemeinsamen Quellensatz und eine gemeinsame Plattform (es gibt so viele wie es Ziele im Projekt gibt, gefolgt von der IDE). </font><font style="vertical-align: inherit;">Es ist unm√∂glich, den erwarteten tats√§chlichen Mechanismus hier nicht zu erw√§hnen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3c/yn/mw/3cynmwhc0ctyakpsq1awmjk9gmu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Mechanismus erm√∂glicht den Zugriff auf plattformspezifischen Code √ºber das Common-Modul. </font><font style="vertical-align: inherit;">Wir deklarieren die Erwartungsdeklaration im Common-Modul und implementieren sie in den Plattformmodulen. </font><font style="vertical-align: inherit;">Im Folgenden finden Sie ein Beispiel f√ºr die Verwendung des Mechanismus zum Abrufen des Datums auf Ger√§ten:</font></font><br>
<br>
<pre><code class="kotlin hljs">Common:
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">expect</span> <span class="hljs-keyword">val</span> timestamp: <span class="hljs-built_in">Long</span><font></font>
<font></font>
Android/JVM:<font></font>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> timestamp: <span class="hljs-built_in">Long</span> 
    <span class="hljs-keyword">get</span>() = java.lang.System.currentTimeMillis()<font></font>
<font></font>
iOS:<font></font>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">val</span> timestamp: <span class="hljs-built_in">Long</span> 
    <span class="hljs-keyword">get</span>() = platform.Foundation.NSDate().timeIntervalSince1970.toLong()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie f√ºr die Plattformmodule sehen k√∂nnen, sind die Java- und iOS Foundation-Systembibliotheken verf√ºgbar.</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Punkte reichen aus, um zu verstehen, was sp√§ter besprochen wird.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unsere Erfahrung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Irgendwann entschieden wir uns, dass alles von Kotlin MPP (damals auch Kotlin / Native genannt) als Standard akzeptiert wurde, und begannen, Bibliotheken zu schreiben, in die wir den gemeinsamen Code teilten. </font><font style="vertical-align: inherit;">Anfangs war es nur Code f√ºr mobile Plattformen, irgendwann wurde die Unterst√ºtzung f√ºr das JVM-Backend hinzugef√ºgt. </font><font style="vertical-align: inherit;">Unter Android verursachte die Entwicklung und Ver√∂ffentlichung der entwickelten Bibliotheken keine Probleme. Unter iOS stie√üen sie in der Praxis auf einige Probleme, wurden jedoch erfolgreich gel√∂st und ein Arbeitsmodell f√ºr die Entwicklung und Ver√∂ffentlichung von Frameworks ausgearbeitet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeit f√ºr etwas zum Herumh√§ngen!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben verschiedene Funktionen in separaten Bibliotheken ausgef√ºhrt, die wir im Hauptprojekt verwenden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Analytik</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hintergrund des Auftretens</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist kein Geheimnis, dass alle mobilen Anwendungen eine Reihe von Analysen sammeln. Ereignisse werden mit allen wichtigen und nicht sehr wichtigen Ereignissen aufgeh√§ngt (in unserer Anwendung werden beispielsweise mehr als 600 verschiedene Metriken erfasst). Und was ist Metriksammlung? Auf einfache Weise ist dies ein Aufruf einer Funktion, die ein Ereignis mit einem bestimmten Schl√ºssel an den Darm der Analytics Engine sendet. Und dann geht es in eine Vielzahl von Analysesystemen wie Firebase, Appmetrica und andere. Welche Probleme gibt es damit? St√§ndige Vervielf√§ltigung des gleichen (Plus- oder Minus-) Codes auf zwei Plattformen! Ja, und der Faktor Mensch kann nirgendwo gefunden werden - die Entwickler k√∂nnten sich irren, sowohl im Namen der Schl√ºssel als auch im Metadatensatz, der mit dem Ereignis √ºbertragen wird. Dies muss eindeutig einmal geschrieben und auf jeder Plattform verwendet werden. Ein idealer Kandidat f√ºr die Erstellung allgemeiner Logik- und Testtechnologien (dies ist unser Teststift in Kotlin Mpp).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie zu implementieren</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die Ereignisse selbst in die Bibliothek √ºbertragen (in Form von Funktionen mit einem verdrahteten Schl√ºssel und einer Reihe erforderlicher Metadaten in den Argumenten) und eine neue Logik f√ºr die Verarbeitung dieser Ereignisse geschrieben. </font><font style="vertical-align: inherit;">Das Ereignisformat wurde vereinheitlicht und eine Handler-Engine (Bus) erstellt, in die alle Ereignisse eingegossen wurden. </font><font style="vertical-align: inherit;">Und f√ºr verschiedene Analysesysteme haben Adapter-Listener geschrieben (eine sehr n√ºtzliche L√∂sung stellte sich heraus, dass wir beim Hinzuf√ºgen neuer Analysen einfach alles oder jedes Ereignis selektiv in eine neue Analyse umleiten k√∂nnen).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vc/zh/vq/vczhvqo8-r4ap2r0tmwoczqloqe.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interessant am Umsetzungsprozess</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund der Funktionen der Implementierung der Arbeit mit Streams in Kotlin / Native f√ºr iOS k√∂nnen Sie das Kotlin-Objekt nicht einfach als Singleton verwenden und dort jederzeit Daten schreiben. </font><font style="vertical-align: inherit;">Alle Objekte, die ihren Status zwischen Threads √ºbertragen, m√ºssen eingefroren sein (hierf√ºr gibt es eine freeze () - Funktion). </font><font style="vertical-align: inherit;">In der Bibliothek wird jedoch unter anderem ein Status gespeichert, der sich w√§hrend der Laufzeit der Anwendung √§ndern kann. </font><font style="vertical-align: inherit;">Es gibt verschiedene M√∂glichkeiten, um diese Situation zu l√∂sen. Wir haben uns f√ºr die einfachste entschieden:</font></font><br>
<br>
<pre><code class="kotlin hljs">Common:<font></font>
<font></font>
<span class="hljs-keyword">expect</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicReference</span>&lt;<span class="hljs-type">T</span>&gt;</span>(value_: T) {
    <span class="hljs-keyword">var</span> value: T<font></font>
}<font></font>
<font></font>
Android:<font></font>
<font></font>
<span class="hljs-keyword">actual</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicReference</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span></span>(value_: T) {
    <span class="hljs-keyword">actual</span> <span class="hljs-keyword">var</span> value: T = value_<font></font>
}<font></font>
<font></font>
iOS:<font></font>
<font></font>
<span class="hljs-keyword">actual</span> <span class="hljs-keyword">typealias</span> AtomicReference&lt;V&gt; = kotlin.<span class="hljs-keyword">native</span>.concurrent.AtomicReference&lt;V&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Option eignet sich f√ºr die einfache Zustandsspeicherung. </font><font style="vertical-align: inherit;">In unserem Fall wird die Plattformkonfiguration gespeichert:</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">object</span> Config {
    <span class="hljs-keyword">val</span> platform = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> manufacturer = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> model = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> deviceId = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> appVersion = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> sessionId = AtomicReference&lt;String?&gt;(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">var</span> debug = AtomicReference&lt;<span class="hljs-built_in">Boolean</span>&gt;(<span class="hljs-literal">false</span>)<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warum wird das ben√∂tigt? Zu Beginn der Anwendung erhalten wir keine Informationen, wenn das Modul bereits geladen sein sollte und seine Objekte bereits eingefroren sind. Um diese Informationen zur Konfiguration hinzuzuf√ºgen und sie dann aus verschiedenen Streams unter iOS zu lesen, ist ein solcher Schritt erforderlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir standen auch vor dem Problem der Ver√∂ffentlichung der Bibliothek. Und wenn Android damit keine Probleme hatte, passte die damals in der offiziellen Dokumentation vorgeschlagene Methode, das zusammengestellte Framework direkt mit dem iOS-Projekt zu verbinden, aus mehreren Gr√ºnden nicht zu uns. Ich wollte neue Versionen so einfach und transparent wie m√∂glich erhalten. Au√üerdem wird die Versionierung unterst√ºtzt.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die L√∂sung besteht darin, das Framework √ºber eine Pod-Datei zu verbinden. </font><font style="vertical-align: inherit;">Zu diesem Zweck haben sie die Podspec-Datei und das Framework selbst generiert, sie in das Repository gestellt und die Verbindung der Bibliothek mit dem Projekt f√ºr iOS-Entwickler sehr einfach und bequem gemacht. </font><font style="vertical-align: inherit;">Zur Vereinfachung der Entwicklung sammeln wir auch hier ein einziges Artefakt f√ºr alle Architekturen, das sogenannte Fat Framework (eigentlich eine fett gedruckte Bin√§rdatei, in der alle vom Kotlin-Plugin generierten Architekturen und hinzugef√ºgten Metadateien zusammenkommen). </font><font style="vertical-align: inherit;">Die Umsetzung dieser ganzen Sache unter dem Spoiler:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wen interessiert es, wie wir es vor der offiziellen Entscheidung gemacht haben?</font></font></b>
                        <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem das Kotlin-Plugin eine Reihe verschiedener Frameworks f√ºr verschiedene Architekturen f√ºr uns gesammelt hat, erstellen wir manuell ein neues universelles Framework, in das wir Metadaten von jedem kopieren (in unserem Fall haben wir arm64 √ºbernommen):</font></font><br>
<pre><code class="kotlin hljs"><span class="hljs-comment">//add meta files (headers, modules and plist) from arm64 platform</span><font></font>
task copyMeta() {<font></font>
    dependsOn build<font></font>
<font></font>
    doLast {<font></font>
        copy {<font></font>
            from(<span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphone/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework"</span>)<font></font>
            into <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/<span class="hljs-subst">${frameworkName}</span>.framework"</span><font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
,    ,   ,   .     lipo,    :<br>
<pre><code class="kotlin hljs"><span class="hljs-comment">//merge binary files into one</span><font></font>
task lipo(type: Exec) {<font></font>
    dependsOn copyMeta<font></font>
<font></font>
    def frameworks = files(<font></font>
            <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphone32/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span>,
            <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphone/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span>,
            <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/bin/iphoneSim/main/release/framework/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span><font></font>
    )<font></font>
    def output = file(<span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/<span class="hljs-subst">${frameworkName}</span>.framework/<span class="hljs-variable">$frameworkName</span>"</span>)<font></font>
    inputs.files frameworks<font></font>
    outputs.file output<font></font>
    executable = <span class="hljs-string">'lipo'</span><font></font>
    args = frameworks.files<font></font>
    args += [<span class="hljs-string">'-create'</span>, <span class="hljs-string">'-output'</span>, output]<font></font>
}<font></font>
</code></pre><br>
  ,     -       Kotlin MPP   Info.plist   UIRequiredDeviceCapabilities,        (    ).       PlistBuddy:<br>
<pre><code class="kotlin hljs"><span class="hljs-comment">//workaround</span>
<span class="hljs-comment">//remove UIRequiredDeviceCapabilities key from plist file (because we copy this file from arm64, only arm64 architecture was available)</span><font></font>
task editPlistFile(type: Exec) {<font></font>
    dependsOn lipo<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span>
    def script = <span class="hljs-string">'./scripts/edit_plist_file.sh'</span>
    def command = <span class="hljs-string">"Delete :UIRequiredDeviceCapabilities"</span>
    def file = <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/<span class="hljs-subst">${frameworkName}</span>.framework/Info.plist"</span><font></font>
<font></font>
    args += [script, command, file]<font></font>
}<font></font>
</code></pre><br>
edit_plist_file.sh:<br>
<pre><code class="bash hljs">/usr/libexec/PlistBuddy -c <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
</code></pre><br>
 ,  zip      (    podspec ):<br>
<pre><code class="kotlin hljs">task zipIosFramework(type: Zip) {<font></font>
    dependsOn editPlistFile<font></font>
    from <span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal/"</span>
    include <span class="hljs-string">'**/*'</span><font></font>
    archiveName = iosArtifactName<font></font>
    destinationDir(file(<span class="hljs-string">"<span class="hljs-variable">$buildDir</span>/iphone_universal_zipped/"</span>))<font></font>
}<font></font>
</code></pre><br>
  podspec :<br>
<pre><code class="kotlin hljs">task generatePodspecFile(type: Exec) {<font></font>
    dependsOn zipIosFramework<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span><font></font>
<font></font>
    def script = <span class="hljs-string">'./scripts/generate_podspec_file.sh'</span><font></font>
<font></font>
    def templateStr = <span class="hljs-string">"version_name"</span>
    def sourceFile = <span class="hljs-string">'./podspec/template.podspec'</span>
    def replaceStr = <span class="hljs-string">"<span class="hljs-variable">$version</span>"</span><font></font>
<font></font>
    args += [script, templateStr, replaceStr, sourceFile, generatedPodspecFile]<font></font>
}<font></font>
</code></pre><br>
 generate_podscpec_file.sh      :<br>
<pre><code class="bash hljs">sed -e s/<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>/<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>/g &lt;<span class="hljs-string">"<span class="hljs-variable">$3</span>"</span> &gt;<span class="hljs-string">"<span class="hljs-variable">$4</span>"</span>
</code></pre><br>
   curl        :<br>
<pre><code class="kotlin hljs">task uploadIosFrameworkToNexus(type: Exec) {<font></font>
    dependsOn generatePodspecFile<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span>
    def body = <span class="hljs-string">"-s -k -v --user \'<span class="hljs-variable">$userName</span>:<span class="hljs-variable">$password</span>\' "</span> +
            <span class="hljs-string">"--upload-file <span class="hljs-variable">$buildDir</span>/iphone_universal_zipped/<span class="hljs-variable">$iosArtifactName</span> <span class="hljs-variable">$iosUrlRepoPath</span>"</span>
    args += [<span class="hljs-string">'-c'</span>, <span class="hljs-string">"curl <span class="hljs-variable">$body</span>"</span>]<font></font>
}<font></font>
<font></font>
task uploadPodspecFileToNexus(type: Exec) {<font></font>
    dependsOn uploadIosFrameworkToNexus<font></font>
<font></font>
    executable = <span class="hljs-string">"/bin/sh"</span>
    def body = <span class="hljs-string">"-s -k -v --user \'<span class="hljs-variable">$userName</span>:<span class="hljs-variable">$password</span>\' "</span> +
            <span class="hljs-string">"--upload-file <span class="hljs-variable">$generatedPodspecFile</span> <span class="hljs-variable">$iosUrlRepoPath</span>"</span>
    args += [<span class="hljs-string">'-c'</span>, <span class="hljs-string">"curl <span class="hljs-variable">$body</span>"</span>]<font></font>
}<font></font>
</code></pre><br>
        :<br>
<pre><code class="kotlin hljs">task createAndUploadUniversalIosFramework() {<font></font>
    dependsOn uploadPodspecFileToNexus<font></font>
    doLast {<font></font>
        println <span class="hljs-string">'createAndUploadUniversalIosFramework complete'</span><font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br>
Profit!<br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Zeitpunkt des Schreibens gibt es offizielle L√∂sungen zum Erstellen eines Fat Frameworks und zum Generieren einer Podspec-Datei (und im Allgemeinen zur Integration in CocoaPods). </font><font style="vertical-align: inherit;">Wir m√ºssen also nur das erstellte Framework und die Podspec-Datei in das Repository hochladen und das Projekt in iOS auf die gleiche Weise wie zuvor verbinden:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  fat framework  Jetbrains</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  podspec   Jetbrains</a><br>
</li>
</ul><br>
<br>
<h4></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Implementierung eines solchen Schemas mit einem einzigen Ort zum Speichern von Ereignissen, einem Mechanismus zum Verarbeiten und Senden von Metriken, wurde unser Prozess des Hinzuf√ºgens neuer Metriken auf die Tatsache reduziert, dass ein Entwickler der Bibliothek eine neue Funktion hinzuf√ºgt, die den Ereignisschl√ºssel und die erforderlichen Metadaten beschreibt, die der Entwickler f√ºr ein bestimmtes Ereignis √ºbertragen muss . Au√üerdem l√§dt der Entwickler einer anderen Plattform einfach eine neue Version der Bibliothek herunter und verwendet die neue Funktion an der richtigen Stelle. Es ist viel einfacher geworden, die Konsistenz des gesamten Analysesystems aufrechtzuerhalten, und es ist jetzt auch viel einfacher, die interne Implementierung des Ereignisbusses zu √§ndern. Zum Beispiel mussten wir zu einem bestimmten Zeitpunkt f√ºr einen unserer Analysten unseren eigenen Ereignispuffer implementieren, der sofort in der Bibliothek ausgef√ºhrt wurde, ohne dass der Code auf den Plattformen ge√§ndert werden musste. Profitieren!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir √ºbertragen immer mehr Code auf Kotlin MPP. In den folgenden Artikeln werde ich die Geschichte unserer Einf√ºhrung in die Welt der plattform√ºbergreifenden Entwicklung anhand von zwei weiteren Bibliotheken als Beispiel fortsetzen, in denen die Serialisierung und die Datenbank verwendet wurden, und im Laufe der Zeit arbeiten. </font><font style="vertical-align: inherit;">Ich erz√§hle Ihnen von den Einschr√§nkungen, die bei der Verwendung mehrerer Kotlin-Frameworks in einem iOS-Projekt aufgetreten sind, und wie Sie diese Einschr√§nkung umgehen k√∂nnen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und nun kurz zu den Ergebnissen unserer Forschung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ In der Produktion funktioniert alles stabil. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Einheitliche Codebasis der Business Service-Logik f√ºr alle Plattformen (weniger Fehler und Diskrepanzen). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Reduzierte Supportkosten und reduzierte Entwicklungszeit f√ºr neue Anforderungen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
+ Wir erh√∂hen das Know-how der Entwickler.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verwandte Links</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kotlin Multiplatform-Website: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.jetbrains.com/lp/mobilecrossplatform</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ZY: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte den Lakonismus der Sprache nicht wiederholen und mich daher beim Schreiben von Code auf die Gesch√§ftslogik konzentrieren. Ich kann mehrere Artikel empfehlen, </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
die </font><font style="vertical-align: inherit;">dieses Thema behandeln: </font><font style="vertical-align: inherit;">‚ÄûKotlin unter der Haube - siehe dekompilierten Bytecode‚Äú - ein Artikel, der die Funktionsweise des Kotlin-Compilers beschreibt und die Grundstruktur der Sprache behandelt. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/de/post/425077</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zwei Teile des Artikels "Kotlin, Zusammenstellung in Bytecode und Leistung", die den vorherigen Artikel erg√§nzen. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/ru/company/inforion/blog/330060 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/ru/company/inforion/blog/330064</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pasha Finkelsteins Bericht ‚ÄûKotlin - zwei Jahre in der Produktion und keine einzige L√ºcke‚Äú basiert auf der Erfahrung mit der Verwendung und Implementierung von Kotlin in unserem Unternehmen. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com/watch?v=nCDWb7O1ZW4</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495340/index.html">So √§ndern Sie die Arbeit eines Administrators in einem Restaurant f√ºr einen guten Job in der IT</a></li>
<li><a href="../de495342/index.html">Abrechnung von Bankkarten im Handel - Erstellen eines offenen Datensatzes und einer Infografik in Google Data Studio</a></li>
<li><a href="../de495344/index.html">Vereinheitlichen Sie es: Wie Lamoda seine Go-Services konsistent macht</a></li>
<li><a href="../de495346/index.html">Vom Fehler zum Alarm mit Aktionen</a></li>
<li><a href="../de499818/index.html">Usbekisches Telegramm-Marketing</a></li>
<li><a href="../de499822/index.html">Drahtloser Zugangspunkt vs. Router: Was sind die Unterschiede?</a></li>
<li><a href="../de499824/index.html">Die Zusammenfassung der Ereignisse f√ºr Personal- und IT-Personalvermittler im Mai 2020</a></li>
<li><a href="../de499826/index.html">Verteilter Blutdruck</a></li>
<li><a href="../de499832/index.html">Wie kann die Remote-Arbeit von Mitarbeitern schnell und sicher organisiert werden? Wir sprechen √ºber verschiedene Ans√§tze: mit VDI und nicht nur</a></li>
<li><a href="../de499834/index.html">Lernen Sie das Felix Arithmometer kennen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>