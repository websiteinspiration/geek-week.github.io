<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜ üì¢ üîä Zeichenfolgenoptimierung in ClickHouse. Yandex-Bericht üç¨ üìù üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das ClickHouse-Analysedatenbankmodul verarbeitet viele verschiedene Zeilen und verbraucht Ressourcen. Um das System zu beschleunigen, werden st√§ndig n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Zeichenfolgenoptimierung in ClickHouse. Yandex-Bericht</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/492868/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das ClickHouse-Analysedatenbankmodul verarbeitet viele verschiedene Zeilen und verbraucht Ressourcen. </font><font style="vertical-align: inherit;">Um das System zu beschleunigen, werden st√§ndig neue Optimierungen hinzugef√ºgt. </font><font style="vertical-align: inherit;">Der ClickHouse-Entwickler Nikolay Kochetov spricht √ºber den String-Datentyp, einschlie√ülich des neuen Typs LowCardinality, und erkl√§rt, wie die Arbeit mit Strings beschleunigt werden kann.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/rqf-ILRgBdY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Lassen Sie uns zun√§chst sehen, wie Sie Zeichenfolgen speichern k√∂nnen. </font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ch/9s/zs/ch9szsqfnkkvpmjjxoo0lmpacno.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben String-Datentypen. </font><font style="vertical-align: inherit;">String funktioniert standardm√§√üig gut, es sollte fast immer verwendet werden. </font><font style="vertical-align: inherit;">Es hat einen kleinen Overhead - 9 Bytes pro Zeile. </font><font style="vertical-align: inherit;">Wenn die Zeilengr√∂√üe im Voraus festgelegt und bekannt sein soll, ist es besser, FixedString zu verwenden. </font><font style="vertical-align: inherit;">Darin k√∂nnen Sie die Anzahl der ben√∂tigten Bytes festlegen. Dies ist praktisch f√ºr Daten wie IP-Adressen oder Hash-Funktionen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/lx/mo/rdlxmobm0ch5l88ab74sszn_fps.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich verlangsamt sich manchmal etwas. </font><font style="vertical-align: inherit;">Angenommen, Sie stellen eine Abfrage f√ºr eine Tabelle. </font><font style="vertical-align: inherit;">ClickHouse liest eine ziemlich gro√üe Datenmenge, beispielsweise mit einer Geschwindigkeit von 100 GB / s, wobei nur wenige Zeilen verarbeitet werden. </font><font style="vertical-align: inherit;">Wir haben zwei Tabellen, in denen fast dieselben Daten gespeichert sind. </font><font style="vertical-align: inherit;">ClickHouse liest Daten aus der zweiten Tabelle mit einer h√∂heren Geschwindigkeit, liest jedoch dreimal weniger Zeilen pro Sekunde.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nd/tz/6l/ndtz6l6-1pwaycgcoxhslfj2hcm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir uns die Gr√∂√üe der komprimierten Daten ansehen, werden sie fast gleich sein. Tats√§chlich werden dieselben Daten in die Tabellen geschrieben - die ersten Milliarden Zahlen - nur in der ersten Spalte werden sie in Form von UInt64 und in der zweiten Spalte in String geschrieben. Aus diesem Grund liest die zweite Abfrage Daten l√§nger von der Festplatte und dekomprimiert sie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i8/a2/vf/i8a2vfterxcfto5foypz6tig3zy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein weiteres Beispiel. Angenommen, es gibt einen vorgegebenen Satz von Linien, der auf eine Konstante von 1000 oder 10.000 begrenzt ist und sich fast nie √§ndert. In diesem Fall ist der Datentyp Enum f√ºr uns geeignet. In ClickHouse gibt es zwei davon - Enum8 und Enum16. Aufgrund der Speicherung in Enum bearbeiten wir Anfragen schnell.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClickHouse bietet Beschleunigungen f√ºr GROUP BY, IN, DISTINCT und Optimierungen f√ºr einige Funktionen, z. B. zum Vergleich mit einer konstanten Zeichenfolge. Nat√ºrlich werden die Zahlen in der Zeichenfolge nicht konvertiert, im Gegenteil, die konstante Zeichenfolge wird in den Wert Enum konvertiert. Danach wird alles schnell verglichen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt aber auch Nachteile. Selbst wenn wir den genauen Satz von Zeilen kennen, muss er manchmal wieder aufgef√ºllt werden. Eine neue Linie ist angekommen - wir m√ºssen ALTER machen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b0/ay/sz/b0ayszedkf252ktki2xizo2fxfm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER f√ºr Enum in ClickHouse ist optimal implementiert. Wir √ºberschreiben die Daten auf der Festplatte nicht, aber ALTER kann langsamer werden, da Enum-Strukturen im Schema der Tabelle selbst gespeichert sind. Daher m√ºssen wir beispielsweise auf Leseanforderungen aus der Tabelle warten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Frage ist, kann man es besser machen? Vielleicht ja. Sie k√∂nnen die Enum-Struktur nicht im Tabellenschema, sondern in ZooKeeper speichern. Es k√∂nnen jedoch Synchronisationsprobleme auftreten. Beispielsweise hat ein Replikat Daten empfangen, das andere nicht, und wenn es eine alte Aufz√§hlung enth√§lt, wird etwas kaputt gehen. (In ClickHouse haben wir die nicht blockierenden ALTER-Anforderungen fast abgeschlossen. Wenn wir sie vollst√§ndig abgeschlossen haben, m√ºssen wir nicht auf </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/rc/vj/yfrcvjamitxxi5taditsaouvrl4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leseanforderungen </font><font style="vertical-align: inherit;">warten.) </font><font style="vertical-align: inherit;">Um sich nicht mit ALTER Enum herumzuschlagen, k√∂nnen Sie externe ClickHouse-W√∂rterb√ºcher verwenden. Ich m√∂chte Sie daran erinnern, dass dies eine Schl√ºsselwert-Datenstruktur in ClickHouse ist, mit der Sie Daten aus externen Quellen abrufen k√∂nnen, beispielsweise aus MySQL-Tabellen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im ClickHouse-W√∂rterbuch speichern wir viele verschiedene Zeilen und in der Tabelle deren Bezeichner in Form von Zahlen. Wenn wir einen String ben√∂tigen, rufen wir die Funktion dictGet auf und arbeiten damit. Danach sollten wir ALTER nicht mehr machen. Um Enum etwas hinzuzuf√ºgen, f√ºgen wir dies in dieselbe MySQL-Tabelle ein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt aber noch andere Probleme. Erstens die umst√§ndliche Syntax. Wenn wir einen String erhalten wollen, m√ºssen wir dictGet aufrufen. Zweitens das Fehlen einiger Optimierungen. Ein Vergleich mit der konstanten Zeichenfolge f√ºr W√∂rterb√ºcher ist ebenfalls nicht schnell m√∂glich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√∂glicherweise treten weiterhin Probleme mit dem Update auf. Angenommen, wir haben eine Zeile im Cache-W√∂rterbuch angefordert, die jedoch nicht in den Cache gelangt ist. Dann m√ºssen wir warten, bis die Daten von einer externen Quelle geladen sind.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/em/4z/ii/em4ziibqzsukh-mvfu2o8dpncv0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein gemeinsamer Nachteil beider Methoden ist, dass wir alle Schl√ºssel an einem Ort speichern und synchronisieren. </font><font style="vertical-align: inherit;">Warum also nicht W√∂rterb√ºcher lokal speichern? </font><font style="vertical-align: inherit;">Keine Synchronisation - kein Problem. </font><font style="vertical-align: inherit;">Sie k√∂nnen das W√∂rterbuch lokal in einem St√ºck auf der Festplatte speichern. </font><font style="vertical-align: inherit;">Das hei√üt, wir haben Einf√ºgen, ein W√∂rterbuch aufgenommen. </font><font style="vertical-align: inherit;">Wenn wir mit Daten im Speicher arbeiten, k√∂nnen wir ein W√∂rterbuch entweder in einen Datenblock oder in einen Teil einer Spalte oder in einen Cache schreiben, um die Berechnungen zu beschleunigen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vokabel-String-Codierung </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So kamen wir zur Erstellung eines neuen Datentyps in ClickHouse - LowCardinality. Dies ist ein Format zum Speichern von Daten: wie sie auf die Festplatte geschrieben und gelesen werden, wie sie im Speicher dargestellt werden und wie sie verarbeitet werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/se/5h/5e/se5h5er0yccult4fjfamsksw4rk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Folie befinden sich zwei Spalten. Auf der rechten Seite werden Zeichenfolgen standardm√§√üig im Zeichenfolgentyp gespeichert. Es ist zu sehen, dass dies eine Art Handy-Modell ist. Links befindet sich genau dieselbe Spalte, nur im Typ LowCardinality. Es besteht aus einem W√∂rterbuch mit vielen verschiedenen Zeilen (Zeilen aus der rechten Spalte) und einer Liste von Positionen (Zeilennummern). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit diesen beiden Strukturen k√∂nnen Sie die urspr√ºngliche Spalte wiederherstellen. Es gibt auch einen umgekehrten inversen Index - eine Hash-Tabelle, mit der Sie die Position im W√∂rterbuch zeilenweise finden k√∂nnen. Es wird ben√∂tigt, um einige Abfragen zu beschleunigen. Wenn wir beispielsweise vergleichen m√∂chten, suchen Sie in unserer Spalte nach einer Zeile oder f√ºhren Sie sie zusammen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LowCardinality ist ein parametrischer Datentyp. Es kann entweder eine Zahl oder etwas sein, das als Zahl oder als Zeichenfolge gespeichert ist, oder Nullable von ihnen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/et/r4/h9/etr4h9fjutj5sf6ffxqjmf04xpu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Besonderheit von LowCardinality ist, dass es f√ºr einige Funktionen gespeichert werden kann. Eine Beispielanforderung wird auf der Folie angezeigt. In der ersten Zeile habe ich aus String eine Spalte vom Typ LowCardinality mit dem Namen S erstellt. Dann habe ich sie nach ihrem Namen gefragt - ClickHouse sagte, es sei LowCardinality aus String. Alles ist richtig. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die dritte Zeile ist fast dieselbe, nur haben wir die L√§ngenfunktion genannt. In ClickHouse gibt die L√§ngenfunktion den UInt64-Datentyp zur√ºck. Aber wir haben LowCardinality von UInt64. Was ist der Punkt?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6h/hs/0x/6hhs0xgy2-hnsc8tputwp8ukqqu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Namen der Handys wurden im W√∂rterbuch gespeichert, wir haben die L√§ngenfunktion angewendet. Jetzt haben wir ein √§hnliches W√∂rterbuch, das nur aus Zahlen besteht. Dies sind die L√§ngen der Zeichenfolgen. Die Spalte mit den Positionen hat sich nicht ge√§ndert. Infolgedessen haben wir weniger Daten verarbeitet, die auf Anfrage gespeichert wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√∂glicherweise gibt es andere Optimierungen, z. B. das Hinzuf√ºgen eines einfachen Caches. Wenn Sie den Wert einer Funktion berechnen, k√∂nnen Sie sich daran erinnern und ihn gleich machen. Berechnen Sie ihn nicht neu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Optimierung kann auch GROUP BY erfolgen, da unsere Spalte mit dem W√∂rterbuch bereits teilweise aggregiert ist. Sie k√∂nnen den Wert der Hash-Funktionen schnell berechnen und grob den Bucket finden, in dem die n√§chste Zeile eingef√ºgt werden soll. Sie k√∂nnen sich auch auf einige Aggregatfunktionen spezialisieren, z. B. uniq, da Sie nur ein W√∂rterbuch an dieses senden und die Positionen unber√ºhrt lassen k√∂nnen. Auf diese Weise funktioniert alles schneller. Die ersten beiden Optimierungen haben wir bereits zu ClickHouse hinzugef√ºgt.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kc/6u/v4/kc6uv48b2vbsmki20ckwvvbc990.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was aber, wenn wir eine Spalte mit unserem Datentyp erstellen und viele fehlerhafte verschiedene Zeilen einf√ºgen? Ist unser Ged√§chtnis voll? Nein, daf√ºr gibt es in ClickHouse zwei spezielle Einstellungen. Der erste ist low_cardinality_max_dictionary_size. Dies ist die maximale Gr√∂√üe eines W√∂rterbuchs, das auf die Festplatte geschrieben werden kann. Das Einf√ºgen erfolgt wie folgt: Wenn wir die Daten einf√ºgen, kommt ein Strom von Zeilen zu uns, aus denen wir ein gro√ües allgemeines W√∂rterbuch bilden. Wenn das W√∂rterbuch gr√∂√üer als der Einstellungswert wird, schreiben wir das aktuelle W√∂rterbuch auf die Festplatte und den Rest der Zeilen irgendwo auf der Seite neben den Indizes. Infolgedessen werden wir niemals ein gro√ües W√∂rterbuch wiedergeben und keine Speicherprobleme bekommen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die zweite Einstellung hei√üt low_cardinality_use_single_dictionary_for_part. Stellen Sie sich vor, dass im vorherigen Schema beim Einf√ºgen der Daten unser W√∂rterbuch voll war und wir es auf die Festplatte geschrieben haben. Es stellt sich die Frage, warum nicht jetzt ein anderes genau das gleiche W√∂rterbuch bilden? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es √ºberl√§uft, schreiben wir es erneut auf die Festplatte und beginnen, eine dritte zu bilden. Diese Einstellung deaktiviert diese Funktion standardm√§√üig.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich k√∂nnen viele W√∂rterb√ºcher n√ºtzlich sein, wenn wir eine Reihe von Zeilen einf√ºgen m√∂chten, aber versehentlich "M√ºll" eingef√ºgt haben. Angenommen, wir haben zuerst die schlechten und dann die guten Zeilen eingef√ºgt. Dann wird das W√∂rterbuch in viele kleine W√∂rterb√ºcher unterteilt. Einige von ihnen werden mit M√ºll sein, aber letztere werden mit guten Linien sein. Und wenn wir zum Beispiel nur das letzte Pellet lesen, funktioniert auch alles schnell. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/jx/jb/jcjxjbo7vmgmexmzxryscvj0lhu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor ich auf die Vorteile von LowCardinality eingehe, m√∂chte ich gleich sagen, dass es unwahrscheinlich ist, dass Daten auf der Festplatte reduziert werden (obwohl dies passieren kann), da ClickHouse die Daten komprimiert. Es gibt eine Standardoption - LZ4. Sie k√∂nnen die Komprimierung auch mit ZSTD durchf√ºhren. Beide Algorithmen implementieren jedoch bereits die W√∂rterbuchkomprimierung, sodass unser externes ClickHouse-W√∂rterbuch nicht viel hilft.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um nicht unbegr√ºndet zu sein, habe ich einige Daten aus der Metrik - String, LowCardinality (String) und Enum - genommen und in verschiedenen Datentypen gespeichert. </font><font style="vertical-align: inherit;">Es stellte sich heraus, dass drei Spalten, in denen eine Milliarde Zeilen geschrieben sind. </font><font style="vertical-align: inherit;">Die erste Spalte, CodePage, enth√§lt insgesamt 62 Werte. </font><font style="vertical-align: inherit;">Und Sie k√∂nnen sehen, dass sie in LowCardinality (String) besser zusammengedr√ºckt wurden. </font><font style="vertical-align: inherit;">Die Saite ist etwas schlechter, aber dies ist h√∂chstwahrscheinlich darauf zur√ºckzuf√ºhren, dass die Saiten kurz sind, wir ihre L√§ngen speichern und sie viel Platz beanspruchen und nicht gut komprimieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie PhoneModel verwenden, gibt es mehr als 48.000 davon, und es gibt fast keine Unterschiede zwischen String und LowCardinality (String). </font><font style="vertical-align: inherit;">F√ºr die URL haben wir auch nur 2 GB gespeichert - ich denke, Sie sollten sich nicht darauf verlassen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sch√§tzung der Arbeitsgeschwindigkeit</font></font></h3> <br>
<img src="https://habrastorage.org/webt/3q/v7/ar/3qv7aronmenayqfhdjait6xo3tw.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link von der Folie</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lassen Sie uns nun die Arbeitsgeschwindigkeit bewerten. Um es auszuwerten, habe ich einen Datensatz verwendet, der Taxifahrten in New York beschreibt. Es</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf GitHub</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">verf√ºgbar</font></a><font style="vertical-align: inherit;">. Es hat etwas mehr als eine Milliarde Reisen. Es zeigt den Ort, die Start- und Endzeiten der Reise, die Zahlungsmethode, die Anzahl der Passagiere und sogar die Art des Taxis - gr√ºn, gelb und Uber.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2o/9n/qb/2o9nqbsb7dodtnoimgnnl66lhlg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die erste Anfrage ganz einfach gemacht - ich habe gefragt, wo Taxis am h√§ufigsten bestellt werden. Dazu m√ºssen Sie den Ort, an dem Sie bestellt haben, nehmen, GROUP BY darauf erstellen und die Z√§hlfunktion berechnen. Hier gibt ClickHouse etwas heraus.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/te/uy/kz/teuykz6_ucr7tuklbfsnobntncc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Geschwindigkeit der Abfrageverarbeitung zu messen, habe ich drei Tabellen mit denselben Daten erstellt, aber drei verschiedene Datentypen f√ºr unseren Startort verwendet - String, LowCardinality und Enum. LowCardinality und Enum sind f√ºnfmal schneller als String. Enum ist schneller, weil es mit Zahlen funktioniert. LowCardinality - weil die GROUP BY-Optimierung implementiert ist. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pl/mx/qr/plmxqrgggpwl4xp2quqggej847k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns die Anfrage komplizieren - fragen Sie, wo sich der beliebteste Park in New York befindet. Wir werden dies wieder daran messen, wo am h√§ufigsten ein Taxi bestellt wird, aber gleichzeitig werden wir nur die Orte herausfiltern, an denen das Wort ‚ÄûPark‚Äú verf√ºgbar ist. F√ºgen Sie auch eine √§hnliche Funktion hinzu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0u/iq/bz/0uiqbzwkh280_wuzn8bccqg2lhi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schauen auf die Zeit - wir sehen, dass Enum pl√∂tzlich langsamer wurde. Und es arbeitet noch langsamer als der Standard-String-Datentyp. Dies liegt daran, dass die Like-Funktion f√ºr Enum √ºberhaupt nicht optimiert ist. Wir m√ºssen unsere Zeilen von Enum in regul√§re Zeilen umwandeln - wir machen mehr Arbeit. LowCardinality (String) ist ebenfalls nicht standardm√§√üig optimiert, funktioniert aber wie dort im W√∂rterbuch, sodass die Abfrage schneller als String ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt ein globaleres Problem mit Enum. Wenn wir es optimieren wollen, m√ºssen wir es an jeder Stelle des Codes tun. Angenommen, wir haben eine neue Funktion geschrieben - Sie m√ºssen sich auf jeden Fall Optimierungen f√ºr Enum einfallen lassen. Und in LowCardinality ist standardm√§√üig alles optimiert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_j/oc/eq/_joceq5ioy66p6gjatm1l5f2rqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns die letzte Anfrage an, k√ºnstlicher. </font><font style="vertical-align: inherit;">Wir berechnen einfach die Hash-Funktion von unserem Standort aus. </font><font style="vertical-align: inherit;">Die Hash-Funktion ist eine ziemlich langsame Anfrage, sie dauert lange, daher wird alles dreimal langsamer. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dn/06/x9/dn06x9ujvdxgdpmjcus8qzlccbg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LowCardinality ist immer noch schneller, obwohl keine Filterung erfolgt. </font><font style="vertical-align: inherit;">Dies liegt daran, dass unsere Funktionen nur im W√∂rterbuch funktionieren. </font><font style="vertical-align: inherit;">Die Hash-Berechnungsfunktion hat ein Argument: Sie kann weniger Daten verarbeiten und auch LowCardinality zur√ºckgeben. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/63/yt/qz/63ytqzwuufiatce0y8wdy4whn5s.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser globaler Plan ist es, in jedem Fall eine Geschwindigkeit zu erreichen, die nicht niedriger als die von String ist, und Beschleunigung zu sparen. </font><font style="vertical-align: inherit;">Und vielleicht werden wir eines Tages String durch LowCardinality ersetzen, Sie werden ClickHouse aktualisieren und alles wird f√ºr Sie etwas schneller funktionieren.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de492850/index.html">Nicht jeder m√∂chte zur Fernarbeit wechseln</a></li>
<li><a href="../de492856/index.html">Covid19, Ihre Gesellschaft und Sie sind aus Sicht von Data Science. √úbersetzter Artikel von Jeremy Howard und Rachel Thomas (fast.ai)</a></li>
<li><a href="../de492862/index.html">Die 15 besten Tipps zur Optimierung der Oracle APEX-Leistung f√ºr Entwickler</a></li>
<li><a href="../de492864/index.html">Kann ich ein Schiff hacken?</a></li>
<li><a href="../de492866/index.html">Das Buch "Maschinelles Lernen ohne Worte"</a></li>
<li><a href="../de492872/index.html">So organisieren Sie den Fernzugriff und leiden nicht unter Hackern</a></li>
<li><a href="../de492874/index.html">Rendering-Optimierung f√ºr Mobile</a></li>
<li><a href="../de492878/index.html">Geek-Hausschuhe: Auf der Suche nach positiven Ergebnissen bei vor√ºbergehenden B√ºroschlie√üungen</a></li>
<li><a href="../de492880/index.html">Was sollen wir ein Smart Home bauen?</a></li>
<li><a href="../de492884/index.html">Empfangen von Nachrichten von YouTube-Sendungen + Google-Autorisierung in PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>