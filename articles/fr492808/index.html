<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ˆ ğŸ”¢ âœ‹ğŸ¾ Capteur de position de l'interrupteur d'Ã©clairage de secours ğŸ  ğŸ¤¦ ğŸŒ²</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avant quiconque conÃ§oit un systÃ¨me d'Ã©clairage de secours autonome, tÃ´t ou tard, le problÃ¨me se pose d'allumer et d'Ã©teindre les lumiÃ¨res de secours. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Capteur de position de l'interrupteur d'Ã©clairage de secours</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant quiconque conÃ§oit un systÃ¨me d'Ã©clairage de secours autonome, tÃ´t ou tard, le problÃ¨me se pose d'allumer et d'Ã©teindre les lumiÃ¨res de secours. </font><font style="vertical-align: inherit;">Comment le faire de la maniÃ¨re la plus pratique et transparente, afin de ne pas gÃ¢cher la conception des piÃ¨ces avec des interrupteurs supplÃ©mentaires?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f4/90/kp/f490kpxmliwuhfpeeuf-lhmjhou.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une des solutions sous la coupe.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le monde moderne, beaucoup de choses sont liÃ©es Ã  une alimentation Ã©lectrique ininterrompue. La plupart des types d'activitÃ©s intellectuelles sont dÃ©jÃ  inconcevables sans un ordinateur et des communications fonctionnant 24h / 24 et 7j / 7. Ce n'est ni bon ni mauvais, Ã§a l'est, et vous devez vivre avec. Surtout si votre lieu de travail n'est pas dans un bureau moderne, rempli d'UPS et de gÃ©nÃ©rateurs diesel de secours, mais dans un appartement d'un immeuble d'habitation ordinaire. Et il se trouve que la fiabilitÃ© de l'approvisionnement Ã©nergÃ©tique des logements dans la plupart des villes de l'ex-URSS laisse beaucoup Ã  dÃ©sirer. En consÃ©quence, le fil reliant la prise de courant domestique et la centrale Ã©lectrique la plus proche a la mauvaise habitude de se casser pÃ©riodiquement. Une fois tous les six mois, et quand et trois fois par jour.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pourquoi, lors du dÃ©marrage des rÃ©parations dans un nouvel appartement, j'ai initialement posÃ© un cÃ¢blage parallÃ¨le dans le projet pour une alimentation et un Ã©clairage ininterrompus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'aimerais beaucoup avoir Ã  ma disposition un puissant gÃ©nÃ©rateur avec ICE, capable de fournir une alimentation normale Ã  tout l'appartement, mais j'ai dÃ» abandonner cette idÃ©e. Dans une maison privÃ©e, la question n'aurait pas Ã©tÃ© posÃ©e du tout, mais un appartement en est une autre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier problÃ¨me est l'Ã©limination des gaz d'Ã©chappement, qui ne sont absolument pas Ã  mettre dans l'appartement d'une maison avec chauffage central. Eh bien, vous ne jeterez pas le tuyau juste Ã  l'extÃ©rieur de la fenÃªtre, oÃ¹ la fumÃ©e est aspirÃ©e instantanÃ©ment dans la fenÃªtre du voisin ouvert le plus proche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me problÃ¨me est le bruit. Oui, les gÃ©nÃ©rateurs Ã  quatre temps Ã  onduleur modernes, lorsque vous les entendez dans la rue, peuvent sembler trÃ¨s silencieux. Et si vous accrochez un silencieux supplÃ©mentaire, puis complÃ¨tement silencieux. Mais croyez-moi, dans un environnement hors tension, ce qui signifie un immeuble d'appartements complÃ¨tement calme, mÃªme un grondement aussi silencieux sera parfaitement audible pour tous les voisins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bref, l'idÃ©e avec le gÃ©nÃ©rateur est morte, donc clairement et pas nÃ©e. Parmi les options rÃ©elles restantes, seules les batteries sont restÃ©es.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, je me permets un simple rÃ©cit de mes Ã©preuves Ã©motionnelles et des dÃ©cisions prises Ã  la premiÃ¨re personne sans aucune prÃ©tention Ã  la vÃ©ritÃ© universelle. </font><font style="vertical-align: inherit;">Et je prÃ©viens immÃ©diatement que mes arguments Ã  quelqu'un peuvent sembler peu convaincants, et les dÃ©cisions prises sont controversÃ©es. </font><font style="vertical-align: inherit;">Mais, nÃ©anmoins, tout ce qui est dÃ©crit ici est actuellement implÃ©mentÃ© dans le matÃ©riel et exÃ©cute avec succÃ¨s les tÃ¢ches. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si quelqu'un s'intÃ©resse Ã  l'aspect purement pratique du problÃ¨me et qu'il n'y ait pas d'importance pour moi, il peut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sauter de nombreuses lettres et passer directement Ã  la description de la solution toute faite.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En bref sur le choix du type de batterie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien que ce problÃ¨me n'ait rien Ã  voir avec le sujet de l'article, je voudrais Ã©galement insÃ©rer mes cinq cents ici. En outre, cela se pose inÃ©vitablement dans le cadre de telles dÃ©clarations, les discussions contiennent souvent beaucoup </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informations utiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, au cours du siÃ¨cle du dÃ©veloppement rapide des Ã©nergies alternatives, des systÃ¨mes d'alimentation Ã©lectrique sans coupure fabriquÃ©s Ã  un prix relativement abordable pour la maison, combinÃ©s Ã  des mini-centrales solaires ou Ã©oliennes, ont commencÃ© Ã  apparaÃ®tre. Les plus avancÃ©s d'entre eux utilisent des batteries lithium-ion avec tout un tas de "exhausteurs" Ã©lectroniques de l'efficacitÃ© de l'ensemble du systÃ¨me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas, il ne peut pas Ãªtre question de mini-centrale pour des raisons objectives, et seule la source de secours, renouvelable Ã  partir d'une prise ordinaire pendant Â«l'illuminationÂ», Ã©tait intÃ©ressante. Par consÃ©quent, il a Ã©tÃ© dÃ©cidÃ© de faire de la ferme collective toute la farce Ã©lectronique de l'onduleur de l'appartement par ses propres moyens. Et comme mes mains Ã©taient complÃ¨tement dÃ©liÃ©es, la premiÃ¨re chose Ã  dÃ©cider Ã©tait le type de piles Ã  utiliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au dÃ©but, j'ai pensÃ© comme ceci: Â«Pourquoi pas le lithium? </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une jeunesse tendance et stylÃ©e</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ScellÃ©, Ã©conome en Ã©nergie, durable. " Mais quand j'ai regardÃ© les prix, ma ferveur de lithium s'est sensiblement apaisÃ©e. Une recherche rapide en combinaison avec l'arithmÃ©tique scolaire a montrÃ© que mÃªme les banques chinoises 26650 trÃ¨s Â«stupidesÂ» avec (bien sÃ»r) les 5000 mAH les plus honnÃªtes coÃ»teront cinq fois plus qu'une batterie acide de mÃªme intensitÃ© Ã©nergÃ©tique. Et si vous choisissez quelque chose qui n'est pas dans le bas du prix triÃ© par prix, la diffÃ©rence atteint facilement 8 Ã  10 fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et comment pouvez-vous compenser une si grande diffÃ©rence de valeur? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, le lithium stocke l'Ã©nergie plus efficacement pour chaque kilogramme et mÃ¨tre cube, et une batterie de la taille d'un bloc de cigarettes consacre facilement une batterie au plomb de dix kilogrammes. Mais ce fait est-il si important pour une utilisation stationnaire?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, un bon "lithium", mais avec la bonne approche durera plus longtemps. Mais dix fois? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le mÃªme temps, de l'autre cÃ´tÃ© de l'Ã©chelle, l'explosivitÃ© potentielle des batteries d'origine inconnue, un algorithme de charge plus complexe, des problÃ¨mes d'Ã©limination (chaque sans-abri sait oÃ¹ utiliser une batterie au plomb Ã  des fins lucratives, tandis que le lithium est beaucoup plus compliquÃ©). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bref, par la somme des facteurs, j'ai dÃ©cidÃ© de reporter l'idÃ©e du lithium jusqu'Ã  la prochaine itÃ©ration. Peut-Ãªtre que dans quelques annÃ©es, quelque chose va changer, mais pour l'instant, le plomb est notre tout.</font></font><br>
<br>
<blockquote>,      ,        .    ,    ,           ,           .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant aux batteries au plomb, il existe Ã©galement plusieurs options. L'option Â«correcteÂ» est des batteries de secours spÃ©cialisÃ©es, qui sont utilisÃ©es dans les onduleurs, dans les stations de base de communication cellulaire et dans d'autres endroits similaires oÃ¹ elles doivent Ãªtre capables de prendre et de dÃ©livrer des courants importants, de subir occasionnellement une forte dÃ©charge et de travailler sans distraire les gens. pour le service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre Â«bonneÂ» option est les batteries de traction pour les chargeurs automatiques Ã©lectriques ou, quoi diable, un sous-marin diesel. Ces batteries ont une durabilitÃ© Ã©levÃ©e et une bonne tolÃ©rance aux dÃ©charges profondes, tout en ne privant pas le propriÃ©taire de la possibilitÃ© de Â«faire le plein d'eauÂ».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la Â«mauvaiseÂ» option est la batterie de dÃ©marrage du magasin de voitures le plus proche. Une telle batterie peut briÃ¨vement donner jusqu'Ã  un kilowatt d'Ã©nergie Ã  la montagne, mais toute dÃ©charge est stressante pour elle, comme le travail pour une personne paresseuse. Et la gloire des piles jetables est gÃ©nÃ©ralement ancrÃ©e dans les piles modernes au calcium: Â«dÃ©chargÃ©es - changezÂ».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, j'espÃ¨re que personne ne doute de l'option que j'ai finalement choisie pour la mise en Å“uvre? Bon, troisiÃ¨me. Et les raisons ici ne rÃ©sident pas seulement dans l'amphibien verruqueux bien connu, mais aussi dans un simple calcul pragmatique. Les batteries de dÃ©marrage sont plusieurs fois moins chÃ¨res que toutes les autres options, se rapprochant parfois du lithium en valeur. Et au lieu de secouer une batterie coÃ»teuse, vous vous sentez beaucoup plus libre dans une situation d'indiffÃ©rence saine, lorsque le remplacement entraÃ®ne des pertes de nourriture pour quelques semaines. De plus, si vous ne laissez pas ces batteries s'Ã©puiser avant de perdre une impulsion, leur durÃ©e de vie dans le rÃ´le des sauvegardes est calculÃ©e pendant de nombreuses annÃ©es. Vous pouvez toujours mettre une batterie avec une plus grande capacitÃ©, dÃ©finir une limite de dÃ©charge plus douce et toujours obtenir un meilleur rapport prix / capacitÃ© que la "bonne" batterie,souffrant d'une dÃ©charge profonde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essentiel Ã  cet Ã©gard est de prÃ©voir une ventilation au moins au niveau du Â«trou dans le murÂ» sur le lieu d'installation des batteries. </font><font style="vertical-align: inherit;">Eh bien, organisez une protection banale contre les courts-circuits, car la basse tension de la source de courant Ã©mousse la vigilance et tout peut trÃ¨s mal se terminer.</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guerre actuelle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans un seul appartement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s un certain rÃ©confort moral provoquÃ© par la dÃ©cision finale sur le type de batterie, une nouvelle raison semble immÃ©diatement rÃ©flÃ©chir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler qu'au dÃ©part, je voulais obtenir un alternateur 230 V. Cependant, aprÃ¨s s'Ãªtre rÃ©conciliÃ© avec la rÃ©alitÃ© objective et Ãªtre passÃ© mentalement aux batteries, l'inertie de la pensÃ©e m'a dÃ©jÃ  conduit sur le cÃ©lÃ¨bre marchÃ© chinois en ligne afin de choisir un convertisseur DC-AC adaptÃ©. Et dans le processus d'Ã©tude des caractÃ©ristiques, le terme Â«onde sinusoÃ¯dale modifiÃ©eÂ», qui a Ã©tÃ© oubliÃ©, a d'abord refait surface, puis le bon sens a commencÃ© Ã  poser des questions inconfortables.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essence des questions Ã©tait la suivante. Pour couvrir tous les besoins Ã©nergÃ©tiques de l'appartement avec une petite batterie ne fonctionnera toujours pas. Des chaudiÃ¨res, un micro-ondes, une machine Ã  laver, un ordinateur de bureau puissant resteront insupportables en puissance. Et le rÃ©frigÃ©rateur, la hotte et mÃªme le ventilateur banal ne pourront pas fonctionner correctement Ã  cause de cette onde sinusoÃ¯dale trÃ¨s modifiÃ©e. Bien sÃ»r, il existe des onduleurs avec une vÃ©ritable onde sinusoÃ¯dale, mais ils sont non seulement plus chers, mais aussi moins efficaces. Et le problÃ¨me des consommateurs puissants n'est toujours pas rÃ©solu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels consommateurs restent dans le budget? Il n'y en a pas beaucoup: l'Ã©lectronique grand public comme les ordinateurs portables et les tÃ©lÃ©phones / tablettes, un routeur, un serveur ARM, l'ambiance est une tÃ©lÃ©vision et, bien sÃ»r, l'Ã©clairage. De plus, le message initial de l'article (et ma motivation personnelle) est justement d'assurer le fonctionnement du poste de travail de secours sous forme d'ordinateur portable et un confort mÃ©nager minimal, comme la lumiÃ¨re dans les toilettes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque tous ces appareils nÃ©cessitent une tension constante de 5 Ã  21 V pour leur fonctionnement et il n'y a aucun objectif objectif d'augmenter d'abord la tension de la batterie Ã  230 V CA, puis de la baisser et de la redresser Ã  plus ou moins le niveau initial. Sur ces transformations, il est facile de perdre jusqu'Ã  50% d'Ã©nergie, ce que je n'ai pas du tout souri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bref, c'est comme Ã§a que l'idÃ©e est venue d'utiliser un rÃ©seau Ã  courant continu basse tension comme alternative. </font><font style="vertical-align: inherit;">Et aprÃ¨s un calcul approximatif des pertes dans les fils, le 12 (13,8) V initial s'est transformÃ© en un 24 (27,6) V. plus pratique.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au dÃ©but, je voulais prendre mÃªme 36 (41,4) B, mais aprÃ¨s avoir Ã©tudiÃ© les caractÃ©ristiques de certains composants Ã©lectroniques que je prÃ©voyais d'utiliser pour travailler avec toute cette Ã©conomie, j'ai dÃ» modÃ©rer mon appÃ©tit.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans un cÃ¢blage alternatif d'une section de 3,5 mm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 de</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuivre pur, la tension a finalement Ã©tÃ© appliquÃ©e Ã  partir de deux batteries de voiture connectÃ©es en sÃ©rie.</font></font><br>
<br>
<blockquote>,        .           (   )   .                ,      .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour permettre aux consommateurs dans les chambres, un point de vente supplÃ©mentaire a Ã©tÃ© ajoutÃ© Ã  chaque Â«grandÂ» bloc de points de vente. Et pour que personne ne confonde une prise ordinaire avec une prise de secours, les produits de type Â«amÃ©ricainÂ» Ã  contacts plats de diffÃ©rentes largeurs ont Ã©tÃ© installÃ©s comme ces derniers. Ceci, d'une part, ne permettra pas Ã  l'aspirateur d'Ãªtre connectÃ© au rÃ©seau DC, et d'autre part, une telle prise, contrairement Ã  la prise europÃ©enne, utilise toujours la mÃªme polaritÃ© lors de l'utilisation de la Â«bonneÂ» prise.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/sm/th/blsmthnmtxqcekbdftv8dfg3u2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ces prises, des adaptateurs pour ordinateur portable ont Ã©tÃ© fabriquÃ©s, abaissant la tension aux 18-20 V souhaitÃ©s et Ã©quipÃ©s des connecteurs correspondants. </font><font style="vertical-align: inherit;">Il est clair que les talons Ã©taient faits des charges USB habituelles de cinq volts pour chaque petite chose. </font><font style="vertical-align: inherit;">Eh bien, juste au cas oÃ¹, une paire de petits convertisseurs 24/230 V a Ã©tÃ© achetÃ©e, avec une puissance de 50 et 200 watts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des Ã©tuis pour charger avec une prise amÃ©ricaine, les mÃªmes cordons d'alimentation et des cartes de convertisseurs d'impulsions prÃªts Ã  l'emploi ont Ã©tÃ© commandÃ©s en Chine. </font><font style="vertical-align: inherit;">Un fer Ã  souder n'Ã©tait nÃ©cessaire que pour connecter les fils. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne parlerai pas de la centrale Ã©lectrique dans cet article, d'autant plus qu'il n'y a rien d'intÃ©ressant, je vais donc aller directement Ã  l'un des problÃ¨mes "du bas", Ã  savoir la question de l'utilisation de l'Ã©nergie accumulÃ©e par la batterie Ã  des fins d'Ã©clairage.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰clairage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lors du cÃ¢blage de l'appartement en parallÃ¨le avec le cÃ¢blage principal, les fils d'un autre rÃ©seau CC avec une tension de 24 (27,6) V. ont Ã©tÃ© tirÃ©s. Entre autres choses, une boucle composÃ©e d'une paire de ces fils a Ã©tÃ© enroulÃ©e dans chaque boÃ®tier de commutation, puis avec les fils du rÃ©seau 230 V conduit aux plafonniers (s'il y en avait plusieurs dans la piÃ¨ce, alors le fil alternatif ne conduisait qu'Ã  un seul).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faire de la sortie du rÃ©seau DC dans le champ de la lampe est une question d'approche individuelle. Comme source de lumiÃ¨re, une bande LED rÃ©guliÃ¨re de 24 volts a Ã©tÃ© choisie. Ses segments de diffÃ©rentes longueurs (proportionnellement Ã  la superficie de la piÃ¨ce), selon la conception des luminaires, Ã©taient soit montÃ©s directement dans leurs logements, soit collÃ©s sur les surfaces d'oÃ¹ il brillerait bien, et d'oÃ¹ il ne serait pas trÃ¨s frappant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tout cas, c'est un problÃ¨me plus esthÃ©tique qu'un problÃ¨me technique, et maintenant c'est autre chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans la boÃ®te de chaque interrupteur, j'ai une boucle d'un fil de phase d'un rÃ©seau 230 V pour allumer la lumiÃ¨re "ordinaire", et une boucle des deux fils d'un rÃ©seau DC pour l'Ã©clairage de secours. De cela et de la danse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, le dÃ©fi devant moi Ã©tait de crÃ©er un certain appareil qui pourrait sÃ©parer trois Ã©tats les uns des autres:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secteur CA OK â†’ Ã©teindre les lumiÃ¨res de secours.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rÃ©seau AC est hors tension, les contacts de l'interrupteur sont fermÃ©s â†’ allumer la lumiÃ¨re de secours. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le rÃ©seau AC est hors tension, les contacts de commutation sont ouverts â†’ Ã©teindre la lumiÃ¨re de secours.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous considÃ©rons que les actions sont unilatÃ©rales, c'est-Ã -dire que, par exemple, Ã©teindre l'Ã©clairage dÃ©jÃ  Ã©teint ne change rien. </font><font style="vertical-align: inherit;">Ces Ã©tats peuvent Ãªtre distinguÃ©s les uns des autres si les tÃ¢ches de dÃ©termination du fonctionnement du rÃ©seau AC et de la position des contacts du commutateur sont rÃ©solues. </font><font style="vertical-align: inherit;">Dans le mÃªme temps, j'avais les conditions initiales suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La gestion de l'Ã©clairage principal et de l'Ã©clairage de secours doit Ãªtre totalement transparente pour un seul organe directeur, pas de Â«ferme collectiveÂ» des boutons supplÃ©mentaires.</font></font></li>
<li> ,  ,   ,        .</li>
<li>      ,        .</li>
<li>      â€“    ,  .</li>
<li>-        .</li>
<li>        (    ),  .</li>
<li>      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sÃ»r, l'absence de secteur AC dans les boÃ®tiers zÃ©ro s'est avÃ©rÃ©e Ãªtre une erreur de calcul trÃ¨s compliquÃ©e. </font><font style="vertical-align: inherit;">Sans cela, la dÃ©termination de la prÃ©sence de tension Ã  l'entrÃ©e de l'interrupteur devient impossible. </font><font style="vertical-align: inherit;">Techniquement, il serait possible d'utiliser le fil nÃ©gatif d'un rÃ©seau Ã  courant continu comme zÃ©ro, mais cela contredit le paragraphe 5 complÃ¨tement indestructible de mon mandat.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe nÃ©anmoins une alternative Ã  la mesure de la tension secteur. Il n'est pas nÃ©cessaire pour moi de dÃ©terminer la prÃ©sence de tension, il suffit de dÃ©terminer la prÃ©sence de courant dans le fil de phase avec les contacts de l'interrupteur fermÃ©s. AprÃ¨s tout, s'il y a du courant, alors il y a de la tension. De plus, la Â«lectureÂ» prÃ©cise du courant permet d'activer l'Ã©clairage de secours non seulement en cas de panne de courant, mais Ã©galement en cas de grillage banal de l'ampoule. Cette mÃ©thode ne permet pas de dÃ©terminer l'Ã©tat du rÃ©seau AC lorsque le commutateur est Ã©teint, mais cet Ã©tat ne me dÃ©range pas, car une fois l'interrupteur Ã©teint, l'Ã©clairage de secours ne devrait pas fonctionner non plus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DÃ©terminer la prÃ©sence de courant dans le fil est assez simple, surtout si ce courant est alternatif. </font><font style="vertical-align: inherit;">Ici, vous pouvez appliquer, par exemple, un capteur Hall qui dÃ©tecte le champ magnÃ©tique autour du fil. </font><font style="vertical-align: inherit;">Mais vous pouvez vous en tirer avec un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transformateur de courant ordinaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , composÃ© d'un circuit magnÃ©tique en anneau avec un enroulement. </font><font style="vertical-align: inherit;">Un fil de courant alternatif passe Ã  travers l'anneau, ce qui crÃ©e un champ magnÃ©tique dans le circuit magnÃ©tique. </font><font style="vertical-align: inherit;">Ce champ induit Ã  son tour un courant secondaire dans l'enroulement, proportionnel au courant primaire dans le fil. </font><font style="vertical-align: inherit;">Ainsi, ce dispositif simple vous permet de mesurer la force du courant alternatif dans n'importe quel fil, sans le casser et gÃ©nÃ©ralement sans connexion galvanique avec le circuit primaire.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le travail des pinces de courant, un outil trÃ¨s utile pour tout Ã©lectricien, est basÃ© sur le mÃªme principe.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il y a un tel transformateur prÃ¨s de l'interrupteur, il suffit de mesurer la tension sur son enroulement secondaire pour savoir si un courant circule dans le circuit de la lampe. La prÃ©sence de courant, comme je l'ai dit, en premiÃ¨re approximation indique deux faits: il y a une tension dans le rÃ©seau 230 V, et l'interrupteur est fermÃ©. Le premier de ces faits est essentiel pour le fonctionnement du dispositif d'activation de l'Ã©clairage de secours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me "paramÃ¨tre d'entrÃ©e" de mon futur appareil devrait Ãªtre la position des contacts de commutation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le Â«brainstormingÂ» initiÃ© parmi les collÃ¨gues amateurs a apportÃ© diverses options pour dÃ©terminer la position du commutateur, ce qui se rÃ©sumait principalement Ã  modifier la conception afin d'y ajouter une autre paire de contacts. Ici, les possibilitÃ©s d'imagination sont assez grandes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il Ã©tait possible de prendre un double au lieu d'un simple interrupteur et de Â«parallÃ©liserÂ» mÃ©caniquement ses moitiÃ©s afin qu'elles deviennent un seul ensemble. Cette option ne diffÃ©rait pas dans l'esthÃ©tique extÃ©rieure et ne rÃ©solvait pas le problÃ¨me dans les piÃ¨ces oÃ¹ l'Ã©clairage Ã©tait Ã  double circuit et l'interrupteur Ã©tait initialement double. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'autres options impliquaient l'introduction d'un micro-interrupteur ou d'un interrupteur Ã  lames avec un aimant dans le mÃ©canisme de l'interrupteur. Mais aprÃ¨s avoir Ã©tudiÃ© les conceptions des disjoncteurs appliquÃ©s, ces options ont Ã©galement disparu. La base en cÃ©ramique monolithique d'un bon interrupteur ne laisse simplement aucune chance, mÃªme pour un microrupteur compact, et l'aimant et l'interrupteur Ã  lames n'ont pas fonctionnÃ© en raison d'une course de clÃ© trop faible et d'une hystÃ©rÃ©sis dans la courbe de fonctionnement / relÃ¢chement de l'interrupteur Ã  lames.</font></font><br>
<br>
<blockquote> Â«Â»        ,     . , ,       ,  .  ,   ,    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bref, il fallait trouver une mÃ©thode qui ne nÃ©cessiterait pas de modification du commutateur. Et cette mÃ©thode a Ã©tÃ© trouvÃ©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessus, j'ai dÃ©crit un transformateur de courant, qui permet de dÃ©terminer la prÃ©sence de courant alternatif dans un fil sans rupture et sans contact galvanique. Mais tout transformateur est un appareil bidirectionnel (contrairement au mÃªme capteur Hall), ses enroulements primaire et secondaire sont interchangeables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous appliquons un courant alternatif Ã  l'enroulement secondaire d'un tel transformateur, il induit une tension aux extrÃ©mitÃ©s du fil enfilÃ© dans l'anneau. Et, plus important encore, l'Ã©nergie consommÃ©e par le bobinage de la source dÃ©pendra du fait que le courant secondaire dans le fil trouvera son chemin pour un mouvement circulaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ici, cela devient plus intÃ©ressant. </font><font style="vertical-align: inherit;">Un fil passe Ã  travers l'anneau, qui est immÃ©diatement, en quelques centimÃ¨tres, connectÃ© Ã  l'un des contacts de l'interrupteur. </font><font style="vertical-align: inherit;">Il ne reste plus qu'Ã  fournir Ã  ce courant un chemin de retour de l'autre cÃ´tÃ© de l'interrupteur afin d'obtenir un dispositif de Â«dÃ©tectionÂ» de la position des contacts. </font><font style="vertical-align: inherit;">Et pour la raison que ce courant est alternatif, un condensateur conventionnel peut devenir un pont pour lui.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/tr/g1/gstrg12mwdwhgu0qmbnl3twrfjc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En principe, pour fermer ce circuit dans certaines conditions, un condensateur n'est pas nÃ©cessaire. </font><font style="vertical-align: inherit;">Si un courant d'une frÃ©quence suffisamment Ã©levÃ©e est Â«pompÃ©Â» dans le transformateur, alors la capacitÃ© parasite entre les fils sera suffisante pour le passage.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/up/yp/ws/upypwscprb9xjbrlaye26xfkry8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, ce qui est nÃ©cessaire pour organiser un tel dÃ©tecteur:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transformateur de courant.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compteur de tension de sortie du transformateur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source de courant alternatif haute frÃ©quence.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compteur de courant traversant l'enroulement d'un transformateur inversÃ©.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus difficile en termes de sÃ©lection des paramÃ¨tres optimaux est un transformateur qui, dans le mode transformateur de courant, devrait fournir une tension acceptable avec une frÃ©quence de 50 Hz, et dans le mode actif de dÃ©tection de l'Ã©tat du disjoncteur, ont un coefficient de transmission acceptable Ã  une frÃ©quence de centaines de KHz. </font><font style="vertical-align: inherit;">Cet Ã©lÃ©ment n'est pas possible de simuler dans un programme de modÃ©lisation de circuits Ã©lectroniques, et mÃªme avec un calcul mathÃ©matique, tout s'est avÃ©rÃ© trÃ¨s difficile. </font><font style="vertical-align: inherit;">J'ai dÃ» prendre un fer Ã  souder dans mes mains et passer des heures Ã  conduire diffÃ©rentes options Ã  la recherche du meilleur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nombre de tours et la rÃ©sistance optimale Ã  la charge ont Ã©tÃ© choisis empiriquement et non le fait que je n'ai pas ratÃ© le meilleur rapport. </font><font style="vertical-align: inherit;">Ã€ la suite des expÃ©riences, la construction suivante est apparue:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noyau en ferrite avec une permÃ©abilitÃ© de 10 000, taille 10x6x4 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enroulement 30 tours avec fil Ã©maillÃ© de 0,25 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La charge active de l'enroulement est de 1 kOhm.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La permÃ©abilitÃ© magnÃ©tique est assez grande, probablement, il serait logique d'utiliser un anneau pour 5000 voire 2000 unitÃ©s, mais en quantitÃ© suffisante j'avais ces anneaux. </font><font style="vertical-align: inherit;">En gÃ©nÃ©ral, la permÃ©abilitÃ© dans ce cas est une valeur de compromis. </font><font style="vertical-align: inherit;">Trop bas, le transformateur ne peut pas fonctionner Ã  une frÃ©quence de 50 Hz et trop Ã©levÃ© gÃ¢che tout Ã  des frÃ©quences supÃ©rieures Ã  des centaines de kilohertz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De multiples expÃ©riences ont confirmÃ© la rÃ©alitÃ© de l'idÃ©e et les rÃ©sultats suivants ont Ã©tÃ© obtenus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mode transformateur de courant, le coefficient de transmission s'est avÃ©rÃ© Ãªtre d'environ un millivolt par watt de puissance circulante (tension 220-230 V).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mode sonde, en fonction de la frÃ©quence et de la capacitÃ© de la fuite, la diffÃ©rence de courant avec les contacts fermÃ©s et ouverts de l'interrupteur atteint deux Ã  trois fois.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Les deux valeurs sont plus que suffisantes pour une fixation fiable du courant circulant et pour dÃ©terminer la position des contacts de commutation. </font><font style="vertical-align: inherit;">Cela dÃ©pend uniquement de l'implÃ©mentation spÃ©cifique.</font></font><br>
<br>
<a name="Solution"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contrairement Ã  la plupart de ses autres conceptions, ici dÃ©jÃ  aux premiers stades de la dÃ©libÃ©ration, il a Ã©tÃ© dÃ©cidÃ© d'utiliser immÃ©diatement le microcontrÃ´leur. </font><font style="vertical-align: inherit;">En fonction des besoins et de l'expÃ©rience, le choix s'est portÃ© sur l'ATtiny13A. </font><font style="vertical-align: inherit;">Cette puce a un ADC, et avec la possibilitÃ© d'utiliser une source de rÃ©fÃ©rence interne de 1,1 V au lieu de la tension d'alimentation. </font><font style="vertical-align: inherit;">Il existe un PWM idÃ©al pour gÃ©nÃ©rer un signal sonore. </font><font style="vertical-align: inherit;">Et, qui s'est avÃ©rÃ© plus tard important, il existe une EEPROM qui vous permet de stocker les donnÃ©es d'Ã©talonnage.</font></font><br>
<br>
<blockquote>,          Â«  ,       ,       - Â«Â» ,  Â».<br>
<br>
      .         .           .   ,   ,  ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous devez combiner au moins un gÃ©nÃ©rateur, un voltmÃ¨tre et une sorte de dÃ©clencheur pour stocker l'Ã©tat actuel entre les mesures. En gÃ©nÃ©ral, tout croquis spÃ©culatif ne nÃ©cessitait au moins trois cas que sur le "noyau", et le contrÃ´leur s'est avÃ©rÃ© beaucoup plus pratique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tension du transformateur de courant avec une charge de 10-20 W est de 10-20 mV et elle est trop petite pour la fournir Ã  l'entrÃ©e DAC avec une limite de 1,1 V. Par consÃ©quent, en plus du contrÃ´leur, vous avez Ã©galement besoin d'un amplificateur avec un coefficient de transfert d'environ 100 pour augmenter la tension du signal au moins jusqu'Ã  des centaines de millivolts.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En gÃ©nÃ©ral, la tension du signal de sortie d'un transformateur de courant dÃ©pend non seulement de la puissance de charge, mais Ã©galement de sa nature. </font><font style="vertical-align: inherit;">Une charge purement active telle que l'ampoule d'Ilyich, par exemple, donne une onde sinusoÃ¯dale de niveau millivolt. </font><font style="vertical-align: inherit;">Une ampoule LED de la mÃªme puissance avec une puissance d'impulsion simple donne de courtes rafales aux volts et au-dessus. </font><font style="vertical-align: inherit;">On pouvait jouer lÃ -dessus, mais, d'une part, je voulais fabriquer un appareil universel, et d'autre part, dans l'appartement, il y avait une lampe avec un bloc d'alimentation externe Ã©quipÃ© d'un circuit PFC (c'est-Ã -dire ayant une caractÃ©ristique de consommation proche de l'actif).</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne tourmenterai pas le lecteur avec des options intermÃ©diaires et donnerai immÃ©diatement le schÃ©ma final de l'appareil.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/at/a-/vdata-spt78rd_pzv7s5awoobya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la tension continue via le rÃ©gulateur linÃ©aire Ã©conomique LM2931-5.0 alimente le contrÃ´leur. En termes de boÃ®tier, de fonctionnalitÃ© et de brochage, ce stabilisateur est similaire au 78L05 populaire, mais s'en distingue par une consommation intrinsÃ¨que plus faible (environ 500 Î¼A Ã  une charge de 10 mA) et une plus grande tolÃ©rance aux courtes impulsions de tension d'entrÃ©e. Si vous prÃ©voyez de travailler avec une tension ne dÃ©passant pas 20 V, vous pouvez utiliser un analogue encore plus Ã©conomique du LP2950-5.0.</font></font><br>
<br>
<blockquote>   LP2950-5.0        30 .      24      .    -      ,     ,       ,     ,   .          50%,   100%.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le transformateur n'est pas reprÃ©sentÃ© sur le schÃ©ma, mais son enroulement est connectÃ© aux broches TR1 et TR2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant qu'Ã©lÃ©ment clÃ© pour commuter la charge, un transistor MOS Ã  canal P Ã  faible courant 2SJ196 est utilisÃ© (un courant jusqu'Ã  1 A devrait Ãªtre suffisant pour n'importe quelle lampe LED), mais tout autre adaptÃ© au brochage, le courant maximal et la tension de drain maximale peuvent Ãªtre utilisÃ©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du contrÃ´leur et de la clÃ© des Ã©lÃ©ments actifs, deux transistors sont utilisÃ©s. Un est nÃ©cessaire pour contrÃ´ler l'obturateur de la clÃ©, fonctionnant sous la tension de la source d'urgence. Le second agit comme un signal amplificateur de la sortie du transformateur de courant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ ce stade, vous pouvez utiliser des amplificateurs opÃ©rationnels, mais en termes de dÃ©tails, le gain est minime et vous devez oublier de travailler Ã  des frÃ©quences supÃ©rieures Ã  plusieurs centaines de kilohertz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas le signal amplifiÃ© du transformateur lui-mÃªme qui est envoyÃ© Ã  l'ADC, mais son enveloppe, qui peut Ãªtre mesurÃ©e par un seul Ã©chantillon, et non par une numÃ©risation en "streaming" pendant un certain temps. Pour isoler l'enveloppe, deux diodes Schottky sont utilisÃ©es, connectÃ©es selon le circuit de doublage de tension. Une telle inclusion forme un dÃ©tecteur d'amplitude classique, dans lequel la chute de tension aux bornes des diodes elles-mÃªmes est largement compensÃ©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe de fonctionnement du capteur est simple. ConsidÃ©rons d'abord l'algorithme des actions nÃ©cessaires pour mesurer le courant dans le fil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mode de mesure actuel, la broche PB0 est mise en mode sortie et est mise Ã  la terre par un zÃ©ro logique. Cela empÃªche l'envoi de signaux du contrÃ´leur au point TR1. En parallÃ¨le, les mÃªmes actions sont effectuÃ©es sur la broche PB3, Ã  la suite de laquelle la sortie supÃ©rieure du condensateur C2 est mise Ã  la terre. Ce condensateur avec la rÃ©sistance R1 crÃ©e un filtre passe-bas avec une frÃ©quence de coupure d'environ 1500 Hz. GrÃ¢ce Ã  ce filtre, le rÃ´le de divers bruits haute frÃ©quence dans la formation du signal mesurÃ© est fortement rÃ©duit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, un niveau Ã©levÃ© est appliquÃ© au PB4 pour alimenter l'amplificateur de signal. AprÃ¨s l'achÃ¨vement des transitoires, un courant de 50 Hz provenant de la sortie du transformateur est amplifiÃ© et arrive au redresseur, oÃ¹ il charge le condensateur C8.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La charge du condensateur C8 est mesurÃ©e Ã  l'aide d'ADC1 et Ã  partir de la valeur de tension obtenue, une conclusion est tirÃ©e au sujet du courant Â«primaireÂ» traversant le transformateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La dÃ©tection active est effectuÃ©e diffÃ©remment. Tout d'abord, la broche PB0 est traduite en un solveur PWM, et un signal lui est envoyÃ© avec une frÃ©quence de centaines de kilohertz Ã  des unitÃ©s de mÃ©gahertz. Ce signal est quelque peu attÃ©nuÃ© par un diviseur rÃ©sistif et envoyÃ© Ã  l'enroulement du transformateur de courant au point TR1. Le condensateur C1, avec un bras supÃ©rieur du diviseur R4, crÃ©e un filtre passe-bas avec une frÃ©quence de coupure d'environ 1,5 MHz, ce qui rÃ©duit le niveau des harmoniques haute frÃ©quence des impulsions rectangulaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s avoir traversÃ© l'enroulement du transformateur, le signal de la sonde du point TR2 parvient au mÃªme amplificateur et dÃ©tecteur, de mÃªme, Ã  la fin, charge le condensateur C8 Ã  une tension proportionnelle Ã  la charge dans le circuit "externe" du transformateur. De la mÃªme maniÃ¨re, la charge du condensateur est mesurÃ©e Ã  l'aide de l'ADC du microcontrÃ´leur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant des explications pour certains "lÃ¢ches". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La rÃ©sistance R5 est conÃ§ue pour limiter la tension Ã  la grille de l'interrupteur d'alimentation, qui pour les MOSFET basse tension ne doit gÃ©nÃ©ralement pas dÃ©passer 20 V.Dans mon cas, le rÃ©seau CC a une tension allant jusqu'Ã  30 V, ce qui a dictÃ© la nÃ©cessitÃ© d'un diviseur 1: 3, qui est obtenu en conjonction avec R3. Lorsqu'elle est alimentÃ©e par une source de moins de 20 V, la rÃ©sistance R5 n'est pas nÃ©cessaire (remplacÃ©e par un cavalier).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les condensateurs C4 et C5 sont connectÃ©s en parallÃ¨le pour atteindre une capacitÃ© de 2 Î¼F. Cette paire de condensateurs est remarquable en ce qu'elle doit transmettre aussi bien des signaux de basses que de hautes frÃ©quences. Ici, il serait possible d'utiliser une connexion parallÃ¨le d'un condensateur Ã©lectrolytique de plusieurs microfarads et d'une cÃ©ramique de cent ou deux nanofarads, mais un "Ã©lectrolyte" d'une si petite capacitÃ© ne donne pas de gain de taille par rapport aux "cÃ©ramiques" microfarad. Certes, il n'Ã©tait pas possible d'acheter un condensateur cÃ©ramique Ã  2 microfarads, donc j'en ai mis deux pareils.</font></font><br>
<br>
<blockquote>,   50     2  ,      .   ,        .               .    100   , ,   .       .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les rÃ©sistances R4 et R1 forment une division de tension qui Ã©galise plus ou moins la tension alternative de cinq volts Ã  la sortie PWM avec la tension de sortie du transformateur de courant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le condensateur C8, comme mentionnÃ© prÃ©cÃ©demment, accumule la tension Ã  mesurer. C'est mieux s'il s'agit d'un condensateur de haute qualitÃ© avec un courant de fuite minimum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une mention spÃ©ciale mÃ©rite le Â«peigneÂ» TP1 / TP2 Ã  deux broches connectÃ© Ã  la jambe de rÃ©initialisation du microcontrÃ´leur. Ces contacts sont utilisÃ©s non seulement pour redÃ©marrer, mais pour entrer dans le mode d'Ã©talonnage, qui est dÃ©crit ci-dessous. Simplement, aprÃ¨s l'implÃ©mentation de toute la liste de souhaits, le contrÃ´leur n'avait plus de broches libres, et la nÃ©cessitÃ© d'ajouter un simple contrÃ´le est apparue lors du dÃ©bogage du firmware. J'ai donc dÃ» utiliser le pied de rÃ©initialisation du contrÃ´leur Ã  cet effet.</font></font><br>
<br>
<blockquote> Â«Â»  AVR     RESET       GPIO.         ,       .         ,        .   ,        ,      ,      ,            RESET.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En gÃ©nÃ©ral, le circuit s'est avÃ©rÃ© assez simple, et toute la Â«magieÂ» est implÃ©mentÃ©e dans le firmware du microcontrÃ´leur. Cependant, aprÃ¨s la fabrication du prototype, il s'est avÃ©rÃ© que la capacitÃ© de cÃ¢blage pour un fonctionnement fiable de la "sonde" n'est souvent pas suffisante. La diffÃ©rence de courant Ã  travers le transformateur s'avÃ¨re simplement comparable au niveau d'interfÃ©rence et le fonctionnement du circuit devient peu fiable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, j'ai dÃ» abandonner l'anneau de ferrite suspendu librement aux fils et ajouter un circuit haute tension directement Ã  la carte dans une nouvelle rÃ©vision de l'appareil, afin de faciliter la tÃ¢che de sondage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point ici est d'ajouter un condensateur dÃ©diÃ©, allumÃ© de sorte que le moyen le plus court de fermer le chemin du courant RF Ã  travers les contacts du commutateur.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i-/_f/63/i-_f636miltufzwifkx4xaxnab0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le condensateur C10 doit Ãªtre conÃ§u pour une tension d'au moins kilovolts, et sa capacitÃ© doit Ãªtre choisie selon un principe de compromis afin que la fiabilitÃ© de fonctionnement soit suffisante pour une utilisation pratique, et que le courant capacitif parasite Ã  travers la lampe ne soit pas trop grand. </font><font style="vertical-align: inherit;">En pratique, vous pouvez essayer de "jouer" avec cette dÃ©nomination, si nÃ©cessaire.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En tout Ã©tat de cause, un interrupteur Ã©quipÃ© d'un tel capteur ne peut plus Ãªtre perÃ§u comme idÃ©al. </font><font style="vertical-align: inherit;">Au contraire, il est similaire Ã  un interrupteur avec un indicateur.Par consÃ©quent, d'une part, il peut provoquer une lumiÃ¨re parasite ou un scintillement de lampes LED de faible qualitÃ©, et d'autre part, il peut provoquer un choc Ã©lectrique, mais pas un fort. </font><font style="vertical-align: inherit;">Par consÃ©quent, vous n'avez jamais besoin de travailler avec le cÃ¢blage d'Ã©clairage, en vous appuyant uniquement sur l'interrupteur dans le mur, Ã©teignez toujours l 'Â«interrupteurÂ» Ã  l'entrÃ©e.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, comme je devais encore ajouter une partie du rÃ©seau AC Ã  la carte, j'ai ajoutÃ© deux selfs d'arrÃªt lÃ -bas, ce qui ne laissera pas le courant de sonde haute frÃ©quence passer dans le cÃ¢blage. La valeur pratique de la frÃ©quence de la tension de sondage peut atteindre plusieurs MHz et moi, en tant que radio-amateur, j'en ai trÃ¨s marre de l'idÃ©e d'augmenter la quantitÃ© d'interfÃ©rences dans le rÃ©seau de mes propres mains. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les selfs L1 et L2 doivent Ãªtre Ã©lectriques, enroulÃ©s avec un fil d'une Ã©paisseur notable sur les noyaux de type haltÃ¨re ou anneau. Les inductances de signal dans la conception axiale de Â«rÃ©sistanceÂ» ne peuvent pas Ãªtre utilisÃ©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tour principal du transformateur de courant est maintenant un morceau de fil enfilÃ© Ã  travers l'anneau et soudÃ© aux points TR3 et TR4 sur la carte. Il est prÃ©fÃ©rable que ce fil soit blindÃ©, tout en connectant l'Ã©cran Ã  TR5 et TR6 des deux cÃ´tÃ©s de l'anneau.</font></font><br>
<br>
<blockquote> TR6       ,   .    -   ,           .          ,          .</blockquote><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code du micrologiciel et le fichier HEX assemblÃ© sont joints Ã  la fin de l'article avec le circuit et la disposition de la carte de circuit imprimÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme du dÃ©tecteur accordÃ© est simple. Toutes les trois secondes, le contrÃ´leur se rÃ©veille d'un sommeil profond, prend des mesures et, si nÃ©cessaire, modifie l'Ã©tat de la touche de commande dans une direction ou dans une autre. Ainsi, la rÃ©action Ã  un changement de position de l'interrupteur peut avoir un retard pouvant aller jusqu'Ã  trois secondes. Pas trÃ¨s pratique, mais cela se fait, d'une part, pour Ã©conomiser l'Ã©nergie de la source de secours, et d'autre part, pour rÃ©duire considÃ©rablement l'intervalle d'interrogation ne permet pas la durÃ©e des transitoires Ã  diffÃ©rents stades de mesure. L'intervalle minimum peut Ãªtre considÃ©rÃ© comme Ã©gal Ã  une seconde, mais le circuit sera alors en mode de consommation active presque tout le temps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, en conclusion, sur la configuration. En raison du fait que diffÃ©rents capteurs doivent fonctionner dans des conditions complÃ¨tement diffÃ©rentes en fonction du courant consommÃ© par la lampe, de la longueur et d'autres caractÃ©ristiques de cÃ¢blage, du niveau d'interfÃ©rence, etc., il Ã©tait impossible de mettre un ensemble universel de paramÃ¨tres adaptatifs dans le micrologiciel. Par consÃ©quent, chaque capteur aprÃ¨s l'installation nÃ©cessite un seul Ã©talonnage sur site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le capteur passe en mode d'Ã©talonnage Ã  chaque mise sous tension, en l'absence de donnÃ©es d'Ã©talonnage, ou aprÃ¨s fermeture des contacts TP1 et TP2. L'entrÃ©e dans la premiÃ¨re Ã©tape de l'Ã©talonnage est indiquÃ©e par un voyant d'urgence clignotant cinq fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AprÃ¨s cinq clignotements, 7,5 secondes sont accordÃ©es pour rÃ©gler l'interrupteur sur la position Â«offÂ», s'il a Ã©tÃ© activÃ© auparavant. PassÃ© ce dÃ©lai, le niveau d'interfÃ©rence toujours prÃ©sent dans le rÃ©seau AC est mesurÃ©. La valeur obtenue est utilisÃ©e comme point de dÃ©part pour les mesures dans le rapport cyclique. Toujours Ã  ce moment, le disjoncteur est dÃ©tectÃ© Ã  diffÃ©rentes frÃ©quences pour la sÃ©lection ultÃ©rieure de la frÃ©quence la plus "contrastÃ©e".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, la deuxiÃ¨me Ã©tape d'Ã©talonnage commence et le voyant d'urgence clignote deux fois. 7,5 secondes de temps sont accordÃ©es pour mettre l'interrupteur en position Â«onÂ» et aprÃ¨s la temporisation, le programme mesure le courant consommÃ© par la lampe. Si la lampe a plusieurs niveaux de luminositÃ©, aprÃ¨s avoir allumÃ©, vous devez immÃ©diatement la rÃ©gler au minimum, afin qu'Ã  l'avenir, le capteur fonctionne correctement avec l'un des niveaux disponibles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le dÃ©but de la troisiÃ¨me et derniÃ¨re Ã©tape d'Ã©talonnage est marquÃ© par un clignotement Ã  trois reprises de la lampe de secours et nÃ©cessite que l'interrupteur reste en mode Â«marcheÂ» et que le rÃ©seau d'Ã©clairage soit mis hors tension Ã  un niveau supÃ©rieur (c'est-Ã -dire avec le disjoncteur principal ou secondaire sur le panneau) au plus tard Ã  travers les mÃªmes 7,5 secondes Dans ce cas, un deuxiÃ¨me sondage du disjoncteur dÃ©jÃ  activÃ© Ã  diffÃ©rentes frÃ©quences est effectuÃ© et en tenant compte des valeurs obtenues au premier Ã©tage, la frÃ©quence est choisie Ã  laquelle la diffÃ©rence de courant Ã  travers l'interrupteur marche / arrÃªt est maximale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La rÃ©ussite de l'Ã©talonnage est indiquÃ©e par un simple clignotement de la lampe de secours et, si le rÃ©seau d'Ã©clairage aprÃ¨s la troisiÃ¨me phase est toujours hors tension, en allumant l'Ã©clairage de secours lors du prochain cycle d'interrogation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les valeurs mesurÃ©es des courants et des rÃ©sistances dans des conditions diffÃ©rentes sont trop proches et ne peuvent pas Ãªtre utilisÃ©es pour une dÃ©tection fiable, l'Ã©talonnage Ã©choue. </font><font style="vertical-align: inherit;">Dans ce cas, la lampe d'Ã©clairage de secours clignote deux fois lorsque la position de l'interrupteur Ã©choue, ou trois fois lorsque la consommation standard de la lampe d'Ã©clairage est trop faible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cas de rÃ©ticence persistante du capteur Ã  calibrer avec un double clignotement au final, vous devriez essayer d'augmenter la capacitÃ© de C10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil s'est avÃ©rÃ© Ãªtre assez simple, assez compact pour tenir dans un boÃ®tier de commutation, mais pour ne pas dire qu'il est trÃ¨s facile Ã  configurer. </font><font style="vertical-align: inherit;">Bien sÃ»r, il ne s'appuie pas sur le composant d'une "maison intelligente" moderne, car il n'a pas de 5G, le contrÃ´le du cloud, et mÃªme le WiFi banal avec GPS n'est pas fourni. </font><font style="vertical-align: inherit;">NÃ©anmoins, huit de ces appareils remplissent leur seule fonction, et rien d'autre n'est requis d'eux dans des conditions de panne d'Ã©lectricitÃ©.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source du firmware (Atmel Studio 7)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 9600000 <span class="hljs-comment">//   (  : avrdude.exe -U lfuse:w:0x7a:m -U hfuse:w:0xff:m)</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/eeprom.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//#define PROTEUS</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">bool</span>; <span class="hljs-comment">//   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> true  (0 == 0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> false (0 != 0)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_U10BIT 0b0000001111111111 <span class="hljs-comment">//      </span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTERVAL         3   <span class="hljs-comment">//  , </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUR_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RES_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_DIV_OFFSET  2   <span class="hljs-comment">//     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_MAXIMAL_DIV 6   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_cur_edge;<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_res_edge; <font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> EEPROM_frequency_dividor;<font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_edge, res_edge; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frequency_dividor; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> clk = <span class="hljs-number">0</span>; <span class="hljs-comment">//   watchdog</span>
<span class="hljs-keyword">bool</span> tp_reset = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   TP1  TP2</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_vars</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">if</span>(MCUSR &amp; (<span class="hljs-number">1</span> &lt;&lt; EXTRF)) { <span class="hljs-comment">// ,       TP1  TP2</span>
    tp_reset = <span class="hljs-literal">true</span>;<font></font>
    MCUSR &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; EXTRF); <span class="hljs-comment">//  EXTRF       ,   </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_pins</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB0) | (<span class="hljs-number">1</span> &lt;&lt; PB1) | (<span class="hljs-number">1</span> &lt;&lt; PB2) | (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//       </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    watchdog</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_interrupts</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  sleep_enable(); <span class="hljs-comment">//   </span><font></font>
<font></font>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDCE) | (<span class="hljs-number">1</span> &lt;&lt; WDE); <span class="hljs-comment">//  watchdog</span>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDTIE) | WDTO_1S; <span class="hljs-comment">// watchdog      ,  1 </span><font></font>
<font></font>
  sei(); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_settings</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  cur_edge = eeprom_read_word(&amp;EEPROM_cur_edge); <span class="hljs-comment">//   </span>
  res_edge = eeprom_read_word(&amp;EEPROM_res_edge); <span class="hljs-comment">//   </span>
  frequency_dividor = eeprom_read_byte(&amp;EEPROM_frequency_dividor); <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_load</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blink_load</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> count)</span> </span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">true</span>);<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">false</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   (   )</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) sleep_cpu();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_amp</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//     PB4</span>
    _delay_ms(<span class="hljs-number">250</span>);      <span class="hljs-comment">//       200 .</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB4);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_lpf</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    (  "0")     C2</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    ( )   C2  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_gen</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    TCCR0A |= (<span class="hljs-number">1</span> &lt;&lt; COM0A0) | (<span class="hljs-number">1</span> &lt;&lt; WGM01); <span class="hljs-comment">//    ( )    OC0A      OCR0A</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> PROTEUS</span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00); <span class="hljs-comment">//    1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00) | (<span class="hljs-number">1</span> &lt;&lt; CS02); <span class="hljs-comment">//    1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    OCR0A = FREQ_DIV_OFFSET + frequency_dividor; <span class="hljs-comment">//   ,         OC0A</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    TCCR0A = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_adc</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    ( )</span>
    ADMUX = <span class="hljs-number">0b01</span> | (<span class="hljs-number">1</span> &lt;&lt; REFS0); <span class="hljs-comment">// PB2, 1.1v reference</span>
    ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADPS0) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | <span class="hljs-comment">//       = 128 (75 )</span>
             (<span class="hljs-number">1</span> &lt;&lt; ADIE) |  <span class="hljs-comment">//    </span>
             (<span class="hljs-number">1</span> &lt;&lt; ADEN);   <span class="hljs-comment">//  </span>
  } <span class="hljs-keyword">else</span> {<font></font>
    ADCSRA = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    (  "0")   C8</span>
    _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      C8</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_adc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_ADC); <span class="hljs-comment">//   "" </span>
  <span class="hljs-keyword">do</span> {<font></font>
    sleep_cpu(); <span class="hljs-comment">//      ,      ,   </span>
  } <span class="hljs-keyword">while</span>(ADCSRA &amp; (<span class="hljs-number">1</span> &lt;&lt; ADSC)); <span class="hljs-comment">//        ,  </span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> ADC;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
//  
static void blink_bin(unsigned int value, unsigned char count) {
  for(unsigned char i = 0; i &lt; count; ++i) {
    _delay_ms(1000);
    toggle_load(true);
    if(value &amp; (1 &lt;&lt; (count - i - 1))) {
      _delay_ms(500);
    } else {
      _delay_ms(50);
    }
    toggle_load(false);
  }
}
*/</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur;<font></font>
<font></font>
  toggle_lpf(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  cur = do_adc(); <span class="hljs-comment">//  </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
  toggle_lpf(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> cur;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_resistance</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  toggle_gen(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  toggle_gen(<span class="hljs-literal">false</span>); <span class="hljs-comment">//   ,   C8     </span>
  res = do_adc(); <span class="hljs-comment">//     </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> MAX_U10BIT - res; <span class="hljs-comment">//      ,      </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_current() &gt;= cur_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_toggled_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_resistance() &lt;= res_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">do_main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is_current()) {<font></font>
    toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is_toggled_on()) {<font></font>
      toggle_load(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  ,  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">first_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (frequency_dividor == <span class="hljs-number">0xff</span>); <span class="hljs-comment">//   EEPROM   0xFF,        FREQ_MAXIMAL_DIV</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_off, cur_on, res_off, res_on, res_on_tmp, res_off_array[FREQ_MAXIMAL_DIV + <span class="hljs-number">1</span>], diff, max_diff, frequency_dividor_tmp;<font></font>
<font></font>
  blink_load(<span class="hljs-number">5</span>); <span class="hljs-comment">//    ,    </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  cur_off = get_current(); <span class="hljs-comment">//      ( )</span><font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_off_array[frequency_dividor] = get_resistance();<font></font>
  }<font></font>
<font></font>
  blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  cur_on = get_current(); <span class="hljs-comment">//     </span><font></font>
<font></font>
  blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  <font></font>
  res_off = MAX_U10BIT;<font></font>
  res_on = MAX_U10BIT;<font></font>
  frequency_dividor_tmp = <span class="hljs-number">0</span>;<font></font>
  max_diff = <span class="hljs-number">0</span>;
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_on_tmp = get_resistance();<font></font>
<font></font>
    <span class="hljs-comment">//   ,      </span>
    <span class="hljs-keyword">if</span>(res_off_array[frequency_dividor] &gt; res_on_tmp) {<font></font>
      diff = res_off_array[frequency_dividor] - res_on_tmp;<font></font>
      <span class="hljs-keyword">if</span>(diff &gt; max_diff) {<font></font>
        res_off = res_off_array[frequency_dividor];<font></font>
        res_on = res_on_tmp;<font></font>
        frequency_dividor_tmp = frequency_dividor;<font></font>
        max_diff = diff;<font></font>
      }    <font></font>
    }<font></font>
  }<font></font>
  frequency_dividor = frequency_dividor_tmp;<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(cur_on &gt; cur_off + CUR_MINIMAL_DIFF) { <font></font>
    cur_edge = cur_off + (cur_on - cur_off) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,     </span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span>(res_on + RES_MINIMAL_DIFF &lt; res_off) {<font></font>
      res_edge = res_off - (res_off - res_on) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,      </span><font></font>
<font></font>
      <span class="hljs-comment">//   </span><font></font>
      eeprom_write_word(&amp;EEPROM_cur_edge, cur_edge);<font></font>
      eeprom_write_word(&amp;EEPROM_res_edge, res_edge);<font></font>
      eeprom_write_byte(&amp;EEPROM_frequency_dividor, frequency_dividor);<font></font>
      <font></font>
      blink_load(<span class="hljs-number">1</span>); <span class="hljs-comment">//  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
  }<font></font>
}<font></font>
<font></font>
ISR(WDT_vect) {<font></font>
  WDTCR |= (<span class="hljs-number">1</span> &lt;&lt; WDTIE); <span class="hljs-comment">//    watchdog   ""    </span><font></font>
}<font></font>
<font></font>
EMPTY_INTERRUPT(ADC_vect); <span class="hljs-comment">//     ,     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  init_vars();<font></font>
  init_pins();       <font></font>
  init_interrupts(); <font></font>
  init_settings();<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(tp_reset || first_on()) {<font></font>
    calibrate(); <span class="hljs-comment">//          </span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
    sleep_cpu(); <span class="hljs-comment">//   watchdog</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span>(++clk &gt;= INTERVAL) {<font></font>
      do_main(); <span class="hljs-comment">//  </span>
      clk = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archive avec schÃ©ma, cÃ¢blage et le projet Atmel Studio 7 complet</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492788/index.html">FatiguÃ©, mais: l'Allemagne a complÃ¨tement arrÃªtÃ© la premiÃ¨re vague de COVID-19</a></li>
<li><a href="../fr492798/index.html">Les gens sont allÃ©s discuter sur Internet, mais maintenant, ils rÃªvent de nouveau hors ligne. Que ce passe-t-il?</a></li>
<li><a href="../fr492800/index.html">Fournisseur IoT GSM dans le logement et les services publics (partie 1)</a></li>
<li><a href="../fr492804/index.html">Sur la question de la rÃ©plication de l'activitÃ© sociale sur Internet comme clÃ© pour minimiser l'augmentation de l'incidence lors d'une pandÃ©mie</a></li>
<li><a href="../fr492806/index.html">Comment lier l'engagement Ã  la monÃ©tisation dans les jeux et applications mobiles</a></li>
<li><a href="../fr492810/index.html">[COVID-19] Votre tÃ¢che consiste Ã  lisser le pic</a></li>
<li><a href="../fr492812/index.html">Essayer d'exÃ©cuter des rÃ©seaux GAN dans OpenVINO</a></li>
<li><a href="../fr492816/index.html">Trucs et astuces IntelliJ IDEA: 4. Synchronisez et partagez les paramÃ¨tres</a></li>
<li><a href="../fr492820/index.html">.Net Core Api: obtenir des donnÃ©es dans une demande de diffÃ©rentes sources</a></li>
<li><a href="../fr492822/index.html">DÃ©veloppeurs CSS - pourquoi le monde en a-t-il besoin?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>