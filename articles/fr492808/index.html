<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙈 🔢 ✋🏾 Capteur de position de l'interrupteur d'éclairage de secours 🎠 🤦 🌲</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avant quiconque conçoit un système d'éclairage de secours autonome, tôt ou tard, le problème se pose d'allumer et d'éteindre les lumières de secours. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Capteur de position de l'interrupteur d'éclairage de secours</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant quiconque conçoit un système d'éclairage de secours autonome, tôt ou tard, le problème se pose d'allumer et d'éteindre les lumières de secours. </font><font style="vertical-align: inherit;">Comment le faire de la manière la plus pratique et transparente, afin de ne pas gâcher la conception des pièces avec des interrupteurs supplémentaires?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f4/90/kp/f490kpxmliwuhfpeeuf-lhmjhou.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une des solutions sous la coupe.</font></font><br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contexte</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le monde moderne, beaucoup de choses sont liées à une alimentation électrique ininterrompue. La plupart des types d'activités intellectuelles sont déjà inconcevables sans un ordinateur et des communications fonctionnant 24h / 24 et 7j / 7. Ce n'est ni bon ni mauvais, ça l'est, et vous devez vivre avec. Surtout si votre lieu de travail n'est pas dans un bureau moderne, rempli d'UPS et de générateurs diesel de secours, mais dans un appartement d'un immeuble d'habitation ordinaire. Et il se trouve que la fiabilité de l'approvisionnement énergétique des logements dans la plupart des villes de l'ex-URSS laisse beaucoup à désirer. En conséquence, le fil reliant la prise de courant domestique et la centrale électrique la plus proche a la mauvaise habitude de se casser périodiquement. Une fois tous les six mois, et quand et trois fois par jour.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est pourquoi, lors du démarrage des réparations dans un nouvel appartement, j'ai initialement posé un câblage parallèle dans le projet pour une alimentation et un éclairage ininterrompus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'aimerais beaucoup avoir à ma disposition un puissant générateur avec ICE, capable de fournir une alimentation normale à tout l'appartement, mais j'ai dû abandonner cette idée. Dans une maison privée, la question n'aurait pas été posée du tout, mais un appartement en est une autre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le premier problème est l'élimination des gaz d'échappement, qui ne sont absolument pas à mettre dans l'appartement d'une maison avec chauffage central. Eh bien, vous ne jeterez pas le tuyau juste à l'extérieur de la fenêtre, où la fumée est aspirée instantanément dans la fenêtre du voisin ouvert le plus proche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième problème est le bruit. Oui, les générateurs à quatre temps à onduleur modernes, lorsque vous les entendez dans la rue, peuvent sembler très silencieux. Et si vous accrochez un silencieux supplémentaire, puis complètement silencieux. Mais croyez-moi, dans un environnement hors tension, ce qui signifie un immeuble d'appartements complètement calme, même un grondement aussi silencieux sera parfaitement audible pour tous les voisins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En bref, l'idée avec le générateur est morte, donc clairement et pas née. Parmi les options réelles restantes, seules les batteries sont restées.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, je me permets un simple récit de mes épreuves émotionnelles et des décisions prises à la première personne sans aucune prétention à la vérité universelle. </font><font style="vertical-align: inherit;">Et je préviens immédiatement que mes arguments à quelqu'un peuvent sembler peu convaincants, et les décisions prises sont controversées. </font><font style="vertical-align: inherit;">Mais, néanmoins, tout ce qui est décrit ici est actuellement implémenté dans le matériel et exécute avec succès les tâches. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et si quelqu'un s'intéresse à l'aspect purement pratique du problème et qu'il n'y ait pas d'importance pour moi, il peut </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sauter de nombreuses lettres et passer directement à la description de la solution toute faite.</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En bref sur le choix du type de batterie</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien que ce problème n'ait rien à voir avec le sujet de l'article, je voudrais également insérer mes cinq cents ici. En outre, cela se pose inévitablement dans le cadre de telles déclarations, les discussions contiennent souvent beaucoup </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informations utiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aujourd'hui, au cours du siècle du développement rapide des énergies alternatives, des systèmes d'alimentation électrique sans coupure fabriqués à un prix relativement abordable pour la maison, combinés à des mini-centrales solaires ou éoliennes, ont commencé à apparaître. Les plus avancés d'entre eux utilisent des batteries lithium-ion avec tout un tas de "exhausteurs" électroniques de l'efficacité de l'ensemble du système.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon cas, il ne peut pas être question de mini-centrale pour des raisons objectives, et seule la source de secours, renouvelable à partir d'une prise ordinaire pendant «l'illumination», était intéressante. Par conséquent, il a été décidé de faire de la ferme collective toute la farce électronique de l'onduleur de l'appartement par ses propres moyens. Et comme mes mains étaient complètement déliées, la première chose à décider était le type de piles à utiliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début, j'ai pensé comme ceci: «Pourquoi pas le lithium? </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une jeunesse tendance et stylée</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Scellé, économe en énergie, durable. " Mais quand j'ai regardé les prix, ma ferveur de lithium s'est sensiblement apaisée. Une recherche rapide en combinaison avec l'arithmétique scolaire a montré que même les banques chinoises 26650 très «stupides» avec (bien sûr) les 5000 mAH les plus honnêtes coûteront cinq fois plus qu'une batterie acide de même intensité énergétique. Et si vous choisissez quelque chose qui n'est pas dans le bas du prix trié par prix, la différence atteint facilement 8 à 10 fois. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et comment pouvez-vous compenser une si grande différence de valeur? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, le lithium stocke l'énergie plus efficacement pour chaque kilogramme et mètre cube, et une batterie de la taille d'un bloc de cigarettes consacre facilement une batterie au plomb de dix kilogrammes. Mais ce fait est-il si important pour une utilisation stationnaire?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, un bon "lithium", mais avec la bonne approche durera plus longtemps. Mais dix fois? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le même temps, de l'autre côté de l'échelle, l'explosivité potentielle des batteries d'origine inconnue, un algorithme de charge plus complexe, des problèmes d'élimination (chaque sans-abri sait où utiliser une batterie au plomb à des fins lucratives, tandis que le lithium est beaucoup plus compliqué). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bref, par la somme des facteurs, j'ai décidé de reporter l'idée du lithium jusqu'à la prochaine itération. Peut-être que dans quelques années, quelque chose va changer, mais pour l'instant, le plomb est notre tout.</font></font><br>
<br>
<blockquote>,      ,        .    ,    ,           ,           .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant aux batteries au plomb, il existe également plusieurs options. L'option «correcte» est des batteries de secours spécialisées, qui sont utilisées dans les onduleurs, dans les stations de base de communication cellulaire et dans d'autres endroits similaires où elles doivent être capables de prendre et de délivrer des courants importants, de subir occasionnellement une forte décharge et de travailler sans distraire les gens. pour le service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre «bonne» option est les batteries de traction pour les chargeurs automatiques électriques ou, quoi diable, un sous-marin diesel. Ces batteries ont une durabilité élevée et une bonne tolérance aux décharges profondes, tout en ne privant pas le propriétaire de la possibilité de «faire le plein d'eau».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la «mauvaise» option est la batterie de démarrage du magasin de voitures le plus proche. Une telle batterie peut brièvement donner jusqu'à un kilowatt d'énergie à la montagne, mais toute décharge est stressante pour elle, comme le travail pour une personne paresseuse. Et la gloire des piles jetables est généralement ancrée dans les piles modernes au calcium: «déchargées - changez».</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, j'espère que personne ne doute de l'option que j'ai finalement choisie pour la mise en œuvre? Bon, troisième. Et les raisons ici ne résident pas seulement dans l'amphibien verruqueux bien connu, mais aussi dans un simple calcul pragmatique. Les batteries de démarrage sont plusieurs fois moins chères que toutes les autres options, se rapprochant parfois du lithium en valeur. Et au lieu de secouer une batterie coûteuse, vous vous sentez beaucoup plus libre dans une situation d'indifférence saine, lorsque le remplacement entraîne des pertes de nourriture pour quelques semaines. De plus, si vous ne laissez pas ces batteries s'épuiser avant de perdre une impulsion, leur durée de vie dans le rôle des sauvegardes est calculée pendant de nombreuses années. Vous pouvez toujours mettre une batterie avec une plus grande capacité, définir une limite de décharge plus douce et toujours obtenir un meilleur rapport prix / capacité que la "bonne" batterie,souffrant d'une décharge profonde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essentiel à cet égard est de prévoir une ventilation au moins au niveau du «trou dans le mur» sur le lieu d'installation des batteries. </font><font style="vertical-align: inherit;">Eh bien, organisez une protection banale contre les courts-circuits, car la basse tension de la source de courant émousse la vigilance et tout peut très mal se terminer.</font></font><br>
<br>
<h3><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guerre actuelle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans un seul appartement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après un certain réconfort moral provoqué par la décision finale sur le type de batterie, une nouvelle raison semble immédiatement réfléchir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler qu'au départ, je voulais obtenir un alternateur 230 V. Cependant, après s'être réconcilié avec la réalité objective et être passé mentalement aux batteries, l'inertie de la pensée m'a déjà conduit sur le célèbre marché chinois en ligne afin de choisir un convertisseur DC-AC adapté. Et dans le processus d'étude des caractéristiques, le terme «onde sinusoïdale modifiée», qui a été oublié, a d'abord refait surface, puis le bon sens a commencé à poser des questions inconfortables.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'essence des questions était la suivante. Pour couvrir tous les besoins énergétiques de l'appartement avec une petite batterie ne fonctionnera toujours pas. Des chaudières, un micro-ondes, une machine à laver, un ordinateur de bureau puissant resteront insupportables en puissance. Et le réfrigérateur, la hotte et même le ventilateur banal ne pourront pas fonctionner correctement à cause de cette onde sinusoïdale très modifiée. Bien sûr, il existe des onduleurs avec une véritable onde sinusoïdale, mais ils sont non seulement plus chers, mais aussi moins efficaces. Et le problème des consommateurs puissants n'est toujours pas résolu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels consommateurs restent dans le budget? Il n'y en a pas beaucoup: l'électronique grand public comme les ordinateurs portables et les téléphones / tablettes, un routeur, un serveur ARM, l'ambiance est une télévision et, bien sûr, l'éclairage. De plus, le message initial de l'article (et ma motivation personnelle) est justement d'assurer le fonctionnement du poste de travail de secours sous forme d'ordinateur portable et un confort ménager minimal, comme la lumière dans les toilettes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presque tous ces appareils nécessitent une tension constante de 5 à 21 V pour leur fonctionnement et il n'y a aucun objectif objectif d'augmenter d'abord la tension de la batterie à 230 V CA, puis de la baisser et de la redresser à plus ou moins le niveau initial. Sur ces transformations, il est facile de perdre jusqu'à 50% d'énergie, ce que je n'ai pas du tout souri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bref, c'est comme ça que l'idée est venue d'utiliser un réseau à courant continu basse tension comme alternative. </font><font style="vertical-align: inherit;">Et après un calcul approximatif des pertes dans les fils, le 12 (13,8) V initial s'est transformé en un 24 (27,6) V. plus pratique.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au début, je voulais prendre même 36 (41,4) B, mais après avoir étudié les caractéristiques de certains composants électroniques que je prévoyais d'utiliser pour travailler avec toute cette économie, j'ai dû modérer mon appétit.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans un câblage alternatif d'une section de 3,5 mm </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 de</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cuivre pur, la tension a finalement été appliquée à partir de deux batteries de voiture connectées en série.</font></font><br>
<br>
<blockquote>,        .           (   )   .                ,      .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour permettre aux consommateurs dans les chambres, un point de vente supplémentaire a été ajouté à chaque «grand» bloc de points de vente. Et pour que personne ne confonde une prise ordinaire avec une prise de secours, les produits de type «américain» à contacts plats de différentes largeurs ont été installés comme ces derniers. Ceci, d'une part, ne permettra pas à l'aspirateur d'être connecté au réseau DC, et d'autre part, une telle prise, contrairement à la prise européenne, utilise toujours la même polarité lors de l'utilisation de la «bonne» prise.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/sm/th/blsmthnmtxqcekbdftv8dfg3u2a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ces prises, des adaptateurs pour ordinateur portable ont été fabriqués, abaissant la tension aux 18-20 V souhaités et équipés des connecteurs correspondants. </font><font style="vertical-align: inherit;">Il est clair que les talons étaient faits des charges USB habituelles de cinq volts pour chaque petite chose. </font><font style="vertical-align: inherit;">Eh bien, juste au cas où, une paire de petits convertisseurs 24/230 V a été achetée, avec une puissance de 50 et 200 watts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des étuis pour charger avec une prise américaine, les mêmes cordons d'alimentation et des cartes de convertisseurs d'impulsions prêts à l'emploi ont été commandés en Chine. </font><font style="vertical-align: inherit;">Un fer à souder n'était nécessaire que pour connecter les fils. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne parlerai pas de la centrale électrique dans cet article, d'autant plus qu'il n'y a rien d'intéressant, je vais donc aller directement à l'un des problèmes "du bas", à savoir la question de l'utilisation de l'énergie accumulée par la batterie à des fins d'éclairage.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Éclairage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, lors du câblage de l'appartement en parallèle avec le câblage principal, les fils d'un autre réseau CC avec une tension de 24 (27,6) V. ont été tirés. Entre autres choses, une boucle composée d'une paire de ces fils a été enroulée dans chaque boîtier de commutation, puis avec les fils du réseau 230 V conduit aux plafonniers (s'il y en avait plusieurs dans la pièce, alors le fil alternatif ne conduisait qu'à un seul).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faire de la sortie du réseau DC dans le champ de la lampe est une question d'approche individuelle. Comme source de lumière, une bande LED régulière de 24 volts a été choisie. Ses segments de différentes longueurs (proportionnellement à la superficie de la pièce), selon la conception des luminaires, étaient soit montés directement dans leurs logements, soit collés sur les surfaces d'où il brillerait bien, et d'où il ne serait pas très frappant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tout cas, c'est un problème plus esthétique qu'un problème technique, et maintenant c'est autre chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, dans la boîte de chaque interrupteur, j'ai une boucle d'un fil de phase d'un réseau 230 V pour allumer la lumière "ordinaire", et une boucle des deux fils d'un réseau DC pour l'éclairage de secours. De cela et de la danse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fin de compte, le défi devant moi était de créer un certain appareil qui pourrait séparer trois états les uns des autres:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secteur CA OK → éteindre les lumières de secours.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le réseau AC est hors tension, les contacts de l'interrupteur sont fermés → allumer la lumière de secours. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le réseau AC est hors tension, les contacts de commutation sont ouverts → éteindre la lumière de secours.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous considérons que les actions sont unilatérales, c'est-à-dire que, par exemple, éteindre l'éclairage déjà éteint ne change rien. </font><font style="vertical-align: inherit;">Ces états peuvent être distingués les uns des autres si les tâches de détermination du fonctionnement du réseau AC et de la position des contacts du commutateur sont résolues. </font><font style="vertical-align: inherit;">Dans le même temps, j'avais les conditions initiales suivantes:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La gestion de l'éclairage principal et de l'éclairage de secours doit être totalement transparente pour un seul organe directeur, pas de «ferme collective» des boutons supplémentaires.</font></font></li>
<li> ,  ,   ,        .</li>
<li>      ,        .</li>
<li>      –    ,  .</li>
<li>-        .</li>
<li>        (    ),  .</li>
<li>      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, l'absence de secteur AC dans les boîtiers zéro s'est avérée être une erreur de calcul très compliquée. </font><font style="vertical-align: inherit;">Sans cela, la détermination de la présence de tension à l'entrée de l'interrupteur devient impossible. </font><font style="vertical-align: inherit;">Techniquement, il serait possible d'utiliser le fil négatif d'un réseau à courant continu comme zéro, mais cela contredit le paragraphe 5 complètement indestructible de mon mandat.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capteur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe néanmoins une alternative à la mesure de la tension secteur. Il n'est pas nécessaire pour moi de déterminer la présence de tension, il suffit de déterminer la présence de courant dans le fil de phase avec les contacts de l'interrupteur fermés. Après tout, s'il y a du courant, alors il y a de la tension. De plus, la «lecture» précise du courant permet d'activer l'éclairage de secours non seulement en cas de panne de courant, mais également en cas de grillage banal de l'ampoule. Cette méthode ne permet pas de déterminer l'état du réseau AC lorsque le commutateur est éteint, mais cet état ne me dérange pas, car une fois l'interrupteur éteint, l'éclairage de secours ne devrait pas fonctionner non plus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Déterminer la présence de courant dans le fil est assez simple, surtout si ce courant est alternatif. </font><font style="vertical-align: inherit;">Ici, vous pouvez appliquer, par exemple, un capteur Hall qui détecte le champ magnétique autour du fil. </font><font style="vertical-align: inherit;">Mais vous pouvez vous en tirer avec un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transformateur de courant ordinaire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , composé d'un circuit magnétique en anneau avec un enroulement. </font><font style="vertical-align: inherit;">Un fil de courant alternatif passe à travers l'anneau, ce qui crée un champ magnétique dans le circuit magnétique. </font><font style="vertical-align: inherit;">Ce champ induit à son tour un courant secondaire dans l'enroulement, proportionnel au courant primaire dans le fil. </font><font style="vertical-align: inherit;">Ainsi, ce dispositif simple vous permet de mesurer la force du courant alternatif dans n'importe quel fil, sans le casser et généralement sans connexion galvanique avec le circuit primaire.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le travail des pinces de courant, un outil très utile pour tout électricien, est basé sur le même principe.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S'il y a un tel transformateur près de l'interrupteur, il suffit de mesurer la tension sur son enroulement secondaire pour savoir si un courant circule dans le circuit de la lampe. La présence de courant, comme je l'ai dit, en première approximation indique deux faits: il y a une tension dans le réseau 230 V, et l'interrupteur est fermé. Le premier de ces faits est essentiel pour le fonctionnement du dispositif d'activation de l'éclairage de secours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième "paramètre d'entrée" de mon futur appareil devrait être la position des contacts de commutation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le «brainstorming» initié parmi les collègues amateurs a apporté diverses options pour déterminer la position du commutateur, ce qui se résumait principalement à modifier la conception afin d'y ajouter une autre paire de contacts. Ici, les possibilités d'imagination sont assez grandes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il était possible de prendre un double au lieu d'un simple interrupteur et de «paralléliser» mécaniquement ses moitiés afin qu'elles deviennent un seul ensemble. Cette option ne différait pas dans l'esthétique extérieure et ne résolvait pas le problème dans les pièces où l'éclairage était à double circuit et l'interrupteur était initialement double. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'autres options impliquaient l'introduction d'un micro-interrupteur ou d'un interrupteur à lames avec un aimant dans le mécanisme de l'interrupteur. Mais après avoir étudié les conceptions des disjoncteurs appliqués, ces options ont également disparu. La base en céramique monolithique d'un bon interrupteur ne laisse simplement aucune chance, même pour un microrupteur compact, et l'aimant et l'interrupteur à lames n'ont pas fonctionné en raison d'une course de clé trop faible et d'une hystérésis dans la courbe de fonctionnement / relâchement de l'interrupteur à lames.</font></font><br>
<br>
<blockquote> «»        ,     . , ,       ,  .  ,   ,    ,               .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bref, il fallait trouver une méthode qui ne nécessiterait pas de modification du commutateur. Et cette méthode a été trouvée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessus, j'ai décrit un transformateur de courant, qui permet de déterminer la présence de courant alternatif dans un fil sans rupture et sans contact galvanique. Mais tout transformateur est un appareil bidirectionnel (contrairement au même capteur Hall), ses enroulements primaire et secondaire sont interchangeables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous appliquons un courant alternatif à l'enroulement secondaire d'un tel transformateur, il induit une tension aux extrémités du fil enfilé dans l'anneau. Et, plus important encore, l'énergie consommée par le bobinage de la source dépendra du fait que le courant secondaire dans le fil trouvera son chemin pour un mouvement circulaire.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ici, cela devient plus intéressant. </font><font style="vertical-align: inherit;">Un fil passe à travers l'anneau, qui est immédiatement, en quelques centimètres, connecté à l'un des contacts de l'interrupteur. </font><font style="vertical-align: inherit;">Il ne reste plus qu'à fournir à ce courant un chemin de retour de l'autre côté de l'interrupteur afin d'obtenir un dispositif de «détection» de la position des contacts. </font><font style="vertical-align: inherit;">Et pour la raison que ce courant est alternatif, un condensateur conventionnel peut devenir un pont pour lui.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gs/tr/g1/gstrg12mwdwhgu0qmbnl3twrfjc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En principe, pour fermer ce circuit dans certaines conditions, un condensateur n'est pas nécessaire. </font><font style="vertical-align: inherit;">Si un courant d'une fréquence suffisamment élevée est «pompé» dans le transformateur, alors la capacité parasite entre les fils sera suffisante pour le passage.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/up/yp/ws/upypwscprb9xjbrlaye26xfkry8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, ce qui est nécessaire pour organiser un tel détecteur:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transformateur de courant.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compteur de tension de sortie du transformateur.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source de courant alternatif haute fréquence.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compteur de courant traversant l'enroulement d'un transformateur inversé.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus difficile en termes de sélection des paramètres optimaux est un transformateur qui, dans le mode transformateur de courant, devrait fournir une tension acceptable avec une fréquence de 50 Hz, et dans le mode actif de détection de l'état du disjoncteur, ont un coefficient de transmission acceptable à une fréquence de centaines de KHz. </font><font style="vertical-align: inherit;">Cet élément n'est pas possible de simuler dans un programme de modélisation de circuits électroniques, et même avec un calcul mathématique, tout s'est avéré très difficile. </font><font style="vertical-align: inherit;">J'ai dû prendre un fer à souder dans mes mains et passer des heures à conduire différentes options à la recherche du meilleur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le nombre de tours et la résistance optimale à la charge ont été choisis empiriquement et non le fait que je n'ai pas raté le meilleur rapport. </font><font style="vertical-align: inherit;">À la suite des expériences, la construction suivante est apparue:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noyau en ferrite avec une perméabilité de 10 000, taille 10x6x4 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enroulement 30 tours avec fil émaillé de 0,25 mm.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La charge active de l'enroulement est de 1 kOhm.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La perméabilité magnétique est assez grande, probablement, il serait logique d'utiliser un anneau pour 5000 voire 2000 unités, mais en quantité suffisante j'avais ces anneaux. </font><font style="vertical-align: inherit;">En général, la perméabilité dans ce cas est une valeur de compromis. </font><font style="vertical-align: inherit;">Trop bas, le transformateur ne peut pas fonctionner à une fréquence de 50 Hz et trop élevé gâche tout à des fréquences supérieures à des centaines de kilohertz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De multiples expériences ont confirmé la réalité de l'idée et les résultats suivants ont été obtenus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mode transformateur de courant, le coefficient de transmission s'est avéré être d'environ un millivolt par watt de puissance circulante (tension 220-230 V).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En mode sonde, en fonction de la fréquence et de la capacité de la fuite, la différence de courant avec les contacts fermés et ouverts de l'interrupteur atteint deux à trois fois.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Les deux valeurs sont plus que suffisantes pour une fixation fiable du courant circulant et pour déterminer la position des contacts de commutation. </font><font style="vertical-align: inherit;">Cela dépend uniquement de l'implémentation spécifique.</font></font><br>
<br>
<a name="Solution"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contrairement à la plupart de ses autres conceptions, ici déjà aux premiers stades de la délibération, il a été décidé d'utiliser immédiatement le microcontrôleur. </font><font style="vertical-align: inherit;">En fonction des besoins et de l'expérience, le choix s'est porté sur l'ATtiny13A. </font><font style="vertical-align: inherit;">Cette puce a un ADC, et avec la possibilité d'utiliser une source de référence interne de 1,1 V au lieu de la tension d'alimentation. </font><font style="vertical-align: inherit;">Il existe un PWM idéal pour générer un signal sonore. </font><font style="vertical-align: inherit;">Et, qui s'est avéré plus tard important, il existe une EEPROM qui vous permet de stocker les données d'étalonnage.</font></font><br>
<br>
<blockquote>,          «  ,       ,       - «» ,  ».<br>
<br>
      .         .           .   ,   ,  ,         .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, vous devez combiner au moins un générateur, un voltmètre et une sorte de déclencheur pour stocker l'état actuel entre les mesures. En général, tout croquis spéculatif ne nécessitait au moins trois cas que sur le "noyau", et le contrôleur s'est avéré beaucoup plus pratique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tension du transformateur de courant avec une charge de 10-20 W est de 10-20 mV et elle est trop petite pour la fournir à l'entrée DAC avec une limite de 1,1 V. Par conséquent, en plus du contrôleur, vous avez également besoin d'un amplificateur avec un coefficient de transfert d'environ 100 pour augmenter la tension du signal au moins jusqu'à des centaines de millivolts.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En général, la tension du signal de sortie d'un transformateur de courant dépend non seulement de la puissance de charge, mais également de sa nature. </font><font style="vertical-align: inherit;">Une charge purement active telle que l'ampoule d'Ilyich, par exemple, donne une onde sinusoïdale de niveau millivolt. </font><font style="vertical-align: inherit;">Une ampoule LED de la même puissance avec une puissance d'impulsion simple donne de courtes rafales aux volts et au-dessus. </font><font style="vertical-align: inherit;">On pouvait jouer là-dessus, mais, d'une part, je voulais fabriquer un appareil universel, et d'autre part, dans l'appartement, il y avait une lampe avec un bloc d'alimentation externe équipé d'un circuit PFC (c'est-à-dire ayant une caractéristique de consommation proche de l'actif).</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne tourmenterai pas le lecteur avec des options intermédiaires et donnerai immédiatement le schéma final de l'appareil.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/at/a-/vdata-spt78rd_pzv7s5awoobya.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, la tension continue via le régulateur linéaire économique LM2931-5.0 alimente le contrôleur. En termes de boîtier, de fonctionnalité et de brochage, ce stabilisateur est similaire au 78L05 populaire, mais s'en distingue par une consommation intrinsèque plus faible (environ 500 μA à une charge de 10 mA) et une plus grande tolérance aux courtes impulsions de tension d'entrée. Si vous prévoyez de travailler avec une tension ne dépassant pas 20 V, vous pouvez utiliser un analogue encore plus économique du LP2950-5.0.</font></font><br>
<br>
<blockquote>   LP2950-5.0        30 .      24      .    -      ,     ,       ,     ,   .          50%,   100%.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le transformateur n'est pas représenté sur le schéma, mais son enroulement est connecté aux broches TR1 et TR2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant qu'élément clé pour commuter la charge, un transistor MOS à canal P à faible courant 2SJ196 est utilisé (un courant jusqu'à 1 A devrait être suffisant pour n'importe quelle lampe LED), mais tout autre adapté au brochage, le courant maximal et la tension de drain maximale peuvent être utilisés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus du contrôleur et de la clé des éléments actifs, deux transistors sont utilisés. Un est nécessaire pour contrôler l'obturateur de la clé, fonctionnant sous la tension de la source d'urgence. Le second agit comme un signal amplificateur de la sortie du transformateur de courant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, vous pouvez utiliser des amplificateurs opérationnels, mais en termes de détails, le gain est minime et vous devez oublier de travailler à des fréquences supérieures à plusieurs centaines de kilohertz.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas le signal amplifié du transformateur lui-même qui est envoyé à l'ADC, mais son enveloppe, qui peut être mesurée par un seul échantillon, et non par une numérisation en "streaming" pendant un certain temps. Pour isoler l'enveloppe, deux diodes Schottky sont utilisées, connectées selon le circuit de doublage de tension. Une telle inclusion forme un détecteur d'amplitude classique, dans lequel la chute de tension aux bornes des diodes elles-mêmes est largement compensée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe de fonctionnement du capteur est simple. Considérons d'abord l'algorithme des actions nécessaires pour mesurer le courant dans le fil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mode de mesure actuel, la broche PB0 est mise en mode sortie et est mise à la terre par un zéro logique. Cela empêche l'envoi de signaux du contrôleur au point TR1. En parallèle, les mêmes actions sont effectuées sur la broche PB3, à la suite de laquelle la sortie supérieure du condensateur C2 est mise à la terre. Ce condensateur avec la résistance R1 crée un filtre passe-bas avec une fréquence de coupure d'environ 1500 Hz. Grâce à ce filtre, le rôle de divers bruits haute fréquence dans la formation du signal mesuré est fortement réduit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, un niveau élevé est appliqué au PB4 pour alimenter l'amplificateur de signal. Après l'achèvement des transitoires, un courant de 50 Hz provenant de la sortie du transformateur est amplifié et arrive au redresseur, où il charge le condensateur C8.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La charge du condensateur C8 est mesurée à l'aide d'ADC1 et à partir de la valeur de tension obtenue, une conclusion est tirée au sujet du courant «primaire» traversant le transformateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La détection active est effectuée différemment. Tout d'abord, la broche PB0 est traduite en un solveur PWM, et un signal lui est envoyé avec une fréquence de centaines de kilohertz à des unités de mégahertz. Ce signal est quelque peu atténué par un diviseur résistif et envoyé à l'enroulement du transformateur de courant au point TR1. Le condensateur C1, avec un bras supérieur du diviseur R4, crée un filtre passe-bas avec une fréquence de coupure d'environ 1,5 MHz, ce qui réduit le niveau des harmoniques haute fréquence des impulsions rectangulaires.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir traversé l'enroulement du transformateur, le signal de la sonde du point TR2 parvient au même amplificateur et détecteur, de même, à la fin, charge le condensateur C8 à une tension proportionnelle à la charge dans le circuit "externe" du transformateur. De la même manière, la charge du condensateur est mesurée à l'aide de l'ADC du microcontrôleur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant des explications pour certains "lâches". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La résistance R5 est conçue pour limiter la tension à la grille de l'interrupteur d'alimentation, qui pour les MOSFET basse tension ne doit généralement pas dépasser 20 V.Dans mon cas, le réseau CC a une tension allant jusqu'à 30 V, ce qui a dicté la nécessité d'un diviseur 1: 3, qui est obtenu en conjonction avec R3. Lorsqu'elle est alimentée par une source de moins de 20 V, la résistance R5 n'est pas nécessaire (remplacée par un cavalier).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les condensateurs C4 et C5 sont connectés en parallèle pour atteindre une capacité de 2 μF. Cette paire de condensateurs est remarquable en ce qu'elle doit transmettre aussi bien des signaux de basses que de hautes fréquences. Ici, il serait possible d'utiliser une connexion parallèle d'un condensateur électrolytique de plusieurs microfarads et d'une céramique de cent ou deux nanofarads, mais un "électrolyte" d'une si petite capacité ne donne pas de gain de taille par rapport aux "céramiques" microfarad. Certes, il n'était pas possible d'acheter un condensateur céramique à 2 microfarads, donc j'en ai mis deux pareils.</font></font><br>
<br>
<blockquote>,   50     2  ,      .   ,        .               .    100   , ,   .       .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les résistances R4 et R1 forment une division de tension qui égalise plus ou moins la tension alternative de cinq volts à la sortie PWM avec la tension de sortie du transformateur de courant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le condensateur C8, comme mentionné précédemment, accumule la tension à mesurer. C'est mieux s'il s'agit d'un condensateur de haute qualité avec un courant de fuite minimum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une mention spéciale mérite le «peigne» TP1 / TP2 à deux broches connecté à la jambe de réinitialisation du microcontrôleur. Ces contacts sont utilisés non seulement pour redémarrer, mais pour entrer dans le mode d'étalonnage, qui est décrit ci-dessous. Simplement, après l'implémentation de toute la liste de souhaits, le contrôleur n'avait plus de broches libres, et la nécessité d'ajouter un simple contrôle est apparue lors du débogage du firmware. J'ai donc dû utiliser le pied de réinitialisation du contrôleur à cet effet.</font></font><br>
<br>
<blockquote> «»  AVR     RESET       GPIO.         ,       .         ,        .   ,        ,      ,      ,            RESET.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, le circuit s'est avéré assez simple, et toute la «magie» est implémentée dans le firmware du microcontrôleur. Cependant, après la fabrication du prototype, il s'est avéré que la capacité de câblage pour un fonctionnement fiable de la "sonde" n'est souvent pas suffisante. La différence de courant à travers le transformateur s'avère simplement comparable au niveau d'interférence et le fonctionnement du circuit devient peu fiable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, j'ai dû abandonner l'anneau de ferrite suspendu librement aux fils et ajouter un circuit haute tension directement à la carte dans une nouvelle révision de l'appareil, afin de faciliter la tâche de sondage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point ici est d'ajouter un condensateur dédié, allumé de sorte que le moyen le plus court de fermer le chemin du courant RF à travers les contacts du commutateur.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/i-/_f/63/i-_f636miltufzwifkx4xaxnab0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le condensateur C10 doit être conçu pour une tension d'au moins kilovolts, et sa capacité doit être choisie selon un principe de compromis afin que la fiabilité de fonctionnement soit suffisante pour une utilisation pratique, et que le courant capacitif parasite à travers la lampe ne soit pas trop grand. </font><font style="vertical-align: inherit;">En pratique, vous pouvez essayer de "jouer" avec cette dénomination, si nécessaire.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En tout état de cause, un interrupteur équipé d'un tel capteur ne peut plus être perçu comme idéal. </font><font style="vertical-align: inherit;">Au contraire, il est similaire à un interrupteur avec un indicateur.Par conséquent, d'une part, il peut provoquer une lumière parasite ou un scintillement de lampes LED de faible qualité, et d'autre part, il peut provoquer un choc électrique, mais pas un fort. </font><font style="vertical-align: inherit;">Par conséquent, vous n'avez jamais besoin de travailler avec le câblage d'éclairage, en vous appuyant uniquement sur l'interrupteur dans le mur, éteignez toujours l '«interrupteur» à l'entrée.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et, comme je devais encore ajouter une partie du réseau AC à la carte, j'ai ajouté deux selfs d'arrêt là-bas, ce qui ne laissera pas le courant de sonde haute fréquence passer dans le câblage. La valeur pratique de la fréquence de la tension de sondage peut atteindre plusieurs MHz et moi, en tant que radio-amateur, j'en ai très marre de l'idée d'augmenter la quantité d'interférences dans le réseau de mes propres mains. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les selfs L1 et L2 doivent être électriques, enroulés avec un fil d'une épaisseur notable sur les noyaux de type haltère ou anneau. Les inductances de signal dans la conception axiale de «résistance» ne peuvent pas être utilisées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le tour principal du transformateur de courant est maintenant un morceau de fil enfilé à travers l'anneau et soudé aux points TR3 et TR4 sur la carte. Il est préférable que ce fil soit blindé, tout en connectant l'écran à TR5 et TR6 des deux côtés de l'anneau.</font></font><br>
<br>
<blockquote> TR6       ,   .    -   ,           .          ,          .</blockquote><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code du micrologiciel et le fichier HEX assemblé sont joints à la fin de l'article avec le circuit et la disposition de la carte de circuit imprimé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme du détecteur accordé est simple. Toutes les trois secondes, le contrôleur se réveille d'un sommeil profond, prend des mesures et, si nécessaire, modifie l'état de la touche de commande dans une direction ou dans une autre. Ainsi, la réaction à un changement de position de l'interrupteur peut avoir un retard pouvant aller jusqu'à trois secondes. Pas très pratique, mais cela se fait, d'une part, pour économiser l'énergie de la source de secours, et d'autre part, pour réduire considérablement l'intervalle d'interrogation ne permet pas la durée des transitoires à différents stades de mesure. L'intervalle minimum peut être considéré comme égal à une seconde, mais le circuit sera alors en mode de consommation active presque tout le temps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, en conclusion, sur la configuration. En raison du fait que différents capteurs doivent fonctionner dans des conditions complètement différentes en fonction du courant consommé par la lampe, de la longueur et d'autres caractéristiques de câblage, du niveau d'interférence, etc., il était impossible de mettre un ensemble universel de paramètres adaptatifs dans le micrologiciel. Par conséquent, chaque capteur après l'installation nécessite un seul étalonnage sur site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le capteur passe en mode d'étalonnage à chaque mise sous tension, en l'absence de données d'étalonnage, ou après fermeture des contacts TP1 et TP2. L'entrée dans la première étape de l'étalonnage est indiquée par un voyant d'urgence clignotant cinq fois.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après cinq clignotements, 7,5 secondes sont accordées pour régler l'interrupteur sur la position «off», s'il a été activé auparavant. Passé ce délai, le niveau d'interférence toujours présent dans le réseau AC est mesuré. La valeur obtenue est utilisée comme point de départ pour les mesures dans le rapport cyclique. Toujours à ce moment, le disjoncteur est détecté à différentes fréquences pour la sélection ultérieure de la fréquence la plus "contrastée".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, la deuxième étape d'étalonnage commence et le voyant d'urgence clignote deux fois. 7,5 secondes de temps sont accordées pour mettre l'interrupteur en position «on» et après la temporisation, le programme mesure le courant consommé par la lampe. Si la lampe a plusieurs niveaux de luminosité, après avoir allumé, vous devez immédiatement la régler au minimum, afin qu'à l'avenir, le capteur fonctionne correctement avec l'un des niveaux disponibles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le début de la troisième et dernière étape d'étalonnage est marqué par un clignotement à trois reprises de la lampe de secours et nécessite que l'interrupteur reste en mode «marche» et que le réseau d'éclairage soit mis hors tension à un niveau supérieur (c'est-à-dire avec le disjoncteur principal ou secondaire sur le panneau) au plus tard à travers les mêmes 7,5 secondes Dans ce cas, un deuxième sondage du disjoncteur déjà activé à différentes fréquences est effectué et en tenant compte des valeurs obtenues au premier étage, la fréquence est choisie à laquelle la différence de courant à travers l'interrupteur marche / arrêt est maximale. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La réussite de l'étalonnage est indiquée par un simple clignotement de la lampe de secours et, si le réseau d'éclairage après la troisième phase est toujours hors tension, en allumant l'éclairage de secours lors du prochain cycle d'interrogation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si les valeurs mesurées des courants et des résistances dans des conditions différentes sont trop proches et ne peuvent pas être utilisées pour une détection fiable, l'étalonnage échoue. </font><font style="vertical-align: inherit;">Dans ce cas, la lampe d'éclairage de secours clignote deux fois lorsque la position de l'interrupteur échoue, ou trois fois lorsque la consommation standard de la lampe d'éclairage est trop faible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cas de réticence persistante du capteur à calibrer avec un double clignotement au final, vous devriez essayer d'augmenter la capacité de C10.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'appareil s'est avéré être assez simple, assez compact pour tenir dans un boîtier de commutation, mais pour ne pas dire qu'il est très facile à configurer. </font><font style="vertical-align: inherit;">Bien sûr, il ne s'appuie pas sur le composant d'une "maison intelligente" moderne, car il n'a pas de 5G, le contrôle du cloud, et même le WiFi banal avec GPS n'est pas fourni. </font><font style="vertical-align: inherit;">Néanmoins, huit de ces appareils remplissent leur seule fonction, et rien d'autre n'est requis d'eux dans des conditions de panne d'électricité.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code source du firmware (Atmel Studio 7)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> F_CPU 9600000 <span class="hljs-comment">//   (  : avrdude.exe -U lfuse:w:0x7a:m -U hfuse:w:0xff:m)</span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/io.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/wdt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/sleep.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/interrupt.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;util/delay.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;avr/eeprom.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-comment">//#define PROTEUS</span><font></font>
<font></font>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">bool</span>; <span class="hljs-comment">//   </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> true  (0 == 0)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> false (0 != 0)</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_U10BIT 0b0000001111111111 <span class="hljs-comment">//      </span></span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTERVAL         3   <span class="hljs-comment">//  , </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUR_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RES_MINIMAL_DIFF 50  <span class="hljs-comment">//      , LSB</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_DIV_OFFSET  2   <span class="hljs-comment">//     </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FREQ_MAXIMAL_DIV 6   <span class="hljs-comment">//     </span></span><font></font>
<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_cur_edge;<font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>  EEPROM_res_edge; <font></font>
EEMEM <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> EEPROM_frequency_dividor;<font></font>
<font></font>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_edge, res_edge; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> frequency_dividor; <span class="hljs-comment">//   ,   EEPROM    </span>
<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> clk = <span class="hljs-number">0</span>; <span class="hljs-comment">//   watchdog</span>
<span class="hljs-keyword">bool</span> tp_reset = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   TP1  TP2</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_vars</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">if</span>(MCUSR &amp; (<span class="hljs-number">1</span> &lt;&lt; EXTRF)) { <span class="hljs-comment">// ,       TP1  TP2</span>
    tp_reset = <span class="hljs-literal">true</span>;<font></font>
    MCUSR &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; EXTRF); <span class="hljs-comment">//  EXTRF       ,   </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_pins</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB0) | (<span class="hljs-number">1</span> &lt;&lt; PB1) | (<span class="hljs-number">1</span> &lt;&lt; PB2) | (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//       </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    watchdog</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init_interrupts</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  sleep_enable(); <span class="hljs-comment">//   </span><font></font>
<font></font>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDCE) | (<span class="hljs-number">1</span> &lt;&lt; WDE); <span class="hljs-comment">//  watchdog</span>
  WDTCR = (<span class="hljs-number">1</span> &lt;&lt; WDTIE) | WDTO_1S; <span class="hljs-comment">// watchdog      ,  1 </span><font></font>
<font></font>
  sei(); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_settings</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  cur_edge = eeprom_read_word(&amp;EEPROM_cur_edge); <span class="hljs-comment">//   </span>
  res_edge = eeprom_read_word(&amp;EEPROM_res_edge); <span class="hljs-comment">//   </span>
  frequency_dividor = eeprom_read_byte(&amp;EEPROM_frequency_dividor); <span class="hljs-comment">//   </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_load</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB1);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">blink_load</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> count)</span> </span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">true</span>);<font></font>
    _delay_ms(<span class="hljs-number">200</span>);<font></font>
    toggle_load(<span class="hljs-literal">false</span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   (   )</span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) sleep_cpu();<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_amp</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    PORTB |= (<span class="hljs-number">1</span> &lt;&lt; PB4); <span class="hljs-comment">//     PB4</span>
    _delay_ms(<span class="hljs-number">250</span>);      <span class="hljs-comment">//       200 .</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    PORTB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB4);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_lpf</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    (  "0")     C2</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB3); <span class="hljs-comment">//  PB3    ( )   C2  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_gen</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    TCCR0A |= (<span class="hljs-number">1</span> &lt;&lt; COM0A0) | (<span class="hljs-number">1</span> &lt;&lt; WGM01); <span class="hljs-comment">//    ( )    OC0A      OCR0A</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> PROTEUS</span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00); <span class="hljs-comment">//    1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    TCCR0B |= (<span class="hljs-number">1</span> &lt;&lt; CS00) | (<span class="hljs-number">1</span> &lt;&lt; CS02); <span class="hljs-comment">//    1024</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    OCR0A = FREQ_DIV_OFFSET + frequency_dividor; <span class="hljs-comment">//   ,         OC0A</span>
  } <span class="hljs-keyword">else</span> {<font></font>
    TCCR0A = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle_adc</span><span class="hljs-params">(<span class="hljs-keyword">bool</span> state)</span> </span>{
  <span class="hljs-keyword">if</span>(state) {<font></font>
    DDRB &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    ( )</span>
    ADMUX = <span class="hljs-number">0b01</span> | (<span class="hljs-number">1</span> &lt;&lt; REFS0); <span class="hljs-comment">// PB2, 1.1v reference</span>
    ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADPS0) | (<span class="hljs-number">1</span> &lt;&lt; ADPS1) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2) | <span class="hljs-comment">//       = 128 (75 )</span>
             (<span class="hljs-number">1</span> &lt;&lt; ADIE) |  <span class="hljs-comment">//    </span>
             (<span class="hljs-number">1</span> &lt;&lt; ADEN);   <span class="hljs-comment">//  </span>
  } <span class="hljs-keyword">else</span> {<font></font>
    ADCSRA = <span class="hljs-number">0</span>; <span class="hljs-comment">//  </span>
    DDRB |= (<span class="hljs-number">1</span> &lt;&lt; PB2); <span class="hljs-comment">//  PB2    (  "0")   C8</span>
    _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//      C8</span><font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">do_adc</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  set_sleep_mode(SLEEP_MODE_ADC); <span class="hljs-comment">//   "" </span>
  <span class="hljs-keyword">do</span> {<font></font>
    sleep_cpu(); <span class="hljs-comment">//      ,      ,   </span>
  } <span class="hljs-keyword">while</span>(ADCSRA &amp; (<span class="hljs-number">1</span> &lt;&lt; ADSC)); <span class="hljs-comment">//        ,  </span><font></font>
<font></font>
  <span class="hljs-keyword">return</span> ADC;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">/*
//  
static void blink_bin(unsigned int value, unsigned char count) {
  for(unsigned char i = 0; i &lt; count; ++i) {
    _delay_ms(1000);
    toggle_load(true);
    if(value &amp; (1 &lt;&lt; (count - i - 1))) {
      _delay_ms(500);
    } else {
      _delay_ms(50);
    }
    toggle_load(false);
  }
}
*/</span><font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur;<font></font>
<font></font>
  toggle_lpf(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  cur = do_adc(); <span class="hljs-comment">//  </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
  toggle_lpf(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> cur;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">get_resistance</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> res;<font></font>
<font></font>
  toggle_gen(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">150</span>);<font></font>
  toggle_adc(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span>
  _delay_ms(<span class="hljs-number">50</span>); <span class="hljs-comment">//    C8</span>
  toggle_gen(<span class="hljs-literal">false</span>); <span class="hljs-comment">//   ,   C8     </span>
  res = do_adc(); <span class="hljs-comment">//     </span>
  toggle_adc(<span class="hljs-literal">false</span>);<font></font>
<font></font>
  <span class="hljs-keyword">return</span> MAX_U10BIT - res; <span class="hljs-comment">//      ,      </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_current</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_current() &gt;= cur_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">is_toggled_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (get_resistance() &lt;= res_edge);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">do_main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  <span class="hljs-keyword">if</span>(is_current()) {<font></font>
    toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span>(is_toggled_on()) {<font></font>
      toggle_load(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  ,  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      toggle_load(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  ,  </span><font></font>
    }<font></font>
  }<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">first_on</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">return</span> (frequency_dividor == <span class="hljs-number">0xff</span>); <span class="hljs-comment">//   EEPROM   0xFF,        FREQ_MAXIMAL_DIV</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> cur_off, cur_on, res_off, res_on, res_on_tmp, res_off_array[FREQ_MAXIMAL_DIV + <span class="hljs-number">1</span>], diff, max_diff, frequency_dividor_tmp;<font></font>
<font></font>
  blink_load(<span class="hljs-number">5</span>); <span class="hljs-comment">//    ,    </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">true</span>); <span class="hljs-comment">//  </span><font></font>
<font></font>
  cur_off = get_current(); <span class="hljs-comment">//      ( )</span><font></font>
<font></font>
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_off_array[frequency_dividor] = get_resistance();<font></font>
  }<font></font>
<font></font>
  blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  cur_on = get_current(); <span class="hljs-comment">//     </span><font></font>
<font></font>
  blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//     </span>
  _delay_ms(<span class="hljs-number">7500</span>); <span class="hljs-comment">//      </span><font></font>
<font></font>
  <font></font>
  res_off = MAX_U10BIT;<font></font>
  res_on = MAX_U10BIT;<font></font>
  frequency_dividor_tmp = <span class="hljs-number">0</span>;<font></font>
  max_diff = <span class="hljs-number">0</span>;
  <span class="hljs-comment">//      </span>
  <span class="hljs-keyword">for</span>(frequency_dividor = <span class="hljs-number">0</span>; frequency_dividor &lt;= FREQ_MAXIMAL_DIV; ++frequency_dividor) {<font></font>
    res_on_tmp = get_resistance();<font></font>
<font></font>
    <span class="hljs-comment">//   ,      </span>
    <span class="hljs-keyword">if</span>(res_off_array[frequency_dividor] &gt; res_on_tmp) {<font></font>
      diff = res_off_array[frequency_dividor] - res_on_tmp;<font></font>
      <span class="hljs-keyword">if</span>(diff &gt; max_diff) {<font></font>
        res_off = res_off_array[frequency_dividor];<font></font>
        res_on = res_on_tmp;<font></font>
        frequency_dividor_tmp = frequency_dividor;<font></font>
        max_diff = diff;<font></font>
      }    <font></font>
    }<font></font>
  }<font></font>
  frequency_dividor = frequency_dividor_tmp;<font></font>
<font></font>
  toggle_amp(<span class="hljs-literal">false</span>); <span class="hljs-comment">//  </span><font></font>
  <font></font>
  <span class="hljs-keyword">if</span>(cur_on &gt; cur_off + CUR_MINIMAL_DIFF) { <font></font>
    cur_edge = cur_off + (cur_on - cur_off) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,     </span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span>(res_on + RES_MINIMAL_DIFF &lt; res_off) {<font></font>
      res_edge = res_off - (res_off - res_on) / <span class="hljs-number">2</span>; <span class="hljs-comment">//    ,      </span><font></font>
<font></font>
      <span class="hljs-comment">//   </span><font></font>
      eeprom_write_word(&amp;EEPROM_cur_edge, cur_edge);<font></font>
      eeprom_write_word(&amp;EEPROM_res_edge, res_edge);<font></font>
      eeprom_write_byte(&amp;EEPROM_frequency_dividor, frequency_dividor);<font></font>
      <font></font>
      blink_load(<span class="hljs-number">1</span>); <span class="hljs-comment">//  </span>
    } <span class="hljs-keyword">else</span> {<font></font>
      blink_load(<span class="hljs-number">2</span>); <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    blink_load(<span class="hljs-number">3</span>); <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">if</span>(first_on()) stop();<font></font>
  }<font></font>
}<font></font>
<font></font>
ISR(WDT_vect) {<font></font>
  WDTCR |= (<span class="hljs-number">1</span> &lt;&lt; WDTIE); <span class="hljs-comment">//    watchdog   ""    </span><font></font>
}<font></font>
<font></font>
EMPTY_INTERRUPT(ADC_vect); <span class="hljs-comment">//     ,     </span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{<font></font>
  init_vars();<font></font>
  init_pins();       <font></font>
  init_interrupts(); <font></font>
  init_settings();<font></font>
<font></font>
  <span class="hljs-keyword">if</span>(tp_reset || first_on()) {<font></font>
    calibrate(); <span class="hljs-comment">//          </span><font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) {<font></font>
    set_sleep_mode(SLEEP_MODE_PWR_DOWN);<font></font>
    sleep_cpu(); <span class="hljs-comment">//   watchdog</span><font></font>
<font></font>
    <span class="hljs-keyword">if</span>(++clk &gt;= INTERVAL) {<font></font>
      do_main(); <span class="hljs-comment">//  </span>
      clk = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archive avec schéma, câblage et le projet Atmel Studio 7 complet</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492788/index.html">Fatigué, mais: l'Allemagne a complètement arrêté la première vague de COVID-19</a></li>
<li><a href="../fr492798/index.html">Les gens sont allés discuter sur Internet, mais maintenant, ils rêvent de nouveau hors ligne. Que ce passe-t-il?</a></li>
<li><a href="../fr492800/index.html">Fournisseur IoT GSM dans le logement et les services publics (partie 1)</a></li>
<li><a href="../fr492804/index.html">Sur la question de la réplication de l'activité sociale sur Internet comme clé pour minimiser l'augmentation de l'incidence lors d'une pandémie</a></li>
<li><a href="../fr492806/index.html">Comment lier l'engagement à la monétisation dans les jeux et applications mobiles</a></li>
<li><a href="../fr492810/index.html">[COVID-19] Votre tâche consiste à lisser le pic</a></li>
<li><a href="../fr492812/index.html">Essayer d'exécuter des réseaux GAN dans OpenVINO</a></li>
<li><a href="../fr492816/index.html">Trucs et astuces IntelliJ IDEA: 4. Synchronisez et partagez les paramètres</a></li>
<li><a href="../fr492820/index.html">.Net Core Api: obtenir des données dans une demande de différentes sources</a></li>
<li><a href="../fr492822/index.html">Développeurs CSS - pourquoi le monde en a-t-il besoin?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>