<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüè´ üí™üèø üòÜ Migrating from Cocoapods to Swift Package Manager üïù ‚úèÔ∏è üë©üèº‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cocoapods is considered the most popular dependency manager for iOS. In recent years, Apple has been working on the development of its native Swift Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Migrating from Cocoapods to Swift Package Manager</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/491994/"><img src="https://habrastorage.org/webt/bv/n3/y-/bvn3y-5hsjuzzklwmjexygcmudm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cocoapods is considered the most popular dependency manager for iOS. In recent years, Apple has been working on the development of its native Swift Package Manager (SPM) dependency manager. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initially, its use was only possible for server-side Swift or terminal applications. SPM was run and modified on such applications, the community got acquainted with its work, and the Apple team received beta testers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the release of Xcode 11, SPM began to come into the world of development for iOS. Now it is already a full-fledged tool that can be used, but so far with limitations.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the current version, SPM does not support resources (we are waiting for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SE-0271</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">In our country, each module is an atomic self-sufficient dependency that can be connected to the project, so resources are needed (localization, assets). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the meantime, we can prepare for migration: to understand how difficult it is, whether it can be automated and what problems you may encounter.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why migrate from Cocoapods to SPM?</font></font></h2><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nativeness and integration into the ecosystem. </font><font style="vertical-align: inherit;">Already, Xcode is proposing to create or add an SPM Package.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unlike Cocoapods, it is no longer necessary to have a workspace to work on a dependency project.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After adding a new dependency, you do not need to do pod install and rebuild the entire project.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is convenient to use local dependencies: the folder structure does not change, it is rebuilt faster.</font></font></li>
<li>SPM     ,    Cocoapods,     Ruby        (   iOS-).</li>
<li>Cocoapods       Xcode   Swift.</li>
<li>    Example   : Xcode   Package.swift   .</li>
<li>       abstract_target: SPM            .</li>
<li>  blame  ,      .</li>
<li>     Ruby,    .</li>
</ul><br>
<h2>  ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If your project has a lot of dependencies, then the migration process cannot be completed in one day. </font><font style="vertical-align: inherit;">The number of dependencies in the Podfile is not equal to the total number of dependencies, since one dependency can come with ten more. </font><font style="vertical-align: inherit;">Even if you do not have many dependencies, but you develop your dependencies, it is possible, even in private repositories, not to migrate quickly. </font><font style="vertical-align: inherit;">Fortunately, SPM gets along well with Cocoapods, and the migration process can be iterated. </font><font style="vertical-align: inherit;">The main thing is to take into account the nuances:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There should be no intersections between the SPM and Cocoapods dependencies.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration should be integrated into the component development process. </font><font style="vertical-align: inherit;">If the component is developing, a version upgrade should be performed for both Cocoapods and SPM.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There should not be any difficulties for the team, which means that you need to implement the installation of all the dependencies through a single cli-command.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration must be built into the CI CD. </font><font style="vertical-align: inherit;">The project must be built both locally and on CI agents, in all configurations.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where to begin?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First of all, we collect a complete list of your dependencies - it is presented in Podfile.lock. </font><font style="vertical-align: inherit;">You can use utilities such as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPMReady</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2k/ml/8b/2kml8biy2v0bye1qgxkgbvv-slm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we group them by relationship. </font><font style="vertical-align: inherit;">For example, almost all components depend on SMENetwork, which means that we will not be able to migrate them to SPM until SMENetwork itself migrates. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then we select one module, on which most of the modules depend - SMENetwork. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finally, go to the repository of this module, check it into a folder and create a module in the root of this folder.</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> ssh://.../smenetwork.git Developer/SMENetwork
<span class="hljs-built_in">cd</span> Developer/SMENetwork<font></font>
swift package init<font></font>
Creating library package: SMENetwork<font></font>
Creating Package.swift<font></font>
Creating Sources/<font></font>
Creating Sources/SMENetwork/SMENetwork.swift<font></font>
Creating Tests/<font></font>
Creating Tests/LinuxMain.swift<font></font>
Creating Tests/SMENetworkTests/<font></font>
Creating Tests/SMENetworkTests/SMENetworkTests.swift<font></font>
Creating Tests/SMENetworkTests/XCTestManifests.swift<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we get the main Package.swift file and the Sources and Tests folders. If you already had them, they will not grind. The files SMENetwork.swift, SMENetworkTests.swift, XCTestManifests.swift, LinuxMain.swift were created for the Package operation example, they can be deleted. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Package.swift file looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/ki/ca/nukicadn2hkt0txc-pqh9in4fem.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's look at the SMENetwork.podspec file: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ae3/4d9/1bb/ae34d91bba2729c274fa03e795b7c58a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, Sources and Tests are in other folders. Transfer the files and test the Cocoapods Example project. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fab/06e/200/fab06e200853027dbbed119b9626a9be.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We add the development platform to Package.swift and transfer the dependencies from the podspec file here. We make sure that they support SPM: just check that there is a Package.swift file in Github. If he is not there and there is not even a PR with him, we will do a PR and help the Open-Source community.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/ki/ca/nukicadn2hkt0txc-pqh9in4fem.png"><br>
<br>
<img src="https://habrastorage.org/webt/og/uc/ib/ogucib-td8g2n5jye8gurzuma7e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For SPM, you do not need to create an Example project: just open Package.swift in Xcode and it will download and connect the dependencies, create the targets according to our specification. </font><font style="vertical-align: inherit;">We can only run. </font></font><br>
 <br>
<img src="https://habrastorage.org/getpro/habr/post_images/012/61f/e9d/01261fe9dbbdca461e36c6a99a6c8c9f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In our case, almost everything worked out of the box, with the exception of one place where import Foundation forgot: iOS developers are used to the fact that UIKit and Foundation are optional, because it works without them. </font><font style="vertical-align: inherit;">It's time to unlearn this habit. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ld/0y/pr/ld0yprs9qp7knmi1bxof0xatys4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Package compiles, tests compile, but fail. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/sn/nk/zg/snnkzgcns9h_56rn3vomkkukawo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And here we run into a limitation of the lack of resources in Package, the tests are based on the moks that lie in json, we are waiting for </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SE-0271</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Switching from Cocoapods to SPM is easy. </font><font style="vertical-align: inherit;">The steps are clear, but flow is monotonous and requires automation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Without much effort, you can create a Package from the .podspec file and commit it to the repository. </font><font style="vertical-align: inherit;">And most importantly - you can move with one project, and the other will remain on Cocoapods. </font><font style="vertical-align: inherit;">If he wants, of course.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en491984/index.html">Airport Automation at HEL</a></li>
<li><a href="../en491986/index.html">RemoteLoRa - More Than ON / OFF</a></li>
<li><a href="../en491988/index.html">What's New in Red Hat OpenShift 4.2 and 4.3?</a></li>
<li><a href="../en491990/index.html">Work with the Chinese chip ADC Hx711 (conclusion)</a></li>
<li><a href="../en491992/index.html">Analyst Development</a></li>
<li><a href="../en491996/index.html">More about Coroutines in C ++</a></li>
<li><a href="../en492000/index.html">Product very first. Burnout</a></li>
<li><a href="../en492002/index.html">Light-Absorbing Wings: The Secret to Super Black Butterflies</a></li>
<li><a href="../en492004/index.html">How to grow from a programmer to a manager (‚ÄúI want to be the mistress of the sea‚Äù)</a></li>
<li><a href="../en492006/index.html">The power of PWA: A video surveillance system with a 300-line neural network JS code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>