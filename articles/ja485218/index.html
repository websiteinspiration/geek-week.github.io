<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸº ğŸ§ğŸ¾ ğŸ‘¨ğŸ¿â€ğŸ’» Cã§ã®å®šæ•°ã¨Gitãƒ•ãƒƒã‚¯ã®äºˆç´„ï¼ƒ ğŸ¤œğŸ¿ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¾ ğŸ‡ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è©±ã‚’ã•ã›ã¦ãã ã•ã„ã€‚ã‚€ã‹ã—ã‚€ã‹ã—ã€ã‚µãƒ ã¨ãƒœãƒ–ã®2äººã®é–‹ç™ºè€…ãŒã„ã¾ã—ãŸã€‚å½¼ã‚‰ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å”åŠ›ã—ã¾ã—ãŸã€‚é–‹ç™ºè€…ãŒãã‚Œã‚’å¤‰æ›´ã—ãŸã„ã¨ãã€stepNNN.sqlNNNãŒç‰¹å®šã®ç•ªå·ã§ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ç•°ãªã‚‹é–‹ç™ºè€…é–“ã®ã“ã‚Œã‚‰ã®æ•°å€¤ã®ç«¶åˆã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€å½¼ã‚‰ã¯å˜ç´”...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cã§ã®å®šæ•°ã¨Gitãƒ•ãƒƒã‚¯ã®äºˆç´„ï¼ƒ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485218/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è©±ã‚’ã•ã›ã¦ãã ã•ã„ã€‚</font><font style="vertical-align: inherit;">ã‚€ã‹ã—ã‚€ã‹ã—ã€ã‚µãƒ ã¨ãƒœãƒ–ã®2äººã®é–‹ç™ºè€…ãŒã„ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">å½¼ã‚‰ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å”åŠ›ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">é–‹ç™ºè€…ãŒãã‚Œã‚’å¤‰æ›´ã—ãŸã„ã¨ãã€</font></font><code>stepNNN.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NNNãŒç‰¹å®šã®ç•ªå·ã§</font><font style="vertical-align: inherit;">ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦</font><font style="vertical-align: inherit;">ãŒã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç•°ãªã‚‹é–‹ç™ºè€…é–“ã®ã“ã‚Œã‚‰ã®æ•°å€¤ã®ç«¶åˆã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€å½¼ã‚‰ã¯å˜ç´”ãªWebã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">SQLãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€å„é–‹ç™ºè€…ã¯ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã«æ–°ã—ã„ç•ªå·ã‚’äºˆç´„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»Šå›ã¯ã€Samã¨Bobã®ä¸¡æ–¹ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã‚µãƒ ã¯ç´ ç›´ã«ã‚µãƒ¼ãƒ“ã‚¹ã«è¡Œãã€ç•ªå·333ã‚’äºˆç´„ã—ã¾ã—ãŸã€‚ãã—ã¦ãƒœãƒ–ã¯ãã‚Œã‚’ã™ã‚‹ã®ã‚’å¿˜ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã«333ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">å¶ç„¶ã«ã‚‚ã€ä»Šå›ã¯ãƒœãƒ–ãŒè‡ªåˆ†ã®å¤‰æ›´ã‚’æœ€åˆã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ´ªæ°´ã®æº–å‚™ãŒã§ããŸã¨ãã€å½¼ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒ</font></font><code>step333.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã§ã«å­˜åœ¨ã™ã‚‹</font><font style="vertical-align: inherit;">ã“ã¨ã‚’ç™ºè¦‹ã—ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å½¼ã¯ãƒœãƒ–ã«é€£çµ¡ã‚’å–ã‚Šã€333ç•ªãŒå½¼ã®ãŸã‚ã«äºˆç´„ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’å½¼ã«èª¬æ˜ã—ã€è¡çªã‚’ä¿®æ­£ã™ã‚‹ã‚ˆã†ã«æ±‚ã‚ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ãƒœãƒ–ã¯ç­”ãˆã¾ã—ãŸï¼š</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ãŠã„ã€ç§ã®ã‚³ãƒ¼ãƒ‰ã¯ã™ã§ã«ã€Œãƒã‚¹ã‚¿ãƒ¼ã€ã«ã‚ã‚Šã€å¤šãã®é–‹ç™ºè€…ãŒã™ã§ã«ãã‚Œã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€ã™ã§ã«é‡ç”£ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã“ã§ã€å¿…è¦ãªã‚‚ã®ã‚’ã™ã¹ã¦ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½•ãŒèµ·ã“ã£ãŸã®ã‹ãŠæ°—ã¥ãã§ã—ã‚‡ã†ã‹ã€‚</font><font style="vertical-align: inherit;">ã™ã¹ã¦ã®è¦å‰‡ã‚’å®ˆã£ãŸäººã¯ç½°ã›ã‚‰ã‚ŒãŸã€‚</font><font style="vertical-align: inherit;">ã‚µãƒ ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç·¨é›†ã—ãŸã‚Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">å€‹äººçš„ã«ã¯ãã†ã„ã†çŠ¶æ³ã¯å«Œã„ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãã‚Œã‚’ã©ã®ã‚ˆã†ã«å›é¿ã§ãã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font></p><a name="habracut"></a><br>
<h2 id="osnovnaya-ideya"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ—¨</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã®ã‚ˆã†ãªã“ã¨ã‚’ã©ã®ã‚ˆã†ã«ã—ã¦å›é¿ã—ã¾ã™ã‹ï¼Ÿ</font><font style="vertical-align: inherit;">ãƒœãƒ–ãŒWebã‚µãƒ¼ãƒ“ã‚¹ã§å¯¾å¿œã™ã‚‹ç•ªå·ã‚’äºˆç´„ã—ãªã‹ã£ãŸå ´åˆã«ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã§ããªã‹ã£ãŸå ´åˆã¯ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ç§ãŸã¡ã¯å®Ÿéš›ã«ã“ã‚Œã‚’é”æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">å„ã‚³ãƒŸãƒƒãƒˆã®å‰ã«Gitãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã™ã¹ã¦ã®å¤‰æ›´ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æ–°ã—ã„ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚³ãƒ¼ãƒ‰ã¯Webã‚µãƒ¼ãƒ“ã‚¹ã«é€£çµ¡ã—ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®ç•ªå·ãŒç¾åœ¨ã®é–‹ç™ºè€…ç”¨ã«äºˆç´„ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç•ªå·ãŒäºˆç´„ã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚³ãƒ¼ãƒ‰ã¯å…¥åŠ›ã‚’ç¦æ­¢ã—ã¾ã™ã€‚</font></font></p><br>
<p>  .     .</p><br>
<h2 id="git-hooki-na-c35">Git hook'  C#</h2><br>
<p>Git     ,       hook'.  C#-,        C#   .     ?</p><br>
<p>, .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"> </a>,  Max HamulyÃ¡k.   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">dotnet-script</a>.     .NET Core 2.1 + SDK   .  ,      ,   .NET .  <code>dotnet-script</code>  :</p><br>
<pre><code class="bash hljs">&gt; dotnet tool install -g dotnet-script</code></pre><br>
<p>    Git hook'  C#.       <code>.git\hooks</code>      <code>pre-commit</code> (  ):</p><br>
<pre><code class="cs hljs"><span class="hljs-meta">#!/usr/bin/env dotnet-script</span><font></font>
<font></font>
Console.WriteLine(<span class="hljs-string">"Git hook"</span>);</code></pre><br>
<p>    ,    <code>git commit</code>,     <code>Git hook</code>   .</p><br>
<h2 id="neskolko-obrabotchikov-na-odin-hook">    hook</h2><br>
<p> ,  .         <code>pre-commit</code>.       .</p><br>
<p>-,   -   .       IDE    .            .</p><br>
<p>    -,    .    .   <code>pre-commit</code>  - .       .    , ,    ,         ..      ,     .</p><br>
<p>      .</p><br>
<h2 id="vyzov-vneshnego-koda">  </h2><br>
<p>   .     (, <code>gitHookAssemblies</code>).      .NET Core  (, <code>GitHooks</code>).     <code>pre-commit</code>        .</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RunHooks</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RunPreCommitHook</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Console.WriteLine(<span class="hljs-string">"Git hook from assembly"</span>);<font></font>
    }<font></font>
}</code></pre><br>
<p>        IDE    .</p><br>
<p>   <code>pre-commit</code>   :</p><br>
<pre><code class="cs hljs"><span class="hljs-meta">#!/usr/bin/env dotnet-script</span><font></font>
<font></font>
<span class="hljs-meta">#r "../../gitHookAssemblies/GitHooks.dll"</span><font></font>
<font></font>
GitHooks.RunHooks.RunPreCommitHook();</code></pre><br>
<p>,   !          <code>GitHooks</code>.   <code>pre-commit</code>     .     - ,     <code>RunPreCommitHook</code>,        <code>gitHookAssemblies</code>.  !</p><br>
<p>,  .</p><br>
<h2 id="borba-s-keshem">  </h2><br>
<p>    .    <code>Console.WriteLine</code>  - ,        <code>gitHookAssemblies</code>.    <code>git commit</code> .    ?  .    . ?</p><br>
<p>,  ,      <code>c:\project</code>.  ,   Git hook'    <code>c:\project\.git\hooks</code>. ,    Windows 10,    <code>c:\Users\&lt;UserName&gt;\AppData\Local\Temp\scripts\c\project\.git\hooks\</code>.  <code>&lt;UserName&gt;</code> â€”    .     ?     <code>pre-commit</code>,        .       ,     (  <code>GitHooks.dll</code>).    <code>execution-cache</code>    SHA256-.   ,    SHA256-   <code>pre-commit</code>.   ,    ,         .   ,      .</p><br>
<p> ,        <code>pre-commit</code>,   <code>GitHooks.dll</code>         .</p><br>
<p>      ? ,   Reflection.     ,    Reflection      <code>GitHooks</code>.         <code>pre-commit</code>:</p><br>
<pre><code class="cs hljs"><span class="hljs-meta">#!/usr/bin/env dotnet-script</span><font></font>
<font></font>
<span class="hljs-meta">#r "nuget: System.Runtime.Loader, 4.3.0"</span><font></font>
<font></font>
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Runtime.Loader;<font></font>
<font></font>
<span class="hljs-keyword">var</span> hooksDirectory = Path.Combine(Environment.CurrentDirectory, <span class="hljs-string">"gitHookAssemblies"</span>);<font></font>
<font></font>
<span class="hljs-keyword">var</span> assemblyPath = Path.Combine(hooksDirectory, <span class="hljs-string">"GitHooks.dll"</span>);<font></font>
<font></font>
<span class="hljs-keyword">var</span> assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath);
<span class="hljs-keyword">if</span>(assembly == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    Console.WriteLine(<span class="hljs-string">$"Can't load assembly from '<span class="hljs-subst">{assemblyPath}</span>'."</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">var</span> collectorsType = assembly.GetType(<span class="hljs-string">"GitHooks.RunHooks"</span>);
<span class="hljs-keyword">if</span>(collectorsType == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    Console.WriteLine(<span class="hljs-string">"Can't find entry type."</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">var</span> method = collectorsType.GetMethod(<span class="hljs-string">"RunPreCommitHook"</span>, System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static);
<span class="hljs-keyword">if</span>(method == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    Console.WriteLine(<span class="hljs-string">"Can't find method for pre-commit hooks."</span>);<font></font>
}<font></font>
<font></font>
method.Invoke(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[<span class="hljs-number">0</span>]);</code></pre><br>
<p>    <code>GitHook.dll</code>    <code>gitHookAssemblies</code>   ,         .      .</p><br>
<p>   ,     ,     ,   .    ,     .</p><br>
<h2 id="ispolzuemye-sborki"> </h2><br>
<p>  ,   ,    <code>RunHooks.RunPreCommitHook</code>,     . ,  ,         .      .          NuGet-.  ,   .</p><br>
<p>  <code>RunHooks.RunPreCommitHook</code> ,     <code>LibGit2Sharp</code>:</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RunPreCommitHook</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> repo = <span class="hljs-keyword">new</span> Repository(Environment.CurrentDirectory);<font></font>
<font></font>
    Console.WriteLine(repo.Info.WorkingDirectory);<font></font>
}</code></pre><br>
<p>,    <code>git commit</code>,      :</p><br>
<pre><code class="plaintext hljs">System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation.<font></font>
 ---&gt; System.IO.FileLoadException: Could not load file or assembly 'LibGit2Sharp, Version=0.26.0.0, Culture=neutral, PublicKeyToken=7cbde695407f0333'. General Exception (0x80131500)</code></pre><br>
<p>,        ,    .    .              <code>gitHookAssemblies</code>    <code>GitHooks.dll</code>.     ,     <code>dotnet publish</code>.          <code>LibGit2Sharp.dll</code>  <code>git2-7ce88e6.dll</code>.</p><br>
<p>     <code>pre-commit</code>.      :</p><br>
<pre><code class="cs hljs"><span class="hljs-meta">#!/usr/bin/env dotnet-script</span><font></font>
<font></font>
<span class="hljs-meta">#r "nuget: System.Runtime.Loader, 4.3.0"</span><font></font>
<font></font>
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Runtime.Loader;<font></font>
<font></font>
<span class="hljs-keyword">var</span> hooksDirectory = Path.Combine(Environment.CurrentDirectory, <span class="hljs-string">"gitHookAssemblies"</span>);<font></font>
<font></font>
<span class="hljs-keyword">var</span> assemblyPath = Path.Combine(hooksDirectory, <span class="hljs-string">"GitHooks.dll"</span>);<font></font>
<font></font>
AssemblyLoadContext.Default.Resolving += (context, assemblyName) =&gt; {<font></font>
    <span class="hljs-keyword">var</span> assemblyPath = Path.Combine(hooksDirectory, <span class="hljs-string">$"<span class="hljs-subst">{assemblyName.Name}</span>.dll"</span>);
    <span class="hljs-keyword">if</span>(File.Exists(assemblyPath))<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
};<font></font>
<font></font>
...</code></pre><br>
<p>      ,       ,   <code>gitHookAssemblies</code>.</p><br>
<p>   <code>git commit</code>     .</p><br>
<h2 id="uluchshenie-rasshiryaemosti"> </h2><br>
<p>  <code>pre-commit</code> .      .      ,     <code>RunHooks.RunPreCommitHook</code>.         .        .  ,      ,      ,      ,     .    ?</p><br>
<p>  .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">MEF</a>.    .</p><br>
<p>       hook':</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IPreCommitHook</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Process</span>(<span class="hljs-params">IList&lt;<span class="hljs-keyword">string</span>&gt; args</span>)</span>;<font></font>
}</code></pre><br>
<p>     Git   .       <code>args</code>.  <code>Process</code>   <code>true</code>,     .      <code>false</code>.</p><br>
<p>      hook',         pre-commit.</p><br>
<p>     :</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">Export(typeof(IPreCommitHook))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MessageHook</span> : <span class="hljs-title">IPreCommitHook</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Process</span>(<span class="hljs-params">IList&lt;<span class="hljs-keyword">string</span>&gt; args</span>)</span><font></font>
    {<font></font>
        Console.WriteLine(<span class="hljs-string">"Message hook..."</span>);<font></font>
<font></font>
        <span class="hljs-keyword">if</span>(args != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            Console.WriteLine(<span class="hljs-string">"Arguments are:"</span>);
            <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> arg <span class="hljs-keyword">in</span> args)<font></font>
            {<font></font>
                Console.WriteLine(arg);<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>      ,    .    .  <code>Export</code>   NuGet- <code>System.ComponentModel.Composition</code>.</p><br>
<p>     ,       <code>IPreCommitHook</code>,   <code>Export</code>,        ,     .        <code>GitHooksCollector</code>,     :</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Collectors</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PreCommitHooks</span><font></font>
    {<font></font>
        [<span class="hljs-meta">ImportMany(typeof(IPreCommitHook))</span>]
        <span class="hljs-keyword">public</span> IPreCommitHook[] Hooks { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">RunPreCommitHooks</span>(<span class="hljs-params">IList&lt;<span class="hljs-keyword">string</span>&gt; args, <span class="hljs-keyword">string</span> directory</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> catalog = <span class="hljs-keyword">new</span> DirectoryCatalog(directory, <span class="hljs-string">"*Hooks.dll"</span>);
        <span class="hljs-keyword">var</span> container = <span class="hljs-keyword">new</span> CompositionContainer(catalog);
        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> PreCommitHooks();<font></font>
        container.ComposeParts(obj);<font></font>
<font></font>
        <span class="hljs-keyword">bool</span> success = <span class="hljs-literal">true</span>;<font></font>
<font></font>
        <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> hook <span class="hljs-keyword">in</span> obj.Hooks)<font></font>
        {<font></font>
            success &amp;= hook.Process(args);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> success ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>     NuGet- <code>System.ComponentModel.Composition</code>. -,  ,     ,     <code>*Hooks.dll</code>,   <code>directory</code>.      ,   .        <code>IPreCommitHook</code>   <code>PreCommitHooks</code>. , ,     hook'     .</p><br>
<p> ,    ,     <code>pre-commit</code>:</p><br>
<pre><code class="cs hljs"><span class="hljs-meta">#!/usr/bin/env dotnet-script</span><font></font>
<font></font>
<span class="hljs-meta">#r "nuget: System.Runtime.Loader, 4.3.0"</span><font></font>
<font></font>
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Runtime.Loader;<font></font>
<font></font>
<span class="hljs-keyword">var</span> hooksDirectory = Path.Combine(Environment.CurrentDirectory, <span class="hljs-string">"gitHookAssemblies"</span>);<font></font>
<font></font>
<span class="hljs-keyword">var</span> assemblyPath = Path.Combine(hooksDirectory, <span class="hljs-string">"GitHooksCollector.dll"</span>);<font></font>
<font></font>
AssemblyLoadContext.Default.Resolving += (context, assemblyName) =&gt; {<font></font>
    <span class="hljs-keyword">var</span> assemblyPath = Path.Combine(hooksDirectory, <span class="hljs-string">$"<span class="hljs-subst">{assemblyName.Name}</span>.dll"</span>);
    <span class="hljs-keyword">if</span>(File.Exists(assemblyPath))<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">var</span> assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath);
<span class="hljs-keyword">if</span>(assembly == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    Console.WriteLine(<span class="hljs-string">$"Can't load assembly from '<span class="hljs-subst">{assemblyPath}</span>'."</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">var</span> collectorsType = assembly.GetType(<span class="hljs-string">"GitHooksCollector.Collectors"</span>);
<span class="hljs-keyword">if</span>(collectorsType == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    Console.WriteLine(<span class="hljs-string">"Can't find collector's type."</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">var</span> method = collectorsType.GetMethod(<span class="hljs-string">"RunPreCommitHooks"</span>, System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static);
<span class="hljs-keyword">if</span>(method == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    Console.WriteLine(<span class="hljs-string">"Can't find collector's method for pre-commit hooks."</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">int</span> exitCode = (<span class="hljs-keyword">int</span>) method.Invoke(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { Args, hooksDirectory });<font></font>
<font></font>
Environment.Exit(exitCode);</code></pre><br>
<p>         <code>gitHookAssemblies</code>.</p><br>
<p>,    .            Git hook'  C#. ,    ,     <code>gitHookAssemblies</code>.          ,  ,    .</p><br>
<p>  ,       .</p><br>
<h2 id="web-servis-dlya-rezervirovaniya-konstant">Web-   </h2><br>
<p>  ,         ,          Web-.    Web-,      .   ASP.NET Core Web-  Windows .        .</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Authorization;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">ListsService.Controllers</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ListItem</span>&lt;T&gt;<font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ListItem</span>(<span class="hljs-params">T <span class="hljs-keyword">value</span>, <span class="hljs-keyword">string</span> owner</span>)</span><font></font>
        {<font></font>
            Value = <span class="hljs-keyword">value</span>;<font></font>
            Owner = owner;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">public</span> T Value { <span class="hljs-keyword">get</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Owner { <span class="hljs-keyword">get</span>; }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Lists</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;ListItem&lt;<span class="hljs-keyword">int</span>&gt;&gt; SqlVersions = <span class="hljs-keyword">new</span> List&lt;ListItem&lt;<span class="hljs-keyword">int</span>&gt;&gt;<font></font>
        {<font></font>
            <span class="hljs-keyword">new</span> ListItem&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">1</span>, <span class="hljs-string">@"DOMAIN\Iakimov"</span>)<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Dictionary&lt;<span class="hljs-keyword">int</span>, List&lt;ListItem&lt;<span class="hljs-keyword">int</span>&gt;&gt;&gt; AllLists = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">int</span>, List&lt;ListItem&lt;<span class="hljs-keyword">int</span>&gt;&gt;&gt;<font></font>
        {<font></font>
            {<span class="hljs-number">1</span>, SqlVersions}<font></font>
        };<font></font>
    }<font></font>
<font></font>
    [<span class="hljs-meta">Authorize</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ListsController</span> : <span class="hljs-title">Controller</span><font></font>
    {<font></font>
        [<span class="hljs-meta">Route(<span class="hljs-meta-string">"/api/lists/{listId}/ownerOf/{itemId}"</span>)</span>]<font></font>
        [<span class="hljs-meta">HttpGet</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> IActionResult <span class="hljs-title">GetOwner</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> listId, <span class="hljs-keyword">int</span> itemId</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (!Lists.AllLists.ContainsKey(listId))
                <span class="hljs-keyword">return</span> NotFound();<font></font>
<font></font>
            <span class="hljs-keyword">var</span> item = Lists.AllLists[listId].FirstOrDefault(li =&gt; li.Value == itemId);
            <span class="hljs-keyword">if</span>(item == <span class="hljs-literal">null</span>)
                <span class="hljs-keyword">return</span> NotFound();<font></font>
<font></font>
            <span class="hljs-keyword">return</span> Json(item.Owner);<font></font>
<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>,   ,     <code>Lists</code>     .      .          ,     .  <code>GetOwner</code>  <code>ListController</code>    ,      .</p><br>
<h2 id="proverka-sql-step-faylov"> SQL step-</h2><br>
<p>   ,      step-  .   ,    step-  .        <code>sql</code>.        <code>verXXX</code>,  <code>XXX</code> â€”  ,       Web-.   <code>verXXX</code>      <code>.sql</code> ,     .           <code>.sql</code> .      .     .      ,    <code>sql/verXXX</code>,   ,    <code>XXX</code>   .</p><br>
<p>      Git hook:</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">Export(typeof(IPreCommitHook))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SqlStepsHook</span> : <span class="hljs-title">IPreCommitHook</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> Regex _expr = <span class="hljs-keyword">new</span> Regex(<span class="hljs-string">"\\bver(\\d+)\\b"</span>);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Process</span>(<span class="hljs-params">IList&lt;<span class="hljs-keyword">string</span>&gt; args</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> repo = <span class="hljs-keyword">new</span> Repository(Environment.CurrentDirectory);<font></font>
<font></font>
        <span class="hljs-keyword">var</span> items = repo.RetrieveStatus()<font></font>
            .Where(i =&gt; !i.State.HasFlag(FileStatus.Ignored))<font></font>
            .Where(i =&gt; i.State.HasFlag(FileStatus.NewInIndex))<font></font>
            .Where(i =&gt; i.FilePath.StartsWith(<span class="hljs-string">@"sql"</span>));<font></font>
<font></font>
        <span class="hljs-keyword">var</span> versions = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">int</span>&gt;(<font></font>
            items<font></font>
            .Select(i =&gt; _expr.Match(i.FilePath))<font></font>
            .Where(m =&gt; m.Success)<font></font>
            .Select(m =&gt; m.Groups[<span class="hljs-number">1</span>].Value)<font></font>
            .Select(d =&gt; <span class="hljs-keyword">int</span>.Parse(d))<font></font>
            );<font></font>
<font></font>
        <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> version <span class="hljs-keyword">in</span> versions)<font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (!ListItemOwnerChecker.DoesCurrentUserOwnListItem(<span class="hljs-number">1</span>, version))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>    <code>Repository</code>  NuGet- <code>LibGit2Sharp</code>.  <code>items</code>        Git,     <code>sql</code>.       ,   .   <code>versions</code>     <code>XXX</code>   <code>verXXX</code>. , ,  <code>ListItemOwnerChecker.DoesCurrentUserOwnListItem</code> ,         Web-   1.</p><br>
<p> <code>ListItemOwnerChecker.DoesCurrentUserOwnListItem</code>  :</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">ListItemOwnerChecker</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetListItemOwner</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> listId, <span class="hljs-keyword">int</span> itemId</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">new</span> HttpClientHandler<font></font>
        {<font></font>
            UseDefaultCredentials = <span class="hljs-literal">true</span><font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> HttpClient(handler);<font></font>
<font></font>
        <span class="hljs-keyword">var</span> response = client.GetAsync(<span class="hljs-string">$"https://localhost:44389/api/lists/<span class="hljs-subst">{listId}</span>/ownerOf/<span class="hljs-subst">{itemId}</span>"</span>)<font></font>
            .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
            .GetAwaiter()<font></font>
            .GetResult();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (response.StatusCode == System.Net.HttpStatusCode.NotFound)<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">var</span> owner = response.Content<font></font>
            .ReadAsStringAsync()<font></font>
            .ConfigureAwait(<span class="hljs-literal">false</span>)<font></font>
            .GetAwaiter()<font></font>
            .GetResult();<font></font>
<font></font>
        <span class="hljs-keyword">return</span> JsonConvert.DeserializeObject&lt;<span class="hljs-keyword">string</span>&gt;(owner);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">DoesCurrentUserOwnListItem</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> listId, <span class="hljs-keyword">int</span> itemId</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> owner = GetListItemOwner(listId, itemId);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (owner == <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            Console.WriteLine(<span class="hljs-string">$"There is no item '<span class="hljs-subst">{itemId}</span>' in the list '<span class="hljs-subst">{listId}</span>' registered on the lists service."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (owner != WindowsIdentity.GetCurrent().Name)<font></font>
        {<font></font>
            Console.WriteLine(<span class="hljs-string">$"Item '<span class="hljs-subst">{itemId}</span>' in the list '<span class="hljs-subst">{listId}</span>' registered by '<span class="hljs-subst">{owner}</span>' and you are '<span class="hljs-subst">{WindowsIdentity.GetCurrent().Name}</span>'."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>    Web-  ,     ( <code>GetListItemOwner</code>).         Windows.          . ,      e-mail    Git.</p><br>
<p>  .          <code>gitHookAssemblies</code>     .    .</p><br>
<h2 id="proverka-znacheniy-enum">  enum</h2><br>
<p> !         ,         Web-.         ,    .</p><br>
<p> ,         enum.            :</p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">enum</span> Constants<font></font>
{<font></font>
    Val1 = <span class="hljs-number">1</span>,<font></font>
    Val2 = <span class="hljs-number">2</span>,<font></font>
    Val3 = <span class="hljs-number">3</span>
}</code></pre><br>
<p>        .         Web-.      ?</p><br>
<p>       Git hook:</p><br>
<pre><code class="cs hljs">[<span class="hljs-meta">Export(typeof(IPreCommitHook))</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ConstantValuesHook</span> : <span class="hljs-title">IPreCommitHook</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Process</span>(<span class="hljs-params">IList&lt;<span class="hljs-keyword">string</span>&gt; args</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> repo = <span class="hljs-keyword">new</span> Repository(Environment.CurrentDirectory);<font></font>
<font></font>
        <span class="hljs-keyword">var</span> constantsItem = repo.RetrieveStatus()<font></font>
            .Staged<font></font>
            .FirstOrDefault(i =&gt; i.FilePath == <span class="hljs-string">@"src/GitInteraction/Constants.cs"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (constantsItem == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (!constantsItem.State.HasFlag(FileStatus.NewInIndex)<font></font>
            &amp;&amp; !constantsItem.State.HasFlag(FileStatus.ModifiedInIndex))<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
<font></font>
        <span class="hljs-keyword">var</span> initialContent = GetInitialContent(repo, constantsItem);
        <span class="hljs-keyword">var</span> indexContent = GetIndexContent(repo, constantsItem);<font></font>
<font></font>
        <span class="hljs-keyword">var</span> initialConstantValues = GetConstantValues(initialContent);
        <span class="hljs-keyword">var</span> indexConstantValues = GetConstantValues(indexContent);<font></font>
<font></font>
        indexConstantValues.ExceptWith(initialConstantValues);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (indexConstantValues.Count == <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
<font></font>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> version <span class="hljs-keyword">in</span> indexConstantValues)<font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (!ListItemOwnerChecker.DoesCurrentUserOwnListItem(<span class="hljs-number">2</span>, version))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
}</code></pre><br>
<p>  ,    ,   .              Git    <code>GetInitialContent</code>  <code>GetIndexContent</code>.   :</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetInitialContent</span>(<span class="hljs-params">Repository repo, StatusEntry item</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> blob = repo.Head.Tip[item.FilePath]?.Target <span class="hljs-keyword">as</span> Blob;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (blob == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> content = <span class="hljs-keyword">new</span> StreamReader(blob.GetContentStream(), Encoding.UTF8);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> content.ReadToEnd();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetIndexContent</span>(<span class="hljs-params">Repository repo, StatusEntry item</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> id = repo.Index[item.FilePath]?.Id;
    <span class="hljs-keyword">if</span> (id == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> itemBlob = repo.Lookup&lt;Blob&gt;(id);
    <span class="hljs-keyword">if</span> (itemBlob == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> content = <span class="hljs-keyword">new</span> StreamReader(itemBlob.GetContentStream(), Encoding.UTF8);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> content.ReadToEnd();<font></font>
}</code></pre><br>
<p>           .     <code>GetConstantValues</code>.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>Roslyn</code></a>    .      NuGet- <code>Microsoft.CodeAnalysis.CSharp</code>.</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> ISet&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">GetConstantValues</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> fileContent</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(fileContent))
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">int</span>&gt;();<font></font>
<font></font>
    <span class="hljs-keyword">var</span> tree = CSharpSyntaxTree.ParseText(fileContent);<font></font>
<font></font>
    <span class="hljs-keyword">var</span> root = tree.GetCompilationUnitRoot();<font></font>
<font></font>
    <span class="hljs-keyword">var</span> enumDeclaration = root<font></font>
        .DescendantNodes()<font></font>
        .OfType&lt;EnumDeclarationSyntax&gt;()<font></font>
        .FirstOrDefault(e =&gt; e.Identifier.Text == <span class="hljs-string">"Constants"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">if</span>(enumDeclaration == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">int</span>&gt;();<font></font>
<font></font>
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> HashSet&lt;<span class="hljs-keyword">int</span>&gt;();<font></font>
<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> member <span class="hljs-keyword">in</span> enumDeclaration.Members)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">int</span>.TryParse(member.EqualsValue.Value.ToString(), <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span>))<font></font>
        {<font></font>
            result.Add(<span class="hljs-keyword">value</span>);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<p>  <code>Roslyn</code>     .   ,     ,    <code>Microsoft.CodeAnalysis.CSharp</code>  <code>3.4.0</code>.       <code>gitHookAssemblies</code>,    ,        .      .  , <code>dotnet-script</code>    <code>Roslyn</code>   .  ,  -   <code>Microsoft.CodeAnalysis.CSharp</code>     .       <code>3.3.1</code>.           NuGet-,  .</p><br>
<p>, ,   <code>Process</code>   hook`,           Web-.</p><br>
<h2 id="napravleniya-dalneyshego-razvitiya">  </h2><br>
<p>  .      .         ,     .</p><br>
<ol>
<li><p>   <code>pre-commit</code>,      ,      <code>.git\hooks</code>    .     <code>--template</code>  <code>git init</code>.   - :</p><br>
<pre><code class="bash hljs">git config init.templatedir git_template_dir<font></font>
git init</code></pre><br>
<p>    <code>core.hooksPath</code>  Git,     Git 2.9   :</p><br>
<pre><code class="bash hljs">git config core.hooksPath git_template_dir</code></pre><br>
<p>          .</p><br>
</li>
<li><p>       <code>dotnet-script</code>.              .NET Core,         .</p><br>
</li>
<li><p>      ,    .  ,       <code>gitHookAssemblies</code>,    ,      . ,  <code>LibGit2Sharp</code>         .    <code>git2-7ce88e6.dll</code>,   Win-x64.        ,     .</p><br>
</li>
<li><p>       Web-.    Windows-,      .   Web-    UI        .</p><br>
</li>
<li><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gitãƒ•ãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§éåŒæœŸæ“ä½œã‚’ä½¿ç”¨ã™ã‚‹ã®ã¯ä¸ä¾¿ã§ã‚ã‚‹ã“ã¨ã«æ°—ã¥ã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ãã®ã‚ˆã†ãªã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚µãƒãƒ¼ãƒˆã‚’æ”¹å–„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚</font></font></p><br>
</li>
</ol><br>
<h2 id="zaklyuchenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµè«–</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€.NETè¨€èªã§Gitãƒ•ãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ä¿¡é ¼æ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã«åŸºã¥ã„ã¦ã€ã•ã¾ã–ã¾ãªå®šæ•°ã®äºˆç´„ã‚’ç¢ºèªã—ã€é•åã®å ´åˆã«ã‚³ãƒ¼ãƒ‰ãŒã„ã£ã±ã„ã«ãªã‚‹ã®ã‚’é˜²ãã“ã¨ãŒã§ãã‚‹ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã„ãã¤ã‹ä½œæˆã—ã¾ã—ãŸã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®æƒ…å ±ãŒãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚</font><font style="vertical-align: inherit;">å¹¸é‹ã‚’</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSã“ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubã«ã‚ã‚Šã¾ã™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485206/index.html">Typescriptã¯ã©ã®ã‚ˆã†ã«ç§ã‚’ãŒã£ã‹ã‚Šã•ã›ã¾ã—ãŸã‹ï¼Ÿ</a></li>
<li><a href="../ja485208/index.html">ãƒ•ã‚©ãƒ¼ãƒ«ãƒˆãƒˆãƒ¬ãƒ©ãƒ³ãƒˆITã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ä½œæˆã€‚ãƒ‘ãƒ¼ãƒˆ2. oVirt 4.3ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨æ§‹æˆ</a></li>
<li><a href="../ja485210/index.html">Unityã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¾ãƒ³ãƒ“ã‚·ãƒ¥ãƒ¼ã‚¿ãƒ¼</a></li>
<li><a href="../ja485214/index.html">CLRiumï¼ƒ7ï¼šå®Ÿç”¨çš„ã€‚ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€ç¢ºèªä»˜ãã®å®¿é¡Œã€ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°</a></li>
<li><a href="../ja485216/index.html">Apple Lightningãƒ“ãƒ‡ã‚ªã‚¢ãƒ€ãƒ—ã‚¿ã®checkm8</a></li>
<li><a href="../ja485220/index.html">Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®é€²åŒ–ï¼šãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‹ã‚‰æ©Ÿæ¢°å­¦ç¿’ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¸</a></li>
<li><a href="../ja485222/index.html">ä¸­å›½ã®ã‚ªãƒ”ãƒ‹ã‚ªãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã¨é€£æºã™ã‚‹ã«ã¯ 5ã¤ã®å®Ÿç”¨çš„ãªãƒ’ãƒ³ãƒˆ</a></li>
<li><a href="../ja485224/index.html">2020å¹´1æœˆ1æ—¥ã‹ã‚‰ã®é€šé–¢åˆ¶é™ã«è©²å½“ã™ã‚‹å•†å“ã®é…é€ã¯ã©ã†ã§ã™ã‹</a></li>
<li><a href="../ja485226/index.html">UIé–‹ç™ºï¼šèª°ã«èãã‹-è‡ªåˆ†è‡ªèº«ã‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹</a></li>
<li><a href="../ja485228/index.html">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã¨ã¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>