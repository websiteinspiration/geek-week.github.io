<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👅 👊🏻 👩🏿‍🤝‍👨🏾 Groupby aggregation in pandas 🥑 ⤵️ 🖇️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aggregation is one of the most common operations in data analysis. Different technologies offer us a bunch of ways to effectively group and aggregate ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Groupby aggregation in pandas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501214/"><img src="https://habrastorage.org/webt/pb/xp/_w/pbxp_wr2snmut3tpxsd0t2isiec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aggregation is one of the most common operations in data analysis. </font><font style="vertical-align: inherit;">Different technologies offer us a bunch of ways to effectively group and aggregate the fields of interest to us (columns, attributes). </font><font style="vertical-align: inherit;">This article will talk about the implementation of aggregation in pandas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my specialization, I work very little with python, but I often hear about the pros and power of this language, especially when it comes to working with data. </font><font style="vertical-align: inherit;">Therefore, I will draw here a parallel operation with T-SQL and give some code examples. </font><font style="vertical-align: inherit;">As the data I will use probably the most popular data set - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Irises Fisher</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first thing that comes to mind is to get the maximum, minimum or average value for any of the iris parameters and group by the species of this plant, which in python using pandas will look something like this: </font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
df = pd.read_csv(<span class="hljs-string">'iris.csv'</span>, delimiter = <span class="hljs-string">','</span>)<font></font>
print(df.groupby(<span class="hljs-string">'variety'</span>).max()[[<span class="hljs-string">'sepalLength'</span>]].to_markdown())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">variety | </font><font style="vertical-align: inherit;">sepal.length | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
|: ----------- | ---------------: | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Setosa | </font><font style="vertical-align: inherit;">5.8 | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Versicolor | </font><font style="vertical-align: inherit;">7 | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Virginica | </font><font style="vertical-align: inherit;">7.9 | </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or so:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
df = pd.read_csv(<span class="hljs-string">'iris.csv'</span>, delimiter = <span class="hljs-string">','</span>)<font></font>
<font></font>
print(df.groupby(<span class="hljs-string">'variety'</span>).sepalLength.agg(<font></font>
    maxSepalLength  = <span class="hljs-string">'max'</span>,<font></font>
    minSepalLength  = <span class="hljs-string">'min'</span>,<font></font>
    ).to_markdown())<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">variety | </font><font style="vertical-align: inherit;">maxSepalLength | </font><font style="vertical-align: inherit;">minSepalLength | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
|: ----------- | -----------------: | ----------------- : | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Setosa | </font><font style="vertical-align: inherit;">5.8 | </font><font style="vertical-align: inherit;">4.3 | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Versicolor | </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4.9 | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Virginica | </font><font style="vertical-align: inherit;">7.9 | </font><font style="vertical-align: inherit;">4.9 | </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Or using lambda expressions:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
df = pd.read_csv(<span class="hljs-string">'iris.csv'</span>, delimiter = <span class="hljs-string">','</span>)<font></font>
<font></font>
print(df.groupby(<span class="hljs-string">'variety'</span>).sepalLength.agg([
    <span class="hljs-keyword">lambda</span> x: x.max(), 
    <span class="hljs-keyword">lambda</span> x: x.min()<font></font>
    ]).to_markdown())<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">variety | </font><font style="vertical-align: inherit;">&lt;lambda_0&gt; | </font><font style="vertical-align: inherit;">&lt;lambda_1&gt; | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
|: ----------- | -------------: | -------------: | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Setosa | </font><font style="vertical-align: inherit;">5.8 | </font><font style="vertical-align: inherit;">4.3 | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Versicolor | </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4.9 | </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">Virginica | </font><font style="vertical-align: inherit;">7.9 | </font><font style="vertical-align: inherit;">4.9 | </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DataFrame Instance Function</font></font><pre><code class="python hljs">to_markdown()</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allows you to display a table (DataFrame) in the usual (console) form. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On T-SQL, this operation looks something like this:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">select</span> i.Variety, <span class="hljs-keyword">max</span>(i.SepalLength) <span class="hljs-keyword">as</span> maxSepalLength
    <span class="hljs-keyword">from</span> Iris i
        <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> i.Variety
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setosa 5.8 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versicolor 7.0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Virginica 7.9 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But suppose now we want to get both the maximum and minimum (if you like the average) values ​​for all parameters of the iris, naturally for each type of plant, the T-SQL code has been generated here:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">select</span><font></font>
	i.Variety <font></font>
	,<span class="hljs-keyword">max</span>(i.SepalLength) <span class="hljs-keyword">as</span> maxSepalLength <font></font>
	,<span class="hljs-keyword">min</span>(i.SepalLength) <span class="hljs-keyword">as</span> minSepalLength<font></font>
	,<span class="hljs-keyword">max</span>(i.SepalWidth) <span class="hljs-keyword">as</span> maxSepalWidth<font></font>
	,<span class="hljs-keyword">min</span>(i.SepalWidth) <span class="hljs-keyword">as</span> minSepalWidth<font></font>
	,<span class="hljs-keyword">max</span>(i.PetalLength) <span class="hljs-keyword">as</span> maxPetalLength<font></font>
	,<span class="hljs-keyword">min</span>(i.PetalLength) <span class="hljs-keyword">as</span> mibPetalLength<font></font>
	,<span class="hljs-keyword">max</span>(i.PetalWidth) <span class="hljs-keyword">as</span> maxPetalWidth<font></font>
	,<span class="hljs-keyword">min</span>(i.PetalWidth) <span class="hljs-keyword">as</span> minPetalWidth
<span class="hljs-keyword">from</span> Iris i
	<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> i.Variety
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setosa 5.8 4.3 4.4 2.3 1.9 1.0 0.6 0.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versicolor 7.0 4.9 3.4 2.0 5.1 3.0 1.8 1.0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Virginica 7.9 4.9 3.8 2.2 6.9 4.5 2.5 1.4 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In pandas, the possibility of group aggregation appeared only in version 0.25.0 of July 18, 2019 (what was done before) ?) and there are several variations, consider them:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
df = pd.read_csv(<span class="hljs-string">'iris.csv'</span>, delimiter = <span class="hljs-string">','</span>)<font></font>
<font></font>
df.groupby(<span class="hljs-string">'variety'</span>).agg(<font></font>
    maxSepalLength = pd.NamedAgg(column = <span class="hljs-string">'sepalLength'</span>, aggfunc = <span class="hljs-string">'max'</span>),<font></font>
    minSepalLength = pd.NamedAgg(column = <span class="hljs-string">'sepalLength'</span>, aggfunc = <span class="hljs-string">'min'</span>),<font></font>
    maxSepalWidth = pd.NamedAgg(column = <span class="hljs-string">'sepalWidth'</span>, aggfunc = <span class="hljs-string">'max'</span>),<font></font>
    minSepalWidth = pd.NamedAgg(column = <span class="hljs-string">'sepalWidth'</span>, aggfunc = <span class="hljs-string">'min'</span>),<font></font>
    maxPetalLength = pd.NamedAgg(column = <span class="hljs-string">'petalLength'</span>, aggfunc = <span class="hljs-string">'max'</span>),<font></font>
    minPetalLength = pd.NamedAgg(column = <span class="hljs-string">'petalLength'</span>, aggfunc = <span class="hljs-string">'min'</span>),<font></font>
    maxPetalWidth = pd.NamedAgg(column = <span class="hljs-string">'petalWidth'</span>, aggfunc = <span class="hljs-string">'max'</span>),<font></font>
    minPetalWidth = pd.NamedAgg(column = <span class="hljs-string">'petalWidth'</span>, aggfunc = <span class="hljs-string">'min'</span>),<font></font>
    )<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setosa 5.8 4.3 4.4 2.3 1.9 1.0 0.6 0.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versicolor 7.0 4.9 3.4 2.0 5.1 3.0 1.8 1.0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Virginica 7.9 4.9 3.8 2.2 6.9 4.5 2.5 1.4 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Function</font></font><pre><code class="python hljs">DataFrame.agg(self, func, axis=<span class="hljs-number">0</span>, *args, **kwargs)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
allows aggregation of several operations on a given axis. As parameters, the function receives ** kwargs (named arguments, see the article on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">details</font></a><font style="vertical-align: inherit;"> ), which are a column on which the operation is performed and the name of the aggregation function in single quotes. The recording looks quite voluminous. Move on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same solution using lambda expressions looks much more concise and simple:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
df = pd.read_csv(<span class="hljs-string">'iris.csv'</span>, delimiter = <span class="hljs-string">','</span>)<font></font>
<font></font>
df.groupby(<span class="hljs-string">'variety'</span>).agg([
    <span class="hljs-keyword">lambda</span> x: x.max(),
    <span class="hljs-keyword">lambda</span> x: x.min()<font></font>
    ])<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setosa 5.8 4.3 4.4 2.3 1.9 1.0 0.6 0.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versicolor 7.0 4.9 3.4 2.0 5.1 3.0 1.8 1.0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Virginica 7.9 4.9 3.8 2.2 6.9 4.5 2.5 1.4 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I often hear about much less written when Python when solving the same type of problem in comparison with other languages. </font><font style="vertical-align: inherit;">Here, in comparison with T-SQL, one can agree with this, but the clarity and sequence of expressions of linguistic tools such as SQL or T-SQL is completely lost (personal opinion). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data set and code from the article can be found here </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What’s new in 0.25.0 (July 18, 2019) </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501202/index.html">Universal event in Google Tag Manager</a></li>
<li><a href="../en501204/index.html">Money Games: PlaykeyPro Service Deployment Experience</a></li>
<li><a href="../en501206/index.html">Briefly about where to put Repository in Onion Architeckture and DDD</a></li>
<li><a href="../en501208/index.html">"Up to 30 thousand": more than 10 reviews of audio systems</a></li>
<li><a href="../en501212/index.html">Realization of skeletal animation for three-dimensional models</a></li>
<li><a href="../en501220/index.html">Parsing: can a company have too much money?</a></li>
<li><a href="../en501222/index.html">Application of COBIT when developing an IT strategy</a></li>
<li><a href="../en501224/index.html">What neural networks can “sing” and perform death metal</a></li>
<li><a href="../en501226/index.html">Quick file search</a></li>
<li><a href="../en501232/index.html">How can an IT expert earn extra on his knowledge</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>