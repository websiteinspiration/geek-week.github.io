<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍💻 🏴󠁧󠁢󠁥󠁮󠁧󠁿 🧑🏿‍🤝‍🧑🏼 Spring Bootでの電報ログイン確認 👍 🏣 🧑🏿‍🤝‍🧑🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、私は問題に遭遇しました：すべてのアプリケーションがログインの確認としてTelegramボットを使用していますが、私の確認はしていません。私は真面目で、チュートリアルを探すためにインターネットで多くの時間を費やしましたが、がっかりしました。タスクは複雑で、多くの落とし穴があり、チュートリアルには...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Spring Bootでの電報ログイン確認</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501728/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、私は問題に遭遇しました：すべてのアプリケーションがログインの確認としてTelegramボットを使用していますが、私の確認はしていません。</font><font style="vertical-align: inherit;">私は真面目で、チュートリアルを探すためにインターネットで多くの時間を費やしましたが、がっかりしました。</font><font style="vertical-align: inherit;">タスクは複雑で、多くの落とし穴があり、チュートリアルにはゼロがあります。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翌週、私はこの機能の独自の実装を書くことに費やし、成功を共​​有する準備ができています。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日作成するすべてのコードは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">リポジトリで</font></a><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">記事を読むのと並行して、プロジェクトのこのコードをチェックして、詳細を見逃さないようにすることをお勧めします。</font></font></p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7WucYd0-gPE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<h3 id="sozdanie-proekta"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの作成</font></font></h3><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、開始するには、プロジェクトを作成します。</font><font style="vertical-align: inherit;">これには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Initializr</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プロジェクトには、Spring MVC、Spring Security、Spring WebSocketが必要です。</font><font style="vertical-align: inherit;">データベースとしてH2を使用します。</font><font style="vertical-align: inherit;">私の設定は次のようになりました：</font></font><br>
<img src="https://habrastorage.org/webt/by/jb/j_/byjbj_jd1yi2ozgdvuhp97bogu0.png" alt="Spring Initializr設定"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に</font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Telegramおよびwebjarを操作するためのライブラリ</font></font><code>bootstrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（美しいデザイン用）、</font></font><code>stomp-websocket</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><code>sockjs-client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring WebSocket </font><font style="vertical-align: inherit;">を操作するためのライブラリに、追加の依存関係</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加し</font><font style="vertical-align: inherit;">ます。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その結果、私たちは</font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のようになります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pom.xmlの依存関係</font></font></b>
                        <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- SPRING --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-messaging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-comment">&lt;!-- DATABASE --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.h2database<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-comment">&lt;!-- TELEGRAM --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.telegram<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>telegrambots<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.telegram<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>telegrambotsextensions<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-comment">&lt;!-- WEBJARS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.4.1-1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>stomp-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sockjs-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><font></font>
<font></font>
    <span class="hljs-comment">&lt;!-- TESTS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>
                    </div><br>
<h3 id="nastroyka-bazovoy-avtorizacii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本認証を構成する</font></font></h3><br>
<p>    .     Web Security  ,     :</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-keyword">private</span> UserService userService;<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebSecurityConfig</span><span class="hljs-params">(UserService userService)</span> </span>{
        <span class="hljs-keyword">this</span>.userService = userService;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        http<font></font>
                .csrf().and()<font></font>
                .authorizeRequests()<font></font>
                .antMatchers(<span class="hljs-string">"/login"</span>).anonymous()<font></font>
                .antMatchers(<span class="hljs-string">"/resource/**"</span>, <span class="hljs-string">"/webjars/**"</span>, <span class="hljs-string">"/websocket/**"</span>).permitAll()<font></font>
                .antMatchers(<span class="hljs-string">"/**"</span>).authenticated()<font></font>
                .and()<font></font>
                .formLogin()<font></font>
                .loginPage(<span class="hljs-string">"/login"</span>)<font></font>
                .and()<font></font>
                .logout()<font></font>
                .logoutUrl(<span class="hljs-string">"/logout"</span>)<font></font>
                .logoutSuccessUrl(<span class="hljs-string">"/login?logout"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        web.ignoring().antMatchers(<span class="hljs-string">"/static/**"</span>, <span class="hljs-string">"/webjars/**"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        auth.userDetailsService(userService).passwordEncoder(passwordEncoder());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();<font></font>
    }<font></font>
}</code></pre><br>
<p>   ,    Spring',      <code>/websocket/**</code> .       ,        .</p><br>
<h3 id="perepis-avtorizacii-na-json-format">   JSON </h3><br>
<p>      :<br>
<img src="https://habrastorage.org/webt/0t/tr/vi/0ttrvidyb3dx7laqgkltmmvl9_c.png" alt="認可アルゴリズム"></p><br>
<p>  ,      :     ,   ,  ,  .           ,    AJAX    .       JSON.       <code>AuthenticationSuccessHandler</code>  <code>AuthenticationFailureHandler</code>,     ,        :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthenticationInfo</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> success;
    <span class="hljs-keyword">private</span> String redirectUrl;
    <span class="hljs-keyword">private</span> String errorMessage;
    <span class="hljs-keyword">private</span> Set&lt;RequiredMfa&gt; requiredMfas;<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> RequiredMfa {<font></font>
        TELEGRAM_MFA<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// getters, setters and no args constructor</span>
}</code></pre><br>
<p>  ,    <code>Set&lt;RequiredMfa&gt; requiredMfas</code>   <code>boolean askTelegramMfa</code>.    ?</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"></b>
                        <div class="spoiler_text"><p>,       .        ,  Telegram ,       ( ).</p></div>
                    </div><br>
<p>  <code>RequireTelegramMfaException</code>.  Exception,    ,       Telegram. ?       Telegram,     ,      Exception,   Spring   .     ?    <code>CustomAuthenticationFailureHandler</code>,     .</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>RequireTelegramMfaException</code></a>     <code>AuthenticationException</code>,    :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RequireTelegramMfaException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthenticationException</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RequireTelegramMfaException</span><span class="hljs-params">(String msg)</span> </span>{
        <span class="hljs-keyword">super</span>(msg);<font></font>
    }<font></font>
}</code></pre><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><code>CustomAuthenticationFailureHandler</code></a>.      :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFailureHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuthenticationFailureHandler</span> </span>{
    <span class="hljs-keyword">private</span> ObjectMapper objectMapper = <span class="hljs-keyword">new</span> ObjectMapper();<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationFailure</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{<font></font>
        AuthenticationInfo info = <span class="hljs-keyword">new</span> AuthenticationInfo();<font></font>
        info.setSuccess(<span class="hljs-keyword">false</span>);<font></font>
        info.setErrorMessage(e.getMessage());<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> RequireTelegramMfaException) {<font></font>
            info.setRequiredMfas(Collections.singleton(TELEGRAM_MFA));<font></font>
        }<font></font>
<font></font>
        response.setCharacterEncoding(CharEncoding.UTF_8);<font></font>
        response.setStatus(HttpStatus.UNAUTHORIZED.value());<font></font>
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);<font></font>
        objectMapper.writeValue(response.getWriter(), info);<font></font>
    }<font></font>
}</code></pre><br>
<p>  :       <code>AuthenticationInfo</code>, ,     ,    Exception    Exception —  <code>RequireTelegramMfaException</code> ,        Telegram.      :  character encoding = UTF-8,   401 (UNAUTHORIZE)   content type = <code>application/json</code>.     <code>AuthenticationInfo</code>.</p><br>
<p> <code>CustomSuccessHandler</code>   <code>AuthenticationInfo</code>   <code>success=true</code>   ,       (  ).    200 (OK).    :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomSuccessHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AuthenticationSuccessHandler</span> </span>{
    <span class="hljs-keyword">private</span> RequestCache requestCache = <span class="hljs-keyword">new</span> HttpSessionRequestCache();
    <span class="hljs-keyword">private</span> ObjectMapper objectMapper = <span class="hljs-keyword">new</span> ObjectMapper();<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAuthenticationSuccess</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Authentication authentication)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{<font></font>
        AuthenticationInfo info = <span class="hljs-keyword">new</span> AuthenticationInfo();<font></font>
        info.setSuccess(<span class="hljs-keyword">true</span>);<font></font>
        info.setRedirectUrl(getRedirectUrl(request, response));<font></font>
<font></font>
        response.setCharacterEncoding(CharEncoding.UTF_8);<font></font>
        response.setStatus(HttpStatus.OK.value());<font></font>
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);<font></font>
        objectMapper.writeValue(response.getWriter(), info);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getRedirectUrl</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> </span>{<font></font>
        SavedRequest cache = requestCache.getRequest(request, response);<font></font>
        <span class="hljs-keyword">return</span> cache == <span class="hljs-keyword">null</span> ? <span class="hljs-string">"/"</span> : cache.getRedirectUrl();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRequestCache</span><span class="hljs-params">(RequestCache requestCache)</span> </span>{
        <span class="hljs-keyword">this</span>.requestCache = requestCache;<font></font>
    }<font></font>
}</code></pre><br>
<p>  , <code>redirectUrl</code>     <code>RequestCache</code>,       <code>HttpSecurity</code>.   <code>WebSecurityConfig</code>     (        ):</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-comment">// fields declarations and constructor</span><font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        http<font></font>
                .csrf().and()<font></font>
                .authorizeRequests()<font></font>
                .antMatchers(<span class="hljs-string">"/login"</span>).anonymous()<font></font>
                .antMatchers(<span class="hljs-string">"/resource/**"</span>, <span class="hljs-string">"/webjars/**"</span>, <span class="hljs-string">"/websocket/**"</span>).permitAll()<font></font>
                .antMatchers(<span class="hljs-string">"/**"</span>).authenticated()<font></font>
                .and()<font></font>
                .formLogin()<font></font>
<font></font>
                <span class="hljs-comment">//      handler'</span><font></font>
                .failureHandler(authenticationFailureHandler())<font></font>
                .successHandler(authenticationSuccessHandler())<font></font>
<font></font>
                .loginPage(<span class="hljs-string">"/login"</span>)<font></font>
                .and()<font></font>
                .logout()<font></font>
                .logoutUrl(<span class="hljs-string">"/logout"</span>)<font></font>
                .logoutSuccessUrl(<span class="hljs-string">"/login?logout"</span>);<font></font>
<font></font>
        <span class="hljs-comment">//   HttpSecurity  RequestCache</span>
        <span class="hljs-comment">//    null -     CustomSuccessHandler</span><font></font>
        RequestCache requestCache = http.getSharedObject(RequestCache.class);<font></font>
        <span class="hljs-keyword">if</span> (requestCache != <span class="hljs-keyword">null</span>) {<font></font>
            authenticationSuccessHandler().setRequestCache(requestCache);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        web.ignoring().antMatchers(<span class="hljs-string">"/static/**"</span>, <span class="hljs-string">"/webjars/**"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        auth.userDetailsService(userService).passwordEncoder(passwordEncoder());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title">passwordEncoder</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> PasswordEncoderFactories.createDelegatingPasswordEncoder();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CustomSuccessHandler <span class="hljs-title">authenticationSuccessHandler</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CustomSuccessHandler();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CustomFailureHandler <span class="hljs-title">authenticationFailureHandler</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CustomFailureHandler();<font></font>
    }<font></font>
}</code></pre><br>
<p>   frontend     AJAX.      Bootstrap Carousel,      ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">html</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">js</a>):</p><br>
<pre><code class="javascript hljs"><span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'DOMContentLoaded'</span>, () =&gt; {<font></font>
    loginForm.addEventListener(<span class="hljs-string">'submit'</span>, e =&gt; {<font></font>
        e.preventDefault();<font></font>
<font></font>
        $.ajax({<font></font>
            <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/login'</span>,
            <span class="hljs-attr">data</span>: $(loginForm).serialize(),
            <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
                <span class="hljs-keyword">let</span> data = response.responseJSON;<font></font>
<font></font>
                <span class="hljs-comment">//      Telegram -</span>
                <span class="hljs-comment">//   ,     </span>
                <span class="hljs-keyword">if</span> (data.requiredMfas <font></font>
                        &amp;&amp; data.requiredMfas.includes(<span class="hljs-string">'TELEGRAM_MFA'</span>)) {<font></font>
                    $(carousel).carousel(TELEGRAM_SLIDE);<font></font>
                } <span class="hljs-keyword">else</span> { <span class="hljs-comment">//  -   </span>
                    showAlert(data.errorMessage, <span class="hljs-string">'danger'</span>);<font></font>
                    loginForm.querySelector(<span class="hljs-string">'input[name="password"]'</span>).value = <span class="hljs-string">''</span>;<font></font>
                }<font></font>
            }<font></font>
        }).done(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
            loginModal.classList.add(<span class="hljs-string">'fullscreen-loading-modal'</span>); <span class="hljs-comment">//   </span>
            location.href = response.redirectUrl; <span class="hljs-comment">//  </span><font></font>
        });<font></font>
    });<font></font>
}</code></pre><br>
<p>  ,      <code>success</code>:   handler'      (200,    401,   ).  , jQuery   response   callback: <code>error</code>,   (  ,  401)  <code>done</code>,    (  ,  200).</p><br>
<h3 id="sozdanie-i-nastroyka-telegram-bota">   Telegram </h3><br>
<p>   Telegram .   <code>pom.xml</code>    : <del>  </del> <code>org.telegram:telegrambots</code>  <code>org.telegram:telegrambotsextensions</code>.       :</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TelegramBot</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TelegramLongPollingCommandBot</span> </span>{
    <span class="hljs-keyword">private</span> String botUsername;
    <span class="hljs-keyword">private</span> String botToken;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TelegramBot</span><span class="hljs-params">(Environment env, ConnectAccountCommand connectAccountCommand)</span> <span class="hljs-keyword">throws</span> TelegramApiException </span>{
        <span class="hljs-keyword">super</span>(ApiContext.getInstance(DefaultBotOptions.class), <span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">this</span>.botToken = env.getRequiredProperty("telegram.bot.token");
        <span class="hljs-keyword">this</span>.botUsername = getMe().getUserName();<font></font>
<font></font>
        register(connectAccountCommand);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBot</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> TelegramApiRequestException </span>{<font></font>
        TelegramBotsApi botsApi = <span class="hljs-keyword">new</span> TelegramBotsApi();<font></font>
        botsApi.registerBot(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processNonCommandUpdate</span><span class="hljs-params">(Update update)</span> </span>{<font></font>
<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getBotUsername</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> botUsername;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getBotToken</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> botToken;<font></font>
    }<font></font>
}</code></pre><br>
<p>      ,  ,         ,        (: <code>/start@myBot</code>).     <code>ConnectAccountCommand</code>.  ,         Telegram. ,     <code>/start</code>,    .  <code>addBot()</code>   <code>@PostConstruct</code>.  ,     ,  Bean   .     <code>TelegramBotsApi</code>     .</p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">ConnectAccountCommand</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConnectAccountCommand</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BotCommand</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(ConnectAccountCommand.class);
    <span class="hljs-keyword">private</span> UserService userService;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConnectAccountCommand</span><span class="hljs-params">(UserService userService)</span> </span>{
        <span class="hljs-keyword">super</span>(<span class="hljs-string">"connect"</span>, <span class="hljs-string">"   "</span>);
        <span class="hljs-keyword">this</span>.userService = userService;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(AbsSender sender, User user, Chat chat, String[] strings)</span> </span>{<font></font>
        String username = strings[<span class="hljs-number">0</span>];<font></font>
        userService.connectBot(username, chat.getId());<font></font>
<font></font>
        SendMessage message = <span class="hljs-keyword">new</span> SendMessage()<font></font>
                .setChatId(chat.getId())<font></font>
                .setText(<span class="hljs-string">"   !"</span>);
        <span class="hljs-keyword">try</span> {<font></font>
            sender.execute(message);<font></font>
        } <span class="hljs-keyword">catch</span> (TelegramApiException e) {<font></font>
            log.error(<span class="hljs-string">"Error sending success telegram bot connect message"</span>, e);<font></font>
        }<font></font>
    }<font></font>
}</code></pre></div>
                    </div><br>
<h3 id="podtverzhdenie-avtorizacii-s-pomoschyu-telegram-bota">    Telegram </h3><br>
<p>       Telegram.      <code>WebAuthenticationDetails</code>.   HttpServletRequest,     .  <code>CustomWebAuthenticationDetails</code>    : </p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomWebAuthenticationDetails</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebAuthenticationDetails</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HttpServletRequest request;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomWebAuthenticationDetails</span><span class="hljs-params">(HttpServletRequest request)</span> </span>{
        <span class="hljs-keyword">super</span>(request);
        <span class="hljs-keyword">this</span>.request = request;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> HttpServletRequest <span class="hljs-title">getRequest</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> request;<font></font>
    }<font></font>
}</code></pre><br>
<p>    <code>AuthenticationProvider</code>,         Telegram    —    Telegram     .      <code>DaoAuthenticationProvider</code>.     <code>additionalAuthenticationChecks(UserDetails, UsernamePasswordAuthenticationToken)</code>.        ,       .</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomAuthenticationProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DaoAuthenticationProvider</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">additionalAuthenticationChecks</span><span class="hljs-params">(UserDetails userDetails, UsernamePasswordAuthenticationToken authentication)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>{<font></font>
        HttpServletRequest request = ((CustomWebAuthenticationDetails) authentication.getDetails()).getRequest();<font></font>
        AuthorizedUser authUser = (AuthorizedUser) userDetails;<font></font>
        User user = authUser.getUser();<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (user.getTelegramChatId() != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> send telegram confirm message</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RequireTelegramMfaException(<span class="hljs-string">",    Telegram!"</span>);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">super</span>.additionalAuthenticationChecks(userDetails, authentication);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supports</span><span class="hljs-params">(Class&lt;?&gt; authentication)</span> </span>{
        <span class="hljs-keyword">return</span> authentication.equals(UsernamePasswordAuthenticationToken.class);<font></font>
    }<font></font>
}</code></pre><br>
<p>  Telegram     <code>MfaCommand</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MfaCommand</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(MfaCommand.class);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String CONFIRM_BUTTON = "confirm";
    <span class="hljs-keyword">private</span> Map&lt;Long, AuthInfo&gt; connectingUser = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    <span class="hljs-keyword">private</span> TelegramBot telegramBot;
    <span class="hljs-keyword">private</span> WebSocketService webSocketService;
    <span class="hljs-keyword">private</span> CustomSuccessHandler customSuccessHandler;<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MfaCommand</span><span class="hljs-params">(TelegramBot telegramBot, WebSocketService webSocketService, <span class="hljs-meta">@Lazy</span> CustomSuccessHandler customSuccessHandler)</span> </span>{
        <span class="hljs-keyword">this</span>.telegramBot = telegramBot;
        <span class="hljs-keyword">this</span>.webSocketService = webSocketService;
        <span class="hljs-keyword">this</span>.customSuccessHandler = customSuccessHandler;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// ,  CustomAuthenticationProvider    </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requireMfa</span><span class="hljs-params">(Authentication authentication, SecurityContext context, HttpServletRequest request)</span> </span>{<font></font>
        User user = ((AuthorizedUser) authentication.getPrincipal()).getUser();<font></font>
<font></font>
        <span class="hljs-comment">//    AuthInfo      </span>
        <span class="hljs-comment">//     chat id</span>
        <span class="hljs-comment">// CSRF    </span>
        String csrfToken = request.getParameter(<span class="hljs-string">"_csrf"</span>);<font></font>
        HttpSession session = request.getSession(<span class="hljs-keyword">true</span>);<font></font>
<font></font>
        <span class="hljs-comment">//    -  ,</span>
        <span class="hljs-comment">//  Spring  HttpSessionRequestCache</span>
        <span class="hljs-comment">//   RequestCache,       ,</span>
        <span class="hljs-comment">//  HttpServletResponse    .</span>
        <span class="hljs-comment">//      null</span>
        String redirectUrl = customSuccessHandler.getRedirectUrl(request, <span class="hljs-keyword">null</span>);<font></font>
<font></font>
        AuthInfo authInfo = <span class="hljs-keyword">new</span> AuthInfo(authentication, context, session, csrfToken, redirectUrl);<font></font>
        connectingUser.put(user.getTelegramChatId(), authInfo);<font></font>
<font></font>
        sendUserMessage(user);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//        -</span>
    <span class="hljs-comment">//  Telegram    </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCallbackQuery</span><span class="hljs-params">(CallbackQuery callbackQuery)</span> </span>{<font></font>
        Message message = callbackQuery.getMessage();<font></font>
<font></font>
        <span class="hljs-comment">//   AuthInfo  chat id,     </span><font></font>
        AuthInfo authInfo = connectingUser.remove(message.getChatId());<font></font>
<font></font>
        EditMessageText editMessageText = <span class="hljs-keyword">new</span> EditMessageText()<font></font>
                .setChatId(message.getChatId())<font></font>
                .setMessageId(message.getMessageId());<font></font>
<font></font>
        AuthenticationInfo info = <span class="hljs-keyword">new</span> AuthenticationInfo();<font></font>
<font></font>
        <span class="hljs-comment">//     ""</span>
        <span class="hljs-keyword">if</span> (callbackQuery.getData().equals(CONFIRM_BUTTON)) {
            <span class="hljs-comment">//  , </span>
            <span class="hljs-comment">//      CustomAuthenticationProvider</span><font></font>
            Authentication authentication = authInfo.getAuthentication();<font></font>
<font></font>
            <span class="hljs-comment">//    SecurityContext, </span>
            <span class="hljs-comment">//     CustomAuthenticationProvider</span><font></font>
            authInfo.getSecurityContext().setAuthentication(authentication);<font></font>
<font></font>
            <span class="hljs-comment">//      </span><font></font>
            authInfo.getSession().setAttribute(SPRING_SECURITY_CONTEXT_KEY, authInfo.getSecurityContext());<font></font>
<font></font>
            <span class="hljs-comment">//     AuthenticationInfo</span>
            editMessageText.setText(<span class="hljs-string">"   !"</span>);<font></font>
            info.setSuccess(<span class="hljs-keyword">true</span>);<font></font>
            info.setRedirectUrl(authInfo.getRedirectUrl());<font></font>
        } <span class="hljs-keyword">else</span> { <span class="hljs-comment">//     ""</span>
            <span class="hljs-comment">//       AuthenticationInfo,</span>
            <span class="hljs-comment">//  ,     </span>
            editMessageText.setText(<span class="hljs-string">"   !"</span>);<font></font>
            info.setSuccess(<span class="hljs-keyword">false</span>);<font></font>
            info.setErrorMessage(<span class="hljs-string">"    Telegram"</span>);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> send browser notification</span><font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            telegramBot.execute(editMessageText);<font></font>
        } <span class="hljs-keyword">catch</span> (TelegramApiException e) {<font></font>
            log.error(<span class="hljs-string">"Error updating telegram MFA message"</span>, e);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendUserMessage</span><span class="hljs-params">(User user)</span> </span>{<font></font>
        InlineKeyboardButton confirmButton = <span class="hljs-keyword">new</span> InlineKeyboardButton(<span class="hljs-string">""</span>);<font></font>
        confirmButton.setCallbackData(CONFIRM_BUTTON);<font></font>
<font></font>
        InlineKeyboardButton declineButton = <span class="hljs-keyword">new</span> InlineKeyboardButton(<span class="hljs-string">""</span>);<font></font>
        declineButton.setCallbackData(<span class="hljs-string">"decline"</span>);<font></font>
<font></font>
        InlineKeyboardMarkup markup = <span class="hljs-keyword">new</span> InlineKeyboardMarkup(<font></font>
                Collections.singletonList(<font></font>
                        Arrays.asList(confirmButton, declineButton)<font></font>
                )<font></font>
        );<font></font>
<font></font>
        SendMessage sendMessage = <span class="hljs-keyword">new</span> SendMessage()<font></font>
                .setChatId(user.getTelegramChatId())<font></font>
                .setText(<span class="hljs-string">"    &lt;b&gt;"</span> + user.getUsername() + <span class="hljs-string">"&lt;/b&gt;"</span>)<font></font>
                .setParseMode(<span class="hljs-string">"HTML"</span>)<font></font>
                .setReplyMarkup(markup);<font></font>
<font></font>
        <span class="hljs-keyword">try</span> {<font></font>
            telegramBot.execute(sendMessage);<font></font>
        } <span class="hljs-keyword">catch</span> (TelegramApiException e) {<font></font>
            log.error(<span class="hljs-string">"Error sending telegram MFA message"</span>, e);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthInfo</span> </span>{
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Authentication authentication;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SecurityContext securityContext;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HttpSession session;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String csrf;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String redirectUrl;<font></font>
<font></font>
        <span class="hljs-comment">// all args constructor and getters</span><font></font>
    }<font></font>
}</code></pre><br>
<p> <code>if</code>   <code>additionalAuthenticationChecks()</code>  <code>CustomAuthenticationProvider</code>.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (user.getTelegramChatId() != <span class="hljs-keyword">null</span>) {<font></font>
    UsernamePasswordAuthenticationToken authenticationToken =<font></font>
            <span class="hljs-keyword">new</span> UsernamePasswordAuthenticationToken(authUser, <span class="hljs-keyword">null</span>, authUser.getAuthorities());<font></font>
    mfaCommand.requireMfa(authenticationToken, SecurityContextHolder.getContext(), request);<font></font>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RequireTelegramMfaException(<span class="hljs-string">",    Telegram!"</span>);<font></font>
}</code></pre><br>
<p>   <code>processNonCommandUpdate(Update)</code>  <code>TelegramBot</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processNonCommandUpdate</span><span class="hljs-params">(Update update)</span> </span>{
    <span class="hljs-keyword">if</span> (update.hasCallbackQuery()) {<font></font>
        mfaCommand.onCallbackQuery(update.getCallbackQuery());<font></font>
    }<font></font>
}</code></pre><br>
<p>  <code>WebSecurityConfig</code>    <code>AuthenticationDetais</code>  <code>CustomWebAuthenticationDetails</code>    <code>CustomAuthenticationProvider</code>.</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>{
    <span class="hljs-keyword">private</span> UserService userService;
    <span class="hljs-keyword">private</span> MfaCommand mfaCommand;<font></font>
<font></font>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WebSecurityConfig</span><span class="hljs-params">(UserService userService, MfaCommand mfaCommand)</span> </span>{
        <span class="hljs-keyword">this</span>.userService = userService;
        <span class="hljs-keyword">this</span>.mfaCommand = mfaCommand;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        http<font></font>
                .csrf().and()<font></font>
                .authorizeRequests()<font></font>
                .antMatchers(<span class="hljs-string">"/login"</span>).anonymous()<font></font>
                .antMatchers(<span class="hljs-string">"/webjars/**"</span>, <span class="hljs-string">"/resource/**"</span>, <span class="hljs-string">"/websocket/**"</span>).permitAll()<font></font>
                .antMatchers(<span class="hljs-string">"/**"</span>).authenticated()<font></font>
                .and()<font></font>
                .formLogin()<font></font>
<font></font>
                <span class="hljs-comment">//  AuthenticationDetails  CustomWebAuthenticationDetails</span>
                <span class="hljs-comment">// : details -&gt; new CustomWebAuthenticationDetails(details)</span>
                .authenticationDetailsSource(CustomWebAuthenticationDetails::<span class="hljs-keyword">new</span>)<font></font>
<font></font>
                .failureHandler(authenticationFailureHandler())<font></font>
                .successHandler(authenticationSuccessHandler())<font></font>
                .loginPage(<span class="hljs-string">"/login"</span>)<font></font>
                .and()<font></font>
                .logout()<font></font>
                .logoutUrl(<span class="hljs-string">"/logout"</span>)<font></font>
                .logoutSuccessUrl(<span class="hljs-string">"/login?logout"</span>);<font></font>
<font></font>
        RequestCache requestCache = http.getSharedObject(RequestCache.class);<font></font>
        <span class="hljs-keyword">if</span> (requestCache != <span class="hljs-keyword">null</span>) {<font></font>
            authenticationSuccessHandler().setRequestCache(requestCache);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    // WebSecurity configure<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>{<font></font>
        auth.authenticationProvider(customAuthenticationProvider());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CustomAuthenticationProvider <span class="hljs-title">customAuthenticationProvider</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> provider = <span class="hljs-keyword">new</span> CustomAuthenticationProvider(mfaCommand);<font></font>
        provider.setUserDetailsService(userService);<font></font>
        provider.setPasswordEncoder(passwordEncoder());<font></font>
        <span class="hljs-keyword">return</span> provider;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// old beans</span>
}</code></pre><br>
<p>     .     Telegram  —      .     "" —  ,     .       ,  ,     (        ,    ).</p><br>
<h3 id="otpravka-soobschenie-v-brauzer-ob-uspeshnoy-avtorizacii">   ,   </h3><br>
<p>,    — <del>  </del>    .      ,      .     ,   .     .</p><br>
<p>   ,    :    Spring WebSocket,      ,   ?     ,      .      ,   <code>simpMessagingTemplate.convertAndSendToUser</code>   <code>Session ID</code>   <code>String user</code> : ID . , <code>Session ID</code>,      <code>HttpServletRequest</code>,   <code>Session ID</code>,        WebSocket.</p><br>
<p>  ,    <code>Session ID</code>  WebSocket.      ?      CSRF .   WebSocket,    CSRF ,   — .   :</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketSessionStorage</span> 
            <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationListener</span>&lt;<span class="hljs-title">SessionConnectEvent</span>&gt; </span>{
    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; storage = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onApplicationEvent</span><span class="hljs-params">(SessionConnectEvent event)</span> </span>{<font></font>
        StompHeaderAccessor sha = StompHeaderAccessor.wrap(event.getMessage());<font></font>
<font></font>
        <span class="hljs-comment">//  Session ID ...</span><font></font>
        String sessionId = sha.getSessionId();<font></font>
<font></font>
        <span class="hljs-comment">// ... CSRF </span>
        List&lt;String&gt; nativeHeader = sha.getNativeHeader(<span class="hljs-string">"X-CSRF-TOKEN"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (nativeHeader != <span class="hljs-keyword">null</span> &amp;&amp; nativeHeader.size() != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">//      </span>
            storage.put(nativeHeader.get(<span class="hljs-number">0</span>), sessionId);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSessionId</span><span class="hljs-params">(String csrf)</span> </span>{
        <span class="hljs-keyword">return</span> storage.remove(csrf);<font></font>
    }<font></font>
}</code></pre><br>
<p>  <code>WebSocketService</code>,      .        CSRF .</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketService</span> </span>{
    <span class="hljs-keyword">private</span> SimpMessagingTemplate simpMessagingTemplate;
    <span class="hljs-keyword">private</span> WebSocketSessionStorage sessionStorage;<font></font>
<font></font>
    <span class="hljs-comment">// all arg constructor</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendLoginStatus</span><span class="hljs-params">(AuthenticationInfo info, String csrf)</span> </span>{
        <span class="hljs-comment">//  Session ID,  CSRF </span><font></font>
        String sessionId = sessionStorage.getSessionId(csrf);<font></font>
<font></font>
        <span class="hljs-keyword">var</span> headerAccessor = SimpMessageHeaderAccessor.create(SimpMessageType.MESSAGE);<font></font>
        headerAccessor.setSessionId(sessionId);<font></font>
        headerAccessor.setLeaveMutable(<span class="hljs-keyword">true</span>);<font></font>
<font></font>
        <span class="hljs-comment">//     "/queue/login"</span>
        simpMessagingTemplate.convertAndSendToUser(sessionId, <span class="hljs-string">"/queue/login"</span>, info, headerAccessor.getMessageHeaders());<font></font>
    }<font></font>
}</code></pre><br>
<p>     <code>MfaCommand</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCallbackQuery</span><span class="hljs-params">(CallbackQuery callbackQuery)</span> </span>{<font></font>
    Message message = callbackQuery.getMessage();<font></font>
    AuthInfo authInfo = connectingUser.remove(message.getChatId());<font></font>
<font></font>
    <span class="hljs-comment">// ...</span><font></font>
<font></font>
    AuthenticationInfo info = <span class="hljs-keyword">new</span> AuthenticationInfo();<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (callbackQuery.getData().equals(CONFIRM_BUTTON)) {
        <span class="hljs-comment">// ...</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">//    </span><font></font>
    webSocketService.sendLoginStatus(info, authInfo.getCsrf());<font></font>
<font></font>
    <span class="hljs-keyword">try</span> {<font></font>
        telegramBot.execute(editMessageText);<font></font>
    } <span class="hljs-keyword">catch</span> (TelegramApiException e) {<font></font>
        log.error(<span class="hljs-string">"Error updating telegram MFA message"</span>, e);<font></font>
    }<font></font>
}</code></pre><br>
<p> <code>WebSocketConfig</code>  <code>WebSocketSecurityConfiguration</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSocketMessageBroker</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebSocketMessageBrokerConfigurer</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureMessageBroker</span><span class="hljs-params">(MessageBrokerRegistry registry)</span> </span>{<font></font>
        registry.enableSimpleBroker(<span class="hljs-string">"/queue/login"</span>);<font></font>
        registry.setApplicationDestinationPrefixes(<span class="hljs-string">"/ws"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerStompEndpoints</span><span class="hljs-params">(StompEndpointRegistry registry)</span> </span>{<font></font>
        registry<font></font>
                .addEndpoint(<span class="hljs-string">"/websocket"</span>)<font></font>
                .setAllowedOrigins(<span class="hljs-string">"*"</span>)<font></font>
                .withSockJS();<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketSecurityConfiguration</span> 
                <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSecurityWebSocketMessageBrokerConfigurer</span> </span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configureInbound</span><span class="hljs-params">(MessageSecurityMetadataSourceRegistry messages)</span> </span>{<font></font>
        messages<font></font>
                <span class="hljs-comment">// ,  ,</span>
                <span class="hljs-comment">//    -  </span><font></font>
                .simpTypeMatchers(<font></font>
                            SimpMessageType.CONNECT, <font></font>
                            SimpMessageType.DISCONNECT, <font></font>
                            SimpMessageType.UNSUBSCRIBE<font></font>
                        ).permitAll()<font></font>
<font></font>
                <span class="hljs-comment">//    </span>
                <span class="hljs-comment">//     </span>
                .simpSubscribeDestMatchers(<span class="hljs-string">"/user/queue/login"</span>).anonymous()<font></font>
<font></font>
                <span class="hljs-comment">//    -</span>
                <span class="hljs-comment">//    </span><font></font>
                .anyMessage().authenticated();<font></font>
    }<font></font>
}</code></pre><br>
<p>,   <code>WebSecurityConfig</code>   <code>.antMatchers("/websocket/**").permitAll()</code>.   . ,     .</p><br>
<p>   frontend,         - ,    :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> socket = <span class="hljs-keyword">new</span> SockJS(<span class="hljs-string">'/websocket'</span>);
<span class="hljs-keyword">let</span> stompClient = Stomp.over(socket);<font></font>
<font></font>
<span class="hljs-comment">//   headers,    Header',</span>
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">let</span> headers = {};<font></font>
<font></font>
<span class="hljs-comment">//  CSRF </span>
<span class="hljs-comment">//        </span>
<span class="hljs-comment">//    - WebSecurity  </span>
<span class="hljs-keyword">let</span> csrfHeader = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'meta[name="_csrf_header"]'</span>).content;<font></font>
headers[csrfHeader] = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'meta[name="_csrf"]'</span>).content;<font></font>
<font></font>
<span class="hljs-comment">//   WebSocket </span><font></font>
stompClient.connect(headers, frame =&gt; {<font></font>
    <span class="hljs-built_in">console</span>.log(frame);<font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    stompClient.subscribe(<span class="hljs-string">'/user/queue/login'</span>, data =&gt; {
        <span class="hljs-keyword">const</span> info = <span class="hljs-built_in">JSON</span>.parse(data.body);<font></font>
<font></font>
        <span class="hljs-comment">//    - </span>
        <span class="hljs-comment">//   </span>
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> (info.success) {<font></font>
            loginModal.classList.add(<span class="hljs-string">'fullscreen-loading-modal'</span>);<font></font>
            location.href = info.redirectUrl;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//  -   </span>
            <span class="hljs-comment">//       </span>
            loginForm.querySelector(<span class="hljs-string">'input[name="password"]'</span>).value = <span class="hljs-string">''</span>;<font></font>
            $(carousel).carousel(LOGIN_SLIDE);<font></font>
            showAlert(info.errorMessage, <span class="hljs-string">'danger'</span>);<font></font>
        }<font></font>
    });<font></font>
});</code></pre><br>
<p>  ! ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">GitHub </a>.           .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、このアプリケーションではこれを考慮していませんが、本番環境では、「Remember Me」機能を実装する必要がある可能性が高くなります。</font><font style="vertical-align: inherit;">実際、ユーザーが電報入力を使用すると、アプリケーションはそれを追加できません</font></font><code>remember me cookie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを修正するには、JavaScriptを使用してクッキーを書くことができるか、例えば、パラメータを指定してページにユーザーをリダイレクト</font></font><code>?rememberMe=true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、その後、使用して</font></font><code>Filter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このパラメータの存在のために、チェックをして、必要であれば、それを記録します</font></font><code>cookie</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja501712/index.html">テストについて話す：いくつかの物語と調査</a></li>
<li><a href="../ja501714/index.html">ITライフ、プログラミングユニバース、その他すべてに対する主な回答としてのスクール42</a></li>
<li><a href="../ja501716/index.html">Lamodaのエンジニアが解決する課題または解決するタスク</a></li>
<li><a href="../ja501722/index.html">コメット-高速REST API用のPHPフレームワーク</a></li>
<li><a href="../ja501724/index.html">頭痛のない純粋なJavaScriptでCookieを操作する</a></li>
<li><a href="../ja501730/index.html">ProxySQL-接続を逆多重化するためのツール</a></li>
<li><a href="../ja501734/index.html">[オタクスタイル]私たちの技術の未来：専門家からの予測</a></li>
<li><a href="../ja501736/index.html">6か月前に光学素子が細かくなったためにudalenkaに切り替えた方法</a></li>
<li><a href="../ja501738/index.html">5月13日Javaダイジェスト</a></li>
<li><a href="../ja501742/index.html">5月13日の輸送：uiiii、患者数の点で2位になりました。今度は制限を解除します</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>