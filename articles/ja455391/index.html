<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🌾 🤟🏾 👨‍❤️‍💋‍👨 パート1：不自然な生息地におけるRISC-V / RocketChip ⛔️ 👨🏾‍💻 👩🏽‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、ハードウェアを使わずにRISC-Vアーキテクチャを試す方法についての記事が Habr に掲載されました。しかし、デバッグボードでこれを行うとどうなりますか？ゲームジェネレーターに関するミームを覚えておいてください。「グラフィックスは危機より悪くない」、「コロブスを奪うことができる」、「生成」ボ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>パート1：不自然な生息地におけるRISC-V / RocketChip</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455391/"><img src="https://habrastorage.org/webt/it/on/yz/itonyz90xq9l_bvyih5h20xhuds.png" alt="RocketChipの構成" align="left"><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、</font><font style="vertical-align: inherit;">ハードウェアを使わずにRISC-Vアーキテクチャを試す方法についての</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事が</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Habr </font><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">掲載されまし</font><font style="vertical-align: inherit;">た。しかし、デバッグボードでこれを行うとどうなりますか？ゲームジェネレーターに関するミームを覚えておいてください。「グラフィックスは危機より悪くない」、「コロブスを奪うことができる」、「生成」ボタンのスタイルで20ティック。 RocketChip SoCジェネレーターはほぼ同じように配置されています。チェックマークの付いたウィンドウはなく、Scalaコードと少しのアセンブラーおよびMakeファイルがあります。この記事では、このRocketChipをネイティブのザイリンクスからアルテラ/インテルに移植するのがいかに簡単かを示します。</font></font></p><a name="habracut"></a><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免責事項：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「焼けた」ボード</font><strong><font style="vertical-align: inherit;">の作成</font></strong><font style="vertical-align: inherit;">者は責任を負いません。ピンの構成方法、物理的な接続内容などを注意深く観察してください。さて、安全対策にも従います。すべてがUSBで接続されているので、人にとって間違いなく安全だと考えるべきではありません。以前の実験でわかったように、USBボードを使用していても、電位差があるため、暖房用バッテリーに足を触れる必要はありません。 、私はプロのプリソボッドや電子エンジニアではありません。私は単なるScalaプログラマです。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私が理解している限り、RocketChipをデバッグするための最初のプラットフォームはザイリンクスFPGAでした。</font><font style="vertical-align: inherit;">私たちが間もなくクローンを作成するリポジトリーから判断すると、それはMicrosemiにも移植されました。</font><font style="vertical-align: inherit;">どこかでアルテラの使用について聞いたことがありますが、ソースはわかりませんでした。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結局のところ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、これは大きな問題ではありません。ボードを受け取って</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">SiFive Freedom</font></a><font style="vertical-align: inherit;">リポジトリの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">調査</font></a><font style="vertical-align: inherit;">を開始した</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">時点</font></a><font style="vertical-align: inherit;">から、動作する「メモリレス」（つまり、プロセッサレジスタ、BootROMおよびメモリマップドレジスタのみ）32ビット「マイクロコントローラ」（これはすでに何であっても）何か</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nanocontrollerが</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">判明...）オフ3日と4つの平日は渡され、それが即座に定義を定義するために私のところに来たならば、それはさらに少ないかかったでしょう</font></font><code>SYNTHESIS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世界的に。</font></font></p><br>
<h1 id="materialy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">材料</font></font></h1><br>
<p>  —  <em></em>    .    :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RocketChip</a> —       (  ,   ).   RocketChip  Rocket core in-order .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SiFive Freedom</a> —      —        </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">rocket-tools</a> —        32-  64-  RISC-V</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">openocd-riscv</a> —  OpenOCD    JTAG  RISC-V  (  , RocketChip)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">IntelliJ IDEA Community</a>   Scala-,   RocketChip </li>
<li>    toolchain  SiFive, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
</ul><br>
<p>   :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  Zeowaa  Aliexpress:   Cyclone 4 EP4CE115  (?) USB Blaster</li>
<li>RaspberryPi   JTAG-  -</li>
</ul><br>
<p>,    —     Ubuntu   Quartus Lite 18.</p><br>
<p>-,      Amazon   FPGA-    SiFive,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">FireSim</a>,      , <del>    </del>.   ,        API       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,  ,  ,         ...</p><br>
<h1 id="izuchaem-obstanovku"> </h1><br>
<p>       <code>read_write_1G</code>          .    ?    ,         . ,  -   .        <code>freedom</code> (   <code>freedom-e-sdk</code>).    -,    <code>rocket-tools</code> (      ),   </p><br>
<pre><code class="plaintext hljs">RISCV=$(pwd)/../rocket-tools make -f Makefile.e300artydevkit verilog mcs</code></pre><br>
<p> <code>verilog</code>      Verilog   ,  <code>mcs</code>  BootROM.   ,  <code>mcs</code>   —     Xilinx Vivado,   BootROM       Vivado .</p><br>
<p>   Quartus <strong>Project -&gt; Add/Remove Files in Project...</strong>  <code>freedom/builds/e300artydevkit/sifive.freedom.everywhere.e300artydevkit.E300ArtyDevKitConfig.v</code>,  Top-level entity: <strong>E300ArtyDevKitFPGAChip</strong>   General    (,   top-level entity     ).     ,      <code>AsyncResetReg</code>, <code>IOBUF</code>  ..    —     Top-level entity.    ,      <code>AsyncResetReg.v</code>,   <code>IOBUF</code> —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  IP core  Xilinx.       <code>freedom/rocket-chip/src/main/resources/vsrc/AsyncResetReg.v</code>.  <code>plusarg_reader.v</code>  .</p><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">Error (10174): Verilog HDL Unsupported Feature error at plusarg_reader.v(18): system function "$value$plusargs" is not supported for synthesis</code></pre><br>
<p> ,           .</p><br>
<div class="spoiler"><b class="spoiler_title">plusarg_reader.v</b><div class="spoiler_text"><pre><code class="plaintext hljs">// See LICENSE.SiFive for license details.<font></font>
<font></font>
//VCS coverage exclude_file<font></font>
<font></font>
// No default parameter values are intended, nor does IEEE 1800-2012 require them (clause A.2.4 param_assignment),<font></font>
// but Incisive demands them. These default values should never be used.<font></font>
module plusarg_reader #(parameter FORMAT="borked=%d", DEFAULT=0) (<font></font>
   output [31:0] out<font></font>
);<font></font>
<font></font>
`ifdef SYNTHESIS<font></font>
assign out = DEFAULT;<font></font>
`else<font></font>
reg [31:0] myplus;<font></font>
assign out = myplus;<font></font>
<font></font>
initial begin<font></font>
   if (!$value$plusargs(FORMAT, myplus)) myplus = DEFAULT;<font></font>
end<font></font>
`endif<font></font>
<font></font>
endmodule</code></pre></div></div><br>
<p>  ,  , ,      ,        .   ,       define   <code>SYNTHESIS</code>.      <code>ifdef</code>     <code>`define SYNTHESIS</code>,    -  ,  ,     (    , ...).    ,      ,    <strong>Compiler settings-&gt;Verilog HDL Input</strong>   <code>SYNTHESIS</code>,     1,   <code>&lt;NONE&gt;</code> ( ).</p><br>
<p>!  Quartus     —      Idea   .</p><br>
<h1 id="znakomimsya-s-proektom">  </h1><br>
<p>  Import project,     <code>freedom</code>,    sbt,   use sbt shell for imports, for builds.    ,  ,      - —    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>      :</p><br>
<ul>
<li>  sbt shell</li>
<li> <code>clean</code></li>
<li>    Restart</li>
<li>  sbt    <code>++2.12.4</code>,       Scala  2.12.4,   <code>compile</code></li>
<li>   Refresh all sbt projects</li>
<li>PROFIT!,    </li>
</ul><br>
<p>      -  ,      . <strong>, -, , <code>quartus_ipcreate</code>    Lite Edition?</strong> IP Variations    ,      Scala   BlackBox.</p><br>
<p>  ,     :</p><br>
<pre><code class="plaintext hljs">fpga-shells ()<font></font>
   |<font></font>
   +-src/main/scala<font></font>
       |<font></font>
       +- ip/intel        &lt;--     IP Variations<font></font>
       |   |<font></font>
       |   +- Intel.scala<font></font>
       |<font></font>
       +- shell/intel     &lt;--      <font></font>
           |<font></font>
           +- ZeowaaShell.scala<font></font>
<font></font>
src/main/scala<font></font>
   |<font></font>
   +- everywhere.e300artydevkit &lt;--   "" ,   <font></font>
   |<font></font>
   +- zeowaa/e115         &lt;--      "" SoC<font></font>
       |<font></font>
       +- Config<font></font>
       +- FPGAChip<font></font>
       +- Platform<font></font>
       +- System</code></pre><br>
<p>   Makefile    <code>Makefile.e300artydevkit</code>,  :</p><br>
<p><strong>Makefile.zeowaa-e115:</strong></p><br>
<pre><code class="plaintext hljs"># See LICENSE for license details.<font></font>
base_dir := $(patsubst %/,%,$(dir $(abspath $(lastword $(MAKEFILE_LIST)))))<font></font>
BUILD_DIR := $(base_dir)/builds/zeowaa-e115<font></font>
FPGA_DIR := $(base_dir)/fpga-shells/intel<font></font>
MODEL := FPGAChip<font></font>
PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG_PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG := ZeowaaConfig<font></font>
export BOARD := zeowaa<font></font>
export BOOTROM_DIR := $(base_dir)/bootrom/xip<font></font>
<font></font>
rocketchip_dir := $(base_dir)/rocket-chip<font></font>
sifiveblocks_dir := $(base_dir)/sifive-blocks<font></font>
<font></font>
include common.mk</code></pre><br>
<h1 id="bindingi"></h1><br>
<p> ,   <code>IOBUF</code> —     .   Scala-,  ,   «» (?) :     ,   ,     .     Quartus   IP Catalog «IOBUF»,        <code>ALTIOBUF</code>.  -    ,  «As a bidirectional buffer».           <code>iobuf</code>:</p><br>
<pre><code class="plaintext hljs">// ...<font></font>
module obuf (<font></font>
    datain,<font></font>
    oe,<font></font>
    dataout);<font></font>
<font></font>
    input   [0:0]  datain;<font></font>
    input   [0:0]  oe;<font></font>
    output  [0:0]  dataout;<font></font>
<font></font>
    wire [0:0] sub_wire0;<font></font>
    wire [0:0] dataout = sub_wire0[0:0];<font></font>
<font></font>
    obuf_iobuf_out_d5t  obuf_iobuf_out_d5t_component (<font></font>
                .datain (datain),<font></font>
                .oe (oe),<font></font>
                .dataout (sub_wire0));<font></font>
<font></font>
endmodule<font></font>
// ...</code></pre><br>
<p>   blackbox-:</p><br>
<pre><code class="scala hljs"><span class="hljs-keyword">package</span> ip.intel<font></font>
<font></font>
<span class="hljs-keyword">import</span> chisel3._
<span class="hljs-keyword">import</span> chisel3.core.{<span class="hljs-type">Analog</span>, <span class="hljs-type">BlackBox</span>}
<span class="hljs-keyword">import</span> freechips.rocketchip.jtag.<span class="hljs-type">Tristate</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IOBUF</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BlackBox</span> </span>{
  <span class="hljs-keyword">val</span> io = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">Bundle</span> {
    <span class="hljs-keyword">val</span> datain = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> dataout = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> oe = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())<font></font>
<font></font>
    <span class="hljs-keyword">val</span> dataio = <span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>)<font></font>
  })<font></font>
<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">desiredName</span></span>: <span class="hljs-type">String</span> = <span class="hljs-string">"iobuf"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IOBUF</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply</span></span>(a: <span class="hljs-type">Analog</span>, t: <span class="hljs-type">Tristate</span>): <span class="hljs-type">IOBUF</span> = {
    <span class="hljs-keyword">val</span> res = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">IOBUF</span>)<font></font>
    res.io.datain := t.data<font></font>
    res.io.oe := t.driven<font></font>
<font></font>
    a &lt;&gt; res.io.dataio<font></font>
<font></font>
    res<font></font>
  }<font></font>
}</code></pre><br>
<p> <code>Analog</code>   <code>inout</code>,   <code>desiredName</code>     .   ,    ,   .</p><br>
<p>   BootROM —     <strong>ROM: 1-PORT</strong> (2048 x 32-bit words,   address,   <code>rden</code>).     <code>rom</code>,         ,    <code>ROMGenerator</code>: <code>rden</code>  <code>me</code>     <code>oe</code> (     1):</p><br>
<p><strong>BootROM.v:</strong></p><br>
<pre><code class="plaintext hljs">module BootROM(<font></font>
  input wire [10:0] address,<font></font>
  input wire clock,<font></font>
  input wire me,<font></font>
  input wire oe,<font></font>
  output wire [31:0] q<font></font>
);<font></font>
<font></font>
rom r(<font></font>
  .address(address),<font></font>
  .clock(clock),<font></font>
  .rden(me),<font></font>
  .q(q)<font></font>
);<font></font>
<font></font>
endmodule<font></font>
</code></pre><br>
<p>     : hex-,  , -    Quartus-.      Intel HEX  (Intel         ,   ),    ,     HEX:</p><br>
<pre><code class="plaintext hljs">srec_cat -Output builds/zeowaa-e115/xip.hex -Intel builds/zeowaa-e115/xip.bin -Binary -Output_Block_Size 128</code></pre><br>
<p>  Makefile  :</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">base_dir := $(patsubst %/,%,$(dir $(abspath $(lastword $(MAKEFILE_LIST)))))<font></font>
BUILD_DIR := $(base_dir)/builds/zeowaa-e115<font></font>
FPGA_DIR := $(base_dir)/fpga-shells/intel<font></font>
MODEL := FPGAChip<font></font>
PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG_PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG := ZeowaaConfig<font></font>
export BOARD := zeowaa<font></font>
export BOOTROM_DIR := $(base_dir)/bootrom/xip<font></font>
<font></font>
rocketchip_dir := $(base_dir)/rocket-chip<font></font>
sifiveblocks_dir := $(base_dir)/sifive-blocks<font></font>
<font></font>
all: verilog<font></font>
    $(MAKE) -C $(BOOTROM_DIR) clean romgen || true<font></font>
    srec_cat -Output $(BUILD_DIR)/xip.hex -Intel $(BUILD_DIR)/xip.bin -Binary -Output_Block_Size 128<font></font>
<font></font>
include common.mk</code></pre></div></div><br>
<h1 id="ono-shevelitsyaw-sinteziruetsya"> ^W </h1><br>
<p>,    ,    — .     ,   , , JTAG.       : BootROM,  , GPIO,   ,  JTAG,         .    <code>E300ArtyDevKit</code>       . -,</p><br>
<p><strong>Config.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultZeowaaConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span> (<span class="hljs-params">
  new <span class="hljs-type">WithNBreakpoints</span>(2</span>)        <span class="hljs-title">++</span></span>
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithNExtTopInterrupts</span>(<span class="hljs-number">0</span>)   ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithJtagDTM</span>                ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">TinyConfig</span><font></font>
)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Peripherals</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span>(<span class="hljs-params">(site, here, up</span>) <span class="hljs-title">=&gt;</span> </span>{
  <span class="hljs-keyword">case</span> <span class="hljs-type">PeripheryGPIOKey</span> =&gt; <span class="hljs-type">List</span>(
    <span class="hljs-type">GPIOParams</span>(address = <span class="hljs-type">BigInt</span>(<span class="hljs-number">0x64002000</span>L), width = <span class="hljs-number">6</span>)<font></font>
  )<font></font>
  <span class="hljs-keyword">case</span> <span class="hljs-type">PeripheryMaskROMKey</span> =&gt; <span class="hljs-type">List</span>(
    <span class="hljs-type">MaskROMParams</span>(address = <span class="hljs-number">0x10000</span>, name = <span class="hljs-string">"BootROM"</span>))<font></font>
})<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZeowaaConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span>(<span class="hljs-params">
  new <span class="hljs-type">Peripherals</span>    ++
    new <span class="hljs-type">DefaultZeowaaConfig</span>(</span>).<span class="hljs-title">alter</span>(<span class="hljs-params">(site, here, up</span>) <span class="hljs-title">=&gt;</span> </span>{
      <span class="hljs-keyword">case</span> <span class="hljs-type">JtagDTMKey</span> =&gt; <span class="hljs-keyword">new</span> <span class="hljs-type">JtagDTMConfig</span> (<font></font>
        idcodeVersion = <span class="hljs-number">2</span>,<font></font>
        idcodePartNum = <span class="hljs-number">0xe31</span>,<font></font>
        idcodeManufId = <span class="hljs-number">0x489</span>,<font></font>
        debugIdleCycles = <span class="hljs-number">5</span>)<font></font>
    })<font></font>
)</code></pre><br>
<p>        E300:               .  ,         (     <code>TinyConfig</code>),    ,  32-!</p><br>
<p>  ,      boilerplate.<br>
<strong>System.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">System</span>(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">RocketSubsystem</span></span>
  <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryMaskROMSlave</span>
  <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryDebug</span>
  <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryGPIO</span><font></font>
{<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> module = <span class="hljs-keyword">new</span> <span class="hljs-type">SystemModule</span>(<span class="hljs-keyword">this</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SystemModule</span>[+<span class="hljs-type">L</span> &lt;: <span class="hljs-type">System</span>](<span class="hljs-params">_outer: <span class="hljs-type">L</span></span>)</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-type">RocketSubsystemModuleImp</span>(_outer)
    <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryDebugModuleImp</span>
    <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryGPIOModuleImp</span><font></font>
{<font></font>
  <span class="hljs-comment">// Reset vector is set to the location of the mask rom</span>
  <span class="hljs-keyword">val</span> maskROMParams = p(<span class="hljs-type">PeripheryMaskROMKey</span>)<font></font>
  global_reset_vector := maskROMParams(<span class="hljs-number">0</span>).address.<span class="hljs-type">U</span>
}</code></pre><br>
<p>,   « »    ( )  :<br>
<strong>Platform.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlatformIO</span>(<span class="hljs-params">implicit val p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> </span>{
  <span class="hljs-keyword">val</span> jtag = <span class="hljs-type">Flipped</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">JTAGIO</span>(hasTRSTn = <span class="hljs-literal">false</span>))
  <span class="hljs-keyword">val</span> jtag_reset = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
  <span class="hljs-keyword">val</span> gpio = <span class="hljs-keyword">new</span> <span class="hljs-type">GPIOPins</span>(() =&gt; <span class="hljs-keyword">new</span> <span class="hljs-type">BasePin</span>(), p(<span class="hljs-type">PeripheryGPIOKey</span>)(<span class="hljs-number">0</span>))<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Platform</span>(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Module</span> </span>{
  <span class="hljs-keyword">val</span> sys = <span class="hljs-type">Module</span>(<span class="hljs-type">LazyModule</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">System</span>).module)
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> io = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">PlatformIO</span>)<font></font>
<font></font>
  <span class="hljs-keyword">val</span> sjtag = sys.debug.systemjtag.get<font></font>
  sjtag.reset := io.jtag_reset<font></font>
  sjtag.mfr_id := p(<span class="hljs-type">JtagDTMKey</span>).idcodeManufId.<span class="hljs-type">U</span>(<span class="hljs-number">11.</span><span class="hljs-type">W</span>)<font></font>
  sjtag.jtag &lt;&gt; io.jtag<font></font>
  io.gpio &lt;&gt; sys.gpio.head<font></font>
}</code></pre><br>
<p><strong>FPGAChip.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FPGAChip</span>(<span class="hljs-params">override implicit val p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">ZeowaaShell</span> </span>{<font></font>
  withClockAndReset(cpu_clock, cpu_rst) {<font></font>
    <span class="hljs-keyword">val</span> dut = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">Platform</span>)<font></font>
<font></font>
    dut.io.jtag.<span class="hljs-type">TCK</span> := jtag_tck<font></font>
    dut.io.jtag.<span class="hljs-type">TDI</span> := jtag_tdi
    <span class="hljs-type">IOBUF</span>(jtag_tdo, dut.io.jtag.<span class="hljs-type">TDO</span>)<font></font>
    dut.io.jtag.<span class="hljs-type">TMS</span> := jtag_tms<font></font>
    dut.io.jtag_reset := jtag_rst<font></font>
<font></font>
    <span class="hljs-type">Seq</span>(led_0, led_1, led_2, led_3) zip dut.io.gpio.pins foreach {
      <span class="hljs-keyword">case</span> (led, pin) =&gt;<font></font>
        led := <span class="hljs-type">Mux</span>(pin.o.oe, pin.o.oval, <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>)<font></font>
    }<font></font>
<font></font>
    dut.io.gpio.pins.foreach(_.i.ival := <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>)<font></font>
    dut.io.gpio.pins(<span class="hljs-number">4</span>).i.ival := key1<font></font>
    dut.io.gpio.pins(<span class="hljs-number">5</span>).i.ival := key2<font></font>
  }<font></font>
}</code></pre><br>
<p> ,  Chisel       (    ).       :</p><br>
<div class="spoiler"><b class="spoiler_title">ZeowaaShell.scala</b><div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZeowaaShell</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemIf</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> </span>{
    <span class="hljs-keyword">val</span> mem_addr = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">14.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_ba = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">3.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_cas_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_cke = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_clk = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_clk_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_cs_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_dm = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">8.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_dq = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">64.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_dqs = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">8.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_odt = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_ras_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_we_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZeowaaShell</span>(<span class="hljs-params">implicit val p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">RawModule</span> </span>{
  <span class="hljs-keyword">val</span> clk25 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))
  <span class="hljs-keyword">val</span> clk27 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))
  <span class="hljs-keyword">val</span> clk48 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> key1 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> key2 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> key3 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> led_0 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> led_1 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> led_2 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> led_3 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> jtag_tdi = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> jtag_tdo = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> jtag_tck = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))
  <span class="hljs-keyword">val</span> jtag_tms = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> uart_rx = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> uart_tx = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))<font></font>
<font></font>
  <span class="hljs-comment">// Internal wiring</span><font></font>
<font></font>
  <span class="hljs-keyword">val</span> cpu_clock = <span class="hljs-type">Wire</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> cpu_rst = <span class="hljs-type">Wire</span>(<span class="hljs-type">Bool</span>())
  <span class="hljs-keyword">val</span> jtag_rst = <span class="hljs-type">Wire</span>(<span class="hljs-type">Bool</span>())<font></font>
<font></font>
  withClockAndReset(cpu_clock, <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>) {
    <span class="hljs-keyword">val</span> counter = <span class="hljs-type">Reg</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">64.</span><span class="hljs-type">W</span>))<font></font>
    counter := counter + <span class="hljs-number">1.</span><span class="hljs-type">U</span>
    cpu_rst := (counter &gt; <span class="hljs-number">1000.</span><span class="hljs-type">U</span>) &amp;&amp; (counter &lt; <span class="hljs-number">2000.</span><span class="hljs-type">U</span>)<font></font>
    jtag_rst := (counter &gt; <span class="hljs-number">3000.</span><span class="hljs-type">U</span>) &amp;&amp; (counter &lt; <span class="hljs-number">4000.</span><span class="hljs-type">U</span>)<font></font>
  }<font></font>
<font></font>
  cpu_clock &lt;&gt; clk25<font></font>
}</code></pre></div></div><br>
<p>     ? , -,      :)   <code>Shell</code>  <code>FPGAChip</code>, ,   ,  Shell —      :         (       !),  <code>FPGAChip</code>  ,     SoC  .   Platform   :  : <code>ZeowaaShell</code> ( ,  <code>Platform</code>) —  <code>RawModule</code>,  ,     <code>clock</code>  <code>reset</code> —    « »,     (, ,       ).   Platform —     ,        ..</p><br>
<h1 id="jtag">JTAG</h1><br>
<p>   ,   JTAG.      RaspberryPi 3 Model B+,     -    GPIO.  , <em>    </em>:   OpenOCD    <code>interface/sysfsgpio-raspberrypi.cfg</code>,          (TCK = 11, TMS = 25, TDI = 10, TDO = 9,  GND    ) —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Freedom.cfg</a>   <code>riscv-tests</code>,   :</p><br>
<pre><code class="plaintext hljs">adapter_khz     10000<font></font>
source [find interface/sysfsgpio-raspberrypi.cfg]<font></font>
set _CHIPNAME riscv<font></font>
<font></font>
jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x20e31913<font></font>
<font></font>
set _TARGETNAME $_CHIPNAME.cpu<font></font>
target create $_TARGETNAME riscv -chain-position $_TARGETNAME -rtos riscv<font></font>
<font></font>
init<font></font>
halt<font></font>
echo "Ready for Remote Connections"</code></pre><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">riscv-openocd</a>,   ARM,  <del>  </del>     SiFive     :</p><br>
<pre><code class="plaintext hljs">./configure --enable-remote-bitbang --enable-sysfsgpio</code></pre><br>
<p>  ,   remote bitbang,      ARM    ...</p><br>
<p>      </p><br>
<pre><code class="plaintext hljs">root@ubuntu:~/riscv-openocd# ./src/openocd -s tcl -f ../riscv.tcl<font></font>
Open On-Chip Debugger 0.10.0+dev-00614-g998fed1fe-dirty (2019-06-03-10:27)<font></font>
Licensed under GNU GPL v2<font></font>
For bug reports, read<font></font>
        http://openocd.org/doc/doxygen/bugs.html<font></font>
adapter speed: 10000 kHz<font></font>
SysfsGPIO nums: tck = 11, tms = 25, tdi = 10, tdo = 9<font></font>
SysfsGPIO nums: swclk = 11, swdio = 25<font></font>
Info : auto-selecting first available session transport "jtag". To override use 'transport select &lt;transport&gt;'.<font></font>
Info : SysfsGPIO JTAG/SWD bitbang driver<font></font>
Info : JTAG and SWD modes enabled<font></font>
Warn : gpio 11 is already exported<font></font>
Warn : gpio 25 is already exported<font></font>
Info : This adapter doesn't support configurable speed<font></font>
Info : JTAG tap: riscv.cpu tap/device found: 0x20e31913 (mfg: 0x489 (SiFive, Inc.), part: 0x0e31, ver: 0x2)<font></font>
Info : datacount=1 progbufsize=16<font></font>
Info : Disabling abstract command reads from CSRs.<font></font>
Info : Examined RISC-V core; found 1 harts<font></font>
Info :  hart 0: XLEN=32, misa=0x40001105<font></font>
Info : Listening on port 3333 for gdb connections<font></font>
Ready for Remote Connections<font></font>
Info : Listening on port 6666 for tcl connections<font></font>
Info : Listening on port 4444 for telnet connections</code></pre><br>
<p>    SSH    3333,   IP:</p><br>
<pre><code class="plaintext hljs">ssh -L 3333:127.0.0.1:3333 ubuntu@192.168.1.104</code></pre><br>
<p>     GDB <strong>  riscv32</strong>:</p><br>
<pre><code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-gdb -q<font></font>
(gdb) target remote :3333<font></font>
Remote debugging using :3333<font></font>
warning: No executable has been specified and target does not support<font></font>
determining executable automatically.  Try using the "file" command.<font></font>
0x00000000 in ?? ()</code></pre><br>
<p>    ,  JTAG   ,   <code>SYNTHESIS</code>      ,      «JTAG ,    ».</p><br>
<h1 id="pervyy-kod"> </h1><br>
<p>     Makefile,   bootrom    <code>bootrom/xip/xip.S</code>.    :</p><br>
<pre><code class="plaintext hljs">// See LICENSE for license details.<font></font>
// Execute in place<font></font>
// Jump directly to XIP_TARGET_ADDR<font></font>
<font></font>
  .section .text.init<font></font>
  .option norvc<font></font>
  .globl _start<font></font>
_start:<font></font>
  csrr a0, mhartid<font></font>
  la a1, dtb<font></font>
  li t0, XIP_TARGET_ADDR<font></font>
  jr t0<font></font>
<font></font>
  .section .rodata<font></font>
dtb:<font></font>
  .incbin DEVICE_TREE</code></pre><br>
<p>,     device tree ( dtb-),    ,       .        :</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">  .section .text.init<font></font>
  .option norvc<font></font>
  .globl _start<font></font>
_start:<font></font>
  li a5, 0x64002000<font></font>
  li a1, 0x0F<font></font>
  li a2, 0x01<font></font>
  li a3, 0x30<font></font>
<font></font>
  li a6, 0x10<font></font>
  li a7, 0x20<font></font>
<font></font>
  sw zero, 0x38(a5) // iof_en<font></font>
  sw a1,   0x08(a5) // output_en<font></font>
  sw a2,   0x00(a5) // value<font></font>
  sw a1,   0x14(a5) // drive<font></font>
<font></font>
  sw a3,   0x04(a5) // input_en<font></font>
<font></font>
// a0 &lt;- timer<font></font>
// a1 &lt;- 0x0F<font></font>
// a2 &lt;- [state]<font></font>
// a3 &lt;- 0x30<font></font>
// a4 &lt;- [buttons]<font></font>
// a5 &lt;- [gpio addr]<font></font>
// a6 &lt;- 0x10<font></font>
// a7 &lt;- 0x20<font></font>
<font></font>
loop:<font></font>
  li a4, 0x1000<font></font>
  add a0, a0, a4<font></font>
  bgtu a0, zero, loop<font></font>
<font></font>
  lw a4,   0x00(a5) // value<font></font>
  beq a4, a6, plus<font></font>
  beq a4, a7, minus<font></font>
  j store<font></font>
plus:<font></font>
  srai a2, a2, 1<font></font>
  beq a2, zero, pzero<font></font>
  j store<font></font>
pzero:<font></font>
  li a2, 0x08<font></font>
  j store<font></font>
minus:<font></font>
  slli a2, a2, 1<font></font>
  beq a2, a6, mzero<font></font>
  j store<font></font>
mzero:<font></font>
  li a2, 0x01<font></font>
store:<font></font>
  sw a2,  0x0c(a5) // value<font></font>
  j loop</code></pre></div></div><br>
<p>   ,        .   ,  RISC-V ,  ,   «     , , ».         ,     ATTiny  . «    , » —  ,  , ,  <em>   </em>:  <del></del> ,    ,      .         «»       ,   .</p><br>
<p>…  :   ,    .   JTAG: program counter = 0x00000000 — -  .    <code>0x64002000</code>     GPIO:</p><br>
<div class="spoiler"><b class="spoiler_title">GPIOCtrlRegs.scala</b><div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-comment">// See LICENSE for license details.</span>
<span class="hljs-keyword">package</span> sifive.blocks.devices.gpio<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">GPIOCtrlRegs</span> </span>{
  <span class="hljs-keyword">val</span> value       = <span class="hljs-number">0x00</span>
  <span class="hljs-keyword">val</span> input_en    = <span class="hljs-number">0x04</span>
  <span class="hljs-keyword">val</span> output_en   = <span class="hljs-number">0x08</span>
  <span class="hljs-keyword">val</span> port        = <span class="hljs-number">0x0c</span>
  <span class="hljs-keyword">val</span> pullup_en   = <span class="hljs-number">0x10</span>
  <span class="hljs-keyword">val</span> drive       = <span class="hljs-number">0x14</span>
  <span class="hljs-keyword">val</span> rise_ie     = <span class="hljs-number">0x18</span>
  <span class="hljs-keyword">val</span> rise_ip     = <span class="hljs-number">0x1c</span>
  <span class="hljs-keyword">val</span> fall_ie     = <span class="hljs-number">0x20</span>
  <span class="hljs-keyword">val</span> fall_ip     = <span class="hljs-number">0x24</span>
  <span class="hljs-keyword">val</span> high_ie     = <span class="hljs-number">0x28</span>
  <span class="hljs-keyword">val</span> high_ip     = <span class="hljs-number">0x2c</span>
  <span class="hljs-keyword">val</span> low_ie      = <span class="hljs-number">0x30</span>
  <span class="hljs-keyword">val</span> low_ip      = <span class="hljs-number">0x34</span>
  <span class="hljs-keyword">val</span> iof_en      = <span class="hljs-number">0x38</span>
  <span class="hljs-keyword">val</span> iof_sel     = <span class="hljs-number">0x3c</span>
  <span class="hljs-keyword">val</span> out_xor     = <span class="hljs-number">0x40</span>
}</code></pre></div></div><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">(gdb) set variable *0x64002038=0<font></font>
(gdb) set variable *0x64002008=0xF<font></font>
(gdb) set variable *0x64002000=0x1<font></font>
(gdb) set variable *0x64002014=0xF<font></font>
(gdb) set variable *0x6400200c=0x1</code></pre><br>
<p>…    …    <code>0x1</code>,  <code>0x5</code>… ,     .   ,    ,    0x00    —   .</p><br>
<pre><code class="plaintext hljs">(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000030<font></font>
//   <font></font>
(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000020<font></font>
//  <font></font>
(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000010<font></font>
//  <font></font>
(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000000</code></pre><br>
<p>, memory-mapped     ,    cont + Ctrl-C   — ,  .</p><br>
<p>      ,    <code>$pc=0x0000000</code>?</p><br>
<pre><code class="plaintext hljs">(gdb) x/10i 0x10000<font></font>
   0x10000:     addi    s1,sp,12<font></font>
   0x10002:     fsd     ft0,-242(ra)<font></font>
   0x10006:     srli    a4,a4,0x21<font></font>
   0x10008:     addi    s0,sp,32<font></font>
   0x1000a:     slli    t1,t1,0x21<font></font>
   0x1000c:     lb      zero,-1744(a2)<font></font>
   0x10010:     nop<font></font>
   0x10012:     addi    a0,sp,416<font></font>
   0x10014:     c.slli  zero,0x0<font></font>
   0x10016:     0x9308</code></pre><br>
<p>   ???     ,  !  :</p><br>
<pre><code class="plaintext hljs">(gdb) x/10x 0x10000<font></font>
0x10000:        0xb7270064      0x9305f000      0x13061000      0x93060003<font></font>
0x10010:        0x13080001      0x93080002      0x23ac0702      0x23a4b700<font></font>
0x10020:        0x23a0c700      0x23aab700</code></pre><br>
<p>  ,      ?</p><br>
<pre><code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-objdump -d builds/zeowaa-e115/xip.elf<font></font>
<font></font>
builds/zeowaa-e115/xip.elf:       elf32-littleriscv<font></font>
<font></font>
  .text:<font></font>
<font></font>
00010054 &lt;_start&gt;:<font></font>
   10054:       640027b7                lui     a5,0x64002<font></font>
   10058:       00f00593                li      a1,15<font></font>
   1005c:       00100613                li      a2,1<font></font>
   10060:       03000693                li      a3,48<font></font>
   10064:       01000813                li      a6,16<font></font>
   10068:       02000893                li      a7,32<font></font>
   1006c:       0207ac23                sw      zero,56(a5) # 64002038 &lt;__global_pointer$+0x63ff0770&gt;<font></font>
   10070:       00b7a423                sw      a1,8(a5)<font></font>
   10074:       00c7a023                sw      a2,0(a5)<font></font>
   10078:       00b7aa23                sw      a1,20(a5)<font></font>
   1007c:       00d7a223                sw      a3,4(a5)<font></font>
...</code></pre><br>
<p> , Quartus     ,     ,    endianness.   ,   ,  <em>  </em>,  —  ,   </p><br>
<div class="spoiler"><b class="spoiler_title">BootROM.v</b><div class="spoiler_text"><pre><code class="plaintext hljs">module BootROM(<font></font>
  input wire [10:0] address,<font></font>
  input wire clock,<font></font>
  input wire me,<font></font>
  input wire oe,<font></font>
  output wire [31:0] q<font></font>
);<font></font>
<font></font>
wire [31:0] q_r;<font></font>
<font></font>
rom r(<font></font>
  .address(address),<font></font>
  .clock(clock),<font></font>
  .rden(me),<font></font>
  .q(q_r)<font></font>
);<font></font>
<font></font>
assign q[31:24] = q_r[7:0];<font></font>
assign q[23:16] = q_r[15:8];<font></font>
assign q[15:8] = q_r[23:16];<font></font>
assign q[7:0] = q_r[31:24];<font></font>
<font></font>
endmodule</code></pre></div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それで、私たちは収集し、始めます、それは輝きません。</font><font style="vertical-align: inherit;">私たちはJTAGを介して接続されています：</font></font><code>$pc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイクル内のどこかを正直に示しています、電球の燃焼のマスク= 4、そうです、設定する必要があり</font><font style="vertical-align: inherit;">ます</font></font><code>output_en</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：（</font><font style="vertical-align: inherit;">続ける）-すべてが機能します！</font><font style="vertical-align: inherit;">ああ、もう出してしまった。</font><font style="vertical-align: inherit;">なんらかの理由で、レジスタへの書き込み順序をどのように並べ替えても機能しません。したがって、まず、単純な松葉杖でバックアップして</font><font style="vertical-align: inherit;">、実際の値を設定する前に設定を</font><font style="vertical-align: inherit;">転送し</font><font style="vertical-align: inherit;">ます。</font></font><code>set variable *0x64002008=0xF</code><font style="vertical-align: inherit;"></font><code>c</code><font style="vertical-align: inherit;"></font><code>output_en</code><font style="vertical-align: inherit;"></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在使用しているリソースの合計：</font></font></p><br>
<pre><code class="plaintext hljs">Total logic elements   17,370 / 114,480 ( 15 % )<font></font>
Total registers        8357<font></font>
Total pins             16 / 281 ( 6 % )<font></font>
Total virtual pins     0<font></font>
Total memory bits      264,000 / 3,981,312 ( 7 % )<font></font>
Embedded Multiplier    9-bit elements 4 / 532 ( &lt; 1 % )</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チゼルに関する情報源</font></font></a></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つづく...</font></font></em></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455377/index.html">IoTアーキテクチャ</a></li>
<li><a href="../ja455379/index.html">（静的）C ++プログラムでの最適なコンテナーの選択</a></li>
<li><a href="../ja455381/index.html">3CXテクニカルサポートの応答：PBXサーバーでのSIPトラフィックのキャプチャ</a></li>
<li><a href="../ja455387/index.html">Elastic Stackでの機械学習の理解（Elasticsearch、別名ELK）</a></li>
<li><a href="../ja455389/index.html">Haxe 4：新機能</a></li>
<li><a href="../ja455393/index.html">レーダーにおけるスペクトル推定のパラメトリック法の使用について-MUSIC法。記事への追加</a></li>
<li><a href="../ja455397/index.html">Huaweiのモスクワオフィスでの新しいネットワークの設計と実装方法、パート1</a></li>
<li><a href="../ja455401/index.html">簡単な例におけるCisco IOSのTcl</a></li>
<li><a href="../ja455403/index.html">5セントから神のゲームまで</a></li>
<li><a href="../ja455405/index.html">小さなプログラムが小さなオフィスをどのようにして1か月あたり1億ルーブル以上の利益をもたらす連邦企業に変えたのか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>