<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€ğŸŒ¾ ğŸ¤ŸğŸ¾ ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ãƒ‘ãƒ¼ãƒˆ1ï¼šä¸è‡ªç„¶ãªç”Ÿæ¯åœ°ã«ãŠã‘ã‚‹RISC-V / RocketChip â›”ï¸ ğŸ‘¨ğŸ¾â€ğŸ’» ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘©ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ€è¿‘ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’ä½¿ã‚ãšã«RISC-Vã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è©¦ã™æ–¹æ³•ã«ã¤ã„ã¦ã®è¨˜äº‹ãŒ Habr ã«æ²è¼‰ã•ã‚Œã¾ã—ãŸã€‚ã—ã‹ã—ã€ãƒ‡ãƒãƒƒã‚°ãƒœãƒ¼ãƒ‰ã§ã“ã‚Œã‚’è¡Œã†ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿã‚²ãƒ¼ãƒ ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã«é–¢ã™ã‚‹ãƒŸãƒ¼ãƒ ã‚’è¦šãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚ã€Œã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯å±æ©Ÿã‚ˆã‚Šæ‚ªããªã„ã€ã€ã€Œã‚³ãƒ­ãƒ–ã‚¹ã‚’å¥ªã†ã“ã¨ãŒã§ãã‚‹ã€ã€ã€Œç”Ÿæˆã€ãƒœ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ãƒ‘ãƒ¼ãƒˆ1ï¼šä¸è‡ªç„¶ãªç”Ÿæ¯åœ°ã«ãŠã‘ã‚‹RISC-V / RocketChip</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455391/"><img src="https://habrastorage.org/webt/it/on/yz/itonyz90xq9l_bvyih5h20xhuds.png" alt="RocketChipã®æ§‹æˆ" align="left"><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€è¿‘ã€</font><font style="vertical-align: inherit;">ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’ä½¿ã‚ãšã«RISC-Vã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’è©¦ã™æ–¹æ³•ã«ã¤ã„ã¦ã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹ãŒ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Habr </font><font style="vertical-align: inherit;">ã«</font><font style="vertical-align: inherit;">æ²è¼‰ã•ã‚Œã¾ã—</font><font style="vertical-align: inherit;">ãŸã€‚ã—ã‹ã—ã€ãƒ‡ãƒãƒƒã‚°ãƒœãƒ¼ãƒ‰ã§ã“ã‚Œã‚’è¡Œã†ã¨ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿã‚²ãƒ¼ãƒ ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã«é–¢ã™ã‚‹ãƒŸãƒ¼ãƒ ã‚’è¦šãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚ã€Œã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¯å±æ©Ÿã‚ˆã‚Šæ‚ªããªã„ã€ã€ã€Œã‚³ãƒ­ãƒ–ã‚¹ã‚’å¥ªã†ã“ã¨ãŒã§ãã‚‹ã€ã€ã€Œç”Ÿæˆã€ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§20ãƒ†ã‚£ãƒƒã‚¯ã€‚ RocketChip SoCã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã»ã¼åŒã˜ã‚ˆã†ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ä»˜ã„ãŸã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯ãªãã€Scalaã‚³ãƒ¼ãƒ‰ã¨å°‘ã—ã®ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ãƒ¼ãŠã‚ˆã³Makeãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€ã“ã®RocketChipã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ã‚¶ã‚¤ãƒªãƒ³ã‚¯ã‚¹ã‹ã‚‰ã‚¢ãƒ«ãƒ†ãƒ©/ã‚¤ãƒ³ãƒ†ãƒ«ã«ç§»æ¤ã™ã‚‹ã®ãŒã„ã‹ã«ç°¡å˜ã‹ã‚’ç¤ºã—ã¾ã™ã€‚</font></font></p><a name="habracut"></a><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è²¬äº‹é …ï¼š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Œç„¼ã‘ãŸã€ãƒœãƒ¼ãƒ‰</font><strong><font style="vertical-align: inherit;">ã®ä½œæˆ</font></strong><font style="vertical-align: inherit;">è€…ã¯è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚ãƒ”ãƒ³ã®æ§‹æˆæ–¹æ³•ã€ç‰©ç†çš„ãªæ¥ç¶šå†…å®¹ãªã©ã‚’æ³¨æ„æ·±ãè¦³å¯Ÿã—ã¦ãã ã•ã„ã€‚ã•ã¦ã€å®‰å…¨å¯¾ç­–ã«ã‚‚å¾“ã„ã¾ã™ã€‚ã™ã¹ã¦ãŒUSBã§æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã®ã§ã€äººã«ã¨ã£ã¦é–“é•ã„ãªãå®‰å…¨ã ã¨è€ƒãˆã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»¥å‰ã®å®Ÿé¨“ã§ã‚ã‹ã£ãŸã‚ˆã†ã«ã€USBãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã‚‚ã€é›»ä½å·®ãŒã‚ã‚‹ãŸã‚ã€æš–æˆ¿ç”¨ãƒãƒƒãƒ†ãƒªãƒ¼ã«è¶³ã‚’è§¦ã‚Œã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ ã€ç§ã¯ãƒ—ãƒ­ã®ãƒ—ãƒªã‚½ãƒœãƒƒãƒ‰ã‚„é›»å­ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç§ã¯å˜ãªã‚‹Scalaãƒ—ãƒ­ã‚°ãƒ©ãƒã§ã™ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ãŒç†è§£ã—ã¦ã„ã‚‹é™ã‚Šã€RocketChipã‚’ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ãŸã‚ã®æœ€åˆã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ã‚¶ã‚¤ãƒªãƒ³ã‚¯ã‚¹FPGAã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ãŒé–“ã‚‚ãªãã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã‹ã‚‰åˆ¤æ–­ã™ã‚‹ã¨ã€ãã‚Œã¯Microsemiã«ã‚‚ç§»æ¤ã•ã‚Œã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã©ã“ã‹ã§ã‚¢ãƒ«ãƒ†ãƒ©ã®ä½¿ç”¨ã«ã¤ã„ã¦èã„ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ã‚½ãƒ¼ã‚¹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµå±€ã®ã¨ã“ã‚</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã“ã‚Œã¯å¤§ããªå•é¡Œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒœãƒ¼ãƒ‰ã‚’å—ã‘å–ã£ã¦</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">SiFive Freedom</font></a><font style="vertical-align: inherit;">ãƒªãƒã‚¸ãƒˆãƒªã®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">èª¿æŸ»</font></a><font style="vertical-align: inherit;">ã‚’é–‹å§‹ã—ãŸ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">æ™‚ç‚¹</font></a><font style="vertical-align: inherit;">ã‹ã‚‰ã€å‹•ä½œã™ã‚‹ã€Œãƒ¡ãƒ¢ãƒªãƒ¬ã‚¹ã€ï¼ˆã¤ã¾ã‚Šã€ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¬ã‚¸ã‚¹ã‚¿ã€BootROMãŠã‚ˆã³ãƒ¡ãƒ¢ãƒªãƒãƒƒãƒ—ãƒ‰ãƒ¬ã‚¸ã‚¹ã‚¿ã®ã¿ï¼‰32ãƒ“ãƒƒãƒˆã€Œãƒã‚¤ã‚¯ãƒ­ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã€ï¼ˆã“ã‚Œã¯ã™ã§ã«ä½•ã§ã‚ã£ã¦ã‚‚ï¼‰ä½•ã‹</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nanocontrollerãŒ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ¤æ˜...ï¼‰ã‚ªãƒ•3æ—¥ã¨4ã¤ã®å¹³æ—¥ã¯æ¸¡ã•ã‚Œã€ãã‚ŒãŒå³åº§ã«å®šç¾©ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ç§ã®ã¨ã“ã‚ã«æ¥ãŸãªã‚‰ã°ã€ãã‚Œã¯ã•ã‚‰ã«å°‘ãªã„ã‹ã‹ã£ãŸã§ã—ã‚‡ã†</font></font><code>SYNTHESIS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸–ç•Œçš„ã«ã€‚</font></font></p><br>
<h1 id="materialy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ææ–™</font></font></h1><br>
<p>  â€”  <em></em>    .    :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RocketChip</a> â€”       (  ,   ).   RocketChip  Rocket core in-order .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SiFive Freedom</a> â€”      â€”        </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">rocket-tools</a> â€”        32-  64-  RISC-V</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">openocd-riscv</a> â€”  OpenOCD    JTAG  RISC-V  (  , RocketChip)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">IntelliJ IDEA Community</a>   Scala-,   RocketChip </li>
<li>    toolchain  SiFive, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
</ul><br>
<p>   :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  Zeowaa  Aliexpress:   Cyclone 4 EP4CE115  (?) USB Blaster</li>
<li>RaspberryPi   JTAG-  -</li>
</ul><br>
<p>,    â€”     Ubuntu   Quartus Lite 18.</p><br>
<p>-,      Amazon   FPGA-    SiFive,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">FireSim</a>,      , <del>    </del>.   ,        API       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,  ,  ,         ...</p><br>
<h1 id="izuchaem-obstanovku"> </h1><br>
<p>       <code>read_write_1G</code>          .    ?    ,         . ,  -   .        <code>freedom</code> (   <code>freedom-e-sdk</code>).    -,    <code>rocket-tools</code> (      ),   </p><br>
<pre><code class="plaintext hljs">RISCV=$(pwd)/../rocket-tools make -f Makefile.e300artydevkit verilog mcs</code></pre><br>
<p> <code>verilog</code>      Verilog   ,  <code>mcs</code>  BootROM.   ,  <code>mcs</code>   â€”     Xilinx Vivado,   BootROM       Vivado .</p><br>
<p>   Quartus <strong>Project -&gt; Add/Remove Files in Project...</strong>  <code>freedom/builds/e300artydevkit/sifive.freedom.everywhere.e300artydevkit.E300ArtyDevKitConfig.v</code>,  Top-level entity: <strong>E300ArtyDevKitFPGAChip</strong>   General    (,   top-level entity     ).     ,      <code>AsyncResetReg</code>, <code>IOBUF</code>  ..    â€”     Top-level entity.    ,      <code>AsyncResetReg.v</code>,   <code>IOBUF</code> â€”  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  IP core  Xilinx.       <code>freedom/rocket-chip/src/main/resources/vsrc/AsyncResetReg.v</code>.  <code>plusarg_reader.v</code>  .</p><br>
<p>      :</p><br>
<pre><code class="plaintext hljs">Error (10174): Verilog HDL Unsupported Feature error at plusarg_reader.v(18): system function "$value$plusargs" is not supported for synthesis</code></pre><br>
<p> ,           .</p><br>
<div class="spoiler"><b class="spoiler_title">plusarg_reader.v</b><div class="spoiler_text"><pre><code class="plaintext hljs">// See LICENSE.SiFive for license details.<font></font>
<font></font>
//VCS coverage exclude_file<font></font>
<font></font>
// No default parameter values are intended, nor does IEEE 1800-2012 require them (clause A.2.4 param_assignment),<font></font>
// but Incisive demands them. These default values should never be used.<font></font>
module plusarg_reader #(parameter FORMAT="borked=%d", DEFAULT=0) (<font></font>
   output [31:0] out<font></font>
);<font></font>
<font></font>
`ifdef SYNTHESIS<font></font>
assign out = DEFAULT;<font></font>
`else<font></font>
reg [31:0] myplus;<font></font>
assign out = myplus;<font></font>
<font></font>
initial begin<font></font>
   if (!$value$plusargs(FORMAT, myplus)) myplus = DEFAULT;<font></font>
end<font></font>
`endif<font></font>
<font></font>
endmodule</code></pre></div></div><br>
<p>  ,  , ,      ,        .   ,       define   <code>SYNTHESIS</code>.      <code>ifdef</code>     <code>`define SYNTHESIS</code>,    -  ,  ,     (    , ...).    ,      ,    <strong>Compiler settings-&gt;Verilog HDL Input</strong>   <code>SYNTHESIS</code>,     1,   <code>&lt;NONE&gt;</code> ( ).</p><br>
<p>!  Quartus     â€”      Idea   .</p><br>
<h1 id="znakomimsya-s-proektom">  </h1><br>
<p>  Import project,     <code>freedom</code>,    sbt,   use sbt shell for imports, for builds.    ,  ,      - â€”    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>      :</p><br>
<ul>
<li>  sbt shell</li>
<li> <code>clean</code></li>
<li>    Restart</li>
<li>  sbt    <code>++2.12.4</code>,       Scala  2.12.4,   <code>compile</code></li>
<li>   Refresh all sbt projects</li>
<li>PROFIT!,    </li>
</ul><br>
<p>      -  ,      . <strong>, -, , <code>quartus_ipcreate</code>    Lite Edition?</strong> IP Variations    ,      Scala   BlackBox.</p><br>
<p>  ,     :</p><br>
<pre><code class="plaintext hljs">fpga-shells ()<font></font>
   |<font></font>
   +-src/main/scala<font></font>
       |<font></font>
       +- ip/intel        &lt;--     IP Variations<font></font>
       |   |<font></font>
       |   +- Intel.scala<font></font>
       |<font></font>
       +- shell/intel     &lt;--      <font></font>
           |<font></font>
           +- ZeowaaShell.scala<font></font>
<font></font>
src/main/scala<font></font>
   |<font></font>
   +- everywhere.e300artydevkit &lt;--   "" ,   <font></font>
   |<font></font>
   +- zeowaa/e115         &lt;--      "" SoC<font></font>
       |<font></font>
       +- Config<font></font>
       +- FPGAChip<font></font>
       +- Platform<font></font>
       +- System</code></pre><br>
<p>   Makefile    <code>Makefile.e300artydevkit</code>,  :</p><br>
<p><strong>Makefile.zeowaa-e115:</strong></p><br>
<pre><code class="plaintext hljs"># See LICENSE for license details.<font></font>
base_dir := $(patsubst %/,%,$(dir $(abspath $(lastword $(MAKEFILE_LIST)))))<font></font>
BUILD_DIR := $(base_dir)/builds/zeowaa-e115<font></font>
FPGA_DIR := $(base_dir)/fpga-shells/intel<font></font>
MODEL := FPGAChip<font></font>
PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG_PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG := ZeowaaConfig<font></font>
export BOARD := zeowaa<font></font>
export BOOTROM_DIR := $(base_dir)/bootrom/xip<font></font>
<font></font>
rocketchip_dir := $(base_dir)/rocket-chip<font></font>
sifiveblocks_dir := $(base_dir)/sifive-blocks<font></font>
<font></font>
include common.mk</code></pre><br>
<h1 id="bindingi"></h1><br>
<p> ,   <code>IOBUF</code> â€”     .   Scala-,  ,   Â«Â» (?) :     ,   ,     .     Quartus   IP Catalog Â«IOBUFÂ»,        <code>ALTIOBUF</code>.  -    ,  Â«As a bidirectional bufferÂ».           <code>iobuf</code>:</p><br>
<pre><code class="plaintext hljs">// ...<font></font>
module obuf (<font></font>
    datain,<font></font>
    oe,<font></font>
    dataout);<font></font>
<font></font>
    input   [0:0]  datain;<font></font>
    input   [0:0]  oe;<font></font>
    output  [0:0]  dataout;<font></font>
<font></font>
    wire [0:0] sub_wire0;<font></font>
    wire [0:0] dataout = sub_wire0[0:0];<font></font>
<font></font>
    obuf_iobuf_out_d5t  obuf_iobuf_out_d5t_component (<font></font>
                .datain (datain),<font></font>
                .oe (oe),<font></font>
                .dataout (sub_wire0));<font></font>
<font></font>
endmodule<font></font>
// ...</code></pre><br>
<p>   blackbox-:</p><br>
<pre><code class="scala hljs"><span class="hljs-keyword">package</span> ip.intel<font></font>
<font></font>
<span class="hljs-keyword">import</span> chisel3._
<span class="hljs-keyword">import</span> chisel3.core.{<span class="hljs-type">Analog</span>, <span class="hljs-type">BlackBox</span>}
<span class="hljs-keyword">import</span> freechips.rocketchip.jtag.<span class="hljs-type">Tristate</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IOBUF</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BlackBox</span> </span>{
  <span class="hljs-keyword">val</span> io = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">Bundle</span> {
    <span class="hljs-keyword">val</span> datain = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> dataout = <span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>())
    <span class="hljs-keyword">val</span> oe = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())<font></font>
<font></font>
    <span class="hljs-keyword">val</span> dataio = <span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>)<font></font>
  })<font></font>
<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">desiredName</span></span>: <span class="hljs-type">String</span> = <span class="hljs-string">"iobuf"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">IOBUF</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply</span></span>(a: <span class="hljs-type">Analog</span>, t: <span class="hljs-type">Tristate</span>): <span class="hljs-type">IOBUF</span> = {
    <span class="hljs-keyword">val</span> res = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">IOBUF</span>)<font></font>
    res.io.datain := t.data<font></font>
    res.io.oe := t.driven<font></font>
<font></font>
    a &lt;&gt; res.io.dataio<font></font>
<font></font>
    res<font></font>
  }<font></font>
}</code></pre><br>
<p> <code>Analog</code>   <code>inout</code>,   <code>desiredName</code>     .   ,    ,   .</p><br>
<p>   BootROM â€”     <strong>ROM: 1-PORT</strong> (2048 x 32-bit words,   address,   <code>rden</code>).     <code>rom</code>,         ,    <code>ROMGenerator</code>: <code>rden</code>  <code>me</code>     <code>oe</code> (     1):</p><br>
<p><strong>BootROM.v:</strong></p><br>
<pre><code class="plaintext hljs">module BootROM(<font></font>
  input wire [10:0] address,<font></font>
  input wire clock,<font></font>
  input wire me,<font></font>
  input wire oe,<font></font>
  output wire [31:0] q<font></font>
);<font></font>
<font></font>
rom r(<font></font>
  .address(address),<font></font>
  .clock(clock),<font></font>
  .rden(me),<font></font>
  .q(q)<font></font>
);<font></font>
<font></font>
endmodule<font></font>
</code></pre><br>
<p>     : hex-,  , -    Quartus-.      Intel HEX  (Intel         ,   ),    ,     HEX:</p><br>
<pre><code class="plaintext hljs">srec_cat -Output builds/zeowaa-e115/xip.hex -Intel builds/zeowaa-e115/xip.bin -Binary -Output_Block_Size 128</code></pre><br>
<p>  Makefile  :</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">base_dir := $(patsubst %/,%,$(dir $(abspath $(lastword $(MAKEFILE_LIST)))))<font></font>
BUILD_DIR := $(base_dir)/builds/zeowaa-e115<font></font>
FPGA_DIR := $(base_dir)/fpga-shells/intel<font></font>
MODEL := FPGAChip<font></font>
PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG_PROJECT := sifive.freedom.zeowaa.e115<font></font>
export CONFIG := ZeowaaConfig<font></font>
export BOARD := zeowaa<font></font>
export BOOTROM_DIR := $(base_dir)/bootrom/xip<font></font>
<font></font>
rocketchip_dir := $(base_dir)/rocket-chip<font></font>
sifiveblocks_dir := $(base_dir)/sifive-blocks<font></font>
<font></font>
all: verilog<font></font>
    $(MAKE) -C $(BOOTROM_DIR) clean romgen || true<font></font>
    srec_cat -Output $(BUILD_DIR)/xip.hex -Intel $(BUILD_DIR)/xip.bin -Binary -Output_Block_Size 128<font></font>
<font></font>
include common.mk</code></pre></div></div><br>
<h1 id="ono-shevelitsyaw-sinteziruetsya"> ^W </h1><br>
<p>,    ,    â€” .     ,   , , JTAG.       : BootROM,  , GPIO,   ,  JTAG,         .    <code>E300ArtyDevKit</code>       . -,</p><br>
<p><strong>Config.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultZeowaaConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span> (<span class="hljs-params">
  new <span class="hljs-type">WithNBreakpoints</span>(2</span>)        <span class="hljs-title">++</span></span>
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithNExtTopInterrupts</span>(<span class="hljs-number">0</span>)   ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">WithJtagDTM</span>                ++
    <span class="hljs-keyword">new</span> <span class="hljs-type">TinyConfig</span><font></font>
)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Peripherals</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span>(<span class="hljs-params">(site, here, up</span>) <span class="hljs-title">=&gt;</span> </span>{
  <span class="hljs-keyword">case</span> <span class="hljs-type">PeripheryGPIOKey</span> =&gt; <span class="hljs-type">List</span>(
    <span class="hljs-type">GPIOParams</span>(address = <span class="hljs-type">BigInt</span>(<span class="hljs-number">0x64002000</span>L), width = <span class="hljs-number">6</span>)<font></font>
  )<font></font>
  <span class="hljs-keyword">case</span> <span class="hljs-type">PeripheryMaskROMKey</span> =&gt; <span class="hljs-type">List</span>(
    <span class="hljs-type">MaskROMParams</span>(address = <span class="hljs-number">0x10000</span>, name = <span class="hljs-string">"BootROM"</span>))<font></font>
})<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZeowaaConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Config</span>(<span class="hljs-params">
  new <span class="hljs-type">Peripherals</span>    ++
    new <span class="hljs-type">DefaultZeowaaConfig</span>(</span>).<span class="hljs-title">alter</span>(<span class="hljs-params">(site, here, up</span>) <span class="hljs-title">=&gt;</span> </span>{
      <span class="hljs-keyword">case</span> <span class="hljs-type">JtagDTMKey</span> =&gt; <span class="hljs-keyword">new</span> <span class="hljs-type">JtagDTMConfig</span> (<font></font>
        idcodeVersion = <span class="hljs-number">2</span>,<font></font>
        idcodePartNum = <span class="hljs-number">0xe31</span>,<font></font>
        idcodeManufId = <span class="hljs-number">0x489</span>,<font></font>
        debugIdleCycles = <span class="hljs-number">5</span>)<font></font>
    })<font></font>
)</code></pre><br>
<p>        E300:               .  ,         (     <code>TinyConfig</code>),    ,  32-!</p><br>
<p>  ,      boilerplate.<br>
<strong>System.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">System</span>(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">RocketSubsystem</span></span>
  <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryMaskROMSlave</span>
  <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryDebug</span>
  <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryGPIO</span><font></font>
{<font></font>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">val</span> module = <span class="hljs-keyword">new</span> <span class="hljs-type">SystemModule</span>(<span class="hljs-keyword">this</span>)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SystemModule</span>[+<span class="hljs-type">L</span> &lt;: <span class="hljs-type">System</span>](<span class="hljs-params">_outer: <span class="hljs-type">L</span></span>)</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-type">RocketSubsystemModuleImp</span>(_outer)
    <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryDebugModuleImp</span>
    <span class="hljs-keyword">with</span> <span class="hljs-type">HasPeripheryGPIOModuleImp</span><font></font>
{<font></font>
  <span class="hljs-comment">// Reset vector is set to the location of the mask rom</span>
  <span class="hljs-keyword">val</span> maskROMParams = p(<span class="hljs-type">PeripheryMaskROMKey</span>)<font></font>
  global_reset_vector := maskROMParams(<span class="hljs-number">0</span>).address.<span class="hljs-type">U</span>
}</code></pre><br>
<p>,   Â« Â»    ( )  :<br>
<strong>Platform.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlatformIO</span>(<span class="hljs-params">implicit val p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> </span>{
  <span class="hljs-keyword">val</span> jtag = <span class="hljs-type">Flipped</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">JTAGIO</span>(hasTRSTn = <span class="hljs-literal">false</span>))
  <span class="hljs-keyword">val</span> jtag_reset = <span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>())
  <span class="hljs-keyword">val</span> gpio = <span class="hljs-keyword">new</span> <span class="hljs-type">GPIOPins</span>(() =&gt; <span class="hljs-keyword">new</span> <span class="hljs-type">BasePin</span>(), p(<span class="hljs-type">PeripheryGPIOKey</span>)(<span class="hljs-number">0</span>))<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Platform</span>(<span class="hljs-params">implicit p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Module</span> </span>{
  <span class="hljs-keyword">val</span> sys = <span class="hljs-type">Module</span>(<span class="hljs-type">LazyModule</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">System</span>).module)
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> io = <span class="hljs-type">IO</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">PlatformIO</span>)<font></font>
<font></font>
  <span class="hljs-keyword">val</span> sjtag = sys.debug.systemjtag.get<font></font>
  sjtag.reset := io.jtag_reset<font></font>
  sjtag.mfr_id := p(<span class="hljs-type">JtagDTMKey</span>).idcodeManufId.<span class="hljs-type">U</span>(<span class="hljs-number">11.</span><span class="hljs-type">W</span>)<font></font>
  sjtag.jtag &lt;&gt; io.jtag<font></font>
  io.gpio &lt;&gt; sys.gpio.head<font></font>
}</code></pre><br>
<p><strong>FPGAChip.scala:</strong></p><br>
<pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FPGAChip</span>(<span class="hljs-params">override implicit val p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">ZeowaaShell</span> </span>{<font></font>
  withClockAndReset(cpu_clock, cpu_rst) {<font></font>
    <span class="hljs-keyword">val</span> dut = <span class="hljs-type">Module</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">Platform</span>)<font></font>
<font></font>
    dut.io.jtag.<span class="hljs-type">TCK</span> := jtag_tck<font></font>
    dut.io.jtag.<span class="hljs-type">TDI</span> := jtag_tdi
    <span class="hljs-type">IOBUF</span>(jtag_tdo, dut.io.jtag.<span class="hljs-type">TDO</span>)<font></font>
    dut.io.jtag.<span class="hljs-type">TMS</span> := jtag_tms<font></font>
    dut.io.jtag_reset := jtag_rst<font></font>
<font></font>
    <span class="hljs-type">Seq</span>(led_0, led_1, led_2, led_3) zip dut.io.gpio.pins foreach {
      <span class="hljs-keyword">case</span> (led, pin) =&gt;<font></font>
        led := <span class="hljs-type">Mux</span>(pin.o.oe, pin.o.oval, <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>)<font></font>
    }<font></font>
<font></font>
    dut.io.gpio.pins.foreach(_.i.ival := <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>)<font></font>
    dut.io.gpio.pins(<span class="hljs-number">4</span>).i.ival := key1<font></font>
    dut.io.gpio.pins(<span class="hljs-number">5</span>).i.ival := key2<font></font>
  }<font></font>
}</code></pre><br>
<p> ,  Chisel       (    ).       :</p><br>
<div class="spoiler"><b class="spoiler_title">ZeowaaShell.scala</b><div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZeowaaShell</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemIf</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bundle</span> </span>{
    <span class="hljs-keyword">val</span> mem_addr = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">14.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_ba = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">3.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_cas_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_cke = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_clk = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_clk_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_cs_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_dm = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">8.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_dq = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">64.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_dqs = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">8.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_odt = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">2.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_ras_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
    <span class="hljs-keyword">val</span> mem_we_n = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZeowaaShell</span>(<span class="hljs-params">implicit val p: <span class="hljs-type">Parameters</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">RawModule</span> </span>{
  <span class="hljs-keyword">val</span> clk25 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))
  <span class="hljs-keyword">val</span> clk27 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))
  <span class="hljs-keyword">val</span> clk48 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> key1 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> key2 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> key3 = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> led_0 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> led_1 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> led_2 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> led_3 = <span class="hljs-type">IO</span>(<span class="hljs-type">Output</span>(<span class="hljs-type">Bool</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> jtag_tdi = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> jtag_tdo = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))
  <span class="hljs-keyword">val</span> jtag_tck = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Clock</span>()))
  <span class="hljs-keyword">val</span> jtag_tms = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))<font></font>
<font></font>
  <span class="hljs-keyword">val</span> uart_rx = <span class="hljs-type">IO</span>(<span class="hljs-type">Input</span>(<span class="hljs-type">Bool</span>()))
  <span class="hljs-keyword">val</span> uart_tx = <span class="hljs-type">IO</span>(<span class="hljs-type">Analog</span>(<span class="hljs-number">1.</span><span class="hljs-type">W</span>))<font></font>
<font></font>
  <span class="hljs-comment">// Internal wiring</span><font></font>
<font></font>
  <span class="hljs-keyword">val</span> cpu_clock = <span class="hljs-type">Wire</span>(<span class="hljs-type">Clock</span>())
  <span class="hljs-keyword">val</span> cpu_rst = <span class="hljs-type">Wire</span>(<span class="hljs-type">Bool</span>())
  <span class="hljs-keyword">val</span> jtag_rst = <span class="hljs-type">Wire</span>(<span class="hljs-type">Bool</span>())<font></font>
<font></font>
  withClockAndReset(cpu_clock, <span class="hljs-literal">false</span>.<span class="hljs-type">B</span>) {
    <span class="hljs-keyword">val</span> counter = <span class="hljs-type">Reg</span>(<span class="hljs-type">UInt</span>(<span class="hljs-number">64.</span><span class="hljs-type">W</span>))<font></font>
    counter := counter + <span class="hljs-number">1.</span><span class="hljs-type">U</span>
    cpu_rst := (counter &gt; <span class="hljs-number">1000.</span><span class="hljs-type">U</span>) &amp;&amp; (counter &lt; <span class="hljs-number">2000.</span><span class="hljs-type">U</span>)<font></font>
    jtag_rst := (counter &gt; <span class="hljs-number">3000.</span><span class="hljs-type">U</span>) &amp;&amp; (counter &lt; <span class="hljs-number">4000.</span><span class="hljs-type">U</span>)<font></font>
  }<font></font>
<font></font>
  cpu_clock &lt;&gt; clk25<font></font>
}</code></pre></div></div><br>
<p>     ? , -,      :)   <code>Shell</code>  <code>FPGAChip</code>, ,   ,  Shell â€”      :         (       !),  <code>FPGAChip</code>  ,     SoC  .   Platform   :  : <code>ZeowaaShell</code> ( ,  <code>Platform</code>) â€”  <code>RawModule</code>,  ,     <code>clock</code>  <code>reset</code> â€”    Â« Â»,     (, ,       ).   Platform â€”     ,        ..</p><br>
<h1 id="jtag">JTAG</h1><br>
<p>   ,   JTAG.      RaspberryPi 3 Model B+,     -    GPIO.  , <em>    </em>:   OpenOCD    <code>interface/sysfsgpio-raspberrypi.cfg</code>,          (TCK = 11, TMS = 25, TDI = 10, TDO = 9,  GND    ) â€”  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p>,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Freedom.cfg</a>   <code>riscv-tests</code>,   :</p><br>
<pre><code class="plaintext hljs">adapter_khz     10000<font></font>
source [find interface/sysfsgpio-raspberrypi.cfg]<font></font>
set _CHIPNAME riscv<font></font>
<font></font>
jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x20e31913<font></font>
<font></font>
set _TARGETNAME $_CHIPNAME.cpu<font></font>
target create $_TARGETNAME riscv -chain-position $_TARGETNAME -rtos riscv<font></font>
<font></font>
init<font></font>
halt<font></font>
echo "Ready for Remote Connections"</code></pre><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">riscv-openocd</a>,   ARM,  <del>  </del>     SiFive     :</p><br>
<pre><code class="plaintext hljs">./configure --enable-remote-bitbang --enable-sysfsgpio</code></pre><br>
<p>  ,   remote bitbang,      ARM    ...</p><br>
<p>      </p><br>
<pre><code class="plaintext hljs">root@ubuntu:~/riscv-openocd# ./src/openocd -s tcl -f ../riscv.tcl<font></font>
Open On-Chip Debugger 0.10.0+dev-00614-g998fed1fe-dirty (2019-06-03-10:27)<font></font>
Licensed under GNU GPL v2<font></font>
For bug reports, read<font></font>
        http://openocd.org/doc/doxygen/bugs.html<font></font>
adapter speed: 10000 kHz<font></font>
SysfsGPIO nums: tck = 11, tms = 25, tdi = 10, tdo = 9<font></font>
SysfsGPIO nums: swclk = 11, swdio = 25<font></font>
Info : auto-selecting first available session transport "jtag". To override use 'transport select &lt;transport&gt;'.<font></font>
Info : SysfsGPIO JTAG/SWD bitbang driver<font></font>
Info : JTAG and SWD modes enabled<font></font>
Warn : gpio 11 is already exported<font></font>
Warn : gpio 25 is already exported<font></font>
Info : This adapter doesn't support configurable speed<font></font>
Info : JTAG tap: riscv.cpu tap/device found: 0x20e31913 (mfg: 0x489 (SiFive, Inc.), part: 0x0e31, ver: 0x2)<font></font>
Info : datacount=1 progbufsize=16<font></font>
Info : Disabling abstract command reads from CSRs.<font></font>
Info : Examined RISC-V core; found 1 harts<font></font>
Info :  hart 0: XLEN=32, misa=0x40001105<font></font>
Info : Listening on port 3333 for gdb connections<font></font>
Ready for Remote Connections<font></font>
Info : Listening on port 6666 for tcl connections<font></font>
Info : Listening on port 4444 for telnet connections</code></pre><br>
<p>    SSH    3333,   IP:</p><br>
<pre><code class="plaintext hljs">ssh -L 3333:127.0.0.1:3333 ubuntu@192.168.1.104</code></pre><br>
<p>     GDB <strong>  riscv32</strong>:</p><br>
<pre><code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-gdb -q<font></font>
(gdb) target remote :3333<font></font>
Remote debugging using :3333<font></font>
warning: No executable has been specified and target does not support<font></font>
determining executable automatically.  Try using the "file" command.<font></font>
0x00000000 in ?? ()</code></pre><br>
<p>    ,  JTAG   ,   <code>SYNTHESIS</code>      ,      Â«JTAG ,    Â».</p><br>
<h1 id="pervyy-kod"> </h1><br>
<p>     Makefile,   bootrom    <code>bootrom/xip/xip.S</code>.    :</p><br>
<pre><code class="plaintext hljs">// See LICENSE for license details.<font></font>
// Execute in place<font></font>
// Jump directly to XIP_TARGET_ADDR<font></font>
<font></font>
  .section .text.init<font></font>
  .option norvc<font></font>
  .globl _start<font></font>
_start:<font></font>
  csrr a0, mhartid<font></font>
  la a1, dtb<font></font>
  li t0, XIP_TARGET_ADDR<font></font>
  jr t0<font></font>
<font></font>
  .section .rodata<font></font>
dtb:<font></font>
  .incbin DEVICE_TREE</code></pre><br>
<p>,     device tree ( dtb-),    ,       .        :</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">  .section .text.init<font></font>
  .option norvc<font></font>
  .globl _start<font></font>
_start:<font></font>
  li a5, 0x64002000<font></font>
  li a1, 0x0F<font></font>
  li a2, 0x01<font></font>
  li a3, 0x30<font></font>
<font></font>
  li a6, 0x10<font></font>
  li a7, 0x20<font></font>
<font></font>
  sw zero, 0x38(a5) // iof_en<font></font>
  sw a1,   0x08(a5) // output_en<font></font>
  sw a2,   0x00(a5) // value<font></font>
  sw a1,   0x14(a5) // drive<font></font>
<font></font>
  sw a3,   0x04(a5) // input_en<font></font>
<font></font>
// a0 &lt;- timer<font></font>
// a1 &lt;- 0x0F<font></font>
// a2 &lt;- [state]<font></font>
// a3 &lt;- 0x30<font></font>
// a4 &lt;- [buttons]<font></font>
// a5 &lt;- [gpio addr]<font></font>
// a6 &lt;- 0x10<font></font>
// a7 &lt;- 0x20<font></font>
<font></font>
loop:<font></font>
  li a4, 0x1000<font></font>
  add a0, a0, a4<font></font>
  bgtu a0, zero, loop<font></font>
<font></font>
  lw a4,   0x00(a5) // value<font></font>
  beq a4, a6, plus<font></font>
  beq a4, a7, minus<font></font>
  j store<font></font>
plus:<font></font>
  srai a2, a2, 1<font></font>
  beq a2, zero, pzero<font></font>
  j store<font></font>
pzero:<font></font>
  li a2, 0x08<font></font>
  j store<font></font>
minus:<font></font>
  slli a2, a2, 1<font></font>
  beq a2, a6, mzero<font></font>
  j store<font></font>
mzero:<font></font>
  li a2, 0x01<font></font>
store:<font></font>
  sw a2,  0x0c(a5) // value<font></font>
  j loop</code></pre></div></div><br>
<p>   ,        .   ,  RISC-V ,  ,   Â«     , , Â».         ,     ATTiny  . Â«    , Â» â€”  ,  , ,  <em>   </em>:  <del></del> ,    ,      .         Â«Â»       ,   .</p><br>
<p>â€¦  :   ,    .   JTAG: program counter = 0x00000000 â€” -  .    <code>0x64002000</code>     GPIO:</p><br>
<div class="spoiler"><b class="spoiler_title">GPIOCtrlRegs.scala</b><div class="spoiler_text"><pre><code class="scala hljs"><span class="hljs-comment">// See LICENSE for license details.</span>
<span class="hljs-keyword">package</span> sifive.blocks.devices.gpio<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">GPIOCtrlRegs</span> </span>{
  <span class="hljs-keyword">val</span> value       = <span class="hljs-number">0x00</span>
  <span class="hljs-keyword">val</span> input_en    = <span class="hljs-number">0x04</span>
  <span class="hljs-keyword">val</span> output_en   = <span class="hljs-number">0x08</span>
  <span class="hljs-keyword">val</span> port        = <span class="hljs-number">0x0c</span>
  <span class="hljs-keyword">val</span> pullup_en   = <span class="hljs-number">0x10</span>
  <span class="hljs-keyword">val</span> drive       = <span class="hljs-number">0x14</span>
  <span class="hljs-keyword">val</span> rise_ie     = <span class="hljs-number">0x18</span>
  <span class="hljs-keyword">val</span> rise_ip     = <span class="hljs-number">0x1c</span>
  <span class="hljs-keyword">val</span> fall_ie     = <span class="hljs-number">0x20</span>
  <span class="hljs-keyword">val</span> fall_ip     = <span class="hljs-number">0x24</span>
  <span class="hljs-keyword">val</span> high_ie     = <span class="hljs-number">0x28</span>
  <span class="hljs-keyword">val</span> high_ip     = <span class="hljs-number">0x2c</span>
  <span class="hljs-keyword">val</span> low_ie      = <span class="hljs-number">0x30</span>
  <span class="hljs-keyword">val</span> low_ip      = <span class="hljs-number">0x34</span>
  <span class="hljs-keyword">val</span> iof_en      = <span class="hljs-number">0x38</span>
  <span class="hljs-keyword">val</span> iof_sel     = <span class="hljs-number">0x3c</span>
  <span class="hljs-keyword">val</span> out_xor     = <span class="hljs-number">0x40</span>
}</code></pre></div></div><br>
<p>   :</p><br>
<pre><code class="plaintext hljs">(gdb) set variable *0x64002038=0<font></font>
(gdb) set variable *0x64002008=0xF<font></font>
(gdb) set variable *0x64002000=0x1<font></font>
(gdb) set variable *0x64002014=0xF<font></font>
(gdb) set variable *0x6400200c=0x1</code></pre><br>
<p>â€¦    â€¦    <code>0x1</code>,  <code>0x5</code>â€¦ ,     .   ,    ,    0x00    â€”   .</p><br>
<pre><code class="plaintext hljs">(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000030<font></font>
//   <font></font>
(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000020<font></font>
//  <font></font>
(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000010<font></font>
//  <font></font>
(gdb) x/x 0x64002000<font></font>
0x64002000:     0x00000000</code></pre><br>
<p>, memory-mapped     ,    cont + Ctrl-C   â€” ,  .</p><br>
<p>      ,    <code>$pc=0x0000000</code>?</p><br>
<pre><code class="plaintext hljs">(gdb) x/10i 0x10000<font></font>
   0x10000:     addi    s1,sp,12<font></font>
   0x10002:     fsd     ft0,-242(ra)<font></font>
   0x10006:     srli    a4,a4,0x21<font></font>
   0x10008:     addi    s0,sp,32<font></font>
   0x1000a:     slli    t1,t1,0x21<font></font>
   0x1000c:     lb      zero,-1744(a2)<font></font>
   0x10010:     nop<font></font>
   0x10012:     addi    a0,sp,416<font></font>
   0x10014:     c.slli  zero,0x0<font></font>
   0x10016:     0x9308</code></pre><br>
<p>   ???     ,  !  :</p><br>
<pre><code class="plaintext hljs">(gdb) x/10x 0x10000<font></font>
0x10000:        0xb7270064      0x9305f000      0x13061000      0x93060003<font></font>
0x10010:        0x13080001      0x93080002      0x23ac0702      0x23a4b700<font></font>
0x10020:        0x23a0c700      0x23aab700</code></pre><br>
<p>  ,      ?</p><br>
<pre><code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-objdump -d builds/zeowaa-e115/xip.elf<font></font>
<font></font>
builds/zeowaa-e115/xip.elf:       elf32-littleriscv<font></font>
<font></font>
  .text:<font></font>
<font></font>
00010054 &lt;_start&gt;:<font></font>
   10054:       640027b7                lui     a5,0x64002<font></font>
   10058:       00f00593                li      a1,15<font></font>
   1005c:       00100613                li      a2,1<font></font>
   10060:       03000693                li      a3,48<font></font>
   10064:       01000813                li      a6,16<font></font>
   10068:       02000893                li      a7,32<font></font>
   1006c:       0207ac23                sw      zero,56(a5) # 64002038 &lt;__global_pointer$+0x63ff0770&gt;<font></font>
   10070:       00b7a423                sw      a1,8(a5)<font></font>
   10074:       00c7a023                sw      a2,0(a5)<font></font>
   10078:       00b7aa23                sw      a1,20(a5)<font></font>
   1007c:       00d7a223                sw      a3,4(a5)<font></font>
...</code></pre><br>
<p> , Quartus     ,     ,    endianness.   ,   ,  <em>  </em>,  â€”  ,   </p><br>
<div class="spoiler"><b class="spoiler_title">BootROM.v</b><div class="spoiler_text"><pre><code class="plaintext hljs">module BootROM(<font></font>
  input wire [10:0] address,<font></font>
  input wire clock,<font></font>
  input wire me,<font></font>
  input wire oe,<font></font>
  output wire [31:0] q<font></font>
);<font></font>
<font></font>
wire [31:0] q_r;<font></font>
<font></font>
rom r(<font></font>
  .address(address),<font></font>
  .clock(clock),<font></font>
  .rden(me),<font></font>
  .q(q_r)<font></font>
);<font></font>
<font></font>
assign q[31:24] = q_r[7:0];<font></font>
assign q[23:16] = q_r[15:8];<font></font>
assign q[15:8] = q_r[23:16];<font></font>
assign q[7:0] = q_r[31:24];<font></font>
<font></font>
endmodule</code></pre></div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œã§ã€ç§ãŸã¡ã¯åé›†ã—ã€å§‹ã‚ã¾ã™ã€ãã‚Œã¯è¼ãã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã¯JTAGã‚’ä»‹ã—ã¦æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™ï¼š</font></font><code>$pc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µã‚¤ã‚¯ãƒ«å†…ã®ã©ã“ã‹ã‚’æ­£ç›´ã«ç¤ºã—ã¦ã„ã¾ã™ã€é›»çƒã®ç‡ƒç„¼ã®ãƒã‚¹ã‚¯= 4ã€ãã†ã§ã™ã€è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Š</font><font style="vertical-align: inherit;">ã¾ã™</font></font><code>output_en</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šï¼ˆ</font><font style="vertical-align: inherit;">ç¶šã‘ã‚‹ï¼‰-ã™ã¹ã¦ãŒæ©Ÿèƒ½ã—ã¾ã™ï¼</font><font style="vertical-align: inherit;">ã‚ã‚ã€ã‚‚ã†å‡ºã—ã¦ã—ã¾ã£ãŸã€‚</font><font style="vertical-align: inherit;">ãªã‚“ã‚‰ã‹ã®ç†ç”±ã§ã€ãƒ¬ã‚¸ã‚¹ã‚¿ã¸ã®æ›¸ãè¾¼ã¿é †åºã‚’ã©ã®ã‚ˆã†ã«ä¸¦ã¹æ›¿ãˆã¦ã‚‚æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€ã¾ãšã€å˜ç´”ãªæ¾è‘‰æ–ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦</font><font style="vertical-align: inherit;">ã€å®Ÿéš›ã®å€¤ã‚’è¨­å®šã™ã‚‹å‰ã«è¨­å®šã‚’</font><font style="vertical-align: inherit;">è»¢é€ã—</font><font style="vertical-align: inherit;">ã¾ã™ã€‚</font></font><code>set variable *0x64002008=0xF</code><font style="vertical-align: inherit;"></font><code>c</code><font style="vertical-align: inherit;"></font><code>output_en</code><font style="vertical-align: inherit;"></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¾åœ¨ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®åˆè¨ˆï¼š</font></font></p><br>
<pre><code class="plaintext hljs">Total logic elements   17,370 / 114,480 ( 15 % )<font></font>
Total registers        8357<font></font>
Total pins             16 / 281 ( 6 % )<font></font>
Total virtual pins     0<font></font>
Total memory bits      264,000 / 3,981,312 ( 7 % )<font></font>
Embedded Multiplier    9-bit elements 4 / 532 ( &lt; 1 % )</code></pre><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒã‚¼ãƒ«ã«é–¢ã™ã‚‹æƒ…å ±æº</font></font></a></p><br>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¤ã¥ã...</font></font></em></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja455377/index.html">IoTã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</a></li>
<li><a href="../ja455379/index.html">ï¼ˆé™çš„ï¼‰C ++ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã®æœ€é©ãªã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®é¸æŠ</a></li>
<li><a href="../ja455381/index.html">3CXãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚µãƒãƒ¼ãƒˆã®å¿œç­”ï¼šPBXã‚µãƒ¼ãƒãƒ¼ã§ã®SIPãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ã‚­ãƒ£ãƒ—ãƒãƒ£</a></li>
<li><a href="../ja455387/index.html">Elastic Stackã§ã®æ©Ÿæ¢°å­¦ç¿’ã®ç†è§£ï¼ˆElasticsearchã€åˆ¥åELKï¼‰</a></li>
<li><a href="../ja455389/index.html">Haxe 4ï¼šæ–°æ©Ÿèƒ½</a></li>
<li><a href="../ja455393/index.html">ãƒ¬ãƒ¼ãƒ€ãƒ¼ã«ãŠã‘ã‚‹ã‚¹ãƒšã‚¯ãƒˆãƒ«æ¨å®šã®ãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯æ³•ã®ä½¿ç”¨ã«ã¤ã„ã¦-MUSICæ³•ã€‚è¨˜äº‹ã¸ã®è¿½åŠ </a></li>
<li><a href="../ja455397/index.html">Huaweiã®ãƒ¢ã‚¹ã‚¯ãƒ¯ã‚ªãƒ•ã‚£ã‚¹ã§ã®æ–°ã—ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨­è¨ˆã¨å®Ÿè£…æ–¹æ³•ã€ãƒ‘ãƒ¼ãƒˆ1</a></li>
<li><a href="../ja455401/index.html">ç°¡å˜ãªä¾‹ã«ãŠã‘ã‚‹Cisco IOSã®Tcl</a></li>
<li><a href="../ja455403/index.html">5ã‚»ãƒ³ãƒˆã‹ã‚‰ç¥ã®ã‚²ãƒ¼ãƒ ã¾ã§</a></li>
<li><a href="../ja455405/index.html">å°ã•ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå°ã•ãªã‚ªãƒ•ã‚£ã‚¹ã‚’ã©ã®ã‚ˆã†ã«ã—ã¦1ã‹æœˆã‚ãŸã‚Š1å„„ãƒ«ãƒ¼ãƒ–ãƒ«ä»¥ä¸Šã®åˆ©ç›Šã‚’ã‚‚ãŸã‚‰ã™é€£é‚¦ä¼æ¥­ã«å¤‰ãˆãŸã®ã‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>