<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòø üëâüèΩ üë©üèæ‚Äçüé§ 60% reduction in React Native application size in a few simple steps üè§ üë©üèº‚Äçüé§ ü§õüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work at Mutual . She works in Brazil, in the field of equal credit. We help borrowers and lenders to connect with each other. The former seek good b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>60% reduction in React Native application size in a few simple steps</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/502422/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I work at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mutual</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">She works in Brazil, in the field of equal credit. </font><font style="vertical-align: inherit;">We help borrowers and lenders to connect with each other. </font><font style="vertical-align: inherit;">The former seek good bets, while the latter seek income that exceeds what the market can offer them. </font><font style="vertical-align: inherit;">Our product is used by a wide range of users, we work in a large country. </font><font style="vertical-align: inherit;">As a result, our React Native-based iOS and Android apps download to very different devices.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/59/3g/lf/593glf1nnlud4u0pbaogbghegiy.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It should be noted that the bulk of our users install applications on budget devices. </font><font style="vertical-align: inherit;">We can draw such conclusions using the data from the Facebook </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">device-year-class</font></a><font style="vertical-align: inherit;"> library.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This library, having received information about the model of the device, reports on in which year this device would be considered an upscale flagship phone. </font><font style="vertical-align: inherit;">For example, the most popular phone among our users is the Samsung Galaxy A10. </font><font style="vertical-align: inherit;">This phone, although it was released in 2019, could be considered the flagship only in 2013. Analyzing data on user devices, we can say that 85% of these devices could be recognized as high-end devices only in 2015 or earlier. </font><font style="vertical-align: inherit;">Because of this, we have special requirements for optimizing our mobile application. </font><font style="vertical-align: inherit;">The goal of optimization is so that even users with weak devices can comfortably use our application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/e6b/cf3/1e2e6bcf354e0ed85e47f70b1570dbba.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Percentage of devices that could be recognized as flagship in a particular year</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this regard, we paid close attention to the size of the application. In the case of its Android version, it was 26.8 MB. Although this is not such a big size, it is definitely more than the median size of our users ‚Äôapplications. This figure, according to the Google Play Console, is 16.3 MB. The size of the application can be a decisive factor for users with limited tariff plans, or for those with low memory devices, which forces users to carefully select the applications that they will have installed. As a result, some applications have to be uninstalled. This is especially important in the case of the Mutual application, as borrowers pay monthly installments through this application. When the borrower uninstalls our application, the chances that he will make the payment on time are greatly reduced.And this directly affects the earnings of investors using our platform.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/cea/78e/72ccea78ee7c05e86b626c0cf6ea45ef.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The size of the Mutual application is much larger than the median size of our users'</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
applications. The size of the application does not only affect the level of uninstallations. Size also affects the conversion rate of application settings.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here's a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> good article on this written by the Google Play team. This article discusses the importance of application size. In particular, it says that every additional 6 MB of the size of the APK file reduces the conversion rate of installations by 1%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They also talk about the fact that in developing countries where budget devices are the norm, this effect is even stronger. Namely, reducing the size of the APK file by 10 MB in emerging markets corresponds to an increase in the conversion rate of installations by about 2.5%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/624/15d/1c162415de7e88ff4c5ed89853b6483b.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Increasing the conversion rate of installations for every 10 Mb of reducing the size of the APK file in different countries (according to Google internal data)</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We were very motivated by how reducing the size of the application can affect the level of uninstallations and the conversion rate of application settings. </font><font style="vertical-align: inherit;">As a result, we set to work aimed at reducing the size of the application as much as possible, taking into account its convenience for users. </font><font style="vertical-align: inherit;">The first step in this project was to analyze the official</font><font style="vertical-align: inherit;">Google</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recommendations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for Android developers.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reading the recommendations, we learned that the easiest way to reduce the size of an application is to use a new application distribution method called the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android App Bundle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (AAB). Until this moment, we distributed the application, collecting the good old </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APK) </font><font style="vertical-align: inherit;">file </font><font style="vertical-align: inherit;">, which can be run on most Android devices, and uploading it to the Google Play Console. But the AAB bundle contains only compiled code and resources. As a result, when it is downloaded, Google is responsible for generating optimized APK files for various types of devices, taking into account their specifications and CPU architecture.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that by making a simple change to the build process of the project, can we get a serious reduction in the size of the application without making any more effort? This is too good for the truth! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we read the documentation, we just changed the React Native Gradle build script so that it </font></font><code>assembleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">would run </font><font style="vertical-align: inherit;">instead of the current </font><font style="vertical-align: inherit;">one </font></font><code>bundleRelease</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. That's all we needed to create the AAB file. After some more modifications made to the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">Fastlane</font></a></font><code>supply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configuration </font><font style="vertical-align: inherit;">regarding automatic uploading of materials directly to the Play Store, we switched to AAB, and a new version of our application appeared in the Google Play Console.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This change alone has led to a reduction in the size of APK files transferred to user devices. The decrease ranged from 9.1 to 12.4 Mb. As it turned out, the use of the Android App Bundle is an effective technique that, indeed, allows you to reduce the size of the application.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/feb/57b/9e5feb57bf54450425a6dc54da48f613.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The old APK-file and the new AAB-bundle, the use of which leads to the fact that the size of the application on different devices can be from 14.4 to 17.7 MB</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
True, you should be careful here. </font><font style="vertical-align: inherit;">If you use React Native with</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hermes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , then you may need to update your dependency</font></font><code>soloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(see details</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Otherwise, there is a risk of giving the user an application that will contain a critical error. </font><font style="vertical-align: inherit;">We were lucky, we were able to identify this problem during testing of the alpha release of the project. </font><font style="vertical-align: inherit;">But the error could easily slip into production, since it does not appear during local testing or when building the APK file.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimizing application resources using Android Size Analyzer</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next suggestion for optimizing applications that we found in the documentation was the use of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Size Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is a command line tool that analyzes Android applications and looks for ways to reduce their size. </font><font style="vertical-align: inherit;">We launched this tool using a command of the following form:</font></font><br>
<br>
<pre><code class="javascript hljs">size-analyzer check-bundle [BUNDLE].aab
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, we got a list of great application resources and images that we can optimize. </font><font style="vertical-align: inherit;">We were also recommended to set up ProGuard.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/a26/0b0/ed0a260b0a19878cf664c53ec54c9026.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Size-analyzer report</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçProGuard</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ProGuard is a tool for compressing, obfuscating, and optimizing Java bytecode. </font><font style="vertical-align: inherit;">We have not yet explored the possibility of using this tool, as we learned that it may not be compatible with some Android libraries. </font><font style="vertical-align: inherit;">Since we strove to reduce the size of our application as quickly as possible, and to make this as simple as possible, we decided to leave this optimization method in the future.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçLarge app resources</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Running it </font></font><code>size-analyzer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">again, with the key </font></font><code>-d</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we got a list of application resources, sorted by their size. </font><font style="vertical-align: inherit;">Since this tool does not know anything about exactly how users work with the application, it gave us the opportunity to independently decide which resources should be removed and which should be loaded into the application dynamically.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d84/262/900d84262161b1440fe03e0d8b0d4fab.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of large application resources sorted by size</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The first and largest resource on this list was the React Native JavaScript bundle. </font><font style="vertical-align: inherit;">Now we cannot split this bundle and load it dynamically. </font><font style="vertical-align: inherit;">But later we will think about it. </font><font style="vertical-align: inherit;">Further down the list are large font files (TTF) and image files (JPG and PNG).</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçUnnecessary images</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our attention was immediately drawn to the huge JPG images used in the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storybook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We use this system to develop and test components. </font><font style="vertical-align: inherit;">This is 2 MB of garbage that fell into the production version of the project. </font><font style="vertical-align: inherit;">Shameful mistake! </font><font style="vertical-align: inherit;">When something like this happens, we feel like we have done some serious stupidity. </font><font style="vertical-align: inherit;">But in the complex world of software development, everyone makes mistakes. </font><font style="vertical-align: inherit;">I believe that if you talk about your mistakes publicly, it will help other developers learn from these mistakes. </font><font style="vertical-align: inherit;">There is a possibility that you make the same mistakes if you do not analyze the resource structure of the application, the size of which is gradually increasing.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Fonts</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we quickly got rid of unnecessary images, we proceeded to analyze other elements of the resource list. It was clear that there were a lot of built-in fonts in it. After we talked about this with our designers, they told us that many old components do not differ in strict adherence to typographic manuals. Therefore, we found out which components can be removed, and in which you can use the appropriate updated fonts. Thanks to this, we were able to reduce the number of fonts used from six to four.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another thing we noticed was the sheer size of the font files themselves. The size of each of them was approximately 670 Kb. This meant that four fonts in the uncompressed bundle occupy a stunning 2.7 Mb. But, fortunately, there is a tool called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FontForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that allows you to deeply analyze and modify font files. Using this tool, we were able to find out that the main reason for the large size of font files are extended Cyrillic characters and unnecessary glyphs. We could safely remove all this, since the text part of our application is completely written in Portuguese. Thanks to this change, we were able to reduce the size of the font files from 670 Kb to 70 Kb - by 90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d0/144/f9c/7d0144f9c3954dee6570347075fbe392.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples of some glyphs included in our fonts.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Due to the fact that we got rid of unnecessary fonts and optimized the remaining ones, we were able to reduce the application size by 3.8 Mb. </font><font style="vertical-align: inherit;">This led to a pleasant reduction in the total size of the APK file by 2 MB.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/62c/a55/52b62ca55ea0178919421a1c08304adc.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of fonts and their sizes before optimization</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/374/6db/83e3746db754c475501170c6e4372c49.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of fonts and their sizes after optimization</font></font></font></i><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñçOptimization of images</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After analyzing the images that still remained in the application, we noticed that some of them are quite large. </font><font style="vertical-align: inherit;">We processed several of these images with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TinyPNG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> graphics optimization </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">tool</font></a><font style="vertical-align: inherit;"> and saw a significant reduction in the size of these images. </font><font style="vertical-align: inherit;">After that, we decided to optimize all the JPG and PNG images used in the application. </font><font style="vertical-align: inherit;">There were 41 of them.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/8e9/9e6/aa58e99e6307077787f37d0d60fc59db.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Image before and after optimization</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
This gave us the opportunity to reduce the size of images from 2.5 MB to 756 KB, that is, by 70%. </font><font style="vertical-align: inherit;">However, due to the fact that the images were not previously optimized, they were compressed during the creation of the final APK-file. </font><font style="vertical-align: inherit;">It turned out that our optimization led to a decrease in the size of the application downloaded by the user by only 500 Kb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, we realized that we had already exhausted all the possibilities of quick optimization. </font><font style="vertical-align: inherit;">Continuing the optimization of resources would require either great efforts or only minor improvements.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React Native JavaScript Bundle Optimization</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we figured out the application resources specific to the Android platform, it's time to analyze the JavaScript bundle. </font><font style="vertical-align: inherit;">Bundle optimization can be considered a good idea for three reasons. </font><font style="vertical-align: inherit;">Firstly, it reduces the size of the finished APK file. </font><font style="vertical-align: inherit;">Secondly, this leads to a faster launch of the application, since the JS virtual machine has to process less code. </font><font style="vertical-align: inherit;">Finally, and most importantly, it speeds up the OTA updates we do several times a week using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodePush</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ñç Bundle analyzer and code optimization</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to make a decision on how to reduce the size of the bundle, first, you had to figure out what takes the most place in the bundle. To do this, we used the excellent open source tool </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react-native-bundle-visualizer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . After analyzing the project with its help, we got a visualization in which every folder and every application dependency was present, indicating the sizes of the corresponding entities.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f2/641/4c0/7f26414c02bec1a7cf7bcd6b901fb837.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snapshot of the libraries and folders of the code base of the frontend of the Mutual application with the indication of sizes</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We found out that the total size of the bundle is 5.49 Mb. 57.8% of this volume is represented by dependencies from the folder</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 27.5% - application code. What remains, the tool used by us could not be identified. During the assembly process of the bundle, unused code was already deleted, so what we saw was code that is actually used by the application. But, even considering this, in the bundle you can always find something that can be improved.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The biggest project dependency is</font></font><code>math.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. This library, as its name suggests, implements many mathematical operations. We do not have a special need for this library due to the fact that we perform all the important calculations on the server, after which we simply send the results to the application. When we looked at the application code, it turned out that the library is used only to perform some simple operations. It was most likely used by a developer who worked on server code only by virtue of habit. We quickly extracted the appropriate methods from the library and built them into our code base, completely getting rid of this dependency. This allowed to reduce the size of the bundle to 4.64 Mb. Refusal of only one library allowed to reduce the size of the bundle by 15.5%!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As already mentioned, we use the Storybook to develop and test components. True, the corresponding capabilities should be available only in local and intermediate environments. End users do not need this. Thanks to this, we used the variable </font></font><code>ENVIRONMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to control the inclusion of the corresponding part of the application. Although this is suitable for restricting access, the bundler cannot know what value is written to this variable. Because of this limitation, all Storybook code fell into the production bundle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to fix the problem, we isolated the import of this section within a single file. Then we created two versions of this file: one that includes the Storybook, and another that is for production, which contains only the component layout. To switch between these files when preparing the production version of the bundle, we wrote a script that is executed before the project is built and changes one file to another. Thanks to this method, we were able to completely remove the Storybook code from the production version of the application, removing both the dependency from </font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the usual code regarding the configuration of Storybook ‚Äústories‚Äù.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/4cc/276/9964cc2769a8a23b3b18d5b0d273cfd9.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updated Storybook folder with two versions of the index file.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
These two changes reduced the bundle size from 5.49 MB to 4.2 MB. </font><font style="vertical-align: inherit;">This means that, among other things, the application will load faster and update faster.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/06f/f53/03406ff53c8a918119c9febd41e6d752.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The size of the final bundle was 4.2 MB.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
After all these improvements, we again downloaded the application in the Play Store. </font><font style="vertical-align: inherit;">Now we were informed that the size of the finished APK-file will be in the range from 10.5 to 13.7 Mb. </font><font style="vertical-align: inherit;">This, given the fact that the application originally had a size of 26.8 MB, simply means an incredible reduction in project size by about 60%! </font><font style="vertical-align: inherit;">So, as we said in an article by the Google Play team, we can fully expect that the conversion rate of installations will increase by 3.75%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/715/69e/cec/71569ececb25a15225a48cef54bfb254.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparison of the original APK version of the application with the final AAB version, in which all the improvements described above are made</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summary</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We, as business-oriented programmers, know that sometimes companies, for the sake of a faster development of a project, may well go on to increase its technical debt. </font><font style="vertical-align: inherit;">This is especially true for young startups like Mutual, who are trying to find their place in the market. </font><font style="vertical-align: inherit;">But if you do not observe this debt, you can make annoying mistakes, such as sending 2 MB of test images to production and unjustified use of a huge library. </font><font style="vertical-align: inherit;">Technical debt should not be allowed to get out of control and cause trouble.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, it often happens that developers simply miss the opportunities available to them to optimize projects. </font><font style="vertical-align: inherit;">Therefore, it is sometimes recommended to critically analyze your projects. </font><font style="vertical-align: inherit;">Just to check if you missed some opportunity to quickly optimize the size, speed, or some other aspect of the application. </font><font style="vertical-align: inherit;">It took us only two days to analyze the application, plan the work and make improvements to the project, which allowed us to reduce the size of the application by 60%. </font><font style="vertical-align: inherit;">It is difficult to come up with something else that can produce the same results in such a short time. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How do you optimize your React Native projects?</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502412/index.html">Guilloche in a different manner</a></li>
<li><a href="../en502414/index.html">FOSS News No. 16 - a review of free and open source software for May 11-17, 2020</a></li>
<li><a href="../en502416/index.html">Complementing SQL. Part 1. The complexity of parsing. Stories about finalizing the ANTLR file</a></li>
<li><a href="../en502418/index.html">3D image monitor</a></li>
<li><a href="../en502420/index.html">Interesting CSS Finds in Twitter Design</a></li>
<li><a href="../en502424/index.html">Stop importing whole JavaScript packages</a></li>
<li><a href="../en502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../en502432/index.html">The digest of fresh materials from the world of the front-end for the last week No. 415 (May 11-17, 2020)</a></li>
<li><a href="../en502436/index.html">CI TeamCity - Automation of build processes of Android and UI testing</a></li>
<li><a href="../en502438/index.html">Material Python. Custom cards with OpenGL effects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>