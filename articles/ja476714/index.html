<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈳 🤷🏽 🧖🏽 Mail.ru Mailでの機械学習の操作 🧑🏻‍🤝‍🧑🏻 ◻️ 🤹🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Highload ++とDataFest Minsk 2019での私のプレゼンテーションに基づいてい
 
 ます。今日、多くの人にとって、メールはネットワーク上の生活の不可欠な部分です。その助けを借りて、ビジネス通信を行い、財政、ホテル予約、チェックアウトなどに関連するあらゆる種類の重要な情報を保存...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mail.ru Mailでの機械学習の操作</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/476714/"><img src="https://habrastorage.org/webt/k-/h5/xj/k-h5xjc6xswda5namvb8vgzjnns.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Highload ++とDataFest Minsk 2019での私のプレゼンテーションに基づいてい</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ます。今日、多くの人にとって、メールはネットワーク上の生活の不可欠な部分です。その助けを借りて、ビジネス通信を行い、財政、ホテル予約、チェックアウトなどに関連するあらゆる種類の重要な情報を保存します。 2018年半ばに、メール開発商品戦略を策定しました。最新のメールは何ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メールは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スマート</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">なければなりません</font><font style="vertical-align: inherit;">。つまり、ユーザーは増え続ける情報をナビゲート</font><font style="vertical-align: inherit;">できるようにする必要があります</font><font style="vertical-align: inherit;">。つまり、フィルター処理、構造化、そして最も便利な方法での提供です。彼女は役に立たなければならない</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、メールボックスでさまざまな問題を解決できるようにします。たとえば、罰金を支払う（残念ながら私が使用している機能です）。</font><font style="vertical-align: inherit;">そして同時に、もちろん、メールはスパムを遮断してハッキングから保護することで情報を保護する必要があり</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">つまり、</font><b><font style="vertical-align: inherit;">安全</font></b><font style="vertical-align: inherit;">です。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの領域はいくつかの主要なタスクを決定し、その多くは機械学習を使用して効果的に解決できます。</font><font style="vertical-align: inherit;">以下は、戦略の一部として開発された既存の機能の例です-各方向に1つ。</font></font><br>
<br>
<ul>
<li><b>Smart Reply</b>.      .    ,     ,         : ,   .         ,         .<br>
</li>
<li><b> </b>,     -.      , ,  ,         . ,  ,   ,       ,   ,          29.     Named Entity Recognition                .         ,       .<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/3f1/b29/7f7/3f1b297f73ba953ecda62e89fee2ee9c.png"><br>
</li>
<li><b></b>.  —     ,         (      )  .     ,  ,    .    Computer Vision          (, Mail.ru, , )               .<br>
</li>
</ul><br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メールの機械学習全般について少し。メールは負荷の高いシステムです。私たちのサーバーでは、1日あたり平均15億通の手紙が3,000万のDAUユーザーに渡されます。約30の機械学習システムに必要なすべての機能を提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各手紙は分類コンベヤ全体を通過します。まず、スパムを遮断し、適切なメールを残します。スパムの95〜99％は対応するフォルダに届かないため、ユーザーはアンチスパムの動作に気付かないことがよくあります。スパムの認識は私たちのシステムの非常に重要な部分であり、最も難しいのは、アンチスパムの分野では、防御システムと攻撃システムの間に絶え間ない適応があり、それが私たちのチームに継続的なエンジニアリングの課題を提供するためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、文字を人やロボットから分離します。人からの手紙が最も重要なので、スマートリプライなどの機能を提供します。ロボットからの手紙は2つの部分に分かれています：トランザクション-これらは、購入やホテルの予約の確認、財務、情報などのサービスからの重要な手紙です-これらはビジネス広告、割引です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、取引状は個人的なやり取りと同等の価値があると信じています。多くの場合、注文やチケットの予約に関する情報をすばやく見つける必要があり、これらの手紙を探すのに時間を費やしているため、手元にあるはずです。したがって、便宜上、これらを自動的に6つの主要カテゴリに分類します。旅行、予約、財務、チケット、登録、そして最後に罰金です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ニュースレターは、最大の、おそらくそれほど重要ではないグループです。ユーザーがそのような手紙を読まなくても、ユーザーの生活に大きな変化はないためです。</font><font style="vertical-align: inherit;">新しいインターフェースでは、ソーシャルネットワークとニュースレターの2つのスレッドにそれらを折りたたんで、メールボックスを視覚的にクリアし、重要な文字のみを残しています。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/300/e18/9b9/300e189b9567866cb526eb34be80b3b4.jpg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搾取</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムの数が多いと、操作が困難になります。結局のところ、他のソフトウェアと同様に、モデルは時間とともに劣化します。兆候が壊れ、マシンが故障し、コードが動き回ります。さらに、データは絶えず変化しています。新しいデータが追加されたり、ユーザーの行動パターンが変換されたりするなどです。そのため、適切なサポートがないモデルは、時間の経過とともにますます機能しなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機械学習がユーザーの生活に深く浸透すればするほど、ユーザーがエコシステムに与える影響が大きくなり、その結果、市場のプレーヤーがより多くの経済的損失や利益を得ることができることを忘れてはなりません。したがって、ますます多くの領域で、プレーヤーはMLアルゴリズムの仕事に適応しています（古典的な例は、広告、検索、および既に述べたアンチスパムです）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、機械学習タスクには機能があります。重要ではありませんが、システムの変更により、モデルで多くの作業が発生する可能性があります。データの操作、再トレーニング、デプロイ、数週間または数か月かかる可能性があります。</font><font style="vertical-align: inherit;">したがって、モデルが動作する環境が高速であるほど、サポートに多くの労力が必要になります。</font><font style="vertical-align: inherit;">チームは多くのシステムを作成してそれを楽しむことができ、その後、何か新しいことをする能力なしに、ほとんどすべてのリソースをサポートに費やすことができます。</font><font style="vertical-align: inherit;">かつて、スパム対策チームでこのような状況に遭遇しました。</font><font style="vertical-align: inherit;">そして彼らは、メンテナンスを自動化すべきだという明白な結論を出しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オートメーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自動化できるものは何ですか？</font><font style="vertical-align: inherit;">実際、ほとんどすべて。</font><font style="vertical-align: inherit;">機械学習のインフラストラクチャを定義する4つの領域を特定しました。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ収集;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">継続教育;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストと監視。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
環境が不安定で常に変化している場合、モデル周辺のインフラストラクチャ全体がモデル自体よりもはるかに重要です。</font><font style="vertical-align: inherit;">それは古き良き線形分類器かもしれませんが、サインを正しく適用し、ユーザーからの良いフィードバックを確立すれば、すべてのベルとホイッスルを備えた最新のモデルよりもはるかにうまく機能します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィードバックループ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサイクルは、データ収集、追加のトレーニング、およびデプロイメントを組み合わせたものであり、実際には、モデルを更新するサイクル全体です。</font><font style="vertical-align: inherit;">どうしてそれが重要ですか？</font><font style="vertical-align: inherit;">メールでの登録スケジュールを見てください</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/nj/qx/8bnjqxedzuj9ubakau7yd1vh_cc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。機械学習開発者は、ボットがメールに登録できないようにするアンチボットモデルを導入しています。</font><font style="vertical-align: inherit;">グラフは、実際のユーザーのみが残る値に低下します。</font><font style="vertical-align: inherit;">すべてが素晴らしいです！</font><font style="vertical-align: inherit;">しかし、4時間が経過すると、ボットボッドはスクリプトを強化し、すべてが元の状態に戻ります。</font><font style="vertical-align: inherit;">この実装では、開発者は1か月かけて機能とトレーニングモデルを追加しましたが、スパマーは4時間で適応できました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それほど痛くなく、後ですべてをやり直す必要がないようにするために、最初にフィードバックループがどのように見えるか、および環境が変化した場合に何をするかについて考える必要があります。</font><font style="vertical-align: inherit;">データの収集から始めましょう。これがアルゴリズムの燃料です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ収集</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最新のニューラルネットワークはデータが多いほど優れていることは明らかであり、実際には製品のユーザーを生み出しています。</font><font style="vertical-align: inherit;">ユーザーはデータをマークアップして私たちを助けることができますが、ある時点でユーザーがモデルの完成にうんざりして別の製品に切り替えるため、データを悪用しないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も一般的な間違いの1つ（ここではAndrew Ngについて言及します）は、テストデータセットのメトリックへの方向付けが強すぎて、ユーザーからのフィードバックではなく、ユーザーのための製品を作成するときに、それが実際に作業の品質の主要な尺度であるということです。</font><font style="vertical-align: inherit;">ユーザーがモデルの作業を理解していない、または嫌いな場合、すべてが壊れやすいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ユーザーは常に投票できる必要があり、フィードバックのためのツールを提供する必要があります。</font><font style="vertical-align: inherit;">ボックスに金融関連の手紙が届いたと思われる場合、それを「金融」とマークし、ユーザーがクリックして、これが金融ではないと言うことができるボタンを描画する必要があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィードバック品質</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーのフィードバックの質について話しましょう。まず、あなたとユーザーは異なる概念を1つの概念に組み込むことができます。たとえば、あなたと製品マネージャーは、「金融」は銀行からの手紙であり、ユーザーは私の祖母からの退職に関する手紙も金融を指すと信じています。第二に、何の論理もなくボタンを押すことを無情に好きなユーザーがいます。第三に、ユーザーは結論を深く誤解している可能性があります。私たちの実践からの鮮やかな例は、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ナイジェリアのスパム</font></a><font style="vertical-align: inherit;">分類器の実装です</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、非常に面白いタイプのスパム。ユーザーがアフリカで突然見つかった遠くの親戚から数百万ドルを集めるように求められたとき。この分類子を導入した後、これらの文字の「スパムなし」のクリックをチェックしたところ、80％がジューシーなナイジェリアのスパムであることがわかりました。これは、ユーザーが非常に信頼できることを示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、人々がボタンを突くことができるだけでなく、ブラウザになりすましているあらゆる種類のボットも忘れないでください。したがって、生のフィードバックは学習に適していません。この情報で何ができますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのアプローチを使用します。</font></font><br>
<br>
<ul>
<li><b>   ML</b>. ,    - , ,    ,        .   ,  ,  .      ,     ..  ,    ,       .            .  ,           .<br>
</li>
<li><b> </b>.      ,      .      ,   ,  ,  ,      .     ,    .        ,         .       precision,         . <br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データをクリーンアップしてMLシステムを再トレーニングしている間、ユーザーのことを忘れないでください。何千、何百万というグラフ上のエラーは統計情報であり、ユーザーにとって、すべてのバグは悲劇です。</font><font style="vertical-align: inherit;">ユーザーは何らかの形であなたの製品のミスに耐える必要があるという事実に加えて、フィードバック後、彼は将来同様の状況が排除されることを期待しています。</font><font style="vertical-align: inherit;">したがって、常にユーザーに投票する機会を与えるだけでなく、MLシステムの動作を修正して、たとえばフィードバックのクリックごとに個人的なヒューリスティックを作成する必要があります。メールの場合、このユーザーの送信者とヘッダーでそのような文字をフィルター処理することが可能です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のユーザーも同様の問題に悩まされないように、一部のレポートまたはサポートの呼び出しを半自動モードまたは手動モードに基づいてモデルを松葉杖で動かす必要もあります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学習のためのヒューリスティック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのヒューリスティックと松葉杖には2つの問題があります。</font><font style="vertical-align: inherit;">1つ目は、増え続ける松葉杖の数は、その品質と長距離パフォーマンスは言うまでもなく、維持するのが難しいということです。</font><font style="vertical-align: inherit;">2番目の問題は、エラーが頻度ではない可能性があり、モデルを再トレーニングするための数回のクリックでは十分ではないことです。</font><font style="vertical-align: inherit;">次のアプローチを適用すると、これらの2つの無関係な影響は実質的に平準化できると思われます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一時的な松葉杖を作成します。 </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データをモデルに転送し、受信したデータを含めて定期的に取得します。</font><font style="vertical-align: inherit;">ここではもちろん、学習セットのデータの品質を低下させないように、ヒューリスティックの精度が高いことが重要です。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、松葉杖の動作の監視を終了します。しばらくして松葉杖が機能しなくなり、モデルで完全に覆われた場合は、安全に取り外すことができます。</font><font style="vertical-align: inherit;">現在、この問題が再発することはほとんどありません。</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
だから松葉杖の軍隊は非常に便利です。</font><font style="vertical-align: inherit;">主なことは、彼らのサービスが緊急ではなく永続的であるということです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さらなる教育</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再トレーニングは、ユーザーまたは他のシステムからのフィードバックの結果として得られた新しいデータを追加し、それらの既存のモデルをトレーニングするプロセスです。</font><font style="vertical-align: inherit;">再トレーニングにはいくつかの問題がある可能性があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルは単にそれ以上の教育をサポートせず、ゼロから学ぶだけかもしれません。 </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自然の本のどこにも、継続的な教育が生産における仕事の質を確実に向上させるとは書かれていません。</font><font style="vertical-align: inherit;">多くの場合、それは正反対に起こります。つまり、劣化のみが可能です。</font></font><br>
</li>
<li>   .    ,     .      /-       ,    ,     .      -  ,          .     ,   ,   ,       ,     ,  ,     .<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、再トレーニングで最も重要なことは、モデルを改善すること、または少なくともモデルを悪化させないことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
継続教育について話すときに最初に頭に浮かぶのは、アクティブラーニングのアプローチです。これは何を意味するのでしょうか？たとえば、分類子は手紙が財政に関連しているかどうかを判断し、意思決定の境界付近に、マークアップされた例のサンプルを追加します。これは、たとえば、多くのフィードバックがあり、モデルをオンラインでトレーニングできる広告でうまく機能します。フィードバックがほとんどない場合は、データ分布の生成に対して強く偏ったサンプルが得られます。これに基づいて、操作中のモデルの動作を評価することはできません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wz/1c/0g/wz1c0gfwffg6kh2gnc76v_-70ai.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私たちの目標は、古いパターン、既知のモデルを保存し、新しいパターンを取得することです。</font><font style="vertical-align: inherit;">ここでは継続性が重要です。</font><font style="vertical-align: inherit;">非常に苦労して展開したモデルはすでに機能しているため、パフォーマンスに集中できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メールでは、ツリー、線形、ニューラルネットワークなど、さまざまなモデルが使用されます。</font><font style="vertical-align: inherit;">それぞれについて、独自の再トレーニングアルゴリズムを作成します。</font><font style="vertical-align: inherit;">再トレーニングの過程で、新しいデータだけでなく、多くの場合、以下のすべてのアルゴリズムで考慮する新しい機能も取得します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">線形モデル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロジスティック回帰があるとしましょう。</font><font style="vertical-align: inherit;">以下のコンポーネントから損失モデルを構成します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいデータのLogLoss。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい標識の重みを正規化します（古い標識には触れません）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古いパターンを保存するために、古いデータから学習します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そして、おそらく最も重要です。標準で古いモデルと比較して重みのわずかな変化を保証する調和正則化をアタッチします。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各損失コンポーネントには係数があるので、交差検証のタスクに最適な値を選択するか、製品の要件に基づいて選択できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kz/ej/-r/kzej-rg5tcarotc9l25xe7x9d8a.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">木</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
決定木に移りましょう。</font><font style="vertical-align: inherit;">次のツリー再トレーニングアルゴリズムを撮影しました。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100〜300本の木の森が、古いデータセットでトレーニングされたprodで動作します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後に、M = 5個を削除し、2M = 10個の新しいものを追加します。これは、データセット全体でトレーニングされますが、新しいデータからの重みが大きいため、当然モデルの増分変更が保証されます。</font></font><br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明らかに、時間の経過とともにツリーの数は大幅に増加し、タイミングに合わせるために定期的に削減する必要があります。</font><font style="vertical-align: inherit;">これを行うには、今ではユビキタスな知識蒸留（KD）を使用しています。</font><font style="vertical-align: inherit;">その作業の原理について簡単に説明します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在の「複雑な」モデルがあります。</font><font style="vertical-align: inherit;">トレーニングデータセットで開始し、出力でクラスの確率分布を取得します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、クラス変数分布をターゲット変数として使用して、モデルの結果を繰り返すように学生モデル（この場合はツリーが少ないモデル）を教えます。</font></font><br>
</li>
<li>  ,       -,      . ,       ,      .  ,       ,        -,    .<br>
</li>
</ol><br>
<img src="https://habrastorage.org/webt/a9/y-/qb/a9y-qbwv-wg1r8w7ohezamjzbi4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これら2つの手法（ツリーを追加し、ナレッジ蒸留を使用して定期的に数を減らす）を組み合わせると、新しいパターンの導入と完全な連続性が保証されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、KDのサポートにより、特性の削除やパスの作成など、モデルの特性による操作の区別も行います。私たちの場合、重要な統計機能（送信者、テキストハッシュ、URLなど）がいくつかあり、これらは拒否するプロパティを持つデータベースに保存されています。もちろん、トレーニングセットには障害が発生しないため、モデルはこのようなイベントの展開に対応できません。そのような場合は、KDと拡張技術を組み合わせます。データの一部をトレーニングするときに、必要な符号を削除またはゼロアウトし、ラベル（現在のモデルの出力）を最初の符号として使用して、学生モデルはこの分布を繰り返すように教えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/dc/12/xzdc12577_krj0_-qknhnh8eqvo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モデルの操作が深刻になるほど、必要なサンプルフローのパーセンテージが高くなることに気づきました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特性を削除するには、最も単純な操作で、フローのごく一部のみが必要です。これは、2、3の特性のみが変化するためです。現在のモデルは同じセットで調査されます-差は最小限です。</font><font style="vertical-align: inherit;">モデルを単純化する（ツリーの数を数回減らす）には、50から50がすでに必要です。また、モデルのパフォーマンスに深刻な影響を与える重要な統計機能を省略するには、すべてのタイプの文字で、漏れに強い新しいモデルの作業を均等にするために、さらに多くのフローが必要です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xw/b5/ib/xwb5ibcbds7xt3asahheyhpj9v4.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fasttext</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FastTextに移りましょう。単語の表現（埋め込み）は、単語自体とそのすべてのアルファベットNグラム（通常はトライグラム）の埋め込みの合計で構成されることを思い出してください。トライグラムは非常に多くなる可能性があるため、バケットハッシュが使用されます。つまり、スペース全体が特定の固定ハッシュマップに変換されます。その結果、重み行列は、単語数+バケットによる内層の次元によって取得されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらなる教育の間に、新しい兆候が現れます：言葉とトライグラム。</font><font style="vertical-align: inherit;">Facebookからのトレーニング後の標準では、重要なことは何も起こりません。</font><font style="vertical-align: inherit;">新しいデータでクロスエントロピーを持つ古い重みのみが再トレーニングされます。</font><font style="vertical-align: inherit;">したがって、新しい機能は使用されません。もちろん、このアプローチには、製造時のモデルの予測不能性に関連する上記のすべての欠点があります。</font><font style="vertical-align: inherit;">したがって、FastTextを少し変更しました。</font><font style="vertical-align: inherit;">すべての新しい重み（単語とトライグラム）を追加し、行列全体をクロスエントロピーで仕上げ、線形モデルとの類推による調和正則化を追加します。これにより、古い重みのわずかな変更が保証されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ib/0g/v3/ib0gv3rq9xvxitkbimz_6f4yaqs.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CNN</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンボリューションネットワークでは、少し複雑になります。</font><font style="vertical-align: inherit;">最後の層がCNNで完成している場合は、もちろん、調和正則化を適用でき、連続性が保証されます。</font><font style="vertical-align: inherit;">ただし、ネットワーク全体の追加のトレーニングが必要な場合は、そのような正規化をすべてのレイヤーで停止することはできません。</font><font style="vertical-align: inherit;">ただし、三重項損失を介して補完的な埋め込みを教えるオプションがあります（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元の記事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三重項損失</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィッシング対策の問題を例にして、トリプレットロスを見てみましょう。当社のロゴ、および他社のロゴのポジティブおよびネガティブな例を採用しています。最初のクラス間の距離を最小化し、2番目のクラス間の距離を最大化します。クラスのコンパクト性を高めるために、これを小さなギャップで行います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h9/uz/cy/h9uzcyjc9y86mc2inrlv0wq3kwm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークを再トレーニングすると、メトリック空間は完全に変化し、以前のものと完全に互換性がなくなります。これはベクターの深刻な問題です。この問題を回避するために、トレーニング中に古い埋め込みを混在させます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいデータをトレーニングセットに追加し、モデルの2番目のバージョンをゼロからトレーニングしています。</font><font style="vertical-align: inherit;">2番目の段階では、ネットワークを再トレーニングします（微調整）。最初に最後のレイヤーが再トレーニングされ、次にネットワーク全体が解凍されます。</font><font style="vertical-align: inherit;">トリプレットをコンパイルするプロセスでは、埋め込みの一部のみがトレーニング済みモデルを使用して計算され、残りは古いモデルを使用して計算されます。</font><font style="vertical-align: inherit;">したがって、再トレーニングのプロセスでは、メトリック空間v1とv2の互換性を確保します。</font><font style="vertical-align: inherit;">調和正則化の独特な変形。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eb/iu/ro/ebiurox9uuibm_meuq8tap3zyzw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーキテクチャ全体</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システム全体をスパム対策の例として考えると、モデルは分離されず、相互に組み込まれます。写真、テキスト、その他の標識を撮影し、CNNと高速テキストを使用して埋め込みを取得します。次に、埋め込みに加えて、分類子が使用され、さまざまなクラス（文字のタイプ、スパム、ロゴの存在）のスコアが付与されます。スコリアと標識はすでに最終決定のために木の森に落ちます。このスキームの個別の分類子により、システムの結果をより適切に解釈し、問題が発生した場合にすべてのデータをディシジョンツリーに提供するよりも、コンポーネントをより正確に再トレーニングできます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ik/42/y4/ik42y4lvyzbhbsuywkmrxwg6bp4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、すべてのレベルで継続性が保証されます。</font><font style="vertical-align: inherit;">CNNおよびFast Textの下位レベルでは、調和正則化を使用し、中間の分類子には、確率分布の互換性のために調和正則化と速度キャリブレーションも使用します。</font><font style="vertical-align: inherit;">まあ、ツリーブースティングは段階的に、または知識蒸留の助けを借りて訓練されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、このような組み込み機械学習システムのサポートは、通常、手間がかかります。下位レベルのコンポーネントは、上のシステム全体のアップグレードにつながるためです。</font><font style="vertical-align: inherit;">ただし、セットアップでは各コンポーネントがわずかに変更され、前のコンポーネントと互換性があるため、構造全体を再トレーニングする必要なく、システム全体を少しずつ更新できます。これにより、深刻なオーバーヘッドなしでコンポーネントを維持できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データ収集とさまざまなタイプのモデルのさらなるトレーニングを調査したので、本番環境での展開に移ります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A / Bテスト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に述べたように、データ収集のプロセスでは、原則として、サンプルの偏りがあり、モデルの生産性能を評価することは不可能です。したがって、展開する際には、実際の状態を理解するために、モデルを以前のバージョンと比較する必要があります。つまり、A / Bテストを実施する必要があります。実際、チャートの展開と分析のプロセスはかなり日常的であり、自動化に適しています。ユーザーの5％、30％、50％、100％ずつモデルを段階的に展開しながら、モデルの応答とユーザーのフィードバックに従って、利用可能なすべてのメトリックを収集しています。一部の深刻な外れ値の場合は、モデルを自動的にロールバックします。他の場合は、十分な数のユーザークリックを収集したため、割合を増やすことにしました。その結果、新しいモデルをユーザーの50％に完全に自動的に提供し、このステップは自動化できますが、オーディエンス全体へのロールアウトは人からアピールされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、A / Bテストプロセスには最適化の余地があります。実際、A / Bテストは非常に長く（この場合、フィードバックの量に応じて6〜24時間かかります）、非常に高価でリソースが限られます。さらに、A / Bテストの合計時間を本質的に加速するために、テストのフローの十分に高い割合のフローが必要です（メトリックを評価するための統計的に有意なサンプルを収集するのに非常に長い時間がかかる場合があります）。これにより、A / Bスロットの数が非常に制限されます。明らかに、最も有望なモデルのみをテストする必要があり、その中で再トレーニングの過程で多くを得ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決するために、A / Bテストの成功を予測する別の分類子をトレーニングしました。</font><font style="vertical-align: inherit;">これを行うために、我々は意思決定統計、精度、リコール、およびトレーニングセット、遅延されたもの、およびストリームからのサンプルに関するその他のメトリックを符号として取得します。</font><font style="vertical-align: inherit;">また、モデルを現在の生産モデルとヒューリスティックで比較し、モデルの複雑さを考慮します。</font><font style="vertical-align: inherit;">これらのすべての兆候を使用して、テストの履歴でトレーニングされた分類子が候補モデルをスカウトします。この場合、それは木の森であり、A / Bテストに入れるモデルを決定します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/nf/mu/jfnfmu8eoxpau1ux_n_ndww9ffi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装時には、このアプローチにより、成功したA / Bテストの数を数回増やすことができました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストとモニタリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
奇妙なことに、テストと監視は私たちの健康に害を与えるものではなく、逆に、不必要なストレスを改善して緩和します。テストはクラッシュの防止に役立ち、監視はクラッシュを適時に検出してユーザーへの影響を軽減します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遅かれ早かれ、システムは常に間違っていることを理解することが重要です-これはソフトウェアの開発サイクルが原因です。システム開発の最初は、すべてが解決し、イノベーションのメインステージが完了するまで、常に多くのバグが存在します。しかし、時間の経過とともに、エントロピーが犠牲になり、エラーが再び表示されます。これは、最初に説明したように、周囲のコンポーネントの劣化とデータの変更が原因です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで私は、機械学習システムはライフサイクル全体を通してその利益の観点から考慮されなければならないことに注意したいと思います。次のグラフは、システムが珍しいタイプのスパムをキャッチする方法の例を示しています（グラフでは、線はゼロに近い）。一度、誤ってキャッシュされたサインが原因で、彼女は頭がおかしくなりました。運が良ければ、異常な動作の監視は行われなかったため、システムは意思決定の境界にあるスパムフォルダに大量の手紙を保存し始めました。結果を修正したにもかかわらず、システムはすでに何度も間違いを犯しており、5年間で元が取れないでしょう。そして、これはモデルのライフサイクルの観点からは完全な失敗です。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/db1/f2f/6a9/db1f2f6a95922c5c4caf13e5aab1be57.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、監視などの単純なことは、モデルのライフサイクルの鍵になる可能性があります。</font><font style="vertical-align: inherit;">標準的で明白なメトリックに加えて、主要な属性の値の分布だけでなく、応答とモデルスコアの分布も考慮します。</font><font style="vertical-align: inherit;">KLダイバージェンスを使用して、現在の分布を履歴分布と比較するか、A / Bテストの値を残りのフローと比較できます。これにより、モデルの異常に気付き、時間の変化をロールバックできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどの場合、将来の監視として使用する単純なヒューリスティックまたはモデルを使用して、システムの最初のバージョンを起動します。</font><font style="vertical-align: inherit;">たとえば、特定のオンラインストアの常連客と比較してNERモデルを監視し、分類器のカバレッジがそれらと比較して浪費されている場合は、その理由を理解しています。</font><font style="vertical-align: inherit;">ヒューリスティックのもう1つの便利なアプリケーション！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の主要な考えをもう一度見てみましょう。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fibdek</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちは常にユーザーについて考えます。彼がどのように私たちの過ちに対処するか、どのように彼がそれらを報告できるかです。</font><font style="vertical-align: inherit;">ユーザーがトレーニングモデルの純粋なフィードバックのソースではないことを忘れないでください。補助的なMLシステムを使用してクリーンアップする必要があります。</font><font style="vertical-align: inherit;">ユーザーから信号を収集する方法がない場合は、関連するシステムなど、代替のフィードバックソースを探しています。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再訓練</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ここでの主なものは継続性なので、現在の生産モデルに依存しています。</font><font style="vertical-align: inherit;">新しいモデルをトレーニングして、調和正則化や同様のトリックのために、以前のモデルと大きく異なることがないようにします。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">自動メトリックにより、モデルの実装にかかる時間が大幅に短縮されます。</font><font style="vertical-align: inherit;">統計と意思決定の分布を監視し、ユーザーからの転倒の数は、十分な睡眠と生産的な週末のために必須です。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、私があなたが読んだことがあなたのMLシステムをより速く改善し、それらの市場立ち上げを加速し、それらをより信頼できるものにし、仕事からのストレスの量を減らすのを助けることを願っています</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476704/index.html">同じタイプの要素を持つ電子メールのレイアウトを自動化する方法：スマートオブジェクトを使用します</a></li>
<li><a href="../ja476706/index.html">Cerebras Systemsは、世界最大のプロセッサを搭載した22×22センチメートルのコンピュータを発表しました</a></li>
<li><a href="../ja476708/index.html">モスクワのスラムベーシック。三日目 パベルセリバノフと「スラムインスパイア」を飛ばす対諜報活動とクラスターのコレクション</a></li>
<li><a href="../ja476710/index.html">登録受付中：火星でのITの詳細</a></li>
<li><a href="../ja476712/index.html">見知らぬ人とのランダムなミーティングのためのサービスですが、デートはしません。ランダムコーヒーのスタートアップ履歴</a></li>
<li><a href="../ja476718/index.html">全国ラジオの歴史：地方ラジオのムッソリーニとジョセフ・ゲッベルスの暖かいランプ</a></li>
<li><a href="../ja476720/index.html">履歴書段階で潜在的な従業員を識別する方法</a></li>
<li><a href="../ja476722/index.html">Apache NiFiでのフロー配信の自動化</a></li>
<li><a href="../ja476724/index.html">Mac Pro 1.1にVMware ESXiをインストールする</a></li>
<li><a href="../ja476726/index.html">イノポリス大学の卒業生、グルノーブル大学での勉強、AI、英語とフランス語、ナンキンムシとチーズ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>