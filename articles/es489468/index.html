<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Aplicaci贸n Slack simple para publicar contenido de Google Sheets  憋 </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos encanta probar cosas nuevas y, por lo tanto, a menudo compartimos enlaces con informaci贸n interesante del mundo de TI y programaci贸n con nuestros ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aplicaci贸n Slack simple para publicar contenido de Google Sheets</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489468/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nos encanta probar cosas nuevas y, por lo tanto, a menudo compartimos enlaces con informaci贸n interesante del mundo de TI y programaci贸n con nuestros colegas. Somos usuarios de Slack desde hace mucho tiempo y para dichos enlaces tenemos un canal educativo separado donde todos pueden encontrar algo interesante por s铆 mismos. Pero como somos personas comunes, peri贸dicamente en el calor del trabajo, olvidamos que necesitamos compartir estos enlaces, y la actividad en el canal se desvanece, aunque muchos de nosotros tenemos algo que compartir.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos enfrentamos a una tarea interesante de desarrollar un "bot" que pudiera tomar autom谩ticamente informaci贸n recopilada previamente y compartir enlaces a ella de manera regular. </font><font style="vertical-align: inherit;">Est谩bamos buscando una soluci贸n preparada en Internet, y ahora ha aparecido </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como una integraci贸n de zapier y holgura</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/zc/el/gbzcelbfefmw2trwii1temk6f2a.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, no encontramos tal integraci贸n antes y decidimos escribir nuestra propia bicicleta peque帽a. </font><font style="vertical-align: inherit;">A continuaci贸n describiremos c贸mo lo hicimos exactamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al pensar en el problema, me vino a la mente la siguiente soluci贸n: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
c贸digo Javascript que recibe informaci贸n sobre enlaces 煤tiles relevantes de la tabla de Google y la env铆a a Slack. </font><font style="vertical-align: inherit;">Llamar a un script desde el primer elemento en un horario usando cron. </font><font style="vertical-align: inherit;">Comencemos en orden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obteniendo una ficha para Slack.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 todo es simple y se ha descrito repetidamente en otros art铆culos, por lo que solo dar茅 una breve descripci贸n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay dos opciones: hacer su propia aplicaci贸n Slack o usar tokens heredados, la primera opci贸n es un poco m谩s complicada, pero es recomendada por Slack, la segunda es m谩s simple y bastante adecuada para nuestras necesidades, debido a su simplicidad la elegiremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abrimos un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace para generar un nuevo token</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y crear un nuevo token para el espacio de trabajo deseado (no olvide copiarlo, el token se emite una vez). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bu/fw/bq/bufwbqnmxbfoliu35xk_lky8gtm.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el futuro, cuando implementemos c贸digo que interact煤a con la API de Slack y las Hojas de c谩lculo de Google, podremos usar este token para el prop贸sito previsto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora necesita obtener el token para las Hojas de c谩lculo de Google. Primero, abra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js Quickstart para Hojas de c谩lculo de Google</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y habilite la API de Hojas de c谩lculo de Google. </font><font style="vertical-align: inherit;">Luego copiamos el c贸digo index.js del ejemplo y lo ejecutamos, realizamos el proceso de autorizaci贸n y obtenemos las credenciales en el archivo, que son 煤tiles para usar con nuestro script.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementaci贸n de script</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora es el momento de comenzar a desarrollar un script para publicar mensajes de Hojas de c谩lculo de Google en Slack. </font><font style="vertical-align: inherit;">El c贸digo completo del script se puede encontrar haciendo clic en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, analizaremos la parte del c贸digo que env铆a mensajes al canal de holgura. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto sucede llamando a la API REST de Slack.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> post = <span class="hljs-keyword">async</span> (text, channel = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CHANNEL</span> <span class="hljs-attr">ID</span>&gt;</span>) =&gt; {
  const uri = `https://slack.com/api/chat.postMessage?token=${SLACK_AUTH_TOKEN}&amp;channel=${channel}&amp;text=${text}`;
  const result = await fetch(encodeURI(uri), {
    headers: {
      'Content-Type': 'application/json',
    },
    method: 'POST',
    body: JSON.stringify({
      channel,
      text,
      as_user: true
    })
  });

  await result.json();
};
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la autorizaci贸n en la API de Google, se utilizan dos funciones (autorizar, getNewToken), cuyo c贸digo est谩 tomado del inicio r谩pido de Node.js, no nos detendremos en ellas en detalle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente bloque de c贸digo interesante es obtener informaci贸n para enviar desde las hojas de c谩lculo de Google, esto se hace mediante la siguiente funci贸n:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> getMessageAndPost = <span class="hljs-keyword">async</span> (auth, spreadsheetId = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ID</span>  <span class="hljs-attr">Google</span> &gt;</span>) =&gt; {
  const sheets = google.sheets({ version: 'v4', auth });
  sheets.spreadsheets.values.get({
    spreadsheetId,
    range: 'Sheet1!A1:B999',
  }, async (err, res) =&gt; {
    if (err) return console.log('The API returned an error: ' + err);
    const rows = res.data.values;
    if (rows.length) {
      // Print columns A and E, which correspond to indices 0 and 4.
      const ix = rows.findIndex(r =&gt; !r[1]);
      await post(rows[ix][0]);
      sheets.spreadsheets.values.update({
        spreadsheetId: '18VzilQTEDGXBnaH1f_k-uAfa8Mb470gx32Phir6xQT4',
        range: `Sheet1!B${ix + 1}`,
        valueInputOption: 'RAW',
        requestBody: {
          range: `Sheet1!B${ix + 1}`,
          values: [['x']]
        }

      })
    } else {
      console.log('No data found.');
    }
  });
};</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tabla con la que interact煤a el script tiene la siguiente forma: en </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/lr/1r/tylr1rijbae8u53q8qvuwbls5te.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
consecuencia, para al lado de cada enlace despu茅s de enviar un mensaje a Slack, el script pone "x". Por lo tanto, para encontrar el mensaje que desea enviar, debe seleccionar la primera l铆nea, que a煤n no tiene una "x", tomar el mensaje, enviarlo y marcar la l铆nea seleccionada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El gui贸n que acabamos de desmontar es bastante simple y ha confirmado su rendimiento durante varios a帽os en nuestro equipo. Solo tenemos que implementar este script en el servidor y disfrutar de su uso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esto, en nuestra compa帽铆a usamos el Ubuntu VPS habitual en Digital Ocean (incluso el que tenga la menor potencia). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, debe configurar el entorno para ejecutar el c贸digo javascript, para ello debe instalar node.js (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gu铆a de instalaci贸n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu茅s de eso, configure la tarea cron para llamar al script en un horario:</font></font><br>
<br>
<pre><code class="plaintext hljs">crontab -e<font></font>
<font></font>
#### <font></font>
<font></font>
24 14 * * 1-5 cd /root/google-sheets-to-slack &amp;&amp; node post.js<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esta configuraci贸n, nuestro script de la carpeta / root / se llamar谩 diariamente de lunes a viernes a las 14:24. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La configuraci贸n ha terminado, pero el lector atento debe haber notado algunas fallas en el script, por ejemplo, si hay alg煤n error al llamar al script, nunca lo sabremos, porque se "caer谩 en silencio" y eso es todo. </font><font style="vertical-align: inherit;">Para resolver este problema, puede agregar el manejo de errores y la salida del resultado de la llamada del script a la misma hoja de c谩lculo o archivo de registro de Google. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem谩s, en lugar de enviar un mensaje a una hora fija, puede enviarlo con un retraso aleatorio, de modo que nuestro mensaje se parezca m谩s a un mensaje de un usuario "en vivo".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra idea interesante de uno de nuestros colegas fue crear una segunda tabla, desde la cual los mensajes se enviar铆an exclusivamente los viernes y ser铆an m谩s entretenidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, vemos innumerables ideas para el refinamiento y las implementaremos gradualmente, pero en la forma existente este script result贸 bastante 煤til. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una tabla de ejemplo que se puede utilizar est谩 disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu铆</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por leer y disfrutar usando.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es489444/index.html">Transforme la naturaleza en decoraci贸n con escaneo 3D</a></li>
<li><a href="../es489452/index.html">Tareas de Microsoft JavaScript</a></li>
<li><a href="../es489456/index.html">Recomendaciones despu茅s de la cita de un cirujano dental</a></li>
<li><a href="../es489460/index.html">UV de dos dedos</a></li>
<li><a href="../es489464/index.html">"隆Volver茅!": C贸mo el ingl茅s de Arnold Schwarzenegger ha cambiado a lo largo de 50 a帽os en los EE. UU.</a></li>
<li><a href="../es489470/index.html">El potencial competitivo de las simulaciones tipo asedio</a></li>
<li><a href="../es489472/index.html">Archivo web: sustituci贸n de importaciones</a></li>
<li><a href="../es489474/index.html">C贸mo comprimir el modelo de texto r谩pido 100 veces</a></li>
<li><a href="../es489476/index.html">Dise帽o de casillas de verificaci贸n y botones de opci贸n con CSS3</a></li>
<li><a href="../es489482/index.html">Lo que necesita saber si desea llamar a las funciones Go desde el ensamblador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>