<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïï üê± ü§ì Clustering no Proxmox VE üñäÔ∏è ‚õìÔ∏è üï°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em artigos anteriores, come√ßamos a falar sobre o que √© o Proxmox VE e como ele funciona. Hoje falaremos sobre como voc√™ pode usar o recurso de cluster...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Clustering no Proxmox VE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/489914/"><img src="https://habrastorage.org/webt/ba/4_/p0/ba4_p0pjj8nlzulpcdlsdbez4mo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em artigos anteriores, come√ßamos a falar sobre o que √© o Proxmox VE e como ele funciona. </font><font style="vertical-align: inherit;">Hoje falaremos sobre como voc√™ pode usar o recurso de cluster e mostrar quais vantagens ele oferece.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que √© um cluster e por que √© necess√°rio? </font><font style="vertical-align: inherit;">Um cluster (do cluster ingl√™s) √© um grupo de servidores conectados por canais de comunica√ß√£o de alta velocidade, trabalhando e representando o usu√°rio como um todo. </font><font style="vertical-align: inherit;">Existem v√°rios cen√°rios b√°sicos para usar um cluster:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fornecendo toler√¢ncia a falhas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (alta disponibilidade).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Balanceamento de carga</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Load Balancing).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maior produtividade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (alto desempenho).</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executando</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> computa√ß√£o distribu√≠da</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada cen√°rio apresenta seus pr√≥prios requisitos para componentes de cluster. </font><font style="vertical-align: inherit;">Por exemplo, para um cluster executando computa√ß√£o distribu√≠da, o principal requisito √© uma alta velocidade de opera√ß√µes de ponto flutuante e baixa lat√™ncia da rede. </font><font style="vertical-align: inherit;">Esses agrupamentos s√£o frequentemente usados ‚Äã‚Äãpara fins de pesquisa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde que abordamos o t√≥pico da computa√ß√£o distribu√≠da, quero observar que ainda existe um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistema de grade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(do ingl√™s. grid - lattice, network). </font><font style="vertical-align: inherit;">Apesar da semelhan√ßa geral, n√£o confunda o sistema de grade e o cluster. </font><font style="vertical-align: inherit;">Grade n√£o √© um cluster no sentido usual. </font><font style="vertical-align: inherit;">Ao contr√°rio do cluster, os n√≥s inclu√≠dos na grade costumam ser heterog√™neos e caracterizados por baixa disponibilidade. </font><font style="vertical-align: inherit;">Essa abordagem simplifica a solu√ß√£o de problemas de computa√ß√£o distribu√≠da, mas n√£o permite a cria√ß√£o de um √∫nico todo a partir de n√≥s.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo impressionante de um sistema de grade √© a popular plataforma de computa√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOINC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Berkeley Open Infrastructure for Network Computing). </font><font style="vertical-align: inherit;">Essa plataforma foi criada originalmente para o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projeto SETI @ home</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Busca de Intelig√™ncia Extra-Terrestre em Casa), que lida com o problema de procurar intelig√™ncia extraterrestre atrav√©s da an√°lise de sinais de r√°dio.</font></font></blockquote><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona</font></font></b><div class="spoiler_text">  ,   ,     ,      - (  SETI@home      ).              SETI.       ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que temos um entendimento claro do que √© um cluster, sugerimos considerar como ele pode ser criado e implantado. </font><font style="vertical-align: inherit;">Usaremos o sistema de virtualiza√ß√£o de c√≥digo aberto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxmox VE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de come√ßar a criar um cluster, √© especialmente importante entender claramente as limita√ß√µes e os requisitos do sistema do Proxmox, a saber:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o n√∫mero m√°ximo de n√≥s em um cluster √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todos os n√≥s devem ter a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesma vers√£o do Proxmox</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (h√° exce√ß√µes, mas n√£o s√£o recomendadas para produ√ß√£o);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se no futuro for planejado usar a funcionalidade de alta disponibilidade, o cluster dever√° ter </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pelo menos tr√™s n√≥s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que os n√≥s se comuniquem, as portas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP / 5404</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP / 5405</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para corosync e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP / 22</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para SSH </font><font style="vertical-align: inherit;">devem estar abertas </font><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o atraso da rede entre os n√≥s n√£o deve exceder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 ms</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cria√ß√£o de Cluster</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importante! </font><font style="vertical-align: inherit;">A configura√ß√£o abaixo √© de teste. </font><font style="vertical-align: inherit;">Certifique-se de verificar a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o oficial do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Proxmox VE. </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para iniciar o cluster de teste, levamos tr√™s servidores com o hipervisor Proxmox instalado da mesma configura√ß√£o (2 n√∫cleos, 2 GB de RAM).</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ deseja saber como instalar o Proxmox, recomendamos que leia o artigo anterior - A </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√°gica da virtualiza√ß√£o: um curso introdut√≥rio no Proxmox VE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialmente, ap√≥s a instala√ß√£o do sistema operacional, um √∫nico servidor √© executado no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modo Independente</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2l/b9/1x/2lb91xdrokvieydn63rr9fb7ndo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crie um cluster clicando no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criar cluster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na se√ß√£o correspondente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4k/sr/me/4ksrmekzntmzfig-2ymdwx7oahs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nomeamos o cluster futuro e selecionamos a conex√£o de rede ativa.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cy/ww/bt/cywwbtaea7ogttm77ebrwtwo7f8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clique no bot√£o Criar. </font><font style="vertical-align: inherit;">O servidor ir√° gerar uma chave de 2048 bits e grav√°-la juntamente com os par√¢metros do novo cluster nos arquivos de configura√ß√£o.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qv/r3/wy/qvr3wyzqfxrgscstbwz0mzxztv0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A inscri√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TASK OK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indica uma opera√ß√£o bem-sucedida. </font><font style="vertical-align: inherit;">Agora, olhando as informa√ß√µes gerais sobre o sistema, fica claro que o servidor mudou para o modo de cluster. </font><font style="vertical-align: inherit;">At√© o momento, o cluster consiste em apenas um n√≥, ou seja, ainda n√£o possui os recursos para os quais o cluster √© necess√°rio.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/zl/17/cvzl17xrzcnv4tbjlgcgutbd6vc.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingressando em um cluster</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de conectar-se ao cluster criado, precisamos obter informa√ß√µes para concluir a conex√£o. </font><font style="vertical-align: inherit;">Para fazer isso, v√° para a se√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e clique no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Join Information</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7g/se/mi/7gsemira1cy79g3f9yxopfxc_mo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na janela que se abre, estamos interessados ‚Äã‚Äãno conte√∫do do campo com o mesmo nome. </font><font style="vertical-align: inherit;">Ele precisar√° ser copiado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/-i/7h/rw-i7hhyo_yqrqy-o9oh2jxmi9g.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os par√¢metros de conex√£o necess√°rios s√£o codificados aqui: endere√ßo do servidor para conex√£o e impress√£o digital. </font><font style="vertical-align: inherit;">Passamos para o servidor que precisa ser inclu√≠do em um cluster. </font><font style="vertical-align: inherit;">Clique no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingressar no cluster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, na janela exibida, cole o conte√∫do copiado.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bt/fh/0v/btfh0vp9foxegb2lcca-d-kww1c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os campos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endere√ßo de par</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impress√£o digital</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√£o preenchidos automaticamente. </font><font style="vertical-align: inherit;">Digite a senha raiz do n√≥ n√∫mero 1, selecione a conex√£o de rede e clique no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingressar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/v-/um/i3/v-umi3rqffairr3yhnn2tz2uafi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voc√™ ingressa em um cluster, a p√°gina da GUI pode parar de atualizar. </font><font style="vertical-align: inherit;">Isso √© normal, basta recarregar a p√°gina. </font><font style="vertical-align: inherit;">Da mesma maneira, adicionamos mais um n√≥ e, como resultado, recebemos um cluster completo de 3 n√≥s em funcionamento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tc/wb/mx/tcwbmxrp1umdagapsce7tv4qfie.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora podemos controlar todos os n√≥s do cluster de uma GUI.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e4/at/cb/e4atcbt-_ihvdai9jjjmiamgrds.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Organiza√ß√£o de alta disponibilidade</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Proxmox pronto para uso suporta a funcionalidade de organiza√ß√£o de alta disponibilidade para m√°quinas virtuais e cont√™ineres LXC. </font><font style="vertical-align: inherit;">O utilit√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha-manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> detecta e processa erros e falhas executando um failover de um n√≥ com falha para um n√≥ em funcionamento. </font><font style="vertical-align: inherit;">Para que o mecanismo funcione corretamente, √© necess√°rio que as m√°quinas e cont√™ineres virtuais tenham um armazenamento de arquivos comum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a ativa√ß√£o da funcionalidade de alta disponibilidade, a pilha de software do ha-manager come√ßar√° a monitorar continuamente o status da m√°quina virtual ou do cont√™iner e a interagir de forma ass√≠ncrona com outros n√≥s no cluster.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anexar armazenamento compartilhado</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, implantamos um pequeno armazenamento de arquivo NFS em 192.168.88.18. </font><font style="vertical-align: inherit;">Para que todos os n√≥s do cluster possam us√°-lo, √© necess√°rio fazer as seguintes manipula√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selecionamos no menu da interface da web </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter - Armazenamento - Adicionar - NFS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vr/pd/3u/vrpd3uedlwasqpg0m19g8pvtb2o.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preencha os campos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Na lista suspensa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exportar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">selecione o diret√≥rio desejado dentre os dispon√≠veis e, na lista </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conte√∫do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , os tipos de dados necess√°rios. </font><font style="vertical-align: inherit;">Depois de clicar no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o </font><font style="vertical-align: inherit;">armazenamento ser√° conectado a todos os n√≥s do cluster.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6d/mu/fy/6dmufyavxpq4dcxaqxarozuughm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao criar m√°quinas virtuais e cont√™ineres em qualquer um dos n√≥s, especificamos nosso </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazenamento</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como armazenamento.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Personalizar HA</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, crie um cont√™iner com o Ubuntu 18.04 e configure a alta disponibilidade para ele. </font><font style="vertical-align: inherit;">Ap√≥s criar e ativar o cont√™iner, acesse a se√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter - HA - Adicionar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No campo que √© aberto, especifique o ID da m√°quina / cont√™iner virtual e o n√∫mero m√°ximo de tentativas para reiniciar e mover-se entre os n√≥s.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se esse valor for excedido, o hipervisor marcar√° a VM como com falha e a transferir√° para o estado Erro, ap√≥s o qual deixar√° de executar qualquer a√ß√£o com ela.</font></font></blockquote><div style="text-align:center;"><img src="https://habrastorage.org/webt/p4/h9/ng/p4h9nglzk5gtsojtebmvlny9cvq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s clicar no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o </font><font style="vertical-align: inherit;">utilit√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ha-manager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> notificar√° todos os n√≥s do cluster que a VM com o ID especificado est√° sendo monitorada e, se cair, deve ser reiniciada em outro n√≥.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ni/6x/q5/ni6xq5soctxwt3-abx9bs0gvo8o.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa um acidente</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ver como o mecanismo de comuta√ß√£o funciona, vamos pagar de maneira anormal a fonte de alimenta√ß√£o do n√≥1. </font><font style="vertical-align: inherit;">Olhamos de outro n√≥ o que acontece com o cluster. </font><font style="vertical-align: inherit;">Vemos que o sistema registrou uma falha.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/df/wc/ve/dfwcve9i2iplppnbexfsomn0w40.png"></div><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A opera√ß√£o do mecanismo de alta disponibilidade n√£o significa a opera√ß√£o continuada da VM. </font><font style="vertical-align: inherit;">Assim que o n√≥ "cai", a opera√ß√£o da VM √© temporariamente interrompida at√© a reinicializa√ß√£o autom√°tica em outro n√≥.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E aqui come√ßa a "m√°gica" - o cluster reatribuiu automaticamente o n√≥ para executar nossa VM e, em 120 segundos, o trabalho foi restaurado automaticamente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/ep/j6/slepj6ytjfwkdkfx--i7kvrxega.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s extinguimos o node2 na nutri√ß√£o. </font><font style="vertical-align: inherit;">Vamos ver se o cluster pode suportar e a VM retornar√° ao estado de funcionamento automaticamente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7c/ge/k6/7cgek6uuanswhta3osmoshozk10.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, como vemos, tivemos um problema com o fato de o √∫nico n√≥ sobrevivente n√£o ter mais quorum, o que desabilita automaticamente a HA. </font><font style="vertical-align: inherit;">Damos o comando para for√ßar a instala√ß√£o do quorum no console.</font></font><br>
<br>
<pre><code class="plaintext hljs">pvecm expected 1</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/n6/jw/qkn6jwdgtovfx9ns7kt2veahb0w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s 2 minutos, o mecanismo de alta disponibilidade funcionou corretamente e, ao n√£o encontrar o n√≥2, lan√ßou nossa VM no n√≥3.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/6s/z2/xm/6sz2xmx1djx-_rm6k_y3uz6xcpu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que ativamos o n√≥1 e o n√≥2 novamente, o cluster foi totalmente restaurado. </font><font style="vertical-align: inherit;">Observe que a VM n√£o migra de volta para o n√≥1, mas isso pode ser feito manualmente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falamos sobre como o mecanismo de cluster no Proxmox funciona e tamb√©m mostramos como a HA √© configurada para m√°quinas e cont√™ineres virtuais. </font><font style="vertical-align: inherit;">O uso adequado de cluster e HA melhora muito a confiabilidade da infraestrutura e tamb√©m fornece recupera√ß√£o de desastres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de criar um cluster, voc√™ precisa planejar imediatamente para que finalidades ele ser√° usado e quanto precisar√° ser dimensionado no futuro. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m precisa verificar a disponibilidade da infraestrutura de rede com atrasos m√≠nimos, para que o futuro cluster funcione sem falhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diga-nos - voc√™ usa recursos de cluster no Proxmox? </font><font style="vertical-align: inherit;">Vejo voc√™ nos coment√°rios. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artigos anteriores sobre o hipervisor Proxmox VE:</font></font></i><br>
<br>
<ul>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A m√°gica da virtualiza√ß√£o: um curso introdut√≥rio no Proxmox VE</font></font></a></i></li>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre backups no Proxmox VE</font></font></a></i></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt489900/index.html">Antipadr√µes do PostgreSQL: alterando dados ignorando um gatilho</a></li>
<li><a href="../pt489902/index.html">Como medir a efic√°cia de uma carteira de investimentos: 3 abordagens pr√°ticas</a></li>
<li><a href="../pt489904/index.html">Por que e como estamos testando a atualiza√ß√£o</a></li>
<li><a href="../pt489906/index.html">Provador virtual em OpenCV</a></li>
<li><a href="../pt489912/index.html">A dor e o sofrimento ao depurar microsservi√ßos no desenvolvimento web</a></li>
<li><a href="../pt489916/index.html">Protocolo de comunica√ß√£o front-end estruturado Protobuf ou JSON?</a></li>
<li><a href="../pt489918/index.html">Como implementamos o projeto do cart√£o virtual de combust√≠vel</a></li>
<li><a href="../pt489920/index.html">Sites, v√° para IPv6, dois</a></li>
<li><a href="../pt489924/index.html">Onde o Elasticsearch come√ßa</a></li>
<li><a href="../pt489926/index.html">Black Friday: um olhar sobre a carga atrav√©s dos olhos do desenvolvedor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>