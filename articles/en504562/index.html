<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐫 🙋🏿 🧗🏿 Proxmox VE incremental backup with VBR 🎿 🌏 🎚️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In one of the previous articles in the Proxmox VE hypervisor series, we already talked about how to backup using regular tools. Today we show how to u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Proxmox VE incremental backup with VBR</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/504562/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6u/nl/ol/6unlolfmjashv0lotsjhjbgc1gg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In one of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previous articles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the Proxmox VE hypervisor series, we already talked about how to backup using regular tools. </font><font style="vertical-align: inherit;">Today we show how to use the excellent Veeam® Backup &amp; Replication ™ 10 tool for the same purpose. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Backups have an explicit quantum essence. </font><font style="vertical-align: inherit;">Until you tried to recover from the backup, it is in superposition. </font><font style="vertical-align: inherit;">He is both successful and not. ” </font><font style="vertical-align: inherit;">(found on the Internet)</font></font></i><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disclaimer:</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No, I'm not saying that this is the perfect way to backup. No, it cannot be recommended for production. No, I do not guarantee the perfect integrity of the backups made. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, all this works and is quite suitable for many users and novice system administrators who take the first steps in the study of virtualization and backup systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Backup is perhaps one of the most important processes on which the work of any company depends. There is nothing more expensive than data stored in corporate information systems, and there is nothing worse than the lack of the ability to recover it in the event of a failure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It often happens that you need to think about the need for backup and choosing a tool only after an emergency that has already occurred, associated with the loss of critical data. </font><font style="vertical-align: inherit;">As the development of virtualization technologies, backup applications began to focus on close interaction with hypervisors. </font><font style="vertical-align: inherit;">Veeam® Backup &amp; Replication ™ is no exception, with extensive backup options in virtualized environments. </font><font style="vertical-align: inherit;">Today we’ll show you how to configure it to work with Proxmox VE.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hypervisor Setup</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will use the current version of Proxmox at the time of writing - 6.2-1. </font><font style="vertical-align: inherit;">This version was released on May 12, 2020 and contains a lot of useful changes, which we will discuss in one of the following articles. </font><font style="vertical-align: inherit;">For now, let's start preparing the hypervisor. </font><font style="vertical-align: inherit;">The main task is to install Veeam® Agent for Linux on a redundant host with Proxmox. </font><font style="vertical-align: inherit;">But before that we take a few steps.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System preparation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We </font><font style="vertical-align: inherit;">install the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utility </font><font style="vertical-align: inherit;">, which is absent in the system if Proxmox was not installed on an existing Linux system, but as a standalone OS from an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official image</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We will also need the pve headers of the kernel. </font><font style="vertical-align: inherit;">We go to the server through SSH and add a repository that works without a support subscription (officially it is not recommended for production, but it contains the packages we need):</font></font><br>
<br>
<pre><code class="plaintext hljs">echo "deb http://download.proxmox.com/debian/pve buster pve-no-subscription" &gt;&gt; /etc/apt/sources.list</code></pre><br>
<pre><code class="plaintext hljs">apt update</code></pre><br>
<pre><code class="plaintext hljs">apt install sudo pve-headers</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After this procedure, be sure to restart the server.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Veeam® Agent</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Download </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Veeam® Agent for Linux </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">deb package</font></a><font style="vertical-align: inherit;"> from the official website (an account is required), arm yourself with an SFTP client and upload the received deb package to the server. </font><font style="vertical-align: inherit;">Install the package and update the list of programs in the repositories that this package adds:</font></font><br>
<br>
<pre><code class="plaintext hljs">dpkg -i veeam-release-deb_1.x.x_amd64.deb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Updating the repositories again:</font></font><br>
<br>
<pre><code class="plaintext hljs">apt update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install the agent itself:</font></font><br>
<br>
<pre><code class="plaintext hljs">apt install veeam</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We check that everything was installed correctly:</font></font><br>
<br>
<pre><code class="plaintext hljs">dkms status</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The answer would be something like this:</font></font><br>
<br>
<pre><code class="plaintext hljs">veeamsnap, 4.0.0.1961, 5.4.41-1-pve, x86_64: installed</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring Veeam® Backup &amp; Replication ™</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adding a repository</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, you can also store backups directly on the server with Veeam® Backup &amp; Replication ™ deployed, but it’s more convenient to use external storage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go to the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BACKUP INFRASTRUCTURE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/n0/do/z9/n0doz9jyudpcf-hayqu6njcstng.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Select the Backup Repositories item, click the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add Repository</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">and select </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Network attached storage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the window that appears </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ds/le/ew/dsleewxwyfrbxi64ibhnkgbl3hm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, let's take a test SMB-storage, I have this is the usual QNAP:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wn/2v/75/wn2v75pnyilvwfm2wdnez0gff3e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fill in the name and description, then click the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ae/lu/c1/aeluc1vlc3rjv8yfjkkegksfqak.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enter the address of the SMB storage and, if it requires authorization, click Add to add access details:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/5g/5n/ku5g5nrjheqx_loj6dicmfylzmm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fill in the username and password to access the SMB storage, and then click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and returning to the previous window, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/z5/ty/dqz5tyipy4tpabxyce7azqvwbos.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If everything is done without errors, the program will connect to the repository, request information about the available disk space, and display the following dialog box. </font><font style="vertical-align: inherit;">In it, set additional parameters (if necessary) and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ed/gd/mk/edgdmktah8gzp2ficmybhka_qio.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next window, you can leave all the default settings and also click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ob/-5/xh/ob-5xhmenemijzrsdka1lonr4a4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We check that the necessary components are installed and are in the status </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">already exists</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and click the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apply</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0a/gv/ix/0agvixnl2-ev6qlpi1dssnj3esy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At this point, Veeam® Backup &amp; Replication ™ will once again connect to the repository, determine the necessary parameters and create a repository. </font><font style="vertical-align: inherit;">Click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/9x/sv/79/9xsv79akohraqucyp83uh6syqo8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We check the total information about the added repository and click the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finish</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/e6/2g/zoe62g6kxg07rl5_qo95l7y1m9y.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The program will automatically offer to save your configuration files in a new repository. </font><font style="vertical-align: inherit;">We do not need this, so we answer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tp/vs/9-/tpvs9-do-0wpdyqhf_fzr0sg7nk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Repository successfully added:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fp/cy/qy/fpcyqy80-k4ktz59aqchgkg2-9y.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating a backup job</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the main window of Veeam® Backup &amp; Replication ™, click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backup Job</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux computer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Choose </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> type </font><font style="vertical-align: inherit;">and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Managed by backup server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mode </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/1s/oi/wz/1soiwz1snio9rt2aa8lsuz7xnou.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We give a name to the assignment and optionally add a description. </font><font style="vertical-align: inherit;">Then click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hi/ji/fy/hijifygvb4srir_ecso7zii2tvk.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we need to make all the servers with Proxmox that we will back up. To do this, click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Individual computer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Enter the hostname or server IP address and access details. Thus, we form the list of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protected computers</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d_/wp/kp/d_wpkp2p_szef1vyd5bwde6blg0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now a very important point, namely the choice of data to be added to the backup. Everything will depend on where exactly your virtual machines are located. If you want to add only any logical volume, you need the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Volume level backup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mode </font><font style="vertical-align: inherit;">and choose the path to the logical volume or device, for example </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / pve</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . All other actions are identical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For this article, we will show how the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File level backup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mode works </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wq/6b/5p/wq6b5psnc7jay48_xbrj2_ureee.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the next window, we create a list of directories for backup. Click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and prescribe the directories where virtual machine configuration files are stored. By default, this is the directory </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / pve / nodes / pve / qemu-server /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . If you use not only virtual machines, but also LXC containers, add the directory </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / pve / nodes / pve / lxc /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . In my case, it is also the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Having formed the list of directories in this way, click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/_k/_d/yd/_k_dydc6dnhx4mngj4cuuisokqu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the drop-down list of repositories, select </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> created earlier. </font><font style="vertical-align: inherit;">We determine the length of the chain for incremental backup. </font><font style="vertical-align: inherit;">The more points there are in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retention policy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the more space you will save. </font><font style="vertical-align: inherit;">But along with this, the reliability of the backup will decrease. </font><font style="vertical-align: inherit;">Reliability is more important to me than the amount of storage space, so I put 4 points. </font><font style="vertical-align: inherit;">You can take the standard value of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We continue to configure the task by clicking </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wk/ae/v5/wkaev5az-3ruj4n-gjuv43oz9vo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here we leave the parameters unchanged, just go to the next window:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tt/4p/b-/tt4pb-cw4quxwulze1xcjjohx_4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We configure the scheduler. </font><font style="vertical-align: inherit;">This is one of the coolest features to make life easier for the system administrator. </font><font style="vertical-align: inherit;">In the example, I chose to automatically start the backup every day at 2 a.m. </font><font style="vertical-align: inherit;">Another great feature is the ability to interrupt the backup task if we go beyond the time limit of the allotted “backup window”. </font><font style="vertical-align: inherit;">Its exact schedule is configured through the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Window</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e-/7j/7h/e-7j7hfdz5fdru4lft7cul74fr0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Again, for example, suppose that we perform backups only during non-working hours on weekdays, and on weekends we are generally not limited in time. </font><font style="vertical-align: inherit;">We form such a beautiful table, return to the previous window and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apply</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7g/ob/ii/7gobiidnihb8a9jsrbsdt8yp9c8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It remains only to check the summary information about the task and click the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finish</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2s/mk/6m/2smk6mspmnfayuhhxxi1yjezj3k.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This completes the creation of the backup job.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backup</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is elementary here. </font><font style="vertical-align: inherit;">In the main window of the program, select the created task and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The system will automatically connect to our server (or several servers), check the availability of the storage and reserve the necessary amount of disk space. </font><font style="vertical-align: inherit;">Then, in fact, the backup process will begin, and upon completion we will receive comprehensive information about the process.</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If a problem of the form </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Failed to load module [veeamsnap] with parameters [zerosnapdata = 1 debuglogging = 0] occurs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> during the backup startup process </font><font style="vertical-align: inherit;">, then you need to rebuild the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veeamsnap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">in accordance with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></blockquote><div style="text-align:center;"><img src="https://habrastorage.org/webt/ts/do/cm/tsdocmchujzdj5nxvujwmrroffs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is especially interesting is that on the server itself we can see not only a list of all completed backup tasks, but also watch the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veeam</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command in real time </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/li/lp/tk/lilptkhpxrygvey6krcgbltfvvm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Predicting the question of why the console looks so strange, I’ll say right away: I really like how the console looks on the screen of a warm CRT tube monitor. </font><font style="vertical-align: inherit;">This is done using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cool-retro-term</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> terminal emulator </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data recovery</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the most important question. </font><font style="vertical-align: inherit;">But how to recover data if something irreparable happened? </font><font style="vertical-align: inherit;">For example, they accidentally deleted the wrong virtual machine. </font><font style="vertical-align: inherit;">In the Proxmox GUI, it disappeared altogether; nothing was left in the storage at the machine site. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The recovery process is simple. </font><font style="vertical-align: inherit;">We go to the Proxmox console and enter the command:</font></font><br>
<br>
<pre><code class="plaintext hljs">veeam</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will see a list of completed backups. </font><font style="vertical-align: inherit;">Select the arrow with the arrows and press the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> key </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Next, select a recovery point and press </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lt/du/j8/ltduj8hywtb1zwrmauzoeplnw4c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After a couple of seconds, the recovery point will be mounted in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ mnt / backup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All that remains is to copy the virtual drives and configuration files of the virtual machines in their places, after which the "killed" machine will appear automatically in the Proxmox VE GUI. </font><font style="vertical-align: inherit;">You can run it in the usual way. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To unmount the recovery point, you should not do this manually, but you must press the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> key </font><font style="vertical-align: inherit;">in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veeam</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utility </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
May the Force be with you! </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Previous articles on the Proxmox VE hypervisor:</font></font></i><br>
<br>
<ul>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> :    Proxmox VE</a></i></li>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">   Proxmox VE</a></i></li>
<li><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  Proxmox VE</a></i></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504524/index.html">Typical COVID-19 Epidemic Development Model</a></li>
<li><a href="../en504554/index.html">Unity Terrane and Mesh Blending</a></li>
<li><a href="../en504556/index.html">Gesture management: handling gesture conflicts. Part 3</a></li>
<li><a href="../en504558/index.html">Is vaccination mandatory a new reality?</a></li>
<li><a href="../en504560/index.html">Let's discuss the face of domestic crowdfunding</a></li>
<li><a href="../en504564/index.html">IoT in my life. How to create a smart office, as well as track the growth of potatoes in your apartment thanks to IoT</a></li>
<li><a href="../en504566/index.html">Table in Atlassian Confluence based on data from a REST request</a></li>
<li><a href="../en504568/index.html">Isaac Asimov: Where do people get new ideas from?</a></li>
<li><a href="../en504572/index.html">Speak like Winston Churchill: who needs to sell their soul to communicate in English SO</a></li>
<li><a href="../en504576/index.html">How home audio developed - from song nights to the first mechanical players</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>