<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏽 🗼 🗺️ Un autre regard sur la question "Dois-je besoin de défragmentation pour SSD" 👩🏽‍🤝‍👨🏼 🛳️ 🧥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sans aucun doute, la question posée dans le titre de l'article n'est pas nouvelle, elle a été soulevée plus d'une fois et un consensus s'est dégagé à ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Un autre regard sur la question "Dois-je besoin de défragmentation pour SSD"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494614/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sans aucun doute, la question posée dans le titre de l'article n'est pas nouvelle, elle a été soulevée plus d'une fois et un consensus s'est dégagé à son sujet «pas vraiment nécessaire, et peut même être nuisible». </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">récente discussion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les commentaires m'a fait réfléchir à nouveau.</font></font></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au fil du temps, tout SSD se fragmentera encore fortement (en interne, en FTL) ... Un SSD fraîchement enregistré avec une lecture linéaire donnera une vitesse élevée, mais s'il a déjà fonctionné, il sera beaucoup plus faible, car il ne sera linéaire que pour vous.</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, </font><font style="vertical-align: inherit;">cela ne devrait </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">généralement</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pas se produire: soit nous écrivons «petit à petit» dans de petits fichiers / petits blocs de méta-informations du FS (la vitesse de lecture linéaire dont nous ne nous soucions pas vraiment), soit nous écrivons «beaucoup» dans de gros fichiers et tout ira bien. </font><font style="vertical-align: inherit;">Il arrive également que vous ajoutiez de petits blocs à des fichiers volumineux - des journaux, par exemple, mais ils sont relativement de courte durée et je ne vois aucun problème particulier ici. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il était facile d'imaginer un scénario très réel, dans lequel la même fragmentation interne du SSD pourrait se produire: un fichier de base de données dans lequel il y a un enregistrement aléatoire assez actif. </font><font style="vertical-align: inherit;">Au fil du temps, il (restant non fragmenté au niveau du système d'exploitation) sera physiquement très fragmenté, ce qui peut réduire considérablement la vitesse de numérisation, de sauvegarde, etc.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour vérification, j'ai écrit un script et exécuté des tests.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spoiler: le problème est présent (affecte de manière significative les performances) sur un seul des modèles proposés (et il est positionné par le constructeur non pas comme un datacenter, mais comme un ordinateur de bureau / portable).</font></font></p><a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est à propos de quoi? </font><font style="vertical-align: inherit;">Quoi d'autre fragmentation à l'intérieur du SSD?</font></font></b><div class="spoiler_text"><p>   , SSD   .  NAND flash   ( )   .     SSD   512- ( 4096-) ,       .<br>
 -  ,   ,  FTL (flash translation layer):   flash-   ,  ( )   ,     , -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">log-  </a>.<br>
      ,    , , ,     —        .</p><br>
<p>,    FTL, , ,    ,       . ,        .<br>
     .</p></div></div><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'idée du script: on crée un fichier de plusieurs gigaoctets, rempli de données aléatoires, mesure la vitesse des lectures séquentielles. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, en utilisant l'accès aléatoire, nous réécrivons une partie du fichier de test et mesurons à nouveau la vitesse de lecture linéaire. </font><font style="vertical-align: inherit;">Si nos soupçons sont vrais, alors la lecture du fichier va ralentir. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après chaque écriture, nous faisons trois opérations de lecture avec un retard entre eux au cas où un lecteur dans la Défragmentation PerForm de fond et </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puis</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la vitesse de lecture améliorée.</font></font></p><br>
<div class="spoiler"><b class="spoiler_title">  ,    SSD  </b><div class="spoiler_text"><p>   ,       ,  -   ,  ,  .  -         ,   ,    ,  , , .<br>
   TRIM:   SSD  «»,       ,      FTL.              NAND flash,    .        , ,        .        SSD    ,  .</p><br>
<p> ,     ,            ,     .</p><br>
<p>,     SSD   ( linux     <code>/dev/urandom</code>).</p></div></div><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><p>     .</p><br>
<p>   linux c dash, coreutils  fio  debian buster,       ,    freebsd         «».</p><br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> preparing...<font></font>
dd <span class="hljs-keyword">if</span>=/dev/urandom of=testfile bs=1M count=4096 status=none<font></font>
sync<font></font>
<span class="hljs-keyword">for</span> A <span class="hljs-keyword">in</span> 1 2 3; <span class="hljs-keyword">do</span><font></font>
    sleep 10<font></font>
    dd <span class="hljs-keyword">if</span>=testfile of=/dev/null bs=1M iflag=direct
<span class="hljs-keyword">done</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> A <span class="hljs-keyword">in</span> 50 200 800 4000; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> fio: write <span class="hljs-variable">${A}</span>M...<font></font>
    fio --name=test1 --filename=testfile --bs=4k --iodepth=1 --numjobs=1  --rw=randwrite  --io_size=<span class="hljs-variable">${A}</span>M --randrepeat=0 --direct=1 --size=4096M &gt; /dev/null<font></font>
    sync<font></font>
<font></font>
    <span class="hljs-keyword">for</span> B <span class="hljs-keyword">in</span> 1 2 3; <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">echo</span> sleep <span class="hljs-variable">${B}</span>0<font></font>
        sleep <span class="hljs-variable">${B}</span>0<font></font>
        dd <span class="hljs-keyword">if</span>=testfile of=/dev/null bs=1M iflag=direct
    <span class="hljs-keyword">done</span>
<span class="hljs-keyword">done</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> sleep 3600<font></font>
sleep 3600<font></font>
dd <span class="hljs-keyword">if</span>=testfile of=/dev/null bs=1M iflag=direct</code></pre></div></div><br>
<p>,  NVMe- intel        windows;    , stackexchange <del> - </del>     </p><br>
<div class="spoiler"><b class="spoiler_title">  ps</b><div class="spoiler_text"><p>    <code>fio</code>;   exe-        .</p><br>
<pre><code class="powershell hljs"><span class="hljs-variable">$testfile</span> = <span class="hljs-string">"c:\temp\testfile"</span>
<span class="hljs-variable">$fio</span> = <span class="hljs-string">"c:\temp\fio-3.18-x64\fio"</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"preparing..."</span><font></font>
<font></font>
<span class="hljs-variable">$filestream</span> = <span class="hljs-built_in">New-Object</span> System.IO.FileStream(<span class="hljs-variable">$testfile</span>, <span class="hljs-string">"Create"</span>)
<span class="hljs-variable">$binarywriter</span> = <span class="hljs-built_in">New-Object</span> System.IO.BinaryWriter(<span class="hljs-variable">$filestream</span>)
<span class="hljs-variable">$out</span> = <span class="hljs-built_in">new-object</span> byte[] <span class="hljs-number">1048576</span><font></font>
<font></font>
<span class="hljs-keyword">For</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">1</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-le</span> <span class="hljs-number">4096</span>; <span class="hljs-variable">$i</span>++) {<font></font>
    (<span class="hljs-built_in">new-object</span> Random).NextBytes(<span class="hljs-variable">$out</span>);
    <span class="hljs-variable">$binarywriter</span>.write(<span class="hljs-variable">$out</span>)<font></font>
}<font></font>
<span class="hljs-variable">$binarywriter</span>.Close()<font></font>
<font></font>
<span class="hljs-keyword">For</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">1</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-le</span> <span class="hljs-number">3</span>; <span class="hljs-variable">$i</span>++) {
    <span class="hljs-built_in">sleep</span> <span class="hljs-number">10</span>
    <span class="hljs-variable">$time</span> = <span class="hljs-built_in">Measure-Command</span> {
        <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-string">"<span class="hljs-variable">$fio</span> --name=test1 --filename=<span class="hljs-variable">$testfile</span> --bs=1M --iodepth=1 --numjobs=1  --rw=read --direct=1 --size=4096M"</span> *&gt;<span class="hljs-variable">$null</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-variable">$seconds</span> = <span class="hljs-variable">$time</span>.Minutes*<span class="hljs-number">60</span>+<span class="hljs-variable">$time</span>.Seconds+<span class="hljs-variable">$time</span>.Milliseconds/<span class="hljs-number">1000</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"read in <span class="hljs-variable">$seconds</span>"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$A</span> <span class="hljs-keyword">in</span> <span class="hljs-number">50</span>,<span class="hljs-number">200</span>,<span class="hljs-number">800</span>,<span class="hljs-number">4000</span>) {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"fio: write <span class="hljs-variable">$</span>{A}M..."</span>
    <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-string">"<span class="hljs-variable">$fio</span> --name=test1 --filename=<span class="hljs-variable">$testfile</span> --bs=4k --iodepth=1 --numjobs=1  --rw=randwrite  --io_size=<span class="hljs-variable">$</span>{A}M --randrepeat=0 --direct=1 --size=4096M"</span> *&gt;<span class="hljs-variable">$null</span>
    <span class="hljs-keyword">For</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">10</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-le</span> <span class="hljs-number">30</span>; <span class="hljs-variable">$i</span>+=<span class="hljs-number">10</span>) {
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"sleep <span class="hljs-variable">$i</span>"</span>
        <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$i</span>
        <span class="hljs-variable">$time</span> = <span class="hljs-built_in">Measure-Command</span> {
            <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-string">"<span class="hljs-variable">$fio</span> --name=test1 --filename=<span class="hljs-variable">$testfile</span> --bs=1M --iodepth=1 --numjobs=1  --rw=read --direct=1 --size=4096M"</span> *&gt;<span class="hljs-variable">$null</span><font></font>
        }<font></font>
<font></font>
        <span class="hljs-variable">$seconds</span> = <span class="hljs-variable">$time</span>.Minutes*<span class="hljs-number">60</span>+<span class="hljs-variable">$time</span>.Seconds+<span class="hljs-variable">$time</span>.Milliseconds/<span class="hljs-number">1000</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"read in <span class="hljs-variable">$seconds</span>"</span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-built_in">rm</span> <span class="hljs-variable">$testfile</span></code></pre></div></div><br>
<p>  :</p><br>
<ul>
<li>      :         ,     «» (    )   ,           ;</li>
<li> windows -         (, ,   ,      );</li>
<li>      (    )    .</li>
</ul><br>
<p>  ( )   4   :</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th>     </th>
<th>   50</th>
<th>+200</th>
<th>+800</th>
<th>+4000</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>intel S3510 SSDSC2BB480G6</strong></td>
<td>10.7</td>
<td>10.7</td>
<td>10.8</td>
<td>10.8</td>
<td>10.8</td>
</tr>
<tr>
<td>toshiba XG5 KXG50ZNV512G</td>
<td>1.9</td>
<td>2.9</td>
<td>3.7</td>
<td>4.8</td>
<td>6.8</td>
</tr>
<tr>
<td><strong>samsung PM963 MZQLW960HMJP</strong></td>
<td>2.8</td>
<td>3.2</td>
<td>3.5</td>
<td>3.7</td>
<td>4.2</td>
</tr>
<tr>
<td><strong>samsung PM983 MZQLB960HAJR</strong></td>
<td>3.3</td>
<td>3.6</td>
<td>3.4</td>
<td>3.4</td>
<td>3.4</td>
</tr>
<tr>
<td>samsung PM981 MZVLB1T0HALR</td>
<td>1.8</td>
<td>1.8</td>
<td>2.1</td>
<td>2.5</td>
<td>3.5</td>
</tr>
<tr>
<td><strong>samsung PM1725b MZPLL1T6HAJQ</strong></td>
<td>1.8</td>
<td>1.9</td>
<td>2.0</td>
<td>2.3</td>
<td>2.9</td>
</tr>
<tr>
<td><strong>micron 5200 eco</strong></td>
<td>9.3</td>
<td>9.8</td>
<td>10.4</td>
<td>12.2</td>
<td>10.7</td>
</tr>
<tr>
<td><strong>samsung PM883 MZ7LH1T9HMLT</strong></td>
<td>7.9</td>
<td>7.9</td>
<td>8.1</td>
<td>8.1</td>
<td>8.0</td>
</tr>
<tr>
<td><strong>intel P3520</strong> (win)</td>
<td>5.8</td>
<td>5.9</td>
<td>6.0</td>
<td>6.1</td>
<td>5.8</td>
</tr>
<tr>
<td><strong>intel P4500</strong> (win)</td>
<td>4.2</td>
<td>4.2</td>
<td>4.3</td>
<td>4.4</td>
<td>4.3</td>
</tr>
</tbody>
</table></div><br>
<p>  DC  ( — /);  SATA,   NVMe, ,   .</p><br>
<p> ,          PM981         ( , ,  ),       —   3.5 ,      SATA .<br>
  ,           ,   .</p><br>
<p>   :     SSD     ,  ,   ,          (  intel, ,   ;   samsung   ,       ).</p><br>
<p>            (, -  NAND flash).<br>
    XG5:     ,    SMART   &gt;&gt;150,       ­—  300-400  ,   flash  ,        SSD.</p><br>
<p>      :            mysql   100. ,         ,   «»  mysql    ( 600/),              (&gt;2/).</p><br>
<div class="spoiler"><b class="spoiler_title">     SSD</b><div class="spoiler_text"><p><del>  ,        :  ,  ,   .     ,       downtime (      -        ).     ,   ,     .</del><br>
       (   )  SSD:</p><br>
<pre><code class="bash hljs">sync<font></font>
fsfreeze -f /mountpoint<font></font>
dd  <span class="hljs-keyword">if</span>=/dev/nvme0n1p2 of=/dev/nvme0n1p2 bs=512M iflag=direct oflag=direct status=progress<font></font>
fsfreeze -u /mountpoint</code></pre><br>
<p>    «»       .        -  ,         ,   ,    -.    «»:     100%,   SSD    «   ,      TRIM» (       ,     TRIM,     ,   ).<br>
 ,  «<del></del>    »   .</p></div></div><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résumé: La</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> défragmentation peut être utile pour </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certains</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SSD, mais </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas tout à fait la même</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (pas du tout?) Comme pour le disque dur. </font><font style="vertical-align: inherit;">Il est important pour nous non seulement que le fichier soit situé dans une chaîne continue de secteurs, mais aussi que l'enregistrement dans ces secteurs soit séquentiel.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Je serais reconnaissant aux lecteurs d'exécuter le script à leur place et de donner des numéros pour leurs SSD, car ma sélection de disques est plutôt unilatérale.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494604/index.html">Boîte de stérilisation UV pour la réutilisation des masques jetables</a></li>
<li><a href="../fr494606/index.html">Comment observer la lune et les planètes</a></li>
<li><a href="../fr494608/index.html">Se préparer pour Ludum Dare</a></li>
<li><a href="../fr494610/index.html">Livres pour podcasteurs débutants: ce qu'il faut lire pour gagner et monétiser des programmes conversationnels</a></li>
<li><a href="../fr494612/index.html">Boutique en ligne côté client Blazor: Partie 3 - Présentation des produits</a></li>
<li><a href="../fr494620/index.html">Comment remplacer une action cible et déléguer par des fermetures</a></li>
<li><a href="../fr494622/index.html">Pas de masques, mais vous détenez 2/2</a></li>
<li><a href="../fr494630/index.html">Installez micropython sur ESP8266 et travaillez avec lui sous Linux (pour les débutants)</a></li>
<li><a href="../fr494632/index.html">Quatuor 9: Allegro | Performance</a></li>
<li><a href="../fr494636/index.html">Analyse financière générale en Python (Partie 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>