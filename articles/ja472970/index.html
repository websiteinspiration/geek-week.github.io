<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏽 📜 🌈 Telegramプロトコルと組織的アプローチに対する批判。パート1、技術：クライアントをゼロから作成した経験-TL、MT 🕣 🧙🏾 📡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、テレグラムの素晴らしさ、ネットワークシステムの構築におけるDurov兄弟の素晴らしさと経験の高さなどについての投稿がHabréに頻繁に掲載されています。同時に、実際に技術的なデバイスに突入した人はごくわずかです-最大の使用はJSONに基づいた非常にシンプルな（そしてMTProtoとは非常に異な...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Telegramプロトコルと組織的アプローチに対する批判。パート1、技術：クライアントをゼロから作成した経験-TL、MT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472970/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、テレグラムの素晴らしさ、ネットワークシステムの構築におけるDurov兄弟の素晴らしさと経験の高さなどについての投稿がHabréに頻繁に掲載されています。</font><font style="vertical-align: inherit;">同時に、実際に技術的なデバイスに突入した人はごくわずかです-最大の使用はJSONに基づいた非常にシンプルな（そしてMTProtoとは非常に異なる）Bot APIであり、通常</font><font style="vertical-align: inherit;">、メッセンジャーを中心に展開するすべての賞賛と広報</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を当然の</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">と考えています。</font><font style="vertical-align: inherit;">ほぼ1年半前に、エシェロンNGOヴァシリーの同僚（残念ながら、彼のHabrのアカウントはドラフトと一緒に消去されました）が自分のTelegramクライアントをPerlでゼロから書き始め、これらのラインの作者が後に加わりました。</font><font style="vertical-align: inherit;">なぜPerlでは、すぐに質問する人がいるのでしょうか？</font></font><s><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他の言語ではそのようなプロジェクトはすでに存在しているため</font></font></del></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実際、これは重要ではありません。</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既製のライブラリ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がない他の言語が存在する</font><strong><font style="vertical-align: inherit;">可能性</font></strong><font style="vertical-align: inherit;">があるため</font><font style="vertical-align: inherit;">、作成者は</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初からやり直す</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要があります</font><font style="vertical-align: inherit;">。さらに、暗号はそのようなものです-信頼しますが、検証します。セキュリティを目的とした製品の場合、製造元からの完成したライブラリをそのまま利用して信頼することはできません。盲目的にそれを信じてください（ただし、これは2番目の部分のトピックです）。現在、ライブラリーは「中間」レベルで非常にうまく機能しています（API要求を行うことができます）。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ただし、この一連の投稿では、暗号化と数学はそれほど多くありません。</font><font style="vertical-align: inherit;">しかし、他にも多くの技術的な詳細やアーキテクチャの松葉杖があります（ゼロから作成するのではなく、任意の言語でライブラリを使用する人には便利です）。</font><font style="vertical-align: inherit;">したがって、主な目標は</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、公式ドキュメントに従って</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントをゼロから実装することです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すなわち、（私たちは、これは本当にどのように話題に拡大する、第二部では、再び公式クライアントのソースコードが閉じていることを想定</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たまたま</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用してクライアントを作成することが可能である- 、例えば、RFCのような標準があり、昔のように、）が、少なくとも1つの仕様、ソースで「覗き見しない」、少なくとも公式（Telegramデスクトップ、モバイル）、少なくとも非公式のTelethon？</font></font></p><a name="habracut"></a><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目次：</font></font></strong></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント...存在しますか？</font><font style="vertical-align: inherit;">真実？..</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> : TL (Type Language)   ,  ,     </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    TL  ,      </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Vector,      </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  TL  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">.  (layers)</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">MTProto</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">, , , Diffie-Hellman</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  , msg_id, msg_seqno, ,        </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RPC: , , . .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">:    </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  . .</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    ?</a></li>
</ul></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">API ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">To be continued!</a></li>
</ul><br>
<h2 id="anchordocsanchordokumentaciya-ona-ved-est-pravda"><a name="docs"></a>…   ? ?..</h2><br>
<p>         .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://core.telegram.org</a>      Layer 23, ..  -  2014  (,      ?). ,  ,            2014 .       , -, , -,    .    ,   2019,  <em></em> ,      ,    Layer 105,  ,      . ,    ,   —     . ,      ,    ,       ,   —   .   , 5     —    ,  <em></em> .    (           )  API-          !</p><br>
<h2 id="anchorbeginanchors-chego-nachat-molodomu-avtoru"><a name="begin"></a>    ?</h2><br>
<p>,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Telethon  Python</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Madeline  PHP</a>,       <em>  </em> — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> <code>api_id</code>  <code>api_hash</code> (  API   ),      .  <strong></strong>     ,    ,       ,    . ,    ,     —   ,        <strong> </strong> ,       .</p><br>
<p>  ,    ,    ,        Telegram    , ,  ..      ,       ""      ,    , ..  .  ,    ,    .</p><br>
<p>    ,          .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://core.telegram.org/</a>    Getting Started    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> MTProto</a> —     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   OSI</a>      ,   .</p><br>
<p>  ,   MTProto,  ,     (       , layer violation)    ,    ...</p><br>
<h1 id="anchortlanchorbinarnaya-serializaciya-tl-type-language-i-ego-shema-i-sloi-i-mnogo-drugih-strashnyh-slov"><a name="TL"></a> : TL (Type Language)   ,  ,     </h1><br>
<p> , ,   Telegram — .   ,      ,  .</p><br>
<p>, .      , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">JSON Schema</a>,   .   :        .  , ,   .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> MTProto</a>,       ,    - ,    :</p><br>
<pre><code class="plaintext">int ? = Int;<font></font>
long ? = Long;<font></font>
double ? = Double;<font></font>
string ? = String;<font></font>
<font></font>
vector#1cb5c415 {t:Type} # [ t ] = Vector t;<font></font>
<font></font>
rpc_error#2144ca19 error_code:int error_message:string = RpcError;<font></font>
<font></font>
rpc_answer_unknown#5e2ad36e = RpcDropAnswer;<font></font>
rpc_answer_dropped_running#cd78e586 = RpcDropAnswer;<font></font>
rpc_answer_dropped#a43ad8b7 msg_id:long seq_no:int bytes:int = RpcDropAnswer;<font></font>
<font></font>
msg_container#73f1f8dc messages:vector&lt;%Message&gt; = MessageContainer;<font></font>
<font></font>
---functions---<font></font>
<font></font>
set_client_DH_params#f5045f1f nonce:int128 server_nonce:int128 encrypted_data:bytes = Set_client_DH_params_answer;<font></font>
<font></font>
ping#7abe77ec ping_id:long = Pong;<font></font>
ping_delay_disconnect#f3427b8c ping_id:long disconnect_delay:int = Pong;<font></font>
<font></font>
invokeAfterMsg#cb9f372d msg_id:long query:!X = X;<font></font>
invokeAfterMsgs#3dc4b4f0 msg_ids:Vector&lt;long&gt; query:!X = X;<font></font>
<font></font>
account.updateProfile#78515775 flags:# first_name:flags.0?string last_name:flags.1?string about:flags.2?string = User;<font></font>
account.sendChangePhoneCode#8e57deb flags:# allow_flashcall:flags.0?true phone_number:string current_number:flags.0?Bool = auth.SentCode;</code></pre><br>
<p>,   ,       — ,    (  ,   ?),     ,      … .         ++ (  , <em> </em>).      ,  , , ,  (       ), - ,  - ,   —   ,     <em></em> (    )  ?    <em>(,        JSON- —      )</em>.</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Binary Data Serialization</a>    <s>     </s>      4 . , , , ,  ,  ,  ,  …      !    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">TL Language</a>,          ,        ,  ,                !</p><br>
<p>,        , ,     ,   ,   ,   ,   -   .    :</p><br>
<ul>
<li>, <em></em>  ,  ,  <strong> </strong></li>
<li>       IT-  —     </li>
<li>,   ,    <strong> </strong>,        TL,   </li>
</ul><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">LeoNerd</a>   <code>#perl</code>  IRC- FreeNode,     Telegram  Matrix (    ):</p><br>
<blockquote> ,  -     ,         ,   ,     .</blockquote><p> ,   bare- (int, long  ..)  -     —        —        <strong></strong>.  ,   , <em></em>,      .</p><br>
<p>  </p><br>
<h2 id="anchorsynanchor-kratkoe-opisanie-podmnozhestva-sintaksisa-tl-dlya-teh-kto-ne-et-chitat-oficialnuyu-dokumentaciyu"><a name="syn"></a>     TL  ,  …    </h2><br>
<pre><code class="plaintext">constructor = Type;<font></font>
myVec ids:Vector&lt;long&gt; = Type;<font></font>
<font></font>
fixed#abcdef34 id:int = Type2;<font></font>
<font></font>
fixedVec set:Vector&lt;Type2&gt; = FixedVec;<font></font>
<font></font>
constructorOne#crc32 field1:int = PolymorType;<font></font>
constructorTwo#2crc32 field_a:long field_b:Type3 field_c:int = PolymorType;<font></font>
constructorThree#deadcrc bit_flags_of_what_really_present:# optional_field4:bit_flags_of_what_really_present.1?Type = PolymorType;<font></font>
<font></font>
an_id#12abcd34 id:int = Type3;<font></font>
a_null#6789cdef = Type3;</code></pre><br>
<p>   <strong></strong>,    (  — )   <code>#</code>  <strong>CRC32</strong>      .    ,    —     .        ,    —  , ,  — .  ,     ,  <strong></strong> —        .</p><br>
<p>      <code>---functions---</code>,     ,     :    RPC-,  —  (         ,   ,     ),  " " —   . , ,     —     <code>---types---</code>,      " ".       , ..        ,   ,   C++,  TL -  .</p><br>
<p> ""  "",    ? ,   , -           —     ,   —    -,  <code>final</code>    .   , ,   <em></em>       - .   —    ,    (           ,   ,     ) —        ,   <em></em>     .</p><br>
<p>  ? ,     4 ,   <code>0xcrc32</code> —  ,    <code>field1</code>   <code>int</code>, ..   4 ,       <code>PolymorType</code> .  <code>0x2crc32</code>  ,    ,  <code>long</code>,   8 .     ,   . , <code>Type3</code>         , ,     <code>0x12abcd34</code>,      4  <code>int</code>,  <code>0x6789cdef</code>,     .   —   .          4  <code>int</code>  <code>field_c</code>  <code>constructorTwo</code>       <code>PolymorType</code>.</p><br>
<p>,   <code>0xdeadcrc</code>  <code>constructorThree</code>,    .     <code>bit_flags_of_what_really_present</code>   <code>#</code> —   ,       <code>nat</code>,  " ".  ,  , unsigned int — , , ,       . ,     , ,     —    on the wire,       ,    (   ). , ,    , ,      <code>Type</code>,      2 .   (   ),     <code>ids</code>   <code>ids:Vector&lt;long&gt;</code>.</p><br>
<p>  ,     generic'    Java.  . , .  <strong></strong>       ,      Vector.      4  CRC32    Vector,  ,  4  —   ,     .</p><br>
<p>   ,       4 ,     —      <code>bytes</code>  <code>string</code>         4 — ,        ?  TL     ,     ,    ,        4 ,   JSON   ? ,        ,   ,     ,          ?..</p><br>
<p>  ,      ,   ,    . -, CRC32         (  whitespace  ..) —      ,    ,     CRC32 , , .       ,         ,    ,     ?..</p><br>
<p>-,   <strong>CRC32</strong>,        <strong>-</strong>   ,    ().       —  ,     2<sup>32</sup>,   .    ,  CRC32    ( )    ,        ? ,     :    CRC32   ,    4      4  —   .           (  ),      ,     .</p><br>
<blockquote>,   ,   <em></em> CRC32?      (  )  -,          239, -!</blockquote><p>, ,  ,      <code>Vector&lt;int&gt;</code>  <code>Vector&lt;PolymorType&gt;</code>    CRC32.      ?     , <em>    </em>? ,       ,   <code>Vector&lt;int&gt;</code>  ,    40000 .    <code>Vector&lt;Type2&gt;</code>,       <code>int</code>      —    10000   0xabcdef34   4  <code>int</code>,            <code>fixedVec</code>   80000     40000 ?</p><br>
<p>      — ,     ,     id, ,  —           .    Telegram   .</p><br>
<p>...</p><br>
<h2 id="anchorvectoranchorvector-kotoryy-tak-i-ne-smogli-vyvesti"><a name="vector"></a>Vector,      </h2><br>
<p>         ,  ,   (  )     tuples  .     ,   ,     ,       .    ?   <em></em>,  ,      —    lazy evaluation     .   <em> </em>   :    <strong></strong>, ..     —   ,  —          ( <code>(cons)</code>  Lisp).  , ,   <strong></strong>    4  (CRC32    TL)    .      <em> </em>,         — .</p><br>
<p>,  TL    ,    .     :</p><br>
<blockquote>Serialization always uses the same constructor “vector” (const 0x1cb5c415 = crc32("vector t:Type # [ t ] = Vector t”) that is not dependent on the specific value of the variable of type t. <br>
<br>
The value of the optional parameter t is not involved in the serialization since it is derived from the result type (always known prior to deserialization).</blockquote><p>: <code>vector {t:Type} # [ t ] = Vector t</code> —  <em></em>      ,        !     .  ,        .       ,   :</p><br>
<blockquote>The Vector t polymorphic pseudotype is a “type” whose value is a sequence of values of any type t, either boxed or bare.</blockquote><p>…      .  ,      (       ),            ,    :     ,     ( - ACM),    .  —     — .</p><br>
<blockquote>,  . , <code>#</code>   <code>nat</code>,  :<br>
<br>
There are type expressions (<em>type-expr</em>) and numeric expressions (<em>nat-expr</em>). However, they are defined the same way.<br>
<pre><code class="plaintext">type-expr ::= expr<font></font>
nat-expr ::= expr</code></pre><br>
<br>
     , ..          .</blockquote><p>  ,   (<code>vector&lt;int&gt;</code>, <code>vector&lt;User&gt;</code>)    (<code>#1cb5c415</code>), ..  ,    </p><br>
<pre><code class="plaintext">users.getUsers#d91a548 id:Vector&lt;InputUser&gt; = Vector&lt;User&gt;;</code></pre><br>
<p>     ,   . , <em></em>  —     ,   bare-,   ,  -      —          <em> </em>?     - PHP,           ?</p><br>
<p>     —     TL? ,         ,   protobuf,   ?   ,    .</p><br>
<h2 id="anchortlimplanchorsuschestvuyuschie-realizacii-tl-v-kode"><a name="TLimpl"></a>  TL  </h2><br>
<p>TL              (<em></em>),     Telegram.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>     .         ,    Telegram. ,       (     ( )   ). </p><br>
<pre><code class="plaintext">Templates are not used now. Instead, the same universal constructors (for example, vector {t:Type} [t] = Vector t) are used w</code></pre><br>
<p>    ,  ,  ,   .</p><br>
<pre><code class="plaintext">#define ZHUKOV_BYTES_HACK<font></font>
<font></font>
#ifdef ZHUKOV_BYTES_HACK<font></font>
<font></font>
/* dirty hack for Zhukov request */</code></pre><br>
<p> , :</p><br>
<pre><code class="plaintext">    static const char *reserved_words_polymorhic[] = {<font></font>
<font></font>
      "alpha", "beta", "gamma", "delta", "epsilon", "zeta", "eta", "theta", NULL<font></font>
<font></font>
      };</code></pre><br>
<p>  —  , :</p><br>
<pre><code class="plaintext">intHash {alpha:Type} vector&lt;coupleInt&lt;alpha&gt;&gt; = IntHash&lt;alpha&gt;;</code></pre><br>
<p>    ,    int — Type.  C++     :</p><br>
<pre><code class="plaintext">    template &lt;T&gt; class IntHash {<font></font>
      vector&lt;pair&lt;int,T&gt;&gt; _map;<font></font>
    }</code></pre><br>
<p> , <code>alpha</code> —  !    C++    T,    alpha, beta…    8 ,    .   ,  -      :</p><br>
<pre><code class="plaintext">--    TL <font></font>
-- ...     , ,...     ... , !<font></font>
-- ?   <font></font>
<font></font>
-- ,        !<font></font>
--  ,     ?<font></font>
--   ,     ,  --  </code></pre><br>
<p>       TL "".       Telegram-.</p><br>
<p> :</p><br>
<blockquote>Vasily, [09.10.18 17:07]<br>
     ,     ,      ,    <br>
 ,    .jpg<br>
   .webp</blockquote><p>,          ,    , ,        -        <abbr title="ドメイン固有の言語">DSL</abbr>, ?..</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">telegram-cli</a>   ,       TLO   (cli) ,   —     TL  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> TL</a>?..</p><br>
<blockquote>16.12 04:18 Vasily: -, -   lex+yacc<br>
16.12 04:18 Vasily:      <br>
16.12 04:18 Vasily:         <br>
16.12 04:19 Vasily: 3+  <code>&lt;censored&gt;</code>  </blockquote><p>, ?  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>    — Telegram Desktop:</p><br>
<pre><code class="python">    nametype = re.match(r'([a-zA-Z\.0-9_]+)(#[0-9a-f]+)?([^=]*)=\s*([a-zA-Z\.&lt;&gt;0-9_]+);', line);<font></font>
    if (not nametype):<font></font>
      if (not re.match(r'vector#1cb5c415 \{t:Type\} # \[ t \] = Vector t;', line)):<font></font>
         print('Bad line found: ' + line);</code></pre><br>
<p>1100+   ,   +    , , ,        TL,      ,   … ,      <i></i> ,          ?!</p><br>
<p>… ,     CRC32?  ,   Telegram Desktop      ,    CRC32 <em> </em>    !</p><br>
<blockquote>Vasily, [18.12 22:49]<br>
   ,     TL<br>
      ,      ,      <br>
tdesktop, , </blockquote><p>   ,      .</p><br>
<p>, telegram-cli — , Telegram Desktop — ,    ?   ?..   Android-      (    ,     ),       ,      .</p><br>
<p>      ? ,  , ,      :</p><br>
<blockquote>Vasily: <code>flags.0? true</code><br>
,      true,   <br>
<br>
Vasily: <code>flags.1? int</code><br>
,   ,    <br>
<br>
Vasily: ,  ,   !<br>
Vasily:  -    ,  true —     ,     -  <br>
Vasily:       ,      </blockquote><p>, , Telethon?     MTProto,  —      ,   <code>%</code>      "  bare-", ..     ,   :</p><br>
<blockquote>Vasily, [22.06.18 18:38]<br>
  :<br>
<pre><code class="plaintext">msg_container#73f1f8dc messages:vector message = MessageContainer;</code></pre><br>
<br>
 :<br>
<pre><code class="plaintext">msg_container#73f1f8dc messages:vector&lt;%Message&gt; = MessageContainer;</code></pre><br>
<br>
    ,    -  <br>
<br>
   bare      <br>
<br>
 telethon   <br>
<br>
     <code>msg_container</code><br>
<br>
 ,    %.   .<br>
<br>
Vadim Goncharov, [22.06.18 19:22]<br>
  tdesktop?<br>
<br>
Vasily, [22.06.18 19:23]<br>
   TL        <br>
<br>
<code>// parsed manually</code><br>
<br>
TL  ,     <br>
<br>
 %     <br>
<br>
     ,   <br>
<br>
   ,      <br>
<br>
     TL,     </blockquote><p>" ",   , "-   ,  ,  ".</p><br>
<p> : "   ,   </p><br>
<pre><code class="plaintext">    args: /* empty */ { $$ = NULL; }<font></font>
        | args arg { $$ = g_list_append( $1, $2 ); }<font></font>
        ;<font></font>
<font></font>
    arg: LC_ID ':' type-term { $$ = tl_arg_new( $1, $3 ); }<font></font>
            | LC_ID ':' condition '?' type-term { $$ = tl_arg_new_cond( $1, $5, $3 ); free($3); }<font></font>
            | UC_ID ':' type-term { $$ = tl_arg_new( $1, $3 ); }<font></font>
            | type-term { $$ = tl_arg_new( "", $1 ); }<font></font>
            | '[' LC_ID ']' { $$ = tl_arg_new_mult( "", tl_type_new( $2, TYPE_MOD_NONE ) ); }<font></font>
            ;</code></pre><br>
<p>-  ,  </p><br>
<pre><code class="plaintext">struct tree *parse_args4 (void) {<font></font>
  PARSE_INIT (type_args4);<font></font>
  struct parse so = save_parse ();<font></font>
  PARSE_TRY (parse_optional_arg_def);<font></font>
  if (S) {<font></font>
    tree_add_child (T, S);<font></font>
  } else {<font></font>
    load_parse (so);<font></font>
  }<font></font>
  if (LEX_CHAR ('!')) {<font></font>
    PARSE_ADD (type_exclam);<font></font>
    EXPECT ("!");<font></font>
  }<font></font>
  PARSE_TRY_PES (parse_type_term);<font></font>
  PARSE_OK;<font></font>
}</code></pre><br>
<p> </p><br>
<pre><code class="python">        # Regex to match the whole line<font></font>
        match = re.match(r'''<font></font>
            ^                  # We want to match from the beginning to the end<font></font>
            ([\w.]+)           # The .tl object can contain alpha_name or namespace.alpha_name<font></font>
            (?:<font></font>
                \#             # After the name, comes the ID of the object<font></font>
                ([0-9a-f]+)    # The constructor ID is in hexadecimal form<font></font>
            )?                 # If no constructor ID was given, CRC32 the 'tl' to determine it<font></font>
<font></font>
            (?:\s              # After that, we want to match its arguments (name:type)<font></font>
                {?             # For handling the start of the '{X:Type}' case<font></font>
                \w+            # The argument name will always be an alpha-only name<font></font>
                :              # Then comes the separator between name:type<font></font>
                [\w\d&lt;&gt;#.?!]+  # The type is slightly more complex, since it's alphanumeric and it can<font></font>
                               # also have Vector&lt;type&gt;, flags:# and flags.0?default, plus :!X as type<font></font>
                }?             # For handling the end of the '{X:Type}' case<font></font>
            )*                 # Match 0 or more arguments<font></font>
            \s                 # Leave a space between the arguments and the equal<font></font>
            =<font></font>
            \s                 # Leave another space between the equal and the result<font></font>
            ([\w\d&lt;&gt;#.?]+)     # The result can again be as complex as any argument type<font></font>
            ;$                 # Finally, the line should always end with ;<font></font>
            ''', tl, re.IGNORECASE | re.VERBOSE)</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext">    ---functions---         return FUNCTIONS;<font></font>
    ---types---             return TYPES;<font></font>
    [a-z][a-zA-Z0-9_]*      yylval.string = strdup(yytext); return LC_ID;<font></font>
    [A-Z][a-zA-Z0-9_]*      yylval.string = strdup(yytext); return UC_ID;<font></font>
    [0-9]+                  yylval.number = atoi(yytext); return NUM;<font></font>
    #[0-9a-fA-F]{1,8}       yylval.number = strtol(yytext+1, NULL, 16); return ID_HASH;<font></font>
<font></font>
    \n                      /* skip new line */<font></font>
    [ \t]+                  /* skip spaces */<font></font>
    \/\/.*$                 /* skip comments */<font></font>
    \/\*.*\*\/              /* skip comments */<font></font>
    .                       return (int)yytext[0];</code></pre><br>
<p>..  —   ".</p><br>
<p> ,          TL    100    ~300   (   <code>print</code>'  ),           .         ,   —          .</p><br>
<h2 id="anchornotypelanganchornehvatka-tipov-v-yazyke-tipov"><a name="notypelang"></a>    </h2><br>
<p>  —   , ? ,    (    ),     TL.   ,       .  ,    ,  ,       .      ?</p><br>
<p> , constraints.        :</p><br>
<blockquote>The file’s binary content is then split into parts. All parts must have the same size ( <strong>part_size</strong> ) and the following conditions must be met:<br>
<ul>
<li><code>part_size % 1024 = 0</code> (divisible by 1KB)</li>
<li><code>524288 % part_size = 0</code> (512KB must be evenly divisible by part_size)</li>
</ul><br>
<br>
The last part does not have to satisfy these conditions, provided its size is less than part_size.<br>
<br>
Each part should have a sequence number, <strong>file_part</strong>, with a value ranging from 0 to 2,999.<br>
<br>
After the file has been partitioned you need to choose a method for saving it on the server. Use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">upload.saveBigFilePart</a> in case the full size of the file is more than 10 MB and <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">upload.saveFilePart</a> for smaller files.<br>
[...] one of the following data input errors may be returned:<br>
<ul>
<li>FILE_PARTS_INVALID — Invalid number of parts. The value is not between <code>1..3000</code></li>
</ul><br>
</blockquote><p>-     ?  -   TL? .  ,    Turbo Pascal   ,  <em></em>.     ,     <code>enum</code> — ,     ()  .     — , ,       <em></em>.     , … ,    ,         , ?</p><br>
<p>    TL .  , ,  JSON Schema.     512  -   ,        ,   ,    <em> </em>     <code>1..3000</code> (     )    , ?..</p><br>
<p>,     .     ,    TL —     ,  <strong></strong>   TL          ,   .     TL   . ,           (   , RPC   -,     ) —           ?..    —   .</p><br>
<p>   ,   ? , ,    <strong>description</strong>     ( JSON-   ),      ,      —       ?    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>:</p><br>
<p>-<code>channelFull#76af5481 flags:# can_view_participants:flags.3?true can_set_username:flags.6?true can_set_stickers:flags.7?true hidden_prehistory:flags.10?true id:int about:string participants_count:flags.0?int admins_count:flags.1?int kicked_count:flags.2?int banned_count:flags.2?int read_inbox_max_id:int read_outbox_max_id:int unread_count:int chat_photo:Photo notify_settings:PeerNotifySettings exported_invite:ExportedChatInvite bot_info:Vector&lt;BotInfo&gt; migrated_from_chat_id:flags.4?int migrated_from_max_id:flags.4?int pinned_msg_id:flags.5?int stickerset:flags.8?StickerSet available_min_id:flags.9?int = ChatFull;</code><br>
+<code>channelFull#1c87a71a flags:# can_view_participants:flags.3?true can_set_username:flags.6?true can_set_stickers:flags.7?true hidden_prehistory:flags.10?true can_view_stats:flags.12?true id:int about:string participants_count:flags.0?int admins_count:flags.1?int kicked_count:flags.2?int banned_count:flags.2?int online_count:flags.13?int read_inbox_max_id:int read_outbox_max_id:int unread_count:int chat_photo:Photo notify_settings:PeerNotifySettings exported_invite:ExportedChatInvite bot_info:Vector&lt;BotInfo&gt; migrated_from_chat_id:flags.4?int migrated_from_max_id:flags.4?int pinned_msg_id:flags.5?int stickerset:flags.8?StickerSet available_min_id:flags.9?int = ChatFull;</code></p><br>
<p></p><br>
<p>-<code>message#44f9b43d flags:# out:flags.1?true mentioned:flags.4?true media_unread:flags.5?true silent:flags.13?true post:flags.14?true id:int from_id:flags.8?int to_id:Peer fwd_from:flags.2?MessageFwdHeader via_bot_id:flags.11?int reply_to_msg_id:flags.3?int date:int message:string media:flags.9?MessageMedia reply_markup:flags.6?ReplyMarkup entities:flags.7?Vector&lt;MessageEntity&gt; views:flags.10?int edit_date:flags.15?int post_author:flags.16?string grouped_id:flags.17?long = Message;</code><br>
+<code>message#44f9b43d flags:# out:flags.1?true mentioned:flags.4?true media_unread:flags.5?true silent:flags.13?true post:flags.14?true from_scheduled:flags.18?true id:int from_id:flags.8?int to_id:Peer fwd_from:flags.2?MessageFwdHeader via_bot_id:flags.11?int reply_to_msg_id:flags.3?int date:int message:string media:flags.9?MessageMedia reply_markup:flags.6?ReplyMarkup entities:flags.7?Vector&lt;MessageEntity&gt; views:flags.10?int edit_date:flags.15?int post_author:flags.16?string grouped_id:flags.17?long = Message;</code></p><br>
<p>  ,  GitHub, ,       .  " 10 ",     ,         ,    -  …   ,        ,     <em>  </em>.</p><br>
<p>,   .     ?   ,   <em></em>      ?       .  ,   ,      .          :</p><br>
<pre><code class="plaintext">storage.fileUnknown#aa963b05 = storage.FileType;<font></font>
storage.filePartial#40bc6f52 = storage.FileType;<font></font>
storage.fileJpeg#7efe0e = storage.FileType;<font></font>
storage.fileGif#cae1aadf = storage.FileType;<font></font>
storage.filePng#a4f63c0 = storage.FileType;<font></font>
storage.filePdf#ae1e508d = storage.FileType;<font></font>
storage.fileMp3#528a0677 = storage.FileType;<font></font>
storage.fileMov#4b09ebbc = storage.FileType;<font></font>
storage.fileMp4#b3cea0e4 = storage.FileType;<font></font>
storage.fileWebp#1081464c = storage.FileType;</code></pre><br>
<p>  ,      5  ,    32     .  .     TL          .</p><br>
<p> ,        . ,  MTProto ( )     Gzip,   —  ,     . ,     RpcResult,   .     ?..   ,     .</p><br>
<p>  ,     —  <code>InputPeerUser</code>  <code>InputUser</code>.  .   !       .    ? , ,      telegram-cli:</p><br>
<pre><code class="plaintext">  if (tgl_get_peer_type (E-&gt;id) != TGL_PEER_CHANNEL || (C &amp;&amp; (C-&gt;flags &amp; TGLCHF_MEGAGROUP))) {<font></font>
    out_int (CODE_messages_get_history);<font></font>
    out_peer_id (TLS, E-&gt;id);<font></font>
  } else {    <font></font>
    out_int (CODE_channels_get_important_history);<font></font>
<font></font>
    out_int (CODE_input_channel);<font></font>
    out_int (tgl_get_peer_id (E-&gt;id));<font></font>
    out_long (E-&gt;id.access_hash);<font></font>
  }<font></font>
  out_int (E-&gt;max_id);<font></font>
  out_int (E-&gt;offset);<font></font>
  out_int (E-&gt;limit);<font></font>
  out_int (0);<font></font>
  out_int (0);</code></pre><br>
<p> ,    <strong></strong>,    !  ,   ?..  ,  ,    ,       ?        ?       .</p><br>
<h2 id="anchoronionanchorversionnost-sloi-layers"><a name="onion"></a>.  (layers)</h2><br>
<p>    ,    ,     .   ,   ,        ,   ,  ,    ,      .  ,    —      "",   .  ,    . ,       — ,       .    2.       TL:</p><br>
<blockquote>If a client supports Layer 2, then the following constructor must be used:<br>
<pre><code class="plaintext">invokeWithLayer2#289dd1f6 {X:Type} query:!X = X;</code></pre><br>
<br>
In practice, this means that before every API call, an int with the value <code>0x289dd1f6</code> must be added before the method number.</blockquote><p> .    ?  </p><br>
<pre><code class="plaintext">invokeWithLayer3#b7475268 query:!X = X;</code></pre><br>
<p> ?   ,</p><br>
<pre><code class="plaintext">invokeWithLayer4#dea0d430 query:!X = X;</code></pre><br>
<p>? ,   ,   ,  <strong></strong>           —      ,    -?     4   —   . So,</p><br>
<pre><code class="plaintext">invokeWithLayer5#417a57ae query:!X = X;</code></pre><br>
<p> ,        .   :</p><br>
<blockquote>Update: Starting with Layer 9, helper methods <code>invokeWithLayerN</code> can be used only together with <code>initConnection</code></blockquote><p>!  9   , ,  ,   Internet-    80- —       !</p><br>
<p> ?..</p><br>
<pre><code class="plaintext">invokeWithLayer10#39620c41 query:!X = X;<font></font>
...<font></font>
invokeWithLayer18#1c900537 query:!X = X;</code></pre><br>
<p>     .    9  , ,      ,         ,       ,     ,   .  .</p><br>
<p>?..</p><br>
<blockquote>Vasily, [16.07.18 14:01]<br>
   :<br>
    .     InvokeWithLayer.    ,       .<br>
<br>
..     ,     <br>
<br>
Vadim Goncharov, [16.07.18 14:02]<br>
 InvokeWithLayer     ?<br>
<br>
Vasily, [16.07.18 14:02]<br>
  <br>
<br>
Vadim Goncharov, [16.07.18 14:02]<br>
         <br>
<br>
,   ,     </blockquote><p>, ..  <code>Updates</code>   —  ,         API-,     .   ,      ,    ,    Updates     .</p><br>
<p> ,     <em></em>     ,      :</p><br>
<ul>
<li>      ,   ,    </li>
<li>     ?</li>
<li> <em></em>,          ?</li>
</ul><br>
<p>,    ,       ,     (  ,  )? !    !</p><br>
<p>       . 14   ,    Telegram - …    :</p><br>
<pre><code class="plaintext">2019-08-15 09:28:35.880640 MSK warn  main: ANON:87: unknown object type: 0x80d182d1 at TL/Object.pm line 213.<font></font>
2019-08-15 09:28:35.751899 MSK warn  main: ANON:87: unknown object type: 0xb5223b0f at TL/Object.pm line 213.</code></pre><br>
<p>     (,    ).      TL -   —     ,    <strong></strong> ,   .      ?</p><br>
<p>,       —    .  .   CRC32 —     73 ,     82.     —      !</p><br>
<p>,      ? ,  Telegram Desktop 1.2.17 (,     Linux),     Exception: MTP Unexpected type id #b5223b0f read in MTPMessageMedia...</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/a59/759/6b7/a597596b72291e5d5c6ac57525003074.jpg"></p><br>
<p> ,     -     ,         ...</p><br>
<p>   -?    :      91,         73.   ,    ,   ,         ,     .</p><br>
<p>     :  , ,     , ,   ,    — ,             .          .</p><br>
<p>?       ,          .  ,   ,    "",    ,    ,      ,     .      "",      .</p><br>
<p> …     ?!.. ,      ,      .    Android     TL-,     (   )  ().   :</p><br>
<pre><code class="java">public static class TL_message_layer68 extends TL_message {<font></font>
    public static int constructor = 0xc09be45f;<font></font>
//...<font></font>
//  <font></font>
//...<font></font>
    public static class TL_message_layer47 extends TL_message {<font></font>
        public static int constructor = 0xc992e15c;<font></font>
        public static Message TLdeserialize(AbstractSerializedData stream, int constructor, boolean exception) {<font></font>
            Message result = null;<font></font>
            switch (constructor) {<font></font>
                case 0x1d86f70e:<font></font>
                    result = new TL_messageService_old2();<font></font>
                    break;<font></font>
                case 0xa7ab1991:<font></font>
                    result = new TL_message_old3();<font></font>
                    break;<font></font>
                case 0xc3060325:<font></font>
                    result = new TL_message_old4();<font></font>
                    break;<font></font>
                case 0x555555fa:<font></font>
                    result = new TL_message_secret();<font></font>
                    break;<font></font>
                case 0x555555f9:<font></font>
                    result = new TL_message_secret_layer72();<font></font>
                    break;<font></font>
                case 0x90dddc11:<font></font>
                    result = new TL_message_layer72();<font></font>
                    break;<font></font>
                case 0xc09be45f:<font></font>
                    result = new TL_message_layer68();<font></font>
                    break;<font></font>
                case 0xc992e15c:<font></font>
                    result = new TL_message_layer47();<font></font>
                    break;<font></font>
                case 0x5ba66c13:<font></font>
                    result = new TL_message_old7();<font></font>
                    break;<font></font>
                case 0xc06b9607:<font></font>
                    result = new TL_messageService_layer48();<font></font>
                    break;<font></font>
                case 0x83e5de54:<font></font>
                    result = new TL_messageEmpty();<font></font>
                    break;<font></font>
                case 0x2bebfa86:<font></font>
                    result = new TL_message_old6();<font></font>
                    break;<font></font>
                case 0x44f9b43d:<font></font>
                    result = new TL_message_layer104();<font></font>
                    break;<font></font>
                case 0x1c9b1027:<font></font>
                    result = new TL_message_layer104_2();<font></font>
                    break;<font></font>
                case 0xa367e716:<font></font>
                    result = new TL_messageForwarded_old2(); //custom<font></font>
                    break;<font></font>
                case 0x5f46804:<font></font>
                    result = new TL_messageForwarded_old(); //custom<font></font>
                    break;<font></font>
                case 0x567699b3:<font></font>
                    result = new TL_message_old2(); //custom<font></font>
                    break;<font></font>
                case 0x9f8d60bb:<font></font>
                    result = new TL_messageService_old(); //custom<font></font>
                    break;<font></font>
                case 0x22eb6aba:<font></font>
                    result = new TL_message_old(); //custom<font></font>
                    break;<font></font>
                case 0x555555F8:<font></font>
                    result = new TL_message_secret_old(); //custom<font></font>
                    break;<font></font>
                case 0x9789dac4:<font></font>
                    result = new TL_message_layer104_3();<font></font>
                    break;</code></pre><br>
<p></p><br>
<pre><code class="java">    boolean fixCaption = !TextUtils.isEmpty(message) &amp;&amp;<font></font>
    (media instanceof TLRPC.TL_messageMediaPhoto_old ||<font></font>
     media instanceof TLRPC.TL_messageMediaPhoto_layer68 ||<font></font>
     media instanceof TLRPC.TL_messageMediaPhoto_layer74 ||<font></font>
     media instanceof TLRPC.TL_messageMediaDocument_old ||<font></font>
     media instanceof TLRPC.TL_messageMediaDocument_layer68 ||<font></font>
     media instanceof TLRPC.TL_messageMediaDocument_layer74)<font></font>
    &amp;&amp; message.startsWith("-1");</code></pre><br>
<p>…  . , ,   ,  ?..      ! , ,      ,   ,   <code>_old7</code> -     … ,     </p><br>
<pre><code class="plaintext">TL_message_layer104<font></font>
TL_message_layer104_2<font></font>
TL_message_layer104_3</code></pre><br>
<p>,   ,       ?! , , "", ,   ,  ,  ?..        ?    , ?..</p><br>
<p>  Telegram Desktop, ,   —  ,           ,  - .  ,       ,   ,    ?   ,    ,    ,     .</p><br>
<p>     ? ,  -,       .</p><br>
<p>,    :</p><br>
<pre><code class="java">public static class TL_folders_deleteFolder extends TLObject {<font></font>
    public static int constructor = 0x1c295881;<font></font>
<font></font>
    public int folder_id;<font></font>
<font></font>
    public TLObject deserializeResponse(AbstractSerializedData stream, int constructor, boolean exception) {<font></font>
        return Updates.TLdeserialize(stream, constructor, exception);<font></font>
    }<font></font>
<font></font>
    public void serializeToStream(AbstractSerializedData stream) {<font></font>
        stream.writeInt32(constructor);<font></font>
        stream.writeInt32(folder_id);<font></font>
    }<font></font>
}<font></font>
<font></font>
//manually created<font></font>
<font></font>
//RichText start<font></font>
public static abstract class RichText extends TLObject {<font></font>
    public String url;<font></font>
    public long webpage_id;<font></font>
    public String email;<font></font>
    public ArrayList&lt;RichText&gt; texts = new ArrayList&lt;&gt;();<font></font>
    public RichText parentRichText;<font></font>
<font></font>
    public static RichText TLdeserialize(AbstractSerializedData stream, int constructor, boolean exception) {<font></font>
        RichText result = null;<font></font>
        switch (constructor) {<font></font>
            case 0x1ccb966a:<font></font>
                result = new TL_textPhone();<font></font>
                break;<font></font>
            case 0xc7fb5e01:<font></font>
                result = new TL_textSuperscript();<font></font>
                break;</code></pre><br>
<p>   "manually created"   ,        (     maintenance?),     . ,     —  ,    <em> </em> (-   GPL   Linux),       .</p><br>
<p> .   ,      .</p><br>
<h1 id="anchormtanchor-mtproto"><a name="MT"></a> MTProto</h1><br>
<p>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>      .    . ,     Telegram —      -,     ,   (,   API   sticker pack —   ,   ).</p><br>
<p>, "" (message)  "" (session) —   ,     Telegram-. ,    ,        ,      "" —  ,  ,    ,   ,  .   …     .</p><br>
<h2 id="anchorpolimeryanchortransportnyy-uroven"><a name="polimery"></a> </h2><br>
<p>  — .     5 :</p><br>
<ul>
<li>TCP</li>
<li>Websocket</li>
<li>Websocket over HTTPS</li>
<li>HTTP</li>
<li>HTTPS</li>
</ul><br>
<blockquote>Vasily, [15.06.18 15:04]<br>
   UDP ,    <br>
<br>
 TCP   <br>
<br>
   UDP  TCP,      sequence number  crc<br>
      ?</blockquote><p>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">TCP   4 </a>:</p><br>
<ul>
<li>Abridged</li>
<li>Intermediate</li>
<li>Padded intermediate</li>
<li>Full</li>
</ul><br>
<p> , Padded intermediate  MTProxy,    -  .       ( ),      ?       ,      payload    MTProto,     :</p><br>
<ul>
<li> Abridged  1  4 ,   0xef,  </li>
<li> Intermediate  4    ,       <code>0xeeeeeeee</code>  ,   Intermediate</li>
<li> Full  ,    : , sequence number,   ,    MTProto, , CRC32. ,    TCP.          ,    ,    . ,   ,   TCP 16-  ,     . ,    -      16 ,    —    —     SHA  .    CRC32   — .</li>
</ul><br>
<p> Abridged,      ,  Intermediate,   "In case 4-byte data alignment is needed",  - . , ,   Telegram  ,          ?     ,           (    -...).    ,   Abridged,         padding'  16  —  3  <em></em> ?</p><br>
<p> ,       ,     ,    .</p><br>
<p>  ,  .. Web  MTProxy,     ,  ,   ,   .    MTProxy   ,       2018,      ,   <strong> </strong>,  <em> </em>!    ,   (  )  MTProxy        ,      (  ),        Go,    Node.js      .</p><br>
<p>            ,    .    5-  OSI,  —     MTProto session.</p><br>
<h2 id="anchorkeystermsdhanchorklyuchi-soobscheniya-sessii-diffie-hellman"><a name="keystermsDH"></a>, , , Diffie-Hellman</h2><br>
<p>      …  —    ,      Active sessions.   .</p><br>
<img src="https://habrastorage.org/getpro/habr/post_images/afa/7dc/a1d/afa7dca1d0a7b13070911cf36e24dba1.jpg"><br>
<p>         .    ,  plaintext —            .        ""  ?       Telegram (             4 ,       ):</p><br>
<blockquote>     <em>session</em> —   UI    "current sessions",       / OS.<br>
 — <em>MTProto session</em>,    sequence number  (  )  ,   <strong>    TCP-.</strong>      MTProto-,     .<br>
<br>
   <em>sessions</em>   <em>authorization</em>.   ,  ,  <em>UI-</em>   ,  <em>authorization</em>,  ,  . :<br>
<ul>
<li>      <em>auth_key</em>  bounds it to account,   SMS —   <em>authorization</em></li>
<li>    <em>MTProto session</em>,   <code>session_id</code>  .</li>
<li>  ,  <em>authorization</em>  <code>session_id</code>    <em>instance</em> —         </li>
<li>,    <strong></strong> <em>MTProto sessions</em>      <em>auth_key</em> —      DC.</li>
<li>,       <em> DC</em> —    DC    <em>auth_key</em> !</li>
<li>  ,      ,     <em>authorization</em> (<em>UI-</em>),    API <code>auth.exportAuthorization</code>   DC <code>auth.importAuthorization</code>   DC.</li>
<li>  ,     <em>MTProto sessions</em> (   <code>session_id</code>)    DC,  <strong></strong> <em>auth_key</em>.</li>
<li>,    Perfect Forward Secrecy.  <em>auth_key</em>  <strong>permanent</strong> key — per DC —     <code>auth.bindTempAuthKey</code>   <strong>temporary</strong> <em>auth_key</em> —  ,   <em>temp_auth_key</em> per DC,    <em>MTProto sessions</em>   DC.</li>
</ul><br>
<br>
,  <em>salt</em> ( future salts)    <em>auth_key</em> .. shared   <em>MTProto sessions</em>      DC.</blockquote><p>  "  TCP-"? ,   <em> </em>    - —   ()  TCP-   ,   .     HTTP,  MTProto       ,   ,   —            ,      TCP-.</p><br>
<p>,        .    —       ? —   .</p><br>
<p> ,  <code>auth_key</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> -  Telegram</a>.   ...</p><br>
<blockquote>Vasily, [19.06.18 20:05]<br>
data_with_hash := SHA1(data) + data + (any random bytes); such that the length equal 255 bytes;<br>
encrypted_data := RSA (data_with_hash, server_public_key); a 255-byte long number (big endian) is raised to the requisite power over the requisite modulus, and the result is stored as a 256-byte number.<br>
<br>
  -  DH<br>
<br>
   DH  <br>
     </blockquote><p>      <del>  </del> —  proof of work ,     .    DoS-.  RSA-       ,  ,   <code>new_nonce</code>.        ,    ?</p><br>
<blockquote>Vasily, [20.06.18 00:26]<br>
      appid<br>
<br>
    DH <br>
<br>
,     ,    4   .  <br>
<br>
     -404,  ?<br>
<br>
  : "  <s></s>      -,  DH",      404</blockquote><p>       ?  ? -    (     ).</p><br>
<blockquote>     <br>
<br>
    ,     - <br>
<br>
 32  .       <br>
<br>
 ,         BE<br>
<br>
Vadim Goncharov, [20.06.18 15:49]<br>
 -  404?<br>
<br>
Vasily, [20.06.18 15:49]<br>
!<br>
<br>
Vadim Goncharov, [20.06.18 15:50]<br>
    ,    " "<br>
<br>
Vasily, [20.06.18 15:50]<br>
<em></em><br>
<br>
       %)<br>
<br>
 error reporting  <br>
<br>
Vasily, [20.06.18 20:18]<br>
,    MD5.    <br>
<br>
The key fingerprint is computed as follows:<br>
<pre><code class="plaintext">digest = md5(key + iv)<font></font>
fingerprint = substr(digest, 0, 4) XOR substr(digest, 4, 4)</code></pre><br>
<br>
SHA1  sha2</blockquote><p>, , <code>auth_key</code>  2048    - .  ?   ,   1024      …      .          .   TLS-,   .        ,   !  , , <em></em>. ..      "-",  -  ICQ,    "-",   SSH (  - gitlab/github).   .      "     DC"?   "   "? ,     —     ,         .</p><br>
<p>, ""    .  ,   ?   ?    :</p><br>
<blockquote>Vasily, [21.06.18 17:53]<br>
     2    %)<br>
<br>
  , <br>
<br>
Vasily, [21.06.18 18:02]<br>
   ,  ,     </blockquote><p> .  ,         ?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> ( ,    ) —  ,     :</p><br>
<pre><code class="plaintext">278     static const char *goodPrime = "c71caeb9c6b1c9048e6c522f70f13f73980d40238e3e21c14934d037563d930f48198a0aa7c14058229493d22530f4dbfa336f6e0ac925139543aed44cce7c3720fd51f69458705ac68cd4fe6b6b13abdc9746512969328454f18faf8c595f642477fe96bb2a941d5bcd1d4ac8cc49880708fa9b378e3c4f3a9060bee67cf9a4a4a695811051907e162753b56b0f6b410dba74d8a84b2a14b3144e0ef1284754fd17ed950d5965b4b9dd46582db1178d169c6bc465b0d6ff9ca3928fef5b9ae4e418fc15e83ebea0f87fa9ff5eed70050ded2849f47bf959d956850ce929851f0d8115f635b105ee2e4e15d04b2454bf6f4fadf034b10403119cd8e3b92fcc5b";<font></font>
279   if (!strcasecmp(prime, goodPrime)) {</code></pre><br>
<p>,    <em>-</em>    ,          .</p><br>
<p>,    .  , ..  ,    ,    AES.</p><br>
<blockquote>The message key is defined as the 128 middle bits of the SHA256 of the message body (including session, message ID, etc.), including the padding bytes, prepended by 32 bytes taken from the authorization key.<br>
<br>
Vasily, [22.06.18 14:08]<br>
, , <br>
<br>
 <code>auth_key</code>. .  …    . Feel free to study the open source code.<br>
<br>
Note that MTProto 2.0 requires from 12 to 1024 bytes of padding, still subject to the condition that the resulting message length be divisible by 16 bytes.<br>
<br>
   ?<br>
<br>
 ,   404   </blockquote><p>       ,  ,   <abbr title="メッセージ認証コード">MAC</abbr>  .   AES   ,      IGE. , ,      FAQ… , ,       SHA-  ,     —      -  silently ignore  (   ,   ?).</p><br>
<p>  ,  ,              .        ,   Telegram Desktop.    (   D877F783D5D3EF8C)    ,    MTProto (     1.0), ..   ,    ( -     <code>auth_key</code>  256 ,   <code>msg_key</code> ).  ,      .  ,       —   .    ,   , ?..    MAC       ,  .   MTProto  <em></em>     ,        .     Telegram Desktop    <code>user_data</code>      —  AES   CTR.</p><br>
<blockquote>Vasily, [21.06.18 01:27]<br>
,  ,   IGE: IGE was the first attempt at an "authenticating encryption mode," originally for Kerberos. It was a failed attempt (it does not provide integrity protection), and had to be removed. That was the beginning of a 20 year quest for an authenticating encryption mode that works, which recently culminated in modes like OCB and GCM.<br>
<br>
     :<br>
<br>
The team behind Telegram, led by Nikolai Durov, consists of six ACM champions, half of them Ph.Ds in math. It took them about two years to roll out the current version of MTProto.<br>
<br>
 .     <br>
<br>
     tls</blockquote><p>, ,      . , ,    TL    ?       ? , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">initConnection</a>,   ?</p><br>
<blockquote>Vasily, [25.06.18 18:46]<br>
Initializes connection and save information on the user's device and application.<br>
<br>
  app_id, device_model, system_version, app_version  lang_code.<br>
<br>
  query<br>
<br>
  . Feel free to study the open source</blockquote><p>  invokeWithLayer    ,  - ? ,    —    ,     —  ,    :</p><br>
<blockquote>Vasily, [25.06.18 19:13]<br>
  ,      ,     invokewithlayer</blockquote><p> initConnection     ,     ? ,  ,          ,   ,    . !      !     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   —    , ...</p><br>
<blockquote>Only a small portion of the API methods are available to unauthorized users:</blockquote><br>
<ul>
<li>auth.sendCode</li>
<li>auth.resendCode</li>
<li>account.getPassword</li>
<li>auth.checkPassword</li>
<li>auth.checkPhone</li>
<li>auth.signUp</li>
<li>auth.signIn</li>
<li>auth.importAuthorization</li>
<li>help.getConfig</li>
<li>help.getNearestDc</li>
<li>help.getAppUpdate</li>
<li>help.getCdnConfig</li>
<li>langpack.getLangPack</li>
<li>langpack.getStrings</li>
<li>langpack.getDifference</li>
<li>langpack.getLanguages</li>
<li>langpack.getLanguage</li>
</ul><br>
<p>   , <code>auth.sendCode</code>,      ,     api_id  api_hash,      SMS  .        DC (     , ),        DC.  ,   IP-   DC  ,   <code>help.getConfig</code>. -    5 ,     2018    .</p><br>
<p>  ,         .      ,    IP-?      ,   ,    MTProto?  : "  ,       ?".    ,  -    <strong> RSA-</strong>, ..   <em></em>  . ,         ,       (,       MTProto,    ,  ).</p><br>
<p>, .              .     ,     ,   .  ...</p><br>
<blockquote>Vasily, [10.07.18 14:45]<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://core.telegram.org/method/help.getConfig</a><br>
<pre><code class="plaintext">config#7dae33e0 [...] = Config;<font></font>
help.getConfig#c4f9186b = Config;</code></pre><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://core.telegram.org/api/datacenter</a><br>
<pre><code class="plaintext">config#232d5905 [...] = Config;<font></font>
help.getConfig#c4f9186b = Config;</code></pre><br>
<br>
  ,  <br>
<br>
  tdesktop  </blockquote><p>,   , ,  .       .      ?  ,    ,  ?   ,   —     (,      ).</p><br>
<p>…  ,    -   API, ..   ,  -    MTProto?  :</p><br>
<blockquote>Vasily, [28.06.18 02:04]<br>
,      e2e<br>
<br>
Mtproto        ,     <br>
<br>
      ,     ,   mtproto    </blockquote><p> ?        PFS,  (, Telegram Desktop   ).    API <code>auth.bindTempAuthKey</code>, ..   .          —  , ,    <code>initConnection</code>  ..,   <em></em>  .     ,         DC,   <code>auth_key_id</code>         ,         ""   —     ,   …        ,    future salts, ?..</p><br>
<p>    MTProto   .</p><br>
<h2 id="anchorrecurseanchorsoobscheniya-o-soobscheniyah-msg_id-msg_seqno-podtverzhdeniya-pingi-ne-v-tu-storonu-i-drugie-idiosinkrazii"><a name="recurse"></a>  , msg_id, msg_seqno, ,        </h2><br>
<p>    ?    ""   ,     ,   API. , msg_key   ,      .         (  ,  ,  padding,    ):</p><br>
<ul>
<li>salt — int64</li>
<li>session_id — int64</li>
<li>message_id — int64</li>
<li>seq_no — int32</li>
</ul><br>
<p>,  —    DC.    ?   ,    <code>get_future_salts</code>,  ,      ,   ,     "",   () —  . , ,   ,  <code>new_session_created</code> —     -  , .       .</p><br>
<p>           . ,    MTProto   ?   , <code>session_id</code>  <code>seq_no</code>    . ,   TCP-, . ,       , , .     —   TCP-   ,  <code>seq_no</code> .   —    ,         ,   .</p><br>
<p>   <code>seq_no</code>? ,   .   ,    :</p><br>
<blockquote>Content-related Message<br>
<br>
A message requiring an explicit acknowledgment. These include all the user and many service messages, virtually all with the exception of containers and acknowledgments.<br>
<br>
Message Sequence Number (msg_seqno)<br>
<br>
A 32-bit number equal to twice the number of “content-related” messages (those requiring acknowledgment, and in particular those that are not containers) created by the sender prior to this message and subsequently incremented by one if the current message is a content-related message. A container is always generated after its entire contents; therefore, its sequence number is greater than or equal to the sequence numbers of the messages contained in it.</blockquote><p>       1,     2?.. ,     "   ACK,  ",        —  , ,    <strong></strong> ,      <code>seq_no</code>! ?     - , ,    ,         .              .     TCP  ,    - ,       ,   TCP <code>seq_no</code>  ,     <code>seq_no</code>   —   .  MTProto   <strong></strong>  <code>seq_no</code>,   TCP,   <code>msg_id</code> !</p><br>
<p>    <code>msg_id</code>,     ?   ,    .    64- ,        "- ",   — Unix timestamp,   ,   32  . ..     (        ).   ,   -  ,   .  ,  —  <code>session_id</code> —  : <strong>Under no circumstances can a message meant for one session be sent into a different session</strong>.  , ,    <em></em>  — ,   , id .   ,     .</p><br>
<p>, <code>msg_id</code>  ...</p><br>
<h3 id="anchorrpcackanchorrpc-zaprosy-otvety-oshibki-podtverzhdeniya"><a name="RPCack"></a>RPC: , , . .</h3><br>
<p> ,  , ,         " RPC-",   .      content-related !  , <em></em>    !   .   <strong></strong>  <code>msg_id</code>.    — :</p><br>
<pre><code class="plaintext">rpc_result#f35c6d01 req_msg_id:long result:Object = RpcResult;</code></pre><br>
<p>   ,     .  ,    API,  ,       — ,   ,   ,        ,        ?  ,  ,      no workers,     :    TCP-  — -,           <code>message_id</code>.    ,   .</p><br>
<p>?..   ?    RPC-    <code>msg_id</code>!      "     !"?  ,     ?   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>  ,  </p><br>
<pre><code class="plaintext">msgs_ack#62d6b459 msg_ids:Vector long = MsgsAck;</code></pre><br>
<p>     .   !    RpcResult,    .  ,       MsgsAck — , " ".    RpcResult.      .</p><br>
<p> ,      ! .           .   .  , ,   .    .</p><br>
<p>      .</p><br>
<pre><code class="plaintext">rpc_error#2144ca19 error_code:int error_message:string = RpcError;</code></pre><br>
<p>,  -,     —  !  .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>, , ,  .    ,   — <em> </em> HTTP- ( ,    ,       ),      <strong>___</strong>. , PHONE_NUMBER_OCCUPIED  FILE_PART__MISSING.   ,      <strong></strong>. , <code>FLOOD_WAIT_3600</code>  ,    ,  <code>PHONE_MIGRATE_5</code>,          5- DC.     , ?      ,  , .</p><br>
<p> ,      , ,      ,    <strong>   </strong>.  <em>  </em>. -, ,  / — <code>RpcError</code>     <code>RpcResult</code>.   ?    ?.. ,  ,  <code>RpcError</code>       <code>RpcResult</code>,        ?..    ,     , ..    <code>req_msg_id</code> ?..</p><br>
<p>    .   ,    ,      :</p><br>
<pre><code class="plaintext">rpc_drop_answer#58e4a740 req_msg_id:long = RpcDropAnswer;</code></pre><br>
<p>     ,     ,  ,     (    ,   ),       (:   Telegram Desktop   ).</p><br>
<h3 id="anchorhighanchornarkomaniya-statusy-soobscheniy-o-soobscheniyah"><a name="high"></a>:    </h3><br>
<p>,       TL, MTProto  Telegram  ,   ,    <em>soft skills</em>     ,     .   , <i></i>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>     ,           .</p><br>
<p>  ,  .    </p><br>
<pre><code class="plaintext">bad_msg_notification#a7eff811 bad_msg_id:long bad_msg_seqno:int error_code:int = BadMsgNotification;<font></font>
bad_server_salt#edab447b bad_msg_id:long bad_msg_seqno:int error_code:int new_server_salt:long = BadMsgNotification;</code></pre><br>
<p>,         MTProto,   " —  — "           —  .    :</p><br>
<ol>
<li>  ,    .   - ,   .</li>
<li>    ? 16, 17, 18, 19, 20, 32, 33, 34, 35, 48, 64…   , ?</li>
</ol><br>
<p> :</p><br>
<blockquote>The intention is that error_code values are grouped (error_code &gt;&gt; 4): for example, the codes 0x40 — 0x4f correspond to errors in container decomposition.</blockquote><p>, -,    , -,  ,   ?   ?.. ,  .</p><br>
<p>         :</p><br>
<ul>
<li>Request for Message Status Information<br>
If either party has not received information on the status of its outgoing messages for a while, it may explicitly request it from the other party:<br>
<code>msgs_state_req#da69fb52 msg_ids:Vector long = MsgsStateReq;</code></li>
<li>Informational Message regarding Status of Messages<br>
<code>msgs_state_info#04deb57d req_msg_id:long info:string = MsgsStateInfo;</code><br>
Here, <code>info</code> is a string that contains exactly one byte of message status for each message from the incoming msg_ids list:<br>
<ul>
<li>1 = nothing is known about the message (msg_id too low, the other party may have forgotten it)</li>
<li>2 = message not received (msg_id falls within the range of stored identifiers; however, the other party has certainly not received a message like that)</li>
<li>3 = message not received (msg_id too high; however, the other party has certainly not received it yet)</li>
<li>4 = message received (note that this response is also at the same time a receipt acknowledgment)</li>
<li>+8 = message already acknowledged</li>
<li>+16 = message not requiring acknowledgment</li>
<li>+32 = RPC query contained in message being processed or processing already complete</li>
<li>+64 = content-related response to message already generated</li>
<li>+128 = other party knows for a fact that message is already received<br>
This response does not require an acknowledgment. It is an acknowledgment of the relevant msgs_state_req, in and of itself.<br>
Note that if it turns out suddenly that the other party does not have a message that looks like it has been sent to it, the message can simply be re-sent. Even if the other party should receive two copies of the message at the same time, the duplicate will be ignored. (If too much time has passed, and the original msg_id is not longer valid, the message is to be wrapped in msg_copy).</li>
</ul></li>
<li>Voluntary Communication of Status of Messages<br>
Either party may voluntarily inform the other party of the status of the messages transmitted by the other party.<br>
<code>msgs_all_info#8cc0d131 msg_ids:Vector long info:string = MsgsAllInfo</code></li>
<li>Extended Voluntary Communication of Status of One Message<br>
…<br>
<code>msg_detailed_info#276d3ec6 msg_id:long answer_msg_id:long bytes:int status:int = MsgDetailedInfo;</code><br>
<code>msg_new_detailed_info#809db6df answer_msg_id:long bytes:int status:int = MsgDetailedInfo;</code></li>
<li>Explicit Request to Re-Send Messages<br>
<code>msg_resend_req#7d861a08 msg_ids:Vector long = MsgResendReq;</code><br>
The remote party immediately responds by re-sending the requested messages [...]</li>
<li>Explicit Request to Re-Send Answers<br>
<code>msg_resend_ans_req#8610baeb msg_ids:Vector long = MsgResendReq;</code><br>
The remote party immediately responds by re-sending <i>answers</i> to the requested messages [...]</li>
<li>Message Copies<br>
In some situations, an old message with a msg_id that is no longer valid needs to be re-sent. Then, it is wrapped in a copy container:<br>
<code>msg_copy#e06046b2 orig_message:Message = MessageCopy;</code><br>
Once received, the message is processed as if the wrapper were not there. However, if it is known for certain that the message orig_message.msg_id was received, then the new message is not processed (while at the same time, it and orig_message.msg_id are acknowledged). The value of orig_message.msg_id must be lower than the container’s msg_id.</li>
</ul><br>
<p>   ,   <code>msgs_state_info</code>     TL (   ,      enum,    ).   . - ,      <em>  </em> ?..  ,     - ,    ,     —   ,   .     <strong>  </strong>.</p><br>
<p> ,          ,       ,    ,    .   ,        <strong></strong>.   ,       ! ,   -,      .    , <em></em>,    ,    TL —   ()   ,  ,    , ..         .</p><br>
<h3 id="anchorpinganchor-pingi-i-taymingi-ocheredi"><a name="ping"></a>   . .</h3><br>
<p> ,       (   ),     —        TCP (  ,     ,       ),     MTProto — <strong> </strong>.    <s></s>     ,      ,     .</p><br>
<p>   —  . ,  -       —      .    ?    . ,      -    , ,  Telegram Desktop   4 ,   ( ,   ,           ;    ,      ,      MTProto    ).</p><br>
<p>  ? ,        ,       -,      .       ,    ,    TCP —  RTT      "" ( )      .  ,        —          .</p><br>
<p>  ,  , ?     TCP     TCP —       .</p><br>
<p> ,     ,  ,     ,    API? ,   ,  ,      . ?      <code>msg_id</code>,   <i></i> ,          —    -        (,    ,         ,     —     ,       - ). ,         ,    :</p><br>
<ol>
<li>      .</li>
<li> <code>msg_id</code>       —  ;   .</li>
<li>)   MsgsAck —  ,   " ".<br>
)  , -   ,   badmsg —   " "<br>
)  ,       —   , .</li>
<li>   <code>RpcResult</code> —   ( ) —   ,   .</li>
</ol><br>
<p><em></em>,       .       ,       ,  <code>msg_id</code>.      ,  -   ,   .</p><br>
<p>          .  ,    ,   ,         —   ,       ?   (, ).</p><br>
<p>  ?    "   "      "  ,     !" (   ,     ,  rationale    ,   ),  / —     ,    .        ?</p><br>
<blockquote>A server usually acknowledges the receipt of a message from a client (normally, an RPC query) using an RPC response. If a response is a long time coming, a server may first send a receipt acknowledgment, and somewhat later, the RPC response itself.<br>
<br>
A client normally acknowledges the receipt of a message from a server (usually, an RPC response) by adding an acknowledgment to the next RPC query if it is not transmitted too late (if it is generated, say, 60-120 seconds following the receipt of a message from the server). However, if for a long period of time there is no reason to send messages to the server or if there is a large number of unacknowledged messages from the server (say, over 16), the client transmits a stand-alone acknowledgment. </blockquote><p>… :    ,    ,   ,     .</p><br>
<p>  :</p><br>
<blockquote><strong>Ping Messages (PING/PONG)</strong><br>
<pre><code class="plaintext">ping#7abe77ec ping_id:long = Pong;</code></pre><br>
<br>
A response is usually returned to the same connection:<br>
<pre><code class="plaintext">pong#347773c5 msg_id:long ping_id:long = Pong;</code></pre><br>
<br>
These messages do not require acknowledgments. A pong is transmitted only in response to a ping while a ping can be initiated by either side.<br>
<br>
<strong>Deferred Connection Closure + PING</strong><br>
<pre><code class="plaintext">ping_delay_disconnect#f3427b8c ping_id:long disconnect_delay:int = Pong;</code></pre><br>
<br>
Works like ping. In addition, after this is received, the server starts a timer which will close the current connection disconnect_delay seconds later unless it receives a new message of the same type which automatically resets all previous timers. If the client sends these pings once every 60 seconds, for example, it may set disconnect_delay equal to 75 seconds. </blockquote><p>    ?!  60     , - ,      .  120 ,  ,    ,     . ,     — " ,     ",      TCP_NODELAY,    . , ,     — 200 <i></i>.               —  , ,  5 ,        "User is typing...".   .</p><br>
<p> , .  ,   TCP-. ,   10            —       ,   .     3 ,   —  , ?..</p><br>
<p>  . TCP-,    ,   .   ,  ,    . ,      SSH-  ,   - ,    ,    —       (  ,   ), . ,     ,    (, !),   , ,    —      .</p><br>
<p>  / IM       ,   — -.   "",      .   ,    Jabber ( 20  ) —  ,     , ,   online (           ). ,  TCP_KEEPALIVE,    ,    TCP,    (     ),    —   ,        ,    ,   ,    (,    ? Telegram Desktop  Ubuntu 18.04    ).</p><br>
<p>    <em></em> ,    —    ,       ,   .</p><br>
<p>      Telegram?   !  .. , ,      .    —    <code>ping_delay_disconnect</code>,     .  ,     ,       . ,    , . , ,    ,     ,   ...</p><br>
<h3 id="anchorteachlifeanchora-kak-nado-bylo-proektirovat"><a name="teachlife"></a>    ?</h3><br>
<p>,            Telegram/    ( )          .</p><br>
<p>     ,    Telegram   ? ,     ,    TCP-, , .     —  . ,    UDP-,       (     —   ).  -  ,      TCP  ,     ,      ( ),       "   " —    .</p><br>
<p>   ?   ,  <code>msg_id</code>   ,        replay-,        . ,      (   Updates,    API      ),   :</p><br>
<ol>
<li>,  TCP-  ,     —    ,  ,    ,  .      id',   "  seq_no" —  ,   TCP (  —  seq  ).      ,   ?</li>
<li>    replay-   , - nonce. ,        .   <code>uint32</code> —         ,   16        ,  —     (  ).</li>
<li> <code>msg_id</code>  —        , -, id , -, id ,   . ,        <code>seq_no</code>.</li>
</ol><br>
<p>    ,        —      API   , .          ,       ,   .</p><br>
<h1 id="anchordatadumperanchorapi-"><a name="DataDumper"></a>API ?</h1><br>
<p>-! ,   ,    ,              ,       (    ,     ,  PUSH,  -  ).</p><br>
<p>,        Perl! ( ,     ,   bless —   ,  —  ):</p><br>
<pre><code class="perl">2019.10.24 12:00:51 $1 = {<font></font>
  'cb' =&gt; 'TeleUpd::__ANON__',<font></font>
  'out' =&gt; bless( {<font></font>
    'filter' =&gt; bless( {}, 'Telegram::ChannelMessagesFilterEmpty' ),<font></font>
    'channel' =&gt; bless( {<font></font>
      'access_hash' =&gt; '-6698103710539760874',<font></font>
      'channel_id' =&gt; '1380524958'<font></font>
    }, 'Telegram::InputPeerChannel' ),<font></font>
    'pts' =&gt; '158503',<font></font>
    'flags' =&gt; 0,<font></font>
    'limit' =&gt; 0<font></font>
  }, 'Telegram::Updates::GetChannelDifference' ),<font></font>
  'req_id' =&gt; '6751291954012037292'<font></font>
};<font></font>
<font></font>
2019.10.24 12:00:51 $1 = {<font></font>
  'in' =&gt; bless( {<font></font>
    'req_msg_id' =&gt; '6751291954012037292',<font></font>
    'result' =&gt; bless( {<font></font>
      'pts' =&gt; 158508,<font></font>
      'flags' =&gt; 3,<font></font>
      'final' =&gt; 1,<font></font>
      'new_messages' =&gt; [],<font></font>
      'users' =&gt; [],<font></font>
      'chats' =&gt; [<font></font>
        bless( {<font></font>
          'title' =&gt; '',<font></font>
          'username' =&gt; 'hoolinomics',<font></font>
          'flags' =&gt; 8288,<font></font>
          'id' =&gt; 1380524958,<font></font>
          'access_hash' =&gt; '-6698103710539760874',<font></font>
          'broadcast' =&gt; 1,<font></font>
          'version' =&gt; 0,<font></font>
          'photo' =&gt; bless( {<font></font>
            'photo_small' =&gt; bless( {<font></font>
              'volume_id' =&gt; 246933270,<font></font>
              'file_reference' =&gt; '<font></font>
              'secret' =&gt; '1854156056801727328',<font></font>
              'local_id' =&gt; 228648,<font></font>
              'dc_id' =&gt; 2<font></font>
            }, 'Telegram::FileLocation' ),<font></font>
            'photo_big' =&gt; bless( {<font></font>
              'dc_id' =&gt; 2,<font></font>
              'local_id' =&gt; 228650,<font></font>
              'file_reference' =&gt; '<font></font>
              'secret' =&gt; '1275570353387113110',<font></font>
              'volume_id' =&gt; 246933270<font></font>
            }, 'Telegram::FileLocation' )<font></font>
          }, 'Telegram::ChatPhoto' ),<font></font>
          'date' =&gt; 1531221081<font></font>
        }, 'Telegram::Channel' )<font></font>
      ],<font></font>
      'timeout' =&gt; 300,<font></font>
      'other_updates' =&gt; [<font></font>
        bless( {<font></font>
          'pts_count' =&gt; 0,<font></font>
          'message' =&gt; bless( {<font></font>
            'post' =&gt; 1,<font></font>
            'id' =&gt; 852,<font></font>
            'flags' =&gt; 50368,<font></font>
            'views' =&gt; 8013,<font></font>
            'entities' =&gt; [<font></font>
              bless( {<font></font>
                'length' =&gt; 20,<font></font>
                'offset' =&gt; 0<font></font>
              }, 'Telegram::MessageEntityBold' ),<font></font>
              bless( {<font></font>
                'length' =&gt; 18,<font></font>
                'offset' =&gt; 480,<font></font>
                'url' =&gt; 'https://alexeymarkov.livejournal.com/[url_].html'<font></font>
              }, 'Telegram::MessageEntityTextUrl' )<font></font>
            ],<font></font>
            'reply_markup' =&gt; bless( {<font></font>
              'rows' =&gt; [<font></font>
                bless( {<font></font>
                  'buttons' =&gt; [<font></font>
                    bless( {<font></font>
                      'text' =&gt; '???? 165',<font></font>
                      'data' =&gt; 'send_reaction_0'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' ),<font></font>
                    bless( {<font></font>
                      'data' =&gt; 'send_reaction_1',<font></font>
                      'text' =&gt; '???? 9'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' )<font></font>
                  ]<font></font>
                }, 'Telegram::KeyboardButtonRow' )<font></font>
              ]<font></font>
            }, 'Telegram::ReplyInlineMarkup' ),<font></font>
            'message' =&gt; '    ! <font></font>
// [         ]<font></font>
 .',<font></font>
            'to_id' =&gt; bless( {<font></font>
              'channel_id' =&gt; 1380524958<font></font>
            }, 'Telegram::PeerChannel' ),<font></font>
            'date' =&gt; 1571724559,<font></font>
            'edit_date' =&gt; 1571907562<font></font>
          }, 'Telegram::Message' ),<font></font>
          'pts' =&gt; 158508<font></font>
        }, 'Telegram::UpdateEditChannelMessage' ),<font></font>
        bless( {<font></font>
          'pts' =&gt; 158508,<font></font>
          'message' =&gt; bless( {<font></font>
            'edit_date' =&gt; 1571907589,<font></font>
            'to_id' =&gt; bless( {<font></font>
              'channel_id' =&gt; 1380524958<font></font>
            }, 'Telegram::PeerChannel' ),<font></font>
            'date' =&gt; 1571807301,<font></font>
            'message' =&gt; '   Facebook  ?  ? -,   .  ,   ,     ,      .<font></font>
<font></font>
    :   Facebook     . ,      ,     .      . -       .  ,             ,     -      .    .<font></font>
<font></font>
,     :     Whatsapp,  Instagram.     ,    !<font></font>
<font></font>
    .     . - -   ,    .<font></font>
<font></font>
# #facebook # #',<font></font>
            'reply_markup' =&gt; bless( {<font></font>
              'rows' =&gt; [<font></font>
                bless( {<font></font>
                  'buttons' =&gt; [<font></font>
                    bless( {<font></font>
                      'data' =&gt; 'send_reaction_0',<font></font>
                      'text' =&gt; '???? 452'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' ),<font></font>
                    bless( {<font></font>
                      'text' =&gt; '???? 21',<font></font>
                      'data' =&gt; 'send_reaction_1'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' )<font></font>
                  ]<font></font>
                }, 'Telegram::KeyboardButtonRow' )<font></font>
              ]<font></font>
            }, 'Telegram::ReplyInlineMarkup' ),<font></font>
            'entities' =&gt; [<font></font>
              bless( {<font></font>
                'length' =&gt; 199,<font></font>
                'offset' =&gt; 0<font></font>
              }, 'Telegram::MessageEntityBold' ),<font></font>
              bless( {<font></font>
                'length' =&gt; 8,<font></font>
                'offset' =&gt; 919<font></font>
              }, 'Telegram::MessageEntityHashtag' ),<font></font>
              bless( {<font></font>
                'offset' =&gt; 928,<font></font>
                'length' =&gt; 9<font></font>
              }, 'Telegram::MessageEntityHashtag' ),<font></font>
              bless( {<font></font>
                'length' =&gt; 6,<font></font>
                'offset' =&gt; 938<font></font>
              }, 'Telegram::MessageEntityHashtag' ),<font></font>
              bless( {<font></font>
                'length' =&gt; 11,<font></font>
                'offset' =&gt; 945<font></font>
              }, 'Telegram::MessageEntityHashtag' )<font></font>
            ],<font></font>
            'views' =&gt; 6964,<font></font>
            'flags' =&gt; 50368,<font></font>
            'id' =&gt; 854,<font></font>
            'post' =&gt; 1<font></font>
          }, 'Telegram::Message' ),<font></font>
          'pts_count' =&gt; 0<font></font>
        }, 'Telegram::UpdateEditChannelMessage' ),<font></font>
        bless( {<font></font>
          'message' =&gt; bless( {<font></font>
            'reply_markup' =&gt; bless( {<font></font>
              'rows' =&gt; [<font></font>
                bless( {<font></font>
                  'buttons' =&gt; [<font></font>
                    bless( {<font></font>
                      'data' =&gt; 'send_reaction_0',<font></font>
                      'text' =&gt; '???? 213'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' ),<font></font>
                    bless( {<font></font>
                      'data' =&gt; 'send_reaction_1',<font></font>
                      'text' =&gt; '???? 8'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' )<font></font>
                  ]<font></font>
                }, 'Telegram::KeyboardButtonRow' )<font></font>
              ]<font></font>
            }, 'Telegram::ReplyInlineMarkup' ),<font></font>
            'views' =&gt; 2940,<font></font>
            'entities' =&gt; [<font></font>
              bless( {<font></font>
                'length' =&gt; 609,<font></font>
                'offset' =&gt; 348<font></font>
              }, 'Telegram::MessageEntityItalic' )<font></font>
            ],<font></font>
            'flags' =&gt; 50368,<font></font>
            'post' =&gt; 1,<font></font>
            'id' =&gt; 857,<font></font>
            'edit_date' =&gt; 1571907636,<font></font>
            'date' =&gt; 1571902479,<font></font>
            'to_id' =&gt; bless( {<font></font>
              'channel_id' =&gt; 1380524958<font></font>
            }, 'Telegram::PeerChannel' ),<font></font>
            'message' =&gt; '  1   .  10 (, 1-)  :<font></font>
// [         ]<font></font>
<font></font>
  ,    1 ,  ... , .'<font></font>
          }, 'Telegram::Message' ),<font></font>
          'pts_count' =&gt; 0,<font></font>
          'pts' =&gt; 158508<font></font>
        }, 'Telegram::UpdateEditChannelMessage' ),<font></font>
        bless( {<font></font>
          'pts' =&gt; 158508,<font></font>
          'pts_count' =&gt; 0,<font></font>
          'message' =&gt; bless( {<font></font>
            'message' =&gt; ', , ,    1?<font></font>
<font></font>
// [         ]<font></font>
# #it #',<font></font>
            'edit_date' =&gt; 1571907650,<font></font>
            'date' =&gt; 1571893707,<font></font>
            'to_id' =&gt; bless( {<font></font>
              'channel_id' =&gt; 1380524958<font></font>
            }, 'Telegram::PeerChannel' ),<font></font>
            'flags' =&gt; 50368,<font></font>
            'post' =&gt; 1,<font></font>
            'id' =&gt; 856,<font></font>
            'reply_markup' =&gt; bless( {<font></font>
              'rows' =&gt; [<font></font>
                bless( {<font></font>
                  'buttons' =&gt; [<font></font>
                    bless( {<font></font>
                      'data' =&gt; 'send_reaction_0',<font></font>
                      'text' =&gt; '???? 360'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' ),<font></font>
                    bless( {<font></font>
                      'data' =&gt; 'send_reaction_1',<font></font>
                      'text' =&gt; '???? 32'<font></font>
                    }, 'Telegram::KeyboardButtonCallback' )<font></font>
                  ]<font></font>
                }, 'Telegram::KeyboardButtonRow' )<font></font>
              ]<font></font>
            }, 'Telegram::ReplyInlineMarkup' ),<font></font>
            'views' =&gt; 4416,<font></font>
            'entities' =&gt; [<font></font>
              bless( {<font></font>
                'offset' =&gt; 0,<font></font>
                'length' =&gt; 64<font></font>
              }, 'Telegram::MessageEntityBold' ),<font></font>
              bless( {<font></font>
                'offset' =&gt; 1551,<font></font>
                'length' =&gt; 5<font></font>
              }, 'Telegram::MessageEntityHashtag' ),<font></font>
              bless( {<font></font>
                'length' =&gt; 3,<font></font>
                'offset' =&gt; 1557<font></font>
              }, 'Telegram::MessageEntityHashtag' ),<font></font>
              bless( {<font></font>
                'offset' =&gt; 1561,<font></font>
                'length' =&gt; 10<font></font>
              }, 'Telegram::MessageEntityHashtag' )<font></font>
            ]<font></font>
          }, 'Telegram::Message' )<font></font>
        }, 'Telegram::UpdateEditChannelMessage' )<font></font>
      ]<font></font>
    }, 'Telegram::Updates::ChannelDifference' )<font></font>
  }, 'MTProto::RpcResult' )<font></font>
};<font></font>
<font></font>
2019.10.24 12:00:51 $1 = {<font></font>
  'in' =&gt; bless( {<font></font>
    'update' =&gt; bless( {<font></font>
      'user_id' =&gt; 2507460,<font></font>
      'status' =&gt; bless( {<font></font>
        'was_online' =&gt; 1571907651<font></font>
      }, 'Telegram::UserStatusOffline' )<font></font>
    }, 'Telegram::UpdateUserStatus' ),<font></font>
    'date' =&gt; 1571907650<font></font>
  }, 'Telegram::UpdateShort' )<font></font>
};<font></font>
<font></font>
2019.10.24 12:05:46 $1 = {<font></font>
  'in' =&gt; bless( {<font></font>
    'chats' =&gt; [],<font></font>
    'date' =&gt; 1571907946,<font></font>
    'seq' =&gt; 0,<font></font>
    'updates' =&gt; [<font></font>
      bless( {<font></font>
        'max_id' =&gt; 141719,<font></font>
        'channel_id' =&gt; 1295963795<font></font>
      }, 'Telegram::UpdateReadChannelInbox' )<font></font>
    ],<font></font>
    'users' =&gt; []<font></font>
  }, 'Telegram::Updates' )<font></font>
};<font></font>
<font></font>
2019.10.24 13:01:23 $1 = {<font></font>
  'in' =&gt; bless( {<font></font>
    'server_salt' =&gt; '4914425622822907323',<font></font>
    'unique_id' =&gt; '5297282355827493819',<font></font>
    'first_msg_id' =&gt; '6751307555044380692'<font></font>
  }, 'MTProto::NewSessionCreated' )<font></font>
};<font></font>
<font></font>
2019.10.24 13:24:21 $1 = {<font></font>
  'in' =&gt; bless( {<font></font>
    'chats' =&gt; [<font></font>
      bless( {<font></font>
        'username' =&gt; 'freebsd_ru',<font></font>
        'version' =&gt; 0,<font></font>
        'flags' =&gt; 5440,<font></font>
        'title' =&gt; 'freebsd_ru',<font></font>
        'min' =&gt; 1,<font></font>
        'photo' =&gt; bless( {<font></font>
          'photo_small' =&gt; bless( {<font></font>
            'local_id' =&gt; 328733,<font></font>
            'volume_id' =&gt; 235140688,<font></font>
            'dc_id' =&gt; 2,<font></font>
            'file_reference' =&gt; '<font></font>
            'secret' =&gt; '4426006807282303416'<font></font>
          }, 'Telegram::FileLocation' ),<font></font>
          'photo_big' =&gt; bless( {<font></font>
            'dc_id' =&gt; 2,<font></font>
            'file_reference' =&gt; '<font></font>
            'volume_id' =&gt; 235140688,<font></font>
            'local_id' =&gt; 328735,<font></font>
            'secret' =&gt; '71251192991540083'<font></font>
          }, 'Telegram::FileLocation' )<font></font>
        }, 'Telegram::ChatPhoto' ),<font></font>
        'date' =&gt; 1461248502,<font></font>
        'id' =&gt; 1038300508,<font></font>
        'democracy' =&gt; 1,<font></font>
        'megagroup' =&gt; 1<font></font>
      }, 'Telegram::Channel' )<font></font>
    ],<font></font>
    'users' =&gt; [<font></font>
      bless( {<font></font>
        'last_name' =&gt; 'Panov',<font></font>
        'flags' =&gt; 1048646,<font></font>
        'min' =&gt; 1,<font></font>
        'id' =&gt; 82234609,<font></font>
        'status' =&gt; bless( {}, 'Telegram::UserStatusRecently' ),<font></font>
        'first_name' =&gt; 'Dima'<font></font>
      }, 'Telegram::User' )<font></font>
    ],<font></font>
    'seq' =&gt; 0,<font></font>
    'date' =&gt; 1571912647,<font></font>
    'updates' =&gt; [<font></font>
      bless( {<font></font>
        'pts' =&gt; 137596,<font></font>
        'message' =&gt; bless( {<font></font>
          'flags' =&gt; 256,<font></font>
          'message' =&gt; '     ??',<font></font>
          'to_id' =&gt; bless( {<font></font>
            'channel_id' =&gt; 1038300508<font></font>
          }, 'Telegram::PeerChannel' ),<font></font>
          'id' =&gt; 119634,<font></font>
          'date' =&gt; 1571912647,<font></font>
          'from_id' =&gt; 82234609<font></font>
        }, 'Telegram::Message' ),<font></font>
        'pts_count' =&gt; 1<font></font>
      }, 'Telegram::UpdateNewChannelMessage' )<font></font>
    ]<font></font>
  }, 'Telegram::Updates' )<font></font>
};</code></pre><br>
<p>,     —    ,    !</p><br>
<p>Oh, wai~~…     ? -  … ,     Web API  JSON,        ?..</p><br>
<p>   …    , ?..   —     ,  Web- <strong> </strong>?..   JSON  HTTPS    ?!       ?     ?</p><br>
<p> ,    TL+MTProto,    . , HTTP,    "-",  ,    -  TLS ?</p><br>
<p><strong> .</strong>     ,   JSON, ,     .  MsgPack   ,   , , CBOR —  , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RFC 7049</a>.   ,     <em></em>,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> :</p><br>
<ul>
<li>25 + 256 —        ,    </li>
<li>26 —   Perl c     </li>
<li>27 —         </li>
</ul><br>
<p>  ,          TL   CBOR      .      CBOR -  :</p><br>
<pre><code class="plaintext">cborlen=1039673 tl_len=1095092</code></pre><br>
<p>, <strong></strong>:     ,        ,   .</p><br>
<p><strong>  </strong>.     RTT   (     ) —      MTProto,     —     ,   , etc.     TLS?   :</p><br>
<blockquote>  PFS  TLS   TLS session tickets (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">RFC 5077</a>)               .       ,         (  session ticket). ,      session ticket,      ,  .  ticket    (session ticket key),          frontend-,  SSL   .[10].  ,  session ticket   PFS      , ,     (OpenSSL, nginx, Apache          ;        ,   ). </blockquote><p> RTT  ,     ClientHello  ServerHello,     Finished     .    ,     Web,      ,  ,       - ,     Web- —   .  ,  ,         .</p><br>
<p><strong>-  ?</strong>   .</p><br>
<h1 id="anchorbroiler747anchor-to-be-continued"><a name="broiler747"></a> To be continued!</h1><br>
<p>          ,    — , , ,     .. , ,    ,    .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3番目の部分では、技術コンポーネント/開発経験の分析を続けます。</font><font style="vertical-align: inherit;">あなたは特に学びます：</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さまざまなTLタイプのホイッスルの継続</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャネルとスーパーグループについて不明な点</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダイアログよりも悪い名簿</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">絶対メッセージと相対メッセージのアドレス指定について</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写真と画像の違いは何ですか</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">絵文字がイタリックを妨げる方法</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の松葉杖！</font><font style="vertical-align: inherit;">乞うご期待！</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja472958/index.html">ArduinoでWindowsプログラムを作成する方法</a></li>
<li><a href="../ja472960/index.html">ソニーの最高の価格/品質のレンズ</a></li>
<li><a href="../ja472962/index.html">ビデオポスト：科学的視覚化の一形態としての実験</a></li>
<li><a href="../ja472964/index.html">状況：ますます多くのオープンソース企業がライセンスを変更しています-専門家の意見について話し合います</a></li>
<li><a href="../ja472966/index.html">zipアーカイブはどのように見え、それで何ができるか。パート2-データ記述子と圧縮</a></li>
<li><a href="../ja472972/index.html">私たちは、JavaScriptクラスとしてCookieを使用します</a></li>
<li><a href="../ja472978/index.html">彼自身の息子のためのArduinoオーサリングコース</a></li>
<li><a href="../ja472980/index.html">ショーツBelokamentseva</a></li>
<li><a href="../ja472982/index.html">「故障を見つけるために聞いてください」：故障した産業機械のオーディオ録音が公開されました</a></li>
<li><a href="../ja472984/index.html">ROSトラックトロリー。パート7.ロボットのローカリゼーション：gmapping、AMCL、ルームマップ上の参照ポイント</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>