<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋🏾 🤩 🌟 DOTSで3人称ゾンビシューターを作成する 👩🏼‍⚕️ 👏🏿 👨🏾‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="敬礼、ハブロフスク。すでに書いたように、1月は新しいローンチが豊富で、本日はOTUSの新しいコースのセットを発表します- "Game Developer for Unity"。コースの開始を見越して、興味深い資料の翻訳を共有します。
 
 
 
 Unityコアをデータ指向のTech Stackで再...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DOTSで3人称ゾンビシューターを作成する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/484094/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">敬礼、ハブロフスク。</font><font style="vertical-align: inherit;">すでに書いたように、1月は新しいローンチが豊富で、本日はOTUSの新しいコースのセットを発表します- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Game Developer for Unity"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">コースの開始を見越して、興味深い資料の翻訳を共有します。</font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/o-/2d/iz/o-2diz_bo0cjb7cksohmc8zeoxc.png"><br>
<br>
<hr><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unityコアを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ指向のTech Stackで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再構築してい</font><font style="vertical-align: inherit;">ます。多くのゲームスタジオと同様に、エンティティコンポーネントシステム（ECS）、C＃タスクシステム（C＃ジョブシステム）、バーストコンパイラを使用することにも大きな利点があります。 Unite Copenhagenでは、ファーノースエンターテインメントとチャットし、従来のUnityプロジェクトでこのDOTS機能を実装する方法を掘り下げる機会がありました。</font></font></blockquote><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Far North Entertainmentは、5人のエンジニアリングの友人が共同所有するスウェーデンのスタジオです。 2018年初頭に「Down to Dungeon for Gear VR」をリリースして以来、同社はPCゲームの古典的なジャンルに属するゲーム、つまりゾンビサバイバルモードのポスト黙示録的なゲームに取り組んできました。プロジェクトを他のプロジェクトと区別するのは、あなたを追いかけているゾンビの数です。この点に関するチームのビジョンは、あなたの後に巨大な群れで何千もの空腹のゾンビを引き寄せました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、プロトタイピングの段階ですでに多くのパフォーマンスの問題が発生しています。この数の敵すべての作成、死、更新、アニメーションは、チームが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オブレクティングプール</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">問題を解決するために問題を解決しようとした後でも、主要なボトルネックのままでし</font><font style="vertical-align: inherit;">た。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニメーションインスタンス化</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、スタジオテクニカルディレクターのAndres EricssonはDOTSに注意を払い、オブジェクト指向からデータ指向へと考え方を変えました。 「この変化をもたらした主なアイデアは、オブジェクトとオブジェクト階層について考えるのをやめ、データ、どのように変換されているか、それにどのようにアクセスするかについて考え始める必要があるということでした」と彼は言った。 。彼の言葉は、最も一般的で抽象的な問題を解決するような方法で、実生活のオブジェクトに目を向けたコードアーキテクチャを構築する必要がないことを意味します。彼のように、世界観の変化に直面している人々のために、彼は多くのヒントを持っています：</font></font><br>
<br>
<i>« ,     ,    ,       .               ?           ?       ,         .             ?»</i><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/QGM4feh0fRA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 チームは、Unityコンポーネントシステムのエンティティはコンポーネントストリームの検索識別子にすぎないことを理解するようになりました。</font><font style="vertical-align: inherit;">コンポーネントは単なるデータですが、システムにはすべてのロジックが含まれており、アーキタイプと呼ばれる特定の署名を持つエンティティを除外します。</font><font style="vertical-align: inherit;">「アイデアを視覚化するのに役立つ洞察の1つは、ECSをSQLデータベースとして導入することでした。</font><font style="vertical-align: inherit;">各アーキタイプは、各列がコンポーネントであり、各行が一意のエンティティであるテーブルです。</font><font style="vertical-align: inherit;">基本的に、システムを使用してこれらのアーキタイプテーブルのクエリを作成し、エンティティに対して操作を実行します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOTSの紹介</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 この理解に来て、彼はのためのドキュメンテーション研究</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンティティコンポーネント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システム</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例、</font><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々はNordeusと一緒にやったとユナイトオースティンで発表されていることを。データ指向アーキテクチャに関する一般的な情報も、チームにとって非常に役立ちました。 「</font><font style="vertical-align: inherit;">CppCon 2014を使用したデータ中心アーキテクチャに関する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mike Acton</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">レポート</font></a><font style="vertical-align: inherit;">は、まさにこの方法でプログラミングに目を向けた最初のものでした。」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファーノースチームは彼らが</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発したブログ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">彼らが学んだことを公開し、</font><font style="vertical-align: inherit;">今年の9月に彼らはUnityのデータ指向アプローチへの移行の経験について話すためにコペンハーゲンに来ました。</font></font><br>
 <br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yTGhg905SCs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 この記事はレポートに基づいており、ECS、C＃タスクシステム、バーストコンパイラの実装の詳細を詳しく説明しています。</font><font style="vertical-align: inherit;">ファーノースはまた、プロジェクトの多くのコードサンプルを親切に共有してくれました。</font></font><br>
 <br>
 <h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゾンビのデータ編成</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 「私たちが直面していた問題は、クライアント側の何千ものオブジェクトの動きと回転の補間でした」とアンダースは言います。彼らの最初のオブジェクト指向のアプローチは</font><font style="vertical-align: inherit;">、一般的な</font><i><font style="vertical-align: inherit;">EntityView</font></i><font style="vertical-align: inherit;">親クラスを継承し</font><font style="vertical-align: inherit;">た抽象的な</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZombieView</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトを作成することでした</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">EntityViewが</font></i><font style="vertical-align: inherit;">ある</font><i><font style="vertical-align: inherit;">MonoBehaviour</font></i><font style="vertical-align: inherit;">に添付</font><i><font style="vertical-align: inherit;">ゲームオブジェクト</font></i><font style="vertical-align: inherit;">。ゲームモデルの視覚的表現として機能します。各</font><i><font style="vertical-align: inherit;">ZombieView</font></i><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">Update</font></i><font style="vertical-align: inherit;">関数で独自の動きと回転の補間を処理しました</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各エンティティがメモリ内の任意の場所に配置されていることを理解するまで、これは正常に聞こえます。つまり、何千ものオブジェクトにアクセスしている場合、CPUは一度に1つずつオブジェクトをメモリから取り出さなければならず、これは非常にゆっくりと行われます。直列に配置されたきちんとしたブロックにデータを置くと、プロセッサーはデータ全体を同時にキャッシュできます。最近のほとんどのプロセッサは、1サイクルでキャッシュから約128ビットまたは256ビットを取得できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チームは、クライアント側のパフォーマンスの問題を解決するために、敵をDOTSに変換することを決定しました。行の最初でした</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アップデート</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能</font><font style="vertical-align: inherit;">で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZombieView</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。チームは、どの部分を異なるシステムに分割すべきかを決定し、必要なデータを決定しました。ゲームの世界は2次元のグリッドなので、最初の最も明白なことは、位置とターンの補間でした。 2つのfloat変数は、ゾンビが向いている場所に関与します。最後のコンポーネントはターゲットの位置であり、敵のサーバーの位置を追跡します。</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> PositionData2D : IComponentData<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> float2 Position;<font></font>
}<font></font>
 <font></font>
 <font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> HeadingData2D : IComponentData<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> float2 Heading;<font></font>
}<font></font>
 <font></font>
[<span class="hljs-meta">Serializable</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> TargetPositionData : IComponentData<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> float2 TargetPosition;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 次のステップは、敵の原型を作成することでした。アーキタイプは、特定のエンティティに属するコンポーネントのセットです。つまり、コンポーネントのシグネチャです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
敵はより多くのコンポーネントを必要とし、それらのいくつかはGameObjectへのリンクを必要とするため、プロジェクトはプレハブを使用してアーキタイプを決定し</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、あなたがあなたのコンポーネントのデータをラップすることができるように動作します</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ComponentDataProxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にそれを回すなる、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonoBehaviour</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今度はプレハブに取り付けることができます。</font><i><font style="vertical-align: inherit;">EntityManager</font></i><font style="vertical-align: inherit;">を使用してインスタンスを作成するとき</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレハブを渡すと、プレハブに接続されたコンポーネントのすべてのデータを含むエンティティが作成されます。すべてのコンポーネントデータは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArchetypeChunk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる16キロバイトのメモリチャンクに格納されます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、コンポーネントフローがアーキタイプチャンクでどのように編成されるかを視覚化したものです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/cn/r9/mhcnr9qjgpsr6lkej2l0ezq0jmi.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「アーキタイプチャンクの主な利点の1つは、メモリが事前に割り当てられているため、新しいオブジェクトを作成するときに多くの場合、バンチを再割り当てする必要がないことです。</font><font style="vertical-align: inherit;">つまり、エンティティの作成は、アーキタイプチャンク内のコンポーネントフローの最後にあるデータのレコードです。</font><font style="vertical-align: inherit;">ヒープ割り当てを最初からやり直す必要があるのは、チャンクの境界に収まらないエンティティを作成する場合のみです。</font><font style="vertical-align: inherit;">この場合、新しい16 KBアーキタイプチャンクが開始されるか、同じアーキタイプの空のフラグメントがある場合は再利用できます。</font><font style="vertical-align: inherit;">次に、新しいオブジェクトのデータは、新しいチャンクのコンポーネントフローに記録され</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゾンビのマルチスレッド</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 データが密にパックされ、キャッシュに便利な方法でメモリに配置されたので、チームは簡単にC＃タスクシステムを使用して、複数のCPUコアでコードを並列に実行できました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PositionData2D</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeadingData2D、</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TargetPositionDataコンポーネント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を持つすべてのアーキタイプブロックからすべてのエンティティをフィルター</font><font style="vertical-align: inherit;">で</font><i><font style="vertical-align: inherit;">除外する</font></i><font style="vertical-align: inherit;">システムを作成することでした</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うために、Andersと彼のチームは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JobComponentSystem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OnCreate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数でリクエストを</font><font style="vertical-align: inherit;">作成しました</font><font style="vertical-align: inherit;">。次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> EntityQuery m_Group;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnCreate</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
	<span class="hljs-keyword">base</span>.OnCreate();<font></font>
<font></font>
	<span class="hljs-keyword">var</span> query = <span class="hljs-keyword">new</span> EntityQueryDesc<font></font>
	{<font></font>
		All = <span class="hljs-keyword">new</span> [] <font></font>
		{<font></font>
			ComponentType.ReadWrite&lt;PositionData2D&gt;(),<font></font>
			ComponentType.ReadWrite&lt;HeadingData2D&gt;(),<font></font>
			ComponentType.ReadOnly&lt;TargetPositionData&gt;()<font></font>
		},<font></font>
	};<font></font>
<font></font>
	m_Group = GetEntityQuery(query);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 このコードは、位置、方向、および目的を持つ世界のすべてのオブジェクトを除外するリクエストをアナウンスします。次に、C＃タスクシステムを使用して各フレームのタスクをスケジュールし、複数のワークフローに計算を分散させたいと考えていました。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「C＃タスクシステムの最も優れた点は、Unityがコードで使用するのと同じシステムであるため、実行可能スレッドが互いにブロックし、同じプロセッサコアが必要で、パフォーマンスの問題が発生することを心配する必要がありませんでした。 …」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンダースは言います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チームは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IJobChunk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用することを決定しまし</font><font style="vertical-align: inherit;">た。何千もの敵が、実行時にリクエストと一致するはずの多数のアーキタイプチャンクの存在を暗示したからです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イジョブチャンク</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しいチャンクをさまざまなワークフローに分散します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各フレーム、新しい</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UpdatePositionAndHeadingJob</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスク</font><font style="vertical-align: inherit;">は、ゲーム内の敵の位置とターンの補間を処理します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タスクをスケジュールするためのコードは次のとおりです。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> JobHandle <span class="hljs-title">OnUpdate</span>(<span class="hljs-params">JobHandle inputDeps</span>)</span><font></font>
{<font></font>
	<span class="hljs-keyword">var</span> positionDataType       = GetArchetypeChunkComponentType&lt;PositionData2D&gt;();
	<span class="hljs-keyword">var</span> headingDataType        = GetArchetypeChunkComponentType&lt;HeadingData2D&gt;();
	<span class="hljs-keyword">var</span> targetPositionDataType = GetArchetypeChunkComponentType&lt;TargetPositionData&gt;(<span class="hljs-literal">true</span>);<font></font>
<font></font>
	<span class="hljs-keyword">var</span> updatePosAndHeadingJob = <span class="hljs-keyword">new</span> UpdatePositionAndHeadingJob<font></font>
	{<font></font>
		PositionDataType = positionDataType,<font></font>
		HeadingDataType = headingDataType,<font></font>
		TargetPositionDataType = targetPositionDataType,<font></font>
		DeltaTime = Time.deltaTime,<font></font>
		RotationLerpSpeed = <span class="hljs-number">2.0f</span>,<font></font>
		MovementLerpSpeed = <span class="hljs-number">4.0f</span>,<font></font>
	};<font></font>
<font></font>
	<span class="hljs-keyword">return</span> updatePosAndHeadingJob.Schedule(m_Group, inputDeps);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 これはタスク自体です：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> UpdatePositionAndHeadingJob : IJobChunk<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> ArchetypeChunkComponentType&lt;PositionData2D&gt; PositionDataType;
    <span class="hljs-keyword">public</span> ArchetypeChunkComponentType&lt;HeadingData2D&gt; HeadingDataType;<font></font>
<font></font>
    [<span class="hljs-meta">ReadOnly</span>]
    <span class="hljs-keyword">public</span> ArchetypeChunkComponentType&lt;TargetPositionData&gt; TargetPositionDataType;<font></font>
<font></font>
    [<span class="hljs-meta">ReadOnly</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> DeltaTime;<font></font>
    [<span class="hljs-meta">ReadOnly</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> RotationLerpSpeed;<font></font>
    [<span class="hljs-meta">ReadOnly</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> MovementLerpSpeed;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ワーカースレッドがキューからタスクを取得すると、タスクのコアが呼び出されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行コアは次のようになります。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params">ArchetypeChunk chunk, <span class="hljs-keyword">int</span> chunkIndex, <span class="hljs-keyword">int</span> firstEntityIndex</span>)</span><font></font>
{<font></font>
	<span class="hljs-keyword">var</span> chunkPositionData       = chunk.GetNativeArray(PositionDataType);
	<span class="hljs-keyword">var</span> chunkHeadingData        = chunk.GetNativeArray(HeadingDataType);
	<span class="hljs-keyword">var</span> chunkTargetPositionData = chunk.GetNativeArray(TargetPositionDataType);<font></font>
		   <font></font>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; chunk.Count; i++)<font></font>
	{<font></font>
		<span class="hljs-keyword">var</span> target       = chunkTargetPositionData[i];
		<span class="hljs-keyword">var</span> positionData = chunkPositionData[i];
		<span class="hljs-keyword">var</span> headingData  = chunkHeadingData[i];<font></font>
<font></font>
		float2 toTarget = target.TargetPosition - positionData.Position;<font></font>
		<span class="hljs-keyword">float</span> distance  = math.length(toTarget);<font></font>
<font></font>
		headingData.Heading = math.<span class="hljs-keyword">select</span>(<font></font>
			headingData.Heading,<font></font>
			math.lerp(headingData.Heading, <font></font>
					math.normalize(toTarget), <font></font>
					math.mul(DeltaTime, RotationLerpSpeed)),<font></font>
			distance &gt; <span class="hljs-number">0.008</span><font></font>
		);<font></font>
<font></font>
		positionData.Position = math.<span class="hljs-keyword">select</span>(<font></font>
			target.TargetPosition,<font></font>
			math.lerp(<font></font>
				positionData.Position, <font></font>
				target.TargetPosition, <font></font>
				math.mul(DeltaTime, MovementLerpSpeed)),<font></font>
			distance &lt;= <span class="hljs-number">1</span><font></font>
		);<font></font>
<font></font>
		chunkPositionData[i] = positionData;<font></font>
		chunkHeadingData[i]  = headingData;<font></font>
	}<font></font>
}<font></font>
</code></pre><br>
 <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「分岐の代わりに選択を使用していることに気づくかもしれませんが、これにより、不適切な分岐予測と呼ばれる影響を取り除くことができます。</font><font style="vertical-align: inherit;">select関数は両方の式を評価し、条件に一致する式を選択します。式の計算がそれほど難しくない場合は、selectを使用することをお勧めします。CPUが誤った分岐予測から回復するのを待つよりも安くなることが多いためです。」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アンダース氏は指摘する。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バーストで生産性を向上</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 DOTSを敵の位置とコースの補間に変換する最後の手順は、バーストコンパイラを有効にすることです。 「データは隣接する配列にあり、Unityの新しい数学ライブラリを使用している</font><font style="vertical-align: inherit;">ため、タスクに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BurstCompile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加する</font><i><font style="vertical-align: inherit;">だけで済みました</font></i><font style="vertical-align: inherit;">。」</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">BurstCompile</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> UpdatePositionAndHeadingJob : IJobChunk<font></font>
{<font></font>
    <span class="hljs-keyword">public</span> ArchetypeChunkComponentType&lt;PositionData2D&gt; PositionDataType;
    <span class="hljs-keyword">public</span> ArchetypeChunkComponentType&lt;HeadingData2D&gt; HeadingDataType;<font></font>
<font></font>
    [<span class="hljs-meta">ReadOnly</span>]
    <span class="hljs-keyword">public</span> ArchetypeChunkComponentType&lt;TargetPositionData&gt; TargetPositionDataType;<font></font>
<font></font>
    [<span class="hljs-meta">ReadOnly</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> DeltaTime;<font></font>
    [<span class="hljs-meta">ReadOnly</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> RotationLerpSpeed;<font></font>
    [<span class="hljs-meta">ReadOnly</span>] <span class="hljs-keyword">public</span> <span class="hljs-keyword">float</span> MovementLerpSpeed;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Burstコンパイラーは、単一命令複数データ（SIMD）を提供します。複数の入力データのセットを処理し、1つの命令だけで複数の出力データのセットを作成できる機械語命令。これにより、128ビットキャッシュバス上のより多くの場所を正しいデータで満たすことができます。バーストコンパイラとキャッシュに適したデータ構成およびジョブシステムを組み合わせることで、チームは生産性を大幅に向上させることができました。以下は、各変換ステップ後のパフォーマンスを測定することによってコンパイルされた表です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bo/gu/8i/bogu8ir1i0apb5cwuhrjfjyk-bk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ファーノースがクライアント側の位置の補間とゾンビの方向に関連する問題を完全に取り除くことを意味しました。</font><font style="vertical-align: inherit;">それらのデータは、キャッシングに便利な形式で格納され、キャッシュラインには、有用なデータのみが入力されます。</font><font style="vertical-align: inherit;">負荷はすべてのCPUコアに分散され、バーストコンパイラはSIMD命令を使用して高度に最適化されたマシンコードを生成します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファーノースエンターテインメントDOTSのヒントとコツ</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSではエンティティは単に並列コンポーネントデータストリームの検索インデックスであるため、データストリームの観点から考え始めます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSを、アーキタイプがテーブル、コンポーネントが列、エンティティがテーブル（行）のインデックスであるリレーショナルデータベースとして想像してください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データをシーケンシャル配列に編成して、プロセッサキャッシュとハードウェアプリフェッチを使用します。</font></font></li>
<li>          ,     ,    .</li>
<li>   .         .       Unity.   ,      .</li>
<li>   ,       .</li>
<li>        C#.</li>
<li>  .    Burst   SIMD?  Burst Inspector   .</li>
<li>     .       ,       UDP.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anders Ericssonが共有したい主なアドバイスは、プロジェクトがすでに開発中の人に対するより一般的なアドバイスです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「パフォーマンスの問題があるゲームの特定の領域を特定し、DOTSを具体的に適用できるかどうかを確認してくださいこの孤立したエリア。</font><font style="vertical-align: inherit;">コードベース全体を変更する必要はありません！」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今後の計画</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「私たちは、ゲームの他の領域でDOTSを使用したいと思っています。DOTSアニメーション、Unity Physics、およびLive Linkに関するUniteの発表に満足しています。より多くのゲームオブジェクトをECSオブジェクトに変換する方法を学びたいと思います。Unityはこれを実装する上で大きな進歩を遂げたようです」とAnders氏は結論付けています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Far Northチームに質問がある場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discordに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加することをお勧めします</font><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Unite Copenhagen DOTS</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
プレイリスト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">チェックして、</font><font style="vertical-align: inherit;">他の現代のゲームスタジオがDOTSを使用して優れた高性能ゲームを作成する方法、およびDOTS PhysicsなどのDOTSベースのコンポーネント、新しい変換ワークフロー、バーストコンパイラがどのように連携するかを</font><font style="vertical-align: inherit;">確認してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
これで翻訳は終わりました、そして私たちは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,    <i>    -  </i>.</b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484076/index.html">暗号通貨を保管する場所：さまざまな国での暗号通貨の課税</a></li>
<li><a href="../ja484084/index.html">1C-Bitrixとその導入の試み</a></li>
<li><a href="../ja484088/index.html">パスワードヒットパレード（リークからの50億までのパスワードの分析）</a></li>
<li><a href="../ja484090/index.html">ロシアのポストデータセンターの新しいITインフラストラクチャ</a></li>
<li><a href="../ja484092/index.html">少し服を着た王子と貴族</a></li>
<li><a href="../ja484096/index.html">2つのヤコズン、またはカサンドラ対HBaseの戦い。Sberbankチームの経験</a></li>
<li><a href="../ja484100/index.html">Android向けGoogle Maps SDKのインターフェースの操作</a></li>
<li><a href="../ja484108/index.html">Etherblade.netカプセル化装置とネットワークコンポーネントのインポート置換（パート2）</a></li>
<li><a href="../ja484112/index.html">飛行機をハックすることは可能ですか</a></li>
<li><a href="../ja484114/index.html">ポールグラハムのエッセイの143の翻訳の抜粋（184から）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>