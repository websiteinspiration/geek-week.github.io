<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚇 👨‍👧‍👧 👩‍🔬 アプリケーションをKubernetesに移植するときのローカルファイル 🙎🏼 ⛰️ 🛌🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetesを使用してCI / CDプロセスを構築する場合、新しいインフラストラクチャとそれに転送されるアプリケーションの要件の非互換性の問題が発生することがあります。特に、アプリケーションのアセンブリ段階では、すべてのプロジェクト環境とクラスターで使用される1つのイメージを取得することが重...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>アプリケーションをKubernetesに移植するときのローカルファイル</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/471582/"><img src="https://habrastorage.org/webt/bx/1x/lp/bx1xlp1iax5bfqfwuggugmedkkq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetesを使用してCI / CDプロセスを構築する場合、新しいインフラストラクチャとそれに転送されるアプリケーションの要件の非互換性の問題が発生することがあります。特に、アプリケーションのアセンブリ段階では</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">すべての</font></i><font style="vertical-align: inherit;">プロジェクト環境とクラスター</font><font style="vertical-align: inherit;">で使用される</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イメージ</font><font style="vertical-align: inherit;">を取得することが重要</font><font style="vertical-align: inherit;">です。この原則は、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Googleの見解</font></a><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">は正しい</font><font style="vertical-align: inherit;">コンテナ管理の</font><font style="vertical-align: inherit;">基礎となっています</font><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">techdir </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">が</font></a><font style="vertical-align: inherit;">これについて</font><font style="vertical-align: inherit;">何</font><font style="vertical-align: inherit;">度も</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">話しました</font></a><font style="vertical-align: inherit;">）。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、既成のフレームワークがサイトコードで使用され、その使用がその後の操作に制限を課す状況に誰も驚かないでしょう。</font><font style="vertical-align: inherit;">そして、「通常の環境」での対処が容易である場合、Kubernetesでこの種の動作は、特に最初に遭遇したときに問題になる可能性があります。</font><font style="vertical-align: inherit;">独創的なマインドは、一見して明白で悪くないインフラストラクチャソリューションを提供することができますが、ほとんどの状況は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーキテクチャで解決</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でき、</font><b><font style="vertical-align: inherit;">解決する</font></b><font style="vertical-align: inherit;">必要</font><b><font style="vertical-align: inherit;">がある</font></b><font style="vertical-align: inherit;">ことを覚えておくことが重要</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターの操作中に不快な結果を招く可能性のある、ファイルを保存するための一般的な回避策の解決策を分析し、より適切なパスを指定します。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的ストレージ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明のために、静的ジェネレータを使用して一連の画像やスタイルなどを取得するWebアプリケーションを考えてみましょう。</font><font style="vertical-align: inherit;">たとえば、Yii PHPフレームワークには、固有のディレクトリ名を生成する組み込みのアセットマネージャーがあります。</font><font style="vertical-align: inherit;">したがって、出力は明らかにサイトスタティックの交差しないパスのセットです（これは、たとえば、多くのコンポーネントで同じリソースを使用するときに重複を排除するために、いくつかの理由で行われました）。</font><font style="vertical-align: inherit;">したがって、最初からWebリソースモジュールに最初にアクセスすると、静的変数が形成され、このデプロイメントに固有の共通ルートディレクトリを使用してレイアウトされます（多くの場合、シンボリックリンクですが、後で詳しく説明します）。</font></font><br>
<br>
<ul>
<li> <code>webroot/assets/2072c2df/css/…</code></li>
<li> <code>webroot/assets/2072c2df/images/…</code></li>
<li> <code>webroot/assets/2072c2df/js/…</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、クラスターの点で何が問題ですか？ </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も単純な例</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPがnginxに直面して静的を分散し、単純なクエリを処理するかなり一般的なケースを考えてみましょう。</font><font style="vertical-align: inherit;">最も簡単な方法は</font><font style="vertical-align: inherit;">、2つのコンテナーを使用した</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デプロイメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: site<font></font>
spec:<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      component: backend<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        component: backend<font></font>
    spec:<font></font>
      volumes:<font></font>
        - name: nginx-config<font></font>
          configMap:<font></font>
            name: nginx-configmap<font></font>
      containers:<font></font>
      - name: php<font></font>
        image: own-image-with-php-backend:v1.0<font></font>
        command: ["/usr/local/sbin/php-fpm","-F"]<font></font>
        workingDir: /var/www<font></font>
      - name: nginx<font></font>
        image: nginx:1.16.0<font></font>
        command: ["/usr/sbin/nginx", "-g", "daemon off;"]<font></font>
        volumeMounts:<font></font>
        - name: nginx-config<font></font>
          mountPath: /etc/nginx/conf.d/default.conf<font></font>
          subPath: nginx.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡略化した形式では、nginx構成は次のように要約されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: "nginx-configmap"<font></font>
data:<font></font>
  nginx.conf: |<font></font>
    server {<font></font>
        listen 80;<font></font>
        server_name _;<font></font>
        charset utf-8;<font></font>
        root  /var/www;<font></font>
<font></font>
        access_log /dev/stdout;<font></font>
        error_log /dev/stderr;<font></font>
<font></font>
        location / {<font></font>
            index index.php;<font></font>
            try_files $uri $uri/ /index.php?$args;<font></font>
        }<font></font>
<font></font>
        location ~ \.php$ {<font></font>
            fastcgi_pass 127.0.0.1:9000;<font></font>
            fastcgi_index index.php;<font></font>
            include fastcgi_params;<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PHPを使用してコンテナー内のサイトに初めてアクセスすると、アセットが表示されます。</font><font style="vertical-align: inherit;">ただし、同じポッド内の2つのコンテナの場合、nginxはこれらの静的ファイルについて何も知らないため、（構成に従って）それらに与える必要があります。</font><font style="vertical-align: inherit;">その結果、クライアントはCSSおよびJSファイルへのすべてのリクエストに対して404エラーを表示します。ここでの最も簡単な解決策は、コンテナの共通ディレクトリを整理することです。</font><font style="vertical-align: inherit;">プリミティブオプション-一般</font></font><code>emptyDir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: apps/v1<font></font>
kind: Deployment<font></font>
metadata:<font></font>
  name: site<font></font>
spec:<font></font>
  selector:<font></font>
    matchLabels:<font></font>
      component: backend<font></font>
  template:<font></font>
    metadata:<font></font>
      labels:<font></font>
        component: backend<font></font>
    spec:<font></font>
      volumes:<font></font>
        - name: assets<font></font>
          emptyDir: {}<font></font>
        - name: nginx-config<font></font>
          configMap:<font></font>
            name: nginx-configmap<font></font>
      containers:<font></font>
      - name: php<font></font>
        image: own-image-with-php-backend:v1.0<font></font>
        command: ["/usr/local/sbin/php-fpm","-F"]<font></font>
        workingDir: /var/www<font></font>
        volumeMounts:<font></font>
        - name: assets<font></font>
          mountPath: /var/www/assets<font></font>
      - name: nginx<font></font>
        image: nginx:1.16.0<font></font>
        command: ["/usr/sbin/nginx", "-g", "daemon off;"]<font></font>
        volumeMounts:<font></font>
        - name: assets<font></font>
          mountPath: /var/www/assets<font></font>
        - name: nginx-config<font></font>
          mountPath: /etc/nginx/conf.d/default.conf<font></font>
          subPath: nginx.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナで生成された静的ファイルがnginxによって正しく提供されるようになりました。</font><font style="vertical-align: inherit;">ただし、これは原始的な解決策であることを思い出させてください。これは、理想とはほど遠く、独自のニュアンスと欠点があることを意味します。これらについては、以下で説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より高度なストレージ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーがサイトにアクセスし、コンテナーで使用可能なスタイルを含むページをロードし、このページを読んでいるときにコンテナーを再デプロイした状況を想像してください。</font><font style="vertical-align: inherit;">アセットディレクトリは空になり、新しいものの生成を開始するにはPHPへのリクエストが必要です。</font><font style="vertical-align: inherit;">ただし、この後でも、古い統計へのリンクは古くなり、静的の表示でエラーが発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、多かれ少なかれロードされたプロジェクトがある可能性が高いです。つまり、アプリケーションの1つのコピーでは十分ではありません。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">規模</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展開の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つの複製に。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1つのレプリカでサイトに初めてアクセスしたときに、アセットが作成されました。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ある時点で、イングレスは（負荷を分散するために）2番目のレプリカのリクエストを送信することを決定しましたが、これらのアセットはまだありません。</font><font style="vertical-align: inherit;">あるいは、</font></font><code>RollingUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">現在</font><font style="vertical-align: inherit;">使用して</font><font style="vertical-align: inherit;">おり、現在デプロイを行っている</font><font style="vertical-align: inherit;">ため、それらはもう存在しない可能性があり</font><font style="vertical-align: inherit;">ます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、結果は再びエラーになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古い資産を失わないようにするために、あなたは変更することができます</font></font><code>emptyDir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>hostPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、クラスタノードに物理的に静的を追加することによって。</font><font style="vertical-align: inherit;">このアプローチは</font><font style="vertical-align: inherit;">、アプリケーションで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定のクラスターノード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に実際に</font><b><font style="vertical-align: inherit;">バインドする</font></b><font style="vertical-align: inherit;">必要があるという点で悪い</font><font style="vertical-align: inherit;">です。他のノードに移動した場合、ディレクトリには必要なファイルが含まれないためです。</font><font style="vertical-align: inherit;">または、ノード間のディレクトリのバックグラウンド同期が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解決策は何ですか？</font></font><br>
<br>
<ol>
<li>     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cephfs</a>       . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>  SSD-,       «»    .</li>
<li>      NFS-.            -,      .    :  mount’        LA,   .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とりわけ、永続ストレージを作成するためのすべてのオプションでは</font><font style="vertical-align: inherit;">、一定期間にわたって蓄積された古いファイルセットの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンドクリーニング</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が必要になり</font><font style="vertical-align: inherit;">ます。 PHPを使用するコンテナーの前に、</font><font style="vertical-align: inherit;">キャッシュされたnginxから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DaemonSet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">置くことができます</font><font style="vertical-align: inherit;">。これにより、限られた時間、アセットのコピーが保存されます。この動作は</font></font><code>proxy_cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、日単位のストレージの深さまたはギガバイトのディスク領域</font><font style="vertical-align: inherit;">を使用して簡単に構成できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法を上記の分散ファイルシステムと組み合わせると、想像力に大きな分野がもたらされます。これは、予算を制限し、それを実装してサポートする人の技術的な可能性に限りがあります。</font><font style="vertical-align: inherit;">経験から、システムがシンプルであるほど、安定して機能すると私たちは言います。</font><font style="vertical-align: inherit;">このようなレイヤーを追加すると、インフラストラクチャの維持がはるかに困難になると同時に、障害が発生した場合の診断と復旧に費やす時間が増加します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勧告</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
提案されたストレージオプションの実装も正当化されていないようである（複雑で高価な...）場合、反対側から状況を確認する必要があります。つまり、プロジェクトのアーキテクチャを掘り下げ</font><font style="vertical-align: inherit;">、イメージ内のある種の静的データ構造にリンクすることで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードの問題</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">根絶し</font></b><font style="vertical-align: inherit;">、コンテンツの明確な定義、またはイメージのアセンブリ段階でのアセットの「ウォームアップ」および/またはプリコンパイルの手順を提供します。したがって、完全に予測可能な動作と、実行中のアプリケーションのすべての環境とレプリカに対して同じファイルセットが得られます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yiiフレームワークを使用した特定の例に戻り、その構造を掘り下げない場合（記事の目的ではありません）、2つの一般的なアプローチを指摘するだけで十分です。</font></font><br>
<br>
<ol>
<li>      ,      .  /    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">yii2-static-assets</a>.</li>
<li>      ,  , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> (   №35). ,      (   !)      build-      ( S3),    CDN.</li>
</ol><br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションをKubernetesクラスターに転送するときに確実に発生するもう1つのケースは、ユーザーファイルをファイルシステムに格納することです。</font><font style="vertical-align: inherit;">たとえば、アップロードフォームを介してファイルを受け入れ、処理中にファイルを処理して返すPHPアプリケーションが再びあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのファイルをKubernetesの現実に配置する場所は、すべてのアプリケーションレプリカに共通である必要があります。</font><font style="vertical-align: inherit;">アプリケーションの複雑さとこれらのファイルの永続性を整理する必要性に応じて、このようなオプションは上記の共有デバイスのオプションとなる場合がありますが、ご覧のように、それらには欠点があります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勧告</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つの解決策は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、S3互換のストレージ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">使用する</font></b><font style="vertical-align: inherit;">ことです（minioのような自己ホスト型のカテゴリの場合でも）。</font><font style="vertical-align: inherit;">S3と仕事への移行は、変更が必要になります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードレベルでの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そして我々はすでに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書いた</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容は、フロントエンドに返されますか</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムセッション</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それとは別に、ユーザーセッションのストレージの編成に注目する価値があります。</font><font style="vertical-align: inherit;">多くの場合、これらはディスク上のファイルでもあり、Kubernetesのコンテキストでは、ユーザーのリクエストが別のコンテナーに分類されると、ユーザーからの承認リクエストが絶え間なく発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題の一部は、</font><font style="vertical-align: inherit;">アプリケーションを使用してユーザーを特定のポッドにバインドする</font><i><font style="vertical-align: inherit;">ために</font></i></font><code>stickySessions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ingress </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（この機能はすべての一般的なIngressコントローラーでサポートされ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ています</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -詳細</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">はレビュー</font></a><font style="vertical-align: inherit;">を参照</font><font style="vertical-align: inherit;">）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">有効にすることで解決され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="plaintext hljs">apiVersion: networking.k8s.io/v1beta1<font></font>
kind: Ingress<font></font>
metadata:<font></font>
  name: nginx-test<font></font>
  annotations:<font></font>
    nginx.ingress.kubernetes.io/affinity: "cookie"<font></font>
    nginx.ingress.kubernetes.io/session-cookie-name: "route"<font></font>
    nginx.ingress.kubernetes.io/session-cookie-expires: "172800"<font></font>
    nginx.ingress.kubernetes.io/session-cookie-max-age: "172800"<font></font>
<font></font>
spec:<font></font>
  rules:<font></font>
  - host: stickyingress.example.com<font></font>
    http:<font></font>
      paths:<font></font>
      - backend:<font></font>
          serviceName: http-svc<font></font>
          servicePort: 80<font></font>
        path: /</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これは繰り返しの展開からあなたを救うことはありません。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勧告</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より正しい方法は、アプリケーションを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memcached、Redis、および同様のソリューションのセッション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">ストレージ</font></b><font style="vertical-align: inherit;">に転送する</font><font style="vertical-align: inherit;">ことです。一般的に、ファイルオプションは完全に破棄します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文で検討されているインフラストラクチャソリューションは、一時的な「クランチ」の形式でのみ適用する価値があります（回避策として英語でより美しく聞こえます）。</font><font style="vertical-align: inherit;">これらは、Kubernetesへのアプリケーションの移行の初期段階に関連している可能性がありますが、「ルート化」してはなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に推奨される方法は、すでによく知られている</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12ファクターアプリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に従って、アプリケーションのアーキテクチャの改良を優先してそれらを取り除くこと</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">ただし、これは-アプリケーションをステートレスな形式にすることは必然的にコードの変更が必要であることを意味し、ここで、ビジネスの機能/要件と、選択されたパスを実装および維持する見通しの間のバランスを見つけることが重要です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginxを使用してAWS S3からファイルをプロキシする</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">7        Google</a>»;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">7   ,   </a>» <i>( Red Hat)</i>;</li>
<li> «<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">7     12 Factor App</a>».</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471570/index.html">改装されたスマートフォン：利益か詐欺か？</a></li>
<li><a href="../ja471572/index.html">サブスクライブの代わりにmergeMapおよびforkJoinを使用する複数のAPIリクエスト</a></li>
<li><a href="../ja471574/index.html">Oracle Database 19c：以前のバージョンとの根本的な違い</a></li>
<li><a href="../ja471576/index.html">QAが開発者との効果的なやり取りを構築する方法。1つの可能な方法</a></li>
<li><a href="../ja471580/index.html">Stripe、Intercom、JetBrains、Miro、ManyChat、Wrike、Targetprocessなどのプラットフォーム開発者向けの会議。</a></li>
<li><a href="../ja471588/index.html">産業用モノのインターネット：成功したケースについて話す</a></li>
<li><a href="../ja471590/index.html">チームリーダーとしての最初の6か月間：すべてが悪いように思われる場合に気を狂わせない方法</a></li>
<li><a href="../ja471594/index.html">BeelineカザフスタンとSlermが11月6〜7日にアルマトイでBeeline DevOps Dayを開催</a></li>
<li><a href="../ja471596/index.html">MacOS 10.15は32ビットアプリケーションをサポートしなくなりました。あなたは何ができますか？</a></li>
<li><a href="../ja471600/index.html">現代音楽の根底にある数</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>