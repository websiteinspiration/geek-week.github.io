<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà¥ üí™üèª üç≥ HighLoad ++, Mikhail Raichenko (ManyChat): casi sin magia, o lo f√°cil que es distribuir la transmisi√≥n de video terabit üìÖ üé° üë®üèæ‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La pr√≥xima conferencia HighLoad ++ se llevar√° a cabo los d√≠as 6 y 7 de abril de 2020 en San Petersburgo. Detalles y entradas aqu√≠ . HighLoad ++ Mosc√∫ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Raichenko (ManyChat): casi sin magia, o lo f√°cil que es distribuir la transmisi√≥n de video terabit</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/488148/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pr√≥xima conferencia HighLoad ++ se llevar√° a cabo los d√≠as 6 y 7 de abril de 2020 en San Petersburgo. </font><font style="vertical-align: inherit;">Detalles y entradas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">HighLoad ++ Mosc√∫ 2018. Sala "Delhi + Calcuta". </font><font style="vertical-align: inherit;">8 de noviembre, 2 p.m. </font><font style="vertical-align: inherit;">Res√∫menes y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">presentaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/ji/ba/ymjiba---vkcs5ibbqbk9kcz8ny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajo en el equipo de VKontakte y estoy desarrollando un sistema de transmisi√≥n de video. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el informe, compartir√© las caracter√≠sticas del desarrollo del backend, c√≥mo ha evolucionado nuestro sistema y las soluciones t√©cnicas a las que hemos llegado:‚Ä®</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥mo hicimos el backend de transmisi√≥n de video y el proceso de evoluci√≥n tal como es;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el impacto de los requisitos comerciales y operativos en la arquitectura;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Esperar" e "intentar de nuevo" fallar√°;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥mo las tareas m√°s simples se complican por la cantidad de usuarios;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥mo reducir la latencia sin UDP;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realizamos pruebas de estr√©s 2 veces al d√≠a, o con lo que Clover nos ayud√≥.</font></font></li>
</ul><a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Raichenko (en adelante - MR):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Una peque√±a excursi√≥n. </font><font style="vertical-align: inherit;">Te contar√© sobre las personas que nos transmiten, sobre el live (live), sobre qu√© plataformas recibimos la transmisi√≥n de video y cu√°les distribuimos. </font><font style="vertical-align: inherit;">Al final, hablar√© sobre la arquitectura actual de la vida, sobre sus limitaciones y capacidades, as√≠ como sobre c√≥mo la arquitectura actual sobrevivi√≥ a un efecto como "Clover".</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/bm/lt/_hbmlt0c2ek74zfr89jdff3wtsw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre transmisiones en vivo. </font><font style="vertical-align: inherit;">Resumen del informe</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, hablar√© un poco sobre las transmisiones en vivo y las transmisiones en s√≠ mismas, envi√°ndonos contenido de video que mostramos a otros espectadores.</font></font></li>
<li>         .    ?     ,     , , ,   -  - , - , .   ,        :   ,  ‚Äì .</li>
<li>    . ,      .     .     ,      ,     .</li>
<li>  ,     ,   .   ,         .  ,   ,   ,  , ,   2014-2015 .     ,      .</li>
<li>       .  ,                    .</li>
<li>,    .          ,    . ,    .</li>
<li>    ,    .      .</li>
<li>  ,    ,      ¬´¬ª,    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/lz/mm/jw/lzmmjwth6qvdlryupzhegpftal0.jpeg"><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los servicios de transmisi√≥n se ven m√°s o menos as√≠: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dt/2r/va/dt2rvaddozkmjrcp-1ojlaixmr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tenemos un transmisor, nos env√≠a una transmisi√≥n RTMP y mostramos a la audiencia: nada sorprendente, nada sobrenatural. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/fx/kq/eefxkq8vknyi57vz-y-_ekw5pd0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øDe d√≥nde viene la transmisi√≥n de video? Una fuente importante de tr√°fico para nosotros es nuestra aplicaci√≥n m√≥vil VKlife. ¬øQu√© hay de bueno en √©l? En √©l, podemos controlar completamente c√≥mo codificamos el video. Podemos hacer muchas optimizaciones en el lado del cliente, para que luego, con retrasos m√≠nimos, se lo muestremos a nuestros espectadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De las desventajas: las aplicaciones m√≥viles funcionan sobre redes. Puede ser 3G ... En cualquier caso, casi siempre se trata de redes m√≥viles, lo que introduce algunos retrasos: debe almacenar adicionalmente los datos en el lado de la aplicaci√≥n, para que la transmisi√≥n se ejecute de la manera m√°s fluida posible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda fuente son los streamers con OBS, Wirecast o aquellos que transmiten desde otras aplicaciones de escritorio. </font><font style="vertical-align: inherit;">Esta es una audiencia bastante grande. </font><font style="vertical-align: inherit;">A veces se trata de seminarios, a veces, transmisiones de juegos (especialmente muchas de estas aplicaciones). </font><font style="vertical-align: inherit;">De lo positivo: hay pocas aplicaciones de este tipo, podemos dar a nuestros streamers buenas recomendaciones de ajuste. </font><font style="vertical-align: inherit;">Pero al mismo tiempo, hay muchas configuraciones y no enviamos la transmisi√≥n que queremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tercera categor√≠a es la transmisi√≥n RTMP de los servidores de medios. </font><font style="vertical-align: inherit;">Estos pueden ser servidores de medios muy peque√±os, es decir, un formato de inicio: una persona transmite una vista de la calle o algo m√°s. </font><font style="vertical-align: inherit;">O transmisiones bastante serias de nuestros socios: puede haber cualquier cosa, no hay muchas transmisiones de este tipo, pero b√°sicamente son muy importantes para nosotros.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQui√©n est√° mirando?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuevamente, esta es una aplicaci√≥n m√≥vil: todo est√° claro aqu√≠. El mayor problema es la latencia de la red. De los profesionales: podemos personalizar el reproductor: es conveniente para nosotros, bueno, pero no en todas partes, resulta 100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reproductor web en vk.com. Aqu√≠, tambi√©n, todo es simple: es un reproductor web normal que puedes abrir para ver. Una audiencia suficientemente grande en vk.com, muchos espectadores en las transmisiones. Algunas transmisiones se cuelgan en nuestra secci√≥n de "Video": puede haber decenas de miles (a veces sin ning√∫n PR), especialmente si este es un contenido interesante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consecuencia, los canales son lo suficientemente grandes para los espectadores que est√°n sentados en un reproductor web. Por lo tanto, hay mucho tr√°fico, incluso para una transmisi√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El tercero es el reproductor web VKontakte en un sitio de terceros. </font><font style="vertical-align: inherit;">Puede comenzar a transmitir todo lo que desee y colgar un reproductor web VKontakte en su sitio web. </font><font style="vertical-align: inherit;">Puede convertirse en nuestro socio si tiene contenido interesante: puede colgarlo por su cuenta, puede colgar con nosotros, como lo desee. </font><font style="vertical-align: inherit;">Puede organizar sus transmisiones de esta manera, y todo funcionar√°.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaci√≥n con videollamadas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En las videollamadas, se disculpar√° la distorsi√≥n de la imagen. Las videollamadas son m√°s simples: podemos degradar significativamente la imagen, pero al mismo tiempo debemos mantener una muy buena latencia. Con un largo retraso, el servicio ser√° absolutamente imposible de usar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En las transmisiones en este sentido, es un poco al rev√©s: debemos mantener una alta calidad de imagen, pero al mismo tiempo podemos aumentar la latencia debido a muchos factores. Por ejemplo, el jugador amortigua el flujo de una forma u otra (puede ser un segundo, dos para sobrevivir a la degradaci√≥n de la red, por ejemplo), por lo tanto, no necesita un segundo retraso de milisegundos en la mayor√≠a de los casos. Puede luchar por esto, pero la comida no es un requisito previo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/7o/o6/j07oo6ceqiizh_lzdgjsgvgfwtq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con el video ordinario, la situaci√≥n es exactamente lo contrario. </font><font style="vertical-align: inherit;">Necesitamos muy buena calidad. </font><font style="vertical-align: inherit;">Al mismo tiempo, es deseable minimizar el tama√±o del video, la relaci√≥n de velocidad de bits y calidad, de modo que con el flujo m√≠nimo, proporcione la mejor soluci√≥n. </font><font style="vertical-align: inherit;">De los profesionales: no estamos limitados en el tiempo: al momento de descargar el video, tenemos suficiente tiempo para optimizar el video, ver c√≥mo comprimirlo de la mejor manera, hacer algo, arrastrarlo a cach√©s, si es necesario; en general, todo es suficiente OKAY. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r-/cc/jfr-cco9dozhxgqqnuw57opkqjk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En vivo, la situaci√≥n es, nuevamente, lo contrario: tenemos muy poco tiempo para transcodificar. </font><font style="vertical-align: inherit;">Al mismo tiempo, hay pocas oportunidades, pero no hay expectativas para la transmisi√≥n. </font><font style="vertical-align: inherit;">El p√∫blico nos perdonar√° si tenemos apoyo o si la calidad no es muy buena.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primera versi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bastante esperado: en </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/gt/bw/3fgtbwzvl3uf680sfzsf8kjette.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
realidad, es un poco diferente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/9r/zu/vu9rzujgkidpvrb66qzgbvapljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Streamer - servidor de medios - nivel de cach√© - espectadores". </font><font style="vertical-align: inherit;">En principio, esta versi√≥n le permite escalar con bastante fuerza. </font><font style="vertical-align: inherit;">Yo dir√≠a que ya deber√≠a soportar decenas de miles de espectadores. </font><font style="vertical-align: inherit;">Tiene otros inconvenientes ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, si observa este circuito (diapositiva anterior), puede ver que no tolera fallas. </font><font style="vertical-align: inherit;">Debemos adivinar con el servidor de medios para equilibrar bien a la audiencia. </font><font style="vertical-align: inherit;">No podemos colgar muchas cach√©s en cada servidor, es simplemente costoso. </font><font style="vertical-align: inherit;">Por lo tanto, miramos, nos dimos cuenta de que era simple y claro, hab√≠a algunas posibilidades de escalado, pero obviamente faltaba algo ... Y comenzamos a formular requisitos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos de infraestructura</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© es importante?</font></font><br>
<br>
<ul>
<li> .     , ,    .            (       ).       (,  ).</li>
<li>.     : -,    (,    )      ; -,     ‚Äì      ,    ,       .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entrega a las regiones. </font><font style="vertical-align: inherit;">Tambi√©n un punto importante! </font><font style="vertical-align: inherit;">Es est√∫pido arrastrar todo el contenido de video desde Petersburgo o Mosc√∫ a alg√∫n tipo de Novosibirsk, Ekaterimburgo, o incluso desde San Petersburgo a Mosc√∫. </font><font style="vertical-align: inherit;">Esto no es muy bueno, ya que la demora de la red ser√° larga: habr√° retrasos, todo se retrasar√°, y esto no es bueno. </font><font style="vertical-align: inherit;">Por lo tanto, nuestra infraestructura debe tener en cuenta que entregamos contenido a las regiones.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conveniencia de operaci√≥n y monitoreo. </font><font style="vertical-align: inherit;">Una propiedad importante. </font><font style="vertical-align: inherit;">Dado que el sistema es grande, hay muchos espectadores, es importante enviar alertas a los administradores a tiempo en caso de cualquier problema, incluido el monitoreo del producto y las m√©tricas t√©cnicas.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/km/n1/e_/kmn1e_0ii74m9xilh_5rsic9l5a.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo se ve la infraestructura de transmisi√≥n ahora?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, llegamos a una infraestructura bastante simple pero efectiva ...</font></font><br>
<br>
<ul>
<li> ‚Äì ,       ( ,  ).   RTMP-,    .        ,  .</li>
<li> ,      ,     ,  ,   .       .  ,   ,   ,   ‚Äì : , -,  (. .       ); -,     .</li>
<li>      .     ‚Äì    ,   .        ,    ,    .      ,         (    ,  ).</li>
<li>         ,         (edge-).     ,  .    !</li>
<li>   ‚Äì  edge-,      ,   .   :      ,   ‚Äì    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/2e/cu/qp/2ecuqpdeldwtxd6qjyi-x4q0_ke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interesantemente? </font><font style="vertical-align: inherit;">Equilibrio! </font><font style="vertical-align: inherit;">En este esquema, elegimos el equilibrio, intentamos enviar a los espectadores que miran la misma transmisi√≥n a cada servidor perimetral. </font><font style="vertical-align: inherit;">La localidad de cach√© es muy importante aqu√≠, porque puede haber muchos servidores perimetrales; </font><font style="vertical-align: inherit;">y si no observamos tanto la ubicaci√≥n temporal como la local del cach√© desde el punto de vista de la secuencia, sobrecargaremos la capa interna. </font><font style="vertical-align: inherit;">Tampoco nos gustar√≠a eso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, equilibramos de la siguiente manera: seleccionamos un determinado servidor perimetral para la regi√≥n a la que enviamos espectadores y enviamos hasta que comencemos a comprender que se ha producido alg√∫n llenado y que se debe enviar a otro servidor. </font><font style="vertical-align: inherit;">El circuito es simple y funciona de manera muy confiable. </font><font style="vertical-align: inherit;">Naturalmente, para diferentes transmisiones, usted elige una secuencia diferente de servidores perimetrales (la secuencia en la que enviamos espectadores). </font><font style="vertical-align: inherit;">En consecuencia, el equilibrio funciona de manera bastante simple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n le damos al cliente un enlace a un servidor perimetral disponible. </font><font style="vertical-align: inherit;">Esto se hace para que, en caso de falla del servidor perimetral, podamos redirigir el visor a otro. </font><font style="vertical-align: inherit;">Es decir, cuando el espectador mira la transmisi√≥n, recibe un enlace al servidor deseado una vez cada pocos segundos. </font><font style="vertical-align: inherit;">Si comprende que el enlace debe ser diferente, cambia (el jugador cambia) y contin√∫a viendo la transmisi√≥n desde otro servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra funci√≥n importante de los servidores perimetrales es la protecci√≥n de contenido. </font><font style="vertical-align: inherit;">Toda la protecci√≥n del contenido tiene lugar esencialmente all√≠. </font><font style="vertical-align: inherit;">Tenemos nuestro propio m√≥dulo nginx para esto. </font><font style="vertical-align: inherit;">Es algo similar a Security Link.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escalado y balanceo</font></font></h3><br>
<ul>
<li>   . ,        :     ,       .          edge-,        .     .     .    ‚Ä¶   ,     ‚Äì    ,  --    ‚Äì ,  ‚Äì , , ,   ‚Äì  !   ‚Äì        .</li>
<li>      .  ,  ,         ,    ,       :     .       (   )    ,    ‚Äì   ,   . ,    ,     ,      edge-.</li>
<li>   ,   ,       ,     .</li>
</ul><br>
<img src="https://habrastorage.org/webt/19/nj/i8/19nji8vwkh_kjrrsm9d698hf5ji.jpeg"><br>
<br>
<h3>   ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uno de los principales protocolos que ten√≠amos era RTMP (no solo para la entrada, sino tambi√©n para la distribuci√≥n de contenido). La principal ventaja es la baja latencia. Puede ser medio segundo, segundo, dos segundos. De hecho, los beneficios terminan all√≠ ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/fv/al/u7fvaloyunlxmyavp5rjemer4sw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este protocolo de transmisi√≥n es dif√≠cil de monitorear; en cierto sentido, est√° cerrado, a pesar de que hay una especificaci√≥n. El reproductor Flash ya no funciona (de hecho, es "ya todo"). Necesita soporte a nivel CDN: necesita m√≥dulos especiales nginx o su propio software para transferir la transmisi√≥n normalmente. Tambi√©n hay algunas dificultades con los clientes m√≥viles. Fuera de la caja en clientes m√≥viles, es muy poco compatible: se necesitan mejoras especiales, y todo esto es muy dif√≠cil.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo protocolo que utilizamos es HLS. </font><font style="vertical-align: inherit;">Parece bastante simple: es un archivo de texto, el llamado archivo de √≠ndice. </font><font style="vertical-align: inherit;">Contiene enlaces a archivos de √≠ndice con diferentes permisos, y los archivos contienen enlaces a segmentos de medios. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/hl/vf/w-hlvfylbcsu1n6ksqlv7uy5e5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo es √©l bueno? </font><font style="vertical-align: inherit;">Es muy simple, a pesar de ser un poco viejo. </font><font style="vertical-align: inherit;">Le permite usar CDN, es decir, solo necesita nginx para distribuir el protocolo HLS. </font><font style="vertical-align: inherit;">Es comprensible en t√©rminos de monitoreo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√°n sus ventajas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facilidad de operaci√≥n: nginx como servidor proxy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es f√°cil de monitorear y tomar m√©tricas (es suficiente para que pueda monitorear casi lo mismo que lo que monitorea en su sitio web);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora este protocolo es el principal para la entrega de contenido.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Significativo menos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alta latencia.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/fa/ko/2_/fako2_ysvwvhaguijmddcna20eu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La latencia HLS est√° realmente anidada en el protocolo mismo; </font><font style="vertical-align: inherit;">Dado que se requiere un tiempo de almacenamiento en b√∫fer prolongado, el jugador se ve obligado a esperar al menos cuando se carga un fragmento, pero en el buen sentido, debe esperar hasta que se carguen dos fragmentos (dos segmentos de medios), de lo contrario, en caso de un retraso, el cliente tendr√° la carga del reproductor, y esto no afecta muy bien experiencia de usuario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo punto que produce un retraso en HLS es el almacenamiento en cach√©. </font><font style="vertical-align: inherit;">La lista de reproducci√≥n se almacena en cach√© en la capa interna y en los servidores perimetrales. </font><font style="vertical-align: inherit;">Incluso si almacenamos en cach√©, en t√©rminos relativos, durante un segundo o medio segundo, esto es aproximadamente m√°s 2-3 segundos de retraso. </font><font style="vertical-align: inherit;">En total, resulta de 12 a 18 segundos; esto no es muy agradable, obviamente es mejor.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mejorando HLS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con estos pensamientos, comenzamos a mejorar HLS. Lo mejoramos de una manera bastante simple: demos el √∫ltimo segmento de medios de la lista de reproducci√≥n, a√∫n no grabado, un poco antes. Es decir, tan pronto como comenzamos a escribir el √∫ltimo segmento de medios, lo anunciamos inmediatamente en la lista de reproducci√≥n. ¬øQu√© est√° pasando en este momento? .. Se </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
reduce el tiempo de amortiguaci√≥n en los jugadores. El jugador cree que ya ha descargado todo, y con calma comienza a descargar los segmentos deseados. De esta manera, "enga√±amos" al jugador de esta manera, pero si controlamos bien el "acero" (cargas en el jugador), no nos asusta, podemos dejar de dar el segmento por adelantado y todo volver√° a la normalidad.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo punto: ganamos un total de aproximadamente 5-8 segundos. ¬øDe d√≥nde vienen? Este tiempo de segmento es de 2 a 4 segundos por segmento, m√°s el tiempo para almacenar en cach√© la lista de reproducci√≥n (esto es otros 2-3 segundos). Nuestro retraso est√° disminuyendo, adem√°s, significativamente. El retraso se reduce de 12-15 segundos a 5-7. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© m√°s hay de bueno en este enfoque? En realidad es gratis! Solo necesitamos verificar si los jugadores son compatibles con este enfoque. Los que son incompatibles, los enviamos a las URL antiguas y enviamos reproductores compatibles a las nuevas URL. No necesitamos actualizar clientes antiguos que admitan esto, lo cual tambi√©n es importante. En realidad, no necesitamos modificar, liberar jugadores en clientes m√≥viles. No necesitamos desarrollar un reproductor web. Se ve lo suficientemente bueno!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/gm/tt/0fgmttjysv2w8rg8bmzdgzcdtz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De los inconvenientes: la necesidad de controlar la transmisi√≥n de video entrante. </font><font style="vertical-align: inherit;">En el caso de un cliente m√≥vil, podemos hacer esto con bastante facilidad (cuando la transmisi√≥n proviene de un cliente m√≥vil), o transcodificar sin falta, ya que el reproductor debe saber cu√°nto tiempo lleva un segmento de medios. </font><font style="vertical-align: inherit;">Y dado que lo anunciamos antes de que se grabe, necesitamos saber cu√°nto tiempo tomar√° cuando lo grabemos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©tricas de calidad</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, hemos mejorado HLS. </font><font style="vertical-align: inherit;">Ahora quiero decir c√≥mo monitoreamos y qu√© m√©tricas de calidad disparamos: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3h/_y/iz/3h_yizx3clxbb18dzi-urr-oylq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
una de las principales m√©tricas de calidad es la hora de inicio. </font><font style="vertical-align: inherit;">Idealmente, esto es cuando se desplaza por el cliente m√≥vil antes de la transmisi√≥n, presiona el bot√≥n y comienza de inmediato. </font><font style="vertical-align: inherit;">Ser√≠a ideal si comienza antes de presionar el bot√≥n, pero, desafortunadamente, solo cuando presiona.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo punto es el retraso de la se√±al. Creemos que unos segundos son muy buenos, 10 segundos son tolerables, 20-30 segundos son muy malos. ¬øPor qu√© es importante? Por ejemplo, para conciertos y algunos eventos p√∫blicos esta es una m√©trica absolutamente sin importancia, no hay comentarios; solo mostramos la transmisi√≥n: es mejor no retrasarse que un ligero retraso. Y para una transmisi√≥n en la que se realiza alg√∫n tipo de conferencia o una persona le dice algo y le hacen preguntas, esto comienza a ser importante, porque hacen muchas preguntas en los comentarios y quiero que la audiencia reciba comentarios lo antes posible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra m√©trica importante es el almacenamiento en b√∫fer y los retrasos. </font><font style="vertical-align: inherit;">De hecho, esta m√©trica es importante no solo desde el punto de vista del cliente y la calidad, sino desde el punto de vista de cu√°nto podemos "estirar" la entrega de HLS, cu√°nto podemos extraer datos de nuestros servidores. </font><font style="vertical-align: inherit;">Por lo tanto, controlamos tanto el tiempo de amortiguaci√≥n promedio en los jugadores como el "acero". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La elecci√≥n de la calidad en los jugadores es comprensible: los cambios inesperados siempre son molestos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consecuencia, esta tambi√©n es una m√©trica importante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supervisi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos muchas m√©tricas de monitoreo, pero aqu√≠ eleg√≠ esas m√©tricas que siempre funcionan si algo sale mal:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/wy/me/irwymelifaedclj13razr83a85i.jpeg"><br>
<br>
<ul>
<li>-,    .   -   ,    .  ,  ‚Äì ,              ( ,  ‚Äì  ).</li>
<li> /     .  , ,  ,      ,        ,    .     .</li>
<li>  edge-.  ,       ,     edge-       .</li>
</ul><br>
<br>
<h3>  ¬´¬ª,       ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora le dir√© c√≥mo manejamos una aplicaci√≥n como "Reproductor" cuando usamos nuestra infraestructura para transmitir una transmisi√≥n de video con preguntas y respuestas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clover es un cuestionario en l√≠nea. El anfitri√≥n dice algo, pregunta: las preguntas se caen, t√∫ respondes. 12 preguntas, 10 minutos del juego, al final, alg√∫n tipo de premio. ¬øQu√© es tan complicado? ¬°Esto es crecimiento! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la derecha est√° este gr√°fico: el </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/i8/_e/hwi8_er_sdcw_gxczrgk3z41en0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pico [en el gr√°fico] es la carga en los servidores en t√©rminos de la API en el momento del inicio de "Clover". El resto del tiempo es el flujo habitual de transmisiones. Esto no puede equipararse al n√∫mero de espectadores. Quiz√°s esta sea la cantidad de solicitudes y la carga.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es dif√≠cil: en 5 minutos nos lleg√≥ un mill√≥n de espectadores en la cima. </font><font style="vertical-align: inherit;">Comienzan a ver la transmisi√≥n, se registran, realizan alg√∫n tipo de acci√≥n, solicitan un video ... Parece un juego muy simple, pero esto sucede en un per√≠odo de tiempo muy corto (todas las acciones, incluido el juego final), esto da una carga bastante alta.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© preguntas y desaf√≠os enfrentamos?</font></font></h3><br>
<img src="https://habrastorage.org/webt/pd/ci/xh/pdcixhln_tmsracssi9qfy5ra5y.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crecimiento r√°pido. </font><font style="vertical-align: inherit;">A veces era + 50% por semana. </font><font style="vertical-align: inherit;">Si, por ejemplo, tienes 200 mil personas el mi√©rcoles, entonces el s√°bado o el domingo ya podr√≠an haber sido 300. ¬°Eso es mucho! </font><font style="vertical-align: inherit;">Comienzan a surgir problemas que antes no eran visibles.</font></font></li>
<li>    2   .       .      ,  .       ,  , ,          ,         ,    .<br>
 12         . ,    ,     ,    , ,    -      ,     ,  ‚Ä¶</li>
<li>      ,       .     , ,  200-300 ,         400-500.</li>
<li>- ,    ,   ,           3-5 .   ?    ¬´¬ª,    ,    ,         ,     .<br>
<br>
       (   3   ,   ),          ,       3-5 .    ?  ‚Äì  ,  ‚Äì     exponential backoff,        .<br>
<br>
  exponential on backoff:  ‚Äì ,       2 ,   4,  8.             backend-.</li>
</ul><br>
<h3>    ¬´¬ª?</h3><br>
<img src="https://habrastorage.org/webt/-h/c_/gn/-hc_gnjjd-m7ujstbxa9edwnoms.jpeg"><br>
<ul>
<li>-,         .      ,    ‚Äì   .</li>
<li>   ¬´ ¬ª.  ,     ,    ,      ,     ¬´¬ª.      ,   , -,    ,  -,     .</li>
<li> ,         ‚Äì   ,     ¬´¬ª    .      ¬´¬ª.     ,  ,   ,    ‚Ä¶     ‚Äì . 10% ¬´¬ª ‚Äì , 10% ¬´¬ª  100  ‚Äì  .</li>
<li> ¬´¬ª   ,     ,    ¬´¬ª      .       ‚Äì     -  .    100    ‚Äì  ,  1    15  ‚Äì   .</li>
<li>   .  ¬´¬ª   , , ,  .   ,      ,     .</li>
<li>   .                   ,    .         ,   latency,    .</li>
<li>   .    ‚Äì     ,       .</li>
<li>  ¬´¬ª       1           . ,  ,   .      .    ,     ,     .      .</li>
</ul><br>
<h3>  ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La arquitectura nos conviene por completo, y puedo recomendarla con seguridad. HLS permanecer√° con nosotros el protocolo principal para al menos el sitio web y al menos el protocolo de respaldo para todo lo dem√°s. Quiz√°s cambiemos a MPEG-DASH. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RTMP abandonado. A pesar de que da un retraso menor, decidimos que sintonizar√≠amos el HLS. Quiz√°s considere otros veh√≠culos de reparto, incluido DASH como alternativa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qz/ut/oq/qzutoqnu3adqhxx0rivblxx9izq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mejoraremos el saldo entrante. Tambi√©n queremos realizar una conmutaci√≥n por error perfecta para el equilibrio entrante, de modo que en caso de problemas en uno de los servidores de medios para el cliente, el cambio sea completamente invisible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s desarrollaremos sistemas de entrega desde servidores perimetrales hasta el cliente. Lo m√°s probable es que sea alg√∫n tipo de UDP. Cu√°l - ahora estamos pensando y estamos en la etapa de investigaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, eso es todo. </font><font style="vertical-align: inherit;">¬°Gracias a todos!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preguntas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pregunta de la audiencia (en adelante - A): - ¬°Muchas gracias por el informe! </font><font style="vertical-align: inherit;">Solo habl√≥ el orador de Odnoklassniki, y √©l me dijo que ten√≠an que reescribir el streamer, el codificador, el codificador ... ¬øUsas tales soluciones o usas las que est√°n en el mercado (como Harmonic, etc.)? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/mt/qb/1_mtqbmuiapdtajkn5at3emzwtm.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ahora tenemos soluciones de terceros que giran. </font><font style="vertical-align: inherit;">De las soluciones de c√≥digo abierto que utilizamos, ten√≠amos nginx, el m√≥dulo RTMP (durante mucho tiempo). </font><font style="vertical-align: inherit;">Por un lado, nos complaci√≥ porque trabaj√≥, bastante simple. </font><font style="vertical-align: inherit;">Luchamos durante mucho tiempo para que trabajara de manera estable. </font><font style="vertical-align: inherit;">Ahora se est√° moviendo de Nginx-RTMP a su propia soluci√≥n. </font><font style="vertical-align: inherit;">Estamos pensando con un transcodificador ahora. </font><font style="vertical-align: inherit;">El receptor, es decir, la parte receptora, tambi√©n se ha reescrito desde Nginx-RTMP para su soluci√≥n. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Quer√≠a hacer una pregunta sobre c√≥mo cortar RTMP en HLS, pero como lo entiendo, ya respondiste ... Dime, ¬øtus soluciones son de c√≥digo abierto? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Estamos considerando lanzarlo en c√≥digo abierto. Preferir√≠amos lanzarlo, pero la pregunta es el momento del lanzamiento en c√≥digo abierto. Simplemente ponga la fuente en Internet; esto no es suficiente. Debe pensar, hacer algunos ejemplos de implementaci√≥n. ¬øY con qu√© prop√≥sito lo preguntas? ¬øQuiere usar? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Porque tambi√©n me encontr√© con Nginx-RTMP! Es, por decirlo suavemente, no es compatible durante mucho tiempo. El autor ni siquiera responde preguntas particulares ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Si lo desea, puede escribir al correo. Dar para uso propio? Podemos estar de acuerdo. Realmente planeamos abrirlo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Tambi√©n dijiste que puedes pasar de HLS a DASH. HLS no se adapta? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Esta es una pregunta sobre lo que podemos, o quiz√°s no. Depende en gran medida de lo que haremos en t√©rminos de investigaci√≥n de m√©todos de entrega alternativos (es decir, UDP). Si encontramos algo "completamente" bueno, entonces probablemente no tocaremos HLS. Si parece que MPEG-DASH es m√°s c√≥modo, tal vez lo moveremos. No parece ser muy dif√≠cil, pero no estamos seguros de si es necesario o no. La sincronizaci√≥n entre flujos, entre cualidades y otras cosas es claramente mejor all√≠. Hay ventajas </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Con respecto a las alertas. Usted habl√≥ sobre el hecho de que si las transmisiones dejan de transmitirse, entonces esto es inmediatamente una alerta. Y no capt√≥ algo independiente de usted: el proveedor se cay√≥, Megafon se cay√≥ y la gente dej√≥ de transmitir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Digamos que algo independiente de nosotros es b√°sicamente todo tipo de vacaciones, etc. S√≠, lo hicieron. Bueno, lo hicieron, s√≠. Los administradores miraron: hoy son las vacaciones, el resto de las caracter√≠sticas est√°n bien, se calmaron. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Y sobre la escala. ¬øA qu√© nivel se escala? Por ejemplo, solicit√© una transmisi√≥n desde el tel√©fono. ¬øRecibir√© de inmediato un cierto enlace con el servidor de cenizas correcto? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aparecer√° un enlace de inmediato y, si es necesario, lo cambiar√° (si hay problemas en un servidor espec√≠fico). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/tn/rq/xztnrqvvbr73gu61lqgpvdt5c-e.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øQui√©n cambiar√°? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Reproductor m√≥vil o reproductor web. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øReiniciar√° la transmisi√≥n o qu√©? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Un nuevo enlace le llegar√° a donde deber√≠a ir en vivo. √âl ir√° all√≠ y volver√° a preguntar la corriente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ¬øA qu√© nivel tienes cach√©s? Y listas de reproducci√≥n, y fragmentos, o simplemente eso ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬°Y listas de reproducci√≥n, fragmentos! Se almacena en cach√© de manera un poco diferente, tanto en t√©rminos de tiempo como en t√©rminos del retorno del tiempo, pero almacenamos en cach√© ambos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Con respecto a la creaci√≥n de servidores de cenizas? ¬øTuviste tal situaci√≥n que miras a 2 millones de espectadores en una transmisi√≥n, no tienes tiempo para algo y recoges r√°pidamente alg√∫n servidor de cenizas? ¬øO aumenta todo por adelantado con un margen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se√±or:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Quiz√°s esto no fue as√≠. En primer lugar, el stock siempre es peque√±o o grande, no importa. En segundo lugar, no sucede que una transmisi√≥n de repente se vuelva s√∫per popular. Podemos predecir bien el n√∫mero de espectadores. B√°sicamente, para tener mucha gente, debemos hacer un esfuerzo. En consecuencia, podemos ajustar el n√∫mero de espectadores de la transmisi√≥n, seg√∫n los esfuerzos que se realicen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dijiste que mides los retrasos instrumentales por parte del jugador. ¬øC√≥mo? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Muy simple. En fragmentos (en los segmentos de medios) tenemos una marca de tiempo, en el nombre del segmento de medios, en el reproductor simplemente la devolvemos. Si no es expl√≠cito en absoluto, regresa. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recuerdo haber intentado ejecutar el peering en WebRTC. ¬øPor qu√© rechazado? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se√±or:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"No puedo responder esta pregunta por ti, sucedi√≥ sin m√≠". No puedo decir por qu√© lo intent√© y no puedo decir por qu√© me negu√©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Con respecto al receptor y al servidor de medios. Seg√∫n tengo entendido, sol√≠a tener Nginx-RTMP, ahora, tanto all√≠ como all√≠, tiene soluciones personalizadas. De hecho, este es un servidor de medios que representa a otros servidores de medios, y ya est√°n en la cach√© y en el borde. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Entonces, en realidad no. Esta es una soluci√≥n hecha a s√≠ misma, pero es diferente tanto en t√©rminos de un servidor de medios como en t√©rminos de un receptor. Nginx-RTMP: era una especie de cosechadora que pod√≠a hacer ambas cosas. Nuestros interiores del receptor y el servidor de medios son muy diferentes, tanto por c√≥digo como en todas partes. Lo √∫nico que los une es el procesamiento RTMP. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Con respecto al equilibrio entre los bordes. ¬øComo sucedi√≥ esto?</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Medimos el tr√°fico, lo enviamos al servidor deseado. No entend√≠ un poco la pregunta ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Explicar√©: el usuario solicita una lista de reproducci√≥n a trav√©s del reproductor - devuelve las rutas relativas a manifiestos y fragmentos o rutas absolutas, por ejemplo, por IP o dominio? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Las rutas son relativas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es decir, ¬øno hay equilibrio cuando un usuario visualiza una transmisi√≥n? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sucede. Bastante complicado. Podemos usar la redirecci√≥n 301 cuando sobrecargamos el servidor. Si vemos que todo est√° completamente mal all√≠, para segmentos podemos enviarlo a otro servidor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øPero deber√≠a estar conectado a la l√≥gica del jugador? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se√±or:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No, solo esta parte no debe coserse. Redirecci√≥n 301 Simplemente, el jugador deber√≠a poder salir del enlace 301. Podemos enviarlo a otro servidor desde el lado del servidor en el momento de la sobrecarga. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es decir, le pregunta al servidor, ¬øy el servidor se lo da? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> S√≠. Esto no es muy bueno, por lo tanto, la l√≥gica del jugador se usa para retuitear enlaces al caso de falla de uno de los servidores; esto ya est√° en la l√≥gica del jugador. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - ¬øY no trataste de trabajar no seg√∫n un pariente, sino seg√∫n rutas absolutas: cuando le pides al jugador que haga algo de magia, averigua d√≥nde hay recursos y d√≥nde no, y ya das listas de reproducci√≥n que indican un servidor espec√≠fico? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se√±or:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En realidad, parece una soluci√≥n de trabajo. </font><font style="vertical-align: inherit;">¬°Si hubieras venido entonces, habr√≠amos pesado los dos! </font><font style="vertical-align: inherit;">Pero la soluci√≥n actual tambi√©n est√° funcionando, por lo que realmente no quiero saltar de una a la otra, aunque, quiz√°s, esto tambi√©n parezca una soluci√≥n que funcione. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dime, ¬øesto es de alguna manera amigable con la multidifusi√≥n? </font><font style="vertical-align: inherit;">HLS, seg√∫n tengo entendido, absolutamente nada ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - En la implementaci√≥n actual, probablemente no tenemos nada en el sistema con la multidifusi√≥n en vivo. </font><font style="vertical-align: inherit;">No incluimos el concepto de multidifusi√≥n all√≠. </font><font style="vertical-align: inherit;">Quiz√°s en alg√∫n lugar en las profundidades de la magia administrativa, hay algo dentro de la red, pero est√° oculto para todos y nadie lo sabe ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/va/s2/qrvas2mhyryhgck9t6n8ffc1pai.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bA-Y_BfTZZY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de publicidad :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por estar con nosotros. ¬øTe gustan nuestros art√≠culos? ¬øQuieres ver m√°s materiales interesantes? Ap√≥yenos haciendo un pedido o recomendando a sus amigos, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS en la nube para desarrolladores desde $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">an√°logo √∫nico de servidores de nivel b√°sico que inventamos para usted: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toda la verdad sobre VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps desde $ 19 o c√≥mo dividir el servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (las opciones est√°n disponibles con RAID1 y RAID10, hasta 24 n√∫cleos y hasta 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 veces m√°s barato en el centro de datos Equinix Tier IV en Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬°Solo tenemos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV desde $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los Pa√≠ses Bajos!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - ¬°desde $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lea sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥mo construir un edificio de infraestructura. </font><font style="vertical-align: inherit;">clase c con servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488136/index.html">¬øC√≥mo aprendi√≥ el robot Atlas a hacer acrobacias insoportables para una persona com√∫n?</a></li>
<li><a href="../es488138/index.html">Peque√±as mediciones de capacitancia (sensor capacitivo anal√≥gico)</a></li>
<li><a href="../es488140/index.html">C√≥mo simplificar la vida con la ayuda de la ley de Pareto</a></li>
<li><a href="../es488142/index.html">Avalonia pensativa</a></li>
<li><a href="../es488146/index.html">[Discusi√≥n]: ¬øSon ingenieros de TI, son ingenieros de TI?</a></li>
<li><a href="../es488150/index.html">Antig√ºedades: ThinkPad X200 y c√≥digo cerrado</a></li>
<li><a href="../es488152/index.html">¬øUn prototipo de juego multijugador para las 3 pm?</a></li>
<li><a href="../es488154/index.html">Nos ponemos en la piel del gerente de la oficina. Algoritmos b√°sicos de suministro</a></li>
<li><a href="../es488160/index.html">Windows Server 2019 vs. Instant√°neas de VMware con inactividad: una soluci√≥n elegante al problema</a></li>
<li><a href="../es488162/index.html">Cuanto mayor sea la calificaci√≥n, m√°s dinero y viceversa.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>