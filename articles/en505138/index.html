<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüéì üë®‚Äçüîß üöπ What to do so that your online broadcast does not fall apart (well, or at least work for a while) üó®Ô∏è üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üë∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many are familiar with the old photo of Palace Square in St. Petersburg: 
 
 
 
 In social networks, it is most often used in the form of a meme ‚ÄúHow ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>What to do so that your online broadcast does not fall apart (well, or at least work for a while)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/505138/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many are familiar with the old photo of Palace Square in St. Petersburg: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tr/if/4o/trif4o62umtj9w8sse3bnhz1mu4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In social networks, it is most often used in the form of a meme ‚ÄúHow to Call the Devil in the City of Lenin‚Äù. The answer is simple and there are no rituals or communist symbols. Here is what is written under it in small print: </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúTread by passers-by - a five-pointed star on Sq. Uritsky. Shot from the top of the spire of the Admiralty Needle. Our photographer climbed the spire five times, since the paths that make up the star are clearly marked only on ‚Äúthawed‚Äù days, which differ in Leningrad by large fogs that prevent the possibility of shooting. ‚Äù</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In fact, these are specially arranged in a rough bridge path, connecting directly all the exits from the square. Convenient, effective solution.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the case of streaming video on the Internet, the picture also consists of many tracks. But these roads add up to some gloomy ritual:</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/0w/em/z0/0wemz0u_fv8wtip5x3sswszekdu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a screenshot from our internal documentation - a constantly updated diagram of how we have streaming drawn </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in Miro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Rastrelli and Rossi spin like fans: it seems that only a select few can go along these tracks to the end. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, this scheme is built on iron logic. Thanks to the precise operation of this scheme at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the JUG Ru Group conferences,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we will try to make a high-quality and stable broadcast. The article that you are reading now will be useful not only to curious habrozherozhitel, but can also be a kind of template for other conference organizers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alexey Fedorov already talked </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in his Telegram channel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that the conference through the eyes of the organizers is an engineering task to design and build some distributed system. </font><font style="vertical-align: inherit;">The nodes of this system are actors (speakers, PC members, presenters, experts, participants and sponsors), equipment (light, sound, picture, streaming, transcoders, sites, chats) and business processes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pipeline streaming is the main part of the software and hardware complex that lies at the center of this system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It performs a chain of several main tasks:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Receive sound and video from the speaker;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transfer it to a streaming service on the Internet;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pick up from the streaming service and display in the video player;</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main units must work, otherwise no conference will happen. </font><font style="vertical-align: inherit;">They work through subsystem duplication, redundancy, buffering, and other good practices for building distributed systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A conference participant sees only the top of the iceberg - a video player in a browser, a report description and other components of the conference site. </font><font style="vertical-align: inherit;">More precisely, a complex web application, but this is no longer necessary for the participant to think about it. </font><font style="vertical-align: inherit;">We will try to tell about how the browser frontend, the player and all that are arranged in a separate article. </font><font style="vertical-align: inherit;">And here we‚Äôll talk about what is hidden deep under water. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Video can come from several main sources:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prerecorded video</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Studio in the office</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connection to the speaker on a remote site</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Studio at the speaker</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pre-recorded videos</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first level of pain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The essence of the conference is interactivity and uniqueness. If at the ‚Äúconference‚Äù there were no interactive elements and unique content, it would be easier to go watch the ancient button accordions on YouTube. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nevertheless, some things should be written in advance. For example, we all know examples where the opening of a conference or some introductory word was ruined at conferences, and this spoiled the impression of everything else. It makes sense to record not only the opening remarks, but also all kinds of interviews with sponsors, demonstrations, and the like. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Think: that which is not will not break. (The same principle underlies functional programming). If you don‚Äôt record the opening remarks live, but put them in notes, this is a guarantee of success.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The downloaded files undergo simplified installation and encoding and are added to our local storage located directly in the office. </font><font style="vertical-align: inherit;">During the conference, engineers can mix these files into the program, and then they are transmitted to the Internet just like any video source like a studio camera or Zoom. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything, the simple part ends, then the pain begins.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Own studio</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second level of pain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you record a report in a well-controlled environment, for example, in your own office, you don‚Äôt have to mess with the delivery of video over the Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On how to build studios in the office, we wrote a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The solution is good, but it can not always be applied: most speakers are on the other side of the world. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, our own studio - the solution is far from free:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The studio occupies the entire office space; renting an office costs money;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This room must be constantly ventilated and generally take care of it;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You need to buy a bunch of expensive equipment, including a video camera and light;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Need to work with additional people. </font><font style="vertical-align: inherit;">Most can work remotely, but it is such a tradeoff between security and the speed of communication fixing problems.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When people hear about the studio for the first time, I‚Äôm kind of reacting: ‚ÄúWhat can I do there, I took the camera and take it off!‚Äù </font><font style="vertical-align: inherit;">In reality, it is quite long, expensive and requires testing. </font><font style="vertical-align: inherit;">We regularly do such testing, for example, conducting releases of the show ‚ÄúSurvivor's Error‚Äù.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speakers on a remote site</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">third level of pain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speaker on a remote site is an unstable and untrusted part of the system. </font><font style="vertical-align: inherit;">The Internet is like the ocean, and the inhabitants of the Internet rush along the waves in fragile little boats in the midst of a storm. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first rule of the Internet is not to connect to the Internet. </font><font style="vertical-align: inherit;">But all the possibilities have already been exhausted: imagine, the studios are working at full capacity, everything that can be pre-recorded - recorded, what's next? </font><font style="vertical-align: inherit;">There will always be a speaker living on the other side of the world! </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Waiting</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are launching some pre-written, well-working, popular software for connecting a speaker to video conferencing via the Internet. </font><font style="vertical-align: inherit;">We are holding a conference. </font><font style="vertical-align: inherit;">We diverge. </font><font style="vertical-align: inherit;">Profit</font></font></li>
</ul><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reality</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are a lot of solutions on the market, but with a snap, nothing came up to our task. </font><font style="vertical-align: inherit;">In short, all of them have problems either with reliability (the transcoder will break, then the CDN will fall off) either with quality or with the possibility of customization. </font><font style="vertical-align: inherit;">For example, most platforms use WebRTC to capture pictures from the speaker, so 1280x720 is their limit on video resolution. </font><font style="vertical-align: inherit;">And let's say, live coding from a speaker in 1280x720 is a sight to behold, on the verge of code readability. </font><font style="vertical-align: inherit;">It is necessary to find and test a bunch of disparate solutions and collect something reasonable from them. </font><font style="vertical-align: inherit;">Brick by brick.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/5r/t9/cx/5rt9cxssd7osgphxv6co02l5h2y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(This is how online coding looks like in a typical online conference. Try to understand what is written here)</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Now we use the following solutions:</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> speaker‚Äôs </font><strong><font style="vertical-align: inherit;">webcam and microphone are</font></strong><font style="vertical-align: inherit;"> captured via vMixCall or Zoom;</font></font></li>
<li><strong> </strong>  Zoom;</li>
<li>    <strong>  </strong>  Zoom ‚Äî Discord  Telegram;</li>
<li>    <strong> </strong>  Zoom ‚Äî     Chrome Remote Desktop.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the speaker, we get an image from his webcam and sound. The speaker receives from us a ‚Äúpushback‚Äù - a picture of how he looks in the broadcast. Broadcast quality is adaptively controlled by WebRTC, on the basis of which vMixCall works. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An important difference between vMix Call and Zoom is that in it you can accurately monitor all the parameters of the connection with the speaker, and if necessary, intervene. For example, if the speed of your Internet connection is unacceptably low, you can manually lower the quality of the image that is transmitted to the speaker via pushback. If the quality of the outgoing video decreases, the incoming video (the speaker‚Äôs webcam) will become better transmitted. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Disconnecting from Zoom is not fatal. We are constantly </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testing</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and there were already situations when the zoom fell off, and the speaker calmly continued to communicate with the presenter, answering the questions of the audience while he was reconnected to the broadcast. </font><font style="vertical-align: inherit;">That is, if a video enters a participant through various independent channels, this is a good idea in terms of reliability, although it requires additional work from engineers.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slideshow: Zoom</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Many conferences and meetups capture slides with Zoom. Unfortunately, the display quality of such slides directly depends on the quality of the connection. If this is some resident from another part of the world connected via the slow ADSL line, the quality can be extremely poor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, at our conferences, slides are not broadcast through Zoom. The speaker sends them in advance and they are uploaded to the server in the hardware room. During the report, they are broadcast directly from this server. By ‚Äúserver‚Äù is meant a laptop on which all the necessary software for slide shows is installed. This is a Windows laptop with PowerPoint or MacBook with Apple Keynote on board. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The speaker can independently scroll through the slides by connecting to this server via Zoom in </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">remote control</font></a><font style="vertical-align: inherit;"> mode</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. To press the ‚Äúforward‚Äù and ‚Äúback‚Äù buttons of an unnecessary some particularly good quality of communication. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is a pretty failover plan. For example, if the server with slides breaks, then we always have several backup laptops that will replace it instantly, and the broadcast participants will not even notice such an overlay. If Zoom does not work, you can always replace it with Chrome Remote Desktop, VNC, or any other remote control tool. You can even buy TeamViewer that you love, but it has very expensive commercial licenses.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine the worst - in all of St. Petersburg turned off electricity. A nuclear missile flew into our St. Petersburg office. Remote Desktop has stopped working for some fundamental reason. But here we also have a fallback - we can continue broadcasting through the equipment room located in Moscow. We make a call to Zoom, in which three sources participate at once: the speaker and both hardware in Moscow and St. Petersburg. The presenter broadcasts slides from his computer. If one of the cities turns off, there is at least one more that you can quickly switch to. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A similar technique can be used if the speaker wants to hold some kind of demonstration from his screen or organize a joint report for several people.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, at the same time, the slides become from perfectly clear - ordinary, slightly soapy, to which everyone is accustomed. </font><font style="vertical-align: inherit;">But you must admit, this is much better than being left without a report at all. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the network connectivity between our headquarters and the speaker is lost and the speaker is on the other side of the world, somewhere in the USA, we will connect him by voice over the phone. </font><font style="vertical-align: inherit;">And we will switch slides by his direct command. </font><font style="vertical-align: inherit;">** There should always be a backup plan **.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speaker and his own studio</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fourth level of pain, maximum</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the previous example with a speaker on a remote site was like a ship in the middle of a storm, then the speaker with his own studio is the ship on which the team rebelled. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What does it look like? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine that the speaker has his own laptop with the tuned Open Broadcaster program - the most popular free streaming solution. From this computer, he can broadcast his screen, do live coding, show any demo videos, change plans himself, and so on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then he connects his OBS to our server via RTMP and forwards all the captured video. This video is a simplified installation and is directly sent to streaming at Amazon. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The untrusted environment here is not only the Internet, but the entire software and hardware complex on the speaker‚Äôs side.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the presenter, being able to independently control the situation may sound good. But in this case, we are very limited in our ability to help the speaker with problems, if any. What to do if OBS starts to fall? What if the speaker‚Äôs computer mystically began to slow down when trying to display a video? A variety of problems can be tens, hundreds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There may be situations when the broadcasting scheme on the speaker‚Äôs side is simply incompatible with our cunning editing system. This happened to Sebastian Dashner, who ‚Äúoutwitted‚Äù us by launching not just one computer, but two. He worked on one, and the second he used as an editing station for OBS. I had to stream it through Zoom, bypassing a beautiful scheme with an RTMP gateway.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There should always be a backup plan. </font><font style="vertical-align: inherit;">In this case, you should agree with the speaker in advance what you will do if the broadcast from his OBS for some reason stops. </font><font style="vertical-align: inherit;">The most logical way is to switch to the ‚Äúnormal‚Äù way of broadcasting: connect via Zoom and continue the report as usual. </font><font style="vertical-align: inherit;">To do this, the speaker must be ready for this ‚Äúnormal mode‚Äù - that is, he must have some kind of slides, and he must imagine what to tell instead of showing the screen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware room and studio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All video captured from various sources is sent to the hardware. </font><font style="vertical-align: inherit;">Here the video is mounted: the correct plans are selected for the broadcast, pictures from webcams are cropped, some graphics like frames and logos are added to the video, and so on. </font><font style="vertical-align: inherit;">After editing the video goes to streaming at Amazon. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We wrote about the hardware device in detail </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in a separate article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but here I want to tell you what all this costs with the studio equipment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To calculate the cost, let's see what we generally need. </font><font style="vertical-align: inherit;">Usually in the equipment room there are several laptops for Zoom and remote slide controls, and an editing station. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How to connect to the hardware?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the speaker is connected via Zoom and remote control, communication goes through the open Internet;</font></font></li>
<li>    OBS   , -     RTMP-,        ;</li>
<li> ,   ,     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This diagram shows all the connections inside the control room: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/np/4q/1rnp4qnybr8qmr8ruwerb2tmgf4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The abbreviation ‚ÄúPTS‚Äù stands for ‚Äúmobile television station‚Äù. </font><font style="vertical-align: inherit;">In reality, it is a computer powerful enough to perform the functions of an editing station. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At any given time, we need at least two TCP. </font><font style="vertical-align: inherit;">While one of them is broadcasting the report, the second is preparing for the next event. </font><font style="vertical-align: inherit;">For example, it makes sense to divide the TCP as follows: only reports are broadcast from one, and only sponsorship interviews and other special things from the second. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In case of a power outage, an uninterruptible power supply is needed. </font><font style="vertical-align: inherit;">One battery will last 10 minutes, so a lot of batteries need to be purchased. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, shock the content. </font><font style="vertical-align: inherit;">Here's how much it costs:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14 computers for TCP, for each you need to have: </font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System unit with a graphics card with RTX 2060: about 130 thousand</font></font></li>
<li> 27- : 30 </li>
<li>   4K: 80 </li>
<li>MIDI-,   : 10   </li>
</ul><br>
</li>
<li>  Asus: 10   70  ;</li>
<li> : 5   30  ;</li>
<li>   : 4   23  ;</li>
<li>: 8   80  ;</li>
<li>  : 4   20  ;</li>
<li>      : 550  ;</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you add all the numbers, you get more than five million rubles for the minimum necessary iron. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you are suddenly wondering where the organizers spend huge money earned on tickets, then here is one example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probably, someone can be shocked by these numbers, but believe me - this is only a small part of the story. </font><font style="vertical-align: inherit;">For example, we did not take into account the efforts and salaries of the people who will exploit this iron, rent space, and all that stuff.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Streaming</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúCDN‚Äù stands for ‚ÄúContent Delivery Network‚Äù. This is a geographically distributed network infrastructure that allows you to optimize the delivery and distribution of content to Internet users. You can read more about CDN </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directly on Habr√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In other words, somewhere near you there is always a server that saves and quickly quickly gives all the pictures and videos that you see in the browser. If every time you downloaded all the pictures from a server in Virginia, where the main Amazon servers are located, half of the sites would load twice as long. Or it wouldn‚Äôt load at all - because the web server fell from the load.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Video on an online conference needs to be distributed via CDN. But if you can build a studio or a hardware room with your own hands, even for millions of rubles, then you won‚Äôt be able to build your own CDNs around the world in any way. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even if we wanted to build only one server distributing video in Moscow or St. Petersburg, it would be very unpleasant. The feature of such systems is maximum availability and fault tolerance under load. The greater the load, the more complex engineering problems that require high qualifications. What will happen if network connectivity disappears between our server and someone in Khabarovsk? What happens if the container with the video server starts to fall five times per second for an unclear reason? It‚Äôs easier to pay money to someone who already knows how to do it well.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We‚Äôve explored several different video streaming solutions and for now have focused on what Amazon offers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The process is as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The result of the hardware is video streams and prerecorded video files.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We send video streams via RTMP to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon MediaLive servers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Files are sent to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon MediaConvert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> servers </font><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video is uploaded to storage - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon S3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally, data is scooped out of S3 and scattered across the CDN servers - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon CloudFront</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously, all services are worth some money. The exact cost depends on the region and volume. At the very beginning, these amounts are not very impressive, but when they add up, it is already pretty decent. For example, the more conferences you have, the more files you need to store. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, you cannot immediately upload files to CloudFront, you must first prepare them. Participants with different Internet connection quality and different screen sizes need video in different quality. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Elemental MediaConvert</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a video transcoding service with capabilities at the level of adult broadcasting companies. Video files are downloaded via the web interface or API and then transcoded themselves into any desired format. If you have uploaded a file to MediaConvert, then all responsibility for providing encoding is no longer on you, but on Amazon. Costs are on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vs/uy/et/vsuyeth8--iqegfow-nu5u_wk3c.png"><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Elemental MediaLive</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is about the same, but for video streams. The idea is that you stream to MediaLive in the highest quality that you have - and it generates several options from it that are suitable for different devices and Internet speeds.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jk/qg/ptjkqgkdr9pymwhtvxkfbh-pxqa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The capabilities of these services look cool, but they are not cheap. For example, when buying a transcoding service, it is understood that they may well break. If the transcoder crashes and restarts in the cloud, time is wasted, and the conference participant does not see anything at this time or the broadcast is interrupted in the player. To prevent this horror from happening, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you need to buy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> several transcoders for the same video stream at once. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Simple Storage Service (Amazon S3)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a data storage service. You can fill in the data there in almost unlimited volumes. In general, S3 can be used as a universal storage for anything: you can distribute files, you can analyze big data, you can synchronize IoT devices, and so on. In our case, S3 is needed as an intermediate storage for everything that MediaLive and MediaConvert rendered to us. In order to be able to transfer video to CDN, in the settings you need to specify the appropriate bucket in S3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/cj/ux/5vcjux85cqutevmhhdox9vjpbji.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As for reliability, the S3 provides 99.999999999% reliability (11 nines here). Such reliability is suitable even for banks, and even more suitable for us for video. We can say that this is the most stable part in the whole scheme - and this stability </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rests on the money</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that we pay Amazon for every megabyte.</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon CloudFront</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a universal CDN, which also can deliver video. </font><font style="vertical-align: inherit;">Video works in Russia with fairly low latencies and high speed. </font><font style="vertical-align: inherit;">CloudFront is integrated with AWS, including S3 and Live services. </font><font style="vertical-align: inherit;">It looks like magic: you configure several parameters in the admin panel, and suddenly your video starts to be distributed in high quality around the world. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Payment for CloudFront occurs upon use - money </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">starts to drip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> only if the conference participants really watch the video. </font><font style="vertical-align: inherit;">It is very important that we do not need to pay for traffic between S3 and CloudFront - traffic between internal services at Amazon is completely free. </font><font style="vertical-align: inherit;">But if instead of S3 we tried to use some other storage, it would have cost a pretty penny.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We catch the stream in the video player</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the video has appeared on CloudFront, you can pick it up using the video player built into our browser front-end (i.e., the site that the conference participants see). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, there is no ready-made platform that would receive video from CloudFront and turn it into a real online conference. </font><font style="vertical-align: inherit;">More precisely, there is the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Media Package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but still modify the file. </font><font style="vertical-align: inherit;">Therefore, we had to write our website, personal account, player </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">based on HLS.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and think through special ‚Äúconference‚Äù features for them. </font><font style="vertical-align: inherit;">But this is a topic for a completely different article.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, we talked about where conference video comes from and how it appears on the Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Video capture, studios and hardware we collect ourselves. Transcoding and delivery of video to CDN, we trust Amazon services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Whether we do the work ourselves or trust contractors, buy or rent equipment - all these are huge amounts, measured in many millions of rubles. This money is taken, inter alia, from the cost of tickets purchased by participants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We still have space for a couple more articles: we need to tell you how our browser frontend works and how the organizational processes work.</font></font><br>
<br>
<blockquote>   -  ,    ! <br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">TechTrain 2020</a>,     <b></b>.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a>.<br>
<br>
      -:<br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">JPoint</a> (Java)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Heisenbug</a> ()</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">HolyJS</a> (JavaScript)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">DotNext</a> (.NET)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">C++ Russia</a> (C++)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">DevOops</a> (DevOps)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Hydra</a> (Distributed computing)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Mobius</a> ( )</li>
</ul><br>
     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  -</a> ( ),         ( ).<br>
</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505124/index.html">Stop pulling an owl on a globe</a></li>
<li><a href="../en505126/index.html">How to teach everyone and everyone at the same time?</a></li>
<li><a href="../en505128/index.html">Deciphering the air of Habr with DIT of Moscow</a></li>
<li><a href="../en505134/index.html">When to write your IoT platform is more profitable than buying a ready-made</a></li>
<li><a href="../en505136/index.html">Nibiru</a></li>
<li><a href="../en505142/index.html">How Amazon wants innovation out of the pandemic</a></li>
<li><a href="../en505156/index.html">Django: one user for everything</a></li>
<li><a href="../en505176/index.html">What assets allowed investors to protect resources during a pandemic?</a></li>
<li><a href="../en505178/index.html">DIY Exergaming in isolation</a></li>
<li><a href="../en505186/index.html">Three ways to combine ground on a printed circuit board</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>