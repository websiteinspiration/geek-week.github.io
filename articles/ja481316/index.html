<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎠 🏜️ 🌉 マイクロサービスブログの作成-パート4ポストサービス 😦 👇🏻 🐎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、マイクロサービスに関するデモブログを作成した歴史の続きです（前のパートはここで読むことができます：パート1「アーキテクチャの一般的な説明」、パート2「APIゲートウェイ」、パート3「サービスユーザー」）。この記事では、Postマイクロサービス（記事）の実装に焦点を当てます。
 
 マイク...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>マイクロサービスブログの作成-パート4ポストサービス</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/481316/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、マイクロサービスに関するデモブログを作成した歴史の続きです（前のパートはここで読むことができます：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1「アーキテクチャの一般的な説明」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2「APIゲートウェイ」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3「サービスユーザー」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">この記事では、Postマイクロサービス（記事）の実装に焦点を当てます。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 マイクロサービスの主な機能は、他のサービスとのさまざまなタイプの接続を実装することです。</font><font style="vertical-align: inherit;">たとえば、Commentsサービス（コメント）では、1対多のタイプの通信が実装され（1つの記事に複数のコメントが含まれる場合があります）、UserサービスとCategoryサービスには多対1の接続があります（つまり、1人のユーザーが多くの記事と1つの記事を持つことができます）カテゴリは複数の記事になる場合があります）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
機能に関しては、以下のメソッドがPostサービスに実装されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス要求と中間状態のロギング（メカニズムはパート3「ユーザーサービス」で詳細に説明されています）、TraceId（api-gwによって発行されたものと同じ、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2「APIゲートウェイ」を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照）を示します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRUD関数（データベースのレコードの作成、読み取り、編集、削除-MongoDB）。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検索機能：すべての記事を検索、カテゴリで検索、著者で検索</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
従来、マイクロサービスの作成は、プロトファイルに記述して開始します。</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">//post.proto</span>
yntax = <span class="hljs-string">"proto3"</span>;<font></font>
<font></font>
<span class="hljs-keyword">package</span> protobuf;<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"google/api/annotations.proto"</span>;<font></font>
<font></font>
<span class="hljs-comment">//   Post</span><font></font>
service PostService {<font></font>
  <font></font>
  <span class="hljs-comment">// </span><font></font>
  rpc Create (CreatePostRequest) returns (CreatePostResponse) {<font></font>
    option (google.api.http) = {<font></font>
      post: <span class="hljs-string">"/api/v1/post"</span><font></font>
    };<font></font>
  }              <font></font>
<font></font>
  <span class="hljs-comment">//  </span><font></font>
  rpc Update (UpdatePostRequest) returns (UpdatePostResponse) {<font></font>
    option (google.api.http) = {<font></font>
      post: <span class="hljs-string">"/api/v1/post/{Slug}"</span><font></font>
    };<font></font>
  }     <font></font>
<font></font>
  <span class="hljs-comment">// </span><font></font>
  rpc Delete (DeletePostRequest) returns (DeletePostResponse) {<font></font>
    option (google.api.http) = {<font></font>
      <span class="hljs-built_in">delete</span>: <span class="hljs-string">"/api/v1/post/{Slug}"</span><font></font>
    };<font></font>
  }     <font></font>
<font></font>
  <span class="hljs-comment">//     </span>
  rpc GetPostCategory (GetPostCategoryRequest) returns (GetPostCategoryResponse) {      <span class="hljs-comment">//    </span><font></font>
    option (google.api.http) = {<font></font>
      get: <span class="hljs-string">"/api/v1/post/category/{Slug}"</span><font></font>
    };<font></font>
  }      <font></font>
<font></font>
  <span class="hljs-comment">//  </span><font></font>
  rpc Find (FindPostRequest) returns (FindPostResponse) {<font></font>
    option (google.api.http) = {<font></font>
      get: <span class="hljs-string">"/api/v1/post"</span><font></font>
    };<font></font>
  }                    <font></font>
<font></font>
  <font></font>
  <span class="hljs-comment">//    </span><font></font>
  rpc Get (GetPostRequest) returns (GetPostResponse) {<font></font>
    option (google.api.http) = {<font></font>
      get: <span class="hljs-string">"/api/v1/post/{Slug}"</span><font></font>
    };<font></font>
  } <font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  rpc GetAuthor (GetAuthorRequest) returns (GetAuthorResponse) {               <span class="hljs-comment">//    SLUG</span><font></font>
    option (google.api.http) = {<font></font>
      get: <span class="hljs-string">"/api/v1/author/{Slug}"</span><font></font>
    };<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//  </span>
  rpc FindAuthors (FindAuthorRequest) returns (FindAuthorResponse) {           <span class="hljs-comment">//  </span><font></font>
    option (google.api.http) = {<font></font>
      get: <span class="hljs-string">"/api/v1/author"</span><font></font>
    };<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  CREATE</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message CreatePostRequest {<font></font>
  <span class="hljs-keyword">string</span> Title = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">string</span> SubTitle = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">string</span> Content = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">string</span> Categories = <span class="hljs-number">4</span>;<font></font>
}<font></font>
message CreatePostResponse {<font></font>
  Post Post = <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  UPDATE</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message UpdatePostRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">string</span> Title = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">string</span> SubTitle = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">string</span> Content = <span class="hljs-number">4</span>;
  <span class="hljs-keyword">int32</span> Status = <span class="hljs-number">5</span>;
  <span class="hljs-keyword">string</span> Categories = <span class="hljs-number">6</span>;<font></font>
}<font></font>
message UpdatePostResponse {<font></font>
  <span class="hljs-keyword">int32</span> Status =<span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  DELETE</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message DeletePostRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;<font></font>
}<font></font>
message DeletePostResponse {<font></font>
  <span class="hljs-keyword">int32</span> Status =<span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  GET</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message GetPostRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;<font></font>
}<font></font>
message GetPostResponse {<font></font>
  Post Post = <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  FIND POST</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message FindPostRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;<font></font>
}<font></font>
message FindPostResponse {<font></font>
  repeated Post Posts = <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  GET AUTHOR</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message GetAuthorRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;<font></font>
}<font></font>
message GetAuthorResponse {<font></font>
  Author Author = <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  FIND AUTHOR</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message FindAuthorRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;<font></font>
}<font></font>
message FindAuthorResponse {<font></font>
  repeated Author Authors = <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  GET CATEGORY</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message GetPostCategoryRequest {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;<font></font>
}<font></font>
message GetPostCategoryResponse {<font></font>
  PostCategory Category = <span class="hljs-number">1</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  POST</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message Post {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">string</span> Title = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">string</span> SubTitle = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">string</span> Content = <span class="hljs-number">4</span>;
  <span class="hljs-keyword">string</span> UserId = <span class="hljs-number">5</span>;
  <span class="hljs-keyword">int32</span> Status = <span class="hljs-number">6</span>;
  <span class="hljs-keyword">string</span> Src = <span class="hljs-number">7</span>;<font></font>
  Author Author = <span class="hljs-number">8</span>;
  <span class="hljs-keyword">string</span> Categories = <span class="hljs-number">9</span>;<font></font>
  repeated PostCategory PostCategories = <span class="hljs-number">10</span>;
  <span class="hljs-keyword">string</span> Comments = <span class="hljs-number">11</span>;<font></font>
  repeated PostComment PostComments = <span class="hljs-number">12</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  Author</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message Author {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">string</span> FirstName = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">string</span> LastName = <span class="hljs-number">3</span>;
  <span class="hljs-keyword">string</span> SrcAvatar = <span class="hljs-number">4</span>;
  <span class="hljs-keyword">string</span> SrcCover = <span class="hljs-number">5</span>;<font></font>
  repeated Post Posts = <span class="hljs-number">6</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  PostCategory</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message PostCategory {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">string</span> Name = <span class="hljs-number">2</span>;<font></font>
  repeated Post Posts = <span class="hljs-number">3</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//---------------------------------------------------------------</span>
<span class="hljs-comment">//  PostComment</span>
<span class="hljs-comment">//---------------------------------------------------------------</span><font></font>
message PostComment {<font></font>
  <span class="hljs-keyword">string</span> Slug = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">string</span> Content = <span class="hljs-number">2</span>;<font></font>
  Author Author = <span class="hljs-number">3</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、マイクロサービスフレームワークを生成します。</font><font style="vertical-align: inherit;">これを行うには、プロジェクトのルートディレクトリに移動し、sh ./bin/protogen.shコマンドを実行します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素晴らしい！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちのほとんどの作業はコードジェネレーターによって行われ、アプリケーション関数の実装を記述する必要がありました。</font><font style="vertical-align: inherit;">ファイル./services/post/functions.goを開き、実装を記述します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Create関数の主なフラグメントを考えてみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1.コールコンテキストを解析し、そこからユーザーに関する情報を取得します。</font></font><br>
<br>
<pre><code class="go hljs">...<font></font>
md,_:=metadata.FromIncomingContext(ctx)<font></font>
<span class="hljs-keyword">var</span> userId <span class="hljs-keyword">string</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(md[<span class="hljs-string">"user-id"</span>])&gt;<span class="hljs-number">0</span>{<font></font>
  userId=md[<span class="hljs-string">"user-id"</span>][<span class="hljs-number">0</span>]<font></font>
}<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.クエリパラメータを確認し、無効な値が含まれている場合は、対応するエラーを返します。</font></font><br>
<br>
<pre><code class="go hljs">...
<span class="hljs-keyword">if</span> in.Title==<span class="hljs-string">""</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>,app.ErrTitleIsEmpty<font></font>
}<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3.データベース（mongoDB）に投稿を保存します。</font></font><br>
<br>
<pre><code class="go hljs">...<font></font>
collection := o.DbClient.Database(<span class="hljs-string">"blog"</span>).Collection(<span class="hljs-string">"posts"</span>)<font></font>
post:=&amp;Post{<font></font>
  Title:in.Title,<font></font>
  SubTitle:in.SubTitle,<font></font>
  Content:in.Content,<font></font>
  Status:app.STATUS_NEW,<font></font>
  UserId:userId,<font></font>
  Categories:in.Categories,<font></font>
}<font></font>
	<font></font>
insertResult, err := collection.InsertOne(context.TODO(), post)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>,err<font></font>
}<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.作成されたレコードのIDを受け取り、それを回答に追加して、回答を返します。</font></font><br>
<br>
<pre><code class="go hljs">...
<span class="hljs-keyword">if</span> oid, ok := insertResult.InsertedID.(primitive.ObjectID); ok {<font></font>
	post.Slug=fmt.Sprintf(<span class="hljs-string">"%s"</span>,oid.Hex())<font></font>
}<span class="hljs-keyword">else</span> {<font></font>
	err:=app.ErrInsert<font></font>
	<span class="hljs-keyword">return</span> out,err<font></font>
}<font></font>
out.Post=post<font></font>
<span class="hljs-keyword">return</span> out,<span class="hljs-literal">nil</span><font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先に述べたように、Postサービスは他のサービスとの接続に関して興味深いものです。</font><font style="vertical-align: inherit;">これは、Getメソッド（特定のIDでPostを取得）によって明確に示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、mongoDB Postから読み取ります。</font></font><br>
<br>
<pre><code class="go hljs">...<font></font>
collection := o.DbClient.Database(<span class="hljs-string">"blog"</span>).Collection(<span class="hljs-string">"posts"</span>)<font></font>
post:=&amp;Post{}<font></font>
id, err := primitive.ObjectIDFromHex(in.Slug)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>,err<font></font>
}<font></font>
filter:= bson.M{<span class="hljs-string">"_id"</span>: id}<font></font>
err= collection.FindOne(context.TODO(), filter).Decode(post)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>,err<font></font>
}<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではすべてが多かれ少なかれ単純です。</font><font style="vertical-align: inherit;">まず、文字列をObjectIDに変換し、それをフィルターで使用してレコードを検索します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、結果の投稿レコードを著者に関するデータで強化する必要があります。</font><font style="vertical-align: inherit;">これを行うには、Userサービスに移動して、指定されたUserIdのレコードを取得します。</font><font style="vertical-align: inherit;">これは次のようにして行うことができます。</font></font><br>
<br>
<pre><code class="go hljs">...
<span class="hljs-comment">//   User</span>
<span class="hljs-keyword">var</span> header, trailer metadata.MD<font></font>
resp, err := o.UserService.Get(<font></font>
getCallContext(ctx),<font></font>
  &amp;userService.GetUserRequest{Slug:post.UserId},<font></font>
  grpc.Header(&amp;header), <span class="hljs-comment">//      </span>
  grpc.Trailer(&amp;trailer), <span class="hljs-comment">//      </span><font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
   <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>,err<font></font>
}<font></font>
	<font></font>
 author:=&amp;Author{<font></font>
  Slug:resp.User.Slug,<font></font>
  FirstName:resp.User.FirstName,<font></font>
  LastName:resp.User.LastName,<font></font>
  SrcAvatar:SRC_AVATAR, <span class="hljs-comment">//TODO - </span>
  SrcCover:SRC_COVER,   <span class="hljs-comment">//TODO - </span><font></font>
 }<font></font>
 post.Author=author<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は意図的に2つの異なる用語「ユーザー」と「作成者」を使用していることに注意したいと思います。私は彼らが異なる状況にあると信じています。ユーザーとは、ユーザー名/パスワード認証およびその他の属性と機能であり、セキュリティとアクセスに関連する何らかの方法で機能します。著者は、公開された投稿、コメントなどに関するエンティティです。 Authorエンティティは、Userからのデータをベースとして使用してPostコンテキストで生まれます。 （違いを説明できたと思います。）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、カテゴリー・サービスから関連カテゴリーのデータを読み取ることです。私が最善の選択肢を提案していることを確信できません（コミュニティがそれを修正してくれることを願っています）。このアプローチの本質は次のとおりです。Categoryサービスに対して1つのリクエストを作成し、すべての既存のカテゴリを差し引き、PostサービスではPostに関連するカテゴリのみを選択します。このアプローチの欠点は、送信されるデータのオーバーヘッドに加えて、1つのリクエストしか作成しないことです。なぜならカテゴリの数は間違いなく圧倒的な量ではありません。オーバーヘッドは無視できると思います。</font></font><br>
<br>
<pre><code class="go hljs">...
<span class="hljs-comment">//   Category, JOIN category</span><font></font>
respCategory,err:=o.CategoryService.Find(<font></font>
   getCallContext(ctx),<font></font>
   &amp;categoryService.FindCategoryRequest{},<font></font>
)<font></font>
   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> out,err<font></font>
   }<font></font>
   <span class="hljs-keyword">for</span> _, category:= <span class="hljs-keyword">range</span> respCategory.Categories {
      <span class="hljs-keyword">for</span> _, category_slug:= <span class="hljs-keyword">range</span> strings.Split(post.Categories,<span class="hljs-string">","</span>) {
         <span class="hljs-keyword">if</span> category.Slug==category_slug{<font></font>
            postCategor:=&amp;PostCategory{<font></font>
	       Slug:category.Slug,<font></font>
	       Name:category.Name,<font></font>
	    }<font></font>
	    post.PostCategories=<span class="hljs-built_in">append</span>(post.PostCategories,postCategor)<font></font>
	 }<font></font>
       }<font></font>
    }<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、関連するすべてのコメントを取得する必要があります。</font><font style="vertical-align: inherit;">ここでは、タスクはカテゴリを使用したタスクと似ていますが、カテゴリIdの場合、関連するカテゴリはPostに保存され、コメントの場合、親PostのIdは子コメントに直接保存されます。</font><font style="vertical-align: inherit;">実際、これによりタスクが大幅に簡素化されます。</font><font style="vertical-align: inherit;">必要なのは、親の投稿を示すコメントサービスへのリクエストを作成し、結果を処理することです。ループで、すべての関連するPostCommentを投稿に追加します</font></font><br>
<br>
<pre><code class="go hljs">...
<span class="hljs-comment">//   Comments, JOIN comments</span><font></font>
respComment,err:=o.CommentService.Find(<font></font>
   getCallContext(ctx),<font></font>
   &amp;commentService.FindCommentRequest{PostId:in.Slug},<font></font>
)<font></font>
   <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> out,err<font></font>
   }<font></font>
   <span class="hljs-keyword">for</span> _, comment:= <span class="hljs-keyword">range</span> respComment.Comments {<font></font>
      postComment:=&amp;PostComment{<font></font>
         Slug:comment.Slug,<font></font>
	 Content:comment.Content,<font></font>
      }<font></font>
      post.PostComments=<span class="hljs-built_in">append</span>(post.PostComments,postComment)<font></font>
   }<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集めたポストを返却</font></font><br>
<br>
<pre><code class="go hljs">...<font></font>
out.Post=post<font></font>
<span class="hljs-keyword">return</span> out,<span class="hljs-literal">nil</span><font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webインターフェースでは、カテゴリー別および著者別のナビゲーションを実装しました。</font><font style="vertical-align: inherit;">それら。</font><font style="vertical-align: inherit;">ユーザーがカテゴリをクリックすると、選択したカテゴリにリンクしているすべての記事のリストが表示されます。</font><font style="vertical-align: inherit;">そして彼が著者をクリックすると、それに応じて記事のリストが表示され、選択されたユーザーは著者によって示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Postサービスにこの機能を実装する方法は2つあり</font><font style="vertical-align: inherit;">ます</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。GetPostCategory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ID、カテゴリ名、および関連記事のコレクション</font><font style="vertical-align: inherit;">を含む</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostCategory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造を返します</font><b><font style="vertical-align: inherit;">GetAuthor-</font></b><font style="vertical-align: inherit;">ユーザー属性（FirstName、LastNameなど）と関連Postのコレクションを含むAuthor構造を返します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しにならないように、これらのメソッドの実装については詳しく説明しません。</font><font style="vertical-align: inherit;">これらは、上記で説明したものと同じコードフラグメントに基づいています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja481302/index.html">「クラスターについてではありません」またはDBMSのインポート方法</a></li>
<li><a href="../ja481304/index.html">アメリカの旗の並べ替え</a></li>
<li><a href="../ja481306/index.html">werf 1.0の安定版の紹介：GitOpsがwerf 1.0をどのように使用するか、ステータス、計画</a></li>
<li><a href="../ja481312/index.html">Santa's Lost Gifts：1月6日のITクエストのお知らせ</a></li>
<li><a href="../ja481314/index.html">ロボットとエンターテインメントのためのDIYクローラープラットフォーム</a></li>
<li><a href="../ja481318/index.html">Unicodeによるハッキング（GitHubの例）</a></li>
<li><a href="../ja481322/index.html">3CX V16 Update 4とUnified FQDN 3CX WebMeetingの紹介</a></li>
<li><a href="../ja481324/index.html">2020年のロゴデザイントレンド</a></li>
<li><a href="../ja481326/index.html">Flutterとは何か、なぜ2020年にFlutterを研究する必要があるのか</a></li>
<li><a href="../ja481328/index.html">キプロスのグループWargamingからの$ 1,690,000の個人的な主張についてのBlitzTeam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>