<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎻 🤚🏻 🍌 Wie funktioniert Ryuk Ransomware, die Unternehmen angreift? 🚴🏾 👨🏿‍🤝‍👨🏼 🅾️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ryuk ist eine der bekanntesten Ransomware-Optionen der letzten Jahre. Seit seinem ersten Erscheinen im Sommer 2018 hat er eine beeindruckende Liste vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie funktioniert Ryuk Ransomware, die Unternehmen angreift?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497696/"><img src="https://habrastorage.org/webt/wc/6r/b3/wc6rb3xxu-e_aw_mg1pxcy_23yq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryuk ist eine der bekanntesten Ransomware-Optionen der letzten Jahre. </font><font style="vertical-align: inherit;">Seit seinem ersten Erscheinen im Sommer 2018 hat er </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine beeindruckende Liste von Opfern zusammengestellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , insbesondere im Geschäftsumfeld, das das Hauptziel seiner Angriffe ist.</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Allgemeine Information</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Dokument enthält eine Analyse der Ryuk-Ransomware-Option sowie des Bootloaders, der für das Herunterladen der Malware auf das System verantwortlich ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryuk Ransomware erschien erstmals im Sommer 2018. Einer der Unterschiede zwischen Ryuk und anderer Ransomware besteht darin, dass Unternehmensumgebungen angegriffen werden sollen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mitte 2019 griffen Cyber-Kriminalitätsgruppen mit Hilfe dieses Kryptors eine große Anzahl spanischer Unternehmen an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x5/ax/et/x5axetxacru5kb7h6er1vagmdqy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/oc/kn/ee/ockneevf4elmwczdwsmimtsvnuk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung </font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">1: Auszug aus El Confidencial zum Ryuk-Ransomware-Angriff [1] </font></i><i><font style="vertical-align: inherit;">2: Auszug aus El País über einen Angriff von Ryuk Ransomware [2] In</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
diesem Jahr griff Ryuk eine große Anzahl von Unternehmen in verschiedenen Ländern an. Wie Sie in den folgenden Zahlen sehen können, haben Deutschland, China, Algerien und Indien am meisten gelitten.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn man die Anzahl der Cyber-Angriffe vergleicht, kann man sehen, dass Millionen von Benutzern von Ryuk betroffen waren und die riesige Datenmenge kompromittiert wurde, was zu ernsthaften wirtschaftlichen Schäden führte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/4u/y-/-p4uy-fnectlv0mqwtvupfa--vc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 3: Illustration von Ryuks globaler Aktivität. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sq/oe/hm/sqoehmto6enrwgz6kjt4_sdpgz0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 4: 16 am stärksten betroffenen Ländern von Ryuk </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/qj/1_/d2/qj1_d2eze5bigcd0gqvvrwiw9ns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 5: Anzahl der von Ryuk-Ransomware angegriffenen Benutzer (in Millionen)</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nach dem üblichen Funktionsprinzip solcher Bedrohungen zeigt diese Ransomware dem Opfer nach Abschluss der Verschlüsselung eine Lösegeldbenachrichtigung an, die in Bitcoins an die angegebene Adresse gezahlt werden muss, um den Zugriff auf verschlüsselte Dateien wiederherzustellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Malware hat sich seit ihrem ersten Auftreten geändert.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine in diesem Dokument analysierte Variante dieser Bedrohung wurde bei einem Versuch entdeckt, im Januar 2020 einen Angriff zu starten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund ihrer Komplexität wird diese Malware häufig organisierten Cyberkriminellen zugeschrieben, die auch als APT-Gruppen bezeichnet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Teil des Ryuk-Codes hat eine bemerkenswerte Ähnlichkeit mit dem Code und der Struktur eines anderen bekannten Hermes-Kryptographen, mit dem sie eine Reihe identischer Funktionen haben. Aus diesem Grund war Ryuk ursprünglich mit der nordkoreanischen Gruppe Lazarus verbunden, die zu dieser Zeit im Verdacht stand, hinter der Hermes-Ransomware zu stehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschließend stellte Falcon X von CrowdStrike fest, dass Ryuk tatsächlich von WIZARD SPIDER erstellt wurde [4].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt einige Beweise, die diese Annahme stützen. Erstens wurde diese Ransomware auf der Exploit.in-Website beworben, die ein bekannter russischer Malware-Markt ist und zuvor mit einigen russischen APT-Gruppen in Verbindung gebracht wurde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Tatsache schließt die Theorie aus, dass Ryuk von der Lazarus APT-Gruppe entwickelt werden könnte Dies entspricht nicht der Art und Weise, wie sich die Gruppe verhält.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus wurde Ryuk als Verschlüsseler angepriesen, der auf russischen, ukrainischen und belarussischen Systemen nicht funktioniert. Dieses Verhalten wird durch die in einigen Versionen von Ryuk gefundene Funktion bestimmt, bei der die Sprache des Systems überprüft wird, in dem dieser Verschlüsseler ausgeführt wird, und der Betrieb beendet wird, wenn das System Russisch, Ukrainisch oder Weißrussisch hat. Schließlich wurden bei einer Expertenanalyse einer Maschine, die von der WIZARD SPIDER-Gruppe gehackt wurde, mehrere „Artefakte“ entdeckt, die angeblich bei der Entwicklung von Ryuk als Variante des Hermes-Kryptors verwendet wurden </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Andererseits schlugen die Experten Gabriela Nicolao und Luciano Martins vor, dass der Kryptograf möglicherweise vom CryptoTech APT-Team entwickelt wurde [5].</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies folgt aus der Tatsache, dass diese Gruppe einige Monate vor dem Erscheinen von Ryuk Informationen im Forum derselben Website veröffentlichte, auf der sie eine neue Version der Hermes-Ransomware entwickelt hatte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mehrere Forumbenutzer haben sich gefragt, ob CryptoTech Ryuk wirklich erstellt hat. </font><font style="vertical-align: inherit;">Danach verteidigte sich diese Gruppe und gab an, Beweise dafür zu haben, dass sie 100% dieses Verschlüsselers entwickelt hatte.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Eigenschaften</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen mit dem Bootloader, dessen Aufgabe es ist, das System zu identifizieren, in dem er sich befindet, damit Sie die „richtige“ Version des Ryuk-Verschlüsselers ausführen können. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Bootloader-Hash lautet wie folgt: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MD5 A73130B0E379A989CBA3D695A157A495 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA256 EF231EE1A2481B7E627921468E79BB4369CCFAEB19A575748DD2B664ABC4F469 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der Funktionen dieses Bootloaders enthält keine Daten. Die Ersteller dieser Malware haben keine Informationen darin aufgenommen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal enthalten sie fehlerhafte Daten, um den Benutzer glauben zu lassen, dass er angeblich eine legitime Anwendung startet. </font><font style="vertical-align: inherit;">Wie wir später sehen werden, halten es die Angreifer jedoch nicht für erforderlich, Metadaten zu verwenden, falls die Infektion keine Interaktion mit dem Benutzer beinhaltet (wie dies bei diesem Verschlüsseler der Fall ist). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/zx/yu/rjzxyuaec1nfxajxzwufks4hb0w.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">6:</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Beispiel- </font><i><font style="vertical-align: inherit;">Metadaten Das Beispiel</font></i><font style="vertical-align: inherit;"> wurde im 32-Bit-Format kompiliert, sodass es sowohl auf 32-Bit- als auch auf 64-Bit-Systemen ausgeführt werden kann.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Penetrationsvektor</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Beispiel, mit dem Ryuk heruntergeladen und gestartet wird, wurde über eine Remoteverbindung in unser System eingegeben, und die Zugriffsparameter wurden dank eines vorläufigen RDP-Angriffs ermittelt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jd/bj/ptjdbj8ce7mgfuy8vowq8gogitm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 7: Angriffsregistrierung Ein</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Angreifer konnte sich remote bei einem System anmelden. Danach erstellte er eine ausführbare Datei mit unserem Beispiel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese ausführbare Datei wurde vor dem Start von einer Antivirenlösung blockiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/gj/gq/ezgjgq4iagc2lep3pebhom5cox0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 8: Blockieren der Probe </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/tg/zv/-k/tgzv-keet96r81465eywpeahn8a.jpeg"><br>
<img src="https://habrastorage.org/webt/c_/0j/wz/c_0jwzu0madpx1t-pmfdznt-xny.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 9: Beispielsperre</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wenn eine schädliche Datei blockiert wurde, versuchte der Angreifer, eine verschlüsselte Version der ausführbaren Datei herunterzuladen, die ebenfalls blockiert wurde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/f8/mh/zaf8mhwwbu4rr9u_elmazc9cmns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 10: Eine Reihe von Beispielen, die ein Angreifer ausführen wollte.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Schließlich versuchte er, eine andere schädliche Datei über eine verschlüsselte Konsole herunterzuladen</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell, um den Virenschutz zu umgehen. </font><font style="vertical-align: inherit;">Er wurde aber auch blockiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/4b/mj/lw4bmjqpqtkf1zrqhhe0zb-4rzm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">11: PowerShell mit dem blockierten schädlichen Inhalt </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/eu/dj/he/eudjheox40zpaop3cphprkuc-5c.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. </font><font style="vertical-align: inherit;">12: PowerShell mit blockierten schädlichen Inhalten</font></font><br>
 </i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Bootloader</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es ausgeführt wird, schreibt es die ReadMe-Datei in den </font><font style="vertical-align: inherit;">für Ryuk typischen </font><font style="vertical-align: inherit;">Ordner </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% temp%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Diese Datei - eine Lösegeldforderung mit einer Protonmail-Domain für die E-Mail-Adresse, die in dieser Malware-Familie häufig vorkommt: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msifelabem1981@protonmail.com </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/zm/qtpgzmcdohk4siulk9nuayvwhqm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/wa/u9/bkwau9on8kixa8bsmiikectemqu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 13: Einlösungsanforderung</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Während der Ausführung des Bootloaders können Sie sehen, dass mehrere ausführbare Dateien mit zufälligen Namen gestartet werden. Sie werden in einem versteckten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ordner gespeichert. </font><font style="vertical-align: inherit;">Wenn die Option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Versteckte Dateien und Ordner anzeigen“</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Betriebssystem nicht aktiv ist </font><font style="vertical-align: inherit;">, bleiben sie ausgeblendet. Darüber hinaus sind diese Dateien 64-Bit im Gegensatz zur übergeordneten Datei, die 32-Bit ist.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/ko/z3/8bkoz3_hgnilr-2i7sytnv5g2ik.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/fe/fb/z-/fefbz-5_yiuoiftotqmnei2hrvq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 14: Vom Beispiel gestartete ausführbare Dateien</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wie Sie in der obigen Abbildung sehen können, startet Ryuk icacls.exe, mit der alle ACLs (Access Control List) geändert werden, um den Zugriff zu gewährleisten und Flags zu ändern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es erhält unter allen Benutzern vollen Zugriff auf alle Dateien auf dem Gerät (/ T), unabhängig von Fehlern (/ C) und ohne Meldungen (/ Q). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/bt/nc/mfbtnclxe4usjepbuizjzknslmu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 15: Ausführungsoptionen für icacls.exe, die vom Beispiel gestartet wurden.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es ist wichtig zu beachten, dass Ryuk überprüft, welche Windows-Version ausgeführt wird. Zu diesem </font><b><font style="vertical-align: inherit;">Zweck</font></b><font style="vertical-align: inherit;"> wird </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
die Version mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetVersionExW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> überprüft, wobei der Wert des </font><b><font style="vertical-align: inherit;">Flags lpVersionInformation</font></b><font style="vertical-align: inherit;"> überprüft wird</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeigt an, ob die aktuelle Version von Windows später als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/iv/yv/lcivyvqvjmm8jximv35wbo_v8ps.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/g8/t_/da/g8t_dabeoemyz2v0u93a8ivfilk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je nachdem, ob Sie eine spätere Version als Windows XP ausführen, schreibt der Bootloader in den lokalen Benutzerordner - in diesem Fall in den Ordner </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Public%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/gr/at/gggrateobojjggmubdykjordzy4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 17: Überprüfen der Betriebssystemversion Die</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
aufgezeichnete Datei ist Ryuk. Dann startet es es und übergibt seine eigene Adresse als Parameter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/0f/ct/hh0fctenv0yqswmtw9rhmhjjwv0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 18: Ausführen von Ryuk über ShellExecute</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Als erstes ruft Ryuk die Eingabeparameter ab. Dieses Mal gibt es zwei Eingabeparameter (die ausführbare Datei selbst und die Dropper-Adresse), mit denen ihre eigenen Spuren entfernt werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/wu/vo/1rwuvoxtlg3lmusyoiem1v-e3da.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/op/wf/f7/opwff7lstsb0iq-nbvfqipywy6y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 19: Erstellen eines Prozesses</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können auch sehen, dass er sich selbst löscht, sobald er seine ausführbaren Dateien gestartet hat, und somit keine Spur seiner Anwesenheit in dem Ordner hinterlässt, in dem er ausgeführt wurde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/ui/af/tpuiafv8uy2rmzsuememmnkaxxa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">20: Löschen von Dateien</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. RYUK</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Präsenz</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ryuk versucht wie andere Malware, so lange wie möglich auf dem System zu bleiben. Wie oben gezeigt, besteht eine Möglichkeit, dieses Ziel zu erreichen, darin, ausführbare Dateien heimlich zu erstellen und auszuführen. Zu diesem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweck wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> am häufigsten der Registrierungsschlüssel </font><b><font style="vertical-align: inherit;">CurrentVersion \ Run</font></b><font style="vertical-align: inherit;"> geändert </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall können Sie sehen, dass zu diesem Zweck die erste ausführbare Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VWjRF.exe</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(der Dateiname wird zufällig generiert) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> startet </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/8b/g2/sd8bg232guhntext0cy-exeh3be.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/og/fo/nnogfoscybmwjhn9xnwd0gw7118.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 21: Ausführen der Datei VWjRF.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anschließend wird ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Befehl </font><font style="vertical-align: inherit;">mit dem Namen " </font><b><font style="vertical-align: inherit;">svchos</font></b><font style="vertical-align: inherit;"> " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eingegeben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Wenn Sie also die Registrierungsschlüssel jederzeit überprüfen möchten, können Sie diese Änderung aufgrund der Ähnlichkeit dieses Namens mit svchost leicht nicht bemerken. Dank dieses Schlüssels stellt Ryuk sicher, dass er im System vorhanden ist. Wenn das System noch nicht infiziert ist Wenn Sie das System neu starten, versucht die ausführbare Datei es erneut. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/my/42/tamy42jg8mihxlgmxgzfjzqvfui.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 22: Das Beispiel stellt sicher, dass der Registrierungsschlüssel vorhanden ist.</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir können auch sehen, dass diese ausführbare Datei die beiden Dienste stoppt: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audioendpointbuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", der, wie der Name schon sagt, mit dem System übereinstimmt Audio, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/28/g8/h-28g8z69elv6rzdsjo2xuvrok4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 23: Beispiel stoppt den System-Audio-</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Samss-Dienst</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist ein Kontoverwaltungsdienst. Das Stoppen dieser beiden Dienste ist ein Merkmal von Ryuk. In diesem Fall versucht der Verschlüsseler, wenn das System mit dem SIEM-System verbunden ist, das Senden </font><font style="vertical-align: inherit;">von Warnungen </font><font style="vertical-align: inherit;">an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">beenden</font></a><font style="vertical-align: inherit;"> . Somit verteidigt er seine nächsten Schritte, da einige SAM-Dienste ihre Arbeit nach der Ausführung von Ryuk nicht korrekt starten können. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/fn/l1/wjfnl14it7llrkny9xpfvrs30di.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 24: Das Beispiel stoppt den Samss-Dienst. </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Berechtigungen</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Im Allgemeinen beginnt Ryuk mit einer horizontalen Bewegung innerhalb des Netzwerks oder wird von einem anderen Schadprogramm wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emotet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trickbot gestartet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das im Falle einer Eskalation von Berechtigungen diese erhöhten Rechte an den Verschlüsseler überträgt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Auftakt zum Implementierungsprozess sehen wir im Voraus, dass der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImpersonateSelf-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prozess </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgeführt wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">Dies</font></b><font style="vertical-align: inherit;"> bedeutet, dass der Sicherheitsinhalt des Zugriffstokens in den Stream übertragen wird, wo er sofort mit </font><b><font style="vertical-align: inherit;">GetCurrentThread empfangen wird</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/nm/ut/9ynmutmaqq2wovbdswheiipajcc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 25: ImpersonateSelf aufrufen</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dann sehen wir, dass das Zugriffstoken dem Stream zugeordnet wird. Wir sehen auch, dass eines der Flags </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DesiredAccess ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit dem der Zugriff des Streams gesteuert werden kann. In diesem Fall muss der Wert, den edx erhält, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_ALL_ACESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_WRITE sein</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/vc/a_/uivca_yeyyvr5m-hwyolmei6k3u.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tm/gy/yg/tmgyygvshjspnungxwqitl_jqm0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 26: Erstellen eines Stream-Tokens</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dann wird es verwendet</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivilege</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ruft auf, um Debug-Debugging-Rechte für den Stream zu erhalten. Durch Angabe von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROCESS_ALL_ACCESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann auf jeden erforderlichen Prozess </font><b><font style="vertical-align: inherit;">zugegriffen</font></b><font style="vertical-align: inherit;"> werden. Da der Verschlüsseler bereits über einen vorbereiteten Stream verfügt, bleibt nur noch die letzte Stufe zu erreichen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/lf/ki/0mlfkifvdv7hk7rizfyus_7oco4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 27: Aufrufen von SeDebugPrivilege und die Funktion des Eskalierens von Rechten</font></font><br>
 </i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Einerseits verfügen wir über LookupPrivilegeValueW, das uns die erforderlichen Informationen zu den Berechtigungen liefert, die wir erhöhen möchten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/wd/db/tswddbwi0jyghyqjpniu6rphmpe.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 28: Informationen über Berechtigungen für deren Eskalation anfordern</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auf der anderen Seite verfügen wir über </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdjustTokenPrivileges</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit denen wir die erforderlichen Rechte für unseren Stream erhalten können. In diesem Fall ist </font><b><font style="vertical-align: inherit;">NewState</font></b><font style="vertical-align: inherit;"> das wichtigste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deren Flag Berechtigungen gewährt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/sx/pa/kisxpam9ymp6ivk8remgfwfx4aq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/9m/0s/sa/9m0ssakqkkjd4wzm4wqfav-mn7g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 29: Festlegen von Rechten für das Token </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Bereitstellung</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In diesem Abschnitt wird gezeigt, wie das Beispiel den zuvor in diesem Bericht erwähnten Bereitstellungsprozess ausführt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Hauptziel des Implementierungsprozesses sowie der Eskalation besteht darin, Zugriff auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schattenkopien zu erhalten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dazu muss er mit dem Stream arbeiten, dessen Rechte höher sind als die des lokalen Benutzers. Sobald er solche höheren Rechte erhält, löscht er die Kopien und nimmt Änderungen an anderen Prozessen vor, um die Rückkehr zu einem früheren Wiederherstellungspunkt im Betriebssystem zu verhindern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bei dieser Art von Malware üblich, wird </font><b><font style="vertical-align: inherit;">CreateToolHelp32Snapshot verwendet</font></b><font style="vertical-align: inherit;"> , um die Implementierung abzuschließen</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Momentaufnahme der aktuell ausgeführten Prozesse erstellt und versucht, mit </font><b><font style="vertical-align: inherit;">OpenProcess</font></b><font style="vertical-align: inherit;"> auf diese Prozesse </font><b><font style="vertical-align: inherit;">zuzugreifen</font></b><font style="vertical-align: inherit;"> . Sobald er Zugriff auf den Prozess erhält, öffnet er auch ein Token mit seinen Informationen, um Prozessparameter abzurufen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/do/xz/dcdoxzczq1ti1kf5fu_5y_rikc8.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Abbildung </font><i><font style="vertical-align: inherit;">30: Empfangen von Prozessen von einem Computer</font></i><font style="vertical-align: inherit;"> Mit CreateToolhelp32Snapshot können wir dynamisch sehen, wie eine Liste der ausgeführten Prozesse in der Routine 140002D9C empfangen wird. Nachdem er sie erhalten hat, geht er die Liste durch und versucht, Prozesse nacheinander mit OpenProcess zu öffnen, bis er dies tun kann. In diesem Fall war der erste Prozess, den er öffnen konnte, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"taskhost.exe"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/24/og/k024ogcd6ioxwnjbfuhjuefrce4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 31: Dynamische Ausführung einer Prozedur, um einen Prozess zu erhalten</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können sehen, dass er anschließend das Token des Prozesses liest, also </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcessToken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20008</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/zl/kn/8jzlkngsiwxlyol93ozqx8ebjrm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 32: Lesen von Prozess-Token-Informationen</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es wird auch überprüft, ob der Prozess, in den es eingebettet wird, nicht </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe, lsaas.exe ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder über eine Reihe von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Berechtigungen verfügt </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/xr/9k/hrxr9kefgjfbtsex5awxtlqmjcm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 33: Ausgeschlossene Prozesse.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir können dynamisch sehen, wie zuerst anhand der Prozesstokeninformationen in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">140002D9C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> überprüft wird </font><font style="vertical-align: inherit;">, ob das Konto, dessen Rechte zur Ausführung des Prozesses verwendet werden, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konto ist </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/_v/-c/4v_v-cloz4ndee9gs0qbihghn9k.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 34: Überprüfen der NT-AUTORITÄT</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Später wird außerhalb der Prozedur überprüft, ob es sich nicht um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe, explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsaas.exe handelt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/uy/gg/wauyggzhisvonm1cyqr3cahfdc0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 35: Überprüfen der NT-BEHÖRDE</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem er eine Momentaufnahme der Prozesse erstellt, die Prozesse geöffnet und überprüft hat, dass keiner von ihnen ausgeschlossen ist, ist er bereit, die Prozesse aufzuschreiben, die im Speicher implementiert werden sollen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu reserviert er zunächst eine Region im Speicher ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), schreibt in diese ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteProcessmemory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und erstellt einen Stream ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Um mit diesen Funktionen zu arbeiten, verwendet er die PIDs der ausgewählten Prozesse, die er zuvor mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateToolhelp32Snapshot erhalten hat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s7/zp/pl/s7zpplpua6q4w1mgpurwvgtzyxy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 36: Code einbetten</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hier können wir dynamisch beobachten, wie die Prozess-PID zum Aufrufen der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion verwendet wird </font><b><font style="vertical-align: inherit;">. </font></b></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/k1/j-/7nk1j-saztq--oxfo2xwzyiowgk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 37: Aufrufen der VirtualAllocEx </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4-Verschlüsselung</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In diesem Abschnitt wird ein Teil dieses Beispiels im Zusammenhang mit der Verschlüsselung beschrieben. In der folgenden Abbildung sehen Sie zwei Routinen mit den Namen " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary_EncodeString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " und " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encode_Func</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", die für die Durchführung des Verschlüsselungsvorgangs verantwortlich sind. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/iu/1r/o5iu1rimo3qfnbgpnl4mvwcpwug.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 38: Verschlüsselungsverfahren</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zuerst können wir sehen, wie eine Zeichenfolge geladen wird, die später verwendet wird, um alles zu entschlüsseln, was benötigt wird: Importe, DLLs, Befehle, Dateien und CSPs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/x6/te/dux6tehj_i7jcqkupvfdb3hlcfw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 39: Deobfuscationskette</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Abbildung zeigt den ersten Import, den es im R4-Register </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary deobfusciert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies wird später verwendet, um die erforderlichen DLLs zu laden. Wir können auch eine andere Zeile in Register R12 sehen, die zusammen mit der vorherigen Zeile zur Durchführung der Deobfuscation verwendet wird. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/oo/to/laootohjrpgt3fa-yeetqz6rxzo.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 40: Dynamische Deobfuscation.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Er </font><i><font style="vertical-align: inherit;">lädt</font></i><font style="vertical-align: inherit;"> weiterhin Befehle, die er später ausführen wird, um Sicherungen, Wiederherstellungspunkte und sichere </font><i><font style="vertical-align: inherit;">Startmodi</font></i><font style="vertical-align: inherit;"> zu deaktivieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/qt/le/ceqtleaezfngmfgtrlhpgxl-vbw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 41: Herunterladen von Befehlen</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anschließend wird der Speicherort </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geladen, an dem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 Dateien abgelegt werden: </font><b><font style="vertical-align: inherit;">Windows.bat, run.sct</font></b><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.bat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/wj/9f/efwj9fcrtd5vai-3jjp6kblwsu0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/jx/sg/sa/jxsgsaqyu0omqswv0-eseu5aeok.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yq/g4/ur/yqg4urwb1wqlo52wgoocuccbi00.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/i2/fc/2t/i2fc2t2mcj6qrwau7gikqb4ohf4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 42: Dateispeicherorte</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese 3 Dateien werden verwendet, um die Berechtigungen zu überprüfen, über die jeder Speicherort verfügt. Wenn die erforderlichen Berechtigungen nicht verfügbar sind, stoppt Ryuk die Ausführung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es werden weiterhin Zeilen geladen, die drei Dateien entsprechen. Die erste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datei</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">DECRYPT_INFORMATION.html</font></b><font style="vertical-align: inherit;"> , enthält die Informationen, die zum Wiederherstellen von Dateien erforderlich sind. Der zweite, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , enthält den öffentlichen RSA-Schlüssel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/w1/do/vfw1doq6ayau0i8pkniuc-rd5mk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 43: String DECRYPT INFORMATION.html</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Drittens </font><font style="vertical-align: inherit;">enthält </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE_ID_DO_NOT_REMOVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den verschlüsselten Schlüssel, der in der nächsten Routine zur Durchführung der Verschlüsselung verwendet wird. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u_/1l/s1/u_1ls1stszk23gkrsh2mwonnvgi.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 44: EINZIGARTIGE ID NICHT ENTFERNEN Zeichenfolge</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Schließlich werden die erforderlichen Bibliotheken zusammen mit den erforderlichen Importen und CSP ( </font><b><font style="vertical-align: inherit;">Microsoft Enhanced RSA) </font></b><i><font style="vertical-align: inherit;">geladen</font></i></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AES Cryptographic Provider</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/b9/q1/7db9q1wjr1k_y1bfsefiewsc-6g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 45: Herunterladen von Bibliotheken</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem die gesamte Deobfuscation abgeschlossen ist, werden die für die Verschlüsselung erforderlichen Aktionen ausgeführt: Über alle logischen Laufwerke iterieren, die in der vorherigen Unterroutine geladenen Aktionen ausführen, die Präsenz im System verstärken, die RyukReadMe.html-Datei löschen, verschlüsseln, iterieren alle Netzlaufwerke, die auf erkannte Geräte umschalten und deren Verschlüsselung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles beginnt mit dem Herunterladen von " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " und dem Schreiben des öffentlichen RSA-Schlüssels. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_n/me/r-/_nmer-jvdpleozaujmoemqo7u9s.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 46: Vorbereiten der Verschlüsselung</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anschließend werden alle logischen Laufwerke mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetLogicalDrives</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> abgerufen </font><font style="vertical-align: inherit;">und alle Sicherungen, Wiederherstellungspunkte und sicheren </font><b><font style="vertical-align: inherit;">Startmodi</font></b><font style="vertical-align: inherit;"> deaktiviert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/ov/f8/faovf8myihdrkrtulhzcu_50e8q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 47: Deaktivieren von Wiederherstellungstools</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Danach verstärkt er seine Präsenz im System, wie wir oben gesehen haben, und schreibt die erste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RyukReadMe.html-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/7u/at/x87uatt-xtzmrn0un3-jqt5o0hw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Abbildung </font><i><font style="vertical-align: inherit;">48: Veröffentlichen einer Rückkaufbenachrichtigung</font></i><font style="vertical-align: inherit;"> In der folgenden Abbildung sehen Sie, wie eine Datei erstellt, der Inhalt heruntergeladen und geschrieben wird: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/5o/2n/vu5o2nliyrqgsmugbe9jpx0-1mc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung. Abbildung 49: Herunterladen und Aufzeichnen des Inhalts einer Datei.</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um auf allen Geräten dieselben Aktionen ausführen zu können, wird </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " verwendet, wie oben gezeigt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6a/qb/bd6aqbnkrrba-polrck91kh53w0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 50: Verwenden von icalcls.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schließlich werden Dateien mit Ausnahme der Dateien "* .exe", "* .dll", Systemdateien und anderer Speicherorte verschlüsselt, die als verschlüsselte weiße Liste angegeben sind. </font><font style="vertical-align: inherit;">Hierzu werden Importe verwendet: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptAcquireContextW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (wobei die Verwendung von AES und RSA angegeben ist), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDeriveKey, CryptGenKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDestroyKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usw. </font><font style="vertical-align: inherit;">Es wird auch versucht, die Wirkung auf erkannte Netzwerkgeräte mithilfe von WNetEnumResourceW zu erweitern und diese dann zu verschlüsseln. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/yn/mj/9jynmjtzu26dwvfg3ugrthcxo0o.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">51: Systemdateiverschlüsselung</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Importe und verwandte Flags</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der folgenden Tabelle sind die wichtigsten Importe und Flags aufgeführt, die von der Stichprobe verwendet werden:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/bn/he/ribnhe9istspdndifpecxgnzljc.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. IOC</font></font></h4><br>
<img src="https://habrastorage.org/webt/bf/gu/cr/bfgucrrkqw-l2jurn09ovgljhas.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verweise</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users \ Public \ run.sct</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Startmenü \ Programme \ Startup \ start.bat AppData \ Roaming \ Microsoft \ Windows \ Start</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menü \ ProgrammeStartup \ start.bat</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/ld/od/e2/ldode2_iiqa4jqw4ol46ch5dov4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Technischer Bericht der Ryuk Ransomware, zusammengestellt von PandaLabs-Experten für Antivirenlabors.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Referenzen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. "Everis y Prisa Radio leidet unter schwerwiegenden ciberataque que secuestra sus sistemas." Https: // www. elconfidencial.com/tecnologia/2019-11-04/ everis-la-ser-ciberataque-ransomware-15_2312019 /, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. „Un virus de origen ruso ataca a importantes empresas españolas.“ Https: //elpais.com/ tecnologia / 2019/11/04 / actualidad / 1572897654_ 251312.html, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. „VB2019-Papier: Shinigamis Rache: der lange Schwanz der Ryuk-Malware.“ Https://securelist.com/ Geschichte-des-Jahres-2019-Städte-unter-Ransomware-Belagerung / 95456 /, Publicada el 11 / </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12/2019 4. „Großwildjagd mit Ryuk: Eine weitere lukrative Ransomware.“ Https: // www. Crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/, Publicada el 01/10/2019.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. "VB2019-Papier: Shinigamis Rache: der lange Schwanz der Ryuk-Malware." Https: // www. </font><font style="vertical-align: inherit;">virusbulletin.com/virusbulletin/2019/10/ vb2019-paper-shinigamis-rache-long-tail-r</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de497680/index.html">Ihr Telegramm scheint zu fließen</a></li>
<li><a href="../de497682/index.html">Pavel Klemenkov, NVIDIA: Wir versuchen, die Kluft zwischen dem, was ein Datenwissenschaftler tun kann und dem, was er tun muss, zu verringern.</a></li>
<li><a href="../de497684/index.html">Hype-Kurve: Welche IT-Technologien sind auf dem Höhepunkt und welche Nachfrage bleibt stabil?</a></li>
<li><a href="../de497686/index.html">Bakterienabtötendes Implantatmaterial</a></li>
<li><a href="../de497688/index.html">Wie die Kubernetes Abendschule funktioniert</a></li>
<li><a href="../de497700/index.html">Wöchentliche Online-Mitaps zu Backing und DevOps, Sicherheit und Robotern ab dem 17. April</a></li>
<li><a href="../de497702/index.html">Fünf Trends in der Datenspeicherung, auf die Sie 2020 achten sollten</a></li>
<li><a href="../de497708/index.html">Wir laden Sie zu einer Reihe von Fujitsu-Webinaren im April und Mai ein</a></li>
<li><a href="../de497714/index.html">So schützen Sie Prozesse und Kernel-Erweiterungen unter macOS</a></li>
<li><a href="../de497724/index.html">Vorbereiten eines Servers für die Veröffentlichung einer Web-App in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>