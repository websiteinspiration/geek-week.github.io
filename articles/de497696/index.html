<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéª ü§öüèª üçå Wie funktioniert Ryuk Ransomware, die Unternehmen angreift? üö¥üèæ üë®üèø‚Äçü§ù‚Äçüë®üèº üÖæÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ryuk ist eine der bekanntesten Ransomware-Optionen der letzten Jahre. Seit seinem ersten Erscheinen im Sommer 2018 hat er eine beeindruckende Liste vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie funktioniert Ryuk Ransomware, die Unternehmen angreift?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497696/"><img src="https://habrastorage.org/webt/wc/6r/b3/wc6rb3xxu-e_aw_mg1pxcy_23yq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryuk ist eine der bekanntesten Ransomware-Optionen der letzten Jahre. </font><font style="vertical-align: inherit;">Seit seinem ersten Erscheinen im Sommer 2018 hat er </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine beeindruckende Liste von Opfern zusammengestellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , insbesondere im Gesch√§ftsumfeld, das das Hauptziel seiner Angriffe ist.</font></font><a name="habracut"></a><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Allgemeine Information</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieses Dokument enth√§lt eine Analyse der Ryuk-Ransomware-Option sowie des Bootloaders, der f√ºr das Herunterladen der Malware auf das System verantwortlich ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ryuk Ransomware erschien erstmals im Sommer 2018. Einer der Unterschiede zwischen Ryuk und anderer Ransomware besteht darin, dass Unternehmensumgebungen angegriffen werden sollen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mitte 2019 griffen Cyber-Kriminalit√§tsgruppen mit Hilfe dieses Kryptors eine gro√üe Anzahl spanischer Unternehmen an. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x5/ax/et/x5axetxacru5kb7h6er1vagmdqy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/oc/kn/ee/ockneevf4elmwczdwsmimtsvnuk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung </font></font><br>
</i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">1: Auszug aus El Confidencial zum Ryuk-Ransomware-Angriff [1] </font></i><i><font style="vertical-align: inherit;">2: Auszug aus El Pa√≠s √ºber einen Angriff von Ryuk Ransomware [2] In</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
diesem Jahr griff Ryuk eine gro√üe Anzahl von Unternehmen in verschiedenen L√§ndern an. Wie Sie in den folgenden Zahlen sehen k√∂nnen, haben Deutschland, China, Algerien und Indien am meisten gelitten.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn man die Anzahl der Cyber-Angriffe vergleicht, kann man sehen, dass Millionen von Benutzern von Ryuk betroffen waren und die riesige Datenmenge kompromittiert wurde, was zu ernsthaften wirtschaftlichen Sch√§den f√ºhrte. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/4u/y-/-p4uy-fnectlv0mqwtvupfa--vc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 3: Illustration von Ryuks globaler Aktivit√§t. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/sq/oe/hm/sqoehmto6enrwgz6kjt4_sdpgz0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 4: 16 am st√§rksten betroffenen L√§ndern von Ryuk </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/qj/1_/d2/qj1_d2eze5bigcd0gqvvrwiw9ns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 5: Anzahl der von Ryuk-Ransomware angegriffenen Benutzer (in Millionen)</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nach dem √ºblichen Funktionsprinzip solcher Bedrohungen zeigt diese Ransomware dem Opfer nach Abschluss der Verschl√ºsselung eine L√∂segeldbenachrichtigung an, die in Bitcoins an die angegebene Adresse gezahlt werden muss, um den Zugriff auf verschl√ºsselte Dateien wiederherzustellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Malware hat sich seit ihrem ersten Auftreten ge√§ndert.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine in diesem Dokument analysierte Variante dieser Bedrohung wurde bei einem Versuch entdeckt, im Januar 2020 einen Angriff zu starten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aufgrund ihrer Komplexit√§t wird diese Malware h√§ufig organisierten Cyberkriminellen zugeschrieben, die auch als APT-Gruppen bezeichnet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Teil des Ryuk-Codes hat eine bemerkenswerte √Ñhnlichkeit mit dem Code und der Struktur eines anderen bekannten Hermes-Kryptographen, mit dem sie eine Reihe identischer Funktionen haben. Aus diesem Grund war Ryuk urspr√ºnglich mit der nordkoreanischen Gruppe Lazarus verbunden, die zu dieser Zeit im Verdacht stand, hinter der Hermes-Ransomware zu stehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschlie√üend stellte Falcon X von CrowdStrike fest, dass Ryuk tats√§chlich von WIZARD SPIDER erstellt wurde [4].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt einige Beweise, die diese Annahme st√ºtzen. Erstens wurde diese Ransomware auf der Exploit.in-Website beworben, die ein bekannter russischer Malware-Markt ist und zuvor mit einigen russischen APT-Gruppen in Verbindung gebracht wurde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Tatsache schlie√üt die Theorie aus, dass Ryuk von der Lazarus APT-Gruppe entwickelt werden k√∂nnte Dies entspricht nicht der Art und Weise, wie sich die Gruppe verh√§lt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dar√ºber hinaus wurde Ryuk als Verschl√ºsseler angepriesen, der auf russischen, ukrainischen und belarussischen Systemen nicht funktioniert. Dieses Verhalten wird durch die in einigen Versionen von Ryuk gefundene Funktion bestimmt, bei der die Sprache des Systems √ºberpr√ºft wird, in dem dieser Verschl√ºsseler ausgef√ºhrt wird, und der Betrieb beendet wird, wenn das System Russisch, Ukrainisch oder Wei√ürussisch hat. Schlie√ülich wurden bei einer Expertenanalyse einer Maschine, die von der WIZARD SPIDER-Gruppe gehackt wurde, mehrere ‚ÄûArtefakte‚Äú entdeckt, die angeblich bei der Entwicklung von Ryuk als Variante des Hermes-Kryptors verwendet wurden </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Andererseits schlugen die Experten Gabriela Nicolao und Luciano Martins vor, dass der Kryptograf m√∂glicherweise vom CryptoTech APT-Team entwickelt wurde [5].</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies folgt aus der Tatsache, dass diese Gruppe einige Monate vor dem Erscheinen von Ryuk Informationen im Forum derselben Website ver√∂ffentlichte, auf der sie eine neue Version der Hermes-Ransomware entwickelt hatte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mehrere Forumbenutzer haben sich gefragt, ob CryptoTech Ryuk wirklich erstellt hat. </font><font style="vertical-align: inherit;">Danach verteidigte sich diese Gruppe und gab an, Beweise daf√ºr zu haben, dass sie 100% dieses Verschl√ºsselers entwickelt hatte.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Eigenschaften</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beginnen mit dem Bootloader, dessen Aufgabe es ist, das System zu identifizieren, in dem er sich befindet, damit Sie die ‚Äûrichtige‚Äú Version des Ryuk-Verschl√ºsselers ausf√ºhren k√∂nnen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Bootloader-Hash lautet wie folgt: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MD5 A73130B0E379A989CBA3D695A157A495 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SHA256 EF231EE1A2481B7E627921468E79BB4369CCFAEB19A575748DD2B664ABC4F469 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine der Funktionen dieses Bootloaders enth√§lt keine Daten. Die Ersteller dieser Malware haben keine Informationen darin aufgenommen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manchmal enthalten sie fehlerhafte Daten, um den Benutzer glauben zu lassen, dass er angeblich eine legitime Anwendung startet. </font><font style="vertical-align: inherit;">Wie wir sp√§ter sehen werden, halten es die Angreifer jedoch nicht f√ºr erforderlich, Metadaten zu verwenden, falls die Infektion keine Interaktion mit dem Benutzer beinhaltet (wie dies bei diesem Verschl√ºsseler der Fall ist). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/zx/yu/rjzxyuaec1nfxajxzwufks4hb0w.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">6:</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Beispiel- </font><i><font style="vertical-align: inherit;">Metadaten Das Beispiel</font></i><font style="vertical-align: inherit;"> wurde im 32-Bit-Format kompiliert, sodass es sowohl auf 32-Bit- als auch auf 64-Bit-Systemen ausgef√ºhrt werden kann.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Penetrationsvektor</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Beispiel, mit dem Ryuk heruntergeladen und gestartet wird, wurde √ºber eine Remoteverbindung in unser System eingegeben, und die Zugriffsparameter wurden dank eines vorl√§ufigen RDP-Angriffs ermittelt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/jd/bj/ptjdbj8ce7mgfuy8vowq8gogitm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 7: Angriffsregistrierung Ein</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Angreifer konnte sich remote bei einem System anmelden. Danach erstellte er eine ausf√ºhrbare Datei mit unserem Beispiel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese ausf√ºhrbare Datei wurde vor dem Start von einer Antivirenl√∂sung blockiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ez/gj/gq/ezgjgq4iagc2lep3pebhom5cox0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 8: Blockieren der Probe </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/tg/zv/-k/tgzv-keet96r81465eywpeahn8a.jpeg"><br>
<img src="https://habrastorage.org/webt/c_/0j/wz/c_0jwzu0madpx1t-pmfdznt-xny.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 9: Beispielsperre</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wenn eine sch√§dliche Datei blockiert wurde, versuchte der Angreifer, eine verschl√ºsselte Version der ausf√ºhrbaren Datei herunterzuladen, die ebenfalls blockiert wurde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/f8/mh/zaf8mhwwbu4rr9u_elmazc9cmns.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 10: Eine Reihe von Beispielen, die ein Angreifer ausf√ºhren wollte.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Schlie√ülich versuchte er, eine andere sch√§dliche Datei √ºber eine verschl√ºsselte Konsole herunterzuladen</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PowerShell, um den Virenschutz zu umgehen. </font><font style="vertical-align: inherit;">Er wurde aber auch blockiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lw/4b/mj/lw4bmjqpqtkf1zrqhhe0zb-4rzm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">11: PowerShell mit dem blockierten sch√§dlichen Inhalt </font></font><br>
</i><br>
<img src="https://habrastorage.org/webt/eu/dj/he/eudjheox40zpaop3cphprkuc-5c.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. </font><font style="vertical-align: inherit;">12: PowerShell mit blockierten sch√§dlichen Inhalten</font></font><br>
 </i><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Bootloader</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn es ausgef√ºhrt wird, schreibt es die ReadMe-Datei in den </font><font style="vertical-align: inherit;">f√ºr Ryuk typischen </font><font style="vertical-align: inherit;">Ordner </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% temp%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Diese Datei - eine L√∂segeldforderung mit einer Protonmail-Domain f√ºr die E-Mail-Adresse, die in dieser Malware-Familie h√§ufig vorkommt: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msifelabem1981@protonmail.com </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/qt/pg/zm/qtpgzmcdohk4siulk9nuayvwhqm.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/bk/wa/u9/bkwau9on8kixa8bsmiikectemqu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 13: Einl√∂sungsanforderung</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
W√§hrend der Ausf√ºhrung des Bootloaders k√∂nnen Sie sehen, dass mehrere ausf√ºhrbare Dateien mit zuf√§lligen Namen gestartet werden. Sie werden in einem versteckten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ordner gespeichert. </font><font style="vertical-align: inherit;">Wenn die Option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄûVersteckte Dateien und Ordner anzeigen‚Äú</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Betriebssystem nicht aktiv ist </font><font style="vertical-align: inherit;">, bleiben sie ausgeblendet. Dar√ºber hinaus sind diese Dateien 64-Bit im Gegensatz zur √ºbergeordneten Datei, die 32-Bit ist.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/ko/z3/8bkoz3_hgnilr-2i7sytnv5g2ik.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/fe/fb/z-/fefbz-5_yiuoiftotqmnei2hrvq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 14: Vom Beispiel gestartete ausf√ºhrbare Dateien</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wie Sie in der obigen Abbildung sehen k√∂nnen, startet Ryuk icacls.exe, mit der alle ACLs (Access Control List) ge√§ndert werden, um den Zugriff zu gew√§hrleisten und Flags zu √§ndern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es erh√§lt unter allen Benutzern vollen Zugriff auf alle Dateien auf dem Ger√§t (/ T), unabh√§ngig von Fehlern (/ C) und ohne Meldungen (/ Q). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mf/bt/nc/mfbtnclxe4usjepbuizjzknslmu.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 15: Ausf√ºhrungsoptionen f√ºr icacls.exe, die vom Beispiel gestartet wurden.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es ist wichtig zu beachten, dass Ryuk √ºberpr√ºft, welche Windows-Version ausgef√ºhrt wird. Zu diesem </font><b><font style="vertical-align: inherit;">Zweck</font></b><font style="vertical-align: inherit;"> wird </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
die Version mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetVersionExW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºberpr√ºft, wobei der Wert des </font><b><font style="vertical-align: inherit;">Flags lpVersionInformation</font></b><font style="vertical-align: inherit;"> √ºberpr√ºft wird</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeigt an, ob die aktuelle Version von Windows sp√§ter als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/iv/yv/lcivyvqvjmm8jximv35wbo_v8ps.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/g8/t_/da/g8t_dabeoemyz2v0u93a8ivfilk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je nachdem, ob Sie eine sp√§tere Version als Windows XP ausf√ºhren, schreibt der Bootloader in den lokalen Benutzerordner - in diesem Fall in den Ordner </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% Public%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gg/gr/at/gggrateobojjggmubdykjordzy4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 17: √úberpr√ºfen der Betriebssystemversion Die</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
aufgezeichnete Datei ist Ryuk. Dann startet es es und √ºbergibt seine eigene Adresse als Parameter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hh/0f/ct/hh0fctenv0yqswmtw9rhmhjjwv0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 18: Ausf√ºhren von Ryuk √ºber ShellExecute</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Als erstes ruft Ryuk die Eingabeparameter ab. Dieses Mal gibt es zwei Eingabeparameter (die ausf√ºhrbare Datei selbst und die Dropper-Adresse), mit denen ihre eigenen Spuren entfernt werden. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1r/wu/vo/1rwuvoxtlg3lmusyoiem1v-e3da.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/op/wf/f7/opwff7lstsb0iq-nbvfqipywy6y.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 19: Erstellen eines Prozesses</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen auch sehen, dass er sich selbst l√∂scht, sobald er seine ausf√ºhrbaren Dateien gestartet hat, und somit keine Spur seiner Anwesenheit in dem Ordner hinterl√§sst, in dem er ausgef√ºhrt wurde. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/ui/af/tpuiafv8uy2rmzsuememmnkaxxa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">20: L√∂schen von Dateien</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. RYUK</font></font></h4><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 Pr√§senz</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ryuk versucht wie andere Malware, so lange wie m√∂glich auf dem System zu bleiben. Wie oben gezeigt, besteht eine M√∂glichkeit, dieses Ziel zu erreichen, darin, ausf√ºhrbare Dateien heimlich zu erstellen und auszuf√ºhren. Zu diesem </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweck wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> am h√§ufigsten der Registrierungsschl√ºssel </font><b><font style="vertical-align: inherit;">CurrentVersion \ Run</font></b><font style="vertical-align: inherit;"> ge√§ndert </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall k√∂nnen Sie sehen, dass zu diesem Zweck die erste ausf√ºhrbare Datei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VWjRF.exe</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
(der Dateiname wird zuf√§llig generiert) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> startet </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/8b/g2/sd8bg232guhntext0cy-exeh3be.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/nn/og/fo/nnogfoscybmwjhn9xnwd0gw7118.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 21: Ausf√ºhren der Datei VWjRF.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anschlie√üend wird ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUN-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Befehl </font><font style="vertical-align: inherit;">mit dem Namen " </font><b><font style="vertical-align: inherit;">svchos</font></b><font style="vertical-align: inherit;"> " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eingegeben</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Wenn Sie also die Registrierungsschl√ºssel jederzeit √ºberpr√ºfen m√∂chten, k√∂nnen Sie diese √Ñnderung aufgrund der √Ñhnlichkeit dieses Namens mit svchost leicht nicht bemerken. Dank dieses Schl√ºssels stellt Ryuk sicher, dass er im System vorhanden ist. Wenn das System noch nicht infiziert ist Wenn Sie das System neu starten, versucht die ausf√ºhrbare Datei es erneut. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/my/42/tamy42jg8mihxlgmxgzfjzqvfui.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 22: Das Beispiel stellt sicher, dass der Registrierungsschl√ºssel vorhanden ist.</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir k√∂nnen auch sehen, dass diese ausf√ºhrbare Datei die beiden Dienste stoppt: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">audioendpointbuilder</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", der, wie der Name schon sagt, mit dem System √ºbereinstimmt Audio, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h-/28/g8/h-28g8z69elv6rzdsjo2xuvrok4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 23: Beispiel stoppt den System-Audio-</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Samss-Dienst</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist ein Kontoverwaltungsdienst. Das Stoppen dieser beiden Dienste ist ein Merkmal von Ryuk. In diesem Fall versucht der Verschl√ºsseler, wenn das System mit dem SIEM-System verbunden ist, das Senden </font><font style="vertical-align: inherit;">von Warnungen </font><font style="vertical-align: inherit;">an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIEM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">beenden</font></a><font style="vertical-align: inherit;"> . Somit verteidigt er seine n√§chsten Schritte, da einige SAM-Dienste ihre Arbeit nach der Ausf√ºhrung von Ryuk nicht korrekt starten k√∂nnen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/fn/l1/wjfnl14it7llrkny9xpfvrs30di.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 24: Das Beispiel stoppt den Samss-Dienst. </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2 </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Berechtigungen</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Im Allgemeinen beginnt Ryuk mit einer horizontalen Bewegung innerhalb des Netzwerks oder wird von einem anderen Schadprogramm wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emotet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trickbot gestartet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das im Falle einer Eskalation von Berechtigungen diese erh√∂hten Rechte an den Verschl√ºsseler √ºbertr√§gt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Auftakt zum Implementierungsprozess sehen wir im Voraus, dass der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImpersonateSelf-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prozess </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgef√ºhrt wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">Dies</font></b><font style="vertical-align: inherit;"> bedeutet, dass der Sicherheitsinhalt des Zugriffstokens in den Stream √ºbertragen wird, wo er sofort mit </font><b><font style="vertical-align: inherit;">GetCurrentThread empfangen wird</font></b><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/nm/ut/9ynmutmaqq2wovbdswheiipajcc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 25: ImpersonateSelf aufrufen</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dann sehen wir, dass das Zugriffstoken dem Stream zugeordnet wird. Wir sehen auch, dass eines der Flags </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DesiredAccess ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit dem der Zugriff des Streams gesteuert werden kann. In diesem Fall muss der Wert, den edx erh√§lt, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_ALL_ACESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOKEN_WRITE sein</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/vc/a_/uivca_yeyyvr5m-hwyolmei6k3u.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/tm/gy/yg/tmgyygvshjspnungxwqitl_jqm0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 26: Erstellen eines Stream-Tokens</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dann wird es verwendet</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivilege</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ruft auf, um Debug-Debugging-Rechte f√ºr den Stream zu erhalten. Durch Angabe von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PROCESS_ALL_ACCESS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann auf jeden erforderlichen Prozess </font><b><font style="vertical-align: inherit;">zugegriffen</font></b><font style="vertical-align: inherit;"> werden. Da der Verschl√ºsseler bereits √ºber einen vorbereiteten Stream verf√ºgt, bleibt nur noch die letzte Stufe zu erreichen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0m/lf/ki/0mlfkifvdv7hk7rizfyus_7oco4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 27: Aufrufen von SeDebugPrivilege und die Funktion des Eskalierens von Rechten</font></font><br>
 </i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Einerseits verf√ºgen wir √ºber LookupPrivilegeValueW, das uns die erforderlichen Informationen zu den Berechtigungen liefert, die wir erh√∂hen m√∂chten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/wd/db/tswddbwi0jyghyqjpniu6rphmpe.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 28: Informationen √ºber Berechtigungen f√ºr deren Eskalation anfordern</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auf der anderen Seite verf√ºgen wir √ºber </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdjustTokenPrivileges</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit denen wir die erforderlichen Rechte f√ºr unseren Stream erhalten k√∂nnen. In diesem Fall ist </font><b><font style="vertical-align: inherit;">NewState</font></b><font style="vertical-align: inherit;"> das wichtigste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deren Flag Berechtigungen gew√§hrt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ki/sx/pa/kisxpam9ymp6ivk8remgfwfx4aq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/9m/0s/sa/9m0ssakqkkjd4wzm4wqfav-mn7g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 29: Festlegen von Rechten f√ºr das Token </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3 Bereitstellung</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In diesem Abschnitt wird gezeigt, wie das Beispiel den zuvor in diesem Bericht erw√§hnten Bereitstellungsprozess ausf√ºhrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Hauptziel des Implementierungsprozesses sowie der Eskalation besteht darin, Zugriff auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schattenkopien zu erhalten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dazu muss er mit dem Stream arbeiten, dessen Rechte h√∂her sind als die des lokalen Benutzers. Sobald er solche h√∂heren Rechte erh√§lt, l√∂scht er die Kopien und nimmt √Ñnderungen an anderen Prozessen vor, um die R√ºckkehr zu einem fr√ºheren Wiederherstellungspunkt im Betriebssystem zu verhindern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bei dieser Art von Malware √ºblich, wird </font><b><font style="vertical-align: inherit;">CreateToolHelp32Snapshot verwendet</font></b><font style="vertical-align: inherit;"> , um die Implementierung abzuschlie√üen</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Momentaufnahme der aktuell ausgef√ºhrten Prozesse erstellt und versucht, mit </font><b><font style="vertical-align: inherit;">OpenProcess</font></b><font style="vertical-align: inherit;"> auf diese Prozesse </font><b><font style="vertical-align: inherit;">zuzugreifen</font></b><font style="vertical-align: inherit;"> . Sobald er Zugriff auf den Prozess erh√§lt, √∂ffnet er auch ein Token mit seinen Informationen, um Prozessparameter abzurufen. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dc/do/xz/dcdoxzczq1ti1kf5fu_5y_rikc8.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Abbildung </font><i><font style="vertical-align: inherit;">30: Empfangen von Prozessen von einem Computer</font></i><font style="vertical-align: inherit;"> Mit CreateToolhelp32Snapshot k√∂nnen wir dynamisch sehen, wie eine Liste der ausgef√ºhrten Prozesse in der Routine 140002D9C empfangen wird. Nachdem er sie erhalten hat, geht er die Liste durch und versucht, Prozesse nacheinander mit OpenProcess zu √∂ffnen, bis er dies tun kann. In diesem Fall war der erste Prozess, den er √∂ffnen konnte, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"taskhost.exe"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/24/og/k024ogcd6ioxwnjbfuhjuefrce4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 31: Dynamische Ausf√ºhrung einer Prozedur, um einen Prozess zu erhalten</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir k√∂nnen sehen, dass er anschlie√üend das Token des Prozesses liest, also </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcessToken</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20008</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8j/zl/kn/8jzlkngsiwxlyol93ozqx8ebjrm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 32: Lesen von Prozess-Token-Informationen</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Es wird auch √ºberpr√ºft, ob der Prozess, in den es eingebettet wird, nicht </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe, lsaas.exe ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder √ºber eine Reihe von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Berechtigungen verf√ºgt </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hr/xr/9k/hrxr9kefgjfbtsex5awxtlqmjcm.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 33: Ausgeschlossene Prozesse.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wir k√∂nnen dynamisch sehen, wie zuerst anhand der Prozesstokeninformationen in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">140002D9C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºberpr√ºft wird </font><font style="vertical-align: inherit;">, ob das Konto, dessen Rechte zur Ausf√ºhrung des Prozesses verwendet werden, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konto ist </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4v/_v/-c/4v_v-cloz4ndee9gs0qbihghn9k.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 34: √úberpr√ºfen der NT-AUTORIT√ÑT</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sp√§ter wird au√üerhalb der Prozedur √ºberpr√ºft, ob es sich nicht um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrss.exe, explorer.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsaas.exe handelt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wa/uy/gg/wauyggzhisvonm1cyqr3cahfdc0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 35: √úberpr√ºfen der NT-BEH√ñRDE</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem er eine Momentaufnahme der Prozesse erstellt, die Prozesse ge√∂ffnet und √ºberpr√ºft hat, dass keiner von ihnen ausgeschlossen ist, ist er bereit, die Prozesse aufzuschreiben, die im Speicher implementiert werden sollen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dazu reserviert er zun√§chst eine Region im Speicher ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), schreibt in diese ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriteProcessmemory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und erstellt einen Stream ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Um mit diesen Funktionen zu arbeiten, verwendet er die PIDs der ausgew√§hlten Prozesse, die er zuvor mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateToolhelp32Snapshot erhalten hat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s7/zp/pl/s7zpplpua6q4w1mgpurwvgtzyxy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 36: Code einbetten</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hier k√∂nnen wir dynamisch beobachten, wie die Prozess-PID zum Aufrufen der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktion verwendet wird </font><b><font style="vertical-align: inherit;">. </font></b></font><br>
<br>
<img src="https://habrastorage.org/webt/7n/k1/j-/7nk1j-saztq--oxfo2xwzyiowgk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. Abbildung 37: Aufrufen der VirtualAllocEx </font></font></i><br>
 <br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4-Verschl√ºsselung</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In diesem Abschnitt wird ein Teil dieses Beispiels im Zusammenhang mit der Verschl√ºsselung beschrieben. In der folgenden Abbildung sehen Sie zwei Routinen mit den Namen " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary_EncodeString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " und " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encode_Func</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", die f√ºr die Durchf√ºhrung des Verschl√ºsselungsvorgangs verantwortlich sind. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o5/iu/1r/o5iu1rimo3qfnbgpnl4mvwcpwug.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 38: Verschl√ºsselungsverfahren</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zuerst k√∂nnen wir sehen, wie eine Zeichenfolge geladen wird, die sp√§ter verwendet wird, um alles zu entschl√ºsseln, was ben√∂tigt wird: Importe, DLLs, Befehle, Dateien und CSPs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/x6/te/dux6tehj_i7jcqkupvfdb3hlcfw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 39: Deobfuscationskette</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die folgende Abbildung zeigt den ersten Import, den es im R4-Register </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary deobfusciert</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies wird sp√§ter verwendet, um die erforderlichen DLLs zu laden. Wir k√∂nnen auch eine andere Zeile in Register R12 sehen, die zusammen mit der vorherigen Zeile zur Durchf√ºhrung der Deobfuscation verwendet wird. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/oo/to/laootohjrpgt3fa-yeetqz6rxzo.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 40: Dynamische Deobfuscation.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Er </font><i><font style="vertical-align: inherit;">l√§dt</font></i><font style="vertical-align: inherit;"> weiterhin Befehle, die er sp√§ter ausf√ºhren wird, um Sicherungen, Wiederherstellungspunkte und sichere </font><i><font style="vertical-align: inherit;">Startmodi</font></i><font style="vertical-align: inherit;"> zu deaktivieren. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/qt/le/ceqtleaezfngmfgtrlhpgxl-vbw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 41: Herunterladen von Befehlen</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anschlie√üend wird der Speicherort </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geladen, an dem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 Dateien abgelegt werden: </font><b><font style="vertical-align: inherit;">Windows.bat, run.sct</font></b><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.bat</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/wj/9f/efwj9fcrtd5vai-3jjp6kblwsu0.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/jx/sg/sa/jxsgsaqyu0omqswv0-eseu5aeok.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/yq/g4/ur/yqg4urwb1wqlo52wgoocuccbi00.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/i2/fc/2t/i2fc2t2mcj6qrwau7gikqb4ohf4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 42: Dateispeicherorte</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese 3 Dateien werden verwendet, um die Berechtigungen zu √ºberpr√ºfen, √ºber die jeder Speicherort verf√ºgt. Wenn die erforderlichen Berechtigungen nicht verf√ºgbar sind, stoppt Ryuk die Ausf√ºhrung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es werden weiterhin Zeilen geladen, die drei Dateien entsprechen. Die erste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datei</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">DECRYPT_INFORMATION.html</font></b><font style="vertical-align: inherit;"> , enth√§lt die Informationen, die zum Wiederherstellen von Dateien erforderlich sind. Der zweite, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLIC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , enth√§lt den √∂ffentlichen RSA-Schl√ºssel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/w1/do/vfw1doq6ayau0i8pkniuc-rd5mk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 43: String DECRYPT INFORMATION.html</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Drittens </font><font style="vertical-align: inherit;">enth√§lt </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE_ID_DO_NOT_REMOVE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den verschl√ºsselten Schl√ºssel, der in der n√§chsten Routine zur Durchf√ºhrung der Verschl√ºsselung verwendet wird. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u_/1l/s1/u_1ls1stszk23gkrsh2mwonnvgi.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 44: EINZIGARTIGE ID NICHT ENTFERNEN Zeichenfolge</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Schlie√ülich werden die erforderlichen Bibliotheken zusammen mit den erforderlichen Importen und CSP ( </font><b><font style="vertical-align: inherit;">Microsoft Enhanced RSA) </font></b><i><font style="vertical-align: inherit;">geladen</font></i></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AES Cryptographic Provider</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7d/b9/q1/7db9q1wjr1k_y1bfsefiewsc-6g.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 45: Herunterladen von Bibliotheken</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nachdem die gesamte Deobfuscation abgeschlossen ist, werden die f√ºr die Verschl√ºsselung erforderlichen Aktionen ausgef√ºhrt: √úber alle logischen Laufwerke iterieren, die in der vorherigen Unterroutine geladenen Aktionen ausf√ºhren, die Pr√§senz im System verst√§rken, die RyukReadMe.html-Datei l√∂schen, verschl√ºsseln, iterieren alle Netzlaufwerke, die auf erkannte Ger√§te umschalten und deren Verschl√ºsselung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles beginnt mit dem Herunterladen von " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " und dem Schreiben des √∂ffentlichen RSA-Schl√ºssels. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_n/me/r-/_nmer-jvdpleozaujmoemqo7u9s.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 46: Vorbereiten der Verschl√ºsselung</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anschlie√üend werden alle logischen Laufwerke mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetLogicalDrives</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> abgerufen </font><font style="vertical-align: inherit;">und alle Sicherungen, Wiederherstellungspunkte und sicheren </font><b><font style="vertical-align: inherit;">Startmodi</font></b><font style="vertical-align: inherit;"> deaktiviert.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fa/ov/f8/faovf8myihdrkrtulhzcu_50e8q.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 47: Deaktivieren von Wiederherstellungstools</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Danach verst√§rkt er seine Pr√§senz im System, wie wir oben gesehen haben, und schreibt die erste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RyukReadMe.html-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><font style="vertical-align: inherit;">in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TEMP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/7u/at/x87uatt-xtzmrn0un3-jqt5o0hw.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Abbildung </font><i><font style="vertical-align: inherit;">48: Ver√∂ffentlichen einer R√ºckkaufbenachrichtigung</font></i><font style="vertical-align: inherit;"> In der folgenden Abbildung sehen Sie, wie eine Datei erstellt, der Inhalt heruntergeladen und geschrieben wird: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/5o/2n/vu5o2nliyrqgsmugbe9jpx0-1mc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung. Abbildung 49: Herunterladen und Aufzeichnen des Inhalts einer Datei.</font></font></i><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Um auf allen Ger√§ten dieselben Aktionen ausf√ºhren zu k√∂nnen, wird </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " verwendet, wie oben gezeigt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6a/qb/bd6aqbnkrrba-polrck91kh53w0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. 50: Verwenden von icalcls.exe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlie√ülich werden Dateien mit Ausnahme der Dateien "* .exe", "* .dll", Systemdateien und anderer Speicherorte verschl√ºsselt, die als verschl√ºsselte wei√üe Liste angegeben sind. </font><font style="vertical-align: inherit;">Hierzu werden Importe verwendet: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptAcquireContextW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (wobei die Verwendung von AES und RSA angegeben ist), </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDeriveKey, CryptGenKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CryptDestroyKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usw. </font><font style="vertical-align: inherit;">Es wird auch versucht, die Wirkung auf erkannte Netzwerkger√§te mithilfe von WNetEnumResourceW zu erweitern und diese dann zu verschl√ºsseln. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/yn/mj/9jynmjtzu26dwvfg3ugrthcxo0o.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feige. </font><font style="vertical-align: inherit;">51: Systemdateiverschl√ºsselung</font></font></i><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Importe und verwandte Flags</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der folgenden Tabelle sind die wichtigsten Importe und Flags aufgef√ºhrt, die von der Stichprobe verwendet werden:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/bn/he/ribnhe9istspdndifpecxgnzljc.jpeg"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. IOC</font></font></h4><br>
<img src="https://habrastorage.org/webt/bf/gu/cr/bfgucrrkqw-l2jurn09ovgljhas.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verweise</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users \ Public \ run.sct</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Startmen√º \ Programme \ Startup \ start.bat AppData \ Roaming \ Microsoft \ Windows \ Start</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Men√º \ ProgrammeStartup \ start.bat</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/ld/od/e2/ldode2_iiqa4jqw4ol46ch5dov4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Technischer Bericht der Ryuk Ransomware, zusammengestellt von PandaLabs-Experten f√ºr Antivirenlabors.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Referenzen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. "Everis y Prisa Radio leidet unter schwerwiegenden ciberataque que secuestra sus sistemas." Https: // www. elconfidencial.com/tecnologia/2019-11-04/ everis-la-ser-ciberataque-ransomware-15_2312019 /, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. ‚ÄûUn virus de origen ruso ataca a importantes empresas espa√±olas.‚Äú Https: //elpais.com/ tecnologia / 2019/11/04 / actualidad / 1572897654_ 251312.html, Publicada el 04/11/2019. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. ‚ÄûVB2019-Papier: Shinigamis Rache: der lange Schwanz der Ryuk-Malware.‚Äú Https://securelist.com/ Geschichte-des-Jahres-2019-St√§dte-unter-Ransomware-Belagerung / 95456 /, Publicada el 11 / </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12/2019 4. ‚ÄûGro√üwildjagd mit Ryuk: Eine weitere lukrative Ransomware.‚Äú Https: // www. Crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/, Publicada el 01/10/2019.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. "VB2019-Papier: Shinigamis Rache: der lange Schwanz der Ryuk-Malware." Https: // www. </font><font style="vertical-align: inherit;">virusbulletin.com/virusbulletin/2019/10/ vb2019-paper-shinigamis-rache-long-tail-r</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de497680/index.html">Ihr Telegramm scheint zu flie√üen</a></li>
<li><a href="../de497682/index.html">Pavel Klemenkov, NVIDIA: Wir versuchen, die Kluft zwischen dem, was ein Datenwissenschaftler tun kann und dem, was er tun muss, zu verringern.</a></li>
<li><a href="../de497684/index.html">Hype-Kurve: Welche IT-Technologien sind auf dem H√∂hepunkt und welche Nachfrage bleibt stabil?</a></li>
<li><a href="../de497686/index.html">Bakterienabt√∂tendes Implantatmaterial</a></li>
<li><a href="../de497688/index.html">Wie die Kubernetes Abendschule funktioniert</a></li>
<li><a href="../de497700/index.html">W√∂chentliche Online-Mitaps zu Backing und DevOps, Sicherheit und Robotern ab dem 17. April</a></li>
<li><a href="../de497702/index.html">F√ºnf Trends in der Datenspeicherung, auf die Sie 2020 achten sollten</a></li>
<li><a href="../de497708/index.html">Wir laden Sie zu einer Reihe von Fujitsu-Webinaren im April und Mai ein</a></li>
<li><a href="../de497714/index.html">So sch√ºtzen Sie Prozesse und Kernel-Erweiterungen unter macOS</a></li>
<li><a href="../de497724/index.html">Vorbereiten eines Servers f√ºr die Ver√∂ffentlichung einer Web-App in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>