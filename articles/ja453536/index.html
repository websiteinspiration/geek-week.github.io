<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔈 🚑 🤳🏿 試験の追跡：ExamCookie 🏑 ▶️ 😆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="私は、デンマーク政府がちょうどなかったことを学んだ、サスペンド我々が分析され、完全に回避デジタル試験のモニタープログラム、以前の記事で、おそらく完全にシャットダウン私たちはハッキング方法を知らせた後、一週間、このシステムを。デンマーク政府が試験の監視の考えを放棄したのは純粋に私たちのせいではないと思...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>試験の追跡：ExamCookie</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453536/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私は、デンマーク政府がちょうどなかったことを学んだ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サスペンド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々が分析され、完全に回避デジタル試験のモニタープログラム、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前の記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、おそらく</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全にシャットダウン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちはハッキング方法を知らせた後、一週間、このシステムを。</font><font style="vertical-align: inherit;">デンマーク政府が試験の監視の考えを放棄したのは純粋に私たちのせいではないと思いたくありませんが、私たちの仕事ははっきりと認識されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、別の学童追跡ツールがどのように機能するかについての技術的な詳細を概説します：ExamCookie。</font><font style="vertical-align: inherit;">システムのバイパスのみに関心がある場合は、適切なセクションまで下にスクロールします。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExamCookie</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、このツール</font><font style="vertical-align: inherit;">はGDPR違反の調査により</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニュースにヒットし</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました。</font><font style="vertical-align: inherit;">私たちは、試験中に前述の学校追跡システムの2番目に大きな競争相手である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExamCookieを調べることにしました</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、20以上のデンマークの学校で使用されている商用追跡システムです。</font><font style="vertical-align: inherit;">このサイトには、次の説明以外のドキュメントはありません。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExamCookieは、試験中の生徒のコンピュータアクティビティを監視して、ルールが守られていることを確認するシンプルなソフトウェアです。</font><font style="vertical-align: inherit;">このプログラムでは、学生が違法な支援を行うことを禁止しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ExamCookieは、ウィンドウのサイズを変更するときに、アクティブなURL、ネットワーク接続、プロセス、クリップボード、スクリーンショットなど、コンピューター上のすべてのアクティビティを保存します。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムは簡単に機能します。試験に参加することで、コンピューター上で実行し、活動を監視します。</font><font style="vertical-align: inherit;">試験が完了するとプログラムが終了し、コンピュータから削除できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
追跡を開始するには、さまざまな教育サイトで機能するUNIログインを使用するか、資格情報を手動で入力する必要があります。</font><font style="vertical-align: inherit;">このツールは使用しなかったため、手動入力を使用したケースはわかりません。</font><font style="vertical-align: inherit;">おそらくこれは、UNIログインを持っていない学生のために行われます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/791/152/8fa791152cd6b1442fb8ca7e738c6eeb.png"></div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイナリ情報</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムはExamCookieホームページからダウンロードできます。</font><font style="vertical-align: inherit;">これはx86 .NETアプリケーションです。</font><font style="vertical-align: inherit;">参考までに、分析されたバイナリMD5ハッシュには</font></font><code>63AFD8A8EC26C1DC368D8FF8710E337D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、2019年4月24日付</font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">EXAMCOOKIE A​​PS署名があります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前回の記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示したように</font><font style="vertical-align: inherit;">、読みやすいILコードとメタデータの組み合わせにより完全なソースコードが提供されるため、.NETバイナリの分析はリバースエンジニアリングとは言えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前の監視プログラムとは異なり、このツールの開発者はデバッグログから削除するだけでなく、難読化も行いました。</font><font style="vertical-align: inherit;">少なくとも彼らは試みた:-)</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">難読化（笑い涙）</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dnSpyでアプリケーションを開いたとき、エントリポイントの欠落にすぐに気付きました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Token: 0x0600003D RID: 61 RVA: 0x00047BB0 File Offset: 0x00045FB0</span><font></font>
[STAThread]<font></font>
[DebuggerHidden]<font></font>
[EditorBrowsable(EditorBrowsableState.Advanced)]<font></font>
[MethodImpl(MethodImplOptions.NoInlining | MethodImplOptions.NoOptimization)]<font></font>
<span class="hljs-function">internal <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(<span class="hljs-built_in">string</span>[] Args)</span>
</span>{<font></font>
    <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
奇妙なことに、通常、ある種のラッパーが想定されています。これは、メソッドの本体をモジュールのコンストラクターから変更し、実際のエントリーポイントまで実行します。見てみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// Token: 0x06000001 RID: 1 RVA: 0x00058048 File Offset: 0x00055048</span>
<span class="hljs-keyword">static</span> &lt;Module&gt;()<font></font>
{<font></font>
	&lt;Module&gt;.\u206B\u202B\u200B\u206F\u206C\u202D\u200D\u200E\u202D\u206B\u206F\u206F\u202C\u202A\u206B\u202E\u202A\u206C\u202A\u206C\u200B\u206A\u202D\u206C\u202C\u206C\u200F\u202C\u206C\u202C\u200C\u206A\u200C\u206C\u200B\u206B\u202B\u206E\u202C\u202B\u202E();<font></font>
	&lt;Module&gt;.\u206C\u200D\u200F\u200E\u200C\u200C\u200F\u200F\u206E\u206A\u206A\u200B\u202C\u206A\u206B\u200D\u206E\u200E\u202D\u206B\u202C\u206C\u202D\u206D\u200C\u200F\u206E\u200F\u206E\u206A\u202B\u206B\u200E\u206B\u202E\u206F\u206A\u202E\u202C\u202A\u202E();<font></font>
	&lt;Module&gt;.\u200B\u202D\u200F\u200F\u202A\u206D\u202C\u206B\u206E\u202A\u206F\u206C\u200D\u200C\u202D\u200F\u202B\u202C\u202B\u206D\u206D\u202D\u206E\u200D\u206D\u206A\u202A\u202C\u200C\u206F\u206B\u206E\u200D\u202E\u206F\u200C\u206B\u200E\u206D\u206A\u202E();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
涼しい。</font><font style="vertical-align: inherit;">それは2019年であり、人々はまだConfuser（Ex）を使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この解凍コードを即座に認識し、アセンブラヘッダーを確認しました。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[モジュール：ConfusedBy（ "Confuser.Core 1.1.0 + a36320377a"）]</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、前述のコンストラクターがメソッドの本体とリソースを復号化するため、コードは実際には難読化されると考えていました。</font><font style="vertical-align: inherit;">しかし、驚いたことに、難読化開発者は...メタデータの名前を変更しないことを決定しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/cd2/01c/2d2cd201c523c4ca0ce981bd41570f6e.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、リバースエンジニアリングの話題がすべてなくなります。</font><font style="vertical-align: inherit;">私たちが言ったように</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、以前の記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私は適切に保護された、高品質の監視ツールの現実的な問題に遭遇したい、の分析は、5分以上かかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれの場合も、confuser（ex）で保護されたバイナリの解凍は非常に簡単です。.NETバイナリダンパーまたは&lt;MODULE&gt; .ctorのretステートメントブレークポイントを使用して、自分でダンプします。</font><font style="vertical-align: inherit;">プロセスには30秒かかり</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">デバッグに対する保護が</font><i><font style="vertical-align: inherit;">まったく機能しない</font></i><font style="vertical-align: inherit;">ため、このパッカーは常に私のお気に入り</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MegaDumperを使用することにしました。これは手動でダンプするよりもわずかに高速です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e72/e7e/877/e72e7e87788c6e50303005e34a3a3add.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ExamCookieバイナリをダンプすると、次のメッセージが表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a32/7fe/b38/a327feb381752accdc31ff15e14b1ede.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、対応するプロセスにロードされたすべてのアセンブラーフラグメントを含むディレクトリが作成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この難読化を実装した人は誰でも、神に感謝します。少なくとも彼は次の行を暗号化しました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.SymbolicLink))<font></font>
{<font></font>
	Module1.DebugPrint(&lt;Module&gt;.smethod_5&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-number">1582642794u</span>), <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.Tiff))<font></font>
{<font></font>
	Module1.DebugPrint(&lt;Module&gt;.smethod_2&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-number">4207351461u</span>), <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.UnicodeText))<font></font>
{<font></font>
	Module1.DebugPrint(&lt;Module&gt;.smethod_5&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-number">3536903244u</span>), <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.WaveAudio))<font></font>
{<font></font>
	Module1.DebugPrint(&lt;Module&gt;.smethod_2&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-number">2091555364u</span>), <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、古き良き文字列暗号化Confuser（Ex）、. NETの世界で最高の疑似セキュリティです。</font><font style="vertical-align: inherit;">Confuser（Ex）が頻繁にハッキングされ、解読ツールが各メカニズムのインターネット上で利用できるので、.NETに関連するものには触れません。</font><font style="vertical-align: inherit;">バイナリダンプでCodeCrackerから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfuserExStringDecryptor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を実行します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52d/0f7/c63/52d0f7c6366fda44ab4264876f801f7b.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のスニペットを次のように変換します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.SymbolicLink))<font></font>
{<font></font>
	Module1.DebugPrint(<span class="hljs-string">"ContainsData.SymbolicLink"</span>, <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.Tiff))<font></font>
{<font></font>
	Module1.DebugPrint(<span class="hljs-string">"ContainsData.Tiff"</span>, <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.UnicodeText))<font></font>
{<font></font>
	Module1.DebugPrint(<span class="hljs-string">"ContainsData.UnicodeText"</span>, <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (System.Windows.Forms.Clipboard.ContainsData(DataFormats.WaveAudio))<font></font>
{<font></font>
	Module1.DebugPrint(<span class="hljs-string">"ContainsData.WaveAudio"</span>, <span class="hljs-keyword">new</span> object[<span class="hljs-number">0</span>]);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これですべてのアプリケーションが保護されました。1分もかからずに壊れます...開発していないため、ソースコードがないため、ここではツールを掲載しません。</font><font style="vertical-align: inherit;">しかし、仕事を繰り返したい人は誰でも</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tuts4Youで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを見つけることができます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">tuts4youアカウントがなくなったため、ミラーへのリンクを配置できません。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能性</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚いたことに、本当の「隠された機能」は見つかりませんでした。</font><font style="vertical-align: inherit;">ウェブサイトに示されているように、次の情報が定期的にサーバーに送信されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロセスリスト（5000ミリ秒ごと）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブなアプリケーション（1000ミリ秒ごと）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クリップボード（500ミリ秒ごと）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット（5000ミリ秒ごと）</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークアダプターのリスト（20,000ミリ秒ごと）</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションの残りの部分は非常に退屈なので、初期化手順全体をスキップして、情報の取得を担当する関数に直接移動することにしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アダプタ</font></font></h2><br><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">前の記事と</font></a></font><code>NetworkInterface.GetAllNetworkInterfaces()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同様に、</font><font style="vertical-align: inherit;">
ネットワークアダプターは.NET関数によって組み立てられます</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">NetworkInterface[] allNetworkInterfaces = NetworkInterface.GetAllNetworkInterfaces();<font></font>
foreach (NetworkInterface networkInterface in allNetworkInterfaces)<font></font>
{<font></font>
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
                <span class="hljs-comment">// ...</span>
                <span class="hljs-comment">// TEXT FORMATTING OMITTED</span>
                <span class="hljs-comment">// ...</span><font></font>
<font></font>
		dictionary.Add(networkInterface.Id, stringBuilder.ToString());<font></font>
		stringBuilder.Clear();<font></font>
	}<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
	{<font></font>
		AdapterThread.OnExceptionEventHandler onExceptionEvent = <span class="hljs-keyword">this</span>.OnExceptionEvent;
		<span class="hljs-keyword">if</span> (onExceptionEvent != null)<font></font>
		{<font></font>
			onExceptionEvent(ex);<font></font>
		}<font></font>
	}<font></font>
}<font></font>
result = dictionary;</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブなアプリケーション</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは面白くなってきています。</font><font style="vertical-align: inherit;">開いているすべてのウィンドウを登録する代わりに、ユーティリティはアクティブなアプリケーションのみを制御します。</font><font style="vertical-align: inherit;">実装は誇張されているため、美化された疑似コードを提示します。</font></font><br>
<br>
<pre><code class="cpp hljs">var whiteList = { 
    <span class="hljs-string">"devenv"</span>,
    <span class="hljs-string">"ExamCookie.WinClient"</span>,
    <span class="hljs-string">"ExamCookie.WinClient.vshost"</span>,
    <span class="hljs-string">"wermgr"</span>,
    <span class="hljs-string">"ShellExperienceHost"</span> };<font></font>
<font></font>
<span class="hljs-comment">// GET WINDOW INFORMATION</span><font></font>
var foregroundWindow = ApplicationThread.GetForegroundWindow();<font></font>
ApplicationThread.GetWindowRect(foregroundWindow, ref rect);<font></font>
ApplicationThread.GetWindowThreadProcessId(foregroundWindow, ref processId);<font></font>
var process = Process.GetProcessById(processId);<font></font>
<font></font>
<span class="hljs-keyword">if</span> (process == null)
    <span class="hljs-keyword">return</span>;<font></font>
<font></font>
<span class="hljs-comment">// LOG BROWSER URL</span>
<span class="hljs-keyword">if</span> (IsBrowser(process))<font></font>
{<font></font>
    var browserUrl = UiAutomation32.GetBrowserUrl(process.Id, process.ProcessName);<font></font>
<font></font>
    <span class="hljs-comment">// SEND BROWSER URL TO SERVER</span>
    <span class="hljs-keyword">if</span> (ValidBrowserUrl(browserUrl))<font></font>
    {<font></font>
        ReportToServer(browserUrl);<font></font>
    }<font></font>
<font></font>
}<font></font>
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!whiteList.contains(process.ProcessName, StringComparer.OrdinalIgnoreCase))<font></font>
{<font></font>
    ReportToServer(process.MainWindowTitle);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
素晴らしい...人々はまだそれらを区別するためにプロセス名を使用しています。</font><font style="vertical-align: inherit;">彼らは決して停止せず、決して考えません。「ちょっと待ってください。あなたは好きなようにプロセスの名前を変更できます」ので、この保護を安全にバイパスできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の試験追跡プログラムに関する以前の記事を読んだ場合、ブラウザーのこの標準以下の実装をおそらく認識するでしょう。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsBrowser</span><span class="hljs-params">(System.Diagnostics.Process proc)</span>
</span>{
	<span class="hljs-keyword">bool</span> result;
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
		<span class="hljs-built_in">string</span> left = proc.ProcessName.ToLower();
		<span class="hljs-keyword">if</span> (Operators.CompareString(left, <span class="hljs-string">"iexplore"</span>, <span class="hljs-literal">false</span>) != <span class="hljs-number">0</span> &amp;&amp; <font></font>
                    Operators.CompareString(left, <span class="hljs-string">"chrome"</span>, <span class="hljs-literal">false</span>) != <span class="hljs-number">0</span> &amp;&amp; <font></font>
                    Operators.CompareString(left, <span class="hljs-string">"firefox"</span>, <span class="hljs-literal">false</span>) != <span class="hljs-number">0</span> &amp;&amp;<font></font>
                    Operators.CompareString(left, <span class="hljs-string">"opera"</span>, <span class="hljs-literal">false</span>) != <span class="hljs-number">0</span> &amp;&amp; <font></font>
                    Operators.CompareString(left, <span class="hljs-string">"cliqz"</span>, <span class="hljs-literal">false</span>) != <span class="hljs-number">0</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (Operators.CompareString(left, <span class="hljs-string">"applicationframehost"</span>, <span class="hljs-literal">false</span>) != <span class="hljs-number">0</span>)<font></font>
			{<font></font>
				result = <span class="hljs-literal">false</span>;<font></font>
			}<font></font>
			<span class="hljs-keyword">else</span><font></font>
			{<font></font>
				result = proc.MainWindowTitle.Containing(<span class="hljs-string">"Microsoft Edge"</span>);<font></font>
			}<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			result = <span class="hljs-literal">true</span>;<font></font>
		}<font></font>
	}<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex)<font></font>
	{<font></font>
		result = <span class="hljs-literal">false</span>;<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetBrowserName</span><span class="hljs-params">(<span class="hljs-built_in">string</span> name)</span>
</span>{
	<span class="hljs-keyword">if</span> (Operators.CompareString(name.ToLower(), <span class="hljs-string">"iexplore"</span>, <span class="hljs-literal">false</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		<span class="hljs-keyword">return</span> <span class="hljs-string">"IE-Explorer"</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Operators.CompareString(name.ToLower(), <span class="hljs-string">"chrome"</span>, <span class="hljs-literal">false</span>) == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
		<span class="hljs-keyword">return</span> <span class="hljs-string">"Chrome"</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Operators.CompareString(name.ToLower(), <span class="hljs-string">"firefox"</span>, <span class="hljs-literal">false</span>) == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Firefox"</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Operators.CompareString(name.ToLower(), <span class="hljs-string">"opera"</span>, <span class="hljs-literal">false</span>) == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Opera"</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Operators.CompareString(name.ToLower(), <span class="hljs-string">"cliqz"</span>, <span class="hljs-literal">false</span>) == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Cliqz"</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Operators.CompareString(name.ToLower(), <span class="hljs-string">"applicationframehost"</span>, <span class="hljs-literal">false</span>) == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Microsoft Edge"</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてケーキの桜：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetBrowserUrlById</span><span class="hljs-params">(object processId, <span class="hljs-built_in">string</span> name)</span>
</span>{
	<span class="hljs-comment">// ...</span>
    automationElement.GetCurrentPropertyValue(<span class="hljs-comment">/*...*/</span>);<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> url;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは文字通り前の記事と同じ実装です。</font><font style="vertical-align: inherit;">開発者がいかにひどいことに気づいていないのか理解するのは難しい。</font><font style="vertical-align: inherit;">誰でもブラウザでURLを編集できますが、これはデモする価値すらありません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンの検出</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサイトの内容とは異なり、仮想マシンで起動するとフラグが設定されます。</font><font style="vertical-align: inherit;">実装は...興味深いです。</font></font><br>
<br>
<pre><code class="cpp hljs">File.WriteAllBytes(<span class="hljs-string">"ecvmd.exe"</span>, Resources.VmDetect);<font></font>
<font></font>
<span class="hljs-keyword">using</span> (Process process = <span class="hljs-keyword">new</span> Process())<font></font>
{<font></font>
	process.StartInfo = <span class="hljs-keyword">new</span> ProcessStartInfo(<span class="hljs-string">"ecvmd.exe"</span>, <span class="hljs-string">"-d"</span>)<font></font>
	{<font></font>
		CreateNoWindow = <span class="hljs-literal">true</span>,<font></font>
		UseShellExecute = <span class="hljs-literal">false</span>,<font></font>
		RedirectStandardOutput = <span class="hljs-literal">true</span><font></font>
	};<font></font>
	process.Start();<font></font>
	<span class="hljs-keyword">try</span><font></font>
	{<font></font>
		<span class="hljs-keyword">using</span> (StreamReader standardOutput = process.StandardOutput)<font></font>
		{<font></font>
			result = standardOutput.ReadToEnd().Replace(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">""</span>);<font></font>
		}<font></font>
	}<font></font>
	<span class="hljs-keyword">catch</span> (Exception ex3)<font></font>
	{<font></font>
		result = <span class="hljs-string">"-5"</span>;<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なんらかの理由で、外部バイナリをディスクに書き込んで実行し、I / Oの結果に完全に依存しています。</font><font style="vertical-align: inherit;">これは本当に頻繁に発生しますが、そのような重要なジョブを保護されていない別のプロセスに転送するのはまあまあです。</font><font style="vertical-align: inherit;">私たちが扱っているファイルを見てみましょう：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b13/e09/99c/b13e0999c55fb0e0686aa91bc16265db.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、C ++を使用しますか？</font><font style="vertical-align: inherit;">まあ、相互運用性は必ずしも悪いわけではありません。</font><font style="vertical-align: inherit;">これは、リバースエンジニアリングに取り組む必要があることを意味する場合があります（!!）。</font><font style="vertical-align: inherit;">IDAを見てみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span>
</span>{
  <span class="hljs-keyword">int</span> v3; <span class="hljs-comment">// ecx</span>
  BOOL v4; <span class="hljs-comment">// ebx</span>
  <span class="hljs-keyword">int</span> v5; <span class="hljs-comment">// ebx</span>
  <span class="hljs-keyword">int</span> *v6; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> detect; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">bool</span> vbox_key_exists; <span class="hljs-comment">// bl</span>
  <span class="hljs-keyword">char</span> vpcext; <span class="hljs-comment">// bh</span>
  <span class="hljs-keyword">char</span> vmware_port; <span class="hljs-comment">// al</span>
  <span class="hljs-keyword">char</span> *vmware_port_exists; <span class="hljs-comment">// ecx</span>
  <span class="hljs-keyword">char</span> *vbox_detected; <span class="hljs-comment">// edi</span>
  <span class="hljs-keyword">char</span> *vpcext_exists; <span class="hljs-comment">// esi</span>
  <span class="hljs-keyword">int</span> v14; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> v15; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> v16; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> v17; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> v18; <span class="hljs-comment">// eax</span>
  <span class="hljs-keyword">int</span> v20; <span class="hljs-comment">// [esp+0h] [ebp-18h]</span>
  HKEY result; <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span>
  HKEY phkResult; <span class="hljs-comment">// [esp+10h] [ebp-8h]</span><font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( argc != <span class="hljs-number">2</span> )
    <span class="hljs-keyword">goto</span> LABEL_20;<font></font>
  v3 = <span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">1</span>], <span class="hljs-string">"-d"</span>);
  <span class="hljs-keyword">if</span> ( v3 )<font></font>
    v3 = -(v3 &lt; <span class="hljs-number">0</span>) | <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> ( !v3 )<font></font>
  {<font></font>
    v4 = (<span class="hljs-keyword">unsigned</span> __int8)vm_detect::vmware_port() != <span class="hljs-number">0</span>;<font></font>
    result = <span class="hljs-number">0</span>;<font></font>
    v5 = (vm_detect::vpcext() != <span class="hljs-number">0</span> ? <span class="hljs-number">2</span> : <span class="hljs-number">0</span>) + v4;<font></font>
    RegOpenKeyExA(HKEY_LOCAL_MACHINE, <span class="hljs-string">"HARDWARE\\ACPI\\DSDT\\VBOX__"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x20019</span>u, &amp;result);<font></font>
    v6 = sub_402340();<font></font>
LABEL_16:<font></font>
    sub_404BC0((<span class="hljs-keyword">int</span>)v6, v20);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
  }<font></font>
  detect = <span class="hljs-built_in">strcmp</span>(argv[<span class="hljs-number">1</span>], <span class="hljs-string">"-s"</span>);
  <span class="hljs-keyword">if</span> ( detect )<font></font>
    detect = -(detect &lt; <span class="hljs-number">0</span>) | <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> ( !detect )<font></font>
  {<font></font>
LABEL_20:<font></font>
    phkResult = <span class="hljs-number">0</span>;<font></font>
    vbox_key_exists = RegOpenKeyExA(HKEY_LOCAL_MACHINE, <span class="hljs-string">"HARDWARE\\ACPI\\DSDT\\VBOX__"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x20019</span>u, &amp;phkResult) == <span class="hljs-number">0</span>;<font></font>
    vpcext = vm_detect::vpcext();<font></font>
    vmware_port = vm_detect::vmware_port();<font></font>
    vmware_port_exists = <span class="hljs-string">"1"</span>;<font></font>
    vbox_detected = <span class="hljs-string">"1"</span>;
    <span class="hljs-keyword">if</span> ( !vbox_key_exists )<font></font>
      vbox_detected = <span class="hljs-string">"0"</span>;<font></font>
    vpcext_exists = <span class="hljs-string">"1"</span>;
    <span class="hljs-keyword">if</span> ( !vpcext )<font></font>
      vpcext_exists = <span class="hljs-string">"0"</span>;
    <span class="hljs-keyword">if</span> ( !vmware_port )<font></font>
      vmware_port_exists = <span class="hljs-string">"0"</span>;<font></font>
    result = (HKEY)vmware_port_exists;<font></font>
    v14 = <span class="hljs-built_in">std</span>::print((<span class="hljs-keyword">int</span>)&amp;dword_433310, <span class="hljs-string">"VMW="</span>);<font></font>
    v15 = <span class="hljs-built_in">std</span>::print(v14, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *)result);<font></font>
    v16 = <span class="hljs-built_in">std</span>::print(v15, <span class="hljs-string">",VPC="</span>);<font></font>
    v17 = <span class="hljs-built_in">std</span>::print(v16, vpcext_exists);<font></font>
    v18 = <span class="hljs-built_in">std</span>::print(v17, <span class="hljs-string">",VIB="</span>);<font></font>
    v6 = (<span class="hljs-keyword">int</span> *)<span class="hljs-built_in">std</span>::print(v18, vbox_detected);
    <span class="hljs-keyword">goto</span> LABEL_16;<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、VMWare I / Oポート「VX」の存在がチェックされます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> __fastcall <span class="hljs-title">vm_detect::vmware_port</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span><font></font>
<font></font>
  result = __indword(<span class="hljs-string">'VX'</span>);<font></font>
  LOBYTE(result) = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想PC拡張</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令の実行がチェックされます</font><font style="vertical-align: inherit;">。これは、正しく処理されない場合にマシンのクラッシュにつながらない場合、仮想化環境で起動したときにのみ機能します。）：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">vm_detect::vpcext</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">char</span> result; <span class="hljs-comment">// al</span><font></font>
<font></font>
  result = <span class="hljs-number">1</span>;<font></font>
  __asm { vpcext  <span class="hljs-number">7</span>, <span class="hljs-number">0B</span>h }
  <span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...実際のリバースエンジニアリングはなく、2つの関数の名前を変更するのにわずか30秒:( </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプログラムはレジストリキーを読み取り、他のプログラムと比べて奇妙に見える2つのハイパーバイザーチェックを実行します。どこにコピーしたのでしょうか？ああ、記事</font><font style="vertical-align: inherit;">これらの方法を説明する</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「仮想（sic）マシンを検出するための方法」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">というタイトルが付けられて</font><font style="vertical-align: inherit;">います。</font><font style="vertical-align: inherit;">いずれの場合も、これらの検出ベクトルは、.vmxファイルを編集するか、選択したハイパーバイザーの拡張バージョンを使用することで回避できます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データ保護</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のように、GDPRに準拠していないことが調査中であり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブサイトに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次のように記載されています。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データは暗号化され、安全なMicrosoft Azureサーバーに送信されます。このサーバーには、正しい資格情報でのみアクセスできます。</font><font style="vertical-align: inherit;">試験後、データは最大3か月間保存されます。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
資格情報はアプリケーションにハードコード化されており、メタデータリソースに完全にクリアテキストで格納されているため、サーバーの「セキュリティ」をどのように決定するのかはよくわかりません。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンドポイント：https://examcookiewinapidk.azurewebsites.net</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザー名：VfUtTaNUEQ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスワード：AwWE9PHjVc</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーの内容は調査しませんでした（これは違法です）が、フルアクセスが提供されていると想定できます。</font><font style="vertical-align: inherit;">アカウントはアプリケーションでハードコーディングされているため、学生のデータコンテナー間の分離はありません。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">法的免責事項：API資格情報は公開バイナリファイルに格納されているため、違法に取得されないため、API資格情報を公開する権利があります。</font><font style="vertical-align: inherit;">ただし、悪意を持ってそれらを使用することは明らかに法律に違反するため、読者は前述の資格情報をいかなる方法でも使用しないことを強くお勧めします。また、潜在的なアクションについて責任を負いません。</font></font></i><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイパス</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプリケーションはDigital Exam Monitorを非常に彷彿とさせるため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ayyxam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コード</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">更新して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ExamCookie</font></a><font style="vertical-align: inherit;">をサポートしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロセスリスト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NETプロセスインターフェイスは、システムコールを使用してプロセスデータを内部的にキャッシュします</font></font><code>ntdll!NtQuerySystemInformation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プロセスに関する情報が多くの場所に示されているため、プロセスからプロセスを隠すには、いくつかの作業が必要です。</font><font style="vertical-align: inherit;">さいわい、.NETは特定の1種類の情報しか取得しないため、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">latebrosの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドをすべて使用する必要はありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクティブなプロセスの検証をバイパスするコード。</font></font><br>
<br>
<pre><code class="cpp hljs">NTSTATUS WINAPI ayyxam::hooks::nt_query_system_information(<font></font>
	SYSTEM_INFORMATION_CLASS system_information_class, PVOID system_information, <font></font>
	ULONG system_information_length, PULONG return_length)<font></font>
{<font></font>
	<span class="hljs-comment">// DONT HANDLE OTHER CLASSES</span>
	<span class="hljs-keyword">if</span> (system_information_class != SystemProcessInformation)
		<span class="hljs-keyword">return</span> ayyxam::hooks::original_nt_query_system_information(<font></font>
				system_information_class, system_information,<font></font>
				system_information_length, return_length);<font></font>
<font></font>
	<span class="hljs-comment">// HIDE PROCESSES</span>
	<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> value = ayyxam::hooks::original_nt_query_system_information(<font></font>
			system_information_class, system_information, <font></font>
			system_information_length, return_length);<font></font>
<font></font>
	<span class="hljs-comment">// DONT HANDLE UNSUCCESSFUL CALLS</span>
	<span class="hljs-keyword">if</span> (!NT_SUCCESS(value))
		<span class="hljs-keyword">return</span> value;<font></font>
<font></font>
	<span class="hljs-comment">// DEFINE STRUCTURE FOR LIST</span>
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SYSTEM_PROCESS_INFO</span>
	{</span><font></font>
		ULONG                   NextEntryOffset;<font></font>
		ULONG                   NumberOfThreads;<font></font>
		LARGE_INTEGER           Reserved[<span class="hljs-number">3</span>];<font></font>
		LARGE_INTEGER           CreateTime;<font></font>
		LARGE_INTEGER           UserTime;<font></font>
		LARGE_INTEGER           KernelTime;<font></font>
		UNICODE_STRING          ImageName;<font></font>
		ULONG                   BasePriority;<font></font>
		HANDLE                  ProcessId;<font></font>
		HANDLE                  InheritedFromProcessId;<font></font>
	};<font></font>
<font></font>
	<span class="hljs-comment">// HELPER FUNCTION: GET NEXT ENTRY IN LINKED LIST</span>
	<span class="hljs-keyword">auto</span> get_next_entry = [](SYSTEM_PROCESS_INFO* entry)<font></font>
	{<font></font>
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">reinterpret_cast</span>&lt;SYSTEM_PROCESS_INFO*&gt;(
			<span class="hljs-keyword">reinterpret_cast</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-keyword">uintptr_t</span>&gt;(entry) + entry-&gt;NextEntryOffset);<font></font>
	};<font></font>
<font></font>
	<span class="hljs-comment">// ITERATE AND HIDE PROCESS</span>
	<span class="hljs-keyword">auto</span> entry = <span class="hljs-keyword">reinterpret_cast</span>&lt;SYSTEM_PROCESS_INFO*&gt;(system_information);<font></font>
	SYSTEM_PROCESS_INFO* previous_entry = <span class="hljs-literal">nullptr</span>;
	<span class="hljs-keyword">for</span> (; entry-&gt;NextEntryOffset &gt; <span class="hljs-number">0x00</span>; entry = get_next_entry(entry))<font></font>
	{<font></font>
		<span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> protected_id = <span class="hljs-number">7488</span>;
		<span class="hljs-keyword">if</span> (entry-&gt;ProcessId == <span class="hljs-keyword">reinterpret_cast</span>&lt;HANDLE&gt;(protected_id) &amp;&amp; previous_entry != <span class="hljs-literal">nullptr</span>)<font></font>
		{<font></font>
			<span class="hljs-comment">// SKIP ENTRY</span><font></font>
			previous_entry-&gt;NextEntryOffset += entry-&gt;NextEntryOffset;<font></font>
		}<font></font>
<font></font>
		<span class="hljs-comment">// SAVE PREVIOUS ENTRY FOR SKIPPING</span><font></font>
		previous_entry = entry;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">return</span> value;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バッファ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼は.NETでのバッファーの内部実装を担当しており、</font></font><code> ole32.dll!OleGetClipboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フックの影響を非常に受けやすくなっています。</font><font style="vertical-align: inherit;">内部構造の分析に多くの時間を費やす代わりに、単純にを返すことができ</font></font><code>S_OK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、.NETエラー処理が残りを行います。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> __stdcall ayyxam::hooks::get_clipboard(<span class="hljs-keyword">void</span>* data_object[[maybe_unused]])<font></font>
{<font></font>
	<span class="hljs-comment">// LOL</span>
	<span class="hljs-keyword">return</span> S_OK;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、プログラムの機能を妨げることなく、バッファ全体がExamCookie監視ツールから隠されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつものように、人々は必要な機能の既製の.NET実装を採用します。</font><font style="vertical-align: inherit;">この関数を回避するために、前のコードで何も変更する必要はありませんでした。</font><font style="vertical-align: inherit;">スクリーンショットは</font></font><code>Graphics.CopyFromScreen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET </font><font style="vertical-align: inherit;">関数によって制御され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これは本質的に、を呼び出すビットブロックを送信するためのラッパーです</font></font><code>gdi32!BitBlt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">スクリーンショットを撮るチート対策システムと戦うビデオゲームの場合と同様に、スクリーンショットを撮る前に、BitBltフックを使用して不要な情報を非表示にすることができます。</font></font><br>
<br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンサイト</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラバーURLは前のプログラムから完全にコピーされているため、コードを再利用して保護をバイパスできます。</font><font style="vertical-align: inherit;">では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前回の記事、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは以下のフックが起動され、その結果として、のAutomationElement構造を文書化：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> __stdcall ayyxam::hooks::get_property_value(<span class="hljs-keyword">void</span>* handle, <span class="hljs-built_in">std</span>::<span class="hljs-keyword">int32_t</span> property_id, <span class="hljs-keyword">void</span>* value)<font></font>
{<font></font>
	<span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> value_value_id = <span class="hljs-number">0x755D</span>;
	<span class="hljs-keyword">if</span> (property_id != value_value_id)
		<span class="hljs-keyword">return</span> ayyxam::hooks::original_get_property_value(handle, property_id, value);<font></font>
<font></font>
	<span class="hljs-keyword">auto</span> result = ayyxam::hooks::original_get_property_value(handle, property_id, value);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (result != S_OK) <span class="hljs-comment">// SUCCESS?</span>
		<span class="hljs-keyword">return</span> result;<font></font>
<font></font>
	<span class="hljs-comment">// VALUE URL IS STORED AT 0x08 FROM VALUE STRUCTURE</span>
	<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">value_structure</span>
	{</span>
	<span class="hljs-keyword">public</span>:
		<span class="hljs-keyword">char</span> pad_0000[<span class="hljs-number">8</span>];	<span class="hljs-comment">//0x0000</span>
		<span class="hljs-keyword">wchar_t</span>* value;		<span class="hljs-comment">//0x0008</span><font></font>
	};<font></font>
	<span class="hljs-keyword">auto</span> value_object = <span class="hljs-keyword">reinterpret_cast</span>&lt;value_structure*&gt;(value);<font></font>
<font></font>
	<span class="hljs-comment">// ZERO OUT OLD URL</span>
	<span class="hljs-built_in">std</span>::<span class="hljs-built_in">memset</span>(value_object-&gt;value, <span class="hljs-number">0x00</span>, <span class="hljs-built_in">std</span>::wcslen(value_object-&gt;value) * <span class="hljs-number">2</span>);<font></font>
<font></font>
	<span class="hljs-comment">// CHANGE TO GOOGLE.COM</span>
	<span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">wchar_t</span> spoofed_url[] = <span class="hljs-string">L"https://google.com"</span>;
	<span class="hljs-built_in">std</span>::<span class="hljs-built_in">memcpy</span>(value_object-&gt;value, spoofed_url, <span class="hljs-keyword">sizeof</span>(spoofed_url));<font></font>
<font></font>
	<span class="hljs-keyword">return</span> result;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンの検出</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンの遅延検出は、次の2つの方法で回避できます。1）ディスクにフラッシュされるプログラムのパッチ。</font><font style="vertical-align: inherit;">または2）プロセス作成プロセスのダミーアプリケーションへのリダイレクト。</font><font style="vertical-align: inherit;">後者は明らかに単純なようです:)。</font><font style="vertical-align: inherit;">その</font><font style="vertical-align: inherit;">ため、</font><font style="vertical-align: inherit;">内部的に</font></font><code>Process.Start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出す</font></font><code>CreateProcess</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため、フックを作成して、文字「0」を出力するダミーアプリケーションにリダイレクトします。</font></font><br>
<br>
<pre><code class="cpp hljs">BOOL WINAPI ayyxam::hooks::create_process(<font></font>
	LPCWSTR application_name,<font></font>
	LPWSTR command_line,<font></font>
	LPSECURITY_ATTRIBUTES process_attributes,<font></font>
	LPSECURITY_ATTRIBUTES thread_attributes,<font></font>
	BOOL inherit_handles,<font></font>
	DWORD creation_flags,<font></font>
	LPVOID environment,<font></font>
	LPCWSTR current_directory,<font></font>
	LPSTARTUPINFOW startup_information,<font></font>
	LPPROCESS_INFORMATION process_information<font></font>
)<font></font>
{<font></font>
<font></font>
	<span class="hljs-comment">// REDIRECT PATH OF VMDETECT TO DUMMY APPLICATION</span>
	<span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> vm_detect = <span class="hljs-string">L"ecvmd.exe"</span>;
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">std</span>::wcsstr(application_name, vm_detect))<font></font>
	{<font></font>
		application_name = <span class="hljs-string">L"dummy.exe"</span>;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-keyword">return</span> ayyxam::hooks::original_create_process(<font></font>
		application_name, command_line, process_attributes,<font></font>
		thread_attributes, inherit_handles, creation_flags,<font></font>
		environment, current_directory, startup_information,<font></font>
		process_information);<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンロード</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクト全体</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はGithubリポジトリで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">プログラムは、x86バイナリを対応するプロセスに挿入することで機能します。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja453522/index.html">ハッピーバースデー、Habr br</a></li>
<li><a href="../ja453524/index.html">モバイル＃299開発者向けの興味深い資料のダイジェスト（5月20〜26日）</a></li>
<li><a href="../ja453526/index.html">ITSM-それは何であり、実装を開始する場所</a></li>
<li><a href="../ja453528/index.html">Psion SIBO-エミュレートする必要さえないPDA</a></li>
<li><a href="../ja453534/index.html">スコットランドで物理学の教師がビッグデータを制覇</a></li>
<li><a href="../ja453538/index.html">統合ストライク戦闘機F-35のオンボードMPSのハードウェアコンポーネント</a></li>
<li><a href="../ja453540/index.html">5Gがショッピングとソーシャルネットワーキングへのアプローチをどのように変えるか</a></li>
<li><a href="../ja453542/index.html">4本足のロボットは重量3.3トンの飛行機を牽引できました</a></li>
<li><a href="../ja453544/index.html">BCDカウンターの直接出力と反転出力の両方を使用する7セグメントデコーダー</a></li>
<li><a href="../ja453546/index.html">小さなキーボードが必要-自分でやる</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>