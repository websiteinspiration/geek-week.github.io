<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐞 👨🏽‍🤝‍👨🏻 🚪 Como transferir um shader de um mecanismo de jogo para o Substance Painter 🧑🏿‍🤝‍🧑🏿 ☀️ 👸🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meu nome é Taras Uleisky, sou um artista técnico no Plarium Kharkiv. Para otimizar os gráficos do nosso Survival RPG em dispositivos móveis, usamos no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como transferir um shader de um mecanismo de jogo para o Substance Painter</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/501982/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meu nome é Taras Uleisky, sou um artista técnico no Plarium Kharkiv. </font><font style="vertical-align: inherit;">Para otimizar os gráficos do nosso Survival RPG em dispositivos móveis, usamos nossos shaders personalizados. </font><font style="vertical-align: inherit;">Eles envolvem o uso de texturas e mapas exclusivos que não são semelhantes a texturas e mapas em outros métodos populares de sombreamento. </font><font style="vertical-align: inherit;">Como resultado, não está totalmente claro para os artistas 3D como criar essas texturas para ativos no jogo. </font><font style="vertical-align: inherit;">Para ver imediatamente como o modelo 3D ficará no mecanismo de jogo no estágio de texturização, mudei o shader para Substance Painter. </font><font style="vertical-align: inherit;">Praticamente não há materiais de API no Substance Painter no momento; eu próprio estudei esse tópico, então decidi compartilhar minhas próprias idéias.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/hi/z2/tthiz2dpzs2v-tdmzga9nskoeao.png"><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader de unidade</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O jogo usa sombreamento matcap. Além da textura diff usual, duas texturas Matcap pré-criadas também são transferidas para o shader. Eles são interpolados e desfocados usando duas máscaras, respectivamente. Como resultado, a textura Matcap é multiplicada por brilho difuso e falso e reflexos podem ser vistos no material. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wd/mt/fr/wdmtfrjwwe6gach03sv2-u31cya.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O exemplo abaixo mostra como o Matcap é implementado em um gráfico de sombreador. Nesse caso, duas texturas do Matcap são compactadas em uma e divididas em canais. Ou seja, metal e não metal nos canais R e G, respectivamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gt/tn/x1/gttnx1bhczfa3fuqiwmgrqegdvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dois Matcaps são interpolados, por exemplo, por verificador. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oj/go/ro/ojgorowglvxcnfsbqns551jwz3e.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resultado é uma certa analogia com metal e não metal como no sombreamento PBR. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Queríamos adicionar rugosidade e sujeira aos materiais, para criar algum tipo de analógico de rugosidade no sombreamento PBR. Para fazer isso, usamos o método de texturização.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mapeamento mip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Uma sequência de texturas cria a chamada pirâmide MIP com uma resolução máxima de 1x1. </font><font style="vertical-align: inherit;">Por exemplo: 1 × 1, 2 × 2, 4 × 4, 8 × 8, 16 × 16, 32 × 32, 64 × 64, 128 × 128. </font><font style="vertical-align: inherit;">Cada uma dessas texturas é chamada de nível MIP. </font><font style="vertical-align: inherit;">Para implementar arranhões no sombreador pixel por pixel, com base na máscara, é necessário selecionar o nível MIP necessário. </font><font style="vertical-align: inherit;">Acontece assim: onde o pixel na máscara é preto, o nível máximo de MIP é selecionado no Matcap e onde a cor do pixel é branca, o nível de MIP é 0. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r9/33/bw/r933bw4z7ja0uwi4o8uwoomrthe.gif"><br>
<br>
<img src="https://habrastorage.org/webt/7o/k7/n9/7ok7n9zj0oxq3ouidw_kwt9ezww.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, o sombreador permite simular reflexões e realces, adicionar rugosidade e arranhões leves. </font><font style="vertical-align: inherit;">E tudo isso sem o uso do Cubemap, sem cálculos complexos de iluminação e outras técnicas que reduzem significativamente o desempenho de dispositivos móveis.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/yr/ur/gayrur5ty9hr3xdfl56duhlcgqi.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configurando o Substance Painter para criar um shader</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os shaders disponíveis no Pintor de substâncias são escritos em GLSL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Especificamente, para escrever um shader para o Substance Painter, eu uso o código VS gratuito. Para realçar a sintaxe, é melhor usar o suporte de idiomas do Shader para a extensão do VS Code. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fz/xo/iw/fzxoiwxrllvqgwvfammn5uuq7b8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há muito pouco material sobre a API no Substance Painter, portanto, a documentação padrão encontrada na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajuda / Documentação / Shader API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não tem preço. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2t/rw/yx/2trwyxswqga9eozdwbk4mmc1ztk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda coisa que ajudará a escrever o shader é o shaders padrão no Substance Painter. Para encontrá-los, vá para ... </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Allegorithmic / SubstancePainter / resources / shelf / allegorithmic / shaders.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar escrever o shader apagado mais simples que mostrará a cor Base. Primeiro, crie um arquivo de texto com a extensão .glsl e escreva um shader tão simples. Talvez, enquanto nada estiver claro, eu lhe falarei mais sobre a estrutura do shader no Substance Painter. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mk/ck/rv/mkckrvh6j8r7fz7zh72sjfhylgg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crie um novo projeto e arraste o shader para o seu shell. Na lista suspensa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importar seus recursos para</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">selecione o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projeto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'project_name'</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a0/us/24/a0us24ykiapgfc-ioeuxt7mpckc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso é necessário para que todas as alterações possam ser atualizadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vá para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Window / Views / Shader Settings</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e selecione seu novo shader na janela que aparece. Você pode usar a pesquisa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9u/bt/6p/9ubt6padacui5ccb77bgpbywfcg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você vir que o modelo inteiro é branco e pode desenhar a cor Base nele, fez tudo certo. </font><font style="vertical-align: inherit;">Agora você pode salvar o projeto e ir para a próxima seção. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/ig/wt/jzigwtwpb73uz6s8paesepkcqao.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o modelo for rosa, provavelmente haverá um erro no sombreador - uma notificação sobre isso estará no console.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construindo um shader no Substance Painter</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere a estrutura de um shader usando o shader apagado descrito anteriormente como exemplo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mk/ck/rv/mkckrvh6j8r7fz7zh72sjfhylgg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O método de sombra é a parte básica do shader; ele não funcionará sem ele. Tudo o que será descrito dentro pode ser exibido em um modelo 3D. Todos os cálculos finais são produzidos através da função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diffuseShadingOutput ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As linhas 3 e 4 criam um parâmetro e uma variável, respectivamente. O parâmetro associa o canal de cores Base à variável na qual a textura pintada será armazenada. Todos os parâmetros estão explicitados na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajuda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; no caso da cor Base, tudo deve ser escrito como no exemplo. A linha 8 apresenta a textura nas coordenadas uv do modelo 3D. Observo que, para a textura com cor Base, o sistema </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sparse Virtual Textures</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é usado </font><font style="vertical-align: inherit;">, porque a biblioteca está conectada com a primeira linha</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lib-sparce.glsl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode encontrar muitas implementações do Matcap, mas seu ponto principal é que as normais do modelo são direcionadas para a câmera e a textura é girada ao longo dos eixos xe y. Para girar o normal em direção à câmera, precisamos visualizar a matriz ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o tipo de matriz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Você pode encontrar um no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certificado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mencionado acima. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/b5/94/ox/b594oxz6c9doiz0sdm2jbzxt6ow.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, esses são os mesmos nomes declarados como no caso da cor Base. Agora precisamos obter as normais do modelo 3D. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wg/os/4b/wgos4bygzxftd_sbadht0lqznhy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zero como o quarto elemento do vetor é necessário.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Multiplicar uma matriz de vista com um vetor normal expandirá o normal para a câmera. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/bt/c0/tybtc0ibyb9ybigfr5x-tse61ne.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não esqueça que, ao multiplicar matrizes, a ordem dos fatores é importante. Se você alterar a ordem da multiplicação, os resultados serão diferentes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora você pode </font><font style="vertical-align: inherit;">criar coordenadas uv a </font><font style="vertical-align: inherit;">partir do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewNormal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/94/ef/jn/94efjnpw9ingufg9ocbgfdxxnwq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É hora de ligar a textura matcap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/k3/k8/edk3k848a9wdmfa06dunpn8zrni.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, o parâmetro criará um campo de textura na interface do sombreador e, se o projeto tiver uma textura com o nome "Matcap_mip", o Substance Painter o puxará para cima automaticamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/q5/e0/ylq5e0hbag9jh4bpgj2ro2vot4e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos verificar o que aconteceu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/zb/iy/rezbiydl_fat8ornozz67bwjbs0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a textura do Matcap é expandida em novas coordenadas e multiplicada pela cor Base na saída. Quero prestar atenção ao fato de que a textura Matcap é expandida através da função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e da cor Base - através da função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">textureSparse ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Isso ocorre porque as texturas especificadas na interface do sombreador não podem ser do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SamplerSparse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O resultado deve ser algo como isto:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/l7/v1/rq/l7v1rqhspgrp92iuffebw2-jmua.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora adicione uma máscara que misture dois Matcap's. Por conveniência, adicione dois Matcap'a em uma textura, dividindo-os em canais. Como resultado, duas texturas Matcap estarão nos canais R e G, respectivamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontecerá algo como isto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a-/nr/ih/a-nrih00ttqwnk6ewdv-pbhq9yo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos começar a adicionar uma máscara ao shader. O princípio é semelhante à adição da cor Base. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/lv/jf/ttlvjfnodtzhu_qp_mpq-oqfpga.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É suficiente substituir o valor da cor básica por user0 no parâmetro </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora obtenha o valor da máscara no pixel shader e misture as texturas matcap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pa/42/sr/pa42srwn-29afh50di07sepap_w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, apenas o canal R é usado na máscara, porque será preto e branco. Os dois canais matcap são misturados usando a função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mix ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um análogo do lerp no Unity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos atualizar o sombreador e adicionar canais personalizados na interface. Para fazer isso, vá para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Window / Views / Texture Set Settings</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, na janela próxima ao cabeçalho Canais, clique no sinal de mais e selecione usuário0 na lista grande. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0t/v0/mo/0tv0mo6ovcvfztcawlrhbzrhzbs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O canal pode ser chamado como você quiser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, desenhando neste canal, você pode ver como as duas texturas do Matcap são misturadas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ri/jq/nu/rijqnu1-0utez7t0babbdv11--s.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sombreador do Unity também usava mapas normais para o Matcap, que eram feitos a partir de um modelo de alto poli. Vamos tentar fazer o mesmo no Pintor de substâncias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar todas as operações em normais, você precisa conectar a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apropriada </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6f/zz/z3/6fzzz36x9epa7a34gew0hcq-fro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, conectamos os mapas normais. Existem dois deles no Substance Painter: um é obtido por cozimento e o segundo pode ser desenhado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/7q/86/hw7q86rpk52sdkyygjo32vufv5s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com os parâmetros, você pode adivinhar que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">channel_normal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um mapa normal, de acordo com o qual você pode desenhar, e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture_normal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- mapa normal assado. Também observo que o nome da variável </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texture_normal está</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> incorporado na API e você não pode nomeá-lo a seu critério. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, descompacte os cartões no pixel shader: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/wx/sv/yqwxsvn2ohvouv-rwzui9blzp6q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, misturamos os mapas normais e os normais que estão nos vértices do modelo. Para fazer isso, na biblioteca conectada acima, há uma função </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalBlend ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2y/r0/zs/2yr0zsobknqtlz7ooj_6xd4onsg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro misturamos os dois mapas normais e depois os normais normais. Embora realmente não importe em qual ordem misturá-los. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A rotação dos normais na direção do olhar da câmera ficará assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yc/bl/mt/ycblmti7x5nhbfhdlx6yyrqyl4o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então você não pode mudar nada, tudo permanecerá o mesmo. Deve ser algo como isto:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gm/ny/za/gmnyza2j-simray-86frype0usa.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mapeamento Mip, como mencionado acima, neste caso é necessário para simular arranhões, algo como uma placa de rugosidade no sombreamento PBR. Mas o principal problema é que a pirâmide dos cartões mip não é gerada para a textura, que é transmitida a partir da interface do shader e, portanto, o método </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">textureLod ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da glsl não funciona. Pode-se ir para o outro lado e carregar a textura do Matcap através do canal do usuário, como foi feito para misturar o Matcap. Mas então a qualidade da textura diminuirá bastante e artefatos estranhos aparecerão. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma solução alternativa é criar uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pirâmide de cartões MIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manualmente, no Adobe Photoshop ou outro editor semelhante, e selecione o nível MIP. A pirâmide é construída de maneira bastante simples. É necessário proceder a partir do tamanho da textura original - no meu caso, é 256x256. Criamos um arquivo com um tamanho de 384x256 (384, porque 256 + 256/2) e agora reduzimos a textura original pela metade até que ele tenha um pixel de tamanho. Todas as versões de texturas reduzidas são colocadas à direita da textura original em ordem crescente. Deverá ocorrer da seguinte maneira: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sg/h-/qw/sgh-qwq1kmwq_gh7hgkg1l8fnxq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora você pode começar a escrever uma função que encontre as coordenadas de cada textura na pirâmide, dependendo da cor de cada pixel na máscara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maneira mais fácil é armazenar as coordenadas uv que serão calculadas para cada textura em uma matriz. O tamanho da matriz será determinado como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log2 (altura)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como precisamos do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> original </font><font style="vertical-align: inherit;">, os adicionamos ao argumento da função. Para determinar qual elemento da matriz usar em um pixel específico, adicione </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao argumento da função. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hq/ox/um/hqoxumpnar903hkoghv3hgtfzr4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora calcule uv para a textura original, ou seja, corte os 128 pixels extras de largura. Para fazer isso, multiplique a coordenada x por ⅔. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ho/or/nh/hoornhxxr9w2yj_bgr8ckt9rdw8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para usar o restante da textura da pirâmide, você precisa encontrar padrões. Quando criamos a pirâmide a partir das texturas, percebemos que cada vez que a textura é reduzida pela metade em relação ao tamanho anterior. Ou seja, quantas vezes o tamanho da textura diminui, você pode determinar aumentando 2 para a potência do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível MIP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9i/yk/6k/9iyk6k9udtbo2gyundt8erj8a0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que, se você selecionar o nível, por exemplo, 4, a textura diminuirá 16 vezes. Como</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> coordenadas </font><i><font style="vertical-align: inherit;">uv</font></i><font style="vertical-align: inherit;"> são determinadas de 0 a 1, então o tamanho precisa ser normalizado, ou seja, 1 dividido por quantas vezes a textura diminuiu, por exemplo, 1 dividido por 16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando o valor obtido da variável size, você pode calcular as coordenadas para um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível MIP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> específico </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/we/cv/kh/wecvkhragapkffyxyussvrbgkes.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tamanho do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uv é</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reduzido da mesma maneira que o tamanho da textura. Na coordenada x, a textura sempre muda em ⅔. O deslocamento da coordenada y pode ser definido como a soma de todos os valores da variável de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamanho</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para cada valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ou seja, se o valor for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível = 1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , uv na coordenada y mudará em 0 pixels e, se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível = 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a mudança será metade da altura da textura - 128 pixels. Se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível = 3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a mudança será 128 + 64 pixels e assim por diante. A soma de todos os turnos pode ser obtida usando o ciclo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nj/fl/wi/njflwi83bfg42lecjugixw2xrr8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, a cada iteração, a variável de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deslocamento</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicionará e mudará a textura ao longo do eixo y pelo número desejado de pixels. O algoritmo passo a passo é mais ou menos assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/cd/ll/jccdllnuvqh288742jsx21jtbme.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O último passo é exibir um canal que selecionará o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desejado </font><font style="vertical-align: inherit;">em cada pixel. Já fizemos isso, nada de novo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/no/sh/4d/nosh4drvum-rq3fif1mh2qdif_0.png"><br>
<br>
<img src="https://habrastorage.org/webt/vg/-5/w0/vg-5w0rym_gpaygfgzhtkubfxly.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para selecionar o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nível MIP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como uma textura, apenas multiplique o comprimento da matriz pela textura. Agora você pode conectar novas coordenadas uv através do método que acabamos de escrever. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/af/-h/1a/af-h1agpkidgfd7153wgsfgltaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não se esqueça de converter a textura no tipo int, pois agora é um índice para a matriz.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, você precisa adicionar um canal personalizado no Substance Painter, como fizemos anteriormente. Deveria acontecer assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qc/4p/h4/qc4ph4jzivfdrtqd5w4dqtn0ojw.gif"><br>
<br>
<img src="https://habrastorage.org/webt/mp/s4/1c/mps41cvu0dlu_kqkkv7qkrtmb5m.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a única coisa que falta para o shader é a fonte de luz e a capacidade de girá-lo pressionando shift. Antes de tudo, para isso, precisamos de um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parâmetro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que produza o ângulo de rotação pressionando shift e a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matriz de rotação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xy/g_/y1/xyg_y1vvg_rhtoxwuepokzrp9x0.png"><br>
<br>
<img src="https://habrastorage.org/webt/ny/17/df/ny17dfcnyibmvgvfx8pbphsxkom.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Colocamos aleatoriamente a fonte de luz e multiplicamos a posição pela matriz de rotação. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bo/gi/fp/bogifpq90um2ygho-bgv0zdvy7a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora a fonte de luz irá girar em torno do eixo y pressionando shift, mas até agora este é apenas um vetor no qual a posição da fonte de luz é armazenada. Há </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coisas boas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como implementar luz direcional em um shader. </font><font style="vertical-align: inherit;">Vamos nos concentrar nele. </font><font style="vertical-align: inherit;">Resta determinar a direção da luz e a iluminação do nosso modelo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ok/a4/df/oka4dfn33tv1t2meohooiu9fz2k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A cor da sombra e a cor da fonte de luz serão definidas pelos parâmetros: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mr/zs/km/mrzskmiirmqmddlhwwg59ab_mpm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os parâmetros de cor são interpolados de acordo com a iluminação calculada acima. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c4/ci/8h/c4ci8hm54ul19f-lg92oox2t7li.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontecerá assim: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dp/rx/s9/dprxs9gy7_jaw4p3lu_ux7a9xbi.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando esses parâmetros, você pode ajustar a cor da sombra e a cor da fonte de luz através da interface do Substance Painter.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ws/o8/e3/wso8e3nnmdky15efibtajhj0rya.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criar e configurar uma predefinição</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o shader estiver pronto, você precisará importar a textura Matcap e o shader com a configuração de prateleira. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hg/w2/wh/hgw2wh4tdzd6i1l4hgcpi8iebpk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Removemos todos os canais não utilizados e adicionamos canais de usuário: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/qs/xe/hlqsxepohrs1j0hbrlkeghgch5g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
predefinição para exportar texturas será semelhante a qualquer outra, exceto pelo uso de nossos canais personalizados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zp/xf/7o/zpxf7oje5map2cl0gurvpustk7u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criaremos um modelo para todas as configurações para que, quando você criar o projeto, o sombreador desejado seja imediatamente atribuído e todos os canais de textura sejam configurados. </font><font style="vertical-align: inherit;">Para fazer isso, vá para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File / SaveAsTemplate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e salve o modelo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pb/xn/aq/pbxnaqjvwraborjnospf8rglc10.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, ao criar um novo projeto, você não precisa configurar nada. Basta selecionar o modelo desejado.</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/hh/xw/by/hhxwbyfzcemnynsqglcabzbgzto.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que você conseguiu</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um artista técnico pode criar efeitos especiais, personalizar cenas e otimizar os processos de renderização. </font><font style="vertical-align: inherit;">Eu também queria que os modelos de armaduras e armas de Stormfall: Saga of Survival fossem exatamente o que os artistas em 3D pretendiam. </font><font style="vertical-align: inherit;">Como resultado, o modelo 3D no Substance Painter parece o mesmo que no mecanismo do jogo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x_/ic/qr/x_icqrlq2s3_osfrps5c-0qttwo.gif"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo 3D no Pintor de substâncias com sombreamento personalizado. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/7e/79/sg/7e79sgwszeyazecwzi18j2fhv4s.gif"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo 3D no Unity com sombreamento personalizado. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que o artigo tenha sido útil e tenha inspirado você a novas conquistas!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt501968/index.html">Modelo de arquitetura MVI na multiplataforma Kotlin, parte 1</a></li>
<li><a href="../pt501970/index.html">O que você precisa para criar uma boa masmorra em RPG?</a></li>
<li><a href="../pt501976/index.html">Como aprender a testar o software</a></li>
<li><a href="../pt501978/index.html">Como o histograma do Prometheus funciona?</a></li>
<li><a href="../pt501980/index.html">A história de um projeto ou como eu criei 7 anos de PBX baseado em Asterisk e Php</a></li>
<li><a href="../pt501984/index.html">O que ver em quarentena? Uma seleção de materiais da Technostream (parte 4)</a></li>
<li><a href="../pt501986/index.html">Segredos do incrível sucesso do Apple AirPods</a></li>
<li><a href="../pt501988/index.html">Como a tela da mensagem VK é renderizada?</a></li>
<li><a href="../pt501990/index.html">Postagem útil: 4 eventos para resolver os problemas do segundo dia no OpenShift e criar operadores</a></li>
<li><a href="../pt501992/index.html">Como organizar os testes para acelerar e estabilizar os lançamentos de produtos. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>