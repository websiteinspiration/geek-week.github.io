<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍✈️ 👩‍👩‍👧‍👦 👩‍🏫 SDRとPythonを使用してアナログテレビを受け入れてデコードする 🔯 👺 🤽🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル。
 
 今日は、SDR受信と信号処理のトピックを続けます。読者の方からの質問を受けて、偶然アナログTVの受信にかなり興味を持ちました。ただし、信号サンプルの数が少ないため、これはそれほど単純ではないことが判明しました。多くの場所で、アナログTVはすでにオフになっています。リーダー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SDRとPythonを使用してアナログテレビを受け入れてデコードする</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482014/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は、SDR受信と信号処理のトピックを続けます。</font><font style="vertical-align: inherit;">読者の方からの質問を受けて、偶然アナログTVの受信にかなり興味を持ちました。</font><font style="vertical-align: inherit;">ただし、信号サンプルの数が少ないため、これはそれほど単純ではないことが判明しました。多くの場所で、アナログTVはすでにオフになっています。</font><font style="vertical-align: inherit;">リーダーはRTL-SDRで録音を送信しましたが、RTLの録音幅は約2 MHzですが、テレビ信号の帯域幅は約8 MHzであり、録音には何もはっきりしていません。</font><font style="vertical-align: inherit;">その結果、そのトピックは長い間見捨てられていましたが、ついに今、親戚との次の旅行で、私はSDRPlayを持って行き、TVチャンネルの周波数に合わせて、画面に目的の信号を確認しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pythonの小さなプログラムで、すべてが機能します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o4/t9/y4/o4t9y4lcex9vssgmpgc2vssujvu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
詳細に興味がある人のために、カットの下で続けられました。</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
戦後の昔、デジタル研究所が秘密の研究所でのみデジタル信号伝送について知っていたが、人々はすでにテレビを見たいと思っていたとき、3つの競合するアナログ規格がありました。 1つ目は、</font><font style="vertical-align: inherit;">40年代から開発さ</font><font style="vertical-align: inherit;">れたアメリカの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTSC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（National Television System System Committee）で、アメリカのネットワーク周波数60Hzで「シャープ」になり、垂直解像度は486ラインのみでした。少し後のドイツでは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Phase Alternating Line）</font><font style="vertical-align: inherit;">標準が開発され始めました</font><font style="vertical-align: inherit;">。これはアメリカの</font><font style="vertical-align: inherit;">標準</font><font style="vertical-align: inherit;">よりもわずかに優れており（「全体」の576ラインの解像度と50Hzのヨーロッパのネットワーク周波数に焦点を当てています）、少し後にフランスの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">SECAM</font></a><font style="vertical-align: inherit;">が登場しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Séquentielcouleuràmémoire）。色再現に関連するPALのいくつかの欠点を排除し、2つの規格の採用も政治的決定であるバージョンがあり、一部の国の居住者は他の国からの番組を見ることができませんでした（EUとシェンゲン連合が結ばれるまで約50年前） 。一つの方法または別の、しかし、全世界がこのように分割されました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i3/w7/qy/i3w7qyt3opicaz0prpryn9-9ha4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以来Habrはまだロシア語のサイトなので、将来的にはSECAMを検討しますが、誰かがサンプル信号PALを送信する場合も興味深いでしょう。</font><s><font style="vertical-align: inherit;">古いスクロール</font></s></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
に</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よると</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、SECAMスペクトル</font><font style="vertical-align: inherit;">は次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m-/t1/l9/m-t1l9ntpksl9ul6zoi4evslxac.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
左側の周波数F0は、振幅変調された輝度（L）信号です。これは実際には白黒の画像であり、古い画像でも表示できます</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暖かくてランプの</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">白黒テレビ。レガシーの問題とユーザー間での古いデバイスの存在はすでに存在していたため、カラーチャネルは個別に追加され、古いテレビとの互換性は失われませんでした。 2つのカラーチャネルが、周波数変調で周波数4.25 MHzと4.406 MHzで交互に送信されました。そして最後に、周波数がさらに高くなると、音も周波数変調で個別に送信されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみにサンクトペテルブルグでのテレビのレセプションでは面白い瞬間があります。ロシアのメディアによると、10月にアナログテレビがオフになりました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e_/ql/pm/e_qlpmgp7ukmcw5ag9ial0gozic.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、これは</font><i><font style="vertical-align: inherit;">州のチャンネルに</font></i><font style="vertical-align: inherit;">のみ適用され</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマーシャルが放送をオフにすることを強制する人はいません。</font><font style="vertical-align: inherit;">少なくとも執筆時点（2019年12月）では、サンクトペテルブルク中心部の「アナログ」で約5〜6のチャネルがまだ利用可能です。</font><font style="vertical-align: inherit;">しかし、それがどのくらい続くかは不明であるため、「履歴用」の信号サンプルを記録したい人は、まだ急いでいる必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、SDRをオンにして実際の</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/pc/6m/glpc6midlpecggjb4nknxhcvdkc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状況を確認します。サウンドチャネルは難しいものではありません。HDSDRの「マウス」でそれを確認し、帯域幅が約50KHzのFMを選択して聴くことができます。</font><font style="vertical-align: inherit;">明るさチャネルからデコードを開始します。これにより、既製の「画像」を取得できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解読</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上述したように、輝度信号はＡＭに送信される。デコーダーを自分で作成しないために、GNUラジオを使用します。スペクトルをゼロ周波数に転送し、AMデコーダーを起動して、結果をファイルに保存します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/n2/wf/xpn2wfbovg--y915lex2kesd1we.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、保存したファイルをPythonで開くことができます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<font></font>
<font></font>
<font></font>
lum_data = np.fromfile(<span class="hljs-string">"pal_lum.raw"</span>, dtype=<span class="hljs-string">'int32'</span>)<font></font>
lum_data = -lum_data - <span class="hljs-number">4700</span><font></font>
<font></font>
fs = <span class="hljs-number">9000000</span>//<span class="hljs-number">2</span>
x_time = np.linspace(<span class="hljs-number">0</span>, len(lum_data)/fs, num=len(lum_data))<font></font>
plt.plot(x_time, lum_data)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画面に4フレームのシーケンスが表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f5/yq/4a/f5yq4aeks144gso4-_73qcmn0t8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1フレームの長さ0.02s-これはちょうど1/50-は、信号が「クロックジェネレーター」として機能する50Hzネットワーク周波数の倍数です（信号がアナログであることを忘れないでください）。各フレームでは、320ラインが送信されます。インターレーススキャンなので、最終的なフレームレートは25 Hzです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
個々のラインをさらに詳しく見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j6/ly/7g/j6ly7gfmqmev6rlumkfudjgc8k4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、各ラインの先頭は「クロック」に対応し、信号の振幅はこのラインの現在の輝度値に対応しています。すべてが非常に単純で、おそらくほとんど変化がないので、そのような信号はテレビのブラウン管に適用されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りは技術の問題です。</font><font style="vertical-align: inherit;">メモリ内に画像を作成し、それに2つのフレームをコピーします。</font><font style="vertical-align: inherit;">インターレースしました。</font><font style="vertical-align: inherit;">信号スパンは+200を超えないため、これらの値をRGBカラーとして直接書き込むことができます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># Output image</span>
frame_size = fs*<span class="hljs-number">1</span>//<span class="hljs-number">50</span><font></font>
<font></font>
img_x, img_y = <span class="hljs-number">320</span>, <span class="hljs-number">650</span>
img_size = (img_y, img_x, <span class="hljs-number">3</span>)<font></font>
img_data = np.zeros(img_size, dtype=np.uint8)<font></font>
img_data.fill(<span class="hljs-number">255</span>)<font></font>
<font></font>
frame_num = <span class="hljs-number">0</span>
<span class="hljs-comment"># Frame #1</span>
pos_x, pos_y = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> px <span class="hljs-keyword">in</span> range(frame_num*frame_size, (frame_num+<span class="hljs-number">1</span>)*frame_size):<font></font>
    val = lum_data[px]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> val &lt; <span class="hljs-number">0</span>: val = <span class="hljs-number">0</span>
    <span class="hljs-keyword">if</span> val &gt; <span class="hljs-number">255</span>: val = <span class="hljs-number">255</span>
    img_data[pos_y][pos_x] = (<span class="hljs-number">0</span>, val, <span class="hljs-number">0</span>)<font></font>
    pos_x += <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> lum_data[px] &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> lum_data[px+<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>:<font></font>
        pos_x = <span class="hljs-number">0</span>
        pos_y += <span class="hljs-number">2</span><font></font>
<font></font>
print(<span class="hljs-string">"Scan lines 1:"</span>, pos_y)<font></font>
<font></font>
<span class="hljs-comment"># Frame #2</span>
pos_x, pos_y = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> px <span class="hljs-keyword">in</span> range((frame_num+<span class="hljs-number">1</span>)*frame_size, (frame_num+<span class="hljs-number">2</span>)*frame_size):<font></font>
    val = lum_data[px]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> val &lt; <span class="hljs-number">0</span>: val = <span class="hljs-number">0</span>
    <span class="hljs-keyword">if</span> val &gt; <span class="hljs-number">255</span>: val = <span class="hljs-number">255</span>
    img_data[pos_y+<span class="hljs-number">1</span>][pos_x] = (<span class="hljs-number">0</span>, val, <span class="hljs-number">0</span>)<font></font>
    pos_x += <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> lum_data[px] &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> lum_data[px+<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0</span>:<font></font>
        pos_x = <span class="hljs-number">0</span>
        pos_y += <span class="hljs-number">2</span><font></font>
<font></font>
img_resized = cv2.resize(img_data, dsize=(<span class="hljs-number">3</span>*img_x, img_y), interpolation=cv2.INTER_CUBIC)<font></font>
plt.imshow(img_resized, interpolation=<span class="hljs-string">'nearest'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のように、私はゼロクロッシングを使用して新しい行の開始を検出しています。</font><font style="vertical-align: inherit;">画像は垂直方向に圧縮されていることがわかりました。この場合、SDRのサンプリングレートによって異なりますが、結局、幅を大きくしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10フレームのアニメーションの最終結果（Habrファイルアーカイブを受け入れなくなりました）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k0/ah/ri/k0ahrixczcntxnwflutgq-aihpy.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような基準を分析することは興味深いです。</font><font style="vertical-align: inherit;">第一に、それらは実施するのが非常に簡単であり、第二に、彼らの研究はまた部分的に歴史的興味の対象です。</font><font style="vertical-align: inherit;">もちろん、私は本格的なソフトウェアテレビチューナーを作るという目標を持っていなかったので、コードは最小限の操作が可能な形式で示されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の評価が肯定的である場合、2番目の部分では、色を扱うことを検討し、本格的なカラー画像を表示することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自分で実験したい場合は、IQファイルを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ダウンロードでき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての成功した実験。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482002/index.html">マイクロサービスブログの作成-パート3「ユーザー」</a></li>
<li><a href="../ja482004/index.html">VPSサーバーで1Cをテストします</a></li>
<li><a href="../ja482008/index.html">レゴコンストラクターと絶対ゼロ</a></li>
<li><a href="../ja482010/index.html">「新しい叙事詩」。開発者、運用者、好奇心の強い人々のために</a></li>
<li><a href="../ja482012/index.html">Raspberry Piおよびiperf-スマートホームおよびIoTデバイス用の帯域幅テスター</a></li>
<li><a href="../ja482020/index.html">R、モンテカルロおよびエンタープライズタスク</a></li>
<li><a href="../ja482022/index.html">ほら見て！科学と科学者に関する20の映画</a></li>
<li><a href="../ja482028/index.html">2つの赤いボタン、はんだごてとReact：IT会議への移行方法</a></li>
<li><a href="../ja482030/index.html">Vue.js：サードパーティコンポーネントのライフサイクルフック</a></li>
<li><a href="../ja482032/index.html">火遊び：開発iPhone 7で任意のコードを起動</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>