<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¼â€ğŸ³ ğŸˆ·ï¸ ğŸ§™ğŸ» Linuxã®Cronï¼šå±¥æ­´ã€ä½¿ç”¨æ–¹æ³•ã€ãƒ‡ãƒã‚¤ã‚¹ ğŸšœ ğŸ˜ ğŸ‘­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤å…¸ã¯ãƒãƒƒãƒ”ãƒ¼ã‚¢ãƒ¯ãƒ¼ã¯è¦³å¯Ÿã•ã‚Œãªã„ã¨æ›¸ã„ã¦ã„ã‚‹ã€‚ãã®ã‚ˆã†ãªè’ã€…ã—ã„æ™‚ä»£ã«ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã‚‚Unixã‚‚ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€ä»Šæ—¥ã§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã¯éå¸¸ã«ã‚ˆãçŸ¥ã£ã¦ã„ã¾ã™ã€‚ãã‚Œã‚‰ã®ä»£ã‚ã‚Šã«ã€cronãŒæ™‚é–“ã«å¾“ã„ã¾ã™ã€‚
 

 . sed, awk, wc, cut . cron, 70-.
 

 cron...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linuxã®Cronï¼šå±¥æ­´ã€ä½¿ç”¨æ–¹æ³•ã€ãƒ‡ãƒã‚¤ã‚¹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/468061/"><img src="https://habrastorage.org/webt/tm/ya/6j/tmya6jd_1sbhnfncczo1nf2g7_y.jpeg"><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤å…¸ã¯ãƒãƒƒãƒ”ãƒ¼ã‚¢ãƒ¯ãƒ¼ã¯è¦³å¯Ÿã•ã‚Œãªã„ã¨æ›¸ã„ã¦ã„ã‚‹ã€‚</font><font style="vertical-align: inherit;">ãã®ã‚ˆã†ãªè’ã€…ã—ã„æ™‚ä»£ã«ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã‚‚Unixã‚‚ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€ä»Šæ—¥ã§ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã¯éå¸¸ã«ã‚ˆãçŸ¥ã£ã¦ã„ã¾ã™ã€‚ãã‚Œã‚‰ã®ä»£ã‚ã‚Šã«ã€cronãŒæ™‚é–“ã«å¾“ã„ã¾ã™ã€‚</font></font></p><br>
<p>        . sed, awk, wc, cut          .         cron,    70-.</p><br>
<p>   cron ,    ,  ,      ,   .    ,       POSIX crontab,   cron    Linux     .</p><br>
<p> Linux     cron?       Unix?    !</p><a name="habracut"></a><br>
<h1 id="soderzhanie"></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">POSIX crontab</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  â€” Vixie cron 3.0pl1</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cron  Debian  Ubuntu</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cronie  Red Hat, Fedora  CentOS</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cronie  SLES  openSUSE</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Vixie cron</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a></li>
</ul><br>
<h1 id="proishozhdenie-vidov"> </h1><br>
<p>      â€”      .    ,      ,    .</p><br>
<p>Unix-       Version 7 Unix,   70-     Bell Labs        (. Ken Thompson).  c Version 7 Unix   cron,      .</p><br>
<p>  cron â€”  ,        :     ,        (/etc/lib/crontab)      ,      .</p><br>
<p>          Unix-  .</p><br>
<p>   crontab       1992       Unix-   â€” POSIX â€”    cron   -   -.</p><br>
<p> 1987    (. Paul Vixie),   Unix     cron,     ,     cron    -.</p><br>
<p>   Vixie cron    POSIX,        ,      ,      README:    ,    ,         .             ,        90-  Linux  Vixie cron         .</p><br>
<p> , Red Hat  SUSE   Vixie cron â€” cronie,  Debian  Ubuntu    Vixie cron   .</p><br>
<p>       POSIX   crontab,     ,   Vixie cron,    Vixie cron    Linux. , ,    â€”    cron.</p><br>
<h1 id="posix-crontab">POSIX crontab</h1><br>
<p>  cron    ,          ,     .</p><br>
<p>ron-     :    cron     crontab.     ,      ,         .</p><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> POSIX</a>           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">crontab</a>.     , , ,    .</p><br>
<p>  crontab    :      ,    ,        .    crontab:</p><br>
<pre><code class="plaintext hljs">crontab -e #   <font></font>
crontab -l #   <font></font>
crontab -r #   <font></font>
crontab path/to/file.crontab #     </code></pre><br>
<p>  <code>crontab -e</code>   ,      <code>EDITOR</code>.</p><br>
<p>     :</p><br>
<pre><code class="plaintext hljs"># - <font></font>
#<font></font>
# ,  <font></font>
* * * * * /path/to/exec -a -b -c<font></font>
# ,   10-   <font></font>
10 * * * * /path/to/exec -a -b -c<font></font>
# ,   10-           <font></font>
10 2 * * * /path/to/exec -a -b -c &gt; /tmp/cron-job-output.log</code></pre><br>
<p>   :  [1..60],  [0..23],   [1..31],  [1..12],   [0..6],  0 â€” . , ,  â€” ,      .</p><br>
<p>        :</p><br>
<pre><code class="plaintext hljs"># ,        <font></font>
1,10 * * * * /path/to/exec -a -b -c</code></pre><br>
<p>  :</p><br>
<pre><code class="plaintext hljs"># ,         <font></font>
0-9 * * * * /path/to/exec -a -b -c</code></pre><br>
<p>       POSIX  cron.allow  cron.deny   , ,     crontab      .       .</p><br>
<p> ,  ,        :</p><br>
<ol>
<li>HOME â€”   .</li>
<li>LOGNAME â€”  .</li>
<li>PATH â€” ,       .</li>
<li>SHELL â€”     .</li>
</ol><br>
<p>,  POSIX     ,      .</p><br>
<h1 id="hit-prodazh--vixie-cron-30pl1">  â€” Vixie cron 3.0pl1</h1><br>
<p>    cron â€” Vixie cron 3.0pl1,    comp.sources.unix  1992 .        .</p><br>
<p>Vixie cron     (cron  crontab).  ,                ,   crontab â€”    .</p><br>
<h3 id="tablica-zadach-i-fayly-konfiguracii">    </h3><br>
<p>     /etc/crontab.      Vixie cron    ,        ,     :</p><br>
<pre><code class="plaintext hljs">#     vlad<font></font>
* * * * * vlad /path/to/exec</code></pre><br>
<p>      /var/cron/tabs/username    .    crontab       .</p><br>
<p>  ,    crontab,    /var/cron/allow  /var/cron/deny,       .</p><br>
<h3 id="rasshirennyy-sintaksis"> </h3><br>
<p>   POSIX crontab             .</p><br>
<p>    : ,        (Mon, Tue   ):</p><br>
<pre><code class="plaintext hljs">#        <font></font>
* * * Jan Mon,Tue /path/to/exec</code></pre><br>
<p>  ,    :</p><br>
<pre><code class="plaintext hljs">#      <font></font>
*/2 * * * Mon,Tue /path/to/exec</code></pre><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">#            <font></font>
0-10/2 * * * * /path/to/exec</code></pre><br>
<p>     (reboot, yearly, annually, monthly, weekly, daily, midnight, hourly):</p><br>
<pre><code class="plaintext hljs">#    <font></font>
@reboot /exec/on/reboot<font></font>
#    <font></font>
@daily /exec/daily<font></font>
#    <font></font>
@hourly /exec/daily</code></pre><br>
<h3 id="sreda-vypolneniya-zadach">  </h3><br>
<p>Vixie cron     .</p><br>
<p>  USER, LOGNAME  HOME    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">passwd</a>.  PATH   "/usr/bin:/bin",  SHELL â€” "/bin/sh".   ,  LOGNAME,     .</p><br>
<p>   (  SHELL  HOME)   cron   .      bash   sh    :</p><br>
<pre><code class="plaintext hljs">SHELL=/bin/bash<font></font>
HOME=/tmp/<font></font>
# exec   bash-  /tmp/<font></font>
* * * * * /path/to/exec</code></pre><br>
<p>         ( cron   )    .</p><br>
<p>    crontab  ,     VISUAL  EDITOR.   ,    crontab,    ,   "/usr/ucb/vi" (ucb â€” , , University of California, Berkeley).</p><br>
<h1 id="cron-v-debian-i-ubuntu">cron  Debian  Ubuntu</h1><br>
<p> Debian     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>  Vixie cron 3.0pl1.    - ,       Vixie cron.   :  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">syslog</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SELinux</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">PAM</a>.</p><br>
<p>  ,    â€”      .</p><br>
<p>   Debian    /var/spool/cron/crontabs,      â€”  /etc/crontab.    Debian     /etc/cron.d,   cron   .      /etc/cron.allow  /etc/cron.deny.</p><br>
<p>      -  /bin/sh,     Debian   POSIX-  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">dash</a>,    -  (  ).</p><br>
<p> cron    Debian   systemd,       /lib/systemd/system/cron.service.      ,          ,    crontab   .</p><br>
<h1 id="cronie-v-redhat-fedora-i-centos">cronie  RedHat, Fedora  CentOS</h1><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cronie</a> â€”  Vixie cron  4.1.    Debian,   ,    PAM  SELinux,   ,      inotify   .</p><br>
<p>      :   â€”  /etc/crontab,      /etc/cron.d,     /var/spool/cron/crontabs.</p><br>
<p>    systemd,   â€” /lib/systemd/system/crond.service.</p><br>
<p> Red Hat-       /bin/sh,      bash.  ,     cron  /bin/sh   bash   POSIX-       ,    .</p><br>
<h1 id="cronie-v-sles-i-opensuse">cronie  SLES  openSUSE</h1><br>
<p>  SLES    openSUSE     cronie.      systemd,     /usr/lib/systemd/system/cron.service. : /etc/crontab, /etc/cron.d, /var/spool/cron/tabs.   /bin/sh     bash,   POSIX-  .</p><br>
<h1 id="ustroystvo-vixie-cron"> Vixie cron</h1><br>
<p>  cron    Vixie cron   ,      ,       .         .     cron       .</p><br>
<p>   cron           cron  â€” Vixie cron 3.0pl1.   ,    ifdef-    .</p><br>
<p>      :</p><br>
<ol>
<li> .</li>
<li>      .</li>
<li>   cron.</li>
<li> .</li>
</ol><br>
<p>   .</p><br>
<h3 id="inicializaciya"></h3><br>
<p>      cron    SIGCHLD  SIGHUP.          ,  â€”    -:</p><br>
<pre><code class="cpp hljs">signal(SIGCHLD, sigchld_handler);<font></font>
signal(SIGHUP, sighup_handler);</code></pre><br>
<p> cron     ,         cron.    -  PID- -, ,         :</p><br>
<pre><code class="cpp hljs">acquire_daemonlock(<span class="hljs-number">0</span>);<font></font>
set_cron_uid();<font></font>
set_cron_cwd();</code></pre><br>
<p>   ,      :</p><br>
<pre><code class="cpp hljs">setenv(<span class="hljs-string">"PATH"</span>, _PATH_DEFPATH, <span class="hljs-number">1</span>);</code></pre><br>
<p>  Â«Â»:      fork       ( setsid).       â€”    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">switch</span> (fork()) {
<span class="hljs-keyword">case</span> <span class="hljs-number">-1</span>:
    <span class="hljs-comment">/*      */</span>
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">break</span>;
<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
    <span class="hljs-comment">/*   */</span>
    (<span class="hljs-keyword">void</span>) setsid();
<span class="hljs-keyword">break</span>;
<span class="hljs-keyword">default</span>:
    <span class="hljs-comment">/*     */</span>
    _exit(<span class="hljs-number">0</span>);<font></font>
}<font></font>
</code></pre><br>
<p>      -.  ,   PID    .     :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*    */</span>
acquire_daemonlock(<span class="hljs-number">0</span>);<font></font>
<font></font>
<span class="hljs-comment">/*    */</span>
database.head = <span class="hljs-literal">NULL</span>;<font></font>
database.tail = <span class="hljs-literal">NULL</span>;<font></font>
database.mtime = (<span class="hljs-keyword">time_t</span>) <span class="hljs-number">0</span>;<font></font>
load_database(&amp;database);</code></pre><br>
<p> cron     .         .</p><br>
<h3 id="sbor-i-obnovlenie-spiska-zadach">    </h3><br>
<p>      load_database.     crontab     .      ,     .        .</p><br>
<p>        :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*     ,  */</span>
<span class="hljs-keyword">if</span> (syscron_stat.st_mtime) {<font></font>
    process_crontab(<span class="hljs-string">"root"</span>, <span class="hljs-string">"*system*"</span>,<font></font>
    SYSCRONTAB, &amp;syscron_stat,<font></font>
    &amp;new_db, old_db);<font></font>
}</code></pre><br>
<p>    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span> (<span class="hljs-literal">NULL</span> != (dp = readdir(dir))) {
    <span class="hljs-keyword">char</span>    fname[MAXNAMLEN+<span class="hljs-number">1</span>],<font></font>
            tabname[MAXNAMLEN+<span class="hljs-number">1</span>];
    <span class="hljs-comment">/*      */</span>
    <span class="hljs-keyword">if</span> (dp-&gt;d_name[<span class="hljs-number">0</span>] == <span class="hljs-string">'.'</span>)
            <span class="hljs-keyword">continue</span>;<font></font>
    (<span class="hljs-keyword">void</span>) <span class="hljs-built_in">strcpy</span>(fname, dp-&gt;d_name);
    <span class="hljs-built_in">sprintf</span>(tabname, CRON_TAB(fname));<font></font>
    process_crontab(fname, fname, tabname,<font></font>
                    &amp;statbuf, &amp;new_db, old_db);<font></font>
}<font></font>
</code></pre><br>
<p>      .</p><br>
<p>     process_crontab    ,     (    ),    load_user.      :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span> ((status = load_env(envstr, file)) &gt;= OK) {
    <span class="hljs-keyword">switch</span> (status) {
    <span class="hljs-keyword">case</span> ERR:<font></font>
        free_user(u);<font></font>
        u = <span class="hljs-literal">NULL</span>;
        <span class="hljs-keyword">goto</span> done;
    <span class="hljs-keyword">case</span> FALSE:<font></font>
        e = load_entry(file, <span class="hljs-literal">NULL</span>, pw, envp);
        <span class="hljs-keyword">if</span> (e) {<font></font>
            e-&gt;next = u-&gt;crontab;<font></font>
            u-&gt;crontab = e;<font></font>
        }<font></font>
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> TRUE:<font></font>
        envp = env_set(envp, envstr);<font></font>
        <span class="hljs-keyword">break</span>;<font></font>
    }<font></font>
}</code></pre><br>
<p>     (  VAR=value)  load_env / env_set,     (* * * * * /path/to/exec)  load_entry.</p><br>
<p> entry,   load_entry, â€”     ,     .        ,           :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*         passwd*/</span><font></font>
e-&gt;uid = pw-&gt;pw_uid;<font></font>
e-&gt;gid = pw-&gt;pw_gid;<font></font>
<font></font>
<span class="hljs-comment">/*    (/bin/sh),      */</span><font></font>
e-&gt;envp = env_copy(envp);<font></font>
<span class="hljs-keyword">if</span> (!env_get(<span class="hljs-string">"SHELL"</span>, e-&gt;envp)) {
    <span class="hljs-built_in">sprintf</span>(envstr, <span class="hljs-string">"SHELL=%s"</span>, _PATH_BSHELL);<font></font>
    e-&gt;envp = env_set(e-&gt;envp, envstr);<font></font>
}<font></font>
<span class="hljs-comment">/*   */</span>
<span class="hljs-keyword">if</span> (!env_get(<span class="hljs-string">"HOME"</span>, e-&gt;envp)) {
    <span class="hljs-built_in">sprintf</span>(envstr, <span class="hljs-string">"HOME=%s"</span>, pw-&gt;pw_dir);<font></font>
    e-&gt;envp = env_set(e-&gt;envp, envstr);<font></font>
}<font></font>
<span class="hljs-comment">/*     */</span>
<span class="hljs-keyword">if</span> (!env_get(<span class="hljs-string">"PATH"</span>, e-&gt;envp)) {
    <span class="hljs-built_in">sprintf</span>(envstr, <span class="hljs-string">"PATH=%s"</span>, _PATH_DEFPATH);<font></font>
    e-&gt;envp = env_set(e-&gt;envp, envstr);<font></font>
}<font></font>
<span class="hljs-comment">/*     passwd */</span>
<span class="hljs-built_in">sprintf</span>(envstr, <span class="hljs-string">"%s=%s"</span>, <span class="hljs-string">"LOGNAME"</span>, pw-&gt;pw_name);<font></font>
e-&gt;envp = env_set(e-&gt;envp, envstr);</code></pre><br>
<p>       .</p><br>
<h3 id="glavnyy-cikl"> </h3><br>
<p> cron  Version 7 Unix   :    ,           .          .</p><br>
<p> SysV    ,        ,    ,   30 .            ,       .</p><br>
<p>Vixie cron        ,    80-    Unix-   :</p><br>
<pre><code class="cpp hljs"><span class="hljs-comment">/*    */</span><font></font>
load_database(&amp;database);<font></font>
<span class="hljs-comment">/*  ,       */</span><font></font>
run_reboot_jobs(&amp;database);<font></font>
<span class="hljs-comment">/*  TargetTime    */</span><font></font>
cron_sync();<font></font>
<span class="hljs-keyword">while</span> (TRUE) {
    <span class="hljs-comment">/*  ,     TargetTime    ,    */</span><font></font>
    cron_sleep();<font></font>
<font></font>
    <span class="hljs-comment">/*   */</span><font></font>
    load_database(&amp;database);<font></font>
<font></font>
    <span class="hljs-comment">/*      */</span><font></font>
    cron_tick(&amp;database);<font></font>
<font></font>
    <span class="hljs-comment">/*  TargetTime     */</span>
    TargetTime += <span class="hljs-number">60</span>;<font></font>
}<font></font>
</code></pre><br>
<p>     cron_sleep,   job_runqueue (   )  do_command (   ).     .</p><br>
<h3 id="zapusk-zadachi"> </h3><br>
<p> do_command    Unix-,         fork.     ,  â€”    :</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">switch</span> (fork()) {
<span class="hljs-keyword">case</span> <span class="hljs-number">-1</span>:
    <span class="hljs-comment">/*   fork */</span>
    <span class="hljs-keyword">break</span>;
<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
    <span class="hljs-comment">/*  :          */</span>
    acquire_daemonlock(<span class="hljs-number">1</span>);
    <span class="hljs-comment">/*      */</span><font></font>
    child_process(e, u);<font></font>
    <span class="hljs-comment">/*       */</span><font></font>
    _exit(OK_EXIT);<font></font>
    <span class="hljs-keyword">break</span>;
<span class="hljs-keyword">default</span>:
    <span class="hljs-comment">/*     */</span>
    <span class="hljs-keyword">break</span>;<font></font>
}</code></pre><br>
<p> child_process   :         ,      (       MAILTO), , ,      .</p><br>
<p>     fork:</p><br>
<pre><code class="cpp hljs"><span class="hljs-keyword">switch</span> (vfork()) {
<span class="hljs-keyword">case</span> <span class="hljs-number">-1</span>:
    <span class="hljs-comment">/*      */</span>
    <span class="hljs-built_in">exit</span>(ERROR_EXIT);
<span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
    <span class="hljs-comment">/* -   ,   ..
     */</span>
    (<span class="hljs-keyword">void</span>) setsid();<font></font>
<font></font>
    <span class="hljs-comment">/*
     *     ,   
     */</span><font></font>
<font></font>
    <span class="hljs-comment">/*  ,    ,
     *      
     */</span><font></font>
    setgid(e-&gt;gid);<font></font>
    setuid(e-&gt;uid);<font></font>
    chdir(env_get(<span class="hljs-string">"HOME"</span>, e-&gt;envp));<font></font>
<font></font>
    <span class="hljs-comment">/*   
     */</span><font></font>
    {<font></font>
        <span class="hljs-comment">/*   SHELL      */</span>
        <span class="hljs-keyword">char</span>    *shell = env_get(<span class="hljs-string">"SHELL"</span>, e-&gt;envp);<font></font>
<font></font>
        <span class="hljs-comment">/*       ,
         *    ,        */</span>
        execle(shell, shell, <span class="hljs-string">"-c"</span>, e-&gt;cmd, (<span class="hljs-keyword">char</span> *)<span class="hljs-number">0</span>, e-&gt;envp);<font></font>
<font></font>
        <span class="hljs-comment">/*  â€”    ?   */</span>
        perror(<span class="hljs-string">"execl"</span>);<font></font>
        _exit(ERROR_EXIT);<font></font>
    }<font></font>
    <span class="hljs-keyword">break</span>;
<span class="hljs-keyword">default</span>:
    <span class="hljs-comment">/*    :      */</span>
    <span class="hljs-keyword">break</span>;<font></font>
}</code></pre><br>
<p>,  -,   cron. -  ,    ,  ,   .</p><br>
<h1 id="posleslovie"></h1><br>
<p>ron â€”      ,      Unix.     ,          .     ,    Ubuntu,    ,     ! ,      .</p><br>
<p> ,  ,     ,                 .</p><br>
<p>    cron: systemd-timers      ,  fcron      .       crontab.</p><br>
<p>,  Unix,           !</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja468047/index.html">lsFusionã§ã®éšå±¤ã®æ“ä½œ</a></li>
<li><a href="../ja468049/index.html">werfã‚’ä½¿ç”¨ã—ã¦è¤‡é›‘ãªHelmãƒãƒ£ãƒ¼ãƒˆã‚’å±•é–‹ã™ã‚‹</a></li>
<li><a href="../ja468051/index.html">100ãƒ«ãƒ¼ãƒ–ãƒ«ã®Windowsã‚µãƒ¼ãƒãƒ¼ãŒãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚ŒãŸVDSï¼šç¥è©±ã‹ç¾å®Ÿã‹ï¼Ÿ</a></li>
<li><a href="../ja468057/index.html">Unixãƒ©ã‚¤ã‚¯ãªOSé–‹ç™º-ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ã¨ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ï¼ˆ7ï¼‰</a></li>
<li><a href="../ja468059/index.html">ãƒã‚¤ã‚¯ã¨ã®2é€±ç›®ï¼šéš ã•ã‚ŒãŸãŸãã•ã‚“ã®ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã¨æ¥½ã—ã„ã‚µãƒ—ãƒ©ã‚¤ã‚ºã€ãã—ã¦ã„ãã¤ã‹ã®å•é¡Œ</a></li>
<li><a href="../ja468063/index.html">Angulareact</a></li>
<li><a href="../ja468065/index.html">çš†ã®ãŸã‚ã®ç²¾ç¥çš„ãªè£½å“ç®¡ç†ãƒ¢ãƒ‡ãƒ«</a></li>
<li><a href="../ja468067/index.html">ã‚¢ãƒ«ãƒ•ã‚¡åˆæˆã®ã—ãã¿</a></li>
<li><a href="../ja468071/index.html">Tungsten Labsã®CTOã§ã‚ã‚‹Eduard Medvedevæ°ï¼šã€Œãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãŒå¤§è¦æ¨¡ãªæå®³ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ã“ã‚ã¾ã§æˆé•·ã—ã¾ã—ãŸã€</a></li>
<li><a href="../ja468073/index.html">Andrei Terekhovï¼šã€Œã‚¢ãƒ¡ãƒªã‚«äººã®æ–¹ãŒã„ã„ã¨è¨€ã£ã¦ã„ã„ã»ã©è©±ã›ã¾ã™ãŒã€è»Šã¯æ•…éšœã—ã¾ã›ã‚“ã€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>