<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏾 👨🏽‍🔬 🛒 伟大的python运动数据处理教程 🐥 🚟 🤘🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在业余时间的最后几年，我参加了铁人三项赛。这项运动在世界许多国家非常受欢迎，尤其是在美国，澳大利亚和欧洲。目前在俄罗斯和独联体国家迅速普及。它涉及的是业余爱好者，而不是专业人士。与铁人三项比赛不同，铁人三项比赛包括参加比赛和为比赛做系统的准备，即使他们不是专业人士，也不仅仅是在游泳池里游泳，早上骑自...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>伟大的python运动数据处理教程</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500162/"><img src="https://habrastorage.org/webt/wd/xv/ft/wdxvftc1pifrlchwt7ddj8dxtos.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在业余时间的最后几年，我参加了铁人三项赛。这项运动在世界许多国家非常受欢迎，尤其是在美国，澳大利亚和欧洲。目前在俄罗斯和独联体国家迅速普及。它涉及的是业余爱好者，而不是专业人士。与铁人三项比赛不同，铁人三项比赛包括参加比赛和为比赛做系统的准备，即使他们不是专业人士，也不仅仅是在游泳池里游泳，早上骑自行车和慢跑。在您的朋友中肯定已经有至少一个“铁人”或计划成为一个铁人。大规模，多种距离和各种条件，一项三项运动-所有这些都有可能形成大量数据。每年，世界上都会举行数百项铁人三项比赛，数十万人参加。比赛由几个组织者举办。当然，它们每个人都以自己的权利发布结果。但是对于来自俄罗斯和某些独联体国家的运动员来说，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tristats.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将所有结果收集在一个位置上-在相同名称的网站上。这使得搜索结果非常方便，无论您是您的朋友还是竞争对手，甚至您的偶像。但是对我来说，它也提供了以编程方式分析大量结果的机会。结果发布在trilife：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请阅读</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是我的第一个此类项目，因为直到最近我才原则上开始进行数据分析以及使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，我想向您介绍这项工作的技术实施方式，尤其是在此过程中，各种细微差别浮出水面，有时需要采取特殊的方法。</font><font style="vertical-align: inherit;">这将涉及报废，解析，转换类型和格式，还原不完整的数据，创建有代表性的样本，可视化，向量​​化甚至并行计算。</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原来容量很大，所以我将所有内容分成五个部分，以便我可以分配信息并记住休息后从哪里开始。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在继续之前，最好先阅读一下研究结果的文章，因为这里基本上描述了其创造的厨房。</font><font style="vertical-align: inherit;">需要10到15分钟。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
你读了...吗？</font><font style="vertical-align: inherit;">那我们走吧！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1部分。刮取和解析</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
给出：网站</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tristats.ru</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们感兴趣的表有两种。这实际上是所有比赛的摘要表，以及每个比赛的结果协议。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/m5/do/vpm5dopzyltw9iwcwdddcff2osw.png"><br>
<br>
<img src="https://habrastorage.org/webt/yf/ez/ve/yfezve61_ds1wsaiguh5tjpwd2m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首要任务是以编程方式获取此数据并将其保存以备进一步处理。碰巧的是，那时我是Web技术的新手，因此并不立即知道该怎么做。我从了解的内容开始着手-查看页面代码。可以使用鼠标右键或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F12</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键完成此操作</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/43/wc/ex/43wcexjx3j9qfvjla_dubcsjgl0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome中的菜单包含两个选项：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看页面代码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看代码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。不是最明显的分裂。自然，它们给出不同的结果。</font><i><font style="vertical-align: inherit;">查看代码的</font></i><font style="vertical-align: inherit;">那个</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F12</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同</font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">浏览器中显示的内容</font><font style="vertical-align: inherit;">的直接文本</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示是元素方式的。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/ow/wb/vvowwbmi5fdawtjbocfjo5zztm4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
反过来，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看页面代码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将提供</font><i><font style="vertical-align: inherit;">页面</font></i><font style="vertical-align: inherit;">的源代码。也是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是那里没有数据，只有卸载它们的JS脚本的名称。好的。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o4/k7/d5/o4k7d5k8zuu66hp43vegbix9hoc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们需要了解如何使用python将每个页面的代码另存为单独的文本文件。我尝试这样：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> requests<font></font>
<font></font>
r = requests.get(url=<span class="hljs-string">'http://tristats.ru/'</span>)<font></font>
print(r.content)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我得到了源代码。但是我需要执行它的结果。经过研究，搜索和询问后，我意识到我需要一个自动执行浏览器操作的工具，例如</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硒</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我说了还有</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Chrome的</font></font></i><font style="vertical-align: inherit;"><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ChromeDriver</font></a></i><font style="vertical-align: inherit;">。然后我按如下方式使用它：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.chrome.service <span class="hljs-keyword">import</span> Service<font></font>
<font></font>
service = Service(<span class="hljs-string">r'C:\ChromeDriver\chromedriver.exe'</span>)<font></font>
service.start()<font></font>
driver = webdriver.Remote(service.service_url)<font></font>
driver.get(<span class="hljs-string">'http://www.tristats.ru/'</span>)<font></font>
print(driver.page_source)<font></font>
driver.quit()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此代码将启动浏览器窗口，并在其中打开指定URL的页面。结果，我们</font><font style="vertical-align: inherit;">已经</font><font style="vertical-align: inherit;">获得</font><font style="vertical-align: inherit;">了带有所需数据的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码。但是有一个障碍。结果只有100个参赛者，比赛的总数几乎是2000。事实是，最初只有前100个条目显示在浏览器中，并且只有滚动到页面的最底部时，才会加载下100个条目，依此类推。因此，有必要以编程方式实现滚动。为此，请使用以下命令：</font></font><br>
<br>
<pre><code class="python hljs">driver.execute_script(<span class="hljs-string">"window.scrollTo(0, document.body.scrollHeight);"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每次滚动时，我们都会检查加载页面的代码是否已更改。</font><font style="vertical-align: inherit;">如果没有更改，我们将检查几次可靠性（例如10），则整个页面已加载，您可以停止。</font><font style="vertical-align: inherit;">在滚动之间，我们将超时设置为一秒，以便页面有时间加载。</font><font style="vertical-align: inherit;">（即使她没有时间，我们也有保留时间-另外9秒）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完整的代码如下所示：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">from</span> selenium.webdriver.chrome.service <span class="hljs-keyword">import</span> Service
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
service = Service(<span class="hljs-string">r'C:\ChromeDriver\chromedriver.exe'</span>)<font></font>
service.start()<font></font>
driver = webdriver.Remote(service.service_url)<font></font>
driver.get(<span class="hljs-string">'http://www.tristats.ru/'</span>)<font></font>
prev_html = <span class="hljs-string">''</span>
scroll_attempt = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-keyword">while</span> scroll_attempt &lt; <span class="hljs-number">10</span>:<font></font>
    driver.execute_script(<span class="hljs-string">"window.scrollTo(0, document.body.scrollHeight);"</span>)<font></font>
    time.sleep(<span class="hljs-number">1</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> prev_html == driver.page_source:<font></font>
        scroll_attempt += <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>:<font></font>
        prev_html = driver.page_source<font></font>
        scroll_attempt = <span class="hljs-number">0</span> <font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    f.write(prev_html)<font></font>
<font></font>
driver.quit()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们有一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，其中包含所有种族的摘要表。</font><font style="vertical-align: inherit;">需要解析它。</font><font style="vertical-align: inherit;">为此，请使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lxml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> html
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们找到表的所有行。</font><font style="vertical-align: inherit;">要确定字符串的符号，只需</font><font style="vertical-align: inherit;">在文本编辑器中</font><font style="vertical-align: inherit;">查看</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b2/j6/_8/b2j6_8isg6smzxbgkojrppfwif4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例如，它可以是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ tr ng-repeat ='r in racesData'class ='ng-scope'”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或某些无法在任何标签中找到的片段。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    sum_html = f.read()<font></font>
<font></font>
tree = html.fromstring(sum_html)<font></font>
rows = tree.findall(<span class="hljs-string">".//*[@ng-repeat='r in racesData']"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后我们启动</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas数据框</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并将表格每一行的每个元素写入此数据框。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<font></font>
<font></font>
rs = pd.DataFrame(columns=[<span class="hljs-string">'date'</span>,<span class="hljs-string">'name'</span>,<span class="hljs-string">'link'</span>,<span class="hljs-string">'males'</span>,<span class="hljs-string">'females'</span>,<span class="hljs-string">'rus'</span>,<span class="hljs-string">'total'</span>], index=range(len(rows))) <span class="hljs-comment">#rs – races summary</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了弄清楚每个特定元素的隐藏位置，您只需要</font><font style="vertical-align: inherit;">在同一文本编辑器中</font><font style="vertical-align: inherit;">查看</font><i><font style="vertical-align: inherit;">行</font></i><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">元素之一</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">ng-repeat</span>=<span class="hljs-string">"r in racesData"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-scope"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>2015-04-26<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/Images/flags/24/USA.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flag"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>Ironman Texas 70.3 2015<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015?sex=F"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>605<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-venus fa-lg"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:Pink"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><font></font>
      /<font></font>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015?sex=M"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>1539<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-mars fa-lg"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:LightBlue"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/Images/flags/24/rus.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flag"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- ngIf: r.CountryCount == 0 --&gt;</span>
      <span class="hljs-comment">&lt;!-- ngIf: r.CountryCount &gt; 0 --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">ng-if</span>=<span class="hljs-string">"r.CountryCount &gt; 0"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/rus/result/ironman/texas/half/2015?country=rus"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_self"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ng-binding ng-scope"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- end ngIf: r.CountryCount &gt; 0 --&gt;</span><font></font>
      / 2144<font></font>
  <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里为儿童进行硬编码导航的最简单方法是，其中没有很多儿童。 </font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(rows)):<font></font>
    rs.loc[i,<span class="hljs-string">'date'</span>] = rows[i].getchildren()[<span class="hljs-number">0</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'name'</span>] = rows[i].getchildren()[<span class="hljs-number">1</span>].getchildren()[<span class="hljs-number">1</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'link'</span>] = rows[i].getchildren()[<span class="hljs-number">1</span>].getchildren()[<span class="hljs-number">1</span>].attrib[<span class="hljs-string">'href'</span>].strip()<font></font>
    rs.loc[i,<span class="hljs-string">'males'</span>] = rows[i].getchildren()[<span class="hljs-number">2</span>].getchildren()[<span class="hljs-number">2</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'females'</span>] = rows[i].getchildren()[<span class="hljs-number">2</span>].getchildren()[<span class="hljs-number">0</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'rus'</span>] = rows[i].getchildren()[<span class="hljs-number">3</span>].getchildren()[<span class="hljs-number">3</span>].text.strip()<font></font>
    rs.loc[i,<span class="hljs-string">'total'</span>] = rows[i].getchildren()[<span class="hljs-number">3</span>].text_content().split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>].strip()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果如下：</font><font style="vertical-align: inherit;">
将数据框保存到文件中。</font><font style="vertical-align: inherit;">我使用</font><i><font style="vertical-align: inherit;">pickle</font></i><font style="vertical-align: inherit;">，但可能是</font><i><font style="vertical-align: inherit;">csv</font></i><font style="vertical-align: inherit;">或其他名称。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>date</th>
<th>event</th>
<th>link</th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
</tr>
<tr>
<td>0</td>
<td>2020-07-02</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>/rus/result/ironman/dubai-duathlon/half/2020</td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
</tr>
<tr>
<td>1</td>
<td>2020-02-07</td>
<td>Ironman Dubai 70.3 2020</td>
<td>/rus/result/ironman/dubai/half/2020</td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
</tr>
<tr>
<td>2</td>
<td>2020-01-29</td>
<td>Israman Half 2020</td>
<td>/rus/result/israman/israman/half/2020</td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
</tr>
<tr>
<td>3</td>
<td>2019-12-08</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>/rus/result/ironman/indian-wells-la-quinta/hal...</td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
</tr>
<tr>
<td>4</td>
<td>2019-12-07</td>
<td>Ironman Taupo 70.3 2019</td>
<td>/rus/result/ironman/taupo/half/2019</td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>1917</td>
<td>1994-07-02</td>
<td>ITU European Championship Eichstatt Olympic 1994</td>
<td>/rus/result/itu/european-championship-eichstat...</td>
<td>61</td>
<td>0</td>
<td>2</td>
<td>61</td>
</tr>
<tr>
<td>1918</td>
<td>1993-09-04</td>
<td>Challenge Almere-Amsterdam Long 1993</td>
<td>/rus/result/challenge/almere-amsterdam/full/1993</td>
<td>795</td>
<td>32</td>
<td>1</td>
<td>827</td>
</tr>
<tr>
<td>1919</td>
<td>1993-07-04</td>
<td>ITU European Cup Echternach Olympic 1993</td>
<td>/rus/result/itu/european-cup-echternach/olympi...</td>
<td>60</td>
<td>0</td>
<td>2</td>
<td>60</td>
</tr>
<tr>
<td>1920</td>
<td>1992-09-12</td>
<td>ITU World Championship Huntsville Olympic 1992</td>
<td>/rus/result/itu/world-championship-huntsville/...</td>
<td>317</td>
<td>0</td>
<td>3</td>
<td>317</td>
</tr>
<tr>
<td>1921</td>
<td>1990-09-15</td>
<td>ITU World Championship Orlando Olympic 1990</td>
<td>/rus/result/itu/world-championship-orlando/oly...</td>
<td>286</td>
<td>0</td>
<td>5</td>
<td>28</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pickle <span class="hljs-keyword">as</span> pkl<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(df,f)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此阶段，所有数据均为字符串类型。</font><font style="vertical-align: inherit;">我们稍后会进行转换。</font><font style="vertical-align: inherit;">我们现在最需要的是链接。</font><font style="vertical-align: inherit;">我们会将它们用于所有种族的抓取协议。</font><font style="vertical-align: inherit;">我们以数据透视表的图像和相似性进行制作。</font><font style="vertical-align: inherit;">在每个种族的周期中，我们将通过引用打开页面，滚动并获取页面代码。</font><font style="vertical-align: inherit;">在摘要表中，我们提供了有关比赛参与者总数的信息- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将使用它来了解直到需要继续滚动到什么位置为止。为此，我们将直接在抓取每个页面的过程中确定表中的记录数，并将其与合计的期望值进行比较。一旦相等，我们就会滚动到结尾，您可以继续进行下一场比赛。我们还将超时设置为60秒。在这段时间吃，我们没有得到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，进入下一场比赛。页面代码将保存到文件中。我们将所有种族的文件保存在一个文件夹中，并以种族名称（即</font><font style="vertical-align: inherit;">摘要表</font><font style="vertical-align: inherit;">中“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">值）命名</font><font style="vertical-align: inherit;">。为避免名称冲突，必须在数据透视表中所有种族具有不同的名称。检查一下：</font></font><br>
<br>
<pre><code class="python hljs">df[df.duplicated(subset = <span class="hljs-string">'event'</span>, keep=<span class="hljs-literal">False</span>)]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>date</th>
<th>event</th>
<th>link</th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
</tr>
<tr>
<td>450</td>
<td>2018-07-15</td>
<td>A1  Sprint 2018</td>
<td>/rus/result/a1/cc/sprint/2018-07-15</td>
<td>43</td>
<td>15</td>
<td>47</td>
<td>58</td>
</tr>
<tr>
<td>483</td>
<td>2018-06-23</td>
<td>A1  Sprint 2018</td>
<td>/rus/result/a1/cc/sprint/2018-06-23</td>
<td>61</td>
<td>15</td>
<td>76</td>
<td>76</td>
</tr>
<tr>
<td>670</td>
<td>2017-07-30</td>
<td>3Grom  Olympic 2017</td>
<td>/rus/result/3grom//olympic/2017-07-30</td>
<td>249</td>
<td>44</td>
<td>293</td>
<td>293</td>
</tr>
<tr>
<td>752</td>
<td>2017-06-11</td>
<td>3Grom  Olympic 2017</td>
<td>/rus/result/3grom//olympic/2017-06-11</td>
<td>251</td>
<td>28</td>
<td>279</td>
<td>279</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好吧，在汇总表中，还有重复项，日期和参与者的数量（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">男性，女性，rus，总数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并且链接是不同的。</font><font style="vertical-align: inherit;">您需要检查这些协议，因为它们很少，因此您可以手动执行。</font><font style="vertical-align: inherit;">现在所有名称都是唯一的，我们启动了一个大型的挖掘周期：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/a8/v7/n8/a8v7n8qoxbzobftxcm0knnvks6m.png"><br>
<br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>date</th>
<th>event</th>
<th>link</th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
</tr>
<tr>
<td>450</td>
<td>2018-07-15</td>
<td>A1  Sprint <u>7</u> 2018</td>
<td>/rus/result/a1/cc/sprint/2018-07-15</td>
<td>43</td>
<td>15</td>
<td>47</td>
<td>58</td>
</tr>
<tr>
<td>483</td>
<td>2018-06-23</td>
<td>A1  Sprint <u>6</u> 2018</td>
<td>/rus/result/a1/cc/sprint/2018-06-23</td>
<td>61</td>
<td>15</td>
<td>76</td>
<td>76</td>
</tr>
<tr>
<td>670</td>
<td>2017-07-30</td>
<td>3Grom  Olympic <u>7</u> 2017</td>
<td>/rus/result/3grom//olympic/2017-07-30</td>
<td>249</td>
<td>44</td>
<td>293</td>
<td>293</td>
</tr>
<tr>
<td>752</td>
<td>2017-06-11</td>
<td>3Grom  Olympic <u>6</u> 2017</td>
<td>/rus/result/3grom//olympic/2017-06-11</td>
<td>251</td>
<td>28</td>
<td>279</td>
<td>27</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">service.start()<font></font>
driver = webdriver.Remote(service.service_url)<font></font>
timeout = <span class="hljs-number">60</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> df.iterrows():
    <span class="hljs-keyword">try</span>:<font></font>
        driver.get(<span class="hljs-string">'http://www.tristats.ru'</span> + row[<span class="hljs-string">'link'</span>])     <font></font>
        start = time.time()<font></font>
<font></font>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
            driver.execute_script(<span class="hljs-string">"window.scrollTo(0, document.body.scrollHeight);"</span>)<font></font>
            time.sleep(<span class="hljs-number">1</span>)<font></font>
            race_html = driver.page_source<font></font>
            tree = html.fromstring(race_html)<font></font>
            race_rows = tree.findall(<span class="hljs-string">".//*[@ng-repeat='r in resultsData']"</span>)<font></font>
<font></font>
            <span class="hljs-keyword">if</span> len(race_rows) == int(row[<span class="hljs-string">'total'</span>]):
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">if</span> time.time() - start &gt; timeout:<font></font>
                print(<span class="hljs-string">'timeout'</span>)
                <span class="hljs-keyword">break</span><font></font>
<font></font>
        <span class="hljs-keyword">with</span> open(os.path.join(<span class="hljs-string">r'D:\tri\races'</span>, row[<span class="hljs-string">'event'</span>] +  <span class="hljs-string">'.txt'</span>), <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:<font></font>
            f.write(race_html)<font></font>
<font></font>
    <span class="hljs-keyword">except</span>:<font></font>
        traceback.print_exc()<font></font>
<font></font>
    time.sleep(<span class="hljs-number">1</span>)<font></font>
    <font></font>
driver.quit()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是一个漫长的过程。</font><font style="vertical-align: inherit;">但是，当一切都设置好之后，这种繁琐的机制开始旋转，一个又一个地添加数据文件时，就会产生一种令人兴奋的感觉。</font><font style="vertical-align: inherit;">每分钟仅加载大约三个协议，非常缓慢。</font><font style="vertical-align: inherit;">左转过夜。</font><font style="vertical-align: inherit;">花了大约10个小时。</font><font style="vertical-align: inherit;">到早上，大多数协议都已上传。</font><font style="vertical-align: inherit;">在使用网络时，通常会发生一些故障。</font><font style="vertical-align: inherit;">再次尝试快速恢复它们。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/un/wi/el/unwielrqjzt6u6otf8sbwwjbq8q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们有1,922个文件，总容量接近3 GB。凉！但是处理近300场比赛以超时结束。有什么事？选择性地检查，结果证明确实来自数据透视表的总值与我们检查的竞争协议中的条目数可能不一致。这很可悲，因为尚不清楚造成这种差异的原因是什么。要么是由于并非所有人都会完成任务，要么是由于数据库中存在某种错误。通常，数据不完整的第一个信号。无论如何，我们都会检查条目数为100或0的条目，这些条目是最可疑的候选人。一共有八个。在严密控制下再次下载它们。顺便说一句，其中两个实际上有100个条目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，我们有所有数据。</font><font style="vertical-align: inherit;">我们通过解析。</font><font style="vertical-align: inherit;">同样，在一个周期中，我们将运行每个种族，读取文件，并将内容保存在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas DataFrame中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将这些数据帧组合成</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dict</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中种族的名称将为键-也就是说，</font><font style="vertical-align: inherit;">数据透视表中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">或具有</font><font style="vertical-align: inherit;">种族页面</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码</font><font style="vertical-align: inherit;">的文件的名称是</font><font style="vertical-align: inherit;">重合的。</font></font><br>
<br>
<pre><code class="python hljs">rd = {} <span class="hljs-comment">#rd – race details</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rs[<span class="hljs-string">'event'</span>]:<font></font>
    place = []<font></font>
    ... sex = [], name=..., country, group, place_in_group, swim, t1, bike, t2, run<font></font>
    result = []<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(os.path.join(<span class="hljs-string">r'D:\tri\races'</span>, e + <span class="hljs-string">'.txt'</span>), <span class="hljs-string">'r'</span>)<font></font>
        race_html = f.read()<font></font>
<font></font>
    tree = html.fromstring(race_html)<font></font>
    rows = tree.findall(<span class="hljs-string">".//*[@ng-repeat='r in resultsData']"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(len(rows)):<font></font>
        row = rows[j]<font></font>
        parts = row.text_content().split(<span class="hljs-string">'\n'</span>)<font></font>
        parts = [r.strip() <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> parts <span class="hljs-keyword">if</span> r.strip() != <span class="hljs-string">''</span>]<font></font>
        place.append(parts[<span class="hljs-number">0</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> len([a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> row.findall(<span class="hljs-string">'.//i'</span>)]) &gt; <span class="hljs-number">0</span>:<font></font>
            sex.append([a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> row.findall(<span class="hljs-string">'.//i'</span>)][<span class="hljs-number">0</span>].attrib[<span class="hljs-string">'ng-if'</span>][<span class="hljs-number">10</span>:<span class="hljs-number">-1</span>])
        <span class="hljs-keyword">else</span>:<font></font>
            sex.append(<span class="hljs-string">''</span>)<font></font>
<font></font>
        name.append(parts[<span class="hljs-number">1</span>])<font></font>
<font></font>
        <span class="hljs-keyword">if</span> len(parts) &gt; <span class="hljs-number">10</span>:<font></font>
            country.append(parts[<span class="hljs-number">2</span>].strip())         <font></font>
            k=<span class="hljs-number">0</span>
        <span class="hljs-keyword">else</span>:<font></font>
            country.append(<span class="hljs-string">''</span>)<font></font>
            k=<span class="hljs-number">1</span><font></font>
<font></font>
        group.append(parts[<span class="hljs-number">3</span>-k])<font></font>
        ... place_in_group.append(...), swim.append ..., t1, bike, t2, run<font></font>
        result.append(parts[<span class="hljs-number">10</span>-k])<font></font>
<font></font>
    race = pd.DataFrame()<font></font>
    race[<span class="hljs-string">'place'</span>] = place<font></font>
    ... race[<span class="hljs-string">'sex'</span>] = sex, race[<span class="hljs-string">'name'</span>] = ..., <span class="hljs-string">'country'</span>, <span class="hljs-string">'group'</span>, <span class="hljs-string">'place_in_group'</span>, <span class="hljs-string">'swim'</span>, <span class="hljs-string">' t1'</span>, <span class="hljs-string">'bike'</span>, <span class="hljs-string">'t2'</span>, <span class="hljs-string">'run'</span>
    race[<span class="hljs-string">'result'</span>] = result<font></font>
<font></font>
    rd[e] = race<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\details.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(rd,f)<font></font>
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>swim</th>
<th>t1</th>
<th>bike</th>
<th>t2</th>
<th>run</th>
<th>result</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Reed, Tim</td>
<td>AUS</td>
<td>MPRO</td>
<td>1</td>
<td>24:34</td>
<td>1:07</td>
<td>2:13:46</td>
<td>1:49</td>
<td>1:23:17</td>
<td>4:04:33</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Van Berkel, Tim</td>
<td>AUS</td>
<td>MPRO</td>
<td>2</td>
<td>24:34</td>
<td>1:05</td>
<td>2:13:47</td>
<td>1:53</td>
<td>1:27:17</td>
<td>4:08:36</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Baldwin, Nicholas</td>
<td>SEY</td>
<td>MPRO</td>
<td>3</td>
<td>26:31</td>
<td>0:59</td>
<td>2:14:06</td>
<td>1:54</td>
<td>1:25:36</td>
<td>4:09:06</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>M</td>
<td>Polizzi, Alexander</td>
<td>AUS</td>
<td>MPRO</td>
<td>4</td>
<td>23:21</td>
<td>1:12</td>
<td>2:14:53</td>
<td>1:54</td>
<td>1:31:16</td>
<td>4:12:36</td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td>Chang, Chia-Hao</td>
<td>TWN</td>
<td>M18-24</td>
<td>1</td>
<td>25:18</td>
<td>1:34</td>
<td>2:23:38</td>
<td>2:13</td>
<td>1:29:01</td>
<td>4:21:44</td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td>Rondy, Guillaume</td>
<td>FRA</td>
<td>M35-39</td>
<td>1</td>
<td>27:51</td>
<td>1:26</td>
<td>2:21:53</td>
<td>2:29</td>
<td>1:35:19</td>
<td>4:28:58</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>F</td>
<td>Steffen, Caroline</td>
<td>SUI</td>
<td>FPRO</td>
<td>1</td>
<td>26:52</td>
<td>1:01</td>
<td>2:24:54</td>
<td>2:10</td>
<td>1:34:17</td>
<td>4:29:14</td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td>Betten, Sam</td>
<td>AUS</td>
<td>MPRO</td>
<td>5</td>
<td>23:30</td>
<td>1:26</td>
<td>2:18:24</td>
<td>1:57</td>
<td>1:45:07</td>
<td>4:30:24</td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td>Gallot, Simon</td>
<td>FRA</td>
<td>M30-34</td>
<td>1</td>
<td>27:50</td>
<td>1:33</td>
<td>2:20:15</td>
<td>2:13</td>
<td>1:45:22</td>
<td>4:37:13</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>524</td>
<td>525</td>
<td>M</td>
<td>Santos, Alfredo</td>
<td>PHI</td>
<td>M65-69</td>
<td>2</td>
<td>50:42</td>
<td>4:23</td>
<td>3:52:10</td>
<td>10:32</td>
<td>3:36:11</td>
<td>8:33:58</td>
</tr>
<tr>
<td>525</td>
<td>526</td>
<td>F</td>
<td>Escober, Eula</td>
<td>PHI</td>
<td>F18-24</td>
<td>5</td>
<td>47:07</td>
<td>3:50</td>
<td>4:43:44</td>
<td>3:41</td>
<td>2:59:45</td>
<td>8:38:07</td>
</tr>
<tr>
<td>526</td>
<td>527</td>
<td>M</td>
<td>Belen, Virgilio Jr.</td>
<td>PHI</td>
<td>M45-49</td>
<td>76</td>
<td>47:05</td>
<td>5:49</td>
<td>3:48:18</td>
<td>11:21</td>
<td>3:46:06</td>
<td>8:38:39</td>
</tr>
<tr>
<td>527</td>
<td>528</td>
<td>M</td>
<td>Kunimoto, Kilhak</td>
<td>GUM</td>
<td>M70-74</td>
<td>2</td>
<td>40:32</td>
<td>2:50</td>
<td>3:53:37</td>
<td>6:45</td>
<td>4:01:36</td>
<td>8:45:20</td>
</tr>
<tr>
<td>528</td>
<td>529</td>
<td>M</td>
<td>Sumicad, Siegfred</td>
<td>PHI</td>
<td>M50-54</td>
<td>54</td>
<td>59:10</td>
<td>4:38</td>
<td>4:11:55</td>
<td>6:35</td>
<td>3:23:45</td>
<td>8:46:03</td>
</tr>
<tr>
<td>529</td>
<td>530</td>
<td>M</td>
<td>Gomez, Paul</td>
<td>PHI</td>
<td>M45-49</td>
<td>77</td>
<td>50:02</td>
<td>6:29</td>
<td>4:07:58</td>
<td>7:24</td>
<td>3:41:41</td>
<td>8:53:34</td>
</tr>
<tr>
<td>530</td>
<td>531</td>
<td>M</td>
<td>Ramos, John Raymund</td>
<td>PHI</td>
<td>M25-29</td>
<td>26</td>
<td>43:44</td>
<td>3:04</td>
<td>4:21:13</td>
<td>5:56</td>
<td>3:45:10</td>
<td>8:59:07</td>
</tr>
<tr>
<td>531</td>
<td>532</td>
<td>F</td>
<td>De Guzman, Clouie Anne</td>
<td>PHI</td>
<td>F30-34</td>
<td>9</td>
<td>52:29</td>
<td>3:16</td>
<td>4:03:02</td>
<td>7:01</td>
<td>3:56:39</td>
<td>9:02:27</td>
</tr>
<tr>
<td>532</td>
<td>533</td>
<td>F</td>
<td>Samson, Maria Dolores</td>
<td>PHI</td>
<td>F45-49</td>
<td>17</td>
<td>48:56</td>
<td>4:21</td>
<td>4:16:34</td>
<td>6:26</td>
<td>3:47:06</td>
<td>9:03:23</td>
</tr>
<tr>
<td>533</td>
<td>534</td>
<td>M</td>
<td>Salazar, Richard</td>
<td>PHI</td>
<td>M40-44</td>
<td>107</td>
<td>42:19</td>
<td>4:02</td>
<td>4:30:36</td>
<td>6:39</td>
<td>3:39:51</td>
<td>9:03:27</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了</font><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">参赛者成绩的表格之外</font><font style="vertical-align: inherit;">，每个比赛</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件还包含比赛的日期，名称和地点。</font><font style="vertical-align: inherit;">日期和名称已经在数据透视表中，但是没有位置。</font><font style="vertical-align: inherit;">我们从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">读取此信息</font><font style="vertical-align: inherit;">，并将其添加到数据透视表中的新列中。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]       
    <span class="hljs-keyword">with</span> open(os.path.join(<span class="hljs-string">r'D:\tri\races'</span>, e + <span class="hljs-string">'.txt'</span>), <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:<font></font>
        race_html = f.read()<font></font>
<font></font>
    tree = html.fromstring(race_html)<font></font>
    header_elem = [tb <span class="hljs-keyword">for</span> tb <span class="hljs-keyword">in</span> tree.findall(<span class="hljs-string">'.//tbody'</span>) <span class="hljs-keyword">if</span> tb.getchildren()[<span class="hljs-number">0</span>].getchildren()[<span class="hljs-number">0</span>].text == <span class="hljs-string">''</span>][<span class="hljs-number">0</span>]<font></font>
    location = header_elem.getchildren()[<span class="hljs-number">1</span>].getchildren()[<span class="hljs-number">1</span>].text.strip()<font></font>
    rs.loc[index, <span class="hljs-string">'loc'</span>] = location
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th><u>loc</u></th>
<th>male</th>
<th>female</th>
<th>rus</th>
<th>total</th>
<th>link</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td><u>Israel, Eilat</u></td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td><u>Indian Wells/La Quinta, California, USA</u></td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td><u>New Zealand</u></td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td><u>Manama, Bahrain</u></td>
<td>858</td>
<td>214</td>
<td>38</td>
<td>1072</td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td><u>Busselton, Western Australia</u></td>
<td>940</td>
<td>229</td>
<td>1</td>
<td>1169</td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td><u>Mar del Plata, Argentina</u></td>
<td>506</td>
<td>66</td>
<td>3</td>
<td>572</td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td><u>Cozumel, Mexico</u></td>
<td>1158</td>
<td>395</td>
<td>12</td>
<td>1553</td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td><u>Tempe, Arizona, USA</u></td>
<td>1697</td>
<td>633</td>
<td>3</td>
<td>2330</td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td><u>Xiamen, China</u></td>
<td>897</td>
<td>170</td>
<td>14</td>
<td>1067</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">救。</font><font style="vertical-align: inherit;">到一个新文件。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary1.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(df,f)<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2部分。类型转换和格式化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们下载了所有数据并将其放入数据框中。</font><font style="vertical-align: inherit;">但是，所有值均为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这适用于日期，结果，位置和所有其他参数。</font><font style="vertical-align: inherit;">所有参数都必须转换为适当的类型。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们从数据透视表开始。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th><u>loc</u></th>
<th>male</th>
<th>female</th>
<th>rus</th>
<th>total</th>
<th>link</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td><u>Israel, Eilat</u></td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td><u>Indian Wells/La Quinta, California, USA</u></td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td><u>New Zealand</u></td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td><u>Manama, Bahrain</u></td>
<td>858</td>
<td>214</td>
<td>38</td>
<td>1072</td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td><u>Busselton, Western Australia</u></td>
<td>940</td>
<td>229</td>
<td>1</td>
<td>1169</td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td><u>Mar del Plata, Argentina</u></td>
<td>506</td>
<td>66</td>
<td>3</td>
<td>572</td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td><u>Cozumel, Mexico</u></td>
<td>1158</td>
<td>395</td>
<td>12</td>
<td>1553</td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td><u>Tempe, Arizona, USA</u></td>
<td>1697</td>
<td>633</td>
<td>3</td>
<td>2330</td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td><u>Xiamen, China</u></td>
<td>897</td>
<td>170</td>
<td>14</td>
<td>1067</td>
<td>...</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td><u>...</u></td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table></div></code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期和时间</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">event</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将保持</font><i><font style="vertical-align: inherit;">不变</font></i><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">熊猫日期时间</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'date'</span>] = pd.to_datetime(rs[<span class="hljs-string">'date'</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其余的转换为整数类型：</font></font><br>
<br>
<pre><code class="python hljs">cols = [<span class="hljs-string">'males'</span>, <span class="hljs-string">'females'</span>, <span class="hljs-string">'rus'</span>, <span class="hljs-string">'total'</span>]<font></font>
rs[cols] = rs[cols].astype(int)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切顺利，没有出现错误。</font><font style="vertical-align: inherit;">这样就可以了-保存：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\summary2.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(rs, f)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在正在竞速数据帧。</font><font style="vertical-align: inherit;">由于所有种族更方便，更快速地一次处理，而不是一次处理，因此我们将</font><font style="vertical-align: inherit;">使用</font><i><font style="vertical-align: inherit;">concat</font></i><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">将它们收集到一个大的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据帧</font><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有记录的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简称</font><font style="vertical-align: inherit;">）中</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar = pd.concat(rd) 
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含1,416,365个条目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，将位置和组中的位置转换为整数值。</font></font><br>
<br>
<pre><code class="python hljs">ar[[<span class="hljs-string">'place'</span>, <span class="hljs-string">'place in group'</span>]] = ar[[<span class="hljs-string">'place'</span>, <span class="hljs-string">'place in group'</span>]].astype(int))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，我们使用临时值处理列。</font><font style="vertical-align: inherit;">我们将它们</font><font style="vertical-align: inherit;">从</font><i><font style="vertical-align: inherit;">熊猫</font></i><font style="vertical-align: inherit;">中以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timedelta</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font><i><font style="vertical-align: inherit;">投放</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，要使转换成功，您需要正确准备数据。</font><font style="vertical-align: inherit;">您可以看到一些小于一个小时的值没有指定提示。</font><font style="vertical-align: inherit;">需要添加它。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th><u>swim</u></th>
<th><u>t1</u></th>
<th>bike</th>
<th><u>t2</u></th>
<th>run</th>
<th>result</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Dejan Patrcevic</td>
<td>CRO</td>
<td>M40-44</td>
<td>1</td>
<td><u>29:03</u></td>
<td><u>2:50</u></td>
<td>2:09:17</td>
<td><u>1:37</u></td>
<td>1:22:06</td>
<td>4:04:51</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Lukas Krpec</td>
<td>CZE</td>
<td>M35-39</td>
<td>1</td>
<td><u>29:00</u></td>
<td><u>2:40</u></td>
<td>2:07:01</td>
<td><u>1:48</u></td>
<td>1:25:48</td>
<td>4:06:15</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Marin Koceic</td>
<td>CRO</td>
<td>M40-44</td>
<td>2</td>
<td><u>27:34</u></td>
<td><u>2:09</u></td>
<td>2:12:13</td>
<td><u>1:30</u></td>
<td>1:27:19</td>
<td>4:10:44</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> [<span class="hljs-string">'swim'</span>, <span class="hljs-string">'t1'</span>, <span class="hljs-string">'bike'</span>, <span class="hljs-string">'t2'</span>, <span class="hljs-string">'run'</span>, <span class="hljs-string">'result'</span>]:<font></font>
    strlen = ar[col].str.len()<font></font>
    ar.loc[strlen==<span class="hljs-number">5</span>, col] = <span class="hljs-string">'0:'</span> + ar.loc[strlen==<span class="hljs-number">5</span>, col]<font></font>
    ar.loc[strlen==<span class="hljs-number">4</span>, col] = <span class="hljs-string">'0:0'</span> + ar.loc[strlen==<span class="hljs-number">4</span>, col]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，仍然剩余的字符串看起来像这样：</font><font style="vertical-align: inherit;">转换为</font><i><font style="vertical-align: inherit;">Timedelta</font></i><font style="vertical-align: inherit;">：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th><u>swim</u></th>
<th><u>t1</u></th>
<th>bike</th>
<th><u>t2</u></th>
<th>run</th>
<th>result</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Dejan Patrcevic</td>
<td>CRO</td>
<td>M40-44</td>
<td>1</td>
<td><u>0:29:03</u></td>
<td><u>0:02:50</u></td>
<td>2:09:17</td>
<td><u>0:01:37</u></td>
<td>1:22:06</td>
<td>4:04:51</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Lukas Krpec</td>
<td>CZE</td>
<td>M35-39</td>
<td>1</td>
<td><u>0:29:00</u></td>
<td><u>0:02:40</u></td>
<td>2:07:01</td>
<td><u>0:01:48</u></td>
<td>1:25:48</td>
<td>4:06:15</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Marin Koceic</td>
<td>CRO</td>
<td>M40-44</td>
<td>2</td>
<td><u>0:27:34</u></td>
<td><u>0:02:09</u></td>
<td>2:12:13</td>
<td><u>0:01:30</u></td>
<td>1:27:19</td>
<td>4:10:44</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> [<span class="hljs-string">'swim'</span>, <span class="hljs-string">'t1'</span>, <span class="hljs-string">'bike'</span>, <span class="hljs-string">'t2'</span>, <span class="hljs-string">'run'</span>, <span class="hljs-string">'result'</span>]:<font></font>
    ar[col] = pd.to_timedelta(ar[col])<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地板</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
继续。</font><font style="vertical-align: inherit;">检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性别</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">中是否只有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'sex'</span>].unique() 
</code></pre><br>
<code><b>Out:</b> ['M', 'F', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，仍然存在一个空字符串，即未指定性别。</font><font style="vertical-align: inherit;">让我们看看有多少种这样的情况：</font></font><br>
<br>
<pre><code class="python hljs">len(ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">''</span>]) 
</code></pre><br>
<code><b>Out:</b> 2538<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没什么好。</font><font style="vertical-align: inherit;">将来，我们将尝试进一步降低该值。</font><font style="vertical-align: inherit;">同时，将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性别</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列保留</font><font style="vertical-align: inherit;">为线条形式。</font><font style="vertical-align: inherit;">我们将保存结果，然后再进行更严重和风险更大的转换。</font><font style="vertical-align: inherit;">为了保持文件之间的连续性，我们将组合的数据帧</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar转换</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回数据帧</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的字典</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> ar.index.get_level_values(<span class="hljs-number">0</span>).unique():<font></font>
    rd[event] = ar.loc[event]<font></font>
<font></font>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\details1.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
    pkl.dump(rd,f)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顺便说一下，由于某些列类型的转换，数据表的大小从数据透视表的367 KB减少到295 KB，对于竞速协议从251 MB减少到168 MB。 </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家代码</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在让我们看看这个国家。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'country'</span>].unique()
</code></pre><br>
<code><b>Out:</b> ['CRO', 'CZE', 'SLO', 'SRB', 'BUL', 'SVK', 'SWE', 'BIH', 'POL', 'MK', 'ROU', 'GRE', 'FRA', 'HUN', 'NOR', 'AUT', 'MNE', 'GBR', 'RUS', 'UAE', 'USA', 'GER', 'URU', 'CRC', 'ITA', 'DEN', 'TUR', 'SUI', 'MEX', 'BLR', 'EST', 'NED', 'AUS', 'BGI', 'BEL', 'ESP', 'POR', 'UKR', 'CAN', 'IRL', 'JPN', 'HKG', 'JEY', 'SGP', 'BRA', 'QAT', 'LUX', 'RSA', 'NZL', 'LAT', 'PHI', 'KSA', 'SEY', 'MAS', 'OMA', 'ARG', 'ECU', 'THA', 'JOR', 'BRN', 'CIV', 'FIN', 'IRN', 'BER', 'LBA', 'KUW', 'LTU', 'SRI', 'HON', 'INA', 'LBN', 'PAN', 'EGY', 'MLT', 'WAL', 'ISL', 'CYP', 'DOM', 'IND', 'VIE', 'MRI', 'AZE', 'MLD', 'LIE', 'VEN', 'ALG', 'SYR', 'MAR', 'KZK', 'PER', 'COL', 'IRQ', 'PAK', 'CZK', 'KAZ', 'CHN', 'NEP', 'ISR', 'MKD', 'FRO', 'BAN', 'ARU', 'CPV', 'ALB', 'BIZ', 'TPE', 'KGZ', 'BNN', 'CUB', 'SNG', 'VTN', 'THI', 'PRG', 'KOR', 'RE', 'TW', 'VN', 'MOL', 'FRE', 'AND', 'MDV', 'GUA', 'MON', 'ARM', 'F.I.TRI.', 'BAHREIN', 'SUECIA', 'REPUBLICA CHECA', 'BRASIL', 'CHI', 'MDA', 'TUN', 'NDL', 'Danish(Dane)', 'Welsh', 'Austrian', 'Unknown', 'AFG', 'Argentinean', 'Pitcairn', 'South African', 'Greenland', 'ESTADOS UNIDOS', 'LUXEMBURGO', 'SUDAFRICA', 'NUEVA ZELANDA', 'RUMANIA', 'PM', 'BAH', 'LTV', 'ESA', 'LAB', 'GIB', 'GUT', 'SAR', 'ita', 'aut', 'ger', 'esp', 'gbr', 'hun', 'den', 'usa', 'sui', 'slo', 'cze', 'svk', 'fra', 'fin', 'isr', 'irn', 'irl', 'bel', 'ned', 'sco', 'pol', 'SMR', 'mex', 'STEEL T BG', 'KINO MANA', 'IVB', 'TCH', 'SCO', 'KEN', 'BAS', 'ZIM', 'Joe', 'PUR', 'SWZ', 'Mark', 'WLS', 'MYA', 'BOT', 'REU', 'NAM', 'NCL', 'BOL', 'GGY', 'ISV', 'TWN', 'GUM', 'FIJ', 'COK', 'NGR', 'IRI', 'GAB', 'ANT', 'GEO', 'COG', 'sue', 'SUD', 'BAR', 'CAY', 'BO', 'VE', 'AX', 'MD', 'PAR', 'UM', 'SEN', 'NIG', 'RWA', 'YEM', 'PLE', 'GHA', 'ITU', 'UZB', 'MGL', 'MAC', 'DMA', 'TAH', 'TTO', 'AHO', 'JAM', 'SKN', 'GRN', 'PRK', 'NFK', 'SOL', 'Sandy', 'SAM', 'PNG', 'SGS', 'Suchy, Jorg', 'SOG', 'GEQ', 'BVT', 'DJI', 'CHA', 'ANG', 'YUG', 'IOT', 'HAI', 'SJM', 'CUW', 'BHU', 'ERI', 'FLK', 'HMD', 'GUF', 'ESH', 'sandy', 'UMI', 'selsmark, 'Alise', 'Eddie', '31/3, Colin', 'CC', '', '', '', '', '', ' ', '', '', '', '-', '', 'GRL', 'UGA', 'VAT', 'ETH', 'ASA', 'PYF', 'ATA', 'ALA', 'MTQ', 'ZZ', 'CXR', 'AIA', 'TJK', 'GUY', 'KR', 'PF', 'BN', 'MO', 'LA', 'CAM', 'NCA', 'ZAM', 'MAD', 'TOG', 'VIR', 'ATF', 'VAN', 'SLE', 'GLP', 'SCG', 'LAO', 'IMN', 'BUR', 'IR', 'SY', 'CMR', 'GBS', 'SUR', 'MOZ', 'BLM', 'MSR', 'CAF', 'BEN', 'COD', 'CCK', 'TUV', 'TGA', 'GI', 'XKX', 'NRU', 'NC', 'LBR', 'TAN', 'VIN', 'SSD', 'GP', 'PS', 'IM', 'JE', '', 'MLI', 'FSM', 'LCA', 'GMB', 'MHL', 'NH', 'FL', 'CT', 'UT', 'AQ', 'Korea', 'Taiwan', 'NewCaledonia', 'Czech Republic', 'PLW', 'BRU', 'RUN', 'NIU', 'KIR', 'SOM', 'TKM', 'SPM', 'BDI', 'COM', 'TCA', 'SHN', 'DO2', 'DCF', 'PCN', 'MNP', 'MYT', 'SXM', 'MAF', 'GUI', 'AN', 'Slovak republic', 'Channel Islands', 'Reunion', 'Wales', 'Scotland', 'ica', 'WLF', 'D', 'F', 'I', 'B', 'L', 'E', 'A', 'S', 'N', 'H', 'R', 'NU', 'BES', 'Bavaria', 'TLS', 'J', 'TKL', 'Tirol"', 'P', '?????', 'EU', 'ES-IB', 'ES-CT', '', 'SOO', 'LZE', '', '', '', '', '', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
412个唯一值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本上，一个国家用大写的三位字母代码表示。</font><font style="vertical-align: inherit;">但是显然，并非总是如此。</font><font style="vertical-align: inherit;">实际上，有一个国际标准</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISO 3166</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中对所有国家（包括已经不存在的国家）都规定了相应的三位数和两位数代码。</font><font style="vertical-align: inherit;">对于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在</font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pycountry</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包中找到该标准的一种实现</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">运作方式如下：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pycountry <span class="hljs-keyword">as</span> pyco<font></font>
<font></font>
pyco.countries.get(alpha_3 = <span class="hljs-string">'RUS'</span>)
</code></pre><br>
<code><b>Out:</b> Country(alpha_2='RU', alpha_3='RUS', name='Russian Federation', numeric='643')<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们将检查所有三位数字的代码，以大写字母表示，并在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">country.get（...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Historic_countries.get（...）中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出响应</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">valid_a3 = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> ar[<span class="hljs-string">'country'</span>].unique() <span class="hljs-keyword">if</span> pyco.countries.get(alpha_3 = c.upper()) != <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> pyco.historic_countries.get(alpha_3 = c.upper()) != <span class="hljs-literal">None</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在412个中，有190个，不到一半。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于其余的222个（我们用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tofix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示其列表</font><font style="vertical-align: inherit;">），我们将</font><i><font style="vertical-align: inherit;">创建一个</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配字典</font><font style="vertical-align: inherit;">，其中的键将是原始名称，值将是根据ISO标准的三位数代码。</font></font><br>
<br>
<pre><code class="python hljs">tofix = list(set(ar[<span class="hljs-string">'country'</span>].unique()) - set(valid_a3))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pycountry.countries.get（alpha_2 = ...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查两位数的代码</font><font style="vertical-align: inherit;">，导致大写：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> icc <span class="hljs-keyword">in</span> tofix: <span class="hljs-comment">#icc -invalid country code</span>
    <span class="hljs-keyword">if</span> pyco.countries.get(alpha_2 = icc.upper()) != <span class="hljs-literal">None</span>:<font></font>
        fix[icc] = pyco.countries.get(alpha_2 = icc.upper()).alpha_3<font></font>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> pyco.historic_countries.get(alpha_2 = icc.upper()) != <span class="hljs-literal">None</span>:<font></font>
            fix[icc] = pyco.historic_countries.get(alpha_2 = icc.upper()).alpha_3<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pycountry.countries.get（name = ...），pycountry.countries.get（common_name = ...）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的全名</font><font style="vertical-align: inherit;">，将其引导为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str.title（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> icc <span class="hljs-keyword">in</span> tofix:
    <span class="hljs-keyword">if</span> pyco.countries.get(common_name = icc.title()) != <span class="hljs-literal">None</span>:<font></font>
        fix[icc] = pyco.countries.get(common_name = icc.title()).alpha_3<font></font>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">if</span> pyco.countries.get(name = icc.title()) != <span class="hljs-literal">None</span>:<font></font>
            fix[icc] = pyco.countries.get(name = icc.title()).alpha_3<font></font>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">if</span> pyco.historic_countries.get(name = icc.title()) != <span class="hljs-literal">None</span>:<font></font>
                fix[icc] = pyco.historic_countries.get(name = icc.title()).alpha_3<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们将无法识别的值的数量减少到190个。仍然很多：</font><font style="vertical-align: inherit;">
您可能会注意到其中仍然有很多三位数的代码，但这不是ISO。</font><font style="vertical-align: inherit;">然后怎样呢？</font><font style="vertical-align: inherit;">事实证明，还有另一个标准- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">奥林匹克运动会</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不幸的是，它的实现不包含在pycountry中，您必须寻找其他东西。</font><font style="vertical-align: inherit;">在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">datahub.io</font></a><font style="vertical-align: inherit;">上以</font><i><font style="vertical-align: inherit;">csv</font></i><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">的形式找到了解决方案</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将此文件的内容</font><i><font style="vertical-align: inherit;">放在</font></i><font style="vertical-align: inherit;">名为</font><i><font style="vertical-align: inherit;">cdf</font></i><font style="vertical-align: inherit;">的</font><i><font style="vertical-align: inherit;">pandas DataFrame中</font></i><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">国际奥委会</font></i><font style="vertical-align: inherit;"> - Intenational奥林匹克委员会（IOC）</font></font><br>
<code>['URU', '', 'PAR', 'SUECIA', 'KUW', 'South African', '', 'Austrian', 'ISV', 'H', 'SCO', 'ES-CT', ', 'GUI', 'BOT', 'SEY', 'BIZ', 'LAB', 'PUR', ' ', 'Scotland', '', '', 'TCH', 'TGA', 'UT', 'BAH', 'GEQ', 'NEP', 'TAH', 'ica', 'FRE', 'E', 'TOG', 'MYA', '', 'Danish (Dane)', 'SAM', 'TPE', 'MON', 'ger', 'Unknown', 'sui', 'R', 'SUI', 'A', 'GRN', 'KZK', 'Wales', '', 'GBS', 'ESA', 'Bavaria', 'Czech Republic', '31/3, Colin', 'SOL', 'SKN', '', 'MGL', 'XKX', 'WLS', 'MOL', 'FIJ', 'CAY', 'ES-IB', 'BER', 'PLE', 'MRI', 'B', 'KSA', '', '', 'LAT', 'GRE', 'ARU', '', 'THI', 'NGR', 'MAD', 'SOG', 'MLD', '?????', 'AHO', 'sco', 'UAE', 'RUMANIA', 'CRO', 'RSA', 'NUEVA ZELANDA', 'KINO MANA', 'PHI', 'sue', 'Tirol"', 'IRI', 'POR', 'CZK', 'SAR', 'D', 'BRASIL', 'DCF', 'HAI', 'ned', 'N', 'BAHREIN', 'VTN', 'EU', 'CAM', 'Mark', 'BUL', 'Welsh', 'VIN', 'HON', 'ESTADOS UNIDOS', 'I', 'GUA', 'OMA', 'CRC', 'PRG', 'NIG', 'BHU', 'Joe', 'GER', 'RUN', 'ALG', '', 'Channel Islands', 'Reunion', 'REPUBLICA CHECA', 'slo', 'ANG', 'NewCaledonia', 'GUT', 'VIE', 'ASA', 'BAR', 'SRI', 'L', '', 'J', 'BAS', 'LUXEMBURGO', 'S', 'CHI', 'SNG', 'BNN', 'den', 'F.I.TRI.', 'STEEL T BG', 'NCA', 'Slovak republic', 'MAS', 'LZE', '-', 'F', 'BRU', '', 'LBA', 'NDL', 'DEN', 'IVB', 'BAN', 'Sandy', 'ZAM', 'sandy', 'Korea', 'SOO', 'BGI', '', 'LTV', 'selsmark, Alise', 'TAN', 'NED', '', 'Suchy, Jorg', 'SLO', 'SUDAFRICA', 'ZIM', 'Eddie', 'INA', '', 'SUD', 'VAN', 'FL', 'P', 'ITU', 'ZZ', 'Argentinean', 'CHA', 'DO2', 'WAL']<br>
</code><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>official name</th>
<th>short name</th>
<th>iso2</th>
<th><u>iso3</u></th>
<th><u>ioc</u></th>
</tr>
<tr>
<td>0</td>
<td>NaN</td>
<td>Taiwan</td>
<td>TW</td>
<td><u>TWN</u></td>
<td><u>TPE</u></td>
</tr>
<tr>
<td>1</td>
<td>Afghanistan</td>
<td>Afghanistan</td>
<td>AF</td>
<td><u>AFG</u></td>
<td><u>AFG</u></td>
</tr>
<tr>
<td>2</td>
<td>Albania</td>
<td>Albania</td>
<td>AL</td>
<td><u>ALB</u></td>
<td><u>ALB</u></td>
</tr>
<tr>
<td>3</td>
<td>Algeria</td>
<td>Algeria</td>
<td>DZ</td>
<td><u>DZA</u></td>
<td><u>ALG</u></td>
</tr>
<tr>
<td>4</td>
<td>American Samoa</td>
<td>American Samoa</td>
<td>AS</td>
<td><u>ASM</u></td>
<td><u>ASA</u></td>
</tr>
<tr>
<td>5</td>
<td>Andorra</td>
<td>Andorra</td>
<td>AD</td>
<td><u>AND</u></td>
<td><u>AND</u></td>
</tr>
<tr>
<td>6</td>
<td>Angola</td>
<td>Angola</td>
<td>AO</td>
<td><u>AGO</u></td>
<td><u>ANG</u></td>
</tr>
<tr>
<td>7</td>
<td>Anguilla</td>
<td>Anguilla</td>
<td>AI</td>
<td><u>AIA</u></td>
<td><u>AIA</u></td>
</tr>
<tr>
<td>8</td>
<td>Antarctica</td>
<td>Antarctica</td>
<td>AQ</td>
<td><u>ATA</u></td>
<td><u>NaN</u></td>
</tr>
<tr>
<td>9</td>
<td>Antigua and Barbuda</td>
<td>Antigua &amp; Barbuda</td>
<td>AG</td>
<td><u>ATG</u></td>
<td><u>ANT</u></td>
</tr>
<tr>
<td>10</td>
<td>Argentina</td>
<td>Argentina</td>
<td>AR</td>
<td><u>ARG</u></td>
<td><u>ARG</u></td>
</tr>
</tbody></table></div></code><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">len(([x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tofix <span class="hljs-keyword">if</span> x.upper() <span class="hljs-keyword">in</span> list(cdf[<span class="hljs-string">'ioc'</span>])]))
</code></pre><br>
<code><b>Out:</b> 82<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tofix</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的三位数代码中，</font><i><font style="vertical-align: inherit;">找到了</font></i><font style="vertical-align: inherit;"> 82个相应的</font><i><font style="vertical-align: inherit;">IOC</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将它们添加到我们的匹配字典中。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> icc <span class="hljs-keyword">in</span> tofix:
    <span class="hljs-keyword">if</span> icc.upper() <span class="hljs-keyword">in</span> list(cdf[<span class="hljs-string">'ioc'</span>]):<font></font>
        ind = cdf[cdf[<span class="hljs-string">'ioc'</span>] == icc.upper()].index[<span class="hljs-number">0</span>]<font></font>
        fix[icc] = cdf.loc[ind, <span class="hljs-string">'iso3'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还剩108个原始值。</font><font style="vertical-align: inherit;">它们是手动完成的，有时会向Google寻求帮助。</font><font style="vertical-align: inherit;">
但是，即使手动控制也不能完全解决问题。</font><font style="vertical-align: inherit;">剩下49个已经无法解释的值。</font><font style="vertical-align: inherit;">这些值大多数可能只是数据错误。</font></font><br>
<code>{'BGI': 'BRB', 'WAL': 'GBR', 'MLD': 'MDA', 'KZK': 'KAZ', 'CZK': 'CZE', 'BNN': 'BEN', 'SNG': 'SGP', 'VTN': 'VNM', 'THI': 'THA', 'PRG': 'PRT', 'MOL': 'MDA', 'FRE': 'FRA', 'F.I.TRI.': 'ITA', 'BAHREIN': 'BHR', 'SUECIA': 'SWE', 'REPUBLICA CHECA': 'CZE', 'BRASIL': 'BRA', 'NDL': 'NLD', 'Danish (Dane)': 'DNK', 'Welsh': 'GBR', 'Austrian': 'AUT', 'Argentinean': 'ARG', 'South African': 'ZAF', 'ESTADOS UNIDOS': 'USA', 'LUXEMBURGO': 'LUX', 'SUDAFRICA': 'ZAF', 'NUEVA ZELANDA': 'NZL', 'RUMANIA': 'ROU', 'sco': 'GBR', 'SCO': 'GBR', 'WLS': 'GBR', '': 'IND', '': 'IRL', '': 'ARM', '': 'BGR', '': 'SRB', ' ': 'BLR', '': 'GBR', '': 'FRA', '': 'HND', '-': 'CRI', '': 'AZE', 'Korea': 'KOR', 'NewCaledonia': 'FRA', 'Czech Republic': 'CZE', 'Slovak republic': 'SVK', 'Channel Islands': 'FRA', 'Reunion': 'FRA', 'Wales': 'GBR', 'Scotland': 'GBR', 'Bavaria': 'DEU', 'Tirol"': 'AUT', '': 'KGZ', '': 'BLR', '': 'BLR', '': 'BLR', '': 'RUS', '': 'BLR', '': 'RUS'}<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">unfixed = [x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tofix <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> fix.keys()]
</code></pre><br>
<code><b>Out:</b> ['', 'H', 'ES-CT', 'LAB', 'TCH', 'UT', 'TAH', 'ica', 'E', 'Unknown', 'R', 'A', '31/3, Colin', 'XKX', 'ES-IB','B','SOG','?????','KINO MANA','sue','SAR','D', 'DCF', 'N', 'EU', 'Mark', 'I', 'Joe', 'RUN', 'GUT', 'L', 'J', 'BAS', 'S', 'STEEL T BG', 'LZE', 'F', 'Sandy', 'DO2', 'sandy', 'SOO', 'LTV', 'selsmark, Alise', 'Suchy, Jorg' 'Eddie', 'FL', 'P', 'ITU', 'ZZ']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这些关键字在匹配的字典中将有一个空字符串。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> unfixed:<font></font>
    fix[cc] = <span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我们向匹配的字典代码添加有效的但以小写形式编写的字典代码。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> valid_a3:
    <span class="hljs-keyword">if</span> cc.upper() != cc:<font></font>
        fix[cc] = cc.upper()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在是时候应用找到的替代品了。</font><font style="vertical-align: inherit;">要保存初始数据以进行进一步比较，请将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">country</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列复制</font><font style="vertical-align: inherit;">到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">country raw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，使用创建的匹配字典，我们在</font><font style="vertical-align: inherit;">不对应于ISO </font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家/地区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">值中进行</font><font style="vertical-align: inherit;">校正</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> fix:<font></font>
    ind = ar[ar[<span class="hljs-string">'country'</span>] == cc].index<font></font>
    ar.loc[ind,<span class="hljs-string">'country'</span>] = fix[cc]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，这里不能没有向量化，表几乎有一百五十万行。</font><font style="vertical-align: inherit;">但是根据字典，我们做一个循环，但是还有什么呢？</font><font style="vertical-align: inherit;">检查更改了多少条记录：</font></font><br>
<br>
<pre><code class="python hljs">len(ar[ar[<span class="hljs-string">'country'</span>] != ar[<span class="hljs-string">'country raw'</span>]])
</code></pre><br>
<code><b>Out:</b> 315955<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也就是说，占总数的20％以上。 </font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'country'</span>] != ar[<span class="hljs-string">'country raw'</span>]].sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th><u>country</u></th>
<th>group</th>
<th>place in group</th>
<th>...</th>
<th><u>country raw</u></th>
</tr>
<tr>
<td>285</td>
<td>286</td>
<td>M</td>
<td>Albaek, Mads Orla</td>
<td><u>DNK</u></td>
<td>M30-34</td>
<td>63</td>
<td>...</td>
<td><u>DEN</u></td>
</tr>
<tr>
<td>1288</td>
<td>1289</td>
<td>M</td>
<td>Benthien, Andreas</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>198</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>490</td>
<td>491</td>
<td>M</td>
<td>Lontok, Joselito</td>
<td><u>PHL</u></td>
<td>M50-54</td>
<td>18</td>
<td>...</td>
<td><u>PHI</u></td>
</tr>
<tr>
<td>145</td>
<td>146</td>
<td>M</td>
<td>Mathiasen, Keld</td>
<td><u>DNK</u></td>
<td>M45-49</td>
<td>16</td>
<td>...</td>
<td><u>DEN</u></td>
</tr>
<tr>
<td>445</td>
<td>446</td>
<td>M</td>
<td>Palm, Francois</td>
<td><u>ZAF</u></td>
<td>M25-29</td>
<td>48</td>
<td>...</td>
<td><u>RSA</u></td>
</tr>
<tr>
<td>152</td>
<td>153</td>
<td>M</td>
<td>Muller, Johannes</td>
<td><u>DEU</u></td>
<td>M35-39</td>
<td>19</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>764</td>
<td>765</td>
<td>F</td>
<td>Woscher Sylvia</td>
<td><u>DEU</u></td>
<td>F55-59</td>
<td>8</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>2182</td>
<td>2183</td>
<td>M</td>
<td>Kojellis, Holger</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>258</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>1293</td>
<td>1294</td>
<td>M</td>
<td>Zweer, Waldemar</td>
<td><u>DEU</u></td>
<td>M25-29</td>
<td>117</td>
<td>...</td>
<td><u>GER</u></td>
</tr>
<tr>
<td>747</td>
<td>748</td>
<td>M</td>
<td>Petersen, Mathias</td>
<td><u>DNK</u></td>
<td>M25-29</td>
<td>79</td>
<td>...</td>
<td><u>DE</u></td>
</tr>
</tbody></table></div></code><br>
<pre><code class="python hljs">len(ar[ar[<span class="hljs-string">'country'</span>] == <span class="hljs-string">''</span>])
</code></pre><br>
<code><b>Out:</b> 3221<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是没有国家或有非正式国家的记录数。</font><font style="vertical-align: inherit;">唯一国家/地区的数量从412个减少到250个。在这里，它们是：</font><font style="vertical-align: inherit;">
现在没有偏差。</font><font style="vertical-align: inherit;">如先前所做的那样，在将合并的数据帧转换回数据帧的字典之后，</font><i><font style="vertical-align: inherit;">我们将</font></i><font style="vertical-align: inherit;">结果</font><i><font style="vertical-align: inherit;">保存</font></i><font style="vertical-align: inherit;">在新的</font><i><font style="vertical-align: inherit;">details2.pkl</font></i><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">。</font></font><br>
<code>['', 'ABW', 'AFG', 'AGO', 'AIA', 'ALA', 'ALB', 'AND', 'ANT', 'ARE', 'ARG', 'ARM', 'ASM', 'ATA', 'ATF', 'AUS', 'AUT', 'AZE', 'BDI', 'BEL', 'BEN', 'BES', 'BGD', 'BGR', 'BHR', 'BHS', 'BIH', 'BLM', 'BLR', 'BLZ', 'BMU', 'BOL', 'BRA', 'BRB', 'BRN', 'BTN', 'BUR', 'BVT', 'BWA', 'CAF', 'CAN', 'CCK', 'CHE', 'CHL', 'CHN', 'CIV', 'CMR', 'COD', 'COG', 'COK', 'COL', 'COM', 'CPV', 'CRI', 'CTE', 'CUB', 'CUW', 'CXR', 'CYM', 'CYP', 'CZE', 'DEU', 'DJI', 'DMA', 'DNK', 'DOM', 'DZA', 'ECU', 'EGY', 'ERI', 'ESH', 'ESP', 'EST', 'ETH', 'FIN', 'FJI', 'FLK', 'FRA', 'FRO', 'FSM', 'GAB', 'GBR', 'GEO', 'GGY', 'GHA', 'GIB', 'GIN', 'GLP', 'GMB', 'GNB', 'GNQ', 'GRC', 'GRD', 'GRL', 'GTM', 'GUF', 'GUM', 'GUY', 'HKG', 'HMD', 'HND', 'HRV', 'HTI', 'HUN', 'IDN', 'IMN', 'IND', 'IOT', 'IRL', 'IRN', 'IRQ', 'ISL', 'ISR', 'ITA', 'JAM', 'JEY', 'JOR', 'JPN', 'KAZ', 'KEN', 'KGZ', 'KHM', 'KIR', 'KNA', 'KOR', 'KWT', 'LAO', 'LBN', 'LBR', 'LBY', 'LCA', 'LIE', 'LKA', 'LTU', 'LUX', 'LVA', 'MAC', 'MAF', 'MAR', 'MCO', 'MDA', 'MDG', 'MDV', 'MEX', 'MHL', 'MKD', 'MLI', 'MLT', 'MMR', 'MNE', 'MNG', 'MNP', 'MOZ', 'MSR', 'MTQ', 'MUS', 'MYS', 'MYT', 'NAM', 'NCL', 'NER', 'NFK', 'NGA', 'NHB', 'NIC', 'NIU', 'NLD', 'NOR', 'NPL', 'NRU', 'NZL', 'OMN', 'PAK', 'PAN', 'PCN', 'PER', 'PHL', 'PLW', 'PNG', 'POL', 'PRI', 'PRK', 'PRT', 'PRY', 'PSE', 'PYF', 'QAT', 'REU', 'ROU', 'RUS', 'RWA', 'SAU', 'SCG', 'SDN', 'SEN', 'SGP', 'SGS', 'SHN', 'SJM', 'SLB', 'SLE', 'SLV', 'SMR', 'SOM', 'SPM', 'SRB', 'SSD', 'SUR', 'SVK', 'SVN', 'SWE', 'SWZ', 'SXM', 'SYC', 'SYR', 'TCA', 'TCD', 'TGO', 'THA', 'TJK', 'TKL', 'TKM', 'TLS', 'TON', 'TTO', 'TUN', 'TUR', 'TUV', 'TWN', 'TZA', 'UGA', 'UKR', 'UMI', 'URY', 'USA', 'UZB', 'VAT', 'VCT', 'VEN', 'VGB', 'VIR', 'VNM', 'VUT', 'WLF', 'WSM', 'YEM', 'YUG', 'ZAF', 'ZMB', 'ZWE']<br>
</code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在回想一下，在国家/地区表</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">loc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中也提到了国家</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">还需要使其具有标准外观。这是一个略有不同的故事：ISO和奥林匹克代码均不可见。一切都以相当自由的形式描述。地址的城市，国家/地区和其他组成部分以逗号（随机顺序）列出。首先在某个地方，最后在某个地方。 pycountry在这里无济于事。并且有很多记录-在1922年的比赛中有525个独特的位置（以其原始形式）。</font><font style="vertical-align: inherit;">
但是在这里找到了合适的工具。这是</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">geopy</font></a><font style="vertical-align: inherit;">，即</font><i><font style="vertical-align: inherit;">地理定位器Nominatim</font></i><font style="vertical-align: inherit;">。它是这样的：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th><u>loc</u></th>
<th>males</th>
<th>females</th>
<th>rus</th>
<th>total</th>
<th>link</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>835</td>
<td>215</td>
<td>65</td>
<td>1050</td>
<td>…</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td><u>Dubai, United Arab Emirates</u></td>
<td>638</td>
<td>132</td>
<td>55</td>
<td>770</td>
<td>…</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td><u>Israel, Eilat</u></td>
<td>670</td>
<td>126</td>
<td>4</td>
<td>796</td>
<td>…</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td><u>Indian Wells/La Quinta, California, USA</u></td>
<td>1590</td>
<td>593</td>
<td>6</td>
<td>2183</td>
<td>…</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td><u>New Zealand</u></td>
<td>767</td>
<td>420</td>
<td>3</td>
<td>1187</td>
<td>…</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td><u>Manama, Bahrain</u></td>
<td>858</td>
<td>214</td>
<td>38</td>
<td>1072</td>
<td>…</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td><u>Busselton, Western Australia</u></td>
<td>940</td>
<td>229</td>
<td>1</td>
<td>1169</td>
<td>…</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td><u>Mar del Plata, Argentina</u></td>
<td>506</td>
<td>66</td>
<td>3</td>
<td>572</td>
<td>…</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td><u>Cozumel, Mexico</u></td>
<td>1158</td>
<td>395</td>
<td>12</td>
<td>1553</td>
<td>…</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td><u>Tempe, Arizona, USA</u></td>
<td>1697</td>
<td>633</td>
<td>3</td>
<td>2330</td>
<td>…</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> geopy.geocoders <span class="hljs-keyword">import</span> Nominatim<font></font>
<font></font>
geolocator = Nominatim(user_agent=<span class="hljs-string">'triathlon results researcher'</span>)<font></font>
geolocator.geocode(<span class="hljs-string">' , , '</span>, language=<span class="hljs-string">'en'</span>)
</code></pre><br>
<code><b>Out:</b> Location( ,  –  ,  , Altaysky District, Altai Krai, Siberian Federal District, Russia, (51.78897945, 85.73956296106752, 0.0))<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
根据要求，它以随机形式给出结构化的答案-地址和坐标。如果您在此处设置语言（英语），那么它会翻译。首先，我们需要国家/地区的标准名称，以便随后将其转换为ISO代码。它仅在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">address</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中排在最后</font><font style="vertical-align: inherit;">。由于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geolocator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次都会向服务器发送请求，因此此过程并不快，需要500分钟才能记录500条记录。而且，碰巧没有答案。在这种情况下，第二个请求有时会有所帮助。在我的第一反应中没有收到130个请求。其中大多数经过两次重试处理。但是，即使再进行几次重试也没有处理34个名称。他们来了：</font></font><br>
<code>['Tongyeong, Korea, Korea, South', 'Constanta, Mamaia, Romania, Romania', 'Weihai, China, China', '. ,  .', 'Odaiba Marin Park, Tokyo, Japan, Japan', 'Sweden, Smaland, Kalmar', 'Cholpon-Ata city, Resort Center "Kapriz", Kyrgyzstan', 'Luxembourg, Region Moselle, Moselle', 'Chita Peninsula, Japan', 'Kraichgau Region, Germany', 'Jintang, Chengdu, Sichuan Province, China, China', 'Madrid, Spain, Spain', 'North American Pro Championship, St. George, Utah, USA', 'Milan Idroscalo Linate, Italy', 'Dexing, Jiangxi Province, China, China', 'Mooloolaba, Australia, Australia', 'Nathan Benderson Park (NBP), 5851 Nathan Benderson Circle, Sarasota, FL 34235., United States', 'Strathclyde Country Park, North Lanarkshire, Glasgow, Great Britain', 'Quijing, China', 'United States of America , Hawaii, Kohala Coast', 'Buffalo City, East London, South Africa', 'Spain, Vall de Cardener', ', .    ', 'Asian TriClub Championship, Hefei, China', 'Taizhou, Jiangsu Province, China, China', ', ,  «»', 'Buffalo, Gallagher Beach, Furhmann Blvd, United States', 'North American Pro Championship | St. George, Utah, USA', 'Weihai, Shandong, China, China', 'Tarzo - Revine Lago, Italy', 'Lausanee, Switzerland', 'Queenstown, New Zealand, New Zealand', 'Makuhari, Japan, Japan', 'Szombathlely, Hungary']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以看出，在许多国家中都多次提到该国，这实际上是在干扰。</font><font style="vertical-align: inherit;">通常，我必须手动处理这些剩余的名称，并获得所有的标准地址。</font><font style="vertical-align: inherit;">此外，从这些地址中，我选择了一个国家，并将该国家写在数据透视表的新列中。</font><font style="vertical-align: inherit;">正如我说过的那样，由于使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geopy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作</font><font style="vertical-align: inherit;">并不很快，因此我决定立即保存位置坐标-纬度和经度。</font><font style="vertical-align: inherit;">他们将派上用场，以便以后在地图上可视化。</font><font style="vertical-align: inherit;">之后，使用</font><i><font style="vertical-align: inherit;">pyco.countries.get（name ='...'）。Alpha_3</font></i><font style="vertical-align: inherit;">按名称搜索国家/地区，并分配一个三位数的代码。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th>loc</th>
<th><u>country</u></th>
<th><u>latitude</u></th>
<th><u>longitude</u></th>
<th>...</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td>Dubai, United Arab Emirates</td>
<td><u>United Arab Emirates</u></td>
<td><u>25.0657</u></td>
<td><u>55.1713</u></td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td>Dubai, United Arab Emirates</td>
<td><u>United Arab Emirates</u></td>
<td><u>25.0657</u></td>
<td><u>55.1713</u></td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td>Israel, Eilat</td>
<td><u>Israel</u></td>
<td><u>29.5569</u></td>
<td><u>34.9498</u></td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td>Indian Wells/La Quinta, California, USA</td>
<td><u>United States of America</u></td>
<td><u>33.7238</u></td>
<td><u>-116.305</u></td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td>New Zealand</td>
<td><u>New Zealand</u></td>
<td><u>-41.5001</u></td>
<td><u>172.834</u></td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td>Manama, Bahrain</td>
<td><u>Bahrain</u></td>
<td><u>26.2235</u></td>
<td><u>50.5822</u></td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td>Busselton, Western Australia</td>
<td><u>Australia</u></td>
<td><u>-33.6445</u></td>
<td><u>115.349</u></td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td>Mar del Plata, Argentina</td>
<td><u>Argentina</u></td>
<td><u>-37.9977</u></td>
<td><u>-57.5483</u></td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td>Cozumel, Mexico</td>
<td><u>Mexico</u></td>
<td><u>20.4318</u></td>
<td><u>-86.9203</u></td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td>Tempe, Arizona, USA</td>
<td><u>United States of America</u></td>
<td><u>33.4255</u></td>
<td><u>-111.94</u></td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td>Xiamen, China</td>
<td><u>China</u></td>
<td><u>24.4758</u></td>
<td><u>118.075</u></td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th>loc</th>
<th><u>country</u></th>
<th>latitude</th>
<th>longitude</th>
<th>...</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Dubai Duathlon 70.3 2020</td>
<td>2020-07-02</td>
<td>Dubai, United Arab Emirates</td>
<td><u>ARE</u></td>
<td>25.0657</td>
<td>55.1713</td>
<td>...</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Dubai 70.3 2020</td>
<td>2020-02-07</td>
<td>Dubai, United Arab Emirates</td>
<td><u>ARE</u></td>
<td>25.0657</td>
<td>55.1713</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>Israman Half 2020</td>
<td>2020-01-29</td>
<td>Israel, Eilat</td>
<td><u>ISR</u></td>
<td>29.5569</td>
<td>34.9498</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td>Indian Wells/La Quinta, California, USA</td>
<td><u>USA</u></td>
<td>33.7238</td>
<td>-116.305</td>
<td>...</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td>New Zealand</td>
<td><u>NZL</u></td>
<td>-41.5001</td>
<td>172.834</td>
<td>...</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Bahrain 70.3 2019</td>
<td>2019-12-07</td>
<td>Manama, Bahrain</td>
<td><u>BHR</u></td>
<td>26.2235</td>
<td>50.5822</td>
<td>...</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td>Busselton, Western Australia</td>
<td><u>AUS</u></td>
<td>-33.6445</td>
<td>115.349</td>
<td>...</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td>Mar del Plata, Argentina</td>
<td><u>ARG</u></td>
<td>-37.9977</td>
<td>-57.5483</td>
<td>...</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td>Cozumel, Mexico</td>
<td><u>MEX</u></td>
<td>20.4318</td>
<td>-86.9203</td>
<td>...</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td>Tempe, Arizona, USA</td>
<td><u>USA</u></td>
<td>33.4255</td>
<td>-111.94</td>
<td>...</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td>Xiamen, China</td>
<td><u>CHN</u></td>
<td>24.4758</td>
<td>118.075</td>
<td>...</td>
</tr>
</tbody></table></div></code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">距离</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
枢轴工作台上需要执行的另一项重要操作是确定每次比赛的距离。这对我们将来计算速度很有用。铁人三项中，主要有四个距离-短跑，奥林匹克，半铁和铁。您可以看到，在比赛名称中通常会标明距离-这些是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sprint</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olympic</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Half</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Full</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Words </font><font style="vertical-align: inherit;">。此外，不同的组织者都有自己的距离指定。例如，钢铁侠的一半被指定为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">70.3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（按距离</font><font style="vertical-align: inherit;">数表示），</font><font style="vertical-align: inherit;">奥林匹克运动会</font><font style="vertical-align: inherit;">被指定为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5150</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（公里数（51.5）），并且铁杆可以指定为“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，由于缺乏解释-例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ironman Arizona 2019</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">铁人-他是铁！</font><font style="vertical-align: inherit;">在“挑战”中，铁杆距离指定为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Long</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，半</font><font style="vertical-align: inherit;">铁杆距离指定</font><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Middle</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">根据公里数，</font><font style="vertical-align: inherit;">我们的俄罗斯IronStar表示满为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">226</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一半为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">113</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但通常</font><font style="vertical-align: inherit;">还会出现“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”字样</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在应用所有这些知识，并根据名称中出现的关键字标记所有种族。</font></font><br>
<br>
<pre><code class="python hljs">sprints = rs.loc[[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index <span class="hljs-keyword">if</span> <span class="hljs-string">'sprint'</span> <span class="hljs-keyword">in</span> rs.loc[i, <span class="hljs-string">'event'</span>].lower()]]<font></font>
olympics1 = rs.loc[[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index <span class="hljs-keyword">if</span> <span class="hljs-string">'olympic'</span> <span class="hljs-keyword">in</span> rs.loc[i, <span class="hljs-string">'event'</span>].lower()]]<font></font>
olympics2 = rs.loc[[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index <span class="hljs-keyword">if</span> <span class="hljs-string">'5150'</span> <span class="hljs-keyword">in</span> rs.loc[i, <span class="hljs-string">'event'</span>].lower()]]<font></font>
olympics = pd.concat([olympics1, olympics2])<font></font>
<span class="hljs-comment">#…   </span><font></font>
<font></font>
rsd = pd.concat([sprints, olympics, halfs, fulls]) <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsd中，有1925</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条记录，即比总比赛数多3条记录，因此有些记录属于两个标准。</font><font style="vertical-align: inherit;">让我们看看它们：</font></font><br>
<br>
<pre><code class="python hljs">rsd[rsd.duplicated(keep=<span class="hljs-literal">False</span>)][<span class="hljs-string">'event'</span>].sort_index()
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th><u>event</u></th>
<th>date</th>
<th>loc</th>
<th>country</th>
<th>latitude</th>
<th>longitude</th>
<th>...</th>
</tr>
<tr>
<td>38</td>
<td><u>Temiradam 113 Half 2019</u></td>
<td>2019-09-22</td>
<td>, </td>
<td>KAZ</td>
<td>43.6521</td>
<td>51.158</td>
<td>...</td>
</tr>
<tr>
<td>38</td>
<td><u>Temiradam 113 Half 2019</u></td>
<td>2019-09-22</td>
<td>, </td>
<td>KAZ</td>
<td>43.6521</td>
<td>51.158</td>
<td>...</td>
</tr>
<tr>
<td>65</td>
<td><u>Triway Olympic Sprint 2019</u></td>
<td>2019-09-08</td>
<td>, --</td>
<td>RUS</td>
<td>47.2214</td>
<td>39.7114</td>
<td>...</td>
</tr>
<tr>
<td>65</td>
<td><u>Triway Olympic Sprint 2019</u></td>
<td>2019-09-08</td>
<td>, --</td>
<td>RUS</td>
<td>47.2214</td>
<td>39.7114</td>
<td>...</td>
</tr>
<tr>
<td>82</td>
<td><u>Ironman Dun Laoghaire Full Swim 70.3 2019</u></td>
<td>2019-08-25</td>
<td>Ireland, Dun Laoghaire</td>
<td>IRL</td>
<td>53.2923</td>
<td>-6.13601</td>
<td>...</td>
</tr>
<tr>
<td>82</td>
<td><u>Ironman Dun Laoghaire Full Swim 70.3 2019</u></td>
<td>2019-08-25</td>
<td>Ireland, Dun Laoghaire</td>
<td>IRL</td>
<td>53.2923</td>
<td>-6.13601</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的确是。</font><font style="vertical-align: inherit;">在第一双</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temiradam 113 Half 2019中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，提到了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Half</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">113</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但这并不是矛盾，它们都被确定为一半。</font><font style="vertical-align: inherit;">接下来是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triway Olympic Sprint 2019</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您在这里真的很困惑- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">奥林匹克运动会</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sprint</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过查看带有比赛结果的协议来弄清楚。</font><font style="vertical-align: inherit;">最佳时间是1:09。</font><font style="vertical-align: inherit;">所以这是一个冲刺。</font><font style="vertical-align: inherit;">从奥运列表中删除该条目。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>swim</th>
<th>t1</th>
<th>bike</th>
<th>t2</th>
<th>run</th>
<th><u>result</u></th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td> </td>
<td>RUS</td>
<td>M</td>
<td>1</td>
<td>00:12:21</td>
<td>00:00:31</td>
<td>00:34:13</td>
<td>00:00:25</td>
<td>00:21:49</td>
<td><u>01:09:19</u></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td> </td>
<td>RUS</td>
<td>M</td>
<td>2</td>
<td>00:12:21</td>
<td>00:00:28</td>
<td>00:34:15</td>
<td>00:00:26</td>
<td>00:23:07</td>
<td><u>01:10:38</u></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td> </td>
<td>RUS</td>
<td>M</td>
<td>3</td>
<td>00:14:20</td>
<td>00:00:37</td>
<td>00:35:48</td>
<td>00:00:34</td>
<td>00:22:16</td>
<td><u>01:13:35</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">olympics.drop(<span class="hljs-number">65</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将与相交的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ironman Dun Laoghaire Full Swim 70.3 2019</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同，</font><font style="vertical-align: inherit;">这是最佳时间4:00。</font><font style="vertical-align: inherit;">这是典型的一半。</font><font style="vertical-align: inherit;">从指数85删除记录</font><i><font style="vertical-align: inherit;">充盈</font></i><font style="vertical-align: inherit;">。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>swim</th>
<th>t1</th>
<th>bike</th>
<th>t2</th>
<th>run</th>
<th><u>result</u></th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Brownlee, Alistair</td>
<td>GBR</td>
<td>MPRO</td>
<td>1</td>
<td>00:23:19</td>
<td>00:02:18</td>
<td>02:21:19</td>
<td>00:01:55</td>
<td>01:11:42</td>
<td><u>04:00:33</u></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Smales, Elliot</td>
<td>GBR</td>
<td>MPRO</td>
<td>2</td>
<td>00:24:47</td>
<td>00:02:09</td>
<td>02:29:26</td>
<td>00:01:48</td>
<td>01:12:47</td>
<td><u>04:10:57</u></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Bowden, Adam</td>
<td>GBR</td>
<td>MPRO</td>
<td>3</td>
<td>00:23:24</td>
<td>00:02:18</td>
<td>02:32:09</td>
<td>00:02:06</td>
<td>01:13:49</td>
<td><u>04:13:46</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">fulls.drop(<span class="hljs-number">85</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们在主数据框中写下距离信息，然后看看发生了什么：</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'dist'</span>] = <span class="hljs-string">''</span><font></font>
<font></font>
rs.loc[sprints.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'sprint'</span>
rs.loc[olympics.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'olympic'</span>
rs.loc[halfs.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'half'</span>
rs.loc[fulls.index,<span class="hljs-string">'dist'</span>] = <span class="hljs-string">'full'</span><font></font>
<font></font>
rs.sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>place in group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
</tr>
<tr>
<td>...</td>
<td>566</td>
<td>M</td>
<td>Vladimir Kozar</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>8</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>8</td>
<td>M</td>
<td>HANNES COOL</td>
<td>BEL</td>
<td><u>MPRO</u></td>
<td>11</td>
<td>...</td>
<td>BEL</td>
<td><u>MPRO M</u></td>
</tr>
<tr>
<td>...</td>
<td>445</td>
<td>F</td>
<td>Ileana Sodani</td>
<td>USA</td>
<td><u>F45-49</u></td>
<td>4</td>
<td>...</td>
<td>USA</td>
<td><u>F45-49 F</u></td>
</tr>
<tr>
<td>...</td>
<td>227</td>
<td>F</td>
<td>JARLINSKA Bozena</td>
<td>POL</td>
<td><u>F45-49</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK45-49</u></td>
</tr>
<tr>
<td>...</td>
<td>440</td>
<td>F</td>
<td>Celine Orrigoni</td>
<td>FRA</td>
<td><u>F40-44</u></td>
<td>6</td>
<td>...</td>
<td>FRA</td>
<td><u>F40-44 F</u></td>
</tr>
<tr>
<td>...</td>
<td>325</td>
<td>M</td>
<td>Vladimir Eckert</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>6</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>139</td>
<td>F</td>
<td>ATRASZKIEWICZ Magda</td>
<td>POL</td>
<td><u>F40-44</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>18</td>
<td>M</td>
<td>Marijn de Jonge</td>
<td>NLD</td>
<td><u>MPRO</u></td>
<td>18</td>
<td>...</td>
<td>NED</td>
<td><u>Mpro</u></td>
</tr>
<tr>
<td>...</td>
<td>574</td>
<td>M</td>
<td>Luca Andalo</td>
<td>ITA</td>
<td><u>M40-44</u></td>
<td>9</td>
<td>...</td>
<td>ITA</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>67</td>
<td>M</td>
<td>URBANKIEWICZ Aleksandra</td>
<td>POL</td>
<td><u>M35-39</u></td>
<td>1</td>
<td>...</td>
<td>POL</td>
<td><u>MK35-39</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查是否没有发现条目：</font></font><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">''</span>])
</code></pre><br>
<code><b>Out:</b> 0<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并检查我们有问题的，模棱两可的：</font></font><br>
<br>
<pre><code class="python hljs">rs.loc[[<span class="hljs-number">38</span>,<span class="hljs-number">65</span>,<span class="hljs-number">82</span>],[<span class="hljs-string">'event'</span>,<span class="hljs-string">'dist'</span>]]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th><u>dist</u></th>
</tr>
<tr>
<td>38</td>
<td>Temiradam 113 Half 2019</td>
<td><u>half</u></td>
</tr>
<tr>
<td>65</td>
<td>Triway Olympic Sprint 2019</td>
<td><u>sprint</u></td>
</tr>
<tr>
<td>82</td>
<td>Ironman Dun Laoghaire Full Swim 70.3 2019</td>
<td><u>half</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一切安好。</font><font style="vertical-align: inherit;">保存到新文件：</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rs, open(<span class="hljs-string">r'D:\tri\summary5.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">年龄组</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在回到赛车协议。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们已经分析了参与者的性别，国家和结果，并将其归为标准格式。</font><font style="vertical-align: inherit;">但是还剩下两列-组，实际上是名称本身。</font><font style="vertical-align: inherit;">让我们从小组开始。</font><font style="vertical-align: inherit;">在铁人三项赛中，习惯上按年龄段划分参与者。</font><font style="vertical-align: inherit;">一群专业人士也经常脱颖而出。</font><font style="vertical-align: inherit;">实际上，偏移量是在每个这样的组中单独分配的-每个组中的前三个位置均被授予。</font><font style="vertical-align: inherit;">在团体中，正在为锦标赛选择资格，例如在Konu上。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
合并所有记录，查看通常存在哪些组。</font></font><br>
<br>
<pre><code class="python hljs">rd = pkl.load(open(<span class="hljs-string">r'D:\tri\details2.pkl'</span>, <span class="hljs-string">'rb'</span>))<font></font>
ar = pd.concat(rd)<font></font>
ar[<span class="hljs-string">'group'</span>].unique()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原来，有很多组-581。随机选择了一百个这样的样子：</font><font style="vertical-align: inherit;">
让我们看看其中哪个是最多的：</font></font><br>
<code>['MSenior', 'FAmat.', 'M20', 'M65-59', 'F25-29', 'F18-22', 'M75-59', 'MPro', 'F24', 'MCORP M', 'F21-30', 'MSenior 4', 'M40-50', 'FAWAD', 'M16-29', 'MK40-49', 'F65-70', 'F65-70', 'M12-15', 'MK18-29', 'M50up', 'FSEMIFINAL 2 PRO', 'F16', 'MWhite', 'MOpen 25-29', 'F', 'MPT TRI-2', 'M16-24', 'FQUALIFIER 1 PRO', 'F15-17', 'FSEMIFINAL 2 JUNIOR', 'FOpen 60-64', 'M75-80', 'F60-69', 'FJUNIOR A', 'F17-18', 'FAWAD BLIND', 'M75-79', 'M18-29', 'MJUN19-23', 'M60-up', 'M70', 'MPTS5', 'F35-40', "M'S PT1", 'M50-54', 'F65-69', 'F17-20', 'MP4', 'M16-29', 'F18up', 'MJU', 'MPT4', 'MPT TRI-3', 'MU24-39', 'MK35-39', 'F18-20', "M'S", 'F50-55', 'M75-80', 'MXTRI', 'F40-45', 'MJUNIOR B', 'F15', 'F18-19', 'M20-29', 'MAWAD PC4', 'M30-37', 'F21-30', 'Mpro', 'MSEMIFINAL 1 JUNIOR', 'M25-34', 'MAmat.', 'FAWAD PC5', 'FA', 'F50-60', 'FSenior 1', 'M80-84', 'FK45-49', 'F75-79', 'M&lt;23', 'MPTS3', 'M70-75', 'M50-60', 'FQUALIFIER 3 PRO', 'M9', 'F31-40', 'MJUN16-19', 'F18-19', 'M PARA', 'F35-44', 'MParaathlete', 'F18-34', 'FA', 'FAWAD PC2', 'FAll Ages', 'M PARA', 'F31-40', 'MM85', 'M25-39']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'group'</span>].value_counts()[:<span class="hljs-number">30</span>]
</code></pre><br>
<code><b>Out:</b><br>
M40-44 199157<br>
M35-39 183738<br>
M45-49 166796<br>
M30-34 154732<br>
M50-54 107307<br>
M25-29 88980<br>
M55-59 50659<br>
F40-44 48036<br>
F35-39 47414<br>
F30-34 45838<br>
F45-49 39618<br>
MPRO 38445<br>
F25-29 31718<br>
F50-54 26253<br>
M18-24 24534<br>
FPRO 23810<br>
M60-64 20773<br>
M 12799<br>
F55-59 12470<br>
M65-69 8039<br>
F18-24 7772<br>
MJUNIOR 6605<br>
F60-64 5067<br>
M20-24 4580<br>
FJUNIOR 4105<br>
M30-39 3964<br>
M40-49 3319<br>
F 3306<br>
M70-74 3072<br>
F20-24 2522<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您会看到，这是一个五年小组，分别针对男性和女性，以及专业团体</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MPRO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPRO</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们的标准将是：</font></font><br>
<br>
<pre><code class="python hljs">ag = [<span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'M18-24'</span>, <span class="hljs-string">'M25-29'</span>, <span class="hljs-string">'M30-34'</span>, <span class="hljs-string">'M35-39'</span>, <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'M45-49'</span>, <span class="hljs-string">'M50-54'</span>, <span class="hljs-string">'M55-59'</span>, <span class="hljs-string">'M60-64'</span>,  <span class="hljs-string">'M65-69'</span>, <span class="hljs-string">'M70-74'</span>, <span class="hljs-string">'M75-79'</span>, <span class="hljs-string">'M80-84'</span>, <span class="hljs-string">'M85-90'</span>, <span class="hljs-string">'FPRO'</span>, <span class="hljs-string">'F18-24'</span>, <span class="hljs-string">'F25-29'</span>, <span class="hljs-string">'F30-34'</span>, <span class="hljs-string">'F35-39'</span>, <span class="hljs-string">'F40-44'</span>,   <span class="hljs-string">'F45-49'</span>, <span class="hljs-string">'F50-54'</span>, <span class="hljs-string">'F55-59'</span>, <span class="hljs-string">'F60-64'</span>, <span class="hljs-string">'F65-69'</span>, <span class="hljs-string">'F70-74'</span>, <span class="hljs-string">'F75-79'</span>, <span class="hljs-string">'F80-84'</span>, <span class="hljs-string">'F85-90'</span>]
<span class="hljs-comment">#ag – age group</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这套产品几乎覆盖了所有整理器的95％。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，我们将无法使所有小组都达到这一标准。</font><font style="vertical-align: inherit;">但我们会寻找与它们相似的东西，并至少提供一部分。</font><font style="vertical-align: inherit;">首先，我们将大写字母删除空格。</font><font style="vertical-align: inherit;">发生了什么：</font><font style="vertical-align: inherit;">
将它们转换为我们的标准格式。</font></font><br>
<code>['F25-29F', 'F30-34F', 'F30-34-34', 'F35-39F', 'F40-44F', 'F45-49F', 'F50-54F', 'F55-59F', 'FAG:FPRO', 'FK30-34', 'FK35-39', 'FK40-44', 'FK45-49', 'FOPEN50-54', 'FOPEN60-64', 'MAG:MPRO', 'MK30-34', 'MK30-39', 'MK35-39', 'MK40-44', 'MK40-49', 'MK50-59', 'M40-44', 'MM85-89', 'MOPEN25-29', 'MOPEN30-34', 'MOPEN35-39', 'MOPEN40-44', 'MOPEN45-49', 'MOPEN50-54', 'MOPEN70-74', 'MPRO:', 'MPROM', 'M0-44"']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">fix = { <span class="hljs-string">'F25-29F'</span>: <span class="hljs-string">'F25-29'</span>, <span class="hljs-string">'F30-34F'</span> : <span class="hljs-string">'F30-34'</span>, <span class="hljs-string">'F30-34-34'</span>: <span class="hljs-string">'F30-34'</span>, <span class="hljs-string">'F35-39F'</span>: <span class="hljs-string">'F35-39'</span>, <span class="hljs-string">'F40-44F'</span>: <span class="hljs-string">'F40-44'</span>, <span class="hljs-string">'F45-49F'</span>: <span class="hljs-string">'F45-49'</span>, <span class="hljs-string">'F50-54F'</span>: <span class="hljs-string">'F50-54'</span>, <span class="hljs-string">'F55-59F'</span>: <span class="hljs-string">'F55-59'</span>, <span class="hljs-string">'FAG:FPRO'</span>: <span class="hljs-string">'FPRO'</span>, <span class="hljs-string">'FK30-34'</span>: <span class="hljs-string">'F30-34'</span>,      <span class="hljs-string">'FK35-39'</span>: <span class="hljs-string">'F35-39'</span>, <span class="hljs-string">'FK40-44'</span>: <span class="hljs-string">'F40-44'</span>, <span class="hljs-string">'FK45-49'</span>: <span class="hljs-string">'F45-49'</span>, <span class="hljs-string">'FOPEN50-54'</span>: <span class="hljs-string">'F50-54'</span>, <span class="hljs-string">'FOPEN60-64'</span>: <span class="hljs-string">'F60-64'</span>, <span class="hljs-string">'MAG:MPRO'</span>: <span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'MK30-34'</span>: <span class="hljs-string">'M30-34'</span>, <span class="hljs-string">'MK30-39'</span>: <span class="hljs-string">'M30-39'</span>, <span class="hljs-string">'MK35-39'</span>: <span class="hljs-string">'M35-39'</span>, <span class="hljs-string">'MK40-44'</span>: <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'MK40-49'</span>: <span class="hljs-string">'M40-49'</span>, <span class="hljs-string">'MK50-59'</span>: <span class="hljs-string">'M50-59'</span>, <span class="hljs-string">'M40-44'</span>: <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'MM85-89'</span>: <span class="hljs-string">'M85-89'</span>, <span class="hljs-string">'MOPEN25-29'</span>: <span class="hljs-string">'M25-29'</span>, <span class="hljs-string">'MOPEN30-34'</span>: <span class="hljs-string">'M30-34'</span>, <span class="hljs-string">'MOPEN35-39'</span>: <span class="hljs-string">'M35-39'</span>, <span class="hljs-string">'MOPEN40-44'</span>: <span class="hljs-string">'M40-44'</span>, <span class="hljs-string">'MOPEN45-49'</span>: <span class="hljs-string">'M45-49'</span>, <span class="hljs-string">'MOPEN50-54'</span>: <span class="hljs-string">'M50-54'</span>, <span class="hljs-string">'MOPEN70-74'</span>: <span class="hljs-string">'M70- 74'</span>, <span class="hljs-string">'MPRO:'</span> :<span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'MPROM'</span>: <span class="hljs-string">'MPRO'</span>, <span class="hljs-string">'M0-44"'</span> : <span class="hljs-string">'M40-44'</span>}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们将转换应用于主数据帧</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但首先将原始</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值保存</font><font style="vertical-align: inherit;">到新的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组原始</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'group raw'</span>] = ar[<span class="hljs-string">'group'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中，</font><font style="vertical-align: inherit;">我们仅保留符合我们标准的那些值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们可以欣赏我们的努力：</font></font><br>
<br>
<pre><code class="python hljs">len(ar[(ar[<span class="hljs-string">'group'</span>] != ar[<span class="hljs-string">'group raw'</span>])&amp;(ar[<span class="hljs-string">'group'</span>]!=<span class="hljs-string">''</span>)])
</code></pre><br>
<code><b>Out:</b> 273<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在一百五十万的水平上只有一点点。</font><font style="vertical-align: inherit;">但是直到尝试，您才知道。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选定的10如下所示：</font><font style="vertical-align: inherit;">将数据框转换回</font><i><font style="vertical-align: inherit;">rd</font></i><font style="vertical-align: inherit;">字典后，保存新版本的数据框</font><font style="vertical-align: inherit;">。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>place in group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
</tr>
<tr>
<td>...</td>
<td>566</td>
<td>M</td>
<td>Vladimir Kozar</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>8</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>8</td>
<td>M</td>
<td>HANNES COOL</td>
<td>BEL</td>
<td><u>MPRO</u></td>
<td>11</td>
<td>...</td>
<td>BEL</td>
<td><u>MPRO M</u></td>
</tr>
<tr>
<td>...</td>
<td>445</td>
<td>F</td>
<td>Ileana Sodani</td>
<td>USA</td>
<td><u>F45-49</u></td>
<td>4</td>
<td>...</td>
<td>USA</td>
<td><u>F45-49 F</u></td>
</tr>
<tr>
<td>...</td>
<td>227</td>
<td>F</td>
<td>JARLINSKA Bozena</td>
<td>POL</td>
<td><u>F45-49</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK45-49</u></td>
</tr>
<tr>
<td>...</td>
<td>440</td>
<td>F</td>
<td>Celine Orrigoni</td>
<td>FRA</td>
<td><u>F40-44</u></td>
<td>6</td>
<td>...</td>
<td>FRA</td>
<td><u>F40-44 F</u></td>
</tr>
<tr>
<td>...</td>
<td>325</td>
<td>M</td>
<td>Vladimir Eckert</td>
<td>SVK</td>
<td><u>M40-44</u></td>
<td>6</td>
<td>...</td>
<td>SVK</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>139</td>
<td>F</td>
<td>ATRASZKIEWICZ Magda</td>
<td>POL</td>
<td><u>F40-44</u></td>
<td>2</td>
<td>...</td>
<td>POL</td>
<td><u>FK40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>18</td>
<td>M</td>
<td>Marijn de Jonge</td>
<td>NLD</td>
<td><u>MPRO</u></td>
<td>18</td>
<td>...</td>
<td>NED</td>
<td><u>Mpro</u></td>
</tr>
<tr>
<td>...</td>
<td>574</td>
<td>M</td>
<td>Luca Andalo</td>
<td>ITA</td>
<td><u>M40-44</u></td>
<td>9</td>
<td>...</td>
<td>ITA</td>
<td><u>MOpen 40-44</u></td>
</tr>
<tr>
<td>...</td>
<td>67</td>
<td>M</td>
<td>URBANKIEWICZ Aleksandra</td>
<td>POL</td>
<td><u>M35-39</u></td>
<td>1</td>
<td>...</td>
<td>POL</td>
<td><u>MK35-39</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details3.pkl'</span>, <span class="hljs-string">'wb'</span>))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，让我们来照顾名字。</font><font style="vertical-align: inherit;">让我们选择性地查看来自不同种族的100个名字：</font></font><br>
<br>
<pre><code class="python hljs">list(ar[<span class="hljs-string">'name'</span>].sample(<span class="hljs-number">100</span>))
</code></pre><br>
<code><b>Out: </b>['Case, Christine', 'Van der westhuizen, Wouter', 'Grace, Scott', 'Sader, Markus', 'Schuller, Gunnar', 'Juul-Andersen, Jeppe', 'Nelson, Matthew', '  ', 'Westman, Pehr', 'Becker, Christoph', 'Bolton, Jarrad', 'Coto, Ricardo', 'Davies, Luke', 'Daniltchev, Alexandre', 'Escobar Labastida, Emmanuelle', 'Idzikowski, Jacek', 'Fairaislova Iveta', 'Fisher, Kulani', 'Didenko, Viktor', 'Osborne, Jane', 'Kadralinov, Zhalgas', 'Perkins, Chad', 'Caddell, Martha', 'Lynaire PARISH', 'Busing, Lynn', 'Nikitin, Evgeny', 'ANSON MONZON, ROBERTO', 'Kaub, Bernd', 'Bank, Morten', 'Kennedy, Ian', 'Kahl, Stephen', 'Vossough, Andreas', 'Gale, Karen', 'Mullally, Kristin', 'Alex FRASER', 'Dierkes, Manuela', 'Gillett, David', 'Green, Erica', 'Cunnew, Elliott', 'Sukk, Gaspar', 'Markina Veronika', 'Thomas KVARICS', 'Wu, Lewen', 'Van Enk, W.J.J', 'Escobar, Rosario', 'Healey, Pat', 'Scheef, Heike', 'Ancheta, Marlon', 'Heck, Andreas', 'Vargas Iii, Raul', 'Seferoglou, Maria', 'chris GUZMAN', 'Casey, Timothy', 'Olshanikov Konstantin', 'Rasmus Nerrand', 'Lehmann Bence', 'Amacker, Kirby', 'Parks, Chris', 'Tom, Troy', 'Karlsson, Ulf', 'Halfkann, Dorothee', 'Szabo, Gergely', 'Antipov Mikhail', 'Von Alvensleben, Alvo', 'Gruber, Peter', 'Leblanc, Jean-Philippe', 'Bouchard, Jean-Francois', 'Marchiotto MASSIMO', 'Green, Molly', 'Alder, Christoph', 'Morris, Huw', 'Deceur, Marc', 'Queenan, Derek', 'Krause, Carolin', 'Cockings, Antony', 'Ziehmer Chris', 'Stiene, John', 'Chmet Daniela', 'Chris RIORDAN', 'Wintle, Mel', ' ', 'GASPARINI CHRISTIAN', 'Westbrook, Christohper', 'Martens, Wim', 'Papson, Chris', 'Burdess, Shaun', 'Proctor, Shane', 'Cruzinha, Pedro', 'Hamard, Jacques', 'Petersen, Brett', 'Sahyoun, Sebastien', "O'Connell, Keith", 'Symoshenko, Zhan', 'Luternauer, Jan', 'Coronado, Basil', 'Smith, Alex', 'Dittberner, Felix', 'N?sman, Henrik', 'King, Malisa', 'PUHLMANN Andre']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
情况很复杂。条目有多种选择：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名字姓氏，姓氏名字，姓氏，名字，姓氏，名字</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。即，不同的顺序，不同的寄存器，在某些地方有分隔符-逗号。西里尔语也有许多协议。也没有统一性，并且可能会出现以下格式：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“姓氏名”，“名字姓氏”，“名字中间名姓氏”，“名字姓氏中间名”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。尽管实际上，中间名也出现在拉丁语拼写中。顺便说一句，这里出现了另一个问题-音译。还应注意，即使没有中间名，记录也可能不限于两个单词。例如，对于西班牙裔，姓名加姓通常由三个或四个词组成。荷兰人的前缀是Van，中国人和韩国人的别名通常是三个单词。通常，您需要以某种方式来解散整个重传并将其标准化到最大。通常，在一场比赛中，每个人的名称格式都相同，但是即使在这里，也存在我们无法处理的错误。让我们开始将现有值存储在新的列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称raw中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name raw'</span>] = ar[<span class="hljs-string">'name'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
绝大多数协议使用拉丁语，所以我想做的第一件事就是音译。</font><font style="vertical-align: inherit;">让我们看看参与者名称中可以包含哪些字符。</font></font><br>
<br>
<pre><code class="python hljs">set( <span class="hljs-string">''</span>.join(ar[<span class="hljs-string">'name'</span>].unique()))
</code></pre><br>
<code><b>Out: </b>[' ', '!', '"', '#', '&amp;', "'", '(', ')', '*', '+', ',', '-', '.', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '&gt;', '?', '@', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[', '\\', ']', '^', '_', '`', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '|', '\x7f', '\xa0', '¤', '¦', '§', '', '«', '\xad', '', '°', '±', 'µ', '¶', '·', '»', '', 'І', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 'є', 'і', 'ў', '–', '—', '‘', '’', '‚', '“', '”', '„', '†', '‡', '…', '‰', '›', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
那里只有什么！</font><font style="vertical-align: inherit;">除了实际的字母和空格外，还有许多不同的古怪字符。</font><font style="vertical-align: inherit;">其中，句点“。”，连字符“-”和撇号“'”可以被认为是有效的，也就是说，不会错误地出现。</font><font style="vertical-align: inherit;">此外，还注意到在许多德国和挪威名字和姓氏中都有一个问号“？”。</font><font style="vertical-align: inherit;">显然，它们正在替换扩展拉丁字母中的字符-'？'，'A'，'o'，'u'，？</font><font style="vertical-align: inherit;">这是示例：</font><font style="vertical-align: inherit;">
逗号虽然经常发生，但在某些种族中只是一个分隔符，因此它也属于不可接受的类别。</font><font style="vertical-align: inherit;">数字也不应出现在名称中。</font></font><br>
<code>Pierre-Alexandre Petit, Jean-louis Lafontaine, Faris Al-Sultan, Jean-Francois Evrard, Paul O'Mahony, Aidan O'Farrell, John O'Neill, Nick D'Alton, Ward D'Hulster, Hans P.J. Cami, Luis E. Benavides, Maximo Jr. Rueda, Prof. Dr. Tim-Nicolas Korf, Dr. Boris Scharlowsk, Eberhard Gro?mann, Magdalena Wei?, Gro?er Axel, Meyer-Szary Krystian, Morten Halkj?r, RASMUSSEN S?ren Balle<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">bs = [s <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> symbols <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (s.isalpha() <span class="hljs-keyword">or</span> s <span class="hljs-keyword">in</span> <span class="hljs-string">" . - ' ? ,"</span>)] <span class="hljs-comment">#bs – bad symbols</span><font></font>
<font></font>
bs<font></font>
</code></pre><br>
<code><b>Out: </b>['!', '"', '#', '&amp;', '(', ')', '*', '+', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '&gt;', '@', '[', '\\', ']', '^', '_', '`', '|', '\x7f', '\xa0', '¤', '¦', '§', '', '«', '\xad', '', '°', '±', '¶', '·', '»', '–', '—', '‘', '’', '‚', '“', '”', '„', '†', '‡', '…', '‰', '›', '']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将暂时删除所有这些字符，以找出它们存在多少个条目：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> bs:<font></font>
    ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, <span class="hljs-string">''</span>)<font></font>
<font></font>
corr = ar[ar[<span class="hljs-string">'name'</span>] != ar[<span class="hljs-string">'name raw'</span>]]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有2184条这样的记录，即仅占总数的0.15％-很少。</font><font style="vertical-align: inherit;">让我们看一下其中的100个：</font></font><br>
<br>
<pre><code class="python hljs">list(corr[<span class="hljs-string">'name raw'</span>].sample(<span class="hljs-number">100</span>))
</code></pre><br>
<code><b>Out:</b> ['Scha¶ffl, Ga?nter', 'Howard, Brian &amp;', 'Chapiewski, Guilherme (Gc)', 'Derkach 1svd_mail_ru', 'Parker H1 Lauren', 'Leal le?n, Yaneri', 'TencA, David', 'Cortas La?pez, Alejandro', 'Strid, Bja¶rn', '(Crutchfield) Horan, Katie', 'Vigneron, Jean-Michel.Vigneron@gmail.Com', '\xa0', 'Telahr, J†rgen', 'St”rmer, Melanie', 'Nagai B1 Keiji', 'Rinc?n, Mariano', 'Arkalaki, Angela (Evangelia)', 'Barbaro B1 Bonin Anna G:Charlotte', 'Ra?esch, Ja¶rg', "CAVAZZI NICCOLO\\'", 'D„nzel, Thomas', 'Ziska, Steffen (Gerhard)', 'Kobilica B1 Alen', 'Mittelholcz, Bala', 'Jimanez Aguilar, Juan Antonio', 'Achenza H1 Giovanni', 'Reppe H2 Christiane', 'Filipovic B2 Lazar', 'Machuca Ka?hnel, Ruban Alejandro', 'Gellert (Silberprinz), Christian', 'Smith (Guide), Matt', 'Lenatz H1 Benjamin', 'Da¶llinger, Christian', 'Mc Carthy B1 Patrick Donnacha G:Bryan', 'Fa¶llmer, Chris', 'Warner (Rivera), Lisa', 'Wang, Ruijia (Ray)', 'Mc Carthy B1 Donnacha', 'Jones, Nige (Paddy)', 'Sch”ler, Christoph', '\xa0', 'Holthaus, Adelhard (Allard)', 'Mi;Arro, Ana', 'Dr: Koch Stefan', '\xa0', '\xa0', 'Ziska, Steffen (Gerhard)', 'Albarraca\xadn Gonza?lez, Juan Francisco', 'Ha¶fling, Imke', 'Johnston, Eddie (Edwin)', 'Mulcahy, Bob (James)', 'Gottschalk, Bj”rn', '\xa0', 'Gretsch H2 Kendall', 'Scorse, Christopher (Chris)', 'Kiel‚basa, Pawel', 'Kalan, Magnus', 'Roderick "eric" SIMBULAN', 'Russell;, Mark', 'ROPES AND GRAY TEAM 3', 'Andrade, H?¦CTOR DANIEL', 'Landmann H2 Joshua', 'Reyes Rodra\xadguez, Aithami', 'Ziska, Steffen (Gerhard)', 'Ziska, Steffen (Gerhard)', 'Heuza, Pierre', 'Snyder B1 Riley Brad G:Colin', 'Feldmann, Ja¶rg', 'Beveridge H1 Nic', 'FAGES`, perrine', 'Frank", Dieter', 'Saarema¤el, Indrek', 'Betancort Morales, Arida–y', 'Ridderberg, Marie_Louise', '\xa0', 'Ka¶nig, Johannes', 'W Van(der Klugt', 'Ziska, Steffen (Gerhard)', 'Johnson, Nick26', 'Heinz JOHNER03', 'Ga¶rg, Andra', 'Maruo B2 Atsuko', 'Moral Pedrero H1 Eva Maria', '\xa0', 'MATUS SANTIAGO Osc1r', 'Stenbrink, Bja¶rn', 'Wangkhan, Sm1.Thaworn', 'Pullerits, Ta¶nu', 'Clausner, 8588294149', 'Castro Miranda, Josa Ignacio', 'La¶fgren, Pontuz', 'Brown, Jann ( Janine )', 'Ziska, Steffen (Gerhard)', 'Koay, Sa¶ren', 'Ba¶hm, Heiko', 'Oleksiuk B2 Vita', 'G Van(de Grift', 'Scha¶neborn, Guido', 'Mandez, A?lvaro', 'Garca\xada Fla?rez, Daniel']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，经过大量研究，决定：用逗号，句点和'\ xa0'符号和空格替换所有字母字符以及空格，连字符，撇号和问号，并用空字符串替换所有其他字符，即删除即可。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name raw'</span>]<font></font>
<font></font>
<span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> symbols:
    <span class="hljs-keyword">if</span> s.isalpha() <span class="hljs-keyword">or</span> s <span class="hljs-keyword">in</span> <span class="hljs-string">" - ? '"</span>:        
        <span class="hljs-keyword">continue</span>        
    <span class="hljs-keyword">if</span> s <span class="hljs-keyword">in</span> <span class="hljs-string">".,\xa0"</span>:<font></font>
        ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, <span class="hljs-string">' '</span>)       
    <span class="hljs-keyword">else</span>:<font></font>
        ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, <span class="hljs-string">''</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后摆脱多余的空间：</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.split().str.join(<span class="hljs-string">' '</span>)<font></font>
ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.strip() <span class="hljs-comment">#   </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看看发生什么了：</font></font><br>
<br>
<pre><code class="python hljs">ar.loc[corr.index].sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>...</th>
<th><u>name raw</u></th>
</tr>
<tr>
<td>63</td>
<td>64</td>
<td>M</td>
<td><u>Curzillat B MARANO Annouck GJulie</u></td>
<td>FRA</td>
<td>...</td>
<td><u>Curzillat B1 MARANO Annouck G:Julie</u></td>
</tr>
<tr>
<td>425</td>
<td>426</td>
<td>M</td>
<td><u>Naranjo Quintero Cndido</u></td>
<td>ESP</td>
<td>...</td>
<td><u>Naranjo Quintero, C‡ndido</u></td>
</tr>
<tr>
<td>1347</td>
<td>1348</td>
<td>F</td>
<td><u>Chang Margaret Peggy</u></td>
<td>USA</td>
<td>...</td>
<td><u>Chang, Margaret (Peggy)</u></td>
</tr>
<tr>
<td>790</td>
<td>791</td>
<td>M</td>
<td><u>Gonzalez Ruben</u></td>
<td>PRI</td>
<td>...</td>
<td><u>Gonzalez`, Ruben</u></td>
</tr>
<tr>
<td>1562</td>
<td>1563</td>
<td>M</td>
<td><u>Garcia Hernandez Elias</u></td>
<td>MEX</td>
<td>...</td>
<td><u>Garcia Hernandez/, Elias</u></td>
</tr>
<tr>
<td>50</td>
<td>51</td>
<td>M</td>
<td><u>Reppe H Christiane</u></td>
<td>DEU</td>
<td>...</td>
<td><u>Reppe H2 Christiane</u></td>
</tr>
<tr>
<td>528</td>
<td>529</td>
<td>M</td>
<td><u>Ho Shihken</u></td>
<td>TWN</td>
<td>...</td>
<td><u>Ho, Shih—ken</u></td>
</tr>
<tr>
<td>819</td>
<td>820</td>
<td>M</td>
<td><u>Elmously A R Abdelrahman</u></td>
<td>EGY</td>
<td>...</td>
<td><u>Elmously, A.R. (Abdelrahman)</u></td>
</tr>
<tr>
<td>249</td>
<td>250</td>
<td>F</td>
<td><u>boyer Isabelle</u></td>
<td>THA</td>
<td>...</td>
<td><u>`boyer, Isabelle</u></td>
</tr>
<tr>
<td>744</td>
<td>745</td>
<td>M</td>
<td><u>Garcaa Morales Pedro Luciano</u></td>
<td>ESP</td>
<td>...</td>
<td><u>Garca¬a Morales, Pedro Luciano</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也有人指出，有些名字完全由问号组成。</font></font><br>
<br>
<pre><code class="python hljs">qmon = ar[(ar[<span class="hljs-string">'name'</span>].str.replace(<span class="hljs-string">'?'</span>, <span class="hljs-string">''</span>).str.strip() == <span class="hljs-string">''</span>)&amp;(ar[<span class="hljs-string">'name'</span>]!=<span class="hljs-string">''</span>)] <span class="hljs-comment">#qmon – question mark only names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它们共有3,429个，看起来像这样：</font><font style="vertical-align: inherit;">我们使名称达到相同标准的目标是使相同的名称看起来相同，但以不同的方式不同。</font><font style="vertical-align: inherit;">在名称仅由问号组成的情况下，它们仅在字符数上有所不同，但这并不能完全确保具有相同数字的名称实际上是相同的。</font><font style="vertical-align: inherit;">因此，我们将它们全部替换为空字符串，以后将不再考虑。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>group</th>
<th>place in group</th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th><u>name raw</u></th>
</tr>
<tr>
<td>818</td>
<td>819</td>
<td>M</td>
<td><u>???? ???</u></td>
<td>JPN</td>
<td>M45-49</td>
<td>177</td>
<td>...</td>
<td>JPN</td>
<td>M45-49</td>
<td><u>????, ???</u></td>
</tr>
<tr>
<td>1101</td>
<td>1102</td>
<td>M</td>
<td><u>?? ??</u></td>
<td>JPN</td>
<td>M50-54</td>
<td>159</td>
<td>...</td>
<td>JPN</td>
<td>M50-54</td>
<td><u>??, ??</u></td>
</tr>
<tr>
<td>162</td>
<td>163</td>
<td>M</td>
<td><u>? ??</u></td>
<td>CHN</td>
<td>M30-34</td>
<td>22</td>
<td>...</td>
<td>CHN</td>
<td>M30-34</td>
<td><u>?, ??</u></td>
</tr>
<tr>
<td>1271</td>
<td>1272</td>
<td>F</td>
<td><u>???? ????</u></td>
<td>JPN</td>
<td>F50-54</td>
<td>15</td>
<td>...</td>
<td>JPN</td>
<td>F50-54</td>
<td><u>????, ????</u></td>
</tr>
<tr>
<td>552</td>
<td>553</td>
<td>M</td>
<td><u>??? ??</u></td>
<td>JPN</td>
<td>M25-29</td>
<td>30</td>
<td>...</td>
<td>JPN</td>
<td>M25-29</td>
<td><u>???, ??</u></td>
</tr>
<tr>
<td>423</td>
<td>424</td>
<td>M</td>
<td><u>??? ????</u></td>
<td>JPN</td>
<td>M55-59</td>
<td>24</td>
<td>...</td>
<td>JPN</td>
<td>M55-59</td>
<td><u>???, ????</u></td>
</tr>
<tr>
<td>936</td>
<td>937</td>
<td>F</td>
<td><u>?? ??</u></td>
<td>JPN</td>
<td>F50-54</td>
<td>7</td>
<td>...</td>
<td>JPN</td>
<td>F50-54</td>
<td><u>??, ??</u></td>
</tr>
<tr>
<td>244</td>
<td>245</td>
<td>M</td>
<td><u>? ??</u></td>
<td>KOR</td>
<td>M50-54</td>
<td>30</td>
<td>...</td>
<td>KOR</td>
<td>M50-54</td>
<td><u>?, ??</u></td>
</tr>
<tr>
<td>627</td>
<td>628</td>
<td>M</td>
<td><u>? ?</u></td>
<td>CHN</td>
<td>M40-44</td>
<td>94</td>
<td>...</td>
<td>CHN</td>
<td>M40-44</td>
<td><u>?, ?</u></td>
</tr>
<tr>
<td>194</td>
<td>195</td>
<td>M</td>
<td><u>?????? ?????</u></td>
<td>RUS</td>
<td></td>
<td>188</td>
<td>...</td>
<td>RUS</td>
<td>M</td>
<td><u>?????? ?????</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar.loc[qmon.index, <span class="hljs-string">'name'</span>] = <span class="hljs-string">''</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名称为空字符串的条目总数为3454。不是很多，我们将生存。</font><font style="vertical-align: inherit;">现在我们已经摆脱了不必要的字符，我们可以继续音译。</font><font style="vertical-align: inherit;">为此，请首先将所有内容都转换为小写，以免重复工作。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.lower()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，创建一个字典：</font></font><br>
<br>
<pre><code class="python hljs">trans = {<span class="hljs-string">''</span>:<span class="hljs-string">'a'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'b'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'v'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'g'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'d'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'zh'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'z'</span>,  <span class="hljs-string">''</span>:<span class="hljs-string">'i'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'y'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'k'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'l'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'m'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'n'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'o'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'p'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'r'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'s'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'t'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'u'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'f'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'kh'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'ts'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'ch'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'sh'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'shch'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">''</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'y'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">''</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'yu'</span>, <span class="hljs-string">''</span>:<span class="hljs-string">'ya'</span>, <span class="hljs-string">'є'</span>:<span class="hljs-string">'e'</span>, <span class="hljs-string">'і'</span>: <span class="hljs-string">'i'</span>,<span class="hljs-string">'ў'</span>:<span class="hljs-string">'w'</span>,<span class="hljs-string">'µ'</span>:<span class="hljs-string">'m'</span>}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它还包括</font><font style="vertical-align: inherit;">白俄罗斯语和乌克兰语中使用</font><font style="vertical-align: inherit;">的所谓的西里尔字母扩展字母</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“є”，“і”，“ў”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及希腊字母</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ µ”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">应用转换：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> trans:<font></font>
    ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.replace(s, trans[s])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，从工作的小写字母开始，我们将所有内容转换为熟悉的格式，其中名字和姓氏以大写字母开头：</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'name'</span>] = ar[<span class="hljs-string">'name'</span>].str.title()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看看发生什么了。</font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'name raw'</span>].str.lower().str[<span class="hljs-number">0</span>].isin(trans.keys())].sample(<span class="hljs-number">10</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>...</th>
<th>country raw</th>
<th>name raw</th>
</tr>
<tr>
<td>99</td>
<td>100</td>
<td>M</td>
<td><u>Nikolay Golovkin</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>95</td>
<td>96</td>
<td>M</td>
<td><u>Maksim Vasilevich Chubakov</u></td>
<td>...</td>
<td>RUS</td>
<td>  </td>
</tr>
<tr>
<td>325</td>
<td>326</td>
<td>F</td>
<td><u>Ganieva Aygul</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>661</td>
<td>662</td>
<td>M</td>
<td><u>Maksut Nizamutdinov</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>356</td>
<td>357</td>
<td>F</td>
<td><u>Kolobanova Svetlana</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>117</td>
<td>118</td>
<td>M</td>
<td><u>Guskov Vladislav</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>351</td>
<td>352</td>
<td>M</td>
<td><u>Kolesnikov Dmitriy</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>92</td>
<td>93</td>
<td>M</td>
<td><u>Kuznetsov Oleg</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>50</td>
<td>51</td>
<td>M</td>
<td><u>Khoraykin Maksim</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td><u>Brylev Aleksey</u></td>
<td>...</td>
<td>RUS</td>
<td> </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，检查唯一字符：</font></font><br>
<br>
<pre><code class="python hljs">set( <span class="hljs-string">''</span>.join(ar[<span class="hljs-string">'name'</span>].unique()))
</code></pre><br>
<code><b>Out:</b> [' ', "'", '-', '?', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J','K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切正确。</font><font style="vertical-align: inherit;">结果，更正影响了1,253,882，占记录总数的89％，唯一名称的数量从660,207减少至599,186，即减少了61,000或几乎10％。</font><font style="vertical-align: inherit;">哇！</font><font style="vertical-align: inherit;">将ar记录的并集转换回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议字典后，保存到新文件</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details4.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们需要恢复顺序。也就是说，所有记录看起来都将是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-First Name Last Name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Last Name First Name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。要确定哪一个。是的，除了名称和姓氏之外，某些协议还包含中间名。可能发生的是，同一个人在不同协议中的书写方式有所不同-某个中间名的地方，而另一个中间名。这会干扰他的身份，因此请尝试删除中间名。男性的</font><i><font style="vertical-align: inherit;">姓氏</font></i><font style="vertical-align: inherit;">通常以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ hiv”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font><font style="vertical-align: inherit;">，女性的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓氏</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常以</font><i><font style="vertical-align: inherit;">“ vna”结尾</font></i><font style="vertical-align: inherit;">。但是也有例外。例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Ilyich，Ilyinichna，Nikitich，Nikitichna</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。是的，很少有这样的例外。如前所述，可以将一种协议中的名称格式视为永久性的。因此，要摆脱赞助人，您需要找到他们所处的种族。为此，请</font><font style="vertical-align: inherit;">在列</font><i><font style="vertical-align: inherit;">名称中</font></i><font style="vertical-align: inherit;">找到片段</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ vich”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ vna”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的总数</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将它们与每个协议中的条目总数进行比较。如果这些数字接近，则有一个中间名，否则就没有。寻求严格的合规是不合理的，例如，即使在记录中间名的比赛中，外国人也可以参加，并且没有他的情况下，他们也会被记录下来。也有可能参与者忘记了或不想指出他的中间名。另一方面，也有以``vich''结尾的姓氏，在白俄罗斯和其他国家中有许多姓氏为斯拉夫语的姓氏。此外，我们进行了音译。可以在音译之前进行此分析，但随后有机会错过其中有中间名的协议，但最初它已经是拉丁文了。所以一切都很好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们将</font><font style="vertical-align: inherit;">在该列中</font><font style="vertical-align: inherit;">查找所有片段数量为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ vich”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ vna”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的协议</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超过协议中条目总数的50％。</font></font><br>
<br>
<pre><code class="python hljs">wp = {} <span class="hljs-comment">#wp – with patronymic </span><font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd:<font></font>
    nvich = (<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name'</span>])).count(<span class="hljs-string">'vich'</span>) <font></font>
    nvna = (<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name'</span>])).count(<span class="hljs-string">'vna'</span>)
    <span class="hljs-keyword">if</span> nvich + nvna &gt; <span class="hljs-number">0.5</span>*len(rd[e]):<font></font>
        wp[e] = rd[e]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有29种这样的协议。</font><font style="vertical-align: inherit;">有趣的是，如果不是50％而是20％，反之则是70％，结果不变，因此29种协议不变。因此，我们做出了正确的选择。</font><font style="vertical-align: inherit;">因此，少于20％-姓氏的影响，超过70％-没有中间名的个人记录的影响。</font><font style="vertical-align: inherit;">借助数据透视表检查了该国，结果发现其中有25个在俄罗斯，有4个在阿布哈兹。</font><font style="vertical-align: inherit;">
继续。</font><font style="vertical-align: inherit;">我们将只处理包含三个部分的记录，即那些（大概）有姓，名，中间名的部分。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>...</th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Yaroslav <u>Stanislavovich</u> Pavlishchev</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Vladimir <u>Vasilevich</u> Perezhigin</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Vladislav <u>Evgenevich</u> Litvinchuk</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>M</td>
<td>Sergey <u>Gennadevich</u> Gavrilenko</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td>Ivan <u>Markovich</u> Markin</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td>Nikolay <u>Evgenevich</u> Sokolov</td>
<td>RUS</td>
<td>...</td>
<td>Nikolay Evgenevich Sokolov</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td>Aram <u>Pavlovich</u> Kukhtiev</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td>Andrey <u>Anatolevich</u> Andreev</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td>Denis <u>Valerevich</u> Bulgakov</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>M</td>
<td>Aleksandr <u>Ivanovich</u> Kuts</td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">sum_n3w = <span class="hljs-number">0</span> <span class="hljs-comment"># sum name of 3 words</span>
sum_nnot3w = <span class="hljs-number">0</span> <span class="hljs-comment"># sum name not of 3 words</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp: <font></font>
    sum_n3w += len([n <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> wp[e][<span class="hljs-string">'name'</span>] <span class="hljs-keyword">if</span> len(n.split()) == <span class="hljs-number">3</span>])<font></font>
    sum_nnot3w += len(wp[e]) - n3w<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此类记录的大多数为86％。</font><font style="vertical-align: inherit;">现在，将三个组成部分划分为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name0，name1，name2的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp:<font></font>
    ind3 = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rd[e].index <span class="hljs-keyword">if</span> len(rd[e].loc[i,<span class="hljs-string">'name'</span>].split()) == <span class="hljs-number">3</span>]<font></font>
    rd[e][<span class="hljs-string">'name0'</span>] = <span class="hljs-string">''</span>
    rd[e][<span class="hljs-string">'name1'</span>] = <span class="hljs-string">''</span>
    rd[e][<span class="hljs-string">'name2'</span>] = <span class="hljs-string">''</span>
    rd[e].loc[ind3, <span class="hljs-string">'name0'</span>] = rd[e].loc[ind3,<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">0</span>]<font></font>
    rd[e].loc[ind3, <span class="hljs-string">'name1'</span>] = rd[e].loc[ind3,<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">1</span>]<font></font>
    rd[e].loc[ind3, <span class="hljs-string">'name2'</span>] = rd[e].loc[ind3,<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">2</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是其中一种协议的样子：</font><font style="vertical-align: inherit;">特别是，很明显，这两个组件的记录尚未处理。</font><font style="vertical-align: inherit;">现在，对于每种协议，您需要确定哪一列具有中间名称。</font><font style="vertical-align: inherit;">只有两个</font><i><font style="vertical-align: inherit;">选项-name1，name2</font></i><font style="vertical-align: inherit;">，因为它不能放在第一位。</font><font style="vertical-align: inherit;">确定后，我们将收集一个没有该名称的新名称。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>name</th>
<th><u>name0</u></th>
<th><u>name1</u></th>
<th><u>name2</u></th>
<th>...</th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>Lekomtsev Denis Nikolaevich</td>
<td><u>Lekomtsev</u></td>
<td><u>Denis</u></td>
<td><u>Nikolaevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>Ivanov Andrey Aleksandrovich</td>
<td><u>Ivanov</u></td>
<td><u>Andrey</u></td>
<td><u>Aleksandrovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>Ivanov Evgeniy Vasilevich</td>
<td><u>Ivanov</u></td>
<td><u>Evgeniy</u></td>
<td><u>Vasilevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>Setepov Vladislav</td>
<td></td>
<td></td>
<td></td>
<td>...</td>
<td> </td>
</tr>
<tr>
<td>4</td>
<td>Mishanin Sergey Yurevich</td>
<td><u>Mishanin</u></td>
<td><u>Sergey</u></td>
<td><u>Yurevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>Baranov Andrey Aleksandrovich</td>
<td><u>Baranov</u></td>
<td><u>Andrey</u></td>
<td><u>Aleksandrovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>6</td>
<td>Nakaryakov Dmitriy Valerevich</td>
<td><u>Nakaryakov</u></td>
<td><u>Dmitriy</u></td>
<td><u>Valerevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>Tretyakov Dmitriy Valentinovich</td>
<td><u>Tretyakov</u></td>
<td><u>Dmitriy</u></td>
<td><u>Valentinovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>Kuznetsov Stanislav Vladimirovich</td>
<td><u>Kuznetsov</u></td>
<td><u>Stanislav</u></td>
<td><u>Vladimirovich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>Dubrovin Maksim Sergeevich</td>
<td><u>Dubrovin</u></td>
<td><u>Maksim</u></td>
<td><u>Sergeevich</u></td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>10</td>
<td>Karpov Anatoliy Sergeevich</td>
<td><u>Karpov</u></td>
<td><u>Anatoliy</u></td>
<td><u>Sergeevich</u></td>
<td>...</td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp:    <font></font>
    n1=(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name1'</span>])).count(<span class="hljs-string">'vich'</span>)+(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name1'</span>])).count(<span class="hljs-string">'vna'</span>)<font></font>
    n2=(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name2'</span>])).count(<span class="hljs-string">'vich'</span>)+(<span class="hljs-string">''</span>.join(rd[e][<span class="hljs-string">'name2'</span>])).count(<span class="hljs-string">'vna'</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (n1 &gt; n2):<font></font>
        rd[e][<span class="hljs-string">'new name'</span>] = rd[e][<span class="hljs-string">'name0'</span>] + <span class="hljs-string">' '</span> + rd[e][<span class="hljs-string">'name2'</span>]
    <span class="hljs-keyword">else</span>:<font></font>
        rd[e][<span class="hljs-string">'new name'</span>] = rd[e][<span class="hljs-string">'name0'</span>] + <span class="hljs-string">' '</span> + rd[e][<span class="hljs-string">'name1'</span>]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>name</th>
<th>name0</th>
<th>name1</th>
<th>name2</th>
<th><u>new name</u></th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>Gorik Pavel Vladimirovich</td>
<td>Gorik</td>
<td>Pavel</td>
<td>Vladimirovich</td>
<td><u>Gorik Pavel</u></td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>Korobov Oleg Anatolevich</td>
<td>Korobov</td>
<td>Oleg</td>
<td>Anatolevich</td>
<td><u>Korobov Oleg</u></td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>Pavlishchev Yaroslav Stanislavovich</td>
<td>Pavlishchev</td>
<td>Yaroslav</td>
<td>Stanislavovich</td>
<td><u>Pavlishchev Yaroslav</u></td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>Fedorov Nikolay Nikolaevich</td>
<td>Fedorov</td>
<td>Nikolay</td>
<td>Nikolaevich</td>
<td><u>Fedorov Nikolay</u></td>
<td>  </td>
</tr>
<tr>
<td>4</td>
<td>Medvedev Andrey Aleksandrovich</td>
<td>Medvedev</td>
<td>Andrey</td>
<td>Aleksandrovich</td>
<td><u>Medvedev Andrey</u></td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>Popov Sergey Eduardovich</td>
<td>Popov</td>
<td>Sergey</td>
<td>Eduardovich</td>
<td><u>Popov Sergey</u></td>
<td>  </td>
</tr>
<tr>
<td>6</td>
<td>Dumchev Andrey Viktorovich</td>
<td>Dumchev</td>
<td>Andrey</td>
<td>Viktorovich</td>
<td><u>Dumchev Andrey</u></td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>Trusov Mikhail Vladimirovich</td>
<td>Trusov</td>
<td>Mikhail</td>
<td>Vladimirovich</td>
<td><u>Trusov Mikhail</u></td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>Demichev Yuriy Anatolevich</td>
<td>Demichev</td>
<td>Yuriy</td>
<td>Anatolevich</td>
<td><u>Demichev Yuriy</u></td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>Pushkin Boris Sergeevich</td>
<td>Pushkin</td>
<td>Boris</td>
<td>Sergeevich</td>
<td><u>Pushkin Boris</u></td>
<td>  </td>
</tr>
<tr>
<td>10</td>
<td>Lando Aleksandr Borisovich</td>
<td>Lando</td>
<td>Aleksandr</td>
<td>Borisovich</td>
<td><u>Lando Aleksandr</u></td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，小心地将新名称分配给主列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不为空），然后删除辅助列。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> wp:<font></font>
    ind = rd[e][rd[e][<span class="hljs-string">'new name'</span>].str.strip() != <span class="hljs-string">''</span>].index<font></font>
    rd[e].loc[ind, <span class="hljs-string">'name'</span>] = rd[e].loc[ind, <span class="hljs-string">'new name'</span>]<font></font>
    rd[e] = rd[e].drop(columns = [<span class="hljs-string">'name0'</span>,<span class="hljs-string">'name1'</span>,<span class="hljs-string">'name2'</span>,<span class="hljs-string">'new name'</span>])
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>...</th>
<th>name raw</th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td><u>Yaroslav Pavlishchev</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td><u>Vladimir Perezhigin</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td><u>Vladislav Litvinchuk</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>M</td>
<td><u>Sergey Gavrilenko</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td><u>Ivan Markin</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td><u>Nikolay Sokolov</u></td>
<td>RUS</td>
<td>...</td>
<td>Nikolay Evgenevich Sokolov</td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td><u>Aram Kukhtiev</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td><u>Andrey Andreev</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td><u>Denis Bulgakov</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>M</td>
<td><u>Aleksandr Kuts</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
<tr>
<td>10</td>
<td>11</td>
<td>M</td>
<td><u>Aleksandr Lando</u></td>
<td>RUS</td>
<td>...</td>
<td>  </td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这就是全部。</font><font style="vertical-align: inherit;">我们编辑了2,035个条目。</font><font style="vertical-align: inherit;">不错。</font><font style="vertical-align: inherit;">已保存。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details5.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，您需要将名称重新排序。</font><font style="vertical-align: inherit;">也就是说，在所有协议中，所有协议中的名称都必须先跟随其后的名字，反之亦然-首先是姓氏，然后是名字。</font><font style="vertical-align: inherit;">取决于哪个，现在我们将找出答案。</font><font style="vertical-align: inherit;">全名可以包含两个以上的单词，即使在删除中间名之后，情况也有些复杂。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'nwin'</span>] = ar[<span class="hljs-string">'name'</span>].str.count(<span class="hljs-string">' '</span>) + <span class="hljs-number">1</span> <span class="hljs-comment"># nwin – number of words in name</span>
ar.loc[ar[<span class="hljs-string">'name'</span>] == <span class="hljs-string">''</span>,<span class="hljs-string">'nwin'</span>] = <span class="hljs-number">0</span>
<span class="hljs-number">100</span>*ar[<span class="hljs-string">'nwin'</span>].value_counts()/len(ar)
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名称中的单词数记录数记录所占的百分比（％）</font><font style="vertical-align: inherit;">当然，绝大多数（91％）是两个单词-只是一个名字和一个姓。</font><font style="vertical-align: inherit;">但是带有三个和四个词的条目也很多。</font><font style="vertical-align: inherit;">让我们看一下这些记录的国籍：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>   </th>
<th> </th>
<th>  (%)</th>
</tr>
<tr>
<td>2</td>
<td>1285270</td>
<td>90.74426</td>
</tr>
<tr>
<td>3</td>
<td>102220</td>
<td>7.217066</td>
</tr>
<tr>
<td>4</td>
<td>22420</td>
<td>1.582925</td>
</tr>
<tr>
<td>0</td>
<td>3454</td>
<td>0.243864</td>
</tr>
<tr>
<td>5</td>
<td>2385</td>
<td>0.168389</td>
</tr>
<tr>
<td>6</td>
<td>469</td>
<td>0.033113</td>
</tr>
<tr>
<td>1</td>
<td>80</td>
<td>0.005648</td>
</tr>
<tr>
<td>7</td>
<td>57</td>
<td>0.004024</td>
</tr>
<tr>
<td>8</td>
<td>5</td>
<td>0.000353</td>
</tr>
<tr>
<td>10</td>
<td>4</td>
<td>0.000282</td>
</tr>
<tr>
<td>9</td>
<td>1</td>
<td>0.000071</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'nwin'</span>] &gt;= <span class="hljs-number">3</span>][<span class="hljs-string">'country'</span>].value_counts()[:<span class="hljs-number">12</span>]
</code></pre><br>
<code><b>Out: </b><br>
ESP 28435<br>
MEX 10561<br>
USA 7608<br>
DNK 7178<br>
BRA 6321<br>
NLD 5748<br>
DEU 4310<br>
PHL 3941<br>
ZAF 3862<br>
ITA 3691<br>
BEL 3596<br>
FRA 3323<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，首先是西班牙，其次是西班牙-墨西哥，这是一个西班牙裔国家，比美国更远，美国在历史上也有很多西班牙裔。巴西和菲律宾也是西班牙（和葡萄牙语）的名称。丹麦，荷兰，德国，南非，意大利，比利时和法国是另一回事，有时候姓氏有时会带有某种前缀，因此有两个以上的单词。但是，在所有这些情况下，名称本身通常由一个单词组成，姓氏由两个，三个组成。当然，该规则也有例外，但是我们将不再处理它们。首先，对于每种协议，您需要确定顺序是什么：名称-姓氏，反之亦然。怎么做？我想到了以下想法：首先，姓氏的种类通常比名字的种类大得多。即使在一个协议的框架内也是如此。其次，名称的长度通常小于姓氏的长度（即使是非复合姓氏）。我们将结合使用这些条件来确定初步订单。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择全名的第一个和最后一个单词：</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'new name'</span>] = ar[<span class="hljs-string">'name'</span>]<font></font>
ind = ar[ar[<span class="hljs-string">'nwin'</span>] &lt; <span class="hljs-number">2</span>].index<font></font>
ar.loc[ind, <span class="hljs-string">'new name'</span>] = <span class="hljs-string">'. .'</span> <span class="hljs-comment">#  ,   str.split()   </span>
ar[<span class="hljs-string">'wfin'</span>] = ar[<span class="hljs-string">'new name'</span>].str.split().str[<span class="hljs-number">0</span>] <span class="hljs-comment">#fwin  – first word in name</span>
ar[<span class="hljs-string">'lwin'</span>] = ar[<span class="hljs-string">'new name'</span>].str.split().str[<span class="hljs-number">-1</span>]<span class="hljs-comment">#lfin – last word in name</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将合并的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据帧转换</font><font style="vertical-align: inherit;">回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字典，</font><font style="vertical-align: inherit;">以便新列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nwin，ns0，ns</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">落入每个种族的数据帧。</font><font style="vertical-align: inherit;">接下来，</font><font style="vertical-align: inherit;">根据我们的标准</font><font style="vertical-align: inherit;">，确定顺序为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名姓</font><i><font style="vertical-align: inherit;">”</font></i><font style="vertical-align: inherit;">的协议数和顺序相反的协议数。</font><font style="vertical-align: inherit;">我们将仅考虑全名由两个单词组成的条目。</font><font style="vertical-align: inherit;">同时，将名称（名字）保存在新列中：</font></font><br>
<br>
<pre><code class="python hljs">name_surname = {}<font></font>
surname_name = {}<font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd:<font></font>
    d = rd[e][rd[e][<span class="hljs-string">'nwin'</span>] == <span class="hljs-number">2</span>]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(d[<span class="hljs-string">'fwin'</span>].unique()) &lt; len(d[<span class="hljs-string">'lwin'</span>].unique()) <span class="hljs-keyword">and</span> len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'fwin'</span>])) &lt; len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'lwin'</span>])):<font></font>
        name_surname[e] = d<font></font>
        rd[e][<span class="hljs-string">'first name'</span>] = rd[e][<span class="hljs-string">'fwin'</span>]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(d[<span class="hljs-string">'fwin'</span>].unique()) &gt; len(d[<span class="hljs-string">'lwin'</span>].unique()) <span class="hljs-keyword">and</span> len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'fwin'</span>])) &gt; len(<span class="hljs-string">''</span>.join(d[<span class="hljs-string">'lwin'</span>])):<font></font>
        surname_name[e] = d<font></font>
        rd[e][<span class="hljs-string">'first name'</span>] = rd[e][<span class="hljs-string">'lwin'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果是：“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓氏名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”命令-244个协议，“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓氏名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”命令</font><font style="vertical-align: inherit;">-1,508个协议。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们将导致更常见的格式。</font><font style="vertical-align: inherit;">由于我们同时检查了两个条件的满足情况，甚至存在严格的不平等性，因此总和小于总金额。</font><font style="vertical-align: inherit;">在某些协议中，只有其中一个条件可以满足，或者可以满足，但是不太可能发生平等。</font><font style="vertical-align: inherit;">但这是完全不重要的，因为已经定义了格式。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，假设我们已经以足够高的精度确定了订单，而不会忘记它不是100％准确的，我们将使用此信息。</font><font style="vertical-align: inherit;">在“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名字”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列中找到最受欢迎的名字</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">vc = ar[<span class="hljs-string">'first name'</span>].value_counts()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
遇到相遇一百次以上的人：</font></font><br>
<br>
<pre><code class="python hljs">pfn=vc[vc&gt;<span class="hljs-number">100</span>] <span class="hljs-comment">#pfn – popular first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
共有1,673个，以下是前一百个，按流行程度从高到低排列：</font><font style="vertical-align: inherit;">
现在，使用此列表，我们将遍历所有协议，并比较在名称的第一个单词或最后一个单词中还有更多匹配项的位置。我们将只考虑两个单词的名称。如果与最后一个单词有更多匹配项，则顺序是正确的；如果与第一个单词匹配，则相反。而且，在这里我们已经更加自信，因此您可以使用此知识，并且每次通过时，我们都会将其下一个协议的名称列表添加到初始流行名称列表中。为了避免随机错误，我们根据名称在初始列表中出现的频率对协议进行了预排序，从而为那些匹配项很少且将在周期结束时进行处理的协议准备了更广泛的列表。</font></font><br>
<code>['Michael', 'David', 'Thomas', 'John', 'Daniel', 'Mark', 'Peter', 'Paul', 'Christian', 'Robert', 'Martin', 'James', 'Andrew', 'Chris', 'Richard', 'Andreas', 'Matthew', 'Brian', 'Patrick', 'Scott', 'Kevin', 'Stefan', 'Jason', 'Eric', 'Christopher', 'Alexander', 'Simon', 'Mike', 'Tim', 'Frank', 'Stephen', 'Steve', 'Andrea', 'Jonathan', 'Markus', 'Marco', 'Adam', 'Ryan', 'Jan', 'Tom', 'Marc', 'Carlos', 'Jennifer', 'Matt', 'Steven', 'Jeff', 'Sergey', 'William', 'Aleksandr', 'Sarah', 'Alex', 'Jose', 'Andrey', 'Benjamin', 'Sebastian', 'Ian', 'Anthony', 'Ben', 'Oliver', 'Antonio', 'Ivan', 'Sean', 'Manuel', 'Matthias', 'Nicolas', 'Dan', 'Craig', 'Dmitriy', 'Laura', 'Luis', 'Lisa', 'Kim', 'Anna', 'Nick', 'Rob', 'Maria', 'Greg', 'Aleksey', 'Javier', 'Michelle', 'Andre', 'Mario', 'Joseph', 'Christoph', 'Justin', 'Jim', 'Gary', 'Erik', 'Andy', 'Joe', 'Alberto', 'Roberto', 'Jens', 'Tobias', 'Lee', 'Nicholas', 'Dave', 'Tony', 'Olivier', 'Philippe']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">sbpn = pd.DataFrame(columns = [<span class="hljs-string">'event'</span>, <span class="hljs-string">'num pop names'</span>], index=range(len(rd))) <span class="hljs-comment"># sbpn - sorted by popular names</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(rd)):<font></font>
    e = list(rd.keys())[i]<font></font>
    sbpn.loc[i, <span class="hljs-string">'event'</span>] = e<font></font>
    sbpn.loc[i, <span class="hljs-string">'num pop names'</span>] = len(set(pfn).intersection(rd[e][<span class="hljs-string">'first name'</span>]))<font></font>
<font></font>
sbnp=sbnp.sort_values(by = <span class="hljs-string">'num pop names'</span>,ascending=<span class="hljs-literal">False</span>)<font></font>
sbnp = sbnp.reset_index(drop=<span class="hljs-literal">True</span>) 
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>num pop names</th>
</tr>
<tr>
<td>0</td>
<td>Ironman World Championship 70.3 2016</td>
<td>811</td>
</tr>
<tr>
<td>1</td>
<td>Ironman World Championship 2019</td>
<td>781</td>
</tr>
<tr>
<td>2</td>
<td>Ironman World Championship 70.3 2015</td>
<td>778</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Mallorca 70.3 2014</td>
<td>776</td>
</tr>
<tr>
<td>4</td>
<td>Ironman World Championship 2018</td>
<td>766</td>
</tr>
<tr>
<td>5</td>
<td>Challenge Roth Long 2019</td>
<td>759</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>1917</td>
<td>Challenge Gran Canaria Olympic 2019</td>
<td>0</td>
</tr>
<tr>
<td>1918</td>
<td>Challenge Gran Canaria Middle 2017</td>
<td>0</td>
</tr>
<tr>
<td>1919</td>
<td>Challenge Forte Village-Sardinia Sprint 2017</td>
<td>0</td>
</tr>
<tr>
<td>1920</td>
<td>ITU European Cup Kuopio Sprint 2007</td>
<td>0</td>
</tr>
<tr>
<td>1921</td>
<td>ITU World Cup Madeira Olympic 2002</td>
<td>0</td>
</tr>
</tbody></table></div></code><br>
<br>
<pre><code class="python hljs">tofix = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(rd)):<font></font>
    e = sbpn.loc[i, <span class="hljs-string">'event'</span>]<font></font>
<font></font>
    <span class="hljs-keyword">if</span> len(set(list(rd[e][<span class="hljs-string">'fwin'</span>])).intersection(pfn)) &gt; len(set(list(rd[e][<span class="hljs-string">'lwin'</span>])).intersection(pfn)):<font></font>
        tofix.append(e)<font></font>
        pfn = list(set(pfn + list(rd[e][<span class="hljs-string">'fwin'</span>])))
    <span class="hljs-keyword">else</span>:<font></font>
        pfn = list(set(pfn + list(rd[e][<span class="hljs-string">'lwin'</span>])))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有235个协议。也就是说，与第一近似（244）中所发生的相同。可以肯定的是，我选择性地查看了每个记录的前三个记录，以确保所有内容都是正确的。还要检查排序的第一阶段是否从类</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称姓氏中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入了36个错误条目，</font><font style="vertical-align: inherit;">并从类</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出了2个错误条目</font><font style="vertical-align: inherit;">。我查看了每个记录的前三个记录，确实，第二个阶段运行良好。现在，实际上，仍然需要修复发现错误顺序的那些协议：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> tofix:<font></font>
    ind = rd[e][rd[e][<span class="hljs-string">'nwin'</span>] &gt; <span class="hljs-number">1</span>].index<font></font>
    rd[e].loc[ind,<span class="hljs-string">'name'</span>] = rd[e].loc[ind,<span class="hljs-string">'name'</span>].str.split(n=<span class="hljs-number">1</span>).str[<span class="hljs-number">1</span>] + <span class="hljs-string">' '</span> +                   rd[e].loc[ind,<span class="hljs-string">'name'</span>].str.split(n=<span class="hljs-number">1</span>).str[<span class="hljs-number">0</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在拆分中，我们使用参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制了件</font><i><font style="vertical-align: inherit;">数</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">逻辑是这样的：名称是一个单词，全名中的第一个。</font><font style="vertical-align: inherit;">其他所有内容都是姓（可能由几个词组成）。</font><font style="vertical-align: inherit;">只需交换它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们摆脱不必要的列并保存：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd:<font></font>
    rd[e] = rd[e].drop(columns = [<span class="hljs-string">'new name'</span>, <span class="hljs-string">'first name'</span>, <span class="hljs-string">'fwin'</span>,<span class="hljs-string">'lwin'</span>, <span class="hljs-string">'nwin'</span>])<font></font>
<font></font>
pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details6.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
检查结果。</font><font style="vertical-align: inherit;">随机打固定记录：</font><font style="vertical-align: inherit;">总共固定108,000条记录。</font><font style="vertical-align: inherit;">唯一全名的数量从598个减少至54.7万个。</font><font style="vertical-align: inherit;">精细！</font><font style="vertical-align: inherit;">完成格式化。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th><u>name</u></th>
<th>country</th>
<th>group</th>
<th>...</th>
<th><u>name raw</u></th>
</tr>
<tr>
<td>188</td>
<td>189</td>
<td>M</td>
<td><u>Azhel Dmitriy</u></td>
<td>BLR</td>
<td></td>
<td>...</td>
<td><u> </u></td>
</tr>
<tr>
<td>96</td>
<td>97</td>
<td>M</td>
<td><u>Bostina Cristian</u></td>
<td>ROU</td>
<td></td>
<td>...</td>
<td><u>Cristian Bostina</u></td>
</tr>
<tr>
<td>1757</td>
<td>1758</td>
<td>M</td>
<td><u>Lowe Jonathan</u></td>
<td>AUS</td>
<td>M30-34</td>
<td>...</td>
<td><u>Jonathan LOWE</u></td>
</tr>
<tr>
<td>599</td>
<td>600</td>
<td>M</td>
<td><u>Baerwald Manuel</u></td>
<td>DEU</td>
<td></td>
<td>...</td>
<td><u>Manuel BAERWALD</u></td>
</tr>
<tr>
<td>657</td>
<td>658</td>
<td>M</td>
<td><u>Krumdieck Ralf</u></td>
<td>DEU</td>
<td></td>
<td>...</td>
<td><u>Ralf KRUMDIECK</u></td>
</tr>
<tr>
<td>354</td>
<td>355</td>
<td>F</td>
<td><u>Knapp Samantha</u></td>
<td>USA</td>
<td>F30-34</td>
<td>...</td>
<td><u>Samantha Knapp</u></td>
</tr>
<tr>
<td>375</td>
<td>376</td>
<td>M</td>
<td><u>Rintalaulaja Mika</u></td>
<td>FIN</td>
<td>M40-44</td>
<td>...</td>
<td><u>Mika Rintalaulaja</u></td>
</tr>
<tr>
<td>1304</td>
<td>1305</td>
<td>M</td>
<td><u>Dee Jim</u></td>
<td>USA</td>
<td>M50-54</td>
<td>...</td>
<td><u>Jim DEE</u></td>
</tr>
<tr>
<td>178</td>
<td>179</td>
<td>M</td>
<td><u>Halibert Greg</u></td>
<td>FRA</td>
<td></td>
<td>...</td>
<td><u>GREG HALIBERT</u></td>
</tr>
<tr>
<td>2740</td>
<td>2741</td>
<td>F</td>
<td><u>Comia Marissa</u></td>
<td>USA</td>
<td>F45-49</td>
<td>...</td>
<td><u>Marissa COMIA</u></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3部分。不完整数据的恢复</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在继续恢复丢失的数据。</font><font style="vertical-align: inherit;">并且有这样。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们从国家开始。</font><font style="vertical-align: inherit;">查找未显示国家/地区的所有记录：</font></font><br>
<br>
<pre><code class="python hljs">arnc = ar[ar[<span class="hljs-string">'country'</span>] == <span class="hljs-string">''</span>] <span class="hljs-comment">#arnc – all records with no country</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中有3,221个，其中随机有10个：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th><u>country</u></th>
<th>group</th>
<th>...</th>
<th>country raw</th>
</tr>
<tr>
<td>...</td>
<td>1633</td>
<td>M</td>
<td>Guerrero Pla Angel</td>
<td></td>
<td>M30-34</td>
<td>...</td>
<td>E</td>
</tr>
<tr>
<td>...</td>
<td>258</td>
<td>M</td>
<td>Bellm Mathias</td>
<td></td>
<td>M35-39</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>655</td>
<td>M</td>
<td>Moratto Alessio</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>I</td>
</tr>
<tr>
<td>...</td>
<td>1317</td>
<td>M</td>
<td>Solari Jean-Jacques</td>
<td></td>
<td>M50-54</td>
<td>...</td>
<td>TAH</td>
</tr>
<tr>
<td>...</td>
<td>1311</td>
<td>F</td>
<td>Duranel Isabelle</td>
<td></td>
<td>F40-44</td>
<td>...</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1012</td>
<td>M</td>
<td>Endler Maximilian</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>284</td>
<td>M</td>
<td>Schreiner Jorg</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>14</td>
<td>M</td>
<td>Butturini Jacopo</td>
<td></td>
<td></td>
<td>...</td>
<td>ITU</td>
</tr>
<tr>
<td>...</td>
<td>204</td>
<td>M</td>
<td>Lindner Thomas</td>
<td></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>1168</td>
<td>M</td>
<td>Gramke Peter</td>
<td></td>
<td>M45-49</td>
<td>...</td>
<td>D</td>
</tr>
</tbody></table></div></code><br>
<br>
<pre><code class="python hljs">nnc = arnc[<span class="hljs-string">'name'</span>].unique() <span class="hljs-comment">#nnc - names with no country</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
没有国家/地区的记录中唯一名称的数量为3051。让我们看看是否可以减少该数量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事实是，在铁人三项赛中，人们很少只参加一场比赛，他们通常会定期参加比赛，每个赛季几次，每年一次，不断训练。</font><font style="vertical-align: inherit;">因此，对于数据中的许多名称，很可能有多个记录。</font><font style="vertical-align: inherit;">要恢复有关该国家的信息，请尝试在指示该国家的记录中查找具有相同名称的记录。</font></font><br>
<br>
<pre><code class="python hljs">arwc = ar[ar[<span class="hljs-string">'country'</span>] != <span class="hljs-string">''</span>] <span class="hljs-comment">#arwc – all records with country</span>
nwc = arwc[<span class="hljs-string">'name'</span>].unique() <span class="hljs-comment">#nwc – names with country</span>
tofix = set(nnc).intersection(nwc)</code></pre><br>
<code><b>Out:</b> ['Kleber-Schad Ute Cathrin', 'Sellner Peter', 'Pfeiffer Christian', 'Scholl Thomas', 'Petersohn Sandra', 'Marchand Kurt', 'Janneck Britta', 'Angheben Riccardo', 'Thiele Yvonne', 'Kie?Wetter Martin', 'Schymik Gerhard', 'Clark Donald', 'Berod Brigitte', 'Theile Markus', 'Giuliattini Burbui Margherita', 'Wehrum Alexander', 'Kenny Oisin', 'Schwieger Peter', 'Grosse Bianca', 'Schafter Carsten', 'Breck Dirk', 'Mautes Christoph', 'Herrmann Andreas', 'Gilbert Kai', 'Steger Peter', 'Jirouskova Jana', 'Jehrke Michael', 'Valentine David', 'Reis Michael', 'Wanka Michael', 'Schomburg Jonas', 'Giehl Caprice', 'Zinser Carsten', 'Schumann Marcus', 'Magoni Livio', 'Lauden Yann', 'Mayer Dieter', 'Krisa Stefan', 'Haberecht Bernd', 'Schneider Achim', 'Gibanel Curto Antonio', 'Miranda Antonio', 'Juarez Pedro', 'Prelle Gerrit', 'Wuste Kay', 'Bullock Graeme', 'Hahner Martin', 'Kahl Maik', 'Schubnell Frank', 'Hastenteufel Marco', …]<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中有2236个，即接近四分之三。</font><font style="vertical-align: inherit;">现在，对于此列表中的每个名称，您需要通过其所在位置的记录来确定国家/地区。</font><font style="vertical-align: inherit;">但是碰巧在多个记录中和在不同的国家都可以找到相同的名称。</font><font style="vertical-align: inherit;">这要么是同名，要么是搬家。</font><font style="vertical-align: inherit;">因此，我们首先处理所有事物都是唯一的事物。</font></font><br>
<br>
<pre><code class="python hljs">fix = {}<font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> tofix:<font></font>
    nr = arwc[arwc[<span class="hljs-string">'name'</span>] == n] <font></font>
	<font></font>
    <span class="hljs-keyword">if</span> len(nr[<span class="hljs-string">'country'</span>].unique()) == <span class="hljs-number">1</span>:<font></font>
        fix[n] = nr[<span class="hljs-string">'country'</span>].iloc[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
循环制作。</font><font style="vertical-align: inherit;">但是，坦率地说，它可以解决很长时间-大约三分钟。</font><font style="vertical-align: inherit;">如果有更多数量级的条目，则可能必须提出矢量实现。</font><font style="vertical-align: inherit;">有2,013个条目，占潜力的90％。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
不同国家在不同记录中可能出现的名称，以最常出现的国家为准。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> n <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> fix:<font></font>
    nr = arwc[arwc[<span class="hljs-string">'name'</span>] == n]<font></font>
    vc = nr[<span class="hljs-string">'country'</span>].value_counts()    <font></font>
	<font></font>
    <span class="hljs-keyword">if</span> vc[<span class="hljs-number">0</span>] &gt; vc[<span class="hljs-number">1</span>]:<font></font>
        fix[n] = vc.index[<span class="hljs-number">0</span>]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，找到了2,208个名称匹配，占所有潜在名称的99％。</font><font style="vertical-align: inherit;">
我们应用以下对应关系：</font></font><br>
<code>{'Kleber-Schad Ute Cathrin': 'DEU', 'Sellner Peter': 'AUT', 'Pfeiffer Christian': 'AUT', 'Scholl Thomas': 'DEU', 'Petersohn Sandra': 'DEU', 'Marchand Kurt': 'BEL', 'Janneck Britta': 'DEU', 'Angheben Riccardo': 'ITA', 'Thiele Yvonne': 'DEU', 'Kie?Wetter Martin': 'DEU', 'Clark Donald': 'GBR', 'Berod Brigitte': 'FRA', 'Theile Markus': 'DEU', 'Giuliattini Burbui Margherita': 'ITA', 'Wehrum Alexander': 'DEU', 'Kenny Oisin': 'IRL', 'Schwieger Peter': 'DEU', 'Schafter Carsten': 'DEU', 'Breck Dirk': 'DEU', 'Mautes Christoph': 'DEU', 'Herrmann Andreas': 'DEU', 'Gilbert Kai': 'DEU', 'Steger Peter': 'AUT', 'Jirouskova Jana': 'CZE', 'Jehrke Michael': 'DEU', 'Wanka Michael': 'DEU', 'Giehl Caprice': 'DEU', 'Zinser Carsten': 'DEU', 'Schumann Marcus': 'DEU', 'Magoni Livio': 'ITA', 'Lauden Yann': 'FRA', 'Mayer Dieter': 'DEU', 'Krisa Stefan': 'DEU', 'Haberecht Bernd': 'DEU', 'Schneider Achim': 'DEU', 'Gibanel Curto Antonio': 'ESP', 'Juarez Pedro': 'ESP', 'Prelle Gerrit': 'DEU', 'Wuste Kay': 'DEU', 'Bullock Graeme': 'GBR', 'Hahner Martin': 'DEU', 'Kahl Maik': 'DEU', 'Schubnell Frank': 'DEU', 'Hastenteufel Marco': 'DEU', 'Tedde Roberto': 'ITA', 'Minervini Domenico': 'ITA', 'Respondek Markus': 'DEU', 'Kramer Arne': 'DEU', 'Schreck Alex': 'DEU', 'Bichler Matthias': 'DEU', …}<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> fix:<font></font>
    ind = arnc[arnc[<span class="hljs-string">'name'</span>] == n].index<font></font>
    ar.loc[ind, <span class="hljs-string">'country'</span>] = fix[n]</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th><u>country</u></th>
<th>group</th>
<th>...</th>
<th>country raw</th>
</tr>
<tr>
<td>...</td>
<td>1633</td>
<td>M</td>
<td>Guerrero Pla Angel</td>
<td><u>ESP</u></td>
<td>M30-34</td>
<td>...</td>
<td>E</td>
</tr>
<tr>
<td>...</td>
<td>258</td>
<td>M</td>
<td>Bellm Mathias</td>
<td><u>DEU</u></td>
<td>M35-39</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>655</td>
<td>M</td>
<td>Moratto Alessio</td>
<td><u>ITA</u></td>
<td>M40-44</td>
<td>...</td>
<td>I</td>
</tr>
<tr>
<td>...</td>
<td>1317</td>
<td>M</td>
<td>Solari Jean-Jacques</td>
<td><u>PYF</u></td>
<td>M50-54</td>
<td>...</td>
<td>TAH</td>
</tr>
<tr>
<td>...</td>
<td>1311</td>
<td>F</td>
<td>Duranel Isabelle</td>
<td><u>FRA</u></td>
<td>F40-44</td>
<td>...</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1012</td>
<td>M</td>
<td>Endler Maximilian</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>284</td>
<td>M</td>
<td>Schreiner Jorg</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>14</td>
<td>M</td>
<td>Butturini Jacopo</td>
<td><u>HRV</u></td>
<td></td>
<td>...</td>
<td>ITU</td>
</tr>
<tr>
<td>...</td>
<td>204</td>
<td>M</td>
<td>Lindner Thomas</td>
<td><u>DEU</u></td>
<td>M40-44</td>
<td>...</td>
<td>D</td>
</tr>
<tr>
<td>...</td>
<td>1168</td>
<td>M</td>
<td>Gramke Peter</td>
<td><u>DEU</u></td>
<td>M45-49</td>
<td>...</td>
<td>D</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经过更正后，无国家/地区的记录数量减少到909，即超过了三倍。</font><font style="vertical-align: inherit;">尽管在一个二分之一五十万的背景下，总数为2208个并不算太大，但它仍然不错。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，像往常一样，我们将组合的数据帧</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ar转换</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字典</font><font style="vertical-align: inherit;">并保存。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details7.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地板</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与国家/地区一样，在某些记录中未指出参与者的性别。 </font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">''</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中有2538个，相对较少，但我们会再次尝试使数量更少。</font><font style="vertical-align: inherit;">将原始值保存在新列中。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'sex raw'</span>] =ar[<span class="hljs-string">'sex'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与我们从其他协议中按名称检索信息的国家不同，这里的一切都有些复杂。</font><font style="vertical-align: inherit;">事实是，数据中充满了错误，并且发现有很多名字（共有2 101个），带有两个性别的标记。</font></font><br>
<br>
<pre><code class="python hljs">arws = ar[(ar[<span class="hljs-string">'sex'</span>] != <span class="hljs-string">''</span>)&amp;(ar[<span class="hljs-string">'name'</span>] != <span class="hljs-string">''</span>)] <span class="hljs-comment">#arws – all records with sex</span>
snds = arws[arws.duplicated(subset=<span class="hljs-string">'name'</span>,keep=<span class="hljs-literal">False</span>)]<span class="hljs-comment">#snds–single name different sex</span>
snds = snds.drop_duplicates(subset=[<span class="hljs-string">'name'</span>,<span class="hljs-string">'sex'</span>], keep = <span class="hljs-string">'first'</span>)<font></font>
snds = snds.sort_values(by=<span class="hljs-string">'name'</span>)<font></font>
snds = snds[snds.duplicated(subset = <span class="hljs-string">'name'</span>, keep=<span class="hljs-literal">False</span>)]<font></font>
<font></font>
snds</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th><u>name</u></th>
<th>country</th>
<th><u>group</u></th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th>sex raw</th>
</tr>
<tr>
<td>...</td>
<td>428</td>
<td><u>F</u></td>
<td><u>Aagaard Ida</u></td>
<td>NOR</td>
<td><u>F40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>F40-44</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>718</td>
<td><u>M</u></td>
<td><u>Aagaard Ida</u></td>
<td>NOR</td>
<td><u>M40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>M40-44</td>
<td>M</td>
</tr>
<tr>
<td></td>
<td>740</td>
<td><u>M</u></td>
<td><u>Aarekol Tove Aase</u></td>
<td>NOR</td>
<td><u>M50-54</u></td>
<td>...</td>
<td>NOR</td>
<td>M50-54</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>520</td>
<td><u>F</u></td>
<td><u>Aarekol Tove Aase</u></td>
<td>NOR</td>
<td><u>F50-54</u></td>
<td>...</td>
<td>NOR</td>
<td>F50-54</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>665</td>
<td><u>F</u></td>
<td><u>Aaroy Torunn</u></td>
<td>NOR</td>
<td><u>F40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>F40-44</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1591</td>
<td><u>M</u></td>
<td><u>Aaroy Torunn</u></td>
<td>NOR</td>
<td><u>M40-44</u></td>
<td>...</td>
<td>NOR</td>
<td>M40-44</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>70</td>
<td><u>M</u></td>
<td><u>Aberg Cobo Dolores</u></td>
<td>ARG</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>ARG</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1258</td>
<td><u>F</u></td>
<td><u>Aberg Cobo Dolores</u></td>
<td>ARG</td>
<td><u>F30-34</u></td>
<td>...</td>
<td>ARG</td>
<td>F30-34</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1909</td>
<td><u>F</u></td>
<td><u>Aboulfaida Zineb</u></td>
<td>MAR</td>
<td><u>F35-39</u></td>
<td>...</td>
<td>MAR</td>
<td>F35-39</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>340</td>
<td><u>M</u></td>
<td><u>Aboulfaida Zineb</u></td>
<td>MAR</td>
<td><u>M35-39</u></td>
<td>...</td>
<td>MAR</td>
<td>M35-39</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>63</td>
<td><u>F</u></td>
<td><u>Abram Felicity</u></td>
<td>AUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>AUS</td>
<td>FPRO</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>38</td>
<td><u>M</u></td>
<td><u>Abram Felicity</u></td>
<td>AUS</td>
<td><u>FJUNIOR</u></td>
<td>...</td>
<td>AUS</td>
<td>FJUNIOR</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>134</td>
<td><u>M</u></td>
<td><u>Abramowski Jannicke</u></td>
<td>DEU</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>GER</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>323</td>
<td><u>F</u></td>
<td><u>Abramowski Jannicke</u></td>
<td>DEU</td>
<td><u>F25-29</u></td>
<td>...</td>
<td>GER</td>
<td>F25-29</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>21</td>
<td><u>M</u></td>
<td><u>Abrosimova Anastasia</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>177</td>
<td><u>F</u></td>
<td><u>Abrosimova Anastasia</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>188</td>
<td><u>M</u></td>
<td><u>Abysova Irina</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>60</td>
<td><u>F</u></td>
<td><u>Abysova Irina</u></td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>312</td>
<td><u>M</u></td>
<td><u>Acaron Fabiola</u></td>
<td>PRI</td>
<td><u>FJUNIOR</u></td>
<td>...</td>
<td>PUR</td>
<td>FJUNIOR</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>294</td>
<td><u>F</u></td>
<td><u>Acaron Fabiola</u></td>
<td>PRI</td>
<td><u>F45-49</u></td>
<td>...</td>
<td>PUR</td>
<td>F45-49</td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>1500</td>
<td><u>M</u></td>
<td><u>Achampong Benjamin</u></td>
<td>GBR</td>
<td><u>M35-39</u></td>
<td>...</td>
<td>GBR</td>
<td>M35-39</td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>749</td>
<td><u>F</u></td>
<td><u>Achampong Benjamin</u></td>
<td>GBR</td>
<td><u>M35-39</u></td>
<td>...</td>
<td>GBR</td>
<td>M35-39</td>
<td>F</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的，原则上有男女通用（或雌雄同体）的名字，也就是用来给男孩和女孩起名字的名字。对于亚洲运动员来说，通常很难按名字来确定性别-也许我只是没有足够的知识而已。但是，很难相信伊琳娜（Irina）或阿纳斯塔西娅（Anastasia）这个名字是男人的名字，本杰明被称为女人。除此之外，我发现在某些协议中，所有参与者都被标记为一种性别。</font></font><br>
<br>
<pre><code class="python hljs">rss = [rd[e] <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rd <span class="hljs-keyword">if</span> len(rd[e][rd[e][<span class="hljs-string">'sex'</span>] != <span class="hljs-string">''</span>][<span class="hljs-string">'sex'</span>].unique()) == <span class="hljs-number">1</span>] <span class="hljs-comment">#rss – races with single sex</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
共有633个协议，这似乎是完全有可能的，只是分别针对女性和男性的协议。但是事实是，几乎所有这些协议都包含男女的年龄段（男性年龄段以字母</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开头</font><font style="vertical-align: inherit;">，女性以字母</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开头</font><font style="vertical-align: inherit;">）。例如：</font><font style="vertical-align: inherit;">预期年龄组的名称</font><font style="vertical-align: inherit;">以男性</font><font style="vertical-align: inherit;">字母</font><i><font style="vertical-align: inherit;">M</font></i><font style="vertical-align: inherit;">开头，</font><font style="vertical-align: inherit;">以女性</font><font style="vertical-align: inherit;">字母</font><i><font style="vertical-align: inherit;">F</font></i><font style="vertical-align: inherit;">开头</font><font style="vertical-align: inherit;">。在前两个示例中，尽管</font><i><font style="vertical-align: inherit;">性别</font></i><font style="vertical-align: inherit;">列中存在错误</font></font><br>
<br>
<code>'ITU World Cup Tiszaujvaros Olympic 2002'<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th>name raw</th>
</tr>
<tr>
<td>76</td>
<td><u>M</u></td>
<td>Dederko Ewa</td>
<td>POL</td>
<td>FPRO</td>
<td>...</td>
<td>POL</td>
<td><u>FPRO</u></td>
<td>Dederko Ewa</td>
</tr>
<tr>
<td>84</td>
<td><u>M</u></td>
<td>Chenevier Giunia</td>
<td>ITA</td>
<td>FPRO</td>
<td>...</td>
<td>ITA</td>
<td><u>FPRO</u></td>
<td>Chenevier Giunia</td>
</tr>
<tr>
<td>36</td>
<td><u>M</u></td>
<td>O'Grady Graham</td>
<td>NZL</td>
<td>MPRO</td>
<td>...</td>
<td>NZL</td>
<td><u>MPRO</u></td>
<td>O'Grady Graham</td>
</tr>
<tr>
<td>23</td>
<td><u>M</u></td>
<td>Danek Michal</td>
<td>CZE</td>
<td>MPRO</td>
<td>...</td>
<td>CZE</td>
<td><u>MPRO</u></td>
<td>Danek Michal</td>
</tr>
<tr>
<td>74</td>
<td><u>M</u></td>
<td>Peon Carole</td>
<td>FRA</td>
<td>FPRO</td>
<td>...</td>
<td>FRA</td>
<td><u>FPRO</u></td>
<td>Peon Carole</td>
</tr>
<tr>
<td>48</td>
<td><u>M</u></td>
<td>Hechenblaickner Daniel</td>
<td>AUT</td>
<td>MPRO</td>
<td>...</td>
<td>AUT</td>
<td><u>MPRO</u></td>
<td>Hechenblaickner Daniel</td>
</tr>
<tr>
<td>70</td>
<td><u>M</u></td>
<td>Blatchford Liz</td>
<td>GBR</td>
<td>FPRO</td>
<td>...</td>
<td>GBR</td>
<td><u>FPRO</u></td>
<td>Blatchford Liz</td>
</tr>
<tr>
<td>1</td>
<td><u>M</u></td>
<td>Walton Craig</td>
<td>AUS</td>
<td>MPRO</td>
<td>...</td>
<td>AUS</td>
<td><u>MPRO</u></td>
<td>Walton Craig</td>
</tr>
<tr>
<td>20</td>
<td><u>M</u></td>
<td>Hobor Peter</td>
<td>HUN</td>
<td>MPRO</td>
<td>...</td>
<td>HUN</td>
<td><u>MPRO</u></td>
<td>Hobor Peter</td>
</tr>
<tr>
<td>56</td>
<td><u>M</u></td>
<td>Kaldau Szabolcs</td>
<td>HUN</td>
<td>MPRO</td>
<td>...</td>
<td>HUN</td>
<td><u>MPRO</u></td>
<td>Kaldau Szabolcs</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该群组的名称似乎仍能正确描述该成员的性别。</font><font style="vertical-align: inherit;">基于几个示例，我们假设正确指示了组，并且可能错误地指示了性别。</font><font style="vertical-align: inherit;">查找组名中首字母与性别不匹配的所有条目。</font><font style="vertical-align: inherit;">我们将使用group </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">group raw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的初始名称</font><font style="vertical-align: inherit;">，因为在标准化过程中许多记录都没有分组，但是现在我们只需要第一个字母，因此标准并不重要。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'grflc'</span>] = ar[<span class="hljs-string">'group raw'</span>].str.upper().str[<span class="hljs-number">0</span>] <span class="hljs-comment">#grflc – group raw first letter capital</span>
grncs = ar[(ar[<span class="hljs-string">'grflc'</span>].isin([<span class="hljs-string">'M'</span>,<span class="hljs-string">'F'</span>]))&amp;(ar[<span class="hljs-string">'sex'</span>]!=ar[<span class="hljs-string">'grflc'</span>])] <span class="hljs-comment">#grncs – group raw not consistent with sex</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有26 161个这样的记录。</font><font style="vertical-align: inherit;">好吧，让我们根据年龄组的名称更正性别：</font></font><br>
<br>
<pre><code class="python hljs">ar.loc[grncs.index, <span class="hljs-string">'sex'</span>] = grncs[<span class="hljs-string">'grflc'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一下结果：</font><font style="vertical-align: inherit;">好。</font><font style="vertical-align: inherit;">现在剩下多少记录没有性别？</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>...</td>
<td>59</td>
<td><u>F</u></td>
<td>Ueda Ai</td>
<td>JPN</td>
<td>FPRO</td>
<td>...</td>
<td>JPN</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>50</td>
<td><u>F</u></td>
<td>Zemanova Lenka</td>
<td>CZE</td>
<td>FPRO</td>
<td>...</td>
<td>CZE</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>83</td>
<td><u>F</u></td>
<td>Spearing Kyleigh</td>
<td>USA</td>
<td>FPRO</td>
<td>...</td>
<td>USA</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>63</td>
<td><u>F</u></td>
<td>Abysova Irina</td>
<td>RUS</td>
<td>FPRO</td>
<td>...</td>
<td>RUS</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>57</td>
<td><u>F</u></td>
<td>Knapp Anja</td>
<td>DEU</td>
<td>FPRO</td>
<td>...</td>
<td>GER</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>68</td>
<td><u>M</u></td>
<td>Matthews Andrew</td>
<td>GBR</td>
<td>M30-34</td>
<td>...</td>
<td>GBR</td>
<td><u>M30-34</u></td>
<td><u>F</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>46</td>
<td><u>F</u></td>
<td>Rappaport Summer</td>
<td>USA</td>
<td>FPRO</td>
<td>...</td>
<td>USA</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>60</td>
<td><u>F</u></td>
<td>Reid Aileen</td>
<td>IRL</td>
<td>FPRO</td>
<td>...</td>
<td>IRL</td>
<td><u>FPRO</u></td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>142</td>
<td><u>F</u></td>
<td>Mcdowall Edwina</td>
<td>GBR</td>
<td>F45-49</td>
<td>...</td>
<td>GBR</td>
<td><u>F45-49</u></td>
<td></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>141</td>
<td><u>M</u></td>
<td>O'Bray Luke</td>
<td>GBR</td>
<td>M30-34</td>
<td>...</td>
<td>GBR</td>
<td><u>M30-34</u></td>
<td></td>
<td>M</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[(ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">''</span>)&amp;(ar[<span class="hljs-string">'name'</span>] != <span class="hljs-string">''</span>)]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原来是一个！</font><font style="vertical-align: inherit;">
好吧，这个小组并没有真正表明，但是，显然，这是一个女人。艾米丽（Emily）是一位女性名字，除了该参与者（或她的同名人物）一年前结束比赛外，还标明了性别和团体。</font><font style="vertical-align: inherit;">
手动恢复此处*并继续。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>London Triathlon Olympic 2019</td>
<td>672</td>
<td></td>
<td>Stather Emily</td>
<td>GBR</td>
<td></td>
<td>...</td>
<td>GBR</td>
<td><u>unknown</u></td>
<td></td>
<td>U</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>Ironman Staffordshire 70.3 2018</td>
<td>1859</td>
<td><u>F</u></td>
<td>Stather Emily</td>
<td>GBR</td>
<td><u>F40-44</u></td>
<td>...</td>
<td>GBR</td>
<td>F40-44</td>
<td><u>F</u></td>
<td>F</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar.loc[arns.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'F'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在所有记录都带有性别。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*通常来说，这样做当然是错误的-重复运行，如果在名称转换之前链中的某些内容发生了变化（例如，姓名转换），那么可能会有不止一个性别的记录超过一个，并且并非所有记录都是女性的，那么就会发生错误。因此，您必须插入繁琐的逻辑以在其他协议中搜索具有相同名称和性别的参与者，例如恢复国家/地区以及如何对其进行测试，或者，为了避免不必要的复杂化，请在此逻辑中添加仅找到一条记录的检查并且名称如此之类，否则会引发异常，从而使整个笔记本电脑停止工作，您会注意到与计划的差异并进行干预。</font></font></i><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">if</span> len(arns) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> arns[<span class="hljs-string">'name'</span>].iloc[<span class="hljs-number">0</span>] == <span class="hljs-string">'Stather Emily'</span>:<font></font>
    ar.loc[arns.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'F'</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">'Different scenario!'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
看来这可以让您平静下来。</font><font style="vertical-align: inherit;">但是事实是，更正是基于正确指示组的假设。</font><font style="vertical-align: inherit;">确实是这样。</font><font style="vertical-align: inherit;">几乎总是。</font><font style="vertical-align: inherit;">几乎。</font><font style="vertical-align: inherit;">尽管如此，还是偶然发现了一些不一致的地方，所以现在让我们尝试确定所有这些不一致之处，或者尽可能多。</font><font style="vertical-align: inherit;">如前所述，在第一个示例中，恰恰是这样一个事实，即性别基于其自身关于男性和女性姓名的观念而与姓名不符，从而保护了我们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在男性和女性记录上找到所有姓名。</font><font style="vertical-align: inherit;">在此，名称应理解为名称，而不是全名，即没有姓氏的英文</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名字</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'fn'</span>] = ar[<span class="hljs-string">'name'</span>].str.split().str[<span class="hljs-number">-1</span>] <span class="hljs-comment">#fn – first name</span>
mfn = list(ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'M'</span>][<span class="hljs-string">'fn'</span>].unique()) <span class="hljs-comment">#mfn – male first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总共列出了32,508个男性名字。</font><font style="vertical-align: inherit;">以下是50个最受欢迎的网址：</font></font><br>
<code>['Michael', 'David', 'Thomas', 'John', 'Daniel', 'Mark', 'Peter', 'Paul', 'Christian', 'Robert', 'Martin', 'James', 'Andrew', 'Chris', 'Richard', 'Andreas', 'Matthew', 'Brian', 'Kevin', 'Patrick', 'Scott', 'Stefan', 'Jason', 'Eric', 'Alexander', 'Christopher', 'Simon', 'Mike', 'Tim', 'Frank', 'Stephen', 'Steve', 'Jonathan', 'Marco', 'Markus', 'Adam', 'Ryan', 'Tom', 'Jan', 'Marc', 'Carlos', 'Matt', 'Steven', 'Jeff', 'Sergey', 'William', 'Aleksandr', 'Andrey', 'Benjamin', 'Jose']<br>
</code><br>
<br>
<pre><code class="python hljs">ffn = list(ar[ar[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'F'</span>][<span class="hljs-string">'fn'</span>].unique()) <span class="hljs-comment">#ffn – female first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
女性更少-14423。最受欢迎：</font><font style="vertical-align: inherit;">
好，看起来很合逻辑。</font><font style="vertical-align: inherit;">让我们看看是否有交叉点。</font></font><br>
<code>['Jennifer', 'Sarah', 'Laura', 'Lisa', 'Anna', 'Michelle', 'Maria', 'Andrea', 'Nicole', 'Jessica', 'Julie', 'Elizabeth', 'Stephanie', 'Karen', 'Christine', 'Amy', 'Rebecca', 'Susan', 'Rachel', 'Anne', 'Heather', 'Kelly', 'Barbara', 'Claudia', 'Amanda', 'Sandra', 'Julia', 'Lauren', 'Melissa', 'Emma', 'Sara', 'Katie', 'Melanie', 'Kim', 'Caroline', 'Erin', 'Kate', 'Linda', 'Mary', 'Alexandra', 'Christina', 'Emily', 'Angela', 'Catherine', 'Claire', 'Elena', 'Patricia', 'Charlotte', 'Megan', 'Daniela']<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">mffn = set(mfn).intersection(ffn) <span class="hljs-comment">#mffn – male-female first names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有。</font><font style="vertical-align: inherit;">其中有2,811个，让我们仔细看看。</font><font style="vertical-align: inherit;">首先，我们找出具有这些名称的记录数：</font></font><br>
<br>
<pre><code class="python hljs">armfn = ar[ar[<span class="hljs-string">'fn'</span>].isin(mffn)] <span class="hljs-comment">#armfn – all records with male-female names</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有725562个。一半！</font><font style="vertical-align: inherit;">太神奇了！</font><font style="vertical-align: inherit;">大约有37,000个唯一名称，但有一半记录共有2800个，让我们看看这些名称是什么，它们是最受欢迎的。</font><font style="vertical-align: inherit;">为此，请创建一个新的数据框，其中这些名称将作为索引：</font></font><br>
<br>
<pre><code class="python hljs">df = pd.DataFrame(armfn[<span class="hljs-string">'fn'</span>].value_counts())<font></font>
df = df.rename(columns={<span class="hljs-string">'fn'</span>:<span class="hljs-string">'total'</span>})
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们计算每个记录有多少个男性和女性记录。</font></font><br>
<br>
<pre><code class="python hljs">df[<span class="hljs-string">'M'</span>] = armfn[armfn[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'M'</span>][<span class="hljs-string">'fn'</span>].value_counts()<font></font>
df[<span class="hljs-string">'F'</span>] = armfn[armfn[<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'F'</span>][<span class="hljs-string">'fn'</span>].value_counts()
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
</tr>
<tr>
<td>Michael</td>
<td>20648</td>
<td>20638</td>
<td>10</td>
</tr>
<tr>
<td>David</td>
<td>18493</td>
<td>18485</td>
<td>8</td>
</tr>
<tr>
<td>Thomas</td>
<td>12746</td>
<td>12740</td>
<td>6</td>
</tr>
<tr>
<td>John</td>
<td>11634</td>
<td>11632</td>
<td>2</td>
</tr>
<tr>
<td>Daniel</td>
<td>11045</td>
<td>11041</td>
<td>4</td>
</tr>
<tr>
<td>Mark</td>
<td>10968</td>
<td>10965</td>
<td>3</td>
</tr>
<tr>
<td>Peter</td>
<td>10692</td>
<td>10691</td>
<td>1</td>
</tr>
<tr>
<td>Paul</td>
<td>9616</td>
<td>9614</td>
<td>2</td>
</tr>
<tr>
<td>Christian</td>
<td>8863</td>
<td>8859</td>
<td>4</td>
</tr>
<tr>
<td>Robert</td>
<td>8666</td>
<td>8664</td>
<td>2</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以...看起来可疑。</font><font style="vertical-align: inherit;">据我所知，所有这些名字都是男性的。</font><font style="vertical-align: inherit;">但是每一个都有一些女性记录。</font><font style="vertical-align: inherit;">这些可能是数据错误。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一下女性名字。</font></font><br>
<br>
<pre><code class="python hljs">df.sort_values(by = <span class="hljs-string">'F'</span>, ascending=<span class="hljs-literal">False</span>)
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
</tr>
<tr>
<td>Jennifer</td>
<td>3652</td>
<td>3</td>
<td>3649</td>
</tr>
<tr>
<td>Sarah</td>
<td>3288</td>
<td>4</td>
<td>3284</td>
</tr>
<tr>
<td>Laura</td>
<td>2636</td>
<td>3</td>
<td>2633</td>
</tr>
<tr>
<td>Lisa</td>
<td>2618</td>
<td>2</td>
<td>2616</td>
</tr>
<tr>
<td>Anna</td>
<td>2563</td>
<td>10</td>
<td>2553</td>
</tr>
<tr>
<td>Michelle</td>
<td>2373</td>
<td>1</td>
<td>2372</td>
</tr>
<tr>
<td>Maria</td>
<td>2555</td>
<td>386</td>
<td>2169</td>
</tr>
<tr>
<td>Andrea</td>
<td>4323</td>
<td>2235</td>
<td>2088</td>
</tr>
<tr>
<td>Nicole</td>
<td>2025</td>
<td>6</td>
<td>2019</td>
</tr>
<tr>
<td>Julie</td>
<td>1938</td>
<td>2</td>
<td>1936</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同。几乎。出于</font><font style="vertical-align: inherit;">某种原因，</font><font style="vertical-align: inherit;">脱颖而出的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrea</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确实是一个雌雄同体的名字，比</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maria</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少</font><font style="vertical-align: inherit;">一些。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，不要忘记我们正在研究来自世界不同国家（也许有人会说）的人们的数据。在不同的文化中，可以以完全不同的方式使用相同的名称。这是一个例子。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凯伦（Karen）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是我们名单上最受欢迎的女性名字之一，但另一方面，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凯伦（Karen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）这个名字</font><font style="vertical-align: inherit;">也将以音译的方式书写，但只由男性携带。幸运的是，这世界上所有的智慧都有一套。称为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性别猜测者</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它是这样的：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> gender_guesser.detector <span class="hljs-keyword">as</span> gg<font></font>
<font></font>
d = gg.Detector()<font></font>
d.get_gender(<span class="hljs-string">u'Oleg'</span>)</code></pre><br>
<code><b>Out:</b> 'male'<br>
</code><br>
<br>
<pre><code class="python hljs">d.get_gender(<span class="hljs-string">u'Evgeniya'</span>)
</code></pre><br>
<code><b>Out:</b> 'female'<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一切都没事。</font><font style="vertical-align: inherit;">但是，如果您检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrea</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的名字</font><font style="vertical-align: inherit;">，那么他也会给出</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">女性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但这并不是完全正确的。</font><font style="vertical-align: inherit;">没错，这是出路。</font><font style="vertical-align: inherit;">如果您查看</font><font style="vertical-align: inherit;">检测器</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">，那么所有歧义都将在此处可见。</font></font><br>
<br>
<pre><code class="python hljs">d.names[<span class="hljs-string">'Andrea'</span>]
</code></pre><br>
<code><b>Out: </b>{'female': ' 4 4 3 4788 64 579 34 1 7 ',<br>
 'mostly_female': '5 6 7 ',<br>
 'male': ' 7 '}<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是的，也就是说，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_gender</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅为您提供了最可能的选择，但实际上它可能要复杂得多。</font><font style="vertical-align: inherit;">检查其他名称：</font></font><br>
<br>
<pre><code class="python hljs">d.names[<span class="hljs-string">'Maria'</span>]
</code></pre><br>
<code><b>Out:</b> {'female': '686 6 A 85986 A BA 3B98A75457 6 ',<br>
 'mostly_female': ' BBC A 678A9 '}<br>
</code><br>
<br>
<pre><code class="python hljs">d.names[<span class="hljs-string">'Oleg'</span>]
</code></pre><br>
<code><b>Out:</b> {'male': ' 6 2 99894737 3 '}<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也就是说，</font><font style="vertical-align: inherit;">每个名称</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">对应于一个或多个键值对，其中键-它是性别：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">male，FEMALE，mostly_male，mostly_female和andy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，值-相应国家/地区的值列表：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,2,3 ... .. 9ABC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些国家是：</font></font><br>
<br>
<pre><code class="python hljs">d.COUNTRIES</code></pre><br>
<code><b>Out:</b> ['great_britain', 'ireland', 'usa', 'italy', 'malta', 'portugal', 'spain', 'france', 'belgium', 'luxembourg', 'the_netherlands', 'east_frisia', 'germany', 'austria', 'swiss', 'iceland', 'denmark', 'norway', 'sweden', 'finland', 'estonia', 'latvia', 'lithuania', 'poland', 'czech_republic', 'slovakia', 'hungary', 'romania', 'bulgaria', 'bosniaand', 'croatia', 'kosovo', 'macedonia', 'montenegro', 'serbia', 'slovenia', 'albania', 'greece', 'russia', 'belarus', 'moldova', 'ukraine', 'armenia', 'azerbaijan', 'georgia', 'the_stans', 'turkey', 'arabia', 'israel', 'china', 'india', 'japan', 'korea', 'vietnam', 'other_countries']<br>
</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不完全理解字母数字的含义或它们在列表中的具体含义。</font><font style="vertical-align: inherit;">但这并不重要，因为我决定限制自己只使用那些具有明确解释的名称。</font><font style="vertical-align: inherit;">也就是说，对于它，只有一对键值对，并且键是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">male</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">female</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于我们数据框中的每个名称，写下其对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性别猜测的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">df[<span class="hljs-string">'sex from gg'</span>] = <span class="hljs-string">''</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> df.index:
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> list(d.names.keys()):<font></font>
        options = list(d.names[n].keys())<font></font>
        <span class="hljs-keyword">if</span> len(options) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'male'</span>:<font></font>
            df.loc[n, <span class="hljs-string">'sex from gg'</span>] = <span class="hljs-string">'M'</span>
        <span class="hljs-keyword">if</span> len(options) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'female'</span>:<font></font>
            df.loc[n, <span class="hljs-string">'sex from gg'</span>] = <span class="hljs-string">'F'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原来有1,150个名字。</font><font style="vertical-align: inherit;">这里是上面已经讨论过的最受欢迎的：</font><font style="vertical-align: inherit;">好吧，还不错。</font><font style="vertical-align: inherit;">现在将此逻辑应用于所有记录。</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
<th>sex from gg</th>
</tr>
<tr>
<td>Michael</td>
<td>20648</td>
<td>20638</td>
<td>10</td>
<td>M</td>
</tr>
<tr>
<td>David</td>
<td>18493</td>
<td>18485</td>
<td>8</td>
<td>M</td>
</tr>
<tr>
<td>Thomas</td>
<td>12746</td>
<td>12740</td>
<td>6</td>
<td>M</td>
</tr>
<tr>
<td>John</td>
<td>11634</td>
<td>11632</td>
<td>2</td>
<td>M</td>
</tr>
<tr>
<td>Daniel</td>
<td>11045</td>
<td>11041</td>
<td>4</td>
<td>M</td>
</tr>
<tr>
<td>Mark</td>
<td>10968</td>
<td>10965</td>
<td>3</td>
<td>M</td>
</tr>
<tr>
<td>Peter</td>
<td>10692</td>
<td>10691</td>
<td>1</td>
<td>M</td>
</tr>
<tr>
<td>Paul</td>
<td>9616</td>
<td>9614</td>
<td>2</td>
<td>M</td>
</tr>
<tr>
<td>Christian</td>
<td>8863</td>
<td>8859</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>Robert</td>
<td>8666</td>
<td>8664</td>
<td>2</td>
<td>M</td>
</tr>
</tbody></table></div></code><br>
 <code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>total</th>
<th>M</th>
<th>F</th>
<th>sex from gg</th>
</tr>
<tr>
<td>Jennifer</td>
<td>3652</td>
<td>3</td>
<td>3649</td>
<td>F</td>
</tr>
<tr>
<td>Sarah</td>
<td>3288</td>
<td>4</td>
<td>3284</td>
<td>F</td>
</tr>
<tr>
<td>Laura</td>
<td>2636</td>
<td>3</td>
<td>2633</td>
<td>F</td>
</tr>
<tr>
<td>Lisa</td>
<td>2618</td>
<td>2</td>
<td>2616</td>
<td>F</td>
</tr>
<tr>
<td>Anna</td>
<td>2563</td>
<td>10</td>
<td>2553</td>
<td>F</td>
</tr>
<tr>
<td>Michelle</td>
<td>2373</td>
<td>1</td>
<td>2372</td>
<td>F</td>
</tr>
<tr>
<td>Maria</td>
<td>2555</td>
<td>386</td>
<td>2169</td>
<td></td>
</tr>
<tr>
<td>Andrea</td>
<td>4323</td>
<td>2235</td>
<td>2088</td>
<td></td>
</tr>
<tr>
<td>Nicole</td>
<td>2025</td>
<td>6</td>
<td>2019</td>
<td>F</td>
</tr>
<tr>
<td>Julie</td>
<td>1938</td>
<td>2</td>
<td>1936</td>
<td></td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">all_names = ar[<span class="hljs-string">'fn'</span>].unique()<font></font>
<font></font>
male_names = []<font></font>
female_names = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> all_names:
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> list(d.names.keys()):<font></font>
        options = list(d.names[n].keys())<font></font>
        <span class="hljs-keyword">if</span> len(options) == <span class="hljs-number">1</span>:
            <span class="hljs-keyword">if</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'male'</span>:<font></font>
                male_names.append(n)<font></font>
            <span class="hljs-keyword">if</span> options[<span class="hljs-number">0</span>] == <span class="hljs-string">'female'</span>:<font></font>
                female_names.append(n)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
发现男性7 091人，女性5 054人。</font><font style="vertical-align: inherit;">应用转换：</font></font><br>
<br>
<pre><code class="python hljs">tofixm = ar[ar[<span class="hljs-string">'fn'</span>].isin(male_names)]<font></font>
ar.loc[tofixm.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'M'</span>
tofixf = ar[ar[<span class="hljs-string">'fn'</span>].isin(female_names)]<font></font>
ar.loc[tofixf.index, <span class="hljs-string">'sex'</span>] = <span class="hljs-string">'F'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们看一下结果：</font></font><br>
<br>
<pre><code class="python hljs">ar[ar[<span class="hljs-string">'sex'</span>]!=ar[<span class="hljs-string">'sex raw'</span>]]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
更正了30,352个条目（连同按组名进行的更正）。</font><font style="vertical-align: inherit;">像往常一样，随机抽取10个：</font><font style="vertical-align: inherit;">现在，我们确定已正确识别性别，我们还将加入标准组。</font><font style="vertical-align: inherit;">让我们看看它们不匹配的地方：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>...</th>
<th>country raw</th>
<th>group raw</th>
<th><u>sex raw</u></th>
<th>grflc</th>
</tr>
<tr>
<td>...</td>
<td>37</td>
<td><u>F</u></td>
<td>Pilz Christiane</td>
<td>DEU</td>
<td>FPRO</td>
<td>...</td>
<td>GER</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>92</td>
<td><u>F</u></td>
<td>Brault Sarah-Anne</td>
<td>CAN</td>
<td>FPRO</td>
<td>...</td>
<td>CAN</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>96</td>
<td><u>F</u></td>
<td>Murphy Susanna</td>
<td>IRL</td>
<td>FPRO</td>
<td>...</td>
<td>IRL</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>105</td>
<td><u>F</u></td>
<td>Spoelder Romy</td>
<td>NLD</td>
<td></td>
<td>...</td>
<td>NED</td>
<td>FJUNIOR</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>424</td>
<td><u>M</u></td>
<td>Watson Tom</td>
<td>GBR</td>
<td>M40-44</td>
<td>...</td>
<td>GBR</td>
<td>M40-44</td>
<td><u>F</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>81</td>
<td><u>F</u></td>
<td>Morel Charlotte</td>
<td>FRA</td>
<td></td>
<td>...</td>
<td>FRA</td>
<td>FJUNIOR</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>65</td>
<td><u>F</u></td>
<td>Selekhova Olga</td>
<td>RUS</td>
<td></td>
<td>...</td>
<td>RUS</td>
<td>FU23</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>166</td>
<td><u>F</u></td>
<td>Keat Rebekah</td>
<td>AUS</td>
<td></td>
<td>...</td>
<td>AUS</td>
<td>FJUNIOR</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>119</td>
<td><u>F</u></td>
<td>Eim Nina</td>
<td>DEU</td>
<td></td>
<td>...</td>
<td>GER</td>
<td>FQUAL…</td>
<td><u>M</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>73</td>
<td><u>F</u></td>
<td>Sukhoruchenkova Evgenia</td>
<td>RUS</td>
<td>FPRO</td>
<td>...</td>
<td>RUS</td>
<td>FPRO</td>
<td><u>M</u></td>
<td>F</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar[<span class="hljs-string">'gfl'</span>] = ar[<span class="hljs-string">'group'</span>].str[<span class="hljs-number">0</span>]<font></font>
gncws = ar[(ar[<span class="hljs-string">'sex'</span>] != ar[<span class="hljs-string">'gfl'</span>]) &amp; (ar[<span class="hljs-string">'group'</span>]!=<span class="hljs-string">''</span>)]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4,248个条目。</font><font style="vertical-align: inherit;">替换第一个字母：</font></font><br>
<br>
<pre><code class="python hljs">ar.loc[gncws.index, <span class="hljs-string">'group'</span>] = ar.loc[gncws.index, <span class="hljs-string">'sex'</span>] + ar.loc[gncws.index, <span class="hljs-string">'group'</span>].str[<span class="hljs-number">1</span>:].index, <span class="hljs-string">'sex'</span>]
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th><u>sex</u></th>
<th>name</th>
<th>country</th>
<th><u>group</u></th>
<th>...</th>
<th>country raw</th>
<th><u>group raw</u></th>
<th>sex raw</th>
</tr>
<tr>
<td>...</td>
<td>803</td>
<td><u>F</u></td>
<td>Kenney Joelle</td>
<td>USA</td>
<td><u>F35-39</u></td>
<td>...</td>
<td>USA</td>
<td><u>M35-39</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1432</td>
<td><u>M</u></td>
<td>Holmberg Henriette Gorm</td>
<td>DNK</td>
<td><u>M45-49</u></td>
<td>...</td>
<td>DEN</td>
<td><u>F45-49</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>503</td>
<td><u>M</u></td>
<td>Tai Oy Leen</td>
<td>MYS</td>
<td><u>M40-44</u></td>
<td>...</td>
<td>MAS</td>
<td><u>F40-44</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>236</td>
<td><u>F</u></td>
<td>Dissanayake Aruna</td>
<td>LKA</td>
<td><u>F25-29</u></td>
<td>...</td>
<td>SRI</td>
<td><u>M25-29</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1349</td>
<td><u>F</u></td>
<td>Delos Reyes Joshua Rafaelle</td>
<td>PHL</td>
<td><u>F18-24</u></td>
<td>...</td>
<td>PHI</td>
<td><u>M18-24</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>543</td>
<td><u>F</u></td>
<td>Vandekendelaere Janique</td>
<td>BEL</td>
<td><u>F50-54</u></td>
<td>...</td>
<td>BEL</td>
<td><u>M50-54</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1029</td>
<td><u>M</u></td>
<td>Provost Shaun</td>
<td>USA</td>
<td><u>M25-29</u></td>
<td>...</td>
<td>USA</td>
<td><u>F25-29</u></td>
<td>F</td>
</tr>
<tr>
<td>...</td>
<td>303</td>
<td><u>F</u></td>
<td>Torrens Vadell Macia</td>
<td>ESP</td>
<td><u>F30-34</u></td>
<td>...</td>
<td>ESP</td>
<td><u>M30-34</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>1338</td>
<td><u>F</u></td>
<td>Suarez Renan</td>
<td>BOL</td>
<td><u>F35-39</u></td>
<td>...</td>
<td>BOL</td>
<td><u>M35-39</u></td>
<td>M</td>
</tr>
<tr>
<td>...</td>
<td>502</td>
<td><u>F</u></td>
<td>Everlo Linda</td>
<td>NLD</td>
<td><u>F30-34</u></td>
<td>...</td>
<td>NED</td>
<td><u>M30-34</u></td>
<td>M</td>
</tr>
</tbody></table></div></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能在某处更正被证明是不正确的，但每个人都以为自己做的是弊大于利。</font><font style="vertical-align: inherit;">对于统计，这很重要。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恢复性生活就是这样。</font><font style="vertical-align: inherit;">我们删除工作列，翻译成字典并保存。</font></font><br>
<br>
<pre><code class="python hljs">pkl.dump(rd, open(<span class="hljs-string">r'D:\tri\details8.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就这样，恢复不完整的数据。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公告更新</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仍然需要用关于男女人数等方面的最新数据来更新汇总表。 </font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'total raw'</span>] = rs[<span class="hljs-string">'total'</span>]<font></font>
rs[<span class="hljs-string">'males raw'</span>] = rs[<span class="hljs-string">'males'</span>]<font></font>
rs[<span class="hljs-string">'females raw'</span>] = rs[<span class="hljs-string">'females'</span>]<font></font>
rs[<span class="hljs-string">'rus raw'</span>] = rs[<span class="hljs-string">'rus'</span>]<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rs.index:<font></font>
    e = rs.loc[i,<span class="hljs-string">'event'</span>]<font></font>
    rs.loc[i,<span class="hljs-string">'total'</span>] = len(rd[e])<font></font>
    rs.loc[i,<span class="hljs-string">'males'</span>] = len(rd[e][rd[e][<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'M'</span>])<font></font>
    rs.loc[i,<span class="hljs-string">'females'</span>] = len(rd[e][rd[e][<span class="hljs-string">'sex'</span>] == <span class="hljs-string">'F'</span>])<font></font>
    rs.loc[i,<span class="hljs-string">'rus'</span>] = len(rd[e][rd[e][<span class="hljs-string">'country'</span>] == <span class="hljs-string">'RUS'</span>])<font></font>
<font></font>
len(rs[rs[<span class="hljs-string">'total'</span>] != rs[<span class="hljs-string">'total raw'</span>]])</code></pre><br>
<code><b>Out:</b> 288<br>
</code><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'males'</span>] != rs[<span class="hljs-string">'males raw'</span>]])
</code></pre><br>
<code><b>Out:</b>962<br>
</code><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'females'</span>] != rs[<span class="hljs-string">'females raw'</span>]])
</code></pre><br>
<code><b>Out:</b> 836<br>
</code><br>
<br>
<pre><code class="python hljs">len(rs[rs[<span class="hljs-string">'rus'</span>] != rs[<span class="hljs-string">'rus raw'</span>]])
</code></pre><br>
<code><b>Out:</b> 8<br>
</code><br>
<br>
<pre><code class="python hljs">pkl.dump(rs, open(<span class="hljs-string">r'D:\tri\summary6.pkl'</span>, <span class="hljs-string">'wb'</span>))
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4部分。采样</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在铁人三项很受欢迎。</font><font style="vertical-align: inherit;">在本赛季中，有许多公开比赛，大量运动员（主要是业余运动员）参加。</font><font style="vertical-align: inherit;">但这并非总是如此。</font><font style="vertical-align: inherit;">自1990年以来，我们的数据中就有记录。</font><font style="vertical-align: inherit;">滚动浏览tristats.ru，我注意到近年来有很多比赛，而在前几场比赛中很少。</font><font style="vertical-align: inherit;">但是，既然我们的数据已经准备好了，您可以更仔细地查看它。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十年期间</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
计算每年的比赛和完成者数量：</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'year'</span>] = pd.DatetimeIndex(rs[<span class="hljs-string">'date'</span>]).year<font></font>
years = range(rs[<span class="hljs-string">'year'</span>].min(),rs[<span class="hljs-string">'year'</span>].max())<font></font>
rsy = pd.DataFrame(columns = [<span class="hljs-string">'races'</span>, <span class="hljs-string">'finishers'</span>, <span class="hljs-string">'rus'</span>, <span class="hljs-string">'RUS'</span>], index = years) <span class="hljs-comment">#rsy – races summary by year</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> rsy.index:<font></font>
    rsy.loc[y,<span class="hljs-string">'races'</span>] = len(rs[rs[<span class="hljs-string">'year'</span>] == y])<font></font>
    rsy.loc[y,<span class="hljs-string">'finishers'</span>] = sum(rs[rs[<span class="hljs-string">'year'</span>] == y][<span class="hljs-string">'total'</span>])<font></font>
    rsy.loc[y,<span class="hljs-string">'rus'</span>] =  sum(rs[rs[<span class="hljs-string">'year'</span>] == y][<span class="hljs-string">'rus'</span>])<font></font>
    rsy.loc[y,<span class="hljs-string">'RUS'</span>] = len(rs[(rs[<span class="hljs-string">'year'</span>] == y)&amp;(rs[<span class="hljs-string">'country'</span>] == <span class="hljs-string">'RUS'</span>)])
</code></pre><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>year</th>
<th>races</th>
<th>finishers</th>
<th>rus</th>
<th>RUS</th>
</tr>
<tr>
<td>1990</td>
<td>1</td>
<td>286</td>
<td>5</td>
<td>0</td>
</tr>
<tr>
<td>1991</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1992</td>
<td>1</td>
<td>317</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>1993</td>
<td>2</td>
<td>887</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>1994</td>
<td>2</td>
<td>128</td>
<td>3</td>
<td>0</td>
</tr>
<tr>
<td>1995</td>
<td>3</td>
<td>731</td>
<td>7</td>
<td>0</td>
</tr>
<tr>
<td>1996</td>
<td>3</td>
<td>776</td>
<td>6</td>
<td>0</td>
</tr>
<tr>
<td>1997</td>
<td>3</td>
<td>403</td>
<td>11</td>
<td>0</td>
</tr>
<tr>
<td>1998</td>
<td>4</td>
<td>583</td>
<td>21</td>
<td>0</td>
</tr>
<tr>
<td>1999</td>
<td>10</td>
<td>1106</td>
<td>26</td>
<td>0</td>
</tr>
<tr>
<td>2000</td>
<td>10</td>
<td>1231</td>
<td>29</td>
<td>0</td>
</tr>
<tr>
<td>2001</td>
<td>11</td>
<td>1992</td>
<td>32</td>
<td>0</td>
</tr>
<tr>
<td>2002</td>
<td>21</td>
<td>2249</td>
<td>100</td>
<td>0</td>
</tr>
<tr>
<td>2003</td>
<td>30</td>
<td>3152</td>
<td>158</td>
<td>0</td>
</tr>
<tr>
<td>2004</td>
<td>19</td>
<td>5488</td>
<td>128</td>
<td>1</td>
</tr>
<tr>
<td>2005</td>
<td>16</td>
<td>3024</td>
<td>244</td>
<td>1</td>
</tr>
<tr>
<td>2006</td>
<td>29</td>
<td>6210</td>
<td>369</td>
<td>1</td>
</tr>
<tr>
<td>2007</td>
<td>44</td>
<td>12153</td>
<td>444</td>
<td>1</td>
</tr>
<tr>
<td>2008</td>
<td>43</td>
<td>13830</td>
<td>369</td>
<td>1</td>
</tr>
<tr>
<td>2009</td>
<td>49</td>
<td>27047</td>
<td>478</td>
<td>1</td>
</tr>
<tr>
<td>2010</td>
<td>47</td>
<td>26528</td>
<td>366</td>
<td>1</td>
</tr>
<tr>
<td>2011</td>
<td>77</td>
<td>45412</td>
<td>848</td>
<td>5</td>
</tr>
<tr>
<td>2012</td>
<td>96</td>
<td>75590</td>
<td>1055</td>
<td>4</td>
</tr>
<tr>
<td>2013</td>
<td>98</td>
<td>86617</td>
<td>2165</td>
<td>9</td>
</tr>
<tr>
<td>2014</td>
<td>135</td>
<td>138018</td>
<td>3188</td>
<td>11</td>
</tr>
<tr>
<td>2015</td>
<td>164</td>
<td>172375</td>
<td>4846</td>
<td>15</td>
</tr>
<tr>
<td>2016</td>
<td>192</td>
<td>178630</td>
<td>7541</td>
<td>27</td>
</tr>
<tr>
<td>2017</td>
<td>238</td>
<td>185473</td>
<td>8825</td>
<td>42</td>
</tr>
<tr>
<td>2018</td>
<td>278</td>
<td>203031</td>
<td>10954</td>
<td>54</td>
</tr>
<tr>
<td>2019</td>
<td>293</td>
<td>220901</td>
<td>13354</td>
<td>59</td>
</tr>
</tbody></table></div></code><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RUS-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">赛车在俄罗斯。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rus-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">俄罗斯的</font><i><font style="vertical-align: inherit;">精加工</font></i><font style="vertical-align: inherit;">者。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是图表上的样子：</font></font><br>
<img src="https://habrastorage.org/webt/nx/yg/4s/nxyg4syvd0x-0f16nxl1ucvhyma.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以看出，在该时期开始和结束时的种族和参与者的数量简直是无法估量的。从2011年开始，比赛的总数大幅度增加，而俄罗斯的起跑次数也有所增加。此外，可以回溯到2009年，参与者人数有所增加。这可能表明参与者之间的兴趣增加，即需求增加，此后两年后供应增加，即启动次数。但是，请不要忘记数据可能不完整，有些甚至可能缺少许多比赛。包括由于收集数据的项目仅在2010年才开始的事实，这也可以解释此时此图的重大飞跃。因此，为了进一步分析，我决定选择过去的十年。这是一个相当长的时期，为了跟踪几年中的任何趋势，而又短到无法到达那里，主要是90年代和2000年代初期的专业比赛。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs[(rs[<span class="hljs-string">'year'</span>]&gt;=<span class="hljs-number">2010</span>)&amp;(rs[<span class="hljs-string">'year'</span>]&lt;= <span class="hljs-number">2019</span>)]
</code></pre><br>
<img src="https://habrastorage.org/webt/ck/p4/qf/ckp4qfjucrjhl7kvu-0fyv_ilbc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
顺便说一句，在选定的时期内，有84％的比赛和94％的完成者摔倒了。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">业余开始</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，选定起点的绝大多数参与者是业余运动员，因此可以从他们那里获得良好的统计数据。老实说，这是我的主要兴趣所在，因为我本人也参加了这样的比赛，但从水平上说，它离奥运会冠军很远。但是，在选定的时期内显然也进行了专业比赛。为了不混淆业余和职业比赛的指标，决定将后者从考虑中删除。如何识别它们？通过速度。我们计算它们。在数据准备的初始阶段之一，我们已经确定了每场比赛的距离类型是：冲刺，奥运，半铁，铁杆。对于每个阶段，都明确定义了各个阶段的里程数-游泳，骑自行车和跑步。短跑的分数是0.75 + 20 + 5，奥运会的分数是1.5 + 40 + 10，半决赛的分数是1.9 + 90 + 21.1。铁为8 + 180 + 42.2。当然，实际上，对于任何类型，实际数字都可能因种族而异，有条件地变化到百分之一，但是没有有关此的信息，因此我们将假定一切都是准确的。</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'km'</span>] = <span class="hljs-string">''</span><font></font>
<font></font>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'sprint'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">0.75</span>+<span class="hljs-number">20</span>+<span class="hljs-number">5</span>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'olympic'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">1.5</span>+<span class="hljs-number">40</span>+<span class="hljs-number">10</span>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'half'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">1.9</span>+<span class="hljs-number">90</span>+<span class="hljs-number">21.1</span>
rs.loc[rs[<span class="hljs-string">'dist'</span>] == <span class="hljs-string">'full'</span>, <span class="hljs-string">'km'</span>] = <span class="hljs-number">3.8</span>+<span class="hljs-number">180</span>+<span class="hljs-number">42.2</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们计算每场比赛的平均速度和最大速度。</font><font style="vertical-align: inherit;">此处的最大值是指获得第一名的运动员的平均速度。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]<font></font>
    rd[e][<span class="hljs-string">'th'</span>] = pd.TimedeltaIndex(rd[e][<span class="hljs-string">'result'</span>]).seconds/<span class="hljs-number">3600</span>
    rd[e][<span class="hljs-string">'v'</span>] = rs.loc[i, <span class="hljs-string">'km'</span>] / rd[e][<span class="hljs-string">'th'</span>]<font></font>
<font></font>
<span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]<font></font>
    rs.loc[index,<span class="hljs-string">'vmax'</span>] = rd[e][<span class="hljs-string">'v'</span>].max()<font></font>
    rs.loc[index,<span class="hljs-string">'vavg'</span>] = rd[e][<span class="hljs-string">'v'</span>].mean()
</code></pre><br>
<img src="https://habrastorage.org/webt/81/6k/pe/816kpel94nzs-hsp9dphfdhtq3g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好了，您可以看到大部分速度聚集在大约15 km / h和30 km / h之间的堆中，但是有一定数量的完全“宇宙”值。</font><font style="vertical-align: inherit;">按平均速度排序，看看有多少：</font></font><br>
<br>
<pre><code class="python hljs">rs = rs.sort_values(by=<span class="hljs-string">'vavg'</span>)
</code></pre><br>
<img src="https://habrastorage.org/webt/aa/wi/ws/aawiwsx0kcmhzyq3y3ezcm_fy0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里，我们更改了比例，可以更准确地估计范围。平均速度约为17 km / h至27 km / h，最大速度为18 km / h至32 km / h。另外，有些“尾巴”的平均速度非常低，非常高。低速很可能对应于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Norseman之</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的极限比赛</font><font style="vertical-align: inherit;">，在取消游泳的情况</font><font style="vertical-align: inherit;">下</font><font style="vertical-align: inherit;">可能出现</font><font style="vertical-align: inherit;">高速，</font><font style="vertical-align: inherit;">在这种情况下，不是冲刺，而是超级冲刺，或者只是错误的数据。另一个要点是</font><font style="vertical-align: inherit;">沿</font><i><font style="vertical-align: inherit;">X</font></i><font style="vertical-align: inherit;">轴</font><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1200</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区域内的平滑台阶</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及更高的平均速度值。</font><font style="vertical-align: inherit;">在那里，您可以看到平均速度和最大速度之间的差异远小于图表的前三分之二。</font><font style="vertical-align: inherit;">显然，这是一场职业比赛。</font><font style="vertical-align: inherit;">为了更清楚地区分它们，我们计算了最大速度与平均值的比率。</font><font style="vertical-align: inherit;">在专业比赛中，没有随机的人，并且所有参与者的身体素质都很高，因此该比例应该很小。</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'vmdbva'</span>] = rs[<span class="hljs-string">'vmax'</span>]/rs[<span class="hljs-string">'vavg'</span>] <span class="hljs-comment">#vmdbva - v max divided by v avg</span>
rs = rs.sort_values(by=<span class="hljs-string">'vmdbva'</span>)
</code></pre><br>
<img src="https://habrastorage.org/webt/li/cv/pr/licvprwpcx3zlws5pjufo0dxhcm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此图表上，第一季度非常明显：最大速度与平均比率之比很小，平均速度较高，参与者人数很少。</font><font style="vertical-align: inherit;">这是一场专业比赛。</font><font style="vertical-align: inherit;">绿色曲线上的台阶大约为1.2。</font><font style="vertical-align: inherit;">在样本中，我们将仅保留比率值大于1.2的记录。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs[rs[<span class="hljs-string">'vmdbva'</span>] &gt; <span class="hljs-number">1.2</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们还会删除非典型的低速和高速记录。</font><font style="vertical-align: inherit;">在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是铁人三项“世界纪录”为每个距离？</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布了2019年通过不同距离的记录时间。</font><font style="vertical-align: inherit;">如果以中等速度计算它们，那么即使最快，也不能超过33 km / h。</font><font style="vertical-align: inherit;">因此，我们将考虑平均速度较高，无效的协议，并将其从考虑中删除。</font></font><br>
<br>
<pre><code class="python hljs">rs = rs[(rs[<span class="hljs-string">'vavg'</span>] &gt; <span class="hljs-number">17</span>)&amp;(rs[<span class="hljs-string">'vmax'</span>] &lt; <span class="hljs-number">33</span>)]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
剩下的就是：</font></font><br>
<img src="https://habrastorage.org/webt/t1/dk/_p/t1dk_pixaznwxlfsunkxpx5yfum.png"><br>
<img src="https://habrastorage.org/webt/qk/9u/4a/qk9u4anxmpnwehsdhckfn64ucvw.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，一切看起来都很相似，并且没有引发任何问题。</font><font style="vertical-align: inherit;">所有这些选择的结果是，我们丢失了1922年协议中的777个，即40％。</font><font style="vertical-align: inherit;">同时，整理机的总数没有减少太多-仅减少了13％。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，剩下1,145场比赛还有1,231,772名完成者。</font><font style="vertical-align: inherit;">该样本成为我进行分析和可视化的素材。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5部分。分析和可视化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这项工作中，适当的分析和可视化是最简单的部分。</font><font style="vertical-align: inherit;">冰山一角，其水下部分只是数据的准备。</font><font style="vertical-align: inherit;">实际上，该分析是对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas Series</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的简单算术运算</font><font style="vertical-align: inherit;">，计算平均值，进行过滤-所有这些操作都是由基本的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pandas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具完成的，</font><font style="vertical-align: inherit;">并且上面的代码包含了示例。</font><font style="vertical-align: inherit;">反过来，可视化主要是使用最</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准的matplotlib完成的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">二手</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情节，酒吧，馅饼</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，在某些地方，在日期和象形图的情况下，我不得不修改轴的签名，但这并不是在此处进行详细描述的内容。</font><font style="vertical-align: inherit;">唯一值得一提的是地理数据的表示。</font><font style="vertical-align: inherit;">至少不是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地理数据</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于每场比赛，我们都有关于场地的信息。</font><font style="vertical-align: inherit;">从一开始，</font><font style="vertical-align: inherit;">我们</font><font style="vertical-align: inherit;">就使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geopy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来计算每个位置的坐标。</font><font style="vertical-align: inherit;">每年在同一地点举行许多比赛。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;">folium</font></i></a><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">
用于在</font><i><font style="vertical-align: inherit;">python中</font></i><font style="vertical-align: inherit;">渲染地理数据的非常方便的工具</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">运作方式如下：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>event</th>
<th>date</th>
<th>country</th>
<th><u>latitude</u></th>
<th><u>longitude</u></th>
<th>loc</th>
<th>…</th>
</tr>
<tr>
<td>0</td>
<td>Ironman Indian Wells La Quinta 70.3 2019</td>
<td>2019-12-08</td>
<td>USA</td>
<td><u>33.7238</u></td>
<td><u>-116.305</u></td>
<td>Indian Wells/La Quinta, California, USA</td>
<td>…</td>
</tr>
<tr>
<td>1</td>
<td>Ironman Taupo 70.3 2019</td>
<td>2019-12-07</td>
<td>NZL</td>
<td><u>-41.5001</u></td>
<td><u>172.834</u></td>
<td>New Zealand</td>
<td>…</td>
</tr>
<tr>
<td>2</td>
<td>Ironman Western Australia 2019</td>
<td>2019-12-01</td>
<td>AUS</td>
<td><u>-33.6445</u></td>
<td><u>115.349</u></td>
<td>Busselton, Western Australia</td>
<td>…</td>
</tr>
<tr>
<td>3</td>
<td>Ironman Mar del Plata 2019</td>
<td>2019-12-01</td>
<td>ARG</td>
<td><u>-37.9977</u></td>
<td><u>-57.5483</u></td>
<td>Mar del Plata, Argentina</td>
<td>…</td>
</tr>
<tr>
<td>4</td>
<td>Ironman Cozumel 2019</td>
<td>2019-11-24</td>
<td>MEX</td>
<td><u>20.4318</u></td>
<td><u>-86.9203</u></td>
<td>Cozumel, Mexico</td>
<td>…</td>
</tr>
<tr>
<td>5</td>
<td>Ironman Arizona 2019</td>
<td>2019-11-24</td>
<td>USA</td>
<td><u>33.4255</u></td>
<td><u>-111.94</u></td>
<td>Tempe, Arizona, USA</td>
<td>…</td>
</tr>
<tr>
<td>6</td>
<td>Ironman Xiamen 70.3 2019</td>
<td>2019-11-10</td>
<td>CHN</td>
<td><u>24.4758</u></td>
<td><u>118.075</u></td>
<td>Xiamen, China</td>
<td>…</td>
</tr>
<tr>
<td>7</td>
<td>Ironman Turkey 70.3 2019</td>
<td>2019-11-03</td>
<td>TUR</td>
<td><u>36.8633</u></td>
<td><u>31.0578</u></td>
<td>Belek, Antalya, Turkey</td>
<td>…</td>
</tr>
<tr>
<td>8</td>
<td>Ironman Florida 2019</td>
<td>2019-11-02</td>
<td>USA</td>
<td><u>30.1766</u></td>
<td><u>-85.8055</u></td>
<td>Panama City Beach, Florida, USA</td>
<td>…</td>
</tr>
<tr>
<td>9</td>
<td>Ironman Marrakech 70.3 2019</td>
<td>2019-10-27</td>
<td>MAR</td>
<td><u>31.6258</u></td>
<td><u>-7.98916</u></td>
<td>Marrakech, Morocco</td>
<td>…</td>
</tr>
<tr>
<td>10</td>
<td>Ironman Waco 70.3 2019</td>
<td>2019-10-27</td>
<td>USA</td>
<td><u>31.5493</u></td>
<td><u>-97.1467</u></td>
<td>Waco, Texas, USA</td>
<td>…</td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"></font></i></a><font style="vertical-align: inherit;"></font><br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> folium<font></font>
<font></font>
m = folium.Map() <font></font>
folium.Marker([<span class="hljs-string">'55.7522200'</span>, <span class="hljs-string">'37.6155600'</span>], popup=<span class="hljs-string">''</span>).add_to(m)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且我们可以在Jupiter笔记本电脑中获得交互式地图。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/hp/fs/jchpfspvaahnnbvwtgwx2wqkppu.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，到我们的数据。</font><font style="vertical-align: inherit;">首先，我们将从坐标的组合开始一个新列：</font></font><br>
<br>
<pre><code class="python hljs">rs[<span class="hljs-string">'coords'</span>] = rs[<span class="hljs-string">'latitude'</span>].astype(str) + <span class="hljs-string">', '</span> + rs[<span class="hljs-string">'longitude'</span>].astype(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
独特的坐标，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COORDS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是291.而独特的位置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是324，这意味着一些名字稍微有些不同，而在同一时间，他们对应的相同点。</font><font style="vertical-align: inherit;">这并不可怕，我们将通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来考虑唯一性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们计算每个位置（具有唯一坐标）在整个时间内经过了多少个事件：</font></font><br>
<br>
<pre><code class="python hljs">vc = rs[<span class="hljs-string">'coords'</span>].value_counts()<font></font>
<font></font>
vc</code></pre><br>
<code><b>Out:</b><br>
43.7009358, 7.2683912 22<br>
43.5854823, 39.723109 20<br>
29.03970805, -13.636291 16<br>
47.3723941, 8.5423328 16<br>
59.3110918, 24.420907 15<br>
51.0834196, 10.4234469 15<br>
54.7585694, 38.8818137 14<br>
20.4317585, -86.9202745 13<br>
52.3727598, 4.8936041 12<br>
41.6132925, 2.6576102 12<br>
... ...<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在创建一个地图，并以圆圈的形式在其上添加标记，其半径将取决于该地点举行的活动的数量。</font><font style="vertical-align: inherit;">将带有位置名称的标记添加到标记中。</font></font><br>
<br>
<pre><code class="python hljs">m = folium.Map(location=[<span class="hljs-number">25</span>,<span class="hljs-number">10</span>], zoom_start=<span class="hljs-number">2</span>)<font></font>
<font></font>
<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> rs[<span class="hljs-string">'coords'</span>].unique():<font></font>
    row = [r[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rs.iterrows() <span class="hljs-keyword">if</span> r[<span class="hljs-number">1</span>][<span class="hljs-string">'coords'</span>] == c][<span class="hljs-number">0</span>]    <font></font>
    folium.Circle([row[<span class="hljs-string">'latitude'</span>], row[<span class="hljs-string">'longitude'</span>]], <font></font>
					popup=(row[<span class="hljs-string">'location'</span>]+<span class="hljs-string">'\n('</span>+str(vc[c])+<span class="hljs-string">' races)'</span>), <font></font>
					radius = <span class="hljs-number">10000</span>*int(vc[c]), <font></font>
					color=<span class="hljs-string">'darkorange'</span>, <font></font>
					fill=<span class="hljs-literal">True</span>, <font></font>
					stroke=<span class="hljs-literal">True</span>, <font></font>
					weight=<span class="hljs-number">1</span>).add_to(m)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
做完了 </font><font style="vertical-align: inherit;">您可以看到结果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ch/d4/gj/chd4gj0qbyjrzyjikpmslgesw0i.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者进度</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，除了指导之外，按照另一个时间表进行工作也是不容易的。这是参与者的最新进度图。它是这样的：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/rf/ca/jq/rfcajquw4qluhsw9wuhicbgk7rm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们对其进行分析，同时我将给出渲染代码，作为使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的示例</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs">fig = plt.figure()<font></font>
fig.set_size_inches(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>)<font></font>
<font></font>
ax = fig.add_axes([<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>])<font></font>
<font></font>
b = ax.bar(exp,numrecs, color = <span class="hljs-string">'navajowhite'</span>)<font></font>
<font></font>
ax1 = ax.twinx()<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(exp_samp)):<font></font>
    ax1.plot(exp_samp[i], vproc_samp[i], <span class="hljs-string">'.'</span>)<font></font>
	<font></font>
p, = ax1.plot(exp, vpm, <span class="hljs-string">'o-'</span>,markersize=<span class="hljs-number">8</span>, linewidth=<span class="hljs-number">2</span>, color=<span class="hljs-string">'C0'</span>)<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(exp)):
    <span class="hljs-keyword">if</span> i &lt; len(exp)<span class="hljs-number">-1</span> <span class="hljs-keyword">and</span> (vpm[i] &lt; vpm[i+<span class="hljs-number">1</span>]):<font></font>
        ax1.text(x = exp[i]+<span class="hljs-number">0.1</span>, y = vpm[i]<span class="hljs-number">-0.2</span>, s = <span class="hljs-string">'{0:3.1f}%'</span>.format(vpm[i]),size=<span class="hljs-number">12</span>)
    <span class="hljs-keyword">else</span>:<font></font>
        ax1.text(x = exp[i]+<span class="hljs-number">0.1</span>, y = vpm[i]+<span class="hljs-number">0.1</span>, s = <span class="hljs-string">'{0:3.1f}%'</span>.format(vpm[i]),size=<span class="hljs-number">12</span>)<font></font>
<font></font>
ax.legend((b,p), (<span class="hljs-string">' '</span>, <span class="hljs-string">''</span>),loc=<span class="hljs-string">'center right'</span>)<font></font>
ax.set_xlabel(<span class="hljs-string">'   '</span>)<font></font>
ax.set_ylabel(<span class="hljs-string">''</span>)<font></font>
ax1.set_ylabel(<span class="hljs-string">'%     '</span>)<font></font>
ax.set_xticks(np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, step=<span class="hljs-number">1</span>))<font></font>
ax.set_yticks(np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">230000</span>, step=<span class="hljs-number">25000</span>))<font></font>
ax1.set_ylim(<span class="hljs-number">97.5</span>,<span class="hljs-number">103.5</span>)<font></font>
ax.yaxis.set_label_position(<span class="hljs-string">"right"</span>)<font></font>
ax.yaxis.tick_right()<font></font>
ax1.yaxis.set_label_position(<span class="hljs-string">"left"</span>)<font></font>
ax1.yaxis.tick_left()      <font></font>
<font></font>
plt.show()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在介绍如何为他计算数据。</font><font style="vertical-align: inherit;">首先，您必须选择至少参加过两场比赛且在不同日历年中均完成比赛且并非专业人士的参与者的姓名。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，对于每个协议，填写一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">date</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的新列</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">将指示比赛的日期。</font><font style="vertical-align: inherit;">从该日期起，我们还需要一年，因此我们将列设为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">year</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于我们要分析每个运动员相对于比赛中平均速度的速度，因此我们立即在新列</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vproc中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算该速度</font><font style="vertical-align: inherit;">-该速度占平均速度的百分比。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> rs.iterrows():<font></font>
    e = row[<span class="hljs-string">'event'</span>]<font></font>
    rd[e][<span class="hljs-string">'date'</span>] = row[<span class="hljs-string">'date'</span>]<font></font>
    rd[e][<span class="hljs-string">'year'</span>] = row[<span class="hljs-string">'year'</span>]<font></font>
    rd[e][<span class="hljs-string">'vproc'</span>] = <span class="hljs-number">100</span> * rd[e][<span class="hljs-string">'v'</span>] / rd[e][<span class="hljs-string">'v'</span>].mean()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在的协议如下所示：</font><font style="vertical-align: inherit;">
接下来，将所有协议组合到一个数据帧中。</font></font><br>
<code>'   Sprint 2019'</code><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>...</th>
<th>th</th>
<th>v</th>
<th><u>date</u></th>
<th><u>year</u></th>
<th><u>vproc</u></th>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>M</td>
<td>Shalev Aleksey</td>
<td>RUS</td>
<td>...</td>
<td>1.161944</td>
<td>22.161128</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>130.666668</u></td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>M</td>
<td>Nikolaev Artem</td>
<td>RUS</td>
<td>...</td>
<td>1.228611</td>
<td>20.958625</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>123.576458</u></td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>M</td>
<td>Kuchierskiy Aleksandr</td>
<td>RUS</td>
<td>...</td>
<td>1.255556</td>
<td>20.508850</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>120.924485</u></td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>F</td>
<td>Korchagina Mariya</td>
<td>RUS</td>
<td>...</td>
<td>1.297222</td>
<td>19.850107</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>117.040401</u></td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>M</td>
<td>Solodov Ivan</td>
<td>RUS</td>
<td>...</td>
<td>1.298056</td>
<td>19.837364</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>116.965263</u></td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>M</td>
<td>Bukin Sergey</td>
<td>RUS</td>
<td>...</td>
<td>1.300278</td>
<td>19.803461</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>116.765365</u></td>
</tr>
<tr>
<td>6</td>
<td>7</td>
<td>M</td>
<td>Lavrentev Dmitriy</td>
<td>RUS</td>
<td>...</td>
<td>1.300278</td>
<td>19.803461</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>116.765365</u></td>
</tr>
<tr>
<td>7</td>
<td>8</td>
<td>M</td>
<td>Dolgov Petr</td>
<td>RUS</td>
<td>...</td>
<td>1.321667</td>
<td>19.482976</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>114.875719</u></td>
</tr>
<tr>
<td>8</td>
<td>9</td>
<td>M</td>
<td>Bezruchenko Mikhailn</td>
<td>RUS</td>
<td>...</td>
<td>1.345000</td>
<td>19.144981</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>112.882832</u></td>
</tr>
<tr>
<td>9</td>
<td>10</td>
<td>M</td>
<td>Ryazantsev Dmitriy</td>
<td>RUS</td>
<td>...</td>
<td>1.359444</td>
<td>18.941561</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>111.683423</u></td>
</tr>
<tr>
<td>10</td>
<td>11</td>
<td>M</td>
<td>Ibragimov Ramil</td>
<td>RUS</td>
<td>...</td>
<td>1.376389</td>
<td>18.708375</td>
<td><u>2019-09-14</u></td>
<td><u>2019</u></td>
<td><u>110.308511</u></td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">ar = pd.concat(rd)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于每个参与者，我们在每个日历年仅保留一个条目：</font></font><br>
<br>
<pre><code class="python hljs">ar1 = ar.drop_duplicates(subset = [<span class="hljs-string">'name'</span>,<span class="hljs-string">'year'</span>], keep=<span class="hljs-string">'first'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，从这些条目的所有唯一名称中，我们发现至少出现两次的名称：</font></font><br>
<br>
<pre><code class="python hljs">nvc = ar1[<span class="hljs-string">'name'</span>].value_counts()<font></font>
names = list(nvc[nvc &gt; <span class="hljs-number">1</span>].index)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
共有219,890个。让我们从此列表中删除职业运动员的名称：</font></font><br>
<br>
<pre><code class="python hljs">pro_names = ar[ar[<span class="hljs-string">'group'</span>].isin([<span class="hljs-string">'MPRO'</span>,<span class="hljs-string">'FPRO'</span>])][<span class="hljs-string">'name'</span>].unique()<font></font>
names = list(set(names) - set(pro_names))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以及2010年之前开始表演的运动员的名字。</font><font style="vertical-align: inherit;">为此，请上载我们在过去十年中进行采样之前保存的数据。</font><font style="vertical-align: inherit;">将它们放在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（所有竞赛摘要）和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（所有竞赛详细信息）</font><font style="vertical-align: inherit;">对象中</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs">rdo = {} <font></font>
<font></font>
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> rda:    
    <span class="hljs-keyword">if</span> rsa[rsa[<span class="hljs-string">'event'</span>] == e][<span class="hljs-string">'year'</span>].iloc[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">2010</span>:<font></font>
        rdo[e] = rda[e]<font></font>
<font></font>
aro = pd.concat(rdo)<font></font>
old_names = aro[<span class="hljs-string">'name'</span>].unique()<font></font>
names = list(set(names) - set(old_names))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我们发现同一天出现多次的名称。</font><font style="vertical-align: inherit;">因此，我们将样本中全名的出现减到最少。</font></font><br>
<br>
<pre><code class="python hljs">namesakes = ar[ar.duplicated(subset = [<span class="hljs-string">'name'</span>,<span class="hljs-string">'date'</span>], keep = <span class="hljs-literal">False</span>)][<span class="hljs-string">'name'</span>].unique()<font></font>
names = list(set(names) - set(namesakes))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，还有198,075个名字。</font><font style="vertical-align: inherit;">从整个数据集中，我们仅选择具有找到的名称的记录：</font></font><br>
<br>
<pre><code class="python hljs">ars = ar[ar[<span class="hljs-string">'name'</span>].isin(names)] <span class="hljs-comment">#ars – all recrds selected</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，对于每条记录，您需要确定运动员职业生涯中的哪一年-第一，第二，第三或第十年。</font><font style="vertical-align: inherit;">我们用所有名称进行循环并计算。</font></font><br>
<br>
<pre><code class="python hljs">ars[<span class="hljs-string">'exp'</span>] = <span class="hljs-string">''</span> <span class="hljs-comment">#exp – experience, counted in years of racing, starts from 1.</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> names:    <font></font>
    ind = ars[ars[<span class="hljs-string">'name'</span>] == n].index <font></font>
    yos = ars.loc[ind, <span class="hljs-string">'year'</span>].min() <span class="hljs-comment">#yos – year of start</span>
    ars.loc[ind, <span class="hljs-string">'exp'</span>] = ars.loc[ind, <span class="hljs-string">'year'</span>] - yos + <span class="hljs-number">1</span> 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是发生的事的一个例子：</font><font style="vertical-align: inherit;">
显然，同名仍然存在。</font><font style="vertical-align: inherit;">这是预料之中的，但并不可怕，因为我们将平均所有东西，并且不应有那么多。</font><font style="vertical-align: inherit;">接下来，我们为图构建数组：</font></font><br>
<code><div class="scrollable-table"><table>
<tbody><tr>
<th>event</th>
<th>place</th>
<th>sex</th>
<th>name</th>
<th>country</th>
<th>group</th>
<th>…</th>
<th>th</th>
<th>v</th>
<th>date</th>
<th><u>year</u></th>
<th>vproc</th>
<th><u>exp</u></th>
</tr>
<tr>
<td>…</td>
<td>633</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>5.356111</td>
<td>21.097397</td>
<td>2014-08-31</td>
<td><u>2014</u></td>
<td>106.036879</td>
<td><u>1</u></td>
</tr>
<tr>
<td>…</td>
<td>302</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>11.236389</td>
<td>20.113223</td>
<td>2015-08-30</td>
<td><u>2015</u></td>
<td>108.231254</td>
<td><u>2</u></td>
</tr>
<tr>
<td>…</td>
<td>522</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>10.402778</td>
<td>21.724967</td>
<td>2016-07-17</td>
<td><u>2016</u></td>
<td>111.265107</td>
<td><u>3</u></td>
</tr>
<tr>
<td>…</td>
<td>25</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>10.910833</td>
<td>20.713358</td>
<td>2017-09-23</td>
<td><u>2017</u></td>
<td>112.953644</td>
<td><u>4</u></td>
</tr>
<tr>
<td>…</td>
<td>23</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>4.700000</td>
<td>24.042553</td>
<td>2017-06-03</td>
<td><u>2017</u></td>
<td>120.565211</td>
<td><u>4</u></td>
</tr>
<tr>
<td>…</td>
<td>42</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M40-44</td>
<td>…</td>
<td>4.599167</td>
<td>24.569668</td>
<td>2018-06-17</td>
<td><u>2018</u></td>
<td>124.579862</td>
<td><u>5</u></td>
</tr>
<tr>
<td>…</td>
<td>90</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>NOR</td>
<td></td>
<td>…</td>
<td>14.069167</td>
<td>16.063496</td>
<td>2018-08-04</td>
<td><u>2018</u></td>
<td>100.001834</td>
<td><u>5</u></td>
</tr>
<tr>
<td>…</td>
<td>86</td>
<td>M</td>
<td>Golovin Sergey</td>
<td>RUS</td>
<td>M45-49</td>
<td>…</td>
<td>9.820556</td>
<td>23.012955</td>
<td>2019-08-03</td>
<td><u>2019</u></td>
<td>118.375766</td>
<td><u>6</u></td>
</tr>
</tbody></table></div></code><br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs">exp = [] <font></font>
vpm = [] <span class="hljs-comment">#vpm – v proc mean</span>
numrecs = [] <span class="hljs-comment">#number of records</span><font></font>
<font></font>
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> range(ars[<span class="hljs-string">'exp'</span>].min(), ars[<span class="hljs-string">'exp'</span>].max() + <span class="hljs-number">1</span>): <font></font>
    exp.append(x)<font></font>
    vpm.append(ars[ars[<span class="hljs-string">'exp'</span>] == x][<span class="hljs-string">'vproc'</span>].mean())<font></font>
    numrecs.append(len(ars[ars[<span class="hljs-string">'exp'</span>] == x]))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
就是这样，有一个基础：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c4/_p/u6/c4_pu61ixkiscputxq1qhfm84eg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，要用与特定结果相对应的点来装饰它，我们将选择1000个随机名称并使用它们的结果构建数组。</font></font><br>
<br>
<pre><code class="python hljs">names_samp = random.sample(names,<span class="hljs-number">1000</span>)<font></font>
ars_samp = ars[ars[<span class="hljs-string">'name'</span>].isin(names_samp)]<font></font>
<font></font>
ars_samp = ars_samp.reset_index(drop = <span class="hljs-literal">True</span>)<font></font>
exp_samp = []<font></font>
vproc_samp = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> names_samp:<font></font>
    nr = ars_samp[ars_samp[<span class="hljs-string">'name'</span>] == n]<font></font>
    nr = nr.sort_values(<span class="hljs-string">'exp'</span>)<font></font>
    exp_samp.append(list(nr[<span class="hljs-string">'exp'</span>]))<font></font>
    vproc_samp.append(list(nr[<span class="hljs-string">'vproc'</span>]))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
添加一个循环以从此随机样本构建图形。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(exp_samp)):<font></font>
    ax1.plot(exp_samp[i], vproc_samp[i], <span class="hljs-string">'.'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在一切就绪：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/0h/ee/uj0hee9v0tujesawdjz41fmfp0u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
总体而言，这并不困难。但是有一个问题。要计算</font><font style="vertical-align: inherit;">一个周期中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经验</font><font style="vertical-align: inherit;">，几乎所有20万个名称都需要八个小时。我不得不在小样本上调试算法，然后在夜间进行计算。原则上，此操作只能执行一次，但是如果您发现某种错误或想要更改某些内容，而又需要重新计算，则会开始增加负担。因此，当我打算在晚上发布报告时，事实证明，再次需要重新叙述所有内容。等到早上不是我的计划的一部分，我开始寻找一种使计算更快的方法。决定并行化。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
找到某处通过</font><i><font style="vertical-align: inherit;">多处理</font></i><font style="vertical-align: inherit;">方法做到这一点的方法</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了在Windows上工作，我们需要将每个并行任务的主要逻辑放入单独的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> pickle <span class="hljs-keyword">as</span> pkl<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worker</span>(<span class="hljs-params">args</span>):</span>
    names = args[<span class="hljs-number">0</span>]<font></font>
    ars=args[<span class="hljs-number">1</span>]<font></font>
    num=args[<span class="hljs-number">2</span>]<font></font>
    ars = ars.sort_values(by=<span class="hljs-string">'name'</span>)<font></font>
    ars = ars.reset_index(drop=<span class="hljs-literal">True</span>)  <font></font>
<font></font>
    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> names:   <font></font>
        ind = ars[ars[<span class="hljs-string">'name'</span>] == n].index <font></font>
        yos = ars.loc[ind, <span class="hljs-string">'year'</span>].min()<font></font>
        ars.loc[ind, <span class="hljs-string">'exp'</span>] = ars.loc[ind, <span class="hljs-string">'year'</span>] - yos + <span class="hljs-number">1</span>                      <font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\par\prog'</span> + str(num) + <span class="hljs-string">'.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:<font></font>
        pkl.dump(ars,f)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该过程被转移到的姓名的一部分</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，部分datafreyma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AR</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅与这些名称，和并行任务的序列号- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">计算被写入数据帧，最后，数据帧被写入文件。</font><font style="vertical-align: inherit;">在调用此</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的笔记本电脑中</font><font style="vertical-align: inherit;">，我们相应地准备了参数：</font></font><br>
<br>
<pre><code class="python hljs">num_proc = <span class="hljs-number">8</span> <span class="hljs-comment">#number of processors</span><font></font>
args = []<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_proc):<font></font>
    step = int(len(names_samp)/num_proc) + <span class="hljs-number">1</span>
    names_i = names_samp[i*step:min((i+<span class="hljs-number">1</span>)*step, len(names_samp))]<font></font>
    ars_i = ars[ars[<span class="hljs-string">'name'</span>].isin(names_i)]<font></font>
    args.append([names_i, ars_i, i])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们开始并行计算：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool
<span class="hljs-keyword">import</span> workers<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">'__main__'</span>:     <font></font>
    p=Pool(processes = num_proc)<font></font>
    p.map(workers.worker,args)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，我们从文件中读取结果，并将片段收集回整个数据框中：</font></font><br>
<br>
<pre><code class="python hljs">ars=pd.DataFrame(columns = ars.columns)<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num_proc):
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">r'D:\tri\par\prog'</span>+str(i)+<span class="hljs-string">'.pkl'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:    <font></font>
        arsi = pkl.load(f)<font></font>
        print(len(arsi))<font></font>
        ars = pd.concat([ars, arsi])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，有可能获得40倍的加速度，而不是8个小时，从而在11分钟内完成计算并在当晚发布报告。同时，我学习了如何在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并行化</font><font style="vertical-align: inherit;">，我认为它将派上用场。在这里，由于每个任务使用的数据帧较小，因此搜索速度甚至是内核数量的8倍以上，这使得搜索速度更快。原则上，可以以此方式加快顺序计算的速度，但是问题是，您如何猜测？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，我无法平静下来，甚至在发布之后，我就一直在思考如何使用矢量化进行计算，即对“ </font><i><font style="vertical-align: inherit;">熊猫系列”数据</font></i><font style="vertical-align: inherit;">框的整列进行操作</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样的计算比任何并行周期都快一个数量级，即使在超级集群上也是如此。</font><font style="vertical-align: inherit;">并想出了。</font><font style="vertical-align: inherit;">事实证明，为每个名字找到职业开始的年份，有必要相反-为每年找到从事这个职业的参与者。</font><font style="vertical-align: inherit;">为此，您必须首先确定样本中第一年的所有名称，即2010年。因此，我们将在今年使用这些名称处理所有记录。</font><font style="vertical-align: inherit;">接下来，我们考虑下一年-2011年。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再次，我们找到了今年所有带有条目的名称，但我们仅从它们中提取了未经处理的名称，即2010年未满足且在2011年使用它们进行处理的名称。</font><font style="vertical-align: inherit;">在下半年，依此类推。</font><font style="vertical-align: inherit;">相同的循环，但没有二十万次迭代，但总共有九次。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(ars[<span class="hljs-string">'year'</span>].min(),ars[<span class="hljs-string">'year'</span>].max()):<font></font>
    arsynp = ars[(ars[<span class="hljs-string">'exp'</span>] == <span class="hljs-string">''</span>) &amp; (ars[<span class="hljs-string">'year'</span>] == y)] <span class="hljs-comment">#arsynp - all records selected for year not processed</span>
    namesy = arsynp[<span class="hljs-string">'name'</span>].unique()<font></font>
    ind = ars[ars[<span class="hljs-string">'name'</span>].isin(namesy)].index<font></font>
    ars.loc[ind, <span class="hljs-string">'exp'</span>] = ars.loc[ind,<span class="hljs-string">'year'</span>] - y + <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个周期仅需几秒钟即可完成。</font><font style="vertical-align: inherit;">而且代码变得更加简洁。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，最后，许多工作已经完成。对我而言，这实际上是同类项目中的第一个。当我学习它时，主要目标是练习使用python及其库。此任务远未完成。结果本身也很可观。完成后我会为自己得出什么结论？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据不完善。几乎所有分析任务都可能如此。即使它们是完全结构化的，并且经常以不同的方式发生，您也需要在开始计算特征并搜索趋势之前准备好对它们进行修补-查找错误，离群值，偏离标准等。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其次：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何任务都有解决方案。这更像是一个口号，但通常是这样。只是，这种解决方案可能并不那么明显，并且不在于数据本身，而是可以直接使用。例如，上述参与者名称的处理或网站抓取。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域知识至关重要。这样就可以更好地准备数据，删除明显无效或非标准的数据，避免解释错误，使用数据中未包含的信息（例如本项目中的距离），以社区接受的形式展示结果，同时避免出现愚蠢的错误结论。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第四：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">python中</font></i><font style="vertical-align: inherit;">工作</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有很多工具。有时似乎值得考虑一些事情，您开始搜索-它已经存在。太好了！非常感谢创建者的贡献，尤其是这里方便使用的工具：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硒</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于刮削，pycountry用于根据ISO标准确定国家/地区代码，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家/地区代码（datahub）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于奥林匹克代码，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geopy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于确定地址处的坐标，大</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">叶</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -用于地理数据的可视化，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性别猜测</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -用于名称分析，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多处理</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -用于并行计算，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">matplotlib</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及当然还有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">熊猫</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -没有它就无处可走。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第五：向</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">量化是我们的一切。能够使用内置的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">熊猫</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具非常重要</font><font style="vertical-align: inherit;">，它非常有效。我想在大多数情况下，当测量记录的数量从成千上万起时，此技能就变得非常必要。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第六：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理数据是一个坏主意。有必要尝试最小化任何手动干预-首先，它不会扩展，也就是说，当数据量增加几倍时，手动处理的时间将增加到不可接受的值，其次，可重复性很差-您会忘记一些东西，会在某个地方犯错。一切都只是程序性的，如果某些东西超出了软件解决方案的通用标准，那么，可以，您可以牺牲部分数据，仍然会有更多好处。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第七：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该代码必须保持工作状态。看来可能会更加明显！实际上，当涉及到供您自己使用的代码（目的是发布此代码的结果）时，此处的一切都不那么严格。我在Jupiter Notebooks工作，在我看来，这种环境不必创建集成的软件产品。它被配置为逐行，分段启动，这具有它的优点-快速：同时进行开发，调试和执行。但是通常的诱惑是只编辑一些行并快速获得新结果，而不是在</font><i><font style="vertical-align: inherit;">def</font></i><font style="vertical-align: inherit;">中复制或包装</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当然，应该避免这种诱惑。人们应该努力争取好的代码，甚至是“为了自己”，至少是因为即使对于一项分析工作来说，启动也要进行多次，并且在开始时花时间肯定会在将来获得回报。您甚至可以在笔记本电脑上以检查关键参数和引发异常的形式添加测试-这非常有用。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第八：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多储蓄。在每个步骤中，我都保存了文件的新版本。总共大约为10。这很方便，因为当检测到错误时，它有助于快速确定发生在哪个阶段。另外，我将源数据保存在标记为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的列中</font><font style="vertical-align: inherit;">-这使您可以快速检查结果并查看差异。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第九：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有必要衡量时间和结果的投入。在某些地方，我花了很长时间还原数据，这些数据只占总数的百分之一。实际上，这没有任何意义，您只需要将它们扔掉即可，仅此而已。如果是商业项目，而不是自动培训，我会这样做。这将使您更快地获得结果。帕累托原理在这里起作用-20％的时间可以达到80％的结果。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些项目的工作大大拓宽了视野。</font><font style="vertical-align: inherit;">愿意，您会从拉丁文“ Confoederatio Helvetica”那里学到一些新的东西，例如皮特凯恩群岛等陌生国家的名称，例如瑞士的ISO代码是CHE，那么西班牙的名字实际上就是铁人三项本身的名字-记录，其所有者，比赛地点，事件历史记录等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也许足够了。</font><font style="vertical-align: inherit;">就这样。</font><font style="vertical-align: inherit;">感谢所有读完本书的人！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500150/index.html">ROS和神经网格乞eg机器人</a></li>
<li><a href="../zh-CN500152/index.html">我如何在1C中集成POS终端和FR IKKM-Touch：企业</a></li>
<li><a href="../zh-CN500154/index.html">机密机器学习。PySyft库</a></li>
<li><a href="../zh-CN500158/index.html">SwiftUI与Redux的交互</a></li>
<li><a href="../zh-CN500160/index.html">视觉元素</a></li>
<li><a href="../zh-CN500164/index.html">导师：专业费用</a></li>
<li><a href="../zh-CN500170/index.html">网络模拟器教程ns-3。第六章</a></li>
<li><a href="../zh-CN500178/index.html">安德鲁·安（Andrew Un）的书《机器学习的激情》第38和39章的翻译</a></li>
<li><a href="../zh-CN500184/index.html">David O'Brien（Xirus）：指标！指标！指标！第2部分</a></li>
<li><a href="../zh-CN500186/index.html">HackTheBox。OpenAdmin演练。OpenNetAdmin中的RCE和nano中的GTFOBins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>