<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌🏿 🐯 🈸 Verwenden von RabbitMQ mit MonsterMQ Teil 1 ✌🏿 👨🏽‍🤝‍👨🏼 👨‍👨‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel richtet sich an Personen, die mit Warteschlangen und RabbitMQ noch nicht vertraut sind. Wenn Sie bereits wissen, wie man mit RabbitMQ a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Verwenden von RabbitMQ mit MonsterMQ Teil 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488850/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Artikel richtet sich an Personen, die mit Warteschlangen und RabbitMQ noch nicht vertraut sind. </font><font style="vertical-align: inherit;">Wenn Sie bereits wissen, wie man mit RabbitMQ arbeitet, und nur die Möglichkeiten von MonsterMQ erkunden möchten, empfehlen wir Ihnen, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Projektseite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf github.com zu </font><font style="vertical-align: inherit;">besuchen. In </font><font style="vertical-align: inherit;">der Beschreibung wird ausführlich beschrieben, wie Sie MonsterMQ verwenden können, ohne die Grundlagen der Arbeit mit RabbitMQ zu beschreiben. </font><font style="vertical-align: inherit;">Der Rest dieses Artikels behandelt die Grundlagen der Funktionsweise von RabbitMQ mit MonsterMQ.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RabbitMQ ist ein Nachrichtenbroker. Es empfängt, speichert und leitet Nachrichten an seine Kunden weiter. Absender und Empfänger von Nachrichten von Clients können beispielsweise in PHP geschriebene Anwendungen bedienen. Die Kommunikation zwischen dem Client und RabbitMQ erfolgt nach bestimmten Regeln, die als AMQP (Advanced Message Queuing Protocol) bezeichnet werden. Beispielsweise folgt die Kommunikation zwischen Ihrem Browser und dem Webserver, auf dem sich dieser Artikel befindet, bestimmten Regeln. Sie werden als HTTP (HyperText Transfer Protocol) bezeichnet - ein Hypertext-Übertragungsprotokoll. Sowohl HTTP als auch AMQP sind Client-Server-Protokolle, dh sie implizieren die Anwesenheit eines Clients und eines Servers. RabbitMQ ist ein AMQP-Server, und MonsterMQ ist eine Bibliothek, mit der Sie schnell einen AMQP-Client in PHP schreiben können, der mit dem AMQP-Server kommuniziert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMQP und RabbitMQ verwenden die folgenden Begriffe: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Produzieren - bedeutet, Nachrichten zu senden, Produzent (Lieferant) - derjenige, der Nachrichten sendet. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/093/98a/3af/09398a3afdf46d8e58c6c2f253037017.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konsumieren - bedeutet, Nachrichten zu empfangen. </font><font style="vertical-align: inherit;">Verbraucher - derjenige, der Nachrichten empfängt. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/918/3b0/d5e/9183b0d5e55eccdd919dee359a50d776.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Warteschlange ist die Warteschlange. </font><font style="vertical-align: inherit;">Vor dem Erreichen des Verbrauchers und nach dem Senden durch den Lieferanten wird die Nachricht in einer Warteschlange in RabbitMQ gespeichert. </font><font style="vertical-align: inherit;">Die Warteschlange ist ein Puffer, in dem Nachrichten gespeichert werden. </font><font style="vertical-align: inherit;">Viele Anbieter können Nachrichten in einer Warteschlange senden, und viele Verbraucher können Nachrichten aus einer Warteschlange lesen. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9d5/99c/8b9/9d599c8b96684a7a58e2aec05e6416b4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass sich Anbieter, Verbraucher und Broker nicht auf demselben Host befinden müssen, sondern sich normalerweise auf einem anderen Host befinden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Welt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Später in diesem Artikel werden wir zwei Programme in PHP unter Verwendung der MonsterMQ-Bibliothek schreiben, von denen eines Nachrichten sendet und das andere sie empfängt und an die Konsole ausgibt. </font><font style="vertical-align: inherit;">In der folgenden Abbildung ist "P" der Anbieter, "C" der Verbraucher, rote Kästchen die Warteschlange, die den Nachrichtenpuffer darstellt (jedes Kästchen ist die Nachricht). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2d8/ca1/fc0/2d8ca1fc0dce6c0c23e4524148027680.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Bild von der offiziellen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ-Website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Für weitere Arbeiten müssen wir MonsterMQ installieren. Geben Sie dazu den folgenden Befehl in die Konsole ein:</font></font><br>
<br>
<pre><code class="bash hljs">composer require goootlib/monster-mq:dev-master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Weitere Informationen zur Installation von MonsterMQ finden Sie auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Projektseite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf github.com.) Mit </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
diesem Befehl wird MonsterMQ im aktuellen Ordner installiert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abfahrt</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden unseren Absender </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php anrufen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und den Empfänger </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Der Absender tritt dem Server bei und sendet die Nachricht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dem Server beizutreten, schreiben Sie den folgenden Code in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Code verbinden wir RabbitMQ, das auf einem lokalen Server an einem Standardport ausgeführt wird. </font><font style="vertical-align: inherit;">Geben Sie eine andere IP-Adresse und einen anderen Port an, wenn RabbitMQ auf Ihrer anderen Adresse ausgeführt wird. </font><font style="vertical-align: inherit;">Nach der Verbindung rufen wir auch die Methode logIn () auf, die die Sitzung mit dem Standard-Login und -Kennwort startet. </font><font style="vertical-align: inherit;">Wenn Sie ein Konto mit einem anderen Benutzernamen und Kennwort in RabbitMQ konfiguriert haben, geben Sie diese hier an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine Nachricht zu senden, müssen wir die Warteschlange deklarieren, in die sie zuerst gestellt wird. </font><font style="vertical-align: inherit;">Nachdem die Warteschlange angekündigt wurde, können wir eine Nachricht senden:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $producer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
   $producer-&gt;publish(<span class="hljs-string">'my-message'</span>, <span class="hljs-string">'test-queue'</span>);<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Warteschlangendeklaration ist idempotent, dh sie erstellt die Warteschlange nicht und ändert sie nicht, wenn sie bereits vorhanden ist. </font><font style="vertical-align: inherit;">Nachdem wir die Sitzung abgeschlossen haben und beitreten.</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $producer = \MonsterMQ\Client\Producer();<font></font>
<font></font>
   $producer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $producer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $producer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
   $producer-&gt;publish(<span class="hljs-string">'Test message'</span>, <span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   $producer-&gt;disconnect();<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erhalte Nachricht</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Gegensatz zum Absender bleibt der Empfänger weiterhin aktiv, um eingehende Nachrichten abzuhören. </font><font style="vertical-align: inherit;">Im </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Receive.php-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code müssen </font><b><font style="vertical-align: inherit;">Sie</font></b><font style="vertical-align: inherit;"> zuerst dasselbe tun wie in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $consumer = \MonsterMQ\Client\Consumer();<font></font>
<font></font>
   $consumer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $consumer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass </font><font style="vertical-align: inherit;">wir </font><font style="vertical-align: inherit;">in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receive.php</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auch unsere Warteschlange deklarieren. Dies bedeutet, dass der Empfänger die Warteschlange deklariert, wenn sie vor dem Absender gestartet wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dem Server mitzuteilen, dass wir eine Nachricht von ihm empfangen möchten, und um einen Zyklus zu starten, der wartet und eingehende Nachrichten verarbeitet, schreiben wir den folgenden Code:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">try</span> {<font></font>
   $consumer = \MonsterMQ\Client\Consumer();<font></font>
<font></font>
   $consumer-&gt;connect(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-number">5672</span>);<font></font>
   $consumer-&gt;logIn(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'guest'</span>);<font></font>
<font></font>
   $consumer-&gt;queue(<span class="hljs-string">'test-queue'</span>)-&gt;declare();<font></font>
<font></font>
   $consumer-&gt;consume(<span class="hljs-string">'test-queue'</span>);<font></font>
<font></font>
   $consumer-&gt;wait(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$message, $channelNumber</span>) <span class="hljs-title">use</span> (<span class="hljs-params">$consumer</span>)</span>{
      <span class="hljs-keyword">echo</span> <span class="hljs-string">"Message - {$message} received on channel {$channelNumber}"</span>;<font></font>
   });<font></font>
} <span class="hljs-keyword">catch</span>(\<span class="hljs-built_in">Exception</span> $e) {<font></font>
   var_dump($e);<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir beide Skripte als Empfänger ausführen:</font></font><br>
<br>
<pre><code class="bash hljs">php receive.php</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
also Absender:</font></font><br>
<br>
<pre><code class="bash hljs">php send.php</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Empfänger gibt die Nachricht, die er von RabbitMQ (das wiederum von send.php erhält) und die verwendete Kanalnummer an die Konsole aus. </font><font style="vertical-align: inherit;">Es wird so lange ausgeführt, bis Sie das Terminal schließen oder die Ausführung durch Drücken von Strg + C beenden. </font><font style="vertical-align: inherit;">Durch Starten des Absenders in einem anderen Terminal können Sie beobachten, wie Nachrichten an den Empfänger übermittelt und in der Konsole angezeigt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie sehen möchten, welche RabbitMQ im Moment Warteschlangen enthält und wie viele Nachrichten sich darin befinden, können Sie dies als privilegierter Benutzer mit </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rabbitmqctl tun</font></font></b><br>
<pre><code class="bash hljs">sudo rabbitmqctl list_queues</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verwenden Sie unter Windows kein Sudo</font></font><br>
<pre><code class="bash hljs">rabbitmqctl.bat list_queues</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt sind wir bereit, mit dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nächsten Teil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unseres Unterrichts fortzufahren.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488836/index.html">Einige Aspekte der Arbeit mit Dictionary bei der Entwicklung geladener Anwendungen</a></li>
<li><a href="../de488842/index.html">Fangen Sie ein Elektron: Beobachten Sie einen Prozess, der eine Quintillionstelsekunde dauert</a></li>
<li><a href="../de488844/index.html">Grenzen für Grenzschutzbeamte: Das US-Gericht hat Regeln für die Überprüfung von Geräten festgelegt - diskutieren Sie die Situation</a></li>
<li><a href="../de488846/index.html">Postgresso 19</a></li>
<li><a href="../de488848/index.html">CTO alle starten</a></li>
<li><a href="../de488852/index.html">Konfigurieren der Verlustfunktion für ein neuronales Netzwerk basierend auf seismischen Daten</a></li>
<li><a href="../de488854/index.html">10. Fortinet Erste Schritte v6.0. Begleiten</a></li>
<li><a href="../de488856/index.html">Gut CRM und CRM. Alles ist einfacher als Sie denken.</a></li>
<li><a href="../de488860/index.html">Importsubstitution und Schiffbau</a></li>
<li><a href="../de488866/index.html">Überprüfen von Bildern mit Gitlab CI / CD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>