<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò± üßöüèΩ üôÜüèΩ Parsing a movie theater site on Golang üê¨ ü§û üö£üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone, in this article we will look at a small sample code written to collect data from a site in the popular programming language Go today. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Parsing a movie theater site on Golang</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493088/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello everyone, in this article we will look at a small sample code written to collect data from a site in the popular programming language Go today. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article will be especially interesting to those who have heard a lot about Go, but have not yet tried it on their own. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For one of the internal projects, we needed to collect data about the films that are being rented and the schedule of shows, now we will consider the first (simplest) version of the parser, with which it all started.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For those who are too lazy to read the article code, I immediately provide a link to the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In its first version, the parser was able to collect only the following information:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About sessions in one cinema,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detailed description,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Title,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Studio,</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And save it in JSON. Initially, you need to select the appropriate library for parsing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google gives a large number of options for the query `golang web scraping`, many of them are reflected in this </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">list</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , I advise you to familiarize yourself with it, I chose </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geziyor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , as it supports JS Rendering (which, by the way, we will not use in this example, however, this feature is very useful when parsing sites) and is quite simple to use. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the library is selected, the next step is to install it and start using it in the code. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installing the library is extremely simple:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> get -u github.com/geziyor/geziyor</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's move on to writing code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside the body of the main function, we call the parser, give it the URL of the page from which we will start collecting data and indicate that we want to export the result to a JSON file:</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> { <font></font>
    geziyor.NewGeziyor(&amp;geziyor.Options{ <font></font>
        StartURLs: []<span class="hljs-keyword">string</span>{<span class="hljs-string">"https://kinoteatr.ru/raspisanie-kinoteatrov/city/#"</span>}, <font></font>
        ParseFunc: parseMovies, <font></font>
        Exporters: []export.Exporter{&amp;export.JSON{}}, <font></font>
    }).Start() <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A start has been made, but there is not enough logic for collecting data, for this we need to implement the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parseMovies</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The collection logic will be as follows:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search for a block containing movie information,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collection of information about all sessions inside this block,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collection of the name of the film and film studio,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gathering a link to a page with detailed information about the film,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collection of descriptions from this page</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's move on to the implementation of this function.</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here, all blocks containing information about the film are selected for further processing.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">parseMovies</span><span class="hljs-params">(g *geziyor.Geziyor, r *client.Response)</span></span> {<font></font>
    r.HTMLDoc.Find(<span class="hljs-string">"div.shedule_movie"</span>).Each(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>, s *goquery.Selection)</span></span> { </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this way, information about the sessions is collected, and then it is brought into a convenient form for a person (we remove extra spaces and indents on a new line).</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-keyword">var</span> sessions = strings.Split(s.Find(<span class="hljs-string">".shedule_session_time"</span>).Text(), <span class="hljs-string">" \n "</span>) <font></font>
sessions = sessions[:<span class="hljs-built_in">len</span>(sessions)<span class="hljs-number">-1</span>] <font></font>
<font></font>
<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">len</span>(sessions); i++ { <font></font>
    sessions[i] = strings.Trim(sessions[i], <span class="hljs-string">"\n "</span>) <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This block of code is responsible for obtaining a page with detailed information about the film and obtaining its description.</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-keyword">if</span> href, ok := s.Find(<span class="hljs-string">"a.gtm-ec-list-item-movie"</span>).Attr(<span class="hljs-string">"href"</span>); ok {<font></font>
    g.Get(r.JoinURL(href), <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(_g *geziyor.Geziyor, _r *client.Response)</span></span> {<font></font>
        description = _r.HTMLDoc.Find(<span class="hljs-string">"span.announce p.movie_card_description_inform"</span>).Text() <font></font>
        description = strings.ReplaceAll(description, <span class="hljs-string">"\t"</span>, <span class="hljs-string">""</span>) <font></font>
        description = strings.ReplaceAll(description, <span class="hljs-string">"\n"</span>, <span class="hljs-string">""</span>) <font></font>
        description = strings.TrimSpace(description) <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This calls the API to export the results to a JSON file.</font></font><br>
<br>
<pre><code class="go hljs">
g.Exports &lt;- <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}{ 
    <span class="hljs-string">"title"</span>:        strings.TrimSpace(s.Find(<span class="hljs-string">"span.movie_card_header.title"</span>).Text()), 
    <span class="hljs-string">"subtitle"</span>:    strings.TrimSpace(s.Find(<span class="hljs-string">"span.sub_title.shedule_movie_text"</span>).Text()), 
    <span class="hljs-string">"sessions"</span>:    sessions, 
    <span class="hljs-string">"description"</span>: description, <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hooray, you're done! </font><font style="vertical-align: inherit;">It remains only to combine the written blocks of code together and start parsing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is how the parser works, we see messages on the successful receipt of pages in the terminal, this is convenient. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/ee/zo/abeezot2smu6-n26c31884sg5tg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And this is how the result of parsing looks. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/qy/3v/0fqy3vtnnv727n5xbjy-jju9zh4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks for reading the article, love programming on Go.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493076/index.html">How to quickly transfer a company to remote work: a free online conference of Netology and TalentTech</a></li>
<li><a href="../en493078/index.html">Top 5 Books to Read by a Manager</a></li>
<li><a href="../en493082/index.html">How Traffic Analysis Systems Detect MITER ATT & CK Hacker Tactics Using PT Network Attack Discovery</a></li>
<li><a href="../en493084/index.html">Writing a business process in Bitrix24 with a deposit for the future</a></li>
<li><a href="../en493086/index.html">Kulhacker. Start</a></li>
<li><a href="../en493090/index.html">Meet NestJS</a></li>
<li><a href="../en493094/index.html">Amazon warehouse workers sound alarm over coronavirus spread</a></li>
<li><a href="../en493096/index.html">Add a dark theme in iOS</a></li>
<li><a href="../en493098/index.html">Deploy ASA VPN Load-Balancing Cluster</a></li>
<li><a href="../en493100/index.html">How finding easy ways helps startups achieve aggressive growth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>