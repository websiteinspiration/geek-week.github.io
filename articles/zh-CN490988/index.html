<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜† â˜ï¸ ğŸ© æˆ‘ä»¬ç ”ç©¶å¤šæ’­RxJSè¿ç®—ç¬¦ ğŸ” ğŸ˜„ ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘©ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼æˆ‘å‘æ‚¨å‘ˆç°Netanel Basal æ’°å†™çš„æ–‡ç« â€œ Understanding RxJS Multicast Operatorsâ€çš„ç¿»è¯‘ã€‚
 
 å¹¿æ’­æˆ–å¤šæ’­è¿ç®—ç¬¦é€šå¸¸ä¼¼ä¹æ˜¯å­¦ä¹ RxJSçš„æœ€éš¾çš„è¯é¢˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å°è¯•ä»¥ä¸€ç§æ˜“äºè®¿é—®çš„æ–¹å¼æ¥è§£é‡Šä¸€åˆ‡ã€‚
 
 æˆ‘ä»¬å°†è€ƒè™‘å¤šæ’­è¿è¥å•†çš„å†…éƒ¨ç»“æ„åŠå…¶è§£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬ç ”ç©¶å¤šæ’­RxJSè¿ç®—ç¬¦</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490988/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHaï¼</font><font style="vertical-align: inherit;">æˆ‘å‘æ‚¨å‘ˆç°</font><font style="vertical-align: inherit;">Netanel Basal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ’°å†™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æ–‡ç« </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">â€œ Understanding RxJS Multicast Operatorsâ€</font></a><font style="vertical-align: inherit;">çš„ç¿»è¯‘</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¿æ’­æˆ–å¤šæ’­è¿ç®—ç¬¦é€šå¸¸ä¼¼ä¹æ˜¯å­¦ä¹ RxJSçš„æœ€éš¾çš„è¯é¢˜ã€‚</font><font style="vertical-align: inherit;">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å°è¯•ä»¥ä¸€ç§æ˜“äºè®¿é—®çš„æ–¹å¼æ¥è§£é‡Šä¸€åˆ‡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†è€ƒè™‘å¤šæ’­è¿è¥å•†çš„å†…éƒ¨ç»“æ„åŠå…¶è§£å†³çš„ä»»åŠ¡ã€‚</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»æè¿°RxJSçš„åŸºæœ¬æ„å»ºå—å¼€å§‹ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯è§‚å¯Ÿçš„</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨RxJSä¸­ï¼Œå¯è§‚å¯Ÿå¯¹è±¡ï¼ˆä»¥ä¸‹ç§°ä¸ºâ€œæµâ€ï¼‰æœ€åˆæ˜¯å†·çš„ã€‚è¿™æ„å‘³ç€æ¯æ¬¡æ‚¨è®¢é˜…æµæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œè®¢é˜…çš„å›è°ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œè¯·åˆ›å»ºä»¥ä¸‹å®ç°ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Observable</span> </span>{
  <span class="hljs-keyword">constructor</span>(subscriptionFn) {
    <span class="hljs-keyword">this</span>.subscriptionFn = subscriptionFn;<font></font>
  }<font></font>
<font></font>
  subscribe(observer) {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.subscriptionFn(observer);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ„é€ å‡½æ•°</font></font><code>Observable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å—ä¸€ä¸ªå‚æ•°-è®¢é˜…çš„å›è°ƒ</font></font><br>
 <code>subscriptionFn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ¯æ¬¡æˆ‘ä»¬è®¢é˜…æµï¼ˆ</font></font><code>subscribe()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰</font><font style="vertical-align: inherit;">éƒ½ä¼šè°ƒç”¨å®ƒ</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰æ—¶ä»–ä»¬ä¼šè°ƒç”¨è®¢é˜…çš„å›è°ƒ</font></font><code>producer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› ä¸ºå®ƒè¿˜ä¼šä¸ºè®¢é˜…è€…ï¼ˆæˆ‘ä»¬ä»£ç ä¸­çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼‰``äº§ç”Ÿ''å€¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•</font></font><code>subscribe()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥å—è¾“å…¥</font></font><code>observer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å®ƒæ˜¯ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•çš„å¯¹è±¡ï¼š</font></font><code>next(), error(), complete()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚åœ¨å®æ—¶RxJSä¸­ï¼Œæ‚¨å¯ä»¥ä¼ é€’ä¸‰ä¸ªå‡½æ•°è€Œä¸æ˜¯å¯¹è±¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•</font></font><code>subscribe()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è°ƒç”¨æ—¶ä¼šè°ƒç”¨è®¢é˜…å‡½æ•°ï¼Œå°†å…¶ä¼ é€’ç»™input </font></font><code>observer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç°åœ¨æ²¡æœ‰æåˆ°è¯¥æ–¹æ³•</font></font><code>unsubscribe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†è¯·è®°ä½ï¼Œæ¯ä¸ªè®¢é˜…éƒ½æä¾›äº†ä¸€ç§é”€æ¯å®ƒçš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">é€šå¸¸ï¼Œè®¢é˜…è¿”å›ä¸€ä¸ªå‡½æ•°ï¼ˆæˆ–å…·æœ‰é€‚å½“æ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒæµåŠå…¶è®¢é˜…è€…ä¹‹é—´çš„è¿æ¥è¢«ç ´åã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸€åˆ‡éƒ½éå¸¸ç®€å•ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨è®©æˆ‘ä»¬æ›´æ¥è¿‘ç°å®ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå°†æœ¬æœºXHR APIåŒ…è£…åœ¨æµä¸­</font></font><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">http</span>(<span class="hljs-params">url</span>) </span>{
  <span class="hljs-comment">// This function will be called when we call http().subscribe()</span>
  <span class="hljs-keyword">const</span> subscriptionFn = <span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> {<font></font>
    log(<span class="hljs-string">'Observable execution: http'</span>);
    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();<font></font>
    xhr.addEventListener(<span class="hljs-string">'load'</span>, () =&gt; {
      <span class="hljs-keyword">if</span> (xhr.readyState === <span class="hljs-number">4</span> &amp;&amp; xhr.status === <span class="hljs-number">200</span>) {<font></font>
        observer.next(<span class="hljs-built_in">JSON</span>.parse(xhr.responseText));<font></font>
        observer.complete();<font></font>
      }<font></font>
    });<font></font>
    xhr.open(<span class="hljs-string">'GET'</span>, url);<font></font>
    xhr.send();<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> xhr.abort()<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Observable(subscriptionFn);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå‡½æ•°</font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">è¯¥å‡½æ•°</font><font style="vertical-align: inherit;">æ¥æ”¶URLï¼Œæ‰§è¡Œhttpè¯·æ±‚å¹¶è¿”å›å‘å‡ºæ¥æ”¶åˆ°çš„httpå“åº”çš„æµã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œçœ‹çœ‹æˆ‘ä»¬çš„å®ç°ï¼Œå½“æˆ‘ä»¬ä¸¤æ¬¡è®¢é˜…æ­¤æµæ—¶ï¼Œæ‚¨è®¤ä¸ºä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</font></font><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-comment">// A small observer helper</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> ({<font></font>
  next(value) {<font></font>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${tag}</span>:`</span>, value);<font></font>
  }<font></font>
});<font></font>
<font></font>
http(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)<font></font>
  .subscribe(observer(<span class="hljs-string">'subscriber-1'</span>));<font></font>
<font></font>
http(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)<font></font>
  .subscribe(observer(<span class="hljs-string">'subscriber-2'</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­£ç¡®åœ°ï¼Œå°†æ‰§è¡Œä¸¤ä¸ªhttpè¯·æ±‚ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬å†çœ‹ä¸€ä¸‹Observableç±»çš„å®ç°ï¼Œæˆ‘ä»¬å°†æ˜ç™½ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªè®¢é˜…è€…éƒ½è°ƒç”¨ä¸€ä¸ªè®¢é˜…å›è°ƒï¼Œè¯¥å›è°ƒåˆæ¯æ¬¡éƒ½æ‰§è¡Œä¸€ä¸ªhttpè¯·æ±‚ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ay/by/ee/aybyeesbyfdzvcjcp3etc8jhfww.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»è¥è€…</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿ç®—ç¬¦æ˜¯å°†æµä½œä¸ºè¾“å…¥ï¼Œæ‰§è¡Œä»»ä½•æ“ä½œå¹¶è¿”å›æµçš„å‡½æ•°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„ç¬¬ä¸€ä¸ªè¿ç®—ç¬¦ã€‚</font></font><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span>(<span class="hljs-params">fn</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">source</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Observable(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> {<font></font>
      log(<span class="hljs-string">'Observable execution: map'</span>);
      <span class="hljs-keyword">return</span> source.subscribe({<font></font>
        next(value) {<font></font>
          observer.next(fn(value));<font></font>
        }<font></font>
      });<font></font>
    });<font></font>
  };<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥å‡½æ•°</font></font><code>map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›ä¸€ä¸ªæ¥å—åŸå§‹æµçš„è¿ç®—ç¬¦ï¼Œå¹¶è¿”å›å…¶ä¸­æ‰€æœ‰ä¼ é€’å€¼éƒ½å°†é€šè¿‡è¯¥å‡½æ•°ä¼ é€’çš„æµ</font></font><code>fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£äº›ã€‚</font><font style="vertical-align: inherit;">åœ¨å…¶ä¸­å§‹ç»ˆæœ‰å¯¹è¾“å…¥æµçš„è®¢é˜…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä½¿ç”¨æ­¤æ–°è¿ç®—ç¬¦ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å°†å…¶é™„åŠ åˆ°æµä¸­ã€‚</font><font style="vertical-align: inherit;">æ‰©å±•æˆ‘ä»¬ç­</font></font><code>Observable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±</font></font><code>pipe()</code><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Observable</span> </span>{
  <span class="hljs-keyword">constructor</span>(subscriptionFn) {
    <span class="hljs-keyword">this</span>.subscriptionFn = subscriptionFn;<font></font>
  }<font></font>
<font></font>
  subscribe(observer) {<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.subscriptionFn(observer);<font></font>
  }<font></font>
<font></font>
  pipe(...operators) {<font></font>
    <span class="hljs-keyword">return</span> operators.reduce(<span class="hljs-function">(<span class="hljs-params">source, next</span>) =&gt;</span> next(source), <span class="hljs-keyword">this</span>);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€ä¸€è¡Œä»£ç ã€‚</font></font><code>pipe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒéœ€è¦ä¸€ç»„è¿ç®—ç¬¦å¹¶ä¾æ¬¡è°ƒç”¨å®ƒä»¬ï¼Œå¹¶å°†æ¯ä¸ªè¾“å…¥çš„ç»“æœä¼ é€’ç»™å‰ä¸€ä¸ªç»“æœã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„è¿ç®—ç¬¦ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">http(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)<font></font>
  .pipe(map(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res[<span class="hljs-number">0</span>]))<font></font>
  .subscribe(observer(<span class="hljs-string">'subscriber'</span>));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è°ƒç”¨æ—¶</font></font><code>subscribe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå°†æ‰§è¡Œå¯¹è¾“å‡ºæµ</font><font style="vertical-align: inherit;">çš„è®¢é˜…</font></font><code>map()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶å</font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå°†åœ¨</font><font style="vertical-align: inherit;">å†…éƒ¨</font><font style="vertical-align: inherit;">æ‰§è¡Œå¯¹åŸå§‹æµçš„è®¢é˜…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
httpæµå‘å‡ºå…¶æ‰€å±çš„å€¼</font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç„¶åï¼Œæ‰§è¡Œè¯¥å‡½æ•°</font></font><code>fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæµä»</font></font><code>map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘å‡ºå€¼åˆ°æœ€ç»ˆè®¢é˜…ã€‚</font><font style="vertical-align: inherit;">å®ƒåƒ</font></font><code>observable chain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¿ç¨‹é“¾ä¸€æ ·å·¥ä½œã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4a/ou/8r/4aou8rffl-aqkm6asdvs2224n84.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæˆ‘ä»¬ä¸¤æ¬¡è®¢é˜…ä¸€ä¸ªé“¾ï¼Œåˆ™è¯¥é“¾ä¸­çš„æ¯ä¸ªè®¢é˜…éƒ½ä¼šè¢«è°ƒç”¨ä¸¤æ¬¡ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> firstUser$ = http(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)<font></font>
    .pipe(map(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res[<span class="hljs-number">0</span>]));<font></font>
<font></font>
firstUser$.subscribe(observer(<span class="hljs-string">'subscriber-1'</span>));<font></font>
firstUser$.subscribe(observer(<span class="hljs-string">'subscriber-2'</span>));
</code></pre><br>
<img src="https://habrastorage.org/webt/kg/c2/iw/kgc2iwjualmgnqh_kcaxfe4c45g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœè¿™ç§è¡Œä¸ºä¸é€‚åˆæˆ‘ä»¬ï¼Ÿ</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬åªæƒ³è°ƒç”¨ä¸€æ¬¡è®¢é˜…åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ‹¥æœ‰å¤šå°‘ä¸ªè®¢é˜…ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦å‘å‡ºä¸€ä¸ªhttpè¯·æ±‚å¹¶å°†ç»“æœç”¨äºæ‰€æœ‰è®¢é˜…è€…ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</font><font style="vertical-align: inherit;">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§‘ç›®</font></font></h2><br>
<code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒæ—¢æ˜¯æµåˆæ˜¯è®¢æˆ·ã€‚</font><font style="vertical-align: inherit;">æµ-å› ä¸ºå®ƒæœ‰ä¸€ä¸ªæ–¹æ³•</font></font><code>subscribe()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè®¢æˆ·-å› ä¸ºå®ƒå®ç°äº†è®¢æˆ·æ¥å£-æ–¹æ³•</font></font><code>next(), error(), complete().</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬æ¥ç¼–å†™å®ƒã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Subject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Observable</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>();
    <span class="hljs-keyword">this</span>.observers = [];<font></font>
  }<font></font>
<font></font>
  subscribe(observer) {<font></font>
    <span class="hljs-keyword">this</span>.observers.push(observer);<font></font>
  }<font></font>
<font></font>
  next(value) {<font></font>
    <span class="hljs-keyword">this</span>.observers.forEach(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> observer.next(value));<font></font>
  }<font></font>
<font></font>
  error(error) {<font></font>
    <span class="hljs-keyword">this</span>.observers.forEach(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> observer.error(error));<font></font>
  }<font></font>
<font></font>
  complete() {<font></font>
    <span class="hljs-keyword">this</span>.observers.forEach(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> observer.complete());<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
<code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¯ä»¥å……å½“å†·æµå’Œè®¸å¤šè®¢æˆ·ä¹‹é—´çš„ä¸­ä»‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ›´æ”¹æˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> subject = <span class="hljs-keyword">new</span> Subject();<font></font>
subject.subscribe(observer(<span class="hljs-string">'subscriber1'</span>));<font></font>
subject.subscribe(observer(<span class="hljs-string">'subscriber2'</span>));<font></font>
<font></font>
http(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)<font></font>
  .pipe(map(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res[<span class="hljs-number">0</span>]))<font></font>
  .subscribe(subject);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è°ƒç”¨æ—¶</font></font><code>subject.subscribe(someFn)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»…æ‰§è¡Œä¸€ä¸ªç®€å•çš„æ“ä½œ-å‘æ•°ç»„æ·»åŠ ä¸€ä¸ª</font></font><code>subject.observers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font></font><code>someFn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‚£ä¹ˆï¼Œæ—¢ç„¶å®ƒä¹Ÿ</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å……å½“è®¢é˜…è€…ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°†å…¶è®¢é˜…åˆ°åŸå§‹æµï¼Œå³ </font><font style="vertical-align: inherit;">å½“åŸå§‹çº¿ç¨‹å‘å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒå°†è¢«è°ƒç”¨</font></font><code>subject.next()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¿™éœ€è¦å°†è¯¥å€¼ä¼ è¾“åˆ°æ¯ä¸ªè®¢æˆ·</font></font><code>subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬å·²ç»æ‰§è¡Œäº†è®¢é˜…çš„åŸå§‹å›è°ƒä¸€æ¬¡ï¼Œå¹¶ä¸”åªä¼šæ‰§è¡Œä¸€ä¸ªhttpè¯·æ±‚ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hk/8h/ld/hk8hld-xyjtum5d3srqpquhaqic.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ´¾å¯¹æ™šå®´è€…</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœåŸå§‹æµåœ¨æˆ‘ä»¬æ³¨å†Œä¹‹å‰å·²ç»èµ·ä½œç”¨äº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­å°†æ— æ³•æ˜¾ç¤ºæ­¤å†…å®¹ï¼Œå› ä¸ºhttpæ˜¯å¼‚æ­¥çš„ï¼Œå³ä½¿æ‚¨åœ¨ç´§éšå…¶åè¿›è¡Œé¢„è®¢ï¼Œè¯¥å€¼ä»å°†åœ¨é¢„è®¢ä¹‹åå‡ºç°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºä¸€ä¸ªç”Ÿæˆå‡½æ•°</font></font><code>of</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">of</span>(<span class="hljs-params">...values</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Observable(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> {<font></font>
    log(<span class="hljs-string">'Observable execution: of'</span>);<font></font>
    values.forEach(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> observer.next(value));<font></font>
  });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡æ‰‹æ®µåˆ›å»ºçš„æµ</font></font><code>of()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘å‡ºå€¼ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬</font></font><code>subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·²ç»è®¢é˜…äº†ï¼Œ</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†</font><font style="vertical-align: inherit;">å¯¹å…¶è¿›è¡Œè®¢é˜…ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> subject = <span class="hljs-keyword">new</span> Subject();
<span class="hljs-keyword">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).subscribe(subject);<font></font>
<font></font>
subject.subscribe(observer(<span class="hljs-string">'subscriber1'</span>));<font></font>
subject.subscribe(observer(<span class="hljs-string">'subscriber2'</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çš„è®¢æˆ·æ²¡æœ‰æ”¶åˆ°ä»»ä½•ä¸œè¥¿ã€‚ä¸ºä»€ä¹ˆï¼Ÿæˆ‘ä»¬çš„å®ç°ä¸æ”¯æŒâ€œåæœŸâ€è®¢é˜…è€…ã€‚å½“åŸå§‹æµä»ä¸­</font></font><code>of()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘å‡ºå€¼æ—¶ï¼Œå°šæœªæ³¨å†Œè®¢é˜…è€…ï¼Œè¿™äº›å€¼å°†æ— å¤„å¯å¯»ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨Angularä¸Šçš„å®é™…ç¤ºä¾‹ä¸­ï¼Œå¾ˆå¯èƒ½æ˜¯æºæµèµ·ä½œç”¨äº†ï¼Œä½†æ˜¯é¡µé¢ä¸Šè¿˜æ²¡æœ‰ç»„ä»¶ã€‚å¹¶ä¸”å½“ç»„ä»¶å‡ºç°æ—¶ï¼Œå®ƒè®¢é˜…æºï¼Œä½†ä¸æ¥æ”¶å·²ç»ä¼ é€’çš„å€¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è§£å†³é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯è¿™æ ·</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æˆ‘ä»¬æ¦‚è¿°å…¶ç‰ˆæœ¬ï¼Œå¹¶æŸ¥çœ‹å…¶å·¥ä½œæ–¹å¼ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReplaySubject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Subject</span> </span>{
  <span class="hljs-keyword">constructor</span>(bufferSize) {
    <span class="hljs-keyword">super</span>();
    <span class="hljs-keyword">this</span>.observers = [];
    <span class="hljs-keyword">this</span>.bufferSize = bufferSize;
    <span class="hljs-keyword">this</span>.buffer = [];<font></font>
  }<font></font>
<font></font>
  subscribe(observer) {<font></font>
    <span class="hljs-keyword">this</span>.buffer.forEach(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> observer.next(val));
    <span class="hljs-keyword">this</span>.observers.push(observer);<font></font>
  }<font></font>
<font></font>
  next(value) {<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.buffer.length === <span class="hljs-keyword">this</span>.bufferSize) {
      <span class="hljs-keyword">this</span>.buffer.shift();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.buffer.push(value);
    <span class="hljs-keyword">this</span>.observers.forEach(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> observer.next(value));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸ªæ¦‚å¿µå¾ˆç®€å•ã€‚é¡¾åæ€ä¹‰ï¼Œ</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠŸèƒ½</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¯ä»¥ä¸ºæ‰€æœ‰æ–°è®¢æˆ·é‡ç°æ—§å€¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¯ä¸ªé‡Šæ”¾çš„å€¼å°†è¢«è½¬ç§»åˆ°æ‰€æœ‰å½“å‰çš„è®¢æˆ·ï¼Œå¹¶ä¿å­˜ä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼Œç¼“å†²åŒºå¤§å°</font></font><code>bufferSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨é‡å†™å‰é¢çš„ç¤ºä¾‹</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> subject = <span class="hljs-keyword">new</span> ReplaySubject(<span class="hljs-number">3</span>);
<span class="hljs-keyword">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).subscribe(subject);<font></font>
<font></font>
subject.subscribe(observer(<span class="hljs-string">'subscriber1'</span>));<font></font>
subject.subscribe(observer(<span class="hljs-string">'subscriber2'</span>));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœå·²æ›´æ”¹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡è®¢é˜…è¾ƒæ™šï¼Œä½†æˆ‘ä»¬éƒ½æŠ“ä½äº†ä»–ä»¬ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sg/xv/y1/sgxvy1flevy8totuzlejeiphvm0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ€»è€Œè¨€ä¹‹ï¼Œç›®çš„</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å°†ä»·å€¼åˆ†é…ç»™æ‰€æœ‰è®¢æˆ·å¹¶å°†å…¶ç¼“å­˜ç»™å°†æ¥çš„``åæœŸ''è®¢æˆ·ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç»§ç»­ä¹‹å‰ï¼Œå»ºè®®æ‚¨å°è¯•ç¼–å†™è‡ªå·±çš„å®ç°</font></font><code>BehaviorSubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åœ¨æ–‡ç« æœ«å°¾æ‰¾åˆ°å®Œæˆçš„ä»£ç ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬ç»ˆäºè½¬åˆ°å¤šæ’­è¿ç®—ç¬¦ã€‚</font><font style="vertical-align: inherit;">å¸Œæœ›ä»¥ä¸Šç¤ºä¾‹å¯ä»¥å¸®åŠ©æ‚¨æ›´å¿«åœ°ç†è§£å®ƒä»¬ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»„æ’­è¿è¥å•†</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»„æ’­å’Œè¿æ¥</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿è¥å•†</font></font><code>multicast() </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äº</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†æºæµå‘å¸ƒç»™å¤šä¸ªè®¢æˆ·ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">
<span class="hljs-keyword">import</span> { interval, Subject, ConnectableObservable } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">import</span> { multicast } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> connectableObservable = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  multicast(<span class="hljs-keyword">new</span> Subject())<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">const</span> observer1 = connectableObservable.subscribe(log);
<span class="hljs-keyword">const</span> observer2 = connectableObservable.subscribe(log);<font></font>
<font></font>
<span class="hljs-keyword">const</span> connectableSubscription = (connectableObservable <span class="hljs-keyword">as</span> ConnectableObservable&lt;any&gt;)<font></font>
  .connect();<font></font>
</code></pre><br>
<code>multicast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿”å›</font></font><code>ConnectableObservable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰æ–¹æ³•</font><font style="vertical-align: inherit;">çš„å¯¹è±¡</font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å…¶ç›®çš„æ˜¯ä¸ºæ¥æ”¶åˆ°çš„ä¸»é¢˜è®¢é˜…æºæµã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥æ–¹æ³•</font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¡®å®šä½•æ—¶å¼€å§‹æ‰§è¡ŒåŸå§‹çº¿ç¨‹ã€‚</font><font style="vertical-align: inherit;">æœ‰ä¸ªæ—¶åˆ»éœ€è¦ç‰¢è®°-å–æ¶ˆè®¢é˜…æ‚¨éœ€è¦åšçš„æ¶ˆæ¯ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">connectableSubscription.unsubscribe();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä¸ä»…é™äºç®€å•</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç›¸åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ´¾ç”Ÿç±»ï¼Œä¾‹å¦‚</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { interval, ReplaySubject, ConnectableObservable } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">import</span> { multicast } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> connectableObservable = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  multicast(<span class="hljs-keyword">new</span> ReplaySubject(<span class="hljs-number">1</span>))<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">const</span> observer1 = connectableObservable.subscribe(log);<font></font>
<font></font>
setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// Late subscriber</span><font></font>
  connectableObservable.subscribe(log);<font></font>
}, <span class="hljs-number">3000</span>)<font></font>
<font></font>
<span class="hljs-keyword">const</span> connectable = (connectableObservable <span class="hljs-keyword">as</span> ConnectableObservable&lt;any&gt;).connect();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»æ­¤ä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥çŒœæµ‹å¹•åæƒ…å†µã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨æ—¶</font></font><code>multicast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä¼ é€’</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·¥å‚å‡½æ•°ï¼Œè¿˜</font><font style="vertical-align: inherit;">å¯ä»¥ä¼ é€’</font><font style="vertical-align: inherit;">å·¥å‚å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¯æ¬¡éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°å‡½æ•°</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡ç”¨å·²ç»å®Œæˆçš„</font></font><code>subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸èƒ½ï¼Œå·¥å‚åŠŸèƒ½è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  multicast(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">new</span> Subject())<font></font>
)<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¿»æ–°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æˆ‘ä»¬ä½¿ç”¨operatoræ—¶</font></font><code>multicast()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬è´Ÿè´£è°ƒç”¨</font></font><code>connect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å¼€å§‹æ‰§è¡ŒåŸå§‹çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œæˆ‘ä»¬ä»ç„¶å¿…é¡»ç›‘è§†å¯èƒ½çš„å†…å­˜æ³„æ¼ï¼Œå¹¶ä»ä¸­æ‰‹åŠ¨é€€è®¢</font></font><code>ConnectableSubscription</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æµç¨‹çš„è‡ªåŠ¨åŒ–å°†é¿å…é”™è¯¯å¹¶ç®€åŒ–ä»£ç ã€‚</font><font style="vertical-align: inherit;">å–„è‰¯çš„RxJSå¼€å‘äººå‘˜ä¸ºæˆ‘ä»¬è€ƒè™‘äº†è¿™ä¸€ç‚¹ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª</font></font><code>refCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿ç®—ç¬¦ã€‚</font></font><br>
<br>
<code>refCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¡ç®—è®¢é˜…æ•°ï¼Œå½“ç¬¬ä¸€ä¸ªå‡ºç°æ—¶ï¼Œå®ƒä¼šè°ƒç”¨</font></font><code>connect()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå³ </font><font style="vertical-align: inherit;">è®¢é˜…ã€‚</font><font style="vertical-align: inherit;">å½“å®ƒå‡å°‘å›é›¶æ—¶ï¼Œå°†è°ƒç”¨ä¸€ä¸ªå“åº”ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> source = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  multicast(<span class="hljs-keyword">new</span> Subject()),<font></font>
  refCount()<font></font>
)<font></font>
 <font></font>
<span class="hljs-comment">// refCount === 1 =&gt; source.subscribe();</span>
<span class="hljs-keyword">const</span> observer1 = source.subscribe(log);<font></font>
<font></font>
<span class="hljs-comment">// refCount === 2</span>
<span class="hljs-keyword">const</span> observer2 = source.subscribe(log);<font></font>
<font></font>
setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">// refCount - 1</span><font></font>
  observer1.unsubscribe();<font></font>
  <span class="hljs-comment">// refCount - 1</span><font></font>
  observer2.unsubscribe();<font></font>
  <span class="hljs-comment">// refCount === 0 =&gt; source.unsubcribe();</span>
}, <span class="hljs-number">3000</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯·æ³¨æ„ï¼Œåœ¨</font></font><code>refCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾—åˆ°é€šå¸¸çš„å¯è§‚å¯Ÿå€¼ä¹‹åï¼Œä¸æ˜¯</font></font><code>ConnectableObservable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘å¸ƒåŠå…¶é€‰é¡¹</font></font></h3><br>
<code>multicast() + Subject + refCount()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™åœ¨RxJSä¸­æ˜¯ç›¸å½“å…¸å‹çš„æƒ…å†µï¼Œå¼€å‘äººå‘˜å·²å°†å…¶ç®€åŒ–ä¸ºå•ä¸ªè¿ç®—ç¬¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬æœ‰å“ªäº›é€‰æ‹©ã€‚</font></font><br>
<br>
<ul>
<li><code>publish()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“é‡ </font></font><code>multicast(() =&gt; new Subject())</code><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> connectableObservable = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  publish()<font></font>
)<font></font>
<font></font>
connectableObservable.connect();<font></font>
</code></pre><br>
</li>
<li><code>publishBehavior()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“é‡ </font></font><code>multicast(new BehaviorSubject())</code><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> connectableObservable = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  publishBehavior(<span class="hljs-number">100</span>)<font></font>
)<font></font>
<font></font>
connectableObservable.connect();<font></font>
</code></pre><br>
</li>
<li><code>publishReplay()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“é‡ </font></font><code>multicast(() =&gt; new ReplaySubject(x))</code><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> connectableObservable = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  publishReplay(<span class="hljs-number">3</span>)<font></font>
)<font></font>
<font></font>
connectableObservable.connect();<font></font>
</code></pre><br>
</li>
<li><code>publishLast()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“é‡ </font></font><code>multicast(new AsyncSubject())</code><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> connectableObservable = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  take(<span class="hljs-number">2</span>),<font></font>
  publishLast()<font></font>
)<font></font>
<font></font>
connectableObservable.connect();<font></font>
</code></pre><br>
</li>
<li><code>share()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å½“é‡ </font></font><code>multicast(() =&gt; new Subject()) + refCount()</code><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> source = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  share()<font></font>
)<font></font>
</code></pre><br>
</li>
<li><code>shareReplay(bufferSize) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä½¿ç”¨çš„å¤šæ’­è¿ç®—ç¬¦</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»–æ²¡æœ‰å†…åœ¨</font></font><code>multicast()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä»–çš„ç»“æœæ˜¯å¯ä»¥è§‚å¯Ÿåˆ°çš„ï¼Œä¸æ˜¯</font></font><code>ConnectableObservable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯ä»¥ä½¿ç”¨å®ƒï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨</font></font><code>refCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸¤ä¸ªé€‰é¡¹ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  shareReplay({ <span class="hljs-attr">refCount</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">bufferSize</span>: <span class="hljs-number">1</span> })<font></font>
)<font></font>
<font></font>
interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  shareReplay(<span class="hljs-number">1</span>)<font></font>
)<font></font>
</code></pre></li>
</ul><br><font style="vertical-align: inherit;"></font><code>shareReplay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸</font></font><code>{ refCount: false }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¯</font><font style="vertical-align: inherit;">
æ—¶</font><font style="vertical-align: inherit;">å°±åƒåœ¨é€šè¯</font></font><code>shareReplay(x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä¸ä¼šè¿›è¡Œå¼•ç”¨è®¡æ•°ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€åœ¨åŸå§‹æµå®Œæˆä¹‹å‰ï¼Œ</font></font><code>shareReplay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†å¯¹å…¶è¿›è¡Œè®¢é˜…ï¼Œè€Œä¸ç®¡å…¶æœ¬èº«æ˜¯å¦å…·æœ‰æœ€ç»ˆè®¢é˜…è€…ã€‚</font><font style="vertical-align: inherit;">æ‰€æœ‰æ–°è®¢æˆ·å°†æ”¶åˆ°æœ€åxä¸ªå€¼ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shareReplay vs publishReplay + refCount</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹ä¸€çœ‹</font><font style="vertical-align: inherit;">ï¼Œå®ƒæ˜¯</font></font><code>shareReplay({ refCount: true, bufferSize: X })</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸åŒçš„</font></font><code>publishReplay(X) + refCount() </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½†è¿™å¹¶éå®Œå…¨æ­£ç¡®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬çœ‹çœ‹æœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„å’Œæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒä»¬å…·æœ‰ç›¸åŒçš„è¡Œä¸º</font></font><code>refCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-æ ¹æ®è®¢é˜…è€…çš„æ•°é‡è®¢é˜…å’Œå–æ¶ˆè®¢é˜…åŸå§‹æµã€‚</font><font style="vertical-align: inherit;">å½“åŸå§‹æµå®Œæˆæ—¶ï¼Œå®ƒä»¬çš„ååº”ä¹Ÿç›¸åŒ-æ‰€æœ‰æ–°è®¢æˆ·éƒ½æ”¶åˆ°Xä¸ªæœ€åä¸€ä¸ªå€¼ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œå¦‚æœåŸå§‹æµå°šæœªå®Œæˆï¼Œåˆ™åœ¨è¿™ç§æƒ…å†µä¸‹</font></font><code>publishReplay(X) + refCount()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-æ‰€æœ‰æ–°è®¢é˜…è€…éƒ½ä»ç¼“å†²åŒºæ¥æ”¶Xå€¼ï¼Œç„¶åå°†ä½¿ç”¨ç›¸åŒçš„å€¼é‡æ–°ç­¾å</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨</font></font><code>shareReplay({ refCount: true, bufferSize: 1 })</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åä¸€ä¸ªXå€¼ï¼Œåˆ™å®ƒä»¬å°†æ— æ³•è·å¾—å®ƒï¼Œå› ä¸ºåœ¨å®ƒçš„å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–°</font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼ï¼Œ</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶ä½¿ç”¨å®ƒæ¥é‡æ–°è®¢é˜…æºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¤ºä¾‹è¯´æ˜äº†è¿™ä¸€ç‚¹ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> source = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  publishReplay(<span class="hljs-number">1</span>),<font></font>
  refCount()<font></font>
);<font></font>
<font></font>
<span class="hljs-keyword">const</span> one = source.subscribe(observer(<span class="hljs-string">'subcriber-1'</span>));<font></font>
<font></font>
setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
  one.unsubscribe();<font></font>
 <font></font>
  <span class="hljs-comment">// This subscriber will get the last emitted values from the source</span>
  <span class="hljs-keyword">const</span> two = source.subscribe(observer(<span class="hljs-string">'subcriber-2'</span>));<font></font>
}, <span class="hljs-number">3000</span>);</code></pre><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> source = interval(<span class="hljs-number">1000</span>).pipe(<font></font>
  shareReplay({ <span class="hljs-attr">refCount</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">bufferSize</span>: <span class="hljs-number">1</span> })<font></font>
);<font></font>
<font></font>
<span class="hljs-keyword">const</span> one = source.subscribe(observer(<span class="hljs-string">'subcriber-1'</span>));<font></font>
<font></font>
setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
  one.unsubscribe();<font></font>
  <font></font>
  <span class="hljs-comment">// This subscriber will NOT get the last emitted values from the source</span>
  <span class="hljs-keyword">const</span> two = source.subscribe(observer(<span class="hljs-string">'subcriber-2'</span>));<font></font>
}, <span class="hljs-number">3000</span>);</code></pre><br>
<img src="https://habrastorage.org/webt/6i/j1/ih/6ij1ihusgtdo_avliuz4tk4gsca.png"><br>
<br>
<img src="https://habrastorage.org/webt/ew/nk/6q/ewnk6q0ems5ysw574aa7unvy2jc.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angularä¸­çš„å®é™…ç¤ºä¾‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨æˆ˜æ–—æ¡ä»¶ä¸‹ä½¿ç”¨ç ”ç©¶è¿‡çš„å¤šæ’­è¿è¥å•†ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨åˆ†äº«</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€è¦åŸå§‹æµä¸­çš„æ•°æ®çš„ç»„ä»¶ã€‚</font><font style="vertical-align: inherit;">å®ƒå¯ä»¥æ˜¯httpè¯·æ±‚ï¼ŒçŠ¶æ€æˆ–å…¶ä»–ä»»ä½•å†…å®¹ã€‚</font><font style="vertical-align: inherit;">è€Œä¸”æˆ‘ä»¬è¿˜éœ€è¦æ•°æ®å¤„ç†ï¼Œä¾‹å¦‚è¿‡æ»¤ï¼Œæ’åºç­‰ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;users-list [users]="allUsers$ | async"&gt;&lt;/users-list&gt;
  `</span>,<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersPageComponent</span> </span>{
  <span class="hljs-attr">allUsers$</span>: Observable&lt;User[]&gt;;<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(private http: HttpClient) {<font></font>
  }<font></font>
<font></font>
  ngOnInit() {<font></font>
    <span class="hljs-keyword">this</span>.allUsers$ = <span class="hljs-keyword">this</span>.http.get(<span class="hljs-string">'https://api/users'</span>).pipe(<font></font>
      map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> filter/sort),<font></font>
    );<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªä»…æ˜¾ç¤ºç¬¬ä¸€ä¸ªç”¨æˆ·çš„ç»„ä»¶ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æŒ‰åŸæ ·è®¢é˜…æºæµï¼Œé‚£ä¹ˆï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;user [user]="firstUser$ | async"&gt;&lt;/user&gt;
    &lt;users-list [users]="allUsers$ | async"&gt;&lt;/users-list&gt;
  `</span>,<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersPageComponent</span> </span>{
  <span class="hljs-attr">allUsers$</span>: Observable&lt;User[]&gt;;<font></font>
  firstUser$: Observable&lt;User&gt;;<font></font>
  <font></font>
  <span class="hljs-keyword">constructor</span>(private http: HttpClient) {<font></font>
  }<font></font>
<font></font>
  ngOnInit() {<font></font>
    <span class="hljs-keyword">this</span>.allUsers$ = <span class="hljs-keyword">this</span>.http.get(<span class="hljs-string">'https://api/users'</span>).pipe(<font></font>
      map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> filter/sort),<font></font>
    );<font></font>
    <font></font>
    <span class="hljs-keyword">this</span>.firstUser$ = <span class="hljs-keyword">this</span>.allUsers$.pipe(map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> users[<span class="hljs-number">0</span>]));<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªhttpè¯·æ±‚ï¼Œæ’åºæˆ–è¿‡æ»¤æ“ä½œå°†æ‰§è¡Œä¸¤æ¬¡ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç”³è¯·</font></font><code>share</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="javascript hljs">@Component({
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;user [user]="firstUser$ | async"&gt;&lt;/user&gt;
    &lt;users-list [users]="allUsers$ | async"&gt;&lt;/users-list&gt;
  `</span>,<font></font>
})<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersPageComponent</span> </span>{
  <span class="hljs-attr">allUsers$</span>: Observable&lt;User[]&gt;;<font></font>
  firstUser$: Observable&lt;User&gt;;<font></font>
  <font></font>
  <span class="hljs-keyword">constructor</span>(private http: HttpClient) {<font></font>
  }<font></font>
<font></font>
  ngOnInit() {<font></font>
    <span class="hljs-keyword">this</span>.allUsers$ = <span class="hljs-keyword">this</span>.http.get(<span class="hljs-string">'https://api/users'</span>).pipe(<font></font>
      map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> filter/sort),<font></font>
      share()<font></font>
    );<font></font>
    <font></font>
    <span class="hljs-keyword">this</span>.firstUser$ = <span class="hljs-keyword">this</span>.allUsers$.pipe(map(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> users[<span class="hljs-number">0</span>]));<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å·²ç»çŸ¥é“ä»–åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„</font></font><code>Subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¢é˜…æºã€‚</font><font style="vertical-align: inherit;">å½“æºå‘å‡ºæ—¶ï¼Œä¸»é¢˜ä¼šå°†è¿™ä¸ªå€¼ä¼ é€’ç»™å®ƒçš„æ‰€æœ‰è®¢é˜…è€…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é—®é¢˜å·²è§£å†³ï¼Œå½“æˆ‘ä»¬è®¢é˜…æ—¶</font></font><code>firstUser$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-æˆ‘ä»¬è®¢é˜…äº†internal </font></font><code>subject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œä¸æ˜¯ç›´æ¥</font><font style="vertical-align: inherit;">è®¢é˜…</font><font style="vertical-align: inherit;">äº†åŸå§‹æµã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨ShareReplay</font></font></h3><br>
<code>ShareReplay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æ‚¨éœ€è¦å‘å‡ºï¼Œç¼“å­˜å’Œé‡å¤æœ€åçš„Xä¸ªå€¼æ—¶é€‚ç”¨ã€‚</font><font style="vertical-align: inherit;">ä¸€ä¸ªå…¸å‹çš„ç¤ºä¾‹æ˜¯æ‰§è¡Œhttpè¯·æ±‚çš„å•ä¾‹æœåŠ¡ã€‚</font></font><br>
<br>
<pre><code class="javascript hljs">
@Injectable({ <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span> })
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogService</span> </span>{<font></font>
  posts$ = <span class="hljs-keyword">this</span>.http.get(<span class="hljs-string">'https://jsonplaceholder.typicode.com/posts'</span>)<font></font>
              .pipe(shareReplay(<span class="hljs-number">1</span>));<font></font>
<font></font>
  <span class="hljs-keyword">constructor</span>(private http: HttpClient) {}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸è®ºç°åœ¨æˆ–å°†æ¥æœ‰å¤šå°‘ç»„ä»¶å°†è¯·æ±‚æ•°æ®ï¼Œéƒ½å°†åªæœ‰ä¸€ä¸ªhttpè¯·æ±‚ï¼Œå¹¶ä¸”ç»“æœå°†ä¿å­˜åœ¨å†…éƒ¨ç¼“å†²åŒºä¸­</font></font><code>ReplaySubject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºæ²¡æœ‰è®¢é˜…è€…ï¼Œæ‚¨éœ€è¦å–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚ï¼Œç„¶åæ‚¨éœ€è¦ç”³è¯·</font></font><code>refCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™é‡Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰¾åˆ°</font><font style="vertical-align: inherit;">ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490976/index.html">DUMP2020çš„å‰ç«¯éƒ¨åˆ†ï¼šæˆ‘ä»¬å°†å†æ¬¡ä¿è¯å°†æœ‰ä¸€ä¸ªå®Œæ•´çš„æˆ¿å­ã€‚å»å¹´çš„çƒ­é—¨æŠ¥å‘Šå’Œæœ¬ä¸»é¢˜</a></li>
<li><a href="../zh-CN490978/index.html">ä½¿ç”¨SecureCRTå°†å‘½ä»¤åŒæ—¶å‘é€åˆ°å¤šä¸ªè®¾å¤‡</a></li>
<li><a href="../zh-CN490982/index.html">ç»™é›‡ä¸»çš„åå»ºè®®ã€‚å¦‚ä½•ä¸å¼€å‘äººå‘˜â€œé€‚å½“â€äº’åŠ¨</a></li>
<li><a href="../zh-CN490984/index.html">ä¸‹è¯ºå¤«å“¥ç½—å¾·Android mitapçš„èµ„æ–™ã€‚MotionLayoutï¼ŒKotlin Coroutinesï¼ŒCI / CDåŸºç¡€ç»“æ„å’Œè®¾è®¡ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN490986/index.html">æµ‹è¯•AMDé”é¾™å¤„ç†å™¨ä¸KOMPAS-3Dé…åˆä½¿ç”¨</a></li>
<li><a href="../zh-CN490992/index.html">ä»·æ ¼æŠ˜æ‰£ç®¡ç†ï¼šä»¥åŠ æ²¹ç«™æ•ˆæœé‡åŒ–æ¨¡å‹ä¸ºä¾‹</a></li>
<li><a href="../zh-CN490996/index.html">åœæ­¢æ•‘æ´ï¼è‡ªç»„è£…â€œåŒ»ç”¨å£ç½©â€çš„è¯´æ˜</a></li>
<li><a href="../zh-CN490998/index.html">SIBURä¸­çš„ç¡¬ä»¶æµ‹è¯•</a></li>
<li><a href="../zh-CN491000/index.html">åœ¨æ²¡æœ‰JavaScriptçš„æƒ…å†µä¸‹ï¼ˆå‡ ä¹ï¼‰å¯¹Select-Optionè¿›è¡Œæ ·å¼è®¾ç½®</a></li>
<li><a href="../zh-CN491006/index.html">Intel NUCé€šè¿‡Unity3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>