<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👦 🐎 👨‍✈️ Elegante asynchrone Programmierung mit Versprechen 🎪 👨🏻‍🚀 🕧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag, Freunde! 
 
 Versprechen (Versprechen) sind eine relativ neue Funktion von JavaScript, mit der Sie die Ausführung einer Aktion bis zum Absc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Elegante asynchrone Programmierung mit Versprechen</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488762/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guten Tag, Freunde! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versprechen (Versprechen) sind eine relativ neue Funktion von JavaScript, mit der Sie die Ausführung einer Aktion bis zum Abschluss der vorherigen Aktion verzögern oder auf die nicht erfolgreiche Ausführung der Aktion reagieren können. </font><font style="vertical-align: inherit;">Dies trägt zur korrekten Bestimmung der Abfolge von asynchronen Operationen bei. </font><font style="vertical-align: inherit;">In diesem Artikel wird erläutert, wie Versprechen funktionieren, wie sie in der Web-API verwendet werden und wie Sie Ihr eigenes Versprechen schreiben können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bedingungen: Grundlegende Computerkenntnisse, Kenntnisse der Grundlagen von JS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ziel: Verstehen, was Versprechen sind und wie sie verwendet werden.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was sind Versprechen?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versprechen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im ersten Artikel des Kurses </font><font style="vertical-align: inherit;">kurz besprochen </font><font style="vertical-align: inherit;">, hier werden wir sie genauer betrachten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Wesentlichen ist ein Versprechen ein Objekt, das einen Zwischenzustand einer Operation darstellt - es „verspricht“, dass das Ergebnis in Zukunft zurückgegeben wird. Es ist nicht genau bekannt, wann der Vorgang abgeschlossen und wann das Ergebnis zurückgegeben wird. Es besteht jedoch die Garantie, dass Ihr Code nach Abschluss des Vorgangs entweder etwas mit dem Ergebnis tut oder den Fehler ordnungsgemäß behandelt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Regel ist es für uns weniger interessant, wie viel Zeit ein asynchroner Vorgang benötigt (nicht zu lange!) Als die Möglichkeit einer sofortigen Reaktion auf seinen Abschluss. Und natürlich ist es schön zu wissen, dass der Rest des Codes nicht blockiert ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines der häufigsten Versprechen sind Web-APIs, die Versprechen zurückgeben. Schauen wir uns eine hypothetische Video-Chat-Anwendung an. Die Anwendung verfügt über ein Fenster mit einer Liste der Freunde des Benutzers. Durch Klicken auf die Schaltfläche neben dem Namen (oder Avatar) des Benutzers wird ein Videoanruf gestartet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Button-Handler ruft </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUserMedia () auf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um auf die Kamera und das Mikrofon des Benutzers zuzugreifen. Von dem Moment an, in dem getUserMedia () den Benutzer um Erlaubnis bittet (Geräte zu verwenden, welches Gerät zu verwenden ist, wenn der Benutzer mehrere Mikrofone oder Kameras hat, unter anderem nur einen Sprachanruf), erwartet getUserMedia () nicht nur die Entscheidung des Benutzers, sondern auch die Freigabe Geräte, wenn sie derzeit verwendet werden. Darüber hinaus reagiert der Benutzer möglicherweise nicht sofort. All dies kann zu großen Zeitverzögerungen führen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn vom Hauptthread eine Anforderung zur Berechtigung zur Verwendung von Geräten gestellt wird, wird der Browser blockiert, bis getUserMedia () abgeschlossen ist. Es ist inakzeptabel. Ohne Versprechen wird alles im Browser „nicht anklickbar“, bis der Benutzer die Erlaubnis zur Verwendung des Mikrofons und der Kamera erteilt. Anstatt auf die Entscheidung eines Benutzers zu warten und einen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaStream</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für einen aus Quellen (Kamera und Mikrofon) erstellten Stream zurückzugeben, gibt getUserMedia () daher das Versprechen zurück, dass MediaStream verarbeitet, sobald er verfügbar ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Video-Chat-Anwendungscode könnte folgendermaßen aussehen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span> <span class="hljs-title">CallButton</span>(<span class="hljs-params">evt</span>)</span>{<font></font>
    setStatusMessage(<span class="hljs-string">'Calling...'</span>)<font></font>
    navigator.mediaDevices.getUserMedia({<span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>})<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">chatStream</span> =&gt;</span> {<font></font>
        selfViewElem.srcObject = chatStream<font></font>
        chatStream.getTracks().forEach(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> myPeerConnection.addTrack(track, chatStream))<font></font>
        setStatusMessage(<span class="hljs-string">'Connected'</span>)<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {<font></font>
        setStatusMessage(<span class="hljs-string">'Failed to connect'</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion beginnt mit dem Aufruf von setStatusMessage () und der Meldung 'Calling ...', die als Indikator dafür dient, dass versucht wird, einen Anruf zu tätigen. Anschließend wird getUserMedia () aufgerufen und ein Stream angefordert, der Video- und Audiospuren enthält. Sobald der Stream erstellt wurde, wird ein Videoelement installiert, um den Stream von der Kamera mit der Bezeichnung "Selbstansicht" anzuzeigen. Zu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTCPeerConnection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , einer Verbindung zu einem anderen Benutzer </font><font style="vertical-align: inherit;">, werden Audiospuren hinzugefügt </font><font style="vertical-align: inherit;">. Danach wird der Status auf "Verbunden" aktualisiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn getUserMedia () fehlschlägt, wird der catch-Block gestartet. Es verwendet setStatusMessage (), um eine Fehlermeldung anzuzeigen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beachten Sie, dass der Aufruf von getUserMedia () zurückgegeben wird, auch wenn der Videostream noch nicht empfangen wurde. </font><font style="vertical-align: inherit;">Selbst wenn die Funktion handleCallButton () die Kontrolle über den Code zurückgibt, der sie aufgerufen hat, würde sie den Handler aufrufen, sobald getUserMedia () die Ausführung abgeschlossen hat. </font><font style="vertical-align: inherit;">Bis die Anwendung „versteht“, dass die Übertragung begonnen hat, befindet sich getUserMedia () im Standby-Modus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis: Weitere Informationen hierzu finden Sie im Artikel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Signale und Videoanrufe“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dieser Artikel enthält einen vollständigeren Code als den im Beispiel verwendeten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückruffunktionen Problem</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu verstehen, warum Versprechen eine gute Lösung sind, ist es hilfreich, die alte Art des Schreibens von Rückrufen zu betrachten, um festzustellen, welche Probleme sie hatten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Beispiel sollten Sie Pizza bestellen. </font><font style="vertical-align: inherit;">Eine erfolgreiche Pizza-Bestellung besteht aus mehreren Schritten, die nacheinander ausgeführt werden müssen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wählen Sie die Füllung. </font><font style="vertical-align: inherit;">Dies kann einige Zeit dauern, wenn Sie lange darüber nachdenken, und kann fehlschlagen, wenn Sie Ihre Meinung ändern und ein Curry bestellen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir geben eine Bestellung auf. </font><font style="vertical-align: inherit;">Das Kochen von Pizza dauert einige Zeit und kann fehlschlagen, wenn dem Restaurant die erforderlichen Zutaten fehlen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir bekommen Pizza und essen. </font><font style="vertical-align: inherit;">Der Empfang von Pizza kann fehlschlagen, wenn wir beispielsweise die Bestellung nicht bezahlen können.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Pseudocode alten Stils mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückruffunktionen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> könnte folgendermaßen aussehen:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{<font></font>
    placeOrder(toppings, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{<font></font>
        collectOrder(order, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
            eatPizza(pizza)<font></font>
        }, failureCallback)<font></font>
    }, failureCallback)<font></font>
}, failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein solcher Code ist schwer zu lesen und zu pflegen (er wird oft als "Hölle der Rückrufe" oder "Hölle der Rückrufe" bezeichnet). </font><font style="vertical-align: inherit;">Die Funktion failCallback () muss auf jeder Verschachtelungsebene aufgerufen werden. </font><font style="vertical-align: inherit;">Es gibt andere Probleme.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verwenden Versprechen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versprechen machen den Code sauberer, verständlicher und unterstützender. </font><font style="vertical-align: inherit;">Wenn wir den Pseudocode mit asynchronen Versprechungen umschreiben, erhalten wir Folgendes:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{
    <span class="hljs-keyword">return</span> placeOrder(toppings)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{
    <span class="hljs-keyword">return</span> collectOrder(order)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
    eatPizza(pizza)<font></font>
})<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist viel besser - wir sehen, was passiert, wir verwenden einen .catch () -Block, um alle Fehler zu behandeln, die Funktion blockiert nicht den Hauptstrom (so können wir Videospiele spielen, während wir auf Pizza warten), jeder Vorgang wird garantiert ausgeführt, nachdem der vorherige abgeschlossen ist. </font><font style="vertical-align: inherit;">Da jedes Versprechen ein Versprechen zurückgibt, können wir die .then-Kette verwenden. </font><font style="vertical-align: inherit;">Großartig, richtig? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Hilfe von Pfeilfunktionen kann der Pseudocode weiter vereinfacht werden:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span><font></font>
    placeOrder(toppings)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span><font></font>
    collectOrder(order)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span><font></font>
    eatPizza(pizza)     <font></font>
)<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder sogar so:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span> placeOrder(toppings))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> collectOrder(order))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span> eatPizza(pizza))<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies funktioniert, weil () =&gt; x identisch mit () =&gt; {return x} ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können dies sogar tun (da Funktionen einfach Parameter übergeben, benötigen wir keine Überlagerung):</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings().then(placeOrder).then(collectOrder).then(eatPizza).catch(failureCallback)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein solcher Code ist schwieriger zu lesen und kann nicht mit komplexeren Konstrukten als im Pseudocode verwendet werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis: Pseudocode kann mit async / await noch verbessert werden, was in einem zukünftigen Artikel erläutert wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Kern ähneln Versprechen den Hörern von Events, weisen jedoch einige Unterschiede auf:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Versprechen wird nur einmal erfüllt (Erfolg oder Misserfolg). </font><font style="vertical-align: inherit;">Es kann nicht zweimal ausgeführt werden oder nach Abschluss des Vorgangs von Erfolg zu Misserfolg oder umgekehrt wechseln.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn das Versprechen erfüllt ist und wir eine Rückruffunktion hinzufügen, um das Ergebnis zu verarbeiten, wird diese Funktion aufgerufen, obwohl das Ereignis vor dem Hinzufügen der Funktion aufgetreten ist.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundlegende Versprechenssyntax: ein echtes Beispiel</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Wissen um Versprechen ist wichtig, da viele Web-APIs sie in Funktionen verwenden, die potenziell komplexe Aufgaben ausführen. Die Arbeit mit modernen Webtechnologien erfordert die Verwendung von Versprechungen. Später werden wir lernen, wie wir unsere eigenen Versprechen schreiben, aber jetzt schauen wir uns einige einfache Beispiele an, die in der Web-API zu finden sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im ersten Beispiel verwenden wir die Methode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetch ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um das Bild aus dem Netzwerk </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">abzurufen</font></a><font style="vertical-align: inherit;"> , die Methode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blob ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um den Inhalt des Antwortkörpers in ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blob-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekt zu konvertieren </font><font style="vertical-align: inherit;">und dieses Objekt im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;img&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Element anzuzeigen </font><font style="vertical-align: inherit;">. Dieses Beispiel ist dem Beispiel aus dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ersten Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sehr ähnlich </font><font style="vertical-align: inherit;">, aber wir werden es etwas anders machen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis: Das folgende Beispiel funktioniert nicht, wenn Sie es einfach aus einer Datei ausführen (d. H. Mit file: // URL). Sie müssen es über einen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lokalen Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausführen </font><font style="vertical-align: inherit;">oder Online-Lösungen wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub-Seiten verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Laden Sie zunächst den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML-Code</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bild hoch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die wir erhalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Fügen Sie das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Element </font><font style="vertical-align: inherit;">am Ende des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;body&gt; hinzu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Fügen Sie im &lt;script&gt; -Element die folgende Zeile hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise = fetch(<span class="hljs-string">'coffee.jpg'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Methode fetch (), die die Bild-URL als Parameter verwendet, wird verwendet, um das Bild aus dem Netzwerk abzurufen. Als zweiten Parameter können wir ein Objekt mit Einstellungen angeben, beschränken uns jedoch vorerst auf eine einfache Option. Wir speichern das von fetch () zurückgegebene Versprechen in der Versprechen-Variablen. Wie bereits erwähnt, ist ein Versprechen ein Objekt, das einen Zwischenstaat darstellt - der offizielle Name für einen bestimmten Staat steht noch aus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Um mit dem Ergebnis des erfolgreichen Abschlusses des Versprechens zu arbeiten (in unserem Fall, wenn </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Response</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zurückkehrt </font><font style="vertical-align: inherit;">), rufen wir die Methode </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.then () auf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Die Rückruffunktion im Block .then () (oft als Executor bezeichnet) wird nur gestartet, wenn das Versprechen erfolgreich abgeschlossen und das Antwortobjekt zurückgegeben wurde. Sie geben an, dass das Versprechen erfüllt wurde (erfüllt, erfüllt). </font><font style="vertical-align: inherit;">Die Antwort wird als Parameter übergeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">Die Operation des Blocks .then () ähnelt der Operation des Ereignis-Listeners AddEventListener (). </font><font style="vertical-align: inherit;">Sie wird erst ausgelöst, nachdem das Ereignis eingetreten ist (nachdem das Versprechen erfüllt wurde). </font><font style="vertical-align: inherit;">Der Unterschied zwischen beiden besteht darin, dass .then () nur einmal aufgerufen werden kann, während der Listener für mehrere Aufrufe ausgelegt ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach Erhalt der Antwort rufen wir die blob () -Methode auf, um die Antwort in ein Blob-Objekt zu konvertieren. </font><font style="vertical-align: inherit;">Es sieht aus wie das:</font></font><br>
<br>
<pre><code class="javascript hljs">response =&gt; response.blob()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... das ist ein kurzer Eintrag für:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>)</span>{
    <span class="hljs-keyword">return</span> response.blob()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK, genug Worte. </font><font style="vertical-align: inherit;">Fügen Sie nach der ersten Zeile Folgendes hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise2 = promise.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Jeder Aufruf von .then () schafft ein neues Versprechen. </font><font style="vertical-align: inherit;">Dies ist sehr nützlich: Da blob () auch ein Versprechen zurückgibt, können wir das Blob-Objekt verarbeiten, indem wir beim zweiten Versprechen .then () aufrufen. </font><font style="vertical-align: inherit;">Da wir etwas komplizierteres tun möchten, als die Methode aufzurufen und das Ergebnis zurückzugeben, müssen wir den Funktionskörper in geschweifte Klammern setzen (andernfalls wird eine Ausnahme ausgelöst): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie am Ende des Codes Folgendes hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise3 = promise2.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Füllen wir den Hauptteil der ausführenden Funktion aus. </font><font style="vertical-align: inherit;">Fügen Sie den geschweiften Klammern die folgenden Zeilen hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
<span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image.src = objectURL<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier rufen wir die Methode URL.createObjectURL () auf und übergeben sie als Blob-Parameter, der das zweite Versprechen zurückgibt. </font><font style="vertical-align: inherit;">Wir bekommen einen Link zum Objekt. </font><font style="vertical-align: inherit;">Dann erstellen wir ein &lt;img&gt; -Element, setzen das src-Attribut mit dem Wert der Objektverknüpfung und fügen es dem DOM hinzu, sodass das Bild auf der Seite angezeigt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie den HTML-Code speichern und in einen Browser laden, wird das Bild wie erwartet angezeigt. </font><font style="vertical-align: inherit;">Ausgezeichnete Arbeit! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">Sie haben wahrscheinlich bemerkt, dass diese Beispiele etwas erfunden sind. </font><font style="vertical-align: inherit;">Sie können auf die Methoden fetch () und blob () verzichten und die entsprechende URL &lt;img&gt;, Coffee.jpg, zuweisen. </font><font style="vertical-align: inherit;">Wir sind diesen Weg gegangen, um anhand eines einfachen Beispiels die Arbeit mit Versprechungen zu demonstrieren.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fehlerreaktion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben etwas vergessen - wir haben keinen Fehlerbehandler, falls eines der Versprechen fehlschlägt (wird abgelehnt). </font><font style="vertical-align: inherit;">Wir können einen Fehlerhandler mit der Methode .catch () hinzufügen. </font><font style="vertical-align: inherit;">Lass uns das tun:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> errorCase = promise3.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dies in Aktion zu sehen, geben Sie die falsche Bild-URL an und laden Sie die Seite neu. </font><font style="vertical-align: inherit;">In der Konsole wird eine Fehlermeldung angezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall wird eine Fehlermeldung auch in der Konsole angezeigt, wenn wir den Block .catch () nicht hinzufügen. </font><font style="vertical-align: inherit;">Mit .catch () können wir Fehler jedoch so behandeln, wie wir es möchten. </font><font style="vertical-align: inherit;">In einer realen Anwendung versucht Ihr .catch () -Block möglicherweise, das Bild erneut aufzunehmen oder das Standardbild anzuzeigen, oder fordert den Benutzer auf, ein anderes Bild auszuwählen oder etwas anderes zu tun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">Sehen Sie sich eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Live-Demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellcode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) an.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blockzusammenführung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich ist der Ansatz, mit dem wir den Code geschrieben haben, nicht optimal. </font><font style="vertical-align: inherit;">Wir sind bewusst diesen Weg gegangen, damit Sie verstehen, was in jeder Phase passiert. </font><font style="vertical-align: inherit;">Wie bereits gezeigt, können wir .then () -Blöcke (und .catch () -Blöcke) kombinieren. </font><font style="vertical-align: inherit;">Unser Code kann wie folgt umgeschrieben werden (siehe auch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-chained.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf GitHub):</font></font><br>
<br>
<pre><code class="javascript hljs">fetch(<span class="hljs-string">'coffee.jpg'</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())<font></font>
.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denken Sie daran, dass der vom Versprechen zurückgegebene Wert als Parameter an den nächsten Funktionsausführenden des Blocks .then () übergeben wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">Die .then () /. Catch () -Blöcke in Versprechungen sind asynchrone Äquivalente des synchronen try ... catch-Blocks. </font><font style="vertical-align: inherit;">Denken Sie daran: Synchroner Versuch ... catch funktioniert nicht in asynchronem Code.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promise Terminologie Schlussfolgerungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie uns eine Bestandsaufnahme machen und eine kurze Anleitung schreiben, die Sie in Zukunft verwenden können. </font><font style="vertical-align: inherit;">Um das Wissen zu festigen, empfehlen wir, den vorherigen Abschnitt mehrmals zu lesen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Wenn das Versprechen erstellt wird, sagen sie, dass es sich in einem Erwartungszustand befindet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Wenn das Versprechen zurückgegeben wird, sagen sie, dass es erfüllt (gelöst) wurde:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Ein erfolgreich abgeschlossenes Versprechen wird als erfüllt bezeichnet. </font><font style="vertical-align: inherit;">Es gibt den Wert zurück, der über die Kette von .then () am Ende des Versprechens erhalten werden kann. </font><font style="vertical-align: inherit;">Die ausführende Funktion im Block .then () enthält den vom Versprechen zurückgegebenen Wert.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Ein nicht erfolgreich abgeschlossenes Versprechen wird als abgelehnt bezeichnet. </font><font style="vertical-align: inherit;">Es gibt den Grund zurück, die Fehlermeldung, die zur Ablehnung des Versprechens geführt hat. </font><font style="vertical-align: inherit;">Dieser Grund kann über den Block .catch () am Ende des Versprechens ermittelt werden.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Führen Sie den Code nach mehreren Versprechungen aus</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die Grundlagen der Verwendung von Versprechungen gelernt. Schauen wir uns nun die erweiterten Funktionen an. Die Kette von .then () ist in Ordnung, aber was ist, wenn wir mehrere Versprechensblöcke nacheinander aufrufen wollen? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können dies mit der Standardmethode Promise.all () tun. Diese Methode verwendet ein Array von Versprechungen als Parameter und gibt ein neues Versprechen zurück, wenn alle Versprechungen im Array erfüllt sind. Es sieht ungefähr so ​​aus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([a,b,c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
        ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alle Versprechen erfüllt sind, wird der Array-Executor des Blocks .then () als Parameter übergeben. Wenn mindestens eines der Versprechen nicht erfüllt wird, wird der gesamte Block abgelehnt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies kann sehr hilfreich sein. Stellen Sie sich vor, wir erhalten Informationen zum dynamischen Füllen der Benutzeroberfläche mit Inhalten auf unserer Seite. In vielen Fällen ist es sinnvoller, alle Informationen zu erhalten und später auf der Seite anzuzeigen, als die Informationen in Teilen anzuzeigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns ein anderes Beispiel an: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Laden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine Seitenvorlage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> herunter </font><font style="vertical-align: inherit;">und platzieren Sie das &lt;script&gt; -Tag vor dem schließenden &lt;/ body&gt; -Tag. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Laden Sie die Quelldateien herunter ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coffee.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tea.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description.txt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) oder ersetzen Sie sie durch Ihre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Im Skript definieren wir zunächst eine Funktion, die die Versprechen zurückgibt, die wir an Promise.all () übergeben. </font><font style="vertical-align: inherit;">Dies ist einfach, wenn wir Promise.all () nach Abschluss der drei Operationen fetch () ausführen. </font><font style="vertical-align: inherit;">Wir können Folgendes tun:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> a = fetch(url1)
<span class="hljs-keyword">let</span> b = fetch(url2)
<span class="hljs-keyword">let</span> c = fetch(url3)<font></font>
<font></font>
<span class="hljs-built_in">Promise</span>.all([a, b, c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
    ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn das Versprechen erfüllt ist, enthält die Variable "values" drei Antwortobjekte, eines aus jeder abgeschlossenen fetch () - Operation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das wollen wir aber nicht. </font><font style="vertical-align: inherit;">Es ist uns egal, wann die fetch () - Operationen abgeschlossen sind. </font><font style="vertical-align: inherit;">Was wir wirklich wollen, sind die geladenen Daten. </font><font style="vertical-align: inherit;">Dies bedeutet, dass wir den Block Promise.all () ausführen möchten, nachdem wir einen gültigen Blob erhalten haben, der Bilder und gültige Textzeichenfolgen darstellt. </font><font style="vertical-align: inherit;">Wir können eine Funktion schreiben, die dies tut; </font><font style="vertical-align: inherit;">Fügen Sie Ihrem &lt;script&gt; -Element Folgendes hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation '</span> + e.message)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht etwas kompliziert aus, also gehen </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wir </font><font style="vertical-align: inherit;">den Code Schritt für Schritt durch: </font><font style="vertical-align: inherit;">1. Zunächst deklarieren wir die Funktion und übergeben ihr die URL und den Typ der resultierenden Datei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Die Struktur der Funktion ähnelt der im ersten Beispiel - wir rufen die Funktion fetch () auf, um die Datei unter einer bestimmten URL abzurufen, und übertragen die Datei dann auf ein anderes Versprechen, das den dekodierten (gelesenen) Antworttext zurückgibt. </font><font style="vertical-align: inherit;">Im vorherigen Beispiel war es immer die blob () -Methode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Es gibt zwei Unterschiede:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstens hängt das zweite Rückgabeversprechen von der Art des Wertes ab. </font><font style="vertical-align: inherit;">Innerhalb der ausführenden Funktion verwenden wir die if ... else if-Anweisung, um das Versprechen abhängig vom Dateityp zurückzugeben, den wir dekodieren müssen (in diesem Fall wählen wir zwischen Blob und Text, aber das Beispiel kann leicht erweitert werden, um mit anderen Typen zu arbeiten).</font></font></li>
<li>-,     «return»   fetch().       ,     (..   ,  blob()  text(),  ,  ,   ).  ,  return     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Am Ende rufen wir die .catch () -Methode auf, um alle Fehler zu behandeln, die in Versprechungen in dem an .all () übergebenen Array auftreten können. Wenn eines der Versprechen abgelehnt wird, teilt uns der Fangblock mit, mit welchem ​​Versprechen das Problem verbunden war. Der Block .all () wird weiterhin ausgeführt, zeigt jedoch nicht die Ergebnisse an, für die Fehler aufgetreten sind. Wenn .all () abgelehnt werden soll, fügen Sie am Ende einen .catch () - Block hinzu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code in der Funktion ist asynchron und basiert auf Versprechungen, sodass die gesamte Funktion wie ein Versprechen funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Als nächstes rufen wir unsere Funktion dreimal auf, um den Prozess des Empfangens und Dekodierens von Bildern und Text zu starten und jedes der Versprechen in eine Variable zu setzen. Fügen Sie Folgendes hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> coffee = fetchAndDecode(<span class="hljs-string">'coffee.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> tea = fetchAndDecode(<span class="hljs-string">'tea.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> description = fetchAndDecode(<span class="hljs-string">'description.txt'</span>, <span class="hljs-string">'text'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Als nächstes deklarieren wir einen Promise.all () -Block, um Code erst auszuführen, nachdem alle drei Versprechen erfüllt wurden. </font><font style="vertical-align: inherit;">Fügen Sie einen Block mit einer leeren Executor-Funktion in .then () hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([coffee, tea, description]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können sehen, dass eine Reihe von Versprechungen als Parameter verwendet werden. </font><font style="vertical-align: inherit;">Der Auftragnehmer startet erst, wenn alle drei Versprechen erfüllt sind. </font><font style="vertical-align: inherit;">In diesem Fall wird das Ergebnis jedes Versprechens (der dekodierte Antwortkörper) in ein Array eingefügt. Dies kann als [Kaffee-Ergebnisse, Tee-Ergebnisse, Beschreibungsergebnisse] dargestellt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Fügen Sie abschließend dem Executor Folgendes hinzu (hier verwenden wir einen ziemlich einfachen synchronen Code, um die Ergebnisse in Variablen einzufügen (URL-Objekte aus Blob erstellen) und Bilder und Text auf der Seite anzuzeigen):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(values)
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">let</span> objectURL1 = URL.createObjectURL(values[<span class="hljs-number">0</span>])
<span class="hljs-keyword">let</span> objectURL2 = URL.createObjectURL(values[<span class="hljs-number">1</span>])
<span class="hljs-keyword">let</span> descText = values[<span class="hljs-number">2</span>]<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> image1 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)
<span class="hljs-keyword">let</span> image2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image1.src = objectURL1<font></font>
image2.src = objectURL2<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image1)
<span class="hljs-built_in">document</span>.body.appendChild(image2)<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> para = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'p'</span>)<font></font>
para.textContent = descText<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(para)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Speichern Sie die Änderungen und laden Sie die Seite neu. Sie sollten sehen, dass alle Komponenten der Benutzeroberfläche geladen werden, obwohl dies nicht sehr attraktiv aussieht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. Wenn Sie irgendwelche Schwierigkeiten haben, können Sie Ihre Version des Codes mit unserer vergleichen - hier ist eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Live-Demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellcode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. Um diesen Code zu verbessern, können Sie die angezeigten Elemente durchlaufen, sie empfangen und dekodieren und dann die Ergebnisse in Promise.all () durchlaufen. Dabei werden verschiedene Funktionen gestartet, um jedes Ergebnis je nach Typ anzuzeigen. Auf diese Weise können Sie mit einer beliebigen Anzahl von Elementen arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus können Sie den Typ der resultierenden Datei bestimmen, ohne die Eigenschaft type explizit angeben zu müssen. Dies kann zum Beispiel mit erfolgen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response.headers.get ('Inhaltstyp')</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Überprüfen </font><font style="vertical-align: inherit;">des HTTP-Protokoll- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inhaltstyp-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Headers </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Führen Sie den Code aus, nachdem Sie das Versprechen erfüllt / abgelehnt haben</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oft müssen Sie Code ausführen, nachdem ein Versprechen abgeschlossen wurde, unabhängig davon, ob es ausgeführt oder abgelehnt wurde. </font><font style="vertical-align: inherit;">Zuvor mussten wir denselben Code sowohl im Block .then () als auch im Block .catch () einfügen, zum Beispiel:</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
    runFinalCode()<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In modernen Browsern steht die Methode .finally () zur Verfügung, mit der Sie den Code nach Abschluss des Versprechens ausführen können. Dadurch werden Wiederholungen vermieden und der Code eleganter. </font><font style="vertical-align: inherit;">Der Code aus dem vorherigen Beispiel kann wie folgt umgeschrieben werden:</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
})<font></font>
.finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie können die Verwendung dieses Ansatzes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anhand</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eines realen Beispiels sehen - der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Live-Demo Versprechen-finally.html</font></a><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellcode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Es funktioniert genauso wie Promise.all () aus dem vorherigen Beispiel, außer dass wir finally () am Ende der Kette in der Funktion fetchAndDecode () hinzufügen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`There has been a problem with your fetch operation for resource "<span class="hljs-subst">${url}</span>": <span class="hljs-subst">${e.message}</span>`</span>)<font></font>
    }).finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`fetch attempt for "<span class="hljs-subst">${url}</span>" finished.`</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erhalten eine Nachricht über den Abschluss jedes Versuchs, die Datei abzurufen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">then () / catch () / finally () ist das asynchrone Äquivalent von synchronem try () / catch () / finally ().</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schreiben Sie Ihr eigenes Versprechen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die gute Nachricht ist, dass Sie bereits wissen, wie es geht. </font><font style="vertical-align: inherit;">Wenn Sie mehrere Versprechen mit .then () kombinieren oder kombinieren, um bestimmte Funktionen bereitzustellen, erstellen Sie Ihre eigenen asynchronen und auf Versprechen basierenden Funktionen. </font><font style="vertical-align: inherit;">Nehmen Sie zum Beispiel unsere Funktion fetchAndDecode () aus dem vorherigen Beispiel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Kombination verschiedener vielversprechungsbasierter APIs zur Erstellung spezifischer Funktionen ist die häufigste Methode, um mit Versprechungen zu arbeiten. Dies zeigt die Flexibilität und Leistungsfähigkeit moderner APIs. </font><font style="vertical-align: inherit;">Es gibt jedoch einen anderen Weg.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konstruktor Versprechen ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem Konstruktor Promise () können Sie Ihr eigenes Versprechen erstellen. Dies kann in einer Situation erforderlich sein, in der Sie Code aus der alten asynchronen API haben, den Sie "überdimensionieren" müssen. Dies geschieht, um sowohl mit vorhandenem, altem Code, Bibliotheken oder „Frameworks“ als auch mit neuem versprechungsbasiertem Code gleichzeitig arbeiten zu können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns ein einfaches Beispiel an - hier verpacken wir den Aufruf von setTimeout () in ein Versprechen - dies startet die Funktion in 2 Sekunden, die das Versprechen (unter Verwendung des übergebenen Aufrufs von resolve ()) mit der Zeichenfolge "Success!" Erfüllt.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        resolve(<span class="hljs-string">'Success!'</span>)<font></font>
    }, <span class="hljs-number">2000</span>)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resolution () und Reject () sind Funktionen, die aufgerufen werden, um ein neues Versprechen zu erfüllen oder abzulehnen. </font><font style="vertical-align: inherit;">In diesem Fall wird das Versprechen mit der Zeichenfolge „Erfolg!“ Erfüllt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie dieses Versprechen aufrufen, können Sie den Block .then () hinzufügen, um weiter mit der Zeile „Success!“ Zu arbeiten. </font><font style="vertical-align: inherit;">So können wir eine Zeile in der Nachricht ausgeben:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise<font></font>
.then(<span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {<font></font>
    alert(message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... oder so:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise.then(alert)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sehen Sie sich eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Live-Demo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellcode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das angegebene Beispiel ist nicht sehr flexibel - das Versprechen kann nur mit einer einfachen Zeile erfüllt werden, wir haben keinen Fehlerbehandler - reverse () (tatsächlich benötigt setTimeout () keinen Fehlerbehandler, daher spielt es in diesem Fall keine Rolle). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">Warum auflösen () anstatt erfüllen ()? </font><font style="vertical-align: inherit;">Im Moment lautet die Antwort: Es ist schwer zu erklären.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir arbeiten mit der Ablehnung eines Versprechens</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können ein abgelehntes Versprechen mit der Reject () -Methode erstellen - genau wie "resolve ()", "Reject ()" einen einfachen Wert annimmt, ist der einfache Wert jedoch nicht das Ergebnis, sondern der Grund für die Ablehnung, d. H. </font><font style="vertical-align: inherit;">Ein Fehler, der an den Block .catch () übergeben wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erweitern wir das vorherige Beispiel, indem wir eine Bedingung für die Ablehnung eines Versprechens sowie die Möglichkeit hinzufügen, andere Nachrichten als eine Erfolgsnachricht zu empfangen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nehmen Sie das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorherige Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und schreiben Sie es folgendermaßen um:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeoutPromise</span>(<span class="hljs-params">message, interval</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span>(message === <span class="hljs-string">''</span> || <span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span>){<font></font>
            reject(<span class="hljs-string">'Message is empty or not a string'</span>)<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(interval &lt; <span class="hljs-number">0</span> || <span class="hljs-keyword">typeof</span> interval !== number){<font></font>
            reject(<span class="hljs-string">'Interval is negative or not a number'</span>)<font></font>
        } <span class="hljs-keyword">else</span>{<font></font>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
                resolve(message)<font></font>
            }, interval)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier übergeben wir zwei Argumente an die Funktion - Nachricht und Intervall (Zeitverzögerung). </font><font style="vertical-align: inherit;">In einer Funktion geben wir ein Promise-Objekt zurück. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Promise-Konstruktor führen wir mehrere Überprüfungen mit if ... else-Strukturen durch:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuerst überprüfen wir die Nachricht. </font><font style="vertical-align: inherit;">Wenn es leer ist oder keine Zeichenfolge ist, lehnen wir das Versprechen ab und melden einen Fehler.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zweitens überprüfen wir die Zeitverzögerung. </font><font style="vertical-align: inherit;">Wenn es eine negative oder keine Zahl ist, lehnen wir das Versprechen ebenfalls ab und melden einen Fehler.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn beide Argumente in Ordnung sind, zeigen Sie die Nachricht nach einer bestimmten Zeit (Intervall) mit setTimeout () an.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da timeoutPromise () ein Versprechen zurückgibt, können wir .then (), .catch () usw. hinzufügen, um die Funktionalität zu verbessern. </font><font style="vertical-align: inherit;">Lass uns das tun:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise(<span class="hljs-string">'Hello there!'</span>, <span class="hljs-number">1000</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {<font></font>
    alert(message)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error: '</span> + e)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie die Änderungen gespeichert und den Code ausgeführt haben, wird nach einer Sekunde eine Meldung angezeigt. </font><font style="vertical-align: inherit;">Versuchen Sie nun, eine leere Zeichenfolge als Nachricht oder eine negative Zahl als Intervall zu übergeben. </font><font style="vertical-align: inherit;">Sie sehen eine Fehlermeldung, wenn Sie das Versprechen ablehnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis. </font><font style="vertical-align: inherit;">Sie finden unsere Version dieses Beispiels auf GitHub - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">custom-versprechen2.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Realistischeres Beispiel.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das von uns untersuchte Beispiel erleichtert das Verständnis des Konzepts, ist jedoch nicht wirklich asynchron. Die Asynchronität im Beispiel wird mit setTimeout () simuliert, obwohl sie immer noch die Nützlichkeit von Versprechungen für die Erstellung von Funktionen mit einem angemessenen Workflow, einer guten Fehlerbehandlung usw. zeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Beispiel für eine nützliche asynchrone Anwendung, die den Promise () </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">-Konstruktor</font></a><font style="vertical-align: inherit;"> verwendet, ist die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDB-Bibliothek (IndexedDB mit Benutzerfreundlichkeit).</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jake Archibald. </font><font style="vertical-align: inherit;">In dieser Bibliothek können Sie die IndexedDB-API (basierend auf den API-Rückruffunktionen zum Speichern und Abrufen von Daten auf der Clientseite) verwenden, die im alten Stil mit Versprechungen geschrieben wurde. </font><font style="vertical-align: inherit;">Wenn Sie sich die Hauptbibliotheksdatei ansehen, werden Sie feststellen, dass sie dieselben Techniken verwendet, die wir oben untersucht haben. </font><font style="vertical-align: inherit;">Der folgende Code konvertiert das von vielen IndexedDB-Methoden verwendete grundlegende Abfragemodell in ein vielversprechendes kompatibles Modell:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promisifyRequest</span>(<span class="hljs-params">request</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>)</span>{<font></font>
        request.onsuccess = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            resolve(request.result)<font></font>
        }<font></font>
<font></font>
        request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            reject(request.error)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies fügt einige Ereignishandler hinzu, die das Versprechen gegebenenfalls erfüllen oder ablehnen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Anforderung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erfolgreich ist</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , erfüllt der Onsuccess-Handler das Versprechen mit dem Ergebnis der Anforderung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Anforderung </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fehlschlägt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lehnt der Onerror-Handler das Versprechen mit dem Fehler der Anforderung ab.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versprechen sind eine großartige Möglichkeit, asynchrone Anwendungen zu erstellen, wenn wir nicht wissen, welchen Wert die Funktion zurückgibt oder wie lange es dauern wird. Sie ermöglichen es Ihnen, mit einer Folge von asynchronen Operationen zu arbeiten, ohne tief verschachtelte Rückruffunktionen zu verwenden, und sie unterstützen den Fehlerbehandlungsstil der synchronen try ... catch-Anweisung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versprechen werden von allen modernen Browsern unterstützt. Die einzige Ausnahme bilden Opera Mini und IE11 sowie frühere Versionen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel haben wir bei weitem nicht alle Merkmale von Versprechungen berücksichtigt, sondern nur die interessantesten und nützlichsten. Sie werden andere Funktionen und Techniken kennenlernen, wenn Sie mehr über Versprechen erfahren möchten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die meisten modernen Web-APIs basieren auf Versprechungen, daher müssen Versprechungen bekannt sein. </font><font style="vertical-align: inherit;">Unter diesen Web-APIs können wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web-Audio-API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Media Capture und Streams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usw. nennen. Versprechen werden immer beliebter, daher ist ihr Studium und Verständnis ein wichtiger Schritt zur Beherrschung des modernen JavaScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siehe auch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Allgemeine JavaScript-Versprechen, die jeder kennen sollte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">“ </font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank für Ihre Aufmerksamkeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konstruktive Kritik ist willkommen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488750/index.html">Dinosaur Walk: Zwei große Computer des 20. Jahrhunderts</a></li>
<li><a href="../de488752/index.html">Golang + Phaser3 = MMORPG - Wir bilden die Basis für die endlose Generation der Welt</a></li>
<li><a href="../de488754/index.html">Alles auf einmal: automatische Überprüfung der Bündelgröße</a></li>
<li><a href="../de488756/index.html">So arbeiten Sie mit der Google Sheets-API (Google Sheets API v4) in R mithilfe des neuen googlesheets4-Pakets</a></li>
<li><a href="../de488758/index.html">DEFCON-Konferenz 27. Internet-Betrugserkennung</a></li>
<li><a href="../de488766/index.html">Kunst und Technologie: Universität von Massachusetts in Lowell</a></li>
<li><a href="../de488768/index.html">Verdammt noch mal, oder wie man auf Englisch schwört, mit einer kultivierten Person verwechselt zu werden</a></li>
<li><a href="../de488776/index.html">Verbesserungen der Barrierefreiheit in Visual Studio 2019 für Mac</a></li>
<li><a href="../de488778/index.html">Datenstrukturen: Eine Liste, die alles kann *</a></li>
<li><a href="../de488780/index.html">Mozilla verlor im Browserkrieg, glaubt aber immer noch, dass es das Internet retten könnte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>