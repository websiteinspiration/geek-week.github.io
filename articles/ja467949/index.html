<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💪🏼 📚 🏇🏻 インターフェースのデフォルトの実装が役立つのはなぜですか？ 🦕 🌷 🎹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="で私の最後のポスト、私は私が思うに、ここでいくつかのケースについて話を約束し、それはインターフェースのデフォルト実装の使用を検討することは理にかなって。もちろん、この機能はコードを記述するための多くの既存の規則をキャンセルしませんが、状況によっては、デフォルトの実装を使用すると、よりクリーンで読みや...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>インターフェースのデフォルトの実装が役立つのはなぜですか？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467949/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の最後</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のポスト、私は私が思うに、ここでいくつかのケースについて話を約束し、それはインターフェースのデフォルト実装の使用を検討することは理にかなって。</font><font style="vertical-align: inherit;">もちろん、この機能はコードを記述するための多くの既存の規則をキャンセルしませんが、状況によっては、デフォルトの実装を使用すると、よりクリーンで読みやすいコードが得られることがわかりました（少なくとも私の意見では）。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下位互換性を持つインターフェースの拡張</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドキュメントは言う：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も一般的なシナリオは、すでに公開され、無数のクライアントによって使用されているインターフェースにメソッドを安全に追加することです。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解決すべき問題は、インターフェイスから継承された各クラスが新しいメソッドの実装を提供する必要があることです。</font><font style="vertical-align: inherit;">インターフェースが独自のコードでのみ使用されている場合、これはそれほど難しくありませんが、それがパブリックライブラリ内にあるか、他のコマンドで使用されている場合、新しいインターフェース要素を追加すると大きな頭痛の種になる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例を考えてみましょう：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">interface</span> <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> Make { <span class="hljs-keyword">get</span>; }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Avalon</span> : <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Make =&gt; <span class="hljs-string">"Toyota"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このインターフェイスに</font><font style="vertical-align: inherit;">
新しい</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTopSpeed（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">を追加する場合は</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalonに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その実装を追加する必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">interface</span> <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> Make { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">GetTopSpeed</span>(<span class="hljs-params"></span>)</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Avalon</span> : <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Make =&gt; <span class="hljs-string">"Toyota"</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetTopSpeed</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-number">130</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は、デフォルトの実装で作成した場合しかし、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTopSpeed（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICARを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私は、各継承されたクラスに追加する必要はありません。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">interface</span> <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> Make { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetTopSpeed</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-number">150</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Avalon</span> : <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Make =&gt; <span class="hljs-string">"Toyota"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要に応じて、デフォルトが適切でないクラスの実装を引き続きオーバーロードできます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">interface</span> <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> Make { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetTopSpeed</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-number">150</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Avalon</span> : <span class="hljs-title">ICar</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Make =&gt; <span class="hljs-string">"Toyota"</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetTopSpeed</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-number">130</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトのメソッド</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetTopSpeed（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICarに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャストされた変数でのみ</font><font style="vertical-align: inherit;">使用でき、</font><font style="vertical-align: inherit;">オーバーロードがない場合</font><font style="vertical-align: inherit;">は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avalon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で使用できないこと</font><font style="vertical-align: inherit;">を考慮することが重要です</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、インターフェースを使用している場合にこの手法が最も有用であることを意味します（そうしないと、コードがインターフェースへの多数のキャストで溢れ、メソッドのデフォルト実装にアクセスできるようになります）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ミックスインとトレイト（またはそのようなもの）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の言語の概念である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myxine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Traits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、多重継承を必要とせずに合成によってオブジェクトのメソッド拡張動作を記述します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィキペディアはミックスインについて次のように報告しています：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mixinは、デフォルトのメソッドとのインターフェースと見なすこともできます</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それはそのように聞こえますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、デフォルトの実装であっても、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェース</font><font style="vertical-align: inherit;">はミックスインではありません。違いは、それらに実装なしのメソッドを含めたり、他のインターフェースからの継承をサポートしたり、特殊化したりできることです</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（明らかに、テンプレートの制限を参照してください。-約Transl。）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ただし、デフォルトの実装を持つメソッドのみを含むインターフェースを作成すると、実際には従来のミックスインになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のコードを考えてみましょう。これは、オブジェクトの「動き」に機能を追加し、その位置を追跡します（たとえば、ゲーム開発で）。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IMovable</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> (<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>) Location { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Angle { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Speed { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
    <span class="hljs-comment">// ,        </span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Move</span>(<span class="hljs-params"></span>)</span> =&gt; Location = ...;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> : <span class="hljs-title">IMovable</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Make =&gt; <span class="hljs-string">"Toyota"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ああ！</font><font style="vertical-align: inherit;">このコードを書き始めて例をコンパイルしようとするまで気づかなかったこのコードの問題があります。</font><font style="vertical-align: inherit;">インターフェース（デフォルトの実装があるインターフェースでも）は状態を保存できません。</font><font style="vertical-align: inherit;">したがって、インターフェイスは自動プロパティをサポートしていません。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font><font style="vertical-align: inherit;">：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイスはインスタンスの状態を保存できません。</font><font style="vertical-align: inherit;">静的フィールドがインターフェースで許可されるようになりましたが、インスタンスフィールドはまだ使用できません。</font><font style="vertical-align: inherit;">したがって、非表示フィールドを暗黙的に使用するため、自動プロパティは使用できません。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、</font><font style="vertical-align: inherit;">インターフェイスはミックスインの概念と矛盾しています（私が理解している限り、ミックスインは概念的に状態を格納できます）。ただし、元の目標を達成できます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IMovable</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> (<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>) Location { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Angle { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Speed { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
    <span class="hljs-comment">// A method that changes location</span>
    <span class="hljs-comment">// using angle and speed</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Move</span>(<span class="hljs-params"></span>)</span> =&gt; Location = ...;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> : <span class="hljs-title">IMovable</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Make =&gt; <span class="hljs-string">"Toyota"</span>;<font></font>
<font></font>
    <span class="hljs-comment">// ,        </span>
    <span class="hljs-keyword">public</span> (<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>) Location { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Angle { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Speed { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Move（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">とその実装を、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMovable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェースを実装するすべてのクラスで利用できるように</font><font style="vertical-align: inherit;">することで、私たちが望んでいたこと</font><font style="vertical-align: inherit;">を実現し</font><i><font style="vertical-align: inherit;">ました</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">もちろん、クラスはプロパティの実装を提供する必要がありますが、少なくともそれらは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMovable</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェースで</font><font style="vertical-align: inherit;">宣言されて</font><i><font style="vertical-align: inherit;">い</font></i><font style="vertical-align: inherit;">ます。これにより、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Move（）の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルト実装が</font><font style="vertical-align: inherit;">それらと連携し、インターフェースを実装するすべてのクラスが正しい状態になることが保証されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より完全で実用的な例として、ロギングのミックスインを検討してください：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ILogger</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogInfo</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        LoggerFactory<font></font>
            .GetLogger(<span class="hljs-keyword">this</span>.GetType().Name)<font></font>
            .LogInfo(message);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LoggerFactory</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ILogger <span class="hljs-title">GetLogger</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span> =&gt;
        <span class="hljs-keyword">new</span> ConsoleLogger(name);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ConsoleLogger</span> : <span class="hljs-title">ILogger</span><font></font>
{<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> _name;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConsoleLogger</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> name</span>)</span><font></font>
    {<font></font>
        _name = name<font></font>
        ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(name));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogInfo</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        Console.WriteLine(<span class="hljs-string">$"[INFO] <span class="hljs-subst">{_name}</span>: <span class="hljs-subst">{message}</span>"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、どのクラスでも</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ILogger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェイス</font><font style="vertical-align: inherit;">から継承でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span> : <span class="hljs-title">ILogger</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoSomething</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        ((ILogger)<span class="hljs-keyword">this</span>).LogInfo(<span class="hljs-string">"Woot!"</span>);<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてそのようなコード：</font></font><br>
<br>
<pre><code class="cs hljs">Foo foo = <span class="hljs-keyword">new</span> Foo();<font></font>
foo.DoSomething();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力：</font></font><br>
<br>
<pre><code class="bash hljs">[INFO] Foo: Woot!</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張メソッドの置き換え</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が見つけた最も有用なアプリケーションは、多数の拡張メソッドを置き換えることです。</font><font style="vertical-align: inherit;">簡単なロギングの例に戻りましょう：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ILogger</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Log</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> level, <span class="hljs-keyword">string</span> message</span>)</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトの実装がインターフェースに現れる前に、原則として、このインターフェースの拡張メソッドを多数記述します。そのため、継承されたクラスでは、1つのメソッドのみを実装する必要があり、その結果、ユーザーは多くの拡張機能にアクセスできます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ILoggerExtensions</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogInfo</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ILogger logger, <span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        logger.Log(<span class="hljs-string">"INFO"</span>, message);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogInfo</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ILogger logger, <span class="hljs-keyword">int</span> id, <span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        logger.Log(<span class="hljs-string">"INFO"</span>, <span class="hljs-string">$"[<span class="hljs-subst">{id}</span>] message"</span>);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ILogger logger, <span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        logger.Log(<span class="hljs-string">"ERROR"</span>, message);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ILogger logger, <span class="hljs-keyword">int</span> id, <span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        logger.Log(<span class="hljs-string">"ERROR"</span>, <span class="hljs-string">$"[<span class="hljs-subst">{id}</span>] <span class="hljs-subst">{message}</span>"</span>);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ILogger logger, Exception ex</span>)</span> =&gt;<font></font>
        logger.Log(<span class="hljs-string">"ERROR"</span>, ex.Message);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> ILogger logger, <span class="hljs-keyword">int</span> id, Exception ex</span>)</span> =&gt;<font></font>
        logger.Log(<span class="hljs-string">"ERROR"</span>, <span class="hljs-string">$"[<span class="hljs-subst">{id}</span>] <span class="hljs-subst">{ex.Message}</span>"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチはうまくいきますが、欠点がないわけではありません。</font><font style="vertical-align: inherit;">たとえば、拡張とインターフェースを持つクラス名前空間は必ずしも一致しません。</font><font style="vertical-align: inherit;">加えて、パラメータとロガーインスタンスへのリンクの形で迷惑な視覚ノイズ：</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">this</span> ILogger logger<font></font>
logger.Log</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、拡張機能をデフォルトの実装に置き換えることができます。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ILogger</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Log</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> level, <span class="hljs-keyword">string</span> message</span>)</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogInfo</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        Log(<span class="hljs-string">"INFO"</span>, message);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogInfo</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id, <span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        Log(<span class="hljs-string">"INFO"</span>, <span class="hljs-string">$"[<span class="hljs-subst">{id}</span>] message"</span>);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        Log(<span class="hljs-string">"ERROR"</span>, message);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id, <span class="hljs-keyword">string</span> message</span>)</span> =&gt;<font></font>
        Log(<span class="hljs-string">"ERROR"</span>, <span class="hljs-string">$"[<span class="hljs-subst">{id}</span>] <span class="hljs-subst">{message}</span>"</span>);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params">Exception ex</span>)</span> =&gt;<font></font>
        Log(<span class="hljs-string">"ERROR"</span>, ex.Message);<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogError</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> id, Exception ex</span>)</span> =&gt;<font></font>
        Log(<span class="hljs-string">"ERROR"</span>, <span class="hljs-string">$"[<span class="hljs-subst">{id}</span>] <span class="hljs-subst">{ex.Message}</span>"</span>);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はこの実装がよりクリーンで読みやすく（そしてサポートされている）と感じています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトの実装を使用すると、拡張メソッドに比べていくつかの利点があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">これ</font></i><font style="vertical-align: inherit;">が使える</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドだけでなく、インデクサーなどの他の要素も提供できます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの実装は、動作を明確にするためにオーバーロードされる場合があります。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のコードで私を混乱させるのは、どのインターフェースメンバーにデフォルトの実装があり、どれが継承されたクラスが実装する必要があるコントラクトの一部であるかが明確でないことです。 2つのブロックを区切るコメントが役立つかもしれませんが、私はこの点に関して拡張メソッドの厳密な明快さを気に入っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題を解決するために、デフォルトの実装を持つメンバーを持つインターフェースを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に宣言し始めました</font><font style="vertical-align: inherit;">（おそらく非常に単純なものを除く）。次に、デフォルトの実装を、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ILogger.LogInfoDefaults.cs」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ILogger.LogErrorDefaults.cs」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など</font><font style="vertical-align: inherit;">の形式の命名規則を使用して別のファイルに配置します</font><font style="vertical-align: inherit;">。デフォルトの実装がほとんどなく、追加のグループ化の必要がない場合は、ファイルに名前を付けます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ILogger.Defaults.cs」</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、デフォルトの実装を持つメンバーと、実装する必要のある継承されたクラスである実装できないコントラクトが分離されます。</font><font style="vertical-align: inherit;">さらに、非常に長いファイルをカットできます。</font><font style="vertical-align: inherit;">また</font><font style="vertical-align: inherit;">、任意の形式のプロジェクトで</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASP.NET</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタイルの添付ファイルをレンダリングする際に</font><font style="vertical-align: inherit;">は、</font><font style="vertical-align: inherit;">注意</font><font style="vertical-align: inherit;">が必要です。</font><font style="vertical-align: inherit;">これを行うには、プロジェクトファイルまたは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Directory.Build.props</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に追加します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">ItemGroup</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ProjectCapability</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"DynamicDependentFile"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ProjectCapability</span> <span class="hljs-attr">Include</span>=<span class="hljs-string">"DynamicFileNesting"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ItemGroup</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">ソリューションエクスプローラー</font></i><font style="vertical-align: inherit;">で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ファイルのネスト]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を選択する</font><font style="vertical-align: inherit;">と、すべての</font><i><font style="vertical-align: inherit;">.Defaults.cs</font></i><font style="vertical-align: inherit;">ファイルが「メイン」インターフェイスファイルの子孫として表示されます。</font><font style="vertical-align: inherit;">
結論として、拡張メソッドが好まれる状況はまだいくつかあります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェースではなくクラスを通常使用する場合（デフォルトの実装にアクセスするには、オブジェクトをインターフェースにキャストする必要があるため）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートで拡張機能を頻繁に使用する場合：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public static T SomeExt &lt; </font></font></i><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;（this T foo）（例えば</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fluent APIで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja467933/index.html">それでも、PositがIEE​​E 754に代わる価値のある理由</a></li>
<li><a href="../ja467935/index.html">「ブラックボックス」の機能を備えたレコーダーEdic Weeny A110のレビュー</a></li>
<li><a href="../ja467937/index.html">新鮮なWordPressオンラインストアプラグイン</a></li>
<li><a href="../ja467941/index.html">金額の問題</a></li>
<li><a href="../ja467943/index.html">リスクの基礎とビジネス指向の情報セキュリティ：基本概念とパラダイム</a></li>
<li><a href="../ja467951/index.html">Habrastatistics：読者のコメントを分析します。パート2、質問への回答</a></li>
<li><a href="../ja467953/index.html">安価な仮想サーバーのテスト</a></li>
<li><a href="../ja467957/index.html">ファイゲンバウム定数の背後にあるもの</a></li>
<li><a href="../ja467959/index.html">ブラウザの宇宙論と量子ゆらぎ</a></li>
<li><a href="../ja467961/index.html">React.jsを使用してSmartTV用に開発する際の問題とニュアンス</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>