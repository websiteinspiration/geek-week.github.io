<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 🔆 🔼 ラウンドをもたらす脆弱性に注意してください。パート1：FragmentSmack / SegmentSmack 👩🏼‍🤝‍👨🏿 👠 👨🏾‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは！私の名前はドミトリーサムソノフです。私はオドノクラスニキの主要なシステム管理者として働いています。 7000台以上の物理サーバー、クラウド内の11,0​​00個のコンテナ、および200のアプリケーションがあり、異なる構成では700の異なるクラスターを形成しています。 CentO...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ラウンドをもたらす脆弱性に注意してください。パート1：FragmentSmack / SegmentSmack</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/475540/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/kc/qy/tg/kcqytg4znoagvdqffwtwxhwzcjs.jpeg"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
みなさん、こんにちは！私の名前はドミトリーサムソノフです。私はオドノクラスニキの主要なシステム管理者として働いています。 7000台以上の物理サーバー、クラウド内の11,0​​00個のコンテナ、および200のアプリケーションがあり、異なる構成では700の異なるクラスターを形成しています。 CentOS 7を実行しているサーバーの大多数。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018年8月14日に、脆弱性FragmentSmack </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2018-5391</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）およびSegmentSmack（</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">CVE-2018-5390</font></a><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">に関する情報が公開されました。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">これらは、ネットワーク攻撃ベクトルとかなり高い評価（7.5）の脆弱性であり、リソースの枯渇（CPU）によるサービス拒否（DoS）の脅威になります。</font><font style="vertical-align: inherit;">FragmentSmackのカーネルの修正はその時点では提案されていませんでした。さらに、脆弱性に関する情報の公開よりもはるかに遅れて公開されました。</font><font style="vertical-align: inherit;">SegmentSmackを排除するために、カーネルを更新することが提案されました。</font><font style="vertical-align: inherit;">更新パッケージ自体は同じ日にリリースされ、残っているのはそれをインストールすることだけでした。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいえ、カーネルの更新にまったく反対していません！</font><font style="vertical-align: inherit;">しかし、ニュアンスがあります...</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製品のコアをどのように更新するか</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的に、複雑なことは何もありません。</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージをダウンロードする</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを多数のサーバー（私たちのクラウドをホストしているサーバーを含む）にインストールします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何も壊れていないことを確認してください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての標準カーネル設定がエラーなしで適用されていることを確認してください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数日待ちます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーのパフォーマンスを確認します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいサーバーの展開を新しいカーネルに切り替えます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データセンターごとにすべてのサーバーを更新します（問題が発生した場合のユーザーへの影響を最小限に抑えるため、一度に1つのデータセンター）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのサーバーを再起動します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コアのすべてのブランチについて繰り返します。</font><font style="vertical-align: inherit;">現在、これは次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stock CentOS 7 3.10-ほとんどの通常のサーバー用。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バニラ4.19は、</font><font style="vertical-align: inherit;">BFQ、BBRなどが必要なため</font><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つのクラウド</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用</font><font style="vertical-align: inherit;">です。;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elrepo kernel-ml 5.2は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高負荷のディストリビューター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向けです。これは、以前は</font><font style="vertical-align: inherit;">4.19が不安定に動作し、機能には同じものが必要であるためです。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご想像のとおり、何千ものサーバーの再起動には最も時間がかかります。</font><font style="vertical-align: inherit;">すべての脆弱性がすべてのサーバーにとって重大であるとは限らないため、インターネットから直接アクセスできる脆弱性のみを再起動します。</font><font style="vertical-align: inherit;">クラウドでは、柔軟性を制限しないために、外部からアクセス可能なコンテナーを新しいコアを持つ個々のサーバーにバインドしませんが、すべてのホストを例外なく再起動します。</font><font style="vertical-align: inherit;">幸い、手順は通常のサーバーよりも簡単です。</font><font style="vertical-align: inherit;">たとえば、ステートレスコンテナは、再起動中に別のサーバーに移動するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それにもかかわらず、まだ多くの作業があり、数週間かかる場合があります。また、新しいバージョンで問題が発生した場合は、最大で数か月かかります。</font><font style="vertical-align: inherit;">攻撃者はこれをよく知っているので、プランBが必要です。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FragmentSmack / SegmentSmack。</font><font style="vertical-align: inherit;">回避策</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、いくつかの脆弱性については、このような計画「B」が存在し、回避策と呼ばれています。ほとんどの場合、これはカーネル/アプリケーション設定の変更であり、起こり得る影響を最小限に抑えたり、脆弱性の悪用を完全になくしたりできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FragmentSmack / SegmentSmackの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の回避策が提案されました。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.ipv4.ipfrag_high_threshおよびnet.ipv4.ipfrag_low_thresh（およびそれらのipv6 net.ipv6.ipfrag_high_threshおよびnet.ipv6.ipfrag_low_threshの類似物）の4MBおよび3MBのデフォルト値を、それぞれ256 kBおよび192 kB変更できます。</font><font style="vertical-align: inherit;">テストでは、機器、設定、条件に応じて、攻撃中のCPU使用率がわずかから大幅に低下します。</font><font style="vertical-align: inherit;">ただし、一度に2つの64Kフラグメントしか再構築キューに入れることができないため、ipfrag_high_thresh = 262144バイトが原因で、パフォーマンスに多少の影響がある可能性があります。</font><font style="vertical-align: inherit;">たとえば、大きなUDPパケットを処理するアプリケーションが壊れるリスクがあります</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。」</font></font></blockquote><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カーネルのドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
のパラメータ自体</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">は</font></a><font style="vertical-align: inherit;">次のとおりです。</font></font><br>
<br>
<blockquote><code>ipfrag_high_thresh - LONG INTEGER<br>
&nbsp;&nbsp;&nbsp;&nbsp;Maximum memory used to reassemble IP fragments.</code></blockquote><br>
<p></p><blockquote><code>ipfrag_low_thresh - LONG INTEGER<br>
&nbsp;&nbsp;&nbsp;&nbsp;Maximum memory used to reassemble IP fragments before the kernel<br>
&nbsp;&nbsp;&nbsp;&nbsp;begins to remove incomplete fragment queues to free up resources.<br>
&nbsp;&nbsp;&nbsp;&nbsp;The kernel still accepts new fragments for defragmentation.</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
運用サービスでは、大規模なUDPはありません。</font><font style="vertical-align: inherit;">LANには断片化されたトラフィックはなく、WANには重要ではないがトラフィックがあります。</font><font style="vertical-align: inherit;">何も前兆がない-あなたは回避策を転がすことができる！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FragmentSmack / SegmentSmack。</font><font style="vertical-align: inherit;">最初の血</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが最初に遭遇した問題は、クラウドコンテナーが新しい設定を部分的にのみ適用することも（ipfrag_low_threshのみ）、それらをまったく使用しないこともありました-最初にクラッシュしただけです。問題を安定して再現することができませんでした（手動ですべての設定が問題なく適用されました）。コンテナが最初にクラッシュする理由を理解するのも簡単ではありません。エラーは見つかりませんでした。確かなことが1つありました。設定をロールバックすると、コンテナーのドロップの問題が解決します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホストでSysctlを使用するだけでは不十分なのはなぜですか？コンテナは専用のネットワーク名前空間に存在するため</font><font style="vertical-align: inherit;">、コンテナの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ネットワークSysctlパラメータの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少なくとも</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">一部が</font></a><font style="vertical-align: inherit;">ホストと異なる場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテナのSysctl設定はどの程度正確に適用されますか？権限のないコンテナーがあるため、コンテナー自体に移動してSysctl設定を変更すると失敗します-十分な権限がないだけです。当時、私たちのクラウドはDocker（現在は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドマン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を使用してコンテナーを起動していました</font><font style="vertical-align: inherit;">。 APIを介してドッカーは、必要なSysctl設定を含む、新しいコンテナーのパラメーターを渡しました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バージョンを列挙する過程で、Docker APIがすべてのエラーをスローしないことが判明しました（少なくともバージョン1.10では）。 「docker run」を使用してコンテナーを起動しようとしたときに、少なくとも何かが最終的にわかりました。</font></font><br>
<br>
<code>write /proc/sys/net/ipv4/ipfrag_high_thresh: invalid argument docker: Error response from daemon: Cannot start container &lt;...&gt;: [9] System error: could not synchronise with container process.</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パラメータ値が無効です。</font><font style="vertical-align: inherit;">しかし、なぜ？</font><font style="vertical-align: inherit;">そして、なぜそれは時々だけ有効ではないのですか？</font><font style="vertical-align: inherit;">DockerがSysctlパラメータの適用を保証していないことが判明したため（最新のテストバージョンは1.13.1でした）、ipfrag_low_threshがまだ3Mのときにipfrag_high_threshが256Kに設定しようとした場合、つまり上限が下限よりも低く、エラーが発生しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その時点で、起動後にコンテナーを再構成するための独自のメカニズムを既に使用しており（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cgroup freezer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">介してコンテナーを凍結し、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip netns</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を介してコンテナーの名前空間でコマンドを実行しています</font><font style="vertical-align: inherit;">）、この部分にSysctlパラメーターも追加しました。</font><font style="vertical-align: inherit;">問題は解決しました。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FragmentSmack / SegmentSmack。</font><font style="vertical-align: inherit;">最初の血2</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラウドで回避策を使用する方法を理解する前に、ユーザーからの最初のまれな苦情が届き始めました。当時、最初のサーバーでの回避策の開始から数週間が経過しました。最初の調査では、これらのサービスのすべてのサーバーではなく、個々のサービスについて苦情が寄せられていることがわかりました。問題は非常に曖昧な性格を取り戻しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん最初に、もちろん、Sysctl設定をロールバックしようとしましたが、これは何の効果も与えませんでした。サーバーとアプリケーションの設定でのさまざまな操作も役に立ちませんでした。再起動が助けた。 Linuxの再起動は、昔のWindowsでの作業の通常の状態と同じように不自然です。それにもかかわらず、それは助けとなり、Sysctlの新しい設定を適用するときに、すべてを「カーネルの不具合」に書き留めました。なんて軽薄だったのか...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3週間後、問題が再発しました。</font><font style="vertical-align: inherit;">これらのサーバーの構成は非常にシンプルでした：プロキシ/バランサーモードのNginx。</font><font style="vertical-align: inherit;">トラフィックは少しです。</font><font style="vertical-align: inherit;">新しい導入：504エラー（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゲートウェイタイムアウト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">の数は、クライアントで毎日増加しています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">グラフは、このサービスの1日あたりの504エラーの数を示しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/hk/rj/xkhkrjedsakcdrx6m_z8hgcgjsw.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのエラーは、同じバックエンドに関するものです-クラウドにあるものに関するものです。</font><font style="vertical-align: inherit;">このバックエンドでのパケットフラグメントのメモリ消費量のグラフは次のとおりです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jy/fb/gt/jyfbgtoqrbqwv6cird2zawvatza.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、オペレーティングシステムのグラフィックに関する問題の最も印象的な兆候の1つです。</font><font style="vertical-align: inherit;">クラウドでは、同時に、QoS（トラフィック制御）設定で別のネットワークの問題が修正されました。</font><font style="vertical-align: inherit;">パケットフラグメントのメモリ消費量のグラフでは、まったく同じに見えました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/09/nf/4r/09nf4rxogxv9xppeumwujvmcr3m.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮定は単純でした。それらがグラフ上で同じように見えれば、同じ理由があります。さらに、このタイプのメモリに関する問題は非常にまれです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
修正された問題の本質は、QoSでデフォルト設定のfqパケットシェデュラーを使用したことです。デフォルトでは、1つの接続でキューに100パケットを追加できます。チャネルが不足している状況では、一部の接続でキューが失敗して詰まり始めました。この場合、パケットはドロップします。 tc統計（tc -s qdisc）では、次のように表示されます。</font></font><br>
<br>
<code>qdisc fq 2c6c: parent 1:2c6c limit 10000p flow_limit 100p buckets 1024 orphan_mask 1023 quantum 3028 initial_quantum 15140 refill_delay 40.0ms <br>
&nbsp;Sent 454701676345 bytes 491683359 pkt (dropped 464545, overlimits 0 requeues 0) <br>
&nbsp;backlog 0b 0p requeues 0 <br>
&nbsp;&nbsp;1024 flows (1021 inactive, 0 throttled)<br>
&nbsp;&nbsp;0 gc, 0 highprio, 0 throttled, 464545 flows_plimit</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「464545 flows_plimit」-これらは、1つの接続のキューの制限を超えたためにドロップされたパケットであり、「dropped 464545」は、このShedulerのドロップされたすべてのパケットの合計です。</font><font style="vertical-align: inherit;">キューの長さを1000に増やしてコンテナを再起動すると、問題は発生しなくなりました。</font><font style="vertical-align: inherit;">あなたは椅子に座ってスムージーを飲むことができます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FragmentSmack / SegmentSmack。</font><font style="vertical-align: inherit;">最後の血</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、カーネルの脆弱性が発表されてから数か月後、最後にFragmentSmackの修正が表示されました（8月の発表では、SegmentSmackのみの修正がリリースされたことを思い出します）。この間、すでにいくつかのサーバーを新しいカーネルに転送できたので、最初からやり直す必要がありました。 FragmentSmackの修正を待たずにカーネルを更新したのはなぜですか？実際のところ、これらの脆弱性から保護するプロセスは、CentOS自体を更新するプロセス（カーネルのみを更新するよりもさらに時間がかかります）と一致（およびマージ）しました。さらに、SegmentSmackはより危険な脆弱性であり、その修正はすぐに現れたため、いずれにせよ重要な点でした。ただし、CentOS 7.5で発生したFragmentSmackの脆弱性により、CentOSのカーネルを単純に更新することはできませんでした。これはバージョン7.6でのみ修正されたため、7.5へのアップグレードを停止し、7.6へのアップグレードで最初からやり直す必要がありました。そしてそうです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第二に、問題に関するまれなユーザーの苦情が私たちに戻ってきました。今では、それらすべてがクライアントから一部のサーバーへのファイルのダウンロードに接続されていることはすでにわかっています。そして、これらのサーバーを介して、総量から非常に少数のアップロードがありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の話から覚えているように、Sysctlのロールバックは役に立ちませんでした。再起動は助けましたが、一時的に。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sysctlの疑いは解消されませんでしたが、今回はできるだけ多くの情報を収集する必要がありました。また、何が起こっているのかをより正確に調査するために、クライアントのアップロードに関する問題を再現する機能が極端に不足していました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
利用可能なすべての統計とログを分析しても、何が起こっているのかを理解することはできませんでした。</font><font style="vertical-align: inherit;">特定のつながりを「感じる」ために問題を再現する能力が大幅に不足していました。</font><font style="vertical-align: inherit;">最後に、特別なバージョンのアプリケーションの開発者は、Wi-Fi経由で接続したときにテストデバイスで問題を安定して再現することに成功しました。</font><font style="vertical-align: inherit;">これは調査の突破口でした。</font><font style="vertical-align: inherit;">クライアントはNginxに接続し、Javaアプリケーションであるバックエンドにプロキシしました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xw/g8/4a/xwg84aziibg7aaglsv6hdc2vyn8.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題のあるダイアログは次のとおりです（Nginxプロキシ側で修正されました）。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント：ファイルのダウンロードに関する情報を要求します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaサーバー：答え。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント：ファイルを含むPOST。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaサーバー：エラー。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、Javaサーバーは、クライアントから0バイトのデータが受信されたことをログに書き込み、リクエストに30秒以上かかったNginxプロキシ（30秒はクライアントアプリケーションのタイムアウトです）を書き込みます。</font><font style="vertical-align: inherit;">なぜタイムアウトし、なぜ0バイトなのか？</font><font style="vertical-align: inherit;">HTTPの観点からは、すべてが正常に機能しますが、ファイルを含むPOSTはネットワークから消えているようです。</font><font style="vertical-align: inherit;">そして、それはクライアントとNginxの間で消えます。</font><font style="vertical-align: inherit;">Tcpdumpで武装する時が来ました！</font><font style="vertical-align: inherit;">ただし、最初にネットワーク構成を理解する必要があります。</font><font style="vertical-align: inherit;">nginxプロキシは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N3ware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L3バランサの背後にあり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">トンネリングは、L3バランサーからサーバーにパケットを配信するために使用され、サーバーにヘッダーが追加されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hs/ge/mf/hsgemfebrlkpjzvtz-cdrghudxu.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、ネットワークはVLANタグ付きトラフィックの形でこのサーバーに到達し、パケットにフィールドが追加されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/-a/ns/ap/-ansap0a5oyjsnqrf0onvsxg0tw.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、このトラフィックは断片化される可能性があり（回避策のリスクを評価するときに説明した、断片化された着信トラフィックのごく一部）、ヘッダーの内容も変更されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gd/yx/48/gdyx48_bc15aj2xmhn5kb0_omci.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合も、パケットはVLANタグによってカプセル化され、トンネルによってカプセル化され、フラグメント化されます。</font><font style="vertical-align: inherit;">これがどのように発生するかをよりよく理解するために、クライアントからNginxプロキシへのパケットルートをトレースしてみましょう。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージはL3バランサーに到達します。</font><font style="vertical-align: inherit;">データセンター内での正しいルーティングのために、パケットはトンネルでカプセル化され、ネットワークカードに送信されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケット+トンネルヘッダーがMTUに適合しないため、パケットはフラグメントに分割され、ネットワークに送信されます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3バランサーの後のスイッチは、パッケージを受信すると、それにVLANタグを追加し、さらに送信します。</font></font></li>
<li>  Nginx-  (  ),    Vlan- ,   ,  ,   Vlan-.</li>
<li>Linux           .</li>
<li>    Vlan-,       — Vlan-.</li>
<li> Linux    Tunnel-,        — Tunnel-.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は、これらすべてをパラメーターとしてtcpdumpに渡すことです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後から始めましょう：vlanとトンネルのカプセル化が削除されたクライアントからのクリーンな（追加のヘッダーなしの）IPパケットはありますか？</font></font><br>
<br>
<code>tcpdump host &lt;ip &gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいえ、サーバーにそのようなパッケージはありませんでした。したがって、問題はより早いはずです。 VLANカプセル化のみが削除されたパッケージはありますか？</font></font><br>
<br>
<code>tcpdump ip[32:4]=0xx390x2xx</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0xx390x2xxは、16進形式のクライアントIPアドレスです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
32：4-SCR IPがトンネルパケットに書き込まれるフィールドのアドレスと長さ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フィールドのアドレスは、インターネット上で約40、44、50、54と書かれているため、ブルートフォースが選択する必要がありましたが、そこにはIPアドレスがありませんでした。 16進数のパケットの1つ（tcpdumpの-xxまたは-XXパラメーター）を見て、IPが認識しているアドレスを計算することもできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VLANとトンネルのカプセル化が削除されていないパケットフラグメントはありますか？</font></font><br>
<br>
<code>tcpdump ((ip[6:2] &gt; 0) and (not ip[6] = 64))<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この魔法は、最後のものを含むすべての断片を見せてくれます。おそらく同じものをIPでフィルタリングできますが、そのようなパケットはそれほど多くなく、必要なパケットは一般的なストリームで簡単に見つけられたため、私は試しませんでした。</font><font style="vertical-align: inherit;">
これら</font><font style="vertical-align: inherit;">は次のとおりです。</font><font style="vertical-align: inherit;">これらは、1つのパッケージ（同じID 53652）の2つのフラグメントと写真（最初のパッケージにExifという単語が表示されています）です。このレベルにはパッケージがありますが、ダンプには接着されていないため、問題は明らかにアセンブリにあります。最後に、これの記録的な証拠があります！</font><font style="vertical-align: inherit;">
パケットデコーダは、アセンブリを妨げる問題を明らかにしませんでした。ここで試してみました：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">hpd.gasmi.net</font></a></font><br>
<br>
<code>14:02:58.471063 In 00:de:ff:1a:94:11 ethertype IPv4 (0x0800), length 1516: (tos 0x0, ttl 63, <b>id 53652, offset 0</b>, flags [+], proto IPIP (4), length 1500)<br>
&nbsp;&nbsp;&nbsp;&nbsp;11.11.11.11 &gt; 22.22.22.22: truncated-ip - 20 bytes missing! (tos 0x0, ttl 50, id 57750, offset 0, flags [DF], proto TCP (6), length 1500)<br>
&nbsp;&nbsp;&nbsp;&nbsp;33.33.33.33.33333 &gt; 44.44.44.44.80: Flags [.], seq 0:1448, ack 1, win 343, options [nop,nop,TS val 11660691 ecr 2998165860], length 1448<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0000: 0000 0001 0006 00de fb1a 9441 0000 0800 ...........A....<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0010: 4500 05dc d194 2000 3f09 d5fb 0a66 387d E.......?....f8}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0020: 1x67 7899 4500 06xx e198 4000 3206 6xx4 .faEE.....@.2.m.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0030: b291 x9xx x345 2541 83b9 0050 9740 0x04 .......A...P.@..<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0040: 6444 4939 8010 0257 8c3c 0000 0101 080x dDI9...W.\......<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0050: 00b1 ed93 b2b4 6964 xxd8 ffe1 006a 4578 ......ad.....j<b>Ex</b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0060: 6966 0000 4x4d 002a 0500 0008 0004 0100 <b>if</b>..MM.*........<br>
<br>
14:02:58.471103 In 00:de:ff:1a:94:11 ethertype IPv4 (0x0800), length 62: (tos 0x0, ttl 63, <b>id 53652, offset 1480</b>, flags [none], proto IPIP (4), length 40)<br>
&nbsp;&nbsp;&nbsp;&nbsp;11.11.11.11 &gt; 22.22.22.22: ip-proto-4<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0000: 0000 0001 0006 00de fb1a 9441 0000 0800 ...........A....<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0010: 4500 0028 d194 00b9 3f04 faf6 2x76 385x E..(....?....f8}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0020: 1x76 6545 xxxx 1x11 2d2c 0c21 8016 8e43 .faE...D-,.!...C<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0030: x978 e91d x9b0 d608 0000 0000 0000 7c31 .x............|Q<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0040: 881d c4b6 0000 0000 0000 0000 0000 ..............</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最初に、そこに何かを詰め込もうとするとき、デコーダーはパケット形式を好みません。</font><font style="vertical-align: inherit;">SrcmacとEthertypeの間に2つのオクテットが余分にあることがわかりました（フラグメント情報に関連していません）。</font><font style="vertical-align: inherit;">それらを削除した後、デコーダーは機能しました。</font><font style="vertical-align: inherit;">しかし、彼は問題を示さなかった。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたが好きなことを言ってください、それらを除いて、非常にSysctlは何も見つかりませんでした。</font><font style="vertical-align: inherit;">規模を理解し、さらにアクションを決定するために、問題のあるサーバーを特定する方法を見つけることは残りました。</font><font style="vertical-align: inherit;">必要なカウンターはすぐに見つかりました：</font></font><br>
<br>
<code>netstat -s | grep "packet reassembles failed”</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OID = 1.3.6.1.2.1.4.31.1.1.16.1（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipSystemStatsReasmFails</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">下のsnmpdにもあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「IP再構成アルゴリズムによって検出された障害の数（何らかの理由で：タイムアウト、エラーなど）。」</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題が調査されたサーバーのグループの中で、このカウンターは2つでより速く、2つで-より遅く、2つでまったく増加しませんでした。このカウンターのダイナミクスとJavaサーバーのHTTPエラーのダイナミクスを比較すると、相関関係が明らかになりました。つまり、カウンタを監視できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のストーリーからはアプリケーションからすぐに理解することは不可能であることを知っているため、Sysctlロールバックが役立つかどうかを正確に判断できるように、問題の信頼できるインジケーターを持つことは非常に重要です。このインジケーターは、ユーザーが気付く前に、プロダクション内のすべての問題領域を特定できるようにします。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sysctlロールバック後、監視エラーが停止したため、問題の原因と、ロールバックが役立つことが証明されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい監視が発火した他のサーバーと、デフォルトで以前よりもさらに多くのメモリをフラグメントに割り当てた他のサーバーの断片化設定をロールバックしました（これはudp-statisticsでしたが、一般的な背景に対して部分的な損失は目立ちませんでした）。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最も重要な質問</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L3バランサーでパッケージが断片化するのはなぜですか？ユーザーからバランサーに到着するほとんどのパッケージは、SYNとACKです。これらのバッグのサイズは小さいです。しかし、そのようなパッケージのシェアは非常に大きいので、その背景から、断片化し始めた大きなパッケージの存在に気づきませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その理由は、</font><font style="vertical-align: inherit;">VLANインターフェースを備えたサーバーで</font><font style="vertical-align: inherit;">advmss構成</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が壊れていたためです</font><font style="vertical-align: inherit;">（その時点で、本番</font><font style="vertical-align: inherit;">環境</font><font style="vertical-align: inherit;">でタグ付きトラフィックを備えたサーバーはほとんどありませんでした）。 Advmssを使用すると、方向のパケットを小さくする必要があるという情報をクライアントに伝えることができるため、トンネルヘッダーをそれらに接着した後、フラグメント化する必要がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜSysctlロールバックが助けなかったのに、再起動が助けになったのですか？</font><font style="vertical-align: inherit;">Sysctl rollbackは、パッケージの接着に使用可能なメモリの量を変更しました。</font><font style="vertical-align: inherit;">同時に、フラグメントのメモリオーバーフローという事実自体が接続の阻害につながり、フラグメントがキュー内で長時間遅延するという事実につながりました。</font><font style="vertical-align: inherit;">つまり、プロセスがループしています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
反論は記憶を無効にし、すべてが秩序だった。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回避策を省略できますか？</font><font style="vertical-align: inherit;">はい。ただし、攻撃が発生した場合にユーザーを放置するという大きなリスクがあります。</font><font style="vertical-align: inherit;">もちろん、結果として回避策を使用すると、ユーザーによるサービスの1つを禁止するなど、さまざまな問題が発生しましたが、それでも、アクションは正当化されたと考えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Andrei Timofeev（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atimofeyev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）調査実施の支援、およびアレクセイ・クレネフ（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devicex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-サーバー上のCentosとコアを更新するという大規模な作業のため。</font><font style="vertical-align: inherit;">プロセスは、この場合、最初から数回開始する必要がありましたが、何ヶ月も続いたためです。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja475518/index.html">カナダの会社があなたを見えなくする素材を開発しました</a></li>
<li><a href="../ja475520/index.html">0pxからautoへの高さプロパティのCSS遷移</a></li>
<li><a href="../ja475522/index.html">HP：元のドライブはまったくオリジナルではありません。誰が責任を負い、何をすべきか？</a></li>
<li><a href="../ja475536/index.html">フリーランス翻訳者のために再開</a></li>
<li><a href="../ja475538/index.html">マーケットプレイスの作成はどこから始まりますか。パート1</a></li>
<li><a href="../ja475542/index.html">2013年以降のメールマーケティングの変化：4つの主な傾向と現在の統計</a></li>
<li><a href="../ja475544/index.html">製品、サービスなどのカタログ</a></li>
<li><a href="../ja475546/index.html">中毒性の症候群IT</a></li>
<li><a href="../ja475548/index.html">不均衡とキューのない退屈なマッチメイキング：実用的なガイド</a></li>
<li><a href="../ja475550/index.html">オープンタイプの部屋のための音響システム</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>