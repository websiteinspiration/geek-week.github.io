<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòâ üí± üë®üèª‚Äçüíª Smoking Detection Complex by photo or video based on Intel NUC üéÜ üíÉüèø üî®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post, we will talk about how we solved the problem of determining the fact of smoking through object video analytics on Intel NUC. At the inpu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smoking Detection Complex by photo or video based on Intel NUC</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/intel/blog/493726/"><img src="https://habrastorage.org/getpro/habr/post_images/0c8/395/be4/0c8395be4749da9c4a122bb0f0bbcc1f.jpg" alt="Intel NUC8i5BEK"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this post, we will talk about how we solved the problem of determining the fact of smoking through object video analytics on Intel NUC. </font><font style="vertical-align: inherit;">At the input, video streams from surveillance cameras that are decoded are cut into frames on the computer, and then each frame (taking into account the frame rate divider) is given to a neural network that detects the presence of a fact of smoking and returns the probability of an event.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let us consider in more detail the problems, the main differences from the solutions existing on the market, as well as the obtained indicators for speed and number of threads. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General issues</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Russia, on June 1, 2014, new norms of the Anti-Tobacco Law came into force. The law against tobacco regulates relations arising in the field of protecting the health of citizens from the effects of surrounding tobacco smoke and the consequences of tobacco consumption: smoking is prohibited on long-distance trains, on passenger platforms, in hostels and hotels, retail premises, markets, cafes, bars, restaurants . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to combat smoking, many states have introduced a law banning smoking in public places. In all offices and theaters, ‚Äúsmoking rooms‚Äù were eliminated, and smoking rooms were removed in catering establishments.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The introduction of the prohibitions described above involves monitoring compliance with established rules and regulations. </font><font style="vertical-align: inherit;">To date, a variety of dust sensors and gas analyzers (e.g. CO2) are used for this purpose. </font><font style="vertical-align: inherit;">The general principle of operation of these devices is as follows: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/81/rm/fi/81rmfi5soiqy-n0fhcydxczgume.png" alt="The general principle of operation of various dust collection sensors and gas analyzers"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The sensor detects changes in the environment, and the control microcontroller creates a reaction event according to a predetermined algorithm. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An alternative to dust collection sensors and gas analyzers can be object video analytics using neural networks, where the input is a photo or video stream from a surveillance camera, and the output is the probability of the presence of tobacco smoking or other compositions in the frame or set of frames.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General block diagram of a hardware-software complex</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are several options for implementing the complex:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Separate system in compact design for installation on site</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Centralized system with data transmission and processing in the data center with the ability to use existing video surveillance systems</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A hybrid option, when part of the data is processed in the immediate vicinity of the data source, and part is processed in the data center with centralized storage of the results of both systems</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's consider them in more detail: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/k-/zj/fmk-zjhn4x5ohukja8jmpfje9fc.png" alt="General block diagram of a hardware-software complex for smoking detection"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Composition of the complex when used in the immediate vicinity of the data source:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP camera / camera with direct connection or a set of cameras (used as a data source).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Switch (when connecting more than one data source).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executive device, Intel NUC8i5BEK calculator.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the low cost of the hardware and software complex, a lot of significant and significant security tasks are solved, such as:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoring compliance with fire safety rules with high accuracy and with photo-recording of the fact of the offense (including data on the time, date, place of the offense) </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identification of facts of offenses at hazardous industries and companies whose activities are associated with the use of flammable and fuels and lubricants</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitoring compliance with internal regime at sensitive facilities</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A valid use case is a server architecture, in which data from cameras is transmitted to the data center for further processing: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-r/tg/xh/-rtgxh2gboodzm8nbhvslb6z6i8.png" alt="Server architecture, in which data from cameras are transmitted to the data center for further processing"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When scaling and using this scheme, as a device for centralized inference, it is assumed to use the same Intel NUC8i5BEK, but in a different form factor (server 1U) :</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j2/3b/t7/j23bt7laybcszwbzlp8zid7l9a0.png" alt="Server for executing neural networks based on 8 Intel NUC8i5BEK"><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description of the principle of detection of the fact of smoking</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To detect the fact of smoking in the photo (frames of the incoming video stream), the neural network topology SSD Mobilenet v2 from the Open Model Zoo is used. The network is pre-trained on the COCO dataset and further trained on Tensorflow. Next, the model is converted through Intel OpenVINO for further operation on the CPU / GPU in order to optimize the cost of FPS. Model performance after conversion: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1c/u-/st/1cu-stxijzjwy1xrf__dqdrjqa8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total on a single Intel NUC8i5BEK with a frame divider value of 5 (25 FPS / 5 = 5 FPS at the input), up to 40 streams can be processed without taking into account the cost of decoding. When using VAAPI hardware decoding and the latest intel-media-driver, decoding costs will be minimal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the advantages of the Intel OpenVINO framework is the ability to transfer networks between different devices, for example, the same model with minimal modification can be run on CPU, GPU, FPGA, VPU and other devices. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the sake of the experiment, a model for detecting the fact of smoking was launched on the Intel Neural Compute Stick 2 based on Myriad X. Results: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/xi/0m/fnxi0mymffxhuo3jqesocolcozu.png"><br>
<br>
<img src="https://habrastorage.org/webt/0j/lo/54/0jlo5481awaudqqack7ksqbt_sa.png" alt="Smoking Detection Launched on Intel Neural Compute Stick 2 Based on Myriad X"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on industrial PCs with motherboards from AAEON or other manufacturers with integrated MyriadX chips, you can already get and use industrial solutions. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/55b/328/1b4/55b3281b45f08a53629d28d400c92a3e.jpg"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To demonstrate the operation of the neural network, the Telegram bot was implemented - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://t.me/smokers_recognition_bot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The input is the image, and the output is the probability of the fact of smoking on it. </font><font style="vertical-align: inherit;">We try, watch, experiment ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The interference is performed on the Intel NUC8i5BEK GPU. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i2/u3/ja/i2u3jaaxtfnuf531-sqs57ioyxs.png"><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solution Benefits</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following advantages can be noted:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Availability of processing data from multiple sources in one place</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Possibility of detecting the fact of smoking at a distance limited only by the focal length of the camera, data source, for example, 5, 50 or 100 m (such indicators cannot be obtained with classical sensors and / or devices) </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Possibility of detecting smoking not only classic cigarettes, but also other devices (for example, vapes or smoking mixtures) </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The ability to save the fact of the offense (photo and event metadata, such as date, time, location) when smoking in the wrong places</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Possibility of retrofitting existing chambers with a function of detecting the fact of smoking and reactions to this event</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Availability of integration with existing monitoring systems and video surveillance systems, for example, Zabbix, Telegraf, Hikvision NVR, etc. </font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application Areas</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider some objects and problems for the application of the described hardware-software complex for smoking detection in the video stream:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Corridors of business centers and other buildings and structures, stairwells</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schools and kindergartens (due to the inefficiency of smoke detectors and other existing solutions in open space and in blown zones)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gas station (due to the inefficiency of smoke sensors and other existing solutions in the open space and in the blown zones)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metro (due to the large area, ceiling heights and the ability to connect multiple cameras into a single system)</font></font></li>
<li>    (-  ,          )</li>
<li> ,  (-  ,  ,        )</li>
<li>    (      )</li>
<li>,  (      )</li>
<li> (      )</li>
</ul><br>
<div class="spoiler"><b class="spoiler_title"> ,          </b><div class="spoiler_text"><img src="https://habrastorage.org/webt/eh/xg/w2/ehxgw27opqk-iolhzbfv-qa9rpy.png"><br>
<img src="https://habrastorage.org/webt/4m/c3/gl/4mc3glbwrk3nk4fgnl8g8_-aqhy.png"><br>
<img src="https://habrastorage.org/webt/ue/fl/uq/uefluqsubwa62mhb5q_pvftiube.png"><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en493714/index.html">Security Cheat Sheets: Nodejs</a></li>
<li><a href="../en493716/index.html">Type inference with TypeScript using the as const construct and the infer keyword</a></li>
<li><a href="../en493718/index.html">Discussion: standard UNIX utilities that few have used and are currently using</a></li>
<li><a href="../en493720/index.html">The perfect storm: how technology is changing the food service industry</a></li>
<li><a href="../en493724/index.html">RPA | Process robotization through the eyes of an analyst</a></li>
<li><a href="../en493728/index.html">Nine tips from a meteorologist on the topic: how not to get into a puddle with the weather forecast this spring (on the occasion of March 23)</a></li>
<li><a href="../en493730/index.html">How not to protect your systems in the cloud</a></li>
<li><a href="../en493732/index.html">Yesterday it was impossible, but today it is necessary: ‚Äã‚Äãhow to start working remotely and not cause a leak?</a></li>
<li><a href="../en493734/index.html">Perfectionism, cancellation: how technical specialists write articles</a></li>
<li><a href="../en493736/index.html">Security Week 13: Home Safety</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>