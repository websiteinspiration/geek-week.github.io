<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∞ üõë üë®üèΩ‚Äçüé® Smart Home: Build Water and Electricity Charts in Home Assistant ü§≤üèø „äôÔ∏è ü¶â</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every time I receive a bill for electricity and water, I wonder - is my family really consuming so much? Well, yes, the bathroom has a heated floor an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Smart Home: Build Water and Electricity Charts in Home Assistant</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492314/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/lf/i3/wjlfi38qar57vvhqgpwuzdalerw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Every time I receive a bill for electricity and water, I wonder - is my family really consuming so much? Well, yes, the bathroom has a heated floor and a boiler, but they don‚Äôt constantly stoke. We also seem to save water (although we also love splashing in the bathroom). A few years ago, I already </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connected water</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">electricity </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">meters</font></a><font style="vertical-align: inherit;"> to a smart home, but this was stuck on this. Hands got to the analysis of consumption only now, about which, in fact, this article is about. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I recently switched to Home Assistant as a smart home system. One of the reasons was just the opportunity to organize the collection of a large amount of data with the possibility of conveniently constructing various kinds of graphs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The information described in this article is not new, all of these things with different sauces have already been described on the Internet. </font><font style="vertical-align: inherit;">But each article, as a rule, describes only one approach or aspect. </font><font style="vertical-align: inherit;">I had to compare all these approaches and choose the most suitable one myself. </font><font style="vertical-align: inherit;">The article still does not provide comprehensive information on data collection, but it is a kind of synopsis of how I did. </font><font style="vertical-align: inherit;">So constructive criticism and suggestions for improvement are welcome.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulation of the problem</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, the goal of today's exercise is to get beautiful graphs of water and electricity consumption:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hourly for 2 days</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daily for 2 weeks</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(optional) weekly and monthly</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is where some difficulties await us:</font></font><br>
<br>
<ul>
<li>  ,  ,  .         . <br>
<br>
  ,     ,     .  home assistant,  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">mini-graph-card</a>,     :<br>
<br>
<ul>
<li>        (     ,         )</li>
<li>       (   ,      )</li>
</ul></li>
<li> ,  home assistant        SQLite <s>( , ,    MySQL  Postgres)</s>,        . , ,               json   <br>
<br>
<pre><code class="json hljs">{<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"old_state"</span>: {<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"state"</span>: <span class="hljs-string">"3"</span>, <span class="hljs-attr">"attributes"</span>: {<span class="hljs-attr">"source"</span>: <span class="hljs-string">"sensor.water_meter_cold"</span>, <span class="hljs-attr">"status"</span>: <span class="hljs-string">"collecting"</span>, <span class="hljs-attr">"last_period"</span>: <span class="hljs-string">"29"</span>, <span class="hljs-attr">"last_reset"</span>: <span class="hljs-string">"2020-02-23T21:00:00.022246+02:00"</span>, <span class="hljs-attr">"meter_period"</span>: <span class="hljs-string">"hourly"</span>, <span class="hljs-attr">"unit_of_measurement"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-attr">"friendly_name"</span>: <span class="hljs-string">"water_cold_hourly"</span>, <span class="hljs-attr">"icon"</span>: <span class="hljs-string">"mdi:counter"</span>}, <span class="hljs-attr">"last_changed"</span>: <span class="hljs-string">"2020-02-23T19:05:06.897604+00:00"</span>, <span class="hljs-attr">"last_updated"</span>: <span class="hljs-string">"2020-02-23T19:05:06.897604+00:00"</span>, <span class="hljs-attr">"context"</span>: {<span class="hljs-attr">"id"</span>: <span class="hljs-string">"aafc8ca305ba4e49ad4c97f0eddd8893"</span>, <span class="hljs-attr">"parent_id"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"user_id"</span>: <span class="hljs-literal">null</span>}}, <span class="hljs-attr">"new_state"</span>: {<span class="hljs-attr">"entity_id"</span>: <span class="hljs-string">"sensor.water_cold_hourly"</span>, <span class="hljs-attr">"state"</span>: <span class="hljs-string">"4"</span>, <span class="hljs-attr">"attributes"</span>: {<span class="hljs-attr">"source"</span>: <span class="hljs-string">"sensor.water_meter_cold"</span>, <span class="hljs-attr">"status"</span>: <span class="hljs-string">"collecting"</span>, <span class="hljs-attr">"last_period"</span>: <span class="hljs-string">"29"</span>, <span class="hljs-attr">"last_reset"</span>: <span class="hljs-string">"2020-02-23T21:00:00.022246+02:00"</span>, <span class="hljs-attr">"meter_period"</span>: <span class="hljs-string">"hourly"</span>, <span class="hljs-attr">"unit_of_measurement"</span>: <span class="hljs-string">"l"</span>, <span class="hljs-attr">"friendly_name"</span>: <span class="hljs-string">"water_cold_hourly"</span>, <span class="hljs-attr">"icon"</span>: <span class="hljs-string">"mdi:counter"</span>}, <span class="hljs-attr">"last_changed"</span>: <span class="hljs-string">"2020-02-23T19:11:11.251545+00:00"</span>, <span class="hljs-attr">"last_updated"</span>: <span class="hljs-string">"2020-02-23T19:11:11.251545+00:00"</span>, <span class="hljs-attr">"context"</span>: {<span class="hljs-attr">"id"</span>: <span class="hljs-string">"0de64b8af6f14bb9a419dcf3b200ef56"</span>, <span class="hljs-attr">"parent_id"</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">"user_id"</span>: <span class="hljs-literal">null</span>}}}</code></pre><br>
     (    ,    ),         .      SDM220      10-15 ,         8.      ,      . ..         100-200  .      ,      (    home assistant  raspberry PI),            .</li>
<li>  ,      .           <s> </s>   .           (RS232/RS485/Modbus/Zigbee)   .<br>
<br>
         (    ),      X -  .            .         ,        . , ,        home assistant,          ,             (  home assistant).</li>
</ul><br>
<h2> 1</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
First, let's see what the home assistant is provided out of the box. Measuring consumption over a period is a highly demanded functionality. Of course, it was realized a long time ago in the form of a specialized component - utility_meter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The essence of the component is that inside it starts the variable current_accumulated_value, and resets it after a specified period (hour / week / month). The component itself monitors the incoming variable (the value of some kind of sensor), subscribes to changes in the value itself - you just get the finished result. This thing is described in just a few lines in the configuration file.</font></font><br>
<br>
<pre><code class="python hljs">utility_meter:<font></font>
  water_cold_hour_um:<font></font>
    source: sensor.water_meter_cold<font></font>
    cycle: hourly<font></font>
  water_cold_day_um:<font></font>
    source: sensor.water_meter_cold<font></font>
    cycle: daily<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here sensor.water_meter_cold is the current value of the counter in liters, which I get </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directly from the piece of iron</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by mqtt. The design creates 2 new sensors water_cold_hour_um and water_cold_day_um, which accumulate hourly and daily readings, resetting them after a period. Here's a half-hour battery chart. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/le/u3/fk/leu3fkbgddojjis_lmcawt6gcv4.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The hourly and daily chart code for lovelace-UI looks like this:</font></font><br>
<br>
<pre><code class="python hljs">      - type: history-graph<font></font>
        title: <span class="hljs-string">'Hourly water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">48</span><font></font>
        entities:<font></font>
          - sensor.water_hour<font></font>
<font></font>
      - type: history-graph<font></font>
        title: <span class="hljs-string">'Daily water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">360</span><font></font>
        entities:<font></font>
          - sensor.water_day<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actually, the problem of this approach lies in this algorithm. As I mentioned, for each input value (the current meter reading for each next liter), 1kb of record is generated in the database. Each utility meter also generates a new value, which also adds up to the database. If I want to collect hourly / daily / weekly / monthly readings, and for several water risers, and even add a bunch of electric meters - this will be a lot of data. Well, more precisely, there is not much data, but since the home assistant writes to the database a bunch of unnecessary information, the size of the database will grow by leaps and bounds. I'm afraid even to estimate the size of the base for weekly and monthly charts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, the utility meter alone does not solve the task. </font><font style="vertical-align: inherit;">The graph of values ‚Äã‚Äãthat the utility meter gives is a monotonically increasing function that resets to 0 every hour. </font><font style="vertical-align: inherit;">We need a user-friendly consumption chart, how many liters were eaten during the period. </font><font style="vertical-align: inherit;">The standard history-graph component does not know how to do this, but the external mini-graph-card component can help us. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the card code for lovelace-UI:</font></font><br>
<br>
<pre><code class="python hljs">      - aggregate_func: max<font></font>
        entities:<font></font>
          - color: var(--primary-color)<font></font>
            entity: sensor.water_cold_hour_um<font></font>
        group_by: hour<font></font>
        hours_to_show: <span class="hljs-number">48</span>
        name: <span class="hljs-string">"Hourly water consumption aggregated by utility meter"</span>
        points_per_hour: <span class="hljs-number">1</span><font></font>
        show:<font></font>
          graph: bar<font></font>
        type: <span class="hljs-string">'custom:mini-graph-card'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to standard settings like the name of the sensor, type of graph, color (I did not like the standard orange), it is important to note 3 settings:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">group_by: hour - the chart will be generated with the columns aligned at the beginning of the hour</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">points_per_hour: 1 - one bar for every hour</font></font></li>
<li>  , aggregate_func: max ‚Äî       .         </li>
</ul><br>
<img src="https://habrastorage.org/webt/yj/du/c7/yjduc7nhxnq18qvcityd_ul91y0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do not pay attention to a number of columns on the left - this is the standard behavior of a component if there is no data. And there was no data - I only turned on utility meter data collection just a couple of hours ago just for the sake of this article (I will tell you my current approach a bit later). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this picture, I wanted to show that sometimes the data display even works, and the bars really reflect the correct values. But that's not all. The selected column for the interval from 11 to 12 in the morning for some reason displays 19 liters, although on the toothy chart a little higher for the same period we see consumption of 62 liters from the same sensor. Either a bug or hands are crooked. But I don‚Äôt understand why the data on the right broke off - the consumption there was normal, which is also visible on the toothy schedule.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, I did not manage to achieve the credibility of this approach - the graph almost always shows some kind of heresy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same code for the day sensor.</font></font><br>
<br>
<pre><code class="python hljs">      - aggregate_func: max<font></font>
        entities:<font></font>
          - color: var(--primary-color)<font></font>
            entity: sensor.water_cold_day_um<font></font>
        group_by: interval<font></font>
        hours_to_show: <span class="hljs-number">360</span>
        name: <span class="hljs-string">"Daily water consumption aggregated by utility meter"</span>
        points_per_hour: <span class="hljs-number">0.0416666666</span><font></font>
        show:<font></font>
          graph: bar<font></font>
        type: <span class="hljs-string">'custom:mini-graph-card'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that the group_by parameter is set to interval, and the points_per_hour parameter rules everything. </font><font style="vertical-align: inherit;">And this is another problem of this component - points_per_hour works well on graphs in an hour or less, but disgusting at large intervals. </font><font style="vertical-align: inherit;">So to get one column in one day, I had to enter the value 1/24 = 0.04166666. </font><font style="vertical-align: inherit;">I'm not talking about weekly and monthly charts.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Approach 2</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just figuring out the home assistant, I came across this video here:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-0HrYFCRH0M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A friend collects consumption data from several types of Xiaomi outlets. His task is a little easier - just display the value of consumption for today, yesterday and for the month. No schedules are required. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let us leave aside the discussion about the manual integration of instantaneous power values ‚Äã‚Äã- I already wrote about the ‚Äúaccuracy‚Äù of this approach. It is not clear why he did not use the accumulated consumption values, which are already collected by the same outlet. In my opinion, integration inside the piece of iron will work better. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the video we take the idea of ‚Äã‚Äãmanually calculating the consumption for the period. The peasant only counts the values ‚Äã‚Äãfor today and yesterday, but we will go further and try to draw a graph. The essence of the proposed method in my case is as follows.</font></font><br>
<br>
<ul>
<li>  ___,      </li>
<li>     (   )          .         ‚Äî    ,         . </li>
<li>  ‚Äú‚Äù  ___     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this can be done </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">through w ...</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> means of the home assistant himself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You will have to write some more code than in the previous approach. </font><font style="vertical-align: inherit;">To get started, let's get these very ‚Äúvariables." </font><font style="vertical-align: inherit;">Out of the box, we don‚Äôt have the ‚Äúvariable‚Äù entity, but you can use the services of the mqtt broker. </font><font style="vertical-align: inherit;">We will send values ‚Äã‚Äãwith the retain = true flag there - this will save the value inside the broker, and you can pull it out at any time, even when the home assistant reboots. </font><font style="vertical-align: inherit;">I made hour and day counters right away.</font></font><br>
<br>
<pre><code class="python hljs">- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/hour"</span><font></font>
  name: water_hour<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/hour_begin"</span><font></font>
  name: water_hour_begin<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/day"</span><font></font>
  name: water_day<font></font>
  unit_of_measurement: l<font></font>
<font></font>
- platform: mqtt<font></font>
  state_topic: <span class="hljs-string">"test/water/day_begin"</span><font></font>
  name: water_day_begin<font></font>
  unit_of_measurement: l</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All magic happens in automation, which runs every hour and every night, respectively.</font></font><br>
<br>
<pre><code class="python hljs">- id: water_new_hour<font></font>
  alias: water_new_hour<font></font>
  initial_state: true<font></font>
  trigger:<font></font>
    - platform: time_pattern<font></font>
      minutes: <span class="hljs-number">0</span><font></font>
  action:<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/hour"</span><font></font>
        payload_template: &gt;<font></font>
          {{ (states.sensor.water_meter_cold.state|int) - (states.sensor.water_hour_begin.state|int) }}<font></font>
        retain: true<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/hour_begin"</span><font></font>
        payload_template: &gt;<font></font>
          {{ states.sensor.water_meter_cold.state }}<font></font>
        retain: true<font></font>
<font></font>
- id: water_new_day<font></font>
  alias: water_new_day<font></font>
  initial_state: true<font></font>
  trigger:<font></font>
    - platform: time<font></font>
      at: <span class="hljs-string">"00:00:00"</span><font></font>
  action:<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/day"</span><font></font>
        payload_template: &gt;<font></font>
          {{ (states.sensor.water_meter_cold.state|int) - (states.sensor.water_day_begin.state|int) }}<font></font>
        retain: true<font></font>
    - service: mqtt.publish<font></font>
      data:<font></font>
        topic: <span class="hljs-string">"test/water/day_begin"</span><font></font>
        payload_template: &gt;<font></font>
          {{ states.sensor.water_meter_cold.state }}<font></font>
        retain: true</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Both automation perform 2 actions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The value for the interval is calculated as the difference between the start and end value</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update base value for next interval</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The graphing in this case is solved by the usual history-graph:</font></font><br>
<br>
<pre><code class="python hljs">      - type: history-graph<font></font>
        title: <span class="hljs-string">'Hourly water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">48</span><font></font>
        entities:<font></font>
          - sensor.water_hour<font></font>
<font></font>
      - type: history-graph<font></font>
        title: <span class="hljs-string">'Daily water consumption using vars'</span>
        hours_to_show: <span class="hljs-number">360</span><font></font>
        entities:<font></font>
          - sensor.water_day</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rp/nn/ah/rpnnahsspezbcydtjmhlu6kb53w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In principle, this is already what you need. </font><font style="vertical-align: inherit;">The advantage of this method is that the data is generated once per interval. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">only 24 entries per day for the hourly chart. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, this still does not solve the general problem of a growing base. </font><font style="vertical-align: inherit;">If I want a monthly consumption schedule, I will have to store data for at least a year. </font><font style="vertical-align: inherit;">And since the home assistant provides only one setting for the duration of storage for the entire database, this means that ALL data in the system will have to be stored for a whole year. </font><font style="vertical-align: inherit;">For example, for a year I consume 200 cubic meters of water, which means that it is 200,000 records in the database. </font><font style="vertical-align: inherit;">And if you take into account other sensors, the figure becomes indecent at all.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Approach 3</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, smart people have already solved this problem by writing the InfluxDB database. This database is specially optimized for storing time-based data and is ideal for storing values ‚Äã‚Äãof different sensors. The system also provides an SQL-like query language that allows you to pick out values ‚Äã‚Äãfrom the database, and then aggregate them in various ways. Finally, different data can be stored at different times. For example, frequently changing readings such as temperature or humidity can be stored for only a couple of weeks, while daily readings of water consumption can be stored for a whole year.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to InfluxDB, smart people also invented Grafana, a charting system based on data from InfluxDB. </font><font style="vertical-align: inherit;">Grafana can draw different types of graphs, customize them in detail, and, most importantly, these graphs can be ‚Äústuck‚Äù on the lovelace-UI home assistant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get inspired </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The articles describe in detail the process of installing and connecting InfluxDB and Grafana to the home assistant. </font><font style="vertical-align: inherit;">I will focus on solving my specific problem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, first of all, let's start adding up the counter value in influxDB. </font><font style="vertical-align: inherit;">A piece of the home assistant configuration (in this example, I will have fun not only with cold, but also with hot water):</font></font><br>
<br>
<pre><code class="python hljs">influxdb:<font></font>
  host: localhost<font></font>
  max_retries: <span class="hljs-number">3</span><font></font>
  default_measurement: state<font></font>
  database: homeassistant<font></font>
  include:<font></font>
    entities:<font></font>
      - sensor.water_meter_hot<font></font>
      - sensor.water_meter_cold</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Turn off the saving of the same data to the internal database of the home assistant so as not to inflate it once again:</font></font><br>
<br>
<pre><code class="python hljs">recorder:<font></font>
  purge_keep_days: <span class="hljs-number">10</span>
  purge_interval: <span class="hljs-number">1</span><font></font>
  exclude:<font></font>
    entities:<font></font>
      - sensor.water_meter_hot<font></font>
      - sensor.water_meter_cold</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We now go to the InfluxDB console and set up our database. In particular, you need to configure how long this or that data will be stored. This is regulated by the so-called retention policy - this is similar to the databases inside the main database, with each internal database having its own settings. By default, all data is stored in a retention policy called autogen, this data will be stored for a week. I would like the hourly data to be stored for a month, the weekly for a year, and the monthly should never be deleted at all. Create appropriate retention policy</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"month"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> <span class="hljs-number">30</span>d <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"year"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> <span class="hljs-number">52</span>w <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">RETENTION</span> <span class="hljs-keyword">POLICY</span> <span class="hljs-string">"infinite"</span> <span class="hljs-keyword">ON</span> <span class="hljs-string">"homeassistant"</span> <span class="hljs-keyword">DURATION</span> INF <span class="hljs-keyword">REPLICATION</span> <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now, in fact, the main trick is data aggregation using continuous query. </font><font style="vertical-align: inherit;">This is a mechanism that automatically starts a query at specified intervals, aggregates data for this query, and adds the result to a new value. </font><font style="vertical-align: inherit;">Let's look at an example (I write in a column for readability, but in fact I had to enter this command in one line)</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> CONTINUOUS <span class="hljs-keyword">QUERY</span> cq_water_hourly <span class="hljs-keyword">ON</span> homeassistant 
<span class="hljs-keyword">BEGIN</span> 
  <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">value</span> 
  <span class="hljs-keyword">INTO</span> homeassistant.month.water_meter_hour 
  <span class="hljs-keyword">FROM</span> homeassistant.autogen.l 
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>h), entity_id fill(previous) 
<span class="hljs-keyword">END</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This command:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creates a continuous query named cq_water_cold_hourly in the homeassistant database</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The request will be executed every hour (time (1h))</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The request will retrieve all the data from the measurement'a homeassistant.autogen.l (liters), including the readings of cold and hot water</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aggregated data will be grouped by entity_id, which will create separate values ‚Äã‚Äãfor cold and hot water.</font></font></li>
<li>               ,      max(value) </li>
<li>     homeassistant.month.water_meter_hour,  month   retention policy     .               entity_id     value</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At night or when nobody is at home there is no water consumption, and accordingly there are no new entries in homeassistant.autogen.l either. To avoid missing values ‚Äã‚Äãin regular queries, you can use fill (previous). This will force InfluxDB to use the past hour value. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, continuous query has a peculiarity: the fill (previous) trick does not work and records are simply not created. Moreover, this is some insurmountable problem that has been </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussed for more than a year</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . We will deal with this problem later, and let fill (previous) in continuous query be - it does not interfere. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's check what happened (of course, you need to wait a couple of hours):</font></font><br>
<br>
<pre><code class="python hljs">&gt; select * <span class="hljs-keyword">from</span> homeassistant.month.water_meter_hour group by entity_id<font></font>
...<font></font>
name: water_meter_hour<font></font>
tags: entity_id=water_meter_cold<font></font>
time                 value<font></font>
----                 -----<font></font>
...<font></font>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T01:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370511</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T02:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370513</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T05:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370527</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T06:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370605</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T07:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370635</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T08:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370699</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T09:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370761</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370767</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T11:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370810</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T12:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370818</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T13:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370827</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T14:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370849</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T15:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">370921</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that the values ‚Äã‚Äãin the database are stored in UTC, therefore in this list they differ by 3 hours - the values ‚Äã‚Äãfor 7 am in the InfluxDB output correspond to the values ‚Äã‚Äãfor 10 am in the graphs above. </font><font style="vertical-align: inherit;">Also note that between 2 and 5 in the morning there are simply no records - this is the same feature of continuous query. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, the aggregated value is also a monotonously increasing sequence, only records are less frequent - once per hour. </font><font style="vertical-align: inherit;">But this is not a problem - we can write another query that will produce the correct data for the chart.</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">difference</span>(<span class="hljs-keyword">max</span>(<span class="hljs-keyword">value</span>)) 
<span class="hljs-keyword">FROM</span> homeassistant.month.water_meter_hour 
<span class="hljs-keyword">WHERE</span> entity_id=<span class="hljs-string">'water_meter_cold'</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &gt;= <span class="hljs-keyword">now</span>() <span class="hljs-number">-24</span>h 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>h), entity_id <font></font>
fill(previous)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will decrypt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the homeassistant.month.water_meter_hour database, we extract the data for entity_id = 'water_meter_cold' for the last day (time&gt; = now () -24h). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As I mentioned in the sequence homeassistant.month.water_meter_hour some entries may be missing. </font><font style="vertical-align: inherit;">We will regenerate this data by running a query with GROUP BY time (1h). </font><font style="vertical-align: inherit;">This time fill (previous) will work as needed, generating the missing data (the function will take the previous value)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most important thing in this request is the difference function, which will calculate the difference between hourly marks. </font><font style="vertical-align: inherit;">By itself, it does not work and requires an aggregate function. </font><font style="vertical-align: inherit;">Let it be the max () used before.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The result of the execution looks like this</font></font><br>
<br>
<pre><code class="python hljs">name: water_meter_hour<font></font>
tags: entity_id=water_meter_cold<font></font>
time                 difference<font></font>
----                 ----------<font></font>
...<font></font>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T02:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">2</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T03:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">0</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T04:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">0</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T05:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">14</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T06:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">78</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T07:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">30</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T08:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">64</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T09:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">62</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T10:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">6</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T11:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">43</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T12:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">8</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T13:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">9</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T14:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">22</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-08</span>T15:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>Z <span class="hljs-number">72</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From 2 to 5 in the morning (UTC) there was no consumption. </font><font style="vertical-align: inherit;">Nevertheless, the query will return the same consumption value due to fill (previous), and the difference function will subtract this value from itself and we will get 0 at the output, which is actually required. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The only thing left is to build a schedule. </font><font style="vertical-align: inherit;">To do this, open Grafana, open some existing (or create a new) dashboard, create a new panel. </font><font style="vertical-align: inherit;">Chart settings will be like this. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ux/q0/c8/uxq0c834j1eq4h7ey4qazk4cc7q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will display data on cold and hot water on one chart. </font><font style="vertical-align: inherit;">The request is exactly the same as I described above. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Display parameters are set as follows. </font><font style="vertical-align: inherit;">I will have a graph with lines, which goes by stairs. </font><font style="vertical-align: inherit;">I‚Äôll explain the Stack parameter just below. </font><font style="vertical-align: inherit;">There are a couple more display options below, but they are not so interesting.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bi/rd/5x/bird5xpaysckqtigczjerbp5mti.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To add the received schedule to the home assistant you need:</font></font><br>
<br>
<ul>
<li>    . -         </li>
<li>     ,    share</li>
<li>      embed</li>
<li>  current time range ‚Äî       URL </li>
<li>  .     light</li>
<li>  URL    lovelace-UI</li>
</ul><br>
<pre><code class="python hljs">      - type: iframe<font></font>
        id: graf_water_hourly<font></font>
        url: <span class="hljs-string">"http://192.168.10.200:3000/d-solo/rZARemQWk/water?orgId=1&amp;panelId=2&amp;from=now-2d&amp;to=now&amp;theme=light"</span>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Please note that the time range (last 2 days) is set here, and not in the dashboard settings. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The graph looks like this. I have not used hot water in the last 2 days, so only a graph of cold water is drawn. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ms/e7/hk/mse7hkckiwjjm_b5ppli9dakd2c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I didn‚Äôt decide for myself which schedule I like best, a step line, or real bars. Therefore, I will simply give an example of a daily consumption chart, only this time in columns. Requests are built in the same way as described above. Display parameters are as follows: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ns/se/jt/nssejtoburugxcldedjuj0cvywm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This graph looks like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zd/yl/hj/zdylhjfnrdonlnkezr3n4dlwdwm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So about the Stack parameter. In this graph, a column of cold water is drawn on top of a column of hot water. The total height corresponds to the total consumption of cold and hot water for the period.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All graphs shown are dynamic. You can mouse over a point of interest and see the details and value at a specific point. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, a couple of spoons of tar could not do. On the bar graph (in contrast to the graph with step lines), the middle of the bar is not in the middle of the day, but at 00:00. Those. the left half of the column is drawn in place of the previous day. So the charts for Saturday and Sunday are drawn a little to the left than the bluish zone. Until I figured out how to win it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another problem is the inability to work correctly at monthly intervals. </font><font style="vertical-align: inherit;">The fact is that the length of the hour / day / week is fixed, but the length of the month is different each time. </font><font style="vertical-align: inherit;">InfluxDB can only work at regular intervals. </font><font style="vertical-align: inherit;">So far, my brain was enough to set a fixed interval of 30 days. </font><font style="vertical-align: inherit;">Yes, the graph will float a little during the year and the columns will not exactly correspond to the months. </font><font style="vertical-align: inherit;">But since this thing is interesting to me simply as a display device, then I'm ok with that. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I see at least two solutions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Score on monthly schedules and limit to weekly. </font><font style="vertical-align: inherit;">52 weekly bars for the year look pretty good</font></font></li>
<li>     ‚Ññ2,       .     .          ‚Äî    .</li>
</ul><br>
<br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I don‚Äôt know why, but I am plodding on such kind of charts. They show that life is in full swing and everything is changing. Yesterday was a lot, today is not enough, tomorrow will be something else. It remains to work with households on the topic of consumption. But even with current appetites, just a big and incomprehensible figure in the payment is already turning into a fairly clear picture of consumption. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite the almost 20-year career as a programmer, I practically did not intersect with databases. Therefore, the installation of an external database seemed something so abstruse and incomprehensible. Everything was changed by the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aforementioned article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - it turned out that screwing up a suitable tool is done in a couple of clicks, and with a specialized tool the task of graphing becomes a little easier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the headline, I mentioned electricity consumption. </font><font style="vertical-align: inherit;">Unfortunately, at the moment I can not give a single chart. </font><font style="vertical-align: inherit;">One SDM120 counter is dead, and the other is buggy when accessing via Modbus. </font><font style="vertical-align: inherit;">However, this does not affect the topic of this article - the graphics will be built in the same way as for water. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I cited the approaches that I tried myself. </font><font style="vertical-align: inherit;">Surely there are some other ways of organizing the collection and visualization of data that I do not know about. </font><font style="vertical-align: inherit;">Tell me about it in the comments, it will be very interesting to me. </font><font style="vertical-align: inherit;">I will be glad to constructive criticism and new ideas. </font><font style="vertical-align: inherit;">I hope the material presented will also help someone.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492298/index.html">Polygons Another World: IBM PC</a></li>
<li><a href="../en492302/index.html">Smart stand with smartphones for testers - a startup project from the accelerator of ITMO University</a></li>
<li><a href="../en492306/index.html">Lidars at CES</a></li>
<li><a href="../en492308/index.html">Neurons and their modeling</a></li>
<li><a href="../en492312/index.html">Avro serialization at Kafka</a></li>
<li><a href="../en492318/index.html">How coronavirus affects the IT industry</a></li>
<li><a href="../en492320/index.html">Covid-19, your society and you in terms of data science</a></li>
<li><a href="../en492322/index.html">Raspberry Pi + Fedora (aarch64) = Wi-Fi Hotspot (or a raspberry router in a blue hat)</a></li>
<li><a href="../en492324/index.html">We discuss the EARN IT Act - a new US bill that could lead to a ban on E2E encryption</a></li>
<li><a href="../en492326/index.html">Analysis of the popularity of YouTube videos of Eurovision 2020 participants</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>