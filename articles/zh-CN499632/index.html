<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏🏼 ‼️ 🐬 使用WaveNetEQ改善Google Duo音频质量 😦 🐦 🐼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="互联网电话已成为数百万人生活中不可或缺的一部分-因此，他们简化了工作流程并与亲人联系。为了通过Internet转移呼叫，呼叫数据被分解成称为“包裹”的小片段。数据包从发送者到接收者通过网络，在网络中被收集回以接收连续的视频和音频流。但是，数据包通常以错误的顺序和错误的时间到达接收者-通常称为抖动。（...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>使用WaveNetEQ改善Google Duo音频质量</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499632/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互联网电话已成为数百万人生活中不可或缺的一部分-因此，他们简化了工作流程并与亲人联系。为了通过Internet转移呼叫，呼叫数据被分解成称为“包裹”的小片段。数据包从发送者到接收者通过网络，在网络中被收集回以接收连续的视频和音频流。但是，数据包通常以错误的顺序和错误的时间到达接收者-通常称为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抖动。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（颤抖）-或完全迷失了。这些问题降低了通话质量，因为收件人必须设法填补空白，这严重影响了音频和视频。例如，通过Google Duo进行的呼叫中有99％发生丢包，抖动过多或网络延迟。其中，有20％的呼叫由于网络问题丢失了3％以上的音频数据，而10％的呼叫丢失了8％以上的数据。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0d0/621/948/0d0621948e21c2ccc9c5dfd530cbeb53.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简化的网络问题图</font></font></i><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使实时通信更加可靠，您必须以某种方式处理尚未到达收件人的必要包裹。例如，如果您不提供连续的音频信号，您会听到中断和卡顿的声音，但是您不能称其为尝试一次又一次重复相同信号的理想解决方案-这会导致失真，并降低总体通话质量。在没有数据包的情况下处理这种情况的技术称为“数据包丢失隐藏”（PLC）。接收器的PLC模块负责创建音频（或视频），以填充由数据包丢失，强烈抖动或网络问题（无论如何导致缺少必要数据）引起的中断。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了解决这些音频问题，我们在Duo中引入了一个称为WaveNetEQ的新PLC系统。</font><font style="vertical-align: inherit;">这是一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成模型</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WaveRNN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术</font><font style="vertical-align: inherit;">从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DeepMind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，培训了大量的身体语言数据真实地补充语音片段。</font><font style="vertical-align: inherit;">她能够完全合成语音缺失片段的声音信号。</font><font style="vertical-align: inherit;">由于对Duo的调用经过端到端加密，因此所有处理都必须在设备本身上进行。</font><font style="vertical-align: inherit;">WaveNetEQ模型对于电话来说足够快，同时与其他现有系统相比，仍然提供出色的音频质量和听起来更自然的PLC。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于Duo的新型PLC系统</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
像许多其他基于Web的通信程序一样，Duo也基于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开源WebRTC项目</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为了掩盖数据包丢失的后果，NetEQ系统组件使用信号处理方法分析语音并产生连续的连续性-对于较小的丢失（最长20 ms）效果很好，但是当数据包丢失导致60 ms的通信中断时听起来就很糟糕或更长。在这种情况下，语音变得类似于机器人的重复语音-不幸的是，这种特征性声音对于许多通过Internet拨打电话的粉丝来说是众所周知的。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了提高丢包处理的质量，我们用WaveRNN的修改版替换了NetEQ PLC。这是一个专为语音合成而设计的递归神经网络，由两部分组成-自回归和条件神经网络。自回归神经网络负责信号的连续性，并产生短期和中期语音结构。在其运行过程中，每个生成的片段都取决于网络的先前结果。条件神经网络会影响自回归，因此会产生与较慢的传入数据相对应的音频信号。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，WaveRNN与其前身WaveNet一样，其创建目的是将文本转换为语音（文本到语音，TTS）。由于WaveRNN是TTS模型，因此可以得到有关需要说什么以及如何说的信息。空调网络以构成音调的词和特征的音素形式直接在输入端接收此信息（诸如音调或语调之类的非文本信息）。从某种意义上说，空调网络能够“展望未来”，然后将自回归网络重定向到其相应的声音。在PLC系统和实时通讯的情况下，我们将没有这种情况。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了创建功能性的PLC系统，您既需要从当前语音（即从过去的语音）中提取上下文，又要产生一个可以接受的声音以进行继续。我们的解决方案WaveNetEQ可以同时做到。它使用了一个自动回归网络（在丢包的情况下会继续发声）和一个条件神经网络，该网络模拟长期症状，例如语音特征。之前的音频信号的频谱图被馈送到条件神经网络的输入，从中提取有限数量的信息来描述韵律和文本内容。这种集中的信息被馈入自回归神经网络，将其与最近的音频结合起来以预测下一个声音片段。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这与我们在WaveNetEQ培训期间遵循的过程略有不同。然后，自回归神经网络接收到一个真实的声音样本作为下一步的输入，而不是使用先前的样本。在这种称为教师强迫的过程中，即使模型的预测质量较差，也可以保证该模型即使在训练的早期也能学到有价值的信息。当模型经过全面训练并用于音频或视频通话时，强加训练仅用于在第一个样本上“预热”模型，此后它已经收到了自己的输出。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/2bd/3c5/03c/2bd3c503c986c9486a7a0053827ee7d9.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WaveNetEQ体系结构。在自回归神经网络的操作过程中，我们通过强加训练来“热身”它。之后，她已经拥有了自己的出口到入口。</font><font style="vertical-align: inherit;">来自音频的较长部分的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低频频谱图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被用作空调神经网络的输入。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
此模型应用于Duo抖动缓冲区中的音频数据。丢包后，当通信恢复并且真实音频信号继续到达时，我们会仔细组合合成和真实音频流。为了最好地组合这两个信号，该模型产生的输出比必要的要多，然后从一个平滑过渡到另一个。这使过渡平滑且几乎无声。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/140/fab/1bf/140fab1bfef6197a27fea65400627c07.gif"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在60毫秒滑动窗口上模拟音频流中的PLC事件。</font><font style="vertical-align: inherit;">蓝线是真实的音频，包括PLC的过去和将来的部分。</font><font style="vertical-align: inherit;">在每次测量时，橙色线代表WaveNetEQ系统将预测的声音是否沿垂直的灰色线被剪切的合成音频。</font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60 ms丢包</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意 </font><font style="vertical-align: inherit;">perev。：音频示例在外观上太笨拙，因为Habr编辑器不提供嵌入音频文件的功能。</font><font style="vertical-align: inherit;">这是mp4带有一个音频而没有图片的外观。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NetEQ</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/neteq_60_ms_1_f1dfe8dd0c6af457976d6ceffb9cc3d8.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WaveNetEQ</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/waveneteq_60_ms_1_f9d02625c71b668a6234767075cb196f.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
网络均衡器</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/neteq_60_ms_2_36d0519b296a64dc538a55aa799697c7.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WaveNetEQ</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/waveneteq_60_ms_2_b2a01d6b1ba35405203bbf430a5675f3.mp4" type="video/mp4"></video></div></div></div><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">120毫秒</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
NetEQ数据包丢失</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/neteq_120_ms_1_f0effd0234b6f9778aab0ff445afc948.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WaveNetEQ</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/waveneteq_120_ms_1_7532342f5800ce52d0a450581816e035.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
网络均衡器</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/neteq_120_ms_2_8e86d7b2061dfb964b845ebefc1aebd9.mp4" type="video/mp4"></video></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WaveNetEQ</font></font><br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的浏览器不支持HTML5视频。</font></font><source src="https://golovanov.net/habr/waveneteq_120_ms_2_63b829581a3291c144a030639139c199.mp4" type="video/mp4"></video></div></div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们保证可靠性</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PLC中要考虑的重要因素之一是神经网络适应可变输入信号的能力，例如，当有多个说话的人或背景噪声变化时。为了确保该模型对广泛用户的可靠性，我们对WaveNetEQ进行了训练，该方法基于从100多种使用48种不同语言的人那里获取的语音数据。这使模型可以学习人类语音的一般特征，而不是特定语言的特征。为了确保WaveNetEQ在后台出现噪音的情况下的运行，例如，当您在火车或咖啡馆里接听电话时，我们通过将数据与来自广泛数据库的背景噪音进行混合来补充数据。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管我们的模型能够学习如何合理地继续您的语音，但它只能在很短的时间内起作用-它可以结束音节，但无法预测单词。在长时间内丢包的情况下，我们会逐渐减小音量，在120 ms之后，该模型只会产生静默状态。另外，为确保模型不会产生错误的音节，我们使用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Google Cloud Speech-to-Text API</font></a><font style="vertical-align: inherit;">检查了WaveNetEQ和NetEQ的声音样本</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发现该模型实际上不会改变结果文本中错误的百分比，即语音识别过程中发生的错误数量。</font><font style="vertical-align: inherit;">我们在Duo进行了WaveNetEQ的试验，其使用对呼叫质量和用户体验产生了积极影响。</font><font style="vertical-align: inherit;">WaveNetEQ已经可以在Pixel 4手机上的所有Duo通话中使用，现在我们将其部署在其他手机上。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN499622/index.html">敏捷团队中的回顾性反模式。第1部分</a></li>
<li><a href="../zh-CN499624/index.html">Ansible工具概述</a></li>
<li><a href="../zh-CN499626/index.html">Laravel和JSON-RPC 2.0上的SOA</a></li>
<li><a href="../zh-CN499628/index.html">发展面试：选择朋友</a></li>
<li><a href="../zh-CN499630/index.html">扑。2020年春季更新</a></li>
<li><a href="../zh-CN499634/index.html">高级打字稿</a></li>
<li><a href="../zh-CN499636/index.html">对小孩子反应本地。移动开发经验</a></li>
<li><a href="../zh-CN499642/index.html">Pixockets：我们如何为游戏服务器编写自己的网络库</a></li>
<li><a href="../zh-CN499644/index.html">使用自动测试工具创建机器人（RPA）</a></li>
<li><a href="../zh-CN499646/index.html">在敏捷和Scrum中集成UX的5条规则</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>