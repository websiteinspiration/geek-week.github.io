<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞🏿 🍒 ⛹🏿 Código de línea única o validación Nethermind usando PVS-Studio C # para Linux 👉🏾 👨🏻‍🌾 🌻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artículo está dedicado al lanzamiento de la prueba beta PVS-Studio C # para Linux, así como al complemento para Rider. Por una razón tan maravill...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Código de línea única o validación Nethermind usando PVS-Studio C # para Linux</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/504320/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b64/5fc/72d/b645fc72ddcded21612bdc5e9fac2c78.png" alt="Foto 1"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artículo está dedicado al lanzamiento de la prueba beta PVS-Studio C # para Linux, así como al complemento para Rider. </font><font style="vertical-align: inherit;">Por una razón tan maravillosa, usando estas herramientas, verificamos el código fuente del producto Nethermind y en este artículo veremos errores interesantes y a veces divertidos.</font></font><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nethermind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un cliente rápido para .NET Core Ethereum para Linux, Windows, MacOs. </font><font style="vertical-align: inherit;">Se puede usar en proyectos al configurar redes privadas Ethereum o dApps. </font><font style="vertical-align: inherit;">Nethermind es de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código abierto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ubicado en GitHub. </font><font style="vertical-align: inherit;">El proyecto fue fundado en 2017 y está en constante evolución.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducción</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Te gusta el trabajo manual? Por ejemplo, como encontrar errores en el código del programa. De acuerdo, es bastante tedioso leer y analizar el sitio que escribió o todo el proyecto en busca de algún error complicado. Bueno, si el proyecto es pequeño, digamos 5,000 líneas, pero si su tamaño ya ha excedido cien mil o un millón de líneas. Además, fue escrito por diferentes programadores y, a veces, no en una forma muy digerible. ¿Qué hacer en este caso? ¿Es realmente necesario dormir en algún lugar, subestimar en algún lugar y el 100% de su tiempo para darse cuenta de todas estas líneas interminables para comprender dónde está este desagradable error? Dudo que te gustaría hacer esto. Entonces, ¿qué hacer, tal vez hay medios modernos para automatizar de alguna manera esto?</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34f/9eb/338/34f9eb3387d61eb4ebfa67f0dbccbef7.png" alt="figura 3"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y luego entra en juego una herramienta como un analizador de código estático. </font><font style="vertical-align: inherit;">El analizador estático es una herramienta para detectar defectos en el código fuente de los programas. </font><font style="vertical-align: inherit;">La ventaja de esta herramienta sobre la verificación manual es la siguiente:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">casi no pasa el tiempo buscando la ubicación del error (al menos es definitivamente más rápido que buscar el error al copiar y pegar con los ojos);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se cansa, a diferencia de una persona que después de un tiempo de búsqueda necesitará descansar;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conoce muchos patrones de error de los que una persona ni siquiera es consciente; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza tecnologías como: análisis de flujo de datos, ejecución simbólica, coincidencia de patrones y otras;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le permite analizar regularmente y en cualquier momento;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, el uso de un analizador de código estático no reemplaza ni cancela las revisiones de código. </font><font style="vertical-align: inherit;">Pero las revisiones de código se están volviendo más productivas y útiles. </font><font style="vertical-align: inherit;">Puede centrarse en encontrar errores de alto nivel, en transferir conocimientos, en lugar de cansarse de leer el código en busca de errores tipográficos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se interesó en leer más al respecto, le sugiero el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siguiente artículo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , así como un artículo sobre las </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tecnologías</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilizadas en PVS-Studio.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio C # para Linux / macOS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por el momento, estamos transfiriendo nuestro analizador de C # a .NET Core, y también estamos desarrollando activamente un complemento para IDE Rider. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si está interesado, puede inscribirse para una prueba beta completando el formulario </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en esta página</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Las instrucciones de instalación se enviarán a su correo (no se preocupe, es muy simple), así como una licencia para usar el analizador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Así es como se ve Rider con el complemento PVS-Studio:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/rp/p6/f_/rpp6f_9oohudg2ov2jt-hdu0yg0.png" alt="Cuadro 4"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un poco de indignación</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero decir que en algunos lugares fue muy difícil leer el código fuente de Nethermind, porque en él las líneas de 300-500 caracteres de longitud son bastante normales. </font><font style="vertical-align: inherit;">Sí, es todo el código sin formatear en 1 línea. </font><font style="vertical-align: inherit;">Y estas líneas, por ejemplo, contienen varios operadores ternarios y operadores lógicos, y no hay nada allí. </font><font style="vertical-align: inherit;">En general, disfrute a partir de la última temporada del juego de tronos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Explicaré un poco para entender el alcance. </font><font style="vertical-align: inherit;">Tengo un monitor UltraWide con una longitud de unos 82 centímetros. </font><font style="vertical-align: inherit;">Si abre el IDE en él en pantalla completa, se ajustará a unos 340 caracteres. </font><font style="vertical-align: inherit;">Es decir, las líneas de las que estoy hablando ni siquiera encajan. </font><font style="vertical-align: inherit;">Si quieres ver cómo se ve, dejé enlaces a archivos en GitHub: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">string</span> authorString = (block.Author == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">"sealed by "</span> +<font></font>
(KnownAddresses.GoerliValidators.ContainsKey(block.Author) ?<font></font>
KnownAddresses.GoerliValidators[block.Author] : block.Author?.ToString())) ??<font></font>
(block.Beneficiary == <span class="hljs-literal">null</span> ? <span class="hljs-keyword">string</span>.Empty : <span class="hljs-string">"mined by "</span> +<font></font>
(KnownAddresses.KnownMiners.ContainsKey(block.Beneficiary) ?<font></font>
KnownAddresses.KnownMiners[block.Beneficiary] : block.Beneficiary?.ToString()));<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo) _logger.Info(<span class="hljs-string">$"Discovered a new block
<span class="hljs-subst">{<span class="hljs-keyword">string</span>.Empty.PadLeft(<span class="hljs-number">9</span> - block.Number.ToString().Length, <span class="hljs-string">'
'</span>)}</span><span class="hljs-subst">{block.ToString(Block.Format.HashNumberAndTx)}</span> <span class="hljs-subst">{authorString}</span>, sent by
<span class="hljs-subst">{syncPeer:s}</span>"</span>);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font><b><font style="vertical-align: inherit;">Ejemplo de </font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enlace de archivo </font></font></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildTransitions</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    releaseSpec.IsEip1283Enabled = (_chainSpec.Parameters.Eip1283Transition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock &amp;&amp;<font></font>
((_chainSpec.Parameters.Eip1283DisableTransition ?? <span class="hljs-keyword">long</span>.MaxValue) <font></font>
&gt; releaseStartBlock || (_chainSpec.Parameters.Eip1283ReenableTransition ??<font></font>
<span class="hljs-keyword">long</span>.MaxValue) &lt;= releaseStartBlock);           <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace al archivo</font></font></a><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 
<span class="hljs-title">Will_not_reject_block_with_bad_total_diff_but_will_reset_diff_to_null</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    _syncServer = <span class="hljs-keyword">new</span> SyncServer(<span class="hljs-keyword">new</span> StateDb(), <span class="hljs-keyword">new</span> StateDb(), localBlockTree,<font></font>
NullReceiptStorage.Instance, <span class="hljs-keyword">new</span> BlockValidator(Always.Valid, <span class="hljs-keyword">new</span><font></font>
HeaderValidator(localBlockTree, Always.Valid, MainnetSpecProvider.Instance,<font></font>
LimboLogs.Instance), Always.Valid, MainnetSpecProvider.Instance, <font></font>
LimboLogs.Instance), Always.Valid, _peerPool, StaticSelector.Full, <font></font>
<span class="hljs-keyword">new</span> SyncConfig(), LimboLogs.Instance);<font></font>
    ...     <font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace al archivo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ahora imagine que se produce un error en dicha sección, ¿será agradable buscarlo? </font><font style="vertical-align: inherit;">Estoy seguro de que no lo es, y todos entienden que es imposible escribir así. </font><font style="vertical-align: inherit;">Y, por cierto, hay un lugar similar con un error en este proyecto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados de validación</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condiciones que no les gustan 0</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condición 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> &amp;&amp; bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posiblemente el índice está fuera del límite. </font><font style="vertical-align: inherit;">El índice '0' apunta más allá del límite de 'bytes'. </font><font style="vertical-align: inherit;">Nethermind.Network ReceiptsMessageSerializer.cs 50 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
a notar un error, consideremos el caso cuando el número de elementos de la matriz es 0. A continuación, el </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes.Length == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> condición </font><font style="vertical-align: inherit;">será verdadera y un </font><i><font style="vertical-align: inherit;">IndexOutOfRangeException de tipo 0</font></i><font style="vertical-align: inherit;"> será </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lanzado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al acceder al elemento de matriz </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Querían salir de este método inmediatamente si la matriz está vacía o si el elemento 0 es igual a un cierto valor, pero parece que accidentalmente confundieron "||" </font><font style="vertical-align: inherit;">con "&amp;&amp;". </font><font style="vertical-align: inherit;">Propongo solucionar este problema de la siguiente manera:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> ReceiptsMessage <span class="hljs-title">Deserialize</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] bytes</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (bytes.Length == <span class="hljs-number">0</span> || bytes[<span class="hljs-number">0</span>] == Rlp.OfEmptySequence[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReceiptsMessage(<span class="hljs-literal">null</span>);<font></font>
    ...<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Condición 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DiscoverAll</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    Type? GetStepType(Type[] typesInGroup)<font></font>
    {<font></font>
        Type? GetStepTypeRecursive(Type? contextType)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
        ...<font></font>
        <span class="hljs-keyword">return</span> typesInGroup.Length == <span class="hljs-number">0</span> ? typesInGroup[<span class="hljs-number">0</span>] :<font></font>
               GetStepTypeRecursive(_context.GetType());<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3106</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Posiblemente el índice está fuera del límite. </font><font style="vertical-align: inherit;">El índice '0' apunta más allá del límite 'typesInGroup'. </font><font style="vertical-align: inherit;">Nethermind.Runner EthereumStepsManager.cs 70 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se </font><font style="vertical-align: inherit;">produce </font><font style="vertical-align: inherit;">una situación similar a la descrita anteriormente. </font><font style="vertical-align: inherit;">Si el número de elementos en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es igual a 0, al acceder al elemento 0, se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">generará</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una excepción de tipo </font><i><font style="vertical-align: inherit;">IndexOutOfRangeException</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo en este caso no entiendo lo que el desarrollador quería. </font><font style="vertical-align: inherit;">Lo más probable es que, en lugar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">typesInGroup [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , necesite escribir </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Error u optimización inacabada?</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
   ...<font></font>
   <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
   {<font></font>
      shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
   }<font></font>
   <span class="hljs-keyword">else</span><font></font>
   {<font></font>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; currentLevel.BlockInfos.Length; i++)<font></font>
      {<font></font>
         <span class="hljs-keyword">if</span> (currentLevel.BlockInfos[<span class="hljs-number">0</span>].BlockHash == currentHash) <span class="hljs-comment">// &lt;=</span><font></font>
         {<font></font>
            currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                      .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                      .ToArray();<font></font>
            <span class="hljs-keyword">break</span>;<font></font>
         }<font></font>
      }<font></font>
   }<font></font>
   ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3102</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Acceso sospechoso al elemento del objeto 'currentLevel.BlockInfos' mediante un índice constante dentro de un bucle. Nethermind.Blockchain BlockTree.cs 895 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primera vista, el error es obvio: el bucle tiene como objetivo </font><font style="vertical-align: inherit;">iterar sobre los </font><font style="vertical-align: inherit;">elementos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero al acceder a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [i],</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribieron </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Arreglamos 0 en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y la misión se completa. Pero no te apresures, vamos a resolverlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, nosotros </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Longitud</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acceso al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlockHash del</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elemento nulo. Si es igual a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entonces tomamos de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentLevel.BlockInfos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todos los elementos que no son iguales</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentHash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , escríbele y sal del bucle. </font><font style="vertical-align: inherit;">Resulta que el ciclo es superfluo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que antes había un algoritmo que decidieron cambiar / optimizar usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">linq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero algo salió mal. </font><font style="vertical-align: inherit;">Ahora, en el caso de que la condición sea falsa, obtenemos iteraciones sin sentido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, si el desarrollador que escribió esto usaría el modo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análisis incremental</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , inmediatamente se daría cuenta de que algo andaba mal y solucionaría todo rápidamente. </font><font style="vertical-align: inherit;">Por el momento, volvería a escribir el código de esta manera:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteBlocks</span>(<span class="hljs-params">Keccak deletePointer</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (currentLevel.BlockInfos.Length == <span class="hljs-number">1</span>)<font></font>
    {<font></font>
        shouldRemoveLevel = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        currentLevel.BlockInfos = currentLevel.BlockInfos<font></font>
                                  .Where(bi =&gt; bi.BlockHash != currentHash)<font></font>
                                  .ToArray();<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desreferencia de referencia nula</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desreferenciar 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Sign</span>(<span class="hljs-params">Transaction tx, <span class="hljs-keyword">int</span> chainId</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsDebug)<font></font>
        _logger?.Debug(<span class="hljs-string">$"Signing transaction: <span class="hljs-subst">{tx.Value}</span> to <span class="hljs-subst">{tx.To}</span>"</span>);<font></font>
    IBasicWallet.Sign(<span class="hljs-keyword">this</span>, tx, chainId);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El objeto '_logger' se usó antes de que se verificara como nulo. Verifique las líneas: 118, 118. Nethermind.Wallet DevKeyStoreWallet.cs 118 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Error en la secuencia incorrecta. En primer lugar hay una apelación a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger.IsDebug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y sólo después de eso es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger controlada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por consiguiente, en el caso de que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sea </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , obtenemos una excepción de tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NullReferenceException</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desreferenciar 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BuildNodeInfo</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _nodeInfo = <span class="hljs-keyword">new</span> NodeInfo();<font></font>
    _nodeInfo.Name = ClientVersion.Description;<font></font>
    _nodeInfo.Enode = _enode.Info;                           <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">byte</span>[] publicKeyBytes = _enode?.PublicKey?.Bytes;        <span class="hljs-comment">// &lt;=</span>
    _nodeInfo.Id = (publicKeyBytes == <span class="hljs-literal">null</span> ? Keccak.Zero :<font></font>
                   Keccak.Compute(publicKeyBytes)).ToString(<span class="hljs-literal">false</span>);<font></font>
    _nodeInfo.Ip = _enode?.HostIp?.ToString();<font></font>
    _nodeInfo.ListenAddress = <span class="hljs-string">$"<span class="hljs-subst">{_enode.HostIp}</span>:<span class="hljs-subst">{_enode.Port}</span>"</span>;<font></font>
    _nodeInfo.Ports.Discovery = _networkConfig.DiscoveryPort;<font></font>
    _nodeInfo.Ports.Listener = _networkConfig.P2PPort;<font></font>
    UpdateEthProtocolInfo();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3095</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El objeto '_enode' se usó antes de que se verificara como nulo. </font><font style="vertical-align: inherit;">Verifique las líneas: 55, 56. Nethermind.JsonRpc AdminModule.cs 55 El </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
error es completamente el mismo que el descrito anteriormente, solo que esta vez el culpable es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_enode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero agregar que si olvidó verificar nulo, recuerde esto solo cuando su programa se bloquee. </font><font style="vertical-align: inherit;">El analizador le recordará esto y todo estará bien.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestro favorito copiar y pegar</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-keyword">ref</span> UInt256 a, <span class="hljs-keyword">ref</span> UInt256 b</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> a.s0 == b.s0 &amp;&amp; a.s1 == b.s1 &amp;&amp; a.s2 == b.s2 &amp;&amp; a.s2 == b.s2;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hay </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">subexpresiones</font></a><font style="vertical-align: inherit;"> idénticas 'a.s2 == b.s2' a la izquierda y a la derecha del operador '&amp;&amp;'. </font><font style="vertical-align: inherit;">Nethermind.Dirichlet.Numerics UInt256.cs 1154 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí se verifica la misma condición 2 veces:</font></font><br>
<br>
<pre><code class="cs hljs">a.s2 == b.s2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que los parámetros </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de una</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tienen un campo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , supongo que al copiar simplemente se olvidó de cambio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que los parámetros serán iguales más a menudo de lo esperado por el autor del código. Al mismo tiempo, algunos desarrolladores piensan que no hacen esto y comienzan a buscar un error en un lugar completamente diferente, gastando mucha energía y nervios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, los errores en las funciones de comparación son generalmente un clásico. Aparentemente, los programadores, al considerar tales funciones simples, se relacionan con su escritura de manera muy casual y desatendida. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prueba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sabiendo esto, ahora ten cuidado :)! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ApiResponse&gt; 
<span class="hljs-title">PublishBlockAsync</span>(<span class="hljs-params">SignedBeaconBlock signedBlock,
                  CancellationToken cancellationToken</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> acceptedLocally = <span class="hljs-literal">false</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (acceptedLocally)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiResponse(StatusCode.Success);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La declaración 'then' es equivalente a la declaración 'else'. Nethermind.BeaconNode BeaconNodeFacade.cs 177 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para cualquier valor de la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptedLocally</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable, el </font><font style="vertical-align: inherit;">método devuelve el mismo. Es difícil decir si es un error o no. Supongamos que un programador copió una línea y olvidó cambiar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode.Success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a otra cosa, entonces esto es un verdadero error. Además, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StatusCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tiene </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InternalError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvalidRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sin embargo, la refactorización de código es, probablemente, a la culpa y que no se preocupan por la </font><i><font style="vertical-align: inherit;">acceptedLocally</font></i><font style="vertical-align: inherit;"> valor de todos modos</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en este caso, la condición se convierte en el lugar que te hace sentarte y pensar si es un error o no. </font><font style="vertical-align: inherit;">En cualquier caso, este caso es extremadamente desagradable. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 3</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TearDown</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> testResult <span class="hljs-keyword">in</span> _results)<font></font>
    {<font></font>
         <span class="hljs-keyword">string</span> message = <span class="hljs-string">$"<span class="hljs-subst">{testResult.Order}</span>. <span class="hljs-subst">{testResult.Name}</span> has "</span> 
               + <span class="hljs-string">$"<span class="hljs-subst">{(testResult.Passed ? <span class="hljs-string">"passed [+]"</span> : <span class="hljs-string">"failed [-]"</span>)}</span>"</span>;
         <span class="hljs-keyword">if</span> (testResult.Passed)<font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
         <span class="hljs-keyword">else</span><font></font>
         {<font></font>
               TestContext.WriteLine(message);<font></font>
         }<font></font>
     }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3004</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La declaración 'then' es equivalente a la declaración 'else'. </font><font style="vertical-align: inherit;">Nethermind.Overseer.Test TestBuilder.cs 46 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y de nuevo, no nos importa la verificación, porque al final obtenemos lo mismo. </font><font style="vertical-align: inherit;">Y nuevamente nos sentamos y sufrimos, pensando, pero qué quería el desarrollador escribir aquí. </font><font style="vertical-align: inherit;">Una pérdida de tiempo que podría haberse evitado mediante el uso de análisis estático e inmediatamente arreglando un código tan ambiguo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 4</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (_decoderBuffer.ReadableBytes &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"decoder buffer"</span>);<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3021</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hay dos declaraciones 'if' con expresiones condicionales idénticas. La primera instrucción 'if' contiene el método return. Esto significa que la segunda declaración 'si' no tiene sentido Nethermind.Network.Benchmark InFlowBenchmarks.cs 55 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Simplemente </font><font style="vertical-align: inherit;">presione </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nuevamente </font><font style="vertical-align: inherit;">. Eliminamos el exceso de cheques y todo está bien. Estoy seguro de que si alguna otra condición eran importantes aquí, entonces todo el mundo sería escribir en un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a través del operador lógico I. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 5</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio Advertencia: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3030</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verificación </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">periódica</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La condición '_logger.IsInfo' ya se verificó en la línea 242. Nethermind.Synchronization SyncServer.cs 244 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De la misma manera que en el cuarto caso, se realiza una verificación adicional. </font><font style="vertical-align: inherit;">Sin embargo, la diferencia es que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_logger</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no solo tiene una propiedad, sino también, por ejemplo, ' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bool IsError {get; </font><font style="vertical-align: inherit;">}</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '. </font><font style="vertical-align: inherit;">Por lo tanto, el código probablemente debería verse así:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogBlockAuthorNicely</span>(<span class="hljs-params">Block block, ISyncPeer syncPeer</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">if</span> (_logger.IsInfo)<font></font>
    {<font></font>
        <span class="hljs-keyword">if</span> (!_logger.IsError) <span class="hljs-comment">// &lt;=</span><font></font>
        {<font></font>
            ...<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, o toda la culpa de la refactorización del código y solo una verificación ya no es necesaria. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso 6</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
{<font></font>
    <span class="hljs-keyword">bool</span> incorrectParametersCount = missingParamsCount != <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount &gt; <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022 La</font></a><font style="vertical-align: inherit;"> expresión 'missingParamsCount! = 0' siempre es verdadera. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 127 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique la condición (missingParamsCount! = 0) y si es verdadera, la calculamos nuevamente y asignaremos el resultado a una variable. </font><font style="vertical-align: inherit;">De acuerdo en que esta es una forma bastante original de escribir verdadero.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cheque confuso</font></font></h3><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-keyword">long</span>&gt; 
<span class="hljs-title">DownloadHeaders</span>(<span class="hljs-params">PeerInfo bestPeer, 
                BlocksRequest blocksRequest, 
                CancellationToken cancellation</span>)</span><font></font>
{<font></font>
  ...<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; headers.Length; i++)<font></font>
  {<font></font>
    ...<font></font>
    BlockHeader currentHeader = headers[i];<font></font>
    ...<font></font>
    <span class="hljs-keyword">bool</span> isValid = i &gt; <span class="hljs-number">1</span> ? <font></font>
        _blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>):<font></font>
        _blockValidator.ValidateHeader(currentHeader, <span class="hljs-literal">false</span>);<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (HandleAddResult(bestPeer, <font></font>
                        currentHeader, <font></font>
                        i == <span class="hljs-number">0</span>,                              <span class="hljs-comment">// &lt;=</span><font></font>
                        _blockTree.Insert(currentHeader))) <font></font>
    {<font></font>
       headersSynced++;<font></font>
    }<font></font>
<font></font>
    ...<font></font>
  }<font></font>
  ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Advertencia de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PVS-Studio: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">V3022 La</font></a><font style="vertical-align: inherit;"> expresión 'i == 0' siempre es falsa. </font><font style="vertical-align: inherit;">Nethermind.Synchronization BlockDownloader.cs 192 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos en orden. </font><font style="vertical-align: inherit;">Al inicializar, a la variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i se le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> asigna el valor 1. A continuación, la variable solo se incrementa, por lo tanto, el valor siempre se pasará a la función </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandleAddResult</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HandleAddResult</span>(<span class="hljs-params">PeerInfo peerInfo, 
                             BlockHeader block,
                             <span class="hljs-keyword">bool</span> isFirstInBatch, 
                             AddBlockResult addResult</span>)</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">if</span> (isFirstInBatch)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí estamos interesados ​​en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isFirstInBatch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A juzgar por el nombre de este parámetro, es responsable de si algo es el primero en la fiesta. </font><font style="vertical-align: inherit;">Hm, primero. </font><font style="vertical-align: inherit;">Miremos nuevamente arriba y veamos que hay 2 llamadas usando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs">BlockHeader currentHeader = headers[i];<font></font>
_blockValidator.ValidateHeader(currentHeader, headers[i - <span class="hljs-number">1</span>], <span class="hljs-literal">false</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay que olvidar que en este caso la cuenta es a 1. Resulta que tenemos dos opciones: o bien una "primera" significa un elemento en el índice 1, o con el símbolo 0. En cualquier caso, al mismo tiempo, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> será igual a 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que la llamada a la función debería verse así:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i == <span class="hljs-number">1</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O así:</font></font><br>
<br>
<pre><code class="cs hljs">HandleAddResult(bestPeer, currentHeader, <font></font>
                i - <span class="hljs-number">1</span> == <span class="hljs-number">0</span>, _blockTree.Insert(currentHeader))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y de nuevo, si el desarrollador usara constantemente un analizador estático, entonces escribiría este código y vería una advertencia, lo arreglaría rápidamente y disfrutaría de la vida. </font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una prioridad ??</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situación 1</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
        MemorySizes.RefSize + Keccak.MemorySize) <font></font>
        + (MemorySizes.RefSize + FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead)   <span class="hljs-comment">// &lt;=</span><font></font>
        + (MemorySizes.RefSize + _rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize)         <span class="hljs-comment">// &lt;=</span><font></font>
        + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
        * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
        + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencias de PVS-Studio: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Quizás el '??' </font><font style="vertical-align: inherit;">El operador funciona de una manera diferente a la esperada. </font><font style="vertical-align: inherit;">Su prioridad es inferior a la prioridad de otros operadores en su parte izquierda. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 43</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123 Quizás el '??' </font><font style="vertical-align: inherit;">El operador funciona de una manera diferente a la esperada. </font><font style="vertical-align: inherit;">Su prioridad es inferior a la prioridad de otros operadores en su parte izquierda. </font><font style="vertical-align: inherit;">Nethermind.Trie TrieNode.cs 44</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El analizador le aconseja que compruebe cómo usamos los operadores "??" y que, para comprender cuál es el problema, propongo considerar la siguiente situación. </font><font style="vertical-align: inherit;">Miramos esta línea aquí:</font></font><br>
<br>
<pre><code class="cs hljs">(MemorySizes.RefSize + FullRlp?.Length ?? MemorySizes.ArrayOverhead)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> son constantes:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MemorySizes</span><font></font>
{<font></font>
    ...<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> RefSize = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ArrayOverhead = <span class="hljs-number">20</span>;<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, para mayor claridad, propongo reescribir la cadena, sustituyendo sus valores:</font></font><br>
<br>
<pre><code class="cs hljs">(<span class="hljs-number">8</span> + FullRlp?.Length ?? <span class="hljs-number">20</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora suponga que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Entonces </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(8 + nulo)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> será nulo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A continuación, obtenemos la expresión ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo ?? 20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), que devolverá 20. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que, siempre que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FullRlp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sea </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.ArrayOverhead</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siempre se devolverá, </font><font style="vertical-align: inherit;">independientemente de lo que esté almacenado en </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> El fragmento en la línea de abajo es similar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero la pregunta es, ¿el desarrollador quería este comportamiento? Veamos la siguiente línea:</font></font><br>
<br>
<pre><code class="cs hljs">MemorySizes.RefSize + (MemorySizes.ArrayOverhead <font></font>
    + _data?.Length * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aquí, como en las secciones consideradas anteriormente, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agrega a la expresión, pero </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tenga en cuenta que después del primer operador "+" hay un paréntesis. </font><font style="vertical-align: inherit;">Resulta que </font><font style="vertical-align: inherit;">deberíamos agregar alguna expresión </font><font style="vertical-align: inherit;">a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemorySizes.RefSize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y si es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , agregaremos otra. </font><font style="vertical-align: inherit;">Entonces el código debería verse así:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MemorySize<font></font>
{<font></font>
  <span class="hljs-keyword">get</span><font></font>
  {<font></font>
    <span class="hljs-keyword">int</span> unaligned = (Keccak == <span class="hljs-literal">null</span> ? MemorySizes.RefSize : <font></font>
       MemorySizes.RefSize + Keccak.MemorySize) <font></font>
       + (MemorySizes.RefSize + (FullRlp?.Length <font></font>
                                 ?? MemorySizes.ArrayOverhead))    <span class="hljs-comment">// &lt;=</span><font></font>
       + (MemorySizes.RefSize + (_rlpStream?.MemorySize <font></font>
                                 ?? MemorySizes.RefSize))          <span class="hljs-comment">// &lt;=</span><font></font>
       + MemorySizes.RefSize + (MemorySizes.ArrayOverhead + _data?.Length <font></font>
       * MemorySizes.RefSize ?? MemorySizes.ArrayOverhead) <font></font>
       + MemorySizes.SmallObjectOverhead + (Key?.MemorySize ?? <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> MemorySizes.Align(unaligned);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuevamente, esto es solo una suposición, sin embargo, si el desarrollador desea un comportamiento diferente, entonces debe indicarlo explícitamente:</font></font><br>
<br>
<pre><code class="cs hljs">((MemorySizes.RefSize + FullRlp?.Length) ?? MemorySizes.ArrayOverhead)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y luego, el que lee este código no tendría que profundizar durante mucho tiempo en lo que está sucediendo aquí y en lo que el programador quería. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situación 2</font></font></b><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task&lt;JsonRpcResponse&gt; 
<span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">JsonRpcRequest request, 
             <span class="hljs-keyword">string</span> methodName,
             (MethodInfo Info, <span class="hljs-keyword">bool</span> ReadOnly</span>) method)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> expectedParameters = method.Info.GetParameters();
    <span class="hljs-keyword">var</span> providedParameters = request.Params;<font></font>
    ...<font></font>
    <span class="hljs-keyword">int</span> missingParamsCount = expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>; <span class="hljs-comment">// &lt;=</span>
    <span class="hljs-keyword">if</span> (missingParamsCount != <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        ...<font></font>
    }<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Advertencia de PVS-Studio: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3123</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quizás el '??' </font><font style="vertical-align: inherit;">El operador funciona de una manera diferente a la esperada. </font><font style="vertical-align: inherit;">Su prioridad es inferior a la prioridad de otros operadores en su parte izquierda. </font><font style="vertical-align: inherit;">Nethermind.JsonRpc JsonRpcService.cs 123 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y nuevamente, la prioridad de la operación es "??", por lo tanto, como en la última vez, consideramos la situación. </font><font style="vertical-align: inherit;">Miramos esta línea aquí:</font></font><br>
<br>
<pre><code class="cs hljs">expectedParameters.Length <font></font>
            - (providedParameters?.Length ?? <span class="hljs-number">0</span>) <font></font>
            + providedParameters?.Count(<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace) ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supongamos que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a continuación, para mayor claridad, sustituir de inmediato todo lo relacionado con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">providedParameters</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font><font style="vertical-align: inherit;">sustituirlo por un valor aleatorio </font><font style="vertical-align: inherit;">en lugar de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">expectedParameters.Length</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> - (<span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>) + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora se nota de inmediato que hay dos controles similares, solo en un caso hay corchetes y en el otro allí. Ejecutemos este ejemplo. Primero obtenemos que ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) devolverá 0, luego resta 0 de 100 y obtenemos 100:</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-number">100</span> + <span class="hljs-literal">null</span> ?? <span class="hljs-number">0</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, en lugar de ejecutar primero " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " y finalmente obtener ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), nos volvemos completamente diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero se ejecutará ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 + nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) y obtenemos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Luego verifica ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo ?? 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), lo que lleva al hecho de que el valor de la variable missingParamsCount será 0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que la siguiente condición es que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">missingParamsCount</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es </font><i><font style="vertical-align: inherit;">igual a</font></i><font style="vertical-align: inherit;"> cero, podemos suponer que el desarrollador buscó este comportamiento. Y diré, ¿por qué no poner corchetes y expresar mis pensamientos explícitamente? En general, es posible que esta verificación se deba a un malentendido de por qué a veces se devuelve 0, y esto no es más que una muleta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y nuevamente, estamos perdiendo el tiempo, aunque podríamos no haber hecho esto; use el modo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">análisis incremental</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al escribir código </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusión</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conclusión, espero poder comunicarles que el analizador estático es su amigo y no un supervisor malvado que solo espera que cometa un error. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
También debe tenerse en cuenta que si usa el analizador una vez o rara vez lo usa, seguramente encontrará errores y algunos de ellos incluso se solucionarán rápidamente, pero también habrá otros a los que deberá aplastar. </font><font style="vertical-align: inherit;">Por lo tanto, debe usar un analizador estático constantemente. </font><font style="vertical-align: inherit;">Luego encontrará muchos más errores y los corregirá en el momento en que se escriba el código del programa y entienda exactamente lo que está tratando de hacer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La simple verdad es que todos cometen errores y eso es normal. </font><font style="vertical-align: inherit;">Todos aprendemos de los errores, pero solo de aquellos que pudieron notar y comprender. </font><font style="vertical-align: inherit;">Por lo tanto, utilice herramientas modernas para buscar estos mismos errores, por ejemplo, PVS-Studio. </font><font style="vertical-align: inherit;">Gracias por la atención.</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/eb2/f9c/3bb/eb2f9c3bb5f32f39239298d36431961c.png"></a></div><p></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea compartir este artículo con una audiencia de habla inglesa, utilice el enlace a la traducción: Nikolay Mironov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código de línea única o verificación de Nethermind usando PVS-Studio C # para Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es504296/index.html">Generando ramas aleatorias en Python</a></li>
<li><a href="../es504306/index.html">¿Cómo se fabrica el hardware ruso para el almacenamiento de Aerodisk Vostok en Elbrus?</a></li>
<li><a href="../es504310/index.html">Dicotomía de datos: repensar la relación con datos y servicios.</a></li>
<li><a href="../es504312/index.html">Registro unificado de programas rusos y GPL. Mis cinco centavos</a></li>
<li><a href="../es504314/index.html">Implementación de los comandos docker pull y docker push sin el cliente docker a través de solicitudes HTTP</a></li>
<li><a href="../es504326/index.html">Evgeny Dikiy: "A nivel local, la Antártida ha sido menos contaminada, pero la contaminación global es muy notable aquí"</a></li>
<li><a href="../es504328/index.html">Lecciones de votación electrónica en la Moscú City Duma 2019</a></li>
<li><a href="../es504332/index.html">Publicación útil: todos los cursos, transmisiones y transmisiones técnicas más relevantes</a></li>
<li><a href="../es504334/index.html">Насколько хорошо вы знаете JavaScript?</a></li>
<li><a href="../es504338/index.html">USB over IP в домашних условиях</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>