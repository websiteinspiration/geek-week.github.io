<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☄️ 🐌 👨🏾‍🏭 Installation von VestaCP auf VPS mit Docker zum Downgrade von PHP 🏴󠁧󠁢󠁳󠁣󠁴󠁿 🤵🏻 🚽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gute Zeit! 
 
 Ich werde hier eine Lösung für mein Hosting auf VPS für 5 Euro hinterlassen, hauptsächlich mit dem Ziel, die Implementierung der Lösung...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Installation von VestaCP auf VPS mit Docker zum Downgrade von PHP</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490592/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gute Zeit! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde hier eine Lösung für mein Hosting auf VPS für 5 Euro hinterlassen, hauptsächlich mit dem Ziel, die Implementierung der Lösung für mein Problem beizubehalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor einigen Jahren habe ich einen dedizierten Server für mehr als 20 Websites, einen Datei-Hosting-Service, eine Datenbank auf PostgreSQL für 1C, einen IMAP-Mailserver, gemietet. Ich habe ISPmanager mit einer "unbefristeten" Lizenz als Control Panel verwendet, CentOS 7 (oder sogar 6) wurde als Betriebssystem verwendet, was ich nicht wirklich respektiere, ich mag Debian / Ubuntu mehr. In Zukunft gingen Projekte an soziale Netzwerke, Websites waren nicht mehr notwendig, Domain-Namen wurden freigegeben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Jahr 2019 stellte ich fest, dass sich meine Site und zwei Client-Sites wirklich drehten. Ich brauchte nur IMAP, um E-Mails auf dem Hosting zu speichern. Filesharing-Dienste gingen auch an Cloud-Dienste.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w5/4h/xb/w54hxbcxo5185n2npfiok-dugg4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was tun, wenn eine Hosting-Site mit PHP über 5.4 nicht funktioniert?</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe mich entschlossen, das Projekt zu bereinigen und auf einem günstigeren VPS mit 40 GB Festplatte, 2 CPUs, 4 RAM im Vergleich zu 8 Kernen i7, 750 SSD und 24 RAM bereitzustellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Postgresql-Basis wurde auf einen i5 HP Mini-Computer mit 16 GB RAM in einem Kleiderschrank zu Hause verschoben, RouterOS im neuen VPS im Docker aufgerufen, L2TP konfiguriert und über die Tunnel-1C-Datenbanken von einem anderen VPS mit Windows 8.1 an Bord zugegriffen. </font><font style="vertical-align: inherit;">Zu diesen Zwecken wäre es möglich, das Windows-Betriebssystem auf einem Computer in einem Kleiderschrank bereitzustellen, aber alle PostgreSQL-Dienstskripte werden unter Linux geschärft. Subjektiv funktioniert es unter Linux schneller. Es gibt Clients außerhalb meiner Computer, auf denen die Datenbank gehostet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also einleitend:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gesamtgröße auf einem Hosting von 30 GB zusammen mit Betriebssystem, Websites und E-Mail;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daten in die Cloud sichern;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine selbst geschriebene Seite, zwei auf WP;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenbanken in MySQL;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Möglichkeit, Websites nach Bedarf hinzuzufügen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimale Kontrolle in der SSH-Konsole (benötigt ein Site Control Panel);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Möglichkeit, ein Projekt auf einem Hosting bereitzustellen (freier Speicherplatz und freie Kapazität). </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich Angebote für kostenlose Control Panels studiert hatte, entschied ich mich, bei VestaCP anzuhalten, obwohl ich etwas überrascht war, dass CP die neuesten Versionen der beliebten RedHat / Debian-Distributionen nicht unterstützt. </font><font style="vertical-align: inherit;">Hier ist ein Screenshot zum Zeitpunkt des Schreibens. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9i/bh/uw/9ibhuwrrltcb9m7w66qvwgk776g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei den Mindestsystemanforderungen ist mit meinem VPS alles in Ordnung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, hetzner.cloud, erstellen Sie ein Projekt, erstellen Sie eine CX21-Maschine darin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VestaCP stellt Apache2 einen Nginx-Proxy zur Verfügung. Für jede Site / jeden Benutzer wird eine Konfiguration erstellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde nicht alle Versuche beschreiben, nur der letzte ist Debian 9.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erhalten eines SSH-2-RSA-Schlüssels mit PuTTY</font></font></b>
                        <div class="spoiler_text"> PuTTY  puttygen  SSH-2 RSA ,      Dropbox.<br>
<br>
  Acess  hetzner.cloud    RSA,    PuTTY      SSH-&gt; (  PuTTY RUS)      Dropbox.       . <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
System aktualisieren: </font></font><br>
<br>
<pre><code class="bash hljs">apt-get update -y<font></font>
apt-get upgrade -y <font></font>
apt-get install mc -y<font></font>
reboot<font></font>
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben VestaCP auf Debian 9 gesetzt</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"> </a>. <br>
 Debian    ,  exim -  ,  «y»      exim.   -    ,     : <br>
<br>
<pre><code class="bash hljs">/bin/bash vst-install-debian.sh
</code></pre><br>
  —    VestaCP      http://:8083/ admin password,    . <br>
<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach der Installation des Panels habe ich sofort die Firewall überprüft und war überrascht, dass eine der Regeln den externen Zugriff auf MySQL ermöglicht (MariaDB ist installiert). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uw/cr/es/uwcres1tpfzglmt7b0n1n9snvgc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich empfehle, den Zugriff auf solche Dienste sofort zu deaktivieren. Meine Bruteforce-Kennwörter gingen ungefähr 5 Minuten nach der Installation verloren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir überprüfen die Version von PHP: 7.0.33 aus der Box. </font><font style="vertical-align: inherit;">Ich werde das Problem des Downgrades von PHP auf 5.4.16 lösen (es wurde beschlossen, es auf dem alten CentOS 7-Hosting, epel, httpd + php bereitzustellen:</font></font><br>
<br>
<pre><code class="bash hljs">wget https://download.docker.com/linux/debian/gpg<font></font>
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/debian <span class="hljs-subst">$(lsb_release -cs)</span> stable"</span> | sudo tee -a /etc/apt/sources.list.d/docker.list<font></font>
apt-get install docker-ce<font></font>
systemctl <span class="hljs-built_in">enable</span> docker<font></font>
docker login<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Wenn Sie sich noch nicht registriert haben, müssen Sie sich im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> registrieren </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">.</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Geben Sie zunächst das Site-Skript in VestaCP und die Datenbank für die Site ein. Das Skript befindet sich standardmäßig: /home/site1/wev/site1.ru/public_html </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Docker erstellen wir unsere eigene CentOS-Version basierend auf Standard-Centos: 7. Ich werde meine DockerFile mitbringen:</font></font><br>
<br>
<pre><code class="bash hljs">FROM centos:7<font></font>
MAINTAINER Dmitry Luponos &lt;info@adm55.ru&gt;<font></font>
VOLUME /home/site1<font></font>
EXPOSE 8082<font></font>
RUN yum update -y &amp;&amp; yum install mc -y<font></font>
RUN yum install epel-release -y<font></font>
RUN yum install yum-utils -y<font></font>
RUN yum-config-manager --<span class="hljs-built_in">disable</span> remi-safe<font></font>
RUN yum-config-manager --<span class="hljs-built_in">enable</span> remi<font></font>
RUN yum-config-manager --<span class="hljs-built_in">enable</span> remi-php54<font></font>
RUN yum install -y httpd<font></font>
RUN yum install php-fpm php-cli php-mysqlnd php-gd php-ldap php-odbc php-pdo php-pecl-memcache php-pear php-xml php-xmlrpc php-mbstring php-snmp php-soap php-zip php-opcache php-imap php php-cli php-fpm php-mysqlnd php-zip php-devel php-gd php-mcrypt php-mbstring php-curl php-xml php-pear php-bcmath php-json -y<font></font>
RUN yum clean all<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, was mache ich: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM centos: 7 - Ich wähle die Installation des Docker-Hubs </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VOLUME / home / site1 - Ich leite das Verzeichnis vom Betriebssystem an den </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPOSE 8082-Gastcomputer weiter - Ich öffne den httpd-Port - 8082 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RUN - Ich </font><font style="vertical-align: inherit;">führe </font><font style="vertical-align: inherit;">den Befehl auf dem Computer aus, ohne dass die </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RUN- </font><font style="vertical-align: inherit;">Konsole </font><font style="vertical-align: inherit;">yum clean all - Ich lösche Cache, damit der Computer weniger Platz beansprucht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich fange an, mein eigenes Docker-Image für CentOS 7 zu erstellen:</font></font><br>
<br>
<pre><code class="bash hljs">docker pull centos:7
<span class="hljs-built_in">cd</span> /&lt;  Dockerfile&gt;<font></font>
docker build -t bessome/centos:7 . <font></font>
docker run -it --name centphp54 --expose 8082 --restart always -v /home/site1:/home/site1 bessome/centos7:php54 /bin/bash<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und wir gelangen zur Konsole (-it switch) der erstellten Docker-Instanz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um in Zukunft zur Instanzkonsole zu gelangen, verwende ich die Maschinen-ID, die mit dem Befehl abgerufen werden kann</font></font><pre><code class="bash hljs">docker ps -a</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Art von "e8b6d6ef6c1a". </font></font><br>
<br>
<pre><code class="bash hljs">docker <span class="hljs-built_in">exec</span> -it e8b6d6ef6c1a /bin/bash</code></pre> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und ich bin drinnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Zukunft habe ich EXPOSE abgelehnt - ich muss den Port nicht außerhalb öffnen, es passt, dass nginx die Site innerhalb des Netzwerks 172.17.0.0/24 auf Port 8082 der Docker-Instanz sieht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlüssel</font></font><br>
<br>
<pre><code class="bash hljs">--restart always</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weist den Computer an, immer neu zu starten, wenn der Docker-Dienst neu gestartet wird. Wenn Sie dies vergessen, können Sie Folgendes tun: </font></font><br>
<br>
<pre><code class="bash hljs">docker update --restart always e8b6d6ef6c1a</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Überprüfen Sie, ob die Weiterleitung des Hostverzeichnisses verknüpft ist: </font></font><br>
<br>
<pre><code class="bash hljs">ls /home/site1<font></font>
[root@e8b6d6ef6c1a centos.docker]<span class="hljs-comment"># cd /home/site1</span>
[root@e8b6d6ef6c1a centos.docker]<span class="hljs-comment"># ls</span><font></font>
conf  mail  tmp  web<font></font>
du -sh<font></font>
418M    .<font></font>
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier sind die wichtigsten Einstellungen für die httpd-Instanz, während wir uns in der Konsole befinden:</font></font></b>
                        <div class="spoiler_text">httpd.conf: <pre><code class="bash hljs">Listen 8082<font></font>
IncludeOptional conf.d/*.conf<font></font>
</code></pre><br>
   /home/site1/conf    /etc/httpd/conf.d/site1.conf:<br>
<br>
<pre><code class="bash hljs">&lt;VirtualHost *:8082&gt;<font></font>
<font></font>
    ServerName site1.ru<font></font>
    ServerAlias www.site1.ru<font></font>
    ServerAdmin info@site1.ru<font></font>
    AddDefaultCharset off<font></font>
    DocumentRoot /home/site1/web/site1.ru/public_html<font></font>
    ScriptAlias /cgi-bin/ /home/site1/web/site1.ru/cgi-bin/<font></font>
    Alias /vstats/ /home/site1/web/site1.ru/stats/<font></font>
    Alias /error/ /home/site1/web/site1.ru/document_errors/<font></font>
    &lt;FilesMatch <span class="hljs-string">"\.ph(p[3-5]?|tml)$"</span>&gt;<font></font>
        SetHandler application/x-httpd-php<font></font>
    &lt;/FilesMatch&gt;<font></font>
    DirectoryIndex index.html index.php<font></font>
    &lt;FilesMatch <span class="hljs-string">"\.phps$"</span>&gt;<font></font>
        SetHandler application/x-httpd-php-source<font></font>
    &lt;/FilesMatch&gt;<font></font>
    &lt;Directory /home/site1/web/site1.ru/public_html&gt;<font></font>
        AllowOverride All<font></font>
        Require all granted<font></font>
        Options +Includes -Indexes +ExecCGI<font></font>
        php_admin_value open_basedir /home/tehnolit/web/site1.ru/public_html:/home/site1/tmp<font></font>
        php_admin_value upload_tmp_dir /home/site1/tmp<font></font>
        php_admin_value session.save_path /home/site1/tmp<font></font>
        php_admin_flag engine on<font></font>
    &lt;/Directory&gt;<font></font>
    &lt;Directory /home/site1/web/site1.ru/stats&gt;<font></font>
        AllowOverride All<font></font>
    &lt;/Directory&gt;<font></font>
<font></font>
    IncludeOptional /home/site1/conf/web/apache2.site1.ru.conf*<font></font>
<font></font>
&lt;/VirtualHost&gt;<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Site VestaCP verfügt über ein eigenes Home-Verzeichnis, beispielsweise site1.ru - test. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes werden wir uns mit Docker-Autorun und den darin enthaltenen Maschinen befassen. Außerdem gibt systemctl einen Fehler aus, wenn versucht wird, den httpd-Dienst innerhalb der Instanz zu starten. Wir starten von rc.local VPS:</font></font><br>
<br>
<pre><code class="bash hljs"> cat rc.local
<span class="hljs-comment">#!/bin/sh -e</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># rc.local</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This script is executed at the end of each multiuser runlevel.</span>
<span class="hljs-comment"># Make sure that the script will "exit 0" on success or any other</span>
<span class="hljs-comment"># value on error.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># In order to enable or disable this script just change the execution</span>
<span class="hljs-comment"># bits.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># By default this script does nothing.</span><font></font>
<font></font>
docker <span class="hljs-built_in">exec</span> 5473051a7b3c /usr/sbin/httpd<font></font>
/opt/mpr-start<font></font>
iptables-restore &lt; /usr/src/iptables.lst<font></font>
<font></font>
<span class="hljs-built_in">exit</span> 0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prä- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erstellen einen Dienst das rc.local Boot zu starten</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich muss sagen, dass alle Manipulationen mit den Site-Einstellungen von VestaCP oder VPS vorgenommen werden, mit einer Einschränkung: Bearbeiten von nginx.conf, um auf httpd CentOS7 zuzugreifen:</font></font><br>
<br>
<pre><code class="bash hljs">server {<font></font>
    listen      &lt;IP-VPS&gt;:80;<font></font>
    server_name site1.ru www.site1.ru;<font></font>
    error_log  /var/<span class="hljs-built_in">log</span>/apache2/domains/site1.ru.error.log error;<font></font>
<font></font>
    location / {<font></font>
<span class="hljs-comment">#   docker : </span><font></font>
        proxy_pass      http://172.17.0.2:8082;<font></font>
        location ~* ^.+\.(jpeg|jpg|png|gif|bmp|ico|svg|tif|tiff|css|js|htm|html|ttf|otf|webp|woff|txt|csv|rtf|doc|docx|xls|xlsx|ppt|pptx|odf|odp|ods|odt|pdf|psd|ai|eot|eps|ps|zip|tar|tgz|gz|rar|bz2|7z|aac|m4a|mp3|mp4|ogg|wav|wma|3gp|avi|flv|m4v|mkv|mov|mpeg|mpg|wmv|exe|iso|dmg|swf)$ {<font></font>
            root           /home/site1/web/site1.ru/public_html;<font></font>
            access_log     /var/<span class="hljs-built_in">log</span>/apache2/domains/site1.ru.log combined;<font></font>
            access_log     /var/<span class="hljs-built_in">log</span>/apache2/domains/site1.ru.bytes bytes;<font></font>
            expires        max;<font></font>
            try_files      <span class="hljs-variable">$uri</span> @fallback;<font></font>
        }<font></font>
    }<font></font>
<font></font>
    location /error/ {<font></font>
        <span class="hljs-built_in">alias</span>   /home/site1/web/site1.ru/document_errors/;<font></font>
    }<font></font>
<font></font>
    location @fallback {<font></font>
<span class="hljs-comment">#   docker : </span><font></font>
        proxy_pass      http://172.17.0.2:8082;<font></font>
    }<font></font>
<font></font>
    location ~ /\.ht    {<span class="hljs-built_in">return</span> 404;}<font></font>
    location ~ /\.svn/  {<span class="hljs-built_in">return</span> 404;}<font></font>
    location ~ /\.git/  {<span class="hljs-built_in">return</span> 404;}<font></font>
    location ~ /\.hg/   {<span class="hljs-built_in">return</span> 404;}<font></font>
    location ~ /\.bzr/  {<span class="hljs-built_in">return</span> 404;}<font></font>
<font></font>
    include /home/site1/conf/web/nginx.site1.ru.conf*;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem ist es eine technische Angelegenheit - wir schließen uns MySQL an, richten die entsprechende Site-Datei mit den Verbindungseinstellungen ein und geben die interne Adresse 172.17.0.1 des Head-VPS an. Natürlich sollte die Datenbank bereits bereitgestellt und der Zugriff darauf konfiguriert sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie auf die Site site1.ru zugreifen, sollte daher alles ordnungsgemäß funktionieren. Wenn dies nicht der Fall ist, hat sich der Konfigurationsfehler irgendwo eingeschlichen und erneut überprüft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle anderen Sites funktionieren korrekt mit PHP 7.0, daher werde ich die Konfiguration von VestaCP selbst nicht beschreiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So habe ich die Aufgaben erfüllt, die ich mir gestellt habe. Ich werde es außerhalb des Geltungsbereichs dieses Artikels belassen, um die IP-Adresse der Docker-Instanz 172.17.0.xxx, Pings und andere Dinge herauszufinden. Sie befinden sich nicht in der Docker-Datei. Ich habe die entsprechenden Pakete über yum installiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Auf dem Weg entschied ich mich, RouterOS auch in Docker bereitzustellen. Ich hatte eine Sicherungskopie der L2TP-Serverkonfigurationsdatei von meinem Heimrouter, also nur den Prozess: </font></font><br>
<br>
<pre><code class="bash hljs">docker pull evilfreelancer/docker-routeros<font></font>
docker run -d -p 22202:22 -p 8728:8728 -p 8729:8729 -p 5900:5900 --restart always -ti evilfreelancer/docker-routeros<font></font>
<font></font>
iptables-save &gt; iptables.lst<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden iptables über iptables.lst den Zugriff auf winbox hinzufügen (wir werden einen Zugriffsport hinzufügen, der den beim Erstellen von 8728 und 5900 weitergeleiteten ähnlich ist): </font></font><br>
<br>
<pre><code class="bash hljs">-A INPUT -p tcp -m tcp --dport 8291 -j ACCEPT<font></font>
-A DOCKER -d 172.17.0.3/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 8291 -j ACCEPT<font></font>
-A POSTROUTING -s 172.17.0.3/32 -d 172.17.0.3/32 -p tcp -m tcp --dport 8291 -j MASQUERADE<font></font>
-A DOCKER ! -i docker0 -p tcp -m tcp --dport 8291 -j DNAT --to-destination 172.17.0.3:8291<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und anwendbar in VPS: </font></font><br>
<br>
<pre><code class="bash hljs">iptables-restore &lt; iptables.lst</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leiten Sie Ports an Instanzen weiter, die Docker beim Initialisieren des Computers, während des Docker-Updates erstellt, oder Sie können sie selbst über die iptables-Firewall eingeben - es geht nur um den Geschmack. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Nächstes habe ich die RouterOS-Konfiguration bereitgestellt und die Ports für den Zugriff auf Docker RouterOS weitergeleitet. Alles funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde keine Leistungsmessungen durchführen, im Moment passt alles zu mir und den Kunden. </font><font style="vertical-align: inherit;">Bei Bedarf nehme ich den nächsten VPS mit einer Erhöhung der Leistung und des Arbeitsspeichers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank für Ihre Aufmerksamkeit. Ich hoffe, jemand kann dem Artikel helfen, sich schnell mit Docker zu befassen, und ich kann nach einer Weile darauf zurückkommen und mich an den gesamten Installationsprozess erinnern.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490576/index.html">Ultraschallbad. Teil 1</a></li>
<li><a href="../de490578/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 335 (24. Februar - 1. März)</a></li>
<li><a href="../de490584/index.html">Infineon hat Cross-Signing-Zertifikate in seinen kryptografischen Chips implementiert</a></li>
<li><a href="../de490586/index.html">Was ist Spring Framework? Von der Abhängigkeitsinjektion zur Web-MVC</a></li>
<li><a href="../de490588/index.html">Самодельная подводная лодка с надводной wi-fi антенной</a></li>
<li><a href="../de490594/index.html">FOSS News Nr. 5 - Überprüfung der kostenlosen und Open Source-Nachrichten für den 24. Februar bis 1. März 2020</a></li>
<li><a href="../de490596/index.html">Die Geschichte der Sprachsynthesizer: die ersten mechanischen Installationen</a></li>
<li><a href="../de490598/index.html">Microsoft-Ankündigungen zu Prüfungen und Zertifikaten</a></li>
<li><a href="../de490602/index.html">Hack The Box. Walkthrough Scavenger. DNS, FTP und Spuren eines anderen Hacks</a></li>
<li><a href="../de490604/index.html">Verwenden von Gradle- und Github-Aktionen zum Veröffentlichen eines Java-Projekts im Sonatype Maven Central Repository</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>