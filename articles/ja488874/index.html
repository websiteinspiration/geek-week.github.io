<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ï¸ ğŸ‘’ ğŸ˜¹ ç§ã®è©¦è¡Œç•ªå·5 ğŸ§›ğŸ» ğŸ“° ğŸ§’ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ãã—ã¦ã€ç§ã¯SJã«ãƒ‘ãƒƒãƒã‚’é©ç”¨ã—ã¾ã—ãŸã€‚
 ã‚‚ã†ä¸€åº¦ã€ã‚‚ã†ä¸€åº¦ã€ã‚‚ã†ä¸€åº¦ã€... 
 ã‚ã‚ã€ç§ãŒã‚ãªãŸã«é£½ããŸæ–¹æ³•
 ç§ã®è©¦ã¿ã¯5ç•ªç›®ã§ã™ã€‚
 
 ç§ã®é ­ã®ä¸­ã§å›è»¢
 

ãã‚Œ å°ã•ã„åœ§ç¸®ãƒ©ã‚¤ãƒ³ã‚’ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ã«ã¤ã„ã¦ã®ç´ æ™´ã‚‰ã—ã„è©±ã¨StringJoinerã€ç§ã®é‚ªé­”ã«ãªã£ãŸå›°é›£ã€‚è­¦å‘Šï¼šè§£å‰–ã¨è…¸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ç§ã®è©¦è¡Œç•ªå·5</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488874/"><p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã—ã¦ã€ç§ã¯SJã«ãƒ‘ãƒƒãƒã‚’é©ç”¨ã—ã¾ã—ãŸã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚‚ã†ä¸€åº¦ã€ã‚‚ã†ä¸€åº¦ã€ã‚‚ã†ä¸€åº¦ã€... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ã‚ã€ç§ãŒã‚ãªãŸã«é£½ããŸæ–¹æ³•</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®è©¦ã¿ã¯5ç•ªç›®ã§ã™ã€‚</font></font><br>
</em><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ã®é ­ã®ä¸­ã§å›è»¢</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãã‚Œ </font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°ã•ã„</font></font></del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ§ç¸®ãƒ©ã‚¤ãƒ³ã‚’ã«ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ã«ã¤ã„ã¦ã®ç´ æ™´ã‚‰ã—ã„è©±ã¨</font></font><code>StringJoiner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ç§ã®é‚ªé­”ã«ãªã£ãŸå›°é›£ã€‚</font><font style="vertical-align: inherit;">è­¦å‘Šï¼šè§£å‰–ã¨è…¸å†…ã§ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‹ã‚‰å­ä¾›ã¨å°è±¡ã®ã‚ã‚‹äººã‚’å¤–ã—ã¦ãã ã•ã„ã€‚</font></font></p><a name="habracut"></a><br>
<h4 id="postanovka-zadachi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•é¡Œã®å®šå¼åŒ–</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ãªãŸã¯Javaé–‹ç™ºè€…ã§ã‚ã‚Œã°ã€ã‚ãªãŸã¯ãŠãã‚‰ãåœ§ç¸®ã•ã‚ŒãŸãƒ©ã‚¤ãƒ³ï¼ˆçŸ¥ã£ã¦ã„ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JEP 254</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éå¸¸ã«æ¬¡ã®ã‚ˆã†ã«ã€ã“ã®æ”¹å–„ãŒèª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«ç°¡ç•¥åŒ–ã•ã‚ŒãŸJava 9ã«ç™»å ´ï¼‰ï¼šå†…éƒ¨ã®å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ï¼ˆæœ€å¤§8åŒ…æ‹¬çš„ã«ï¼‰</font></font><code>java.lang.String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨ã—ã¦æç¤ºã•ã‚ŒãŸè¡Œã®å†…å®¹</font></font><code>char[]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã®å¾Œã«ã€ -ã¨ã—ã¦</font></font><code>byte[]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ã“ã‚Œã«ã‚ˆã‚Šã€æ–‡å­—åˆ—ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚æ–‡å­—åˆ—ã¯ã™ã¹ã¦ASCIIã«å±ã—ã¾ã™ï¼ˆã¤ã¾ã‚Šã€1ãƒã‚¤ãƒˆã§ååˆ†ã§ã™ï¼‰ã€‚</font><font style="vertical-align: inherit;">è©³ç´°ã¨ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªå½¢å¼ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã“ã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜è¼‰ã•ã‚Œã¦ã„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸæ–½ã•å¤‰æ›´ã¯</font></font><code>java.lang.AbstractStringBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ç›¸ç¶šäººã¯ãã®ã†ã¡ã‚ã‚‹</font></font><code>java.lang.StringBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><code>java.lang.StringBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã—ã‹ã—ã€</font></font><code>java.util.StringJoiner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-thã§ã¯ã€ã™ã¹ã¦ãŒç•°ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã§é–‹å§‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã‚‹Java 9ã€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–¹æ³•ã§ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ã‚’ä»‹ã—ã¦é€£çµã•ã‚Œã‚‹å†…éƒ¨æ–‡å­—åˆ—ã®é…åˆ—ãŒã‚ã‚Šã¾ã™</font></font><code>toString()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<pre><code class="java hljs">String delimiter = <span class="hljs-keyword">this</span>.delimiter;
<span class="hljs-keyword">char</span>[] chars = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[<span class="hljs-keyword">this</span>.len + addLen];  <span class="hljs-comment">// !!!</span>
<span class="hljs-keyword">int</span> k = getChars(<span class="hljs-keyword">this</span>.prefix, chars, <span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) {<font></font>
  k += getChars(elts[<span class="hljs-number">0</span>], chars, k);        <span class="hljs-comment">//  byte[] -&gt; char[]</span><font></font>
<font></font>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; size; ++i) {<font></font>
    k += getChars(delimiter, chars, k);<font></font>
    k += getChars(elts[i], chars, k);<font></font>
  }<font></font>
}<font></font>
<font></font>
k += getChars(<span class="hljs-keyword">this</span>.suffix, chars, k);
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(chars);                    <span class="hljs-comment">//  char[] -&gt; byte[]</span></code></pre><br>
<p>    ,    ASCII (  2 ),    .      ?    :  <code>byte[]</code>      <code>char[]</code> (     0),        :   .   .   .</p><br>
<h4 id="pervaya-krov"> </h4><br>
<p>,  <code>StringJoiner</code> (JDK 14,   ):</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringJoiner</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String prefix;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String delimiter;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String suffix;<font></font>
<font></font>
  <span class="hljs-comment">/** Contains all the string components added so far. */</span>
  <span class="hljs-keyword">private</span> String[] elts;<font></font>
<font></font>
  <span class="hljs-comment">/** The number of string components added so far. */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> size;<font></font>
<font></font>
  <span class="hljs-comment">/** Total length in chars so far, excluding prefix and suffix. */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> len;<font></font>
<font></font>
  <span class="hljs-comment">// ...</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StringJoiner</span><span class="hljs-params">(CharSequence delimiter,
                        CharSequence prefix,
                        CharSequence suffix)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">this</span>.prefix = prefix.toString();
    <span class="hljs-keyword">this</span>.delimiter = delimiter.toString();
    <span class="hljs-keyword">this</span>.suffix = suffix.toString();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">// ...</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> StringJoiner <span class="hljs-title">add</span><span class="hljs-params">(CharSequence newElement)</span> </span>{
    <span class="hljs-keyword">final</span> String elt = String.valueOf(newElement);
    <span class="hljs-keyword">if</span> (elts == <span class="hljs-keyword">null</span>) {<font></font>
      elts = <span class="hljs-keyword">new</span> String[<span class="hljs-number">8</span>];<font></font>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (size == elts.length)<font></font>
        elts = Arrays.copyOf(elts, <span class="hljs-number">2</span> * size);<font></font>
      len += delimiter.length();<font></font>
    }<font></font>
    len += elt.length();<font></font>
    elts[size++] = elt;<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
  }<font></font>
  <span class="hljs-comment">// ...</span>
}</code></pre><br>
<p>     :    ,       <code>len</code>,     â€”   <code>size</code>.      <code>toString()</code>    .   -  ,         .      2 :  ( <code>char[]</code>)  "" ( <code>byte[]</code>)   :   <code>allLatin1</code>      :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringJoiner</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> allLatin1;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StringJoiner</span><span class="hljs-params">(CharSequence delimiter,
                      CharSequence prefix,
                      CharSequence suffix)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">this</span>.allLatin1 = <span class="hljs-keyword">this</span>.prefix.isLatin1() &amp;&amp; <span class="hljs-keyword">this</span>.delimiter.isLatin1() &amp;&amp; <span class="hljs-keyword">this</span>.suffix.isLatin1();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> StringJoiner <span class="hljs-title">add</span><span class="hljs-params">(CharSequence newElement)</span> </span>{
    <span class="hljs-keyword">final</span> String elt = String.valueOf(newElement);
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>.allLatin1 &amp;= elt.isLatin1();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
  }<font></font>
}</code></pre><br>
<p>,    :).   <code>toString()</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">final</span> String[] elts = <span class="hljs-keyword">this</span>.elts;
  <span class="hljs-keyword">if</span> (elts == <span class="hljs-keyword">null</span> &amp;&amp; emptyValue != <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">return</span> emptyValue;<font></font>
  }<font></font>
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> size = <span class="hljs-keyword">this</span>.size;
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> addLen = prefix.length() + suffix.length();
  <span class="hljs-keyword">if</span> (addLen == <span class="hljs-number">0</span>) {<font></font>
    compactElts();<font></font>
    <span class="hljs-keyword">return</span> size == <span class="hljs-number">0</span> ? <span class="hljs-string">""</span> : elts[<span class="hljs-number">0</span>];<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (allLatin1) {
    <span class="hljs-keyword">return</span> bytesToString(elts, size, addLen);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> charsToString(elts, size, addLen);<font></font>
}</code></pre><br>
<p>    <code>charsToString()</code>,    -  <code>bytesToString()</code>,       <code>byte[]</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">bytesToString</span><span class="hljs-params">(String[] elts, <span class="hljs-keyword">int</span> size, <span class="hljs-keyword">int</span> addLen)</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[len + addLen];
  <span class="hljs-keyword">int</span> k = getBytes(prefix, bytes, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">final</span> String delimiter = <span class="hljs-keyword">this</span>.delimiter;<font></font>
    k += getBytes(elts[<span class="hljs-number">0</span>], bytes, k);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; size; i++) {<font></font>
      k += getBytes(delimiter, bytes, k);<font></font>
      k += getBytes(elts[i], bytes, k);<font></font>
    }<font></font>
  }<font></font>
  getBytes(suffix, bytes, k);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(bytes);<font></font>
}<font></font>
<font></font>
<span class="hljs-meta">@SuppressWarnings("deprecation")</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getBytes</span><span class="hljs-params">(String s, <span class="hljs-keyword">byte</span>[] bytes, <span class="hljs-keyword">int</span> start)</span> </span>{
  <span class="hljs-keyword">int</span> len = s.length();<font></font>
  s.getBytes(<span class="hljs-number">0</span>, len, bytes, start);
  <span class="hljs-keyword">return</span> len;<font></font>
}</code></pre><br>
<p>  â€”      <code>char[]</code>  <code>byte[]</code>    . ,  :</p><br>
<pre><code class="java hljs"><span class="hljs-comment">// JDK 14</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> COMPACT_STRINGS &amp;&amp; coder == LATIN1;<font></font>
  }<font></font>
}</code></pre><br>
<p> ,  <code>StringJoiner</code>   <code>java.util</code>,   <code>String.isLatin1()</code>     <code>java.lang</code>.   â€”    :</p><br>
<pre><code class="java hljs"><span class="hljs-comment">// JDK 11</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">()</span> </span>{                   <span class="hljs-comment">// private !</span>
    <span class="hljs-keyword">return</span> COMPACT_STRINGS &amp;&amp; coder == LATIN1;<font></font>
  }<font></font>
}</code></pre><br>
<p>         ,       ?</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">()</span> </span>{                    <span class="hljs-comment">//  *?</span>
    <span class="hljs-keyword">return</span> COMPACT_STRINGS &amp;&amp; coder == LATIN1;<font></font>
  }<font></font>
}</code></pre><br>
<p> ,       ,    .    ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">     </a>  core-libs-dev (      ).</p><br>
<div class="spoiler"><b class="spoiler_title">   ?</b><div class="spoiler_text"><p>     (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>),          latin = true (    latin1,    ):</p><br>
<pre><code class="plaintext hljs">                       count length         Original  Patched          Units<font></font>
sj                         1      1     26.7 Â±   1.3     38.2 Â±   1.1  ns/op !<font></font>
sj                         1      5     27.4 Â±   0.0     40.5 Â±   2.2  ns/op !<font></font>
sj                         1     10     29.6 Â±   1.9     38.4 Â±   1.9  ns/op !<font></font>
sj                         1    100     61.1 Â±   6.9     47.6 Â±   0.6  ns/op<font></font>
sj                         5      1     91.1 Â±   6.7     83.6 Â±   2.0  ns/op<font></font>
sj                         5      5     96.1 Â±  10.7     85.6 Â±   1.1  ns/op<font></font>
sj                         5     10    105.5 Â±  14.3     84.7 Â±   1.1  ns/op<font></font>
sj                         5    100    266.6 Â±  30.1    139.6 Â±  14.0  ns/op<font></font>
sj                        10      1    190.7 Â±  23.0    162.0 Â±   2.9  ns/op<font></font>
sj                        10      5    200.0 Â±  16.9    167.5 Â±  11.0  ns/op<font></font>
sj                        10     10    216.4 Â±  12.4    164.8 Â±   1.7  ns/op<font></font>
sj                        10    100    545.3 Â±  49.7    282.2 Â±  12.0  ns/op<font></font>
sj                       100      1   1467.0 Â±  90.3   1302.0 Â±  18.5  ns/op<font></font>
sj                       100      5   1491.8 Â± 166.2   1493.0 Â± 135.4  ns/op<font></font>
sj                       100     10   1768.8 Â± 160.6   1760.8 Â± 111.4  ns/op<font></font>
sj                       100    100   3654.3 Â± 113.1   3120.9 Â± 175.9  ns/op<font></font>
sj:Â·gc.alloc.rate.norm     1      1    120.0 Â±   0.0    120.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     1      5    128.0 Â±   0.0    120.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     1     10    144.0 Â±   0.0    136.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     1    100    416.0 Â±   0.0    312.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     5      1    144.0 Â±   0.0    136.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     5      5    200.0 Â±   0.0    168.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     5     10    272.0 Â±   0.0    216.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm     5    100   1632.0 Â±   0.0   1128.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm    10      1    256.0 Â±   0.0    232.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm    10      5    376.0 Â±   0.0    312.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm    10     10    520.0 Â±   0.0    408.0 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm    10    100   3224.1 Â±   0.0   2216.1 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm   100      1   1760.2 Â±  14.9   1544.2 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm   100      5   2960.3 Â±  14.9   2344.2 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm   100     10   4440.4 Â±   0.0   3336.3 Â±   0.0   B/op<font></font>
sj:Â·gc.alloc.rate.norm   100    100  31449.3 Â±  12.2  21346.7 Â±  14.7   B/op</code></pre></div></div><br>
<p>   ,   1  ,  :         ,     .                "" (  ,    ).</p><br>
<h4 id="nabivaem-shishki"> </h4><br>
<p>,  ,       .      :   <code>String.isLatin1()</code>  ,   - :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> java.lang;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringHelper</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">(String str)</span> </span>{
    <span class="hljs-keyword">return</span> str.isLatin1();<font></font>
  }<font></font>
}</code></pre><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a>:</p><br>
<blockquote>You can not change the implementation anymore, by example if instead of having a split between latin1 and non latin1, we decide in the future to split between utf8 and non utf8.<br>
<br>
If you want to optimize StringJoiner, the best way to do it is to use the shared secret mechanism so a java.util class can see implementation details of a java.lang class without exposing those details publicly. As an example, take a look to EnumSet and its implementations.</blockquote><p> :        ,    ,       .         latin1 /  latin1,       (,   UTF-8 /  UTF-8).       â€”  <code>SharedSecrets</code>.</p><br>
<h4 id="glubzhe-eschyo-glubzhe">!  !</h4><br>
<p>   â€” <code>jdk.internal.access.SharedSecrets</code> (      <code>jdk.internal.misc.SharedSecrets</code>). :</p><br>
<pre><code class="java hljs"><span class="hljs-comment">/** A repository of "shared secrets", which are a mechanism for
    calling implementation-private methods in another package without
    using reflection. A package-private class implements a public
    interface and provides the ability to call package-private methods
    within that package; the object implementing that interface is
    provided through a third package to which access is restricted.
    This framework avoids the primary disadvantage of using reflection
    for this purpose, namely the loss of compile-time checking. */</span></code></pre><br>
<p> , ,        ,   "" ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>     :</p><br>
<blockquote>yes!<br>
crossing package boundary in a non public way is not free, but given that StringJoiner is used quite often (directly or indirectly using Collectors.joining()), it may worth the cost.</blockquote><p>    .   ,    "" :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> jdk.internal.access;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JavaLangStringAccess</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">(String str)</span></span>;<font></font>
}</code></pre><br>
<p>  (   ):</p><br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringAccess</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">jdk</span>.<span class="hljs-title">internal</span>.<span class="hljs-title">access</span>.<span class="hljs-title">JavaLangStringAccess</span> </span>{
  <span class="hljs-keyword">static</span> {<font></font>
    SharedSecrets.setJavaLangStringAccess(<span class="hljs-keyword">new</span> StringAccess());<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Method isLatin1;<font></font>
<font></font>
  StringAccess() {<font></font>
    <span class="hljs-keyword">this</span>.isLatin1 = initIsLatin1Method();<font></font>
  }<font></font>
<font></font>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">(String str)</span> </span>{
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> (<span class="hljs-keyword">boolean</span>) isLatin1.invoke(str);<font></font>
    } <span class="hljs-keyword">catch</span> (IllegalAccessException | InvocationTargetException e) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method <span class="hljs-title">initIsLatin1Method</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">try</span> {<font></font>
      Method isLatin1 = String.class.getDeclaredMethod("isLatin1");<font></font>
      isLatin1.setAccessible(<span class="hljs-keyword">true</span>);
      <span class="hljs-keyword">return</span> isLatin1;<font></font>
    } <span class="hljs-keyword">catch</span> (NoSuchMethodException e) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(e);<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<p>   <code>SharedSecrets</code> (         <code>StringAccess</code>):</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedSecrets</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Unsafe unsafe = Unsafe.getUnsafe();<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JavaLangStringAccess javaLangStringAccess;<font></font>
<font></font>
  <span class="hljs-comment">// ...</span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JavaLangStringAccess <span class="hljs-title">getJavaLangStringAccess</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (javaLangStringAccess == <span class="hljs-keyword">null</span>) {<font></font>
      unsafe.ensureClassInitialized(StringAccess.class);<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> javaLangStringAccess;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setJavaLangStringAccess</span><span class="hljs-params">(JavaLangStringAccess stringAccess)</span> </span>{<font></font>
    javaLangStringAccess = stringAccess;<font></font>
  }<font></font>
}</code></pre><br>
<p>,   <code>StringJoiner.add()</code>      ,    <code>JavaLangStringAccess.isLatin1()</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringJoiner</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> allLatin1;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> StringJoiner <span class="hljs-title">add</span><span class="hljs-params">(CharSequence newElement)</span> </span>{
    <span class="hljs-keyword">final</span> String elt = String.valueOf(newElement);
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>.allLatin1 &amp;= isLatin1(elt);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">(String str)</span> </span>{
    <span class="hljs-keyword">return</span> SharedSecrets.getJavaLangStringAccess().isLatin1(str);<font></font>
  }<font></font>
}</code></pre><br>
<p>  ,      ,   â€”    .  ,        , . .        "".   ,    :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringJoiner</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> allLatin1;<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">StringJoiner</span><span class="hljs-params">(CharSequence delimiter,
                      CharSequence prefix,
                      CharSequence suffix)</span> </span>{
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">this</span>.allLatin1 = isLatin1(<span class="hljs-keyword">this</span>.prefix) &amp;&amp; isLatin1(<span class="hljs-keyword">this</span>.delimiter) &amp;&amp; isLatin1(<span class="hljs-keyword">this</span>.suffix);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> StringJoiner <span class="hljs-title">add</span><span class="hljs-params">(CharSequence newElement)</span> </span>{
    <span class="hljs-keyword">final</span> String elt = String.valueOf(newElement);
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">this</span>.allLatin1 &amp;= isLatin1(elt);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
  }<font></font>
}</code></pre><br>
<p>,   10  .         <code>allLatin1</code>  <code>false</code>,    ,      .         <code>char[]</code>.</p><br>
<p> ,    :   <code>allLatin1</code>        <code>toString()</code>.           <code>false</code>,     :</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">allLatin1</span><span class="hljs-params">(String[] strings, <span class="hljs-keyword">int</span> size)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {<font></font>
    String str = strings[i];<font></font>
    <span class="hljs-keyword">if</span> (!SharedSecrets.getJavaLangStringAccess().isLatin1(str)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">psdLatin1</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> SharedSecrets.getJavaLangStringAccess().isLatin1(delimiter)<font></font>
      &amp;&amp; SharedSecrets.getJavaLangStringAccess().isLatin1(prefix)<font></font>
      &amp;&amp; SharedSecrets.getJavaLangStringAccess().isLatin1(suffix)<font></font>
}</code></pre><br>
<p> <code>toString()</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">final</span> String[] elts = <span class="hljs-keyword">this</span>.elts;
  <span class="hljs-keyword">if</span> (elts == <span class="hljs-keyword">null</span> &amp;&amp; emptyValue != <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">return</span> emptyValue;<font></font>
  }<font></font>
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> size = <span class="hljs-keyword">this</span>.size;
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> addLen = prefix.length() + suffix.length();
  <span class="hljs-keyword">if</span> (addLen == <span class="hljs-number">0</span>) {<font></font>
    compactElts();<font></font>
    <span class="hljs-keyword">return</span> size == <span class="hljs-number">0</span> ? <span class="hljs-string">""</span> : elts[<span class="hljs-number">0</span>];<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (psdLatin1() &amp;&amp; allLatin1(elts, size)) {
    <span class="hljs-keyword">return</span> bytesToString(elts, size, addLen);<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> charsToString(elts, size, addLen);<font></font>
}</code></pre><br>
<p>  ,       :</p><br>
<div class="spoiler"><b class="spoiler_title"> -  ,     ...</b><div class="spoiler_text"><pre><code class="plaintext hljs">Benchmark      count    latin  len        Original          Patched<font></font>
sj                 1     true    1    26.9 Â±   0.7     48.8 Â±   2.2 ns/op !<font></font>
sj                 1     true    5    30.5 Â±   1.0     46.1 Â±   2.1 ns/op !<font></font>
sj                 1     true   10    31.2 Â±   0.6     47.3 Â±   1.3 ns/op !<font></font>
sj                 1     true  100    62.5 Â±   3.3     79.9 Â±   4.8 ns/op !<font></font>
sj                 5     true    1    78.2 Â±   1.6    110.3 Â±   2.9 ns/op !<font></font>
sj                 5     true    5    94.2 Â±   8.7    116.6 Â±   0.7 ns/op !<font></font>
sj                 5     true   10    95.3 Â±   6.9    100.1 Â±   0.4 ns/op<font></font>
sj                 5     true  100   188.0 Â±  10.2    136.0 Â±   0.4 ns/op<font></font>
sj                10     true    1   160.3 Â±   4.5    172.9 Â±   0.8 ns/op<font></font>
sj                10     true    5   169.0 Â±   4.7    180.2 Â±   9.1 ns/op<font></font>
sj                10     true   10   205.7 Â±  16.4    182.7 Â±   1.1 ns/op<font></font>
sj                10     true  100   366.5 Â±  17.0    284.5 Â±   3.1 ns/op<font></font>
sj               100     true    1  1117.6 Â±  11.1   2123.7 Â±  11.1 ns/op !<font></font>
sj               100     true    5  1270.7 Â±  40.2   2163.6 Â±  12.4 ns/op !<font></font>
sj               100     true   10  1364.4 Â±  14.0   2283.8 Â±  16.1 ns/op !<font></font>
sj               100     true  100  3592.9 Â± 164.8   3535.2 Â±  29.9 ns/op<font></font>
<font></font>
sj                 1    false    1    35.6 Â±   1.2     59.1 Â±   3.0 ns/op !<font></font>
sj                 1    false    5    39.3 Â±   1.2     52.6 Â±   2.5 ns/op !<font></font>
sj                 1    false   10    42.2 Â±   1.6     53.6 Â±   0.3 ns/op !<font></font>
sj                 1    false  100    70.5 Â±   1.8     86.4 Â±   0.4 ns/op !<font></font>
sj                 5    false    1    89.0 Â±   3.5    102.2 Â±   1.0 ns/op !<font></font>
sj                 5    false    5    87.6 Â±   0.7    106.5 Â±   1.2 ns/op !<font></font>
sj                 5    false   10   109.0 Â±   5.6    116.5 Â±   1.2 ns/op !<font></font>
sj                 5    false  100   324.0 Â±  16.5    221.9 Â±   0.5 ns/op<font></font>
sj                10    false    1   183.9 Â±   5.9    204.7 Â±   5.5 ns/op !<font></font>
sj                10    false    5   198.7 Â±   9.7    202.4 Â±   1.5 ns/op !<font></font>
sj                10    false   10   196.7 Â±   6.9    226.7 Â±   6.4 ns/op !<font></font>
sj                10    false  100   535.8 Â±   2.3    553.0 Â±   5.6 ns/op !<font></font>
sj               100    false    1  1674.6 Â± 122.1   1940.8 Â±  16.2 ns/op !<font></font>
sj               100    false    5  1791.9 Â±  58.1   2158.1 Â±  12.0 ns/op !<font></font>
sj               100    false   10  2124.1 Â± 193.3   2364.0 Â±  25.2 ns/op !<font></font>
sj               100    false  100  4323.4 Â±  29.2   4675.5 Â±  11.8 ns/op !<font></font>
<font></font>
sj:Â·gc.a.r.n       1     true    1   120.0 Â±   0.0    120.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       1     true    5   128.0 Â±   0.0    120.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       1     true   10   144.0 Â±   0.0    136.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       1     true  100   416.0 Â±   0.0    312.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5     true    1   144.0 Â±   0.0    136.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5     true    5   200.0 Â±   0.0    168.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5     true   10   272.0 Â±   0.0    216.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5     true  100  1632.0 Â±   0.0   1128.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n      10     true    1   256.0 Â±   0.0    232.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n      10     true    5   376.0 Â±   0.0    316.8 Â±   4.9  B/op<font></font>
sj:Â·gc.a.r.n      10     true   10   520.0 Â±   0.0    408.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n      10     true  100  3224.1 Â±   0.0   2236.9 Â±  21.2  B/op<font></font>
sj:Â·gc.a.r.n     100     true    1  1748.1 Â±   4.0   1592.2 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n     100     true    5  2948.2 Â±   4.0   2392.3 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n     100     true   10  4444.3 Â±   4.0   3384.3 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n     100     true  100  1441.4 Â±   0.0  21385.4 Â±   0.0  B/op<font></font>
<font></font>
sj:Â·gc.a.r.n       1    false    1   144.0 Â±   0.0    144.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       1    false    5   160.0 Â±   0.0    160.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       1    false   10   184.0 Â±   0.0    184.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       1    false  100   640.0 Â±   0.0    640.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5    false    1   184.0 Â±   0.0    184.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5    false    5   280.0 Â±   0.0    280.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5    false   10   400.0 Â±   0.0    400.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n       5    false  100  2664.1 Â±   0.0   2664.1 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n      10    false    1   320.0 Â±   0.0    334.4 Â±   7.4  B/op<font></font>
sj:Â·gc.a.r.n      10    false    5   520.0 Â±   0.0    520.0 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n      10    false   10   760.0 Â±   0.0    769.6 Â±   6.5  B/op<font></font>
sj:Â·gc.a.r.n      10    false  100  5264.2 Â±   0.0   5273.8 Â±   6.5  B/op<font></font>
sj:Â·gc.a.r.n     100    false    1  2204.2 Â±   4.0   2216.3 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n     100    false    5  4196.3 Â±   6.2   4216.4 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n     100    false   10  6696.5 Â±   5.4   6712.6 Â±   0.0  B/op<font></font>
sj:Â·gc.a.r.n     100    false  100  1702.0 Â±   4.1  51714.4 Â±   0.0  B/op</code></pre></div></div><br>
<p>,    ,         .  ,     ""    .</p><br>
<h4 id="replika-iz-zala">  </h4><br>
<p> -    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link">lany</a>     .    (  ):</p><br>
<blockquote>Hello!<br>
<br>
In many tests, I see little or no performance improvements. E.g.:<br>
stringJoiner 100 10 1768.8 Â±160.6 1760.8 Â± 111.4 ns/op<br>
<br>
How would you explain that this code change doesn't improve the performance for given count and length?<br>
<br>
<strong>Also, you are using <code>new String(bytes)</code> assuming that the platform charset is latin1-compatible. This is not always true, so your code would produce incorrect results depending on this setting. In general, decoding via charset is tons of extra work. Instead, I would experiment with pre-sized StringBuilder inside compactElts, instead of char[] array. While it does some extra checks, StringBuilder already can use the compact string representation, so if it's properly pre-sized, no extra memory will be allocated.</strong><br>
<br>
<strong>Finally, if you optimize for the case when X is true you should always benchmark what happens when X is false. It's great that in some cases we see a speedup for latin1 strings. But what if not all of the strings are latin1?</strong> Is there any performance degradation? If yes, can we tolerate it?</blockquote><p>     . ,      <code>java.lang.String</code>,     :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span> coder;<font></font>
<font></font>
 <span class="hljs-comment">/**
  * <span class="hljs-doctag">@implNote</span>
  * The actual value for this field is injected by JVM. The static       &lt;--- !!!
  * initialization block is used to set the value here to communicate
  * that this static final field is not statically foldable, and to
  * avoid any possible circular dependency during vm initialization.
  */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> COMPACT_STRINGS;<font></font>
<font></font>
  <span class="hljs-keyword">static</span> {<font></font>
    COMPACT_STRINGS = <span class="hljs-keyword">true</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> COMPACT_STRINGS &amp;&amp; coder == LATIN1;<font></font>
  }<font></font>
}</code></pre><br>
<p>     ,            ?         <code>-XX:-CompactStrings</code>      <code>String.COMPACT_STRINGS</code> (     <code>true</code>). ,  â€” <code>String.COMPACT_STRINGS</code>  <code>false</code>. ,  </p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span> </span>{<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> COMPACT_STRINGS &amp;&amp; coder == LATIN1;<font></font>
  }<font></font>
}</code></pre><br>
<p>. .   <code>isLatin1()</code>  <code>true</code>,    .    :      <code>bytesToString()</code>,  ,    ,      ,       .  :</p><br>
<blockquote><strong>In general, decoding via charset is tons of extra work. Instead, I would experiment with pre-sized StringBuilder inside compactElts, instead of char[] array. While it does some extra checks, StringBuilder already can use the compact string representation, so if it's properly pre-sized, no extra memory will be allocated.</strong></blockquote><p>     â€”     <code>char[]</code> / <code>byte[]</code>,       <code>StringBuilder</code>-,         <code>java.lang</code>.</p><br>
<p> , :</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">final</span> String[] elts = <span class="hljs-keyword">this</span>.elts;
  <span class="hljs-keyword">if</span> (elts == <span class="hljs-keyword">null</span> &amp;&amp; emptyValue != <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">return</span> emptyValue;<font></font>
  }<font></font>
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> size = <span class="hljs-keyword">this</span>.size;
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> addLen = prefix.length() + suffix.length();
  <span class="hljs-keyword">if</span> (addLen == <span class="hljs-number">0</span>) {<font></font>
    compactElts();<font></font>
    <span class="hljs-keyword">return</span> size == <span class="hljs-number">0</span> ? <span class="hljs-string">""</span> : elts[<span class="hljs-number">0</span>];<font></font>
  }<font></font>
  StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder(len + addLen).append(prefix);
  <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) {<font></font>
    sb.append(elts[<span class="hljs-number">0</span>]);<font></font>
    String delimiter = <span class="hljs-keyword">this</span>.delimiter;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; size; i++) {<font></font>
      sb.append(delimiter).append(elts[i]);<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> sb.append(suffix).toString();<font></font>
}</code></pre><br>
<p>,   .      ,      :</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> AbstractStringBuilder <span class="hljs-title">append</span><span class="hljs-params">(String str)</span> </span>{
  <span class="hljs-keyword">if</span> (str == <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">return</span> appendNull();<font></font>
  }<font></font>
  <span class="hljs-keyword">int</span> len = str.length();<font></font>
  ensureCapacityInternal(count + len);<font></font>
  putStringAt(count, str);<font></font>
  count += len;<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">putStringAt</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, String str)</span> </span>{
  <span class="hljs-keyword">if</span> (getCoder() != str.coder()) {<font></font>
    inflate();<font></font>
  }<font></font>
  str.getBytes(value, index, coder);<font></font>
}</code></pre><br>
<p>      . :</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">Benchmark     count  latin   len          Original     StringBuilder<font></font>
sj                1   true     1      26.9 Â±   0.7      33.4 Â±   0.2  ns/op !<font></font>
sj                1   true     5      30.5 Â±   1.0      33.0 Â±   0.1  ns/op !<font></font>
sj                1   true    10      31.2 Â±   0.6      34.3 Â±   0.3  ns/op !<font></font>
sj                1   true   100      62.5 Â±   3.3      44.4 Â±   0.1  ns/op<font></font>
sj                5   true     1      78.2 Â±   1.6      87.8 Â±   0.8  ns/op !<font></font>
sj                5   true     5      94.2 Â±   8.7      88.2 Â±   0.9  ns/op<font></font>
sj                5   true    10      95.3 Â±   6.9      91.6 Â±   0.6  ns/op<font></font>
sj                5   true   100     188.0 Â±  10.2     126.1 Â±   0.7  ns/op<font></font>
sj               10   true     1     160.3 Â±   4.5     177.6 Â±   0.8  ns/op !<font></font>
sj               10   true     5     169.0 Â±   4.7     179.4 Â±   1.0  ns/op !<font></font>
sj               10   true    10     205.7 Â±  16.4     189.5 Â±   1.2  ns/op<font></font>
sj               10   true   100     366.5 Â±  17.0     290.0 Â±   0.8  ns/op<font></font>
sj              100   true     1    1117.6 Â±  11.1    1563.8 Â±   2.8  ns/op !<font></font>
sj              100   true     5    1270.7 Â±  40.2    1592.4 Â±   4.0  ns/op !<font></font>
sj              100   true    10    1364.4 Â±  14.0    1773.7 Â±  57.7  ns/op !<font></font>
sj              100   true   100    3592.9 Â± 164.8    2899.2 Â±  51.0  ns/op<font></font>
<font></font>
sj                1  false     1      35.6 Â±   1.2      52.7 Â±   1.2  ns/op !<font></font>
sj                1  false     5      39.3 Â±   1.2      54.4 Â±   1.6  ns/op !<font></font>
sj                1  false    10      42.2 Â±   1.6      52.2 Â±   1.0  ns/op !<font></font>
sj                1  false   100      70.5 Â±   1.8      78.6 Â±   1.2  ns/op !<font></font>
sj                5  false     1      89.0 Â±   3.5     116.3 Â±   3.8  ns/op !<font></font>
sj                5  false     5      87.6 Â±   0.7     115.2 Â±   2.9  ns/op !<font></font>
sj                5  false    10     109.0 Â±   5.6     126.5 Â±   0.5  ns/op !<font></font>
sj                5  false   100     324.0 Â±  16.5     288.9 Â±   0.5  ns/op <font></font>
sj               10  false     1     183.9 Â±   5.9     261.2 Â±   7.7  ns/op !<font></font>
sj               10  false     5     198.7 Â±   9.7     253.3 Â±   6.7  ns/op !<font></font>
sj               10  false    10     196.7 Â±   6.9     274.3 Â±   7.0  ns/op !<font></font>
sj               10  false   100     535.8 Â±   2.3     677.3 Â±   6.4  ns/op !<font></font>
sj              100  false     1    1674.6 Â± 122.1    2212.5 Â±  32.2  ns/op !<font></font>
sj              100  false     5    1791.9 Â±  58.1    2492.8 Â±  30.9  ns/op !<font></font>
sj              100  false    10    2124.1 Â± 193.3    2611.7 Â±  17.5  ns/op !<font></font>
sj              100  false   100    4323.4 Â±  29.2    5501.3 Â±  21.1  ns/op !<font></font>
<font></font>
sj:Â·gc.a.r.n      1   true     1     120.0 Â±   0.0     144.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      1   true     5     128.0 Â±   0.0     144.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      1   true    10     144.0 Â±   0.0     160.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      1   true   100     416.0 Â±   0.0     336.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n      5   true     1     144.0 Â±   0.0     160.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      5   true     5     200.0 Â±   0.0     192.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n      5   true    10     272.0 Â±   0.0     240.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n      5   true   100    1632.0 Â±   0.0    1152.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n     10   true     1     256.0 Â±   0.0     256.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n     10   true     5     376.0 Â±   0.0     336.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n     10   true    10     520.0 Â±   0.0     432.0 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n     10   true   100    3224.1 Â±   0.0    2240.1 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n    100   true     1    1748.1 Â±   4.0    1568.2 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n    100   true     5    2948.2 Â±   4.0    2368.2 Â±   0.0   B/op <font></font>
sj:Â·gc.a.r.n    100   true    10    4444.3 Â±   4.0    3364.3 Â±   4.0   B/op <font></font>
sj:Â·gc.a.r.n    100   true   100   31441.4 Â±   0.0   21365.1 Â±   4.1   B/op <font></font>
<font></font>
sj:Â·gc.a.r.n      1  false     1     144.0 Â±   0.0     192.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      1  false     5     160.0 Â±   0.0     208.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      1  false    10     184.0 Â±   0.0     240.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      1  false   100     640.0 Â±   0.0     784.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      5  false     1     184.0 Â±   0.0     240.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      5  false     5     280.0 Â±   0.0     349.6 Â±   2.4   B/op !<font></font>
sj:Â·gc.a.r.n      5  false    10     400.0 Â±   0.0     496.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n      5  false   100    2664.1 Â±   0.0    3216.1 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n     10  false     1     320.0 Â±   0.0     384.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n     10  false     5     520.0 Â±   0.0     624.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n     10  false    10     760.0 Â±   0.0     912.0 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n     10  false   100    5264.2 Â±   0.0    6320.3 Â±   0.0   B/op !<font></font>
sj:Â·gc.a.r.n    100  false     1    2204.2 Â±   4.0    2436.3 Â±   6.8   B/op !<font></font>
sj:Â·gc.a.r.n    100  false     5    4196.3 Â±   6.2    4832.4 Â±   6.6   B/op !<font></font>
sj:Â·gc.a.r.n    100  false    10    6696.5 Â±   5.4    7844.7 Â±   4.0   B/op !<font></font>
sj:Â·gc.a.r.n    100  false   100   51702.0 Â±   4.1   61838.6 Â±   6.2   B/op !</code></pre></div></div><br>
<p>,    .           (    ),      .</p><br>
<h4 id="prizrak-ash"> </h4><br>
<p>   ,   .   <code>String.isLatin1()</code> ,    â€”     ,  <code>StringBuilder</code>-  ,  .  ? ,  .</p><br>
<p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>     â€”    JEP 254:</p><br>
<blockquote>As a point of interest, some investigation of updating StringJoiner for CompactStrings was done a while back.<br>
<br>
See <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">https://bugs.openjdk.java.net/browse/JDK-8148937</a></blockquote><p>      2016    :</p><br>
<blockquote>This is seems to be a performance optimization, but it clashes with Compact Strings which now have to re-compress the resulting char[] array into byte[]. We may want to extend this mechanism by figuring out the coders for arguments, and creating byte[] with appropriate coder, then using a private String constructor that does not re-compress.</blockquote><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>   .  :<br>
1)     <code>StringJoiner</code>-    <code>SharedSecrets</code> ( 89  "")<br>
2)        . <code>char[]</code>   ,      /   .<br>
3)         <code>JavaLangAccess</code></p><br>
<p>     ,   ,  .              .    <code>SharedSecrets</code> -&gt; <code>JavaLangAccess</code> -&gt; <code>java.lang.System</code>   ,  <code>String.isLatin1()</code>   <code>System</code>!</p><br>
<p>, ,     , :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">JavaLangAccess</span> </span>{
  <span class="hljs-comment">//...</span>
  <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">(String str)</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">System</span> </span>{
  <span class="hljs-comment">//...</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isLatin1</span><span class="hljs-params">(String str)</span> </span>{
    <span class="hljs-keyword">return</span> str.isLatin1();<font></font>
  }<font></font>
}</code></pre><br>
<p>        .   .    :</p><br>
<blockquote>In general, decoding via charset is tons of extra work.</blockquote><p>,       <code>new String(byte[])</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">bytesToString</span><span class="hljs-params">(String[] elts, <span class="hljs-keyword">int</span> size, <span class="hljs-keyword">int</span> addLen)</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[len + addLen];
  <span class="hljs-keyword">int</span> k = getBytes(prefix, bytes, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">final</span> String delimiter = <span class="hljs-keyword">this</span>.delimiter;<font></font>
    k += getBytes(elts[<span class="hljs-number">0</span>], bytes, k);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; size; i++) {<font></font>
      k += getBytes(delimiter, bytes, k);<font></font>
      k += getBytes(elts[i], bytes, k);<font></font>
    }<font></font>
  }<font></font>
  getBytes(suffix, bytes, k);<font></font>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(bytes);<font></font>
}</code></pre><br>
<p>  -   â€¦      :</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] bytes)</span> </span>{
  <span class="hljs-keyword">this</span>(bytes, <span class="hljs-number">0</span>, bytes.length);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-keyword">byte</span> bytes[], <span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> length)</span> </span>{<font></font>
  checkBoundsOffCount(offset, length, bytes.length);<font></font>
  StringCoding.Result ret = StringCoding.decode(bytes, offset, length); <span class="hljs-comment">// </span>
  <span class="hljs-keyword">this</span>.value = ret.value;
  <span class="hljs-keyword">this</span>.coder = ret.coder;<font></font>
}</code></pre><br>
<p>  <code>new String(byte[])</code>   .   ,   , <code>StringBuilder</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-meta">@HotSpotIntrinsicCandidate</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// Create a copy, don't share the array</span>
  <span class="hljs-keyword">return</span> isLatin1() <font></font>
       ? StringLatin1.newString(value, <span class="hljs-number">0</span>, count)   <span class="hljs-comment">// &lt;---</span>
       :  StringUTF16.newString(value, <span class="hljs-number">0</span>, count);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringLatin1</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">newString</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] val, <span class="hljs-keyword">int</span> index, <span class="hljs-keyword">int</span> len)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(Arrays.copyOfRange(val, index, index + len), LATIN1);<font></font>
  }<font></font>
}</code></pre><br>
<p> ,        , . .  <code>StringBuilder.toString()</code>     .  ,     <code>StringBuilder</code>  .          <code>StringJoiner.toString()</code>   ,     .    <code>StringLatin1.newString(byte[])</code>:</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringLatin1</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">newString</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] val, <span class="hljs-keyword">int</span> index, <span class="hljs-keyword">int</span> len)</span> </span>{
    <span class="hljs-keyword">byte</span>[] copy = Arrays.copyOfRange(val, index, index + len);
    <span class="hljs-keyword">return</span> newString(copy);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">newString</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] val)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> String(val, LATIN1);<font></font>
  }<font></font>
}</code></pre><br>
<p>   ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  </a> (     ).      ,         !</p><br>
<p> :       .         JDK 14,    .</p><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text"><pre><code class="plaintext hljs">        latin cnt  len        Original            Mine             ASh<font></font>
<font></font>
sj       true   1    1     27.7 Â±  1.2     22.1 Â±  0.2     19.7 Â±  0.2  ns/op<font></font>
sj       true   1    5     27.7 Â±  0.1     22.3 Â±  0.0     19.8 Â±  0.0  ns/op<font></font>
sj       true   1   10     29.0 Â±  0.6     23.2 Â±  0.0     20.1 Â±  0.1  ns/op<font></font>
sj       true   1  100     51.4 Â±  0.1     31.4 Â±  0.1     32.9 Â±  0.1  ns/op<font></font>
sj       true   5    1     71.1 Â±  0.4     64.9 Â±  0.3     53.8 Â±  0.1  ns/op<font></font>
sj       true   5    5     79.5 Â±  0.3     65.5 Â±  0.3     54.8 Â±  0.1  ns/op<font></font>
sj       true   5   10     81.2 Â±  0.3     67.7 Â±  0.2     56.1 Â±  0.1  ns/op<font></font>
sj       true   5  100    150.0 Â±  0.4     86.5 Â±  0.5     78.5 Â±  0.3  ns/op<font></font>
sj       true  10    1    145.5 Â±  0.7    142.5 Â±  0.4    127.1 Â±  0.5  ns/op<font></font>
sj       true  10    5    160.0 Â±  0.8    145.6 Â±  0.2    130.8 Â±  0.3  ns/op<font></font>
sj       true  10   10    165.6 Â±  0.4    150.8 Â±  0.3    138.9 Â±  0.4  ns/op<font></font>
sj       true  10  100    340.2 Â±  1.2    189.3 Â±  0.4    175.2 Â±  0.7  ns/op<font></font>
sj       true 100    1   1114.3 Â± 15.9   1372.7 Â± 53.0   1197.4 Â± 34.0  ns/op !<font></font>
sj       true 100    5   1184.2 Â± 18.5   1385.9 Â± 56.0   1159.0 Â± 32.3  ns/op<font></font>
sj       true 100   10   1345.8 Â± 13.9   1369.0 Â±  2.7   1233.5 Â± 32.9  ns/op<font></font>
sj       true 100  100   3156.1 Â± 19.1   1844.1 Â±  4.1   1727.9 Â± 37.6  ns/op<font></font>
<font></font>
sj      false   1    1     33.5 Â±  0.4     34.9 Â±  0.1     19.6 Â±  0.0  ns/op<font></font>
sj      false   1    5     33.3 Â±  0.3     35.9 Â±  0.1     20.1 Â±  0.1  ns/op<font></font>
sj      false   1   10     33.8 Â±  0.1     35.9 Â±  0.1     20.6 Â±  0.0  ns/op<font></font>
sj      false   1  100     57.5 Â±  0.2     58.3 Â±  0.1     39.6 Â±  0.1  ns/op<font></font>
sj      false   5    1     82.9 Â±  0.5     82.0 Â±  0.8     64.2 Â±  1.3  ns/op<font></font>
sj      false   5    5     86.0 Â±  0.5     84.8 Â±  0.9     66.6 Â±  0.8  ns/op<font></font>
sj      false   5   10     96.9 Â±  0.5     92.5 Â±  0.6     76.9 Â±  0.7  ns/op<font></font>
sj      false   5  100    224.2 Â±  0.6    226.7 Â±  0.7    125.1 Â±  0.6  ns/op<font></font>
sj      false  10    1    165.7 Â±  0.9    167.6 Â±  3.2    152.1 Â±  1.0  ns/op<font></font>
sj      false  10    5    178.4 Â±  0.7    179.6 Â±  2.1    163.7 Â±  0.9  ns/op<font></font>
sj      false  10   10    191.7 Â±  0.9    195.9 Â±  2.2    172.5 Â±  0.8  ns/op<font></font>
sj      false  10  100    534.4 Â±  1.4    534.5 Â±  1.3    305.2 Â±  1.1  ns/op<font></font>
sj      false 100    1   1435.9 Â±  9.5   1428.2 Â±  3.2   1333.0 Â±  4.7  ns/op<font></font>
sj      false 100    5   1618.5 Â± 14.3   1595.2 Â±  3.7   1379.7 Â± 10.4  ns/op<font></font>
sj      false 100   10   1898.1 Â±  9.4   1860.8 Â±  4.7   1531.5 Â± 13.7  ns/op<font></font>
sj      false 100  100   4247.4 Â± 60.7   4150.1 Â±  9.1   2423.8 Â± 11.9  ns/op<font></font>
<font></font>
g.a.r.n  true   1    1    124.0 Â±  4.0     96.0 Â±  0.0     96.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   1    5    128.0 Â±  0.0     96.0 Â±  0.0     96.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   1   10    144.0 Â±  0.0    104.0 Â±  0.0    104.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   1  100    416.0 Â±  0.0    192.0 Â±  0.0    192.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   5    1    144.0 Â±  0.0    104.0 Â±  0.0     96.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   5    5    200.0 Â±  0.0    120.0 Â±  0.0    120.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   5   10    272.0 Â±  0.0    144.0 Â±  0.0    144.0 Â±  0.0   B/op<font></font>
g.a.r.n  true   5  100   1632.0 Â±  0.0    600.0 Â±  0.0    592.0 Â±  0.0   B/op<font></font>
g.a.r.n  true  10    1    256.0 Â±  0.0    192.0 Â±  0.0    184.0 Â±  0.0   B/op<font></font>
g.a.r.n  true  10    5    376.0 Â±  0.0    232.0 Â±  0.0    224.0 Â±  0.0   B/op<font></font>
g.a.r.n  true  10   10    520.0 Â±  0.0    280.0 Â±  0.0    272.0 Â±  0.0   B/op<font></font>
g.a.r.n  true  10  100   3224.1 Â±  0.0   1184.0 Â±  0.0   1168.0 Â±  0.0   B/op<font></font>
g.a.r.n  true 100    1   1752.1 Â±  5.4   1328.2 Â±  5.4   1244.1 Â±  9.5   B/op<font></font>
g.a.r.n  true 100    5   2952.2 Â±  5.4   1728.2 Â±  5.4   1627.3 Â±  7.6   B/op<font></font>
g.a.r.n  true 100   10   4444.4 Â±  4.0   2216.2 Â±  0.0   2140.2 Â±  9.5   B/op<font></font>
g.a.r.n  true 100  100  31445.6 Â±  4.0  11216.7 Â±  0.0  11135.0 Â±  9.3   B/op<font></font>
<font></font>
g.a.r.n false   1    1    144.0 Â±  0.0    144.0 Â±  0.0     96.0 Â±  0.0   B/op<font></font>
g.a.r.n false   1    5    160.0 Â±  0.0    160.0 Â±  0.0    104.0 Â±  0.0   B/op<font></font>
g.a.r.n false   1   10    184.0 Â±  0.0    184.0 Â±  0.0    112.0 Â±  0.0   B/op<font></font>
g.a.r.n false   1  100    640.0 Â±  0.0    640.0 Â±  0.0    288.0 Â±  0.0   B/op<font></font>
g.a.r.n false   5    1    184.0 Â±  0.0    184.0 Â±  0.0    104.0 Â±  0.0   B/op<font></font>
g.a.r.n false   5    5    280.0 Â±  0.0    280.0 Â±  0.0    144.0 Â±  0.0   B/op<font></font>
g.a.r.n false   5   10    400.0 Â±  0.0    400.0 Â±  0.0    192.0 Â±  0.0   B/op<font></font>
g.a.r.n false   5  100   2664.1 Â±  0.0   2664.1 Â±  0.0   1088.0 Â±  0.0   B/op<font></font>
g.a.r.n false  10    1    320.0 Â±  0.0    320.0 Â±  0.0    192.0 Â±  0.0   B/op<font></font>
g.a.r.n false  10    5    520.0 Â±  0.0    520.0 Â±  0.0    272.0 Â±  0.0   B/op<font></font>
g.a.r.n false  10   10    760.0 Â±  0.0    760.0 Â±  0.0    368.0 Â±  0.0   B/op<font></font>
g.a.r.n false  10  100   5264.2 Â±  0.0   5264.2 Â±  0.0   2168.1 Â±  0.0   B/op<font></font>
g.a.r.n false 100    1   2208.2 Â±  0.0   2168.2 Â±  0.0   1317.7 Â±  5.7   B/op<font></font>
g.a.r.n false 100    5   4196.3 Â±  6.2   4168.3 Â±  0.0   2123.4 Â±  7.6   B/op<font></font>
g.a.r.n false 100   10   6704.6 Â±  0.0   6664.5 Â±  0.0   3123.4 Â±  7.6   B/op<font></font>
g.a.r.n false 100  100  51698.1 Â±  5.4  51666.3 Â±  0.0  21124.3 Â±  7.6   B/op</code></pre></div></div><br>
<p> ,      ,           !    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">JDK-8148937</a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a> (  )   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">JDK-8149758</a>.      .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>,      JDK-8148937. , 1,5-2 -       .</p><br>
<h4 id="vyvody"></h4><br>
<ul>
<li>  â€”  .   ,    (   )     .  â€”          .      ,    ,  ,    </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDKã«ä½•ã‹ã‚’è¨˜å…¥ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€æ ¡æ­£ã¯ç„¡æ…ˆæ‚²ã«ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã®ææ¡ˆã¯æœ€ã‚‚çœŸå®Ÿã«æ€ãˆã¾ã™ãŒã€å¤šãã®å ´åˆã“ã‚Œã¯å¹»æƒ³ã§ã™ã€‚</font><font style="vertical-align: inherit;">æ‰¹åˆ¤ã€å£Šæ»…çš„ã•ãˆã‚‚å—ã‘å–ã‚‰ãªã„ã§ãã ã•ã„</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€ã‚‚ã‚¯ãƒ¼ãƒ«ãªåˆ©ç›Šã§ã•ãˆã€é–‹ç™ºè€…ã®æ³¨æ„ã‚’ç´„æŸã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å‰ã®è¨˜äº‹ã®ä¸€ã¤ã€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Iã¯ã€æœ‰ç”¨ãªèª¬æ˜ã¨åŒæ™‚ã«å°å‹ã§ã‚ã‚‹ãŸã‚ã€ä½é‡è¦åº¦ã¾ãŸã¯ç•°ãªã‚‹å„ªå…ˆé †ä½ã®å˜ã«å½“åˆ†ã®é–“ã«é™¤å»ã•ã‚Œã‚‹100ï¼…ã®ä¿¡é ¼æ€§å¤‰åŒ–ã€</font></font></li>
</ul><br>
<h4 id="vmesto-poslesloviya"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚ã¨ãŒãã®ä»£ã‚ã‚Šã«</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€é€±é–“ã§ã€æ˜¥ã¯å°‘ã—ã§å§‹ã¾ã‚Šã¾ã™ã€ç§ã¯æœ€åˆã®æš–ã‹ã•ã§åŠ›ã®é«˜ã¾ã‚Šã‚’æ„Ÿã˜ã¦ã€å¤§èƒ†ã«è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã«å–ã‚Šçµ„ã¿ã€ã‚ãªãŸã®éã¡ã‚’è‹¦ç—›ãªãèªã‚ã€ãã—ã¦å­¦ã³ã€å‹‰å¼·ã—ã€ãã—ã¦å†ã³å‹‰å¼·ã§ãã‚‹ã‚ˆã†ã«ãªã‚ŠãŸã„ã§ã™:)</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja488856/index.html">ã¾ã‚CRMã¨CRMã€‚ã™ã¹ã¦ã¯ã‚ãªãŸãŒæ€ã£ã¦ã„ã‚‹ã‚ˆã‚Šç°¡å˜ã§ã™ã€‚</a></li>
<li><a href="../ja488860/index.html">è¼¸å…¥ä»£æ›¿å“ã¨é€ èˆ¹</a></li>
<li><a href="../ja488866/index.html">Gitlab CI / CDã«ã‚ˆã‚‹ç”»åƒã®æ¤œè¨¼</a></li>
<li><a href="../ja488868/index.html">Mobius 2020 Piterã®ç™ºè¡¨ï¼šãƒ¢ãƒã‚¤ãƒ«é–‹ç™ºè€…ã‚’èˆˆå¥®ã•ã›ã‚‹ã‚‚ã®ã¯ä½•ã§ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja488872/index.html">ã‚¦ã‚§ãƒ“ãƒŠãƒ¼ã€Œãƒ‡ã‚¸ã‚¿ãƒ«ãƒ€ãƒ–ãƒ«ã‚¤ãƒ³IIoTã€</a></li>
<li><a href="../ja488876/index.html">ç–‘ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®ä¸¦ã¹æ›¿ãˆã«ã‚ˆã‚‹æ¢ç´¢ã¨å¤‰æ›</a></li>
<li><a href="../ja488880/index.html">DUMP2020ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®DevOpsã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€‚å–œã¶/ä¸€ç·’ã«æ³£ã</a></li>
<li><a href="../ja488884/index.html">3Dãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã¯ç§ã®ãƒãƒ«ã‚³ãƒ‹ãƒ¼ã®ç§ã®å·¥å ´ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</a></li>
<li><a href="../ja488886/index.html">Chromeã«ã‚ˆã‚‹ã¨2019</a></li>
<li><a href="../ja488888/index.html">ThinkPadãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ãŒãƒ­ãƒœãƒƒãƒˆã®è„³ã«ãªã‚‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>