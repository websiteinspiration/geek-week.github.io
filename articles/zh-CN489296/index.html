<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–²ï¸ ğŸ¤œğŸ¿ ğŸŒŸ ç±»å›ºé†‡çš„åŠŸèƒ½é€‰æ‹© ğŸ¤¾ğŸ¾ ğŸ‘©ğŸ¼â€ğŸ’» ğŸ«</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼æˆ‘å‘æ‚¨ä»‹ç»MÃ¡rkSÃ¡gi-KazÃ¡ræ’°å†™çš„æ–‡ç« ã€Šç±»å›ºé†‡çš„åŠŸèƒ½æ€§é€‰æ‹©ã€‹ã€‚ åŠŸèƒ½é€‰é¡¹æ˜¯Goçš„å…¸èŒƒï¼Œé€‚ç”¨äºå¹²å‡€ä¸”å¯æ‰©å±•çš„APIã€‚å¥¹å—åˆ°Dave Cheneyå’ŒRob Pikeçš„æ¨å´‡ã€‚è¿™ç¯‡æ–‡ç« æ˜¯å…³äºè‡ªæ¨¡æ¿é¦–æ¬¡å¼•å…¥ä»¥æ¥çš„å®è·µã€‚ åŠŸèƒ½é€‰é¡¹å·²æˆä¸ºä¸€ç§é€šè¿‡åŒ…å«å¯é€‰å‚æ•°çš„é…ç½®æ¥åˆ›å»ºè‰¯å¥½ä¸”ç®€æ´çš„APIçš„æ–¹æ³•ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ç±»å›ºé†‡çš„åŠŸèƒ½é€‰æ‹©</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/489296/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHaï¼</font><font style="vertical-align: inherit;">æˆ‘å‘æ‚¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ä»‹ç»MÃ¡rkSÃ¡gi-KazÃ¡ræ’°å†™</font></a><font style="vertical-align: inherit;">çš„æ–‡ç« </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€Šç±»å›ºé†‡</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">åŠŸèƒ½æ€§é€‰æ‹©ã€‹</font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">
åŠŸèƒ½é€‰é¡¹æ˜¯Goçš„å…¸èŒƒï¼Œé€‚ç”¨äºå¹²å‡€ä¸”å¯æ‰©å±•çš„APIã€‚</font><font style="vertical-align: inherit;">å¥¹å—åˆ°</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Dave Cheney</font></a><font style="vertical-align: inherit;">å’Œ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Rob Pikeçš„</font></a><font style="vertical-align: inherit;">æ¨å´‡</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¿™ç¯‡æ–‡ç« æ˜¯å…³äºè‡ªæ¨¡æ¿é¦–æ¬¡å¼•å…¥ä»¥æ¥çš„å®è·µã€‚</font><font style="vertical-align: inherit;">
åŠŸèƒ½é€‰é¡¹å·²æˆä¸ºä¸€ç§é€šè¿‡åŒ…å«å¯é€‰å‚æ•°çš„é…ç½®æ¥åˆ›å»ºè‰¯å¥½ä¸”ç®€æ´çš„APIçš„æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">æœ‰å¾ˆå¤šæ˜æ˜¾çš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼ˆæ„é€ å‡½æ•°ï¼Œé…ç½®ç»“æ„ï¼Œsetterç­‰ï¼‰ï¼Œä½†æ˜¯å½“æ‚¨éœ€è¦ä¼ é€’è®¸å¤šé€‰é¡¹æ—¶ï¼Œå®ƒä»¬çš„å¯è¯»æ€§å¾ˆå·®ï¼Œå¹¶ä¸”ä¸èƒ½æä¾›åŠŸèƒ½é€‰é¡¹ä¹‹ç±»çš„ä¼˜è´¨APIã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/tg/q_/netgq_6sygojlguqfqahr_k_hh0.jpeg" alt="å›¾ç‰‡"><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®€ä»‹-ä»€ä¹ˆæ˜¯åŠŸèƒ½é€‰é¡¹ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ï¼Œå½“æ‚¨åˆ›å»ºâ€œå¯¹è±¡â€æ—¶ï¼Œä¼šä½¿ç”¨å¿…è¦çš„å‚æ•°è°ƒç”¨æ„é€ å‡½æ•°ï¼š</font></font><br>
<br>
<pre><code class="go hljs">obj := New(arg1, arg2)</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆè®©æˆ‘ä»¬å¿½ç•¥ä»¥ä¸‹äº‹å®ï¼šGoä¸­æ²¡æœ‰ä¼ ç»Ÿçš„æ„é€ </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å‡½æ•°</font><i><font style="vertical-align: inherit;">ã€‚ï¼‰</font></i><font style="vertical-align: inherit;">åŠŸèƒ½é€‰é¡¹å…è®¸æ‚¨ä½¿ç”¨å…¶ä»–å‚æ•°æ‰©å±•APIï¼Œä»è€Œå°†ä¸Šé¢çš„è¡Œå˜ä¸ºä»¥ä¸‹å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// I can still do this...</span><font></font>
obj := New(arg1, arg2)<font></font>
<font></font>
<span class="hljs-comment">// ...but this works too</span>
obj := New(arg1, arg2, myOption1, myOption2)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŠŸèƒ½é€‰é¡¹åŸºæœ¬ä¸Šæ˜¯å¯å˜å‡½æ•°çš„å‚æ•°ï¼Œè¯¥å¯å˜å‡½æ•°é‡‡ç”¨å¤åˆæˆ–ä¸­é—´é…ç½®ç±»å‹ä½œä¸ºå‚æ•°ã€‚</font><font style="vertical-align: inherit;">ç”±äºå…¶å¯å˜çš„æ€§è´¨ï¼Œå³ä½¿ä¸ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¹Ÿå¯ä»¥ä¸å¸¦ä»»ä½•é€‰é¡¹åœ°è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¿æŒå…¶æ•´æ´ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ›´å¥½åœ°æ¼”ç¤ºè¯¥æ¨¡å¼ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…çš„ç¤ºä¾‹ï¼ˆä¸å¸¦åŠŸèƒ½é€‰é¡¹ï¼‰ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {<font></font>
    addr <span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// NewServer initializes a new Server listening on addr.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">Server</span></span> {
    <span class="hljs-keyword">return</span> &amp;Server {<font></font>
        addr: addr,<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ·»åŠ è¶…æ—¶é€‰é¡¹åï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {<font></font>
    addr <span class="hljs-keyword">string</span><font></font>
<font></font>
    <span class="hljs-comment">// default: no timeout</span><font></font>
    timeout time.Duration<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Timeout configures a maximum length of idle connection in Server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Timeout</span><span class="hljs-params">(timeout time.Duration)</span> <span class="hljs-title">func</span><span class="hljs-params">(*Server)</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.timeout = timeout<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// NewServer initializes a new Server listening on addr with optional configuration.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(*Server)</span>) *<span class="hljs-title">Server</span></span> {<font></font>
    server := &amp;Server {<font></font>
        addr: addr,<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// apply the list of options to Server</span>
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
        opt(server)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> server<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆçš„APIæ˜“äºä½¿ç”¨ä¸”æ˜“äºé˜…è¯»ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// no optional paramters, use defaults</span>
server := NewServer(<span class="hljs-string">":8080"</span>)<font></font>
<font></font>
<span class="hljs-comment">// configure a timeout in addition to the address</span>
server := NewServer(<span class="hljs-string">":8080"</span>, Timeout(<span class="hljs-number">10</span> * time.Second))<font></font>
<font></font>
<span class="hljs-comment">// configure a timeout and TLS in addition to the address</span>
server := NewServer(<span class="hljs-string">":8080"</span>, Timeout(<span class="hljs-number">10</span> * time.Second), TLS(&amp;TLSConfig{}))</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†è¿›è¡Œæ¯”è¾ƒï¼Œä¸‹é¢æ˜¯ä½¿ç”¨æ„é€ å‡½æ•°å’Œconfigé…ç½®ç»“æ„è¿›è¡Œåˆå§‹åŒ–çš„æ ·å­ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// constructor variants</span>
server := NewServer(<span class="hljs-string">":8080"</span>)<font></font>
server := NewServerWithTimeout(<span class="hljs-string">":8080"</span>, <span class="hljs-number">10</span> * time.Second)<font></font>
server := NewServerWithTimeoutAndTLS(<span class="hljs-string">":8080"</span>, <span class="hljs-number">10</span> * time.Second, &amp;TLSConfig{})<font></font>
<font></font>
<font></font>
<span class="hljs-comment">// config struct</span>
server := NewServer(<span class="hljs-string">":8080"</span>, Config{})<font></font>
server := NewServer(<span class="hljs-string">":8080"</span>, Config{ Timeout: <span class="hljs-number">10</span> * time.Second })<font></font>
server := NewServer(<span class="hljs-string">":8080"</span>, Config{ Timeout: <span class="hljs-number">10</span> * time.Second, TLS: &amp;TLSConfig{} })</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨åŠŸèƒ½é€‰é¡¹è€Œä¸æ˜¯æ„é€ å‡½æ•°çš„å¥½å¤„å¯èƒ½å¾ˆæ˜æ˜¾ï¼šå®ƒä»¬æ›´æ˜“äºç»´æŠ¤å’Œè¯»å–/å†™å…¥ã€‚</font><font style="vertical-align: inherit;">å½“å‚æ•°æ²¡æœ‰ä¼ é€’ç»™æ„é€ å‡½æ•°æ—¶ï¼ŒåŠŸèƒ½å‚æ•°ä¹Ÿä¼šè¶…å‡ºé…ç½®ç»“æ„ã€‚</font><font style="vertical-align: inherit;">åœ¨ä»¥ä¸‹å„èŠ‚ä¸­ï¼Œæˆ‘å°†æ˜¾ç¤ºæ›´å¤šç¤ºä¾‹ï¼Œå…¶ä¸­é…ç½®ç»“æ„å¯èƒ½ä¸ç¬¦åˆé¢„æœŸã€‚</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å•å‡»ç®€ä»‹ä¸­çš„é“¾æ¥ï¼Œä»¥é˜…è¯»åŠŸèƒ½é€‰é¡¹çš„å®Œæ•´å†å²è®°å½•ã€‚</font><font style="vertical-align: inherit;">ï¼ˆè¯‘è€…æ³¨-å¸¦æœ‰Dave CheneyåŸåˆ›æ–‡ç« çš„åšå®¢åœ¨ä¿„ç½—æ–¯å¹¶ä¸æ€»æ˜¯å¯ç”¨ï¼Œæ‚¨å¯èƒ½éœ€è¦é€šè¿‡VPNè¿›è¡Œè¿æ¥æ‰èƒ½æŸ¥çœ‹ã€‚æ­¤å¤–ï¼Œè¯¥æ–‡ç« ä¸­çš„ä¿¡æ¯ä¹Ÿå¯ä»¥åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»–å…³äºdotGo 2014çš„æŠ¥å‘Š</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">è§†é¢‘ä¸­æ‰¾åˆ°</font></a><font style="vertical-align: inherit;">ï¼‰</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠŸèƒ½é€‰æ‹©å®è·µ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‡½æ•°é€‰é¡¹æœ¬èº«ä»…æ˜¯ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‡½æ•°ã€‚</font><font style="vertical-align: inherit;">ç®€å•åŠŸèƒ½çš„æ˜“ç”¨æ€§æä¾›äº†çµæ´»æ€§ï¼Œå¹¶å…·æœ‰å¾ˆå¤§çš„æ½œåŠ›ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¤šå¹´æ¥ï¼Œæ¨¡æ¿å‘¨å›´å‡ºç°äº†è®¸å¤šå®è·µä¹Ÿå°±ä¸è¶³ä¸ºå¥‡äº†ã€‚</font><font style="vertical-align: inherit;">ä¸‹é¢ï¼Œæˆ‘å°†åˆ—å‡ºæˆ‘è®¤ä¸ºæœ€æµè¡Œå’Œæœ‰ç”¨çš„åšæ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨è®¤ä¸ºç¼ºå°‘æŸäº›å†…å®¹ï¼Œè¯·ç»™æˆ‘å‘é€ç”µå­é‚®ä»¶ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‰é¡¹ç±»å‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åº”ç”¨åŠŸèƒ½é€‰é¡¹æ¨¡æ¿æ—¶ï¼Œæ‚¨è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ç¡®å®šå¯é€‰åŠŸèƒ½çš„ç±»å‹ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Option configures a Server.</span>
<span class="hljs-keyword">type</span> Option <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡è¿™çœ‹èµ·æ¥ä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ”¹è¿›ï¼Œä½†æ˜¯é€šè¿‡ä½¿ç”¨ç±»å‹åç§°è€Œä¸æ˜¯å®šä¹‰å‡½æ•°ï¼Œä»£ç å˜å¾—æ›´å…·å¯è¯»æ€§ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Timeout</span><span class="hljs-params">(timeout time.Duration)</span> <span class="hljs-title">func</span><span class="hljs-params">(*Server)</span></span> { <span class="hljs-comment">/*...*/</span> }<font></font>
<font></font>
<span class="hljs-comment">// reads: a new server accepts an address</span>
<span class="hljs-comment">//      and a set of functions that accepts the server itself</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(s *Server)</span>) *<span class="hljs-title">Server</span></span><font></font>
<font></font>
<span class="hljs-comment">// VS</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Timeout</span><span class="hljs-params">(timeout time.Duration)</span> <span class="hljs-title">Option</span></span> { <span class="hljs-comment">/*...*/</span> }<font></font>
<font></font>
<span class="hljs-comment">// reads: a new server accepts an address and a set of options</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...Option)</span> *<span class="hljs-title">Server</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…·æœ‰é€‰é¡¹ç±»å‹çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯Godocå°†é€‰é¡¹å‡½æ•°æ”¾åœ¨è¯¥ç±»å‹ä¸‹ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/7j/cw/ng7jcwf-ayhf9tfblay4-dl7_ck.png" alt="å›¾ç‰‡"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€‰é¡¹ç±»å‹åˆ—è¡¨</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ï¼ŒåŠŸèƒ½å‚æ•°ç”¨äºåˆ›å»ºæŸäº›äº‹ç‰©çš„å•ä¸ªå®ä¾‹ï¼Œä½†å¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚</font><font style="vertical-align: inherit;">åœ¨åˆ›å»ºå¤šä¸ªå®ä¾‹æ—¶é‡ç”¨é»˜è®¤å‚æ•°åˆ—è¡¨çš„æƒ…å†µä¹Ÿä¸é²œè§ï¼š</font></font><br>
<br>
<pre><code class="go hljs">defaultOptions := []Option{Timeout(<span class="hljs-number">5</span> * time.Second)}<font></font>
<font></font>
server1 := NewServer(<span class="hljs-string">":8080"</span>, <span class="hljs-built_in">append</span>(defaultOptions, MaxConnections(<span class="hljs-number">10</span>))...)<font></font>
<font></font>
server2 := NewServer(<span class="hljs-string">":8080"</span>, <span class="hljs-built_in">append</span>(defaultOptions, RateLimit(<span class="hljs-number">10</span>, time.Minute))...)<font></font>
<font></font>
server3 := NewServer(<span class="hljs-string">":8080"</span>, <span class="hljs-built_in">append</span>(defaultOptions, Timeout(<span class="hljs-number">10</span> * time.Second))...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸æ˜¯å¯è¯»æ€§å¾ˆå¼ºçš„ä»£ç ï¼Œå°¤å…¶æ˜¯è€ƒè™‘åˆ°ä½¿ç”¨åŠŸèƒ½é€‰é¡¹çš„ç›®çš„æ˜¯åˆ›å»ºå‹å¥½çš„APIã€‚</font><font style="vertical-align: inherit;">å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç®€åŒ–æ­¤è¿‡ç¨‹ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬åªéœ€è¦å°†[]é€‰é¡¹ç›´æ¥åˆ‡ç‰‡å³å¯ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Options turns a list of Option instances into an Option.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Options</span><span class="hljs-params">(opts ...Option)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {
        <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
            opt(s)<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨â€œé€‰é¡¹â€åŠŸèƒ½æ›¿æ¢åˆ‡ç‰‡ä¹‹åï¼Œä¸Šé¢çš„ä»£ç å˜ä¸ºï¼š</font></font><br>
<br>
<pre><code class="go hljs">defaultOptions := Options(Timeout(<span class="hljs-number">5</span> * time.Second))<font></font>
<font></font>
server1 := NewServer(<span class="hljs-string">":8080"</span>, defaultOptions, MaxConnections(<span class="hljs-number">10</span>))<font></font>
<font></font>
server2 := NewServer(<span class="hljs-string">":8080"</span>, defaultOptions, RateLimit(<span class="hljs-number">10</span>, time.Minute))<font></font>
<font></font>
server3 := NewServer(<span class="hljs-string">":8080"</span>, defaultOptions, Timeout(<span class="hljs-number">10</span> * time.Second))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨/è®¾ç½®é€‰é¡¹çš„å‰ç¼€</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰é¡¹é€šå¸¸æ˜¯å¤æ‚ç±»å‹ï¼Œä¸è¶…æ—¶æˆ–æœ€å¤§è¿æ¥æ•°ä¸åŒã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œåœ¨æœåŠ¡å™¨è½¯ä»¶åŒ…ä¸­ï¼Œæ‚¨å¯ä»¥å°†Loggeræ¥å£å®šä¹‰ä¸ºä¸€ä¸ªé€‰é¡¹ï¼ˆå¦‚æœæ²¡æœ‰é»˜è®¤è®°å½•å™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ƒï¼‰ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Logger <span class="hljs-keyword">interface</span> {<font></font>
    Info(msg <span class="hljs-keyword">string</span>)<font></font>
    Error(msg <span class="hljs-keyword">string</span>)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ˜¾ç„¶ï¼ŒLoggeråç§°ä¸èƒ½ç”¨ä½œé€‰é¡¹åç§°ï¼Œå› ä¸ºæ¥å£å·²ç»ä½¿ç”¨å®ƒäº†ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥è°ƒç”¨é€‰é¡¹LoggerOptionï¼Œä½†è¿™ä¸æ˜¯ä¸€ä¸ªéå¸¸å‹å¥½çš„åç§°ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å°†æ„é€ å‡½æ•°è§†ä¸ºä¸€ä¸ªå¥å­ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæƒ³åˆ°çš„æ˜¯ï¼šWithLoggerã€‚</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithLogger</span><span class="hljs-params">(logger Logger)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.logger = logger<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// reads: create a new server that listens on :8080 with a logger</span>
NewServer(<span class="hljs-string">":8080"</span>, WithLogger(logger))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¤æ‚ç±»å‹é€‰é¡¹çš„å¦ä¸€ä¸ªå¸¸è§ç¤ºä¾‹æ˜¯å€¼çš„åˆ‡ç‰‡ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// ...</span><font></font>
<font></font>
    whitelistIPs []<span class="hljs-keyword">string</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithWhitelistedIP</span><span class="hljs-params">(ip <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.whitelistIPs = <span class="hljs-built_in">append</span>(s.whitelistIPs, ip)<font></font>
    }<font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithWhitelistedIP(<span class="hljs-string">"10.0.0.0/8"</span>), WithWhitelistedIP(<span class="hljs-string">"172.16.0.0/12"</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥é€‰é¡¹é€šå¸¸å°†å€¼é™„åŠ åˆ°ç°æœ‰å€¼ä¸Šï¼Œè€Œä¸æ˜¯è¦†ç›–å®ƒä»¬ã€‚</font><font style="vertical-align: inherit;">å¦‚æœéœ€è¦è¦†ç›–ä¸€ç»„ç°æœ‰å€¼ï¼Œåˆ™å¯ä»¥åœ¨é€‰é¡¹åç§°ä¸­ä½¿ç”¨å•è¯setï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SetWhitelistedIP</span><span class="hljs-params">(ip <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
        s.whitelistIPs = []<span class="hljs-keyword">string</span>{ip}<font></font>
    }<font></font>
}<font></font>
<font></font>
NewServer(<font></font>
    <span class="hljs-string">":8080"</span>,<font></font>
    WithWhitelistedIP(<span class="hljs-string">"10.0.0.0/8"</span>),<font></font>
    WithWhitelistedIP(<span class="hljs-string">"172.16.0.0/12"</span>),<font></font>
    SetWhitelistedIP(<span class="hljs-string">"192.168.0.0/16"</span>), <span class="hljs-comment">// overwrites any previous values</span>
)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„è®¾æ¨¡æ¿</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç‰¹æ®Šç”¨ä¾‹é€šå¸¸è¶³å¤Ÿé€šç”¨ä»¥æ”¯æŒåº“ä¸­çš„ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">åœ¨é…ç½®çš„æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½æ„å‘³ç€å°†ä¸€ç»„å‚æ•°åˆ†ç»„åœ¨ä¸€èµ·å¹¶ç”¨ä½œé¢„è®¾ä½¿ç”¨ã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥å…·æœ‰å¼€æ”¾å¼å’Œå†…éƒ¨ä½¿ç”¨æ–¹æ¡ˆï¼Œä»¥ä¸åŒçš„æ–¹å¼è®¾ç½®è¶…æ—¶ï¼Œé€Ÿåº¦é™åˆ¶ï¼Œè¿æ¥æ•°ç­‰ã€‚</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// PublicPreset configures a Server for public usage.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PublicPreset</span><span class="hljs-params">()</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> Options(<font></font>
        WithTimeout(<span class="hljs-number">10</span> * time.Second),<font></font>
        MaxConnections(<span class="hljs-number">10</span>),<font></font>
    )<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// InternalPreset configures a Server for internal usage.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InternalPreset</span><span class="hljs-params">()</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> Options(<font></font>
        WithTimeout(<span class="hljs-number">20</span> * time.Second),<font></font>
        WithWhitelistedIP(<span class="hljs-string">"10.0.0.0/8"</span>),<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°½ç®¡é¢„è®¾åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æœ‰ç”¨ï¼Œä½†å®ƒä»¬åœ¨å†…éƒ¨åº“ä¸­å¯èƒ½å…·æœ‰å¾ˆå¤§çš„ä»·å€¼ï¼Œè€Œåœ¨å…¬å…±åº“ä¸­ï¼Œå®ƒä»¬çš„ä»·å€¼åˆ™è¾ƒå°ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é»˜è®¤ç±»å‹å€¼ä¸é»˜è®¤é¢„è®¾å€¼</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goå§‹ç»ˆå…·æœ‰é»˜è®¤å€¼ã€‚å¯¹äºæ•°å­—ï¼Œé€šå¸¸ä¸ºé›¶ï¼›å¯¹äºå¸ƒå°”ç±»å‹ï¼Œåˆ™ä¸ºfalseï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨å¯é€‰é…ç½®ä¸­ï¼Œä¾é é»˜è®¤å€¼è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¥½ä¹ æƒ¯ã€‚ä¾‹å¦‚ï¼Œç©ºå€¼åº”è¡¨ç¤ºæ— é™åˆ¶çš„è¶…æ—¶è€Œä¸æ˜¯ä¸å­˜åœ¨ï¼ˆé€šå¸¸æ˜¯æ— æ„ä¹‰çš„ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé»˜è®¤ç±»å‹å€¼ä¸æ˜¯ä¸€ä¸ªå¥½çš„é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼ŒLoggerçš„é»˜è®¤å€¼ä¸ºnilï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ææ…Œï¼ˆå¦‚æœæ‚¨ä¸é€šè¿‡æ¡ä»¶æ£€æŸ¥æ¥ä¿æŠ¤loggerè°ƒç”¨ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®å€¼ï¼ˆåœ¨åº”ç”¨å‚æ•°ä¹‹å‰ï¼‰æ˜¯ç¡®å®šåå¤‡çš„å¥½æ–¹æ³•ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(*Server)</span>) *<span class="hljs-title">Server</span></span> {<font></font>
    server := &amp;Server {<font></font>
        addr:   addr,<font></font>
        logger: noopLogger{},<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// apply the list of options to Server</span>
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
        opt(server)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> server<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘çœ‹åˆ°äº†å¸¦æœ‰é»˜è®¤é¢„è®¾çš„ç¤ºä¾‹ï¼ˆä½¿ç”¨ä¸Šä¸€èŠ‚ä¸­æè¿°çš„æ¨¡æ¿ï¼‰ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ä»…åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®é»˜è®¤å€¼ç›¸æ¯”ï¼Œè¡¨è¾¾æ€§è¦å·®å¾—å¤šï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewServer</span><span class="hljs-params">(addr <span class="hljs-keyword">string</span>, opts ...<span class="hljs-keyword">func</span>(*Server)</span>) *<span class="hljs-title">Server</span></span> {<font></font>
    server := &amp;Server {<font></font>
        addr:   addr,<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// what are the defaults?</span>
    opts = <span class="hljs-built_in">append</span>([]Option{DefaultPreset()}, opts...)<font></font>
<font></font>
    <span class="hljs-comment">// apply the list of options to Server</span>
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {<font></font>
        opt(server)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> server<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ç½®ç»“æ„é€‰é¡¹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†Configç»“æ„ä½œä¸ºåŠŸèƒ½é€‰é¡¹å¯èƒ½å¹¶ä¸å¸¸è§ï¼Œä½†æ˜¯æœ‰æ—¶ä¼šå‘ç°è¿™ç§æƒ…å†µã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªæƒ³æ³•æ˜¯ï¼ŒåŠŸèƒ½é€‰é¡¹æ˜¯æŒ‡é…ç½®ç»“æ„ï¼Œè€Œä¸æ˜¯æŒ‡æ­£åœ¨åˆ›å»ºçš„å®é™…å¯¹è±¡ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {<font></font>
    Timeout time.Duration<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> Option <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Config)</span></span><font></font>
<font></font>
<span class="hljs-keyword">type</span> Server <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// ...</span><font></font>
<font></font>
    config Config<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æ‚¨æœ‰è®¸å¤šé€‰é¡¹æ—¶ï¼Œæ­¤æ¨¡æ¿å¾ˆæœ‰ç”¨ï¼Œå¹¶ä¸”åˆ›å»ºé…ç½®ç»“æ„ä¼¼ä¹æ¯”åœ¨å‡½æ•°è°ƒç”¨ä¸­åˆ—å‡ºæ‰€æœ‰é€‰é¡¹æ›´å¹²å‡€ï¼š</font></font><br>
<br>
<pre><code class="go hljs">config := Config{<font></font>
    Timeout: <span class="hljs-number">10</span> * time.Second
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// lots of other options</span><font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithConfig(config))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ­¤æ¨¡æ¿çš„å¦ä¸€ä¸ªç”¨ä¾‹æ˜¯è®¾ç½®é»˜è®¤å€¼ï¼š</font></font><br>
<br>
<pre><code class="go hljs">config := Config{<font></font>
    Timeout: <span class="hljs-number">10</span> * time.Second
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// lots of other options</span><font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithConfig(config), WithTimeout(<span class="hljs-number">20</span> * time.Second))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›é˜¶èŒƒæœ¬</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç¼–å†™äº†æ•°åä¸ªåŠŸèƒ½é€‰é¡¹ä¹‹åï¼Œæ‚¨å¯èƒ½ä¼šæƒ³çŸ¥é“æ˜¯å¦æœ‰æ›´å¥½çš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä¸æ˜¯åœ¨ä½¿ç”¨æ–¹é¢ï¼Œè€Œæ˜¯åœ¨é•¿æœŸæ”¯æŒæ–¹é¢ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å®šä¹‰ç±»å‹å¹¶å°†å…¶ç”¨ä½œå‚æ•°è¯¥æ€ä¹ˆåŠï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Timeout time.Duration<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, Timeout(time.Minute))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ï¼ˆè¯·æ³¨æ„ï¼ŒAPIçš„ä½¿ç”¨ä¿æŒä¸å˜ï¼‰</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äº‹å®è¯æ˜ï¼Œé€šè¿‡æ›´æ”¹Optionç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Option configures a Server.</span>
<span class="hljs-keyword">type</span> Option <span class="hljs-keyword">interface</span> {
    <span class="hljs-comment">// apply is unexported,</span>
    <span class="hljs-comment">// so only the current package can implement this interface.</span><font></font>
    apply(s *Server)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†å¯é€‰åŠŸèƒ½é‡å†™ä¸ºæ¥å£ä¸ºå®ç°åŠŸèƒ½é€‰é¡¹çš„è®¸å¤šæ–°æ–¹æ³•æ‰“å¼€äº†å¤§é—¨ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å„ç§å†…ç½®ç±»å‹å¯ç”¨ä½œæ²¡æœ‰åŒ…è£…å‡½æ•°çš„å‚æ•°ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Timeout configures a maximum length of idle connection in Server.</span>
<span class="hljs-keyword">type</span> Timeout time.Duration<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Timeout)</span> <span class="hljs-title">apply</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
    s.timeout = time.Duration(t)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰é¡¹å’Œé…ç½®ç»“æ„çš„åˆ—è¡¨ï¼ˆè¯·å‚é˜…å‰é¢çš„éƒ¨åˆ†ï¼‰ä¹Ÿå¯ä»¥é‡æ–°å®šä¹‰å¦‚ä¸‹ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// Options turns a list of Option instances into an Option.</span>
<span class="hljs-keyword">type</span> Options []Option<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o Options)</span> <span class="hljs-title">apply</span><span class="hljs-params">(s *Server)</span></span> {
    <span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> o {<font></font>
        o.apply(s)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {<font></font>
    Timeout time.Duration<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c Config)</span> <span class="hljs-title">apply</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
    s.config = c<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä¸ªäººæœ€å–œæ¬¢çš„æ˜¯èƒ½å¤Ÿåœ¨å¤šä¸ªæ„é€ å‡½æ•°ä¸­é‡ç”¨è¯¥é€‰é¡¹çš„åŠŸèƒ½ï¼š</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// ServerOption configures a Server.</span>
<span class="hljs-keyword">type</span> ServerOption <span class="hljs-keyword">interface</span> {<font></font>
    applyServer(s *Server)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// ClientOption configures a Client.</span>
<span class="hljs-keyword">type</span> ClientOption <span class="hljs-keyword">interface</span> {<font></font>
    applyClient(c *Client)<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Option configures a Server or a Client.</span>
<span class="hljs-keyword">type</span> Option <span class="hljs-keyword">interface</span> {<font></font>
    ServerOption<font></font>
    ClientOption<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithLogger</span><span class="hljs-params">(logger Logger)</span> <span class="hljs-title">Option</span></span> {
    <span class="hljs-keyword">return</span> withLogger{logger}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> withLogger <span class="hljs-keyword">struct</span> {<font></font>
    logger Logger<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o withLogger)</span> <span class="hljs-title">applyServer</span><span class="hljs-params">(s *Server)</span></span> {<font></font>
    s.logger = o.logger<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(o withLogger)</span> <span class="hljs-title">applyClient</span><span class="hljs-params">(c *Client)</span></span> {<font></font>
    c.logger = o.logger<font></font>
}<font></font>
<font></font>
NewServer(<span class="hljs-string">":8080"</span>, WithLogger(logger))<font></font>
NewClient(<span class="hljs-string">"http://localhost:8080"</span>, WithLogger(logger))</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‘˜è¦</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŠŸèƒ½å‚æ•°æ˜¯ç”¨äºåˆ›å»ºå…·æœ‰æ•°åä¸ªå‚æ•°çš„æ•´æ´ä¸”å¯æ‰©å±•çš„APIçš„å¼ºå¤§æ¨¡æ¿ã€‚</font><font style="vertical-align: inherit;">å°½ç®¡ä¸æ”¯æŒç®€å•çš„é…ç½®ç»“æ„ç›¸æ¯”ï¼Œå®ƒæ‰€åšçš„å·¥ä½œè¦å¤šä¸€äº›ï¼Œä½†ä¸æ›¿ä»£æ–¹æ¡ˆç›¸æ¯”ï¼Œå®ƒæä¾›äº†æ›´å¤§çš„çµæ´»æ€§å¹¶æä¾›äº†æ›´ç®€æ´çš„APIã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN489282/index.html">DirectX 12-ä»è¾¾èŠ¬å¥‡åˆ°å½“ä»£è‰ºæœ¯</a></li>
<li><a href="../zh-CN489284/index.html">æˆ‘æœ€å–œæ¬¢çš„Chromeå¼€å‘è€…å·¥å…·</a></li>
<li><a href="../zh-CN489286/index.html">å†…è£¤ï¼Œè¢œå­å’Œå‰ƒé¡»åˆ·ï¼š2æœˆ23æ—¥å¯¹ç¤¼ç‰©çš„åè¯„çº§</a></li>
<li><a href="../zh-CN489290/index.html">â€œ ITé¢†åŸŸçš„å·¥ä½œ-2020â€ï¼Œæˆ–è€…æˆ‘ä»¬çˆ±è°å’Œè°</a></li>
<li><a href="../zh-CN489294/index.html">é€šè¿‡å®é™…ç¤ºä¾‹å­¦ä¹ CSSå˜é‡</a></li>
<li><a href="../zh-CN489298/index.html">å¯¹Maria Dolgushevaï¼ˆç¡…è°·äººåŠ›èµ„æºï¼‰çš„éæ­£å¼é‡‡è®¿</a></li>
<li><a href="../zh-CN489302/index.html">ç¬¬31æœŸï¼šITåŸ¹è®­-é¢†å…ˆå…¬å¸çš„å½“å‰é—®é¢˜å’ŒæŒ‘æˆ˜</a></li>
<li><a href="../zh-CN489304/index.html">ChIP-seqæ•°æ®åˆ†æï¼šä»ç»„è›‹ç™½åˆ°è®¡ç®—æœºä»»åŠ¡</a></li>
<li><a href="../zh-CN489306/index.html">[å“ˆä¼¯]ï¼šç”œç”œåœˆ</a></li>
<li><a href="../zh-CN489310/index.html">åå¤§ï¼šHeisenbug 2019è«æ–¯ç§‘çš„æœ€ä½³æŠ¥é“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>