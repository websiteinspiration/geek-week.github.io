<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•• üëáüèø üé© Why am I not using SharedViewModel for fragments? üë®‚Äç‚öñÔ∏è ü§î üì°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habr, hello! 
 
 The task of organizing the interaction between fragments is very common. At first glance, ShareViewModel is great for this. We create...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Why am I not using SharedViewModel for fragments?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504712/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habr, hello! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The task of organizing the interaction between fragments is very common. At first glance, ShareViewModel is great for this. We create a ViewModel with owner = our activity, in which our fragments are displayed, and get this ViewModel inside each fragment. Because the owner of the ViewModel is activity, the fragments get the same instance of the ViewModel, which allows them to exchange data, call methods, etc. Here is the link from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The figure below shows the interaction scheme of 3 fragments. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/367/ad4/04f/367ad404f3bf81ec55692ad5c7fc7ac7.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Those. what we do: in each fragment we get the SharedViewModel of those fragments with which we need to interact ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And this is not the best solution, in my opinion. Because:</font></font><br>
<a name="habracut"></a><br>
<ol>
<li>    *VM.   ViewModel   View. ViewModel   LiveData,   View,    .. ViewModel    - ,   View.</li>
<li>  SharedViewModel ‚Äî     .   ,    SharedViewModel ,    ,     .     - . </li>
<li>       SharedViewModel,         .       ,     ,        . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SharedViewModel can be used only when there are several completely identical fragments with the same data. In my practice, there was no such scenario. There may be two identical fragments, but the state of the ViewModel of each is different, the SharedViewModel is invalid for them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SharedViewModel brings a ton of problems. You start to get confused, everything is overgrown with dependencies, the code is complicated. It is much easier to work when Fragment + ViewModel is a black box. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What solution can be offered? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A simple service with which each fragment interacts in its own way.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/de9/a92/247/de9a92247d6d9f0cd0c1d9bbdf7bbe6c.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This service must be passed inside each ViewModel. Thanks to DI and scope (Dagger, Koin, any others) this can be done easily and simply. If the service should live in the context of an Activity, create it in the Scope of this Activity and pass it to each ViewModel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
See what happened: we removed all SharedViewModel from fragments. Each fragment now knows nothing about the other fragments. If we want to add a new fragment to this scheme, then we only need to connect viewModel D with our service and that‚Äôs it. If the fragment should respond to a change in some property of the service - just subscribe to it. We no longer need to understand other people's ViewModels. And this service will be much simpler than any ViewModel, it will be easier to understand the service.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It may seem that there are not so many interacting fragments on one screen. </font><font style="vertical-align: inherit;">On the phone - maybe. </font><font style="vertical-align: inherit;">On the tablet - you can‚Äôt say that anymore. </font><font style="vertical-align: inherit;">And FragmentContainerView helps to use fragments in any layouts, which is very convenient if the application has many common components with a life cycle.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonus: how do I create fragments?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Like this: SomeFragment () </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And what about the parameters? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the advent of ViewModel, I do not use parameters. </font><font style="vertical-align: inherit;">I don‚Äôt pass anything to the fragment via bundle (Android Studio still offers to create a fragment with arguments and create a fragment through the static method), I do not use </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Safety NavArgs for the Navigation Component</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All these things make the fragment conditioned. We cannot just take such a fragment and add it to the ViewPager, for example. One must think how to pass the parameters. Or another example: you created a fragment with parameters, work in it, the data has changed, the fragment already shows something else. We changed the device configuration (turned over), the fragment was created anew with outdated parameters, while the ViewModel already contains other data. And the actualization of the parameters, etc. begins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I removed all this in the ViewModel. I use the same service through which I pass the parameters. It works like Safety NavArgs. ViewModel requests parameters from the service by the type of the parameter class. After successfully retrieving the parameter, the service deletes them (works like Push / Pop).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This immediately solves the problem of changing the configuration: the fragment was created again, and the ViewModel is already with the current data, all that is needed is to connect them with the View. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also a problem when passing parameters through bundle - this is an excess of the permissible amount. </font><font style="vertical-align: inherit;">If the amount of data transferred is over 500 kb., Then the application may crash due to an exception inside Binder.java. </font><font style="vertical-align: inherit;">This led to the creation of different libraries that transmit parameters via SD, which is not very fast compared to using RAM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, the tools are cool, everything is flexible, but you need to be careful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all, thanks for watching!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504700/index.html">Soviet graphic tablet "sketch"</a></li>
<li><a href="../en504702/index.html">People do not want to know English</a></li>
<li><a href="../en504706/index.html">Auto Wi-Fi Power Management</a></li>
<li><a href="../en504708/index.html">Sectigo certificate issue after May 30, 2020 and solution method</a></li>
<li><a href="../en504710/index.html">FOSS News No. 18 - a review of free and open source news for May 25-31, 2020</a></li>
<li><a href="../en504714/index.html">Go software measurement tools</a></li>
<li><a href="../en504716/index.html">Secure access to a smart home in the absence of a public IP (part 1)</a></li>
<li><a href="../en504718/index.html">The digest of fresh materials from the world of the front-end for the last week No. 417 (May 25 - 31, 2020)</a></li>
<li><a href="../en504720/index.html">The fastest template engine for PHP</a></li>
<li><a href="../en504722/index.html">HLS in MP4 using ffmpeg in a browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>