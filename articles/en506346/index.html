<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèª üôçüèΩ üñïüèΩ Million in a month: how to launch a startup in Europe on your own üñïüèº üéöÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone! 
 
 Two months ago, my friend and I (for short, let's call him Ilya) launched their startup. 
 Pffff ... you say. Every day someone st...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Million in a month: how to launch a startup in Europe on your own</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506346/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello everyone! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Two months ago, my friend and I (for short, let's call him Ilya) launched their startup. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pffff ... you say. </font><font style="vertical-align: inherit;">Every day someone starts something. </font><font style="vertical-align: inherit;">Someone launches alone. </font><font style="vertical-align: inherit;">Some are grouped in teams. </font><font style="vertical-align: inherit;">Someone has money for development \ marketing, someone offers a share, post-payment, options. </font><font style="vertical-align: inherit;">Everyone is spinning as they can and looking for partners as well.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fi/8a/yt/fi8ayt5fc0g2zt4l7ws_dd4luzk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We had no money, there was only experience and 2 weeks before the first sales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under the cut, I‚Äôll talk about what we faced and how we earned a million during the crisis</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I just want to share the experience that we have gained. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
More precisely, to share the experience that allowed to launch it all in 2 weeks. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seriously! </font><font style="vertical-align: inherit;">I am not kidding. </font><font style="vertical-align: inherit;">From the first meeting to the launch of the project - 2 weeks! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A week for the development and promotion in the social. </font><font style="vertical-align: inherit;">networks and a week on sales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the course of the story, I will miss the insignificant (or obvious, which can be found in the documentation) details and focus only on certain subtleties. </font><font style="vertical-align: inherit;">Configs and code examples will also be found.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Who are we? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When quarantine began, many areas of business began to sag slowly. </font><font style="vertical-align: inherit;">This also affected the sphere of Ilya, namely, ‚Äúdancing and choreography‚Äù. </font><font style="vertical-align: inherit;">He owns a large number of dance schools. </font><font style="vertical-align: inherit;">The same misfortune overtook fitness. </font><font style="vertical-align: inherit;">And there, people began to get out through online training. </font><font style="vertical-align: inherit;">So he got the idea to conduct a dance camp online (in full analogy with offline camps). </font><font style="vertical-align: inherit;">With which he came to me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, the team was formed of only 2 people:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">technical part (s)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marketing + Management (Ilya)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If not to dissemble, then this list can be supplemented by hired employees (designer, cmm, translator, lawyer), but these are already trifles of life. </font><font style="vertical-align: inherit;">We attribute this to one-time expenses. </font><font style="vertical-align: inherit;">And these costs are small.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What did we do?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The meaning of the dance camp was simple. There are 12 teachers and an event of 3 days. 4 classes per day. It was necessary to create a platform where the user could register, buy access to the camp. There was also information about the teachers, lineup \ schedule, some form for feedback. Well, and the most interesting - it was necessary to organize a streaming of artists who also sit in quarantine at home. Why didn‚Äôt we choose instagram solutions - ban for background music. Decisions such as Zoom shrugged off the unnecessary interaction + too expensive + the need to install software. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A separate nuance is that teachers from Europe and the USA are also in quarantine. This imposed certain restrictions on the technical part.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And one more nuance - this should be a finished product. </font><font style="vertical-align: inherit;">People had to see something beautiful and understand what they were buying, what they would get. </font><font style="vertical-align: inherit;">Why do they need it.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What do we want?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We wanted to make MVP to launch the first camp and to continue to carry them out more and more. </font><font style="vertical-align: inherit;">It is necessary to test the hypothesis that people have a need for this service. </font><font style="vertical-align: inherit;">And it's not just quarantine. </font><font style="vertical-align: inherit;">As adults, we presented a number of requirements for it:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The solution must be stable. </font><font style="vertical-align: inherit;">No 500th transaction freezes. </font><font style="vertical-align: inherit;">We do not need support tickets. </font><font style="vertical-align: inherit;">Everything should work without our participation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The solution must be flexible and scalable. </font><font style="vertical-align: inherit;">Today we have 100 people. </font><font style="vertical-align: inherit;">Tomorrow 10,000. Letters must go. </font><font style="vertical-align: inherit;">Streaming can withstand any load. </font><font style="vertical-align: inherit;">In the case of a change in the payment gateway, for example, there should be no time lag in the acceptance of payment</font></font></li>
<li>      ,            </li>
<li>         . ..     </li>
</ol><br>
<h3>  ?</h3><br>
<ul>
<li>backend  symfony</li>
<li>frontend  jquery + vue</li>
<li>   webpack</li>
<li> nats</li>
<li>   Go   </li>
<li> Minio   </li>
<li>redis   </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The admin panel was made using the Sonata Admin Bundle. </font><font style="vertical-align: inherit;">This beast is configured quickly, convenient to use. </font><font style="vertical-align: inherit;">No need to waste time developing any custom panel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let‚Äôs dwell a little bit more on different nuances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just want to note that the things described below are just a list of recommendations (tips) on how to do quickly and inexpensively. </font><font style="vertical-align: inherit;">Much of what is written for someone will be obvious, but for someone not.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SMS authorization is the biggest vacuum cleaner for your money. If you run a startup, think 10 times about whether you need it. Imagine that 1000 users came to you. Now multiply by the average price of SMS in Europe \ USA and add this to the cost of your project. You will also experience a number of problems matching the sender name. And besides, it‚Äôs also a long time (in some countries this process lasts from 2-3 weeks or more). And on the standard name of the sender, many mobile operators block SMS. A little pleasant. Therefore, we used authorization through mail \ social. network. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Very quickly, authorization through social networks can be integrated by adding the LexikJWTAuthenticationBundle library to the project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I am more than sure that other languages ‚Äã‚Äãand frameworks also have similar ones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is well documented and there are various examples.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can find her here</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">github.com/lexik/LexikJWTAuthenticationBundle</a><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We immediately began to send letters through the queue. </font><font style="vertical-align: inherit;">I believe that even for small projects this should be taken as a basis. </font><font style="vertical-align: inherit;">This is done very quickly. </font><font style="vertical-align: inherit;">And who knows, maybe in a month your startup will shoot and there will be x10 users. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About NATS there are articles on a habr including. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are ready-made libraries for both php and Go (and many other languages) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
i.e. </font><font style="vertical-align: inherit;">it turned out a bunch of PHP -&gt; NATS -&gt; GO -&gt; Amazon SES </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using docker-compose, we install NATS:</font></font><br>
<br>
<pre><code class="plaintext hljs">version: "2"<font></font>
<font></font>
services:<font></font>
 nats:<font></font>
  container_name: nats-mq<font></font>
  image: nats<font></font>
  networks:<font></font>
    - "back"<font></font>
  ports:<font></font>
    - "127.0.0.1:4222:4222"<font></font>
    - "127.0.0.1:6222:6222"<font></font>
    - "127.0.0.1:8222:8222"<font></font>
  entrypoint: "/gnatsd -c gnatsd.conf --auth SECRET --debug"<font></font>
  restart: always<font></font>
<font></font>
networks:<font></font>
  back:<font></font>
    driver: "bridge"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add a package to work with it in composer.json:</font></font><br>
<br>
<pre><code class="plaintext hljs">...<font></font>
"repejota/nats": "^0.8.6"<font></font>
...<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here is an example function for sending mail:</font></font><br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">email</span>(<span class="hljs-params">$emails, $body, $subject</span>)</span><font></font><span class="hljs-function">
</span>{<font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($emails)) {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    $prefix = getenv(<span class="hljs-string">'NATS_PREFIX'</span>);<font></font>
    $encoder = <span class="hljs-keyword">new</span> JSONEncoder();<font></font>
    $options = <span class="hljs-keyword">new</span> ConnectionOptions([<font></font>
        <span class="hljs-string">'token'</span> =&gt; getenv(<span class="hljs-string">'NATS_TOKEN'</span>)<font></font>
    ]);<font></font>
    $client = <span class="hljs-keyword">new</span> EncodedConnection($options, $encoder);<font></font>
<font></font>
    <span class="hljs-keyword">try</span> {<font></font>
        $client-&gt;connect();<font></font>
        $client-&gt;publish(<font></font>
            $prefix . <span class="hljs-string">'email'</span>,<font></font>
            [<font></font>
                <span class="hljs-string">'Emails'</span> =&gt; $emails,<font></font>
                <span class="hljs-string">'HtmlBody'</span> =&gt; $body,<font></font>
                <span class="hljs-string">'TextBody'</span> =&gt; strip_tags($body),<font></font>
                <span class="hljs-string">'Subject'</span> =&gt; $subject,<font></font>
                <span class="hljs-string">'Sender'</span> =&gt; <span class="hljs-string">'info@'</span> . getenv(<span class="hljs-string">'DOMAIN_NAME'</span>)<font></font>
            ]<font></font>
        );<font></font>
    } <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> $exception) {<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In my projects, I took the habit of writing a lot of factory methods, and calling the send function from the superclass of notifications. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This adds flexibility. </font><font style="vertical-align: inherit;">But a startup must adhere to this when developing. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is also convenient for debugging. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After all, you can add a certain Dummy class with a function:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">email</span>(<span class="hljs-params">$emails, $body, $subject</span>)</span><font></font><span class="hljs-function">
</span>{<font></font>
    $time = time();<font></font>
    file_put_contents(SRC_PATH . <span class="hljs-string">'../var/dummy/email'</span> . $time . <span class="hljs-string">'.html'</span>, $body);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will leave the general interface here</font></font></b>
                        <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">NotificationInterface</span>
</span>{<font></font>
<font></font>
    <span class="hljs-comment">/**
     *  
     *
     * init storage
     * <span class="hljs-doctag">@void</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *   
     *
     * <span class="hljs-doctag">@return</span> bool
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSync</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *  
     *
     * <span class="hljs-doctag">@param</span> $phone
     * <span class="hljs-doctag">@param</span> $message
     * <span class="hljs-doctag">@return</span> bool
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sms</span>(<span class="hljs-params">$phone, $message</span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *  
     *
     * <span class="hljs-doctag">@param</span> $email
     * <span class="hljs-doctag">@param</span> $body
     * <span class="hljs-doctag">@param</span> $subject
     * <span class="hljs-doctag">@return</span> bool
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">email</span>(<span class="hljs-params">$email, $body, $subject</span>)</span>;<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Go, you can subscribe to a queue like this:</font></font><br>
<pre><code class="go hljs">opts := nats.Options{<font></font>
	Url:   ...,<font></font>
	Token: ...,<font></font>
}<font></font>
<font></font>
nc, err := opts.Connect()<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	log.Error(<span class="hljs-string">"error in nats connection"</span>, err)<font></font>
}<font></font>
<font></font>
c, err := nats.NewEncodedConn(nc, nats.JSON_ENCODER)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	log.Error(<span class="hljs-string">"error in nats encoding"</span>, err)<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">defer</span> c.Close()<font></font>
<span class="hljs-keyword">defer</span> nc.Close()<font></font>
<font></font>
c.Subscribe(<span class="hljs-string">"email"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(p *EmailInput)</span></span> {<font></font>
	p.sendEmail()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
declaring before this:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> EmailInput <span class="hljs-keyword">struct</span> {<font></font>
	Emails   []*<span class="hljs-keyword">string</span> <span class="hljs-string">`json:"Emails"`</span><font></font>
	HtmlBody <span class="hljs-keyword">string</span>    <span class="hljs-string">`json:"HtmlBody"`</span><font></font>
	TextBody <span class="hljs-keyword">string</span>    <span class="hljs-string">`json:"TextBody"`</span><font></font>
	Subject  <span class="hljs-keyword">string</span>    <span class="hljs-string">`json:"Subject"`</span><font></font>
	Sender   <span class="hljs-keyword">string</span>    <span class="hljs-string">`json:"Sender"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(email *EmailInput)</span> <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span></span> {<font></font>
	...<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For sending, as I wrote above, we used Amazon SES. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Why?</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">administer your mail server is very expensive and it will take time</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is a turnkey solution with a good free limit</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DKIM + SPF are easily configured (otherwise letters will fly to spam, conversion will fall)</font></font></li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPF setup manual here</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">docs.aws.amazon.com/ses/latest/DeveloperGuide/send-email-authentication-spf.html</a><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another very important nuance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we did not have a separate support department, we immediately added redirects from support mail to our personal ones. </font><font style="vertical-align: inherit;">This allowed us to quickly respond to user questions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now your users can quickly and easily log in. </font><font style="vertical-align: inherit;">It's time to get the cherished money from them for tickets to your event.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Billing</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the point of view of the code, the payment system is quite simple. </font><font style="vertical-align: inherit;">There is a superclass for link generation, and again many factory methods. </font><font style="vertical-align: inherit;">They know how to generate a link for payment, and process a callback. </font><font style="vertical-align: inherit;">And also launch post-sale hooks (notification by mail + adding access to the event).</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I leave the general interfaces for hooks and payment systems here</font></font></b>
                        <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HookInterface</span>
</span>{<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> Transaction $transaction
     * <span class="hljs-doctag">@param</span> array $params
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params">Transaction $transaction, <span class="hljs-keyword">array</span> $params</span>)</span>;<font></font>
<font></font>
}<font></font>
</code></pre><br>
<pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SystemInterface</span>
</span>{<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> Transaction $transaction
     * <span class="hljs-doctag">@param</span> string|null $redirect
     * <span class="hljs-doctag">@return</span> null
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createLink</span>(<span class="hljs-params">Transaction $transaction, $redirect = <span class="hljs-literal">null</span></span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> Transaction $transaction
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createWidget</span>(<span class="hljs-params">Transaction $transaction</span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createWidgetAssets</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> $request
     * <span class="hljs-doctag">@param</span> $em
     * <span class="hljs-doctag">@return</span> PayResponse
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleCallback</span>(<span class="hljs-params">Request $request, ObjectManager $em</span>)</span>;<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our product was oriented to Europe, therefore the prices were in Euros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What difficulties did we encounter:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can count on the fingers payment gateways that have currency terminals. </font><font style="vertical-align: inherit;">What is it? </font><font style="vertical-align: inherit;">This is such a thing that allows you to accept payment in EURO, not rubles. </font><font style="vertical-align: inherit;">Why is this so important? </font><font style="vertical-align: inherit;">Yes, because the Europeans are wary of the Russians, there are a lot of scammers. </font><font style="vertical-align: inherit;">When paying, rubles will reduce conversion and add tickets to support, where you will have to explain who you are and what you are.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coordination of the currency terminal takes time. </font><font style="vertical-align: inherit;">Get ready that it will be from 5 days and above. </font><font style="vertical-align: inherit;">In practice, about 10. Because you will be carefully checked, and the Europeans were reluctant to quarantine. </font><font style="vertical-align: inherit;">Also, questions will arise from our domestic bank, why did you need it</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3d secure has not been canceled (SMS, which comes with a payment confirmation code). </font><font style="vertical-align: inherit;">Therefore, if a bank in Europe does not support this possibility for a client in Europe, then he will not be able to pay. </font><font style="vertical-align: inherit;">In this case, you have to beat the client with pens on PayPal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The coordination of the site occurs only when all the content is already present on it. </font><font style="vertical-align: inherit;">Those. </font><font style="vertical-align: inherit;">the site is completely ready, including all legal documents such as an offer. </font><font style="vertical-align: inherit;">Because </font><font style="vertical-align: inherit;">we didn‚Äôt have an online store and in general an atypical solution - we turned to lawyers to draw up an offer for our product and its subsequent translation</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It so happened that we first accepted payments in rubles. </font><font style="vertical-align: inherit;">After agreeing on a payment gateway, they switched to euros. </font><font style="vertical-align: inherit;">This slightly reduced the conversion at the start.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streaming Organization</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If everything is simple with authorization, and billing can be screwed on your own. </font><font style="vertical-align: inherit;">Such tasks are often found in the average statistical developer. </font><font style="vertical-align: inherit;">But with streaming, everything is not as clear as it seems at first glance. </font><font style="vertical-align: inherit;">What is wrong?</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have never dealt with him. </font><font style="vertical-align: inherit;">I needed a server + client for teachers</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The picture needs to be mirrored, i.e. </font><font style="vertical-align: inherit;">do vertical display (features of dance videos)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We didn‚Äôt know exactly how many participants would be in the camp. </font><font style="vertical-align: inherit;">And we could not buy an account for the month \ year \ number of traffic anywhere (in ready-made streaming solutions) yet. </font><font style="vertical-align: inherit;">That would gobble up all the profits</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I needed iframe protection against content theft at least by referrer</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a solution, we chose a bunch of larix broadcastr app -&gt; nginx + rtmp -&gt; cdn -&gt; client. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the search, the Larix Broadcaster application for broadcasting RTMP from mobile devices turned out to be the most reliable and stable. </font><font style="vertical-align: inherit;">On a separate small virtual server, we raised nginx + rtmp to stream further to CDN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This scheme is the cheapest. </font><font style="vertical-align: inherit;">Much cheaper than using the services of ready-made streaming platforms. </font><font style="vertical-align: inherit;">You do not need to buy any premium \ gold \ super account for a month \ year. </font><font style="vertical-align: inherit;">You pay only for the spent traffic. </font><font style="vertical-align: inherit;">This was the perfect solution in our situation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There, they unfolded a mirror image.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restriming configuration is here</font></font></b>
                        <div class="spoiler_text"><pre><code class="plaintext hljs">worker_processes  1;<font></font>
<font></font>
events {<font></font>
    worker_connections  1024;<font></font>
}<font></font>
<font></font>
http {<font></font>
    include       mime.types;<font></font>
    default_type  application/octet-stream;<font></font>
<font></font>
    sendfile        on;<font></font>
    <font></font>
    keepalive_timeout  65;<font></font>
    <font></font>
    include _root.conf;<font></font>
    include _stat.conf;<font></font>
}<font></font>
include _rtmp.conf;<font></font>
</code></pre><br>
<pre><code class="plaintext hljs">server {<font></font>
<font></font>
    listen       80;<font></font>
    server_name  localhost;<font></font>
    location / {<font></font>
        root   html;<font></font>
        index  index.html index.htm;<font></font>
    }<font></font>
<font></font>
    error_page   500 502 503 504  /50x.html;<font></font>
    location = /50x.html {<font></font>
        root   html;<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<pre><code class="plaintext hljs">server {<font></font>
    listen      8080;<font></font>
<font></font>
    auth_basic "Restricted Area";<font></font>
    auth_basic_user_file .htpasswd;<font></font>
<font></font>
    location / {<font></font>
        root www;<font></font>
    }<font></font>
<font></font>
    location /stat {<font></font>
        rtmp_stat all;<font></font>
        rtmp_stat_stylesheet stat.xsl;<font></font>
    }<font></font>
<font></font>
    location /stat.xsl {<font></font>
        root www;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
<pre><code class="plaintext hljs">rtmp {<font></font>
    server {<font></font>
<font></font>
        listen 1935;<font></font>
        chunk_size 4096;<font></font>
<font></font>
        application your-custom-hash-here {<font></font>
            live on;<font></font>
            record off;<font></font>
<font></font>
            allow publish all;<font></font>
            allow play all;<font></font>
<font></font>
            push rtmp://localhost/cdn;<font></font>
        }<font></font>
<font></font>
        application cdn {<font></font>
            allow publish 127.0.0.1;<font></font>
            deny publish all;<font></font>
<font></font>
            live on;<font></font>
            record off;<font></font>
<font></font>
            exec ffmpeg -i rtmp://localhost/cdn/$name -vf "hflip" -crf 30 -preset ultrafast -acodec aac -strict experimental -ar 44100 -ac 2 -b:a 128k -vcodec libx264 -x264-params keyint=60:no-scenecut=1 -r 30 -b:v 2000k -f flv rtmp://rtmp.cdnhost.abc;<font></font>
        }<font></font>
<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the front of the part, we used a simple html5 player, configured taking into account mobile devices and their features:</font></font><br>
<br>
<pre><code class="javascript hljs">videojs($(<span class="hljs-string">'#video'</span>)[<span class="hljs-number">0</span>], {<font></font>
    <span class="hljs-attr">controls</span>: <span class="hljs-literal">true</span>,<font></font>
    <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">false</span>,<font></font>
    <span class="hljs-attr">preload</span>: <span class="hljs-string">'auto'</span>,<font></font>
    <span class="hljs-attr">poster</span>: <span class="hljs-string">'/static/splash-en.jpg'</span>,<font></font>
    <span class="hljs-attr">language</span>: <span class="hljs-string">'en'</span>,<font></font>
    <span class="hljs-attr">muted</span>: <span class="hljs-literal">true</span>,<font></font>
    <span class="hljs-attr">html5</span>: {<font></font>
        <span class="hljs-attr">hls</span>: {<font></font>
            <span class="hljs-attr">overrideNative</span>: !videojs.browser.IS_SAFARI<font></font>
        }<font></font>
    }<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The solution turned out to be very stable and convenient. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After the event, we calculated the percentage of quality complaints - it was 2%. </font><font style="vertical-align: inherit;">And mostly people who have old stationary computers or outdated software (browsers).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What is the result? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We spent 2 online camps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Received only positive feedback from the first users. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the difficult quarantine time, this was exactly what people need at home. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The total revenue amounted to more than </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,000,000 rubles</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk a little about castdev, then focusing on the feedback of the first camp, we finalized the system</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They made it possible to buy a ticket for one day (and not just a full ticket) - this raised revenue, because </font><font style="vertical-align: inherit;">many did not want to buy a full ticket, but only wanted to buy a master class of one or two teachers</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We made a simple chat near the video player on socket.io - this added interactivity to the lessons and allowed us to get real-time feedback</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Because </font><font style="vertical-align: inherit;">international camp and many people got confused in time zones - we added the ability to change the time zone in the schedule and watch the schedule according to our time zone</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What conclusions can be made:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It‚Äôs not necessary to have a start-up investment and a huge team to test the idea</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lead development flexibly, listen to your users. </font><font style="vertical-align: inherit;">Add only what people really need</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not write immediately a huge monolith with a bunch of functions, it is not needed to test a hypothesis. </font><font style="vertical-align: inherit;">Do not save those. </font><font style="vertical-align: inherit;">debt. </font><font style="vertical-align: inherit;">Learn to strike a balance between ‚Äúbad‚Äù code and ‚Äúredundant‚Äù functionality. </font><font style="vertical-align: inherit;">Use each tool for its intended purpose.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use the experience of your friends. </font><font style="vertical-align: inherit;">After all, most of the tasks have already been solved. </font><font style="vertical-align: inherit;">It is enough to find the necessary tools, conduct research, combine them into a single system</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I hope that this article seems useful to someone, but motivates someone.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en506332/index.html">The moral aspect of the Barmin patch</a></li>
<li><a href="../en506334/index.html">What to do if siloviki came to your hoster</a></li>
<li><a href="../en506338/index.html">Gold Against Cancer: Biocompatible Gold Nanoparticles For Individual Oncotherapy Received</a></li>
<li><a href="../en506340/index.html">What Amazon's new safeguards look like</a></li>
<li><a href="../en506342/index.html">How an automation system solves the problems of a sports club</a></li>
<li><a href="../en506358/index.html">3 options for court behavior when they receive cases of prosecutorial locks</a></li>
<li><a href="../en506362/index.html">How we did a dance ball online</a></li>
<li><a href="../en506370/index.html">Compare the performance of Check Constraint and Foreign Key in SQL Server</a></li>
<li><a href="../en506372/index.html">–£ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –Ω–∞–π–¥–µ–Ω –∏–Ω—Å—Ç–∏–Ω–∫—Ç —Ä–∞–∑–º–Ω–æ–∂–µ–Ω–∏—è</a></li>
<li><a href="../en506380/index.html">Free or domestic software. Standard or free tuition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>