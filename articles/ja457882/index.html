<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✡️ 👼 🏞️ ゼロからのヘキサポッド開発（パート7）-新しいパッケージ、アプリケーションソフトウェア、通信プロトコル 💱 👩‍⚕️ 💈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="みなさん、こんにちは！新しいエンクロージャーの設計、印刷、組み立てがついに完了しました。 STM32F373をベースにした新しい制御ボードの発売も完了し、FWは新しいMKに正常に転送されました。基本的な機能を備えたリリース1.00がますます近づいています。これで、サイクルで言及されたことのない何かに...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ゼロからのヘキサポッド開発（パート7）-新しいパッケージ、アプリケーションソフトウェア、通信プロトコル</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457882/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/pl/pz/zb/plpzzbg1zxhcgfisx9j2c2bb1p0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
みなさん、こんにちは！新しいエンクロージャーの設計、印刷、組み立てがついに完了しました。 STM32F373をベースにした新しい制御ボードの発売も完了し、FWは新しいMKに正常に転送されました。基本的な機能を備えたリリース1.00がますます近づいています。これで、サイクルで言及されたことのない何かについて話すことができます-アプリケーション管理ソフトウェアと通信に使用されるプロトコル。いつものように、私がジャンプから踏み出した写真、ビデオ、そして熊手のリストがたくさんあります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発段階：</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート1-設計</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート2-アセンブリ</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート3-運動学</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート4-軌道とシーケンスの数学</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート5-電子工学</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート6-3Dプリントへの移行</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート7-新しい建物、アプリケーションソフトウェア、通信プロトコル</font></font></b></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パート8-動きの数学の改善</font></font></a><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい変更の概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに8個のDS3218MGユニットが購入され（マージンあり）、完全に新しいドライブに切り替えることができました（COXAにはMG996Rがありました）。</font><font style="vertical-align: inherit;">これにより、ドライブが異なるため、COXAの回転速度をFEMURおよびTIBIAの速度と同期させる問題が解決されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3Dプリンターで10日間印刷した後、新しいプラスチックケースが出てきました。</font><font style="vertical-align: inherit;">視覚的には以前のものよりも大きいことがわかりましたが、物理的には寸法は変わりませんでした。</font><font style="vertical-align: inherit;">ケースの組み立てには、新しい部品の印刷を考慮して、部品を側枠に交換することを考慮して、5日かかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
電子機器とドライブを除いたケースの重量は約1.5kgです。</font><font style="vertical-align: inherit;">ドライブの重量〜1.2kg。</font><font style="vertical-align: inherit;">電子機器の重量は〜90g、バッテリーの重量は〜148gです。</font><font style="vertical-align: inherit;">ヘキサポッドの総重量は約3kgです。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組み立てのさまざまな段階でのケースの写真</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/s4/z0/d_/s4z0d_ddxxi8xarv6r4gauhkmwm.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qz/fe/dq/qzfedqrsjiei95eu-dybk-_acwq.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xt/0f/kw/xt0fkw6bwr_rayatbj3pqlrd2ce.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sh/qv/ie/shqvie777k2vnlzr-tuctjei3mq.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2h/b9/o7/2hb9o7msrv_qn-d_iwc6zcvl1s0.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/us/ar/xyusarw9nriefli7lhyb5eb-fyi.jpeg"></div></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、内部には2つのファン35x35mmの形でアクティブな冷却があります。心の安らぎのために残しました。ヘキサポッドはあまり機能しないため、過熱はこれまでになく、また予期されていません。外部電源からの長時間の使用（30分を超える）により、電源ボードの顕著な加熱が観察されます。左手の形の温度計は約70度の温度を示しました。ボードの反対側には、銅ポリゴンの形のヒートシンクもありません。これは、国内生産によるものです。近い将来、私はこの欠点を考慮に入れて、実際には他の多くの製品を中国で注文する予定です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前面には4つのRGB LEDがあり、ヘキサポッドのステータスを示します。</font><font style="vertical-align: inherit;">たとえば、バッテリーの充電量が少ない場合、LEDはしばしば赤く点滅し、同時にピエゾツイーターを狂わせます。</font><font style="vertical-align: inherit;">接続が失われた場合、LEDはすでに青色に点滅しますが、ツィーターがない場合はまれです。</font><font style="vertical-align: inherit;">すべて問題なければ-緑を燃やします。</font><font style="vertical-align: inherit;">さて、すべてのケースについては説明しません:)以下は、プロセスを明確にするためにヘキサポッド初期化プロセスを使用したビデオです。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/u2NjJ9BqKm8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、接続が失われたときのテスト付きのビデオ：</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9ujS4k7mIv4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
中国人はついに新しい制御盤を製造して送り、最小限の部品一式が同じ日にはんだ付けされました。</font><font style="vertical-align: inherit;">ボード上でクリティカルでない側枠が1つだけ見つかりました。RESETクロックボタンの結論（そのうち4つあります）が混同されています。これは、2つの結論を対角線で噛むことで解決します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/h-/wh/lt/h-whltrukvwbjc6gzydx1czqhqi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はもっ​​と多くの側枠を期待しましたが、そうではないことを嬉しく思います（RXとTXでさえ混乱しませんでした）。</font><font style="vertical-align: inherit;">スポイラーの下のボードの写真には、比較のために古いサンドイッチの写真もいくつか追加されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はPCBWayでボードを注文しましたが、約束されたように、生産自体は24時間かかりました。</font><font style="vertical-align: inherit;">ePacketの配信では通常よりも長くかかりました-19日（通常、この配信では12〜14日かかります）。</font><font style="vertical-align: inherit;">コストは合計で12ドルで、5枚のボードの生産と配送（注文の最小数量）でした。これは、わが国の価格に比べて非常に安価です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、通信をBluetoothに転送していなかったため、ヘキサポッドはWIFI接続を介して制御されています（Bluetoothをコントロールボードに接続する可能性はすでに整っています）。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制御盤の写真</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/j9/rr/pk/j9rrpkuzfbt6n02rjgzmr7kjh94.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0f/7m/0n/0f7m0n2dqzey3ujab3mwnvzoyaq.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nq/uo/ab/nquoabfzgwhpnlf-ysi8ofmke4s.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/mx/fe/cgmxfe-uiuomuyfdphwc9nv5vte.jpeg"></div></div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コネクタの説明付きの写真</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y1/i1/z4/y1i1z4ylzirsjkofkppo8rac-ry.png"></div></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバッグ用に、SWDインターフェースははんだ付け用の接点に出力されます（ワイヤーは写真ではすでにはんだ付けされています）。</font><font style="vertical-align: inherit;">次のブロックがボードに接続されています：手足からのリミットスイッチ、ドライブへの信号送信用の電源ボードへのループ、ジェネレーターを内蔵したツイーター、フロントRGB LED、電源、セルの充電を制御するバッテリーを備えたバランシングコネクタ。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボードファームウェア</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が会った、STのすべてのMKは、USARTとSTM32F373を介したプログラミングをサポートしていることも例外ではありません。</font><font style="vertical-align: inherit;">これにより、プログラマーやデバッガーを使用せずにMKをプログラミングできます。</font><font style="vertical-align: inherit;">この場合、アリとプログラム「STM32フラッシュローダーデモンストレーター」で150ルーブルのUSB-UARTコンバーターを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボードをフラッシュするには、BOOTジャンパーとRESETボタンを操作する必要があります（上に置いて押します）。</font><font style="vertical-align: inherit;">次に、USB-UARTコンバーターをサービスコネクタ（RX、TX、GND）に接続し、「STM32フラッシュローダーデモンストレーター」プログラムを使用する必要があります（使用方法はインターネットで確認できます）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソフトウェア</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が開発プロセスでまだ説明していないこと、つまりヘキサポッド（AIWMコントロール）とのユーザーインタラクションのためのアプリケーションに移りましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラップトップを持って通りを歩くのはあまり便利ではないので、私はAndroidソフトウェアを作ることにしました（今は誰もが携帯電話をポケットに入れています）。プログラムはQt \ QMLを使用してC ++で記述されています。これにより、アプリケーションのクロスプラットフォームの性質を維持することもできるため、Windowsでは、exe-shnikを取得することは問題になりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムインターフェイスは機能が豊富ではなく、可能な限りシンプルになっています。このプログラムには、接続、端末、制御の3つの可能な画面があります。内部的には、これはQML SwipeViewを使用して実装されます。どの画面からでも、電話の戻るボタンを使用して接続画面に戻ることができます。接続画面の戻るボタンを押すと、アプリケーションが終了します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続画面。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、すべてが簡単です-ちょうど2つのボタン。</font><font style="vertical-align: inherit;">ここから、制御画面と端末画面に移動できます。</font><font style="vertical-align: inherit;">クリック-交差。</font><font style="vertical-align: inherit;">内部的には、これはSwipeViewで適切なインデックスを設定することで実装され、Qtが残りを行います。</font><font style="vertical-align: inherit;">画面に入ると、別のスレッドが起動して通信を処理し（インターフェースが遅くなると気に入らない）、画面を離れると強制終了されます。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q3/rg/2r/q3rg2rigi9em66scy7ldfapcdn0.png"></div></div>
                    </div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントロール画面。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここはもっとおもしろいです。</font><font style="vertical-align: inherit;">この画面には、バッテリーの充電とヘキサポッドモジュールのステータスが表示されます。</font><font style="vertical-align: inherit;">モジュールの1つが故障すると、対応する長方形が赤く点灯します。</font><font style="vertical-align: inherit;">モジュールに正確に何が起こったかを理解するためのエラー表示もあります。</font><font style="vertical-align: inherit;">たとえば、ムーブメントコアが正しく構成されていない場合、長方形の「ムーブメントエンジン」と「構成エラー」が点灯します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘキサポッドの通常の操作中のブロックの状態の例。</font><font style="vertical-align: inherit;">この場合、エラーはなく、すべてのモジュールが緑色で強調表示されています。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0z/wq/vi/0zwqvifdmjsjsfu0sigfgse6tdw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに示されているモジュールとエラーを簡単に説明する価値があると思います。</font><font style="vertical-align: inherit;">間違いから始めましょう。</font></font><br>
<br>
<ul>
<li>FATAL_ERROR —   .     ,      .  ,  ,       .       ,     -  .    FW   ,        ;</li>
<li>CONFIGURATION_ERROR —  .         ( ,  TIBIA = 0xFFFF ).            FATAL_ERROR   ;</li>
<li>MEMORY_ERROR —  .     EEPROM,     I2C.  ,     .      FATAL_ERROR   ;</li>
<li>VOLTAGE_ERROR —  .        ,     .          ,   ;</li>
<li>SYNC_ERROR —  .       .       PWM  (160 )         .        (    EEPROM),      ;</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MATH_ERROR-数学エラー。</font><font style="vertical-align: inherit;">0による除算、FPUの失敗、その他の喜びが検出された場合に設定されます。</font><font style="vertical-align: inherit;">エラーインストールの場合、それが検出されたモジュールは無効になります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONNECTION_LOST-接続が失われました。</font><font style="vertical-align: inherit;">接続の切断が検出された場合に設定されます。</font><font style="vertical-align: inherit;">アイデアによると、このブロックは赤くならないはずです。接続が失われたことを検出した場合（ウィザードからのパケットがないことを意味します）、ヘキサポッドは現在の状態のパケットの送信を停止します。</font><font style="vertical-align: inherit;">エラーは内部で使用するために必要です。取り付けられている場合、ヘキサポッドはお腹の上に座って青色のLEDを点滅させます（記事の冒頭のビデオ）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュール：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONFIGURATOR-EEPROMの操作を担当します。</font><font style="vertical-align: inherit;">データを読み書きするためのインターフェースを提供します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SERVO_DRIVER-サーボドライバー。</font><font style="vertical-align: inherit;">パルス幅の計算に関与し、PWMドライバーへの値の同期送信を整理します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIMBS_DRIVER-リムドライバー。</font><font style="vertical-align: inherit;">四肢の動きの軌道を計算し、逆運動学の問題を解決します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOVEMENT_ENGINE-ムーブメントの中核。</font><font style="vertical-align: inherit;">シーケンスを切り替えるためのインターフェースを提供し、リムドライバーへの座標の転送を整理します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SYSTEM_MONITOR-システムの状態を監視するためのモジュール。</font><font style="vertical-align: inherit;">エラーを設定/リセットし、アナログ測定を実行し、対応する値（電圧）を計算するためのインターフェースを提供します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
移動に適切なヘキサポッドコマンドを送信するためのさまざまなコントロールがあります。</font><font style="vertical-align: inherit;">ここにあるのは剣だけではありません。誰かをつついたり、ドアをノックしたりできます。ところで、彼はかなりの重量と強力なドライブのため、かなり顕著に突きます。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mb/rw/vq/mbrwvqadefow6fobejyatzrcx9e.png"></div></div>
                    </div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端末画面。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘキサポッドを構成およびデバッグするためのサービス画面。</font><font style="vertical-align: inherit;">画面の機能は非常にシンプルで、受信と送信の2つの機能を実行します。</font><font style="vertical-align: inherit;">すべて。</font><font style="vertical-align: inherit;">通信にはCLIが使用されますが、これについては少し後で説明します。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリーンショット</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/jw/ha/yc/jwhaycnlprzz7ukzi4sla-vprze.png"></div></div>
                    </div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根性。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部では、すべてが非常に単純に配置されています。メインストリームと通信ストリームの2つのストリームがあります。メインスレッドではGUIとアプリケーションコアが処理され、通信スレッドでは（突然）通信が処理されます。ストリーム間の通信は、信号とスロットを使用して実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通信はQUdpSocketを使用して行われ、上位レベルではSWLP（Simple WireLess Protocol）プロトコルが使用されます。プロトコルの説明をグーグルで検索することはできません-これは私の発想であり、後でそれについて話します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットはタイマーイベントによって送信されます。タイマーイベントを処理するとき、通信ストリームはメインストリームをヤンクし（信号を生成し）、送信するデータを与えます。さらに、データはSWLPフレームにパックされ、WIFI接続を介してUDPプロトコルで送信されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットを受信すると、データグラムが到着したソケットからの信号が処理されます。</font><font style="vertical-align: inherit;">次に一連のチェックが行われ、データが抽出されて、メインストリームに「データが到着しました-取得」という信号が生成されます。</font><font style="vertical-align: inherit;">すべてが簡単です。</font><font style="vertical-align: inherit;">その後、メインスレッドは受信したデータに応じてインターフェースの更新を開始します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信プロトコル-シンプルワイヤレスプロトコル（SWLP）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、通常の操作でのヘキサポッドとの主要な通信プロトコルです。</font><font style="vertical-align: inherit;">トランスポートプロトコルの品質はUDP / IPを使用します。</font><font style="vertical-align: inherit;">執筆時点では、フレームフォーマット（ADU）とペイロード（PDU）は次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/ch/_7/x8ch_7n05inkyk5bbh24en1ura8.png"><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開始マーカー-パケットの開始のマーカー。</font><font style="vertical-align: inherit;">0xAAAAの固定値があります。</font><font style="vertical-align: inherit;">追加のパッケージ整合性制御に必要です。</font></font></li>
<li>Packet number —  .  UDP            .       ;</li>
<li>PDU (Payload Data Unit) —    ().    COMMAND  STATUS;</li>
<li>CRC16 —     .  0xA001,      ModBus;</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどのPDUは、将来必要になる可能性がある追加のデータ用に予約されています。 PDUのフィールドは、説明しても意味がないと思いますが、そこでは名前がわかります。電圧がmVで送信されるという事実についてのみコメントできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コミュニケーションのプロセスはもっと面白いです。プロトコルはマスター-スレーブモデルを使用します。マスター（この場合、Androidアプリケーション）は常に「PDUコマンド」のパケットを少なくとも毎秒2回送信します。マスターからの各パケットのスレーブ（ヘキサポッド）は「PDUステータス」のパケットを形成して送信する必要があります。同時に、ヘキサポッドはマスターにデータを要求できず、要求するものはありません。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存のプロトコルを使用しなかったのはなぜですか？何のために？それらのほとんどは、可変長または冗長なヘッダーを持っています。私は受け入れる必要があるバイト数が正確にわかっている状況が好きです、私はとても穏やかです。それは間違っていて非効率的かもしれませんが、単純かつ確実に十分機能します。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ファームウェアでは、フレーム受信（ADU）は、USARTの非常に便利な機能の1つであるRTO（Receiver Timeout）に基づいています。これにより、マイクロコントローラーのRXラインに「沈黙」時間値を設定でき、沈黙が設定時間より長く続くとすぐに割り込みが生成されます。これにより、DMAを使用して、割り込みで各バイトを処理せずにデータを受信でき、データストリームでパケットの先頭を探す必要がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記に基づいて、パケット間のポーズは、30ビットの送信時間より長くなければなりません。</font><font style="vertical-align: inherit;">理由として値30が選択されました。これはUSARTによる3.5文字の送信時間です（わずかなマージンあり）。このルールはModBusプロトコルの仕様に基づいています。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModBus仕様からの抜粋</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/gg/0o/bv/gg0obvjufcm37dpg7ntkhfjvoxo.png"><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバッグプロトコル-CLI</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロトコルを使用するには、接続画面でアプリケーションの「ターミナル」ボタンをクリックする必要があります。デフォルトでは、アクティブな通信プロトコルはSWPLです。 CLIを使用するには、「cli cli cli」を送信してプロトコルを切り替える必要があります。端末画面に切り替えると、アプリケーションはこれを自動的に行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、CLIコマンドを使用してヘキサポッドを制御できます。コマンドの形式は、&lt;モジュール名&gt; &lt;コマンド&gt; &lt;引数&gt;です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -「システムステータス」は現在のシステム情報を要求します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -「サーボキャリブレーション1500」は、ドライバーからすべてのサーボを切断し、角度補正用に1500usのパルス幅を設定します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -「config write 0200 0102AABB」は、データ0102AABBをアドレス0200のEEPROMに書き込みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ドライブ1と3の逆方向の設定例</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ub/vu/zw/ubvuzwm33qbnd03gq-a_gnqpkdg.gif"></div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドの完全なリスト（ヘルプ出力）</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/w7/xg/ib/w7xgib2n9o09ghqvpzjalzhf_to.png"></div><br>
     ,         .         .<br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レーキ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に、ケースが印刷された瞬間から始めて、開発プロセス中のエピックエラーのリストを示します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制御基板には、ダイオードの形で逆極性に対する保護を提供しました。</font><font style="vertical-align: inherit;">ボードのコンポーネントはパーツで提供され、この同じダイオードが別のバッチで使用されました。</font><font style="vertical-align: inherit;">他のダイオードも利用可能でしたが、「まあ、このボードを開発したので、+と-がどこにあるかわかっています」の指示に従って、ジャンパーをはんだ付けすることにしました。</font><font style="vertical-align: inherit;">その場合、10日でも、VDDとGNDを混同しました。</font><font style="vertical-align: inherit;">すべてが3V3と5Vでそれぞれ殺されたスタビライザーのみに判明し、MKは無傷のままでした（親愛なるラスカル）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライブの回転角度を制限する機能はサーボドライバーに備えられていたため、構成中にはオンにしませんでした。</font><font style="vertical-align: inherit;">ほんとに？なんで？</font><font style="vertical-align: inherit;">その結果、ドライブがTIBIAを目的の位置に押し続けようとしている間、TIBIAがFEMURにどのように置かれているか（位置0がタッチ境界に近い）に気づきませんでした。</font><font style="vertical-align: inherit;">約15分後、手足からぬくもりが出始め、触ると熱くなりすぎました。</font><font style="vertical-align: inherit;">ドライブは死んでいた。</font><font style="vertical-align: inherit;">完全に。</font><font style="vertical-align: inherit;">そしてDCモーターと両方のトランジスタ。</font><font style="vertical-align: inherit;">あと2つ買ってよかった。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
忘れられない壮大なものは何もないようです。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私はそのような瞬間をリストし始めませんでした：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラグからアンテナからワイヤーを引っ張る必要がありました。</font><font style="vertical-align: inherit;">これを行うには、8本のボルトを緩めてカバーを取り外します。</font><font style="vertical-align: inherit;">それから来たもの：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カバーを取り外すと、プラスチックラックの1つが外されました。その結果、COXA軸から四肢を取り外す必要がありました（これはすぐに行うことができます）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取り外し、ラックをひねり、肢を所定の位置に置きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カバーを元の位置に戻し、8本のボルトを締めます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何を忘れましたか？</font><font style="vertical-align: inherit;">そうです-アンテナワイヤーを引き出し、分解して分解します。</font><font style="vertical-align: inherit;">一般的に、それは楽しかったです:)この瞬間までに私が電動ドライバーを手に入れ、ボルトを回転させるプロセスが喜びをもたらし始めたのは良いことです。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発の過程で、ケースの組み立てについてビデオを作ることにしました。</font><font style="vertical-align: inherit;">残念ながら手足の組み立てのみの動画をなんとか作りました。</font><font style="vertical-align: inherit;">このアイデアが出たとき、ボディは既に80％組み立てられていて、分解したくありませんでした。</font><font style="vertical-align: inherit;">また今度。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/WEOGHbEVW0M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい建物（音なし）を散歩します。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6YZRIJafFbs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja457866/index.html">Laravelでの単体テスト</a></li>
<li><a href="../ja457870/index.html">Dockerを使用したプロジェクトビルドインフラストラクチャ</a></li>
<li><a href="../ja457872/index.html">時間を管理し、先延ばしをやめるには？</a></li>
<li><a href="../ja457874/index.html">なぜ従業員が戻ってくるのですか？出発と帰路の物語</a></li>
<li><a href="../ja457876/index.html">翻訳：IEEE 802.15.4z規格。将来私たちを待っているのは何ですか？</a></li>
<li><a href="../ja457884/index.html">ソブリンインターネット-注文の明確化</a></li>
<li><a href="../ja457886/index.html">USBトークンを使用したサイトでの2要素認証。Linux向け</a></li>
<li><a href="../ja457888/index.html">変異テスト：テストテスト</a></li>
<li><a href="../ja457892/index.html">ルーレット教授</a></li>
<li><a href="../ja457894/index.html">Proxmoxクラスターの操作：インストール、ネットワークセットアップ、ZFS、一般的な問題の解決</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>