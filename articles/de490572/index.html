<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óæÔ∏è üë©üèº‚Äçüîß ü•† Selbst gemachter Autopilot auf einem Single Board Computer (SBC) Tinker Board und Arduino DUE üéÆ üíé „äóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Idee, einen Autopiloten zu bauen, kam vor ungef√§hr 2 Jahren. Ich wollte einen vollst√§ndig autonomen Apparat schaffen, der in der Lage ist, von Pun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Selbst gemachter Autopilot auf einem Single Board Computer (SBC) Tinker Board und Arduino DUE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490572/"><img src="https://habrastorage.org/getpro/habr/post_images/61d/7fa/23b/61d7fa23bfc1c4a76018dbf13eb0adb6.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Idee, einen Autopiloten zu bauen, kam vor ungef√§hr 2 Jahren. </font><font style="vertical-align: inherit;">Ich wollte einen vollst√§ndig autonomen Apparat schaffen, der in der Lage ist, von Punkt A nach Punkt B zu gelangen, mit der M√∂glichkeit, Kollisionen zu vermeiden und um Hindernisse herumzufliegen, St√∂rzonen zu √ºberwinden oder kein Satellitensignal zu haben. </font><font style="vertical-align: inherit;">Ich wollte auch eine bequeme und einfache Steuerung mit der Maus haben, da diese in Spielen (Strategien) implementiert ist, die die Bewegung des Flugzeugs mithilfe von Punkten steuern. </font><font style="vertical-align: inherit;">Ich musste alles von vorne beginnen, wie in diesem Artikel. Wenn es also Fehler gibt, schreibe dar√ºber in den Kommentaren. </font><font style="vertical-align: inherit;">Ich werde in der richtigen Reihenfolge beginnen.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hardware</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anfangs wusste ich nicht, welches Eisen f√ºr dieses Projekt besser geeignet ist, aber am Ende kam ich zu dem Schluss, dass die beste Option ein Haufen Mikrocontroller (MK) + Einplatinencomputer w√§re. Wenn MK das Problem der Stabilisierung eines Flugzeugs (LA) l√∂st, l√∂st seine Bewegung auf einem bestimmten Kurs und in einer bestimmten H√∂he, und ein Einplatinencomputer l√∂st das Problem der Navigation und Bewegung entlang einer Route. Da der Plan war, Kollisionen zu vermeiden, musste der Computer leistungsf√§hig genug sein, um Informationen von Hinderniserkennungssensoren zu verarbeiten, kompakt und zu dieser Zeit nicht zu teuer. TinkerBoard war f√ºr diese Beschreibung am besten geeignet, dann war Raspbery 3B + und hatte viel schlechtere Eigenschaften. Als MK wollte ich einen Arduino-kompatiblen Controller haben, weil Arduino hatte eine riesige Basis an vorgefertigten Skizzen und daher fiel die Wahl auf DUE 84 MHz, 32 Bit ARM Cortex-M3, weiler war der m√§chtigste und musste die Direktheit meiner H√§nde ausgleichen)).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Urspr√ºnglich wollte ich die MPU 9250 mit einem Majevik-Filter als Orientierungssensoren verwenden, und die Ergebnisse waren ausgezeichnet. Der Hauptvorteil dieser Option bestand darin, dass alle Berechnungen, einschlie√ülich der Kalibrierung der Sensoren (Beschleunigungsmesser, Gyroskop und Magnetometer), auf dem MK durchgef√ºhrt wurden. Es gab jedoch ein Problem, der Filter kompensierte die Linearbeschleunigung, die st√§ndig bei St√∂√üen oder einer starken Kurs√§nderung auftritt, schlecht. Dies dr√ºckt sich in den Ablesungen von Nick- und Rollbewegungen aus. Im Moment der Beschleunigung beginnen sie wegzuschweben und passieren durch das Proportionaldifferentialregler (PD) und insbesondere den Differentialteil das Schweben verursachte Probleme. Daher musste ich einen Sensor mit einem bereits implementierten BNO 055 Filter verwenden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Gegensatz zur MPU 9250 verf√ºgt der BNO √ºber den integrierten Cortex M0 MK, der sofort die Ausrichtung in Euler-Winkeln, die Quaternine mit absoluter Ausrichtung und die Linearbeschleunigung berechnet, obwohl dieser Sensor auch einige Nachteile hat. Das Hauptproblem dieses Sensors ist die Autokalibrierung, oder vielmehr, dass er nicht ausgeschaltet werden kann, ist eine solche ‚ÄûPassung‚Äú dieses Sensors, und diese Kalibrierung hat die unangenehme Eigenschaft, zu verschwinden, manchmal absolut pl√∂tzlich sogar nur an einem Ort ohne Bewegung. Dies spiegelt sich haupts√§chlich in dem Gieren wider, das an dem Magnetometer in diesem Sensor angebracht ist und die Richtung zum magnetischen Nordpol (Kurs) anzeigen sollte, aber manchmal zeigt es 100 Grad in Strona, und nach dem Kalibrieren kann es zur√ºckgehen))). In anderen F√§llen kann das Kursproblem weiterhin durch Synchronisation mit GPS gel√∂st werden. Ansonsten funktioniert der Sensor einwandfrei,Er bestimmt die Neigung und das Rollen immer richtig, und lineare Beschleunigungen haben keinen gro√üen Einfluss auf seine Arbeit, es sei denn, die Beschleunigung √ºberschreitet nat√ºrlich nicht 2G, weil Diese Schwelle wird verwendet, um den Schwerkraftvektor zu messen und die Drift von Gyroskopen zu kompensieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Rest des B√ºgeleisens ist wie folgt: GPS Ublox Neo M8N mit USB-Ausgang, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BMP 280-Barometer, HSCR 04-Sonar zum Empfangen von Daten zur Bodenverf√ºgbarkeit und genaueren vertikalen Geschwindigkeit, EEPROM 24c16 zum Speichern von Kalibrierungsdaten und PID-Einstellungen, Neoway M509E GSM-Modul zum Senden Meldungen √ºber die Koordinaten des Flugzeugs im Falle eines Unfalls. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Funktionsdiagramm ist in Abbildung 1 dargestellt: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7f7/9e3/9df/7f79e39df3579c4508abd884aba32236.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 1 - Funktionsdiagramm des Autopiloten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Software</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr die Softwareentwicklung verwende ich QT zusammen mit der QT Creator IDE. Er ist mir am vertrautesten und dank der plattform√ºbergreifenden Funktionalit√§t kann ich meine Programme sowohl auf einem Einplatinen-PC mit Debian als auch auf einem Desktop mit Windows ausf√ºhren, was sehr praktisch ist. F√ºr die Entwicklung von Mikrocontroller-Software wird die Arduino IDE verwendet. Aus Gr√ºnden der √úbersichtlichkeit werde ich versuchen, alle Abschnitte in Abbildung 2 darzustellen. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6fa/dcb/48d/6fadcb48dd175a45e40ca07bf2870961.png" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 2. - Architektur des AP (BNO 080 f√ºr die Zukunft hinzugef√ºgt).</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1) Grafische Steueroberfl√§che - ist eine Satellitenkarte, mit deren Hilfe das Flugzeug gesteuert wird. Das Satellitenbild-Anzeigeprogramm selbst geh√∂rt nicht mir, es wurde von mir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gestohlen </font><font style="vertical-align: inherit;">(sein Autor hat auch versucht, etwas √Ñhnliches zu tun).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen das Flugzeug mit Punkten (Markierungen) oder WADS-Tasten steuern. Um Punkte zu kontrollieren, muss die Flugroute mit gr√ºnen Markierungen versehen werden, sie werden mit der Maus (RMB) gesetzt und auf Route laden geklickt oder die (rote) Sofortbewegungsmarkierung (LMB) verwendet, und dann fliegt das Flugzeug von der aktuellen Position zu diesem Punkt, f√ºr dessen Betrieb muss es eingestellt werden Kontrollk√§stchen im Kontrollk√§stchen "Manuell" bei versehentlichem Klicken.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Markierungsparameter werden in die entsprechenden Felder des Formulars eingegeben. Sie k√∂nnen die Markierungen entfernen, indem Sie mit der mittleren Maustaste doppelklicken. W√§hrend sie weiterhin im Flugzeugspeicher verbleiben, m√ºssen Sie sie mit der Schaltfl√§che Route l√∂schen aus dem Speicher l√∂schen. Sobald der Punkt erreicht ist, dreht er sich wie in den Strategien des Flugzeugs um ihn. Tastensteuerung WADS steuert die Lenkr√§der direkt √ºber PD-Steuerungen. Wenn jede Taste gedr√ºckt wird, wird ein Wert in den Eingang der Steuerung eingegeben, z. B. wenn S gedr√ºckt wird, Tonh√∂he 30 und wenn losgelassen wird 0. Wenn W-30 gedr√ºckt wird usw. WADS wird √ºber Kontrollk√§stchen aktiviert: "manuell", "Tasten". In diesem Modus k√∂nnen Sie vor dem Start die Funktionalit√§t aller Ruder √ºberpr√ºfen. Die grafische Oberfl√§che l√§uft auf dem Laptop, Steuerbefehle von der grafischen Oberfl√§che √ºber den TCP-Socket werden an den Kernel √ºbertragen. Die grafische Bedienoberfl√§che ist in Abbildung 3 dargestellt:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/687/2ad/ff3/6872adff36543236e64e5f75af0842cd.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 3 - Grafische Verwaltungsoberfl√§che.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Der Kern des Autopiloten ist der Teil der Software, der auf einem TinkerBoard-Einplatinencomputer berechnet wird. </font><font style="vertical-align: inherit;">Der Kernel ist f√ºr die Navigation und Bewegung entlang der Route verantwortlich. </font><font style="vertical-align: inherit;">Dazu wird ein GPS-Sensor an den Computer angeschlossen. </font><font style="vertical-align: inherit;">Mit dieser Funktion k√∂nnen Sie die aktuelle Position des Flugzeugs (Breiten- und L√§ngengrad) abrufen und diese Position mit der Position auf der Flugroute vergleichen. </font><font style="vertical-align: inherit;">Infolge dieser Operation wird der Azimut zum Ziel erhalten, der zusammen mit den √ºbrigen Flugparametern an den Mikrocontroller gesendet wird. </font><font style="vertical-align: inherit;">In Zukunft kann der Kernel mit seinem IMU-Sensor ausgestattet werden, um die ANN zu implementieren. </font><font style="vertical-align: inherit;">Sie k√∂nnen beispielsweise BNO 080 verwenden, um die Geschwindigkeit zu integrieren, zu beschleunigen und zu ermitteln. Durch Integrieren der Geschwindigkeit k√∂nnen Sie die Entfernung ermitteln. </font><font style="vertical-align: inherit;">Die vom ANN empfangene Entfernung muss f√ºr die Berechnung des Azimuts in das GPS-Koordinatensystem (Breiten- und L√§ngengrad) √ºbersetzt werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein solches ANN kann in Verbindung mit einem GPS-Sensor verwendet werden, wenn die Kommunikation mit dem Satelliten vor√ºbergehend unterbrochen wird, damit das Flugzeug keine ‚ÄûAbbiegung‚Äú zu einem Punkt verpasst. Zum Zeitpunkt des GPS-Betriebs wird der ANN st√§ndig anhand seiner Messwerte angepasst und f√ºllt die L√ºcken zwischen den Aktualisierungsperioden des GPS-Sensors. Auf die gleiche Weise sollte der Bildverarbeitungsalgorithmus oder SLAM angepasst werden, indem die H√∂he des Punkts ge√§ndert und Verzerrungen des berechneten Azimuts erzeugt werden. Nach Abschluss der Routenberechnung sendet der Kernel UART-Daten: Azimut, H√∂he, Anstellwinkel, Punkttyp und auch, ob eine Drehung um diesen Punkt erforderlich ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Der Mikrocontroller f√ºhrt die Kernbefehle aus. Die Hauptaufgabe des MK besteht darin, dem vorgegebenen Kurs in einer bestimmten H√∂he zu folgen. Daf√ºr ist die MKU mit einem IMU BNO 055 Sensor, einem BMP 280 Barometer und einem Sonar ausgestattet. F√ºr die Bewegung entlang des Kurses wird der vom Kern erhaltene Azimut verwendet, er wird mit dem aktuellen Kurs verglichen und die resultierende Nicht√ºbereinstimmung wird zum Gieren und Rollen an die PD-Steuerungen √ºbertragen. Die Pitch-Steuerung wird von 2 PD-Controllern ausgef√ºhrt: Der 1. bestimmt die Nicht√ºbereinstimmung des Stroms und der vorgegebenen H√∂hen, die dem Eingang des 2. Controllers zugef√ºhrt werden, w√§hrend der Ausgang des H√∂henreglers durch den aktuellen Anstellwinkel begrenzt wird, um seinen Satz zu steuern. Wenn in der grafischen Oberfl√§che der Punkttyp f√ºr Start oder Landung ausgew√§hlt ist, wird ein Sonar verwendet, um die H√∂he zu bestimmen. Sein Zeugnis wird mit den Daten des Barometers kombiniert,um den Abstand zum Boden und die vertikale Geschwindigkeit am genauesten zu bestimmen. Zus√§tzlich zu den Grundfunktionen sammelt MK Telemetrie √ºber den Betrieb von IMU-Sensoren, die aktuelle Richtung und H√∂he, √ºbertr√§gt sie an den Kernel, wo diese Daten durch Daten vom GPS erg√§nzt werden und in die grafische Oberfl√§che gelangen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fazit </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derzeit befindet sich der Autopilot noch in der Flugtestphase und ist nicht vollst√§ndig konfiguriert. </font><font style="vertical-align: inherit;">Ich habe jedoch nur zwei Starts verbracht und die Koeffizienten f√ºr die Regulierungsbeh√∂rden noch nicht erfasst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen scheinen mir PD-Regulatoren instabil zu sein, und ich m√∂chte sie durch etwas Zuverl√§ssigeres ersetzen, zumal sie bereits veraltet sind. </font><font style="vertical-align: inherit;">Es ist auch notwendig, Berechnungen durch Euler-Winkel durch Berechnungen in Quaternionen zu ersetzen, weil </font><font style="vertical-align: inherit;">Letztere verhalten sich stabiler, wenn das Flugzeug in einem Winkel von mehr als 120 Grad gedreht wird und w√§hrend des Windes fliegt.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine detailliertere Aufnahme der Avionik</font></font></b>
                        <div class="spoiler_text"> <br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d4d/ff2/ca1/d4dff2ca14a27c848142db0092ba0c9b.jpg" alt="Bild"><br>
<br>
</div>
                    </div><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link zum Quellcode des Giftes (mit Bibliotheken) </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github hier nur die Quelle aber neuer</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de490558/index.html">Evangelisten gegen Werw√∂lfe</a></li>
<li><a href="../de490560/index.html">Hackathon von Grund auf in zwei Wochen</a></li>
<li><a href="../de490566/index.html">Softwarebereitstellungsumgebungen</a></li>
<li><a href="../de490568/index.html">Plastikschuss: Atypische Munition</a></li>
<li><a href="../de490570/index.html">Go: Soll ich einen Zeiger anstelle einer Kopie meiner Struktur verwenden?</a></li>
<li><a href="../de490574/index.html">Was haben Rekursion, Landing Pages und Content Marketing gemeinsam: sagt der Gr√ºnder der Agentur Embacy</a></li>
<li><a href="../de490576/index.html">Ultraschallbad. Teil 1</a></li>
<li><a href="../de490578/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 335 (24. Februar - 1. M√§rz)</a></li>
<li><a href="../de490584/index.html">Infineon hat Cross-Signing-Zertifikate in seinen kryptografischen Chips implementiert</a></li>
<li><a href="../de490586/index.html">Was ist Spring Framework? Von der Abh√§ngigkeitsinjektion zur Web-MVC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>