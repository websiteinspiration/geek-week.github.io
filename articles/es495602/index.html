<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèæ üì† üë©üèª‚Äçüíª ¬°Comenzando con Core Data! Dif√≠cil en palabras simples [Parte 2] ‚ÑπÔ∏è üï¥üèø üè•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, me gustar√≠a revelar a√∫n m√°s las capacidades de Core Data. Este art√≠culo es una continuaci√≥n . Realmente espero poder tener la idea d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¬°Comenzando con Core Data! Dif√≠cil en palabras simples [Parte 2]</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495602/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este art√≠culo, me gustar√≠a revelar a√∫n m√°s las capacidades de Core Data. </font><font style="vertical-align: inherit;">Este art√≠culo es una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continuaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Realmente espero poder tener la idea de que Core Data no es una de las muchas bases de datos relacionales, sino una herramienta muy poderosa que puede convertirse en un arma integral en el arsenal de cualquier desarrollador de iOS que se precie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, empecemos!</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy consideramos trabajar con dos NSManageObjectContext y NSFetchedResultsController. </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dos NSManageObjectContext y ¬øpor qu√© es necesario?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si su aplicaci√≥n usa activamente cualquier API a trav√©s de la cual recibe datos, y desea guardar estos datos en alg√∫n lugar, entonces Core Data es una excelente opci√≥n. ¬øQu√© problemas podr√≠as tener con esto? La primera y m√°s obvia: la cantidad de datos ser√° tan grande que cuando intente guardarlos, nuestra aplicaci√≥n se congelar√° por un tiempo, lo que afectar√° la experiencia del usuario. No se puede prescindir de un GCD ordinario aqu√≠, ya que independientemente, nuestra Pila de datos principales, que se mencion√≥ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , funciona de forma sincronizada y para cualquier acceso a nuestro NSManageObjectContext tenemos que esperar hasta el final del ciclo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero aqu√≠ el NSManageObjectContext privado que funciona en el hilo de fondo viene al rescate. Para llamarlo, primero debe comunicarse con nuestro NSPersistentContainer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La inicializaci√≥n se ver√° as√≠:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> persistentContainer: <span class="hljs-type">NSPersistentContainer</span> = {
    <span class="hljs-keyword">let</span> container = <span class="hljs-type">NSPersistentContainer</span>(name: <span class="hljs-string">"Preset"</span>)<font></font>
    container.loadPersistentStores { (persistent, error) <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">"Error: "</span> + error.localizedDescription)<font></font>
        }<font></font>
    }<font></font>
    container.viewContext.mergePolicy = <span class="hljs-type">NSMergeByPropertyStoreTrumpMergePolicy</span>
    container.viewContext.shouldDeleteInaccessibleFaults = <span class="hljs-literal">true</span>
    container.viewContext.automaticallyMergesChangesFromParent = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">return</span> container<font></font>
}()<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mergepolicy</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ especifica la pol√≠tica de fusi√≥n de nuestro NSManageObjectContext. </font><font style="vertical-align: inherit;">Aqu√≠ indicamos expl√≠citamente c√≥mo deben comportarse los datos centrales en caso de conflicto de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opciones de MergePolicy:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSRollbackMergePolicy: en caso de conflicto, descarta todos los cambios hasta que ocurra </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSOverwriteMergePolicy: guarda nuevos valores independientemente de los datos </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSMergeByPropertyStoreTrumpMergePolicy: guarda los objetos modificados propiedad por propiedad, en este caso, prevalecer√°n los datos guardados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSMergeByPropertyObjectTrumpMergePolicy: guarda los objetos modificados propiedad por propiedad, en este caso prevalecer√°n los datos nuevos </font></font></li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutomaticallyMergesChangesFromParent</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : indica si nuestro contexto fusionar√° autom√°ticamente los datos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, cree un nuevo contexto:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> context = persistentContainer.viewContext
<span class="hljs-keyword">let</span> context = persistentContainer.newBackgroundContext()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora tenemos dos NSManageObjectContext. </font><font style="vertical-align: inherit;">El primero es para trabajar con la interfaz de usuario y se ejecuta en el hilo principal, y el segundo tiene privateQueueConcurrencyType para trabajar en segundo plano. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo usaremos para descargar datos.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">let</span> object = <span class="hljs-type">NSEntityDescription</span>.insertNewObject(forEntityName: <span class="hljs-string">"Name"</span>, into: context)<font></font>
saveChanges(with: context)<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ creamos nuestra Entidad y luego podemos asignarle las propiedades necesarias, despu√©s de lo cual llamamos el m√©todo de guardar, se ve as√≠: </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">saveChanges</span><span class="hljs-params">(with context: NSManagedObjectContext)</span></span> {<font></font>
        context.performAndWait {<font></font>
            <span class="hljs-keyword">if</span> context.hasChanges {
                <span class="hljs-keyword">do</span> {
                    <span class="hljs-keyword">try</span> context.save()<font></font>
                } <span class="hljs-keyword">catch</span> {<font></font>
                    context.rollback()<font></font>
                }<font></font>
            }<font></font>
            context.reset()<font></font>
        }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay 2 m√©todos para elegir:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performAndWait: realiza acciones en el hilo de contexto sincr√≥nicamente</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realizar: realiza acciones en la secuencia de contexto de forma asincr√≥nica</font></font></li>
</ul><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSFetchedResultsController</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSFetchedResultsController: un controlador que realiza ciertas solicitudes y muestra los datos necesarios al usuario.</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> fetchedResultsController: <span class="hljs-type">NSFetchedResultsController</span>&lt;<span class="hljs-type">Pack</span>&gt; = {
        <span class="hljs-keyword">let</span> fetchRequest = <span class="hljs-type">NSFetchRequest</span>&lt;<span class="hljs-type">Pack</span>&gt;(entityName:<span class="hljs-string">"Pack"</span>)<font></font>
        fetchRequest.fetchBatchSize = <span class="hljs-number">20</span>
        fetchRequest.sortDescriptors = [<span class="hljs-type">NSSortDescriptor</span>(key: <span class="hljs-string">"name"</span>, ascending:<span class="hljs-literal">true</span>)]
        <span class="hljs-keyword">let</span> controller = <span class="hljs-type">NSFetchedResultsController</span>(fetchRequest: fetchRequest, managedObjectContext: context, sectionNameKeyPath: <span class="hljs-literal">nil</span>, cacheName: <span class="hljs-literal">nil</span>)<font></font>
<font></font>
        controller.delegate = <span class="hljs-keyword">self</span>
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">try</span> controller.performFetch()<font></font>
        } <span class="hljs-keyword">catch</span> {
            <span class="hljs-built_in">print</span>(error.localizedDescription)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> controller<font></font>
    }()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSFetchedResultsController tiene una gran cantidad de configuraciones, analizaremos algunas de ellas:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fetchlimit</font></font></b><div class="spoiler_text">FetchLimit ‚Äî      <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sketchoffset</font></font></b><div class="spoiler_text">FetchOffset ‚Äî  .    2,       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FetchbatchSize</font></font></b><div class="spoiler_text">FetchBatchSize ‚Äî        .      Table/CollectionView        5 ,        7   ,          .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FetchbatchSize</font></font></b><div class="spoiler_text">FetchBatchSize ‚Äî                .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SortDescriptor</font></font></b><div class="spoiler_text">SortDescriptor ‚Äî       ,       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReturnsObjectsAsFaults</font></font></b><div class="spoiler_text">ReturnsObjectsAsFaults ‚Äî ,      ,      ,      PersistentStore         RawCache<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por el momento, tenemos un NSFetchedResultsController que debe mostrar nuestros datos en una tabla. </font><font style="vertical-align: inherit;">Para actualizar los datos, debe llamar al m√©todo delegado:</font></font><br>
 <br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">NSFetchedResultsControllerDelegate</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">controller</span><span class="hljs-params">(<span class="hljs-number">_</span> controller: NSFetchedResultsController&lt;NSFetchRequestResult&gt;, didChange anObject: <span class="hljs-keyword">Any</span>, at indexPath: IndexPath?, <span class="hljs-keyword">for</span> type: NSFetchedResultsChangeType, newIndexPath: IndexPath?)</span></span> {<font></font>
       collectionView.reloadData()<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este m√©todo de delegado funciona cuando tenemos alg√∫n cambio en nuestro contexto. </font><font style="vertical-align: inherit;">En esta implementaci√≥n, esto sucede despu√©s de guardar los datos en un contexto privado. </font><font style="vertical-align: inherit;">En este momento, se activa el m√©todo delegado y se actualizan los datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo un par de acciones y Core Data de una base de datos normal se convierten en un arma poderosa de cualquier desarrollador de iOS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Feliz codificaci√≥n!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495580/index.html">Pepino JVM - No solo BDD</a></li>
<li><a href="../es495588/index.html">Creando roguelike en Unity desde cero: generador de mazmorras</a></li>
<li><a href="../es495592/index.html">C√≥mo usar diccionarios (y no solo)</a></li>
<li><a href="../es495594/index.html">Comience a ganar dinero con el software: creando mini-digital-business</a></li>
<li><a href="../es495596/index.html">Trabajo a distancia en la oficina. RDP, Port Knocking, Mikrotik: simple y seguro</a></li>
<li><a href="../es495604/index.html">Localizaci√≥n temporal en Symfony 4 + Twig</a></li>
<li><a href="../es495606/index.html">"Monitoreo social". Puntuaci√≥n 1: 0 a nuestro favor</a></li>
<li><a href="../es495608/index.html">[Infograf√≠a] Visualizaci√≥n de pandemias en la historia de la humanidad</a></li>
<li><a href="../es495610/index.html">¬øPor qu√© el futuro no es para Python?</a></li>
<li><a href="../es495612/index.html">¬øAirbnb sobrevivir√° al coronavirus? [spoiler: s√≠]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>