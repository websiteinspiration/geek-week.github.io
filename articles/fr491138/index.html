<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèø üëèüèø üëåüèø Int√©gration satellite et tour Ansible üëéüèæ üò• üë®üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous utilisez Red Hat Satellite et Red Hat Ansible Automation Platform? √Ä partir de Satellite 6.3, ils peuvent √™tre int√©gr√©s les uns aux autres afin q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Int√©gration satellite et tour Ansible</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/491138/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous utilisez Red Hat Satellite et Red Hat Ansible Automation Platform? √Ä partir de Satellite 6.3, ils peuvent √™tre int√©gr√©s les uns aux autres afin que Dynamic Inventory dans Ansible Tower extrait les listes d'h√¥tes du Satellite. De plus, si les h√¥tes RHEL sont initialis√©s √† l'aide de Satellite (ce qui signifie l'approvisionnement), Ansible Tower peut √™tre int√©gr√© √† ce processus afin qu'il ex√©cute automatiquement des scripts de configuration sur les nouveaux h√¥tes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qq/4o/so/qq4oso9wx_wxkl81ha7aiy1b18a.jpeg" width="100%"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous verrons comment configurer l'inventaire dynamique dans Ansible Tower afin qu'il tire les h√¥tes du satellite, et nous montrerons comment l'utiliser avec des exemples. De plus, nous vous montrerons comment organiser un appel automatique vers Ansible Tower apr√®s avoir initialis√© un nouvel h√¥te depuis Satellite.</font></font><br>
<a name="habracut"></a><br>
<h3> 1.    Inventory.  Satellite,       Dynamic Inventory  Ansible Tower</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour qu'Ansible Tower ait acc√®s √† la liste des h√¥tes, groupes d'h√¥tes et autres informations connexes, elle a besoin d'un compte Satellite. Cette entr√©e a suffisamment d'autorisations minimales, nous allons donc cr√©er un nouveau r√¥le dans Satellite, lui donner uniquement les autorisations n√©cessaires pour Ansible Tower, puis cr√©er un nouveau compte et lui affecter ce r√¥le. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satellite 6.6 et versions ult√©rieures ont d√©j√† un r√¥le Ansible Tower Inventory Reader pr√™t pour cela, vous pouvez donc ignorer les √©tapes ci-dessous pour cr√©er un r√¥le. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le satellite 6.3-6.5, le r√¥le devra √™tre cr√©√© √† la main. Pour ce faire, acc√©dez √† l'interface Web Satellite, acc√©dez √† l'√©cran Administrer, s√©lectionnez R√¥les et cliquez sur Cr√©er un r√¥le. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nommons</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ce r√¥le </font><b><font style="vertical-align: inherit;">ansible_tower_integration_role</font></b><font style="vertical-align: inherit;"> et d√©finissons des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">emplacements et des organisations</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour cela </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/oy/ey/ocoyeyrceo04wboamjmzv_2nnf0.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cliquez sur Soumettre pour cr√©er le r√¥le. Apr√®s cela, cliquez sur son nom et acc√©dez √† l'onglet Filtres. Cliquez sur le bouton vert Nouveau filtre et ajoutez les filtres suivants, un par un: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Type de ressource: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√¥te</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , autorisation: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view_hosts</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Type de ressource: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">groupe d'h√¥tes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , autorisation: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view_hostgroups</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Type de ressource: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur de fait</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , autorisation: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">view_facts</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Par cons√©quent, les filtres suivants doivent avoir un r√¥le:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/cc/ia/r-/cciar-m-0-bz63n2lrijzatkbrg.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc cr√©√© un r√¥le. Nous allons maintenant cr√©er un nouvel utilisateur dans Satellite, pour lequel nous allons dans le menu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Administrer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , s√©lectionnez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisateurs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et cliquez sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©er un utilisateur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nommons</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cet utilisateur </font><b><font style="vertical-align: inherit;">ansible_integration</font></b><font style="vertical-align: inherit;"> , changez le param√®tre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authorized by</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNAL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et d√©finissons le mot de passe. Ensuite, dans les onglets </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emplacements et organisations</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">s√©lectionnez les emplacements / organisations appropri√©s. Enfin, allez dans l'onglet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√¥les</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et attribuez √† cet utilisateur le r√¥le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansible_tower_integration_role</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nouvellement cr√©√© </font><font style="vertical-align: inherit;">(si vous avez Satellite 6.3 - 6.5) ou le r√¥le int√©gr√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ansible Tower Inventory Reader</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Satellite 6.6 et sup√©rieur). </font><font style="vertical-align: inherit;">Enfin, cliquez sur Soumettre pour cr√©er un compte pour cet utilisateur.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Personnaliser la tour Ansible</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acc√©dez maintenant √† l'interface Web d'Ansible Tower et acc√©dez √† l'√©cran des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">informations d'identification</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cliquez sur le bouton vert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ (Ajouter)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour cr√©er une nouvelle entr√©e d'informations d'identification. </font><font style="vertical-align: inherit;">Nous l'appelons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et dans le type d'informations d'identification, nous sp√©cifions </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red Hat Satellite 6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Entrez ensuite l'URL (dans notre cas, Satellite 6), ainsi que le nom d'utilisateur (dans notre cas, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ansible_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), et le mot de passe est celui que nous avons d√©fini dans Satellite ci-dessus:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/xd/ws/ybxdws81uadmggdncbl_icg-ig8.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cliquez ensuite sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, allez √† l'√©cran </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inventaires</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cliquez sur le bouton vert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ (Ajouter)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et s√©lectionnez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inventaire</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sp√©cifiez satellite_inventory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme nom </font><font style="vertical-align: inherit;">et cliquez sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enregistrer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour cr√©er un inventaire. Apr√®s cela, acc√©dez √† l'onglet Sources de l'inventaire nouvellement cr√©√© et cliquez sur le bouton vert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ (Ajouter)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous utilisons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme nom de source </font><font style="vertical-align: inherit;">et sp√©cifions le type de source comme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red Hat Satellite 6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans le champ Credential, sp√©cifiez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite_integration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui a √©t√© cr√©√© √† l'√©tape pr√©c√©dente. Cochez la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">case Remplacer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âcraser les variables</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et mettre √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jour au lancement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le groupe de contr√¥le Options de mise √† jour (vous pouvez en savoir plus sur ces options en utilisant les points d'interrogation √† droite). </font><font style="vertical-align: inherit;">De plus, dans le champ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache Timeout (Seconds)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">entrez 90 et cliquez sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0n/_2/0j/0n_20jc394t3fh9vkxz00cqda3w.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, sans quitter l'onglet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sources</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cliquez sur l'ic√¥ne </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©marrer le processus de synchronisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gz/ys/um/gzysumhr2fghwc0l-xymeofs7cu.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous attendons que l'ic√¥ne devienne verte - cela signale la r√©ussite de la synchronisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez maintenant acc√©der √† l'onglet H√¥tes et voir les donn√©es extraites du satellite:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ne/4_/qk/ne4_qk5ne8ohsfx3iriwkkdfbvm.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez √©galement consulter l'onglet Groupes:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oj/sw/af/ojswafnsedywlukqweh3oib_hgu.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, la synchronisation a non seulement extrait les listes d'h√¥tes de Satellite, mais les a √©galement divis√©es en groupes en fonction des vues de contenu correspondantes dans Satellite, groupes d'h√¥tes, environnements de cycle de vie, emplacements et organisations. </font><font style="vertical-align: inherit;">Ce regroupement peut √™tre utilis√© pour cibler des scripts Ansible sur des h√¥tes cibles, et c'est une chose tr√®s puissante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous s√©lectionnez un h√¥te dans l'onglet H√¥tes, nous verrons qu'entre Satellite et Ansible Tower, beaucoup d'informations auxiliaires sur l'h√¥te sont synchronis√©es, qui sont pr√©sent√©es sous forme de variables. </font><font style="vertical-align: inherit;">Ces variables peuvent ensuite √™tre utilis√©es dans des scripts Ansible:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/la/6o/fw/la6ofwr3cf91cfxktzok_0eoy7c.png"></div><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de l'inventaire dynamique li√© au satellite</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons donc synchronis√© Satellite et Ansible Tower. Maintenant, nous allons voir comment les utiliser dans la pratique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moyen le plus simple consiste √† utiliser </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satellite_inventory</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme source d'inventaire dans le mod√®le de tour Ansible. Si l'option </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hosts: all</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est sp√©cifi√©e dans le script </font><font style="vertical-align: inherit;">, le script sera ex√©cut√© sur tous les h√¥tes Satellite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une option plus avanc√©e consiste √† utiliser des groupes d'inventaire cr√©√©s automatiquement dans les scripts (comment ils sont cr√©√©s - voir ci-dessus), en d'autres termes, sp√©cifiez le groupe d'h√¥tes souhait√© dans la ligne d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√¥tes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par exemple, comme dans ce sc√©nario o√π le package d'√©cran est install√©:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
- name: Install screen package<font></font>
  hosts: "foreman_hostgroup_rhel6"<font></font>
  tasks:<font></font>
  - yum:<font></font>
      name: screen<font></font>
      state: installed<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous avons enregistr√© des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√¥tes: foreman_hostgroup_rhel6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indiquant ainsi la liste des h√¥tes formant le groupe d'h√¥tes rhel6 dans le Satellite. </font><font style="vertical-align: inherit;">Par cons√©quent, le script sera ex√©cut√© uniquement sur ces h√¥tes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, dans le script, vous pouvez sp√©cifier dans la ligne des h√¥tes les variables que Ansible Tower re√ßoit lors de la synchronisation avec Satellite. </font><font style="vertical-align: inherit;">Par exemple, vous pouvez faire ceci:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
- name: Install screen package<font></font>
  hosts: "{{ hosts_var }}"<font></font>
  tasks:<font></font>
  - yum:<font></font>
      name: screen<font></font>
      state: installed<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, nous pourrons modifier le mod√®le de t√¢che dans Ansible Tower √† la vol√©e, en indiquant l'un des groupes d'inventaire via une variable externe.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jr/fe/iu/jrfeiulsq6wqesxwt-e1njpt2mm.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, le mod√®le ne s'ex√©cutera que sur les h√¥tes membres du groupe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rhel7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans Satellite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, le mod√®le de travail peut √™tre configur√© pour qu'au d√©marrage, il demande √† l'utilisateur la valeur de la variable </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hosts_var</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (et en m√™me temps affiche les groupes d'inventaire disponibles sous forme de commentaires):</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/lh/gl/adlhglvneyz5ettasl8vh1z_mag.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©cran ci-dessus illustre la situation o√π, lors du d√©marrage du mod√®le, l'utilisateur est invit√© √† entrer le nom du groupe d'inventaire Satellite sur les h√¥tes duquel vous souhaitez ex√©cuter le script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, vous pouvez utiliser les variables h√¥tes extraites de Satellite pendant la synchronisation. </font><font style="vertical-align: inherit;">Par exemple, voici √† quoi ressemble un script montrant comment r√©f√©rencer ces variables:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
- name: Show Satellite variables<font></font>
  hosts: all<font></font>
  tasks:<font></font>
  - name: Show subscription_status<font></font>
    debug:<font></font>
      msg: &gt;<font></font>
        Subscription Status: {{ foreman.subscription_status_label }}<font></font>
  - name: Show Errata Counts<font></font>
    debug:<font></font>
      msg: &gt;<font></font>
        Bug fixes: {{ foreman.content_facet_attributes.errata_counts.bugfix }},<font></font>
        Security: {{ foreman.content_facet_attributes.errata_counts.security }},<font></font>
        Enhancement: {{ foreman.content_facet_attributes.errata_counts.enhancement }},<font></font>
        Total: {{ foreman.content_facet_attributes.errata_counts.total }}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ex√©cutez ce script dans Ansible Tower, il affichera les valeurs des variables:</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/la/3o/ub/la3oubu_3gdoc2o_tvxhuqycyko.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien s√ªr, ces variables peuvent √™tre utilis√©es dans des constructions conditionnelles quand, de sorte que les t√¢ches ne sont lanc√©es que sous certaines conditions. </font><font style="vertical-align: inherit;">Par exemple, si l'h√¥te ne dispose pas de correctifs de s√©curit√© ou lorsque l'abonnement √† l'h√¥te n'est pas valide.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sumer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Red Hat Satellite et Red Hat Ansible sont eux-m√™mes des outils tr√®s puissants et leur int√©gration offre une synergie tangible. </font><font style="vertical-align: inherit;">Ci-dessus, nous avons montr√© comment faire de Satellite une source de donn√©es pour Dynamic Inventory dans Ansible et l'utiliser dans la pratique.</font></font><br>
‚ÄÉ<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partie 2. Autoconfiguration de nouveaux h√¥tes via le rappel de provisioning</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outre de nombreuses autres fonctionnalit√©s, Satellite est √©galement en mesure d'initialiser les h√¥tes, en d'autres termes, d'effectuer le provisionnement. La tour Ansible, quant √† elle, est con√ßue pour configurer les h√¥tes. L'int√©gration vous permet de vous assurer qu'apr√®s l'initialisation d'un nouvel h√¥te RHEL via Satellite, Ansible Tower se connectera automatiquement √† cet h√¥te et ex√©cutera le script de configuration correspondant sur celui-ci. De toute √©vidence, un tel sch√©ma fait gagner beaucoup de temps aux administrateurs syst√®me, les aidant √† r√©pondre plus rapidement aux besoins de l'organisation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter que ce sch√©ma ne fonctionne que si plusieurs conditions sont remplies. </font><font style="vertical-align: inherit;">Premi√®rement, Satellite devrait √™tre utilis√© comme source de donn√©es d'inventaire dynamique dans Ansible Tower (nous avons couvert ce probl√®me dans la partie pr√©c√©dente). </font><font style="vertical-align: inherit;">Deuxi√®mement, l'initialisation de l'h√¥te doit non seulement √™tre effectu√©e via Satellite, mais √©galement via le m√©canisme du groupe d'h√¥tes (pour plus de d√©tails, voir le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide de provisioning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ci-dessous, nous montrons comment configurer Satellite et Ansible Tower pour qu'apr√®s l'initialisation de l'h√¥te, il ex√©cute automatiquement le script de configuration Ansible.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aper√ßu</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les outils d'automatisation informatique, tels que Ansible Tower, entrent g√©n√©ralement dans l'une des deux cat√©gories suivantes: certains fonctionnent par la m√©thode push, d'autres par la m√©thode pull. Dans les syst√®mes push auxquels Ansible Tower appartient, le serveur d'automatisation √©tablit une connexion avec l'h√¥te. Dans les syst√®mes pull, l'initiateur est l'h√¥te, qui lui-m√™me communique avec le serveur d'automatisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre cas, avec un script automatique sur de nouveaux h√¥tes, un sch√©ma mixte est utilis√©. L'h√¥te nouvellement initialis√© contacte le serveur d'automatisation avec une demande de ¬´rappel¬ª et de configuration. Apr√®s cela, le serveur d'automatisation se connecte √† cet h√¥te et ex√©cute le script de configuration demand√© par l'h√¥te sur celui-ci. Par cons√©quent, dans Ansible Tower, ce m√©canisme est appel√© rappel de provisioning, qui peut √™tre traduit par ¬´rappel d'initialisation¬ª.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour montrer pourquoi le rappel de provisioning est n√©cessaire, consid√©rez la situation suivante: nous avons un certain script de configuration d'h√¥te qui s'ex√©cute quotidiennement √† minuit. Disons qu'√† 8 heures du matin, nous initialisons plusieurs nouveaux serveurs √† la fois via Satellite. Dans le m√™me temps, Satellite est utilis√© comme source de donn√©es d'inventaire dynamique dans Ansible Tower, de sorte que les h√¥tes cr√©√©s tombent automatiquement dans Ansible. Cependant, le prochain lancement du script d'automatisation n'aura lieu qu'√† minuit, c'est-√†-dire apr√®s 16 heures. √âvidemment, c'est loin d'√™tre id√©al, et j'aimerais que le script s'ex√©cute imm√©diatement apr√®s l'initialisation du nouvel h√¥te. Dans ce but, le rappel de provisioning est √©galement pens√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, le rappel de provisioning est configur√© et fonctionne comme suit:</font></font><br>
<br>
<ol>
<li>  Ansible Tower   credential        root,  Satellite           . Tower    ,            .</li>
<li>   Job Template  Ansible Tower   provisioning callback.       URL     Host Config Key,        Ansible. </li>
<li> Satellite      ,       provisioning callback   Ansible Tower,  : URL-  Ansible Tower,  Host Config Key    Ansible.</li>
<li>      Satellite     /etc/systemd/system/ansible-callback.service (  RHEL 7  8;   RHEL 6  ).         provisioning callback   Ansible Tower,  ,     (URL-, Host Config Key   ).</li>
<li>Ansible Tower       Host Config Key.   , Tower       ,      root,    Job Template.   ,      .</li>
</ol><br>
<h4> Ansible Tower  Provisioning Callback</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commen√ßons par cr√©er un script de configuration sur le serveur Ansible Tower qui modifie le contenu de / etc / motd, cr√©e une sorte d'utilisateur et installe un package sp√©cifique. </font><font style="vertical-align: inherit;">Ensuite, nous utiliserons ce script pour configurer de nouveaux h√¥tes imm√©diatement apr√®s leur initialisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la vie r√©elle, les scripts d'automatisation sont probablement stock√©s dans un syst√®me de contr√¥le de version, mais pour simplifier, nous supposons qu'ils se trouvent directement sur le serveur Ansible Tower. </font><font style="vertical-align: inherit;">Par cons√©quent, nous entrons dans le serveur Ansible Tower via SSH et cr√©ons le r√©pertoire / var / lib / awx / projects / provision pour eux en ex√©cutant la commande suivante:</font></font><br>
<br>
<pre><code class="plaintext hljs"># mkdir /var/lib/awx/projects/provision
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous cr√©ons notre script dans ce r√©pertoire, l'appelons provision.yaml et y √©crivons le contenu suivant:</font></font><br>
<br>
<pre><code class="plaintext hljs">---<font></font>
<font></font>
- name: Provision new host<font></font>
<font></font>
  hosts: all<font></font>
<font></font>
  tasks:<font></font>
<font></font>
  - name: Set content in /etc/motd <font></font>
<font></font>
    copy:<font></font>
<font></font>
      content: Authorized use only!<font></font>
<font></font>
      dest: /etc/motd<font></font>
<font></font>
      mode: 644<font></font>
<font></font>
      owner: root<font></font>
<font></font>
      group: root<font></font>
<font></font>
<font></font>
  - name: Create brian user account<font></font>
<font></font>
    user:<font></font>
<font></font>
      name: brian<font></font>
<font></font>
      uid: 10000<font></font>
<font></font>
      state: present<font></font>
<font></font>
<font></font>
  - name: Install tmux package<font></font>
<font></font>
    yum:<font></font>
<font></font>
      name: tmux<font></font>
<font></font>
      state: present<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acc√©dez maintenant √† l'interface Web de Tower et acc√©dez √† l'√©cran des informations d'identification. </font><font style="vertical-align: inherit;">Nous cliquons sur le bouton avec le signe plus vert pour cr√©er un nouvel enregistrement d'informations d'identification, lui donnons le nom provisioning_root et d√©finissons √©galement le type d'informations d'identification comme machine. </font><font style="vertical-align: inherit;">Dans le champ Nom d'utilisateur, √©crivez root et dans le champ Mot de passe, sp√©cifiez le mot de passe sp√©cifi√© dans Satellite pour une utilisation sur les nouveaux h√¥tes du groupe d'h√¥tes correspondant dans Satellite (son nom se trouve dans l'interface Web Satellite sous l'onglet Syst√®me d'exploitation). </font><font style="vertical-align: inherit;">En utilisant cette entr√©e, Ansible Tower pourra se connecter aux nouveaux h√¥tes cr√©√©s lors de l'initialisation via Satellite.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zf/b7/lb/zfb7lbondu4unvzqe-h5ex-2e54.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, dans l'interface Ansible Tower, acc√©dez √† l'√©cran Projets et cliquez sur le signe plus vert pour cr√©er un nouveau projet. </font><font style="vertical-align: inherit;">Appelez-le provision, changez SCM Type en Manual et sp√©cifiez provision comme r√©pertoire Playbook:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/aq/ib/ybaqibhcd2nlts3ysjwzfphdr8w.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, dans l'interface Ansible Tower, acc√©dez √† l'√©cran Mod√®les, cliquez sur le signe plus vert pour cr√©er un nouveau mod√®le de travail. </font><font style="vertical-align: inherit;">Nous l'appellerons provision, dans le champ Inventaire nous √©crirons Satellite, dans le champ Projet - provision, dans le champ Playbook - provision.yaml, et dans le champ Credential - provisioning_root. </font><font style="vertical-align: inherit;">En outre, vous devez activer la case √† cocher Autoriser les rappels de provisionnement et cliquer sur l'ic√¥ne de la baguette magique √† droite du champ Cl√© de configuration de l'h√¥te pour g√©n√©rer une cl√© secr√®te. </font><font style="vertical-align: inherit;">Cette cl√© est n√©cessaire pour demander un rappel de provisionnement. Il ne peut s'agir de personne, mais uniquement de quelqu'un qui conna√Æt la cl√© de configuration de l'h√¥te. </font><font style="vertical-align: inherit;">Sans la bonne cl√©, le serveur Ansible Tower ne r√©pondra tout simplement pas √† la demande.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/mx/lo/f6/mxlof6mxbd8ny0f0wursfzhqdzy.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous devons nous souvenir pour l'avenir de la valeur de la cl√© de configuration de l'h√¥te, ainsi que de l'ID du mod√®le, qui peut √™tre trouv√© √† partir de l'URL de ce mod√®le de travail: </font></font><br>
<br>
<pre><code class="plaintext hljs">https://tower.example.com/#/templates/job_template/11
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, l'ID est 11. </font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration du satellite pour provisionner le rappel</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acc√©dez maintenant √† l'interface Web du satellite, acc√©dez √† l'√©cran Configurer et cliquez sur Groupes d'h√¥tes. </font><font style="vertical-align: inherit;">Nous s√©lectionnons le groupe d'h√¥tes existant, qui est utilis√© lors de l'initialisation de nouveaux h√¥tes, dans notre exemple, c'est RHEL 8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur l'√©cran d'√©dition du groupe d'h√¥tes, allez dans l'onglet Param√®tres et cr√©ez 4 nouveaux param√®tres: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_host_config_key - ici nous entrons la cl√© de configuration de l'h√¥te √† partir de notre mod√®le de tour Ansible. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_job_template_id - ici, nous √©crivons l'ID du mod√®le, que nous avons pr√©c√©demment d√©couvert √† partir de l'URL du mod√®le. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_tower_fqdn est le nom de domaine complet du serveur Ansible Tower. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ansible_tower_provisioning - d√©finie sur true.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/th/ji/m8/thjim8rh06qhbq_gdwhxfc4jlue.png"></div><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rifiez comment tout fonctionne</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, initialisez le nouvel h√¥te depuis Satellite et v√©rifiez que le rappel de provisioning fonctionne et ex√©cute automatiquement notre script sur cet h√¥te. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'interface Web Satellite, acc√©dez √† l'√©cran H√¥tes, cliquez sur Cr√©er un h√¥te et v√©rifiez que le groupe pour lequel nous venons de cr√©er 4 nouveaux param√®tres est utilis√©, c'est-√†-dire le groupe RHEL 8.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/xt/mn/yc/xtmnycjplympck_rrh4lag9l2ts.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois l'initialisation de l'h√¥te termin√©e, nous devons nous assurer que le mod√®le qu'il contient a √©t√© lanc√© avec succ√®s. </font><font style="vertical-align: inherit;">Pour ce faire, acc√©dez √† l'√©cran Mod√®les de l'interface Web d'Ansible Tower, recherchez notre mod√®le dans la liste et voyez si le carr√© le plus √† gauche de son indicateur est devenu vert:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/g2/o-/lkg2o-kj5rtuuotxnvyhnxrcr3e.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous cliquons sur cette case verte pour voir les d√©tails du lancement, qui dans notre cas a r√©ussi. </font><font style="vertical-align: inherit;">Veuillez noter que cette t√¢che a une limite (Limit) - le lancement de nouveaux h√¥tes uniquement cr√©√©s lors de l'initialisation. </font><font style="vertical-align: inherit;">Eh bien, cela n'est pas surprenant, car le m√©canisme de rappel de provisioning ex√©cute uniquement le mod√®le sur les h√¥tes qui le demandent.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/aa/ll/t1/aallt1qykw1g_z9t_hmsujmtqby.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant √† l'h√¥te nouvellement cr√©√© et v√©rifions s'il correspond √† ce qui est √©crit dans le script:</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# rpm -qa | grep tmux<font></font>
tmux-2.7-1.el8.x86_64<font></font>
<font></font>
[root@provision-test-rhel8 ~]# id brian<font></font>
uid=10000(brian) gid=10000(brian) groups=10000(brian)<font></font>
<font></font>
[root@provision-test-rhel8 ~]# cat /etc/motd<font></font>
Authorized use only!<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©pannage</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le mod√®le Ansible Tower ne d√©marre pas automatiquement sur un nouvel h√¥te initialis√© via Satellite, il y a quelques points √† v√©rifier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re √©tape consiste √† savoir si la tour Ansible a re√ßu une demande de rappel d'approvisionnement, comment le script s'est d√©roul√© et s'il a d√©marr√©. Pour ce faire, dans l'interface Tower, acc√©dez √† l'√©cran Mod√®les et regardez la couleur de l'indicateur √† c√¥t√© du nom du mod√®le: vert - le lancement a r√©ussi, rouge - le lancement a √©chou√©.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gc/ra/id/gcraidlrqdznksnzfsryp80qbwk.png"></div><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la case est rouge, nous cliquons dessus et recherchons des informations suppl√©mentaires pour comprendre pourquoi le lancement a √©chou√© (il peut s'agir √† la fois d'erreurs de syntaxe dans le script et d'autres probl√®mes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le carr√© est vert, nous cliquons et regardons quand m√™me, car la t√¢che peut signaler une ex√©cution r√©ussie, mais elle n'a pas r√©ellement d√©marr√© sur notre h√¥te. Par exemple, si la ligne d'h√¥tes dans le script indique des h√¥tes et des groupes sp√©cifiques, mais n'inclut pas les h√¥tes cr√©√©s lors de l'initialisation, la t√¢che signalera le succ√®s, mais les informations suppl√©mentaires indiqueront ¬´ignorer: aucun h√¥te correspondant¬ª.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le carr√© indicateur n'est ni vert ni rouge, vous devez commencer par v√©rifier les param√®tres du groupe d'h√¥tes dans Satellite. Assurez-vous que l'URL du serveur Ansible Tower, la cl√© de configuration de l'h√¥te et l'ID du mod√®le y sont correctement sp√©cifi√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, acc√©dez √† l'h√¥te nouvellement initialis√© et v√©rifiez qu'il existe un fichier /etc/systemd/system/ansible-callback.service (sur les syst√®mes RHEL 7 ou 8) ou un fichier /root/ansible_provisioning_call.sh (RHEL 6). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le fichier n'existe pas, v√©rifiez que le param√®tre ansible_tower_provisioning est d√©fini sur true pour ce groupe d'h√¥tes et que les mod√®les d'initialisation sur le serveur Satellite n'ont pas √©t√© modifi√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le fichier /etc/systemd/system/ansible-callback.service est pr√©sent sur l'h√¥te, ouvrez-le et recherchez l'URL o√π la demande de rappel de provisioning est envoy√©e:</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# cat /etc/systemd/system/ansible-callback.service<font></font>
[Unit]<font></font>
Description=Provisioning callback to Ansible Tower<font></font>
Wants=network-online.target<font></font>
After=network-online.target<font></font>
<font></font>
[Service]<font></font>
Type=oneshot<font></font>
ExecStart=/usr/bin/curl -k -s --data "host_config_key=aa5ebe82-491c-4fbb-bd36-a6657549451e" https://tower.example.com/api/v2/job_templates/11/callback/<font></font>
ExecStartPost=/usr/bin/systemctl disable ansible-callback<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez ex√©cuter curl et dupliquer manuellement les commandes sp√©cifi√©es dans ce fichier pour lancer manuellement un rappel de provisioning:</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k -s --data "host_config_key=aa5ebe82-491c-4fbb-bd36-a6657549451e" https://tower.example.com/api/v2/job_templates/11/callback/
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si une cl√© de configuration d'h√¥te non valide est sp√©cifi√©e, nous recevrons le message d'erreur suivant:</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k -s --data "host_config_key=wrong-key-here" https://tower.example.com/api/v2/job_templates/11/callback/<font></font>
<font></font>
{"detail":"You do not have permission to perform this action."}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si l'ID du mod√®le n'est pas sp√©cifi√© correctement (ici - 43 au lieu de 11), la r√©ponse sera la suivante:</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k -s --data "host_config_key=wrong-key-here" https://tower.example.com/api/v2/job_templates/43/callback/<font></font>
<font></font>
{"detail":"Not found."}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez √©galement d√©sactiver le mode silencieux (-s) dans la commande curl afin qu'il affiche les erreurs li√©es √† la r√©solution du nom d'h√¥te, comme dans l'exemple ci-dessous, o√π nous avons remplac√© le bon nom ansible.example.com par le mauvais ansible-tower.example.com :</font></font><br>
<br>
<pre><code class="plaintext hljs">[root@provision-test-rhel8 ~]# /usr/bin/curl -k  --data "host_config_key=wrong-key-here" https://ansible-tower.example.com/api/v2/job_templates/11/callback/<font></font>
<font></font>
curl: (6) Could not resolve host: ansible-tower.example.com<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, lors de la recherche de la cause de l'erreur, le fichier /var/log/tower/tower.log sur le serveur Ansible Tower peut s'av√©rer utile. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, ce fichier enregistre l'utilisation d'une cl√© de configuration d'h√¥te non valide:</font></font><br>
<br>
<pre><code class="plaintext hljs">2019-11-19 23:19:17,371 WARNING  awx.api.generics status 403 received by user AnonymousUser attempting to access /api/v2/job_templates/11/callback/ from 192.168.0.138
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela corrige √©galement l'utilisation d'un ID de mod√®le non valide:</font></font><br>
<br>
<pre><code class="plaintext hljs">2019-11-19 23:19:49,093 WARNING  awx.api.generics status 404 received by user AnonymousUser attempting to access /api/v2/job_templates/43/callback/ from 192.168.0.138<font></font>
<font></font>
2019-11-19 23:19:49,095 WARNING  django.request Not Found: /api/v2/job_templates/43/callback/<font></font>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©sumer</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'int√©gration de Satellite et d'Ansible Tower peut grandement optimiser l'initialisation et la configuration de nouveaux h√¥tes, ce qui fait gagner beaucoup de temps aux administrateurs syst√®me, les aidant √† r√©pondre plus rapidement aux besoins de l'organisation. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le 24 mars, de 11h00 √† 12h30, Red Hat tiendra un webinaire ¬´Ce que vous devez savoir sur l'automatisation: comp√©tences de base possibles¬ª L'</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
automatisation est un sujet qui approche en popularit√© et en nombre de demandes de transformation num√©rique. Nous vous parlerons de notre vision de l'automatisation - avec Ansible et Ansible Tower - et ce seront les informations de base qui vous ouvriront la porte au nouveau monde courageux des outils d'automatisation d√©claratifs.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s ce webinaire, vous comprendrez les entit√©s de base Ansible, telles que le playbook, l'inventaire, le module. </font><font style="vertical-align: inherit;">Avec vous, nous ma√Ætriserons la syntaxe YAML de base afin que vous puissiez √©crire vos propres scripts. </font><font style="vertical-align: inherit;">Il envisagera √©galement le lancement de scripts et l'augmentation des privil√®ges. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, vous obtiendrez un ensemble de comp√©tences de base qui vous permettront d'√©tudier avec succ√®s la documentation et d'autres documents sans le sentiment constant que vous manquez quelque chose. </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inscrivez-vous</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et venez!</font></font></b></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr491122/index.html">Analyse judiciaire des sauvegardes HiSuite</a></li>
<li><a href="../fr491130/index.html">Caract√©ristiques √† retenir</a></li>
<li><a href="../fr491132/index.html">Lorsque le filtre bloom ne rentre pas</a></li>
<li><a href="../fr491134/index.html">5 √©tapes d'in√©vitabilit√© de l'adoption de la certification ISO / IEC 27001. N√©gation</a></li>
<li><a href="../fr491136/index.html">Projection de contenu dans une documentation angulaire ou √† contenu ng perdu</a></li>
<li><a href="../fr491146/index.html">UML pour les d√©veloppeurs</a></li>
<li><a href="../fr491150/index.html">Comment j'ai pirat√© les escrocs, ou tout simplement l'int√©rieur des panneaux de phishing</a></li>
<li><a href="../fr491154/index.html">Recherche de cours: comment construire un parcours d'apprentissage</a></li>
<li><a href="../fr491156/index.html">Empathie mesurable: pr√©dire la sympathie pour l'IRM c√©r√©brale</a></li>
<li><a href="../fr491162/index.html">PostgreSQL Antipatterns: un conte sur le raffinement it√©ratif d'une recherche par nom, ou ¬´aller-retour d'optimisation¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>