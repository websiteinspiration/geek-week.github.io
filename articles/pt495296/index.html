<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öìÔ∏è ü§∂üèø üö£üèæ Forense, inje√ß√£o de SQL e gato sofredor: an√°lise da tarefa n¬∫ 3 do est√°gio online NeoQUEST-2020 üë®üèª‚Äç‚öïÔ∏è üéÖ üëèüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje consideraremos a tarefa mais controversa do NeoQUEST-2020 : sua primeira parte √© uma campe√£ no n√∫mero de participantes que a aprovaram, e a segun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Forense, inje√ß√£o de SQL e gato sofredor: an√°lise da tarefa n¬∫ 3 do est√°gio online NeoQUEST-2020</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neobit/blog/495296/"><img src="https://habrastorage.org/webt/gd/oc/8f/gdoc8fvxf7oimhxlgxvmijvuwmk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje consideraremos a tarefa mais controversa do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : sua primeira parte √© uma campe√£ no n√∫mero de participantes que a aprovaram, e a segunda parte obedeceu apenas a alguns. </font><font style="vertical-align: inherit;">O que h√° de t√£o especial sobre ele? </font><font style="vertical-align: inherit;">Entenda o corte!</font></font><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ j√° teve que investigar um despejo de RAM? Voc√™ sabe quantas coisas interessantes voc√™ pode obter de l√°? (spoiler: tudo, incluindo os resultados da execu√ß√£o de scripts, fotos recentes e o hist√≥rico do navegador). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E as inje√ß√µes ex√≥ticas de SQL? Voc√™ envia uma determinada foto para o site e recebe informa√ß√µes de um banco de dados fechado - isso n√£o √© um crime ideal? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na primeira parte do artigo, consideraremos as ferramentas para analisar o despejo de mem√≥ria e aprenderemos como extrair as informa√ß√µes necess√°rias, e na segunda parte do artigo mostraremos claramente o processo de manipula√ß√£o de tags de imagem para uma inje√ß√£o complicada :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a tarefa √© fazer o download do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo morto.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que cont√©m um arquivo bin√°rio de 1 GB com o nome falante memdump.bin, com base no qual podemos assumir que este √© um despejo de RAM. Usaremos a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estrutura de volatilidade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para sua pesquisa </font><font style="vertical-align: inherit;">. O Volatility suporta v√°rios plugins que facilitam a pesquisa e a extra√ß√£o do despejo de v√°rias informa√ß√µes √∫teis para </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chantagear um</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analista. Primeiro, use o comando imageinfo e obtenha informa√ß√µes sobre o dump:</font></font><br>
<cut></cut><br>
<img src="https://habrastorage.org/webt/8b/po/2n/8bpo2nbfia9ykmdpqohz8zt4w0a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A julgar pela sa√≠da do comando imageinfo, estamos lidando com um despejo de mem√≥ria do Windows 7. A seguir, veremos a lista de processos em execu√ß√£o no sistema no momento em que o despejo foi removido usando o comando pslist: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ja/1n/py/ja1npywtltvjjnzwwhbs7mkk1ho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta lista, voc√™ pode ver v√°rios processos interessantes. Vamos come√ßar o estudo com o processo chrome.exe - voc√™ sempre pode encontrar algo intrigante no navegador. Existem plugins adicionais para volatilidade que automatizam a extra√ß√£o de informa√ß√µes dos processos. Por exemplo, o plugin </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chromehistory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos permitir√° extrair um hist√≥rico de visitas do navegador de um despejo de RAM: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/oo/o7/lxooo7skzcqwcxf-hw_njv5rmdk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na hist√≥ria do chrome, v√°rias coisas interessantes podem ser notadas ao mesmo tempo. Primeiro, um link </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a segunda parte da tarefa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bem como consultas de pesquisa sobre metadados em imagens PNG, que tamb√©m s√£o uma dica para a segunda parte, mas veremos mais adiante. No est√°gio atual, estamos interessados ‚Äã‚Äãem solicitar um c√≥digo promocional </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para um desconto</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no site e em arquivos pdf, o que indica o objeto de novas pesquisas (a execu√ß√£o do Acrobat Reader`a tamb√©m pode nos solicitar isso). Vamos tentar encontrar documentos PDF em um despejo usando o comando filescan: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/ro/qk/sbroqkdf1jetkddyzac1rhasqh0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Boa sorte! Parece que h√° algum promo.pdf no despejo. Vamos tentar pux√°-lo usando o comando dumpfiles:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-w/gn/iz/-wgnizdzvl_kszkhof-z1bldwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse est√°gio, pequenas dificuldades podem surgir devido ao fato de que alguns visualizadores de documentos em PDF podem n√£o reconhecer o arquivo extra√≠do (voc√™ s√≥ precisa excluir os bytes extras no final do arquivo). Mas estamos realmente com medo de alguns bytes extras? :) No final, abra o documento e veja o c√≥digo QR, depois de ler o que recebemos a bandeira da primeira parte da tarefa (e ao mesmo tempo o c√≥digo promocional para receber um presente da equipe NeoQUEST - oferecemos pr√™mios memor√°veis todos os participantes que conclu√≠ram pelo menos uma tarefa!).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/84/od/xp84odjm5frx774wqy9ka75rjws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, tente obter a segunda bandeira. Voltamos ao site, cujo link foi encontrado no hist√≥rico do navegador. Para acessar o site, voc√™ precisa inserir um c√≥digo promocional. Recordamos o hist√≥rico de pesquisa no navegador e a descri√ß√£o do pr√≥prio documento (USE ISTO PARA ADERIR), a partir do qual podemos assumir que o primeiro sinalizador √© o c√≥digo promocional de que precisamos. Entramos no campo e chegamos ao site onde √© oferecido o upload de uma foto: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n9/kb/vu/n9kbvuleozzylxcgoa2hxy5trhq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
julgar pela frequ√™ncia com que o site congela, nossos participantes decidiram verificar experimentalmente o carregamento de todos os tipos poss√≠veis de documentos. Depois de um certo per√≠odo de tempo, entendemos que apenas imagens PNG podem ser carregadas no site. O pr√≥ximo quebra-cabe√ßa √© a mensagem ‚ÄúN√£o h√° dados suficientes para armazenar esta imagem, desculpe!‚Äù, O que ocorre quando voc√™ tenta fazer upload de uma imagem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltando ao hist√≥rico do navegador, lembramos sobre solicita√ß√µes do formul√°rio "adicionar metadados ao arquivo png". Usando infer√™ncias simples, conclu√≠mos que, provavelmente, certos valores devem ser inseridos nos metadados para fazer upload de uma imagem em um site. Voc√™ pode come√ßar explorando o formato PNG (para obter uma descri√ß√£o, por exemplo, clique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Primeiro, verifique a lista de palavras-chave padr√£o para imagens PNG de metadados, por exemplo: "Autor", "Descri√ß√£o" etc. Usando, por exemplo, o utilit√°rio de convers√£o do conjunto ImageMagick, adicione metadados √† imagem de teste: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
convert test.png -set 'Title' '1' -set 'Author' '2' -set 'Description' '3' -set 'Copyright' '4 '-set' Tempo de cria√ß√£o '' 5 '-set' Software '' 6 '-set' Isen√ß√£o de responsabilidade '' 7 '-set 'Warning' '8' -set 'Source' '9' -set 'Comment' '0' out.png</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentamos fazer upload da imagem resultante para o site e obter o sucesso: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/7o/pw/sa7opwndturwyzaqse9f4qah83g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que os campos de metadados necess√°rios s√£o T√≠tulo, Descri√ß√£o, Autor e Direitos autorais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, uma dica para isso tamb√©m pode ser encontrada no despejo de mem√≥ria: voc√™ pode encontrar a men√ß√£o do arquivo mr_cat.png usando volatilidade. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/bw/cn/ixbwcn3pzw3ndqxlbnfb6btadyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossos participantes decidiram que era com a ajuda do Sr. Cat que era necess√°rio injetar o site (muitas mensagens chegaram ao nosso correio com o Sr. Gato em uma </font><font style="vertical-align: inherit;">apar√™ncia </font><font style="vertical-align: inherit;">comprimida, invertida, refletida e outras </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">feias</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mas o gato n√£o tinha nada a ver com isso! Ele simplesmente distrai e sugere aos participantes: bem, olhe para mim, h√° algo interessante por dentro! Dentro da lixeira, a imagem foi preservada apenas parcialmente; no entanto, em seus res√≠duos, √© poss√≠vel observar os campos de metadados preenchidos necess√°rios:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/4h/0o/zv4h0ogsh94higmrsqslbzbxzby.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V√° em frente: agora podemos fazer upload de arquivos para o site; no entanto, o que d√° e como procurar uma bandeira? √â l√≥gico supor que, uma vez que os metadados sejam necess√°rios para o download, √© poss√≠vel que eles sejam usados ‚Äã‚Äãde alguma forma para armazenar arquivos baixados (por exemplo, como chaves em um banco de dados). Viva! Estamos nos aproximando da sobremesa: precisamos verificar o site quanto √† possibilidade de inje√ß√£o de SQL. Descobrimos que, se um dos par√¢metros for substitu√≠do por aspas duplas ("), o site notificar√° um erro em vez de carregar a imagem:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/s2/bf/f7s2bfigyph9mkfj9jfg6wfxhxc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, vemos a pr√≥pria consulta SQL e entendemos quais campos podemos operar para construir uma inje√ß√£o para extrair dados do banco de dados usado. Quanto √† localiza√ß√£o do sinalizador, neste caso, √© l√≥gico verificar a primeira imagem que foi carregada no banco de dados. Al√©m disso, durante a opera√ß√£o de inje√ß√£o, voc√™ deve prestar aten√ß√£o ao fato de que INSERT √© executado na solicita√ß√£o. Isso nos for√ßa a construir consultas espec√≠ficas porque √© imposs√≠vel executar explicitamente uma opera√ß√£o SELECT da mesma tabela na qual estamos inserindo ao mesmo tempo que a opera√ß√£o de inser√ß√£o (INSERT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos fazer uma solicita√ß√£o com a qual extra√≠mos a Descri√ß√£o da primeira imagem no banco de dados:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
converter test1.png -set 'Title' '1' -set 'Author' '", (SELECT description FROM (imagem SELECT * FROM) AS x limite 0,1)) - -' -set 'Descri√ß√£o' '3' - set 'Copyright' '4' test.png </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Carregue a imagem resultante no site e obtenha a descri√ß√£o no campo Copyright, que √© uma bandeira: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/k8/6x/vzk86xyosytdwsvc9orcwkypybi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hurrah, tarefa conclu√≠da! Esperamos convencer a todos a verificar novamente a entrada do usu√°rio pela milion√©sima vez e tamb√©m mant√™-la segura olho no olho de criar uma reserva de mem√≥ria RAM :) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Termine o artigo com uma cita√ß√£o dos grandes s√°bios:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qg/9i/un/qg9iunp8zncqovjy3_qg990lmlc.png"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495280/index.html">Patrulha m√°xima SIEM. Vis√£o geral do sistema de gerenciamento de eventos de seguran√ßa da informa√ß√£o</a></li>
<li><a href="../pt495282/index.html">Valida√ß√£o de XML usando XSD, JAXB e Spring Framework</a></li>
<li><a href="../pt495290/index.html">Explorando a qualidade do c√≥digo do sistema operacional Zephyr</a></li>
<li><a href="../pt495292/index.html">Vers√£o InterSystems IRIS 2020.1</a></li>
<li><a href="../pt495294/index.html">Macros para um pythonist. Relat√≥rio Yandex</a></li>
<li><a href="../pt495298/index.html">Avalie as op√ß√µes de Monte Carlo Clojure</a></li>
<li><a href="../pt495302/index.html">Como aumentar as vendas 2,5 vezes em 4 meses em uma loja online - um caso de promo√ß√£o de SEO</a></li>
<li><a href="../pt495304/index.html">Rejuvenescimento das c√©lulas humanas devido √† sua reprograma√ß√£o</a></li>
<li><a href="../pt495308/index.html">Rake no caminho para se manter vivo</a></li>
<li><a href="../pt495310/index.html">Guia eletr√¥nico: biometria e multi-formato</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>