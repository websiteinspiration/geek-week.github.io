<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚓️ 🤶🏿 🚣🏾 Forense, injeção de SQL e gato sofredor: análise da tarefa nº 3 do estágio online NeoQUEST-2020 👨🏻‍⚕️ 🎅 👏🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje consideraremos a tarefa mais controversa do NeoQUEST-2020 : sua primeira parte é uma campeã no número de participantes que a aprovaram, e a segun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Forense, injeção de SQL e gato sofredor: análise da tarefa nº 3 do estágio online NeoQUEST-2020</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neobit/blog/495296/"><img src="https://habrastorage.org/webt/gd/oc/8f/gdoc8fvxf7oimhxlgxvmijvuwmk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoje consideraremos a tarefa mais controversa do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2020</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : sua primeira parte é uma campeã no número de participantes que a aprovaram, e a segunda parte obedeceu apenas a alguns. </font><font style="vertical-align: inherit;">O que há de tão especial sobre ele? </font><font style="vertical-align: inherit;">Entenda o corte!</font></font><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você já teve que investigar um despejo de RAM? Você sabe quantas coisas interessantes você pode obter de lá? (spoiler: tudo, incluindo os resultados da execução de scripts, fotos recentes e o histórico do navegador). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E as injeções exóticas de SQL? Você envia uma determinada foto para o site e recebe informações de um banco de dados fechado - isso não é um crime ideal? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na primeira parte do artigo, consideraremos as ferramentas para analisar o despejo de memória e aprenderemos como extrair as informações necessárias, e na segunda parte do artigo mostraremos claramente o processo de manipulação de tags de imagem para uma injeção complicada :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a tarefa é fazer o download do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquivo morto.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que contém um arquivo binário de 1 GB com o nome falante memdump.bin, com base no qual podemos assumir que este é um despejo de RAM. Usaremos a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estrutura de volatilidade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para sua pesquisa </font><font style="vertical-align: inherit;">. O Volatility suporta vários plugins que facilitam a pesquisa e a extração do despejo de várias informações úteis para </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chantagear um</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analista. Primeiro, use o comando imageinfo e obtenha informações sobre o dump:</font></font><br>
<cut></cut><br>
<img src="https://habrastorage.org/webt/8b/po/2n/8bpo2nbfia9ykmdpqohz8zt4w0a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A julgar pela saída do comando imageinfo, estamos lidando com um despejo de memória do Windows 7. A seguir, veremos a lista de processos em execução no sistema no momento em que o despejo foi removido usando o comando pslist: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ja/1n/py/ja1npywtltvjjnzwwhbs7mkk1ho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesta lista, você pode ver vários processos interessantes. Vamos começar o estudo com o processo chrome.exe - você sempre pode encontrar algo intrigante no navegador. Existem plugins adicionais para volatilidade que automatizam a extração de informações dos processos. Por exemplo, o plugin </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chromehistory</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos permitirá extrair um histórico de visitas do navegador de um despejo de RAM: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/oo/o7/lxooo7skzcqwcxf-hw_njv5rmdk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na história do chrome, várias coisas interessantes podem ser notadas ao mesmo tempo. Primeiro, um link </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a segunda parte da tarefa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, bem como consultas de pesquisa sobre metadados em imagens PNG, que também são uma dica para a segunda parte, mas veremos mais adiante. No estágio atual, estamos interessados ​​em solicitar um código promocional </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para um desconto</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no site e em arquivos pdf, o que indica o objeto de novas pesquisas (a execução do Acrobat Reader`a também pode nos solicitar isso). Vamos tentar encontrar documentos PDF em um despejo usando o comando filescan: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/ro/qk/sbroqkdf1jetkddyzac1rhasqh0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Boa sorte! Parece que há algum promo.pdf no despejo. Vamos tentar puxá-lo usando o comando dumpfiles:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-w/gn/iz/-wgnizdzvl_kszkhof-z1bldwxu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse estágio, pequenas dificuldades podem surgir devido ao fato de que alguns visualizadores de documentos em PDF podem não reconhecer o arquivo extraído (você só precisa excluir os bytes extras no final do arquivo). Mas estamos realmente com medo de alguns bytes extras? :) No final, abra o documento e veja o código QR, depois de ler o que recebemos a bandeira da primeira parte da tarefa (e ao mesmo tempo o código promocional para receber um presente da equipe NeoQUEST - oferecemos prêmios memoráveis todos os participantes que concluíram pelo menos uma tarefa!).</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xp/84/od/xp84odjm5frx774wqy9ka75rjws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, tente obter a segunda bandeira. Voltamos ao site, cujo link foi encontrado no histórico do navegador. Para acessar o site, você precisa inserir um código promocional. Recordamos o histórico de pesquisa no navegador e a descrição do próprio documento (USE ISTO PARA ADERIR), a partir do qual podemos assumir que o primeiro sinalizador é o código promocional de que precisamos. Entramos no campo e chegamos ao site onde é oferecido o upload de uma foto: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n9/kb/vu/n9kbvuleozzylxcgoa2hxy5trhq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
julgar pela frequência com que o site congela, nossos participantes decidiram verificar experimentalmente o carregamento de todos os tipos possíveis de documentos. Depois de um certo período de tempo, entendemos que apenas imagens PNG podem ser carregadas no site. O próximo quebra-cabeça é a mensagem “Não há dados suficientes para armazenar esta imagem, desculpe!”, O que ocorre quando você tenta fazer upload de uma imagem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltando ao histórico do navegador, lembramos sobre solicitações do formulário "adicionar metadados ao arquivo png". Usando inferências simples, concluímos que, provavelmente, certos valores devem ser inseridos nos metadados para fazer upload de uma imagem em um site. Você pode começar explorando o formato PNG (para obter uma descrição, por exemplo, clique </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Primeiro, verifique a lista de palavras-chave padrão para imagens PNG de metadados, por exemplo: "Autor", "Descrição" etc. Usando, por exemplo, o utilitário de conversão do conjunto ImageMagick, adicione metadados à imagem de teste: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
convert test.png -set 'Title' '1' -set 'Author' '2' -set 'Description' '3' -set 'Copyright' '4 '-set' Tempo de criação '' 5 '-set' Software '' 6 '-set' Isenção de responsabilidade '' 7 '-set 'Warning' '8' -set 'Source' '9' -set 'Comment' '0' out.png</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentamos fazer upload da imagem resultante para o site e obter o sucesso: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/7o/pw/sa7opwndturwyzaqse9f4qah83g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que os campos de metadados necessários são Título, Descrição, Autor e Direitos autorais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A propósito, uma dica para isso também pode ser encontrada no despejo de memória: você pode encontrar a menção do arquivo mr_cat.png usando volatilidade. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ix/bw/cn/ixbwcn3pzw3ndqxlbnfb6btadyk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossos participantes decidiram que era com a ajuda do Sr. Cat que era necessário injetar o site (muitas mensagens chegaram ao nosso correio com o Sr. Gato em uma </font><font style="vertical-align: inherit;">aparência </font><font style="vertical-align: inherit;">comprimida, invertida, refletida e outras </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">feias</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), mas o gato não tinha nada a ver com isso! Ele simplesmente distrai e sugere aos participantes: bem, olhe para mim, há algo interessante por dentro! Dentro da lixeira, a imagem foi preservada apenas parcialmente; no entanto, em seus resíduos, é possível observar os campos de metadados preenchidos necessários:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/4h/0o/zv4h0ogsh94higmrsqslbzbxzby.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vá em frente: agora podemos fazer upload de arquivos para o site; no entanto, o que dá e como procurar uma bandeira? É lógico supor que, uma vez que os metadados sejam necessários para o download, é possível que eles sejam usados ​​de alguma forma para armazenar arquivos baixados (por exemplo, como chaves em um banco de dados). Viva! Estamos nos aproximando da sobremesa: precisamos verificar o site quanto à possibilidade de injeção de SQL. Descobrimos que, se um dos parâmetros for substituído por aspas duplas ("), o site notificará um erro em vez de carregar a imagem:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/s2/bf/f7s2bfigyph9mkfj9jfg6wfxhxc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, vemos a própria consulta SQL e entendemos quais campos podemos operar para construir uma injeção para extrair dados do banco de dados usado. Quanto à localização do sinalizador, neste caso, é lógico verificar a primeira imagem que foi carregada no banco de dados. Além disso, durante a operação de injeção, você deve prestar atenção ao fato de que INSERT é executado na solicitação. Isso nos força a construir consultas específicas porque é impossível executar explicitamente uma operação SELECT da mesma tabela na qual estamos inserindo ao mesmo tempo que a operação de inserção (INSERT). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos fazer uma solicitação com a qual extraímos a Descrição da primeira imagem no banco de dados:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
converter test1.png -set 'Title' '1' -set 'Author' '", (SELECT description FROM (imagem SELECT * FROM) AS x limite 0,1)) - -' -set 'Descrição' '3' - set 'Copyright' '4' test.png </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Carregue a imagem resultante no site e obtenha a descrição no campo Copyright, que é uma bandeira: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/k8/6x/vzk86xyosytdwsvc9orcwkypybi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hurrah, tarefa concluída! Esperamos convencer a todos a verificar novamente a entrada do usuário pela milionésima vez e também mantê-la segura olho no olho de criar uma reserva de memória RAM :) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Termine o artigo com uma citação dos grandes sábios:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qg/9i/un/qg9iunp8zncqovjy3_qg990lmlc.png"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495280/index.html">Patrulha máxima SIEM. Visão geral do sistema de gerenciamento de eventos de segurança da informação</a></li>
<li><a href="../pt495282/index.html">Validação de XML usando XSD, JAXB e Spring Framework</a></li>
<li><a href="../pt495290/index.html">Explorando a qualidade do código do sistema operacional Zephyr</a></li>
<li><a href="../pt495292/index.html">Versão InterSystems IRIS 2020.1</a></li>
<li><a href="../pt495294/index.html">Macros para um pythonist. Relatório Yandex</a></li>
<li><a href="../pt495298/index.html">Avalie as opções de Monte Carlo Clojure</a></li>
<li><a href="../pt495302/index.html">Como aumentar as vendas 2,5 vezes em 4 meses em uma loja online - um caso de promoção de SEO</a></li>
<li><a href="../pt495304/index.html">Rejuvenescimento das células humanas devido à sua reprogramação</a></li>
<li><a href="../pt495308/index.html">Rake no caminho para se manter vivo</a></li>
<li><a href="../pt495310/index.html">Guia eletrônico: biometria e multi-formato</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>