<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•ºğŸ½ ğŸ—» ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ» Sistem penyiraman taman otomatis untuk Home Assistant, ESP8266 dan MiFlora ğŸ—ï¸ ğŸ’‚ âš—ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa waktu yang lalu keluarga saya memiliki rumah dengan taman kecil di tempat yang sangat hangat dan gersang, dan kami menghadapi masalah penyira...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sistem penyiraman taman otomatis untuk Home Assistant, ESP8266 dan MiFlora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497606/"><img src="https://habrastorage.org/webt/87/-y/wi/87-ywilifgui1kkhe06izsbt7ag.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa waktu yang lalu keluarga saya memiliki rumah dengan taman kecil di tempat yang sangat hangat dan gersang, dan kami menghadapi masalah penyiraman secara teratur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin sistem irigasi otomatis, sementara memilihnya saya harus mempertimbangkan kondisi berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> air yang sangat mahal yang harus dihemat dengan semua cara yang tersedia </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berbagai tanaman di kebun untuk kebutuhan kelembaban, dari sukulen hingga yang menyukai kelembaban</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kebutuhan untuk penyiraman sepenuhnya otonom selama tidak adanya orang di rumah, lebih disukai dengan kemungkinan remote control </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> iklim kering yang tidak memaafkan kesalahan irigasi</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah mengevaluasi solusi siap pakai yang ditemukan di jaringan DIY lokal dan di Amazon serta membaca ulasan tentang keandalannya (biasanya bukan yang tertinggi), kami memutuskan untuk mencoba melakukan sesuatu sendiri. </font></font><br>
<a name="habracut"></a><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penafian: Penulis bukan spesialis IT, dan tidak mengklaim sebagai pengetahuan profesional tentang topik tersebut. </font><font style="vertical-align: inherit;">Tingkat pelaksanaan proyek adalah hobi. </font><font style="vertical-align: inherit;">Penulis sangat menyadari tingkat pengetahuannya dalam pemrograman dan elektronik dan akan sangat menghargai saran untuk meningkatkan dan mengoptimalkan solusi yang digunakan.</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagram sirkuit</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Taman itu dibagi menjadi 4 zona irigasi, masing-masing dilengkapi dengan sensor kelembaban tanah individu dan dapat disiram sesuai dengan jadwal individu dan jumlah air yang berbeda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di tanah, pipa PND-irigasi tetes dengan perforasi diletakkan, yang terhubung ke pipa yang berkumpul di unit pengumpul air dan terhubung melalui katup elektromagnetik ke pasokan air. </font><font style="vertical-align: inherit;">Katup dikendalikan oleh relay yang terhubung ke ESP8266 (Sonoff 4Ch). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penyiraman dilakukan oleh timer, pada malam hari, untuk meningkatkan jumlah air yang diserap ke tanah dan tidak akan diuapkan oleh matahari. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada waktu penyiraman yang dijadwalkan, kepatuhan terhadap beberapa kondisi diperiksa:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kelembaban tanah di bawah nilai yang telah ditentukan </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak ada perkiraan curah hujan dalam jumlah yang cukup besar untuk 2 hari ke depan </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batas air untuk irigasi yang ditetapkan untuk saluran ini tidak terlampaui</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peralatan bekas</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pie Raspberry</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan HassIO terinstal (sudah memiliki) </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP32 DevKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sebuah firmware ESPHome, bertindak sebagai gateway bluetooth untuk MiFlora dan menerima data dari sensor kelembaban kabel. </font><font style="vertical-align: inherit;">Terletak di taman </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sensor kabel berkabel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Capacitive Soil Moisture Sensor v1.2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengukur kelembaban di zona penyiraman terdekat dengan lokasi instalasi ESP32. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MiFlora </font><font style="vertical-align: inherit;">terhubung ke ESP32 melalui BLE, yang mengukur kelembaban di zona penyiraman jarak jauh. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SONOFF 4Ch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dijahit dengan ESPHome, terletak di unit pengambilan air, di mana pipa dari semua zona air datang </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 katup solenoid yang biasanya tertutup untuk 220V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terletak di tempat air dan terhubung ke Sonoff 4Ch. Buka pasokan air untuk irigasi. Model yang biasanya tertutup ditutup sehingga kemungkinan "banjir" jika terjadi kegagalan listrik dan elektronik minimal, dan untuk meminimalkan jumlah output relai yang diperlukan. </font><font style="vertical-align: inherit;">Meteran </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">air berdenyut</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di pintu masuk ke sistem irigasi di unit pemasukan air dan terhubung ke Sonoff 4ch. Diizinkan untuk sepenuhnya mentransfer data aliran air ke Home Asssistant dan mengimplementasikan fungsi irigasi dengan jumlah tertentu. Ternyata menjadi sangat sukses bahwa pada versi sonoff ini kontak untuk firmware sudah disolder dan bahkan ada satu GPIO02 gratis - penghitung pulsa digantung di atasnya.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/zz/d9/eczzd9zfq4drf8katpm4ofyn0b4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sepertinya kolektor dengan katup yang dipasang dan meter air. </font><font style="vertical-align: inherit;">Kontroler (sonoff 4Ch) tidak masuk ke dalam bingkai, itu dipasang pada jarak setengah meter di perisai IP65</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESPHome dan Pengaturan Home Assistant</font></font></h3><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonoff 4ch</font></font></b><div class="spoiler_text"> ESPHome    ,     :<br>
<br>
<pre><code class="xml hljs">switch:<font></font>
  - platform: gpio<font></font>
    name: "   1"<font></font>
    pin: GPIO12<font></font>
    id: sw1<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   2"<font></font>
    pin: GPIO5<font></font>
    id: sw2<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   3"<font></font>
    pin: GPIO4<font></font>
    id: sw3<font></font>
    icon: mdi:water<font></font>
  - platform: gpio<font></font>
    name: "   4"<font></font>
    pin: GPIO15<font></font>
    id: sw4<font></font>
    icon: mdi:water<font></font>
binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: button<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor Kelembaban Tanah Kapasitif v1.2</font></font></b><div class="spoiler_text">   ESPHome:<br>
<br>
<pre><code class="xml hljs">sensor:<font></font>
  - platform: adc<font></font>
    pin: GPIO34<font></font>
    filters:<font></font>
      - lambda: |-<font></font>
          if (x &gt; 3.22) {<font></font>
            return 0;<font></font>
          } else if (x <span class="hljs-tag">&lt; <span class="hljs-attr">1.65</span>) {
            <span class="hljs-attr">return</span> <span class="hljs-attr">100</span>;
          } <span class="hljs-attr">else</span> {
            <span class="hljs-attr">return</span> (<span class="hljs-attr">3.22-x</span>) / (<span class="hljs-attr">3.22-1.65</span>) * <span class="hljs-attr">100.0</span>;
          }
    <span class="hljs-attr">name:</span> "   <span class="hljs-attr">1</span>  "
    <span class="hljs-attr">update_interval:</span> <span class="hljs-attr">60s</span>
    <span class="hljs-attr">attenuation:</span> <span class="hljs-attr">11db</span>
    <span class="hljs-attr">unit_of_measurement:</span> "%"
    <span class="hljs-attr">accuracy_decimals:</span> <span class="hljs-attr">0</span>
    <span class="hljs-attr">icon:</span> <span class="hljs-attr">mdi:water-percent</span>
</span></code></pre><br>
       (ADC)  <br>
  ,        (   3.22 )     (1,65 ).      log'   ESPHome  HassIO            .<br>
<br>
<img src="https://habrastorage.org/webt/sb/tf/b4/sbtfb4ckgxx7kltxe6kk8a5q0r4.png"><br>
<br>
  ESP32  Home Assistant    ,         <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meteran Air pulsa</font></font></b><div class="spoiler_text">   Â«Â»,          (   ).       â€”      ,   ,        (  â€”  3   10 ). <br>
,      GND    GPIO      .<br>
<br>
  ESPHome   : <br>
<br>
<pre><code class="xml hljs">binary_sensor:<font></font>
  - platform: gpio<font></font>
    name: "WaterCounter"<font></font>
    id: counter<font></font>
    pin:<font></font>
      number: GPIO2<font></font>
      mode: INPUT_PULLUP<font></font>
</code></pre><br>
 Home Assistant   :<br>
<br>
     (counter),       <br>
          (,   Â«Â»  ).      â€”  counter,              ESPHome,   sensor,          counter (       ).<br>
<br>
           2      â€”    ,    Â«Â».       ,   ,                      . <br>
<br>
<div class="spoiler"><b class="spoiler_title">    ( automations.yaml   )</b><div class="spoiler_text"><pre><code class="xml hljs">- alias:     <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_counter<font></font>
    service: counter.increment<font></font>
- alias:    1 <font></font>
  trigger:<font></font>
  - entity_id: binary_sensor.watercounter<font></font>
    platform: state<font></font>
    from: 'on'<font></font>
    to: 'off'<font></font>
  condition:<font></font>
    - condition: state<font></font>
      entity_id: switch.sistema_poliva_liniia_1<font></font>
      state: 'on'<font></font>
  action:<font></font>
  - data:<font></font>
      entity_id:<font></font>
      - counter.my_water_line1, counter.my_water_line1t<font></font>
    service: counter.increment    <font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml    +      </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
      water_counter:    <font></font>
        unit_of_measurement: 'M3'<font></font>
        value_template: "{{ (states('counter.my_water_counter')| float)/1000 }}"    <font></font>
counter:<font></font>
  my_water_counter:<font></font>
    initial: 2.667<font></font>
    step: 10<font></font>
  my_water_line1:<font></font>
    name: " 1     ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
  my_water_line1t:<font></font>
    name: " 1   ()"<font></font>
    initial: 0<font></font>
    step: 10<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor MiFlora</font></font></b><div class="spoiler_text"> MiFlora   ESPHome   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">esphome.io</a> <br>
 Home Assistant          â€” , ,   Â«Â» .   â€”     ,        .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor curah hujan virtual</font></font></b><div class="spoiler_text">   â€”          .            ,   . <br>
<br>
       darksky.  ,          Apple        Â« Â». API  , ,   ,      ,   HA     .      darksky, ,          .<br>
<br>
  2        :<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml   </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: darksky<font></font>
    api_key: xxxx_your_API_key_xxxx<font></font>
    forecast:<font></font>
      - 1<font></font>
      - 2<font></font>
    monitored_conditions:<font></font>
      - precip_intensity<font></font>
</code></pre><br>
   HA   : sensor.dark_sky_precip_intensity_1d  sensor.dark_sky_precip_intensity_2d,              .<br>
</div></div><br>
       template-sensor:<br>
<br>
<div class="spoiler"><b class="spoiler_title">  configuration.yaml  sensors.yaml    </b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
sensor:<font></font>
  - platform: template<font></font>
    sensors:<font></font>
       rain2days:    <font></font>
        unit_of_measurement: 'mm'<font></font>
        value_template: "{{ (((states('sensor.dark_sky_precip_intensity_2d')| float)+(states('sensor.dark_sky_precip_intensity_1d')| float))*24)| round(3) }}"    <font></font>
</code></pre><br>
 HA  sensor.rain2days          2 . <br>
  ,   Darksky         ,              <br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah semua data dikumpulkan, Anda dapat melanjutkan ke penyiraman langsung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah bagaimana saya melihat sepotong antarmuka dari salah satu zona di Home Assistant: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pf/l6/ut/pfl6ut8aoieytcg0kxlk-mjslcu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda dapat mengatur jumlah air untuk irigasi (dengan slider) dan melihat nilai-nilai sensor utama dan penghitung. </font><font style="vertical-align: inherit;">Saya memberikan antarmuka untuk salah satu jalur, untuk sisanya semuanya sama, hanya pada jalur dengan sensor data kabel itu sedikit kurang.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di antarmuka, Anda dapat melihat satu detail "berlebihan" - sensor tambahan "Norma telah tercapai". </font><font style="vertical-align: inherit;">Itu harus diperkenalkan, karena </font><font style="vertical-align: inherit;">Saya tidak dapat memperoleh kondisi: templat berfungsi untuk menghentikan otomatisasi ketika norma untuk jumlah air tercapai, dan sebagai hasilnya, otomatisasi hanya memeriksa nilai sensor ini. </font><font style="vertical-align: inherit;">Saya yakin bahwa bagian otomatisasi ini dapat dibuat lebih sederhana dan lebih elegan, tetapi level saya tidak cukup untuk ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di bawah ini adalah kode untuk sensor templat "kruk" yang dihasilkan:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensor kecukupan penyiraman (di dalam konfigurasi. Yaml atau file terpisah)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">  - platform: template<font></font>
    sensors:<font></font>
      line4_status:<font></font>
        friendly_name: " 4 -  "<font></font>
        value_template: &gt;-<font></font>
          {% if states('counter.my_water_line4t')|float &gt; states('input_number.slider4')|float %}<font></font>
            yes<font></font>
          {% elif states('counter.my_water_line4t')|float == states('input_number.slider4')|float  %}<font></font>
            yes<font></font>
          {% else %}<font></font>
            no<font></font>
          {% endif %}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otomatisasi untuk mulai menyiram pada akhirnya terlihat seperti ini:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mulai penyiraman (di dalam automations.yaml atau file terpisah)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4   23.01<font></font>
  trigger:<font></font>
    platform: time<font></font>
    at: "23:01:00"<font></font>
  condition:<font></font>
   condition: and<font></font>
   conditions:<font></font>
#    <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.rainfor2days<font></font>
      below: 5<font></font>
#      <font></font>
    - condition: numeric_state<font></font>
      entity_id: sensor.miflora_1_moisture<font></font>
      below: 50<font></font>
# ,       <font></font>
    - condition: state<font></font>
      entity_id: 'sensor.line4_status'<font></font>
      state: 'no'<font></font>
  action:<font></font>
   - service: switch.turn_on<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penyiraman dimulai sore hari, dengan setiap baris dimulai pada interval waktunya sendiri. </font><font style="vertical-align: inherit;">Pemisahan dengan waktu mulai memungkinkan Anda untuk menggunakan satu meter air masuk untuk mendapatkan data pada 4 baris. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat startup, tiga kondisi diperiksa:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apakah batas jumlah air untuk hari ini tidak terlampaui (jika, misalnya, penyiraman manual dihidupkan)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apakah kelembaban melebihi 50% (menurut pengamatan dalam kondisi kami, tanah yang baru saja tumpah memiliki kadar air tidak lebih dari 60%)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curah hujan lebih besar dari 5 mm tidak diharapkan dalam dua hari ke depan.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otomatisasi berikutnya menonaktifkan penyiraman:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menonaktifkan penyiraman (di dalam automations.yaml atau file terpisah)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs">- alias:   4 <font></font>
  trigger:<font></font>
#      <font></font>
  - entity_id: sensor.line4_status<font></font>
    platform: state<font></font>
    to: 'yes'<font></font>
    for: <font></font>
      seconds: 5    <font></font>
#   <font></font>
  - platform: time<font></font>
    at: "23:59:00"<font></font>
#     <font></font>
  - platform: numeric_state<font></font>
    entity_id: sensor.miflora_1_moisture<font></font>
    above: 65<font></font>
#       <font></font>
  - platform: state<font></font>
    entity_id: switch.sistema_poliva_liniia_4<font></font>
    to: 'on'<font></font>
    for: <font></font>
      minutes: 60<font></font>
  action:<font></font>
   - service: switch.turn_off<font></font>
     entity_id: switch.sistema_poliva_liniia_4<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam otomasi, sebanyak 4 varian pemicu digunakan, tetapi dalam kebanyakan kasus ini berfungsi sesuai dengan yang pertama - sebuah sensor â€œpenopangâ€, yang memantau kelebihan batas dengan jumlah air. </font><font style="vertical-align: inherit;">Pemicu lainnya dibuat sebagian besar untuk alasan keamanan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, otomatisasi terakhir yang terkait dengan masalah ini adalah mengatur ulang penghitung harian</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menempatkan penghitung harian (di dalam automations.yaml atau file terpisah)</font></font></b><div class="spoiler_text"><pre><code class="xml hljs"><font></font>
- alias:    4 <font></font>
  trigger:<font></font>
  - platform: time<font></font>
    at: "00:00:01"<font></font>
  action:<font></font>
  - service: counter.reset<font></font>
    entity_id: counter.my_water_line4t<font></font>
</code></pre><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ekonomi proyek</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biaya untuk bagian kontrol sistem irigasi adalah sebagai berikut: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Raspberry PIE dengan HassIO on board dan router WiFi dengan pelapis di kebun sudah sebelum memulai proyek, saya tidak memperhitungkannya) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNIPUMP BCX-15 1/2 "solenoid valve (biasanya ditutup) 4 * 20 euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sonoff 4CH 17 euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pulsa meter Pulsar 8 euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP32 DevKitC 3,5 euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kapasitif Sensor Kelembaban Tanah v1.2 2 * 0,67 euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MiFlora sensor 2 * 16 euro </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penjaga, kolektor, kabel, alat kelengkapan bersama-sama sekitar 50 euro </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TOTAL: sekitar 190 euro</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Waktu yang dihabiskan untuk menyiapkan sensor dan MK adalah sekitar 3-4 pm selama beberapa jam, tetapi sebagian besar waktu dihabiskan untuk "menciptakan sepeda" dan menciptakan "kruk", secara umum, tidak banyak pekerjaan. </font><font style="vertical-align: inherit;">Perakitan fisik sistem memakan waktu sekitar 2 malam. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, penghematan air sekitar 20-50% diharapkan dibandingkan dengan sistem pengatur waktu yang â€œkonyolâ€ dan dengan harga air setempat, sistem tersebut harus membayar dalam satu atau dua musim.</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kekurangan dan rencana revisi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasil dari proyek ini, beberapa nuansa dan peluang untuk perbaikan lebih lanjut terungkap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara khusus, saya akan mengganti katup solenoid 220V dengan model 24V - tegangan ini standar untuk sistem irigasi. Dalam hal ini, Anda harus menambahkan transformator 24V ke sistem dan mengubah Sonoff 4Ch menjadi sesuatu dengan kontak kering (misalnya, Sonoff 4CH Pro atau sesuatu yang dirakit sendiri). Katup sendiri lebih murah (dari 8 euro) dan mengurangi kemungkinan sengatan listrik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata untuk bekerja dengan pipa plastik, tekanan dari pasokan air terlalu tinggi, dan alat kelengkapannya bisa bocor selama siklus irigasi. Dalam kasus saya, ini tidak kritis, semua alat kelengkapan terletak di atas tanah penyiraman, tetapi dengan cara yang baik Anda perlu menambahkan peredam di saluran masuk untuk menurunkan tekanan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya bahkan lebih kesal dengan ketidakmungkinan menghitung jumlah air untuk irigasi dalam volume kurang dari 10 liter - volume ini adalah jumlah minimum yang dapat diukur untuk meteran seperti itu. </font><font style="vertical-align: inherit;">Masalah ini dapat diselesaikan dengan membongkar konter dan menukar roda, tetapi sampai saat itu tangan belum mencapainya.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id497588/index.html">Keamanan Musim Semi - Contoh Aplikasi Web Otorisasi O2uth Melalui BitBucket</a></li>
<li><a href="../id497590/index.html">Kami berurusan dengan algoritma runtuhnya fungsi gelombang</a></li>
<li><a href="../id497594/index.html">Penyimpanan data eksternal: dari zaman IBM 1311 hingga saat ini. Bagian 1</a></li>
<li><a href="../id497596/index.html">PHP panjang umur</a></li>
<li><a href="../id497602/index.html">Apakah Anda menganggap diri Anda sebagai penandatangan? Siapa yang bercanda</a></li>
<li><a href="../id497608/index.html">Bagaimana Sistem Analisis Lalu Lintas Mendeteksi Taktik Peretas oleh MITER ATT & CK, Bagian 5</a></li>
<li><a href="../id497612/index.html">Kisah bagaimana tangan pasar yang tak kasat mata memindahkan saya ke tempat yang jauh</a></li>
<li><a href="../id497614/index.html">Eksperimen pemikiran, paradoks, dan batasan logika // Kita ditakdirkan untuk # 2</a></li>
<li><a href="../id497616/index.html">Wawancara dengan Alexander Makarov (Yii) tentang opensource, konferensi, dan Yii</a></li>
<li><a href="../id497618/index.html">Implementasi konsep akses jarak jauh yang sangat aman</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>