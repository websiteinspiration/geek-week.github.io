<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥦 👰🏿 🧑🏼 Cのデリゲートとイベント＃ 👩🏿‍🍳 🔎 🌝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事の翻訳は、コース"C＃Developer"の学生のために特別に準備されました。
 
 
 
 C＃のイベントとは何ですか？
 イベントを使用して通知を提供できます。これらの通知が必要な場合は、イベントをサブスクライブできます。また、興味のあることが起こったことを通知する独自のイベントを作成するこ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cのデリゲートとイベント＃</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/472094/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の翻訳は、コース</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C＃Developer"の</font></font></a></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">学生のために特別に準備されました</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/yd/rp/irydrp5fqzvuhxdmpcokybn5gj4.png"><br>
<hr><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃のイベントとは何ですか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イベントを使用して通知を提供できます。</font><font style="vertical-align: inherit;">これらの通知が必要な場合は、イベントをサブスクライブできます。</font><font style="vertical-align: inherit;">また、興味のあることが起こったことを通知する独自のイベントを作成することもできます。</font><font style="vertical-align: inherit;">.NET Frameworkには、イベントの作成に使用できる組み込み型が用意されています。</font><font style="vertical-align: inherit;">デリゲート、ラムダ式、および無名メソッドを使用すると、便利な方法でイベントを作成および使用できます。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cのデリゲートを理解する＃</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C＃では、デリゲートはイベントの基本的なビルディングブロックを形成します。</font><font style="vertical-align: inherit;">デリゲートは、メソッドのシグネチャを定義するタイプです。</font><font style="vertical-align: inherit;">たとえば、C ++では、これは関数ポインターを使用して行うことができます。</font><font style="vertical-align: inherit;">C＃では、別のメソッドを指すデリゲートのインスタンスを作成できます。</font><font style="vertical-align: inherit;">このメソッドは、デリゲートインスタンスを介して呼び出すことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、デリゲートを宣言し、それを介してメソッドを呼び出す例です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cでデリゲートを使用する＃</font></font></h3><br>
<pre><code class="cs hljs">}<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">delegate</span> <span class="hljs-keyword">double</span> <span class="hljs-title">MathDelegate</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> value1, <span class="hljs-keyword">double</span> value2</span>)</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> value1, <span class="hljs-keyword">double</span> value2</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> value1 + value2;<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">Subtract</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> value1, <span class="hljs-keyword">double</span> value2</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> value1 - value2;<font></font>
    }<font></font>
        Console.ReadLine();<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        MathDelegate mathDelegate = Add;<font></font>
        <span class="hljs-keyword">var</span> result = mathDelegate(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);<font></font>
        Console.WriteLine(result);<font></font>
        <span class="hljs-comment">// : 7</span><font></font>
<font></font>
        mathDelegate = Subtract;<font></font>
        result = mathDelegate(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);<font></font>
        Console.WriteLine(result);<font></font>
        <span class="hljs-comment">// : 3</span><font></font>
<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、デリゲートキーワードを使用して、デリゲート型を作成していることをコンパイラに伝えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいデリゲートタイプを自動的に作成することで、デリゲートの設定は簡単です。</font><i><font style="vertical-align: inherit;">new</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
キーワードを使用してデリゲートを作成することもできます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">
インスタンス化されたデリゲートはオブジェクトです。</font><font style="vertical-align: inherit;">また、それを使用して、引数として他のメソッドに渡すこともできます。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<code>MathDelegate mathDelegate = new MathDelegate(Add)</code><font style="vertical-align: inherit;"></font><br>
 <br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cのマルチキャストデリゲート＃</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デリゲートのもう1つの優れた機能は、デリゲートを結合できることです。</font><font style="vertical-align: inherit;">これはマルチキャストと呼ばれます。</font><font style="vertical-align: inherit;">+または+ =演算子を使用して、別のメソッドを既存のデリゲートインスタンスの呼び出しリストに追加できます。</font><font style="vertical-align: inherit;">同様に、デクリメント代入演算子（-または-=）を使用して、呼び出しリストからメソッドを削除することもできます。</font><font style="vertical-align: inherit;">この機能は、C＃のイベントの基礎として機能します。</font><font style="vertical-align: inherit;">以下は、マルチキャストデリゲートの例です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Hello</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> s</span>)</span><font></font>
    {<font></font>
        Console.WriteLine(<span class="hljs-string">"  Hello, {0}!"</span>, s);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Goodbye</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> s</span>)</span><font></font>
    {<font></font>
        Console.WriteLine(<span class="hljs-string">"  Goodbye, {0}!"</span>, s);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Del</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> s</span>)</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        Del a, b, c, d;<font></font>
<font></font>
        <span class="hljs-comment">//   a     Hello:</span><font></font>
        a = Hello;<font></font>
<font></font>
        <span class="hljs-comment">//   b     Goodbye:</span><font></font>
        b = Goodbye;<font></font>
<font></font>
        <span class="hljs-comment">//    a  b - c: </span><font></font>
        c = a + b;<font></font>
<font></font>
                <span class="hljs-comment">//  a    c,   d,        Goodbye:</span><font></font>
        d = c - a;<font></font>
<font></font>
        Console.WriteLine(<span class="hljs-string">"Invoking delegate a:"</span>);<font></font>
        a(<span class="hljs-string">"A"</span>);<font></font>
        Console.WriteLine(<span class="hljs-string">"Invoking delegate b:"</span>);<font></font>
        b(<span class="hljs-string">"B"</span>);<font></font>
        Console.WriteLine(<span class="hljs-string">"Invoking delegate c:"</span>);<font></font>
        c(<span class="hljs-string">"C"</span>);<font></font>
        Console.WriteLine(<span class="hljs-string">"Invoking delegate d:"</span>);<font></font>
        d(<span class="hljs-string">"D"</span>);<font></font>
<font></font>
<font></font>
        <span class="hljs-comment">/* :
        Invoking delegate a:
          Hello, A!
        Invoking delegate b:
          Goodbye, B!
        Invoking delegate c:
          Hello, C!
          Goodbye, C!
        Invoking delegate d:
          Goodbye, D!
        */</span><font></font>
<font></font>
        Console.ReadLine();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デリゲートは、クラスから継承するため、これが可能である</font></font><code>System.MulticastDelegate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からターン継承でいます、</font></font><code>System.Delegate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらの基本クラスで定義されたメンバーをデリゲートに使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、マルチキャストデリゲートが呼び出すメソッドの数を調べるには、次のコードを使用できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">int invocationCount = d.GetInvocationList().GetLength(0);</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cの共分散と反分散＃</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドをデリゲートに割り当てる場合、メソッドシグネチャはデリゲートと正確に一致する必要はありません。</font><font style="vertical-align: inherit;">これは共分散および反分散と呼ばれます。</font><font style="vertical-align: inherit;">共分散により、メソッドはデリゲートで定義されたものよりも多くの派生戻り値の型を持つことができます。</font><font style="vertical-align: inherit;">反変は、デリゲート内の型よりも派生が少ないパラメーター型を持つメソッドを許可します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委任の共分散</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが共分散の例です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">delegate</span> TextWriter <span class="hljs-title">CovarianceDel</span>(<span class="hljs-params"></span>)</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> StreamWriter <span class="hljs-title">MethodStream</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> StringWriter <span class="hljs-title">MethodString</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        CovarianceDel del;<font></font>
<font></font>
        del = MethodStream;<font></font>
        del = MethodString;<font></font>
<font></font>
        Console.ReadLine();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><code>StreamWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、の</font><font style="vertical-align: inherit;">
両方</font></font><code>StringWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がから継承されている</font></font><code>TextWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ため</font></font><code>CovarianceDel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、両方の方法で</font><font style="vertical-align: inherit;">使用できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デリゲートの反分散</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は反変の例です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoSomething</span>(<span class="hljs-params">TextWriter textWriter</span>)</span> { }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ContravarianceDel</span>(<span class="hljs-params">StreamWriter streamWriter</span>)</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        ContravarianceDel del = DoSomething;<font></font>
<font></font>
        Console.ReadLine();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッド</font></font><code>DoSomething</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はで機能する</font><font style="vertical-align: inherit;">ため、</font></font><code>TextWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確実にで機能し</font></font><code>StreamWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">矛盾があるため、デリゲートを呼び出して、インスタンス</font></font><code>StreamWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をメソッドに</font><font style="vertical-align: inherit;">渡すことができます</font></font><code>DoSomething</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この概念について詳しくは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cのラムダ式＃</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドシグネチャ全体で、メソッド自体の本体よりも多くのコードが必要になる場合があります。デリゲートとして使用するためだけにメソッド全体を作成する必要がある状況もあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような場合のために、MicrosoftはC＃にいくつかの新機能を追加しました。 C＃3.0では、ラムダ式が追加されたときに状況がさらに改善されました。ラムダ式は、新しいコードを記述するときに推奨される方法です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、最新のラムダ構文の例です。</font></font><br>
<br>
<pre><code class="css hljs"><span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Program</span><font></font>
{<font></font>
    public delegate double MathDelegate(double value1, double value2);<font></font>
<font></font>
    public static void Main()<font></font>
    {<font></font>
        MathDelegate mathDelegate = (x,y) =&gt; x + y;<font></font>
        var result = mathDelegate(5, 2);<font></font>
        Console.WriteLine(result);<font></font>
        // : 7<font></font>
<font></font>
        mathDelegate = (x, y) =&gt; x - y; ;<font></font>
        result = mathDelegate(5, 2);<font></font>
        Console.WriteLine(result);<font></font>
        // : 3<font></font>
<font></font>
        Console.ReadLine();<font></font>
    }<font></font>
<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードを読むには、特別なラムダ構文のコンテキストで「フォロー」という単語を使用する必要があります。たとえば、上記の例の最初のラムダ式は、「xとyはxとyの加算に従います」と読み取ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドとは異なり、ラムダ関数には特定の名前はありません。このため、ラムダは無名関数と呼ばれます。また、戻り値の型を明示的に指定する必要もありません。コンパイラは、ラムダから自動的にそれを想定します。また、上記の例の場合、パラメータータイプxおよびyも明示的に指定されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数の演算子にまたがるラムダを作成できます。これを行うには、下の例に示すように、ラムダを構成する演算子を中括弧で囲みます。</font></font><br>
<br>
<pre><code class="cs hljs">MathDelegate mathDelegate = (x,y) =&gt; <font></font>
            {<font></font>
                Console.WriteLine(<span class="hljs-string">"Add"</span>);
                <span class="hljs-keyword">return</span> x + y;<font></font>
            };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
時々、イベントのデリゲートのアナウンスは少し面倒に思えます。</font><font style="vertical-align: inherit;">このため、.NET Frameworkには、デリゲートを宣言するときに使用できるいくつかの組み込みデリゲート型があります。</font><font style="vertical-align: inherit;">MathDelegateの例では、次のデリゲートを使用しました。</font></font><br>
<br>
<pre><code class="plaintext hljs">public delegate double MathDelegate(double value1, double value2);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデリゲートを組み込みタイプの1つ、つまりに置き換えることができます</font></font><code>Func &lt;int, int, int&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような、</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            Func&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt; mathDelegate = (x,y) =&gt; <font></font>
            {<font></font>
                Console.WriteLine(<span class="hljs-string">"Add"</span>);
                <span class="hljs-keyword">return</span> x + y;<font></font>
            };<font></font>
<font></font>
            <span class="hljs-keyword">var</span> result = mathDelegate(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);<font></font>
            Console.WriteLine(result);<font></font>
            <span class="hljs-comment">// : 7</span><font></font>
<font></font>
            mathDelegate = (x, y) =&gt; x - y; ;<font></font>
            result = mathDelegate(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);<font></font>
            Console.WriteLine(result);<font></font>
            <span class="hljs-comment">// : 3</span><font></font>
<font></font>
            Console.ReadLine();<font></font>
        }<font></font>
<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Func &lt;...&gt;型はSystem名前空間にあります。これらは、型を返し、0〜16のパラメーターを取るデリゲートを表します。これらのタイプはすべてSystem.MulticaseDelegateから継承されるため、複数のメソッドを呼び出しリストに追加できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
値を返さないデリゲート型が必要な場合は、System.Action型を使用できます。また、0〜16個のパラメーターを使用できますが、値を返しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、Actionタイプの使用例です。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            Action&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt; mathDelegate = (x,y) =&gt; <font></font>
            {<font></font>
                Console.WriteLine(x + y);<font></font>
            };<font></font>
<font></font>
            mathDelegate(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);
            <span class="hljs-comment">// : 7</span><font></font>
<font></font>
            mathDelegate = (x, y) =&gt; Console.WriteLine(x - y) ;<font></font>
            mathDelegate(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);
            <span class="hljs-comment">// : 3</span><font></font>
<font></font>
            Console.ReadLine();<font></font>
        }<font></font>
<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
.NET組み込みデリゲートの詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラムダ関数がラムダ式の外部で宣言された変数またはこれを参照し始めると、事態は複雑になります。</font><font style="vertical-align: inherit;">通常、コントロールが変数のスコープを離れると、変数は無効になります。</font><font style="vertical-align: inherit;">しかし、デリゲートがローカル変数を参照している場合はどうでしょうか。</font><font style="vertical-align: inherit;">これを修正するために、コンパイラーは、少なくとも最も長く存続するデリゲートが存続する限り、キャプチャーされた変数の存続期間を延長するコードを生成します。</font><font style="vertical-align: inherit;">これはクロージャーと呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クロージャについて詳しくは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20150707082707/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cのイベント＃</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的な開発パターンである、発行者と購読者（pub / sub）について考えてみましょう。イベントを購読すると、イベントパブリッシャーが新しいイベントを開始したときに通知されます。このシステムは、アプリケーション内のコンポーネント間の弱い通信を確立するために使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デリゲートは、C＃のイベントシステムの基礎を形成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イベントは、イベント指向のプログラミングを容易にする特殊なタイプのデリゲートです。イベントは、アクセス指定子に関係なく、クラスの外で呼び出すことができないクラスのメンバーです。したがって、たとえば、パブリックとして宣言されたイベントは、他のクラスがこのイベントに+ =および-=を使用できるようにしますが、イベントのトリガー（つまり、デリゲートの呼び出し）は、イベントを含むクラスでのみ許可されます。例を見てみましょう、</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-comment">// -  Pub</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Pub</span><font></font>
{<font></font>
    <span class="hljs-comment">// OnChange    callback-  </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> Action OnChange = <span class="hljs-keyword">delegate</span> { };<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Raise</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">// OnChange</span><font></font>
        OnChange();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、別のクラスのメソッドは、そのメソッドの1つをイベントデリゲートに追加することにより、イベントをサブスクライブできます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。次の例は、クラスがオープンデリゲートを提供してイベントを生成する方法を示しています。</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//   pub</span>
        Pub p = <span class="hljs-keyword">new</span> Pub();<font></font>
<font></font>
        <span class="hljs-comment">//  Subscriber 1   OnChange </span>
        p.OnChange += () =&gt; Console.WriteLine(<span class="hljs-string">"Subscriber 1!"</span>);
        <span class="hljs-comment">//  Subscriber 2   OnChange</span>
        p.OnChange += () =&gt; Console.WriteLine(<span class="hljs-string">"Subscriber 2!"</span>);<font></font>
<font></font>
        <span class="hljs-comment">// </span><font></font>
        p.Raise();<font></font>
<font></font>
        <span class="hljs-comment">//   Raise()   callback-    </span><font></font>
<font></font>
        Console.WriteLine(<span class="hljs-string">"Press enter to terminate!"</span>);<font></font>
        Console.ReadLine();<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イベントがとして宣言されていても</font></font><code>public</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、それが配置されているクラスを除いて、直接トリガーすることはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーワードを使用する</font></font><code>event</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、コンパイラは不要なアクセスからフィールドを保護します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=（直接デリゲート割り当て）を使用すること</font><font style="vertical-align: inherit;">も</font><font style="vertical-align: inherit;">できません。したがって、コードは+ =ではなく=を使用して、以前のサブスクライバーを削除するリスクから保護されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、などの空のデリゲートのOnChangeフィールドを初期化するための特別な構文に気付くかもしれません</font></font><code>delegate { }</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これにより、OnChangeフィールドがnullになることはありません。したがって、nullにするクラスメンバーが他にいない場合は、イベントを呼び出す前にnullチェックを削除できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のプログラムを実行すると、コードはPubの新しいインスタンスを作成し、2つの異なる方法でイベントをサブスクライブし、p.Raiseを呼び出してイベントを生成します。</font><font style="vertical-align: inherit;">Pubクラスは、どのサブスクライバーも完全に認識していません。</font><font style="vertical-align: inherit;">イベントを生成するだけです。</font><font style="vertical-align: inherit;">この概念をより深く理解するには</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、私の記事「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃パブリッシャー/サブスクライバーデザインパターン」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">読むこともでき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今のところ、これですべてです。</font><font style="vertical-align: inherit;">私はあなたがアイデアを得ることを望みます。</font><font style="vertical-align: inherit;">投稿を読んでいただきありがとうございます。</font><font style="vertical-align: inherit;">エラーや変更が必要な場合は、下のコメントでお知らせください。</font><font style="vertical-align: inherit;">前もって感謝します！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">役立つリンク</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">www.c-sharpcorner.com/blogs/c-sharp-generic-delegates-func-action-and-predicate</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/covariance-contravariance</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://web.archive.org/web/20150707082707/">https://web.archive.org/web/20150707082707/http://diditwith.net/PermaLink,guid,235646ae-3476-4893-899d-105e4d48c25b.aspx</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja472082/index.html">ポストグレソ18</a></li>
<li><a href="../ja472084/index.html">スマートフォンの脆弱性</a></li>
<li><a href="../ja472086/index.html">ユーザーインターフェイス設計でゲシュタルト心理学の法則を使用する</a></li>
<li><a href="../ja472088/index.html">ServiceDeskの選択方法。パート2</a></li>
<li><a href="../ja472092/index.html">安全でないPHP関数</a></li>
<li><a href="../ja472096/index.html">Androidクリッカーはユーザーを有料サービスに登録します</a></li>
<li><a href="../ja472100/index.html">ShchyryウクライナDunnoまたはキエフが推測しなかった方法</a></li>
<li><a href="../ja472104/index.html">Habr Weekly＃23 /宇宙と心に飛び込む、MicrosoftがWindows Phoneを埋め込む、Matrixのレガシー、紙のゲーム</a></li>
<li><a href="../ja472106/index.html">MacBook Pro 2018 T2をArchLinux（デュアルブート）と連携させる</a></li>
<li><a href="../ja472110/index.html">RegexPlay 100％チャレンジに合格</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>