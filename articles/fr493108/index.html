<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎅🏼 🙎🏻 😾 Cloudflare sélectionne des processeurs AMD pour les serveurs Edge de dixième génération 👩‍💻 🎪 ▶️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Plus d'un milliard d'adresses IP uniques transitent quotidiennement par le réseau Cloudflare; Il sert plus de 11 millions de requêtes HTTP par seconde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cloudflare sélectionne des processeurs AMD pour les serveurs Edge de dixième génération</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493108/"><img src="https://habrastorage.org/getpro/habr/post_images/536/952/a76/536952a764f14e82b44b8765e9c63737.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus d'un milliard d'adresses IP uniques transitent quotidiennement par le réseau Cloudflare; Il sert plus de 11 millions de requêtes HTTP par seconde; il est situé à une distance maximale de 100 m de 95% de la population Internet. Notre réseau couvre 200 villes dans plus de 90 pays, et notre équipe d'ingénieurs a construit une infrastructure extrêmement rapide et fiable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes très fiers de notre travail et nous nous engageons à contribuer à rendre Internet meilleur et plus sûr. Les ingénieurs de Cloudflare, dont le travail est lié au matériel, connaissent bien les serveurs et leurs composants afin de comprendre et de choisir le meilleur équipement pour maximiser son efficacité.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre pile logicielle gère l'informatique à haute charge et dépend beaucoup de la vitesse du processeur, c'est pourquoi nos ingénieurs doivent constamment optimiser l'efficacité et la fiabilité de Cloudflare à tous les niveaux de la pile. </font><font style="vertical-align: inherit;">Côté serveur, le moyen le plus simple consiste à augmenter la puissance de calcul en ajoutant des cœurs CPU. </font><font style="vertical-align: inherit;">Plus vous pouvez insérer de cœurs dans un serveur, plus il peut traiter de données. </font><font style="vertical-align: inherit;">C'est important pour nous, car la diversité de nos produits et de nos clients augmente avec le temps, et la croissance des demandes nécessite des serveurs pour augmenter la productivité. </font><font style="vertical-align: inherit;">Pour augmenter leur productivité, nous devions augmenter la densité des noyaux - et c'est précisément ce que nous avons accompli. </font><font style="vertical-align: inherit;">Ci-dessous, nous fournissons des détails sur les données de processeur pour les serveurs que nous déployons depuis 2015, y compris le nombre de cœurs:</font></font><br>
<a name="habracut"></a><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 6</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 7</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 8</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 9</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Début des travaux</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Silver 4116</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Platinum 6162</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noyaux physiques</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 12</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP par cœur</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10,65 W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,50 W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.08W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,25 W</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2018, nous avons fait un bond en avant dans le nombre total de cœurs par serveur avec la 9e génération. </font><font style="vertical-align: inherit;">L'impact environnemental a été réduit de 33% par rapport à la 8e génération, ce qui nous a permis d'augmenter le volume et la puissance de calcul par rack. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exigences de conception de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Thermal Design Power</font></a><font style="vertical-align: inherit;"> (TDP) </font><font style="vertical-align: inherit;">sont </font><font style="vertical-align: inherit;">mentionnées pour souligner que notre efficacité énergétique a également augmenté au fil du temps. </font><font style="vertical-align: inherit;">Cet indicateur est important pour nous: premièrement, nous voulons émettre moins de carbone dans l'atmosphère; </font><font style="vertical-align: inherit;">deuxièmement, nous voulons tirer le meilleur parti de l'énergie des centres de données. </font><font style="vertical-align: inherit;">Mais nous savons ce que nous devons viser.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre métrique principale de définition est le nombre de demandes par watt. Nous pouvons augmenter le nombre de demandes par seconde en ajoutant des cœurs, mais nous devons respecter notre budget énergétique. Nous sommes limités par l'infrastructure d'alimentation des centres de données, qui, avec nos modules de distribution d'énergie sélectionnés, nous donne une certaine limite supérieure pour chaque rack de serveur. L'ajout de serveurs à un rack augmente la consommation d'énergie. Les coûts d'exploitation augmenteront considérablement si nous dépassons la limite d'énergie d'un rack et que nous devons ajouter de nouveaux racks. Nous devons augmenter la puissance de calcul, en restant dans la même gamme d'énergie, ce qui augmentera le nombre de demandes par watt - notre métrique clé.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous l'avez peut-être deviné, nous avons soigneusement étudié la consommation d'énergie au stade de la conception. </font><font style="vertical-align: inherit;">Le tableau ci-dessus montre que nous ne devrions pas perdre de temps à déployer des CPU plus gourmands en énergie, si le TDP par cœur est supérieur à la génération actuelle - cela affectera négativement notre métrique, le nombre de demandes par watt. </font><font style="vertical-align: inherit;">Nous avons soigneusement examiné les systèmes prêts à l'emploi pour notre génération X sur le marché et pris une décision. </font><font style="vertical-align: inherit;">Nous passons de notre circuit avec 48 cœurs Intel Xeon Platinum 6162 et deux sockets à un AMD EPYC 7642 à 48 cœurs avec un socket.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d3c/162/8f5/d3c1628f5dfb45681f0fb25abce76b3e.jpg"><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AMD</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xeon Platinum 6162</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPYC 7642</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microarchitecture</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«Skylake» </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Zen 2"</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom de code</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Skylake SP"</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Rome" </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technologie de processus</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14nm</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 nm</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noyaux</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fréquence</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,9 GHz</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,4 GHz</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache / socket L3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24 x 1,375 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 x 16 Mo</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mémoire / socket</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 canaux, jusqu'à DDR4-2400</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 canaux, jusqu'à DDR4-3200</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">225W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCIe / socket</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48 voies</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 voies</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EST UN</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'après les spécifications, il est clair que la puce d'AMD nous permettra de laisser le même nombre de cœurs, abaissant le TDP. </font><font style="vertical-align: inherit;">Dans la 9e génération, le TDP par cœur était de 6,25 watts, et dans la Xe génération, il sera de 4,69 watts. </font><font style="vertical-align: inherit;">Une diminution de 25%. </font><font style="vertical-align: inherit;">En raison de l'augmentation de la fréquence et, éventuellement, d'un circuit plus simple avec une seule prise, nous pouvons supposer que la puce AMD s'avérera meilleure en entreprise. </font><font style="vertical-align: inherit;">Pendant que nous effectuons divers tests et simulations pour comprendre les performances accrues d'AMD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En attendant, nous notons que TDP est une métrique simplifiée à partir des spécifications du fabricant, que nous avons utilisée dans les premières étapes de la conception du serveur et de la sélection du processeur. </font><font style="vertical-align: inherit;">Une recherche rapide sur Google montre qu'AMD et Intel ont des approches différentes de la définition de TDP, c'est pourquoi cette spécification n'est pas fiable. </font><font style="vertical-align: inherit;">La consommation d'énergie réelle du CPU et, plus important encore, la consommation d'énergie du serveur, est ce que nous utilisons vraiment pour prendre la décision finale.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préparation de l'écosystème</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début de notre voyage vers le choix du prochain processeur, nous avons étudié un large éventail de CPU de différents fabricants qui étaient bien adaptés à notre pile de logiciels et à nos services (écrits en C, LuaJIT et Go). Nous avons déjà décrit en détail un ensemble d'outils pour mesurer la vitesse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans un article de notre blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans ce cas, nous avons utilisé le même ensemble - cela nous permet d'évaluer l'efficacité du CPU dans un délai raisonnable, après quoi nos ingénieurs peuvent commencer à adapter nos programmes à un processeur spécifique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons testé différents processeurs avec un nombre varié de cœurs, de sockets et de fréquences. Étant donné que cet article explique pourquoi nous nous sommes installés sur l'AMD EPYC 7642, tous les graphiques de ce blog se concentrent sur les performances des processeurs AMD par rapport à l'Intel Xeon Platinum 6162 de</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notre 9e génération</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les résultats correspondent à des mesures du fonctionnement d'un serveur avec chaque variante de processeur, c'est-à-dire avec deux processeurs 24 cœurs d'Intel ou avec un processeur 48 cœurs d'AMD (serveur pour Intel avec deux sockets et serveur pour AMD EPYC avec un). </font><font style="vertical-align: inherit;">Dans le BIOS, nous définissons les paramètres correspondant aux serveurs qui fonctionnent. </font><font style="vertical-align: inherit;">Ce sont 3,03 GHz pour AMD et 2,5 GHz pour Intel. </font><font style="vertical-align: inherit;">Simplifiant beaucoup, nous prévoyons qu'avec le même nombre de cœurs, AMD affichera des résultats 21% meilleurs qu'Intel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cryptographie</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/eb4/843/287/eb484328713741f6688d81c15a9c5920.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/598/82b/416/59882b416feabd9eea86ea9d99d1e1df.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble prometteur pour AMD. </font><font style="vertical-align: inherit;">Il fonctionne 18% mieux sur la cryptographie à clé publique. </font><font style="vertical-align: inherit;">Avec une clé symétrique, il perd pour les options de cryptage AES-128-GCM, mais en général il se montre comparable.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compression</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur les serveurs de périphérie, nous compressons un grand nombre de données pour économiser de la bande passante et augmenter la vitesse de livraison de contenu. </font><font style="vertical-align: inherit;">Nous transmettons les données via les bibliothèques zlib et brotli C. </font><font style="vertical-align: inherit;">Tous les tests ont eu lieu sur le fichier HTML blog.cloudflare.com en mémoire. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fdc/bf7/ae1/fdcbf7ae1109d02a45b2ca40fe353376.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ccc/427/983/ccc427983ceb85dbf63bab614850692f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMD a remporté une moyenne de 29% lors de l'utilisation de gzip. </font><font style="vertical-align: inherit;">Dans le cas de brotli, les résultats sont encore meilleurs sur les tests de qualité 7, que nous utilisons pour la compression dynamique. </font><font style="vertical-align: inherit;">Une forte baisse se produit sur le test brotli-9 - nous l'attribuons au fait que Brotli consomme beaucoup de mémoire et déborde le cache. </font><font style="vertical-align: inherit;">Cependant, AMD gagne par une large marge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de nos services sont écrits en Go. </font><font style="vertical-align: inherit;">Dans les graphiques suivants, nous revérifions les taux de cryptographie et de compression sur Go avec RegExp sur des lignes de 32 Ko en utilisant la bibliothèque de chaînes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez la cryptographie</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/78a/ab0/495/78aab0495309cefee6f30bac835ee961.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez compression</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/f99/2cb/95d/f992cb95d4913a2d19808d4bd15b5b54.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/850/e7c/f55/850e7cf5586f693dd14d62f70510f681.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go regexp</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/b58/798/6cb/b587986cbab94ca7087364a949f09aa4.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/444/e76/f72/444e76f72c1ec2e93c4cae0c5bd386f2.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez cordes</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/3e9/984/19a/3e998419adb450f598e0f3d82de01aa1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMD montre les meilleurs résultats dans tous les tests avec Go, sauf le signe ECDSA P256, où il est 38% derrière - ce qui est étrange, étant donné qu'il a montré 24% de meilleurs résultats en C. </font><font style="vertical-align: inherit;">Cela vaut la peine de comprendre ce qui se passe là-bas. </font><font style="vertical-align: inherit;">Mais en général, AMD ne gagne pas beaucoup, mais montre toujours les meilleurs résultats.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luajit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons souvent LuaJIT dans la pile. </font><font style="vertical-align: inherit;">Ceci est la colle tenant toutes les parties de Cloudflare. </font><font style="vertical-align: inherit;">Et nous sommes heureux qu'AMD ait gagné ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, les tests montrent que EPYC 7642 fonctionne mieux que deux Xeon Platinum 6162. AMD perd sur une paire de tests - par exemple, AES-128-GCM et Go OpenSSL ECDSA-P256 Sign - cependant, il gagne sur tous les autres, en moyenne de 25% .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation de charge de travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après nos tests express, nous avons exécuté le serveur via un autre ensemble de simulations dans lesquelles la charge synthétique est appliquée à la pile de périphérie logicielle. Ici, nous simulons une charge de travail de scripts avec différents types de requêtes qui peuvent être trouvées dans le travail réel. Les demandes varient en termes de volume de données, de protocoles HTTP ou HTTPS, de WAF, de sources de travailleurs et autres à partir d'une variété de variables. Vous trouverez ci-dessous une comparaison du débit des deux CPU pour les types de requêtes que nous trouvons le plus souvent.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/594/dbb/4cf/594dbb4cf570a1c22ff666d592884ef7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les résultats sur le diagramme sont mesurés par les indicateurs de base de la 9e génération de machines avec processeurs Intel, normalisés à une valeur de 1,0 le long de l'axe x. </font><font style="vertical-align: inherit;">Par exemple, en prenant de simples requêtes de 10 Ko via HTTPS, nous pouvons voir qu'AMD est 1,5 fois mieux qu'Intel en termes de nombre de requêtes par seconde. </font><font style="vertical-align: inherit;">En moyenne, AMD a réalisé 34% mieux pour les tests donnés qu'Intel. </font><font style="vertical-align: inherit;">Considérant que le TDP pour un seul AMD EPYC 7642 est égal à 225 W, et pour deux processeurs Intel - 300 W, il s'avère qu'en termes de «demandes par watt», AMD affiche des résultats 2 fois meilleurs qu'Intel!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, nous étions clairement en faveur de l'option d'un seul socket pour AMD EPYC 7642 comme futurs CPU pour la génération X. Nous étions très intéressés de savoir comment les serveurs AMD EPYC se comportaient dans le travail réel, et nous avons immédiatement envoyé plusieurs serveurs à certains des centres de données.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Du vrai travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première chose, bien sûr, a été de préparer le serveur au travail dans des conditions réelles. </font><font style="vertical-align: inherit;">Toutes les machines de notre flotte fonctionnent avec les mêmes processus et services, ce qui en fait une excellente occasion de comparer correctement les performances. </font><font style="vertical-align: inherit;">Comme dans la plupart des centres de données, nous avons déployé plusieurs générations de serveurs et nous assemblons nos serveurs en grappes afin que chaque classe contienne des serveurs d'environ la même génération. </font><font style="vertical-align: inherit;">Dans certains cas, cela peut entraîner des courbes d'utilisation variant entre les clusters. </font><font style="vertical-align: inherit;">Mais pas avec nous. </font><font style="vertical-align: inherit;">Nos ingénieurs ont optimisé l'utilisation du processeur pour toutes les générations afin que, indépendamment du fait que le processeur ait 8 cœurs sur une machine particulière ou 24, l'utilisation du processeur n'est généralement pas différente des autres.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9b9/ea2/a9b/9b9ea2a9b8b70ad4e6e8f3b4e72200a3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le graphique illustre notre commentaire sur la similitude d'utilisation - il n'y a pas de différence significative entre l'utilisation de processeurs AMD dans les serveurs de génération X et l'utilisation de processeurs Intel dans les serveurs de génération 9. Cela signifie que les serveurs de test et les serveurs principaux sont chargés de manière égale. Bien. C'est exactement ce que nous réalisons dans le travail de nos serveurs, et nous en avons besoin pour une comparaison honnête. Les deux graphiques ci-dessous indiquent le nombre de demandes traitées par un cœur de processeur et tous les cœurs au niveau du serveur. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/075/8a6/91c/0758a691c0287281bd4c70bc1625d631.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requêtes au </font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0a2/c5d/206/0a2c5d206c83c98cc06b910118a03a17.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serveur Requêtes au serveur</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On peut voir qu'en moyenne AMD traite 23% de demandes en plus. Pas mal du tout! Nous avons souvent écrit sur notre blog des moyens d'augmenter les performances de la génération 9. Et ici, nous avons le même nombre de cœurs, mais AMD fait plus de travail avec moins d'énergie. Immédiatement à partir des spécifications du nombre de cœurs et du TDP, on peut voir que AMD offre plus de vitesse avec une plus grande efficacité énergétique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, comme nous l'avons déjà mentionné, le TDP n'est pas une spécification standard, et ce n'est pas la même chose pour tous les fabricants, alors regardons l'utilisation réelle de l'énergie. En mesurant la consommation d'énergie du serveur en parallèle avec le nombre de requêtes par seconde, nous avons obtenu le graphique suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/eac/f1a/a0f/eacf1aa0fcbee9f35c376bf52a7f37d1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par le nombre de requêtes par seconde dépensées par watt, le serveur Gen X sur les processeurs AMD est 28% plus efficace. On aurait pu s'attendre à plus, étant donné que le TDP d'AMD est inférieur de 25%, cependant, il faut se rappeler que le TDP est une caractéristique ambiguë. Nous avons vu que la consommation d'énergie réelle d'AMD coïncide presque avec le TDP indiqué à une fréquence bien au-dessus de la base; Intel n'a pas ça. C'est une autre raison pour laquelle le TDP n'est pas une estimation fiable de la consommation d'énergie. Les processeurs Intel de nos serveurs Gen 9 sont intégrés dans le système multicode, tandis que les processeurs AMD fonctionnent dans des serveurs au format 1U standard. Cela ne parle pas en faveur d'AMD, car les serveurs multi-nœuds devraient fournir une densité plus élevée avec moins de consommation d'énergie par nœud, mais AMD a toujours surclassé Intel en termes de consommation d'énergie par nœud.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des comparaisons sur les spécifications, les simulations de test et le travail réel, la configuration de 1P AMD EPYC 7642 s'est avérée bien meilleure que 2P Intel Xeon 6162. Dans certaines conditions, AMD peut fonctionner 36% mieux, et nous pensons qu'en optimisant le matériel et les programmes, nous nous pouvons obtenir une telle amélioration sur une base continue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que AMD a gagné. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des graphiques supplémentaires montrent le délai moyen et le délai p99 en fonctionnement NGINX pendant 24 heures. </font><font style="vertical-align: inherit;">En moyenne, les processus AMD ont fonctionné 25% plus rapidement. </font><font style="vertical-align: inherit;">À p99, il fonctionne 20 à 50% plus rapidement en fonction de l'heure de la journée.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les ingénieurs du matériel et des performances de Cloudflare effectuent un nombre important de tests et de recherches pour sélectionner la meilleure configuration de serveur pour nos clients. Nous aimons travailler ici parce que nous pouvons résoudre de telles tâches grandioses, et aussi vous aider à résoudre vos problèmes avec des services tels que l'informatique sans serveur et une gamme de solutions aux problèmes de sécurité, en particulier, Magic Transit, Argo Tunnel et la protection DDoS . Tous les serveurs du réseau Cloudflare sont configurés pour un fonctionnement fiable, et nous essayons toujours de rendre chaque nouvelle génération de serveurs meilleure que la précédente. Nous pensons que AMD EPYC 7642 est la réponse à la question du choix des processeurs pour la génération X.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant le service Cloudflare Workers, les développeurs déploient leurs applications sur notre réseau, se développant dans le monde entier. Nous sommes fiers d'offrir à nos clients la possibilité de se concentrer sur l'écriture de code pendant que nous travaillons sur la sécurité et la fiabilité dans le cloud. Et aujourd'hui, nous sommes encore plus heureux d'annoncer que leur travail sera déployé sur nos serveurs de génération Gen X exécutant des processeurs AMD EPYC de deuxième génération. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7de/304/54d/7de30454d5b87e7a32fceda1e3f7ca49.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processeurs EPYC 7642, nom de code «Rome» [Rome]</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Grâce à EPYC 7642 d'AMD, nous avons pu augmenter notre vitesse et faciliter l'expansion du réseau vers de nouvelles villes. Rome n'a pas été construite en un jour, mais bientôt elle sera plus proche de beaucoup d'entre vous.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours des deux dernières années, nous avons expérimenté de nombreuses puces x86 d'Intel et d'AMD, ainsi que des processeurs d'ARM. </font><font style="vertical-align: inherit;">Nous espérons qu'à l'avenir, ces fabricants de CPU travailleront avec nous afin que nous puissions ensemble construire un Internet amélioré.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493096/index.html">Ajouter un thème sombre dans iOS</a></li>
<li><a href="../fr493098/index.html">Déployer le cluster d'équilibrage de charge VPN ASA</a></li>
<li><a href="../fr493100/index.html">Comment trouver des moyens simples aide les startups à atteindre une croissance agressive</a></li>
<li><a href="../fr493102/index.html">Tendances mondiales de l'automatisation: développement RPA</a></li>
<li><a href="../fr493106/index.html">Quelle est la nouveauté de la Devil's Dozen?</a></li>
<li><a href="../fr493110/index.html">Comment déléguer dans le travail à distance - un guide pour le chef d'équipe et plus</a></li>
<li><a href="../fr493112/index.html">Comment démarrer une nouvelle entreprise en 6 mois au lieu de 3 ans</a></li>
<li><a href="../fr493114/index.html">Comment Data Engineer a regardé les données</a></li>
<li><a href="../fr493116/index.html">"Plus d'interactivité!" ou comment était TeamLead Conf 2020</a></li>
<li><a href="../fr493118/index.html">Présentation de l'extension d'étiquetage de mémoire (Armv8.5-A)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>