<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖüèº üôéüèª üòæ Cloudflare s√©lectionne des processeurs AMD pour les serveurs Edge de dixi√®me g√©n√©ration üë©‚Äçüíª üé™ ‚ñ∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Plus d'un milliard d'adresses IP uniques transitent quotidiennement par le r√©seau Cloudflare; Il sert plus de 11 millions de requ√™tes HTTP par seconde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cloudflare s√©lectionne des processeurs AMD pour les serveurs Edge de dixi√®me g√©n√©ration</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493108/"><img src="https://habrastorage.org/getpro/habr/post_images/536/952/a76/536952a764f14e82b44b8765e9c63737.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus d'un milliard d'adresses IP uniques transitent quotidiennement par le r√©seau Cloudflare; Il sert plus de 11 millions de requ√™tes HTTP par seconde; il est situ√© √† une distance maximale de 100 m de 95% de la population Internet. Notre r√©seau couvre 200 villes dans plus de 90 pays, et notre √©quipe d'ing√©nieurs a construit une infrastructure extr√™mement rapide et fiable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes tr√®s fiers de notre travail et nous nous engageons √† contribuer √† rendre Internet meilleur et plus s√ªr. Les ing√©nieurs de Cloudflare, dont le travail est li√© au mat√©riel, connaissent bien les serveurs et leurs composants afin de comprendre et de choisir le meilleur √©quipement pour maximiser son efficacit√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre pile logicielle g√®re l'informatique √† haute charge et d√©pend beaucoup de la vitesse du processeur, c'est pourquoi nos ing√©nieurs doivent constamment optimiser l'efficacit√© et la fiabilit√© de Cloudflare √† tous les niveaux de la pile. </font><font style="vertical-align: inherit;">C√¥t√© serveur, le moyen le plus simple consiste √† augmenter la puissance de calcul en ajoutant des c≈ìurs CPU. </font><font style="vertical-align: inherit;">Plus vous pouvez ins√©rer de c≈ìurs dans un serveur, plus il peut traiter de donn√©es. </font><font style="vertical-align: inherit;">C'est important pour nous, car la diversit√© de nos produits et de nos clients augmente avec le temps, et la croissance des demandes n√©cessite des serveurs pour augmenter la productivit√©. </font><font style="vertical-align: inherit;">Pour augmenter leur productivit√©, nous devions augmenter la densit√© des noyaux - et c'est pr√©cis√©ment ce que nous avons accompli. </font><font style="vertical-align: inherit;">Ci-dessous, nous fournissons des d√©tails sur les donn√©es de processeur pour les serveurs que nous d√©ployons depuis 2015, y compris le nombre de c≈ìurs:</font></font><br>
<a name="habracut"></a><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 6</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 7</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 8</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gen 9</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©but des travaux</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon E5-2630 v4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Silver 4116</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Xeon Platinum 6162</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noyaux physiques</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 12</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 85W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP par c≈ìur</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10,65 W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,50 W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.08W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,25 W</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En 2018, nous avons fait un bond en avant dans le nombre total de c≈ìurs par serveur avec la 9e g√©n√©ration. </font><font style="vertical-align: inherit;">L'impact environnemental a √©t√© r√©duit de 33% par rapport √† la 8e g√©n√©ration, ce qui nous a permis d'augmenter le volume et la puissance de calcul par rack. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exigences de conception de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Thermal Design Power</font></a><font style="vertical-align: inherit;"> (TDP) </font><font style="vertical-align: inherit;">sont </font><font style="vertical-align: inherit;">mentionn√©es pour souligner que notre efficacit√© √©nerg√©tique a √©galement augment√© au fil du temps. </font><font style="vertical-align: inherit;">Cet indicateur est important pour nous: premi√®rement, nous voulons √©mettre moins de carbone dans l'atmosph√®re; </font><font style="vertical-align: inherit;">deuxi√®mement, nous voulons tirer le meilleur parti de l'√©nergie des centres de donn√©es. </font><font style="vertical-align: inherit;">Mais nous savons ce que nous devons viser.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Notre m√©trique principale de d√©finition est le nombre de demandes par watt. Nous pouvons augmenter le nombre de demandes par seconde en ajoutant des c≈ìurs, mais nous devons respecter notre budget √©nerg√©tique. Nous sommes limit√©s par l'infrastructure d'alimentation des centres de donn√©es, qui, avec nos modules de distribution d'√©nergie s√©lectionn√©s, nous donne une certaine limite sup√©rieure pour chaque rack de serveur. L'ajout de serveurs √† un rack augmente la consommation d'√©nergie. Les co√ªts d'exploitation augmenteront consid√©rablement si nous d√©passons la limite d'√©nergie d'un rack et que nous devons ajouter de nouveaux racks. Nous devons augmenter la puissance de calcul, en restant dans la m√™me gamme d'√©nergie, ce qui augmentera le nombre de demandes par watt - notre m√©trique cl√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous l'avez peut-√™tre devin√©, nous avons soigneusement √©tudi√© la consommation d'√©nergie au stade de la conception. </font><font style="vertical-align: inherit;">Le tableau ci-dessus montre que nous ne devrions pas perdre de temps √† d√©ployer des CPU plus gourmands en √©nergie, si le TDP par c≈ìur est sup√©rieur √† la g√©n√©ration actuelle - cela affectera n√©gativement notre m√©trique, le nombre de demandes par watt. </font><font style="vertical-align: inherit;">Nous avons soigneusement examin√© les syst√®mes pr√™ts √† l'emploi pour notre g√©n√©ration X sur le march√© et pris une d√©cision. </font><font style="vertical-align: inherit;">Nous passons de notre circuit avec 48 c≈ìurs Intel Xeon Platinum 6162 et deux sockets √† un AMD EPYC 7642 √† 48 c≈ìurs avec un socket.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d3c/162/8f5/d3c1628f5dfb45681f0fb25abce76b3e.jpg"><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AMD</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Xeon Platinum 6162</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EPYC 7642</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microarchitecture</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Skylake¬ª </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Zen 2"</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nom de code</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Skylake SP"</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Rome" </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technologie de processus</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14nm</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 nm</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noyaux</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 24</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fr√©quence</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,9 GHz</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,4 GHz</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cache / socket L3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24 x 1,375 Mo</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 x 16 Mo</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©moire / socket</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 canaux, jusqu'√† DDR4-2400</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 canaux, jusqu'√† DDR4-3200</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDP</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x 150W</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">225W</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCIe / socket</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48 voies</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 voies</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EST UN</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86-64</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'apr√®s les sp√©cifications, il est clair que la puce d'AMD nous permettra de laisser le m√™me nombre de c≈ìurs, abaissant le TDP. </font><font style="vertical-align: inherit;">Dans la 9e g√©n√©ration, le TDP par c≈ìur √©tait de 6,25 watts, et dans la Xe g√©n√©ration, il sera de 4,69 watts. </font><font style="vertical-align: inherit;">Une diminution de 25%. </font><font style="vertical-align: inherit;">En raison de l'augmentation de la fr√©quence et, √©ventuellement, d'un circuit plus simple avec une seule prise, nous pouvons supposer que la puce AMD s'av√©rera meilleure en entreprise. </font><font style="vertical-align: inherit;">Pendant que nous effectuons divers tests et simulations pour comprendre les performances accrues d'AMD.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En attendant, nous notons que TDP est une m√©trique simplifi√©e √† partir des sp√©cifications du fabricant, que nous avons utilis√©e dans les premi√®res √©tapes de la conception du serveur et de la s√©lection du processeur. </font><font style="vertical-align: inherit;">Une recherche rapide sur Google montre qu'AMD et Intel ont des approches diff√©rentes de la d√©finition de TDP, c'est pourquoi cette sp√©cification n'est pas fiable. </font><font style="vertical-align: inherit;">La consommation d'√©nergie r√©elle du CPU et, plus important encore, la consommation d'√©nergie du serveur, est ce que nous utilisons vraiment pour prendre la d√©cision finale.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√©paration de l'√©cosyst√®me</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au d√©but de notre voyage vers le choix du prochain processeur, nous avons √©tudi√© un large √©ventail de CPU de diff√©rents fabricants qui √©taient bien adapt√©s √† notre pile de logiciels et √† nos services (√©crits en C, LuaJIT et Go). Nous avons d√©j√† d√©crit en d√©tail un ensemble d'outils pour mesurer la vitesse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans un article de notre blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans ce cas, nous avons utilis√© le m√™me ensemble - cela nous permet d'√©valuer l'efficacit√© du CPU dans un d√©lai raisonnable, apr√®s quoi nos ing√©nieurs peuvent commencer √† adapter nos programmes √† un processeur sp√©cifique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons test√© diff√©rents processeurs avec un nombre vari√© de c≈ìurs, de sockets et de fr√©quences. √âtant donn√© que cet article explique pourquoi nous nous sommes install√©s sur l'AMD EPYC 7642, tous les graphiques de ce blog se concentrent sur les performances des processeurs AMD par rapport √† l'Intel Xeon Platinum 6162 de</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notre 9e g√©n√©ration</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les r√©sultats correspondent √† des mesures du fonctionnement d'un serveur avec chaque variante de processeur, c'est-√†-dire avec deux processeurs 24 c≈ìurs d'Intel ou avec un processeur 48 c≈ìurs d'AMD (serveur pour Intel avec deux sockets et serveur pour AMD EPYC avec un). </font><font style="vertical-align: inherit;">Dans le BIOS, nous d√©finissons les param√®tres correspondant aux serveurs qui fonctionnent. </font><font style="vertical-align: inherit;">Ce sont 3,03 GHz pour AMD et 2,5 GHz pour Intel. </font><font style="vertical-align: inherit;">Simplifiant beaucoup, nous pr√©voyons qu'avec le m√™me nombre de c≈ìurs, AMD affichera des r√©sultats 21% meilleurs qu'Intel.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cryptographie</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/eb4/843/287/eb484328713741f6688d81c15a9c5920.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/598/82b/416/59882b416feabd9eea86ea9d99d1e1df.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela semble prometteur pour AMD. </font><font style="vertical-align: inherit;">Il fonctionne 18% mieux sur la cryptographie √† cl√© publique. </font><font style="vertical-align: inherit;">Avec une cl√© sym√©trique, il perd pour les options de cryptage AES-128-GCM, mais en g√©n√©ral il se montre comparable.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compression</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur les serveurs de p√©riph√©rie, nous compressons un grand nombre de donn√©es pour √©conomiser de la bande passante et augmenter la vitesse de livraison de contenu. </font><font style="vertical-align: inherit;">Nous transmettons les donn√©es via les biblioth√®ques zlib et brotli C. </font><font style="vertical-align: inherit;">Tous les tests ont eu lieu sur le fichier HTML blog.cloudflare.com en m√©moire. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/fdc/bf7/ae1/fdcbf7ae1109d02a45b2ca40fe353376.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/ccc/427/983/ccc427983ceb85dbf63bab614850692f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMD a remport√© une moyenne de 29% lors de l'utilisation de gzip. </font><font style="vertical-align: inherit;">Dans le cas de brotli, les r√©sultats sont encore meilleurs sur les tests de qualit√© 7, que nous utilisons pour la compression dynamique. </font><font style="vertical-align: inherit;">Une forte baisse se produit sur le test brotli-9 - nous l'attribuons au fait que Brotli consomme beaucoup de m√©moire et d√©borde le cache. </font><font style="vertical-align: inherit;">Cependant, AMD gagne par une large marge. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de nos services sont √©crits en Go. </font><font style="vertical-align: inherit;">Dans les graphiques suivants, nous rev√©rifions les taux de cryptographie et de compression sur Go avec RegExp sur des lignes de 32 Ko en utilisant la biblioth√®que de cha√Ænes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez la cryptographie</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/78a/ab0/495/78aab0495309cefee6f30bac835ee961.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez compression</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/f99/2cb/95d/f992cb95d4913a2d19808d4bd15b5b54.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/850/e7c/f55/850e7cf5586f693dd14d62f70510f681.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go regexp</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/b58/798/6cb/b587986cbab94ca7087364a949f09aa4.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/444/e76/f72/444e76f72c1ec2e93c4cae0c5bd386f2.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allez cordes</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/3e9/984/19a/3e998419adb450f598e0f3d82de01aa1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMD montre les meilleurs r√©sultats dans tous les tests avec Go, sauf le signe ECDSA P256, o√π il est 38% derri√®re - ce qui est √©trange, √©tant donn√© qu'il a montr√© 24% de meilleurs r√©sultats en C. </font><font style="vertical-align: inherit;">Cela vaut la peine de comprendre ce qui se passe l√†-bas. </font><font style="vertical-align: inherit;">Mais en g√©n√©ral, AMD ne gagne pas beaucoup, mais montre toujours les meilleurs r√©sultats.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luajit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons souvent LuaJIT dans la pile. </font><font style="vertical-align: inherit;">Ceci est la colle tenant toutes les parties de Cloudflare. </font><font style="vertical-align: inherit;">Et nous sommes heureux qu'AMD ait gagn√© ici. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, les tests montrent que EPYC 7642 fonctionne mieux que deux Xeon Platinum 6162. AMD perd sur une paire de tests - par exemple, AES-128-GCM et Go OpenSSL ECDSA-P256 Sign - cependant, il gagne sur tous les autres, en moyenne de 25% .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation de charge de travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s nos tests express, nous avons ex√©cut√© le serveur via un autre ensemble de simulations dans lesquelles la charge synth√©tique est appliqu√©e √† la pile de p√©riph√©rie logicielle. Ici, nous simulons une charge de travail de scripts avec diff√©rents types de requ√™tes qui peuvent √™tre trouv√©es dans le travail r√©el. Les demandes varient en termes de volume de donn√©es, de protocoles HTTP ou HTTPS, de WAF, de sources de travailleurs et autres √† partir d'une vari√©t√© de variables. Vous trouverez ci-dessous une comparaison du d√©bit des deux CPU pour les types de requ√™tes que nous trouvons le plus souvent.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/594/dbb/4cf/594dbb4cf570a1c22ff666d592884ef7.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les r√©sultats sur le diagramme sont mesur√©s par les indicateurs de base de la 9e g√©n√©ration de machines avec processeurs Intel, normalis√©s √† une valeur de 1,0 le long de l'axe x. </font><font style="vertical-align: inherit;">Par exemple, en prenant de simples requ√™tes de 10 Ko via HTTPS, nous pouvons voir qu'AMD est 1,5 fois mieux qu'Intel en termes de nombre de requ√™tes par seconde. </font><font style="vertical-align: inherit;">En moyenne, AMD a r√©alis√© 34% mieux pour les tests donn√©s qu'Intel. </font><font style="vertical-align: inherit;">Consid√©rant que le TDP pour un seul AMD EPYC 7642 est √©gal √† 225 W, et pour deux processeurs Intel - 300 W, il s'av√®re qu'en termes de ¬´demandes par watt¬ª, AMD affiche des r√©sultats 2 fois meilleurs qu'Intel!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce stade, nous √©tions clairement en faveur de l'option d'un seul socket pour AMD EPYC 7642 comme futurs CPU pour la g√©n√©ration X. Nous √©tions tr√®s int√©ress√©s de savoir comment les serveurs AMD EPYC se comportaient dans le travail r√©el, et nous avons imm√©diatement envoy√© plusieurs serveurs √† certains des centres de donn√©es.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Du vrai travail</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose, bien s√ªr, a √©t√© de pr√©parer le serveur au travail dans des conditions r√©elles. </font><font style="vertical-align: inherit;">Toutes les machines de notre flotte fonctionnent avec les m√™mes processus et services, ce qui en fait une excellente occasion de comparer correctement les performances. </font><font style="vertical-align: inherit;">Comme dans la plupart des centres de donn√©es, nous avons d√©ploy√© plusieurs g√©n√©rations de serveurs et nous assemblons nos serveurs en grappes afin que chaque classe contienne des serveurs d'environ la m√™me g√©n√©ration. </font><font style="vertical-align: inherit;">Dans certains cas, cela peut entra√Æner des courbes d'utilisation variant entre les clusters. </font><font style="vertical-align: inherit;">Mais pas avec nous. </font><font style="vertical-align: inherit;">Nos ing√©nieurs ont optimis√© l'utilisation du processeur pour toutes les g√©n√©rations afin que, ind√©pendamment du fait que le processeur ait 8 c≈ìurs sur une machine particuli√®re ou 24, l'utilisation du processeur n'est g√©n√©ralement pas diff√©rente des autres.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9b9/ea2/a9b/9b9ea2a9b8b70ad4e6e8f3b4e72200a3.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le graphique illustre notre commentaire sur la similitude d'utilisation - il n'y a pas de diff√©rence significative entre l'utilisation de processeurs AMD dans les serveurs de g√©n√©ration X et l'utilisation de processeurs Intel dans les serveurs de g√©n√©ration 9. Cela signifie que les serveurs de test et les serveurs principaux sont charg√©s de mani√®re √©gale. Bien. C'est exactement ce que nous r√©alisons dans le travail de nos serveurs, et nous en avons besoin pour une comparaison honn√™te. Les deux graphiques ci-dessous indiquent le nombre de demandes trait√©es par un c≈ìur de processeur et tous les c≈ìurs au niveau du serveur. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/075/8a6/91c/0758a691c0287281bd4c70bc1625d631.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requ√™tes au </font></font></i><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0a2/c5d/206/0a2c5d206c83c98cc06b910118a03a17.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serveur Requ√™tes au serveur</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On peut voir qu'en moyenne AMD traite 23% de demandes en plus. Pas mal du tout! Nous avons souvent √©crit sur notre blog des moyens d'augmenter les performances de la g√©n√©ration 9. Et ici, nous avons le m√™me nombre de c≈ìurs, mais AMD fait plus de travail avec moins d'√©nergie. Imm√©diatement √† partir des sp√©cifications du nombre de c≈ìurs et du TDP, on peut voir que AMD offre plus de vitesse avec une plus grande efficacit√© √©nerg√©tique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais, comme nous l'avons d√©j√† mentionn√©, le TDP n'est pas une sp√©cification standard, et ce n'est pas la m√™me chose pour tous les fabricants, alors regardons l'utilisation r√©elle de l'√©nergie. En mesurant la consommation d'√©nergie du serveur en parall√®le avec le nombre de requ√™tes par seconde, nous avons obtenu le graphique suivant:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/eac/f1a/a0f/eacf1aa0fcbee9f35c376bf52a7f37d1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par le nombre de requ√™tes par seconde d√©pens√©es par watt, le serveur Gen X sur les processeurs AMD est 28% plus efficace. On aurait pu s'attendre √† plus, √©tant donn√© que le TDP d'AMD est inf√©rieur de 25%, cependant, il faut se rappeler que le TDP est une caract√©ristique ambigu√´. Nous avons vu que la consommation d'√©nergie r√©elle d'AMD co√Øncide presque avec le TDP indiqu√© √† une fr√©quence bien au-dessus de la base; Intel n'a pas √ßa. C'est une autre raison pour laquelle le TDP n'est pas une estimation fiable de la consommation d'√©nergie. Les processeurs Intel de nos serveurs Gen 9 sont int√©gr√©s dans le syst√®me multicode, tandis que les processeurs AMD fonctionnent dans des serveurs au format 1U standard. Cela ne parle pas en faveur d'AMD, car les serveurs multi-n≈ìuds devraient fournir une densit√© plus √©lev√©e avec moins de consommation d'√©nergie par n≈ìud, mais AMD a toujours surclass√© Intel en termes de consommation d'√©nergie par n≈ìud.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la plupart des comparaisons sur les sp√©cifications, les simulations de test et le travail r√©el, la configuration de 1P AMD EPYC 7642 s'est av√©r√©e bien meilleure que 2P Intel Xeon 6162. Dans certaines conditions, AMD peut fonctionner 36% mieux, et nous pensons qu'en optimisant le mat√©riel et les programmes, nous nous pouvons obtenir une telle am√©lioration sur une base continue. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que AMD a gagn√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des graphiques suppl√©mentaires montrent le d√©lai moyen et le d√©lai p99 en fonctionnement NGINX pendant 24 heures. </font><font style="vertical-align: inherit;">En moyenne, les processus AMD ont fonctionn√© 25% plus rapidement. </font><font style="vertical-align: inherit;">√Ä p99, il fonctionne 20 √† 50% plus rapidement en fonction de l'heure de la journ√©e.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les ing√©nieurs du mat√©riel et des performances de Cloudflare effectuent un nombre important de tests et de recherches pour s√©lectionner la meilleure configuration de serveur pour nos clients. Nous aimons travailler ici parce que nous pouvons r√©soudre de telles t√¢ches grandioses, et aussi vous aider √† r√©soudre vos probl√®mes avec des services tels que l'informatique sans serveur et une gamme de solutions aux probl√®mes de s√©curit√©, en particulier, Magic Transit, Argo Tunnel et la protection DDoS . Tous les serveurs du r√©seau Cloudflare sont configur√©s pour un fonctionnement fiable, et nous essayons toujours de rendre chaque nouvelle g√©n√©ration de serveurs meilleure que la pr√©c√©dente. Nous pensons que AMD EPYC 7642 est la r√©ponse √† la question du choix des processeurs pour la g√©n√©ration X.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant le service Cloudflare Workers, les d√©veloppeurs d√©ploient leurs applications sur notre r√©seau, se d√©veloppant dans le monde entier. Nous sommes fiers d'offrir √† nos clients la possibilit√© de se concentrer sur l'√©criture de code pendant que nous travaillons sur la s√©curit√© et la fiabilit√© dans le cloud. Et aujourd'hui, nous sommes encore plus heureux d'annoncer que leur travail sera d√©ploy√© sur nos serveurs de g√©n√©ration Gen X ex√©cutant des processeurs AMD EPYC de deuxi√®me g√©n√©ration. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7de/304/54d/7de30454d5b87e7a32fceda1e3f7ca49.jpg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processeurs EPYC 7642, nom de code ¬´Rome¬ª [Rome]</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Gr√¢ce √† EPYC 7642 d'AMD, nous avons pu augmenter notre vitesse et faciliter l'expansion du r√©seau vers de nouvelles villes. Rome n'a pas √©t√© construite en un jour, mais bient√¥t elle sera plus proche de beaucoup d'entre vous.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours des deux derni√®res ann√©es, nous avons exp√©riment√© de nombreuses puces x86 d'Intel et d'AMD, ainsi que des processeurs d'ARM. </font><font style="vertical-align: inherit;">Nous esp√©rons qu'√† l'avenir, ces fabricants de CPU travailleront avec nous afin que nous puissions ensemble construire un Internet am√©lior√©.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493096/index.html">Ajouter un th√®me sombre dans iOS</a></li>
<li><a href="../fr493098/index.html">D√©ployer le cluster d'√©quilibrage de charge VPN ASA</a></li>
<li><a href="../fr493100/index.html">Comment trouver des moyens simples aide les startups √† atteindre une croissance agressive</a></li>
<li><a href="../fr493102/index.html">Tendances mondiales de l'automatisation: d√©veloppement RPA</a></li>
<li><a href="../fr493106/index.html">Quelle est la nouveaut√© de la Devil's Dozen?</a></li>
<li><a href="../fr493110/index.html">Comment d√©l√©guer dans le travail √† distance - un guide pour le chef d'√©quipe et plus</a></li>
<li><a href="../fr493112/index.html">Comment d√©marrer une nouvelle entreprise en 6 mois au lieu de 3 ans</a></li>
<li><a href="../fr493114/index.html">Comment Data Engineer a regard√© les donn√©es</a></li>
<li><a href="../fr493116/index.html">"Plus d'interactivit√©!" ou comment √©tait TeamLead Conf 2020</a></li>
<li><a href="../fr493118/index.html">Pr√©sentation de l'extension d'√©tiquetage de m√©moire (Armv8.5-A)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>