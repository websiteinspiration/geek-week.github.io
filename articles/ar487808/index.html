<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ป ๐ง๐ฝ ๐ง๐ผ ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุงููุชูุฑุฑุฉ (RNN) ูุน Keras ๐ ๐คณ๐ผ ๐ด๓ง๓ข๓ณ๓ฃ๓ด๓ฟ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชุฑุฌูุฉ ุฏููู ุงูุดุจูุฉ ุงูุนุตุจูุฉ ุงูุนูุฏูุฉ ูู Tensorflow.org. ุชูุงูุด ุงููุงุฏุฉ ููุงู ูู ุงููุฏุฑุงุช ุงููุฏูุฌุฉ ูู Keras / Tensorflow 2.0 ููุชุดุจูู ุงูุณุฑูุน ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅููุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุงููุชูุฑุฑุฉ (RNN) ูุน Keras</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487808/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุฌูุฉ ุฏููู ุงูุดุจูุฉ ุงูุนุตุจูุฉ ุงูุนูุฏูุฉ ูู Tensorflow.org. </font><font style="vertical-align: inherit;">ุชูุงูุด ุงููุงุฏุฉ ููุงู ูู ุงููุฏุฑุงุช ุงููุฏูุฌุฉ ูู Keras / Tensorflow 2.0 ููุชุดุจูู ุงูุณุฑูุน ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅููุงููุฉ ุชุฎุตูุต ุงูุทุจูุงุช ูุงูุฎูุงูุง. </font><font style="vertical-align: inherit;">ููุง ูุชู ุงููุธุฑ ูู ุญุงูุงุช ูุญุฏูุฏ ุงุณุชุฎุฏุงู ููุงุฉ CuDNN ุ ููุง ูุณูุญ ุจุชุณุฑูุน ุนูููุฉ ุชุนูู ุงูุดุจูุฉ ุงูุนุตุจูุฉ.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xt/_q/nj/xt_qnjgfjengqoqd4gizkq4j_wk.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุงูุนูุฏูุฉ (RNNs) ูู ูุฆุฉ ูู ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุฌูุฏุฉ ูููุฐุฌุฉ ุงูุจูุงูุงุช ุงูุชุณูุณููุฉ ุ ูุซู ุงูุณูุงุณู ุงูุฒูููุฉ ุฃู ุงููุบุฉ ุงูุทุจูุนูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงูุช ุงูุทุจูุฉ RNN ุชุณุชุฎุฏู ุจุดูู ุชุฎุทูุทู ุญููุฉ </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุฑุงุฑ ุนุจุฑ ุชุณูุณู ูุฑุชุจ ุญุณุจ ุงูููุช ุ ุฃุซูุงุก ุงูุชุฎุฒูู ูู ุญุงูุฉ ุฏุงุฎููุฉ ุ ูุชู ุชุฑููุฒ ุงููุนูููุงุช ุญูู ุงูุฎุทูุงุช ุงูุชู ุดุงูุฏูุง ุจุงููุนู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชู ุชุตููู Keras RNN API ูุน ุงูุชุฑููุฒ ุนูู: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููุฉ ุงูุงุณุชุฎุฏุงู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ุงููุฏูุฌ ูู ุทุจูุงุช </font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>tf.keras.layers.LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>tf.keras.layers.GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณูุญ ูู ูุจูุงุก ุจุณุฑุนุฉ ูููุฐุฌุง ูุชูุฑุฑุฉ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุฅุฌุฑุงุก ุฅุนุฏุงุฏุงุช ุงูุชูููู ูุนูุฏุฉ. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฎุตูุต ุงูุณูู</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ููููู ุฃูุถูุง ุชุญุฏูุฏ ุงูุทุจูุฉ ุงูุฎุงุตุฉ ุจู ูู ุฎูุงูุง RNN (ุงูุฌุฒุก ุงูุฏุงุฎูู ูู ุงูุญููุฉ</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ูุน ุงูุณููู ุงููุฎุตุต ูุงุณุชุฎุฏุงูู ูุน ุทุจูุฉ ูุดุชุฑูุฉ ูู `tf.keras.layers.RNN` (ุญููุฉ` for` ููุณูุง). </font><font style="vertical-align: inherit;">ุณูุชูุญ ูู ุฐูู ูุถุน ููุงุฐุฌ ูุฃููุงุฑ ุงูุจุญุซ ุงููุฎุชููุฉ ุจุณุฑุนุฉ ูุจุฃุณููุจ ูุฑู ุ ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฑููุจ</font></font></h2><br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> absolute_import, division, print_function, unicode_literals<font></font>
<font></font>
<span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<font></font>
<font></font>
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> layers</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุงุก ูููุฐุฌ ุจุณูุท</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุชูู Keras ุนูู ุซูุงุซ ุทุจูุงุช RNN ูุถููุฉ:</font></font><br>
<br>
<ol>
<li><code>tf.keras.layers.SimpleRNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ RNN ูุชุตู ุจุงููุงูู ุจุญูุซ ูุชู ุชูุฑูุฑ ูุงุชุฌ ุงูุฎุทูุฉ ุงูุฒูููุฉ ุงูุณุงุจูุฉ ุฅูู ุงูุฎุทูุฉ ุงูุชุงููุฉ.</font></font></li>
<li><code>tf.keras.layers.GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุงูุชุฑุญ ูุฃูู ูุฑุฉ ูู ุงูููุงูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุฑุงุณุฉ ุงูุนุจุงุฑุงุช ุจุงุณุชุฎุฏุงู ุจุฑูุงูุฌ ุงูุชุฑููุฒ RNN ููุชุฑุฌูุฉ ุงูุขููุฉ ุงูุฅุญุตุงุฆูุฉ</font></font></a></li>
<li><code>tf.keras.layers.LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุงูุชุฑุญ ูุฃูู ูุฑุฉ ูู ููุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทููู ุงูุฃูุฏ ุงูุฐุงูุฑุฉ ูุตูุฑุฉ ุงููุฏู</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุฃูุงุฆู ุนุงู 2015 ุ ูุฏูุช Keras ุฃูู ุชุทุจููุงุช ููุชูุญุฉ ุงููุตุฏุฑ ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู Python ู LSTM ู GRU. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุง ููู ูุซุงู ุนูู </font></font><code>Sequential</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุฐุฌ ูุนุงูุฌ ุชุณูุณู ุงูุฃุนุฏุงุฏ ุงูุตุญูุญุฉ ุนู ุทุฑูู ุชุฏุงุฎู ูู ุนุฏุฏ ุตุญูุญ ูู ูุงูู 64-ุงูุฃุจุนุงุฏ ุ ุซู ูุนุงูุฌุฉ ุชุณูุณูุงุช ุงููุชุฌูุงุช ุจุงุณุชุฎุฏุงู ุทุจูุฉ </font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential()
<span class="hljs-comment">#   Embedding      1000, </span>
<span class="hljs-comment">#     64.</span>
model.add(layers.Embedding(input_dim=<span class="hljs-number">1000</span>, output_dim=<span class="hljs-number">64</span>))<font></font>
<font></font>
<span class="hljs-comment">#   LSTM  128  .</span>
model.add(layers.LSTM(<span class="hljs-number">128</span>))<font></font>
<font></font>
<span class="hljs-comment">#   Dense  10    softmax.</span>
model.add(layers.Dense(<span class="hljs-number">10</span>))<font></font>
<font></font>
model.summary()</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฎุฑุฌุงุช ูุงูุญุงูุงุช</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุดูู ุงูุชุฑุงุถู ุ ูุญุชูู ุฅุฎุฑุงุฌ ุทุจูุฉ RNN ุนูู ูุชุฌู ูุงุญุฏ ููู ุนูุตุฑ. ูุฐุง ุงููุชุฌู ูู ุฅุฎุฑุงุฌ ุขุฎุฑ ุฎููุฉ RNN ุชุญุชูู ุนูู ูุนูููุงุช ุญูู ุชุณูุณู ุงูุฅุฏุฎุงู ุจุฃูููู. ุจูุนุฏ ูุฐุง ุงูุฅุฎุฑุงุฌ </font></font><code>(batch_size, units)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุญูุซ </font></font><code>units</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุงูู ูุน ุงููุณูุทุฉ ุงูุชู </font></font><code>units</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชู ุชูุฑูุฑูุง ุฅูู ูููุดุฆ ุงูุทุจูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ูุทุจูุฉ RNN ุฃูุถูุง ุฅุฑุฌุงุน ุชุณูุณู ุงูุฅุฎุฑุงุฌ ุงููุงูู ููู ุนูุตุฑ (ูุชุฌู ูุงุญุฏ ููู ุฎุทูุฉ) ุ ุฅุฐุง ุญุฏุฏุช </font></font><code>return_sequences=True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ุงูุจุนุฏ ูู ูุฐุง ุงููุงุชุฌ </font></font><code>(batch_size, timesteps, units)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
model.add(layers.Embedding(input_dim=<span class="hljs-number">1000</span>, output_dim=<span class="hljs-number">64</span>))<font></font>
<font></font>
<span class="hljs-comment">#  GRU  3D   (batch_size, timesteps, 256)</span>
model.add(layers.GRU(<span class="hljs-number">256</span>, return_sequences=<span class="hljs-literal">True</span>))<font></font>
<font></font>
<span class="hljs-comment">#  SimpleRNN  2D   (batch_size, 128)</span>
model.add(layers.SimpleRNN(<span class="hljs-number">128</span>))<font></font>
<font></font>
model.add(layers.Dense(<span class="hljs-number">10</span>))<font></font>
<font></font>
model.summary()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ูุทุจูุฉ RNN ุฅุฑุฌุงุน ุญุงูุชูุง (ุญุงูุงุชูุง) ุงูุฏุงุฎููุฉ ุงูููุงุฆูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุงุณุชุฎุฏุงู ุงูุญุงูุงุช ุงููุฑุชุฌุนุฉ ูุงุญููุง ูุงุณุชุฆูุงู ุชูููุฐ RNN ุฃู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชููุฆุฉ RNN ุฃุฎุฑู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ููุณุชุฎุฏู ูุฐุง ุงูุฅุนุฏุงุฏ ุนุงุฏุฉู ูู ูููุฐุฌ ูุญุฏุฉ ุงูุชุดููุฑ - ุงูุชุดููุฑ ุ ุจุงูุชุณูุณู ุฅูู ุงูุชุณูุณู ุ ุญูุซ ูุชู ุงุณุชุฎุฏุงู ุงูุญุงูุฉ ุงูููุงุฆูุฉ ูููุดูุฑุฉ ููุญุงูุฉ ุงูุฃูููุฉ ููููู ุงูุดูุฑุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููู ุชููู ุทุจูุฉ RNN ุจุฅุนุงุฏุฉ ุญุงูุชูุง ุงูุฏุงุฎููุฉ ุ ูู ุจุชุนููู ุงููุนููุฉ </font></font><code>return_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงููููุฉ </font></font><code>True</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏ ุฅูุดุงุก ุงูุทุจูุฉ. ูุงุญุธ ุฃู ููุงู </font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุฑุงู ูุญุงูุฉ ุงูููุงูุฉ </font></font><code>GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุญุฏ ููุท. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุถุจุท ุงูุญุงูุฉ ุงูุฃูููุฉ ููุทุจูุฉ ุ ูุง ุนููู ุณูู ุงุณุชุฏุนุงุก ุงูุทุจูุฉ ุจุญุฌุฉ ุฅุถุงููุฉ </font></font><code>initial_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงุญุธ ุฃู ุงูุจุนุฏ ูุฌุจ ุฃู ูุชุทุงุจู ูุน ุจูุนุฏ ุนูุตุฑ ุงูุทุจูุฉ ุ ููุง ูู ุงููุซุงู ุงูุชุงูู.</font></font><br>
<br>
<pre><code class="python hljs">encoder_vocab = <span class="hljs-number">1000</span>
decoder_vocab = <span class="hljs-number">2000</span><font></font>
<font></font>
encoder_input = layers.Input(shape=(<span class="hljs-literal">None</span>, ))<font></font>
encoder_embedded = layers.Embedding(input_dim=encoder_vocab, output_dim=<span class="hljs-number">64</span>)(encoder_input)<font></font>
<font></font>
<span class="hljs-comment">#       </span><font></font>
output, state_h, state_c = layers.LSTM(<font></font>
    <span class="hljs-number">64</span>, return_state=<span class="hljs-literal">True</span>, name=<span class="hljs-string">'encoder'</span>)(encoder_embedded)<font></font>
encoder_state = [state_h, state_c]<font></font>
<font></font>
decoder_input = layers.Input(shape=(<span class="hljs-literal">None</span>, ))<font></font>
decoder_embedded = layers.Embedding(input_dim=decoder_vocab, output_dim=<span class="hljs-number">64</span>)(decoder_input)<font></font>
<font></font>
<span class="hljs-comment">#  2     LSTM    </span><font></font>
decoder_output = layers.LSTM(<font></font>
    <span class="hljs-number">64</span>, name=<span class="hljs-string">'decoder'</span>)(decoder_embedded, initial_state=encoder_state)<font></font>
output = layers.Dense(<span class="hljs-number">10</span>)(decoder_output)<font></font>
<font></font>
model = tf.keras.Model([encoder_input, decoder_input], output)<font></font>
model.summary()<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุจูุงุช RNN ูุฎูุงูุง RNN</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชููุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช RNN ุ ุจุงูุฅุถุงูุฉ ุฅูู ุทุจูุงุช RNN ุงููุฏูุฌุฉ ุ ูุงุฌูุงุช ุจุฑูุฌุฉ ุชุทุจููุงุช ุนูู ูุณุชูู ุงูุฎููุฉ. </font><font style="vertical-align: inherit;">ุนูู ุนูุณ ุทุจูุงุช RNN ุ ุงูุชู ุชุนุงูุฌ ุญุฒู ูุงููุฉ ูู ุชุณูุณูุงุช ุงูุฅุฏุฎุงู ุ ุชุนุงูุฌ ุฎููุฉ RNN ุฎุทูุฉ ุฒูููุฉ ูุงุญุฏุฉ ููุท. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฎููุฉ ุฏุงุฎู ุฏูุฑุฉ </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุจูุฉ RNN. </font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุญู </font><font style="vertical-align: inherit;">ุงูุชูุงู ุงูุฎููุฉ ุจุทุจูุฉ </font><font style="vertical-align: inherit;">ุทุจูุฉ ูุงุฏุฑุฉ ุนูู ูุนุงูุฌุฉ ุญุฒู ุชุณูุณู ุ ุนูู ุณุจูู ุงููุซุงู </font></font><code>RNN(LSTMCell(10))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฑูุงุถูุง ุ </font></font><code>RNN(LSTMCell(10))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุทู ููุณ ุงููุชูุฌุฉ </font></font><code>LSTM(10)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูู ุงููุงูุน ุ ูุงู ุชูููุฐ ูุฐู ุงูุทุจูุฉ ุฏุงุฎู TF v1.x ููุท ูุฅูุดุงุก ุฎููุฉ RNN ุงูููุงุจูุฉ ููููุง ูู ุทุจูุฉ RNN. </font><font style="vertical-align: inherit;">ููุน ุฐููุ ูุฅู ุงุณุชุฎุฏุงู ุทุจูุงุช ุฌุฒุกุง ูุง ูุชุฌุฒุฃ ูู </font></font><code>GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุญ ุงุณุชุฎุฏุงู CuDNN ุงูุชู ูููู ุฃู ุชุนุทูู ุฃุฏุงุก ุฃูุถู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุซูุงุซ ุฎูุงูุง RNN ูุฏูุฌุฉ ุ ูู ูููุง ูุชูุงูู ูุน ุทุจูุฉ RNN ุงูุฎุงุตุฉ ุจู.</font></font><br>
<br>
<ul>
<li><code>tf.keras.layers.SimpleRNNCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทุงุจู ุงูุทุจูุฉ </font></font><code>SimpleRNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><code>tf.keras.layers.GRUCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทุงุจู ุงูุทุจูุฉ </font></font><code>GRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><code>tf.keras.layers.LSTMCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทุงุจู ุงูุทุจูุฉ </font></font><code>LSTM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅู ุงุณุชุฎูุงุต ุฎููุฉ ูุน ูุฆุฉ ูุดุชุฑูุฉ </font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุนู ูู ุงูุณูู ุฌุฏูุง ุชูููุฐ ุจูู RNN ุงููุฎุตุตุฉ ูุจุญุซู.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌููุนุฉ ุญูุธ ุนุจุฑ ุงูุฏูุนุฉ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏ ูุนุงูุฌุฉ ุชุณูุณูุงุช ุทูููุฉ (ุฑุจูุง ูุง ุญุตุฑ ููุง) ุ ูุฏ ุชุฑุบุจ ูู ุงุณุชุฎุฏุงู ููุท ุงูุญุงูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุจุฑ ุงูุฏูุนุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนุงุฏุฉ ุ ูุชู ุฅุนุงุฏุฉ ุชุนููู ุงูุญุงูุฉ ุงูุฏุงุฎููุฉ ูุทุจูุฉ RNN ูุน ูู ุญุฒูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ (ุฃู ูู ูุซุงู ูุฑู ุฃู ุงูุทุจูุฉ ููุชุฑุถ ุฃููุง ูุณุชููุฉ ุนู ุงููุงุถู). ุณุชุญุงูุธ ุงูุทุจูุฉ ุนูู ุงูุญุงูุฉ ููุท ุทูุงู ูุฏุฉ ูุนุงูุฌุฉ ูุฐุง ุงูุนูุตุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุน ุฐูู ุ ุฅุฐุง ูุงู ูุฏูู ุชุณูุณูุงุช ุทูููุฉ ุฌุฏูุง ุ ููู ุงููููุฏ ุชูุณูููุง ุฅูู ุชุณูุณู ุฃูุตุฑ ูููููุง ุฅูู ุทุจูุฉ RNN ุจุฏูุฑูุง ุฏูู ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุทุจูุฉ. ูุจุงูุชุงูู ุ ูููู ููุทุจูุฉ ุชุฎุฒูู ูุนูููุงุช ุญูู ุงูุชุณูุณู ุจุฃูููู ุ ุนูู ุงูุฑุบู ูู ุฃููุง ุณุชุฑู ุชุชุงุจุนูุง ูุงุญุฏูุง ููุท ูู ูู ูุฑุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุชุนููู `stateful = True` ูู ุงููููุดุฆ.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅุฐุง ูุงู ูุฏูู ุงูุชุณูุณู `s = [t0ุ t1ุ ... t1546ุ t1547]` ุ ููููู ุชูุณููู ุนูู ุณุจูู ุงููุซุงู ุฅูู:</font></font><br>
<br>
<pre><code class="python hljs">s1 = [t0, t1, ... t100]<font></font>
s2 = [t101, ... t201]<font></font>
...<font></font>
s16 = [t1501, ... t1547]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุซู ููููู ูุนุงูุฌุชูุง ุจุงุณุชุฎุฏุงู:</font></font><br>
<br>
<pre><code class="python hljs">lstm_layer = layers.LSTM(<span class="hljs-number">64</span>, stateful=<span class="hljs-literal">True</span>)
<span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> sub_sequences:<font></font>
  output = lstm_layer(s)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูุฏูุง ุชุฑูุฏ ุชูุธูู ุงูุญุงูุฉ ุ ุงุณุชุฎุฏู </font></font><code>layer.reset_states()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุญุธุฉ:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุฐู ุงูุญุงูุฉ ุ ูููุชุฑุถ ุฃู ุงููุซุงู </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุฒูุฉ ูู ุงุณุชูุฑุงุฑ ููุซุงู </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุฒูุฉ ุงูุณุงุจูุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃู ุฌููุน ุงูุญุฒู ุชุญุชูู ุนูู ููุณ ุนุฏุฏ ุงูุนูุงุตุฑ (ุญุฌู ุงูุนุจูุฉ). </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูุงูุช ุงูุญุฒูุฉ ุชุญุชูู ุนูู </font></font><code>[sequence_A_from_t0_to_t100, sequence_B_from_t0_to_t100]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุฌุจ ุฃู ุชุญุชูู ุงูุญุฒูุฉ ุงูุชุงููุฉ </font></font><code>[sequence_A_from_t101_to_t200, sequence_B_from_t101_to_t200]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูุซุงู ูุงูู:</font></font><br>
<br>
<pre><code class="python hljs">paragraph1 = np.random.random((<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)).astype(np.float32)<font></font>
paragraph2 = np.random.random((<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)).astype(np.float32)<font></font>
paragraph3 = np.random.random((<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)).astype(np.float32)<font></font>
<font></font>
lstm_layer = layers.LSTM(<span class="hljs-number">64</span>, stateful=<span class="hljs-literal">True</span>)<font></font>
output = lstm_layer(paragraph1)<font></font>
output = lstm_layer(paragraph2)<font></font>
output = lstm_layer(paragraph3)<font></font>
<font></font>
<span class="hljs-comment"># reset_states()      initial_state.</span>
<span class="hljs-comment">#  initial_state   ,      .</span>
lstm_layer.reset_states()</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RNN ุซูุงุฆู ุงูุงุชุฌุงู</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงููุณุจุฉ ููุชุณูุณูุงุช ุจุฎูุงู ุงูุณูุงุณู ุงูุฒูููุฉ (ูุซู ุงููุตูุต) ุ ุบุงูุจูุง ูุง ูุญุฏุซ ุฃู ูููุฐุฌ RNN ูุนูู ุจุดูู ุฃูุถู ุฅุฐุง ูุงู ูุนุงูุฌ ุงูุชุณูุณู ููุณ ููุท ูู ุงูุจุฏุงูุฉ ุฅูู ุงูููุงูุฉ ุ ูููู ุฃูุถูุง ุจุงูุนูุณ. ุนูู ุณุจูู ุงููุซุงู ุ ููุชูุจุค ุจุงููููุฉ ุงูุชุงููุฉ ูู ุงูุฌููุฉ ุ ุบุงูุจูุง ูุง ูููู ูู ุงููููุฏ ูุนุฑูุฉ ุงูุณูุงู ุญูู ุงููููุฉ ุ ูููุณ ููุท ุงููููุงุช ุงูููุฌูุฏุฉ ุฃูุงููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููุฑ Keras ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุจุณูุทุฉ ูุฅูุดุงุก ุดุจูุงุช RNN ุซูุงุฆูุฉ ุงูุงุชุฌุงู: ุบูุงู </font></font><code>tf.keras.layers.Bidirectional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs">model = tf.keras.Sequential()<font></font>
<font></font>
model.add(layers.Bidirectional(layers.LSTM(<span class="hljs-number">64</span>, return_sequences=<span class="hljs-literal">True</span>), <font></font>
                               input_shape=(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)))<font></font>
model.add(layers.Bidirectional(layers.LSTM(<span class="hljs-number">32</span>)))<font></font>
model.add(layers.Dense(<span class="hljs-number">10</span>))<font></font>
<font></font>
model.summary()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุญุช ุบุทุงุก ุงููุญุฑู ุ </font><font style="vertical-align: inherit;">ุณูุชู ูุณุฎ </font></font><code>Bidirectional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุจูุฉ RNN ุงููููููุฉ </font></font><code>go_backwards</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุชู </font><font style="vertical-align: inherit;">ููุจ ุญูู </font><font style="vertical-align: inherit;">ุงูุทุจูุฉ ุงูููุณูุฎุฉ ุญุฏูุซูุง ุ ูุจุงูุชุงูู ุณูุชู ูุนุงูุฌุฉ ุจูุงูุงุช ุงูุฅุฏุฎุงู ุจุชุฑุชูุจ ุนูุณู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูููู ุฎุฑุฌ ` </font></font><code>Bidirectional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RNN ุจุดูู ุงูุชุฑุงุถู ูู ูุฌููุน ูุงุชุฌ ุงูุทุจูุฉ ุงูุฃูุงููุฉ ูุฎุฑุฌ ุงูุทุจูุฉ ุงูุนูุณูุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุณููู ุฏูุฌ ุขุฎุฑ ุ ุนูู ุณุจูู ุงููุซุงู </font><font style="vertical-align: inherit;">ุชุณูุณู ุ ูู ุจุชุบููุฑ ุงููุนููุฉ `merge_mode` ูู ูููุดุฆ ุงููุฌููุน` ุซูุงุฆู ุงูุงุชุฌุงู`.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญุณูู ุงูุฃุฏุงุก ู CuDNN Core ูู TensorFlow 2.0</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู TensorFlow 2.0 ุ ูููู ุงุณุชุฎุฏุงู ุทุจูุงุช LSTM ู GRU ุงููุถููุฉ ุจุดูู ุงูุชุฑุงุถู ููู CuDNN ุฅุฐุง ูุงู ูุนุงูุฌ ุงูุฑุณููุงุช ูุชุงุญูุง. </font><font style="vertical-align: inherit;">ูุน ูุฐุง ุงูุชุบููุฑ ุ ุชููู ุงูุทุจูุงุช ุงูุณุงุจูุฉ </font></font><code>keras.layers.CuDNNLSTM/CuDNNGRU</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏููุฉ ุ ูููููู ุจูุงุก ูููุฐุฌู ุฏูู ุงูููู ุจุดุฃู ุงููุนุฏุงุช ุงูุชู ุณุชุนูู ุนูููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃู ููุงุฉ CuDNN ูุจููุฉ ุจุจุนุถ ุงูุงูุชุฑุงุถุงุช ุ ูุฅู ูุฐุง ูุนูู ุฃู ุงูุทุจูุฉ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุชููู ูู ุงุณุชุฎุฏุงู ุทุจูุฉ ููุงุฉ CuDNN ุฅุฐุง ููุช ุจุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ูุทุจูุงุช LSTM ุฃู GRU ุงููุฏูุฌุฉ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุบููุฑ ูุธููุฉ </font></font><code>activation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><code>tanh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูุก ุขุฎุฑ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุบููุฑ ูุธููุฉ </font></font><code>recurrent_activation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><code>sigmoid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดูุก ุขุฎุฑ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุงุณุชุฎุฏุงู </font></font><code>recurrent_dropout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; 0.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนููููุง </font></font><code>unroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู Trueุ ูุงูุฐู ูุณุจุจ LSTM / GRU ูุชุชุญูู ุงูุฏุงุฎููุฉ </font></font><code>tf.while_loop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุญููุฉ ูุดุฑูุง </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนููู </font></font><code>use_bias</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุฎุทุฃ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู ุงูุฃููุนุฉ ุนูุฏูุง ุชููู ุจูุงูุงุช ุงูุฅุฏุฎุงู ุบูุฑ ูุจุฑุฑุฉ ุจุดูู ุตุญูุญ (ุฅุฐุง ูุงู ุงูููุงุน ูุทุงุจู ุงูุจูุงูุงุช ุงูุตุญูุญุฉ ุงููุญุงุฐุงุฉ ุจุฏูุฉ ุ ููุง ูุฒุงู ูู ุงููููู ุงุณุชุฎุฏุงู CuDNN. ูุฐู ูู ุงูุญุงูุฉ ุงูุฃูุซุฑ ุดููุนูุง).</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏ ุงูุฅููุงู ุงุณุชุฎุฏู ููู CuDNN</font></font></h3><br>
<pre><code class="python hljs">batch_size = <span class="hljs-number">64</span>
<span class="hljs-comment">#    MNIST    (batch_size, 28, 28).</span>
<span class="hljs-comment">#     (28, 28) (   ).</span>
input_dim = <span class="hljs-number">28</span><font></font>
<font></font>
units = <span class="hljs-number">64</span>
output_size = <span class="hljs-number">10</span>  <span class="hljs-comment">#   0  9</span><font></font>
<font></font>
<span class="hljs-comment">#  RNN </span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model</span>(<span class="hljs-params">allow_cudnn_kernel=True</span>):</span>
  <span class="hljs-comment"># CuDNN     ,     .</span>
  <span class="hljs-comment">#   `LSTM(units)`    CuDNN,</span>
  <span class="hljs-comment">#   RNN(LSTMCell(units))   non-CuDNN .</span>
  <span class="hljs-keyword">if</span> allow_cudnn_kernel:
    <span class="hljs-comment">#  LSTM      CuDNN.</span>
    lstm_layer = tf.keras.layers.LSTM(units, input_shape=(<span class="hljs-literal">None</span>, input_dim))
  <span class="hljs-keyword">else</span>:
    <span class="hljs-comment">#  LSTMCell  RNN    CuDNN.</span><font></font>
    lstm_layer = tf.keras.layers.RNN(<font></font>
        tf.keras.layers.LSTMCell(units),<font></font>
        input_shape=(<span class="hljs-literal">None</span>, input_dim))<font></font>
  model = tf.keras.models.Sequential([<font></font>
      lstm_layer,<font></font>
      tf.keras.layers.BatchNormalization(),<font></font>
      tf.keras.layers.Dense(output_size)]<font></font>
  )<font></font>
  <span class="hljs-keyword">return</span> model
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุญููู ูุฌููุนุฉ ุจูุงูุงุช MNIST</font></font></h3><br>
<pre><code class="python hljs">mnist = tf.keras.datasets.mnist<font></font>
<font></font>
(x_train, y_train), (x_test, y_test) = mnist.load_data()<font></font>
x_train, x_test = x_train / <span class="hljs-number">255.0</span>, x_test / <span class="hljs-number">255.0</span>
sample, sample_label = x_train[<span class="hljs-number">0</span>], y_train[<span class="hljs-number">0</span>]</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ูุซูู ูู ุงููููุฐุฌ ูุชุฌููุนู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ุงุฎุชุฑูุง </font></font><code>sparse_categorical_crossentropy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุงูุฉ ููุฎุณุงุฆุฑ. </font><font style="vertical-align: inherit;">ูุงุชุฌ ุงููููุฐุฌ ูู ุจุนุฏ </font></font><code>[batch_size, 10]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุฅุฌุงุจุฉ ุงููููุฐุฌ ูุชุฌู ุนุฏุฏ ุตุญูุญ ุ ูู ูู ุงูุฃุฑูุงู ูู ุงููุทุงู ูู 0 ุฅูู 9.</font></font><br>
<br>
<pre><code class="python hljs">model = build_model(allow_cudnn_kernel=<span class="hljs-literal">True</span>)<font></font>
<font></font>
model.compile(loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="hljs-literal">True</span>), <font></font>
              optimizer=<span class="hljs-string">'sgd'</span>,<font></font>
              metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre><br>
<pre><code class="python hljs">model.fit(x_train, y_train,<font></font>
          validation_data=(x_test, y_test),<font></font>
          batch_size=batch_size,<font></font>
          epochs=<span class="hljs-number">5</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุจูุงุก ูููุฐุฌ ุฌุฏูุฏ ุจุฏูู ููุงุฉ CuDNN</font></font></h3><br>
<pre><code class="python hljs">slow_model = build_model(allow_cudnn_kernel=<span class="hljs-literal">False</span>)<font></font>
slow_model.set_weights(model.get_weights())<font></font>
slow_model.compile(loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="hljs-literal">True</span>), <font></font>
                   optimizer=<span class="hljs-string">'sgd'</span>, <font></font>
                   metrics=[<span class="hljs-string">'accuracy'</span>])<font></font>
slow_model.fit(x_train, y_train, <font></font>
               validation_data=(x_test, y_test), <font></font>
               batch_size=batch_size,<font></font>
               epochs=<span class="hljs-number">1</span>)  <span class="hljs-comment">#         .</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุชุฑู ุ ูุฅู ุงููููุฐุฌ ุงููุตูู ุจุงุณุชุฎุฏุงู CuDNN ุฃุณุฑุน ุจูุซูุฑ ูู ุงูุชุฏุฑูุจ ูู ุงููููุฐุฌ ุจุงุณุชุฎุฏุงู ููุงุฉ TensorFlow ุงููุนุชุงุฏุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุงุณุชุฎุฏุงู ููุณ ุงููููุฐุฌ ูุน ุฏุนู CuDNN ููุฅุฎุฑุงุฌ ูู ุจูุฆุฉ ุงููุนุงูุฌ ุงููุงุญุฏ. </font></font><code>tf.device</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดูุฑ </font><font style="vertical-align: inherit;">ุงูุชุนููู ุงูุชูุถูุญู </font><font style="vertical-align: inherit;">ุจุจุณุงุทุฉ ุฅูู ุงูุฌูุงุฒ ุงููุณุชุฎุฏู. </font><font style="vertical-align: inherit;">ุณูุชู ุชุดุบูู ุงููููุฐุฌ ุจุดูู ุงูุชุฑุงุถู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุฅุฐุง ูู ููู GPU ูุชุงุญูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ุฏุงุนู ููููู ุจุดุฃู ุงูุฃุฌูุฒุฉ ุงูุชู ุชุนูู ุนูููุง. </font><font style="vertical-align: inherit;">ุฃููุณ ูุฐุง ุฑุงุฆุนุงุ</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">with</span> tf.device(<span class="hljs-string">'CPU:0'</span>):<font></font>
  cpu_model = build_model(allow_cudnn_kernel=<span class="hljs-literal">True</span>)<font></font>
  cpu_model.set_weights(model.get_weights())<font></font>
  result = tf.argmax(cpu_model.predict_on_batch(tf.expand_dims(sample, <span class="hljs-number">0</span>)), axis=<span class="hljs-number">1</span>)<font></font>
  print(<span class="hljs-string">'Predicted result is: %s, target result is: %s'</span> % (result.numpy(), sample_label))<font></font>
  plt.imshow(sample, cmap=plt.get_cmap(<span class="hljs-string">'gray'</span>))
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RNN ูุน ุฅุฏุฎุงู ูุงุฆูุฉ / ูุงููุณ ุ ุฃู ุฅุฏุฎุงู ูุชุฏุงุฎู</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุชุชูุญ ูู ุงูููุงูู ุงููุชุฏุงุฎูุฉ ุชุถููู ุงููุฒูุฏ ูู ุงููุนูููุงุช ูู ุฎุทูุฉ ูุงุญุฏุฉ. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูุฏ ูุญุชูู ุฅุทุงุฑ ุงูููุฏูู ุนูู ุฅุฏุฎุงู ุตูุช ูููุฏูู ูู ููุณ ุงูููุช. </font><font style="vertical-align: inherit;">ูุฏ ูููู ุญุฌู ุงูุจูุงูุงุช ูู ูุฐู ุงูุญุงูุฉ:</font></font><br>
<br>
<pre><code class="plaintext hljs">[batch, timestep, {\"video\": [height, width, channel], \"audio\": [frequency]}]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ูุซุงู ุขุฎุฑ ุ ูููู ุฃู ุชุญุชูู ุงูุจูุงูุงุช ุงูููุชูุจุฉ ุจุฎุท ุงููุฏ ุนูู ุฅุญุฏุงุซูุงุช x ู y ูููุถุน ุงูููู ุงูุญุงูู ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุนูููุงุช ุงูุถุบุท. </font><font style="vertical-align: inherit;">ูุฐูู ูููู ุชูุซูู ุงูุจูุงูุงุช ุนูู ุงููุญู ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="plaintext hljs">[batch, timestep, {\"location\": [x, y], \"pressure\": [force]}]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุดุฆ ุงูููุฏ ุงูุชุงูู ูุซุงูุงู ูุฎููุฉ RNN ูุฎุตุตุฉ ุชุนูู ูุน ูุซู ูุฐู ุงููุฏุฎูุงุช ุงูููุธูุฉ.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฏุฏ ุฎููุฉ ูุณุชุฎุฏู ุชุฏุนู ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุงููุชุฏุงุฎู</font></font></h3><br>
<pre><code class="python hljs">NestedInput = collections.namedtuple(<span class="hljs-string">'NestedInput'</span>, [<span class="hljs-string">'feature1'</span>, <span class="hljs-string">'feature2'</span>])<font></font>
NestedState = collections.namedtuple(<span class="hljs-string">'NestedState'</span>, [<span class="hljs-string">'state1'</span>, <span class="hljs-string">'state2'</span>])<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NestedCell</span>(<span class="hljs-params">tf.keras.layers.Layer</span>):</span><font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, unit_1, unit_2, unit_3, **kwargs</span>):</span><font></font>
    self.unit_1 = unit_1<font></font>
    self.unit_2 = unit_2<font></font>
    self.unit_3 = unit_3<font></font>
    self.state_size = NestedState(state1=unit_1, <font></font>
                                  state2=tf.TensorShape([unit_2, unit_3]))<font></font>
    self.output_size = (unit_1, tf.TensorShape([unit_2, unit_3]))<font></font>
    super(NestedCell, self).__init__(**kwargs)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self, input_shapes</span>):</span>
    <span class="hljs-comment"># #  input_shape  2 , [(batch, i1), (batch, i2, i3)]</span>
    input_1 = input_shapes.feature1[<span class="hljs-number">1</span>]<font></font>
    input_2, input_3 = input_shapes.feature2[<span class="hljs-number">1</span>:]<font></font>
<font></font>
    self.kernel_1 = self.add_weight(<font></font>
        shape=(input_1, self.unit_1), initializer=<span class="hljs-string">'uniform'</span>, name=<span class="hljs-string">'kernel_1'</span>)<font></font>
    self.kernel_2_3 = self.add_weight(<font></font>
        shape=(input_2, input_3, self.unit_2, self.unit_3),<font></font>
        initializer=<span class="hljs-string">'uniform'</span>,<font></font>
        name=<span class="hljs-string">'kernel_2_3'</span>)<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">call</span>(<span class="hljs-params">self, inputs, states</span>):</span>
    <span class="hljs-comment">#     [(batch, input_1), (batch, input_2, input_3)]</span>
    <span class="hljs-comment">#     [(batch, unit_1), (batch, unit_2, unit_3)]</span><font></font>
    input_1, input_2 = tf.nest.flatten(inputs)<font></font>
    s1, s2 = states<font></font>
<font></font>
    output_1 = tf.matmul(input_1, self.kernel_1)<font></font>
    output_2_3 = tf.einsum(<span class="hljs-string">'bij,ijkl-&gt;bkl'</span>, input_2, self.kernel_2_3)<font></font>
    state_1 = s1 + output_1<font></font>
    state_2_3 = s2 + output_2_3<font></font>
<font></font>
    output = [output_1, output_2_3]<font></font>
    new_states = NestedState(state1=state_1, state2=state_2_3)<font></font>
<font></font>
    <span class="hljs-keyword">return</span> output, new_states
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุจูุงุก ูููุฐุฌ RNN ุจุฅุฏุฎุงู / ุฅุฎุฑุงุฌ ูุชุฏุงุฎู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฏุนููุง ูุจูู ูููุฐุฌ Keras ูุณุชุฎุฏู ุทุจูุฉ </font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎููุฉ ูุฎุตุตุฉ ุญุฏุฏูุงูุง ููุชู.</font></font><br>
<br>
<pre><code class="python hljs">unit_1 = <span class="hljs-number">10</span>
unit_2 = <span class="hljs-number">20</span>
unit_3 = <span class="hljs-number">30</span><font></font>
<font></font>
input_1 = <span class="hljs-number">32</span>
input_2 = <span class="hljs-number">64</span>
input_3 = <span class="hljs-number">32</span>
batch_size = <span class="hljs-number">64</span>
num_batch = <span class="hljs-number">100</span>
timestep = <span class="hljs-number">50</span><font></font>
<font></font>
cell = NestedCell(unit_1, unit_2, unit_3)<font></font>
rnn = tf.keras.layers.RNN(cell)<font></font>
<font></font>
inp_1 = tf.keras.Input((<span class="hljs-literal">None</span>, input_1))<font></font>
inp_2 = tf.keras.Input((<span class="hljs-literal">None</span>, input_2, input_3))<font></font>
<font></font>
outputs = rnn(NestedInput(feature1=inp_1, feature2=inp_2))<font></font>
<font></font>
model = tf.keras.models.Model([inp_1, inp_2], outputs)<font></font>
<font></font>
model.compile(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'mse'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])unit_1 = <span class="hljs-number">10</span>
unit_2 = <span class="hljs-number">20</span>
unit_3 = <span class="hljs-number">30</span><font></font>
<font></font>
input_1 = <span class="hljs-number">32</span>
input_2 = <span class="hljs-number">64</span>
input_3 = <span class="hljs-number">32</span>
batch_size = <span class="hljs-number">64</span>
num_batch = <span class="hljs-number">100</span>
timestep = <span class="hljs-number">50</span><font></font>
<font></font>
cell = NestedCell(unit_1, unit_2, unit_3)<font></font>
rnn = tf.keras.layers.RNN(cell)<font></font>
<font></font>
inp_1 = tf.keras.Input((<span class="hljs-literal">None</span>, input_1))<font></font>
inp_2 = tf.keras.Input((<span class="hljs-literal">None</span>, input_2, input_3))<font></font>
<font></font>
outputs = rnn(NestedInput(feature1=inp_1, feature2=inp_2))<font></font>
<font></font>
model = tf.keras.models.Model([inp_1, inp_2], outputs)<font></font>
<font></font>
model.compile(optimizer=<span class="hljs-string">'adam'</span>, loss=<span class="hljs-string">'mse'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฏุฑูุจ ุงููููุฐุฌ ุนูู ุงูุจูุงูุงุช ุจุดูู ุนุดูุงุฆู</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุนุฏู ูุฌูุฏ ูุฌููุนุฉ ุจูุงูุงุช ุฌูุฏุฉ ููุฐุง ุงููููุฐุฌ ุ ูุฅููุง ูุณุชุฎุฏู ุจูุงูุงุช ุนุดูุงุฆูุฉ ุชู ุฅูุดุงุคูุง ุจูุงุณุทุฉ ููุชุจุฉ Numpy ููุชูุถูุญ.</font></font><br>
<br>
<pre><code class="python hljs">input_1_data = np.random.random((batch_size * num_batch, timestep, input_1))<font></font>
input_2_data = np.random.random((batch_size * num_batch, timestep, input_2, input_3))<font></font>
target_1_data = np.random.random((batch_size * num_batch, unit_1))<font></font>
target_2_data = np.random.random((batch_size * num_batch, unit_2, unit_3))<font></font>
input_data = [input_1_data, input_2_data]<font></font>
target_data = [target_1_data, target_2_data]<font></font>
<font></font>
model.fit(input_data, target_data, batch_size=batch_size)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงุณุชุฎุฏุงู ุงูุทุจูุฉ ุ ูุง </font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนููู ุณูู ุชุญุฏูุฏ ุงูููุทู ุงูุฑูุงุถู ูุฎุทูุฉ ูุงุญุฏุฉ ุฏุงุฎู ุงูุชุณูุณู ุ ูุณุชุชุนุงูู ุงูุทุจูุฉ </font></font><code>tf.keras.layers.RNN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุน ุชูุฑุงุฑ ุงูุชุณูุณู ููุงุจุฉ ุนูู. </font><font style="vertical-align: inherit;">ูุฐู ุทุฑููุฉ ูููุฉ ุจุดูู ูุง ูุตุฏู ููููุฐุฌ ุณุฑูุน ูุฃููุงุน ุฌุฏูุฏุฉ ูู RNNs (ูุซู ูุชุบูุฑ LSTM). </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุงูุชุญูู ุ ุณุชุธูุฑ ุงูุชุฑุฌูุฉ ุฃูุถูุง ุนูู Tensorflow.org. </font><font style="vertical-align: inherit;">ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงููุดุงุฑูุฉ ูู ุชุฑุฌูุฉ ูุซุงุฆู ูููุน Tensorflow.org ุฅูู ุงููุบุฉ ุงูุฑูุณูุฉ ุ ููุฑุฌู ุงูุงุชุตุงู ุจุดุฎุต ุฃู ุชุนูููุงุช. </font><font style="vertical-align: inherit;">ูู ููุถุน ุชูุฏูุฑ ุฃู ุชุตุญูุญุงุช ูุชุนูููุงุช.</font></font></i></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar487798/index.html">ููู ูููุง ุจุงูุชุฑุญูู ูู Oracle JDK ู Java Web Start ุฅูู ุงุนุชูุงุฏ ู OpenJDK ู OpenWebStart</a></li>
<li><a href="../ar487800/index.html">ููุงุฐุง ูู ุงูููู ุฅุฎุจุงุฑ ููุฏู ุงูุทูุจ ุจุงูุฎุทุฃ ุงูุฐู ุญุฏุซ ุฃุซูุงุก ุงูููุงุจูุฉ (ูููููุฉ ุงูููุงู ุจุฐูู ุจุดูู ุตุญูุญ)</a></li>
<li><a href="../ar487802/index.html">APC Smart UPS ุบูุฑ ุงููููุทุนุฉ ุ ูููููุฉ ุทูููุง</a></li>
<li><a href="../ar487804/index.html">ููุงุก ูุฑู ุงูููู ูู Raiffeisenbank</a></li>
<li><a href="../ar487806/index.html">ุฅูุดุงุก API ุฏููู ุตุบูุฑุฉ</a></li>
<li><a href="../ar487812/index.html">ุงุฎุชุจุงุฑ ุงูุทูู LED ุงูุจูููุฏู E27</a></li>
<li><a href="../ar487814/index.html">ุงูุณุฑุนุฉ ูุงูููุซูููุฉ ุฃุนูู ูุงูุณุนุฑ ุฃูู. ูุญุฑูุงุช ุงูุฃูุฑุงุต ุงูุตูุจุฉ Kingston KC2000 ุงูุฌุฏูุฏุฉ</a></li>
<li><a href="../ar487822/index.html">AvitoTech On Tour: ููุงุก Android ูู ููุฌูู ูููุบูุฑูุฏ</a></li>
<li><a href="../ar487824/index.html">ูุธุฑุฉ ุนุงูุฉ ุนูู ูุตุงุจูุญ LED ุงูุทูู LED GU10 ูู ุฃูุฑูุจุง</a></li>
<li><a href="../ar487826/index.html">ูุธุฑุฉ ุนุงูุฉ ุนูู ูุตุงุจูุญ LED ูู ุจูููุฏุง Spectrum Led E14</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>