<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏾 👨🏿 🤷 Comment les nombres entiers très longs sont-ils implémentés en Python? 🙃 🤚🏾 🗼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une traduction de l'article a été préparée spécialement pour les étudiants du cours de développeur Python .
 
 
 
 
 Lorsque vous écrivez dans un lang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Comment les nombres entiers très longs sont-ils implémentés en Python?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489258/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une traduction de l'article a été préparée spécialement pour les étudiants du cours de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">développeur Python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
</i></b><br>
<br>
<img src="https://habrastorage.org/webt/83/4n/6h/834n6hzjg8axynzih1kpbfszk_4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous écrivez dans un langage de bas niveau tel que C, vous vous inquiétez de choisir le bon type de données et les bons qualificateurs pour vos entiers, à chaque étape, vous analysez s'il sera suffisant de l'utiliser simplement </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou si vous devez ajouter </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou même </font></font><code>long double</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cependant, lorsque vous écrivez du code en Python, vous n'avez pas à vous soucier de ces choses "mineures", car Python peut fonctionner avec des nombres de </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'importe quel </font><font style="vertical-align: inherit;">type de </font><font style="vertical-align: inherit;">taille.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En C, si vous essayez de calculer 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20000 en</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisant la fonction intégrée </font></font><code>powl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous obtiendrez la sortie </font></font><code>inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>
<span class="hljs-comment">#include &lt;math.h&gt;</span><font></font>
<font></font>
int main(void) {<font></font>
  printf(<span class="hljs-string">"%Lf\n"</span>, powl(<span class="hljs-number">2</span>, <span class="hljs-number">20000</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
$ ./a.out<font></font>
inf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais en Python, rendre cela plus facile que jamais est facile:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">2</span> ** <span class="hljs-number">20000</span>
<span class="hljs-number">39802768403379665923543072061912024537047727804924259387134</span> ...<font></font>
...<font></font>
<span class="hljs-meta">... </span><span class="hljs-number">6021</span> digits long ...<font></font>
...<font></font>
<span class="hljs-number">6309376</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce doit être sous le capot que Python fait quelque chose de très beau, et aujourd'hui nous allons découvrir ce qu'il fait pour travailler avec des entiers de taille arbitraire!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Présentation et définition</font></font></h3> <br>
<code>Integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Python, il s'agit d'une structure C définie comme suit:</font></font><br>
<br>
<pre><code class="python hljs">struct _longobject {<font></font>
    PyObject_VAR_HEAD<font></font>
    digit ob_digit[<span class="hljs-number">1</span>];<font></font>
};<font></font>
</code></pre><br>
<code>PyObject_VAR_HEAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est une macro, elle se développe en </font></font><code>PyVarObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui a la structure suivante:</font></font><br>
<br>
<pre><code class="python hljs">typedef struct {<font></font>
    PyObject ob_base;<font></font>
    Py_ssize_t ob_size; /* Number of items <span class="hljs-keyword">in</span> variable part */<font></font>
} PyVarObject;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 D'autres types qui ont </font></font><code>PyObject_VAR_HEAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyBytesObject</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyTupleObject</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyListObject</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie qu'un entier, comme un tuple ou une liste, a une longueur variable, et c'est la première étape pour comprendre comment Python peut prendre en charge le travail avec des nombres géants. </font><font style="vertical-align: inherit;">Une fois développée, la macro </font></font><code>_longobject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut être considérée comme:</font></font><br>
<br>
<pre><code class="python hljs">struct _longobject {<font></font>
    PyObject ob_base;<font></font>
    Py_ssize_t ob_size; /* Number of items <span class="hljs-keyword">in</span> variable part */<font></font>
    digit ob_digit[<span class="hljs-number">1</span>];<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il </font></font><code>PyObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y a quelques méta-champs </font><font style="vertical-align: inherit;">dans la structure </font><font style="vertical-align: inherit;">qui sont utilisés pour le comptage des références (garbage collection), mais pour en parler, nous avons besoin d'un article séparé. </font><font style="vertical-align: inherit;">Le domaine sur lequel nous allons nous concentrer sur cela </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et dans un peu </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Décryptage </font></font><code>ob_digit</code></h3> <br>
<code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est un tableau alloué statiquement de longueur unitaire de type </font></font><code>digit (typedef  uint32_t)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Puisqu'il s'agit d'un tableau, il </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'agit principalement d'un pointeur vers un nombre et, par conséquent, si nécessaire, il peut être augmenté à l'aide de la fonction malloc à n'importe quelle longueur. </font><font style="vertical-align: inherit;">De cette façon, python peut représenter et traiter des nombres très longs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En règle générale, dans les langages de bas niveau tels que C, la précision des entiers est limitée à 64 bits, mais Python prend en charge les entiers de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">précision arbitraire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">À partir de Python 3, tous les nombres sont présentés sous la forme </font></font><code>bignum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et ne sont limités que par la mémoire système disponible.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Décryptage </font></font><code>ob_size</code></h3><br>
<code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stocke le nombre d'éléments dans </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Python remplace et utilise ensuite la valeur </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour déterminer le nombre réel d'éléments contenus dans le tableau pour augmenter l'efficacité de l'allocation de mémoire au tableau </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espace de rangement</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La façon la plus naïve de stocker des nombres entiers est de stocker un chiffre décimal dans un élément du tableau, puis des opérations telles que l'addition et la soustraction peuvent être effectuées selon les règles mathématiques de l'école primaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cette approche, le nombre 5238 sera enregistré comme ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z_/gt/qz/z_gtqzwee0xfpoaktyogzh1_cv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette approche est inefficace, car nous utiliserons jusqu'à 32 bits (uint32_t) pour stocker un chiffre décimal, qui, en fait, va de 0 à 9 et peut être facilement représenté avec seulement 4 bits, car lors de l'écriture de quelque chose d'aussi polyvalent que python, le développeur du noyau doit être encore plus inventif. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alors, pouvons-nous faire mieux? </font><font style="vertical-align: inherit;">Bien sûr, sinon je n'aurais pas posté cet article. </font><font style="vertical-align: inherit;">Examinons de plus près comment Python stocke un entier extra-long.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chemin Python</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de stocker un seul chiffre décimal dans chaque élément du tableau </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Python convertit les nombres du système numérique avec une base de 10 en nombres dans un système avec une base de 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et appelle chaque élément comme un chiffre dont la valeur varie de 0 à 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30-1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le système numérique hexadécimal, la base 16 ~ 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signifie que chaque "chiffre" du nombre hexadécimal va de 0 à 15 dans le système numérique décimal. En Python, de même, un «nombre» avec une base de 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui signifie que le nombre variera de 0 à 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 = 1073741823 en décimal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette façon, Python utilise efficacement la quasi-totalité de l'espace alloué de 32 bits par chiffre, économise des ressources et effectue toujours des opérations simples, telles que l'ajout et la soustraction au niveau mathématique de l'école élémentaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selon la plate-forme, Python utilise soit des tableaux entiers non signés 32 bits, soit des tableaux entiers non signés 16 bits avec des chiffres de 15 bits. Pour effectuer les opérations qui seront discutées plus loin, vous n'avez besoin que de quelques bits. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple: 1152921504606846976</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Comme mentionné, pour Python, les nombres sont représentés dans un système de base 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-à-dire que si vous convertissez 1152921504606846976 en un nombre de base avec 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> base </font><font style="vertical-align: inherit;">, vous obtenez 100. </font></font><br>
 <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1152921504606846976 = 1 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 0 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 0 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sup></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Étant donné que le </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chiffre </font><font style="vertical-align: inherit;">le </font><font style="vertical-align: inherit;">moins significatif est enregistré en premier, il est enregistré sous 001 sous forme de trois chiffres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La structure </font></font><code>_longobject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de cette valeur contiendra:</font></font><br>
<br>
<ul>
<li><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme 3</font></font></li>
<li><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme [0, 0, 1]</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hb/fj/y4/hbfjy4kl64ogtyfjjx6hikzvray.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai créé une démo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REPL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui montrera comment Python stocke un entier à l'intérieur de lui-même, et fait également référence aux membres de la structure tels que </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ob_refcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opérations longues entières</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant que nous avons une idée claire de la façon dont Python implémente des entiers de précision arbitraire, il est temps de comprendre comment diverses opérations mathématiques sont effectuées avec eux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une addition</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les entiers sont stockés "en nombre", ce qui signifie que l'addition est aussi simple qu'à l'école primaire, et le code source Python nous montre que c'est ainsi que l'addition est implémentée. </font><font style="vertical-align: inherit;">Une fonction avec un nom </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">x_add</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans un fichier </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajoute deux nombres.</font></font><br>
<br>
<pre><code class="python hljs">...
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; size_b; ++i) {<font></font>
        carry += a-&gt;ob_digit[i] + b-&gt;ob_digit[i];<font></font>
        z-&gt;ob_digit[i] = carry &amp; PyLong_MASK;<font></font>
        carry &gt;&gt;= PyLong_SHIFT;<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (; i &lt; size_a; ++i) {<font></font>
        carry += a-&gt;ob_digit[i];<font></font>
        z-&gt;ob_digit[i] = carry &amp; PyLong_MASK;<font></font>
        carry &gt;&gt;= PyLong_SHIFT;<font></font>
    }<font></font>
    z-&gt;ob_digit[i] = carry;<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'extrait de code ci-dessus est tiré d'une fonction </font></font><code>x_add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comme vous pouvez le voir, il itère sur un nombre par nombre et effectue l'ajout de nombres, calcule le résultat et ajoute un trait d'union. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela devient plus intéressant lorsque le résultat de l'addition est un nombre négatif. </font><font style="vertical-align: inherit;">Le signe </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un signe entier, c'est-à-dire que si vous avez un nombre négatif, ce </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera un moins. </font><font style="vertical-align: inherit;">La valeur </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modulo déterminera le nombre de chiffres dans </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soustraction </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout comme l'addition a lieu, la soustraction a également lieu. </font><font style="vertical-align: inherit;">Une fonction avec un nom </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">x_sub</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le fichier </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soustrait un nombre d'un autre.</font></font><br>
<br>
<pre><code class="python hljs">...
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; size_b; ++i) {<font></font>
        borrow = a-&gt;ob_digit[i] - b-&gt;ob_digit[i] - borrow;<font></font>
        z-&gt;ob_digit[i] = borrow &amp; PyLong_MASK;<font></font>
        borrow &gt;&gt;= PyLong_SHIFT;<font></font>
        borrow &amp;= <span class="hljs-number">1</span>; /* Keep only one sign bit */<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (; i &lt; size_a; ++i) {<font></font>
        borrow = a-&gt;ob_digit[i] - borrow;<font></font>
        z-&gt;ob_digit[i] = borrow &amp; PyLong_MASK;<font></font>
        borrow &gt;&gt;= PyLong_SHIFT;<font></font>
        borrow &amp;= <span class="hljs-number">1</span>; /* Keep only one sign bit */<font></font>
    }<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'extrait de code ci-dessus est tiré d'une fonction </font></font><code>x_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous y voyez comment l'énumération des nombres se produit et la soustraction est effectuée, le résultat est calculé et le transfert est distribué. </font><font style="vertical-align: inherit;">En effet, il est très similaire à l'addition.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiplication</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et encore une fois, la multiplication sera mise en œuvre de la même manière naïve que celle que nous avons apprise des leçons de mathématiques au primaire, mais elle n'est pas très efficace. </font><font style="vertical-align: inherit;">Pour maintenir l'efficacité, Python implémente </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'algorithme de Karatsuba</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui multiplie deux nombres à n chiffres en O (n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log </font></font></sup><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></sub><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) étapes simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'algorithme n'est pas simple et son implémentation dépasse le cadre de cet article, mais vous pouvez trouver son implémentation dans les fonctions </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">k_mul</a> </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">k_lopsided_mul</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le fichier </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Division et autres opérations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les opérations sur les entiers sont définies dans le fichier </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, elles sont très simples pour trouver et tracer le travail de chacun. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une compréhension détaillée du travail de chacun d'entre eux prendra du temps, alors faites le plein de pop-corn à l'avance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python préalloue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> petit nombre d'entiers en mémoire allant de -5 à 256. Cette allocation se produit lors de l'initialisation, et comme nous ne pouvons pas changer les entiers (immuabilité), ces nombres pré-alloués sont singleton et sont directement référencés au lieu d'être alloués. Cela signifie que chaque fois que nous utilisons / créons un petit nombre, Python au lieu de le vendre renvoie simplement une référence au numéro précédemment alloué. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une telle optimisation peut être tracée dans la macro </font></font><code>IS_SMALL_INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la fonction </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">get_small_int</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Python économise donc beaucoup d'espace et de temps dans le calcul des nombres entiers couramment utilisés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceci est le deuxième article de la série Python Internals. Le premier article était sur la façon dont j'ai changé ma version de Python pour la rendre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambigu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il vous aidera à faire les premiers pas dans la compréhension du code source Python et à continuer le chemin pour devenir un développeur de noyau Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez voir plus d'articles similaires, abonnez-vous à ma newsletter et recevez-les directement dans votre boîte de réception. </font><font style="vertical-align: inherit;">J'écris sur l'ingénierie, l'ingénierie des systèmes et un peu sur la programmation tous les vendredis. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envoyez-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> moi un </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">courriel</font></a><font style="vertical-align: inherit;"> à </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">@arpit_bhayani</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez retrouver mes précédents articles sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ arpitbhayani.me / blogs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Rendez-vous sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parcours</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr489244/index.html">Développement de plugins pour Zabbix Agent 2</a></li>
<li><a href="../fr489246/index.html">J'ai 14 ans et j'ai décidé de développer un jeu</a></li>
<li><a href="../fr489252/index.html">L'histoire de Telegram: d'une idée à sa propre crypto-monnaie</a></li>
<li><a href="../fr489254/index.html">Yandex aide-t-il à propager des logiciels malveillants?</a></li>
<li><a href="../fr489256/index.html">Systèmes d'automatisation Foundation Fieldbus</a></li>
<li><a href="../fr489260/index.html">Comment concevoir un système automatisé à grande échelle pour une grande entreprise en sept étapes</a></li>
<li><a href="../fr489262/index.html">Pourquoi il n'est pas facile de donner aux développeurs la liberté de choix</a></li>
<li><a href="../fr489268/index.html">Mise en œuvre du processus de téléchargement d'un fichier depuis un conteneur avec un navigateur vers un framework de test</a></li>
<li><a href="../fr489270/index.html">WebAuthn dans la vraie vie</a></li>
<li><a href="../fr489272/index.html">Yeux, cerveau, qualité vidéo: réflexions sur 120fps, 8K, HDR, baguettes, cônes et «effet feuilleton»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>