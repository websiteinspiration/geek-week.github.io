<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌯 🥌 🤙🏼 機能ポリシーHTTPヘッダーとWebブラウザーコントロール 🥕 🏂🏿 😹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Webプロジェクトのパフォーマンスを制御下に保つことができる、まったく比較できないテクニックが1つあります。それは、開発プロセスにメカニズムを導入することにあり、その結果ははっきりと見える。これらのメカニズムは、常にプログラマにパフォーマンスの重要性を思い出させるように設計されています。この文脈で私...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>機能ポリシーHTTPヘッダーとWebブラウザーコントロール</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/490624/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webプロジェクトのパフォーマンスを制御下に保つことができる、まったく比較できないテクニックが1つあります。それは、開発プロセスにメカニズムを導入することにあり、その結果ははっきりと見える。これらのメカニズムは、常にプログラマにパフォーマンスの重要性を思い出させるように設計されています。この文脈で私は本当に好きなものがあります。これは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feature-Policy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTTPヘッダー</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">
このタイトルは比較的新しい機能であり、開発者はサイトの閲覧中に特定のブラウザー機能をオンまたはオフにすることができます。</font><font style="vertical-align: inherit;">
たとえば、次のヘッダーを渡すことで、Geolocation APIの使用を許可しないようにブラウザに指示できます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/_a/mh/zz/_amhzzcwmae7goctptz7hobpnwa.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: geolocation 'none'</code></pre><br><font style="vertical-align: inherit;"></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セキュリティとパフォーマンスの観点から</font><font style="vertical-align: inherit;">
、ヘッダー</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">使用する</font><font style="vertical-align: inherit;">ことには多くの利点</font><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">しかし、私は今、特に</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それを使用して、通常見落としがちなWebサイトのパフォーマンスの問題をより顕著にする</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">好き</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは「パフォーマンスリンティング」のようなものと比較できます。</font><font style="vertical-align: inherit;">特に、Webプロジェクトで使用される画像の問題を特定することについて話します。</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特大画像ポリシー</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サポートされている形式で画像がブラウザに送信されると、そのような画像が表示されます。これはブラウザの標準的な動作です。ブラウザは、ページを表示しているユーザーを支援するために、そのような画像を自動的に拡大縮小します。したがって、巨大なグラフィックファイルで表されていても、見栄えがします。その結果、ページで必要なサイズよりも大きい画像を使用する場合、一見するとこれは見えません。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポリシー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディレクティブ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテナのサイズを指定された回数だけ超えるサイズのイメージの使用を許可しないようにブラウザに指示します。</font><font style="vertical-align: inherit;">標準の制限に従い、画像はコンテナの2倍を超えることはできません。</font><font style="vertical-align: inherit;">ただし、この値は、必要に応じて再定義できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、ブラウザーが次のヘッダーを受け取った場合、どのソースから取得した画像も表示できなくなります（これはおかげで設定</font></font><code>none</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">されます）。そのサイズは、コンテナーのサイズ（幅または高さ）の2倍以上です。</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに柔軟性が必要な場合は、コンテナの3倍を超える画像を表示しないようにブラウザに指示できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: oversized-images *(3) 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いずれの場合も、イメージが指定された境界に適合しない場合、イメージの代わりにスタブが表示され、エラーメッセージがコンソールに送信されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c98/1e3/169/c981e3169d9219c226c13236f198c222.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイトがoversized-imagesポリシーを使用している場合、大きな画像がアップロードされますが、代わりにスタブが表示され、コンソールにエラーメッセージが表示されます</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化されていない画像</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフィックに関するもう1つの一般的な問題は、最適化されていない画像の使用です。十分に圧縮されていない画像に出くわすことがよくあります。ただし、サイズは正しく選択できます。そのため、写真付きのファイルに、それらを撮影して作成するときに、多くの不要なメタデータを追加できます。メタデータは、多くの場合、ファイルに残り、ブラウザで使用されるときに残ります。これの特に厄介な例の1つは画像で、そのメタデータにはプレビュー用の独自のサムネイルが含まれています。多くの場合、画像に埋め込まれたサムネイル（デザイナーや開発者が知らなかった存在）が、画像自体よりも「重要」であることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特に、ここでは、多くのフォーマットでサポートされている通常の画像圧縮を呼び出すことができます。これにより、画質とファイルサイズの完璧なバランスを実現できます。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">unoptimized-lossy-images</font></a><font style="vertical-align: inherit;">および</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">unoptimized-lossless-images</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ポリシー</font><font style="vertical-align: inherit;">は、ファイルサイズと画像サイズ（ピクセル単位）が一致していることをブラウザーに通知します。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unoptimized-lossy-images 'none';<font></font>
Feature-Policy: unoptimized-lossless-images 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ピクセルあたりのバイト数（ピクセルあたりのバイト数、BPP）が高すぎる場合、ブラウザは画像ではなくスタブを表示し、コンソールにエラーメッセージを表示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/215/e57/347215e574f0574312eff1d6737b8d9e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最適化されていないポリシーを適用すると、不適切な画像の代わりにスタブが表示されます。特大の画像ポリシーを使用する場合と同様に</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、非可逆圧縮画像の推奨されるBPPレベルは0.5であり、可逆圧縮画像の場合は1です。さらに、画像を分析するとき、これらのレベルからの合計サイズのわずかなずれが許容されます。これで、損失なしで圧縮された画像のこの偏差は1 Kb、損失なしで圧縮された画像の場合-10 Kbになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、200x200ピクセルのJPEG画像があるとします。 JPEGは非可逆画像圧縮形式であり、推奨されるBPPレベルは0.5です。同時に、画像の合計サイズが推奨サイズを1 Kbだけ超えることがあります。類似した画像がブラウザに適したサイズを見つけるには、画像の辺のサイズをピクセル単位で相互に掛け、BPPを掛けて、許容される偏差を何が起こるかに追加する必要があります。</font></font><br>
<br>
<code>(200 x 200 x .5) + 1024 = 21,024</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイト、または</font></font><code>20.5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kb </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像が損失なしで圧縮される場合、「理想的な」サイズである10 Kbからの逸脱が許可されますが、そのような画像のBPPは1になります。それ以外の場合、計算はまったく同じです：</font></font><br>
<br>
<code>(200 x 200 x 1) + 10,240 = 50,240</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バイト、または</font></font><code>49.1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kb</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
許容される偏差のサイズは将来変更される可能性があります。</font><font style="vertical-align: inherit;">実際、Blinkはデフォルトで、10 Kbに等しい損失なしで圧縮された画像にこのインジケーターを使用しますが、このインジケーターを</font></font><code>unoptimized-lossless-images-strict</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 Kbのレベルに下げる</font><font style="vertical-align: inherit;">ポリシー</font><font style="vertical-align: inherit;">を使用</font><font style="vertical-align: inherit;">した実験がすでに進行中です</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メディアが指定されていません</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいものは忘れられていた古いものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長い時間の画像属性の使用のために</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そして</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多かれ少なかれ一般的でした。これらの属性がないと、ブラウザは、画像が読み込まれるまで、画像が占めるスペースを認識できませんでした。これにより、ページレイアウトが変化しました。ページが表示され、画像が到着した後、コンテンツがシフトしました。ブラウザは、画像用のスペースを割り当てるために、レイアウトを再度数える必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CSSを使用して画像サイズを柔軟にサイズ変更する必要のあるレイアウトの時が来たとき、これらの属性の有無は特別な役割を果たしていません。その結果、多くは単にこれらの属性の使用をやめました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">最近の仕事の</font></a><font style="vertical-align: inherit;">おかげで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jen Simmonsによって開始されたFirefoxとChromeは、属性</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とに</font><font style="vertical-align: inherit;">基づいて画像のアスペクト比を計算できます</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このアプローチを画像に適用されるスタイルと組み合わせると、ブラウザーがレイアウトの最初の通過時に画像用のスペースを予約できることがわかります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">unsized-media</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ポリシー</font><font style="vertical-align: inherit;">は、すべてのメディア要素がこれらの要素のサイズを指定する属性を持つ必要があることをブラウザーに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">します。そのような属性がない場合、ブラウザはデフォルト値を使用する必要があります。実際、すべてが少し複雑ですが、肝心な点は、画像に適切な属性がない場合、ブラウザは標準の</font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピクセル</font><font style="vertical-align: inherit;">値を使用するということ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="plaintext hljs">Feature-Policy: unsized-media 'none';</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このポリシーを適用すると画像が表示されますが、HTMLでサイズが指定されていない場合、開発者は画像がデフォルトのサイズで表示されていることにすぐに気づきます。また、通常どおり、エラーメッセージがコンソールに送信されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4b/b8a/4c5/a4bb8a4c52a7267ef162a8a8244c0f9a.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unsized-mediaポリシーを適用すると、高さと幅の属性のない画像と動画が表示されますが、ブラウザーはそれらのサイズを300x150ピクセルに設定します。</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
おそらく、最初は私には珍しいと思われた機能の1つに言及する価値があります。</font><font style="vertical-align: inherit;">ポリシー</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">共有するとき、彼女は自分自身を示します</font></font><code>oversized-images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この状況では、画像のサイズが大きすぎるというメッセージの数がこれまで以上に増えていることに驚かないでください。</font><font style="vertical-align: inherit;">事実が原因ポリシーの適用に、ということである</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブラウザは属性を持っていない画像をリサイズし</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かつ</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大</font></font><code>300x150</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のピクセルを。</font><font style="vertical-align: inherit;">その後、ブラウザが画像がそのコンテナと一致するかどうかを判断するための参照ポイントとして使用するのはこのサイズです。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目立たない問題に注意を引く</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像関連のポリシーでは、プロジェクトを開発する過程で、通常は隠されているものを可視化できるという点が気に入っています。その結果、開発者は、画像の最適化に注意を払っていなかったこと、またはそれらの属性</font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">を設定するのを忘れたことを知りました</font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これらのエラーはすべて、ページの外観にすぐに反映されます。実際、上記のポリシーを使用する主な利点は、開発者が画像に関する問題をすばやく見つけられることです。政治中</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ページレイアウトの「シフト」が発生する状況の数を減らすことができます。他のポリシーを使用しても、不適切な画像の読み込みが妨げられることはありません。その結果、これらのポリシーを適用する唯一の利点は、問題に開発者の注意を引くことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページを分析してパフォーマンスへの影響を調べるのに役立つポリシーがいくつかあります。ここで、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sync-script</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのポリシーが思い浮かびます</font><font style="vertical-align: inherit;">（このポリシーは、同期スクリプトの実行を</font></font><code>sync-xhr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロックします</font><font style="vertical-align: inherit;">）、</font><font style="vertical-align: inherit;">（同期AJAX要求をブロックします）、</font></font><code>document-write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（呼び出しをブロックします</font></font><code>document.write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのポリシーは、ページパフォーマンスの特定の側面を制御するための優れたツールですが、それら自体は、上記のポリシーの多くが欠けている画像の形で提供するのと同じ顕著なフィードバックを開発者に提供しません。もちろん、ページに同期スクリプトがあり、それがないと表示されない場合、これは見逃しがちです（そのようなページを見つけるのはそれほど難しくありません）。ただし、これらのポリシーは通常、コンソールに表示されるメッセージの形式でエラーを示します。正直なところ、ほとんどの開発者はコンソールにあまり注意を払っていないのではないかと思います（コンソールについてはもっと注意する必要があると思います）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、それでも、APIを使用して、「見えない」ポリシーによって検出されたエラーをさらに目立たせることができます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">違反を監視し、ページに関連する通知を表示するための</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ReportingObserver</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このような通知は非常に目立つようにすることができます。</font></font><br>
<br>
<pre><code class="plaintext hljs">let reportingAlerts = document.createElement('ul');<font></font>
&nbsp;&nbsp;reportingAlerts.setAttribute('id','reportingAlerts');<font></font>
&nbsp;&nbsp;document.body.appendChild(reportingAlerts);<font></font>
<font></font>
const alertBox = document.getElementById('reportingAlerts');<font></font>
<font></font>
new ReportingObserver((reports, observer) =&gt; {<font></font>
&nbsp;&nbsp;let fragment = document.createDocumentFragment();<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;Object.keys(reports).forEach(function(item) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let li = document.createElement('li');<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;li.textContent = reports[item].body.message + ': ' + reports[item].body.featureId;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fragment.appendChild(li);<font></font>
&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;alertBox.appendChild(fragment)<font></font>
}, {types: ['feature-policy-violation'], buffered: true}).observe();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これがどのように見えるかの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
をCodePen </font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">スケッチしまし</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">た</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bd/c18/c8a/2bdc18c8a9bb20db1f18a9e095be4b8e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feature-Policyヘッダーで指定されたポリシー違反の通知を表示する方法の例。</font><font style="vertical-align: inherit;">このような通知は、開発環境での出力用に設計されているか、またはプロジェクトが本番環境への出力用に準備されている場所です。</font></font></font></i><br>
 <br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feature-Policyヘッダーの使用を減らす</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘッダーを使用する最大の欠点は</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ブラウザーによるサポートです。</font><font style="vertical-align: inherit;">どうやら、今ではそれはBlinkベースのブラウザ（Opera、Edge、Chrome、Samsung）でのみサポートされています。</font><font style="vertical-align: inherit;">FirefoxおよびSafariブラウザは</font></font><code>allow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アイテム</font><font style="vertical-align: inherit;">の属性</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">サポートしています</font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ただし、</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートされ</font><font style="vertical-align: inherit;">ている場合でも、</font><font style="vertical-align: inherit;">多くのポリシーの正常性を保証するには、フラグを有効にする必要があり</font></font><code>Experimental Web Platform features</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます（アドレスで確認できます</font></font><code>about:flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能ポリシーヘッダーの使用方法</font></font></font></h2><br><font style="vertical-align: inherit;"></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上記の</font><font style="vertical-align: inherit;">
タイトルのマイナスは、</font><font style="vertical-align: inherit;">個人的には特に問題ではありません。このヘッダーで定義されたポリシーをブラウザベースのページチェッカーとして使用することを好みます。したがって、</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本番</font><font style="vertical-align: inherit;">環境に適用</font><font style="vertical-align: inherit;">したり、すべてのユーザーに対してポリシーが機能するようにしたり</font><font style="vertical-align: inherit;">する必要はありません</font><font style="vertical-align: inherit;">。それらは私だけでなく、サイトを開発している人にも必要です。私はいずれにせよ、開発プロセスのメインブラウザとしてChromeを使用しています。したがって、</font></font><code>Feature-Police</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私の作業環境で</font><font style="vertical-align: inherit;">パフォーマンス</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">確保</font><font style="vertical-align: inherit;">するには、適切なフラグを有効にします。この後、政治家は私の側で追加の介入なしに働きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘッダーを使用する最も簡単な方法</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はブラウザー拡張機能</font><font style="vertical-align: inherit;">を使用する</font><font style="vertical-align: inherit;">ことです</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModHeader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">この拡張機能を使用すると、ページが表示されたときにページに渡される独自の見出しを設定できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/ec2/33b/9c9ec233b6a3913a5e584335ac43a344.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModHeader拡張機能を使用すると、Feature-Policyヘッダーオプションを構成できます。</font><font style="vertical-align: inherit;">必要に応じて、オンとオフを切り替えることができます</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定期的に使用する</font><font style="vertical-align: inherit;">3セットのヘッダー値</font><font style="vertical-align: inherit;">があります。</font></font><br>
<br>
<ul>
<li><code>oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
<li><code>script-sync 'none'; unsized-media 'none'; oversized-images 'none'; unoptimized-lossy-images 'none'; unoptimized-lossless-images 'none';</code></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はしばしば最初のものをオンにしておきます。使用されているポリシーが適用されるWebページを移動するのは非常にエキサイティングです。一部の画像の大きさを見るのは怖いです。現代のウェブには改善の余地があるものがたくさんあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、ページで政治が引き起こされることが非常に多いため</font></font><code>unsized-media</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（そして私もこれによって罪を犯します）、インターネットでの通常の作業中に使用することは不便です。そのため、オンとオフを切り替えることができる別のポリシーで強調表示しています。同じことがポリシー</font></font><code>sync-scripts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">適用され</font><font style="vertical-align: inherit;">、その適用は多くのサイトを「破壊」します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が協力したチームのいくつかは、開発中に説明したポリシーを使い始めました。</font><font style="vertical-align: inherit;">これにより、以前は見えなかった問題にすばやく注意を払うことができます。</font><font style="vertical-align: inherit;">もちろん、</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発環境に</font><font style="vertical-align: inherit;">すべてのポリシーを含めることをお勧めし</font><font style="vertical-align: inherit;">ます。これにより、エラーをすばやく識別して修正できます。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果として、Chromeだけでなく</font><font style="vertical-align: inherit;">
サポート</font><font style="vertical-align: inherit;">が表示さ</font><font style="vertical-align: inherit;">れることを願ってい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これが私のメインのブラウザーですが、他のブラウザーも使用する必要があります。</font><font style="vertical-align: inherit;">彼らがサポートし</font></font><code>Feature-Policy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た</font><font style="vertical-align: inherit;">場合、それは役に立ちます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">しかし、ここでは、特定の機会の実験的なサポートでさえ、それが実際に有益であるには十分であるというまれな状況が見られます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
微妙なパフォーマンスの問題も問題です。</font><font style="vertical-align: inherit;">そして、そのような問題をより見やすくする機能は、開発者がそれらを特定して修正するために使用できる最良の方法の1つです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能ポリシーの見出しを使用して、Webプロジェクトの目立たない問題を特定する予定ですか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490612/index.html">Scalaでのトランザクションへの機能的アプローチ、または独自の有用なモナドの記述</a></li>
<li><a href="../ja490616/index.html">先週のフロントエンドの世界からのフレッシュな素材のダイジェスト第404号（2020年2月24日〜2020年3月1日）</a></li>
<li><a href="../ja490618/index.html">Goroutineスタックバッファー</a></li>
<li><a href="../ja490620/index.html">「ニューラルネットワークを復元しました」という言葉を聞くと、バックアップを確認するために登ります</a></li>
<li><a href="../ja490622/index.html">Webアプリケーションでのメモリリークとの戦い</a></li>
<li><a href="../ja490626/index.html">データの完全なガイド-* HTML属性</a></li>
<li><a href="../ja490628/index.html">CSSがページ解析をブロックする場合はどうすればよいですか？</a></li>
<li><a href="../ja490630/index.html">ディスクからのNumPy配列の読み込み：memmap（）とZarr / HDF5の比較</a></li>
<li><a href="../ja490634/index.html">3月2日から8日までのモスクワでのデジタルイベント</a></li>
<li><a href="../ja490636/index.html">3月2日から8日までのサンクトペテルブルクでのデジタルイベント</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>