<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåà üßõüèº üìò Computer system simulators - do they look like reality üôéüèª ü§µüèº üéØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a simple and accessible language about basic terms from the field of simulators, as well as types and levels of detail of models. Material for easy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Computer system simulators - do they look like reality</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/auriga/blog/504086/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In a simple and accessible language about basic terms from the field of simulators, as well as types and levels of detail of models. </font><font style="vertical-align: inherit;">Material for easy and quick acquaintance with this area.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n6/ra/jd/n6rajd4edfjmszumvujqoaqtxt8.jpeg" alt="image"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If I had been asked about the simulation a while ago, the first thing that would have occurred to me is my son, who talks about his sick stomach on the eve of the control at school. However, for the last ten years I have been working with simulators of various computer systems, from telephones to servers based on microprocessors, SOCs (System-On-Chip) and chipsets of one of the largest manufacturers (unfortunately, the name is under the NDA), and my idea of The simulation has changed. But first things first.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I am sure that many of you have come across simulators, which are often called virtual machines, hypervisors. </font><font style="vertical-align: inherit;">Someone installs Parallels Studio on their Mac to run Windows from MacOS, someone uses a product from VmWare - Workstation to have another operating system (OS) running inside already installed. </font><font style="vertical-align: inherit;">Those familiar with Linux prefer KVM and QEMU. </font><font style="vertical-align: inherit;">Also popular among the people is VirtualBox. </font><font style="vertical-align: inherit;">People professionally developing FPGA-based hardware (Programmable Logic Integrated Circuits) are aware of VCS from Synopsys and Mentor Graphics Questa. </font><font style="vertical-align: inherit;">And yet this is only a small part of what can be called simulators.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is a simulator? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A simulator is a model, usually a software, real device. </font><font style="vertical-align: inherit;">Accordingly, simulation is a process of such a model that repeats the operation of the device. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In principle, you can make a model of any device, but the most common are simulators of microprocessor devices, that is, devices whose central component is a microprocessor, and the rest of the logic is already being built around it. </font><font style="vertical-align: inherit;">One of the main uses for the simulator is to launch programs designed for this microprocessor itself. </font><font style="vertical-align: inherit;">At the same time, using a real device is difficult for one reason or another, for example, it may simply not exist yet, if we are talking about modeling the future generation of microprocessors.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Airbnb in simulation - guest and host</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code that runs inside the simulator is called the "guest code", it can be a "guest program" or the whole "guest operating system". </font><font style="vertical-align: inherit;">The simulated system itself is simply called a ‚Äúguest‚Äù. </font><font style="vertical-align: inherit;">In turn, the system, the computer where the simulator runs, is called the ‚Äúhost‚Äù (English host), and the operating system running on the host in which the simulator runs is called the ‚Äúhost OS‚Äù.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0z/u-/6c/0zu-6c26huucbitovqa4ln8pjcc.jpeg" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, we can say that a simulator that implements a certain set of guest system instructions simulates them using the available host system tools.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simulation and emulation - which name is correct?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The model can repeat the device with varying degrees of accuracy and detail. </font><font style="vertical-align: inherit;">Often this is a simulation of only the external behavior of the system available to the program code. </font><font style="vertical-align: inherit;">The code doesn‚Äôt ‚Äúcare‚Äù how exactly this or that processor instruction is implemented inside - the main thing is that it works. </font><font style="vertical-align: inherit;">This version of the simulation is common, not difficult to develop and quite fast, does not slow down even on ordinary user computers.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, this is not enough if we want to know, for example, how long the program will run on real hardware. </font><font style="vertical-align: inherit;">This requires modeling not only external behavior, but also a repetition of the internal structure and logic of work. </font><font style="vertical-align: inherit;">This can also be done with varying degrees of detail and accuracy. </font><font style="vertical-align: inherit;">It‚Äôs more correct to call such models emulators, which really emulate the device, and not ‚Äúsimulate‚Äù the results.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creating emulators is much more complicated due to the greater amount of functionality that must be implemented in the model. </font><font style="vertical-align: inherit;">They also function much slower compared to simulators of the external behavior of the device. </font><font style="vertical-align: inherit;">With emulators, we are not talking about starting Windows at all - it can take years. </font><font style="vertical-align: inherit;">No one is engaged in the creation of a software emulator of the entire platform - it is very long and expensive. </font><font style="vertical-align: inherit;">Instead, individual components of the system are emulated, such as the same central processor, and only part of the simulation process is launched on it. </font><font style="vertical-align: inherit;">Various hybrid schemes are possible, when part of the simulator is a high-level model, part is a low-level model, part is in an FPGA, and part is actually a real piece of iron.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lt/j3/yd/ltj3ydvpjsh9jgsczxuqi-cu2x0.jpeg" alt="image"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 levels of simulation detail</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As I wrote above, the most common option is the simulation at the level of the processor instructions, the so-called ISA (Instruction Set Architecture), or, more precisely, the result of their execution, i.e. without emulating all the internal logic of how this happens in a real processor, and without taking into account the execution time of various instructions. Such simulators are also called functional. This is how VirtualBox, Vmware Workstation, Wind River Simics, KVM and QEMU work. This allows you to conveniently, without unnecessary additional actions, run programs designed for the simulated device. In other words, neither recompilation nor any other manipulations with running programs are required. In such cases, they say that it is possible to run unmodified binary code.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we talk about a higher level of abstraction, then this will be the implementation of a certain ABI (Application Binary Interface). In a nutshell, ABI describes a binary interface for the interaction of two programs - usually a user program and a library or OS. ABI covers calling conventions (how to pass parameters and return values), sizes of data types, making system calls. How it works? For example, if a program written for Linux needs to create an additional thread (from the English thread) for execution, then the pthread_create () function is called. But what if you make a library with such a function in Windows and implement the necessary mechanisms for linking the application and the library (dynamic linking)? In this case, you can run Linux applications from Windows. Windows will "simulate" Linux.This is exactly what was done in Windows subsystem for Linux on Windows 10, which allows you to run unmodified binary Linux applications on Windows.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's see how the lower-level and detailed levels of simulation look like. This will be the microarchitecture level at which real internal algorithms and processor blocks are simulated, such as an instruction decoder, queues, an out-of-order processing unit, a branch predictor, a cache, a scheduler, and counting devices themselves. Such modeling allows us to analyze the real speed of program execution and, for example, optimize them for existing architectures. And in the case of simulating prototypes of future microprocessors, prediction and evaluation of the performance of these devices are possible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Below the level of microarchitectural simulation is the level of emulation of the logical elements that modern chips are made of. Such emulators are both software and hardware using FPGAs. FPGA logic is described using RTL (Register Transfer Level) in the languages ‚Äã‚ÄãVerilog, VHDL, etc. After compilation, an image (bitstream) is obtained, which is then flashed into the FPGA. And for this, it is not necessary to use a soldering iron and understand electrical engineering. The board is connected to a computer, for example, via USB or JTAG interface, and special software from the manufacturer of the FPGA card performs recording. The cost of such boards starts from ten dollars for the simplest options to millions of dollars for large FPGA boards the size of a cabinet used in large chip manufacturing companies.In such companies, FPGA simulation is the final stage before RTL is put into production.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we are talking about simple devices, then having the FPGA image on hand, you can contact specialized companies that will make a real (non-FPGA) device with programmed logic. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The figure below shows the described simulation levels.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jr/zp/yb/jrzpybtaxtzvnzr9rxixvbkifqo.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition to these simulation levels, I also had to deal with hybrid simulators. In fact, they are simulators connected with each other, modeling different parts of the system at different levels. For example, you need to analyze the bandwidth of a new network card that works together with the driver being developed for a particular OS. Such a network device, as well as a number of related devices, can be implemented first at the microarchitectural level for preliminary analysis, and then in the FPGA, at the level of logic elements, for final checks. At the same time, the rest of the system, which is only partially involved, is implemented at the instruction level. You can‚Äôt do without it, since it is necessary, for example, to load the OS, and it makes no sense to implement it at a lower and more complex level.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So what about comparing simulators and reality? </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As it is now clear, there is no task to make this or that simulator as similar to reality as possible. </font><font style="vertical-align: inherit;">There is a task posed by the business, and the simulation is performed with the degree of ‚Äúsimilarity‚Äù to reality, which is minimally sufficient to solve this problem, without wasting extra money and time. </font><font style="vertical-align: inherit;">In one case, it can be a simple library that implements the necessary binary interface (ABI), and in the other, a detailed microarchitectural simulator cannot be dispensed with. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the most basic information about what simulators are and what they are. </font><font style="vertical-align: inherit;">In the next article I will describe the details of the implementation of full-platform simulators, beat models and work with tracks.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504072/index.html">The ideal user agreement: how to minimize risks for developers</a></li>
<li><a href="../en504074/index.html">Glass Nightmare: Cleansing the Hanford Cold War Nuclear Heritage</a></li>
<li><a href="../en504080/index.html">How Apple and Google Employees Help Healthcare Officials Track Coronavirus Together</a></li>
<li><a href="../en504082/index.html">What will we do with the additional 1.2 GHz?</a></li>
<li><a href="../en504084/index.html">Explore iOS bug with Hopper</a></li>
<li><a href="../en504088/index.html">Advanced Windows Logging. Looking for mimikatz</a></li>
<li><a href="../en504092/index.html">First look at JavaScript records and tuples</a></li>
<li><a href="../en504096/index.html">Optimal Newbie Way for C ++ / Qt</a></li>
<li><a href="../en504098/index.html">Dipfake video one frame</a></li>
<li><a href="../en504102/index.html">Introduction to Python Functools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>