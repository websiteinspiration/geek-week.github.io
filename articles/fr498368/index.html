<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèº ü§òüèæ üßîüèΩ L'histoire d'un interrupteur üìò üåû üíÜüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans notre agr√©gation LAN, il y avait six paires de commutateurs Arista DCS-7050CX3-32S et une paire de commutateurs Brocade VDX 6940-36Q. Ce n'est pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>L'histoire d'un interrupteur</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/498368/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y6/hn/ng/y6hnnglhd7cga9rdsoloimhiism.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans notre agr√©gation LAN, il y avait six paires de commutateurs Arista DCS-7050CX3-32S et une paire de commutateurs Brocade VDX 6940-36Q. </font><font style="vertical-align: inherit;">Ce n'est pas que les commutateurs Brocade sur ce r√©seau ont exerc√© une grande pression sur nous, ils travaillent et remplissent leurs fonctions, mais nous pr√©parions l'automatisation compl√®te de certaines actions, et nous n'avions pas ces capacit√©s sur ces commutateurs. </font><font style="vertical-align: inherit;">Je voulais √©galement passer des interfaces 40GE √† la possibilit√© d'utiliser 100GE pour faire une r√©serve pour les 2-3 prochaines ann√©es. </font><font style="vertical-align: inherit;">Nous avons donc d√©cid√© d'√©changer Brocade contre Arista.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces commutateurs sont des commutateurs d'agr√©gation LAN pour chaque centre de donn√©es. </font><font style="vertical-align: inherit;">Les commutateurs de distribution (le deuxi√®me niveau d'agr√©gation) leur sont directement connect√©s, qui sont d√©j√† assembl√©s en eux-m√™mes Commutateurs LAN haut de gamme dans des racks de serveurs.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/wr/_k/mn/wr_kmn_mxcbk5pzlszif5fwpmmy.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque serveur est inclus dans un ou deux commutateurs d'acc√®s. Les commutateurs d'acc√®s sont connect√©s √† une paire de commutateurs de distribution (deux commutateurs de distribution et deux liaisons physiques du commutateur d'acc√®s √† diff√©rents commutateurs de distribution sont utilis√©s pour la redondance). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque serveur peut √™tre utilis√© par son client, donc un VLAN distinct est allou√© au client. Le m√™me VLAN est ensuite attribu√© √† un autre serveur de ce client dans n'importe quel rack. Le centre de donn√©es se compose de plusieurs lignes de ce type (POD), chaque ligne de racks poss√®de ses propres commutateurs de distribution. Ces commutateurs de distribution sont ensuite connect√©s aux commutateurs d'agr√©gation.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/2p/r5/oc2pr5parnr_c3-m4s1fswgxlcm.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les clients peuvent commander un serveur dans n'importe quelle ligne, il est impossible de pr√©voir √† l'avance que le serveur sera allou√© ou install√© dans une ligne particuli√®re dans un rack particulier.Par cons√©quent, il y a environ 2500 VLAN dans chaque centre de donn√©es sur des commutateurs d'agr√©gation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©quipement pour DCI (Data-Center Interconnect) se connecte aux commutateurs d'agr√©gation. Il peut √™tre utilis√© pour la connectivit√© L2 (une paire de commutateurs formant un tunnel VXLAN vers un autre centre de donn√©es) et pour la connectivit√© L3 (deux routeurs MPLS).</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/eh/2a/pg/eh2apgb0jx6excyolzu7hlqwwiy.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme je l'ai d√©j√† √©crit, afin d'unifier les processus d'automatisation de la configuration des services sur les √©quipements d'un m√™me centre de donn√©es, il a fallu remplacer les commutateurs d'agr√©gation centralis√©s. </font><font style="vertical-align: inherit;">Nous avons install√© de nouveaux commutateurs √† c√¥t√© des commutateurs existants, les avons combin√©s en une paire MLAG et avons commenc√© √† nous pr√©parer pour le travail. </font><font style="vertical-align: inherit;">Ils ont √©t√© imm√©diatement connect√©s aux commutateurs d'agr√©gation existants, de sorte qu'ils avaient un domaine L2 commun sur tous les VLAN clients.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tails du circuit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par sp√©cificit√©, nous appellerons les anciens commutateurs d'agr√©gation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les nouveaux - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Imaginez que dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POD 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POD 4,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il existe des serveurs d'un client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le VLAN du client est indiqu√© en bleu. Ce client utilise le service de connectivit√© L2 avec un autre centre de donn√©es, de sorte que son VLAN est servi sur une paire de commutateurs VXLAN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> place les serveurs dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POD 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POD 3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous d√©signons le VLAN du client comme vert fonc√©. Ce client utilise √©galement le service de connectivit√© avec un autre centre de donn√©es, mais L3, de sorte que son VLAN est servi sur une paire de routeurs L3VPN.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/pl/tx/8t/pltx8tm018xdgys6sbk08dng6_w.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons besoin des VLAN clients pour comprendre √† quelles √©tapes du travail de remplacement ce qui se passe, o√π la coupure de communication se produit et quelle peut √™tre sa dur√©e. </font><font style="vertical-align: inherit;">Le protocole STP n'est pas utilis√© dans ce sch√©ma, car la largeur de l'arborescence dans ce cas est grande et la convergence du protocole cro√Æt de fa√ßon exponentielle √† partir du nombre d'appareils et de liens entre eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les appareils connect√©s par des liaisons doubles forment une pile, une paire MLAG ou une usine VCS-Ethernet. </font><font style="vertical-align: inherit;">Ces technologies ne sont pas utilis√©es pour une paire de routeurs L3VPN, car il n'y a pas besoin de redondance L2, il suffit qu'ils aient une connectivit√© L2 entre eux via des commutateurs d'agr√©gation.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Options d'impl√©mentation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En analysant les options pour d'autres √©v√©nements, nous avons r√©alis√© qu'il existe plusieurs fa√ßons de r√©aliser ces travaux. </font><font style="vertical-align: inherit;">D'une interruption globale sur l'ensemble du r√©seau local √† de petites interruptions litt√©rales de 1 √† 2 secondes dans certaines parties du r√©seau.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©seau, debout! </font><font style="vertical-align: inherit;">Commutateurs, remplacez!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fa√ßon la </font><font style="vertical-align: inherit;">plus simple - est, bien s√ªr, annoncent un lien de rupture dans tous les </font><font style="vertical-align: inherit;">POD mondiaux et tous les </font><font style="vertical-align: inherit;">services DCI et passer tous les liens du commutateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans les commutateurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/oe/ru/gj/oerugjzsi4pdh1lqcnu5bxyzlra.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus de la rupture, dont nous ne pouvons garantir le temps (oui, nous connaissons le nombre de liens, mais nous ne savons pas combien de fois quelque chose va mal - d'un cordon de raccordement cass√© ou d'un connecteur endommag√© √† un port ou un dysfonctionnement de l'√©metteur-r√©cepteur), nous ne pouvons toujours pas pour pr√©voir √† l'avance si la longueur des cordons de brassage, DAC, AOC, connect√©s aux anciens commutateurs A, est suffisante pour les atteindre, bien que se trouvant √† c√¥t√© d'eux, mais toujours l√©g√®rement s√©par√©s, les nouveaux commutateurs N, et si les m√™mes √©metteurs-r√©cepteurs fonctionneront / DAC / AOC des commutateurs Brocade dans les commutateurs Arista.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et tout cela dans des conditions de forte pression des clients et du support technique ("Natasha, l√®ve-toi! Natasha, tout ne fonctionne pas l√†-bas! Natasha, nous avons d√©j√† √©crit le support technique, honn√™tement, honn√™tement! Natasha, ils ont d√©j√† tout l√¢ch√© l√†-bas! Natasha, mais combien n'a pas √ßa va marcher? Natasha, et quand √ßa marche?! "). </font><font style="vertical-align: inherit;">M√™me malgr√© une interruption annonc√©e au pr√©alable et une notification aux clients, un afflux d'appels √† un tel moment est garanti.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attendez, 1-2-3-4!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et sinon pour d√©clarer une rupture globale, mais pour annoncer une s√©rie de petites ruptures de communication sur les services POD et DCI. </font><font style="vertical-align: inherit;">Lors de la premi√®re interruption, </font><font style="vertical-align: inherit;">ne </font><font style="vertical-align: inherit;">commutez </font><font style="vertical-align: inherit;">que les </font><font style="vertical-align: inherit;">commutateurs </font><b><font style="vertical-align: inherit;">POD 1 √† </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans le second - apr√®s quelques jours - </font><b><font style="vertical-align: inherit;">POD 2</font></b><font style="vertical-align: inherit;"> , puis apr√®s quelques jours </font><b><font style="vertical-align: inherit;">POD 3</font></b><font style="vertical-align: inherit;"> , puis </font><b><font style="vertical-align: inherit;">POD 4 ... [N]</font></b><font style="vertical-align: inherit;"> , puis les commutateurs VXLAN, puis les routeurs L3VPN.</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/dg/1n/8o/dg1n8oei0wx04clgnk2a0emzu-o.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec une telle organisation de changement de travail, nous r√©duisons la complexit√© du travail ponctuel et augmentons notre temps pour r√©soudre les probl√®mes en cas de probl√®me soudain. La connectivit√© du POD 1 apr√®s la commutation avec d'autres POD et DCI n'est pas perdue. Mais le travail lui-m√™me est retard√© pendant longtemps, pendant le temps de ce travail dans le centre de donn√©es, un ing√©nieur est tenu d'effectuer physiquement la commutation, et pendant le travail (et ce travail est g√©n√©ralement effectu√© la nuit, de 2 √† 5 heures du matin), la pr√©sence d'un ing√©nieur r√©seau en ligne est assez √©lev√©e qualifications. Mais nous obtenons de courtes pauses dans la communication, en r√®gle g√©n√©rale, le travail peut √™tre effectu√© dans l'intervalle d'une demi-heure avec une pause pouvant aller jusqu'√† 2 minutes (en pratique, souvent 20-30 secondes avec le comportement attendu de l'√©quipement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'exemple ci-dessus, client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous devrez avertir du travail avec une interruption des communications au moins trois fois - la premi√®re fois pour effectuer un travail sur un POD, dans lequel l'un de ses serveurs est situ√©, la deuxi√®me fois - sur le deuxi√®me et la troisi√®me fois - lors du changement d'√©quipement pour les services DCI.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Changement de canaux de communication agr√©g√©s</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi parlons-nous du comportement attendu de l'√©quipement et comment les canaux agr√©g√©s peuvent-ils commuter avec une minimisation des interruptions de communication? </font><font style="vertical-align: inherit;">Imaginez l'image suivante:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/s0/g5/4b/s0g54bkj-ujiumk0egmyp7ookv0.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'une part, le lien est les commutateurs de distribution POD - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ils forment une paire MLAG (pile, usine VCS, paire vPC), d'autre part deux liens - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sont inclus dans l'ancienne paire MLAG commutateur agr√©gation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Du c√¥t√© des commutateurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constituaient une interface agr√©g√©e appel√©e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port-canal A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , du c√¥t√© des commutateurs d'agr√©gation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - une interface agr√©g√©e appel√©e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port D-canal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les interfaces agr√©g√©es utilisent LACP dans leur travail, c'est-√†-dire que les commutateurs des deux c√¥t√©s √©changent r√©guli√®rement des paquets LACPDU sur les deux liaisons pour s'assurer que les liaisons:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ouvriers;</font></font></li>
<li>       .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'√©change de paquets dans un paquet, la valeur d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID syst√®me</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est transmise </font><font style="vertical-align: inherit;">, ce qui indique le p√©riph√©rique sur lequel ces liens sont inclus. Pour une paire MLAG (pile, usine, etc.), la valeur de system-id pour les p√©riph√©riques formant l'interface agr√©g√©e est la m√™me. Le commutateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> envoie un </font><b><font style="vertical-align: inherit;">syst√®me ID-D de</font></b><font style="vertical-align: inherit;"> valeur de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liaison 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et le commutateur </font><b><font style="vertical-align: inherit;">D2</font></b><font style="vertical-align: inherit;"> envoie un </font><b><font style="vertical-align: inherit;">syst√®me ID-D de</font></b><font style="vertical-align: inherit;"> valeur de </font><b><font style="vertical-align: inherit;">liaison 2</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Les commutateurs </font><b><font style="vertical-align: inherit;">A1</font></b><font style="vertical-align: inherit;"> et </font><b><font style="vertical-align: inherit;">A2</font></b><font style="vertical-align: inherit;"> analysent les paquets LACPDU re√ßus sur la m√™me interface Po D et v√©rifient que l'ID syst√®me en eux correspond. Si l'ID syst√®me re√ßu par un lien diff√®re soudainement </font><b><font style="vertical-align: inherit;">de la valeur de travail actuelle</font></b></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce lien est supprim√© de l'interface agr√©g√©e jusqu'√† ce que la situation soit corrig√©e. </font><font style="vertical-align: inherit;">Maintenant , </font><font style="vertical-align: inherit;">nous passons √† c√¥t√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la valeur actuelle du syst√®me-id LACP-partenaire - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et les </font><font style="vertical-align: inherit;">commutateurs du c√¥t√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - la valeur du </font><font style="vertical-align: inherit;">syst√®me actuel de id LACP-partenaire - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous devez changer l'interface agr√©g√©e, nous pouvons proc√©der de deux mani√®res diff√©rentes:</font></font></b></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thode 1 - Simple</font></font></b>
                        <div class="spoiler_text"><b>     A</b>.      .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/4x/y3/1f/4xy31fons85dmc1xqmyoatx3cok.jpeg"></div></a><br>
       <b>N</b>,       LACP,   <b>Po D</b>   <b>N</b>      <b>system-id N</b>.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/9o/-x/d2/9o-xd2p6oyk3x_yxroz_tlh6hbc.jpeg"></div></a><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thode 2 - Minimisez la pause</font></font></b>
                        <div class="spoiler_text"><b>   2  Link 2</b>.     <b></b>  <b>D</b>       ,      .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/hw/u-/zy/hwu-zy2rypxofaqv9llskenulbm.jpeg"></div></a><br>
<b> Link 2   N2</b>.   <b>N</b>     <b>Po DN</b>,   <b>N2</b>    LACPDU <b>system-id N</b>.       ,   <b>N2</b>    ,   <b>Link 2</b>,       <b>Up</b>,     LACPDU      .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/cw/cy/st/cwcysth25wi_quoldhjghlysgx8.jpeg"></div></a><br>
  ,   <b>D2</b>    <b>Po A</b>   <b>Link 2   system-id N,      system-id A</b>,    <b>D</b>  <b>Link 2</b>     <b>Po A</b>.  <b>N</b>    <b>Link 2</b>  ,          LACP-  <b>D2</b>.     <b>Link 2</b>  .<br>
<br>
<b>    Link 1   A1</b>,     <b></b>  <b>D</b>   .  ,    <b>D</b>     system-id   <b>Po A</b>.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/me/uw/8u/meuw8uq0g5lglbxkt6qwbdiodtg.jpeg"></div></a><br>
   <b>D</b>  <b>N</b>    system-id <b>A-N</b>   <b>Po A</b>  <b>Po DN</b>,        <b>Link 2</b>.     ,  ,  2 .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/rj/zs/ai/rjzsai50lw8dbbxbk0ntlicofoa.jpeg"></div></a><br>
<b>     Link 1   N1</b>,       <b>Po A</b>  <b>Po DN</b>.           system-id    ,    .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/8_/3c/vd8_3cszxwsxtwdcrewohql3arg.jpeg"></div></a><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens suppl√©mentaires</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais la commutation peut se faire sans la pr√©sence d'un ing√©nieur au moment de la commutation. </font><font style="vertical-align: inherit;">Pour ce faire, nous avons besoin d' effectuer une </font><font style="vertical-align: inherit;">pr√©-lay liens suppl√©mentaires entre les </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commutateurs de distribution </font><font style="vertical-align: inherit;">et les nouveaux </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commutateurs d'agr√©gation </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/sb/3h/dusb3hcwgnj_rt8kgkusiitltdk.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous √©tablissons de nouveaux liens entre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commutateurs d' </font><font style="vertical-align: inherit;">agr√©gation </font><font style="vertical-align: inherit;">et tous les commutateurs de distribution POD. Cela n√©cessite l' </font><font style="vertical-align: inherit;">ordre et la </font><font style="vertical-align: inherit;">pose des c√¢bles de raccordement suppl√©mentaires et installer des </font><font style="vertical-align: inherit;">√©metteurs - </font><font style="vertical-align: inherit;">r√©cepteurs suppl√©mentaires dans les </font><font style="vertical-align: inherit;">deux </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous pouvons le faire parce que nous </font><font style="vertical-align: inherit;">avons des ports libres </font><font style="vertical-align: inherit;">dans les commutateurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><font style="vertical-align: inherit;">chaque POD (ou nous les lib√©rons d'abord). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cons√©quence, chaque POD est physiquement connect√© par deux liaisons aux anciens commutateurs A et aux nouveaux commutateurs N.</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/wj/m-/32wjm-s5ehe6o1vlkvtrhcpn_mq.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deux interfaces agr√©g√©es sont form√©es </font><font style="vertical-align: inherit;">
sur le commutateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Po A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec les liaisons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Po N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec les liaisons </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link N1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link N2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . √Ä ce stade, nous v√©rifions la connexion correcte des interfaces et des liaisons, les niveaux de signaux optiques aux deux extr√©mit√©s des liaisons (via les informations DDM des commutateurs), nous pouvons m√™me v√©rifier la capacit√© de travail de la liaison sous charge ou surveiller l'√©tat des signaux optiques et les temp√©ratures de l'√©metteur-r√©cepteur pendant quelques jours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le trafic est toujours transmis via l' </font><font style="vertical-align: inherit;">interface </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Po A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tandis que l'interface </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Po N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">exempte de trafic. Les param√®tres sur les interfaces sont approximativement les suivants:</font></font><br>
<br>
<pre><code class="plaintext hljs">Interface Port-channel A<font></font>
Switchport mode trunk<font></font>
Switchport allowed vlan C1, C2<font></font>
<font></font>
Interface Port-channel N<font></font>
Switchport mode trunk<font></font>
Switchport allowed vlan none</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les commutateurs D, en r√®gle g√©n√©rale, prennent en charge le changement de configuration de session; ces mod√®les de commutateur qui ont cette fonctionnalit√© sont utilis√©s. Nous pouvons donc modifier les param√®tres des interfaces Po A et Po N en une seule fois:</font></font><br>
<br>
<pre><code class="plaintext hljs">Configure session<font></font>
Interface Port-channel A<font></font>
Switchport allowed vlan none<font></font>
Interface Port-channel N<font></font>
Switchport allowed vlan C1, C2<font></font>
Commit</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, le changement de configuration se produira assez rapidement, et la pause ne sera, en pratique, pas plus de 5 secondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette m√©thode nous permet d'effectuer √† l'avance tous les travaux pr√©paratoires, d'effectuer toutes les v√©rifications n√©cessaires, de coordonner le travail avec les participants au processus, de pr√©voir en d√©tail les actions pour la production de travaux, sans travail cr√©atif, lorsque ¬´tout s'est mal pass√©¬ª, et d'avoir en main un plan de retour √† la configuration pr√©c√©dente. </font><font style="vertical-align: inherit;">Le travail sur ce plan est effectu√© par un ing√©nieur r√©seau sans la pr√©sence d'un centre de donn√©es sur site de l'ing√©nieur qui effectue physiquement la commutation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui est plus important avec cette m√©thode de commutation - tous les nouveaux liens sont d√©j√† pr√©r√©gl√©s pour la surveillance. </font><font style="vertical-align: inherit;">Erreurs, inclusion de liens dans l'unit√©, chargement des liens - toutes les informations n√©cessaires sont d√©j√† dans le syst√®me de surveillance, et elles sont d√©j√† dessin√©es sur les cartes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jour J</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cosse</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons choisi le moins douloureux pour les clients et le moins enclin au commutateur "quelque chose s'est mal pass√©" avec des liens suppl√©mentaires. </font><font style="vertical-align: inherit;">Donc, pendant quelques nuits, nous avons commut√© tous les POD vers les nouveaux commutateurs d'agr√©gation.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/lm/c0/oa/lmc0oafevg5twt9amzd2thudqgm.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il reste √† changer d'√©quipement fournissant des services DCI.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L2</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le cas d'√©quipements fournissant une connectivit√© L2, nous n'avons pas pu effectuer de travaux similaires avec des liaisons suppl√©mentaires. </font><font style="vertical-align: inherit;">Il y a au moins deux raisons √† cela:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manque de ports libres de la vitesse requise sur les commutateurs VXLAN.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manque de fonctionnalit√©s pour les modifications de configuration de session sur les commutateurs VXLAN.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous n'avons pas chang√© les liens ¬´un √† la fois¬ª avec une interruption uniquement pendant la dur√©e de l'approbation d'une nouvelle paire d'ID syst√®me, car nous n'avions pas 100% de confiance que la proc√©dure serait correcte, et un test en laboratoire a montr√© que, dans le cas si ¬´quelque chose ne va pas¬ª, nous obtenons toujours une coupure de connexion, et le pire n'est pas seulement pour les clients qui ont une connectivit√© L2 avec d'autres centres de donn√©es, mais pour tous les clients de ce centre de donn√©es en g√©n√©ral.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons effectu√© un travail de propagande sur la commutation des canaux L2 √† l'avance, de sorte que le nombre de clients concern√©s par les travaux sur les commutateurs VXLAN √©tait d√©j√† plusieurs fois inf√©rieur √† il y a un an. </font><font style="vertical-align: inherit;">En cons√©quence, nous avons d√©cid√© d'interrompre la communication sur le service de connectivit√© L2, √† condition de maintenir le fonctionnement normal des services de r√©seau local dans un centre de donn√©es. </font><font style="vertical-align: inherit;">De plus, le SLA de ce service pr√©voit la possibilit√© de travaux planifi√©s avec interruption.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi avons-nous recommand√© √† tout le monde de passer √† l'utilisation de L3VPN lors de l'organisation des services DCI? L'une des raisons est la possibilit√© de travailler sur l'un des routeurs qui fournissent ce service, simplement avec une r√©duction du niveau de redondance √† N + 0, sans interruption de communication. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinez de plus pr√®s le syst√®me de prestation de services. Dans ce service, le segment L2 passe des serveurs clients uniquement aux routeurs Selectel L3VPN. Sur les routeurs, le r√©seau client est termin√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque serveur client, par exemple, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le diagramme ci-dessus, a ses propres adresses IP priv√©es - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.0.2/24 pour le serveur S2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.0.3/24 pour le serveur S3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Adresses </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.0.252/24</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.0.253/24</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">attribu√© par Selectel aux routeurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , respectivement. </font><font style="vertical-align: inherit;">L'adresse IP </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.0.254/24 est une adresse VIP VRRP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur les routeurs Selectel.</font></font><br>
<br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">savoir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plus sur le service L3VPN </font><font style="vertical-align: inherit;">sur notre blog.</font></font></b></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'au moment de la commutation, tout ressemblait approximativement au sch√©ma:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/lu/z9/_l/luz9_l1950pk5r3vr5hrn-tdnss.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deux routeurs </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont √©t√© connect√©s √† l'ancienne agr√©gation du commutateur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le ma√Ætre pour les adresses VIP VRRP 10.0.0.254 est le routeur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il a une priorit√© d√©finie sur cette adresse sup√©rieure √† celle du routeur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="plaintext hljs">unit 1006 {<font></font>
    description C2;<font></font>
    vlan-id 1006;<font></font>
    family inet {       <font></font>
        address 10.0.0.252/24 {<font></font>
            vrrp-group 1 {<font></font>
                priority 200;<font></font>
                virtual-address 10.100.0.254;<font></font>
                preempt {<font></font>
                    hold-time 120;<font></font>
                }<font></font>
                accept-data;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le serveur S2 utilise la passerelle 10.0.0.254 pour communiquer avec les serveurs d'autres emplacements. </font><font style="vertical-align: inherit;">Ainsi, la d√©connexion du routeur L3VPN-2 du r√©seau (bien s√ªr, si vous le d√©connectez d'abord du domaine MPLS) n'affecte pas la connectivit√© des serveurs clients. </font><font style="vertical-align: inherit;">√Ä ce stade, le niveau de redondance du circuit diminue simplement.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/gj/oi/sk/gjoiskqum4kmknfm8u36cf5v44w.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, nous pouvons reconnecter en toute s√©curit√© le routeur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† la paire de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> commutateurs </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Disposez les liens, changez les √©metteurs-r√©cepteurs. </font><font style="vertical-align: inherit;">Les interfaces logiques du routeur, dont d√©pend le travail des services clients, jusqu'√† la confirmation que tout fonctionne comme il se doit, sont d√©sactiv√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir v√©rifi√© les liens, les √©metteurs-r√©cepteurs, les niveaux de signal, les niveaux d'erreur sur les interfaces, le routeur se met en service, mais est d√©j√† connect√© √† une nouvelle paire de commutateurs.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/dh/cs/jbdhcsuakuma1fofufzc-pp0poy.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous diminuons la priorit√© VRRP du routeur L3VPN-1, et l'adresse VIP 10.0.0.254 se d√©place vers le routeur L3VPN-2. </font><font style="vertical-align: inherit;">Ces travaux sont √©galement effectu√©s sans interruption de communication.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/uq/lq/ixuqlq5wx5veluojqgpwfy8yewu.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transfert adresse VIP au routeur 10.0.0.254 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous permet de d√©sactiver le routeur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L3VPN-1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sans interruption de contact pour le client et le </font><font style="vertical-align: inherit;">connecter √† une nouvelle paire de commutateurs d' </font><font style="vertical-align: inherit;">agr√©gation </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de N</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/lx/vo/jv/lxvojv_hiozuurqfsyonclwjez4.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que ce soit pour renvoyer VRRP VIP au routeur L3VPN-1 est une autre question, et si vous revenez, cela se fait sans interruption.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s toutes ces √©tapes, nous avons vraiment remplac√© les commutateurs d'agr√©gation dans l'un de nos centres de donn√©es, tout en minimisant les interruptions pour nos clients.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/fw/d1/jx/fwd1jxarjvfl1agcko-4fhezx7s.jpeg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il ne reste plus qu'√† d√©manteler. </font><font style="vertical-align: inherit;">D√©montage d'anciens commutateurs, d√©mant√®lement d'anciennes liaisons entre les commutateurs A et D, d√©montage des √©metteurs-r√©cepteurs de ces liaisons, correction de la surveillance, fixation des sch√©mas de r√©seau dans la documentation et la surveillance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons utiliser des commutateurs, des √©metteurs-r√©cepteurs, des cordons de raccordement, AOC, DAC apr√®s la commutation, dans d'autres projets ou toute autre commutation similaire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Natasha, nous avons tout chang√©!"</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr498354/index.html">Comment traduire ¬´liste de souhaits¬ª en ¬´mat√©riel¬ª ou semi-semi-mobile semi-id√©al</a></li>
<li><a href="../fr498358/index.html">Apprenez le fran√ßais ou comment obtenir un adaptateur universel √† partir d'un scanner de diagnostic PSA</a></li>
<li><a href="../fr498360/index.html">√âvaluation des m√©triques de charge du serveur int√©gr√©</a></li>
<li><a href="../fr498362/index.html">Kingston conserve son leadership dans les livraisons de SSD: comment faire?</a></li>
<li><a href="../fr498366/index.html">Quels algorithmes les d√©veloppeurs Yandex impl√©mentent-ils chaque jour</a></li>
<li><a href="../fr498370/index.html">SAP UI5 et Windows de confirmation: encore une fois sur le contexte</a></li>
<li><a href="../fr498372/index.html">Tutoriel de simulateur de r√©seau ns-3. Chapitre 5</a></li>
<li><a href="../fr498374/index.html">GPU Computing - Pourquoi, quand et comment. Plus quelques tests</a></li>
<li><a href="../fr498378/index.html">Annonce de l'√©cole du soir de Slurm par Agile</a></li>
<li><a href="../fr498380/index.html">La fen√™tre d'Overton en action: comment une pand√©mie est utilis√©e pour limiter notre libert√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>