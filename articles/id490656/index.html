<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🤝‍👨🏼 🛠️ 🥨 Tugas eksternal Camunda - alat yang ampuh untuk membangun aplikasi dengan arsitektur yang tangguh dan dapat diskalakan 🆗 📢 🎇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di Tinkoff, kami menggunakan kerangka kerja Camunda + Spring untuk mengembangkan sistem otomasi proses bisnis . Kami menjelaskan proses bisnis menggun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tugas eksternal Camunda - alat yang ampuh untuk membangun aplikasi dengan arsitektur yang tangguh dan dapat diskalakan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/490656/"><img src="https://habrastorage.org/webt/sw/nv/az/swnvaz2_ifbzirrprmoucnx0zli.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Tinkoff, kami menggunakan kerangka kerja </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda + Spring</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mengembangkan sistem otomasi proses bisnis </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kami menjelaskan proses bisnis menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BPMN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Notasi Manajemen Proses Bisnis) dalam bentuk bagan alur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elemen yang paling umum digunakan dalam diagram kami adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas servis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gear rectangle). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mendukung dua cara untuk melakukan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas layanan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan panggilan sinkron ke kode java.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat tugas eksternal.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metode kedua memungkinkan Anda untuk melakukan tugas menggunakan sistem eksternal - misalnya, jika Anda perlu memanggil satu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplikasi camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dari yang lain atau bahkan mendelegasikan pekerjaan ke sistem eksternal mana pun.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/27/tm/sd/27tmsdtlkpfvti2vcgdvjl8xcqk.png" alt="gambar"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh Diagram BPMN</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ini berguna ketika Anda bermaksud untuk menggunakan kembali logika di beberapa aplikasi. </font><font style="vertical-align: inherit;">Atau ketika Anda ingin tetap berpegang pada arsitektur microservice. </font><font style="vertical-align: inherit;">Misalnya, memisahkan layanan yang berhubungan dengan proses bisnis dari layanan yang mengimplementasikan tugas teknis, seperti menghasilkan laporan atau pengiriman surat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bersamaan dengan fitur ini, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memberikan arsitektur yang tangguh dan dapat diskalakan. </font><font style="vertical-align: inherit;">Untuk memahami mengapa hal ini terjadi, Anda harus terlebih dahulu memahami bagaimana </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bekerja di tingkat </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BPMN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan aplikasi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tugas eksternal di BPMN</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> melibatkan pembuatan tugas yang dapat dilakukan oleh penangan eksternal. </font><font style="vertical-align: inherit;">Inti dari pola </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah:</font></font><br>
<br>
<ol>
<li>,  «»  ,      «».</li>
<li>     <b>camunda</b>   ,       ,       .</li>
<li>     <b>camunda</b>   (/).</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam diagram di atas, saya menggambarkan proses fiksi di mana kami ingin mendapatkan daftar pengguna, mengirimkan iklan kepada mereka dan setelah 2 jam menghitung jumlah aplikasi setelah buletin pemasaran. </font><font style="vertical-align: inherit;">Dan, jika ada lebih dari 10 aplikasi, tingkatkan pilihan untuk pengiriman berikutnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya ingin aplikasi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> saya </font><font style="vertical-align: inherit;">hanya bertanggung jawab untuk proses bisnis, dan aplikasi lain mana pun </font><b><font style="vertical-align: inherit;">harus</font></b><font style="vertical-align: inherit;"> bertanggung jawab untuk mengirim email. </font><font style="vertical-align: inherit;">Dalam hal ini, pola </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> berfungsi dengan baik untuk saya </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dalam proses saya, saya hanya akan membuat tugas buletin email dan menunggu sampai diselesaikan oleh beberapa penangan eksternal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk membuat </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam diagram </font><font style="vertical-align: inherit;">, Anda harus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> biasa </font><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubah tipenya menjadi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas layanan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan implementasi ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentukan nilai bidang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Topik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br>
<img src="https://habrastorage.org/webt/qk/sf/0p/qksf0pz_6lglnp8_xu42jxphsmg.png" alt="gambar"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Topik</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah nama antrian di mana tugas-tugas dari satu jenis akan ditambahkan dan ke mana pengendali eksternal akan berlangganan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang ada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dalam proses </font><font style="vertical-align: inherit;">, Anda dapat memulainya, tetapi tidak akan dieksekusi, karena tidak ada yang memprosesnya.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pekerja tugas eksternal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pola </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> baik karena memungkinkan Anda untuk mengimplementasikan pemrosesan tugas dalam bahasa apa pun, menggunakan alat apa pun yang dapat melakukan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permintaan HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut ini adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contoh dari blog </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Contoh ini mengimplementasikan penangan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javascript</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eksternal </font><font style="vertical-align: inherit;">yang, setiap 20 detik, meminta </font><font style="vertical-align: inherit;">daftar tugas pemrosesan </font><font style="vertical-align: inherit;">dari </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Jika ada tugas, maka itu mengirim mereka keluar dan memberi tahu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang penyelesaian tugas.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'http://localhost:8080/my-app/rest'</span>;
<span class="hljs-keyword">const</span> workerSettings = {
 <span class="hljs-attr">workerId</span>: <span class="hljs-string">'worker01'</span>, <span class="hljs-comment">// some unique name for the current worker instance</span>
 <span class="hljs-attr">maxTasks</span>: <span class="hljs-number">5</span>,
 <span class="hljs-attr">topics</span>: [<font></font>
   {<font></font>
     <span class="hljs-attr">topicName</span>: <span class="hljs-string">'sendEmail'</span>,
     <span class="hljs-attr">lockDuration</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// How much time the worker thinks he needs to process the task</span>
     <span class="hljs-attr">variables</span>: [<span class="hljs-string">'video'</span>] <span class="hljs-comment">// Which variables should be returned in the response (to avoid additional REST calls to read data)</span><font></font>
   }]};<font></font>
<span class="hljs-keyword">const</span> requestParams = {<span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">headers</span>: {<span class="hljs-attr">contentType</span>: <span class="hljs-string">'application/json'</span>}};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pollExternalTasks</span>(<span class="hljs-params"></span>) </span>{
 <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/external-task/fetchAndLock`</span>, {<font></font>
   ...requestParams,<font></font>
   <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify(workerSettings)<font></font>
 })<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processExternalTask</span>(<span class="hljs-params">result = []</span>) </span>{
 <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(result.map(<span class="hljs-function"><span class="hljs-params">externalTask</span> =&gt;</span> {<font></font>
   sendEmail(externalTask); <span class="hljs-comment">// Here the actual work would be done</span><font></font>
<font></font>
   <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>/external-task/<span class="hljs-subst">${externalTask.id}</span>/complete`</span>, {<font></font>
     ...requestParams,<font></font>
     <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({<span class="hljs-attr">workerId</span>: workerSettings.workerId}),<font></font>
   })<font></font>
 }));<font></font>
}<font></font>
<font></font>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
 pollExternalTasks().then(processExternalTask)<font></font>
}, <span class="hljs-number">20000</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang dapat Anda lihat dari kode di atas, metode utama untuk menangani </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetchAndLock</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selesai</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Metode pertama meminta daftar tugas dan mengamankan implementasinya, dan yang kedua menginformasikan tentang penyelesaian tugas. </font><font style="vertical-align: inherit;">Selain kedua metode ini, ada metode lain, Anda dapat membacanya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di dokumentasi resmi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camunda klien tugas eksternal</font></font></h2><br>
<img src="https://habrastorage.org/webt/sf/td/-g/sftd-gp7palq7dtzvgvpjqyj2y0.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menerapkan pemrosesan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">camunda</font></b><font style="vertical-align: inherit;"> menyediakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font><font style="vertical-align: inherit;">klien </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang memungkinkan Anda membuat penangan tugas eksternal hanya dalam beberapa baris. </font><font style="vertical-align: inherit;">Ada juga </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">panduan terperinci</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang menjelaskan prinsip-prinsip dasar pemrosesan tugas eksternal - lagi dengan contoh dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javascript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh penerapan penangan eksternal menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExternalTaskClient</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String... args)</span> </span>{
       <span class="hljs-comment">// bootstrap the client</span><font></font>
       ExternalTaskClient client = ExternalTaskClient.create()<font></font>
           .baseUrl(<span class="hljs-string">"http://localhost:8080/engine-rest"</span>)<font></font>
           .asyncResponseTimeout(<span class="hljs-number">1000</span>)<font></font>
           .build();<font></font>
<font></font>
       <span class="hljs-comment">// subscribe to the topic</span>
       client.subscribe(<span class="hljs-string">"sendEmail"</span>).handler((externalTask, externalTaskService) -&gt; {
           <span class="hljs-keyword">try</span> {<font></font>
               String result = sendEmail(externalTask)<font></font>
               Map&lt;String, Object&gt; variables = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<font></font>
<font></font>
               variables.put(<span class="hljs-string">"result"</span>, result);<font></font>
               externalTaskService.complete(externalTask, variables);<font></font>
               System.out.println(<span class="hljs-string">"The External Task "</span> + externalTask.getId() + <span class="hljs-string">" has been completed!"</span>);<font></font>
           } <span class="hljs-keyword">catch</span> (e: Exception) {<font></font>
               externalTaskService.handleFailure(externalTask, e.message, e.stackTrace.toString())<font></font>
           }<font></font>
       }).open();<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika tugas Anda mengharuskan tidak hanya melakukan beberapa tindakan sinkron, tetapi memulai seluruh proses, maka Anda dapat melakukannya, misalnya, dengan memulai proses melalui </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RuntimeService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Service</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailWorker</span></span>(
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> runtimeService: RuntimeService<font></font>
) {<font></font>
   <span class="hljs-keyword">val</span> builder = ExternalTaskClientBuilderImpl().baseUrl(<span class="hljs-string">"http://localhost:8080"</span>).workerId(<span class="hljs-string">"myWorker"</span>)
   <span class="hljs-keyword">val</span> taskClient = builder.build()
   <span class="hljs-keyword">val</span> engineClient = (builder <span class="hljs-keyword">as</span> ExternalTaskClientBuilderImpl).engineClient<font></font>
<font></font>
   <span class="hljs-meta">@PostConstruct</span>
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {<font></font>
       taskClient<font></font>
           .subscribe(<span class="hljs-string">"sendEmail"</span>)<font></font>
           .lockDuration(<span class="hljs-number">10000</span>)<font></font>
           .handler { externalTask, externalService -&gt;<font></font>
               runtimeService.startProcessInstanceByKey(<font></font>
                   <span class="hljs-string">"SendEmailProcess"</span>,<font></font>
                   externalTask.getVariable(<span class="hljs-string">"emailId"</span>),<font></font>
                   mapOf(<font></font>
                       <span class="hljs-string">"text"</span> to externalTask.getVariable(<span class="hljs-string">"text"</span>),
                       <span class="hljs-string">"email"</span> to externalTask.getVariable(<span class="hljs-string">"email"</span>)<font></font>
                   )<font></font>
               )<font></font>
           }<font></font>
           .<span class="hljs-keyword">open</span>()<font></font>
   }<font></font>
<font></font>
<font></font>
   <span class="hljs-meta">@PreDestroy</span>
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span> {<font></font>
       taskClient.stop()<font></font>
   }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Delegate from SendEmailProcess process</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailResultDelegate</span></span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> emailWorker: EmailWorker) {
   <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doExecute</span><span class="hljs-params">(execution: <span class="hljs-type">DelegateExecution</span>)</span></span> {<font></font>
       emailWorker.engineClient.complete(<font></font>
           execution.readVar(EXTERNAL_TASK_ID),<font></font>
           mapOf(<span class="hljs-string">"result"</span> to <span class="hljs-string">"Success"</span>)<font></font>
       )<font></font>
   }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh ini, penangan tugas eksternal ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailWorker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ketika tugas diterima, memulai proses </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SendEmailProcess</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bayangkan proses ini melakukan beberapa tindakan yang diperlukan untuk mengirim nawala, dan pada akhirnya memanggil </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailResultDelegate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang, pada gilirannya, menyelesaikan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manfaat Arsitektur dari Tugas Eksternal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa ada cara untuk memulai proses dalam aplikasi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lain </font><font style="vertical-align: inherit;">dengan cara yang lebih sederhana: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST: / rest / process-definition / key / $ {id} / start</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ketika Anda menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Anda tidak memiliki jaminan transaksi. Tapi bagaimanapun, </font><font style="vertical-align: inherit;">kami juga bekerja </font><font style="vertical-align: inherit;">dengan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> melalui </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apa bedanya? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perbedaannya adalah bahwa kita tidak memanggil layanan eksternal secara langsung, tetapi hanya mempublikasikan tugas yang dapat diproses. Pertimbangkan sebuah contoh: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cv/-3/iv/cv-3ivsxpit3o3q8zosyi1e9jkw.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa penangan eksternal mengambil tugas yang sekarang ditugaskan kepadanya, tetapi ketika respons diterima, koneksi terputus. Sekarang di sisi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas yang tidak akan diproses diblokir karena penangan eksternal tidak menerima respons. Tapi ini tidak menakutkan: di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas-tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ada batas waktu dimana tugas akan kembali ke antrian lagi dan orang lain dapat mengatasinya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita lihat kasus ketika penangan eksternal menerima tugas, menyelesaikannya, dan memanggil metode </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lengkap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang gagal karena masalah jaringan. Sekarang Anda tidak akan dapat memahami apakah tugas itu berhasil diselesaikan di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">camunda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau tidak. Anda dapat mencoba lagi, tetapi ada kemungkinan masalah jaringan akan berlanjut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam hal ini, solusi terbaik adalah dengan mengabaikan masalahnya. Jika tugas berhasil diselesaikan, maka semuanya beres. Jika tidak, setelah batas waktu tugas akan tersedia lagi untuk diproses. Tetapi ini berarti bahwa pawang eksternal Anda harus idempoten atau mengandung logika untuk menduplikasi tugas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah serupa dapat terjadi ketika memulai proses baru, jadi Anda harus memeriksa contoh yang ada dengan data yang sama, misalnya, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">businessKey</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain </font><b><font style="vertical-align: inherit;">tugas eksternal</font></b><font style="vertical-align: inherit;"> toleransi kesalahan tinggi</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memungkinkan Anda untuk skala penangan eksternal dengan mudah dan menerapkannya dalam bahasa pemrograman apa pun. </font><font style="vertical-align: inherit;">Pada saat yang sama, polanya membantu untuk mengimplementasikan layanan-layanan mikro sehingga mereka saling memengaruhi sesedikit mungkin, sehingga meningkatkan stabilitasnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih lanjut tentang </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tugas eksternal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/user-guide/process-engine/external-tasks/ </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/reference/rest/external -task / </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.camunda.org/manual/latest/user-guide/ext-client/</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490644/index.html">Repositori rpm sederhana menggunakan Inotify dan webdav</a></li>
<li><a href="../id490648/index.html">Menggunakan Kata Containers di Kubernetes</a></li>
<li><a href="../id490650/index.html">Kesalahan utama dalam menyusun CV oleh spesialis IT pemula</a></li>
<li><a href="../id490652/index.html">Logistik. pengantar Hampir rumit</a></li>
<li><a href="../id490654/index.html">Mengotori sensor gas Seri MQ - pemahaman mendalam tentang lembar data dan penyetelan</a></li>
<li><a href="../id490660/index.html">Bagaimana kami memastikan pertumbuhan CityMobile</a></li>
<li><a href="../id490664/index.html">PHP: array_key_exists mencari 500 kali lebih cepat daripada in_array</a></li>
<li><a href="../id490668/index.html">Sejarah transformasi dari produk ke proyek dan sebaliknya (menggunakan contoh Goodness di wilayah Moskow)</a></li>
<li><a href="../id490670/index.html">Cara membuat mobil menulis tes dari kode untuk Anda</a></li>
<li><a href="../id490674/index.html">Habr Wickley # 41 / Lebih banyak mobil otonom, prof. Fortran, Yandex, rasa sakit robot, cara memblokir situs pesaing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>