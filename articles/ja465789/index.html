<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰 👨🏾‍⚖️ 👋 Cisco 200-125 CCNA v3.0のトレーニング。29日目。PATとNAT 👩🏽‍🤝‍👨🏼 📯 👷🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日は、ポートを使用してIPアドレスを変換する技術であるPAT（ポートアドレス変換）と、中継パケットのIPアドレスを変換する技術であるNAT（ネットワークアドレス変換）について学習します。 PATはNATの特殊なケースです。 3つのトピックを検討します。- 
 
 プライベート、または内部（イントラ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cisco 200-125 CCNA v3.0のトレーニング。29日目。PATとNAT</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/465789/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日は、ポートを使用してIPアドレスを変換する技術であるPAT（ポートアドレス変換）と、中継パケットのIPアドレスを変換する技術であるNAT（ネットワークアドレス変換）について学習します。 PATはNATの特殊なケースです。 3つのトピックを検討します。- </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 プライベート、または内部（イントラネット、ローカル）IPアドレスとパブリックまたは外部IPアドレス。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -NATおよびPAT。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -NAT / PATを設定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プライベートIPアドレスから始めましょう。 A、B、Cの3つのクラスに分かれてい</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ob/rv/le/obrvlewzzejxlfwxxbi_90zkrwe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">クラスA </font><font style="vertical-align: inherit;">の</font><font style="vertical-align: inherit;">内部アドレスは、10.0.0.0から10.255.255.255までの「数十」の範囲を占め、外部アドレスは、1.0.0.0から9までです。255.255.255から11.0.0.0〜126.255.255.255。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスBの内部アドレスの範囲は172.16.0.0〜172.31.255.255で、外部アドレスの範囲は128.0.0.0〜172.15.255.255および172.32.0.0〜191.255.255.255です。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスCの内部アドレスは192.168.0.0から192.168.255.255の範囲であり、外部アドレスは192.0.0から192.167.255.255および192.169.0.0から223.255.255.255の範囲です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-e/_r/ba/-e_rba3erd3jnyymki4ebjwu9fs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスAアドレスは、アドレス/ 8、クラスB-/ 12およびクラスC-/ 16です。したがって、異なるクラスの外部IPアドレスと内部IPアドレスは、異なる範囲を占有します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プライベートIPアドレスとパブリックIPアドレスの違いについては、繰り返し説明しました。一般的に、ルーターと内部IPアドレスのグループがある場合、それらをインターネットに接続しようとすると、ルーターがそれらを外部IPアドレスに変換します。内部アドレスはローカルネットワークでのみ使用され、インターネットでは使用されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドラインを使用してコンピューターのネットワークパラメーターを表示すると、内部LAN IPアドレス192.168.1.103が表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hq/tx/wf/hqtxwfez60be9ufwpywe72ldll4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パブリックIPアドレスを確認するには、「私のIPとは」などのインターネットサービスを利用できますか？ご覧のとおり、コンピュータ78.100.196.163の外部アドレスは内部アドレスとは異なります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wm/1n/w0/wm1nw0n_syo74vtnmskictzyx8e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての場合において、私のコンピューターは、外部IPアドレスによって正確にインターネット上に表示されます。したがって、私のコンピュータの内部アドレスは192.168.1.103で、外部アドレスは78.100.196.163です。内部アドレスはローカル通信にのみ使用され、それを使用してインターネットにアクセスすることはできません。これには、パブリックIPアドレスが必要です。ビデオチュートリアルの3日目を確認すると、プライベートアドレスとパブリックアドレスが分離された理由を思い出すことができます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。NATとは何かを検討してください。 NATには、静的、動的、および過負荷NAT、つまりPATの3つのタイプがあります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sq/os/yh/sqosyhlr7iwvdpydrfys3xigo9m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ciscoには、NATを表す4つの用語があります。前述したように、NATは内部アドレスを外部アドレスに変換するためのメカニズムです。インターネットに接続されているデバイスがローカルネットワークから別のデバイスからパケットを受信した場合、内部アドレスの形式がグローバルインターネットで使用されているアドレスの形式と一致しないため、このパケットがドロップされます。したがって、デバイスはインターネットにアクセスするためにパブリックIPアドレスを受信する必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最初の用語は内部ローカルです。これは、内部LAN上のホストのIPアドレスを意味します。簡単に言えば、これはタイプ192.168.1.10のプライマリソースアドレスです。 2番目の用語、Inside Globalは、ローカルホストのIPアドレスであり、その下で外部ネットワークに表示されます。この例では、これはルーター200.124.22.10の外部ポートのIPアドレスです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/b_/ia/sj/b_iasjqtn7zpepgxzpykgutrnxg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inside LocalはプライベートIPアドレスであり、Inside GlobalはパブリックIPアドレスであると言えます。内部という用語はトラフィックのソースを指すために使用され、外部はトラフィックの目的を指すために使用されていることに注意してください。外部ローカルは、外部ネットワーク上のホストのIPアドレスであり、その下で内部ネットワークから見える。簡単に言えば、これは内部ネットワークから見える受信者アドレスです。このようなアドレスの例は、インターネット上にあるデバイスのIPアドレス200.124.22.100です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/sm/o-/eysmo-pr4ikwlwag52qkmag4zeu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outside Globalは、外部ネットワークに表示されるホストIPアドレスです。ほとんどの場合、外部ローカルアドレスと外部グローバルアドレスは同じように見えます。これは、変換後でも、ソースの宛先IPアドレスは変換前と同じであるためです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/tn/xq/bgtnxq5blz5qdtgtnpqddu8rr08.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
静的NATとは何かを検討してください。スタティックNATは、内部IPアドレスから外部への1対1変換、または1対1変換を意味します。デバイスがインターネットにトラフィックを送信すると、その内部ローカル内部アドレスは内部グローバル内部アドレスに変換されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oo/n6/ql/oon6qlova0vcwlg7bovpduisxho.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカルネットワークには3つのデバイスがあり、デバイスがオンラインになると、それぞれが独自の内部グローバルアドレスを取得します。これらのアドレスは、トラフィックソースに静的に割り当てられます。 1対1の原則は、ローカルネットワークに100台のデバイスが配置されている場合、100個の外部アドレスを受け取ることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NATは、パブリックIPアドレスで終わったインターネットを救うように見えました。 NATのおかげで、多くの企業、多くのネットワークが1つの共通の外部IPアドレスを持つことができ、インターネットにアクセスするときにローカルデバイスアドレスが変換されます。この静的NATの場合、100台のローカルコンピューターに100個の外部アドレスが割り当てられているため、アドレス数を節約することはできません。ただし、静的NATにはいくつかの利点があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、内部IPアドレスが192.168.1.100のサーバーがあります。インターネットからの何らかのデバイスが彼に連絡したい場合、彼は内部宛先アドレスを使用してこれを行うことができません。そのため、彼はサーバー200.124.22.3の外部アドレスを使用する必要があります。ルーターで静的NATが構成されている場合、200.124.22.3宛てのすべてのトラフィックは自動的に192.168.1.100に転送されます。これにより、ローカルネットワーク上のデバイス、この場合は会社のWebサーバーへの外部アクセスが提供されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
動的NATを検討してください。これはスタティックに非常に似ていますが、各ローカルデバイスに永続的な外部アドレスを割り当てません。たとえば、3つのローカルデバイスと2つの外部アドレスしかありません。 2番目のデバイスがオンラインになりたい場合は、最初の空きIPアドレスが割り当てられます。その後、Webサーバーがオンラインになりたい場合、ルーターは2番目に使用可能な外部アドレスをそれに割り当てます。その後、最初のデバイスが外部ネットワークに移動したい場合、使用可能なIPアドレスがないため、ルーターはパケットをドロップします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/uf/lt/iduflt-hi8gyfgpgkotj8sagyxs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは内部IPアドレスを持つ何百ものデバイスを持つことができ、これらのデバイスのそれぞれはオンラインになることができます。ただし、外部アドレスの静的割り当てがないため、動的に割り当てられる外部アドレスは2つしかないため、同時にインターネットにアクセスできるデバイスは数百台のうち2台以下です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シスコのデバイスのデフォルトのアドレス変換時間は、デフォルトで24時間です。いつでも1、2、3、10分に変更できます。この後、外部アドレスは解放され、自動的にアドレスプールに返されます。この時点で最初のデバイスがオンラインになり、外部アドレスが使用可能な場合、デバイスはそれを受信します。ルーターには動的に更新されるNATテーブルが含まれており、変換時間が経過するまで、割り当てられたアドレスはデバイスによって保存されます。簡単に言えば、ダイナミックNATは、「誰が最初に来たのか」という原則に基づいて機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
過負荷のNAT、つまりPATの構成要素を検討してください。これは最も一般的なタイプのNATです。ホームネットワークには多くのデバイス（PC、スマートフォン、ラップトップ、タブレット）があり、それらすべてが1つの外部IPアドレスを持つルーターに接続されています。したがって、PATを使用すると、内部IPアドレスを持つ多くのデバイスを1つの外部IPアドレスで同時にオンラインにすることができます。これは、各プライベート内部IPアドレスが通信セッション中に特定のポート番号を使用するために可能です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのパブリックアドレス200.124.22.1と多くのローカルデバイスがあるとします。したがって、インターネットにアクセスすると、これらすべてのホストは同じアドレス200.124.22.1を受け取ります。それらを互いに区別する唯一のものはポート番号です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トランスポート層の説明を覚えている場合は、トランスポート層にポート番号が含まれていて、送信元ポート番号が乱数であることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/6v/rd/bd6vrdsnsfezgoads3mbzzphcco.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
外部ネットワーク上にIPアドレス200.124.22.10のホストがあり、インターネットに接続されているとします。コンピュータ192.168.1.11がコンピュータ200.124.22.10に接続する場合、ランダムな送信元ポート51772が作成されます。この場合、外部ネットワーク上のコンピュータの宛先ポートは80になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルータは、外部ネットワークに送信されたローカルコンピュータパケットを受信すると、ローカルの内部ローカルアドレスを内部グローバルアドレス200.124.22.1に変換し、ポートに23556を割り当てます。パケットはコンピュータ200.124.22.10に到達し、ハンドシェイク手順に従って応答を送信する必要があります。この場合、宛先はアドレス200.124.22.1とポート23556です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーターにはNAT変換テーブルがあるため、外部コンピューターのパッケージを受信すると、内部グローバルアドレスに対応する内部ローカルアドレスが192.168.1.11：51772であると判断し、パケットを転送します。その後、2台のコンピューター間の接続が確立されたと見なすことができます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、通信に同じアドレス200.124.22.1を使用するがポート番号が異なる数百のデバイスを使用できるため、すべてのデバイスを同時にオンラインにすることができます。これが、PATが人気の高い翻訳方法である理由です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
静的NATの構成を見てみましょう。どのネットワークでも、まず第一に、入出力インターフェースを決定する必要があります。この図は、トラフィックがポートG0 / 0からポートG0 / 1に、つまり内部ネットワークから外部ネットワークに送信されるルーターを示しています。したがって、入力インターフェース192.168.1.1と出力インターフェース200.124.22.1があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/nc/o6/rjnco6mmewiiildmwtu0gn8ixs4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NATを構成するには、G0 / 0インターフェイスに移動して、ip addres 192.168.1.1 255.255.255.0 ipパラメーターを設定し、このインターフェイスがip nat insideコマンドを使用して入力されていることを示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rf/dd/xt/rfddxtoq7k4bti2dprru9jriheq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、出力インターフェイスG0 / 1でNATを構成し、IPアドレス200.124.22.1、サブネットマスク255.255.255.0、およびIP NAT外部を指定します。ダイナミックNAT変換は常に、入力から出力インターフェイスへ、内部から外部へと行われることに注意してください。当然、ダイナミックNATの場合、答えは出力インターフェイスを介して入力インターフェイスに到達しますが、トラフィックが開始されると、トリガーされるのは入出力方向です。スタティックNATの場合、トラフィックの開始は、インアウトまたはアウトインのいずれの方向でも発生する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、静的NATのテーブルを作成する必要があります。各ローカルアドレスは、個別のグローバルアドレスに対応しています。この例では、デバイスが3つあるため、テーブルはソースの内部ローカルIPアドレスを示す3つのエントリで構成され、内部グローバルアドレスに変換されます：ip nat inside static 192.168.1.10 200.124.22.1。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、静的NATでは、各ローカルホストアドレスの変換を手動で指定します。次に、Packet Tracerに移動して、上記の設定を行います。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mz/td/sh/mztdshpsmzcjt5zsb7xuifiacp8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上部にはサーバー192.168.1.100があり、下にはコンピューター192.168.1.10があり、一番下にはコンピューター192.168.1.11があります。 Router0のG0 / 0ポートには192.168.1.1のIPアドレスがあり、G0 / 1ポートには200.124.22.1があります。インターネットを表す「クラウド」に、IPアドレス200.124.22.10が割り当てられたルーター1を配置しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Router1の設定に入り、debug ip icmpコマンドを入力します。 pingがこのデバイスに到達するとすぐに、設定ウィンドウにデバッグメッセージが表示され、パッケージの種類が示されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルータRouter0を設定しましょう。グローバル設定モードに入り、G0 / 0インターフェイスを呼び出します。次に、ip nat insideコマンドを入力してから、g0 / 1インターフェイスに移動して、ip nat outsideコマンドを入力します。したがって、私はルータの入力および出力インターフェイスを割り当てました。次に、IPアドレスを手動で構成する必要があります。つまり、上記の表の行設定を設定に転送します</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Ip nat inside source static 192.168.1.10 200.124.22.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ip nat inside source static 192.168.1.11 200.124.22.2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ip nat inside source static 192.168.1.100 200.124 .22.3</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/tb/px/-f/tbpx-flkjx4vwlsd6ee2rljrky0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、各デバイスからルーター1にpingを送信し、ルーター1が受信したpingが表示するIPアドレスを確認します。これを行うには、R1ルーターの開いているCLIウィンドウを画面の右側に配置して、デバッグメッセージを表示します。次に、PC0コマンドラインターミナルに移動して、アドレス200.124.22.10にpingを送信します。その後、pingがIPアドレス200.124.22.1から受信されたことを示すメッセージがウィンドウに表示されます。これは、ローカルコンピューター192.168.1.10のIPアドレスがグローバルアドレス200.124.22.1に変換されたことを意味します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/ei/g6/axeig6imwtfp-bxxjjmz0uh6uum.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のローカルコンピュータでも同じことを行い、そのアドレスが200.124.22.2に変換されていることを確認します。次に、サーバーからpingを送信し、アドレス200.124.22.3を確認します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、LANデバイスからのトラフィックが静的NATが構成されているルーターに到達すると、ルーターは、テーブルに従ってローカルIPアドレスをグローバルアドレスに変換し、トラフィックを外部ネットワークに送信します。 NATテーブルを確認するには、show ip nat translationsコマンドを入力します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5d/-9/rx/5d-9rxvls9gdzoz_aanqpbdxeqe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ルーターが行うすべての変換を確認できます。 Inside Globalの最初の列は、ブロードキャスト前のデバイスのアドレス、つまり外部ネットワークからデバイスが見えるアドレスであり、次にInside Localアドレス、つまりローカルネットワーク上のデバイスアドレスです。 3番目の列は外部ローカルを示し、4番目の列は外部グローバルアドレスを示します。宛先IPアドレスを変換しないため、どちらも同じです。ご覧のとおり、数秒後、Packet Tracerで短いpingタイムアウトが設定されたため、テーブルがクリアされました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アドレス200.124.22.3のR1ルーターからサーバーにpingを実行できます。ルーターの設定に戻ると、変換された宛先アドレス192.168.1.100を含む4つのping行がテーブルに再び表示されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xx/5i/nq/xx5inqtiknpu90hl-mqjrheahti.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前述のように、ブロードキャストタイムアウトが機能していても、トラフィックが外部ソースから開始されると、NATメカニズムが自動的にアクティブになります。これは、スタティックNATを使用している場合にのみ発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、動的NATがどのように機能するかを見てみましょう。この例では、ローカルネットワーク上の3つのデバイスに2つのパブリックアドレスがありますが、そのようなプライベートホストは数十および数百ある場合があります。同時に、オンラインにできるデバイスは2つだけです。これ以外に、静的NATと動的NATの違いは何かを検討してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のケースと同様に、まずルーターの入力および出力インターフェイスを決定する必要があります。次に、一種のアクセスリストを作成しますが、これは前のレッスンで説明したACLではありません。このアクセスリストは、変換するトラフィックを識別するために使用されます。ここで、「興味深いトラフィック」または「興味深いトラフィック」という新しい用語が表示されます。これは、何らかの理由で関心のあるトラフィックであり、このトラフィックがアクセスリストの条件に一致すると、NATのアクションに該当し、変換されます。この用語は、多くの場合トラフィックに適用されます。たとえば、VPNの場合、「興味深い」トラフィックは、VPNトンネルを通過するトラフィックと呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
対象のトラフィックを識別するACLを作成する必要があります。この場合は、ネットワーク全体のトラフィック192.168.1.0であり、リバースマスク0.0.0.255が示されています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ep/rp/rqeprpll-v1nzyru_dewaflnj9o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ip nat pool &lt;pool name&gt;コマンドを使用して、IPアドレスのプール200.124.22.1 200.124.22.2を指定するNATプールを作成する必要があります。つまり、提供する外部IPアドレスは2つだけです。次に、コマンドはnetmaskキーワードを使用して、サブネットマスク255.255.255.252を入力します。マスクの最後のオクテットは（255-プールアドレスの数は1）なので、プールに254個のアドレスがある場合、サブネットマスクは255.255.255.0になります。これは非常に重要なパラメータであるため、ダイナミックNATを設定するときは、必ず正しいネットマスク値を入力してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、NATメカニズムを開始するコマンドを使用します。ipnat inside soourse list 1 pool NWKING。ここで、NWKINGはプール名で、リスト1はACLアクセスリスト番号1を意味します。このコマンドが機能するためには、まず動的アドレスのプールとアクセスリストを作成する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、私たちの状況では、インターネットにアクセスしたい最初のデバイスがこれを実行でき、2番目のデバイスもこれを実行できますが、3番目のデバイスはプールアドレスの1つが解放されるまで待機する必要があります。動的NATの構成は、入力および出力インターフェースの決定、「対象」トラフィックの決定、NATプールの作成と設定の4つのステップで構成されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Packet Tracerに移動して、動的NATの構成を試みます。まず、我々は、以下のコマンドを入力するための静的NAT設定を、削除する必要がありません：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、no ip NATの内側のソースの静的を192.168.1.10 200.124.22.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、no ip NATの内側のソース静的192.168.1.11 200.124.22.2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
は、no ip NATの内側のソース静的192.168.1.100 200.124.22.3 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、access-list 1 permit 192.168.1.0 0.0.0.255コマンドを使用してネットワーク全体のリスト1アクセスリストを作成し、ip nat pool NWKING 200.124.22.1 200.124.22.2 netmask 255.255.255.252コマンドを使用してNATプールを構成します。このコマンドでは、プールの名前、プールに入るアドレス、およびネットワークマスクを指定しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、このNATが内部か外部かを示し、NATが情報を取得するソース（この場合はリスト）をip nat inside source list 1コマンドを使用して示します。その後、システムはプール全体または特定のインターフェイスが必要かどうかを尋ねます。複数の外部アドレスがあるため、プールを選択します。インターフェースを選択する場合、特定のIPアドレスを持つポートを指定する必要があります。最終的な形式では、コマンドは次のようになります。ip nat inside source list 1 pool NWKING。現在、このプールは2つのアドレス200.124.22.1 200.124.22.2で構成されていますが、自由に変更したり、特定のインターフェイスに関連付けられていない新しいアドレスを追加したりできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルーティングテーブルが更新されていることを確認して、プール内のこれらのIPアドレスのいずれかがこのデバイスに送信されるようにする必要があります。そうしないと、リターントラフィックを受信できません。設定が機能していることを確認するために、静的NATに対して実行されたクラウドルーターのping処理を繰り返します。ルーター1のルーターウィンドウを開いてデバッグモードのメッセージを表示し、3つのデバイスのそれぞれからpingを実行します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/yt/lk/ioytlkva1_ucbg0-llm4r5ckiy0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pingパケットの送信元アドレスがすべて設定に対応していることがわかります。同時に、十分な空き外部アドレスがなかったため、PC0コンピューターからのpingは通過しません。ルータ1の設定に入ると、プールアドレス200.124.22.1および200.124.22.2が現在使用されていることがわかります。ブロードキャストをオフにすると、ラインが次々と消えていくのがわかります。 PC0から再度pingを開始します。ご覧のように、解放された外部アドレス200.124.22.1を取得できたため、すべてが正常に機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NATテーブルをクリアして、指定されたアドレス変換をキャンセルするにはどうすればよいですか？ルーターRouter0の設定に入り、行の最後にアスタリスクを付けてコマンドclear ip nat translation *を入力します。 show ip nat translationコマンドを使用して変換ステータスを確認すると、システムは空の文字列を提供します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NAT統計を表示するには、show ip nat statisticsコマンドを使用します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c8/o0/ne/c8o0neryfwlityjhd2zb_v5mc98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、動的、静的、および高度なNAT / PAT変換の総数を確認できる非常に便利なコマンドです。前のコマンドで翻訳データをクリアしたため、0であることがわかります。入出力インターフェース、成功および失敗したヒットとミスの変換の数（内部ホスト用の空き外部アドレスがないために失敗した数）、アクセスリストとプールの名前がここに表示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、最も一般的なタイプのIPアドレス変換-高度なNAT、またはPATに移ります。 PATを構成するには、動的NATの構成と同じ手順を実行する必要があります。ルーターの入力および出力インターフェイスを定義し、「対象の」トラフィックを識別し、NATプールを作成して、PATを構成します。前のケースと同じように、複数のアドレスの同じプールを作成できますが、PATは常に同じ外部アドレスを使用するため、これは必要ありません。ダイナミックNATとPATの設定の唯一の違いは、最後の設定コマンドを終了するoverloadキーワードです。この単語を入力すると、ダイナミックNATは自動的にPATに変わります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rs/ho/mv/rshomvllaqmpjgqhp36eferkb9o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、NWKINGプールではアドレスを1つだけ使用します（たとえば、200.124.22.1）が、ネットワークマスクが255.255.255.0の開始および終了外部アドレスとして2回指定します。 ip nat 1 pool NWKING 200.124.22.1 200.124.22.1 netmask 255.255.255.0行の代わりに、G0 / 1インターフェイスのソースインターフェイスパラメーターと固定アドレス200.124.22.1を使用することで、これを簡単に行うことができます。この場合、インターネットに変換されたすべてのローカルアドレスは、このIPアドレスに変換されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定の物理インターフェイスに必ずしも対応しない、プール内の他のIPアドレスを使用することもできます。ただし、この場合は、ネットワーク内のすべてのルーターが、選択したデバイスに応答トラフィックを転送できることを確認する必要があります。 NATの欠点は、エンドツーエンドのアドレッシングに使用できないことです。これは、戻りパケットがローカルデバイスに戻るまで、動的NAT IPアドレスが時間とともに変化する可能性があるためです。つまり、選択したIPアドレスが通信セッションの間使用可能なままであることを確認する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをPacket Tracerで見てみましょう。まず、no Ip nat inside source list 1 NWKINGコマンドを使用して動的NATを削除し、no Ip nat pool NWKING 200.124.22.1 200.124.22.2 netmask 225.255.255.252コマンドを使用してNATプールを削除する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Ip nat pool NWKING 200.124.22.2 200.124.22.2 netmask 225.255.255.255コマンドを使用してPATプールを作成する必要があります。今回は、物理デバイスのアドレスが200.124.22.1であるため、物理デバイスに属していないIPアドレスを使用し、200.124.22.2を使用します。私たちの場合、ローカルネットワークがあるため、これは機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、source list 1 pool NWKING overloadコマンド内のIp natでPATを設定します。このコマンドを入力すると、PATアドレス変換がアクティブになります。設定が正しいことを確認するには、デバイス、サーバー、および2台のコンピューターに移動し、PC0ルーター1から200.124.22.10にpingを送信します。ルーター設定ウィンドウでは、予想どおり、pingの送信元がIPアドレス200.124.22.2であることを示すデバッグ行が表示されます。このアドレスから、PC1およびServer0によって送信されたpingが送信されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルータRouter0の変換テーブルで何が起こるか見てみましょう。すべての変換が成功し、各デバイスに独自のポートが割り当てられ、すべてのローカルアドレスがプール200.124.22.2のIPアドレスを介してルーター1に接続されていることがわかります。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/fh/tf/gp/fhtfgp0x3n7fghja8yjs_qtp7ci.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PAT統計情報を表示するには、show ip nat statisticsコマンドを使用します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/na/vq/l2/navql2ahsncx0c5utra8t5efxbi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変換またはアドレスの変換の総数は12であることがわかります。プールの特性とその他の情報がわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、別のことを行います。コマンド「Ip nat inside source list 1 interface gigabit Ethernet g0 / 1 overload」を入力します。その後、PC0からルーターにpingを送信すると、パケットがアドレス200.124.22.1、つまり物理インターフェイスから送信されたことがわかります。これはより簡単な方法です。ホームルーターを使用するときに最も頻繁に発生するプールを作成したくない場合は、ルーターの物理インターフェイスのIPアドレスを外部NATアドレスとして使用できます。これは、プライベートホストアドレスからパブリックネットワークへの変換が最も頻繁に行われる方法です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は非常に重要なトピックを研究したので、それを実践する必要があります。 Packet Tracerを使用して、実際のNATおよびPAT構成タスクの理論的な知識をテストします。 CCNDコースの最初の試験であるICND1の学習が終わりました。次のビデオレッスンは要約に専念するでしょう。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/l5wuJFoeVDQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつもご利用いただきありがとうございます。私たちの記事は好きですか？もっと面白い資料を見たいですか？注文またはお友達にそれを推奨することで私たちをサポートしてください、私たちがあなたの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ために発明したエントリーレベルのサーバーのユニークなアナログのHabrユーザーのための30％割引：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS（KVM）E5-2650 v4（6コア）10GB DDR4 240GB SSD 1Gbpsの真実20ドルまたはサーバーを分割する方法？</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（オプションは、RAID1およびRAID10、最大24コア、最大40GB DDR4で利用可能です）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xdは2倍安いですか？</font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">オランダでは、</font></b></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">199ドルから、インテルTetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV</font></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">2台</font></a></b><font style="vertical-align: inherit;">だけ持ってい</font><b><font style="vertical-align: inherit;">ます！</font></b><b><b><font style="vertical-align: inherit;">デルR420-2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB-$ 99から！</font></b></b><font style="vertical-align: inherit;">について読む</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   .  c   Dell R730xd 5-2650 v4  9000   ?</a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja465775/index.html">CentOS7ベースのLTSPサーバー</a></li>
<li><a href="../ja465779/index.html">Yealink T19自動プロビジョニング+動的アドレス帳</a></li>
<li><a href="../ja465781/index.html">Kotlinのコルーチンを使用してカスタムOkhttpブレーカーを作成する方法</a></li>
<li><a href="../ja465783/index.html">ロシアのゲーム開発者、無意味で無慈悲</a></li>
<li><a href="../ja465787/index.html">ヤギが大好き</a></li>
<li><a href="../ja465791/index.html">小売業者の脆弱性-リクエストでOTPを受信できる3つのケース</a></li>
<li><a href="../ja465795/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェスト第378号（2019年8月26日-9月1日）</a></li>
<li><a href="../ja465797/index.html">遺伝的アルゴリズム（またはクライアントは常に王様です-そしてしばしばばか者です）</a></li>
<li><a href="../ja465801/index.html">フードデザインダイジェスト2019年8月</a></li>
<li><a href="../ja465803/index.html">Goプロジェクトを構築するためのMavenの方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>