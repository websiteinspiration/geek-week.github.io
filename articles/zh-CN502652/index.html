<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍫 👩🏽‍🤝‍👨🏾 👨🏿‍🏭 公共合同，如何确保其一致性 👨🏾‍🔧 👵 🍍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- 您的系统是否包含许多互连的服务？
- 更改公共API时还手动更新服务代码？
- 服务的更改通常会破坏其他人的工作，而其他开发人员为此讨厌吗？
 如果您至少回答了一次，那么欢迎您！
 
 条款
 公共合同，规范 -您可以通过其与服务进行交互的公共接口。在文本中，它们是同一意思。
 
 这篇文章是关...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>公共合同，如何确保其一致性</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/directum/blog/502652/"><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的系统是否包含许多互连的服务？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改公共API时还手动更新服务代码？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务的更改通常会破坏其他人的工作，而其他开发人员为此讨厌吗？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您至少回答了一次，那么欢迎您！</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款</font></font></h4><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共合同，规范</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -您可以通过其与服务进行交互的公共接口。</font><font style="vertical-align: inherit;">在文本中，它们是同一意思。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这篇文章是关于什么</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
了解如何使用用于合同的统一描述和自动代码生成的工具来减少开发Web服务的时间。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
正确使用下面介绍的技术和工具，可以使您快速推出新功能，而又不会破坏旧功能。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题是什么样的</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有一个包含多个服务的系统。</font><font style="vertical-align: inherit;">这些服务分配给不同的团队。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-e/nt/tj/-enttjd6jjg8qoq2c51pw4fha0a.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消费者服务取决于服务提供商。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
系统不断发展，有一天，服务提供商更改了其公共合同。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hk/sf/qs/hksfqs6qfhp-ptvnfidpouif2ki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果消费者服务尚未准备好进行更改，则系统将停止完全运行。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1u/iv/iq/1uiviq4rc31xzihqfa4rc2qzgdy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何解决这个问题呢</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">供应商服务团队将解决所有问题</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果供应商团队拥有其他服务的主题区域并有权访问其git存储库，则可以完成此操作。</font><font style="vertical-align: inherit;">这仅在依赖服务很少的小型项目中有效。</font><font style="vertical-align: inherit;">这是最便宜的选择。</font><font style="vertical-align: inherit;">如果可能，应该使用它。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向客户团队更新您的服务代码</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为什么其他人坏了，但我们正在修理？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，主要问题是如何修复您的服务，合同现在看起来像什么？</font><font style="vertical-align: inherit;">您需要学习新的提供商服务代码或联系他们的团队。</font><font style="vertical-align: inherit;">我们花时间研究代码并与另一个团队进行交互。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑采取什么措施防止问题出现</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从长远来看，最合理的选择。</font><font style="vertical-align: inherit;">在下一节中考虑它。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何预防问题的显现 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
软件开发的生命周期可以分为三个阶段：设计，实施和测试。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个步骤都需要扩展如下：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在设计阶段以声明方式定义合同；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实施过程中，我们根据合同生成服务器和客户端代码；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在测试时，我们检查合同并尝试考虑客户需求（CDC）。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作为我们问题的一个示例，将进一步解释每个步骤。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题对我们的影响</font></font></h3><br>
<img src="https://habrastorage.org/webt/ws/qh/3j/wsqh3j_vzqriz0hufhvw5k4j_1i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这就是我们的生态系统。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
圆圈是服务，箭头是它们之间的沟通渠道。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前端是基于Web的客户端应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大多数箭头指向存储服务。它存储文件。这是最重要的服务。毕竟，我们的产品是一个电子文档管理系统。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果该服务更改了合同，系统将立即停止工作。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4t/mx/xx/4tmxxxgjb3e888bmekaqofdxhq8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们系统的源代码主要是用c＃编写的，但是Go和Python中也有服务。在这种情况下，图中的其他服务做什么无关紧要。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/qw/pu/rtqwpuk7eea5fyotxyspnctk2iq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个服务都有其自己的客户端实现，用于与存储服务一起使用。更改合同时，必须手动更新每个项目中的代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想从手动更新转向自动更新。</font><font style="vertical-align: inherit;">这将有助于提高客户端代码更改的速度并减少错误。</font><font style="vertical-align: inherit;">错误是URL中的错字，由于粗心而导致的错误等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，这种方法不能解决客户端业务逻辑中的错误。</font><font style="vertical-align: inherit;">您只能手动调整。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从问题到任务</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的情况下，需要实现</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端代码的自动生成。</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，应考虑以下几点：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端-控制器已被写入；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器是该服务的客户端；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务通过HTTP进行通信。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一代必须调整。</font><font style="vertical-align: inherit;">例如，要支持JWT。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在解决问题的过程中，出现了以下问题：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择哪种工具；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何获得合同；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里放置合同；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户代码放置在哪里；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在什么时候做一代。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下是这些问题的答案。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择哪种工具</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
合同处理工具从两个方向提供-RPC和REST。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/3e/3k/wy3e3k54sqffxjda4tvynid6rcy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPC可以理解为只是一个远程调用，而REST需要HTTP动词和URL的附加条件。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处介绍了RPC和REST调用的区别。</font></font></b>
                        <div class="spoiler_text"><div class="scrollable-table"><table>
<tbody><tr>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC-远程过程调用</font></font></td>
<td colspan="2">REST Representational State Transfer</td>
</tr>
<tr>
<td colspan="2">  </td>
<td colspan="2">, HTTP-  URL</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Restaurant</a>:8080/Orders/PlaceOrder</td>
<td>POST</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Restaurant</a>:8080/Orders</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Restaurant</a>:8080/Orders/GetOrder?OrderNumber=1</td>
<td>GET</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Restaurant</a>:8080/Orders/1</td>
</tr>
<tr>
<td></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Restaurant</a>:8080/Orders/UpdateOrder</td>
<td>PUT</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Restaurant</a>:8080/Orders/1</td>
</tr>
</tbody></table></div><br>
</div>
                    </div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具类</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下表显示了使用REST和RPC的工具的比较。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物产</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSDL</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节约</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">休息</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rpc</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台</font></font></td>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不依赖</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">舌</font></font></td>
<td colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不依赖</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发顺序*</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码优先，规范优先</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码优先，规范优先</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规格优先</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码优先，规范优先</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输协议</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 1.1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何（REST需要HTTP）</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拥有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 2</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规格</font></font></td>
<td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构架 </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低入门门槛，大量文档</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML冗余，SOAP等</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入门门槛高，文档少</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平均入学门槛，文件更完善</font></font></td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写</font><i><font style="vertical-align: inherit;">代码</font></i><font style="vertical-align: inherit;"> -首先我们编写服务器部分，然后再获取合同。</font><font style="vertical-align: inherit;">服务器端已被写入时，这很方便。</font><font style="vertical-align: inherit;">无需手动描述合同。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先指定规格</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -首先定义合同，然后从合同中获取客户端部分和服务器部分。</font><font style="vertical-align: inherit;">在没有代码的情况下，在开发开始时很方便。</font><font style="vertical-align: inherit;">
WSDL </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于其冗余而不合适。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apache Thrift太过奇特，很难学习。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRPC需要net Core 3.0和net Standard 2.1。</font><font style="vertical-align: inherit;">在分析时，使用的是net Core 2.2和net Standard 2.0。</font><font style="vertical-align: inherit;">开箱即用的浏览器不提供GRPC支持，需要其他解决方案。</font><font style="vertical-align: inherit;">GRPC使用Protobuf和HTTP / 2二进制序列化。</font><font style="vertical-align: inherit;">因此，用于测试API（例如Postman等）的实用程序的范围正在缩小。</font><font style="vertical-align: inherit;">通过某些JMeter进行负载测试可能需要额外的精力。</font><font style="vertical-align: inherit;">不适合，切换到GRPC需要大量资源。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAPI不需要其他更新。</font><font style="vertical-align: inherit;">它吸引了众多支持使用REST和此规范的工具。</font><font style="vertical-align: inherit;">我们选择它。</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用OpenAPI的工具</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下表显示了使用OpenAPI的工具的比较。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具类</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">花花公子</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">瓦格</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi工具</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的规范版本</font></font></td>
<td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以生成OpenApi v2，v3格式的规范</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码优先支持</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的服务器语言</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ＃</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的客户语言</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃，TypeScript，AngularJS，Angular（v2 +），window.fetch API</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世代设定</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuget包</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuget包+单独的实用程序</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单独的实用程序</font></font></td>
</tr>
</tbody></table></div><b><font style="vertical-align: inherit;"></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Swashbuckle </font><b><font style="vertical-align: inherit;">的结论</font></b><font style="vertical-align: inherit;">不合适，因为 </font><font style="vertical-align: inherit;">仅允许您获取规格。</font><font style="vertical-align: inherit;">要生成客户端代码，您需要使用其他解决方案。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenApiTools是一个有趣的工具，具有许多设置，但它首先不支持代码。</font><font style="vertical-align: inherit;">它的优点是能够以多种语言生成服务器代码。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag的方便之处在于它是一个Nuget软件包。</font><font style="vertical-align: inherit;">建立项目时很容易连接。</font><font style="vertical-align: inherit;">支持我们需要的一切：代码优先方法和c＃中的客户端代码生成。</font><font style="vertical-align: inherit;">我们选择它。</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里安排合同。</font><font style="vertical-align: inherit;">如何获得合同服务</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是组织合同存储的解决方案。</font><font style="vertical-align: inherit;">列出的解决方案按复杂度递增的顺序排列。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供程序服务项目文件夹是最简单的选项。</font><font style="vertical-align: inherit;">如果您需要运行该方法，则选择它。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果所需项目在同一存储库中，则共享文件夹是有效选项。</font><font style="vertical-align: inherit;">从长远来看，将很难维护文件夹中合同的完整性。</font><font style="vertical-align: inherit;">这可能需要使用其他工具来解释合同的不同版本等。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规范的单独存储库-如果项目位于不同的存储库中，则应将合同放置在公共场所。</font><font style="vertical-align: inherit;">缺点与共享文件夹相同。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过服务API（swagger.ui，swaggerhub）进行处理-一种单独的服务，用于处理规范管理。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们决定使用最简单的选项-将合同存储在服务提供商的项目文件夹中。</font><font style="vertical-align: inherit;">在现阶段，这对我们来说已经足够了，那么为什么要付出更多呢？</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在什么时候产生</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，您需要决定在什么时候执行代码生成。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果共享合同，则消费者服务可以接收合同并在必要时自行生成代码。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们决定将合同放在服务提供商项目的文件夹中。</font><font style="vertical-align: inherit;">这意味着可以在组装供应商服务项目本身之后完成生成。</font></font></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放置客户端代码的位置</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
客户代码将通过合同生成。</font><font style="vertical-align: inherit;">它仍然是找出放置它的位置。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将客户端代码放在单独的StorageServiceClientProxy项目中似乎是个好主意。</font><font style="vertical-align: inherit;">每个项目都将能够连接该装配体。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该解决方案的优势：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户代码接近其服务，并且不断更新；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消费者可以在一个存储库中使用指向项目的链接。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
缺点：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您需要在系统的另一部分（例如，不同的存储库）中生成客户端，则将无法使用。</font><font style="vertical-align: inherit;">它至少使用一个共享合同文件夹来解决。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消费者必须使用相同的语言编写。</font><font style="vertical-align: inherit;">如果您需要其他语言的客户端，则需要使用OpenApiTools。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们系上NSwag</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器属性</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
需要告诉NSwag如何为我们的控制器生成正确的规范。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，您需要安排属性。</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.Routing.Route(<span class="hljs-meta-string">"[controller]"</span>)</span>]  <span class="hljs-comment">//  url</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ApiController</span>] <span class="hljs-comment">//     </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DescriptionController</span> : <span class="hljs-title">ControllerBase</span> {<font></font>
[<span class="hljs-meta">NSwag.Annotations.OpenApiOperation(<span class="hljs-meta-string">"GetDescription"</span>)</span>] <span class="hljs-comment">//    </span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(typeof(ConversionDescription), 200)</span>] <span class="hljs-comment">//    200  </span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(401)</span>] <span class="hljs-comment">//    401</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(403)</span>] <span class="hljs-comment">//    403</span>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.HttpGet(<span class="hljs-meta-string">"{pluginName}/{binaryDataId}"</span>)</span>] <span class="hljs-comment">//  url</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ActionResult&lt;ConversionDescription&gt; <span class="hljs-title">GetDescription</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> pluginName, Guid binaryDataId</span>)</span> { 
 <span class="hljs-comment">// ... </span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认情况下，NSwag无法为MIME类型的application / octet-stream生成正确的规范。</font><font style="vertical-align: inherit;">例如，在传输文件时可能会发生这种情况。</font><font style="vertical-align: inherit;">要解决此问题，您需要编写属性和处理器以创建规范。</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.Route(<span class="hljs-meta-string">"[controller]"</span>)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ApiController</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileController</span> : <span class="hljs-title">ControllerBase</span> {<font></font>
[<span class="hljs-meta">NSwag.Annotations.OpenApiOperation(<span class="hljs-meta-string">"SaveFile"</span>)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(401)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.ProducesResponseType(403)</span>]<font></font>
[<span class="hljs-meta">Microsoft.AspNetCore.Mvc.HttpPost(<span class="hljs-meta-string">"{pluginName}/{binaryDataId}/{fileName}"</span>)</span>]<font></font>
[<span class="hljs-meta">OurNamespace.FileUploadOperation</span>] <span class="hljs-comment">//  </span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SaveFile</span>(<span class="hljs-params"></span>)</span> { <span class="hljs-comment">// ... }</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于生成文件操作规范的处理器</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
想法是您可以编写属性和处理器来处理此属性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将属性挂在控制器上，当NSwag遇到该属性时，它将使用我们的处理器对其进行处理。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了实现这一点，NSwag提供了OpenApiOperationProcessorAttribute和IOperationProcessor类。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的项目中，我们成为继承人：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FileUploadOperationAttribute：OpenApiOperationProcessorAttribute</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FileUploadOperationProcessor：IOperationProcessor</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处阅读有关使用处理器的更多信息。</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于规范和代码生成的NSwag配置</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在配置3个主要部分中：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时-指定.net运行时。</font><font style="vertical-align: inherit;">例如，NetCore22;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentGenerator-描述如何生成规范；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">codeGenerators-定义如何根据规范生成代码。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSwag包含许多设置，一开始会令人困惑。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了方便起见，您可以使用NSwag Studio。</font><font style="vertical-align: inherit;">使用它，您可以实时查看各种设置如何影响代码生成或规范的结果。</font><font style="vertical-align: inherit;">之后，在配置文件中手动选择选定的设置。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处阅读有关配置设置的更多信息</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组装服务提供商的项目时，我们会生成规范和客户代码</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了在组装服务提供者项目之后，生成规范和代码，请执行以下操作：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们为客户端创建了一个WebApi项目。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们为Nswag CLI编写了一个配置-Nswag.json（在上一节中进行了介绍）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在csproj服务提供商项目中编写了一个PostBuild Target。</font></font></li>
</ol><br>
<code>&lt;Target Name="GenerateWebApiProxyClient“ AfterTargets="PostBuildEvent"&gt;<br>
&lt;Exec Command="$(NSwagExe_Core22) run nswag.json”/&gt;<br>
</code><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$（NSwagExe_Core22）运行nswag.json-使用nswag.json配置在.bet runtine netCore 2.2下运行NSwag实用程序 </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目标执行以下操作：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag从供应商服务程序集生成规范。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSwag根据规范生成客户端代码。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在服务提供者项目的每次组装之后，将更新客户端项目。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
客户和服务提供商的项目在同一解决方案内。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
组装是解决方案的一部分。</font><font style="vertical-align: inherit;">该解决方案配置为应在供应商的服务项目之后组装客户的项目。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSwag还允许您通过软件API强制性地自定义规范/代码生成。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何添加对JWT的支持</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们需要保护我们的服务免受未经授权的请求。</font><font style="vertical-align: inherit;">为此，我们将使用JWT令牌。</font><font style="vertical-align: inherit;">必须在每个HTTP请求的标头中发送它们，以便服务提供者可以检查它们并决定是否满足该请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于JWT这里更多信息</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jwt.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任务归结为需要修改传出HTTP请求的标头。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，NSwag代码生成器可以生成扩展点-CreateHttpRequestMessageAsync方法。</font><font style="vertical-align: inherit;">在此方法内部，可以在发送HTTP请求之前对其进行访问。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码示例</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> Task&lt;HttpRequestMessage&gt; <span class="hljs-title">CreateHttpRequestMessageAsync</span>(<span class="hljs-params">CancellationToken cancellationToken</span>)</span> {
      <span class="hljs-keyword">var</span> message = <span class="hljs-keyword">new</span> HttpRequestMessage();<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(<span class="hljs-keyword">this</span>.AuthorizationToken)) {<font></font>
        message.Headers.Authorization =<font></font>
          <span class="hljs-keyword">new</span> System.Net.Http.Headers.AuthenticationHeaderValue(BearerScheme, <span class="hljs-keyword">this</span>.AuthorizationToken);<font></font>
      }<font></font>
<font></font>
      <span class="hljs-keyword">return</span> Task.FromResult(message);<font></font>
    }<font></font>
</code></pre><br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们选择了OpenAPI选项，因为 </font><font style="vertical-align: inherit;">它易于实施，并且已高度开发了适用于此规范的工具。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于OpenAPI和GRPC的结论：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenAPI</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该规范是冗长的；</font></font></li>
<li>          ,  ;</li>
<li>     ;</li>
<li>    .</li>
</ul><br>
<b>GRPC</b><br>
<br>
<ul>
<li>  ,      URL, HTTP  ..;</li>
<li>      OpenAPI;</li>
<li>    ;</li>
<li>           ;</li>
<li>     HTTP/2.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们收到了基于控制器已编写代码的规范。</font><font style="vertical-align: inherit;">为此，必须在控制器上悬挂特殊属性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后，根据收到的规范，我们实现了客户端代码的生成。</font><font style="vertical-align: inherit;">现在，我们不需要手动更新客户端代码。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
已经在版本和测试合同领域进行了研究。</font><font style="vertical-align: inherit;">但是，由于缺乏资源，不可能在实践中测试整个过程。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本化公共合同</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么要对公共合同进行版本控制？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在更改服务提供商后，整个系统必须保持一致的可操作状态。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须避免破坏公共API的更改，以免破坏客户端。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决方案选项</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不对公共合同进行版本控制</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务提供商团队本身会修复消费者服务。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f0/k3/_6/f0k3_6ed1gt10sz1k5ol2brrj80.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果服务提供商团队无法访问消费者服务存储库或缺乏能力，则此方法将行不通。</font><font style="vertical-align: inherit;">如果没有此类问题，则无需版本控制。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-8/dd/ri/-8ddri4wch4oiugyd2bvz28zvzk.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用公共合同的版本控制</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务提供商团队保留合同的先前版本。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-v/xg/e9/-vxge9yyrzws2i3lbm5b6rrvbyq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这种方法没有上一个方法的缺点，但是增加了其他困难。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您需要确定以下内容：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用哪种工具；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时推出新版本；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留旧版本多长时间。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用哪个工具</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下表显示了与版本控制相关的OpeanAPI和GRPC的功能。</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gRPC</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openapi</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本属性</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在protobuf级别，有一个属性包[packageName]。</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在规范级别，有basePath（用于URL）和Version属性</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法不推荐使用的属性</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的，但是C＃下的代码生成器未考虑在内</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的，它被标记为过时</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。代码不首先支持NSwag，您需要编写处理器</font></font><br>
</td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数不推荐使用的属性</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记为过时</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的，它被标记为过时</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。代码不首先支持NSwag，您需要编写处理器</font></font><br>
</td>
</tr>
</tbody></table></div><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弃用</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着该API不再值得使用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
两种工具都支持版本和不推荐使用的属性。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您使用OpenAPI和代码优先方法，则再次需要编写处理器来创建正确的规范。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时推出新版本</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当合同更改不保留向后兼容性时，必须引入新版本。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如何验证更改是否违反了新旧合同之间的兼容性？</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于OpenAPI，有一个Azure opeanapi-diff工具可用于检查2个规范之间的兼容性</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/Azure/openapi-diff;</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找不到用于gRPC的自动工具，只有版本控制策略； </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/grpc/grpc/blob/master/doc/versioning.md;</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在.Net </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.microsoft.com/zh-cn/aspnet/core/grpc/versioning?view=aspnetcore-3.1下</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本维持多长时间</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个问题没有正确答案。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要删除对旧版本的支持，您需要知道谁在使用您的服务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果删除该版本，而其他人使用它，那将是不好的。</font><font style="vertical-align: inherit;">如果您不控制客户，这尤其困难。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
那么在这种情况下可以做什么？</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知客户不再支持旧版本。</font><font style="vertical-align: inherit;">在这种情况下，我们可能会失去客户收入；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持整个版本集。</font><font style="vertical-align: inherit;">软件支持的成本在增长；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要回答这个问题，您需要问业务-老客户的收入是否超过了支持旧版本软件的成本？</font><font style="vertical-align: inherit;">要求客户升级会更有利可图吗？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这种情况下，唯一的建议是要更加注意公共合同，以减少更改的频率。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果在封闭系统中使用公共合同，则可以使用CDC方法。</font><font style="vertical-align: inherit;">因此，我们可以找出客户何时停止使用旧版本的软件。</font><font style="vertical-align: inherit;">在那之后，您可以删除旧版本的支持。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仅当您无法使用版本控制时，才使用它。</font><font style="vertical-align: inherit;">如果决定使用版本控制，则在设计合同时，请考虑版本兼容性。</font><font style="vertical-align: inherit;">在支持较旧版本的成本与其提供的好处之间必须取得平衡。</font><font style="vertical-align: inherit;">还值得确定何时可以停止支持旧版本。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试合同和疾病预防控制中心</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本节以浅色显示，例如 </font><font style="vertical-align: inherit;">实施此方法没有严格的先决条件。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消费者驱动合同（CDC）</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CDC是如何确保供应商和消费者使用相同合同的问题的答案。</font><font style="vertical-align: inherit;">这些是旨在检查合同的某种集成测试。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这个想法如下：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消费者描述合同。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">供应商在家中执行此合同。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此合同在消费者和供应商的CI流程中使用。</font><font style="vertical-align: inherit;">如果违反了流程，则表示某人已停止遵守合同。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PACT是实现此想法的工具。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用者使用PACT库编写测试。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些测试将转换为工件-pact文件。</font><font style="vertical-align: inherit;">它包含有关合同的信息。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供者和消费者使用契约文件来运行测试。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在客户端测试期间，将创建提供者存根，而在供应商测试期间，将创建客户端存根。</font><font style="vertical-align: inherit;">这两个存根都使用pact文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以通过Swagger Mock Validator </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bitbucket.org/atlassian/swagger-mock-validator/src/master</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现类似的存根创建行为</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于契约的有用链接</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">契约代理-契约文件管理解决方案</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io/pact_broker</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pact尚不支持GRPC。</font><font style="vertical-align: inherit;">阅读有关路线图Pact </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pact.canny.io的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多信息</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io上的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PACT的更多信息</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么要使用PACT </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docs.pact.io/faq/convinceme</font></font></a></li>
</ul><br>
<img src="https://habrastorage.org/webt/0u/qv/-f/0uqv-fhceairtmtcfyv6fy9b-xg.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何将CDC嵌入到CI中</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己部署Pact + Pact经纪人；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">购买现成的Pact Flow SaaS解决方案。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
需要签订协议以确保合同合规。</font><font style="vertical-align: inherit;">它将显示合同变更何时违反了消费者服务的期望。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当供应商适应客户-客户时，此工具适用。</font><font style="vertical-align: inherit;">这仅在隔离的系统内部可行。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您要为外界提供服务，而又不知道您的客户是谁，那么Pact不适合您。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN502636/index.html">商业和计算机朋克：混合，维持，使用</a></li>
<li><a href="../zh-CN502638/index.html">2020年如何在Instagram上开发博客：Sasha Mitroshina案分析</a></li>
<li><a href="../zh-CN502642/index.html">将游戏“ Snake”放在实验板上。第2部分：“向量”显示</a></li>
<li><a href="../zh-CN502644/index.html">Sherpaa如何传递不切实际的风险投资期望</a></li>
<li><a href="../zh-CN502648/index.html">关于将Hadoop移植到云的十大误解</a></li>
<li><a href="../zh-CN502654/index.html">马云在英语方面有很多错误，但他的口语能力比大多数学生都高。这是为什么？</a></li>
<li><a href="../zh-CN502656/index.html">微型化：两原子磁性半导体</a></li>
<li><a href="../zh-CN502660/index.html">如何在没有部分/参与的情况下翻译“参与” /“参与者”</a></li>
<li><a href="../zh-CN502662/index.html">日常生活中的“炼金术士”</a></li>
<li><a href="../zh-CN502666/index.html">组件486-零件选择</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>