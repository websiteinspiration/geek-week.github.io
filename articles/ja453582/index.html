<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♎️ 🌉 🧑🏼‍🤝‍🧑🏼 ロックファイルを使用しない方が良いNode.jsプロジェクト 👼🏽 👩🏿‍✈️ 👷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日私たちが翻訳を公開している資料の著者は、プログラマーが対処しなければならない問題の1つは、コードが彼らのために機能し、それが他の誰かにエラーを与えることだと述べています。この問題は、おそらく最も一般的なものの1つであり、プログラムの作成者とユーザーのシステムでは、プログラムが使用する依存関係が異...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ロックファイルを使用しない方が良いNode.jsプロジェクト</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/453582/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日私たちが翻訳を公開している資料の著者は、プログラマーが対処しなければならない問題の1つは、コードが彼らのために機能し、それが他の誰かにエラーを与えることだと述べています。</font><font style="vertical-align: inherit;">この問題は、おそらく最も一般的なものの1つであり、プログラムの作成者とユーザーのシステムでは、プログラムが使用する依存関係が異なるために発生します。</font><font style="vertical-align: inherit;">この現象に対処する</font><font style="vertical-align: inherit;">ために、いわゆるロックファイルが、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yarn</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージマネージャーに</font><font style="vertical-align: inherit;">存在します。</font><font style="vertical-align: inherit;">依存関係の正確なバージョンに関する情報が含まれています。</font><font style="vertical-align: inherit;">このメカニズムは便利ですが、誰かがnpmで公開される予定のパッケージを開発している場合は、ロックファイルを使用しない方がよいでしょう。</font><font style="vertical-align: inherit;">この資料は、これがそうである理由の話に捧げられています。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/_r/wg/hp/_rwghp7lka8tkw1fdaqwyhfmqfg.png"></a><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一言で言えば最も重要なこと</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロックファイルは、WebサーバーなどのNode.jsアプリケーションを開発するときに非常に役立ちます。</font><font style="vertical-align: inherit;">ただし、npmでの公開を目的としたライブラリまたはコマンドラインツールの作成について話している場合は、npmのロックファイルが公開されていないことを知っておく必要があります。</font><font style="vertical-align: inherit;">つまり、開発中にこれらのファイルが使用される場合、npmパッケージの作成者とこのパッケージを使用するユーザーは、異なるバージョンの依存関係を使用します。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロックファイルとは何ですか？</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ロックファイルは、プロジェクトの作業中に取得した形式で完全な依存関係ツリーを記述します。</font><font style="vertical-align: inherit;">この説明には、ネストされた依存関係も含まれます。</font><font style="vertical-align: inherit;">このファイルには、使用されているパッケージの特定のバージョンに関する情報が含まれています。</font><font style="vertical-align: inherit;">NPMパッケージマネージャでは、このようなファイルが呼び出され</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">た糸で、 - </font></font><code>yarn.lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">どちらのマネージャでも、これらのファイルはと同じフォルダにあります</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルは次のようになります</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="json hljs">{
 <span class="hljs-attr">"name"</span>: <span class="hljs-string">"lockfile-demo"</span>,
 <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
 <span class="hljs-attr">"lockfileVersion"</span>: <span class="hljs-number">1</span>,
 <span class="hljs-attr">"requires"</span>: <span class="hljs-literal">true</span>,
 <span class="hljs-attr">"dependencies"</span>: {
 &nbsp;&nbsp;<span class="hljs-attr">"ansi-styles"</span>: {
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"version"</span>: <span class="hljs-string">"3.2.1"</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"resolved"</span>: <span class="hljs-string">"https://registry.npmjs.org/ansi-styles/-/ansi-styles-3.2.1.tgz"</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"integrity"</span>: <span class="hljs-string">"sha512-VT0ZI6kZRdTh8YyJw3SMbYm/u+NqfsAxEpWO0Pf9sq8/e94WxxOpPKx9FR1FlyCtOVDNOQ+8ntlqFxiRc+r5qA=="</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"requires"</span>: {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"color-convert"</span>: <span class="hljs-string">"^1.9.0"</span><font></font>
 &nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
 &nbsp;&nbsp;},<font></font>
 &nbsp;&nbsp;<span class="hljs-attr">"chalk"</span>: {
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"version"</span>: <span class="hljs-string">"2.4.2"</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"resolved"</span>: <span class="hljs-string">"https://registry.npmjs.org/chalk/-/chalk-2.4.2.tgz"</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"integrity"</span>: <span class="hljs-string">"sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ=="</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"requires"</span>: {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"ansi-styles"</span>: <span class="hljs-string">"^3.2.1"</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"escape-string-regexp"</span>: <span class="hljs-string">"^1.0.5"</span>,
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"supports-color"</span>: <span class="hljs-string">"^5.3.0"</span><font></font>
 &nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
 &nbsp;&nbsp;}<font></font>
 }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがファイルの例です</font></font><code>yarn.lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同じようには設計されていません</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、同様のデータが含まれています。</font></font><br>
<br>
<pre><code class="json hljs"># THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.<font></font>
# yarn lockfile v1<font></font>
<font></font>
ansi-styles@^<span class="hljs-number">3.2</span><span class="hljs-number">.1</span>:<font></font>
 &nbsp;version <span class="hljs-string">"3.2.1"</span>
 &nbsp;resolved <span class="hljs-string">"https://registry.yarnpkg.com/ansi-styles/-/ansi-styles-3.2.1.tgz#41fbb20243e50b12be0f04b8dedbf07520ce841d"</span>
 &nbsp;integrity sha512-VT0ZI6kZRdTh8YyJw3SMbYm/u+NqfsAxEpWO0Pf9sq8/e94WxxOpPKx9FR1FlyCtOVDNOQ+<span class="hljs-number">8</span>ntlqFxiRc+r5qA==<font></font>
 &nbsp;dependencies:<font></font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color-convert <span class="hljs-string">"^1.9.0"</span><font></font>
<font></font>
chalk@^<span class="hljs-number">2.4</span><span class="hljs-number">.2</span>:<font></font>
 &nbsp;version <span class="hljs-string">"2.4.2"</span>
 &nbsp;resolved <span class="hljs-string">"https://registry.yarnpkg.com/chalk/-/chalk-2.4.2.tgz#cd42541677a54333cf541a49108c1432b44c9424"</span><font></font>
 &nbsp;integrity sha512-Mti+f9lpJNcwF4tWV8/OrTTtF1gZi+f8FqlyAdouralcFWFQWF2+NgCHShjkCb+IFBLq9buZwE1xckQU4peSuQ==<font></font>
 &nbsp;dependencies:<font></font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ansi-styles <span class="hljs-string">"^3.2.1"</span>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escape-string-regexp <span class="hljs-string">"^1.0.5"</span>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;supports-color <span class="hljs-string">"^5.3.0"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのファイルの両方には、いくつかの重要な依存関係情報が含まれています。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストールされている各依存関係の正確なバージョン。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各依存関係の依存関係情報。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージの整合性を検証するために使用されるチェックサムを含む、ダウンロードされたパッケージに関する情報。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての依存関係がロックファイルにリストされている場合、なぜそれらはそれらに関する情報を追加するの</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ですか？</font><font style="vertical-align: inherit;">なぜ2つのファイルが必要なのですか？</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">package.jsonとロックファイルの比較</font></font></font></h2><br><font style="vertical-align: inherit;"></font><code>dependencies</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">
フィールドの目的は、</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しく動作するためにインストールする必要があるプロジェクトの依存関係を示すことです。</font><font style="vertical-align: inherit;">ただし、これにはこれらの依存関係の依存関係に関する情報は含まれません。</font><font style="vertical-align: inherit;">依存関係情報には、正確なパッケージバージョン、または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セマンティックバージョニングの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">規則に従って指定された特定の範囲のバージョンが含まれる場合があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">npmまたはyarn範囲を使用する場合、最も適切なパッケージバージョンが選択されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特定のプロジェクトの依存関係を設定するコマンドが実行されたとします。</font></font><code>npm install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。インストールプロセス中に、npmは適切なパッケージを取得しました。このコマンドをしばらくして再度実行し、この間に新しいバージョンの依存関係がリリースされた場合、プロジェクトで使用されているパッケージの他のバージョンが2回目に読み込まれる可能性があります。たとえば</font></font><code>twilio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コマンドを使用する</font><font style="vertical-align: inherit;">など、依存関係が確立されている場合</font></font><code>npm install twilio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><font style="vertical-align: inherit;">次のエントリが</font></font><code>dependencies</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">セクションに</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示さ</font><font style="vertical-align: inherit;">れる</font><font style="vertical-align: inherit;">ことが</font><font style="vertical-align: inherit;">あり</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">{<font></font>
 &nbsp;"dependencies": {<font></font>
 &nbsp;&nbsp;&nbsp;&nbsp;"twilio": "^3.30.3"<font></font>
 &nbsp;}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたが見れば</font><font style="vertical-align: inherit;">NPMセマンティックバージョニング</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、アイコンがあることがわかります</font></font><code>^</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージのいずれかのバージョンが適当であり、数がより多いまたは3.30.3未満の4.0.0と同等であることを示しています。解放されたプロジェクトとパッケージの新しいバージョンにはロックファイルが存在しない場合、結果として、チームがします</font></font><code>npm install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どちらか</font></font><code>yarn install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自動的にパッケージのこの新しいバージョンをインストールします。</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合の</font><font style="vertical-align: inherit;">情報は</font><font style="vertical-align: inherit;">更新されません。ロックファイルを使用すると、すべてが異なって見えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
npmまたはyarnが対応するロックファイルを見つけると、それらはこのファイルに基づいてパッケージをインストールします。</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、たとえば、特性が事前にわかっている環境でコードとテストを均一に運用する必要があるプラットフォームで継続的インテグレーション（CI）システムを使用する場合に特に便利です。このような場合、適切なパッケージマネージャーを呼び出すときに、特別なコマンドまたはフラグを使用できます。</font></font><br>
<br>
<pre><code class="javascript hljs">npm ci #   ,    package-lock.json<font></font>
yarn install --frozen-lock-file #  ,    yarn.lock,    </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、CI環境ではユーザーの動作をシミュレートする必要があるため、Webアプリケーションやサーバーなどのプロジェクトを開発している場合に非常に役立ちます。</font><font style="vertical-align: inherit;">その結果、プロジェクトリポジトリにロックファイルを含める場合（たとえば、gitツールを使用して作成）、すべての開発者、すべてのサーバー、すべてのコード構築システム、およびすべてのCI環境が同じバージョンを使用していることを確認できます。依存関係。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリまたは他のソフトウェアツールをnpmレジストリで公開するときに、同じことをしないのはなぜですか？</font><font style="vertical-align: inherit;">この質問に答える前に、パッケージを公開するプロセスがどのように編成されているかについて話す必要があります。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ発行プロセス</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の開発者は、npmで公開されるものはgitリポジトリに保存されるもの、またはプロジェクトの作業完了後にプロジェクトがどのようになるかを正確に信じています。これは実際にはそうではありません。パッケージを公開するプロセスでは、NPMの発見は、外のファイルは、キーアクセスして公開し</font></font><code>files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たファイルで</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ファイルを</font></font><code>.npmignore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これを検出できない場合は、ファイルが使用され</font></font><code>.gitignore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。また、常に公開されるファイルと公開されないファイルがあります。これらのファイルの内容については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。たとえば、npmは常にフォルダーを無視します</font></font><code>.git</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、npmは適切なすべてのファイルを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し</font></font><code>tarball</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次のコマンドを使用</font><font style="vertical-align: inherit;">してファイルに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">パック</font></a><font style="vertical-align: inherit;">します</font></font><code>npm pack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのようなファイルに正確にパックされているものを確認したい場合は、プロジェクトフォルダーでコマンドを実行</font></font><code>npm pack --dry-run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">し、コンソールでマテリアルのリストを確認</font><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83e/1a1/edc/83e1a1edc6fc37c9573fd816103f5f3e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Npm packコマンドの結果--dry-run</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
結果のファイルは</font></font><code>tarball</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、npmレジストリにアップロードされます。</font><font style="vertical-align: inherit;">コマンドを実行する</font></font><code>npm pack --dry-run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と、プロジェクト</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">ファイルがある場合</font><font style="vertical-align: inherit;">、それがtarballファイルに含まれていない</font><font style="vertical-align: inherit;">ことに注意する</font><font style="vertical-align: inherit;">ことができます。</font><font style="vertical-align: inherit;">これは、</font><font style="vertical-align: inherit;">npm</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルール</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に従って、このファイル</font><font style="vertical-align: inherit;">が常に無視されるためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、誰かが他の誰かのパッケージをインストールした場合、そのファイル</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はこれに参加しないことがわかりました。</font><font style="vertical-align: inherit;">他の人がパッケージをインストールするときに、パッケージ開発者が持っているこのファイルの内容は考慮されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、残念なことに偶然にも、最初に述べた問題につながる可能性があります。</font><font style="vertical-align: inherit;">開発者のシステムではコードは正常に機能し、他のシステムではエラーが発生します。</font><font style="vertical-align: inherit;">しかし、実際には、プロジェクト開発者とプロジェクトを使用する人々は、異なるバージョンのパッケージを使用しています。</font><font style="vertical-align: inherit;">それを修正するには？</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロックファイルの拒否とテクノロジーシュリンクラップの使用</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、プロジェクトリポジトリにロックファイルが含まれないようにする必要があります。</font><font style="vertical-align: inherit;">gitを使用する場合は、プロジェクトファイルに</font></font><code>.gitignore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下</font><font style="vertical-align: inherit;">を含める必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">yarn.lock<font></font>
package-lock.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヤーンのドキュメントには、</font></font><code>yarn.lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開する予定のライブラリを開発する場合でも、リポジトリに追加する必要があると</font><font style="vertical-align: inherit;">記載されてい</font><font style="vertical-align: inherit;">ます。ただし、ライブラリのユーザーと同じコードを使用する場合</font></font><code>yarn.lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ファイルに</font><font style="vertical-align: inherit;">含めることをお勧め</font><font style="vertical-align: inherit;">します</font></font><code>.gitignore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次の内容の</font><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">プロジェクトフォルダに追加することで、</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
自動ファイル作成</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">無効に</font><font style="vertical-align: inherit;">できます</font></font><code>.npmrc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="javascript hljs">package-lock=<span class="hljs-literal">false</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヤーンを操作するとき</font></font><code>yarn install --no-lockfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ファイルの読み取りを無効にする</font><font style="vertical-align: inherit;">コマンド</font><font style="vertical-align: inherit;">を使用できます</font></font><code>yarn.lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ファイルを削除</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したからといって、依存関係とネストされた依存関係に関する情報を取得できないというわけではありません。</font><font style="vertical-align: inherit;">と呼ばれる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">別のファイル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a></font><code>npm-shrinkwrap.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、これ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font></a><font style="vertical-align: inherit;"></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チームが作成した</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ファイル</font></a><font style="vertical-align: inherit;">と</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">同じです</font></a></font><code>npm shrinkwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このファイルは、パッケージが公開されるときにnpmレジストリに入ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この操作を自動化するために、コマンド</font></font><code>npm shrinkwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をファイルのスクリプトの説明セクションに追加できます</font></font><code>package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prepackスクリプトの形式で。</font><font style="vertical-align: inherit;">git commitフックを使用して同じ効果を得ることができます。</font><font style="vertical-align: inherit;">その結果、開発環境、CIシステム、およびプロジェクトのユーザーが同じ依存関係を確実に使用できるようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このテクニックは責任を持って使用することをお勧めします。</font><font style="vertical-align: inherit;">シュリンクラップファイルを作成することにより、依存関係の特定のバージョンをコミットします。</font><font style="vertical-align: inherit;">一方では、プロジェクトの安定した運用を保証するのに役立ちます。他方では、ユーザーが重要なパッチをインストールするのを防ぐことができます。そうでなければ、自動的に行われます。</font><font style="vertical-align: inherit;">実際、npmは、ライブラリの開発時にシュリンクラップファイルを使用しないことを強くお勧めします。その使用はCIシステムなどに限定されます。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージと依存関係の情報を見つける</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、</font><font style="vertical-align: inherit;">npmの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には依存関係管理に関する豊富な情報が含まれているため、</font><font style="vertical-align: inherit;">この情報をナビゲートするのが難しい場合があります。</font><font style="vertical-align: inherit;">依存関係のインストール中にインストールされるもの、またはパッケージをnpmに送信する前にパックされるものを正確に知りたい場合は、さまざまなコマンドでフラグを使用できます</font></font><code>--dry-run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このフラグを適用すると、チームはシステムに影響を与えなくなります。</font><font style="vertical-align: inherit;">たとえば、コマンド</font></font><code>npm install --dry-run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は実際に依存関係をインストール</font></font><code>npm publish --dry-run</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">せず</font><font style="vertical-align: inherit;">、コマンド</font><font style="vertical-align: inherit;">はパッケージ発行プロセスを開始しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様のコマンドをいくつか示します。</font></font><br>
<br>
<pre><code class="plaintext hljs">npm ci --dry-run #  ,   package-lock.json   npm-shrinkwrap.json<font></font>
npm pack --dry-run #     ,      <font></font>
npm install &lt;dep&gt; --verbose --dry-run #           </code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで説明したことの多くは、npmを使用してさまざまな操作を実行する詳細に依存しています。パッケージ化、公開、パッケージのインストール、依存関係の操作について話しています。そして、npmは常に進化しているという事実を考えると、これらすべてが将来変更される可能性があると言えます。さらに、ここに記載されている推奨事項を実際に適用できるかどうかは、パッケージ開発者がさまざまな環境でさまざまなバージョンの依存関係を使用する問題をどのように認識するかによって異なります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この資料が、npmで依存関係を操作するためのエコシステムがどのように機能するかを理解するのに役立つことを願っています。この質問をさらに掘り下げたい場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"></font><code>npm ci</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とと</font><font style="vertical-align: inherit;">コマンドの違いについて読むことができます</font></font><code>npm install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたは正確にファイルに入ったものを見つけることができます</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>npm-shrinkwrap.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プロジェクトファイルが含まれており、パッケージに含まれていないあなたは見つけることができNPMのドキュメントページです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトでnpm-shrinkwrap.jsonファイルを使用していますか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja453566/index.html">伝説を復元する：ノートルダムの復元に役立つオープンデータの交換の呼びかけ</a></li>
<li><a href="../ja453570/index.html">macOS用Microsoft Edge</a></li>
<li><a href="../ja453574/index.html">B2B製品管理</a></li>
<li><a href="../ja453578/index.html">批評家からアルゴリズムまで：レーベル、企業、20世紀の音楽文化</a></li>
<li><a href="../ja453580/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェストNo.366（2019年5月20日〜26日）</a></li>
<li><a href="../ja453584/index.html">準備する：Angular 8は間近です</a></li>
<li><a href="../ja453586/index.html">IntersectionObserver APIと画像の遅延読み込み</a></li>
<li><a href="../ja453588/index.html">陛下の粘土についての作品。パート4-シリコーン</a></li>
<li><a href="../ja453590/index.html">自分だけのSaaS</a></li>
<li><a href="../ja453592/index.html">生計を立ててゲームを作る：11 Levelordのヒント</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>