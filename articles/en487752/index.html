<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü©Ô∏è üç´ üë®üèæ Optimize storage: a case of unification and lower cost of ownership üîÑ üëä üßëüèø‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article describes the process of optimizing the storage infrastructure of a middle-class company. 
 
 Justifications for such a transition and a b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Optimize storage: a case of unification and lower cost of ownership</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/487752/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The article describes the process of optimizing the storage infrastructure of a middle-class company. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Justifications for such a transition and a brief description of the process of setting up a new storage system are considered. </font><font style="vertical-align: inherit;">We give an example of the pros and cons of switching to the selected system.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The infrastructure of one of our customers consisted of many heterogeneous storage systems of different levels: from SOHO systems QNAP, Synology for user data to Entry and Mid-range storage systems Eternus DX90 and DX600 for iSCSI and FC for service data and virtualization systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this differed both in generations and in the disks used; part of the systems was legacy equipment that did not have vendor support. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A separate problem was the management of free space, since all available disk space was highly fragmented across many systems. As a result, the inconvenience of administration and the high cost of maintaining a fleet of systems. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We faced the challenge of optimizing the storage infrastructure in order to reduce the cost of ownership and unification.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The task was comprehensively analyzed by our company experts taking into account customer requirements for data availability, IOPS, RPO / RTO, as well as the possibility of upgrading the existing infrastructure.</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementation</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main players in the market for mid-range storage systems (and above) are IBM with Storwize; Fujitsu, represented by the Eternus line, and NetApp with the FAS series. As a storage system that meets the given requirements, these systems were considered, namely: IBM Storwize V7000U, Fujitsu Eternus DX100, NetApp FAS2620. All three are Unified-SHD, that is, they provide both block access and file access, and provide close performance indicators. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in the case of the Storwize V7000U, file access is organized through a separate controller - a file module that connects to the main block controller, which is an additional point of failure. In addition, this system is relatively difficult to manage, and does not provide proper isolation of services.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Eternus DX100 storage system, also being an Unified storage system, has serious limitations on the number of file systems created, without giving the necessary isolation. In addition, the process of creating a new file system takes a long time (up to half an hour). Both described systems do not allow sharing CIFS / NFS servers used at the network level.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Taking into account all parameters, including the total cost of ownership of the system, NetApp FAS2620 was chosen, consisting of a pair of controllers operating in Active-Active mode, and allowing to distribute the load between the controllers. And when combined with the built-in mechanisms of online deduplication and compression, it can significantly save on the space occupied by data on disks. These mechanisms become much more effective when aggregating data on one system compared to the initial situation, when potentially identical data was located on different storage systems and it was impossible to deduplicate them among themselves.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such a system made it possible to place all types of services under the control of a single failover cluster: SAN in the form of block devices for virtualization and NAS in the form of CIFS, NFS shares for Windows user data and * nix systems. At the same time, there remained the possibility of a safe logical separation of these services thanks to the SVM (Storage Virtual Machine) technology: the services responsible for different components do not affect the ‚Äúneighbors‚Äù and do not allow access to them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It also remains possible to isolate services at the disk level, avoiding performance sagging under heavy load from the "neighbors".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For services that require fast read / write, you can use a hybrid type of RAID array, adding several SSDs to the HDD aggregate. </font><font style="vertical-align: inherit;">The system itself will place ‚Äúhot‚Äù data on them, reducing the latency of reading frequently used data. </font><font style="vertical-align: inherit;">This is in addition to the NVRAM cache, which ensures its atomicity and integrity in addition to the high write speed (data will be stored in the NVRAM powered by the battery until confirmation of their complete recording is received from the file system) in case of a sudden power failure. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After data migration to a new storage system, it becomes possible to more efficiently use the cache disk space.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Positive sides</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As mentioned above, the use of this system made it possible to solve two problems at once: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Unification</font></font></b><br>
<br>
<ul>
<li>     ,    ,     ,   .</li>
<li>       .    ,     LUN,            .</li>
<li>   .    ,     .     ,    Ethernet  Fiber Channel   .</li>
<li>          ,     ,     .         .</li>
</ul><br>
<b>‚Äî </b><br>
<br>
<ul>
<li>   NetApp  SVM (Storage Virtual Machine),     ,   ,     .        SVM,     .          /.</li>
<li>    .<br>
 SVM      ,       ,  VLAN-.  ,              SVM,      VLAN‚Äô.  ,     trunk-.<br>
    iSCSI-,     SAN-      ,        , ¬´ ¬ª    .<br>
</li>
<li>     .<br>
      - RAID- (     RAID-   ),          Volume. Volume  SVM‚Äô,       SVM‚Äô   .     ¬´¬ª  , ¬´¬ª  SVM‚Äô  .<br>
        RAID-    ,        .<br>
</li>
</ul><br>
<b>‚Äî </b><br>
<br>
<ul>
<li>                .          RAID-,    .</li>
<li>           (CPU, RAM).           storage-,     ,   IO-,      .</li>
<li> NetApp  S3-       ,          on-premise    , .</li>
</ul><br>
<h4> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Having reduced all services under the control of one system, we expectedly get a greater impact from disabling one component (1 out of 2 controllers versus 1 out of 10+ in the old infrastructure). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Decreased distribution of storage infrastructure. </font><font style="vertical-align: inherit;">If earlier storage systems could be located on different floors / in different buildings, now everything is concentrated in one rack. </font><font style="vertical-align: inherit;">This item can be offset by purchasing a less efficient system and using synchronous / asynchronous replication in case of force majeure situations.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step by step setup</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Due to the confidentiality of information, it is impossible to demonstrate screenshots from the real customer‚Äôs environment, so the configuration steps are shown in the test environment and completely repeat the steps performed in the customer‚Äôs productive environment. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/ko/1t/f1ko1tluxp7grrcm0vfi6iwe1vw.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The initial state of the cluster. Two aggregates for root partitions of the corresponding clus01_01, clus01_02 cluster nodes </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/5f/-n/k1/5f-nk1hym-z5y7v92zqlvmnjgwe.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creating aggregates for data. Each node has its own aggregate consisting of one RAID-DP array. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/d8/id/5w/d8id5wywwsh0fpnjof0ag10ucyq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Result: two aggregates were created: rg0_node02, rg1_node01. There is no data on them yet. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/pb/7q/xz/pb7qxz8bpdoyxxvh76b_ud8vwis.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creation of SVM as a CIFS server. For SVM, it is mandatory to create a root volume for which the root aggregate is selected - rg1_node01. This volume will store individual SVM settings.</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/pp/jv/_b/ppjv_brwqb09psalyq0cue4ftru.png"><br>
<i> CIFS-  SVM.   IP-   .,      .       VLAN-,   LACP .      Volume   ,   ,       .</i><br>
<br>
<img src="https://habrastorage.org/webt/vj/9w/tm/vj9wtmzdhhm0brl9s7fr2vrz8ro.png"><br>
<i>      ,        .        4,9  ,    .        .</i><br>
<br>
<img src="https://habrastorage.org/webt/ha/sy/2h/hasy2hzg7gzbn3p486hoivjwk0i.png"><br>
<i> SVM   iSCSI-.   ,     Root Volume  .         CIFS-  IP-   iSCSI-, .  ,     (LUN),    .</i><br>
<br>
<img src="https://habrastorage.org/webt/lw/ui/or/lwuiorx2n-cxtgehsnkes7dvjj4.png"><br>
<i> LUN  10 .     ,     .</i><br>
<br>
<img src="https://habrastorage.org/webt/if/p1/og/ifp1ogwj-7c84uv6jr5f7vsotws.png"><br>
<i>     Hyper-V Server    iqn.</i><br>
<br>
<img src="https://habrastorage.org/webt/tg/mj/35/tgmj35rac-x-uswp0sttjp8int4.png"><br>
<i>   Hyper-V Server LUN         Linux.       Volume,   ,   ,    .     LUN     ,        .</i></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en487742/index.html">Arbitrage Trading (Bellman-Ford Algorithm)</a></li>
<li><a href="../en487744/index.html">FARO Introduces FOCUS S 70 Laser 3D Scanner</a></li>
<li><a href="../en487746/index.html">Eternal</a></li>
<li><a href="../en487748/index.html">$ 3 hardware encryption key - is this possible?</a></li>
<li><a href="../en487750/index.html">Some subtleties of injection collections in Spring</a></li>
<li><a href="../en487754/index.html">Organization of the intranet (automation of IT production). Part 1 - Users and Mail</a></li>
<li><a href="../en487756/index.html">RIT, Maxim Lapshin (Erlyvideo): how a programmer to grow a company</a></li>
<li><a href="../en487764/index.html">I am 14 and I combine school with work in IT</a></li>
<li><a href="../en487768/index.html">Opening ports 4321 and 9898 on Xiaomi Gateway 2</a></li>
<li><a href="../en487772/index.html">Meet the Chuvash language in Yandex.Translate: how we solve the main problem of machine translation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>