<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌅 📔 🚟 HTTP / 3 and HTTP / 2 performance comparison 🏇🏻 👩🏾‍🚒 👏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We at Cloudflare announced HTTP / 3 support last September when we were celebrating our ninth birthday . Our goal has always been to improve the Inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HTTP / 3 and HTTP / 2 performance comparison</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/497520/"><img src="https://habrastorage.org/getpro/habr/post_images/65f/7dd/0ec/65f7dd0ec9fb9b4950c56c632f259165.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We at Cloudflare announced </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://blog.cloudflare.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP / 3 support</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> last September when we </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">were celebrating our ninth birthday</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Our goal has always been to improve the Internet. Collaboration in the field of standards is an important part of the process, and we are fortunate to be involved in the development of HTTP / 3.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although HTTP / 3 is still at the draft stage, we noticed a great interest in the new protocol from our users (Cloudflare infrastructure serves more than 10% of Internet sites - approx. Per.). To date, more than 113,000 zones have activated HTTP / 3 support, and if you have an experimental browser, now you can access these zones using the new protocol! It's great that so many people have included it: working on HTTP / 3 of a large number of real websites means that you can test more various properties from browsers.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We initially </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://blog.cloudflare.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launched HTTP / 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in partnership with Google, which also included experimental support for Chrome Canary. </font><font style="vertical-align: inherit;">Since then, more and more browsers have added experimental support: it appeared in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firefox Nightly builds</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in various Chromium-based browsers such as Opera and Edge (via the Chromium base engine), and in </font><font style="vertical-align: inherit;">Safari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pre-builds</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We closely monitor these developments and help wherever we can. </font><font style="vertical-align: inherit;">Having a large network of sites that have enabled HTTP / 3 gives browser developers an excellent testing ground to validate the code.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So what is the current status?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The IETF standardization process involves a series of drafts to prepare a “final draft” ready for labeling as an RFC standard. QUIC team members work together on analysis, implementation, and interoperability to identify potential problems. We launched protocol support at the stage of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://tools.ietf.org/html/draft-ietf-quic-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23rd version of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> draft, and then we followed all the changes, and at the time of writing (April 14, 2020) the last was the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://tools.ietf.org/html/draft-ietf-quic-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27th version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">With each draft, the quality of the QUIC definitions improves and approaches a “rough consensus” about how the protocol should behave. </font><font style="vertical-align: inherit;">To avoid perpetual analysis with endlessly dopilivaniya settings to the ideal, with each new version of the draft the bar for making changes to the specification increases. </font><font style="vertical-align: inherit;">This means that with each version there are fewer changes, and the final RFC will closely correspond to the protocol that we have already launched in production.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benefits</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
One of the main advantages of HTTP / 3 was the increase in performance, especially when requesting multiple objects at the same time. In HTTP / 2, any interference (packet loss) in a TCP connection blocks all flows at once (blocking the beginning of a line). Since HTTP / 3 is based on UDP, only one stream is interrupted when a packet is lost, but not all. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, HTTP / 3 supports </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0-RTT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (zero receive-transmit time), that is, subsequent connections can start much faster than the first, eliminating the need to confirm TLS from the server when establishing a connection. This means that the client begins to request data much earlier than with full TLS negotiation, that is, the website starts loading in the browser earlier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The animations below show the effect of packet loss. In the first example, requests are received from the client to the server over HTTP / 2 to receive two resources. Requests and related responses are colored in green and yellow. Responses are broken into several packets. Alas, one packet is lost - as a result, the transfer of both resources is delayed. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/124/73f/12d/12473f12db5359904526d1878bc3c046.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the second example, requests for two resources are received via HTTP / 3. One packet is lost, blocking the transfer of the yellow resource, but without affecting the green one.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f6d/c5b/11f/f6dc5b11f8a240b4283dcb8de5b9a0f4.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Improvements in the procedure for negotiating a session mean that “connections” with servers are established much faster, that is, data arrives faster in the browser. We were curious how much this was reflected in real traffic, so we conducted several tests. To evaluate the contribution of 0-RTT, we launched several control tests to measure the time to the first byte (time to first byte, TTFB). On average, over HTTP / 3, the first byte appears after 176 ms. In the case of HTTP / 2, we see 201 ms, that is, HTTP / 3 here reduces the delay by 12.4%! </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6e9/87d/1e7/6e987d1e7e32d2041cfd80920f37a52f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interestingly, drafts and RFCs do not regulate all aspects of the protocol. For example, the </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">packet transfer method</font></a><font style="vertical-align: inherit;"> affects performance.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and traffic congestion control algorithm. Congestion control is a method of adapting to congested networks on the client and server side: when packets are lost, the quality of communication decreases. Since QUIC is a new protocol, experimentation and tuning are required to properly design and implement an overload management system. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a simple and safe starting point, the Loss Detection and Congestion Control specification recommends the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reno</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> algorithm </font><font style="vertical-align: inherit;">, but any other can be used. We started with the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Reno</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> algorithm </font><font style="vertical-align: inherit;">, but based on experience, we assumed that it was not optimal. We recently switched to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CUBIC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;- And in a network with oversized transmissions and greater packet loss, CUBIC performed better than New Reno. Soon we will talk more about this, stay tuned for a blog update. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the current HTTP / 2 stack, we have </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBR v1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (TCP). This means that the tests do not perform an exact comparison of apples with apples, as these congestion control algorithms behave differently on different gear sizes. However, when switching from HTTP / 2 to HTTP / 3, we already see an improvement on smaller sites. In large areas, brilliant performance is shown by our finely tuned and optimized HTTP / 2 stack.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A small 15K test page loads over HTTP / 3 on average in 443 ms, compared to 458 ms for HTTP / 2. But if you increase the page size to 1 MB, this advantage disappears: specifically in our network, the HTTP / 3 protocol now works a little slower than HTTP / 2 - 2.33 s versus 2.30 s. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/e9e/562/b32/e9e562b32780f0d63499d13362be51ca.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a96/e57/122/a96e57122148f282b3343a6022e61d4e.png"><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7fc/688/e1d/7fc688e1dfd935afe4fb09107f354296.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Synthetic benchmarks are interesting, but it is interesting how HTTP / 3 shows itself in the real world. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For comparison, we wanted to attract a third-party service that can download sites from our network, simulating a web browser. WebPageTest is a common framework for measuring page load time, with good cascading diagrams (waterfall). To analyze the backend, we used our own </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browser Insights</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> system </font><font style="vertical-align: inherit;">, fixing the timings at the edge of our network. Then they connected both parts by a little automation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a test case for measuring performance, we took </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">our own blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . We set up our WebPageTest instances to load the site from locations around the world, both over HTTP / 2 and over HTTP / 3. Included HTTP / 3 and Browser Insights. Thus, every time a browser with HTTP / 3 support loaded the page, test scripts requested collected analytics data from the browser. The same procedure was repeated for HTTP / 2 so that it could be compared. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The following graph shows the loading time of the actual </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog.cloudflare.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> page </font><font style="vertical-align: inherit;">with a comparison of the HTTP / 3 and HTTP / 2 metrics. We have such metrics for different geographical points.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/106/ffd/03f/106ffd03f7deccc26ca9316f57ea436a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As you can see, HTTP / 3 performance is still inferior to HTTP / 2 performance. </font><font style="vertical-align: inherit;">The difference is about 1-4% on average in North America. </font><font style="vertical-align: inherit;">Similar results in Europe, Asia and South America. </font><font style="vertical-align: inherit;">We suspect that this may be due to a difference in congestion control algorithms: BBR v1 works on HTTP / 2, and CUBIC on HTTP / 3. </font><font style="vertical-align: inherit;">In the future, we will try to implement the same overload control algorithm on both protocols in order to get a more accurate comparison of apples with apples.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Overall, we are very happy to help advance the new standard. Our implementation holds well, in some situations shows better performance, and in the worst case - similar HTTP / 2. As the standard is finalized, we look forward to browsers adding HTTP / 3 support in major versions. As for us, we will support the latest drafts and will look for new ways to optimize HTTP / 3 to further improve performance, whether it is setting up congestion control, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://blog.cloudflare.com/adopting-a-new-approach-to-"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prioritization</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or system configuration (CPU and channel bandwidth).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the meantime, if you want to try HTTP / 3 in action, just activate it on our dashboard and download the test assembly (Nightly, Canary) of any of the main browsers. </font><font style="vertical-align: inherit;">See our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://developers.cloudflare.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developer documentation for</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instructions on enabling HTTP / 3 </font><font style="vertical-align: inherit;">.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en497506/index.html">Create a todo for a remote command on Laravel</a></li>
<li><a href="../en497508/index.html">We continue to run into multi-storey C ++ templates in RESTinio: a type-safe alternative to express-js router</a></li>
<li><a href="../en497510/index.html">Video Game Audio Synthesis - Issue # 2. Prey</a></li>
<li><a href="../en497512/index.html">Will melting glaciers provide hydropower in the future?</a></li>
<li><a href="../en497516/index.html">How to create an anechoic shielded box yourself</a></li>
<li><a href="../en497522/index.html">Games for money: experience in a distributed gaming network of the owner of several servers</a></li>
<li><a href="../en497526/index.html">CodePen Added Flutter Support</a></li>
<li><a href="../en497528/index.html">Coronavirus: the world is crazy</a></li>
<li><a href="../en497532/index.html">Thanks to Habr, and new features in user posts</a></li>
<li><a href="../en497534/index.html">Loneliness for rent. 1. Fantasy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>