<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👧‍👧 📼 ⚰️ 例としてPSPゲームコンソールエミュレーターを使用してTravis CIでPVS-Studioを構成する方法 💴 🕌 👲🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Travis CIは、GitHubをソースコードのホスティングとして使用するソフトウェアを構築およびテストするための分散Webサービスです。上記のシナリオに加えて、広範な構成オプションのおかげで、独自のシナリオを追加できます。この記事では、PPSSPPコードの例を使用してPVS-Studioで動作す...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>例としてPSPゲームコンソールエミュレーターを使用してTravis CIでPVS-Studioを構成する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/464645/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/622/289/29e/62228929e341faee94fa7a2084abb6bb.png" alt="PPSSPP"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travis CIは、GitHubをソースコードのホスティングとして使用するソフトウェアを構築およびテストするための分散Webサービスです。</font><font style="vertical-align: inherit;">上記のシナリオに加えて、広範な構成オプションのおかげで、独自のシナリオを追加できます。</font><font style="vertical-align: inherit;">この記事では、PPSSPPコードの例を使用してPVS-Studioで動作するようにTravis CIを構成します。</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ソフトウェアを構築およびテストするためのWebサービスです。</font><font style="vertical-align: inherit;">通常は、継続的インテグレーションの練習と組み合わせて使用​​されます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPSSPP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -PSPゲームコンソールエミュレータ。</font><font style="vertical-align: inherit;">プログラムは、ソニーPSP用に設計されたディスクイメージからのゲームの起動をエミュレートできます。</font><font style="vertical-align: inherit;">プログラムは2012年11月1日にリリースされました。</font><font style="vertical-align: inherit;">PPSSPPはGPL v2の下でライセンスされています。</font><font style="vertical-align: inherit;">誰でも</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのソースコードを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改善でき</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、プログラムコードのエラーや潜在的な脆弱性を検索するための静的コードアナライザーです。</font><font style="vertical-align: inherit;">この記事では、変更のために、開発者のマシンのローカルではなくクラウドでPVS-Studioを起動し、PPSSPPでエラーを探します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CIを構成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要なプロジェクトがあるGitHub上のリポジトリと、PVS-Studioのキーが必要です（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">試用キーを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手する</font><font style="vertical-align: inherit;">か</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、オープンソースプロジェクトの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">無料で</font></a><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">）。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Travis CIの</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Webサイトにアクセスしてみましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">GitHubアカウントを使用して承認すると、リポジトリのリストが表示されます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52c/7ee/2c4/52c7ee2c426d0700d2f80e6a2081d344.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テストのために、PPSSPPをforkしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
収集するリポジトリをアクティブ化します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/615/ec9/200/615ec9200b31f85474f6a443bb9755c5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のところ、Travis CIは私たちのプロジェクトを組み立てることができません。組み立ての指示がないためです。</font><font style="vertical-align: inherit;">したがって、構成の時間です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分析中、たとえばPVS-Studioのキーなど、構成ファイルで指定するのは望ましくない変数が役立ちます。</font><font style="vertical-align: inherit;">したがって、Travis CIのビルド設定を使用して環境変数を追加します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e7/f4f/a27/8e7f4fa27ce4f7ac89dd5f0b330762f6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のものが必要です。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS_USERNAME-ユーザー名</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS_KEY-キー</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAIL_USER-レポートの送信に使用されるメール</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAIL_PASSWORD-メールパスワード</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の2つはオプションです。</font><font style="vertical-align: inherit;">結果はメールで送信されます。</font><font style="vertical-align: inherit;">別の方法でレポートを送信する場合は、指定する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、必要な環境変数を追加しました。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f6/c83/158/5f6c83158ee2e9bba6b6cba0d579cf3d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.travis.yml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成し</font><font style="vertical-align: inherit;">、プロジェクトのルートに配置します。</font><font style="vertical-align: inherit;">Travis CIの構成ファイルは既にPPSSPPに存在していましたが、大きすぎてこの例には完全に適していなかったため、大幅に単純化して基本要素のみを残す必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、言語、仮想マシンで使用するUbuntu Linuxのバージョン、およびアセンブリに必要なパッケージを指定します。</font></font><br>
<br>
<pre><code class="cpp hljs">language: cpp<font></font>
dist: xenial<font></font>
<font></font>
addons:<font></font>
  apt:<font></font>
    update: <span class="hljs-literal">true</span><font></font>
    packages:<font></font>
      - ant<font></font>
      - aria2<font></font>
      - build-essential<font></font>
      - cmake<font></font>
      - libgl1-mesa-dev<font></font>
      - libglu1-mesa-dev<font></font>
      - libsdl2-dev<font></font>
      - pv<font></font>
      - sendemail<font></font>
      - software-properties-common<font></font>
    sources:<font></font>
      - sourceline: <span class="hljs-string">'ppa:ubuntu-toolchain-r/test'</span>
      - sourceline: <span class="hljs-string">'ppa:ubuntu-sdk-team/ppa'</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストされているすべてのパッケージはPPSSPP専用です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、アセンブリマトリックスを指定します。</font></font><br>
<br>
<pre><code class="cpp hljs">matrix:<font></font>
  include:<font></font>
    - os: linux<font></font>
      compiler: <span class="hljs-string">"gcc"</span><font></font>
      env: PPSSPP_BUILD_TYPE=Linux PVS_ANALYZE=Yes<font></font>
    - os: linux<font></font>
      compiler: <span class="hljs-string">"clang"</span>
      env: PPSSPP_BUILD_TYPE=Linux</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マトリックス</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
セクションについてもう少し</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Travis CIでは、ビルドオプションを作成する方法が2つあります。1つ目は、コンパイラ、オペレーティングシステムのタイプ、環境変数などをリストすることです。その後、すべての可能な組み合わせのマトリックスが生成されます。</font><font style="vertical-align: inherit;">2番目は、マトリックスの明示的な表示です。</font><font style="vertical-align: inherit;">もちろん、これらの2つのアプローチを組み合わせて一意のケースを追加することも、または</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclude</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションを使用して</font><i><font style="vertical-align: inherit;">除外することもでき</font></i><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">詳細について</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、Travis CIのドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクト固有の組み立て手順を指定する必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs">before_install:<font></font>
  - travis_retry bash .travis.sh travis_before_install<font></font>
<font></font>
install:<font></font>
  - travis_retry bash .travis.sh travis_install<font></font>
<font></font>
script:<font></font>
  - bash .travis.sh travis_script<font></font>
<font></font>
after_success:<font></font>
  - bash .travis.sh travis_after_success</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Travis CIを使用すると、仮想マシンのライフのさまざまな段階で独自のチームを追加できます。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">before_install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクション</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、パッケージをインストールする前に実行されます。その後、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インストール</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">からのパッケージのインストールは以下のどの、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">addons.aptの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リスト</font><font style="vertical-align: inherit;">、我々は上記に示しました、。アセンブリ自体は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプトで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行われ</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。すべてがうまくいけば、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after_success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に入り</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">（このセクションでは、静的分析を実行します）。これらは変更できるすべての手順ではありません。さらに必要な場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CIのドキュメントを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご覧ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読みやすくするために、コマンドは</font><font style="vertical-align: inherit;">、プロジェクトのルートに配置され</font><font style="vertical-align: inherit;">ている別のスクリプト</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.travis.shに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移動さ</font><font style="vertical-align: inherit;">れました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、次の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.travis.yml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルがあります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">language: cpp<font></font>
dist: xenial<font></font>
<font></font>
addons:<font></font>
  apt:<font></font>
    update: <span class="hljs-literal">true</span><font></font>
    packages:<font></font>
      - ant<font></font>
      - aria2<font></font>
      - build-essential<font></font>
      - cmake<font></font>
      - libgl1-mesa-dev<font></font>
      - libglu1-mesa-dev<font></font>
      - libsdl2-dev<font></font>
      - pv<font></font>
      - sendemail<font></font>
      - software-properties-common<font></font>
    sources:<font></font>
      - sourceline: <span class="hljs-string">'ppa:ubuntu-toolchain-r/test'</span>
      - sourceline: <span class="hljs-string">'ppa:ubuntu-sdk-team/ppa'</span><font></font>
<font></font>
matrix:<font></font>
  include:<font></font>
    - os: linux<font></font>
      compiler: <span class="hljs-string">"gcc"</span><font></font>
      env: PVS_ANALYZE=Yes<font></font>
    - os: linux<font></font>
      compiler: <span class="hljs-string">"clang"</span><font></font>
<font></font>
before_install:<font></font>
  - travis_retry bash .travis.sh travis_before_install<font></font>
<font></font>
install:<font></font>
  - travis_retry bash .travis.sh travis_install<font></font>
<font></font>
script:<font></font>
  - bash .travis.sh travis_script<font></font>
<font></font>
after_success:<font></font>
  - bash .travis.sh travis_after_success</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージをインストールする前に、サブモジュールを更新します。</font><font style="vertical-align: inherit;">これは、PPSSPPを構築するために必要です。</font><font style="vertical-align: inherit;">最初の関数を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.travis.shに</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">（拡張子に注意してください）。</font></font><br>
<br>
<pre><code class="cpp hljs">travis_before_install() {<font></font>
  git submodule update --init --recursive<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、Travis CIで自動的に起動するようにPVS-Studioを設定することになりました。</font><font style="vertical-align: inherit;">まず、PVS-Studioパッケージをシステムにインストールする必要があります。</font></font><br>
<br>
<pre><code class="cpp hljs">travis_install() {
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$CXX"</span> = <span class="hljs-string">"g++"</span> ]; then<font></font>
    sudo apt-get install -qq g++<span class="hljs-number">-4.8</span><font></font>
  fi<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
    wget -q -O - https:<span class="hljs-comment">//files.viva64.com/etc/pubkey.txt \</span><font></font>
      | sudo apt-key add -<font></font>
    sudo wget -O /etc/apt/sources.<span class="hljs-built_in">list</span>.d/viva64.<span class="hljs-built_in">list</span> \<font></font>
      https:<span class="hljs-comment">//files.viva64.com/etc/viva64.list  </span><font></font>
    <font></font>
    sudo apt-get update -qq<font></font>
    sudo apt-get install -qq pvs-studio \<font></font>
                             libio-socket-ssl-perl \<font></font>
                             libnet-ssleay-perl<font></font>
  fi<font></font>
    <font></font>
  download_extract \<font></font>
    <span class="hljs-string">"https://cmake.org/files/v3.6/cmake-3.6.2-Linux-x86_64.tar.gz"</span> \<font></font>
    cmake<span class="hljs-number">-3.6</span><span class="hljs-number">.2</span>-Linux-x86_64.tar.gz<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">travis_install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数の最初に、</font><font style="vertical-align: inherit;">環境変数を使用して必要なコンパイラをインストールします。</font><font style="vertical-align: inherit;">次に、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ PVS_ANALYZE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に値</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">アセンブリマトリックスの構成時に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションで指定した）が</font><font style="vertical-align: inherit;">格納されている場合</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pvs-studio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージをインストールします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これに加えて、パッケージ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libio-socket-ssl-perl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libnet-ssleay-perl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も示さ</font><font style="vertical-align: inherit;">れていますが、結果をメールで送信するために必要であるため、別のレポート配信方法を選択した場合は必要ありません。</font><i><font style="vertical-align: inherit;">download_extract</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数</font><font style="vertical-align: inherit;">は、指定されたアーカイブをダウンロードして解凍します。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs">download_extract() {<font></font>
  aria2c -x <span class="hljs-number">16</span> $<span class="hljs-number">1</span> -o $<span class="hljs-number">2</span>
  tar -xf $<span class="hljs-number">2</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトをまとめるときがきました。</font><font style="vertical-align: inherit;">これは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スクリプト</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セクションで発生し</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">travis_script() {
  <span class="hljs-keyword">if</span> [ -d cmake<span class="hljs-number">-3.6</span><span class="hljs-number">.2</span>-Linux-x86_64 ]; then
    <span class="hljs-keyword">export</span> PATH=$(pwd)/cmake<span class="hljs-number">-3.6</span><span class="hljs-number">.2</span>-Linux-x86_64/bin:$PATH<font></font>
  fi<font></font>
  <font></font>
  CMAKE_ARGS=<span class="hljs-string">"-DHEADLESS=ON ${CMAKE_ARGS}"</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
    CMAKE_ARGS=<span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On ${CMAKE_ARGS}"</span><font></font>
  fi<font></font>
  cmake $CMAKE_ARGS CMakeLists.txt<font></font>
  make<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、次の行を除いて、これは単純化された元の構成です。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
  CMAKE_ARGS=<span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On ${CMAKE_ARGS}"</span>
fi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードセクションでは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のコンパイルコマンドのエクスポートフラグ</font><font style="vertical-align: inherit;">を設定し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これは、静的コードアナライザーに必要です。</font><font style="vertical-align: inherit;">詳細については、「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinuxおよびmacOSでPVS-Studioを実行する方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」の記事を参照してください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブリが成功した場合、</font><font style="vertical-align: inherit;">静的分析を実行する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">after_success</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">になります。</font></font><br>
<br>
<pre><code class="cpp hljs">travis_after_success() {
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
    pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic<font></font>
    pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic \<font></font>
                                    -o PVS-Studio-${CC}.<span class="hljs-built_in">log</span> \<font></font>
                                    --disableLicenseExpirationCheck<font></font>
    <font></font>
    plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in">log</span> -o PVS-Studio-${CC}.html<font></font>
    sendemail -t mail@domain.com \<font></font>
              -u <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> \<font></font>
              -m <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> \<font></font>
              -s smtp.gmail.com:<span class="hljs-number">587</span> \<font></font>
              -xu $MAIL_USER \<font></font>
              -xp $MAIL_PASSWORD \<font></font>
              -o tls=yes \<font></font>
              -f $MAIL_USER \<font></font>
              -a PVS-Studio-${CC}.<span class="hljs-built_in">log</span> PVS-Studio-${CC}.html<font></font>
  fi<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の行をさらに詳しく検討してみましょう。</font></font><br>
<br>
<pre><code class="cpp hljs">pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic<font></font>
pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic \<font></font>
                                -o PVS-Studio-${CC}.<span class="hljs-built_in">log</span> \<font></font>
                                --disableLicenseExpirationCheck<font></font>
plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in">log</span> -o PVS-Studio-${CC}.html</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1行目は、Travis CI環境変数を設定するときに最初に指定したユーザー名とキーからライセンスファイルを生成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2行目は分析を直接開始します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j &lt;N&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグ</font><font style="vertical-align: inherit;">は分析用のストリーム数を設定し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l &lt;file&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグはライセンスを示し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o &lt;file&gt;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグ</font><font style="vertical-align: inherit;">はログ出力用のファイルを定義します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-disableLicenseExpirationCheck</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラグ</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、デフォルトでは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pvs- studio-analyzerは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ライセンスの期限切れについてユーザーに警告します。これを防ぐには、このフラグを指定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ログファイルには変換なしでは読み取れない生の出力が含まれているため、最初にファイルを読み取り可能にする必要があります。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plog-converter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を介し</font><i><font style="vertical-align: inherit;">て</font></i><font style="vertical-align: inherit;">ログ</font><i><font style="vertical-align: inherit;">をスキップし</font></i><font style="vertical-align: inherit;">、出力はhtmlファイルです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sendemail</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドを使用してメールでレポートを送信することにしました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、次の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.travis.sh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを取得しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs">#/bin/<span class="hljs-function">bash

<span class="hljs-title">travis_before_install</span><span class="hljs-params">()</span> </span>{<font></font>
  git submodule update --init --recursive<font></font>
}<font></font>
<font></font>
download_extract() {<font></font>
  aria2c -x <span class="hljs-number">16</span> $<span class="hljs-number">1</span> -o $<span class="hljs-number">2</span>
  tar -xf $<span class="hljs-number">2</span><font></font>
}<font></font>
<font></font>
travis_install() {<font></font>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$CXX"</span> = <span class="hljs-string">"g++"</span> ]; then<font></font>
    sudo apt-get install -qq g++<span class="hljs-number">-4.8</span><font></font>
  fi<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
    wget -q -O - https:<span class="hljs-comment">//files.viva64.com/etc/pubkey.txt \</span><font></font>
      | sudo apt-key add -<font></font>
    sudo wget -O /etc/apt/sources.<span class="hljs-built_in">list</span>.d/viva64.<span class="hljs-built_in">list</span> \<font></font>
      https:<span class="hljs-comment">//files.viva64.com/etc/viva64.list  </span><font></font>
    <font></font>
    sudo apt-get update -qq<font></font>
    sudo apt-get install -qq pvs-studio \<font></font>
                             libio-socket-ssl-perl \<font></font>
                             libnet-ssleay-perl<font></font>
  fi<font></font>
    <font></font>
  download_extract \<font></font>
    <span class="hljs-string">"https://cmake.org/files/v3.6/cmake-3.6.2-Linux-x86_64.tar.gz"</span> \<font></font>
    cmake<span class="hljs-number">-3.6</span><span class="hljs-number">.2</span>-Linux-x86_64.tar.gz<font></font>
}<font></font>
travis_script() {<font></font>
  <span class="hljs-keyword">if</span> [ -d cmake<span class="hljs-number">-3.6</span><span class="hljs-number">.2</span>-Linux-x86_64 ]; then
    <span class="hljs-keyword">export</span> PATH=$(pwd)/cmake<span class="hljs-number">-3.6</span><span class="hljs-number">.2</span>-Linux-x86_64/bin:$PATH<font></font>
  fi<font></font>
  <font></font>
  CMAKE_ARGS=<span class="hljs-string">"-DHEADLESS=ON ${CMAKE_ARGS}"</span>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
    CMAKE_ARGS=<span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On ${CMAKE_ARGS}"</span><font></font>
  fi<font></font>
  cmake $CMAKE_ARGS CMakeLists.txt<font></font>
  make<font></font>
}<font></font>
travis_after_success() {<font></font>
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"$PVS_ANALYZE"</span> = <span class="hljs-string">"Yes"</span> ]; then<font></font>
    pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic<font></font>
    pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic \<font></font>
                                    -o PVS-Studio-${CC}.<span class="hljs-built_in">log</span> \<font></font>
                                    --disableLicenseExpirationCheck<font></font>
    <font></font>
    plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in">log</span> -o PVS-Studio-${CC}.html<font></font>
    sendemail -t mail@domain.com \<font></font>
              -u <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> \<font></font>
              -m <span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span> \<font></font>
              -s smtp.gmail.com:<span class="hljs-number">587</span> \<font></font>
              -xu $MAIL_USER \<font></font>
              -xp $MAIL_PASSWORD \<font></font>
              -o tls=yes \<font></font>
              -f $MAIL_USER \<font></font>
              -a PVS-Studio-${CC}.<span class="hljs-built_in">log</span> PVS-Studio-${CC}.html<font></font>
  fi<font></font>
}<font></font>
<span class="hljs-built_in">set</span> -e
<span class="hljs-built_in">set</span> -x<font></font>
<font></font>
$<span class="hljs-number">1</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gitリポジトリに変更を追加します。その後、Travis CIが自動的にビルドを開始します。</font><font style="vertical-align: inherit;">「ppsspp」をクリックしてレポートを作成します。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/705/1e1/7d8/7051e17d8fc919dd7801679b6815e8e1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のアセンブリの概要が表示されます。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/434/49e/fc3/43449efc3a67070eb47d9603a4c05bb6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブリが正常に完了すると、静的分析の結果がメールで送信されます。</font><font style="vertical-align: inherit;">もちろん、レポートを入手する方法は郵送だけではありません。</font><font style="vertical-align: inherit;">任意の実装方法を選択できます。</font><font style="vertical-align: inherit;">ただし、アセンブリが完了すると、仮想マシンのファイルにアクセスできなくなることに注意してください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エラーの概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も難しい部分を無事に完成させました。</font><font style="vertical-align: inherit;">ここで、すべての取り組みが正当化されることを確認しましょう。</font><font style="vertical-align: inherit;">郵送で届いた静的分析のレポートから興味深い点をいくつか考えてみてください（私が指摘したことではありません）。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">危険な最適化</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sha1</span><span class="hljs-params">( <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *input, <span class="hljs-keyword">int</span> ilen, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> output[<span class="hljs-number">20</span>] )</span>
</span>{<font></font>
  sha1_context ctx;<font></font>
<font></font>
  sha1_starts( &amp;ctx );<font></font>
  sha1_update( &amp;ctx, input, ilen );<font></font>
  sha1_finish( &amp;ctx, output );<font></font>
<font></font>
  <span class="hljs-built_in">memset</span>( &amp;ctx, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>( sha1_context ) );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studio警告：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V597</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラは「合計」バッファをフラッシュするために使用される「memset」関数呼び出しを削除する可能性があります。</font><font style="vertical-align: inherit;">RtlSecureZeroMemory（）関数を使用して、プライベートデータを消去する必要があります。</font><font style="vertical-align: inherit;">sha1.cpp 325 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このコードフラグメントは安全なハッシュモジュールにありますが、重大なセキュリティ上の欠陥（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-14</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">が含まれています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">デバッグバージョンのコンパイル時に生成されるアセンブラーリストを検討します。</font></font><br>
<br>
<pre><code class="cpp hljs">; Line <span class="hljs-number">355</span>
  mov r8d, <span class="hljs-number">20</span>
  <span class="hljs-keyword">xor</span> edx, edx<font></font>
  lea rcx, QWORD PTR sum$[rsp]<font></font>
  call <span class="hljs-built_in">memset</span>
; Line <span class="hljs-number">356</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが完全な順序であり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">が実行され、それによってRAM内の重要なデータが上書きされますが、これまでのところ喜ばれていません。</font><font style="vertical-align: inherit;">最適化されたリリースバージョンのアセンブラーリストを検討します。</font></font><br>
<br>
<pre><code class="cpp hljs">; <span class="hljs-number">354</span>  :<font></font>
; <span class="hljs-number">355</span>  :  <span class="hljs-built_in">memset</span>( sum, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>( sum ) );<font></font>
; <span class="hljs-number">356</span>  :}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リストからわかるように、コンパイラーは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出しを無視しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、</font><i><font style="vertical-align: inherit;">memset</font></i><font style="vertical-align: inherit;">を呼び出した後</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sha1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数</font><font style="vertical-align: inherit;">が</font><i><font style="vertical-align: inherit;">ctx</font></i><font style="vertical-align: inherit;">構造体</font><font style="vertical-align: inherit;">を呼び出さ</font><font style="vertical-align: inherit;">なくなった</font><font style="vertical-align: inherit;">ため</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">そのため、コンパイラーは、将来、未使用のメモリーを上書きしてプロセッサー時間を浪費するポイントを認識しません。</font><font style="vertical-align: inherit;">あなたは使用してこの問題を解決することができ</font><i><font style="vertical-align: inherit;">RtlSecureZeroMemory</font></i><font style="vertical-align: inherit;">機能</font><font style="vertical-align: inherit;">または</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">類似しました</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
正しく：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sha1</span><span class="hljs-params">( <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *input, <span class="hljs-keyword">int</span> ilen, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> output[<span class="hljs-number">20</span>] )</span>
</span>{<font></font>
  sha1_context ctx;<font></font>
<font></font>
  sha1_starts( &amp;ctx );<font></font>
  sha1_update( &amp;ctx, input, ilen );<font></font>
  sha1_finish( &amp;ctx, output );<font></font>
<font></font>
  RtlSecureZeroMemory(&amp;ctx, <span class="hljs-keyword">sizeof</span>( sha1_context ) );<font></font>
} </code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要な比較</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> u32 <span class="hljs-title">sceAudioOutputPannedBlocking</span>
             <span class="hljs-params">(u32 chan, <span class="hljs-keyword">int</span> leftvol, <span class="hljs-keyword">int</span> rightvol, u32 samplePtr)</span> </span>{
  <span class="hljs-keyword">int</span> result = <span class="hljs-number">0</span>;
  <span class="hljs-comment">// For some reason, this is the only one that checks for negative.</span>
  <span class="hljs-keyword">if</span> (leftvol &gt; <span class="hljs-number">0xFFFF</span> || rightvol &gt; <span class="hljs-number">0xFFFF</span> || leftvol &lt; <span class="hljs-number">0</span> || rightvol &lt; <span class="hljs-number">0</span>) {<font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (leftvol &gt;= <span class="hljs-number">0</span>) {<font></font>
      chans[chan].leftVolume = leftvol;<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (rightvol &gt;= <span class="hljs-number">0</span>) {<font></font>
      chans[chan].rightVolume = rightvol;<font></font>
    }<font></font>
    chans[chan].sampleAddress = samplePtr;<font></font>
    result = __AudioEnqueue(chans[chan], chan, <span class="hljs-literal">true</span>);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;">式「leftvol&gt; = 0」は常にtrueです。 sceAudio.cpp 120 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elseブランチに注意してください</font><font style="vertical-align: inherit;">。コードは、すべての条件が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">残っている</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合にのみ実行されます</font><i><font style="vertical-align: inherit;">vol&gt; 0xFFFF || rightvol&gt; 0xFFFF || leftvol &lt;0 || rightvol &lt;0</font></i><font style="vertical-align: inherit;">はfalseになります。したがって、elseブランチに当てはまる次のステートメントを取得します：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leftvol &lt;= 0xFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rightvol &lt;= 0xFFFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leftvol&gt; = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rightvol&gt; = 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。最後の2つのステートメントに注意してください。このコードの実行に必要な条件を確認することは理にかなっていますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、これらの条件ステートメントを穏やかに削除できます。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> u32 <span class="hljs-title">sceAudioOutputPannedBlocking</span>
<span class="hljs-params">(u32 chan, <span class="hljs-keyword">int</span> leftvol, <span class="hljs-keyword">int</span> rightvol, u32 samplePtr)</span> </span>{
  <span class="hljs-keyword">int</span> result = <span class="hljs-number">0</span>;
  <span class="hljs-comment">// For some reason, this is the only one that checks for negative.</span>
  <span class="hljs-keyword">if</span> (leftvol &gt; <span class="hljs-number">0xFFFF</span> || rightvol &gt; <span class="hljs-number">0xFFFF</span> || leftvol &lt; <span class="hljs-number">0</span> || rightvol &lt; <span class="hljs-number">0</span>) {<font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    chans[chan].leftVolume = leftvol;<font></font>
    chans[chan].rightVolume = rightvol;<font></font>
<font></font>
    chans[chan].sampleAddress = samplePtr;<font></font>
    result = __AudioEnqueue(chans[chan], chan, <span class="hljs-literal">true</span>);<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のシナリオ。</font><font style="vertical-align: inherit;">これらの冗長な状態の背後には、なんらかのエラーがあります。</font><font style="vertical-align: inherit;">おそらく彼らは必要なものをチェックしなかったでしょう。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + C Ctrl + V取り消し</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> u32 <span class="hljs-title">scePsmfSetPsmf</span><span class="hljs-params">(u32 psmfStruct, u32 psmfData)</span> </span>{
  <span class="hljs-keyword">if</span> (!Memory::IsValidAddress(psmfData) ||<font></font>
      !Memory::IsValidAddress(psmfData)) {<font></font>
    <span class="hljs-keyword">return</span> hleReportError(ME, SCE_KERNEL_ERROR_ILLEGAL_ADDRESS, <span class="hljs-string">"bad address"</span>);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '||'の左側と右側に同一のサブ式 '！Memory :: IsValidAddress（psmfData）'があります </font><font style="vertical-align: inherit;">オペレーター。</font><font style="vertical-align: inherit;">scePsmf.cpp 703 </font><i><font style="vertical-align: inherit;">場合</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
は、内部のチェックに注意してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">アドレス</font><i><font style="vertical-align: inherit;">psmfDataが2倍</font></i><font style="vertical-align: inherit;">有効かどうかを確認するのは</font><i><font style="vertical-align: inherit;">おかしなことでは</font></i><font style="vertical-align: inherit;">ないでしょうか </font><font style="vertical-align: inherit;">だから私には奇妙に思われます...実際、私たちはもちろんタイプミスを持っています、そしてその考えは両方の入力パラメーターをチェックすることでした。</font><font style="vertical-align: inherit;">
正しいオプション：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> u32 <span class="hljs-title">scePsmfSetPsmf</span><span class="hljs-params">(u32 psmfStruct, u32 psmfData)</span> </span>{
  <span class="hljs-keyword">if</span> (!Memory::IsValidAddress(psmfStruct) ||<font></font>
      !Memory::IsValidAddress(psmfData)) {<font></font>
    <span class="hljs-keyword">return</span> hleReportError(ME, SCE_KERNEL_ERROR_ILLEGAL_ADDRESS, <span class="hljs-string">"bad address"</span>);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忘れられた変数</font></font></h3><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ud_translate_att</span><span class="hljs-params">(
  <span class="hljs-keyword">int</span> size = <span class="hljs-number">0</span>;
  ....
  <span class="hljs-keyword">if</span> (size == <span class="hljs-number">8</span>) {
    ud_asmprintf(u, <span class="hljs-string">"b"</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (size == <span class="hljs-number">16</span>) {
    ud_asmprintf(u, <span class="hljs-string">"w"</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (size == <span class="hljs-number">64</span>) {
    ud_asmprintf(u, <span class="hljs-string">"q"</span>);
  }
  ....
}</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PVS-Studioの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;">式 'size == 8'は常にfalseです。 syn-att.c 195 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このエラーは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダー</font><font style="vertical-align: inherit;">にあるため、プロジェクトにはあまり当てはまりませんが、注意を引く前にエラーが見つかったため、そのままにすることにしました。それでも、この記事はエラーのレビューではなく、Travis CIとの統合に関するものであり、アナライザーの構成は行われていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変数の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズは</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定数で初期化されますが、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifステートメント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まではコードでまったく使用されません。</font><font style="vertical-align: inherit;">もちろん、</font><font style="vertical-align: inherit;">条件のチェック時に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falseを</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返し</font><font style="vertical-align: inherit;">ます。これは</font><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がゼロであるためです。その後のチェックも意味がありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやら、コードフラグメントの作成者は、</font><font style="vertical-align: inherit;">この前に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイズ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を上書きすることを忘れていました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">やめる</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これについては、おそらく、エラーが発生します。</font><font style="vertical-align: inherit;">この記事の目的は、Travis CIと組み合わせたPVS-Studioの動作を示すことであり、プロジェクトを可能な限り徹底的に分析することではありません。</font><font style="vertical-align: inherit;">あなたがますます美しい間違いをしたいなら、いつ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でもここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それらを賞賛することができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;"> :)。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webサービスを使用してプロジェクトをビルドし、インクリメンタル分析を行うことで、コードのマージ直後に多くの問題を検出できます。</font><font style="vertical-align: inherit;">確かに、単一のアセンブリでは不十分な場合があるため、静的解析と組み合わせてテストを設定すると、コードの品質が大幅に向上します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">役立つリンク</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LinuxおよびmacOSでのPVS-Studioの実行</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DockerでのPVS-Studioの実行</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travis CIドキュメント</font></font></a></li>
</ul><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Maxim Zvyagintsev。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSPゲームコンソールエミュレーターの例を使用して、Travis CIでPVS-Studioをセットアップする方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja464631/index.html">ウォルマートは、ソーラーシティのソーラーパネルによるいくつかの火災後にテスラを訴えます</a></li>
<li><a href="../ja464635/index.html">ビゼルバVS MES。メーカーは何に投資すべきですか？</a></li>
<li><a href="../ja464637/index.html">UseData Conf 2019カンファレンスでは何が起こりますか？</a></li>
<li><a href="../ja464639/index.html">回復のための時間を自分に与える-これは心理的安定の鍵です</a></li>
<li><a href="../ja464643/index.html">シングルスキャンではない、または9つのステップで脆弱性管理プロセスを構築する方法</a></li>
<li><a href="../ja464649/index.html">Zimbra Open-Source Editionのドキュメントコラボレーションシステム</a></li>
<li><a href="../ja464651/index.html">AVRマイクロコントローラー用のアセンブラーコードジェネレーターライブラリ。パート5</a></li>
<li><a href="../ja464655/index.html">プログラミング言語の給与と人気は過去2年間でどのように変化したか</a></li>
<li><a href="../ja464657/index.html">電気コーニスAM82TVのリバースエンジニアリング</a></li>
<li><a href="../ja464659/index.html">アプリケーションのセキュリティ、またはカスタム開発にセキュリティを組み込む方法。AGIMAでの個人的な経験</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>