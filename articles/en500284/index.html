<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòæ üßúüèø üëä OS "Sivelkiriya": an example of building a program ü•° üîµ üöá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr. 
 
 This post continues the cycle of publications about the Sivelkiriya OS project. The first article of the cycle gave a general descrip...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>OS "Sivelkiriya": an example of building a program</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500284/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This post continues the cycle of publications about the Sivelkiriya OS project. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first article of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cycle gave a general description of the concept, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the second</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> explained why it was needed and in what form the product could see the light, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the third</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> described architectural solutions, and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the fourth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> answered the question of how to coordinate the actions of OS developers and Software in this model. This article will show an example of splitting a simple program into modules in order to fit it into the realities of the new OS.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider a classic example: a program that allows you to open a file containing a bitmap image and view it on the screen. The image can be scaled, and if its size at the current scale exceeds the screen size, scroll. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In modern operating systems, this problem is often solved by an application with a closed architecture, that is, one that either itself contains all the required code, or uses third-party components purely on its own initiative. The key point is that you cannot use part of the application - you can either start it as is or use another solution.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to understand how this problem is solved within the framework of the Sivelkiriya OS, you will first have to look ‚Äúunder the hood‚Äù of this program and understand what it does and what concepts it operates with. </font><font style="vertical-align: inherit;">The following are the entities that arise during the operation of the program.</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The location of the image.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the classic case, it is described by the path to the file on disk. With a little broader consideration, addresses in the local network or on the Internet also fall into this category. This, however, does not exhaust all the possibilities: the image can be located in the RAM, at the output of some program (for example, a photo processor or a graphics renderer), on a web page, in a chat or email message, inside an archive or office document. Despite the fact that technically all of these options are different from each other and require different processing, from the point of view of the user they all serve one purpose: they indicate where the image that he wants to view is located. Creating an interface that allows you to choose among so many options is a non-trivial task, but conceptually there are no obstacles to this approach.Moreover: there is no reason why the user should not be given the opportunity to view the image located in any of the above locations.</font></font></li>
<li><b> ,   .</b>         ,     ,         ,    .</li>
<li><b>  .</b>   , , jpeg  gif.      :   jpeg      .gif,     gif       .    ,       , ,      ,  web-.</li>
<li><b></b>,       (    )    .</li>
<li><b>       .</b>  ,   tiff,        .  ‚Äî , gif ‚Äî   .</li>
<li><b></b>  <b></b>.</li>
<li><b> </b> :  ,  , ,  .</li>
<li><b> </b>    .</li>
<li><b></b> (  ) <b> </b>,    .</li>
<li><b></b> (    ),      .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Within the Sivelkiriya OS, each of the entities listed above is described by a certain data interface. Such a representation allows their use in many contexts outside the original model (which will be discussed later). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Each interface is implemented by some object, which is created by some module. The code of the object's methods is executed within the framework of the module that generated it. At the same time, it is incorrect to talk about launching modules as separate applications, since they have neither their own threads, nor memory outside the objects created by them. If you need to store a state that goes beyond working with a single image, it is stored in a separate object, access to which is carried out according to general rules - through the OS object interface.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The structure of the modules involved in the work of this program may look like this:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first module defines the behavior of an object that implements the ‚ÄúObject location‚Äù interface (an image is a special case of an object). </font><font style="vertical-align: inherit;">In particular, it determines how to access bytes from a given location. </font><font style="vertical-align: inherit;">However, he can use modules that provide direct access to the disk or network support, depending on the physical location of the object.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second module provides direct access to image bytes. </font><font style="vertical-align: inherit;">In addition, it provides hints about the possible type of content based on the storage method (file extension, web server headers, etc.).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The third module, using hints about the type of content and access to its byte representation, determines the actual type of content (image file format).</font></font></li>
<li>   ,     (    , , )   ( )     .      ,    : ,         .      ‚Äî        :    jpeg     .</li>
<li>       ,  ,   ,    ,         .      ‚Äî     ‚Äî   ,      ,     .</li>
<li>,      .     ,         .           ‚Äî ,       ,   ,       , ,   ,  ,     .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, in addition to the described modules, the program can take part in modules that provide additional features: logging, rendering of window components, audio feedback, and so on.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is easy to see that such a structure makes reusing implemented functionality as simple as possible. </font><font style="vertical-align: inherit;">So, installing a new codec in the system means that this type of image will be automatically supported in all contexts and in all programs. </font><font style="vertical-align: inherit;">Different modules can be written by different programmers and in different languages, however, in the framework of this interaction model, these differences are not significant. </font><font style="vertical-align: inherit;">One and the same codec can be used both for loading images onto a screen in this interface, and for rendering them in a messaging program, browser, directory contents viewer, and so on.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Support for new use cases is carried out elementarily. For example, adding a few additional interfaces allows you to support actions such as moving to the next and previous images (regardless of their location and how to access them) or applying filters. The introduction of a thin client is also not a problem: since the passage of data and calls through the borders of the module is controlled by the operating system, it is possible to transfer costly operations (for example, decoding the contents of a file and scaling an image) to another machine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since the prototypes of all the modules described above are known to the operating system, it knows about their needs from a system point of view and can act accordingly. For example, the image scaling operation can be performed in a separate thread so that work with large images does not block the interface on low-end computers. Moreover, since the modules do not make assumptions about the threads in which they are executed, additional optimizations are possible: for example, the user interface thread can be separated from the thread responsible for computing (in this case, scaling), only if the latter I didn‚Äôt have time to finish the work within a predetermined period of time, and with a quick re-scale, drawing the image at a new scale can be started in an additional stream even beforeas a thread engaged in rendering, which no longer needs to be completed, it will manage to process the signal to completion. Since the operating system has information about all running threads, about the loading and actual capabilities of the computer's processors, the optimization data can be more effective than those that the author of a separate application can do based on assumptions about its execution environment.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The question of how the modules that jointly provide a solution to an applied problem are linked together can be solved in several ways. For example, it is obvious that the choice of a module that reads bytes of a file from disk is determined by the file system of this section, and in all cases of access to the same section, the same module will be used. The module responsible for determining the image format is likely to be installed at the system level and used in all contexts. An exception may be cases when a module fails: in this case, the operating system can search for another installed module that matches this prototype, and if it exists, try to use it with the same input data. In this way,the error can be processed without user intervention, and data about it is collected and, if allowed by the security policies of this machine, passed to the developers of the problem module along with the necessary related information. If a module often has problems, the operating system may decide to exclude it from the search chain or lower its priority in it.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In other cases, the choice of module can be user-defined and stored in the configuration. So, different image scaling modules can provide a different rendering style (anti-aliasing parameters when zooming out or blurring the borders of pixels when it increases). Depending on the context, the user may need a different approach (sharp pixel borders for precise positioning or blurry for visual comfort).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Methods for starting modules may also vary. For example, the module responsible for rendering the image viewer window can be called up by the module responsible for rendering the desktop (by clicking on the graphic file on the desktop), or by the module that displays the program launch menu. After starting, the window module loads those modules that it needs to complete the current task. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This description is only a demonstration of the fundamental possibility of implementing such an interaction scheme and cannot be considered as a complete instruction for writing an image viewer, operating system and / or modules for it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Previous articles in the series are available here: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">three</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">four</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The full text, as before, is available </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the project website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500272/index.html">Why do we need DevOps in the field of ML data</a></li>
<li><a href="../en500276/index.html">The digest of fresh materials from the world of the front-end for the last week No. 413 (April 27 - May 3, 2020)</a></li>
<li><a href="../en500278/index.html">Go through the eyes of a Rust programmer: first impressions</a></li>
<li><a href="../en500280/index.html">Credential distribution model of rights in FreeBSD v.2.0</a></li>
<li><a href="../en500282/index.html">How to measure and evaluate developer productivity</a></li>
<li><a href="../en500286/index.html">Mein linux</a></li>
<li><a href="../en500288/index.html">Beginners in the stock market: honest talk about trading</a></li>
<li><a href="../en500290/index.html">Selection and CSS</a></li>
<li><a href="../en500292/index.html">A simple approach to working with responsive images</a></li>
<li><a href="../en500294/index.html">5 Free Web Developer Productivity Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>