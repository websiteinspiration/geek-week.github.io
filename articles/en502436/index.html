<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèáüèø üëÉ ü§Ø CI TeamCity - Automation of build processes of Android and UI testing üñçÔ∏è üßëüèø‚Äçü§ù‚Äçüßëüèæ üíä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I bring to your attention instructions for installing and configuring TeamCity to automate the assembly and testing of Android projec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CI TeamCity - Automation of build processes of Android and UI testing</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502436/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article, I bring to your attention instructions for installing and configuring TeamCity to automate the assembly and testing of Android projects under Windows. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I will also pay attention to the features of setting up the environment for the Android project (which I found in the research process) and various kinds of things that can help make life easier for the novice tester and developer.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objectives:</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When updating the project code, the following should occur:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auto build project</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run UI Autotests</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exporting debug and release APK files for subsequent manual testing</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notify all development team members of the results</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plan:</font></font></h4><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install and configure the Java JDK</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install and configure Android SDK</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting a separate gradle for debug</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparing an Android project</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install TeamCity Server and Build Agent</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting up TeamCity Project ‚Üí Build for the project build and getting the installation APK</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure build steps with UI autotests</font></font></li>
</ol><a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Main part </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installing and Configuring Java JDK</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Contrary to popular belief about installing the latest version of Java, JetBrains on its official website publishes the recommended version of the Java SDK: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Installs the recommended version: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Also install Environment Variables:</font></font><br>
<br>
<ul>
<li><code>JAVA_HOME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- path to the folder with SKD Java for using CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>C:\Java\jdk1.8.0_181</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Better to put in System variables.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Path - path to the folder with Java SKD for use from the command line. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>C:\Java\jdk1.8.0_181\bin</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Better to put in User variables.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We check the installation: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the CMD in any directory we enter: </font></font><code> java -version </code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Java should answer that it is: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jr/sr/6f/jrsr6flrr8_x5nphn3pyeh4spwk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install and configure the Android SDK</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
We will not install the Android SDK tools separately. Android has forbidden to create projects from the command line. It will also be more convenient to debug possible errors if we immediately install Android Studio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install the latest version: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Also install Environment Variables: </font></font><br>
<br>
<code>ANDROID_HOME</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><code>C:\Users\1\AppData\Local\Android\Sdk</code><br>
<br>
<code>ANDROID_AVD_HOME</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><code>C:\Users\1\.android\avd</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Path: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><code>C:\Users\1\AppData\Local\Android\Sdk\platform-tools\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- launch the utilities from the console by us and CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Check: type in CMD: </font></font><code>adb --help</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Get information on the current version and available commands: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dh/ax/nl/dhaxnlpo3zycmxk39upb7vdmht4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Path: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example:</font></font><code> C:\Users\1\AppData\Local\Android\Sdk\emulator\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- start the emulator from the console by us and CI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Check: we type in CMD </font></font><code>emulator -version</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We get information on the current version: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qn/dn/jt/qndnjtqddivhsoab-x4thjvng1c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle installation Gradle</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
is included in Android Studio, but we will put another one for debug from the console. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The version is not important, because it is assumed that the project will be launched through the Gradle wrapper. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I suggest installing a version similar to that used in the project, for example Gradle 3.3. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also install Environment Variables: </font></font><br>
<br>
<code>GRADLE_HOME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- there is no need, because CI will use Gradle Android Studio. </font></font><br>
<br>
<code>GRADLE_USER_HOME</code> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><code>c:/gradle-cache</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actual for Windows Server, as without it, during the assembly of the project, all the downloaded Gradle libraries will be stored in</font></font><code>C:\Windows\System32\config\systemprofile\.gradle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">further CI will not be able to access these files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Path: </font></font><br>
<br>
<code>C:\Gradle\gradle-3.3\bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the path to the Gradle folder for convenient use from the command line. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Check: we type in CMD </font></font><code>gradle -v</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We receive information on the current version: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5d/oz/sz/5dozszxuoyliwdu4cc7kbsqks5m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparation of the Android project</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
4.1. Create a test project in Android Studio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Type Activity - Bottom Navigation Activity. It will come in handy later for creating a UI test. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.2. Disable Gradle Daemon on an ongoing basis so that Gradle Daemon does not spawn in CI: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add in file </font></font><code>gradle.properties:</code><br>
<code>add org.gradle.daemon=false</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.3. We also add to the file </font></font><code>.gitignore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(to your taste) </font><font style="vertical-align: inherit;">
so that extra files are not left in VCS. </font><font style="vertical-align: inherit;">
4.4. Create a keystore (or use an existing one) in the project folder. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Link</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<code>.gradle<br>
.idea<br>
/build/<br>
local.properties</code><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.5. Add links to the keystore to Gradle so that we can build a full-fledged APK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example:</font></font><br>
<br>
<pre><code class="plaintext hljs">android{  <font></font>
    ... //  <font></font>
    signingConfigs {<font></font>
        release {<font></font>
            storeFile file("keystorefile.jks") //        <font></font>
            storePassword "Password" //  <font></font>
            keyAlias "android" // keyAlias,     <font></font>
            keyPassword "Password" //  APK<font></font>
        }<font></font>
    }<font></font>
<font></font>
    ... //  <font></font>
     buildTypes {<font></font>
        release {<font></font>
            ... //  <font></font>
            signingConfig signingConfigs.release //  APK<font></font>
        }<font></font>
    }<font></font>
} </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.6. To test the health of the system, we will assemble a new project from the command line. Enter in CMD: </font></font><br>
<br>
<code>cd &lt;  &gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example: </font></font><code>C:\Users\1\Documents\GitHub\Command2</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go to the project. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enter: We are </font></font><br>
<br>
<code>gradlew assembleDebug</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
waiting for the completion of the assembly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If all is well, then we get the result BUILD SUCCESSFUL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/dr/x7/ufdrx77tmdj5e1xlin8depxema0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We go to the project folder: </font></font><code>app\build\outputs\apk\debug</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It contains a fresh APK file that can be installed on the device and check if everything works. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7. We will also check whether the SDK tools and AVD manager are launched. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.1. Launch Android Studio and create an emulator. You can, of course, create it on the command line, but we have the installed UI shell, it‚Äôs a sin not to use it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tools ‚Üí AVD Manager: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ib/k7/k5/ibk7k5w33zp2jh4rxcts51ioifu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The SDK version of the emulator created must be at least as large as our SDK project.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.2. Created an emulator. Let's check its launch from the console. We enter at the command line: </font></font><br>
<br>
<code>start /min emulator -avd &lt; &gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>start /min emulator -avd Pixel_2_API_25</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Note that we use a function </font></font><code>/min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to start the emulator in the background. Otherwise, he would not have allowed to enter new commands in the CMD. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The device is running: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wj/go/ia/wjgoiap9s77ujejq-pn_fahputw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.3. We check the installation of the collected APK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We enter in the CMD: </font></font><br>
<br>
<code>adb install &lt;path_to_apk&gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>adb install C:\Users\1\Documents\GitHub\Command2\app\release\app-release.apk</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Successfully: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-l/gf/ze/-lgfze9zuuhlvlzlecbgp9clwue.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.4. We check the launch of the installed APK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We enter in the CMD: </font></font><br>
<br>
<code>adb shell monkey -p &lt;     &gt; -c android.intent.category.LAUNCHER 1</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: The </font></font><br>
<br>
<code>adb shell monkey -p com.panarik.command -c android.intent.category.LAUNCHER 1</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
application started: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kc/dl/pu/kcdlpuz9f0bc16c5dulf14rsyd4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4.7.5. We upload the project to a remote repository, for example, to GitHub. Check if the project will be downloaded: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install Git BASH (if we use Git VCS). </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We clone the project from a remote repo. Enter in the console Git BASH: </font></font><br>
<br>
<code>git clone &lt;  .git&gt;</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>git clone https://github.com/panarik/Command2.git</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We see the result. The project was copied to a local folder: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2m/mc/3u/2mmc3upb1vs0_rurcfes7yeyrai.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is ready to install and configure TeamCity. Why are we doing exercises with the command line, and not immediately installing TeamCity. It will be much more convenient to make sure in advance that the project is working, so that later it will be easier to localize possible bugs at the build stage in TeamCity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installing TeamCity Server and Build Agent</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
I will not describe the installation process in detail. He is in the official guide and many other sources. TeamCity server port I propose to set non-standard, so that it is more difficult to calculate port scans. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring TeamCity Project ‚Üí Build</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general settings, you just need to set the path to the APK output: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>app\build\outputs\apk\release\app-release.apk</code><br>
<br>
<img src="https://habrastorage.org/webt/4o/ca/_0/4oca_0ess7vbx4awyid4q7ldv3a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.1. Setting up TeamCity VCS Roots </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything is standard. In our project, we use Git, so we enter it and a link to the remote repo. Example: </font></font><br>
<br>
<code>https://github.com/panarik/Command2.git</code><br>
<br>
<img src="https://habrastorage.org/webt/ko/p9/d1/kop9d17wvkt7gwcgxxpuaoglio0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6.2. TeamCity Build Configuration </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add a Build Step, which will compile the project and display the APK. In our project we use Gradle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enter in the field Gradle tasks: </font></font><br>
<br>
<code>clean build assembleDebug --no-daemon</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(--no-daemon just in case, and this should work as a subscript to the file that we did in section 4.2) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/za/wt/cm/zawtcmqdtqqsvpwjzpn_4e0bwvc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Click Run, we get the APK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuring build steps with UI autotests We</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
got to the most interesting part, namely, the automatic launch of UI tests.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Steps will be launched using .BAT files. It‚Äôs much more convenient to write code, change it on the fly without having to go into TeamCity UI, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.1. First, create a build step with the emulator running. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can make the URL to the BATnik completely, for convenience, I made the Environment in TeamCity </font></font><code>BAT_FILES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the path to the folder with the BATs: we </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/mz/hx/hmmzhx2i5rdyb3eafa3gyczn1ue.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
write the emulator start code in the file. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example: </font></font><br>
<br>
<code>start /min "emulator" /D "C:\Users\1\AppData\Local\Android\Sdk\emulator" emulator.exe -avd Pixel_2_API_25 -no-snapshot-save -no-boot-anim</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
List of commands and parameters on an off site: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.2. Create a build step with a pause while the emulator loads. You can immediately register the first step in .BAT, but it will be more clear. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example of such a team that has spied on the Internet: </font></font><br>
<br>
<code>adb wait-for-device shell 'while [[ -z $(getprop sys.boot_completed) ]]; do sleep 1; done; input keyevent 82'</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the UI it will look like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/uh/0r/pouh0rl3u3g9kfwxyu1h5dcpbxy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
List of all the teams on the off site: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.3. </font><font style="vertical-align: inherit;">Run the test. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also from the command line. </font><font style="vertical-align: inherit;">Everything is individual here. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example command: </font></font><br>
<br>
<code>gradlew connectedDebugAndroidTest</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7.4. </font><font style="vertical-align: inherit;">We stop the emulator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example command: </font></font><br>
<br>
<code>adb -s emulator-5554 emu kill</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Process completed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can also upload the report in a separate step. </font><font style="vertical-align: inherit;">By default, it is saved in the project folder. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you very much for your attention! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If anyone has advice on improving the code for steps, and suggestions for improvement, I will be very grateful.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502420/index.html">Interesting CSS Finds in Twitter Design</a></li>
<li><a href="../en502422/index.html">60% reduction in React Native application size in a few simple steps</a></li>
<li><a href="../en502424/index.html">Stop importing whole JavaScript packages</a></li>
<li><a href="../en502428/index.html">Syntactic Goodies Julia</a></li>
<li><a href="../en502432/index.html">The digest of fresh materials from the world of the front-end for the last week No. 415 (May 11-17, 2020)</a></li>
<li><a href="../en502438/index.html">Material Python. Custom cards with OpenGL effects</a></li>
<li><a href="../en502440/index.html">Building Applications with Mediapipe</a></li>
<li><a href="../en502442/index.html">PHP Digest No. 180 (May 4 - 18, 2020)</a></li>
<li><a href="../en502448/index.html">IBM Weekly Seminars - May 2020</a></li>
<li><a href="../en502450/index.html">Moderation of comments 2. And yet, can we trust users? (continued)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>