<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüî¨ üëí üëµüèΩ Programaci√≥n asincr√≥nica elegante con promesas. ‚ò∏Ô∏è üïµüèø ‚è±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Buen dia amigos! 
 
 Las promesas (promesas) son una caracter√≠stica relativamente nueva de JavaScript que le permite retrasar la ejecuci√≥n de una acc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Programaci√≥n asincr√≥nica elegante con promesas.</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488762/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Buen dia amigos! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las promesas (promesas) son una caracter√≠stica relativamente nueva de JavaScript que le permite retrasar la ejecuci√≥n de una acci√≥n hasta la finalizaci√≥n de la acci√≥n anterior o responder a la ejecuci√≥n fallida de la acci√≥n. </font><font style="vertical-align: inherit;">Esto contribuye a la correcta determinaci√≥n de la secuencia de operaciones asincr√≥nicas. </font><font style="vertical-align: inherit;">Este art√≠culo analiza c√≥mo funcionan las promesas, c√≥mo se usan en la API web y c√≥mo puede escribir su propia promesa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Condiciones: conocimientos b√°sicos de inform√°tica, conocimiento de los conceptos b√°sicos de JS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Objetivo: comprender qu√© son las promesas y c√≥mo se usan.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© son las promesas?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Revisamos brevemente las </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">promesas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el primer art√≠culo del curso, aqu√≠ las consideraremos con m√°s detalle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esencia, una promesa es un objeto que representa un estado intermedio de una operaci√≥n: "promete" que el resultado se devolver√° en el futuro. No se sabe exactamente cu√°ndo se completar√° la operaci√≥n y cu√°ndo se devolver√° el resultado, pero hay una garant√≠a de que cuando se complete la operaci√≥n, su c√≥digo har√° algo con el resultado o manejar√° el error con gracia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como regla, cu√°nto tiempo lleva una operaci√≥n asincr√≥nica (¬°no demasiado!) Nos interesa menos que la posibilidad de una respuesta inmediata a su finalizaci√≥n. Y, por supuesto, es bueno saber que el resto del c√≥digo no est√° bloqueado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las promesas m√°s comunes son las API web que devuelven promesas. Veamos una hipot√©tica aplicaci√≥n de video chat. La aplicaci√≥n tiene una ventana con una lista de amigos del usuario, al hacer clic en el bot√≥n junto al nombre (o avatar) del usuario se inicia una videollamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El manejador de botones llama a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUserMedia ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para acceder a la c√°mara y el micr√≥fono del usuario. Desde el momento en que getUserMedia () contacta al usuario para obtener permiso (para usar dispositivos, qu√© dispositivo usar si el usuario tiene varios micr√≥fonos o c√°maras, solo una llamada de voz, entre otras cosas), getUserMedia () espera no solo la decisi√≥n del usuario, sino tambi√©n liberar dispositivos si est√°n actualmente en uso. Adem√°s, el usuario puede no responder de inmediato. Todo esto puede conducir a grandes retrasos en el tiempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se realiza una solicitud de permiso para usar dispositivos desde el hilo principal, el navegador se bloquea hasta que se complete getUserMedia (). Es inaceptable Sin promesas, todo en el navegador se vuelve "no clicable" hasta que el usuario da permiso para usar el micr√≥fono y la c√°mara. Por lo tanto, en lugar de esperar la decisi√≥n de un usuario y devolver un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MediaStream</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para una secuencia creada a partir de fuentes (c√°mara y micr√≥fono), getUserMedia () devuelve la promesa de que MediaStream procesa tan pronto como est√© disponible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo de la aplicaci√≥n de video chat podr√≠a verse as√≠:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span> <span class="hljs-title">CallButton</span>(<span class="hljs-params">evt</span>)</span>{<font></font>
    setStatusMessage(<span class="hljs-string">'Calling...'</span>)<font></font>
    navigator.mediaDevices.getUserMedia({<span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>})<font></font>
    .then(<span class="hljs-function"><span class="hljs-params">chatStream</span> =&gt;</span> {<font></font>
        selfViewElem.srcObject = chatStream<font></font>
        chatStream.getTracks().forEach(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> myPeerConnection.addTrack(track, chatStream))<font></font>
        setStatusMessage(<span class="hljs-string">'Connected'</span>)<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {<font></font>
        setStatusMessage(<span class="hljs-string">'Failed to connect'</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La funci√≥n comienza llamando a setStatusMessage (), mostrando el mensaje 'Llamando ...', que sirve como indicador de que se est√° intentando hacer una llamada. Luego se llama a getUserMedia (), solicitando una secuencia que contiene pistas de video y audio. Una vez que se forma la transmisi√≥n, se instala un elemento de video para mostrar la transmisi√≥n desde la c√°mara llamada 'vista propia', las pistas de audio se agregan a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTCPeerConnection</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que es una conexi√≥n a otro usuario. Despu√©s de eso, el estado se actualiza a 'Conectado'. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si getUserMedia () falla, se inicia el bloque catch. Utiliza setStatusMessage () para mostrar un mensaje de error.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que la llamada a getUserMedia () se devuelve incluso si la transmisi√≥n de video a√∫n no se ha recibido. </font><font style="vertical-align: inherit;">Incluso si la funci√≥n handleCallButton () devolvi√≥ el control al c√≥digo que lo llam√≥, tan pronto como getUserMedia () completara la ejecuci√≥n, llamar√≠a al controlador. </font><font style="vertical-align: inherit;">Hasta que la aplicaci√≥n "entienda" que la transmisi√≥n ha comenzado, getUserMedia () estar√° en modo de espera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: puede obtener m√°s informaci√≥n al respecto en el art√≠culo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Se√±ales y videollamadas"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este art√≠culo proporciona un c√≥digo m√°s completo que el que usamos en el ejemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema de funciones de devoluci√≥n de llamada</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comprender por qu√© las promesas son una buena soluci√≥n, es √∫til observar la antigua forma de escribir devoluciones de llamada para ver cu√°les eran sus problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ejemplo, considere pedir pizza. </font><font style="vertical-align: inherit;">Un pedido de pizza exitoso consta de varios pasos que se deben realizar en orden, uno tras otro:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elige el relleno. </font><font style="vertical-align: inherit;">Esto puede llevar algo de tiempo si lo piensa durante mucho tiempo, y fracasar√° si cambia de opini√≥n y pide un curry.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacemos un pedido. </font><font style="vertical-align: inherit;">Cocinar pizza lleva algo de tiempo y puede fallar si el restaurante carece de los ingredientes necesarios.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conseguimos pizza y comemos. </font><font style="vertical-align: inherit;">Recibir pizza puede fallar si, por ejemplo, no podemos pagar el pedido.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un pseudoc√≥digo de estilo antiguo que utiliza </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funciones de devoluci√≥n de llamada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podr√≠a tener este aspecto:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{<font></font>
    placeOrder(toppings, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{<font></font>
        collectOrder(order, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
            eatPizza(pizza)<font></font>
        }, failureCallback)<font></font>
    }, failureCallback)<font></font>
}, failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo es dif√≠cil de leer y mantener (a menudo se le llama el "infierno de las devoluciones de llamada" o el "infierno de las devoluciones de llamada"). </font><font style="vertical-align: inherit;">La funci√≥n failureCallback () debe llamarse en cada nivel de anidamiento. </font><font style="vertical-align: inherit;">Hay otros problemas</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usamos promesas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las promesas hacen que el c√≥digo sea m√°s limpio, m√°s f√°cil de entender y apoyar. </font><font style="vertical-align: inherit;">Si reescribimos el pseudoc√≥digo usando promesas asincr√≥nicas, obtenemos lo siguiente:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">toppings</span>)</span>{
    <span class="hljs-keyword">return</span> placeOrder(toppings)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>)</span>{
    <span class="hljs-keyword">return</span> collectOrder(order)<font></font>
})<font></font>
.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>)</span>{<font></font>
    eatPizza(pizza)<font></font>
})<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es mucho mejor: vemos lo que sucede, usamos un bloque .catch () para manejar todos los errores, la funci√≥n no bloquea la transmisi√≥n principal (por lo que podemos jugar videojuegos mientras esperamos pizza), se garantiza que cada operaci√≥n se realizar√° despu√©s de que se complete la anterior. </font><font style="vertical-align: inherit;">Como cada promesa devuelve una promesa, podemos usar la cadena .then. </font><font style="vertical-align: inherit;">Genial, verdad? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando las funciones de flecha, el pseudoc√≥digo puede simplificarse a√∫n m√°s:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span><font></font>
    placeOrder(toppings)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span><font></font>
    collectOrder(order)<font></font>
)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span><font></font>
    eatPizza(pizza)     <font></font>
)<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O incluso as√≠:</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings()<font></font>
.then(<span class="hljs-function"><span class="hljs-params">toppings</span> =&gt;</span> placeOrder(toppings))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> collectOrder(order))<font></font>
.then(<span class="hljs-function"><span class="hljs-params">pizza</span> =&gt;</span> eatPizza(pizza))<font></font>
.catch(failureCallback)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto funciona porque () =&gt; x es id√©ntico a () =&gt; {return x}. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso puede hacer esto (dado que las funciones simplemente pasan par√°metros, no necesitamos capas):</font></font><br>
<br>
<pre><code class="javascript hljs">chooseToppings().then(placeOrder).then(collectOrder).then(eatPizza).catch(failureCallback)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dicho c√≥digo es m√°s dif√≠cil de leer y no puede usarse con construcciones m√°s complejas que en pseudoc√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: el pseudoc√≥digo a√∫n se puede mejorar usando async / await, que se discutir√° en un art√≠culo futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esencia, las promesas son similares a las de los oyentes de eventos, pero con algunas diferencias:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una promesa se cumple solo una vez (√©xito o fracaso). </font><font style="vertical-align: inherit;">No se puede ejecutar dos veces o cambiar de √©xito a fracaso o viceversa despu√©s de que se complete la operaci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si se completa la promesa y agregamos una funci√≥n de devoluci√≥n de llamada para procesar su resultado, se llamar√° a esta funci√≥n, a pesar de que el evento ocurri√≥ antes de que se agregara la funci√≥n.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sintaxis de promesa b√°sica: un ejemplo real</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conocer las promesas es importante porque muchas API web las usan en funciones que realizan tareas potencialmente complejas. Trabajar con tecnolog√≠as web modernas implica el uso de promesas. M√°s adelante aprenderemos c√≥mo escribir nuestras propias promesas, pero por ahora, veamos algunos ejemplos simples que se pueden encontrar en la API web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el primer ejemplo, utilizamos el m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetch ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obtener la imagen de la red, el m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blob ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para convertir el contenido del cuerpo de respuesta en un objeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blob</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y mostrar este objeto dentro del elemento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;img&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este ejemplo es muy similar al ejemplo del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primer art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero lo haremos un poco diferente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota: el siguiente ejemplo no funcionar√° si simplemente lo ejecuta desde un archivo (es decir, usando file: // URL). Debe ejecutarlo a trav√©s de un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor local</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o utilizando soluciones en l√≠nea como </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">p√°ginas de </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. En primer lugar, suba el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que recibiremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Agregue el elemento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al final de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;body&gt;</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Dentro del elemento &lt;script&gt;, agregue la siguiente l√≠nea:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise = fetch(<span class="hljs-string">'coffee.jpg'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo fetch (), que toma la URL de la imagen como par√°metro, se usa para obtener la imagen de la red. Como segundo par√°metro, podemos especificar un objeto con configuraciones, pero por ahora nos limitaremos a una opci√≥n simple. Almacenamos la promesa devuelta por fetch () en la variable de promesa. Como se se√±al√≥ anteriormente, una promesa es un objeto que representa un estado intermedio: el nombre oficial de un estado determinado est√° pendiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Para trabajar con el resultado de la finalizaci√≥n exitosa de la promesa (en nuestro caso, cuando la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respuesta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regresa </font><font style="vertical-align: inherit;">), llamamos al m√©todo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.then ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La funci√≥n de devoluci√≥n de llamada dentro del bloque .then () (a menudo denominado ejecutor) se inicia solo cuando la promesa se completa con √©xito y se devuelve el objeto Respuesta: dicen que la promesa se ha completado (cumplido, cumplido). </font><font style="vertical-align: inherit;">La respuesta se pasa como un par√°metro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">La operaci√≥n del bloque .then () es similar a la operaci√≥n del detector de eventos AddEventListener (). </font><font style="vertical-align: inherit;">Se activa solo despu√©s de que ocurra el evento (despu√©s de cumplir la promesa). </font><font style="vertical-align: inherit;">La diferencia entre los dos es que .then () solo se puede llamar una vez, mientras que el oyente est√° dise√±ado para m√∫ltiples llamadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de recibir la respuesta, llamamos al m√©todo blob () para convertir la respuesta en un objeto Blob. </font><font style="vertical-align: inherit;">Se parece a esto:</font></font><br>
<br>
<pre><code class="javascript hljs">response =&gt; response.blob()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... que es una entrada corta para:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>)</span>{
    <span class="hljs-keyword">return</span> response.blob()<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OK, suficientes palabras. </font><font style="vertical-align: inherit;">Agregue lo siguiente despu√©s de la primera l√≠nea:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise2 = promise.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Cada llamada a .then () crea una nueva promesa. </font><font style="vertical-align: inherit;">Esto es muy √∫til: dado que blob () tambi√©n devuelve una promesa, podemos procesar el objeto Blob llamando a .then () en la segunda promesa. </font><font style="vertical-align: inherit;">Dado que queremos hacer algo m√°s complicado que llamar al m√©todo y devolver el resultado, necesitamos envolver el cuerpo de la funci√≥n entre llaves (de lo contrario, se lanzar√° una excepci√≥n): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue lo siguiente al final del c√≥digo:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> promise3 = promise2.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Completemos el cuerpo de la funci√≥n de ejecuci√≥n. </font><font style="vertical-align: inherit;">Agregue las siguientes l√≠neas a las llaves:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
<span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image.src = objectURL<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ llamamos al m√©todo URL.createObjectURL (), pas√°ndolo como un par√°metro Blob, que devolvi√≥ la segunda promesa. </font><font style="vertical-align: inherit;">Obtenemos un enlace al objeto. </font><font style="vertical-align: inherit;">Luego creamos un elemento &lt;img&gt;, establecemos el atributo src con el valor del enlace del objeto y lo agregamos al DOM para que la imagen aparezca en la p√°gina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si guarda el HTML y lo carga en un navegador, ver√° que la imagen se muestra como se esperaba. </font><font style="vertical-align: inherit;">¬°Gran trabajo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Probablemente haya notado que estos ejemplos son un tanto artificiales. </font><font style="vertical-align: inherit;">Podr√≠a prescindir de los m√©todos fetch () y blob () y asignar la &lt;img&gt; URL correspondiente, coffee.jpg. </font><font style="vertical-align: inherit;">Hicimos este camino para demostrar que trabajamos con promesas con un simple ejemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respuesta a la falla</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Olvidamos algo: no tenemos un controlador de errores en caso de que una de las promesas falle (ser√° rechazada). </font><font style="vertical-align: inherit;">Podemos agregar un controlador de errores utilizando el m√©todo .catch (). </font><font style="vertical-align: inherit;">Vamos a hacer eso:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> errorCase = promise3.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ver esto en acci√≥n, especifique la URL de imagen incorrecta y vuelva a cargar la p√°gina. </font><font style="vertical-align: inherit;">Aparecer√° un mensaje de error en la consola. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, si no agregamos el bloque .catch (), tambi√©n se mostrar√° un mensaje de error en la consola. </font><font style="vertical-align: inherit;">Sin embargo, .catch () nos permite manejar los errores de la manera que queremos. </font><font style="vertical-align: inherit;">En una aplicaci√≥n real, su bloque .catch () puede intentar retomar la imagen o mostrar la imagen predeterminada, o pedirle al usuario que seleccione otra imagen o haga otra cosa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Vea una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demostraci√≥n en vivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fuente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bloque de fusi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, el enfoque que usamos para escribir el c√≥digo no es √≥ptimo. </font><font style="vertical-align: inherit;">Deliberadamente, tomamos este camino para que pueda comprender lo que est√° sucediendo en cada etapa. </font><font style="vertical-align: inherit;">Como se mostr√≥ anteriormente, podemos combinar bloques .then () (y bloques .catch ()). </font><font style="vertical-align: inherit;">Nuestro c√≥digo se puede reescribir de la siguiente manera (tambi√©n vea </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simple-fetch-chained.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en GitHub):</font></font><br>
<br>
<pre><code class="javascript hljs">fetch(<span class="hljs-string">'coffee.jpg'</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.blob())<font></font>
.then(<span class="hljs-function"><span class="hljs-params">myBlob</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> objectURL = URL.createObjectURL(myBlob)
    <span class="hljs-keyword">let</span> image = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
    image.src = objectURL<font></font>
    <span class="hljs-built_in">document</span>.body.appendChild(image)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation: '</span> + e.message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde que el valor devuelto por la promesa se pasa como un par√°metro al siguiente ejecutor de funciones del bloque .then (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Los bloques .then () /. Catch () en las promesas son equivalentes asincr√≥nicos del bloque try ... catch s√≠ncrono. </font><font style="vertical-align: inherit;">Recuerde: prueba sincr√≥nica ... catch no funcionar√° en c√≥digo asincr√≥nico.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promesa Terminolog√≠a Conclusiones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hagamos un balance y escribamos una breve gu√≠a que puede usar en el futuro. </font><font style="vertical-align: inherit;">Para consolidar el conocimiento, le recomendamos que lea la secci√≥n anterior varias veces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Cuando se crea la promesa, dicen que est√° en un estado de expectativa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Cuando se devuelve la promesa, dicen que se complet√≥ (resolvi√≥):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Una promesa completada con √©xito se llama cumplida. </font><font style="vertical-align: inherit;">Devuelve el valor que se puede obtener a trav√©s de la cadena desde .then () al final de la promesa. </font><font style="vertical-align: inherit;">La funci√≥n de ejecuci√≥n en el bloque .then () contiene el valor devuelto por la promesa.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Una promesa cumplida sin √©xito se llama rechazada. </font><font style="vertical-align: inherit;">Devuelve el motivo, el mensaje de error que condujo al rechazo de la promesa. </font><font style="vertical-align: inherit;">Este motivo se puede obtener a trav√©s del bloque .catch () al final de la promesa.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute el c√≥digo despu√©s de varias promesas.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprendimos los conceptos b√°sicos del uso de promesas. Ahora veamos caracter√≠sticas m√°s avanzadas. La cadena de .then () est√° bien, pero ¬øqu√© pasa si queremos llamar a varios bloques de promesas uno por uno? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede hacerlo utilizando el m√©todo est√°ndar Promise.all (). Este m√©todo toma una serie de promesas como par√°metro y devuelve una nueva promesa cuando se cumplen todas las promesas de la matriz. Se ve algo como esto:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([a,b,c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
        ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se cumplen todas las promesas, el ejecutor de matriz del bloque .then () se pasar√° como un par√°metro. Si al menos una de las promesas no se cumple, se rechazar√° todo el bloque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto puede ser muy √∫til. Imagine que recibimos informaci√≥n para llenar din√°micamente la interfaz de usuario con contenido en nuestra p√°gina. En muchos casos, es m√°s razonable recibir toda la informaci√≥n y mostrarla en la p√°gina m√°s tarde que mostrar la informaci√≥n en partes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos otro ejemplo: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Descargue </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una plantilla de p√°gina</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y coloque la etiqueta &lt;script&gt; antes de la etiqueta de cierre &lt;/body&gt;. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Descargue los archivos fuente ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coffee.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tea.jpg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">description.txt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) o reempl√°celos con los suyos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. En el script, primero definimos una funci√≥n que devuelve las promesas que pasamos a Promise.all (). </font><font style="vertical-align: inherit;">Esto ser√° f√°cil de hacer si ejecutamos Promise.all () despu√©s de completar las tres operaciones fetch (). </font><font style="vertical-align: inherit;">Podemos hacer lo siguiente:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> a = fetch(url1)
<span class="hljs-keyword">let</span> b = fetch(url2)
<span class="hljs-keyword">let</span> c = fetch(url3)<font></font>
<font></font>
<span class="hljs-built_in">Promise</span>.all([a, b, c]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
    ...<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se cumple la promesa, la variable "valores" contendr√° tres objetos de respuesta, uno de cada operaci√≥n fetch () completada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, no queremos esto. </font><font style="vertical-align: inherit;">No nos importa cu√°ndo se completan las operaciones fetch (). </font><font style="vertical-align: inherit;">Lo que realmente queremos son los datos cargados. </font><font style="vertical-align: inherit;">Esto significa que queremos ejecutar el bloque Promise.all () despu√©s de recibir un blob v√°lido que representa im√°genes y cadenas de texto v√°lidas. </font><font style="vertical-align: inherit;">Podemos escribir una funci√≥n que haga esto; </font><font style="vertical-align: inherit;">agregue lo siguiente a su elemento &lt;script&gt;:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'There has been a problem with your fetch operation '</span> + e.message)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece un poco complicado, as√≠ que veamos el c√≥digo paso a paso: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. En primer lugar, declaramos una funci√≥n y le pasamos la URL y el tipo del archivo resultante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. La estructura de la funci√≥n es similar a la que vimos en el primer ejemplo: llamamos a la funci√≥n fetch () para obtener el archivo en una URL espec√≠fica y luego transferir el archivo a otra promesa que devuelve el cuerpo de respuesta decodificado (le√≠do). </font><font style="vertical-align: inherit;">En el ejemplo anterior, siempre fue el m√©todo blob (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Hay dos diferencias:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, la segunda promesa de devoluci√≥n depende del tipo de valor. </font><font style="vertical-align: inherit;">Dentro de la funci√≥n de ejecuci√≥n, utilizamos el operador if ... else if para devolver la promesa seg√∫n el tipo de archivo que necesitemos decodificar (en este caso, elegimos entre blob y texto, pero el ejemplo puede extenderse f√°cilmente para trabajar con otros tipos).</font></font></li>
<li>-,     ¬´return¬ª   fetch().       ,     (..   ,  blob()  text(),  ,  ,   ).  ,  return     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Al final, llamamos al m√©todo .catch () para manejar cualquier error que pueda ocurrir en las promesas en la matriz pasada a .all (). Si se rechaza una de las promesas, el bloqueo de captura nos permitir√° saber con qu√© promesa estuvo el problema. El bloque .all () a√∫n se ejecutar√°, pero no mostrar√° los resultados para los que hubo errores. Si desea que se rechace .all (), agregue un bloque .catch () al final. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo dentro de la funci√≥n es as√≠ncrono y se basa en promesas, por lo que toda la funci√≥n funciona como una promesa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Luego, llamamos a nuestra funci√≥n tres veces para comenzar el proceso de recibir y decodificar im√°genes y texto, y poner cada una de las promesas en una variable. Agregue lo siguiente:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> coffee = fetchAndDecode(<span class="hljs-string">'coffee.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> tea = fetchAndDecode(<span class="hljs-string">'tea.jpg'</span>, <span class="hljs-string">'blob'</span>)
<span class="hljs-keyword">let</span> description = fetchAndDecode(<span class="hljs-string">'description.txt'</span>, <span class="hljs-string">'text'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5. Luego, declaramos un bloque Promise.all () para ejecutar alg√∫n c√≥digo solo despu√©s de que se hayan cumplido las tres promesas. </font><font style="vertical-align: inherit;">Agregue un bloque con una funci√≥n ejecutor vac√≠a dentro de .then ():</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">Promise</span>.all([coffee, tea, description]).then(<span class="hljs-function"><span class="hljs-params">values</span> =&gt;</span> {<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver que toma una serie de promesas como par√°metro. </font><font style="vertical-align: inherit;">El contratista comenzar√° solo despu√©s de que se cumplan las tres promesas; </font><font style="vertical-align: inherit;">cuando esto sucede, el resultado de cada promesa (el cuerpo de respuesta decodificado) se colocar√° en una matriz, esto se puede representar como [resultados de caf√©, resultados de t√©, resultados de descripci√≥n]. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6. Finalmente, agregue lo siguiente al ejecutor (aqu√≠ usamos un c√≥digo s√≠ncrono bastante simple para poner los resultados en variables (crear objetos URL desde blob) y mostrar im√°genes y texto en la p√°gina):</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-built_in">console</span>.log(values)
<span class="hljs-comment">//       </span>
<span class="hljs-keyword">let</span> objectURL1 = URL.createObjectURL(values[<span class="hljs-number">0</span>])
<span class="hljs-keyword">let</span> objectURL2 = URL.createObjectURL(values[<span class="hljs-number">1</span>])
<span class="hljs-keyword">let</span> descText = values[<span class="hljs-number">2</span>]<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> image1 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)
<span class="hljs-keyword">let</span> image2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'img'</span>)<font></font>
image1.src = objectURL1<font></font>
image2.src = objectURL2<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(image1)
<span class="hljs-built_in">document</span>.body.appendChild(image2)<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">let</span> para = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'p'</span>)<font></font>
para.textContent = descText<font></font>
<span class="hljs-built_in">document</span>.body.appendChild(para)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guarde los cambios y vuelva a cargar la p√°gina. Deber√≠a ver que todos los componentes de la interfaz de usuario se est√°n cargando, aunque esto no parece muy atractivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. Si tiene alguna dificultad, puede comparar su versi√≥n del c√≥digo con la nuestra: aqu√≠ hay una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demostraci√≥n en vivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fuente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. Para mejorar este c√≥digo, puede recorrer los elementos mostrados, recibir y decodificar cada uno, y luego recorrer los resultados dentro de Promise.all (), iniciando diferentes funciones para mostrar cada resultado dependiendo de su tipo. Esto le permitir√° trabajar con cualquier cantidad de elementos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, puede determinar el tipo de archivo resultante sin tener que especificar expl√≠citamente la propiedad de tipo. Esto, por ejemplo, se puede hacer con</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response.headers.get ('tipo de contenido')</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para verificar </font><font style="vertical-align: inherit;">el </font><font style="vertical-align: inherit;">encabezado del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tipo de contenido del</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> protocolo HTTP.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute el c√≥digo despu√©s de cumplir / rechazar la promesa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A menudo, es posible que deba ejecutar el c√≥digo despu√©s de que se haya completado una promesa, independientemente de si se ejecut√≥ o rechaz√≥. </font><font style="vertical-align: inherit;">Anteriormente, ten√≠amos que incluir el mismo c√≥digo tanto en el bloque .then () como en el bloque .catch (), por ejemplo:</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
    runFinalCode()<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los navegadores modernos, el m√©todo .finally () est√° disponible, lo que le permite ejecutar el c√≥digo una vez que se completa la promesa, lo que evita la repetici√≥n y hace que el c√≥digo sea m√°s elegante. </font><font style="vertical-align: inherit;">El c√≥digo del ejemplo anterior se puede reescribir de la siguiente manera:</font></font><br>
<br>
<pre><code class="javascript hljs">myPromise<font></font>
.then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {<font></font>
    doSomething(response)<font></font>
})<font></font>
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<font></font>
    returnError(e)<font></font>
})<font></font>
.finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    runFinalCode()<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver el uso de este enfoque con un ejemplo real: la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demostraci√≥n de demostraci√≥n en vivo-finally.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fuente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Funciona igual que Promise.all () del ejemplo anterior, excepto que agregamos finalmente () al final de la cadena en la funci√≥n fetchAndDecode ():</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchAndDecode</span>(<span class="hljs-params">url, type</span>)</span>{
    <span class="hljs-keyword">return</span> fetch(url).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'blob'</span>){
            <span class="hljs-keyword">return</span> response.blob()<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'text'</span>){
            <span class="hljs-keyword">return</span> response.text()<font></font>
        }<font></font>
    }).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`There has been a problem with your fetch operation for resource "<span class="hljs-subst">${url}</span>": <span class="hljs-subst">${e.message}</span>`</span>)<font></font>
    }).finally(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`fetch attempt for "<span class="hljs-subst">${url}</span>" finished.`</span>)<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recibiremos un mensaje sobre la finalizaci√≥n de cada intento de obtener el archivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">then () / catch () / finally () es el equivalente as√≠ncrono de try sincr√≥nico () / catch () / finally ().</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribiendo tu propia promesa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La buena noticia es que ya sabes c√≥mo hacerlo. </font><font style="vertical-align: inherit;">Cuando combina m√∫ltiples promesas con .then (), o las combina para proporcionar una funcionalidad espec√≠fica, crea sus propias funciones as√≠ncronas y basadas en promesas. </font><font style="vertical-align: inherit;">Tomemos, por ejemplo, nuestra funci√≥n fetchAndDecode () del ejemplo anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La combinaci√≥n de varias API basadas en promesas para crear una funcionalidad espec√≠fica es la forma m√°s com√∫n de trabajar con las promesas, lo que demuestra la flexibilidad y el poder de las API modernas. </font><font style="vertical-align: inherit;">Sin embargo, hay otra manera.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Promesa del constructor ()</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede crear su propia promesa utilizando el constructor Promise (). Esto puede ser necesario en una situaci√≥n en la que tiene c√≥digo de la antigua API asincr√≥nica que necesita "sobredimensionar". Esto se hace para poder trabajar simult√°neamente tanto con el c√≥digo existente, antiguo, bibliotecas o "marcos", como con un nuevo c√≥digo basado en promesas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos un ejemplo simple: aqu√≠ envolvemos la llamada setTimeout () en una promesa: esto iniciar√° la funci√≥n en 2 segundos, que cumplir√° la promesa (usando la llamada resolve () aprobada) con la cadena "¬°√âxito!".</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {<font></font>
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
        resolve(<span class="hljs-string">'Success!'</span>)<font></font>
    }, <span class="hljs-number">2000</span>)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
resolver () y rechazar () son funciones que est√°n llamadas a cumplir o rechazar una nueva promesa. </font><font style="vertical-align: inherit;">En este caso, la promesa se cumple con la cadena "¬°√âxito!". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando llama a esta promesa, puede agregarle un bloque .then () para seguir trabajando con la l√≠nea "¬°√âxito!". </font><font style="vertical-align: inherit;">Entonces podemos generar una l√≠nea en el mensaje:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise<font></font>
.then(<span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {<font></font>
    alert(message)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... m√°s o menos:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise.then(alert)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vea una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">demostraci√≥n en vivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo fuente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo dado no es muy flexible: la promesa solo se puede cumplir con una l√≠nea simple, no tenemos un controlador de errores: rechazar () (realmente setTimeout () no necesita un controlador de errores, por lo que en este caso no importa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">¬øPor qu√© resolver () en lugar de cumplir ()? </font><font style="vertical-align: inherit;">Por el momento, la respuesta es esta: es dif√≠cil de explicar.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajamos rechazando una promesa.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos crear una promesa rechazada utilizando el m√©todo rechazar (): al igual que resolver (), rechazar () toma un valor simple, pero a diferencia de resolver (), el valor simple no es el resultado, sino la raz√≥n del rechazo, es decir. </font><font style="vertical-align: inherit;">Un error que se pasa al bloque .catch (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Expandamos el ejemplo anterior agregando una condici√≥n para rechazar una promesa, as√≠ como la capacidad de recibir mensajes que no sean de √©xito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tome el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y vuelva a escribirlo as√≠:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeoutPromise</span>(<span class="hljs-params">message, interval</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span>(message === <span class="hljs-string">''</span> || <span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span>){<font></font>
            reject(<span class="hljs-string">'Message is empty or not a string'</span>)<font></font>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(interval &lt; <span class="hljs-number">0</span> || <span class="hljs-keyword">typeof</span> interval !== number){<font></font>
            reject(<span class="hljs-string">'Interval is negative or not a number'</span>)<font></font>
        } <span class="hljs-keyword">else</span>{<font></font>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
                resolve(message)<font></font>
            }, interval)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ pasamos dos argumentos a la funci√≥n: mensaje e intervalo (retraso de tiempo). </font><font style="vertical-align: inherit;">En una funci√≥n, devolvemos un objeto Promise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el constructor Promise, realizamos varias comprobaciones utilizando las estructuras if ... else:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero, verificamos el mensaje. </font><font style="vertical-align: inherit;">Si est√° vac√≠o o no es una cadena, rechazamos la promesa e informamos un error.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En segundo lugar, verificamos el retraso de tiempo. </font><font style="vertical-align: inherit;">Si es negativo o no un n√∫mero, tambi√©n rechazamos la promesa e informamos un error.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente, si ambos argumentos est√°n bien, muestre el mensaje despu√©s de un cierto tiempo (intervalo) usando setTimeout ().</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como timeoutPromise () devuelve una promesa, podemos agregarle .then (), .catch (), etc. para mejorar su funcionalidad. </font><font style="vertical-align: inherit;">Vamos a hacer eso:</font></font><br>
<br>
<pre><code class="javascript hljs">timeoutPromise(<span class="hljs-string">'Hello there!'</span>, <span class="hljs-number">1000</span>)<font></font>
.then(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {<font></font>
    alert(message)<font></font>
}).catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error: '</span> + e)<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de guardar los cambios y ejecutar el c√≥digo, ver√° un mensaje despu√©s de un segundo. </font><font style="vertical-align: inherit;">Ahora intente pasar una cadena vac√≠a como mensaje o un n√∫mero negativo como intervalo. </font><font style="vertical-align: inherit;">Ver√° un mensaje de error como resultado de rechazar la promesa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nota. </font><font style="vertical-align: inherit;">Puede encontrar nuestra versi√≥n de este ejemplo en GitHub: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">custom-promise2.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fuente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo m√°s realista.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo que examinamos facilita la comprensi√≥n del concepto, pero no es realmente as√≠ncrono. La asincron√≠a en el ejemplo se simula usando setTimeout (), aunque todav√≠a muestra la utilidad de las promesas para crear funciones con un flujo de trabajo razonable, buen manejo de errores, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un ejemplo de una aplicaci√≥n as√≠ncrona √∫til que utiliza el constructor Promise () es la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca idb (IndexedDB con usabilidad)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jake Archibald. </font><font style="vertical-align: inherit;">Esta biblioteca le permite utilizar la API IndexedDB (basada en las funciones de devoluci√≥n de llamada API para almacenar y recuperar datos en el lado del cliente), escrita en el estilo antiguo, con promesas. </font><font style="vertical-align: inherit;">Si observa el archivo de la biblioteca principal, ver√° que utiliza las mismas t√©cnicas que examinamos anteriormente. </font><font style="vertical-align: inherit;">El siguiente c√≥digo convierte el modelo de consulta b√°sico utilizado por muchos m√©todos IndexedDB en un modelo compatible prometedor:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promisifyRequest</span>(<span class="hljs-params">request</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>)</span>{<font></font>
        request.onsuccess = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            resolve(request.result)<font></font>
        }<font></font>
<font></font>
        request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<font></font>
            reject(request.error)<font></font>
        }<font></font>
    })<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto agrega un par de controladores de eventos que cumplen o rechazan la promesa, seg√∫n corresponda:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando la solicitud </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiene √©xito</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el controlador de √©xito cumple la promesa con el resultado de la solicitud.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando la solicitud </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falla</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , el controlador onerror rechaza la promesa con el error de la solicitud.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las promesas son una excelente manera de crear aplicaciones asincr√≥nicas cuando no sabemos qu√© valor devolver√° la funci√≥n o cu√°nto tiempo llevar√°. Le permiten trabajar con una secuencia de operaciones asincr√≥nicas sin utilizar funciones de devoluci√≥n de llamada profundamente anidadas, y admiten el estilo de manejo de errores de la declaraci√≥n try ... catch s√≠ncrona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las promesas son compatibles con todos los navegadores modernos. La √∫nica excepci√≥n es Opera Mini e IE11 y sus versiones anteriores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo, hemos considerado lejos de todas las caracter√≠sticas de las promesas, solo las m√°s interesantes y √∫tiles. Conocer√° otras caracter√≠sticas y t√©cnicas si desea obtener m√°s informaci√≥n sobre las promesas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mayor√≠a de las API web modernas se basan en promesas, por lo que es necesario conocerlas. </font><font style="vertical-align: inherit;">Entre estas API web podemos nombrar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web Audio API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Media Capture y Streams</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc. Las promesas se volver√°n cada vez m√°s populares, por lo que su estudio y comprensi√≥n es un paso importante hacia el dominio de JavaScript moderno. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consulte tambi√©n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Errores comunes en las promesas de JavaScript que todos deber√≠an conocer"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias por su atenci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cr√≠tica constructiva es bienvenida.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488750/index.html">Dinosaur Walk: dos grandes computadoras del siglo XX</a></li>
<li><a href="../es488752/index.html">Golang + Phaser3 = MMORPG - Hacemos la base para la generaci√≥n interminable del mundo</a></li>
<li><a href="../es488754/index.html">Todo a la vez: comprobaci√≥n autom√°tica del tama√±o del paquete</a></li>
<li><a href="../es488756/index.html">C√≥mo trabajar con la API de Hojas de c√°lculo de Google (API de Hojas de c√°lculo de Google v4) en R usando el nuevo paquete de Google Googlesheets4</a></li>
<li><a href="../es488758/index.html">Conferencia 27 de DEFCON. Reconocimiento de estafas en Internet</a></li>
<li><a href="../es488766/index.html">Arte y tecnolog√≠a: Universidad de Massachusetts en Lowell</a></li>
<li><a href="../es488768/index.html">Infierno sangriento, o c√≥mo jurar en ingl√©s que se confunde con una persona culta</a></li>
<li><a href="../es488776/index.html">Mejoras de accesibilidad en Visual Studio 2019 para Mac</a></li>
<li><a href="../es488778/index.html">Estructuras de datos: una lista que puede hacer todo *</a></li>
<li><a href="../es488780/index.html">Mozilla perdi√≥ en la guerra del navegador, pero a√∫n cree que podr√≠a salvar Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>