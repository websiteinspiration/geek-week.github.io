<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼 👏🏾 😀 SecがOpsハーネスを試用した方法、またはダミー用にRed Hat OKD 3.11をデプロイした方法 🍁 🏌️ 🔅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="よう皆！
 
 昨年の秋、私はコンテナー化環境を保護するためのソリューションをテストする必要がありました（私は情報セキュリティエンジニアとして働いています）が、これのためのマイクロサービスアーキテクチャを備えた既製のスタンドはありませんでした。私たちはモーターを購入しましたが、トラクター...彼らは...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SecがOpsハーネスを試用した方法、またはダミー用にRed Hat OKD 3.11をデプロイした方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/503618/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よう皆！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
昨年の秋、私はコンテナー化環境を保護するためのソリューションをテストする必要がありました（私は情報セキュリティエンジニアとして働いています）が、これのためのマイクロサービスアーキテクチャを備えた既製のスタンドはありませんでした。私たちはモーターを購入しましたが、トラクター...彼らは私たちからそれを盗みました。コンテナオーケストレーションシステムが大幅に不足し、冒険の匂いがしました。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/415/c98/640/415c9864027b4ba7349e81ec55994f27.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のOpの同僚は常に統合と実装の最前線にいるため、昼夜を問わず複雑なシステムとコンピューティングシステムを展開し、「OpenShiftクラスターをすばやく交換する」よう依頼することは、エンジニアリング連帯の概念に適合しませんでした。したがって、私は強い意志をもって決断しました-それを自分で行うことです！もちろん、同僚の助言がなければ、OpsのおかげでOpsの知恵が訪れるかもしれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今後の展望として、最終的にスタンドは成功し、今日まで非常にうまく機能していると言います。私はあなたとの経験を共有したいと思います。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、オーケストレーションプラットフォームRed Hat OKD 3.11についてお話します。</font><font style="vertical-align: inherit;">新しい4番目のメジャーバージョンが既にリリースされていますが、以前のバージョンはまだコンテナー内のマイクロサービスアプリケーションの操作に広く使用されていることを、すぐに言っておく必要があります。</font><font style="vertical-align: inherit;">4.xがすでにテストで試されている場合でも、proxはまだ3.xを使用することがよくあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Red Hat OKD 3.11ソリューションは非常に興味深いですが、それについての世論は物議を醸しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部は言う：</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-スムージーとひねり！</font><font style="vertical-align: inherit;">ホイッスルをバニラクベルネテスに掛け、企業のように押し込みました。</font><font style="vertical-align: inherit;">私が間違っていることを証明してください！</font></font></i></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 他の人が直面する：</font></font><br>
<blockquote><i>—        .         ,      ,    ?</i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おばあちゃんはサモワールをセットし、ホリバーを始めましょう... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私たちはホリバーのためにここにいません。プラットフォームを最初から展開して、OKD 3.11 &lt;ノズルを調整して点火を調整する&gt;内のハンドルを開始してみましょう。その後、自分で確認します。そしてセキュリティについて少し話しましょう-トピックは広範囲であり、時には無視されます（そうです、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「それら」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も同様です）。 Red Hat OpenShift / OKDに遭遇していない場合は、この記事が概要ガイドとして役立ち、私のレーキを踏まないようにしてください。プラットフォームで作業した場合-あなたはカンフーを知っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、すでにお気づきのように、私の分身のコメントは、括弧&lt;&gt;内のテキストをすり抜けることがあります-心配しないでください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免責事項：著者の意見は、編集者、Red Hatのマーケティング部門、ウルグアイの大統領および著者の猫の意見と一致しない場合があります。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは歴史に飛び込むことはせず、誰が最初にコンテナの概念、GoogleまたはRed Hatを思いついたのかを知ることはしません。</font><font style="vertical-align: inherit;">プラットフォームが今私たちに提供するものを見てみましょう。</font><font style="vertical-align: inherit;">これを行うために、私たちは施設にシステムを展開しようとします。つまり、インフラストラクチャを準備し、環境を構成し、インストールを開始し、途中で発生する問題を解決しようとします&lt;確実に&gt;、それから作業のためにシステムを準備します。</font><font style="vertical-align: inherit;">「Cold＆Dark to Ready to Taxi」のようなもの。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0d7/9ce/e75/0d79cee7543b80dfaf8e559a1b9c3420.jpg" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこから始めますか？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、優れたエンジニアといい人たちは&lt;ちなみに、Googleはそのような立場にあります&gt;文書を読むことから始めました。上</font><font style="vertical-align: inherit;">のRed Hat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポータル</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちは「友好的」インターフェースとドキュメントのセクションを多数迎えています。確かに、年代学はすぐに完全に理解できるようには見えないかもしれません。ドキュメントには、ほとんどすべての質問に対する回答が含まれています&lt;しかし、読むのは面倒な場合があります&gt;。ここでは、アーキテクチャの説明、システムのコンポーネント、セットアップ、トラブルシューティング、および最も可能性のある状況でのアクションに関する多くのガイドをご覧いただけます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンピューティングシステムのプラットフォーム要件を見ると、「追加は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">強く</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">お勧めします。これは、リソースが不足している場合、上記のすべてが必要最小限であるため、&lt;Crysis to a necropecのように&gt;うまく機能しないことを意味します。それ以外の場合は、システムにどれだけのコンピューティングリソースを割り当てれば、システムがぐちゃぐちゃになります。これは、システムが高速で簡単なスケーラビリティに向けられているため、これはごく普通のことです。プラットフォームはリソースを非常に要求し、最も簡単なインストールでは、1つのマスターノード、2つのワーカーノード、1つのインフラノードが必要です。それは何ですか、なぜですか、なぜ必要なのですか？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、システムカーネルが実行される管理サーバーです。コンテナのデプロイを管理し、システム構成をコンテナに格納し、APIがコンテナを制御し、システムのすべてのコンポーネントが相互に通信します。要するに、脳。最小数量は1です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワーカー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-作業用サーバー、最初の概算では-コンテナーの「バケット」。</font><font style="vertical-align: inherit;">実際、コンテナに容量を提供するのはコンピューティング環境です。</font><font style="vertical-align: inherit;">予想通り、マスターによって管理されました。</font><font style="vertical-align: inherit;">最小数量は2です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフラ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も労働者ですが、従業員です。</font><font style="vertical-align: inherit;">内部イメージレジストリ（イメージが格納されている場所）、ルーター（コンテナールーター、後で詳しく説明します）、および監視システムコンテナー（システムステータスメトリックの収集と表示）のサービスコンテナーをデプロイします。</font><font style="vertical-align: inherit;">他のアプリケーションが含まれているコンテナは上昇しません。</font><font style="vertical-align: inherit;">最小数量は1です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システム全体がコンテナのセットであり、私たちのインストールでは、NFSとDNS用の別個のサーバーがあり、その上にAnsibleをデプロイして、インストールを実行します。</font><font style="vertical-align: inherit;">さて、利便性とフォールトトレランスのために、プラットフォームの太さを許してみましょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何が何であるかを理解しましょう</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私のオンプレミススタンドには次の特徴があります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/796/a36/555/796a36555ed4961ddd58ceef5bac0594.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はこのすべてをvCloudクラウドにデプロイし、指定された特徴を持つ仮想マシンを作成しました。</font><font style="vertical-align: inherit;">それらのそれぞれについて、CentOS 7.4-1708をWebサーバーパッケージにインストールしました（スペースを取りすぎず、必要なパッケージのほとんどがすでにそこにあるため、最良のオプションです）。特権ユーザーを作成し、ネットワークマネージャーを介してネットワーク設定を登録しました。</font><font style="vertical-align: inherit;">したがって、すべてのサーバーが相互にアクセス可能です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データストレージ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合、コンテナー化されたサービスデータのすべての長期ストレージは永続ボリュームディレクトリ内のNFS（要塞サーバー）に配置されるため、ノード自体に直接大きなディスク容量がなくても実行できます。コンテナーは、ライフサイクル全体を通じて、つまりコンテナーが停止されるまで、コンテナー内にデータを格納します。コンテナの削除や再起動とは関係なく、永続的なデータストレージが必要な場合、</font><b><font style="vertical-align: inherit;">永続的なボリューム</font></b><font style="vertical-align: inherit;">と呼ばれるエンティティで発生します。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これは、設定されたアクセスポリシーに従って、特定のコンテナでデータを使用できる一種のディレクトリです。大まかに言えば、コンテナー内のアプリケーションは永続ボリュームにデータを書き込みます。その下に、実際にはこのデータが移動するNFSディレクトリがあります。コンテナーを再起動した後、または、コンテナーの2番目のレプリカをアプリケーションに追加した後など、両方のコンテナーの両方のアプリケーションがこのデータにアクセスできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenShiftは、ストレージサブシステムのいくつかのプラグインをサポートしています：NFS、GlusterFS、Ceph RBD、OpenStack Cinder、AWS Elastic Block Store（EBS）、GCE永続ディスク、およびiSCSI。プラグインの選択は、特定のインストールと必要なタスクに応じて異なります。&lt;コメントでジェットジェットに点火する-よく、いいえ&gt;のどちらを使用する方が良いかは考慮しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NFSを選択したのは、インターネットに手順とガイドが満載されているため、展開が簡単で迅速であるためです。ただし、ベンダーはこのオプションを製品で使用することを推奨していません。テストやデモなど、それで十分ですが、本番環境では問題が発生する可能性があります。たとえば、OpenShiftはNFSにデータを格納するためのディレクトリを作成しません;それらは事前に作成およびエクスポートする必要があります。数百のプロジェクトに含まれる数百、数千のコンテナの場合、手作業でカタログを作成するのは面倒ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームに戻りましょう。理想的な世界では、プラットフォームの構成は下図とほぼ同じです。これは完全に推奨されるインストールです。必要に応じてワーカーを追加することで、さらに拡張できます。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7f5/513/150/7f5513150bcb23fb46e25eb5e917987a.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スリー</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノード-構成の初期ストレージ（etcdデータストア）、コンテナーレプリカの管理（レプリケーションコントローラー）、および新しいコンテナー（スケジューラー）の展開の計画にフォールトトレランスを提供し、システムの管理にも役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワーカー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノード（これらはアプリケーションノードでもあります）-アプリケーションが含まれるコンテナーは、それらに均等に分散され（別の方法で構成されていない限り）、ノードに障害が発生した場合、他のノードに流れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフラ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ノード-ここではすべてがワーカーとの類推によって行われ、サービスコンテナーのみが使用されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ロードバランサー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-相対的に言えば、コンテナとルーターがそれらの間のトラフィックのために接続されている仮想内部ネットワークのNATのようなものです。</font><font style="vertical-align: inherit;">直接構成することはないので、詳細は考慮しません。</font><font style="vertical-align: inherit;">これは、ネットワークトラフィックを管理し、必要なコンテナーサービスに応じてネットワークトラフィックを分散できる仮想ルーターであると言えます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ansible Master-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコンポーネントはプラットフォーム自体の一部ではありませんが、言及する価値があります。</font><font style="vertical-align: inherit;">これがあなたの最初の出会いである場合、これが何であるか、そしてその理由についてここにいくつかの言葉があります：</font></font><br>
<blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Ansibleは、構成を記述するために宣言型マークアップ言語を使用して、Pythonプログラミング言語で記述された構成管理システムです。</font><font style="vertical-align: inherit;">ソフトウェアの構成と展開を自動化するために使用されます</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiki</font></font></i></a></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがどのように機能するかを指で説明します。Ansibleマスターホストは、ネットワーク経由でターゲットホストに接続し、自動的に構成できます。これが機能するために、彼は最初の1つを持っています</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インベントリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">には、ターゲットホストにアクセスするためのパラメーターが記述されています。IPアドレス、接続するユーザー、およびパスワード（これは最小値です）。そして2番目は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイブック</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、つまり設定用のパラメータの設定値のリストです。 Ansibleは特定のパラメーターの値をチェックし、必要なパラメーターを設定します。大まかに言えば、システムチェック</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemctlを対応さドッカー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と期待値は、例えば、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターゲットホスト戻りの値があれば、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従って、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドッカーを有効systemctl</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">したがって、パラメーターの必要な値を設定します。例は木製ですが、本質はほぼ同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複雑なシステムでは、構成パラメーター値の変数、承認用のSSHキー、ターゲットホストをさまざまなタイプでグループ化するための子ホストグループ、および非常に役立つが別の記事にまとめられたその他の多くの優れた機能が使用されます。インストール中に遭遇した場合は、もう少し詳しく見ていきます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、これが他のサーバーを構成できるサーバーであることを理解するだけで十分です。ターゲットサーバーで多くの設定を行う必要があり、そのようなサーバーが多数ある場合に非常に便利です。これを行うには、ターゲットホストにコマンドを送信するか、ファイルから構成をアップロードします。当然、マシンのネットワーク接続の影響を受けます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、OpenShiftに戻ります。私たちの場合、インストールはより単純になります：1つのマスター、1つのインフラ、2つのワーカー（下の図）。約6か月間のテスト環境での使用の経験に基づいて、これは機能しますが、マスターの最初の問題までです。たとえば、&lt;それが起こったことはなく、ここでもまた&gt;落ちるとすぐに、OSでソフトウェア障害が発生したり、ネットワークが落ちたり、一部のPython 2.7が曲がって更新されたり、または類似したものになると、プラットフォームが動作しなくなります（これを回避するために、マスターは3個を推奨しました）。公平に言うと、問題を修正してノードを正常にロードすると、すべてが自然に立ち上がり、接続して戻り、何もなかったかのように動作します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b57/971/1de/b579711de0a90c11331891c4fab71f8b.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムのインストール手順はベンダーのポータルの説明にありますが、ニュアンスのあるいくつかの点に個別に注意します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホストでネットワークアダプターとホスト名を構成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSサーバーをインストールして起動します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルDNSゾーンを構成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルDNSを使用するようにホストを構成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ansibleプレイブックを実行するためのSSHパスワードレス接続を構成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なRPMパッケージをインストールして更新します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なリポジトリをインストールします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイブックアーカイブをダウンロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dockerをインストールし、Dockerストレージを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インベントリファイルを編集します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイブックprerequisites.ymlを実行します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deploy_cluster.ymlプレイブックを実行します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さあ、もう行きましょう！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ホストでネットワークアダプターとホスト名を構成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークマネージャーの助けを借りて、ネットワーク構成を設定し、すぐに将来のDNSを示します。</font><font style="vertical-align: inherit;">nmtuiの方が快適です。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/0e0/0ec/597/0e00ec597963f6536f10ddb4062f0fe6.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホスト名を割り当てます。</font></font><br>
<br>
<pre><code class="bash hljs">hostnamectl <span class="hljs-built_in">set</span>-hostname master.okd.local</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のための</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><br>
<br>
<pre><code class="bash hljs">hostnamectl <span class="hljs-built_in">set</span>-hostname worker-1.okd.local</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のための</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">労働者-1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のように。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
okd.localドメインはローカルです。別のDNSゾーンを作成します。</font><font style="vertical-align: inherit;">お好みでドメインを作成できます。</font><font style="vertical-align: inherit;">くそー、これを今から取得します。</font><font style="vertical-align: inherit;">この設定は、すべてのマスター、ワーカー、インフラノードに対してそれぞれ実行してください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. DNSサーバーをインストールして起動します</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合、バインドします。クラスタードメインで要求を処理するために必要です。クラスター内のアプリケーションは、ドメイン名などを介して相互に通信できます。これらすべてのドメイン名は、DNSがサービスを提供するクラスターゾーンに配置されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要するに、なぜこれが必要なのでしょう。アプリケーションは、仮想ネットワークのクラスター内でスピンするコンテナーで実行されます。これらは常に起動、破棄、複製され、&lt;そして一般的に、それらとのトラフィックはアジアの交差点に似ています&gt;、コンテナのIPアドレスを使用してネットワークトラフィックをルーティングすることは無意味です-絶えず変化しています。これを行うには、ドメイン名にバインドし、それらに対してすべてのルーティングを実行します。これはOpenShiftでルーターが行うことです。また、サービスのFQDNアドレスを解決できるようにするには、悪名高いDNSサーバーが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージをインストールします。</font></font><br>
<br>
<pre><code class="bash hljs">yum -y install <span class="hljs-built_in">bind</span> <span class="hljs-built_in">bind</span>-utils <span class="hljs-built_in">bind</span>-chroot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスを開始して有効にします。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl start named-chroot</code></pre><br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> named-chroot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
設定ファイルbind </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/var/named/chroot/etc/named.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を開い</font><font style="vertical-align: inherit;">て次の形式にします（スポイラーの下で削除します）。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/var/named/chroot/etc/named.conf</font></font></b>
                        <div class="spoiler_text">options {<br>
listen-on port 53 { any; };<br>
listen-on-v6 port 53 { none; };<br>
directory "/var/named";<br>
dump-file "/var/named/data/cache_dump.db";<br>
allow-query { 127.0.0.1; 192.168.7.0/24; };<br>
recursion yes;<br>
allow-recursion { 127.0.0.1; 192.168.7.0/24; };<br>
forwarders { 8.8.8.8; };<br>
version «DNS Server»;<br>
managed-keys-directory "/var/named/dynamic";<br>
pid-file "/run/named/named.pid";<br>
session-keyfile "/run/named/session.key";<br>
dnssec-enable no;<br>
dnssec-validation no;<br>
};<br>
<br>
zone "." IN {<br>
type hint;<br>
file «named.ca»;<br>
};<br>
<br>
include "/etc/named.rfc1912.zones";<br>
include "/etc/named.root.key";<br>
<br>
logging {<br>
channel default_file {<br>
file "/var/log/named/default.log" versions 3 size 5m;<br>
severity dynamic;<br>
print-time yes;<br>
};<br>
category default { default_file; };<br>
};<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は何をしましたか？</font><font style="vertical-align: inherit;">&lt;モンスターを作成&gt; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のパラメーターを設定しました。</font></font><br>
<br>
<pre><code class="bash hljs">listen-on-v6 port 53 { none; }; —     ipv6,         ipv6 . </code></pre><br>
<pre><code class="bash hljs">forwarders { 8.8.8.8; }; —  ,    ,  DNS- (   DNS-).</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたが完全に怠惰な場合は、デフォルトですべてを残すことができます-それは動作します。</font><font style="vertical-align: inherit;">進め。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.ローカルDNSゾーンを構成する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、実際には、このゾーンを作成する必要があります。</font><font style="vertical-align: inherit;">named.confでゾーンファイルを記述し（つまり、named：「そこにゾーンパラメータを検索」と伝えます）、ファイルの最後にゾーンファイルを示します。</font><font style="vertical-align: inherit;">ここで：</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/465/e2f/d67/465e2fd67cb140c1d7f13954e9467435.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして今、同じゾーンファイルを作成しています&lt;Nanoを使用したいのですが、Vimを使用していると、時々不思議な感覚を感じました...くすぐりやかゆみ&gt;。</font></font><br>
<br>
<pre><code class="bash hljs">nano /var/named/master/okd.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ファイルの内容（ネタバレの下）：</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">okd.local</font></font></b>
                        <div class="spoiler_text">$TTL 86400<br>
<br>
@ IN SOA okd. okd.local. (<br>
 1192648703<br>
 10800<br>
 3600<br>
 604800<br>
 38400<br>
);<br>
<br>
@ IN NS localhost.<br>
console IN CNAME master<br>
<br>
bastion IN A 10.31..30<br>
master IN A 10.31..32<br>
api IN A 10.31..32<br>
api-int IN A 10.31..32<br>
infra IN A 10.31..31<br>
worker-1 IN A 10.31..33<br>
worker-2 IN A 10.31..34<br>
<br>
*.okd.local IN A 10.31..31<br>
<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして保存します（nano ctrl + x）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私がやったことについて一言：DNSサーバーが解決する新しいゾーンを作成し、その中に必要なホストを示しました。私はDNSに、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master、api、infra</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などの</font><font style="vertical-align: inherit;">すべてのリクエストを要求しました</font><font style="vertical-align: inherit;">。適切なホストに到達し、それらのIPアドレスを示します。ここでは何も複雑ではありませんが、どのようなAPIですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、OpenShift自体（つまり、Kubernetes）のAPIサーバーであり、ユーザーとシステムコンポーネントがコア、およびコンポーネント間のコンポーネントと通信できるように支援します。たとえば、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kubectlプログラム</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（カスタムコンソールシェル）は、このAPIを介してI / Oを生成します。システム</font><b><font style="vertical-align: inherit;">にノードを取得</font></b><font style="vertical-align: inherit;">するように指示した場合</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（コマンドは、クラスタノードのステータスを表示）、フードの下OCは、APIでの要求を行い、それが今度はOCは&lt;ジャックが建てたことを家の中に&gt; ...人間が読める形式に変換することを応答を返す</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ようなエントリでは、私は明示的にこのことが示されたがAPIはマスターで実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワイルドカードエントリ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .okd.local</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font><b><font style="vertical-align: inherit;">okd.local</font></b><font style="vertical-align: inherit;">ドメイン内のすべてのアドレスを意味します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（そして、これらはapp1.okd.local、app2.okd.localなどのコンテナー内のアプリケーションになります）アドレス10.31.xxx.31で機能します。これは、ルーターを備えた私のインフラノードです。抽象化のレベルはとても酸性ですよね？ DNSは外部リクエストに応答します。たとえば、アプリケーションapp1.okd.localは10.31.xxx.31にあり、それ自体がコンテナで動作するルーターがパケットをルーティングし、別のコンテナに送信します。私自身、私が正しく書いたかどうかはよくわかりません&gt;。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、私が作成して保存し、Namedにフィードしたゾーンファイルです。 DNSを再起動して、エラーがないことを確認します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># rndc reconfig</span>
<span class="hljs-comment"># systemctl restart named</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドは実行されるべきであり、応答として何も書き込まないでください。異なる結果になった場合は、エラーメッセージを確認してください。何が問題かを正確に確認するための場所がわかります。通常は、/ var / log / messagesまたはjournalctlに移動する必要があります。そこで何を注意深く見れば、エラーメッセージからも学ぶことができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが機能することを確認してください！ここでのエラーは、クラスターが展開フェーズ中に上昇しないという事実に満ちています。 APIのインストールが完了し、ヘルスチェックが使用されると、プレイブックを通過しますが、愚かに応答しない場合があります。 DNSがアドレスを解決しない場合は使用できません。それから、私の頭を悩ませて間違いを探すのに非常に長い時間がかかります&lt;そして、あなたが夜に仕事で姿を消すという事実のために私の妻との離婚に備える&gt;、私はそれだけで良かったです&lt;妻-敏感な女性と理解&gt;。そして、障害はゾーン構成のタイプミスにすぎませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、/ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc/resolv.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のDNS構成</font><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホスト名</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構成</font><font style="vertical-align: inherit;">、およびサーバーが名前で応答するかどうかを確認します。 ：たとえば、次のよう</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
に</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolve.conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正しいDNSが登録されていることを確認してください。</font><b><font style="vertical-align: inherit;">ホスト名</font></b></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/f45/b78/2ff/f45b782ff0a80caa0f1c0ec83820e480.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ノードを確認し</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></b><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/88b/ac2/ca5/88bac2ca532dc2e2cba9407a1176e8ce.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ノードが名前で応答することを確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/69a/2dc/250/69a2dc2507ebb5b284c3dbe843623f0e.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nslookupまたはdig、ノードが正しいドメイン名で解決されることを確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/aff/b2a/b03/affb2ab03dc1039eaaf25ab2085c8d60.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、DNSを備えたサーバーを含め、クラスターのすべてのノードでこれらすべてをチェックする必要があります。</font><font style="vertical-align: inherit;">すべてのサーバーで設定が同一であることが重要であり、それぞれに適切です。</font><font style="vertical-align: inherit;">たとえば、マスターのホスト名はmaster.okd.localで、インフラストラクチャ-infra.okd.localなどでした。</font><font style="vertical-align: inherit;">すべてが正しい場合-優れていない場合-正しい形にしてください。</font><font style="vertical-align: inherit;">エラーを探すために長くて退屈になるよりも、今すぐすべてを再確認することをお勧めします。</font><font style="vertical-align: inherit;">さらに進みましょう...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.次に、Ansibleマスターの準備に移りましょう</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パスワードなしのSSH接続を設定して、Ansibleプレイブックを実行します。</font><font style="vertical-align: inherit;">この瞬間から、OpenShiftのインストールを開始したと想定できます。</font><font style="vertical-align: inherit;">パスワードは無効にしません。キーを生成して、Ansibleマスターホストにインポートするだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各ホストでSSHキーを生成します。</font><font style="vertical-align: inherit;">すでに述べたように、これらはAnsibleマスターが特権ユーザーとして接続し、ホスト構成コマンドを実行してユーザーのパスワードを手動で入力するために必要です。</font><font style="vertical-align: inherit;">これを行うには、すべてのターゲットホストで実行します。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># ssh key-gen</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、すべての質問のためにエンターを突き刺してください。</font><font style="vertical-align: inherit;">その結果、サーバーは、キー、そのフィンガープリント、およびrandomartが格納されているディレクトリを表示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、実際にはパスワードなしの接続になります。これまでにAnsibleを使用したことがある場合は、すべてがはっきりしているはずです。そのような経験がなかった場合、私は説明します：Ansibleはターゲットホスト上でコマンドを実行し、指定されたユーザーによってそれらにログオンされ、SSH経由で接続されます。プレイブック（または単純なアドホックコマンド）が機能するためには、宛先ホストのアドレス、Ansibleが接続するユーザー、そして最も単純な場合にはパスワードを指定する必要があります。毎回接続を確認せず、パスワードを入力しないようにするには、公開SSHキーをターゲットマシンからAnsibleマスターにインポートします。もちろん、キーはすでに生成されている必要があります（上記を参照）。これを行うには、Bastion（Ansibleマスター）で次のようにします。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># for host in master.okd.local \   </span><font></font>
worker-1.okd.local \ <font></font>
worker-2.okd.local \<font></font>
infra.okd.local; \<font></font>
<span class="hljs-keyword">do</span> ssh-copy-id -i ~/.ssh/id_rsa.pub <span class="hljs-variable">$host</span>; \<font></font>
Done<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">〜/ .ssh / id_rsa.pubディレクトリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に、コピーされたキーが表示されます。</font><font style="vertical-align: inherit;">Bastionを使用して各ホストに接続することで、すべてが正常であることを確認できます。</font><font style="vertical-align: inherit;">私は断固としてこれを行うことを勧め、哀れに懇願します：</font></font><br>
<br>
<pre><code class="bash hljs">ssh master.okd.local<font></font>
ssh worker-1.okd.local<font></font>
...<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確認メッセージには</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「はい」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と答える必要があり</font><b><font style="vertical-align: inherit;">ます</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">サーバーはパスワードを入力せずに各ホストにログインする必要があります。接続の提案を受け入れたため、再度表示されることはありません。</font><font style="vertical-align: inherit;">これは、プレイブックの練習に適しています。プレイブックを起動するたびに[はい]をクリックする必要はありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.必要なパッケージをインストールしてアップグレードする</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バスティオンのホストでも同じです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ニュアンスがあります。</font><font style="vertical-align: inherit;">この順序はCentOSで機能しますが、RHELでは手順が少し異なります。</font><font style="vertical-align: inherit;">たとえば、RHELでは、サブスクリプションマネージャーを介して更新のサブスクリプションをアクティブ化し、ホストをRed Hatポータルに登録し、必要なリポジトリーを選択してそこからインストールする必要があります。</font><font style="vertical-align: inherit;">私の場合、</font><font style="vertical-align: inherit;">CentOSをポータルに登録せず、RPMパッケージを使用して簡単なインストールを実行します。</font><font style="vertical-align: inherit;">結果は同じになるので、これは重要ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">。</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、上記のすべてが必要なわけではありませんが、これは、起こりうる問題を構成およびトラブルシューティングするためのユーティリティの完全なパックです。</font><font style="vertical-align: inherit;">したがって、壊れないですべてを置くことをお勧めします。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># yum install –y wget git net-tools bind-utils yum-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct</span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.必要なリポジトリをインストールします</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
epelリポジトリをインストールし、そこからAnsibleをダウンロードします。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># yum -y install \  </span>
https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リポジトリをグローバルにオフにして、後でパッケージがデフォルトのリポジトリからデフォルトでロードおよび更新されるようにします。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># sed -i -e "s/^enabled=1/enabled=0/" /etc/yum.repos.d/epel.repo</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、epelリポジトリからansible rpmをインストールします。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># yum -y --enablerepo=epel install ansible pyOpenSSL —        Ansible, Python’   . </span></code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.プレイブックのアーカイブをダウンロードする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;なぜそんなに地獄？</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSTALL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンはどこにあるのですか</font><font style="vertical-align: inherit;">?????&gt;</font></font><br>
<br>
<pre><code class="bash hljs">
<span class="hljs-comment"># cd ~</span>
<span class="hljs-comment"># git clone https://github.com/openshift/openshift-ansible</span>
<span class="hljs-comment"># cd openshift-ansible</span>
<span class="hljs-comment"># git checkout release-3.11</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単な方法があります。ホームディレクトリに移動し、プレイブックと必要なすべてのファイルを含むアーカイブをGithubからクローンして、正しいバージョンを使用していることを確認しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. Dockerをインストールし、Dockerストレージを作成します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マスター、インフラ、および両方のワーカーノードでこれを行います！</font><font style="vertical-align: inherit;">プラットフォームが回転する場所。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># yum install docker-1.13.1</span>
<span class="hljs-comment"># systemctl enable docker</span>
<span class="hljs-comment"># systemctl start docker</span>
<span class="hljs-comment"># docker-storage-setup </span>
<span class="hljs-comment"># systemctl restart docker</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は何をしましたか？ Dockerをコンテナーエンジンとしてインストールし、そのストレージを有効にしました。ただし、これはダウンロードした画像を保存するためのストレージであり、一般的にはDocker自体のためのものです。これはコンテナ内のアプリケーションのストアではありません。後でプラットフォーム自体に作成する必要があります。一般に、この段階では詳細に停止することはできません。ストレージの構成、そのセキュリティ、およびその他の必要なものがOpenShiftによって処理されるためです。プラットフォームが言うように、Dockerは愚かにコンテナーを起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はデフォルトのデフォルトでここにストレージを残し、追加の設定は通常必要ありません。ただし、場合によっては、何かを構成する必要があります。私は単純な</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスマッパー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドライバーを使用</font><font style="vertical-align: inherit;">し、ストレージ</font><font style="vertical-align: inherit;">には</font><font style="vertical-align: inherit;">単純なブロックデバイス、ディスク/ sda、/ sdbなどを使用しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.インベントリファイルを編集する</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&lt;しかし、まだインストールを開始していません&gt; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、</font><font style="vertical-align: inherit;">このセクションのドキュメントへの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンク</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を紹介します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それが必要になります...私は仲間を感じることを知っています... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、OpenShift 3.xの最初のインストールの忠実な仲間である大きな痛みと不眠症があるので、ここでもう少し詳しく説明します。</font><font style="vertical-align: inherit;">Inventoryファイルには、プラットフォームのインストール、ノードのタイプと役割、追加モジュールの構成などが記述されています。</font><font style="vertical-align: inherit;">実行中にプレイブックで使用される変数とそのターゲット値が格納されます。</font><font style="vertical-align: inherit;">最も単純なケースでは、インベントリファイルは次のようになります（これはテストベンチの例であり、Openshiftはそれとは関係ありません-明確にするためだけです）。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/90c/019/463/90c01946328f874b3c89e19bf57e6780.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、サーバーのグループ（RHEL、DEBIAN、windows）を見ることができます。それらは、まるで子供であるかのように、子供と呼ばれます。たとえば、すべてのサーバーにnet-toolsをインストールする場合、RHELベースのホストオペレーティングシステムの場合、プレイブックのコマンドは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yum install net-tools</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">となり、DebianベースのUbuntuの場合は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt-get install net-toolsとなります</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ここで、これら2つのコマンドを実行しようとする1つのプレイブックが</font><font style="vertical-align: inherit;">、Ubuntuで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yum</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実行できず</font><font style="vertical-align: inherit;">、RHELで</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt-get</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">実行できないというログのすべてのサーバーですぐにエラーをスローしないよう</font><font style="vertical-align: inherit;">に、ターゲットホストをグループに分割できます。 RHELグループの場合は、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yumを使用した</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレイブック</font><font style="vertical-align: inherit;">、Ubuntuの場合は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt-getを使用し</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。非常に不格好な例ですが、本質は理解できると思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、各グループには、造語の名前を持つホストが示され（-= CentOS-1 =-/ 2など）、プレイブックが実行されたときにのみ表示されます。これは、ユーザーがどのホストで何が発生していて、どこでエラーが発生したかを理解するために必要です。このホストのIPアドレス、接続するユーザー、および彼のパスワードがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、ちなみに、Windows Ansibleは構成方法も知っています。構成方法は異なります。話をしないでください。今のところはここにいません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、OpenShiftをデプロイするためのインベントリファイルでは、すべてのホストもその役割（マスター、ワーカー、インフラストラクチャなど）に応じてグループに分割され、システムの構成変数がすぐに追加されます。</font><font style="vertical-align: inherit;">つまり、最初に、実行時にAnsibleはホスト構成をターゲット構成に調整し（これはprerequisites.ymlプレイブックです）、システムのデプロイを開始し（deploy-cluster.ymlプレイブック）、その構成パラメーターを設定すると、指定したパラメーターからこれらと同じパラメーターを取得します在庫変数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インベントリファイルの外観に戻ります。OpenShiftからインベントリをスポイラーの下に隠しました-たとえば、レベリーの子があります。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">host-poc.yaml</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/231/622/27f/23162227fa98429788b4162127f142b1.jpg" alt="image"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pff、はい、すべてが明確になりました、最後に</font><font style="vertical-align: inherit;">私はでき</font><font style="vertical-align: inherit;">ます... </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9f1/5e0/211/9f15e02115d569757cdf90e00d5f0834.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に詳細に記載されてい</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;"> &lt;しかし、誰にも害を与えたくありません&gt;、次のAnsible Inventory変数を変更する必要があることに注意します（</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：これはすべてBastionにあります）：</font><b><font style="vertical-align: inherit;">ansible_ssh_user = root-</font></b><font style="vertical-align: inherit;">ここで、Ansibleがノードにログインできるユーザーを設定する必要があります（そのキーは、SSHアクセス用にキーでコピーされました）。私はそれを</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">として行いました</font><font style="vertical-align: inherit;">&lt;怠惰な母の罵倒のためではなく、決してrootで作業するべきではないことをもう一度思い出させるために&gt;。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openshift_master_default_subdomain = apps.okd.local-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以降、作成されたゾーンからドメインを指定し、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">okd.localにします。</font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openshift_master_cluster_hostname = api.okd.local </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openshift_master_cluster_public_hostname = console.okd.local </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
openshift_console_hostname = console.apps.okd.local </font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openshift_metrics_storage_volume_size = 40Gi-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで、モニタリングメトリックストレージのサイズを指定できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openshift_logging_storage_volume_size = 50Gi-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは、ログストレージのサイズを指定できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openshift_hosted_etcd_storage_volume_size = 5G</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -etcdストレージのサイズを指定できます。これは構成ストレージです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次はまさに子供たちのグループです。この場合、これらはノードの役割に関連付けられています。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃マスターのホストグループ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[マスター] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">マスター</font></b><font style="vertical-align: inherit;">のホスト名は</font><font style="vertical-align: inherit;">次のとおり</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃etcd </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[etcd] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マスターの</font><font style="vertical-align: inherit;">ホストグループ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-設定がマスターに保存されているため、マスターのホスト名もここにあります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[nfs] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bastion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -NFSサーバーのホスト名（デプロイされている場合）。 Ansible、DNS、NFSのこの要塞があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[nodes] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
master openshift_node_group_name = "node-config-master"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">マスターにnode-config-master</font></b><font style="vertical-align: inherit;">の役割を指定します。私を信じて、指摘してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker-1 openshift_node_group_name = "node-config-compute"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -作業ノードに対するnode-config-computeの役割を示します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">worker-2 openshift_node_group_name = "node-config-compute" </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
infra openshift_node_group_name = "node-config-infra"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">インフラ</font></b><font style="vertical-align: inherit;">ノードに対するnode-config-infraの役割を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての準備措置の後、ダウンロードしたパックからプレイブックを起動する必要があります。そこには多くのプレイブックがあり、それらの多くは、たとえばログストレージの拡張と監視、クラスターへのノードの追加、暗号化証明書のローテーションなど、さらなるメンテナンスを目的としています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このインストール全体について少しだけお話ししたいのですが、私の感想を共有します。 Ansibleを使用した自動化は一般にすばらしいトピックですが、OpenShiftのような複雑なものの場合、インストールプロセスには、ターゲットホストの膨大な数のチェックと構成が必要です。その結果、プレイブックの練習中に&lt;そしてあなたの謙遜な召使いが1週間同様の暴力にさらされた&gt;可能性が非常に高くなり、インストールが停止する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、Ansibleは、エラーが発生した段階、その説明などを表示します。</font><font style="vertical-align: inherit;">ただし、エラーの原因がPlaybookの進捗レポートから明らかになると信じるのは、残念ながら非常にナイーブです。</font><font style="vertical-align: inherit;">したがって、ほとんどの場合、すべての種類のログとログにアクセスして、エラーが発生した場所とその内容を分析する必要があります。</font><font style="vertical-align: inherit;">悲しいが本当... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、Red Hatは根本的にアプローチを変更し、すでにメジャー4バージョンではCoreOSオペレーティングシステムが使用されています。これは、プラットフォームのインストールと同時にノードに展開できます。</font><font style="vertical-align: inherit;">とてもクールですが、それについては別の機会に説明します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、この「インストール」はどこにありますか？</font></font></h3><br>
<pre><code class="bash hljs"><span class="hljs-comment"># ansible-playbook -i host-poc.yaml /openshift-ansible/playbooks/prerequisites.yml</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開始後、プレイブックには約15分かかります（これがエラーですぐにクラッシュしない場合は、笑）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完了すると、Ansibleは実装の簡単な概要を表示します。</font><font style="vertical-align: inherit;">このようなタイプでは、数だけが多くなります。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/9ce/f67/5be/9cef675be0c1c188cb1beea12422b394.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インベントリファイルの各ホストには、プレイブックのグループからのタスク（タスク）の数が含まれます。</font><font style="vertical-align: inherit;">つまり、これらは設定手順です。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ok-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホスト上の特定の変数の値は、プレイブックの値と一致します。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ホスト上の指定した変数の値は、脚本の値と一致しませんでしたし、変更されました。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失敗しました</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -指定された変数を変更することはできません。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">skipped-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定された変数の値を</font><b><font style="vertical-align: inherit;">スキップしました</font></b><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失敗した場合は、タスクに関する情報とエラーが発生した変数が要約に追加されます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.プレイブックdeploy_cluster.ymlを実行します</font></font></h3><br>
<pre><code class="bash hljs"><span class="hljs-comment"># ansible-playbook -i host-poc.yaml /openshift-ansible/playbooks/deploy_cluster.yml</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイブックの実行に失敗した場合、Ansibleはランタイムデバッグモードを提供します。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スイッチを使用してプレイブックを実行することで開始でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">例えば：</font></font><br>
<br>
<pre><code class="bash hljs"> <span class="hljs-comment"># ansible-playbook -i host-poc.yaml /openshift-ansible/playbooks/deploy_cluster.yml –v</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、Ansibleは各タスクの詳細を表示します。</font><font style="vertical-align: inherit;">粒度を上げるには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプションスイッチを追加します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">詳細を最大限にするには、5つのキーを指定します（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-vvvvv</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイブックが完了したら、すべてが正常に機能したかどうかを確認して、（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">master.okd.loca</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l上の）</font><font style="vertical-align: inherit;">クラスターノードステータスコマンドの出力を支援します</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># oc get nodes</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And-and-and-and ... </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/397/05c/5d5/39705c5d57576e31445b19045c093b74.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. Webインターフェースへのアクセス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Webインターフェースにアクセスするためのクラスターを正常にインストールした場合は、マスターノードのIPアドレスを指定する必要があります。</font><font style="vertical-align: inherit;">ホストmaster.okd.local：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 10.31.xxx console.okd.localに</font><font style="vertical-align: inherit;">登録しました</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、コンソールのWebインターフェイスは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https：//console.okd.local：8443</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で利用できるようになります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a8e/69c/c99/a8e69cc999e0f544bb4468f47f72fb24.jpg" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WABA-LABA-DAB-DAB！</font><font style="vertical-align: inherit;">クラスタがインストールされました！</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c84/baf/1ad/c84baf1adaa62e35bb40d4b178e59cb9.png" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ちょっとした回顧と問題</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイブックを使用したインストールについて：最初のプレイブックを開始し、喫煙し、お茶を注ぎ、それが正常に完了した後、約10〜15分後に、2番目のクラスターデプロイメントを起動します。もちろん、これはすでに太っているので、食べることもできます。その瞬間、火曜日の夜の10時に、オフィスからshawarmaカフェに行き、露店にソーダのために立ち寄り、shawarmaを長引かせてオフィスに戻りました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、2番目のプレイブックの最後に、oc get nodesコマンドの出力には、準備完了ステータスのすべてのノードが表示され、Webコンソールが利用可能でした... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、そして...いいえ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行の過程で、たとえば次のような暗黙の問題が発生する可能性があり</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。1.インベントリファイルに次のようなパラメータがあります</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。openshift_disable_check </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の場合、それは重要です：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
= memory_availability、disk_availability、package_availability、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker_image_availability</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、docker_storage、package_version </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
太字のパラメーターを追加しました。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。それは人生にあったように</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、前提条件の脚本が実行されると、ハンドラでチェックドッカー画像可用性の段階があり、指定されたパラメータが期待値を受信するまで、それが数回繰り返される-これはAnsibleのコンテキストです。実際には、Dockerデーモンがパブリックレジストリで何らかの理由で利用できないイメージを探していたことが起こりました。変数の混乱と、プレイブックからプレイブックへのリンクのため、その時点で目的を見つけることができませんでした。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">判明したこと</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像の内部レジストリのコンソールの画像でした。 OpenShiftには画像レジストリ自体があり、そこに画像を保存できます。また、コンテンツの表示に便利なこのレジストリ用のWebインターフェイスであるコンソールがあります。このコンソールの画像は使用できないことが判明し、それ自体は機能しませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、必要に応じて、新しいイメージを見つけて、コンソールのデプロイメント構成で古いイメージと置き換え、このコンソールを再作成する必要がありました。インストール時にこれを知らなかったので、例外にチェックを追加して、プレイブックが次に何をするかを確認することにしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、OpenShiftをプレイブックからロールアウトするときに発生する可能性のある予期しない問題のベクトルを示す1つの例にすぎません。もちろん、2つのプレイブックを起動した後にすべてがそれ自体でOKになるようにインストールを自動化しようとするアイデア自体については、悪いことは何も言えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
悲しみが半分になり、プレイブックの前提条件が正常に完了したので、私は自分にヴァロコルディンを投げ、デプロイクラスタープレイブックを載せました。ここでもすべてがスムーズに行きませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. SDNネットワークプラグインが機能していないというエラーが発生しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一連の変数と他のプレイブックへのリンクがぎっしり詰まった一連のプレイブックを介して展開することの主な困難は、エラーの原因を見つけることの難しさでした。たとえば、SDNプラグイン（プラットフォームの内部仮想ネットワーク）をインストールする段階で、Ansibleがエラーを報告しました。将来のマスターのマシンのログには、ネットワークにアクセスできないことに関する多くのエラーがありました。後で判明したように、問題はDNSゾーン構成のタイプミスでした。プレイブックでは、APIサーバーは、インベントリから設定されたドメイン名によって可用性がチェックされました。 DNSゾーン構成で、FQDN名のスペルが誤っており、DNSがそれを解決しませんでした。その結果、マスターのAPIサーバーは利用できず、プレイブックはネットワークプラグインエラーとして解釈しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は知っています、彼自身はkrivorukyですが、DNSログ、マスターノードに深く入り込み、それらの間のホストの可用性を手動でチェックすることによってのみ、彼はなんとかエラーをキャッチできました...</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/669/f1f/40c/669f1f40cbdae74f0874e410a5966214.jpg" alt="画像"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合計</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
展開方法が悪いと言っているのではありません。</font><font style="vertical-align: inherit;">インストール中、特に複数のマシンで、特に抽象化のいくつかのレベルで、何をしているのか理解していないときにエラーをキャッチすることは非常に問題があると私は主張します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、エラーが検出されて修正され、インストールプロセスが完了し、プラットフォームを使用できます。</font><font style="vertical-align: inherit;">彼女が私たちに提供できるものを見てください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はこの意見を聞いた：</font></font><blockquote><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「裸のKubernetesを使用して、メトリックコレクションとモニタリングツール、アーティファクトストレージ、CIシステム、およびその他の多くの優れた機能をハングアップできるため、組織のすべての開発要件を満たすシステムを構築できます。</font><font style="vertical-align: inherit;">これは、これらすべての長期保守の問題が発生するまでは、非常に良いことです。</font><font style="vertical-align: inherit;">Red Hat OpenShiftは優れており、そのコンポーネントはデバッグされ、互いに友好的であり、それに加えてベンダーサポートがあります。</font><font style="vertical-align: inherit;">一部のコンポーネントの更新によりスレンダーシステムが壊れた場合、その根本に立ち入る必要はありません。機能のリクエストに対応できるベンダーがいます。」</font></font></i></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、それはかなりいいですね。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
箱から出してすぐに：</font></font><br>
<br>
<ul>
<li><b>  .</b> , ,  ,  RBAC (Role Based Access Control)     .</li>
<li><b>      - :</b> /,   ,  .</li>
<li><b>CI-.</b> ,    ,  ,  ,      .</li>
<li><b>    Prometheus  Grafana. </b>, , .</li>
<li><b>   </b>, ,            . </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、オフトピックとして、私はRed Hat OpenShift 4thバージョンのいくつかの変更点に注意する必要があります（私のOpsの同僚による詳細なレビューは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には多くの違いがありますが、最初に遭遇するのはインストールプロセスです。次に、ベンダーはアプローチを根本的に変更し、Ansibleを使用するという考えを放棄しました。代わりに、</font><b><font style="vertical-align: inherit;">CoreOS</font></b><font style="vertical-align: inherit;">イメージのホストにインストールする方法を使用します</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これはRed Hatのオペレーティングシステムであり、ベンダーによって軽量、クラスター展開用に特別に強化されたものとして位置付けられており、アプリケーションがコンテナーで機能するために最低限必要な機能を備えています。システムはPxEサーバーを使用して注がれ、そこからすべての構成が展開プロセス中にプルアップされます。一般に、インストールプロセスは基本的に、すべての構成を準備する段階と、すべてが展開されるまで待機するフェーズで構成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちなみに、OpenShift 4.xクラスター自体は、ほぼすべてのコンテナーで機能し、新しいエンティティー（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オペレーター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を備えています。コンテナーは、アプリケーションと共に他のコンテナーをデプロイし、常にそのパフォーマンスを監視できます。しかし、Red Hat自体からこれについての記事があります:)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、私の友達、ここに一緒にいてシステムをインストールしました。</font><font style="vertical-align: inherit;">今、あなたは息を吐き、自分を賛美することができます。</font><font style="vertical-align: inherit;">別の記事では、いわゆる「2日目の操作」、つまりインストール後に構成する価値のあるものについて扱います。</font><font style="vertical-align: inherit;">もちろん、セキュリティ機能は無視しません。セキュリティコンテキストの制約とネットワークポリシーについて説明し、アプリケーションを展開する前に手を洗う必要がある理由を説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つづく。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS私は皆にDevSecOpsトークチャンネル（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tlgg.ru/devsecops_weekly）で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DevSecOpsについて話すことを</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">勧め</font></a><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">そこで、チームと私はこのトピックに関する興味深いレビュー、役立つリンクを共有し、安全な開発の文化の発展に貢献しています。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja503606/index.html">Swift 5.3：新機能</a></li>
<li><a href="../ja503608/index.html">ウイルスフィルターの検索方法</a></li>
<li><a href="../ja503610/index.html">Web用に独自のLispを作成してみませんか？</a></li>
<li><a href="../ja503612/index.html">Kubernetesのベストプラクティス。外部サービスのマッピング</a></li>
<li><a href="../ja503616/index.html">プロトタイプのロボットマーチャンダイザーの作成方法と次のステップ</a></li>
<li><a href="../ja503620/index.html">OpenStreetMap No. 512の世界からのニュース（2020年5月5日〜2020年5月11日）</a></li>
<li><a href="../ja503624/index.html">先週のフロントエンドの世界からの新鮮な食材のダイジェストNo. 416（2020年5月18〜24日）</a></li>
<li><a href="../ja503626/index.html">テスト。ISTQB認定エラーまたは100万例の解決</a></li>
<li><a href="../ja503630/index.html">拡張現実メガネ：私たちは今どこにいますか？</a></li>
<li><a href="../ja503632/index.html">1000と1の投稿：ハッピーバースデー、Habr❤</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>