<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤞 🚶🏻 👩‍🔬 Features of designing a data model for NoSQL ✊🏼 😆 🐛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction
 

 “You need to 
 run as fast just to stay in place, but to get somewhere, you must run at least twice as fast!” 
 (c) Alice in Wonderla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Features of designing a data model for NoSQL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/504166/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br>
<p><img src="https://habrastorage.org/webt/ya/bi/xa/yabixavvniqzjcvm7ra_igpanqa.png" align="left"> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“You need to </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
run as fast </font><font style="vertical-align: inherit;">just to stay in place, </font><font style="vertical-align: inherit;">but to get somewhere, you must run at least twice as fast!” </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(c) Alice in Wonderland</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some time ago I was asked to give a lecture </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> our company’s </font><strong><font style="vertical-align: inherit;">analysts</font></strong><font style="vertical-align: inherit;"> on the topic of designing data models, because when we sit on projects for a long time (sometimes for several years) we lose sight of what is happening around the IT world. In our company (it just so happened), NoSQL databases are not used on many projects (at least for now), so in my lecture I separately paid some attention to them using the HBase example and tried to orient the presentation of the material on those who never worked. In particular, I illustrated some features of data model design using an example that I read several years ago </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the article “Introduction to HB ase Schema Design” by Amandeep Khurana</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Analyzing the examples, I compared among themselves several options for solving the same problem in order to better convey to the audience the main ideas.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recently, “there’s nothing to do”, I wondered (long May weekends in quarantine mode are especially suitable for this), how much theoretical calculations will correspond to practice? </font><font style="vertical-align: inherit;">Actually, the idea of ​​this article was born. </font><font style="vertical-align: inherit;">A developer who has been working with NoSQL for several days may not learn anything new from it (and therefore can immediately spend half a hundred). </font><font style="vertical-align: inherit;">But for </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analysts</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> who have not yet worked closely with NoSQL, I think it will be useful for getting a basic understanding of the design features of data models for HBase.</font></font></p><a name="habracut"></a><br>
<h2 id="razbor-primera"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parsing an Example</font></font></h2><br>
<p>  ,     NoSQL  ,      «»  «».           .     NoSQL     .        NoSQL  ,   ,       .        ,          (  ). ,  «»        ,        .  NoSQL   <u>       </u>    .  ,    ,     .</p><br>
<p>  «» ,      :</p><br>
<blockquote>          .    ,       (  ,    Linkedin).    :<br>
<ul>
<li>  ,       ( ) </li>
<li> /    /      (  )</li>
</ul><br>
</blockquote><p> ,    .              (, , , ,    : ,   ..,     «»),        /.         :</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>user_id</th>
<th>friend_id</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table></div><br>
<p><em>         ID   </em></p><br>
<p>    HBase  , :</p><br>
<ul>
<li> ,    full table scan,  <u>  </u><br>
<ul>
<li><em>,     SQL-    –  ; , ,      Impala  SQL-  Join’     HBase,      …</em></li>
</ul></li>
</ul><br>
<p> ID      .      «    ID ?»       .     «»      (  <strong> 1 (default)</strong>,    ):</p><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<th>RowKey </th>
<th colspan="3"></th>
</tr>
<tr>
<td></td>
<td>1: </td>
<td>2: </td>
<td>3: </td>
</tr>
<tr>
<td> </td>
<td>1:  </td>
<td>2: </td>
<td></td>
</tr>
</tbody>
</table></div><br>
<p>      .   : 1, 2, … —   ,     ID .  ,        .           (1, 2  3),   –   (1  2) –       HBase,     :</p><br>
<ul>
<li>     (  -&gt;  ,   -&gt;  )</li>
<li>       </li>
</ul><br>
<p>      :</p><br>
<ul>
<li><strong> </strong>:  ,  ,     ,     <u> </u>   RowKey = «»    ,   «»   .     , « »     False;</li>
<li><strong> :  </strong>:         <u> </u>   RowKey = «»,      .   -   ,    ,     ID  .</li>
<li><strong> :  </strong>:<br>
<ul>
<li>  <u> </u>   RowKey = «»     ,    ,     ;</li>
<li> ,   ,  «»     ,    «»   .</li>
</ul></li>
</ul><br>
<p>  ,   ,        « »,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">-</a>.        n.          (n-1).  (-1)        ,      -  .</p><br>
<ul>
<li><strong> </strong>:           .       (n)</li>
<li><strong> :  </strong>:         ,      =&gt; (n)</li>
<li><strong> :  </strong>:<br>
<ul>
<li>  –       =&gt; (n)</li>
<li>     «» .    « »,       (n-1) .           ,    «-»   -  –            n.    (  ,  (2))    (n)  .     :      «»   ,     ,     :<br>
<img src="https://habrastorage.org/webt/4g/oq/up/4goqupih9lvnzijmoigisvgkxck.jpeg"></li>
</ul></li>
</ul><br>
<p>,         O(n).<br>
,   ,           ,         ,        - .         «count»,         .              - ,      «count». ,    «count»    . ..   <strong> 2 (count):</strong></p><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<th>RowKey</th>
<th colspan="4"></th>
</tr>
<tr>
<td></td>
<td>1: </td>
<td>2: </td>
<td>3: </td>
<td>count: 3</td>
</tr>
<tr>
<td></td>
<td>1: </td>
<td>2: </td>
<td></td>
<td>count: 2</td>
</tr>
</tbody>
</table></div><br>
<p>    :</p><br>
<ul>
<li><strong> </strong>:      «   ?»    =&gt; (n)</li>
<li><strong> :  </strong>:     ,             ,       «count»  ..        .        (1)</li>
<li><strong> :  </strong>:          ,     -  «»     .       ,   ,   ,  =&gt; O(n)</li>
<li>  ,            «count»,      ,    -  </li>
</ul><br>
<p>   2    ,    «  ».   «»   <strong> 3 (col)</strong>.<br>
  «   »:  <u>   </u>!       –      ,    1 (,     , ,  «// ..»).      «»,         NoSQL-,       HBase     :</p><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<th>RowKey</th>
<th colspan="3"></th>
</tr>
<tr>
<td></td>
<td>: 1</td>
<td>: 1</td>
<td>: 1</td>
</tr>
<tr>
<td></td>
<td>: 1</td>
<td>: 1</td>
<td></td>
</tr>
</tbody>
</table></div><br>
<p>     .   ,       :</p><br>
<ul>
<li><strong> </strong>:  ,    ,     ,     «»:   ,   True,   – False =&gt; O(1)</li>
<li><strong> :  </strong>:  :      «ID » =&gt; O(1)</li>
<li><strong> :  </strong>:     «ID » =&gt; O(1)</li>
</ul><br>
<p> ,       ,           ,         ,     .      , …</p><br>
<p>              -    .            ?       userID.friendID?            (<strong> 4(row)</strong>):</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>RowKey</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>: 1</td>
</tr>
<tr>
<td>.</td>
<td>: 1</td>
</tr>
<tr>
<td>.</td>
<td>: 1</td>
</tr>
<tr>
<td>.</td>
<td>: 1</td>
</tr>
<tr>
<td>.</td>
<td>: 1</td>
</tr>
</tbody>
</table></div><br>
<p>,           ,       (1).    3       -  .</p><br>
<p>   «».  ,    4        , , ,     ( ,  HBase            ).     ,       .    ,     userID  friendID,         ,     ,  .        (<strong> 5(hash)</strong>):</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th>RowKey</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>dc084ef00e94aef49be885f9b01f51c01918fa783851db0dc1f72f83d33a5994</td>
<td>: 1</td>
</tr>
<tr>
<td>dc084ef00e94aef49be885f9b01f51c0f06b7714b5ba522c3cf51328b66fe28a</td>
<td>: 1</td>
</tr>
<tr>
<td>dc084ef00e94aef49be885f9b01f51c00d2c2e5d69df6b238754f650d56c896a</td>
<td>: 1</td>
</tr>
<tr>
<td>1918fa783851db0dc1f72f83d33a59949ee3309645bd2c0775899fca14f311e1</td>
<td>: 1</td>
</tr>
<tr>
<td>1918fa783851db0dc1f72f83d33a5994dc084ef00e94aef49be885f9b01f51c0</td>
<td>: 1</td>
</tr>
</tbody>
</table></div><br>
<p>,           ,   ,    4 –   (1).<br>
,         :</p><br>
<div class="scrollable-table"><table>
<tbody>
<tr>
<th></th>
<th> </th>
<th> </th>
<th> </th>
</tr>
<tr>
<td> 1 (default)</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td> 2 (count)</td>
<td>O(1)</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td> 3 (column)</td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td> 4 (row)</td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td> 5 (hash)</td>
<td>O(1)</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody>
</table></div><br>
<p> ,  3-5                .             ,      ,   ,   «»,       « ».       3.   ,            ,           .</p><br>
<h2> </h2><br>
<p>        –         .        « »      ,           (n).  ,           ,  ,  « »,    «-».  «-»     :</p><br>
<ul>
<li>   </li>
<li>,       </li>
<li>  </li>
</ul><br>
<p> ,       ,    :</p><br>
<ul>
<li><strong> </strong>.       n.     " "      –    .  ,    « »   HBase   .          –        «-»</li>
<li><strong> </strong>.      «»,     ,       .   =  -  ,         «»,     – «».     ,   «»  «»  (              1  2).                 .</li>
<li><strong> </strong>.     .    –  (  «»  ,    ).                .</li>
</ul><br>
<p>      5         ,  ,      .    n          , ,    5 .<br>
         n= 5.  «»      ID-:</p><br>
<ul>
<li> –  </li>
<li> –  </li>
<li> –  </li>
</ul><br>
<pre><code class="python hljs">{<span class="hljs-number">0</span>: [<span class="hljs-number">1</span>], <span class="hljs-number">1</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], <span class="hljs-number">2</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], <span class="hljs-number">3</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>], <span class="hljs-number">4</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">1</span>]} <span class="hljs-comment">#  15 </span><font></font>
<font></font>
{<span class="hljs-number">0</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">10800</span>], <span class="hljs-number">1</span>: [<span class="hljs-number">5</span>, <span class="hljs-number">10800</span>, <span class="hljs-number">2</span>, <span class="hljs-number">10801</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10802</span>], <span class="hljs-number">2</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">10800</span>], <span class="hljs-number">3</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">10800</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10801</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10802</span>], <span class="hljs-number">4</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">10800</span>]} <span class="hljs-comment">#  18  </span><font></font>
<font></font>
{<span class="hljs-number">0</span>: [<span class="hljs-number">1</span>], <span class="hljs-number">1</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>], <span class="hljs-number">2</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], <span class="hljs-number">3</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>], <span class="hljs-number">4</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]} <span class="hljs-comment">#  15 </span>
</code></pre><br>
<p>  ,  ID,  10 000     –    ,     False. ,    «»       .</p><br>
<p>      Windows 10,    -    HBase,    – Python  Jupyter Notebook.    2  CPU  2   .  ,     « »,   «»           Python.    HBase   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">happybase</a>,    (MD5)   5 — hashlib</p><br>
<p>           n = 10, 30, …. 170 –        (       n)   -        (  15 ).</p><br>
<p>   ,             .           .           n,        « »   , «»      ,   (     ).</p><br>
<h2> </h2><br>
<p>  –   ,     .  –   .<br>
<img src="https://habrastorage.org/webt/ne/ic/ch/neicch80pil-0znkkdbpyt9w0vw.png"><br>
 3-5      «-»,            .<br>
 2   ,    ,     2    3-5.      ,      –      - / HBase    2  .     ,         .<br>
 1              ,     .<br>
    .<br>
<img src="https://habrastorage.org/webt/i1/ud/f8/i1udf8elt8rpxe5n1ell55a6uu8.png"><br>
 3-5      –  ,     .  1  2           .   2    –    -       «count»,    n   .       - ,       .  ,   ( , 1  2, )      (      "   ").</p><br>
<p>    –   .</p><br>
<p><img src="https://habrastorage.org/webt/xx/w0/bn/xxw0bntvsixft4ifp458kuduhnc.png"></p><br>
<p>    .  3-5     .<br>
,  ,  4  5,     ,     ,   3.   ,    –  ,    ,    .</p><br>
<p> 1  2, ,    .    2    1 – -   -  «»  count.</p><br>
<p><strong>  :</strong></p><br>
<ul>
<li> 3-5   ,      HBase;                . </li>
<li>   4  5   .    ,   5   .  ,             .</li>
<li>  ,    «-»  ,          .</li>
</ul><br>
<h2 id="epilog"></h2><br>
<p>        .   ,          (          ). ,   thrift,   happybase,     ,       Python (  ,           ),    HBase,   Windows 10     ..    ,        .         «  »  .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In conclusion - recommendations for anyone who is just starting to design data models in HBase: abstract from previous experience with relational databases and remember the “commandments”:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When designing, we go from the task and data manipulation patterns, and not from the domain model</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Effective access (without full table scan) - only by key</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denormalization</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Different lines may contain different columns</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The dynamic composition of the columns</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504152/index.html">Backup for thousands of virtual machines with free tools</a></li>
<li><a href="../en504154/index.html">How to protect your data from theft, crossover Levelord and build a career in IT, if you have a shiz</a></li>
<li><a href="../en504160/index.html">Communication revolution? A new approach allows you to save bandwidth of 100 or more times with audio and video calls</a></li>
<li><a href="../en504162/index.html">Phones that created the design story</a></li>
<li><a href="../en504164/index.html">Minitel: French Internet Cousin</a></li>
<li><a href="../en504176/index.html">[Launch postponed to May 30 due to weather conditions] Historical launch of Demo-2: today SpaceX will send people to the ISS</a></li>
<li><a href="../en504180/index.html">The tale of how we tamed BigQuery</a></li>
<li><a href="../en504182/index.html">Reviewix Solution500 C500 3D Scanner</a></li>
<li><a href="../en504184/index.html">Creating a trading bot using machine learning in time series analysis</a></li>
<li><a href="../en504186/index.html">Paul Graham: How to Write Useful Texts (Full)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>