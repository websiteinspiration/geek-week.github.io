<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😁 👋🏻 🦏 VRRPの仕組み 👊🏼 🙇🏼 🚬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="FHRP（First Hop Redundancy Protocol）は、デフォルトゲートウェイの冗長性を作成するように設計されたプロトコルのファミリです。これらのプロトコルの一般的なアイデアは、複数のルーターを1つの仮想ルーターに結合し、共通のIPアドレスを使用することです。このIPアドレスは、デ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>VRRPの仕組み</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452490/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FHRP（First Hop Redundancy Protocol）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、デフォルトゲートウェイの冗長性を作成するように設計されたプロトコルのファミリです。</font><font style="vertical-align: inherit;">これらのプロトコルの一般的なアイデアは、複数のルーターを1つの仮想ルーターに結合し、共通のIPアドレスを使用することです。</font><font style="vertical-align: inherit;">このIPアドレスは、デフォルトゲートウェイアドレスとしてホストに割り当てられます。</font><font style="vertical-align: inherit;">このアイデアの無料の実装は、VRRPプロトコル（仮想ルーター冗長プロトコル）です。</font><font style="vertical-align: inherit;">この記事では、VRRPの基本について説明します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/sz/zd/2u/szzd2u6mzizcvujixh0a4gcfcek.png" width="50%"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRRPルーターは1つの仮想ルーターに結合されます。グループ内のすべてのルーターには、共通の仮想IP（VIP）アドレスと、共通のグループ番号またはVRID（仮想ルーター識別子）があります。 1つのルーターは複数のグループで構成でき、各グループには独自の一意のVIP / VRIDペアが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ciscoの場合、次のコマンドを使用して、対象のインターフェイスに仮想ルータを設定します。</font></font><br>
<br>
<pre><code class="plaintext hljs">R1(config-if)# vrrp &lt;group-number&gt; ip &lt;ip-address&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのルーターは、VRRPマスターとVRRPバックアップの2つのタイプに分類されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VRRPマスター</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、この仮想グループのパケットを転送するルーターです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VRRPバックアップ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、マスターからのパケットを期待するルーターです。</font><font style="vertical-align: inherit;">マスターからのパケットの到着が停止すると、バックアップはマスター状態への切り替えを試みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
優先順位が最も高い場合、ルーターはマスターになります。</font><font style="vertical-align: inherit;">マスターは常にブロードキャストアドレス224.0.0.18にメッセージを送信して、動作していることをバックアップルータに通知します。</font><font style="vertical-align: inherit;">マスターはAdver Timerに従ってメッセージを送信します。デフォルトは1秒です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ut/sg/6v/utsg6vtqy9gxnhtvafqgkyb-bp8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、グループアドレス00：00：5E：00：01：xxが送信者のMACアドレスとして使用されます。ここで、xxは16進形式のVRIDです。</font><font style="vertical-align: inherit;">この例では、最初のグループが使用されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/u5/ft/qmu5ft8lqoritvw_l35f9k9vsge.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップルーターが3つのアドバータイマー（マスターダウンタイマー）内でメッセージを受信しない場合、最高の優先度を持つルーター、または最高のIPを持つルーターが新しいマスターになります。</font><font style="vertical-align: inherit;">この場合、優先度の高いバックアップルータが、優先度の低いマスターの役割を引き継ぎます。</font><font style="vertical-align: inherit;">ただし、プリエンプトモードでバックアップが無効になっている場合、バックアップはマスターからの役割をインターセプトしません。</font></font><br>
<br>
<pre><code class="plaintext hljs">R1(config-if)# no vrrp &lt;group-number&gt; preempt</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRRPルーターがVIPアドレスの所有者である場合は、常にマスターの役割を傍受します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRRP優先度は1から254の値で設定されます。値0は、マスターが</font><font style="vertical-align: inherit;">ルーティングの責任</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を軽減する</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要がある場合のために予約され</font><font style="vertical-align: inherit;">ています。</font><font style="vertical-align: inherit;">値255は、ルーターによってVIP所有者に設定されます。</font><font style="vertical-align: inherit;">デフォルトの優先度は100ですが、管理者が設定できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">R1(config-if)#vrrp &lt;group-number&gt; priority &lt;priority 1-254&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、管理上設定されているルーターの優先度を確認できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fl/rh/wa/flrhwae7lljtqonb6gu2tys7biw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これがルーターがVIPの所有者である場合です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yi/ih/pq/yiihpqi0fm9e8vhfq8jvxfiat5i.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRRPルーターには、初期化、バックアップ、マスターの3つの状態があります。</font><font style="vertical-align: inherit;">これらは、ルーターが順番に変化することを示しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期化状態では、ルーターは操作の開始を待機しています。</font><font style="vertical-align: inherit;">このルーターがVIPアドレスの所有者である場合（優先度は255）、ルーターはマスターになるメッセージを送信します。</font><font style="vertical-align: inherit;">また、送信</font><font style="vertical-align: inherit;">元MACアドレスが仮想ルーターのアドレスと等しい</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無償ARP要求</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も送信し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">その後、マスター状態になります。</font><font style="vertical-align: inherit;">ルータがVIPを所有していない場合、バックアップ状態になります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/x0/00/zj/x000zjajnzimlqk9mbk5blegjfi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップ状態では、ルーターはマスターからのパケットを予期します。この状態のルータは、VIPアドレスからのARP要求に応答しません。また、仮想ルーターのMACアドレスを宛先アドレスとするパケットは受け入れません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Backupがマスターダウンタイマー中にマスターからメッセージを受信しない場合、マスターになることを示すVRRPメッセージを送信します。次に、送信元MACアドレスがこの仮想ルーターのアドレスと等しいブロードキャストVRRPメッセージを送信します。このメッセージでは、ルーターがその優先順位を示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マスター状態では、ルーターは仮想ルーター宛てのパケットを処理します。 VIP ARP要求にも応答します。マスターは、アドバータイマーごとにVRRPメッセージを送信して、実行中であることを確認します。</font></font><br>
<br>
<pre><code class="plaintext hljs">*May 13 19:52:18.531: %VRRP-6-STATECHANGE: Et1/0 Grp 1 state Init -&gt; Backup<font></font>
*May 13 19:52:21.751: %VRRP-6-STATECHANGE: Et1/0 Grp 1 state Backup -&gt; Master</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRRPを使用すると、複数のルーター間で負荷を分散することもできます。これを行うには、2つのVRRPグループを同じインターフェイス上に作成します。あるグループには別のグループよりも高い優先順位が与えられます。同時に、優先度は2番目のルーターで逆に設定されます。それら。一方のルーターで最初のグループの優先度が100で2番目のグループが200の場合、もう一方のルーターでは最初のグループの優先度は200で2番目のグループは100になります</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。その結果、2つのルーターがサービスを提供する2つのIPアドレスが取得され、それぞれがデフォルトゲートウェイとして機能します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ip/np/2-/ipnp2-gzm3uqbct5eglgwkqgwui.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンピュータの半分にはデフォルトゲートウェイアドレスが1つ割り当てられ、他の半分には割り当てられます。</font><font style="vertical-align: inherit;">したがって、トラフィックの半分は1つのルーターを通過し、残りの半分は別のルーターを通過します。</font><font style="vertical-align: inherit;">ルーターの1つに障害が発生すると、2番目のルーターが両方のVIPの動作を傍受します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ej/8l/m9/ej8lm9a_xlwhqnqw-zkh6ldpms8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、VRRPを使用すると、デフォルトゲートウェイのフォールトトレランスを整理して、ネットワークの信頼性を高めることができます。</font><font style="vertical-align: inherit;">また、複数の仮想ルーターを使用する場合は、実際のルーター間で負荷を分散することができます。</font><font style="vertical-align: inherit;">タイマーを減らすことで、障害応答率を下げることができます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja452468/index.html">«Если вам нужно кого-то убить, то вы обратились по адресу»</a></li>
<li><a href="../ja452474/index.html">ウェーブレット分析。パート2</a></li>
<li><a href="../ja452478/index.html">Figma設計システムでのテーブルの作成とStorybook（React）での実装</a></li>
<li><a href="../ja452480/index.html">フェニックスライブビュー：JavaScriptが不要になったとき*</a></li>
<li><a href="../ja452486/index.html">コンセンサスは嘘です</a></li>
<li><a href="../ja452492/index.html">ヘビを分解する</a></li>
<li><a href="../ja452494/index.html">MIMO空間ダイバーシティ：Alamouti、DET、その他の空間ダイバーシティ</a></li>
<li><a href="../ja452496/index.html">他に何が放送されているのですか？HF放送（DXing）</a></li>
<li><a href="../ja452502/index.html">モバイル＃298開発者向けの興味深い資料のダイジェスト（5月13〜19日）</a></li>
<li><a href="../ja452506/index.html">陛下の粘土についての作品。パート3-ポリウレタンvsスペースコールド</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>