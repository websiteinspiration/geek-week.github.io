<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♥️ 🥠 👩🏽‍✈️ アルファバンクの投資ビジネスの中核をどのようにしてタランツールに基づいて実行したか 🍸 👩‍⚕️ 📤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="映画「私たちの秘密の宇宙：細胞の隠された生命」からのショット
 
 ローン、ローン、預金だけでなく、証券、通貨、商品、デリバティブや構造製品の形であらゆる種類の困難。
 
 最近、私たちは人口の金融リテラシーの増加を見てきました。ますます多くの人々が証券市場での取引に関与しています。個人投資勘定はそ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>アルファバンクの投資ビジネスの中核をどのようにしてタランツールに基づいて実行したか</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/495326/"><img src="https://habrastorage.org/webt/tc/or/26/tcor26cmqrsph9b0nioj_ic4cwa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映画「私たちの秘密の宇宙：細胞の隠された生命」からのショット</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ローン、ローン、預金だけでなく、証券、通貨、商品、デリバティブや構造製品の形であらゆる種類の困難。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、私たちは人口の金融リテラシーの増加を見てきました。ますます多くの人々が証券市場での取引に関与しています。個人投資勘定はそれほど昔に登場しませんでした。彼らはあなたが証券市場で取引することを可能にし、同時に税控除を受けるか税金を払わないかのどちらかを可能にします。そして、私たちを訪れるすべての顧客は、ポートフォリオを管理し、リアルタイムのレポートを見たいと考えています。さらに、ほとんどの場合、このポートフォリオはマルチ製品です。つまり、人々はさまざまなビジネスラインの顧客です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、ロシアと外国の両方の規制当局の要件が高まっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在のニーズに対応し、将来のアップグレードの基礎を築くために、タランツールに基づいた投資ビジネスの中核を開発しました。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかの統計。</font><font style="vertical-align: inherit;">Alfa-Bankの投資事業は、個人および法人がさまざまな証券市場で取引する機会を提供する仲介サービス、証券の保管のための保管サービス、個人および大資本を持つ個人向けの信託管理サービス、証券発行サービスを提供しています他の会社。</font><font style="vertical-align: inherit;">Alfa-Bankの投資ビジネスは、毎秒3,000クォートを超え、さまざまな取引プラットフォームからダウンロードされます。</font><font style="vertical-align: inherit;">営業日に、銀行またはその顧客に代わって市場で30万件を超えるトランザクションが成立します。</font><font style="vertical-align: inherit;">外部および内部プラットフォームでは、1秒あたり最大5000オーダーが実行されます。</font><font style="vertical-align: inherit;">同時に、社内外のすべての顧客は、自分のポジションをリアルタイムで確認したいと考えています。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンド</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2000年代の初めからどこかで、私たちの投資ビジネスの領域は独立して発展しました：取引所取引、仲介サービス、通貨取引、証券の店頭取引およびさまざまなデリバティブ。その結果、私たちは機能的な井戸の罠に陥りました。それは何ですか？各事業部門には、お互いの機能を複製する独自のシステムがあります。各システムには独自のデータモデルがありますが、トランザクション、商品、取引相手、見積もりなど、同じ概念で動作します。そして、各システムが独立して開発されたため、さまざまな技術の動物園が生まれました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、一部の製品は1990年代半ばに開発されたため、システムのコードベースはすでに古くなっています。また、一部の領域では、開発プロセスが遅くなり、生産性に問題がありました。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいソリューション要件</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビジネスは、技術開発がさらなる発展のために不可欠であることを認識しました。</font><font style="vertical-align: inherit;">タスクが割り当てられました：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてのビジネスデータを単一の高速ストレージと単一のデータモデルに収集します。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この情報を紛失または変更してはなりません。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">規制当局はいつでも過去数年間の統計を要求する可能性があるため、データをバージョン管理する必要があります。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいファッショナブルなDBMSを持ち込むだけでなく、ビジネス上の問題を解決するためのプラットフォームを作成する必要があります。 </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、私たちの建築家は彼らの条件を設定しました： </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいソリューションはエンタープライズクラスである必要があります。つまり、一部の大企業ですでにテストされているはずです。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソリューションの動作モードはミッションクリティカルでなければなりません。</font><font style="vertical-align: inherit;">つまり、複数のデータセンターに同時に存在し、1つのデータセンターの切断を落ち着いて体験する必要があります。</font></font></li>
<li>    .   ,        ,       -    .   ,         . </li>
<li>    ,     . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準的な方法で要件を策定し、調達部門に連絡しました。そこから、一般的に、これを実行する準備ができている企業のリストを取得しました。彼らは全員にタスクについて話し、6人が解決策の評価を受けました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
銀行では誰の言葉も信じていません。すべてを自分でテストするのが大好きです。したがって、私たちの入札競争の前提条件は、ストレステストに合格することでした。負荷のテストタスクを作成しましたが、すでに6社のうち3社が自己負担で、インメモリテクノロジーに基づいたプロトタイプソリューションを実装してテストすることに同意しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてをどのようにテストしたか、どのくらいの時間がかかったのかは説明しません。要約します。負荷テストでの最高のパフォーマンスは、Mail.ru Group開発チームのTarantoolベースのソリューションのプロトタイプによって示されました。</font><font style="vertical-align: inherit;">契約を結び、開発を開始しました。</font><font style="vertical-align: inherit;">Mail.ru Groupから4人、Alfa-Bankから3人の開発者、3人のシステムアナリスト、ソリューションアーキテクト、製品所有者、およびスクラムマスターがいました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、私たちのシステムがどのように成長したか、どのように進化したか、何をしたのか、そしてその理由についてお話します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、現在のシステムからデータを取得する方法を考えました。現在のすべてのシステムは互いに通信し、HTTPを介してXMLまたはJSONを送信するため、HTTPが非常に適していると判断しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
組み込みのTarantool HTTPサーバーを使用します。これは、SSLセッションを終了する必要がないため、そのパフォーマンスで十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、私たちはすべてのシステムが異なるデータモデルで動作しており、入力では、オブジェクトを自宅で説明するモデルに持ってくる必要があります。データを変換するには言語が必要でした。私たちは命令型Luaを選択しました。サンドボックスでデータ変換のためのすべてのコードを実行します-これは安全な場所であり、実行中のコードはそれを超えません。これを行うには、必要なコードのロードストリングを実行するだけで、何もブロックしたり、何かをドロップしたりできない関数を持つ環境を作成します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e3/04c/45f/4e304c45ff56974d624be577ebb8258d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
変換後、作成中のモデルに準拠しているかどうかデータを確認する必要があります。</font><font style="vertical-align: inherit;">私たちは長い間、モデルがどうあるべきか、それを説明するためにどの言語を使用すべきかについて議論しました。</font><font style="vertical-align: inherit;">言語はシンプルで、Tarantoolからのサポートがあるため、Apache Avroに立ち寄りました。</font><font style="vertical-align: inherit;">新しいバージョンのモデルとユーザーコードは、負荷がかかっていても、負荷がかかっていなくても、いつでも操作でき、変更にすばやく対応できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d28/172/bea/d28172beab19e37ef1fd30597d21d321.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確認後、データを保存する必要があります。</font><font style="vertical-align: inherit;">これは、vshardを使用して行います（シャードのジオスペースレプリカがあります）。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5a/619/7b4/d5a6197b44b2d8f1f43b33004241f221.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、詳細はデータを送信するほとんどのシステムでは、データを受信したかどうかは問題ではないということです。そのため、当初から修理ラインを導入しています。それは何ですか？なんらかの理由でオブジェクトがデータの変換または検証に合格しなかった場合でも、受信を確認しますが、同時にオブジェクトを修復キューに保存します。ビジネスデータと一緒にメインリポジトリに配置され、一貫しています。そのための管理インターフェイス、さまざまなメトリック、アラートをすぐに作成しました。その結果、データが失われることはありません。ソースで何かが変更されていても、データモデルが変更されていれば、すぐにそれを見つけて適応できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ad/2a7/c23/7ad2a7c235467068ccec89b9eb025b12.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、保存されたデータを取得する方法を学ぶ必要があります。システムを注意深く分析したところ、JavaとOracleのクラシックスタックには、リレーショナルビューからオブジェクトビューにデータを変換する何らかのORMが常に存在することがわかりました。では、なぜオブジェクトをグラフの形でシステムにすぐに渡さないのでしょうか。したがって、すべてのニーズを満たしたGraphQLを喜んで採用しました。それはあなたが今必要なものだけを引き出すために、グラフの形でデータを受け取ることを可能にします。十分な柔軟性を備えたAPIをバージョン管理することもできます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d90/636/a7a/d90636a7ac34c91eefd299a88d902d44.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すぐに、抽出されたデータでは不十分であることに気付きました。</font><font style="vertical-align: inherit;">モデル内のオブジェクト（実際には計算フィールド）にアタッチできる関数を作成しました。</font><font style="vertical-align: inherit;">つまり、フィールドに特定の関数をアタッチします。たとえば、見積の平均価格を考慮します。</font><font style="vertical-align: inherit;">そして、データを要求する外部の消費者は、このフィールドが計算されることすら知りません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f77/51f/ce9/f7751fce9a424fa80aba0c701cb9295e.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
認証システムを実装しました。 </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/768/d24/2f7/768d242f7825460594a79ff0c3e07449.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、私たちのソリューションにはいくつかの役割が具体化していることに気づきました。</font><font style="vertical-align: inherit;">ロールは、関数の一種のアグリゲーターです。</font><font style="vertical-align: inherit;">原則として、役割には機器の使用に関するさまざまなプロファイルがあります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T-Connect：着信接続を処理し、プロセッサによって制限され、メモリをほとんど消費せず、状態を保存しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IB-Core：Tarantoolプロトコルを介して受信したデータを変換します。つまり、タブレットで動作します。</font><font style="vertical-align: inherit;">また、状態を保存せず、スケーリングできます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレージ：データを保存するだけで、ロジックは使用しません。</font><font style="vertical-align: inherit;">この役割では、最も単純なインターフェースが実装されます。</font><font style="vertical-align: inherit;">vshardのおかげでスケーラブルです。</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/292/66e/613/29266e613da2a34c5df9463884873267.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、役割の助けを借りて、互いに独立してスケーリングできるクラスターの異なる部分を互いに切り離しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、トランザクションデータストリームと修復キューの非同期レコードを管理者インターフェイスで作成しました。</font><font style="vertical-align: inherit;">記録はビジネスの観点から非同期です。データを自分自身に記録することが保証されている場合は、どこにいてもこれを確認します。</font><font style="vertical-align: inherit;">確認されない場合、問題が発生したため、データを送信する必要があります。</font><font style="vertical-align: inherit;">これは非同期録音です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テスト中</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの最初から、テスト駆動開発を導入しようとすることが決定されました。私たちはtarantool / tapフレームワークを使用してLuaで単体テストを作成し、pytestフレームワークを使用してPythonで統合テストを作成します。同時に、開発者とアナリストの両方が統合テストの作成に関与しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テスト駆動開発をどのように適用しますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しい機能が必要な場合は、まずその機能のテストを作成します。バグを発見したら、まずテストに書き込み、それを修正する必要があります。最初は、このように作業するのは難しく、従業員の側で、さらには妨害行為でさえ、誤解があります。この「後で」だけが発生することはほとんどありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、まず自分でテストを作成し、他の人にテストを依頼する必要があります。私を信じて、テスト駆動開発は短期的にも有益です。生活しやすくなったと感じます。私たちの考えによると、コードの99％は現在テストでカバーされています。多くのように見えますが、問題はありません。すべてのコミットでテストが実行されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、私たちがストレステストを愛しているすべてのほとんどは、それを最も重要であると考え、定期的に実施しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のバージョンの1つで負荷テストの最初の段階をどのように実施したかについての短い話をお伝えします。システムを開発者のラップトップに置き、負荷をオンにして、1秒あたり4000トランザクションを受け取りました。ラップトップの良い結果。 4台のサーバーの仮想ロードスタンドを設置しましたが、運用環境よりも脆弱です。最小限に展開。私たちはそれを開始し、1つのスレッドのラップトップよりも悪い結果が得られます。衝撃の内容。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とても悲しかったです。サーバーの負荷を調べたところ、アイドル状態でした。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0b/eba/0fa/a0beba0fad0ba7e8f0cf333ef8366948.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは開発者を呼び出し、Javaの世界から来た人々に、Tarantoolはシングルスレッドであることを説明します。</font><font style="vertical-align: inherit;">負荷がかかっている1つのプロセッサコアだけで効果的に使用できます。</font><font style="vertical-align: inherit;">次に、可能な最大数のTarantoolインスタンスを各サーバーにデプロイし、負荷をオンにして、1秒あたりすでに14.5千のトランザクションを受信しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67f/8ca/e14/67f8cae14bea588f5018d4406f99c23c.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう一度説明します。</font><font style="vertical-align: inherit;">リソースの使用方法が異なる役割に分割されているため、接続とデータ変換の処理を担当する役割はプロセッサにのみ負荷をかけ、負荷に完全に比例していました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/822/cb3/9d1822cb3dcacd91f3f9fd7dbb7c9f7c.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/566/1b4/1f05661b4e5b7806867849b060dc23b7.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、メモリは着信接続と一時オブジェクトの処理にのみ使用されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16e/e79/f9f/16ee79f9fbfd6157c7df6edd66b90535.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
逆に、ストレージサーバーでは、プロセッサの負荷が増加しましたが、接続を処理するサーバーよりもはるかに遅くなりました。 </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18b/0ad/d2d/18b0add2da6deda36388ca9b0f07594b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、メモリ消費量は、読み込まれたデータ量に正比例して増加しました。 </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e21/697/e05/e21697e0521f54530aa7c50227297af1.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特にアプリケーションプラットフォームとして新製品を開発するために、サービスとライブラリをデプロイするためのコンポーネントを作成しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスは、いくつかのフィールドで動作する小さなコード片ではありません。</font><font style="vertical-align: inherit;">それらは、クラスターの一部である非常に大きく複雑な設計になる可能性があり、参照データを確認し、ビジネスロジックをひねり、答えを出します。</font><font style="vertical-align: inherit;">また、サービススキームをGraphQLにエクスポートします。コンシューマーは、モデル全体を内省して、ユニバーサルデータアクセスポイントを受け取ります。</font><font style="vertical-align: inherit;">とても快適です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスにはより多くの機能が含まれているため、頻繁に使用されるコードを取り出すライブラリが必要であると判断しました。</font><font style="vertical-align: inherit;">これらが私たちにとって何も破壊しないことを確認した後、私たちはそれらを安全な環境に追加しました。</font><font style="vertical-align: inherit;">さらに、ライブラリの形式で追加の環境の関数を設定できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストレージだけでなく、コンピューティングにも対応できるプラットフォームが欲しいと思っていました。</font><font style="vertical-align: inherit;">また、レプリカとシャードの束がすでにあるため、分散コンピューティングの類似物を実装し、それをmap reduceと呼びました。これは、元のmap reduceのようになったためです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">古いシステム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古いプロトコルのすべてがHTTP経由で呼び出してGraphQLを使用できるわけではありませんが、このプロトコルはサポートされています。</font><font style="vertical-align: inherit;">そのため、これらのシステムにデータを複製するメカニズムを作成しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/6e5/e33/f5d6e5e33b10e605cf7c6c5befd4aa07.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何かが変更された場合、特異なトリガーがストレージロールで機能し、変更を含むメッセージが処理キューに入ります。</font><font style="vertical-align: inherit;">別のレプリケーターの役割を使用して外部システムに送信されます。</font><font style="vertical-align: inherit;">このロールは状態を保存しません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しい改善</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご存じのように、ビジネスの観点から、非同期録音を行いました。</font><font style="vertical-align: inherit;">しかし、操作のステータスに関する回答をすぐに受信する必要のあるクラスのシステムがあるため、十分ではないことに気付きました。</font><font style="vertical-align: inherit;">したがって、GraphQLを拡張し、突然変異を追加しました。</font><font style="vertical-align: inherit;">データを操作するという既存のパラダイムに有機的に適合します。</font><font style="vertical-align: inherit;">別のクラスのシステムについては、読み取りと書き込みの両方の単一のポイントがあります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/395/562/ef7/395562ef7191842f4dc9526dae8c0661.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、1日1週間、1か月に1度作成する必要のある非常に重いレポートがあるため、サービスだけでは十分ではないことにも気付きました。これには時間がかかる場合があり、レポートはTarantoolイベントループをブロックすることさえできます。したがって、スケジューラとランナーという別々の役割を作りました。ランナーは状態を保存しません。彼らは難しいタスクを起動しますが、その場で数えることはできません。また、スケジューラロールは、これらのタスクを起動するためのスケジュールを監視します。これは、構成で説明されています。タスク自体は、ビジネスデータと同じ場所に保存されます。適切なタイミングになると、スケジューラはタスクを実行し、一部のランナーに渡し、それを考慮して結果を保存します。</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb1/bbf/123/fb1bbf12343d40bab27a87b5f1021f0d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのタスクをスケジュールどおりに実行する必要はありません。</font><font style="vertical-align: inherit;">一部のレポートはオンデマンドで読む必要があります。</font><font style="vertical-align: inherit;">この要件が満たされるとすぐに、タスクがサンドボックスで形成され、実行のためにランナーに送信されます。</font><font style="vertical-align: inherit;">しばらくすると、ユーザーはすべてが計算されたという非同期の応答を受け取り、レポートの準備が整います。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13f/27e/db0/13f27edb0711b735602d77c7c54c4d38.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、すべてのデータを保存し、バージョン管理を行い、それらを削除しないというパラダイムを遵守しました。</font><font style="vertical-align: inherit;">しかし、人生の中で、時々、あなたはまだ何か、主にいくつかの生または中間の情報を削除する必要があります。</font><font style="vertical-align: inherit;">期限切れに基づいて、古いデータのストレージをクリーニングするメカニズムを作成しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/1aa/e8d/4d91aae8daf9c27437ca9ed57574e349.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、遅かれ早かれ、データをメモリに格納するための十分なスペースがない状況が発生することは理解していますが、それでもデータを格納する必要があります。</font><font style="vertical-align: inherit;">これらの目的のために、すぐにディスクストレージを作成します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/10e/7da/13a10e7da6c77907d88504ee20fbb62c.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データを単一のモデルにロードするタスクから始め、その開発に3か月を費やしました。 6つのデータプロバイダーシステムがありました。単一のモデルへの変換コード全体は、Luaで約3万行です。そして、仕事のほとんどはまだ来ていません。時々、隣接するチームのモチベーションの欠如があり、状況の仕事を非常に複雑にします。同様の問題が発生した場合は、その実装が正常であると考える時間を3倍、さらには4倍にします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ビジネスプロセスの既存の問題は、たとえ生産性が高くても、新しいDBMSを使用して解決することはできません。私が意味したのは？私たちのプロジェクトの開始時に、私たちは今、新しい高速データベースを持ち込んでライブするという印象を顧客にもたらしました。プロセスはより速く進み、すべてがうまくいくでしょう。実際、ビジネスプロセスは人間であるため、テクノロジーはビジネスプロセスに存在する問題を解決しません。テクノロジーではなく、人と協力する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初期段階でのテストによる開発は、苦痛で時間がかかる可能性があります。ただし、回帰テストを実施するために何もする必要がない場合でも、短期間でもその効果は顕著になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発のすべての段階で負荷テストを実行することは非常に重要です。アーキテクチャのある種の欠陥に気づくほど、修正が容易になり、将来の多くの時間を節約できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luaには何の問題もありません。 Java開発者、JavaScript開発者、Python開発者、フロントエンドまたはバックエンドで、誰でもそれを書くことを学ぶことができます。アナリストも書いています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちがSQLを持っていないという事実について話すとき、これは人々を怖がらせます。 「SQLなしでデータを取得するにはどうすればよいですか？」それは可能ですか？」もちろん。 OLTPクラスシステムでは、SQLは必要ありません。すぐにドキュメント指向のビューを返す言語形式の代替手段があります。たとえば、GraphQL。そして、分散コンピューティングの形で代替案があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スケールする必要があることを理解したら、すぐにTarantoolでソリューションを設計し、数十のTarantoolインスタンスで並行して動作できるようにします。</font><font style="vertical-align: inherit;">そうしないと、Tarantoolは1つのプロセッサコアしか効率的に使用できないため、困難で苦痛になります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja495310/index.html">電子ウォークスルー：生体認証とマルチフォーマット</a></li>
<li><a href="../ja495312/index.html">境界セキュリティ-未来は今</a></li>
<li><a href="../ja495314/index.html">それが公式の情報源からのものである場合、誤った情報をフィルタリングする方法は？</a></li>
<li><a href="../ja495316/index.html">Habr Quarantine Careerチームの生活のルール</a></li>
<li><a href="../ja495324/index.html">JavaScriptでのMosbirzheのランダムストックジェネレーターの作成</a></li>
<li><a href="../ja495328/index.html">Gitでのコミットの履歴を整理する方法</a></li>
<li><a href="../ja495330/index.html">数字で見るに値する人気</a></li>
<li><a href="../ja495332/index.html">カルテット9：アレグロ| TypeScript</a></li>
<li><a href="../ja495336/index.html">だけでなく、企業のメッセンジャーとしての不和</a></li>
<li><a href="../ja495338/index.html">本番環境でコンテナーとKubernetesを起動するためのベストプラクティスとガイドライン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>