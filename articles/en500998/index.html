<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèä ü•ò üñêüèø Convolutional neural network and its integration in iOS (part 1) üßó üëåüèª üêá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Means of implementation.
 
 Various machine learning algorithms are integrated into many high-level programming languages. The most popular and fastes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Convolutional neural network and its integration in iOS (part 1)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500998/"><img src="https://habrastorage.org/webt/ob/i9/sq/obi9sqkryjcwn5txcjgdvc0fcoi.jpeg"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Means of implementation.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Various machine learning algorithms are integrated into many high-level programming languages. The most popular and fastest growing of them is Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TensorFlow is an open software library for machine learning developed by Google to solve the problems of building and training a neural network in order to automatically find and classify images, achieving the quality of human perception. The main API for working with the library is implemented for Python. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Keras is an open neural network library. It is an add-on for the TensorFlow and Theano frameworks. It is aimed at operational work with deep learning networks, while being designed to be compact, modular and expandable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The latest version of Python 3.7.2 is selected as the interpreter. The development environment is PyCharm Community. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data preparation.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
In the modern world, for most AI tasks, you do not need to collect a data set manually, there are many resources where, after registration, you can download ready-made datasets. A data set with ten digits in sign language was selected (Fig. 1). </font></font><br>
<img src="https://habrastorage.org/webt/_-/wd/e7/_-wde7b_bdaeuj-ge5tk6fkymxi.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. 1. - Numbers in sign language.</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The algorithm will need to detect the presence of a gesture in the photo and classify it with a number from 0 to 9. Before building the architecture of the neural network, you need to prepare data for its training. First, Sign Language Digits Dataset data is downloaded. The first file contains 2063 black and white pictures with numbers in sign language. Pictures have a size of 64x64 pixels. The second file contains a label (vector) corresponding to the picture. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The pixel values ‚Äã‚Äãin the pictures are normalized and are in the interval (0,1). You can immediately use them to enter the neural network, but the most optimal result will be achieved if you follow the standardization procedure. After its execution, the rules will be satisfied for each matrix of pixels: The </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
average value in the matrix is ‚Äã‚Äãzero. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 The dispersion in the matrix is ‚Äã‚Äãunity.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Photos are standardized and added to a new array for their subsequent combination with previous data ( </font></font><br>
<img src="https://habrastorage.org/webt/ad/m6/wd/adm6wdbpvyip5kyp_4glxau1j50.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. </font><font style="vertical-align: inherit;">2) </font><font style="vertical-align: inherit;">Fig. 2. - The procedure for loading and processing images. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neural network architecture.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Network_sign_lang.py - the main project file in which the neural network is described. At the beginning of the script, several global variables of the neural network are described (Fig. 3). </font></font><br>
<img src="https://habrastorage.org/webt/ug/wo/ll/ugwollmtjdgakxjrkjaycuq7bog.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. 3. - Global options. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Batch_size - the number of images fed into the neural network for each iteration. Num_classes - the number of classes that the model will predict. Img_size - the size of the images supplied to the input layer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The train_test_split () function from the Sklearn library is imported into the project, it splits the X and y arrays in the 80:20 ratio into training and test samples, and also randomly mixes the data so that they are not sorted by class. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the model is initialized (Fig. 4), the first layer of Conv2D is added. Images from the Xtrain array are input, the dimension of the output space is indicated - 64, the convolution core - 4x4, the convolution step and the activation function of the ReLU layer. </font></font><br>
<img src="https://habrastorage.org/webt/7z/3p/jw/7z3pjw8oimjgvt7n4nde4jgivao.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. 4. - Neural network</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since neural networks typically use a much larger number of training data, the constructed model is prone to retraining. To avoid this, an effective regularization method, such as Dropout, is used. This layer will exclude the indicated percentage of random neurons so that there is no glut between the layers. The number 0.5 will mean that on each batch the algorithm will exclude half of random neurons. The second main layer is also similar to the first - convolutional. (Conv2D) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next is the pooling layer (MaxPooling2D). It serves as another filter for model output. Since when displaying the numbers horizontally or vertically, the meaning of the image does not change, the neural network should classify them equally.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The flatten layer serves as a link between the data obtained by the algorithm and the output vector with the prediction. The last layer of the network is the Dense layer with sofmax activation function. This function allows you to get a normalized vector of probabilities for each class, where the sum of the probabilities will be equal to one.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, you need to compile the created model by specifying the following parameters: metric, loss function, and optimizer. As a metric, accuracy is chosen - the percentage of correctly classified examples. The loss function is categorical_crossentropy. Optimization Algorithm - Adam. Before starting the training, several callbacks are added. EarlyStopping - stops learning the neural network when its accuracy ceases to increase with the epochs of learning. ModelCheckpoint - saves the best model weights to a file for later use. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The training of the neural network is started with the saving of data about its process into the histor variable. Validation_split - Takes ten percent of the training data for validation, which is another way to regularize.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The size of the training sample is 1965 examples, the test sample is 547, and the validation sample is 219. After completion of the training process, a graph of the dependence of the accuracy obtained on the training and test data is constructed (Fig. 5). </font></font><br>
<img src="https://habrastorage.org/webt/ip/fj/0t/ipfj0t4yibt6ogcdlddvuuqbksu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig.5. - Training schedule. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The graph shows that the model was saved at the 15th era (with the greatest accuracy and the smallest gap between Xtrain and Xtest). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next step is to load the resulting neural networks into another script to verify their functioning. The values ‚Äã‚Äãof the metrics on the test data are displayed (Fig. 6). </font></font><br>
<img src="https://habrastorage.org/webt/yy/gk/pw/yygkpwatefnnhsps263xk54futk.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fig. 6. - Checking the performance of the model.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on the results of the metrics, we can conclude that the models do not differ much. </font><font style="vertical-align: inherit;">The lower the loss function index, the more confident the predictions of the algorithm. </font><font style="vertical-align: inherit;">The accuracy or fidelity of the model shows the percentage of correctly classified photos, which means that the higher it is, the better the neural network. </font><font style="vertical-align: inherit;">Consequently, it is more logical to use the first model obtained as a result of early stopping of education. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
About data preprocessing and integration of a neural network of a certain format in an iOS application, we will describe in the next part.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500984/index.html">Bad Apple or Happy Radio Day, geeks</a></li>
<li><a href="../en500986/index.html">Monitoring in the data center: how we changed the old BMS to a new one. Part 3</a></li>
<li><a href="../en500992/index.html">How is Performance Management in the best IT companies</a></li>
<li><a href="../en500994/index.html">Run ant. Run</a></li>
<li><a href="../en500996/index.html">How to become a DevOps engineer in six months or even faster. Part 1. Introduction</a></li>
<li><a href="../en501000/index.html">Code generation in Go by the example of creating a client for the database</a></li>
<li><a href="../en501002/index.html">Umka: new statically typed scripting language</a></li>
<li><a href="../en501004/index.html">Do it. Work</a></li>
<li><a href="../en501006/index.html">We are friends STM32 with LCD display 1604 on I2C bus (HAL library)</a></li>
<li><a href="../en501008/index.html">Dominos paving</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>