<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™‚ï¸ ğŸš‹ ğŸš² Sag schlechtes Wort fÃ¼r LINQ ğŸ“ ğŸ§•ğŸ¼ ğŸ‰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WÃ¤hrend meines kurzen Lebens als C # -Programmierer dachte ich, dass es bei LINQ nicht in erster Linie um die Leistung des Codes geht, sondern um die ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sag schlechtes Wort fÃ¼r LINQ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503734/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WÃ¤hrend meines kurzen Lebens als C # -Programmierer dachte ich, dass es bei LINQ nicht in erster Linie um die Leistung des Codes geht, sondern um die Leistung des Programmierers, wie schnell er den Code schreibt und nicht wie schnell der Prozessor diesen Code ausfÃ¼hrt. </font><font style="vertical-align: inherit;">Und die Leistungsprobleme sowohl des Codes als auch des Programmierers werden behoben, nachdem die EngpÃ¤sse identifiziert wurden. </font><font style="vertical-align: inherit;">Daher schreibe </font></font><code>var groupedByDate = lst.GroupBy(item =&gt; item.IssueTime.Date).Select(â€¦).ToList()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und mache </font><font style="vertical-align: inherit;">ich dies oft </font><font style="vertical-align: inherit;">nicht aufgrund von Schaden oder bÃ¶swilliger Absicht, aber es ist einfach einfacher, den Code zu debuggen. </font><font style="vertical-align: inherit;">Platzieren Sie fÃ¼r die Liste einfach den Mauszeiger Ã¼ber dem Text der Variablen und Sie kÃ¶nnen sofort sehen, ob etwas vorhanden ist oder nicht.</font></font></p><a name="habracut"></a><br>
<h4 id="nachalo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start</font></font></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich den Artikel â€ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfolgloser Artikel Ã¼ber das Beschleunigen der Reflexion</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> â€œ und das Beruhigen von Emotionen Ã¼ber â€Jemand ist im Internet falsch </font><font style="vertical-align: inherit;">â€œ gelesen hatte </font><font style="vertical-align: inherit;">, fragte ich mich, ob es mÃ¶glich ist, den Code â€LINQ to Objectsâ€œ in der Leistung nahe an â€manuellâ€œ zu bringen. </font><font style="vertical-align: inherit;">Warum genau LINQ zu Objekten? </font><font style="vertical-align: inherit;">In meiner Arbeit verwende ich hÃ¤ufig nur die Anbieter LINQ to Objects und LINQ to Entities. </font><font style="vertical-align: inherit;">Die Leistung von LINQ to Entities ist fÃ¼r mich nicht kritisch. </font><font style="vertical-align: inherit;">Es ist wichtig, wie optimal die generierte SQL-Abfrage fÃ¼r den Zieldatenbankserver ist und wie schnell der Server sie ausfÃ¼hrt.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Grundlage habe ich mich fÃ¼r das Projekt des Autors des Artikels entschieden. </font><font style="vertical-align: inherit;">Im Gegensatz zu den Beispielen aus dem Internet, bei denen ein Code hauptsÃ¤chlich wie </font></font><code>integerList.Where(item =&gt; item &gt; 5).Sum()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein â€manuellerâ€œ Code </font><font style="vertical-align: inherit;">verglichen wird </font></font><code>foreach</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usw. </font><font style="vertical-align: inherit;">enthÃ¤lt </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">erschien mir das Beispiel aus dem Artikel interessant und wichtig.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als erstes habe ich eine einzelne String-Vergleichsfunktion verwendet. </font><font style="vertical-align: inherit;">Im Quellcode werden in Methoden, die dieselbe Funktion ausfÃ¼hren, sich jedoch in gegenÃ¼berliegenden Ecken des Rings befinden, in einem Fall </font></font><code>variable0.Equals(constant0, StringComparison.InvariantCultureIgnoreCase)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und in einem anderen </font><font style="vertical-align: inherit;">Fall unterschiedliche Methoden verwendet </font></font><code>variable0.ToUpperInvariant() ==constant0.ToUpperInvariant()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es ist besonders Ã¤rgerlich fÃ¼r die Konstante, dass jeder Methodenaufruf in GroÃŸbuchstaben konvertiert wird. </font><font style="vertical-align: inherit;">Ich habe in beiden FÃ¤llen die dritte Option gewÃ¤hlt </font></font><code>variable0.ToUpperInvariant() ==constant0InUpperCaseInvariant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dann wurde der gesamte Code verworfen, der nicht direkt mit dem Vergleich der LINQ-Leistung und des manuellen Codes zusammenhÃ¤ngt. </font><font style="vertical-align: inherit;">Der erste, der abgefangen wurde, war der Code, der das Klassenobjekt erstellt und initialisiert </font></font><code>Mock&lt;HabraDbContext&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Was bringt es, fÃ¼r jeden Test einmal eine Datenbankverbindung herzustellen? </font><font style="vertical-align: inherit;">Es wurde Ã¼ber Leistungstests hinaus verschoben.</font></font></p><br>
<pre><code class="cs hljs">IStorage _db;<font></font>
<font></font>
[<span class="hljs-meta">GlobalSetup</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Setup</span>(<span class="hljs-params"></span>)</span><font></font>
{<font></font>
    _db = MockHelper.InstanceDb();<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> IStorage DBInstance =&gt; _db;</code></pre><br>
<p>    â€¦  â€” , !    Linq      Â«Â» !</p><br>
<p><img src="https://habrastorage.org/webt/nf/g3/n7/nfg3n7ucmeox6i0kdhzh9bk_mqu.png" alt="Bild"></p><br>
<p>   Â«      -  Â»   .  LINQ .     ,    â€” .</p><br>
<h4 id="celi-menyayutsya"> </h4><br>
<p>       ,     ,     LINQ vs Â«Â» .        .         .      .</p><br>
<p> ,            ,   ,          (<code>[Params(1, 10, 100, 1000)]</code>).      .           .        .     <code>StatisticColumnRelStdDev</code>.</p><br>
<p>     â€”    <code>FastHydrationLinq</code>,        <code>ManualHydrationLinq</code> â€”     .  ,   ,  (Fast)(Manual)(Slow)HydrationLinq vs (Fast)(Manual)(Slow)Hydration,        <code>ManualHydrationLinq</code>.  <code>FastHydrationLinq</code>   -    .     .</p><br>
<p>           <code>ToArray</code>, <code>ToDictionary</code>     <code>IEnumerable&lt;T&gt;</code>       .   ,     <code>FastContactHydrator2</code>.         -  <code>Action&lt;Contact, string&gt;</code> c <code>ConcurrentDictionary&lt;string, Action&lt;Contact, string&gt;&gt;</code>  <code>IEnumerable&lt;KeyValuePair&lt;string, Action&lt;Contact, string&gt;&gt;&gt;</code>.    <code>GetContact2</code>,    <code>Sum</code>,       .</p><br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Contact <span class="hljs-title">GetContact2</span>(<span class="hljs-params">IEnumerable&lt;PropertyToValueCorrelation&gt; correlations</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> contact = <span class="hljs-keyword">new</span> Contact();
    <span class="hljs-keyword">int</span> dummySum = _propertySettersArray.Join(correlations, propItem =&gt; propItem.Key, corrItem =&gt; corrItem.PropertyName, (prop, corr) =&gt; { prop.Value(contact, corr.Value); <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; }).Sum();
    <span class="hljs-keyword">return</span> contact;<font></font>
}</code></pre><br>
<p> <code>ParseWithLinq</code>   </p><br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IEnumerable&lt;KeyValuePair&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt;&gt; ParseWithLinq2(<span class="hljs-keyword">string</span> rawData, <span class="hljs-keyword">string</span> keyValueDelimiter = <span class="hljs-string">":"</span>, <span class="hljs-keyword">string</span> pairDelimiter = <span class="hljs-string">";"</span>)<font></font>
    =&gt; rawData.Split(pairDelimiter)<font></font>
    .Select(x =&gt; x.Split(keyValueDelimiter, StringSplitOptions.RemoveEmptyEntries))<font></font>
    .Select(x =&gt; x.Length == <span class="hljs-number">2</span> ? <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt;(x[<span class="hljs-number">0</span>].Trim(), x[<span class="hljs-number">1</span>].Trim())<font></font>
                                : <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>&gt;(_unrecognizedKey, x[<span class="hljs-number">0</span>].Trim()));</code></pre><br>
<p>   .</p><br>
<p>     <code>FastContactHydrator2</code>,     ,  ,               ,        -,      ( <code>ParseWithLinq</code>  <code>ParseWithoutLinq</code>).        .      ,   ,   <code>ToArray</code>.       10   <code>var result = new List&lt;PropertyToValueCorrelation&gt;(10)</code>.  10?  42   ,   10  .       Fair  .</p><br>
<p>     .           .    <code>GetFakeData</code>    .   ,      .<br>
      ,       ,        Â« Â» (RelStdDev).     <code>N=1000</code>.</p><br>
<p>    :</p><br>
<pre><code class="plaintext hljs">-  `ManualHydration`, `SlowHydration`, `FastHydration`, `ManualHydrationLinq`, `SlowHydrationLinq`, `FastHydrationLinq` -     ,  ;</code></pre><br>
<ul>
<li> <code>ManualHydrationFair</code>, <code>ManualHydrationFairLinq</code>, <code>FastHydrationFairLinq</code> â€”     ,      ;</li>
<li> <code>FastHydrationLinq2</code> â€”        , , - ,         LINQ;</li>
<li> <code>N</code>    ,     ;</li>
<li> <code>Ratio</code>           <code>FastHydrationLinq2</code>.</li>
</ul><br>
<p><img src="https://habrastorage.org/webt/li/kh/jn/likhjnapsei7x-unzwduff1ivwq.png" alt="Bild"><br>
<em>Linq-   </em></p><br>
<p>   ?   â€”  <code>FastHydrationLinq2</code>    <code>ManualHydrationLinq</code>   <code>Ratio</code>.    26,361.37 Î¼s  26,422.17 Î¼s   <code>N=1000</code>.    /     <code>N</code>.     <code>ManualHydrationFairLinq</code>,    8% ,        .     <code>FastHydrationFairLinq</code>,     1%  -.</p><br>
<p>     Fair-.     ,  <code>ManualHydrationFairLinq</code>  8%     .  <code>FastHydrationFairLinq</code>   <code>FastHydrationLinq</code> 12%.    Linq       .</p><br>
<p>     ,  .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>          .   ,          <code>MockHelper.InstanceDb()</code>   <code>Setup</code>,         .          â€”      ,       <code>GetFakeData</code>,        .  ,     â€”    .    <code>MockHelper.InstanceDb()</code>    .</p><br>
<p>    <code>N</code>,   <code>MakeGarbage</code>.   <code>False</code>     , <code>True</code> â€”      .</p><br>
<p><img src="https://habrastorage.org/webt/no/bl/lh/nobllhj80burrhvb3udycfq5hkg.png" alt="Bild"><br>
<em>    </em></p><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">      N</b>
                        <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ak/0y/a7/ak0ya7v5fldvc-krutvw53rb7fu.png" alt="image"></p></div>
                    </div><br>
<p>VoilÃ ,       ,             .    â€”             <code>N=1</code>.    10%      82%    .</p><br>
<p>â€¦    .</p><br>
<h4 id="v-pogone-za-neulovimym-dzho">    </h4><br>
<p>       ,      ,      Â«Â»  â€” Linq-,             :</p><br>
<p><img src="https://habrastorage.org/webt/vm/ui/__/vmui__wnkqlox2jky12xm28cx5g.png" alt="Bild"><br>
<em> <code>N=1</code>  <code>MakeGarbage=True</code>     Â«Â» </em></p><br>
<p>  ,     ,   ,    LINQ     .<br>
  Â«Gen XÂ»  Â«AllocatedÂ»  <code>N=1</code>  <code>MakeGarbage=True</code>     o ,   <code>FastHydrationLinq2</code> </p><br>
<pre><code class="plaintext hljs">|                                |      Gen 0 |   Gen 1 | Gen 2 |   Allocated |<font></font>
|Â«Â»     |    20.5078 |  0.4883 |     - |    63.95 KB |<font></font>
|Linq-        |    20.7520 |       - |     - |    63.69 KB |</code></pre><br>
<p>     <code>ManualHydrationFairLinq</code>  .</p><br>
<p>            .       ,   ,            â€”  .<br>
        ,       ?      .   ,     <code>N</code>  <code>[Params(1, 100)]</code>  <code>MakeGargabe=True</code>.     Â«Â» â€” Linq-,          .    â€”     ,   â€”    Linq-,    Linq â€”  â€”  â€” Linq.    â€”   .       .</p><br>
<p>  ,         ,     â€” Linq-  .   ,  .          paint.net,       .       paint.net    â€”            paint.net   .  paint.net â€” Â«Â»  ,   â€” Linq-   .</p><br>
<p>     â€”  <code>N</code>   1, 10, 100, 1000   <code>MakeGarbage</code>   <code>[ParamsAllValues]</code>.  paint.net,   â€” Â«Â»  .      â€”  Linq-   .    paint.net  Visual Studio â€” Â«Â»    .      ,    80-    .    ,            Linq-  2%.</p><br>
<h4 id="vyvody"></h4><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich die Tests geschrieben und die Ergebnisse analysiert habe, hat sich meine Meinung zu LINQ nicht geÃ¤ndert. Wenn ich es verwende, ist meine ProduktivitÃ¤t beim Schreiben von Code hÃ¶her als ohne. </font><font style="vertical-align: inherit;">Die Leistung von LINQ to Objects ist in Ordnung. </font><font style="vertical-align: inherit;">Die verzÃ¶gerte AusfÃ¼hrung von LINQ-Code als Mittel zur Leistungsverbesserung ist wenig sinnvoll.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn in einem Projekt Leistungsprobleme aufgrund des Garbage Collectors auftreten - der .net-Geburtsverletzung -, war die Wahl dieser Technologie wahrscheinlich nicht die beste LÃ¶sung.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mein Testcode ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verfÃ¼gbar </font><font style="vertical-align: inherit;">.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de503724/index.html">Wi-Fi oder Twisted Pair - was ist besser?</a></li>
<li><a href="../de503726/index.html">6 MÃ¶glichkeiten, Pandas mit ein paar Codezeilen deutlich zu beschleunigen. Teil 1</a></li>
<li><a href="../de503728/index.html">Forscher: Hacker fÃ¼hren zunehmend Brute-Force-Angriffe auf Finanzdienstleistungen durch</a></li>
<li><a href="../de503730/index.html">Kostenlose Data Science-Kurse an der Harvard University</a></li>
<li><a href="../de503732/index.html">JUG Ru Group # 3 Online Stream Woche</a></li>
<li><a href="../de503742/index.html">Poly Studio Video Bar Test (Video)</a></li>
<li><a href="../de503744/index.html">Drei FÃ¤lle von Workstation-Inventar unter Remote-Arbeitsbedingungen</a></li>
<li><a href="../de503746/index.html">GitHub: Zabbix-Vorlage zur Ãœberwachung von Datenerfassungsaufgaben in MaxPatrol SIEM</a></li>
<li><a href="../de503758/index.html">Erfahrung in der Vorbereitung auf die Zertifizierung Professional Scrum Master II (Scrum.org)</a></li>
<li><a href="../de503760/index.html">Coronavirus-Cyberangriffe: Alles Salz im Social Engineering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>