<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈂️ 🦄 🔵 Wir konfigurieren WireGuard auf einem Mikrotik-Router, auf dem OpenWrt ausgeführt wird 🤚🏿 🥣 👩🏽‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In den meisten Fällen ist das Verbinden eines Routers mit einem VPN nicht schwierig. Wenn Sie jedoch das gesamte Netzwerk schützen und gleichzeitig di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wir konfigurieren WireGuard auf einem Mikrotik-Router, auf dem OpenWrt ausgeführt wird</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487450/"><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/ao/dp/ci/aodpci2jg61mfsgufozhgakjwgc.jpeg" alt="Bild"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In den meisten Fällen ist das Verbinden eines Routers mit einem VPN nicht schwierig. Wenn Sie jedoch das gesamte Netzwerk schützen und gleichzeitig die optimale Verbindungsgeschwindigkeit beibehalten möchten, ist die Verwendung des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WireGuard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VPN-Tunnels die beste Lösung </font><font style="vertical-align: inherit;">. </font><b><font style="vertical-align: inherit;">Mikrotik-</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Router haben </font><font style="vertical-align: inherit;">sich als zuverlässige und sehr flexible Lösungen etabliert. Leider </font><font style="vertical-align: inherit;">wird </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">WireGuard unter RouterOS</font></a><font style="vertical-align: inherit;"> immer noch nicht </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">unterstützt,</font></a><font style="vertical-align: inherit;"> und es ist nicht bekannt, wann und in welcher Version es erscheinen wird. </font><font style="vertical-align: inherit;">Kürzlich </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">wurde bekannt,</font></a><font style="vertical-align: inherit;"> dass die Entwickler des WireGuard VPN-Tunnels eine </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Reihe von Patches angeboten haben</font></a><font style="vertical-align: inherit;"> , mit denen ihre VPN-Tunnel-Organisationssoftware Teil des Linux-Kernels wird, und wir hoffen, dass dies zur Implementierung von RouterOS beiträgt.</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um WireGuard auf einem Mikrotik-Router zu konfigurieren, müssen Sie jedoch vorerst die Firmware ändern.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware Mikrotik, installieren und konfigurieren Sie OpenWrt</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst müssen Sie sicherstellen, dass OpenWrt Ihr Modell unterstützt. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf mikrotik.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> können Sie sehen, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ob</font></a><font style="vertical-align: inherit;"> das Modell dem Marketingnamen und dem Image </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">entspricht</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gehen Sie zu openwrt.com </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Bereich zum Herunterladen der Firmware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für dieses Gerät benötigen wir 2 Dateien:</font></font><br>
<br>
<blockquote><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downloads.openwrt.org/releases/18.06.2/targets/ar71xx/mikrotik/openwrt-18.06.2-ar71xx-mikrotik-rb-nor-flash-16M-initramfs-kernel.bin|elf </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downloads.openwrt.org/releases /18.06.2/targets/ar71xx/mikrotik/openwrt-18.06.2-ar71xx-mikrotik-rb-nor-flash-16M-squashfs-sysupgrade.bin</font></font></a></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie müssen beide Dateien herunterladen: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installieren</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aktualisieren</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yq/ha/sx/yqhasx9i5vz9bzzvv4noh1tcjsw.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Netzwerkeinrichtung, Laden und Einrichten eines PXE-Servers</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Laden Sie die </font><font style="vertical-align: inherit;">neueste Version von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiny PXE Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für Windows </font><font style="vertical-align: inherit;">herunter </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einen separaten Ordner entpacken. </font><font style="vertical-align: inherit;">Fügen Sie in der Datei config.ini den Parameter </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rfc951 = 1</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> section </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[dhcp] hinzu</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dieser Parameter ist für alle Mikrotik-Modelle gleich. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-x/zp/yt/-xzpytuejiueczctfulycm5aiuw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir wenden uns den Netzwerkeinstellungen zu: Sie müssen eine statische IP-Adresse auf einer der Netzwerkschnittstellen Ihres Computers registrieren.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4b/op/mx/4bopmxe-1f7whsalfi3xxuyjxbw.png"><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP-Adresse: 192.168.1.10 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Netzmaske: 255.255.255.0</font></font></blockquote><img src="https://habrastorage.org/webt/jj/-k/vg/jj-kvgjo5ijnitt3idoculwnntq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Starten Sie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiny PXE Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Administrator und wählen Sie den </font><font style="vertical-align: inherit;">Server mit der Adresse </font><b><font style="vertical-align: inherit;">192.168.1.10</font></b><font style="vertical-align: inherit;"> im Feld </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP-Server</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus. </font><i><font style="vertical-align: inherit;">In einigen Windows-Versionen wird diese Schnittstelle möglicherweise erst nach einer Ethernet-Verbindung angezeigt. </font></i><i><font style="vertical-align: inherit;">Ich empfehle, den Router anzuschließen und den Router und den PC sofort mit einem Patchkabel zu verbinden. </font></i><font style="vertical-align: inherit;">
Klicken Sie auf die Schaltfläche "..." (unten rechts) und geben Sie den Ordner an, in den Sie die Firmware-Dateien für Mikrotik heruntergeladen haben. </font><font style="vertical-align: inherit;">
Wählen Sie eine Datei, deren Name mit "initramfs-kernel.bin oder elf" endet.</font></font><b><font style="vertical-align: inherit;"></font></b><br>
<br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br>
<img src="https://habrastorage.org/webt/i3/ho/zw/i3hozwbq_ztdgewiuf2nmnqq7ro.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/ao/wu/ge/aowuge--ezsup2dhmnb_ds8cuuq.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Herunterladen des Routers vom PXE-Server</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir verbinden das PC-Kabel und den ersten Port (WAN, Internet, Poe In, ...) des Routers. Danach nehmen wir einen Zahnstocher und stecken ihn mit der Aufschrift "Reset" in das Loch. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_b/20/uq/_b20uqrbpd3ii8euxvemiwrwqkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schalten Sie den Router ein und warten Sie 20 Sekunden. Lassen Sie dann den Zahnstocher los. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der nächsten Minute sollten die folgenden Meldungen im Tiny PXE Server-Fenster </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/zp/ij/u7zpijoidywi8z_zihwiee13zsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
angezeigt werden </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Wenn eine Meldung angezeigt wird, sind Sie in die richtige Richtung! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie die Einstellungen am Netzwerkadapter wieder her und stellen Sie die Empfangsadresse dynamisch ein (über DHCP). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie mit demselben Patchkabel eine Verbindung zu den LAN-Ports des Mikrotik-Routers her (in unserem Fall 2 ... 5). Schalten Sie es einfach von Port 1 auf Port 2 um. Öffnen Sie die Adresse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Browser.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/f5/9l/rgf59lv1gyipf3tlp5k09sbttu0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rufen Sie die OpenWRT-Verwaltungsoberfläche auf und gehen Sie zum Menübereich „System -&gt; Backup / Flash-Firmware“. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/zw/xv/ttzwxvujqpwbrgzoxz-ldxqgdjk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie im Unterabschnitt „Neues Firmware-Image </font><font style="vertical-align: inherit;">flashen </font><font style="vertical-align: inherit;">“ auf die Schaltfläche „Datei auswählen (Durchsuchen)“. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qs/n-/4b/qsn-4bashizxh4e2x1holm5h5u4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Geben Sie den Pfad zu der Datei an, deren Name mit "-squashfs-sysupgrade.bin" endet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rx/gy/kp/rxgykpenqhyfre51yaotebuset0.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie anschließend auf die Schaltfläche „Flash Image“. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie im nächsten Fenster auf die Schaltfläche "Weiter". </font><font style="vertical-align: inherit;">Der Firmware-Download auf den Router beginnt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/as/wz/3q/aswz3qugsit5sqmrpsrcryvfu1a.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!!! </font><font style="vertical-align: inherit;">Trennen Sie die Leistung des Routers im Prozess der Firmware nicht vom Stromnetz !!! </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/nd/fg/no/ndfgnohd--rem_x3tmkzm4yfsni.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Flashen und Neustarten des Routers erhalten Sie Mikrotik mit OpenWRT-Firmware.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mögliche Probleme und Lösungen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viele 2019 Mikrotik-Geräte verwenden den FLASH-NOR-Speicherchip Typ GD25Q15 / Q16. </font><font style="vertical-align: inherit;">Das Problem ist, dass beim Flashen keine Gerätemodelldaten gespeichert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Fehler "Die hochgeladene Bilddatei enthält kein unterstütztes Format" angezeigt wird. </font><font style="vertical-align: inherit;">Stellen Sie sicher, dass Sie das generische Bildformat für Ihre Plattform auswählen. “ </font><font style="vertical-align: inherit;">dann liegt das Problem höchstwahrscheinlich im Flash. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist leicht zu überprüfen: Führen Sie den Befehl aus, um die Modell-ID im Geräteterminal zu überprüfen</font></font><br>
<br>
<pre><code class="bash hljs">root@OpenWrt: cat /tmp/sysinfo/board_name</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn Sie die Antwort «unbekannt» erhalten, müssen Sie das Modell des Geräts manuell in Form des Befehls «rb-951-2nd» </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
für das Modell </font><font style="vertical-align: inherit;">angeben</font></font><br>
<br>
<pre><code class="bash hljs">root@OpenWrt: cat /tmp/sysinfo/model<font></font>
MikroTik RouterBOARD RB951-2nd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir das Modell des Geräts erhalten haben, installieren wir es manuell:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">'rb-951-2nd'</span> &gt; /tmp/sysinfo/board_name</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach können Sie das Gerät über die Weboberfläche oder mit dem Befehl sysupgrade flashen</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie mit WireGuard einen VPN-Server</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie bereits einen Server mit WireGuard konfiguriert haben, können Sie dieses Element überspringen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyVPN.RUN-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anwendung </font><font style="vertical-align: inherit;">über die Katze verwenden </font><font style="vertical-align: inherit;">, um einen persönlichen VPN-Server zu konfigurieren. </font><font style="vertical-align: inherit;">Ich habe bereits </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine Bewertung veröffentlicht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WireGuard Client unter OpenWRT konfigurieren</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie über SSH eine Verbindung zum Router her:</font></font><br>
<br>
<pre><code class="bash hljs">ssh root@192.168.1.1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Installieren Sie WireGuard:</font></font><br>
<br>
<pre><code class="bash hljs">opkg update<font></font>
opkg install wireguard</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bereiten Sie die Konfiguration vor (kopieren Sie den folgenden Code in die Datei, ersetzen Sie die angegebenen Werte durch Ihre eigenen und führen Sie sie im Terminal aus). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie MyVPN verwenden, müssen Sie in der folgenden Konfiguration nur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG_SERV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - die IP des Servers, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG_KEY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - den privaten Schlüssel aus der Wireguard-Konfigurationsdatei und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG_PUB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - den öffentlichen Schlüssel </font><b><font style="vertical-align: inherit;">ändern</font></b><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="bash hljs">WG_IF=<span class="hljs-string">"wg0"</span>
WG_SERV=<span class="hljs-string">"100.0.0.0"</span> <span class="hljs-comment"># ip  </span>
WG_PORT=<span class="hljs-string">"51820"</span> <span class="hljs-comment">#  wireguard</span>
WG_ADDR=<span class="hljs-string">"10.8.0.2/32"</span> <span class="hljs-comment">#   wireguard</span><font></font>
<font></font>
WG_KEY=<span class="hljs-string">"xxxxx"</span> <span class="hljs-comment">#  </span>
WG_PUB=<span class="hljs-string">"xxxxx"</span> <span class="hljs-comment">#   </span><font></font>
<font></font>
<span class="hljs-comment"># Configure firewall</span>
uci rename firewall.@zone[0]=<span class="hljs-string">"lan"</span>
uci rename firewall.@zone[1]=<span class="hljs-string">"wan"</span>
uci rename firewall.@forwarding[0]=<span class="hljs-string">"lan_wan"</span>
uci del_list firewall.wan.network=<span class="hljs-string">"<span class="hljs-variable">${WG_IF}</span>"</span>
uci add_list firewall.wan.network=<span class="hljs-string">"<span class="hljs-variable">${WG_IF}</span>"</span><font></font>
uci commit firewall<font></font>
/etc/init.d/firewall restart<font></font>
<font></font>
<span class="hljs-comment"># Configure network</span>
uci -q delete network.<span class="hljs-variable">${WG_IF}</span>
uci <span class="hljs-built_in">set</span> network.<span class="hljs-variable">${WG_IF}</span>=<span class="hljs-string">"interface"</span>
uci <span class="hljs-built_in">set</span> network.<span class="hljs-variable">${WG_IF}</span>.proto=<span class="hljs-string">"wireguard"</span>
uci <span class="hljs-built_in">set</span> network.<span class="hljs-variable">${WG_IF}</span>.private_key=<span class="hljs-string">"<span class="hljs-variable">${WG_KEY}</span>"</span><font></font>
<font></font>
uci add_list network.<span class="hljs-variable">${WG_IF}</span>.addresses=<span class="hljs-string">"<span class="hljs-variable">${WG_ADDR}</span>"</span><font></font>
<font></font>
<span class="hljs-comment"># Add VPN peers</span><font></font>
uci -q delete network.wgserver<font></font>
uci <span class="hljs-built_in">set</span> network.wgserver=<span class="hljs-string">"wireguard_<span class="hljs-variable">${WG_IF}</span>"</span>
uci <span class="hljs-built_in">set</span> network.wgserver.public_key=<span class="hljs-string">"<span class="hljs-variable">${WG_PUB}</span>"</span>
uci <span class="hljs-built_in">set</span> network.wgserver.preshared_key=<span class="hljs-string">""</span>
uci <span class="hljs-built_in">set</span> network.wgserver.endpoint_host=<span class="hljs-string">"<span class="hljs-variable">${WG_SERV}</span>"</span>
uci <span class="hljs-built_in">set</span> network.wgserver.endpoint_port=<span class="hljs-string">"<span class="hljs-variable">${WG_PORT}</span>"</span>
uci <span class="hljs-built_in">set</span> network.wgserver.route_allowed_ips=<span class="hljs-string">"1"</span>
uci <span class="hljs-built_in">set</span> network.wgserver.persistent_keepalive=<span class="hljs-string">"25"</span>
uci add_list network.wgserver.allowed_ips=<span class="hljs-string">"0.0.0.0/1"</span>
uci add_list network.wgserver.allowed_ips=<span class="hljs-string">"128.0.0.0/1"</span>
uci add_list network.wgserver.allowed_ips=<span class="hljs-string">"::/0"</span><font></font>
uci commit network<font></font>
/etc/init.d/network restart</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit ist die Einrichtung von WireGuard abgeschlossen! </font><font style="vertical-align: inherit;">Jetzt ist der gesamte Datenverkehr auf allen verbundenen Geräten durch eine VPN-Verbindung geschützt.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verweise</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle Nr. 1 </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geänderte Anweisung für MyVPN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (zusätzlich sind </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">L2TP-</font></a><font style="vertical-align: inherit;"> und PPTP-Konfigurationsanweisungen für die Standard-Mikrotik-Firmware verfügbar). </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenWrt WireGuard Client</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de487450/">https://habr.com/ru/post/de487450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487432/index.html">Auf den Spuren von DevConf und CfgMgmtCamp oder was Sie lernen können, indem Sie in 2 Wochen auf zwei internationalen Konferenzen zum Redner gehen</a></li>
<li><a href="../de487438/index.html">Wie erstelle ich ein IT-Unternehmen von Grund auf neu - ohne Erfahrung in diesem Bereich und Programmierkenntnisse?</a></li>
<li><a href="../de487444/index.html">"Während Sie Kaffee trinken, in Rechnung gestellt und einen Push for Payment erhalten" - Innovationen, mit denen Sie rund um die Uhr Geschäfte abwickeln können</a></li>
<li><a href="../de487446/index.html">Kann ein Unternehmen Farbe „besitzen“?</a></li>
<li><a href="../de487448/index.html">Superkräfte ultradünner Materialien: In der Materialwissenschaft ist 2D das neue 3D</a></li>
<li><a href="../de487454/index.html">Wer sind diese Leute? Warum brauchen sie mich? und andere Scrum Master Probleme</a></li>
<li><a href="../de487460/index.html">Delta: Plattform für Datensynchronisation und -anreicherung</a></li>
<li><a href="../de487462/index.html">Webix JavaScript-Bibliothek mit den Augen eines Anfängers. Teil 4. Mit Daten arbeiten. CRUD</a></li>
<li><a href="../de487470/index.html">Calibry: 3D-Durchbruch Preisdurchbruch</a></li>
<li><a href="../de487486/index.html">Sega Dreamcast Anatomy: Konsole Second Life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>