<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧘🏽 ✊🏻 ➕ Muss schnell los. Schnelle IMAP-E-Mail-Synchronisierung 🖖 ⤵️ 🏅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Ich heiße Ilya. Vor zwei Jahren bin ich dem IMAP Mobile Client beigetreten. Frühere Versionen der Anwendung haben die Liste der Briefe lange Ze...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Muss schnell los. Schnelle IMAP-E-Mail-Synchronisierung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492074/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo! Ich heiße Ilya. Vor zwei Jahren bin ich dem IMAP Mobile Client beigetreten. Frühere Versionen der Anwendung haben die Liste der Briefe lange Zeit heruntergeladen und viel Verkehr für die Aktualisierung des Postfachs aufgewendet. Es stellte sich die Frage nach der Optimierung der Arbeit mit dem Protokoll und nach den Fähigkeiten dieses Protokolls im Allgemeinen. Ich wusste nichts über das Protokoll und stürzte mich in das Lesen der Dokumentation. Es stellt sich heraus, dass der Client das Protokoll die ganze Zeit ohne Unterbrechung verwendet hat und die Implementierungsfunktionen überhaupt nicht berücksichtigt hat. Diese Funktionen haben dazu beigetragen, das Herunterladen von E-Mails um das Zwei- bis Dreifache zu beschleunigen. Was IMAP ist und welche Chips es später in meinem Artikel zur Optimierung gibt.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde nicht zu tief in das Protokoll eintauchen. </font><font style="vertical-align: inherit;">Ein Artikel eher aus der Kategorie "Ich möchte diesen Artikel vor zwei Jahren lesen." </font><font style="vertical-align: inherit;">Es ist unwahrscheinlich, dass IMAP-Gurus neue Informationen für sich finden. </font><font style="vertical-align: inherit;">Dieser Artikel basiert auf der Protokollbeschreibung von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 3501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serververbindung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IMAP ist ein Stateful-Protokoll. </font><font style="vertical-align: inherit;">Dies war eine Entdeckung für mich, bevor ich solche Protokolle nicht gesehen oder damit gearbeitet hatte. </font><font style="vertical-align: inherit;">Betrachten Sie das Schema der Arbeit mit dem Server.&nbsp;</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/311/882/30f/31188230f96d5252e2a974ebe843786d.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gehen wir der Reihe nach und vor allem mit Beispielen. </font><font style="vertical-align: inherit;">Zuerst müssen Sie eine Verbindung zum Server herstellen. </font><font style="vertical-align: inherit;">Verwenden Sie dazu die openSSL-Bibliothek.</font></font><br>
<br>
<pre><code class="bash hljs">openssl s_client -connect imap.server.com:993 -crlf&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gut, die Verbindung ist hergestellt und Sie können die OK-Antwort mit einer Zeile beobachten, die mit der CAPABILITY-Antwort beginnt</font></font><br>
<br>
<pre><code class="bash hljs">OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE&nbsp; SPECIAL-USE AUTH=PLAIN AUTH=LOGIN]</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
jede CAPABILITY gibt es einen praktischen </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Spickzettel</font></a><font style="vertical-align: inherit;"> , in dem alle möglichen CAPABILITY-Werte mit Links zum RFC geschrieben sind. </font><font style="vertical-align: inherit;">Beispielsweise teilt IMAP4rev1 dem Client mit, dass der Server gemäß dem IMAP4-Standard arbeitet, und IDLE signalisiert, dass Sie Änderungen abonnieren können, die im Postfach auftreten.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serverautorisierung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie eine Verbindung zum Server hergestellt haben, müssen Sie zu Ihrer Mailbox gehen. </font><font style="vertical-align: inherit;">Dies erfolgt mit dem Befehl LOGIN.</font></font><br>
<br>
<pre><code class="bash hljs">a1 LOGIN email pass</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, hör auf, logge dich ein, ich verstehe, und a1 was ist das? </font><font style="vertical-align: inherit;">-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vielleicht fragst du. </font><font style="vertical-align: inherit;">Und das ist das Team-Tag. </font><font style="vertical-align: inherit;">Im Interesse des Kunden sollten die Tags unterschiedlich sein, da die Antwort mit demselben Tag wie die Anforderung eingeht, was bedeutet, dass sie für das Parsen zwischen Teams abgeglichen werden kann. </font><font style="vertical-align: inherit;">Der Server kann auch eine Antwort mit einem Sternchen am Anfang zurückgeben, z. B. * OK. Dies wird als Antwort ohne Tags bezeichnet. </font><font style="vertical-align: inherit;">Grundsätzlich wird eine solche Antwort für Teams zurückgegeben, die mehrere Entitäten in der Antwort erwarten, z. B. LIST.&nbsp;</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ordnerlistenanforderung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine Liste von Buchstaben in einem Ordner anzufordern, müssen Sie zuerst diese Ordner herausfinden. </font><font style="vertical-align: inherit;">Dies erfolgt mit dem Befehl LIST. </font><font style="vertical-align: inherit;">Dieser Befehl gibt eine Liste der Ordner auf dem Server zurück.</font></font><br>
<br>
<pre><code class="bash hljs">A2 LIST «» *<font></font>
* LIST (\HasNoChildren \Trash) «/» Trash<font></font>
* LIST (\HasNoChildren \Sent) «/» Sent<font></font>
* LIST (\HasNoChildren \Drafts) «/» Drafts<font></font>
* LIST (\HasNoChildren \Junk) «/» Junk<font></font>
* LIST (\HasNoChildren) «/» INBOX<font></font>
A2 OK List completed (0.001 + 0.000 + 0.001 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Parameter im Befehl ist der Namespace. Wenn der Server einen Namespace unterstützt, können seine Werte mithilfe der NAMESPACE-Abfrage angefordert werden. Der Standard-Namespace sieht aus wie eine leere Zeichenfolge. Als nächstes kommt der Platzhalterparameter ins Spiel. Damit können wir dem Server mitteilen, welche Ordner wir zurückgeben müssen. Zum Beispiel können wir erhalten: einen Ordnerbaumzweig, nur Wurzeln oder einfach alles, wie im obigen Beispiel. Es ist besser, dies nicht zu tun, denn wer weiß, wie viele Ordner der Benutzer in der Box hat. Die Autoren des Protokolls empfehlen die Verwendung von "%". In diesem Fall erhalten Sie alle Ordner der obersten Ebene aus dem Postfach.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus der Antwort geht hervor, dass dies eine Antwort ohne Tags ist, bei der jede Zeile Ihr Ordner in der Box ist. </font><font style="vertical-align: inherit;">Erstens gibt es Flags, mit denen wir die Metainformationen des Ordners lesen. In diesem Beispiel haben alle Ordner keine Nachkommen und einige Spezialordner (wie Papierkorb, Junk usw.). </font><font style="vertical-align: inherit;">Als nächstes kommt das Ordnertrennzeichen. </font><font style="vertical-align: inherit;">Dieses Symbol wird für Unterordner verwendet. </font><font style="vertical-align: inherit;">Für einen Nachkommen des Papierkorbs würde der Name beispielsweise wie "Papierkorb / Neuer Ordner" aussehen. </font><font style="vertical-align: inherit;">Nach allen Ordnern gibt der Server mit dem Tag, das wir dem Befehl zugewiesen haben, und der Ausführungszeit dieses Befehls OK an uns zurück.&nbsp;&nbsp;</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ordnerauswahl</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Weiter müssen wir gemäß dem Schema einen Ordner auswählen, aus dem wir unsere Nachrichten straffen werden. </font><font style="vertical-align: inherit;">Dies erfolgt mit dem Befehl SELECT.</font></font><br>
<br>
<pre><code class="bash hljs">4 SELECT INBOX<font></font>
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span>)<font></font>
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span> \*)] Flags permitted.<font></font>
* 16337 EXISTS<font></font>
* 2 RECENT<font></font>
* OK [UNSEEN 6037] First unseen.<font></font>
* OK [UIDVALIDITY 1532079879] UIDs valid<font></font>
* OK [UIDNEXT 17412] Predicted next UID<font></font>
* OK [HIGHESTMODSEQ 21503] Highest<font></font>
4 OK [READ-WRITE] Select completed (0.015 + 0.000 + 0.014 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie einen Ordner auswählen, werden alle Informationen darüber zurückgegeben. </font><font style="vertical-align: inherit;">Lass uns in Ordnung gehen.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antworten Sie mit Flags, die im Ordner für Buchstaben zulässig sind.&nbsp;&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antworten Sie mit Flags, die der Client für immer ändern kann</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antworten Sie mit der Anzahl der Buchstaben im Ordner</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Antwort ist mit der Anzahl der letzten Briefe, dh derjenigen, die wir zwischen den Ordnerauswahlen erhalten haben</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antworten Sie mit der Anzahl der ungelesenen Nachrichten</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, lassen Sie uns jetzt darüber nachdenken. </font><font style="vertical-align: inherit;">Den Rest der Informationen brauchen wir nicht.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Briefe anfordern</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Interessanteste ist nun die Bitte um Briefe. </font><font style="vertical-align: inherit;">Hier muss man besonders bei mobilen Clients sehr vorsichtig sein. </font><font style="vertical-align: inherit;">Stimmen Sie zu, es ist unwahrscheinlich, dass Sie beim Aufrufen der Anwendung Tausende von Nachrichten vom Server an Ihre Datenbank erhalten. </font><font style="vertical-align: inherit;">Darüber hinaus ist es nicht sinnvoll, den gesamten Brief herunterzuladen, da es möglicherweise nicht praktikabel ist, beispielsweise eine Liste aller Briefe anzuzeigen. </font><font style="vertical-align: inherit;">Um beispielsweise die Benutzerbriefe schnell anzuzeigen, werden wir nur nach einem "Umschlag" fragen. </font><font style="vertical-align: inherit;">In diesem Umschlag möchten wir sehen: Absender, Empfänger, Betreff des Briefes und Versanddatum. </font><font style="vertical-align: inherit;">Wir werden die ersten 10 Beiträge laden.</font></font><br>
<br>
<pre><code class="bash hljs">5 FETCH 16337:16327 (ENVELOPE)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Doppelpunkt zählt das Segment der Anzahl der Buchstaben auf, die wir empfangen möchten, und in Klammern, was wir aus diesen Buchstaben lesen möchten, in diesem Fall den Umschlag des Buchstabens. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde die Antwort in Kurzform geben:</font></font><br>
<br>
<pre><code class="bash hljs">* 16334 FETCH (ENVELOPE (<span class="hljs-string">"Sat, 07 Sep 2019 23:07:48 +0000"</span> <span class="hljs-string">"Hello from Fabric.io"</span> ((<span class="hljs-string">"Fabric"</span> NIL <span class="hljs-string">"notifier"</span> <span class="hljs-string">"fabric.io"</span>)) ((<span class="hljs-string">"Fabric"</span> NIL <span class="hljs-string">"notifier"</span> <span class="hljs-string">"fabric.io"</span>)) ((<span class="hljs-string">"Fabric"</span> NIL <span class="hljs-string">"notifier"</span> <span class="hljs-string">"fabric.io"</span>)) ((NIL NIL <span class="hljs-string">"me"</span> <span class="hljs-string">"me@mail"</span>)) NIL NIL NIL <span class="hljs-string">"&lt;5d7438441b07c_2d872ad30967b9646405c6@answers-notifier2012.mail&gt;"</span>))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist klar, dass nichts klar ist. </font><font style="vertical-align: inherit;">Und die Sache ist, dass das Umschlagformat von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2822</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vorgegeben wird. </font><font style="vertical-align: inherit;">Ich werde es in diesem Artikel nicht berücksichtigen. </font><font style="vertical-align: inherit;">Dieser Umschlag enthält alle erforderlichen Informationen: Datum des Eingangs des Briefes, Betreff des Briefes, Absender, Empfänger und sogar die Nachrichten-ID. </font><font style="vertical-align: inherit;">Seine Kunden zeigen ein Gespräch an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir konnten dem Benutzer also grundlegende Informationen über den Brief anzeigen, aber was ist mit dem Körper? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir können sofort den gesamten Text des Briefes herunterladen, unabhängig von seiner Größe. Dies ist natürlich nicht lange, aber dennoch kostspielig über das Netzwerk und den Speicher. </font><font style="vertical-align: inherit;">Dies geschieht übrigens mit demselben FETCH-Befehl.&nbsp;</font></font><br>
<br>
<pre><code class="bash hljs">6 FETCH 16337:16327 (BODY[])&nbsp;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versuchen Sie einen solchen Befehl in Ihrem Posteingang, und Sie werden verstehen, was ich mit "teuer" gemeint habe. Selbst bei 10 Nachrichten erhalten wir eine ziemlich umfangreiche Antwort mit absolut allen Informationen über den Brief. Apropos sie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oft haben Sie die Quelle des Briefes in einem Ihnen bekannten Kunden heruntergeladen, um zu sehen, wie er in seiner ursprünglichen Form aussieht? Wenn nicht, lassen Sie uns einen Testbrief herausholen. Darin habe ich ein Bild direkt zum Brief und ein Bild als Anhang hinzugefügt. Speichern Sie es im EML-Format und öffnen Sie es mit einem beliebigen Texteditor. Je nach Kunde erhalten Sie unterschiedliche Quellen für den Brief, die jedoch im Allgemeinen ähnlich sind.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beginnen wir mit dem E-Mail-Header:</font></font><br>
<br>
<pre><code class="bash hljs">Return-Path: &lt;myemail&gt;<font></font>
Delivered-To:myemail<font></font>
Received: from localhost (localhost [127.0.0.1])<font></font>
	byimap.server.com (imap.server.com) with ESMTP id 6C2BE2A0363<font></font>
	<span class="hljs-keyword">for</span> &lt;myemail&gt;; Sun,&nbsp; 8 Sep 2019 23:41:29 +0300 (MSK)<font></font>
X-Virus-Scanned: amavisd-new at imap.server.com<font></font>
Received: from imap.server.com ([127.0.0.1])<font></font>
	by localhost ( imap.server.com [127.0.0.1]) (amavisd-new, port 10026)<font></font>
	with ESMTP id abx8HQQT_k5A <span class="hljs-keyword">for</span> &lt;myemail&gt;;<font></font>
	Sun,&nbsp; 8 Sep 2019 23:41:29 +0300 (MSK)<font></font>
Mime-Version: 1.0<font></font>
Date: Sun, 08 Sep 2019 20:41:28 +0000<font></font>
Content-Type: multipart/mixed;<font></font>
&nbsp;boundary=»--=_Part_722_554093397.1567975288»<font></font>
Message-ID: &lt;9e4e3872e603eac2c20f26bb1d65548d&gt;<font></font>
From: <span class="hljs-string">"Me"</span> &lt;myemail&gt;<font></font>
Subject: Hey, Habr!<font></font>
To: myemail<font></font>
X-Priority: 3 (Normal)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Metainformationen werden in der Kopfzeile des Briefes beschrieben, von wem, an wen, wann, Art des Nachrichteninhalts, Betreff und Priorität des Briefes. </font><font style="vertical-align: inherit;">Das Grenzfeld gibt die Grenze des Buchstabens an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verstehe weiter, was das bedeutet.</font></font><br>
<br>
<pre><code class="bash hljs">----=_Part_722_554093397.1567975288<font></font>
Content-Type: multipart/related;<font></font>
&nbsp;boundary=»--=_Part_583_946112260.1567975288»<font></font>
----=_Part_583_946112260.1567975288<font></font>
Content-Type: multipart/alternative;<font></font>
&nbsp;boundary=»--=_Part_881_599167713.1567975288»<font></font>
----=_Part_881_599167713.1567975288<font></font>
Content-Type: text/plain; charset=«utf-8»<font></font>
Content-Transfer-Encoding: quoted-printable<font></font>
----=_Part_881_599167713.1567975288<font></font>
Content-Type: text/html; charset=«utf-8»<font></font>
Content-Transfer-Encoding: quoted-printable<font></font>
&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=3D<span class="hljs-string">"Content-Type"</span> content=3D<span class="hljs-string">"t=
ext/html; charset=3Dutf-8"</span> /&gt;&lt;/head&gt;&lt;body&gt;&lt;div data-crea=3D<span class="hljs-string">"font-wrapper"</span>=<font></font>
&nbsp;style=3D«font-family: XO Tahion; font-size: 16px; direction: ltr»&gt; &lt;img =<font></font>
src=3D<span class="hljs-string">"cid:jua-uid-q1nz1guinitrcfd3-1567975257318"</span>&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;/div&gt; &lt;b=<font></font>
r&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<font></font>
----=_Part_881_599167713.1567975288--<font></font>
----=_Part_583_946112260.1567975288<font></font>
Content-Type: image/jpeg; name=«2018-09-04 22.46.36.jpg»<font></font>
Content-Disposition: inline; filename=«2018-09-04 22.46.36.jpg»<font></font>
Content-ID: &lt;jua-uid-q1nz1guinitrcfd3-1567975257318&gt;<font></font>
Content-Transfer-Encoding: base64</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Grenze ist die übliche Grenze einer Schrift. </font><font style="vertical-align: inherit;">Sie beginnen mit zwei Bindestrichen "-". </font><font style="vertical-align: inherit;">Die schließende Grenze hat diese beiden Bindestriche am Ende. </font><font style="vertical-align: inherit;">Es wird ausführlicher in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC1341 beschrieben.</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dies kann als Hauptteil des Briefes bezeichnet werden. Teile des Briefes und ihre MIME-Typen werden hier beschrieben.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informationen zu MIME-Typen</font></font></b><div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein MIME-Typ ist ein Medientyp, der in MIME ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multipurpose Internet Mail Extensions)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beschrieben wurde, um die Inhaltstypen in einer E-Mail-Nachricht zu beschreiben.&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mehrteilig / gemischt sagt uns, dass der Buchstabe eine gemischte Struktur hat, dh verschiedene Teile von Buchstaben können unterschiedliche Darstellungen dieser oder jener Informationen sein.&nbsp;</font></font></li>
</ul><br>
<ul>
<li>multipart/related  ,     ,     ,&nbsp;</li>
</ul><br>
<ul>
<li>multipart/alternative   ,       , ,   text/plain  text/html,       .&nbsp;</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben hier keinen einfachen Text, daher ist es logischer, eine HTML-Darstellung zu erstellen. In dieser HTML-Präsentation gibt es nur ein Bild mit dem Parameter Content-Disposition: Inline, das heißt, es befindet sich direkt im Hauptteil des Briefes und nicht in den angehängten Dokumenten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Link zu diesem Bild ist nicht ganz einfach. Es wird durch den Parameter Content-ID beschrieben, der gleich </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jua-uid-q1nz1guinitrcfd3-1567975257318 ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies ist ein Link zum nächsten Teil des Briefes - ein Bild, das in Base-64 codiert ist. Um meine Nerven zu schonen, habe ich nicht den gesamten Base-64-Code eingefügt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der letzte Teil des Briefes hat das Formular&nbsp;</font></font><br>
<br>
<pre><code class="bash hljs">----=_Part_722_554093397.1567975288<font></font>
Content-Type: image/png; name=«2018-07-02 11.08.23 pm.png»<font></font>
Content-Disposition: attachment; filename=«2018-07-02 11.08.23 pm.png»<font></font>
Content-Transfer-Encoding: base64</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
die bereits Content-Disposition nicht inline hat, wie das Bild oben, sondern Anhang. </font><font style="vertical-align: inherit;">Dieses Bild sollte nur in das Dateianhangfenster gelangen, da es übrigens auch in Base-64 codiert ist und eine große Größe hat. </font><font style="vertical-align: inherit;">Hier wird klar, dass Sie nicht noch einmal den gesamten Textkörper laden sollten, wenn wir nur grundlegende Informationen anzeigen möchten.&nbsp;</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zurück zum Protokoll</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie an den Buchstaben gearbeitet haben, müssen Sie den ausgewählten Ordner schließen und sich vom Server verabschieden. </font><font style="vertical-align: inherit;">Um den Ordner zu schließen, müssen wir den Befehl CLOSE eingeben. </font><font style="vertical-align: inherit;">Ja, es ist so einfach</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
7 CLOSE<font></font>
7 OK Close completed (0.001 + 0.000 secs).<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Übrigens, wenn Sie parallel mit mir mit der Konsole gearbeitet und den Artikel gelesen haben, könnte ein nicht so angenehmes Ereignis eingetreten sein, der Server könnte Ihre Verbindung durch Timeout schließen. </font><font style="vertical-align: inherit;">Dies ist völlig normal und jeder Server hat sein eigenes Timeout. Wir haben beispielsweise 30 Minuten Zeit.&nbsp;</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher wird empfohlen, den NOOP-Befehl im Hintergrund auszuführen</font></font><br>
<br>
<pre><code class="bash hljs">1 NOOP<font></font>
1 OK NOOP completed (0.001 + 0.000 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es macht buchstäblich nichts, aber Sie können die Verbindung ohne Zeitüberschreitung so lange beibehalten, wie wir es benötigen. </font><font style="vertical-align: inherit;">Wenn Sie derzeit einen Ordner auswählen, kann NOOP als regelmäßige Anforderung für Änderungen an diesem Ordner fungieren&nbsp;</font></font><br>
<br>
<pre><code class="bash hljs">1 NOOP<font></font>
* 16472 EXPUNGE<font></font>
* 16471 EXPUNGE<font></font>
* 16472 EXISTS<font></font>
* 1 RECENT<font></font>
1 OK NOOP completed (0.004 + 0.000 + 0.003 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier in der Antwort werden wir über zwei gelöschte Nachrichten informiert, eine neue und dass die Anzahl der Nachrichten in diesem Ordner 16 472 beträgt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich </font><font style="vertical-align: inherit;">stelle </font><font style="vertical-align: inherit;">auch fest, dass Sie nur mit einem ausgewählten Ordner arbeiten können, hier gibt es keine parallele Arbeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, am Ende schließen Sie die Sitzung mit dem Server und wir werden uns von ihm verabschieden.</font></font><br>
<br>
<pre><code class="bash hljs">8 LOGOUT<font></font>
* BYE Logging out<font></font>
8 OK Logout completed (0.001 + 0.000 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sehen die traurige, nicht getaggte BYE-Antwort, was bedeutet, dass es Zeit ist, den Job zu beenden.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schnelle Synchronisierung mit CONDSOTORE und QRESYNC</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der NOOP-Operation können Sie Änderungen in einem Feld in einem ausgewählten Ordner verfolgen. Aber was ist, wenn wir herausfinden möchten, was sich in dem Ordner geändert hat, während wir mit einem anderen gearbeitet haben? Die naheliegendste Option besteht darin, alle Buchstaben im lokalen Speicher zu sortieren, unabhängig davon, ob es sich um einen Cache oder eine Datenbank handelt, und mit dem zu vergleichen, was der Server zurückgibt. Einerseits ist dies in der Tat eine Lösung, und auf einigen Servern wird es buchstäblich die einzig wahre sein. Auf der anderen Seite möchten wir Buchstaben so schnell anzeigen, wie es das Protokoll allgemein zulässt. Glücklicherweise unterstützt unser Server Protokollerweiterungen wie CONDSTORE und QRESYNC, die zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">RFC7162</font></a><font style="vertical-align: inherit;"> hinzugefügt </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wurden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die erste fügt der Nachricht und dem Ordner eine spezielle 63-Bit-Nummer hinzu, die als Mod-Sequenz bezeichnet wird und mit jeder Operation an diesem Buchstaben zunimmt. Die höchste Mod-Sequenz unter allen Nachrichten wird dem Ordner hinzugefügt. Infolgedessen können wir jedes Mal, wenn Sie eine Verbindung zu einem Ordner auf einem Server herstellen, der CONDSTORE unterstützt, leicht herausfinden, ob sich etwas geändert hat oder nicht, indem wir einfach die Mod-Sequenz-Werte für den lokalen Ordner und den Server-Ordner vergleichen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus fügt diese Erweiterung zusätzliche Parameter für die STORE- und FETCH-Befehle hinzu - CHANGEDSINCE-Mod-Sequenz und UNCHANGEDSINCE-Mod-Sequenz, mit denen Sie eine Operation ausführen können, wenn die Mod-Sequenz der übertragenen Nachrichten größer bzw. kleiner als die angegebene ist. Schauen wir uns ein Beispiel an.</font></font><br>
<br>
<pre><code class="bash hljs">FETCH 17221:17241 (UID) (CHANGEDSINCE 0)<font></font>
* OK [HIGHESTMODSEQ 22746] Highest<font></font>
* 17222 FETCH (UID 18319 MODSEQ (22580))<font></font>
* 17223 FETCH (UID 18320 MODSEQ (22601))<font></font>
* 17224 FETCH (UID 18324 MODSEQ (22607))<font></font>
* 17225 FETCH (UID 18325 MODSEQ (22604))<font></font>
* 17226 FETCH (UID 18326 MODSEQ (22608))<font></font>
* 17227 FETCH (UID 18327 MODSEQ (22614))<font></font>
* 17228 FETCH (UID 18328 MODSEQ (22613))<font></font>
* 17229 FETCH (UID 18336 MODSEQ (22628))<font></font>
* 17230 FETCH (UID 18338 MODSEQ (22628))<font></font>
* 17231 FETCH (UID 18340 MODSEQ (22628)<font></font>
* 17232 FETCH (UID 18341 MODSEQ (22628))<font></font>
* 17221 FETCH (UID 18318 MODSEQ (22583))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe eine Situation simuliert, in der wir in die Mailbox gegangen sind und vorher nichts davon gewusst haben, dh unsere lokale Mod-Sequenz ist 0. Wie Sie sehen, gibt der Server im Allgemeinen alle Nachrichten zurück, die sich in der Mailbox befinden, da wir zuvor nichts erhalten haben und weiß nichts über die Box. Als Antwort auf eine Anfrage nach UID-Briefen von CHANGEDSINCE enthält eine Antwort ohne Tags OK auch einen HIGHESTMODESEQ, den wir jetzt speichern, und für jede Nachricht unseren MODSEQ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden einige Operationen mit der Mailbox </font><font style="vertical-align: inherit;">ausführen </font><font style="vertical-align: inherit;">: Neue Buchstaben hinzufügen, Flags ändern. Lassen Sie uns eine neue Anfrage stellen, aber mit der vorherigen Mod-Sequenz</font></font><br>
<br>
<pre><code class="bash hljs">1 fetch 17221:* (UID FLAGS) (CHANGEDSINCE 22746)<font></font>
* 17267 FETCH (UID 18378 FLAGS () MODSEQ (22753))<font></font>
* 17270 FETCH (UID 18381 FLAGS (\Seen) MODSEQ (22754))<font></font>
* 17271 FETCH (UID 18382 FLAGS () MODSEQ (22751))<font></font>
* 17273 FETCH (UID 18384 FLAGS () MODSEQ (22750))</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und wir sehen bereits den Unterschied, anstatt 20 alte und neue Communities auszugeben, die gerade angekommen sind (Sternchen 17221: * bedeutet, Buchstaben von Nummer 17221 auf das Maximum zu bringen), erhalten wir Briefe, deren MODSEQ größer als die vorherige ist. Dies hilft sehr gut, einen Ordner zu synchronisieren, in dem wir uns seit einiger Zeit nicht mehr befinden, und eine Art Besetzung der geänderten Buchstaben zu erhalten, anstatt alle möglichen zu versuchen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint viel besser zu sein? Mit QRESYNC wird der Synchronisierungsvorgang jedoch noch schneller. Sie können die MODSEQ-Parameter und die uns bekannten Nachrichten-UIDs direkt bei der Ordnerauswahl angeben. Lassen Sie uns mit einem Beispiel erklären. Zunächst muss QRESYNC mit dem Befehl ENABLE aktiviert werden.&nbsp;</font></font><br>
<br>
<pre><code class="bash hljs">1 ENABLE QRESYNC<font></font>
* ENABLED QRESYNC<font></font>
1 OK Enabled (0.001 + 0.000 secs).<font></font>
1 SELECT INBOX (QRESYNC (0 0))<font></font>
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span>)<font></font>
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span> \*)] Flags permitted.<font></font>
* 17271 EXISTS<font></font>
* 0 RECENT<font></font>
* OK [UNSEEN 17241] First unseen.<font></font>
* OK [UIDVALIDITY 1532079879] UIDs valid<font></font>
* OK [UIDNEXT 18385] Predicted next UID<font></font>
* OK [HIGHESTMODSEQ 22754] Highest<font></font>
1 OK [READ-WRITE] Select completed (0.001 + 0.000 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir vorher nichts über den Ordner wussten, gibt der Server nur Informationen über den Ordner an uns zurück, ohne ein Nugget seiner Änderungen. Angenommen, wir haben die ersten zwanzig Nachrichten abgefragt und uns an ihre UID und auch an HIGHESTMODESEQ erinnert. Wir verlassen den Ordner, senden uns eine Nachricht, löschen die Nachricht, ändern die Flags und kehren mit den früheren Informationen über den Ordner zurück</font></font><br>
<br>
<pre><code class="bash hljs">1 CLOSE<font></font>
1 OK Close completed (0.001 + 0.000 secs).<font></font>
1 SELECT INBOX (QRESYNC (1532079879 22754 18300:18385))<font></font>
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span>)<font></font>
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft <span class="hljs-variable">$Forwarded</span> <span class="hljs-variable">$MDNSent</span> \*)] Flags permitted.<font></font>
* 17271 EXISTS<font></font>
* 0 RECENT<font></font>
* OK [UNSEEN 17241] First unseen.<font></font>
* OK [UIDVALIDITY 1532079879] UIDs valid<font></font>
* OK [UIDNEXT 18386] Predicted next UID<font></font>
* OK [HIGHESTMODSEQ 22757] Highest<font></font>
* VANISHED (EARLIER) 18380<font></font>
* 17269 FETCH (UID 18383 FLAGS () MODSEQ (22757))<font></font>
* 17271 FETCH (UID 18385 FLAGS () MODSEQ (22755))<font></font>
1 OK [READ-WRITE] Select completed (0.001 + 0.000 secs).</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt erhalten wir bei der Auswahl eines geänderten Ordners sofort ein Nugget an Änderungen in Form einer Antwort VANISHED (EARLIER) für gelöschte Nachrichten und FETCH für hinzugefügte oder geänderte Nachrichten. Jetzt ist es noch einfacher, den Ordner zu synchronisieren, wenn der Benutzer ihn längere Zeit nicht besucht hat. Dies ist eine sehr coole Methode, wenn Sie eine Reihe von Nachrichten lokal im Cache gespeichert haben und diese nicht mit Nachrichten auf dem Server vergleichen möchten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Parameter dieser Anforderung ist UIDVALIDITY, mit dem im Wesentlichen überprüft wird, ob sich die zuvor empfangene UID im Ordner nicht geändert hat. Dies kann passieren, wenn der Server die Sitzungs-UID für alle Nachrichten von Sitzung zu Sitzung ändert oder der Ordner gelöscht wurde und an seiner Stelle ein Ordner mit demselben Namen erstellt wurde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Parameter ist der uns bekannte HIGHESTMODSEQ und der letzte ist das Intervall bekannter UIDs. Sie können als Doppelpunkt geschrieben werden, wenn das Intervall kontinuierlich ist oder durch ein Komma getrennt ist.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Beispiel bin ich auf eine Situation gestoßen, in der Unkenntnis des Themenbereichs zu einer fehlerhaften und suboptimalen Funktionsweise der Anwendung führt. </font><font style="vertical-align: inherit;">Ich habe in diesem Artikel nicht alle möglichen Optionen für die Verwendung des Protokolls behandelt. </font><font style="vertical-align: inherit;">Ich hoffe jedoch, dass die obigen Informationen für den nächsten Entwickler des IMAP-Clients hilfreich sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IMAP hat eine Menge interessanter Sachen. </font><font style="vertical-align: inherit;">Befehle für die schnelle Synchronisierung sind nur der Anfang. Tatsächlich können Sie verschiedene IMAP-Befehle je nach den Funktionen des Servers weiter optimieren und die Arbeit mit E-Mails schneller, wirtschaftlicher in Bezug auf Netzwerk und Speicher und im Allgemeinen angenehmer gestalten. </font><font style="vertical-align: inherit;">Aber darüber werde ich später sprechen.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de492058/index.html">ROS2 vs ROS1. Installation von ROS2 unter Ubuntu 18.04</a></li>
<li><a href="../de492060/index.html">Wie löst man? "ECONNREFUSED - Verbindung vom Server abgelehnt"</a></li>
<li><a href="../de492062/index.html">Golang Backend Server Vorlage - Teil 1 (HTTP Server)</a></li>
<li><a href="../de492066/index.html">Warum Event Sourcing das Gegenmuster für die Interaktion mit Microservices ist</a></li>
<li><a href="../de492068/index.html">Die S7 Group eröffnet am MIPT eine Abteilung „Informationstechnologien in der Luftfahrt“</a></li>
<li><a href="../de492076/index.html">Ein Beispiel für eine hexagonale Architektur in Java</a></li>
<li><a href="../de492078/index.html">Die wichtigsten und nützlichsten Materialien zum Coronavirus COVID-19</a></li>
<li><a href="../de492082/index.html">So vereinfachen und verwalten Sie die Verwaltung von Heimgeräten (teilen Sie Ideen zu Kauri Safe Smart Home)</a></li>
<li><a href="../de492086/index.html">Coronavirus gegen russisches IT-Geschäft: Sind Unternehmen bereit, Mitarbeiter an einen entfernten Standort zu verlegen?</a></li>
<li><a href="../de492088/index.html">Testen der Amazon Lumberyard Game Engine. Ansätze und Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>