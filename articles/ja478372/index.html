<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👊 📯 🙌🏾 耐え難いほど苦痛にならないようにWAFと共存する方法 🤸🏿 😎 👩🏻‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="アプリケーションレベルのファイアウォールの機能を説明する次の記事はありません。すでにたくさんあります。今日は、このソリューションを使用する際の落とし穴について説明します。これにより、プロジェクトの開始前であってもそれらについて理解し、コースを正しくプロットできます。
 
 彼らは初めて、2008年に...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>耐え難いほど苦痛にならないようにWAFと共存する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/478372/"><img src="https://habrastorage.org/webt/z2/9m/o7/z29mo7n0jla220e_3i8tr8yl4ii.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションレベルのファイアウォールの機能を説明する次の記事はありません。</font><font style="vertical-align: inherit;">すでにたくさんあります。</font><font style="vertical-align: inherit;">今日は、このソリューションを使用する際の落とし穴について説明します。これにより、プロジェクトの開始前であってもそれらについて理解し、コースを正しくプロットできます。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らは初めて、2008年に国内市場でWebアプリケーションファイアウォール（WAF）について話し始め、2011年にその人気が高まりました。このソリューションは現在非常に需要が高くなっていますが、（最初のインシデントの前に）なぜそれが必要なのか本当に誰も知りません。さまざまな組織の情報セキュリティ部門と通信するとき、「はい、私たちを必要としている人」や「私たちはこれまでハッキングされたことはなく、今もハッキングされていない」とよく耳にします。しかし、実践が示すように、彼らはすべての人を自動的にそして時には標的にして攻撃します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハッカーは一種のコミュニティであり、他のコミュニティと同様に、新生物と専門家で構成されています。この分野の愛好家には、脆弱性を見つけて自慢するという1つの動機しかありません。誰が賢く、この情報を暗闇で販売しています。そこでは、準備なしでは検出することがほとんど不可能である標的型攻撃を組織する非常に専門的なサイバーグループの手に落ちます。記事の前半で、詳細な調査を実施し、情報と技術システムに可能な限り完全にアクセスできるようにするために、攻撃者が脆弱なインフラストラクチャの長期的で目立たない存在に向けてますます努力しているとすでに述べました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハッキングの結果は、当座預金からお金を盗むことから、組織のリソースを使用してDDoS攻撃を実行することまで、さまざまです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WAFソーラーMSSサービスのために私たちに来たお客様は、実装中に彼ら自身が遭遇した同じ問題について話しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加の予算を追加 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、最近、Webセキュリティソリューションの購入は予算が立てやすくなりました。そして、あなたはすでに市場に存在するWAFのいずれかの幸運な所有者であり、おそらく最悪の状況でさえありません...しかし、適切に訓練されたWAFスペシャリストがいないとセットアップできず、侵入者から身を守ることができず、ITユニットが急いで特定することはないことを理解するには、説明を開くだけで十分です。その操作のための管理者。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このデバイスの使い方を学ぶために従業員を派遣するとします（ちなみに、多くの人が最年少で未経験の部下をそのようなトレーニングに送ります-大きな間違いです）。スペシャリストは数日後に戻り、IT管理者と共にWebサーバーとWAFのネットワーク接続の構成を開始します（実際、この作業は通常、デフォルトルートの変更とWAFを介したトラフィックのリダイレクトに帰着します）。すべてのキーと証明書がすでにWAFにあるため、SSLトラフィックは徹底的に検査されますが、同時にサイトの機能の半分が機能しなくなります。優れたWAF保護モジュールは、サイト上のJavaScriptがマルウェアまたはボットとして機能することを決定しました。判明したように、CSRFトークンはどこでも要求されるべきではありませんが、</font><font style="vertical-align: inherit;">WAFを</font><font style="vertical-align: inherit;">どのようにし</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て知りましたか</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r6/69/fm/r669fmrwwhkmhk8mh0vffpih5ps.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ダッシュボードに「低」、「中」、「高」という単語の反対側にさまざまな数字が表示されます。訓練された10の機械学習モデルのいくつかは、すぐに使えるようになっています。 、およびあなたを含むあなたの訓練された専門家。 2日間で特定のWAFシステムのプロファイリングをトレーニングすることは不可能であるため、典型的なOWASP攻撃と非典型的なOWASP攻撃のすべての種類について深い洞察を与えることで、スペシャリストが自社のWebアプリケーションに関連しているかどうかを判断し、さらにWAF設定の調整方法を教えることができます。 。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、インシデントでどのイベントを形成する必要があるか、特定のWebアプリケーションに相関ルールを適応させる方法を理解する必要があります。ソリューションのコストのみが予算に含まれている場合、それを設定するのに役立つインテグレーターを引き付けるお金がないことが多いため、ほとんどの場合、WAF </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はシェルフに配置され、</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スパンポートモードに切り替えられ、ネットワークルートをデフォルトのルートに変更し、作業を延期します新しい予算が表示される来年。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その過程で、多くの人は、WAFが常に24時間365日安定しているわけではなく、多くの場合クラッシュして、Webの可用性のダウンタイムを引き起こす可能性があることを学びます。フェイルオーバークラスターが必要です。そのサービスとWebアプリケーションの可用性を常に監視する必要があります。これはすべて考慮され、「海岸」で予算が立てられます。</font></font><br>
<br>
<h2>,          </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しばらくして、新しい予算があり、相関ルール、機械学習モデル、ブラックリストを設定するインテグレーターを引き付け、サイトの機能全体も引き続き機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、Webアプリケーションの新しいメジャーリリースがリリースされると、これらのポリシーはすべて前のバージョン用に作成されたため、カボチャに変わり、WAFを介して新しい機能が機能しない可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、Webアプリケーションを保護するいくつかのタスクでは、SZIの個別のクラス（Anti-DDoSやSIEMなど）を使用する方が良いため、WAFをそれらと統合する必要があります。これも簡単な作業ではありません。SZIは常にWAFから独立してメッセージを送信できるとは限らないため、これらの外部システムに送信する必要があるデータ、方法、および形式を理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、お客様の1人は、これらのイベントを将来SIEMに転送し、ブルートフォース攻撃を監視するために、WAFで失敗した認証試行を記録するタスクを抱えていました。このようなルールは通常、すべての一般的なWAFに実装されており、追加の調整なしで機能します。ただし、顧客のWebアプリケーションの開発者は、当時の承認フォームが配列内の配列のように見えるように認証ロジックを記述しました-承認フォームおよびWAFの非標準。 WAFの通常のルールでは、ブルートフォース攻撃のこのようなリクエストフォームを処理することは不可能でした。認証の試行回数、フォームが送信された形式、サーバーコード、および成功または失敗した認証の値が解析された応答本文を追跡するカスタムルールを作成しました。とりわけルールにはボットからの保護が含まれているはずでした。認証の数が指定されたしきい値を超えると、スクリプトが応答ページに入り、サーバーへのリクエストの「人間性」をチェックしました。サーバーへの次の要求がこのチェックに合格しなかった場合、クライアントはキャプチャページにリダイレクトしました。また、このルールはボット（Yandex、Googleなど）の正当なアクティビティを妨害しないようにする必要があります。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装例</font></font></b><div class="spoiler_text"><pre><code class="sql hljs">when CLIENT_ACCEPTED {<font></font>
  BOTDEFENSE::disable<font></font>
  <span class="hljs-keyword">set</span> loginevent <span class="hljs-number">0</span>
  <span class="hljs-keyword">set</span> srcip2 [IP::remote_addr]
  <span class="hljs-keyword">set</span> coun222t <span class="hljs-number">0</span>
  <span class="hljs-keyword">set</span> login_count <span class="hljs-number">3</span>
  <span class="hljs-keyword">set</span> countloginintable <span class="hljs-number">0</span>
  <span class="hljs-keyword">set</span> user_agent <span class="hljs-number">0</span>
  <span class="hljs-keyword">set</span> <span class="hljs-keyword">var</span> <span class="hljs-keyword">test</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">when</span> HTTP_REQUEST {
<span class="hljs-keyword">set</span> sms_count <span class="hljs-number">3</span>
	<span class="hljs-keyword">set</span> evil_client <span class="hljs-number">0</span>
    <span class="hljs-keyword">set</span> evil_client_action <span class="hljs-number">0</span>
	<span class="hljs-keyword">set</span> b_challande_count <span class="hljs-number">0</span>
	 <span class="hljs-keyword">set</span> user_agent [<span class="hljs-keyword">HTTP</span>::header <span class="hljs-keyword">User</span>-<span class="hljs-keyword">Agent</span>]
    <span class="hljs-keyword">set</span> <span class="hljs-keyword">var</span> [IP::client_addr]$user_agent
	<span class="hljs-keyword">if</span> {[<span class="hljs-keyword">virtual</span> <span class="hljs-keyword">name</span>] == <span class="hljs-string">"vs_ccc_pilot"</span>} {
<span class="hljs-comment">#####START LK########</span>
 <span class="hljs-keyword">if</span> { ([<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] starts_with <span class="hljs-string">"/login"</span>) <span class="hljs-keyword">and</span> [<span class="hljs-keyword">HTTP</span>::method] eq <span class="hljs-string">"POST"</span>} {
    <span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">collect</span> [<span class="hljs-keyword">HTTP</span>::header <span class="hljs-keyword">Content</span>-<span class="hljs-keyword">Length</span>]
    <span class="hljs-keyword">set</span> loginevent <span class="hljs-number">1</span><font></font>
    <font></font>
<font></font>
	<font></font>
   <span class="hljs-comment">#log local0. "Login event $loginevent "</span><font></font>
 }<font></font>
  <span class="hljs-keyword">if</span> { ([<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] eq <span class="hljs-string">"/NCbf5"</span> ) &amp;&amp; [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login:[IP::client_addr] -<span class="hljs-keyword">count</span>] &gt;= $login_count } {
   <span class="hljs-keyword">set</span> evil_client <span class="hljs-number">1</span>
   BOTDEFENSE::<span class="hljs-keyword">enable</span>
 <span class="hljs-keyword">if</span> { [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login_un:$<span class="hljs-keyword">var</span> -<span class="hljs-keyword">count</span>] &gt;= <span class="hljs-number">3</span>  } {
	 <span class="hljs-keyword">set</span> evil_client_action <span class="hljs-number">1</span><font></font>
	 }<font></font>
   <font></font>
 }<font></font>
  <span class="hljs-keyword">if</span> { ([<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] eq <span class="hljs-string">"/NCbf5"</span> ) &amp;&amp; [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login:[IP::client_addr] -<span class="hljs-keyword">count</span>] &lt; $login_count } {
  <span class="hljs-keyword">HTTP</span>::redirect <span class="hljs-string">"/login"</span><font></font>
  }<font></font>
<font></font>
<span class="hljs-comment">#####END_LK########</span><font></font>
<font></font>
<span class="hljs-comment">#####START_SMS########</span>
 <span class="hljs-keyword">if</span> { ([<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] starts_with <span class="hljs-string">"/somebuilder/somepath/someVerification/sendsomesms.json.jsp"</span>) <span class="hljs-keyword">and</span> [<span class="hljs-keyword">HTTP</span>::method] eq <span class="hljs-string">"POST"</span>} {
    <span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">collect</span> [<span class="hljs-keyword">HTTP</span>::header <span class="hljs-keyword">Content</span>-<span class="hljs-keyword">Length</span>]
    <span class="hljs-keyword">set</span> loginevent <span class="hljs-number">2</span>
    <span class="hljs-keyword">set</span> SMS_count <span class="hljs-number">3</span>
	<span class="hljs-keyword">set</span> b_challande_count_sms <span class="hljs-number">0</span>
   <span class="hljs-comment">#log local0. "Login event loginevent "</span><font></font>
 }<font></font>
<span class="hljs-comment">#####END_SMS########</span><font></font>
<font></font>
<font></font>
}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">when</span> HTTP_REQUEST_DATA {
<span class="hljs-comment">### ###</span>
  <span class="hljs-keyword">if</span> { $loginevent == <span class="hljs-number">1</span> } { <font></font>
                             foreach x [<span class="hljs-keyword">split</span> [<span class="hljs-keyword">string</span> tolower [<span class="hljs-keyword">HTTP</span>::payload]] <span class="hljs-string">"&amp;"</span>] {
				<span class="hljs-keyword">if</span> { $x starts_with <span class="hljs-string">"%2fcom%2fsomesite%2fsomeuserprofil%2floginhandler.loginsensitive="</span> } { 
                      <span class="hljs-keyword">set</span> user_agent [<span class="hljs-keyword">HTTP</span>::header <span class="hljs-keyword">User</span>-<span class="hljs-keyword">Agent</span>]
                     <span class="hljs-keyword">set</span> <span class="hljs-keyword">var</span> [IP::client_addr]$user_agent
				     <span class="hljs-keyword">set</span> username [lindex [<span class="hljs-keyword">split</span> $x <span class="hljs-string">"="</span>] <span class="hljs-number">1</span>]
				     <span class="hljs-keyword">set</span> countloginintable [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login:[IP::client_addr] -<span class="hljs-keyword">count</span>]
				     <span class="hljs-keyword">set</span> countloginintable2 [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login_un:$<span class="hljs-keyword">var</span> -<span class="hljs-keyword">count</span>]<font></font>
				    <font></font>
                     <span class="hljs-keyword">if</span> { [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login:[IP::client_addr] -<span class="hljs-keyword">count</span>] &gt;= $login_count  } {
                         <span class="hljs-keyword">set</span> evil_client <span class="hljs-number">1</span>
						 <span class="hljs-keyword">set</span> srcip [IP::remote_addr]
						 <span class="hljs-keyword">set</span> msec [clock clicks -milliseconds] <font></font>
						<font></font>
						 <font></font>
						 <span class="hljs-keyword">if</span> { [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable customer_login_un:$<span class="hljs-keyword">var</span> -<span class="hljs-keyword">count</span>] &gt;= <span class="hljs-number">3</span>  } {<font></font>
						 <font></font>
						 <span class="hljs-keyword">set</span> evil_client_action <span class="hljs-number">1</span>
						 } <span class="hljs-keyword">else</span> { 
						 <span class="hljs-keyword">table</span> <span class="hljs-keyword">set</span> -subtable customer_login_un:$<span class="hljs-keyword">var</span> $msec indefinite  <span class="hljs-number">600</span><font></font>
						 }<font></font>
                         BOTDEFENSE::<span class="hljs-keyword">enable</span><font></font>
<font></font>
                        }<font></font>
					}<font></font>
<font></font>
				}<font></font>
<span class="hljs-comment">### ###</span>
   <span class="hljs-keyword">log</span> local0. <span class="hljs-string">"USERNAME $username count $countloginintable count capt $countloginintable2 var $var"</span>
    <span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">release</span>
  }    elseif { $loginevent == <span class="hljs-number">2</span> } { <font></font>
                             foreach x [<span class="hljs-keyword">split</span> [<span class="hljs-keyword">string</span> tolower [<span class="hljs-keyword">HTTP</span>::payload]] <span class="hljs-string">"&amp;"</span>] {
				<span class="hljs-keyword">if</span> { $x starts_with <span class="hljs-string">"phone="</span> } { 
				     <span class="hljs-keyword">set</span> phone [lindex [<span class="hljs-keyword">split</span> $x <span class="hljs-string">"="</span>] <span class="hljs-number">1</span>]
					 <span class="hljs-keyword">table</span> <span class="hljs-keyword">set</span> -subtable sms_some_phone:[IP::client_addr] $phone indefinite  <span class="hljs-number">600</span>
                     <span class="hljs-keyword">if</span> { [<span class="hljs-keyword">table</span> <span class="hljs-keyword">keys</span> -subtable sms_some_phone:[IP::client_addr] -<span class="hljs-keyword">count</span>] &gt;= $sms_count  } {
                         <span class="hljs-keyword">set</span> evil_client <span class="hljs-number">2</span>
						 <span class="hljs-keyword">set</span> srcip [IP::remote_addr]<font></font>
                         BOTDEFENSE::<span class="hljs-keyword">enable</span><font></font>
<font></font>
                        }<font></font>
					}<font></font>
<font></font>
				}<font></font>
<font></font>
   <span class="hljs-keyword">log</span> local0. <span class="hljs-string">"phone sms $phone "</span>
    <span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">release</span><font></font>
  } <font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment">###  ###</span><font></font>
<font></font>
<span class="hljs-keyword">when</span> HTTP_RESPONSE  {
        <span class="hljs-keyword">if</span> { $loginevent == <span class="hljs-number">1</span> } { 
        <span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">collect</span> <span class="hljs-number">2048</span>
        <span class="hljs-keyword">if</span> { [<span class="hljs-keyword">HTTP</span>::cookie <span class="hljs-keyword">exists</span> <span class="hljs-string">"SOME_USER_ID"</span>] } {
        <span class="hljs-keyword">log</span> local0. <span class="hljs-string">"successsss login $username $success_login Evilclient $evil_client "</span><font></font>
<font></font>
            <span class="hljs-keyword">set</span> success_login <span class="hljs-number">1</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">set</span> success_login <span class="hljs-number">0</span>
                    <span class="hljs-keyword">log</span> local0. <span class="hljs-string">"asdasdassuccesssss login $username $success_login Evilclient $evil_client "</span><font></font>
<font></font>
		<span class="hljs-keyword">table</span> <span class="hljs-keyword">set</span> -subtable customer_login:[IP::client_addr] $username indefinite  <span class="hljs-number">600</span><font></font>
        }<font></font>
        <span class="hljs-keyword">set</span> loginevent <span class="hljs-number">0</span>
			<span class="hljs-keyword">log</span> local0. <span class="hljs-string">"success login $username $success_login Evilclient $evil_client "</span><font></font>
        }<font></font>
<font></font>
}<font></font>
<font></font>
 <span class="hljs-keyword">when</span> BOTDEFENSE_ACTION {<font></font>
 <font></font>
  <span class="hljs-keyword">log</span> local0. <span class="hljs-string">"BOTDEFENSE_ACTION [BOTDEFENSE::action] client $evil_client BR [BOTDEFENSE::reason]  BC [BOTDEFENSE::captcha_status] $evil_client_action"</span>
    <span class="hljs-keyword">set</span> coun222t <span class="hljs-number">0</span>
	<span class="hljs-keyword">set</span> <span class="hljs-keyword">key</span> <span class="hljs-string">"$srcip2"</span>
	append <span class="hljs-keyword">key</span> <span class="hljs-string">"_8"</span>
	 <span class="hljs-keyword">if</span> {[<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] eq <span class="hljs-string">"/NCbf5"</span> <span class="hljs-keyword">and</span> $evil_client == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span>  [<span class="hljs-keyword">HTTP</span>::method] eq <span class="hljs-string">"GET"</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> ([BOTDEFENSE::<span class="hljs-keyword">action</span>] eq <span class="hljs-string">"allow"</span>) } {<font></font>
	<font></font>
	<span class="hljs-keyword">if</span> { ($evil_client == <span class="hljs-number">1</span>  <span class="hljs-keyword">and</span> $evil_client_action == <span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> ([BOTDEFENSE::reason] starts_with <span class="hljs-string">"passed browser challenge"</span>)) <span class="hljs-keyword">and</span> ([BOTDEFENSE::captcha_status] ne <span class="hljs-string">"correct"</span>) } {<font></font>
<font></font>
	<span class="hljs-keyword">log</span> local0. <span class="hljs-string">"[IP::client_addr] has [BOTDEFENSE::action], reason: [BOTDEFENSE::reason]"</span>
	<span class="hljs-comment">#Browser Chalange</span>
	<span class="hljs-keyword">set</span> res [BOTDEFENSE::<span class="hljs-keyword">action</span> browser_challenge]<font></font>
<font></font>
			} elseif { ($evil_client == <span class="hljs-number">1</span>  <span class="hljs-keyword">and</span> $evil_client_action == <span class="hljs-number">1</span>)  <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> ([BOTDEFENSE::reason] starts_with <span class="hljs-string">"passed browser challenge"</span>)) <span class="hljs-keyword">and</span> ([BOTDEFENSE::captcha_status] ne <span class="hljs-string">"correct"</span>)  }  {
		    	<span class="hljs-keyword">set</span> res [BOTDEFENSE::<span class="hljs-keyword">action</span> captcha_challenge]
			      <span class="hljs-keyword">log</span> local0. <span class="hljs-string">"[IP::client_addr] has [BOTDEFENSE::action], reason: [BOTDEFENSE::reason]"</span><font></font>
<font></font>
			} <span class="hljs-keyword">else</span> { <span class="hljs-keyword">set</span> res [BOTDEFENSE::<span class="hljs-keyword">action</span> <span class="hljs-keyword">allow</span>] }<font></font>
			<font></font>
	} elseif  	{[<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] eq <span class="hljs-string">"/login"</span> <span class="hljs-keyword">and</span> $evil_client == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span>  [<span class="hljs-keyword">HTTP</span>::method] eq <span class="hljs-string">"POST"</span> <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> ([BOTDEFENSE::reason] starts_with <span class="hljs-string">"passed browser challenge"</span>)) <span class="hljs-keyword">and</span> ([BOTDEFENSE::captcha_status] ne <span class="hljs-string">"correct"</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> ([BOTDEFENSE::<span class="hljs-keyword">action</span>] eq <span class="hljs-string">"allow"</span>) } {<font></font>
		BOTDEFENSE::<span class="hljs-keyword">action</span> custom_redirect <span class="hljs-string">"/NCbf5"</span> <span class="hljs-number">302</span>
		<span class="hljs-keyword">log</span> local0. <span class="hljs-string">"Send custum redirect [IP::client_addr]"</span><font></font>
	<font></font>
	} elseif  	{[<span class="hljs-keyword">HTTP</span>::<span class="hljs-keyword">path</span>] eq <span class="hljs-string">"/NCbf5"</span>  <span class="hljs-keyword">and</span> [BOTDEFENSE::<span class="hljs-keyword">action</span>] eq <span class="hljs-string">"allow"</span> } {<font></font>
		BOTDEFENSE::<span class="hljs-keyword">action</span> custom_redirect <span class="hljs-string">"/login"</span> <span class="hljs-number">302</span>
		<span class="hljs-keyword">log</span> local0. <span class="hljs-string">"Send custum redirect [IP::client_addr]"</span><font></font>
	<font></font>
	} <font></font>
			<font></font>
 <font></font>
 }<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなルールにより、顧客は、承認フォームの機能を考慮に入れても、ログイン/パスワードの選択に関連するイベントを追跡できました。 </font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webアプリケーションの保護は継続的なプロセスであることを忘れないでください。</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、新しい脆弱性に関する情報が表示され、ベンダーがWAFの検出とクローズを開始するためのアップデートをまだ送信していない場合もあります。脆弱なソフトウェア開発者は、まだ何も更新できていません。 ShellShockを思い出してください。その後、数百万のシステムが一度に脆弱になり、攻撃の実装は非常に簡単だったので、「scriptdidi」はそれを実行できました。そして、発見された脆弱性に関するニュースの公開後、最初の数時間から攻撃を開始しました。そして、この場合何をすべきか？この脆弱性のポリシーをプロファイルしようとしても無駄であり、署名ベースはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような状況では、一時的なスタブであっても、このような攻撃を検出してブロックするための特定のルールを作成する必要がありますが、実行する必要があります。したがって、新しい脆弱性がないか常に最新の状態に保ち、インターネットを常に監視する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WAFでの作業には、Webサーバーとその上にあるWebアプリケーションの操作を担当するすべての構造単位との継続的な相互作用が含まれます。 WAFとの連携は、既存のセキュリティポリシーの継続的な運用と適応であり、新たなインシデントへのアクセスと対応をサポートするための24時間年中無休の運用であり、XSSとSQLインジェクションの違いを完全に理解し、何に関連するのかを理解する経験豊富なスペシャリストとアナリストのスタッフの存在ですあるWebアプリケーションは別のWebアプリケーションに適用できず、さまざまなフレームワークの動作原理を理解しており、特定のWebアプリケーションに対してWAFのプロファイルとセキュリティポリシーの高品質で迅速な適応を実行できます。これについては、「Webアプリケーションの継続的保護の問題」の記事で詳しく説明し、開発者や顧客からの問題を取り上げました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらくこの記事を読んだ後、誰かがWAFに連絡したくないでしょうが、現代の現実では、このアプローチはほとんど不可能です。</font><font style="vertical-align: inherit;">プロジェクトの開始直後から、運用のすべての機能に留意し、これらの落とし穴を回避する方法を計画してください。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Egor Valov、アナリスト、エキスパートプレセール、製品とサービス、Solar JSOC</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478358/index.html">ロシア語のNLU：ELMo対BERT</a></li>
<li><a href="../ja478364/index.html">プライバシーとセキュリティを確保する方法と方法。2019ツールの概要</a></li>
<li><a href="../ja478366/index.html">Microsoft SQL Server 2019およびDell EMC Unity XTフラッシュアレイ</a></li>
<li><a href="../ja478368/index.html">オフィスは私たちが俳優である劇場です</a></li>
<li><a href="../ja478370/index.html">オブジェクトビデオ分析の最新システムのアーキテクチャ。時間の経過とともに欠陥になる、または根付くプロセス？</a></li>
<li><a href="../ja478374/index.html">Retrofit-インターネットと共有するためのライブラリ（パート1）</a></li>
<li><a href="../ja478376/index.html">自動運転車は人々の利己主義のレベルを考慮に入れます</a></li>
<li><a href="../ja478378/index.html">約Tech：フロントエンドのミートアップ＃2の記録の記録</a></li>
<li><a href="../ja478380/index.html">効果的および非効果的なPythonコーディング技術</a></li>
<li><a href="../ja478382/index.html">レールブレーキの真実：パート3-制御装置</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>