<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèåÔ∏è üßòüèæ üò£ No, dynamic type systems are essentially no more open üí∑ ü¶ã üï¥üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The holy wars on the Internet about type systems continue to suffer from the widespread myth that dynamic type systems are inherently better suited fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>No, dynamic type systems are essentially no more open</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486604/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The holy wars on the Internet about type systems continue to suffer from the widespread myth that dynamic type systems are inherently better suited for modeling subject areas of the ‚Äúopen world‚Äù. Usually the argument is: the purpose of static typing is to capture all entities as accurately as possible, but in the real world this is simply inconvenient. Real systems should be loosely coupled and as little as possible tied to the presentation of data, so dynamic typing leads to a more stable system as a whole.</font></font></p><br>
<p><img src="https://habrastorage.org/webt/jp/qd/ef/jpqdef9gxgkcrxgqr9vc-7iswm4.png"></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This story sounds convincing, but it's not true. </font><font style="vertical-align: inherit;">The mistake in such reasoning is that static types are </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">not intended</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to ‚Äúclassify the world‚Äù or determine the structure of each value in the system. </font><font style="vertical-align: inherit;">The reality is that static type systems allow you to specify exactly how much a component should know about the structure of its input data, and, conversely, how much it does not know. </font><font style="vertical-align: inherit;">In practice, static type systems perfectly process data with a partially known structure, as well as being able to make sure that the application logic does not accidentally assume too much about the data.</font></font></p><br>
<h2 id="dve-lzhi-o-tipah"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two lies about types</font></font></h2><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I have long wanted to write an article on this topic in a blog, but the last impetus for this decision was misinforming comments in response to </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my previous article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In particular, two comments particularly caught my attention, the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first of which was published on / r / programming</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strongly disagree with the post [...], which promotes a completely confused and static view of the world. </font><font style="vertical-align: inherit;">It is assumed that we can or should theoretically establish what exactly is an ‚Äúacceptable‚Äù input on the border between the program and the world, thus introducing a feeling of strong connectivity to the whole system, and then a mismatch of any scheme automatically leads to a program malfunction.</font></font><br>
     ,  ,       .    JSON ,         .   ,     . [‚Ä¶] ¬´ ¬ª     ,               . </blockquote><p> ,      ,         ,  ,     . ,  -      ,       ,   ?     ,      ,        .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">     Hacker News</a>     :</p><br>
<blockquote>  , ,  <code>pickle.load()</code>?</blockquote><p>   ,    ,           ,      .   ,     ,       .</p><br>
<p>   ,    ,       .        ,          ,       :     <em></em>    .   ,   ;           ,          . </p><br>
<h2 id="vy-ne-mozhete-obrabotat-to-chto-vy-ne-znaete">    ,    </h2><br>
<p> :          ,         , ,  , !       ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a>          .    ,    . </p><br>
<p>     . ,           ,      .      (payload),        .           ,    -    ,  JSON  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">EDN</a>. </p><br>
<p>   ,           ,    : </p><br>
<pre><code class="json">{<font></font>
  "event_type": "signup",<font></font>
  "timestamp": "2020-01-19T05:37:09Z",<font></font>
  "data": {<font></font>
    "user": {<font></font>
      "id": 42,<font></font>
      "name": "Alyssa",<font></font>
      "email": "alyssa@example.com"<font></font>
    }<font></font>
  }<font></font>
}</code></pre><br>
<p>      <code>signup</code>-       . ,          .       JavaScript,       :</p><br>
<pre><code class="javascript">const handleEvent = ({ event_type, data }) =&gt; {<font></font>
  switch (event_type) {<font></font>
    case 'login':<font></font>
      /* ... */<font></font>
      break<font></font>
    case 'signup':<font></font>
      sendEmail(data.user.email, `Welcome to Blockchain Emporium, ${data.user.name}!`)<font></font>
      break<font></font>
  }<font></font>
}</code></pre><br>
<p> ,       Haskell?  ,        Haskell,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">,   </a>,     :</p><br>
<pre><code class="haskell">data Event = Login LoginPayload | Signup SignupPayload<font></font>
data LoginPayload = LoginPayload { userId :: Int }<font></font>
data SignupPayload = SignupPayload<font></font>
  { userId :: Int<font></font>
  , userName :: Text<font></font>
  , userEmail :: Text<font></font>
  }<font></font>
<font></font>
instance FromJSON Event where<font></font>
  parseJSON = withObject "Event" \obj -&gt; do<font></font>
    eventType &lt;- obj .: "event_type"<font></font>
    case eventType of<font></font>
      "login" -&gt; Login &lt;$&gt; (obj .: "data")<font></font>
      "signup" -&gt; Signup &lt;$&gt; (obj .: "signup")<font></font>
      _ -&gt; fail $ "unknown event_type: " &lt;&gt; eventType<font></font>
<font></font>
instance FromJSON LoginPayload where { ... }<font></font>
instance FromJSON SignupPayload where { ... }<font></font>
<font></font>
handleEvent :: JSON.Value -&gt; IO ()<font></font>
handleEvent payload = case fromJSON payload of<font></font>
  Success (Login LoginPayload { userId }) -&gt; {- ... -}<font></font>
  Success (Signup SignupPayload { userName, userEmail }) -&gt;<font></font>
    sendEmail userEmail $ "Welcome to Blockchain Emporium, " &lt;&gt; userName &lt;&gt; "!"<font></font>
  Error message -&gt; fail $ "could not parse event: " &lt;&gt; message</code></pre><br>
<p>    ,         (, ,        ).            . <em></em>     ,     Reddit,   ,    Haskell     ,       !          Event,         .   ,        ?    .</p><br>
<p> ,  JavaScript   .     ,     <code>switch</code>    .       ,  JavaScript    . ,     .</p><br>
<p>  ,  ,   .      <code>Event</code>,          ,        <code>handleEvent</code>.           JavaScript,    ,     : </p><br>
<pre><code class="javascript">const handleEvent = ({ event_type, data }) =&gt; {<font></font>
  switch (event_type) {<font></font>
    /* ... */<font></font>
    default:<font></font>
      throw new Error(`unknown event_type: ${event_type}`)<font></font>
  }<font></font>
}</code></pre><br>
<p>   ,          .    ,     ,     .   ,       ,          Haskell:</p><br>
<pre><code class="haskell">handleEvent :: JSON.Value -&gt; IO ()<font></font>
handleEvent payload = case fromJSON payload of<font></font>
  {- ... -}<font></font>
  Error _ -&gt; pure ()</code></pre><br>
<p>  -   ¬´,  ¬ª,         <em></em>     ,       .              ,    (   )      .       ,  !       ,     .</p><br>
<p>    :  <code>Event</code>     Haskell   ¬´  ¬ª,    ,    .  ,      ,         .    ,        ,        ,   .</p><br>
<p>,       ,    ,      :</p><br>
<ul>
<li><p>      Haskell,     .  , ,        <code>timestamp</code>,              .             ,  ,     ,  ,   ,       !</p><br>
</li>
<li><p> , ,   Haskell    <em> </em>  <code>userId</code>   <code>SignupPayload</code>,     .    ,      (, ,      <code>userId</code>    ),       ;    , ,    ,        .</p><br>
</li>
<li><p>,     ,   <em> </em> (shotgun parsing),   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">  </a>,               .</p><br>
</li>
</ul><br>
<p>,        , , ,         ,     .      ,   ,           . ,    ,           ,  ,  ,  ,   .</p><br>
<p>   JavaScript     ,      Haskell:  ,       JSON   <code>event_type</code>    ¬´¬ª <code>signup</code>     <code>data.user.name</code>  <code>data.user.email</code>.           !     ,   JavaScript        ,    .    ,                ;    ,         ,     - .</p><br>
<h2 id="sohranenie-neprozrachnosti-dannyh">  </h2><br>
<p>       ,          ,   ,   ,      .</p><br>
<p>     ,     ,    ,      - -. , ,      .      ,          .       JavaScript  :</p><br>
<pre><code class="javascript">const handleEvent = (payload) =&gt; {<font></font>
  const signedPayload = { ...payload, signature: signature(payload) }<font></font>
  retransmitEvent(signedPayload)<font></font>
}</code></pre><br>
<p>            ( signature      JSON),      ,   .           ,         ?</p><br>
<p> ,    :        ,   .          Haskell:</p><br>
<pre><code class="haskell">handleEvent :: JSON.Value -&gt; IO ()<font></font>
handleEvent (Object payload) = do<font></font>
  let signedPayload = Map.insert "signature" (signature payload) payload<font></font>
  retransmitEvent signedPayload<font></font>
handleEvent payload = fail $ "event payload was not an object " &lt;&gt; show payload</code></pre><br>
<p>  ,       ,      <code>JSON.Value</code>.            <code>Event</code>   ‚Äî       JSON  ,     <em> </em>,    . </p><br>
<p>        :      ,     JSON- (    -),   -    JSON,      - .       , ,   ,         ,  .       .</p><br>
<p>  ,   ,          Haskell, <em></em>     JavaScript!     JavaScript <code>handleEvent</code>     (    JSON ),    ,  ,    ,       spread- <code>‚Ä¶</code>    :</p><br>
<pre><code class="javascript">&gt; { ..."payload", signature: "sig" }<font></font>
{0: "p", 1: "a", 2: "y", 3: "l", 4: "o", 5: "a", 6: "d", signature: "sig"}</code></pre><br>
<p>,   .  ,        .     ¬´¬ª  JSON        <code>Object</code>,     .        -,      ,     .</p><br>
<hr><br>
<p>      ,    . ,   API,    ,  ,     <code>UUID</code>.   ¬´,  ¬ª    ,         API Haskell    <code>UUID</code>:</p><br>
<pre><code class="haskell">type UserId = UUID</code></pre><br>
<p>  ,   Reddit, ,     !     API   ,      UUID,     ,     .      UUID , ,     ,       !     ,   ?</p><br>
<p> ,  ‚Äî .     ,       ‚Äî    .   ,     <code>UserId</code>    ‚Äî     : </p><br>
<pre><code class="haskell">newtype UserId = UserId Text<font></font>
  deriving (Eq, FromJSON, ToJSON)</code></pre><br>
<p>      ,         <code>UUID</code>,       <code>UserId</code>,      ,  <code>Text</code>.        (     ,    ),  <em></em>   <code>UserId</code> ‚Äî      <code>FromJSON</code>.  , ,      <code>UserId</code> ‚Äî      <code>UserId</code>        <code>ToJSON</code>.    :              .</p><br>
<p>   ,       ,       .    <code>UserId</code>   ,                  <code>UserId</code>   .</p><br>
<div class="spoiler"><b class="spoiler_title"> 1</b><div class="spoiler_text"><p>,      <code>FromJSON</code>      <code>UserId</code>,      ,  ,   <code>fromJSON</code>    .  ,   -       .         ,        ,     ‚Ä¶               <code>UserId</code>.          ,     ,        ( ,    ,             ,     ).</p></div></div><br>
<p>  ‚Äî   ,                . ,  ,      ,       .</p><br>
<h2 id="refleksiya-ne-yavlyaetsya-chem-to-osobennym">   - </h2><br>
<p>,    ,   ,  ,   ,        . <em></em>  <code>pickle.load()</code>    Python?  ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">    </a>        Python.            <code>pickle.dump()</code>,          <code>pickle.load()</code>.</p><br>
<p>       ,    ,  <code>pickle.load()</code>,   ‚Äî     ,         <code>pickle.dump()</code>. ,        ,           .   ,    ,     ,      .</p><br>
<p> ,          JSON,   ,   pickle  Python    Python ,   . ?  ,   <em> </em>,    <code>pickle.load()</code>. ,    :</p><br>
<pre><code class="python">def load_value(f):<font></font>
  val = pickle.load(f)<font></font>
  #  -  `val`</code></pre><br>
<p>  ,   <code>val</code>   <em></em> ,   ,          ,  ,       ,      -  .    -     -   ,       ,      <code>pickle.load(f)</code>  , ,    <em></em>   <code>val</code>!</p><br>
<p>, ,  ,     <code>val</code>   <code>val.foo()</code>    ,    .     Java,    <code>val</code>     ‚Äî   ,      :</p><br>
<pre><code class="java">interface Foo extends Serializable {<font></font>
  String foo();<font></font>
}</code></pre><br>
<p>  ,   <code>pickle.load()</code>       Java:</p><br>
<pre><code class="java">static &lt;T extends Serializable&gt; Optional&lt;T&gt; load(InputStream in, Class&lt;? extends T&gt; cls);</code></pre><br>
<p>     ,      ,  <code>pickle.load()</code>,       <code>Class&lt;T&gt;</code>    .       <code>Serializable.class</code>      ,   .    :   ,      <em> -</em>,    -   ,     !          ,   ,        JSON-.</p><br>
<hr><br>
<p>        Haskell?   ‚Äî    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> serialise</a>,   API,  ,   Java,   .  API  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> Haskell    JSON, aeson</a>, ,  ,      JSON           Haskell ‚Äî  -     - ,      -.</p><br>
<p>  ,   ,  <em></em>    <code>pickle.load()</code>,       .   ,       .  -        ,   ,   ,    ,   <em>   </em>.       ,       (,  REPL    ),      ,              .</p><br>
<p>            . ,     , ,    ,      -    ,  ¬´¬ª    ,        ,         .    ,      ,      ,     ,      ,    <em></em>  .</p><br>
<p>             .    <em></em>     ,     <em></em>    ,   ,        ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"> </a>).     ,             ,      ¬´¬ª       . </p><br>
<h2 id="prilozhenie-realnost-skrytaya-za-mifami">: ,   </h2><br>
<p>     :                   .  ,   ,     ,     ,     ,                 .</p><br>
<p>,    ,       . -,    -        (nominal typing).  ,  ,  ,        ,         .          ,            . ,          .</p><br>
<p>      ,     ,         ,          ,  .     ,             ,   -,   ,            (     ).</p><br>
<p>       .   JavaScript  Clojure      -       ,      -         ,       .              (  )     .</p><br>
<p>,            ,     - ,    ,     .       ( ) ,    <em> </em> (nominal typing).       ,      ;        (boilerplate).</p><br>
<p>    ,       ,     .   ,     ,            ,  .  ,      :</p><br>
<ol>
<li><p>    ,       , ,    ,    <em></em>        .       (    ),          : ,        .</p><br>
</li>
<li><p>            ,    ,           -      . ,     ,        ,           .      ,    .</p><br>
</li>
</ol><br>
<p>       Python,    ,   ,   ,   TypeScript,   ,    . ,            .        -  Clojure ‚Äî      ,       - ‚Äî         ,   - Clojure,    - .</p><br>
<p>            ,         : TypeScript, Flow, PureScript, Elm, OCaml  Reason,         .    <em> </em>    ‚Äî   Haskell,      ; Haskell (  ,     )  .</p><br>
<div class="spoiler"><b class="spoiler_title"> 2</b><div class="spoiler_text"><p> ,      Haskell     .</p></div></div><br>
<p>  ,  Haskell ,          ? ,  ;        Haskell,     ,          .        Haskell,       ,  .   ,         Haskell,       ,         ,    <em></em>   . ( ,         ,  Haskell!)</p><br>
<p>   :      ,    ,     ,    .       ,        ,   ,         .    ‚Äî ,     <em></em> , , ,    .         .</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en486604/">https://habr.com/ru/post/en486604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486586/index.html">IPv6 addresses - are there so many?</a></li>
<li><a href="../en486590/index.html">A constant stream of discoveries related to fluid equations</a></li>
<li><a href="../en486592/index.html">Robogami - real descendants of terminators and transformers</a></li>
<li><a href="../en486598/index.html">Microcontroller Experiments in Jupyter Notebook</a></li>
<li><a href="../en486602/index.html">Svelte Community Materials Digest (January 16 - February 1)</a></li>
<li><a href="../en486608/index.html">Essential Assistants in the Intelligence of the Most Effective Intelligence Service in the World (Part 2)</a></li>
<li><a href="../en486614/index.html">Why eSIM is needed. How it works and why they talk so much about it</a></li>
<li><a href="../en486622/index.html">Parallel computing model</a></li>
<li><a href="../en486626/index.html">Svelte: getting to know Actions</a></li>
<li><a href="../en486628/index.html">Fixed distance between ticks on an axis in gnuplot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>