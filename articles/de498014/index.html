<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüöí üß£ üçê PyDERASN: Als ich Big-Data-Unterst√ºtzung hinzuf√ºgte üë∑ üö£üèΩ ‚úãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich setze den letzten Artikel √ºber PyDERASN fort - den kostenlosen ASN.1 DER / CER / BER-Codec in Python. Im letzten Jahr, ab dem Zeitpunkt des Schrei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PyDERASN: Als ich Big-Data-Unterst√ºtzung hinzuf√ºgte</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498014/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich setze den letzten Artikel √ºber </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyDERASN fort</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - den kostenlosen ASN.1 DER / CER / BER-Codec in Python. </font><font style="vertical-align: inherit;">Im letzten Jahr, ab dem Zeitpunkt des Schreibens, erschien in dieser Bibliothek neben all den kleinen Dingen, kleinen Korrekturen und noch strengeren Daten√ºberpr√ºfungen (obwohl es zuvor bereits der strengste mir bekannte kostenlose Codec war) eine Funktion zum Arbeiten mit gro√üen Datenmengen - nicht in RAM kriechen. </font><font style="vertical-align: inherit;">Ich m√∂chte in diesem Artikel dar√ºber sprechen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/241/bae/4fc/241bae4fcfb5d7f0c3a605bf5f3211cb.png" alt="ASN.1 Browser"></div><a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probleme / Aufgaben</font></font></h2><br>
<ul>
<li><strong> CRL</strong>:<br>
,      (CA)         X.509 .    ,    CRL (certificate revocation list). CRL  CACert.org,  8.72 MiB,   PyDERASN-  Python 3.6      (    <em>asn1crypto</em>  <em>pyasn1</em>   ).      416 .  .    ,           .  .<br>
</li>
<li><strong> CMS</strong>:<br>
CMS (Cryptographic Message Syntax)    <br>
// . ,<br>
<em>SignedData</em>     ,   ,<br>
  ,   - <em>EnvelopedData</em> <br>
 .<br>
<br>
                 CMS. , CMS   detached data,     - ,         .  10 GiB    20 GiB   :       10 GiB      . .<br>
</li>
</ul><br>
<h2> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche ASN.1-Objekte k√∂nnen in der Praxis ressourcenintensiv sein und viel Speicherplatz beanspruchen? Nur </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEQUENCE OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enth√§lt zahlreiche Objekte (Hunderttausende im Fall von CACert.org) und alle Arten von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRINGs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (wie im zweiten problematischen Fall). Da eine der Tugenden eines Programmierers die Faulheit ist (laut Larry Wall), werden wir versuchen, die Probleme des Ressourcenverbrauchs mit einer minimalen √Ñnderung des Bibliothekscodes zu √ºberwinden. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRING-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekte unterscheiden sich aus Sicht des Codecs fast nicht voneinander und werden von einer gemeinsamen Klasse in der Bibliothek implementiert. Was ist die Codierung in </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OCTET STRING</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in DER?</font></font><br>
<br>
<pre><code class="plaintext hljs">return tag + len_encode(len(value)) + value
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offensichtlich muss der </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nicht die ganze Zeit im RAM sein. </font><font style="vertical-align: inherit;">Es muss ein byte√§hnliches Objekt sein, anhand dessen Sie die L√§nge ermitteln k√∂nnen. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memoryview</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erf√ºllt diese Bedingungen. </font><font style="vertical-align: inherit;">Und doch </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memoryview</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann erfolgen </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmap</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf jede tempor√§re Datei , </font><font style="vertical-align: inherit;">die bereits im Speicher reduziert wird 20 GiB 10 GiB Anforderungen an die CMS - </font><font style="vertical-align: inherit;">Datenbank kopiert in H√§lfte: es gen√ºgt, wenn der Wert von angeben </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OCTET STRING</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s (oder jede andere </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRING</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s) √§hnlich wie </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memoryview</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Um es zu erstellen, hat PyDERASN eine Hilfsfunktion:</font></font><br>
<br>
<pre><code class="plaintext hljs">from pyderasn import file_mmaped<font></font>
with open("dump.sql.zst", "rb") as fd:<font></font>
    ... = OctetString(file_mmaped(fd))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir eine gro√üe Datenmenge dekodieren </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√∂chten,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann die </font><em><font style="vertical-align: inherit;">Speicheransicht auch</font></em><font style="vertical-align: inherit;"> zum Dekodieren verwendet werden:</font></font><br>
<br>
<pre><code class="plaintext hljs">from pyderasn import file_mmaped<font></font>
with open("dump.sql.zst", "rb") as fd:<font></font>
    obj = Schema.decode(file_mmaped(fd))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir betrachten das Problem mit </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRING</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als teilweise gel√∂st. </font><font style="vertical-align: inherit;">Zur√ºck zum Erstellen einer riesigen CRL. </font><font style="vertical-align: inherit;">Wie ist seine Struktur?</font></font><br>
<br>
<pre><code class="plaintext hljs">CertificateList SEQUENCE<font></font>
. tbsCertList: TBSCertList SEQUENCE<font></font>
. . version: Version INTEGER v2 (01) OPTIONAL<font></font>
. . signature: AlgorithmIdentifier SEQUENCE<font></font>
. . issuer: Name CHOICE rdnSequence<font></font>
. . thisUpdate: Time CHOICE utcTime<font></font>
. . nextUpdate: Time CHOICE utcTime OPTIONAL<font></font>
. . revokedCertificates: RevokedCertificates SEQUENCE OF OPTIONAL<font></font>
. . . 0: RevokedCertificate SEQUENCE<font></font>
. . . . userCertificate: CertificateSerialNumber INTEGER 17 (11)<font></font>
. . . . revocationDate: Time CHOICE utcTime UTCTime 2003-04-01T14:25:08<font></font>
. . . 1: RevokedCertificate SEQUENCE<font></font>
. . . . userCertificate: CertificateSerialNumber INTEGER 20 (14)<font></font>
. . . . revocationDate: Time CHOICE utcTime UTCTime 2002-10-01T02:18:01<font></font>
<font></font>
                                 [...]<font></font>
<font></font>
. . . 415753: RevokedCertificate SEQUENCE<font></font>
. . . . userCertificate: CertificateSerialNumber INTEGER 1341859 (14:79:A3)<font></font>
. . . . revocationDate: Time CHOICE utcTime UTCTime 2020-02-08T06:51:56<font></font>
. . . 415754: RevokedCertificate SEQUENCE<font></font>
. . . . userCertificate: CertificateSerialNumber INTEGER 1341860 (14:79:A4)<font></font>
. . . . revocationDate: Time CHOICE utcTime UTCTime 2020-02-08T06:53:01<font></font>
. . . 415755: RevokedCertificate SEQUENCE<font></font>
. . . . userCertificate: CertificateSerialNumber INTEGER 1341861 (14:79:A5)<font></font>
. . . . revocationDate: Time CHOICE utcTime UTCTime 2020-02-08T07:25:06<font></font>
. signatureAlgorithm: AlgorithmIdentifier SEQUENCE<font></font>
. signatureValue: BIT STRING 4096 bits<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine lange Liste kleiner </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RevokedCertificate-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Strukturen. </font><font style="vertical-align: inherit;">In diesem Fall enth√§lt es nur die Seriennummer des Zertifikats und den Zeitpunkt seines Widerrufs. </font><font style="vertical-align: inherit;">Was ist die DER-Codierung?</font></font><br>
<br>
<pre><code class="plaintext hljs">value = b"".join(revCert.encode() for revCert in revCerts)<font></font>
return tag + len_encode(len(value)) + value<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur Verkettung von DER-Darstellungen jedes einzelnen Elements dieser Liste. </font><font style="vertical-align: inherit;">M√ºssen wir all diese Hunderttausende von Objekten im Voraus haben, w√§hrend wir nur in 15 Bytes DER-Darstellung serialisiert werden? </font><font style="vertical-align: inherit;">Offensichtlich nicht. </font><font style="vertical-align: inherit;">Daher ersetzen wir die Liste der Objekte durch einen Iterator / Generator. </font><font style="vertical-align: inherit;">Die Erstellung der CRL basiert h√∂chstwahrscheinlich auf Daten aus dem DBMS:</font></font><br>
<br>
<pre><code class="plaintext hljs">def revCertsGenerator(...):<font></font>
    for row in db.cursor:<font></font>
        yield RevokedCertificate((<font></font>
            ("userCertificate", CertificateSerialNumber(row.serial)),<font></font>
            ("revocationDate", Time(("utcTime", UTCTime(row.revdate)))),<font></font>
        ))<font></font>
<font></font>
crl["tbsCertList"]["revokedCertificates"] = revCertsGenerator()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt verbrauchen wir beim Erstellen einer solchen CRL fast keinen Speicher mehr - wir brauchen nur einen Ort, an dem wir mit der DER-Darstellung arbeiten k√∂nnen: In diesem Fall handelt es sich um ein paar zehn Megabyte (im Gegensatz zu einer halben Gigabyte-Liste von RevokedCertificate-Objekten). </font><font style="vertical-align: inherit;">Es gibt jedoch einen Unterschied im Verhalten: Die </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√∂√üenpr√ºfung von SEQUENCE OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erfolgt erst, nachdem der Iterator ersch√∂pft ist, und nicht zum Zeitpunkt der Zuweisung eines Werts.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DER-Streaming-Codierung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist unm√∂glich. Immerhin ist dies DER - die L√§ngen aller TLV-Elemente (Tag + L√§nge + Wert) m√ºssen im Voraus bekannt sein! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber ich w√ºrde so gerne! Immerhin ben√∂tigen wir noch 10 GiB Speicher, um die DER-Darstellung der Datenbankkopie zu speichern: </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw = cms.encode ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! Idealerweise m√∂chte ich einem bestimmten </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schriftsteller</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vermitteln, </font><font style="vertical-align: inherit;">wo die serialisierte Darstellung geschrieben werden soll. √úbertragen Sie m√∂glicherweise den Dateideskriptor, lassen Sie Platzhalter in der Datei an der Stelle der L√§ngen und f√ºllen Sie sie dann durch Suchen aus? Leider ist auch die L√§ngenl√§nge (bzw. der Platzhalter) nicht im Voraus bekannt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PyDERASN hat die M√∂glichkeit einer DER-Codierung mit zwei Durchg√§ngen erhalten. Im ersten Durchgang wird Wissen √ºber die L√§nge von Objekten gesammelt, wodurch ein tempor√§rer Zustand entsteht. Der zweite ist </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streaming</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DER-Codierung in einen bestimmten </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Writer</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aufgrund der Kenntnis der L√§ngen bereits m√∂glich. Die Implementierung war einfach und f√ºgte jedem der ASN.1-Basistypen nur ein paar Methoden mit zwei Durchg√§ngen hinzu. Da das Durchlaufen von Objekten streng bestimmt ist (D - unterschieden!), Wird zum Speichern der erforderlichen L√§ngen eine einfache Liste gef√ºhrt, zu der beim Durchlaufen des gesamten Objektbaums L√§ngenwerte hinzugef√ºgt werden. Bei einigen Typen ist die L√§nge festgelegt. F√ºr einige wird es nur f√ºr die Meldung an einen vorgelagerten Container ben√∂tigt ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEQUENCE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEQUENCE OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLICIT TAG</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Der L√§ngenstatus f√ºr eine Liste von zwei widerrufenen Zertifikaten sieht beispielsweise folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="plaintext hljs">revCert = RevokedCertificate((<font></font>
    ("userCertificate", CertificateSerialNumber(123)),<font></font>
    ("revocationDate", Time(("utcTime", UTCTime(datetime.utcnow())))),<font></font>
))<font></font>
revs = RevokedCertificates([revCert, revCert])<font></font>
<font></font>
(42, [40, 18, 18])<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall m√ºssen wir die L√§nge des Werts nur f√ºr jedes </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RevokedCertificate</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und die gesamte Liste als Ganzes kennen. Die L√§nge von Ganzzahlen und die codierte Zeit (in DER ist es eine feste L√§nge) im Zustand werden nicht als unn√∂tig gespeichert. F√ºr unsere CACert.org-CRL ben√∂tigt eine solche Liste daher etwas mehr als 3,5 MiB, und f√ºr das riesige CMS, bei dem fast das gesamte Gewicht auf ein einzelnes Feld mit einer Kopie der Datenbank f√§llt, sind etwa 0,5 KiB erforderlich. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Codierung in zwei Durchg√§ngen erfolgt durch zwei Aufrufe:</font></font><br>
<br>
<pre><code class="plaintext hljs">fulllen, state = obj.encode1st()<font></font>
with open("result", "wb") as fd:<font></font>
    obj.encode2nd(fd.write, iter(state))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Durchgang gibt auch die gesamte L√§nge der Daten an, mit denen der freie Speicherplatz √ºberpr√ºft oder durch einen </font><font style="vertical-align: inherit;">Aufruf </font><font style="vertical-align: inherit;">von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posix_fallocate</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zugewiesen werden kann </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit der </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hilfsfunktion encode2pass (obj) k√∂nnen</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie eine Zwei-Pass-Codierung in den Speicher durchf√ºhren. Wozu? Der Speicherverbrauch kann erheblich wirtschaftlicher sein, da im Fall von CACert.org CRL keine 416k + kleinen Bin√§rleitungen gespeichert werden, die durch einen </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b "". Join ()</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -Aufruf verbunden sind </font><font style="vertical-align: inherit;">. Dies erfordert jedoch mehr Prozessorzeit, da alle Objekte zweimal durchlaufen werden m√ºssen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen wir ein beliebig gro√ües CMS in DER praktisch ohne Speicherverbrauch codieren. </font><font style="vertical-align: inherit;">Im Fall von CRL haben wir jedoch den Zertifikatsperrgenerator verwendet, der nach dem Ende des ersten Durchgangs abl√§uft. </font><font style="vertical-align: inherit;">Was zu tun ist? </font><font style="vertical-align: inherit;">Einfach neu initialisieren!</font></font><br>
<br>
<pre><code class="plaintext hljs">_, state = crl.encode1st()<font></font>
crl["tbsCertList"]["revokedCertificates"] = revCertsGenerator()<font></font>
crl.encode2nd(writer, iter(state))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich wir </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sind verpflichtet</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dass das Ergebnis des Iterators sicherzustellen , </font><font style="vertical-align: inherit;">wird genau das gleiche, sonst werden wir ein gebrochenes DER erhalten. </font><font style="vertical-align: inherit;">Wenn Daten aus dem DBMS-Cursor entnommen werden, vergessen Sie nicht die </font><font style="vertical-align: inherit;">Transaktionsisolationsstufe und </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-sortierung</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von </font><em><font style="vertical-align: inherit;">REPEATABLE READ</font></em><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Real Stream Encoding: CER</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie wissen, ist DER (Distinguished Coding Rules) eine Teilmenge von BER (Basic Coding Rules), die die Codierungsregeln auf eine und nur eine Weise streng regelt. Dies erm√∂glicht die Verwendung in kryptografischen Aufgaben. Es gibt jedoch noch eine weitere bemerkenswerte Teilmenge von BER: CER (Canonical Coding Rules). Wie DER gibt es nur eine m√∂gliche Darstellung der Daten. CER unterscheidet sich von DER in mehreren Details, aber Sie k√∂nnen damit eine echte Streaming-Codierung von Daten durchf√ºhren. Leider wurde CER nicht so popul√§r wie DER. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ohne so auff√§llige Unterschiede (wie das Sortieren von Tags in SET) weist CER zwei grundlegende Unterschiede zu DER auf:</font></font><br>
<br>
<ul>
<li>    (constructed,  )  indefinite  (<em>LENINDEF</em>   PyDERASN).  ,  <em>SEQUENCE</em>/<em>SET</em>, <em>SEQUENCE OF</em>/<em>SET OF</em>, <em>EXPLICIT TAG</em>-  :<br>
<br>
<pre><code class="plaintext hljs">TAG_CONSTRUCTED || LEN(VALUE) || VALUE
</code></pre><br>
 <em>LENINDEF</em> (0x80)  EOC ( ,  )   :<br>
<br>
<pre><code class="plaintext hljs">TAG_CONSTRUCTED || 80 || VALUE || 00 00
</code></pre><br>
</li>
<li><em>*STRING</em>-,    1000-,  chunk-  1000-. ,      ,   DER. , 512          DER:<br>
<br>
<pre><code class="plaintext hljs">TAG_PRIMITIVE || LEN(512) || 512B
</code></pre><br>
 2048  :<br>
<br>
<pre><code class="plaintext hljs">TAG_CONSTRUCTED || 80 ||<font></font>
    TAG_PRIMITIVE || LEN(1000) || 1000B ||<font></font>
    TAG_PRIMITIVE || LEN(1000) || 1000B ||<font></font>
    TAG_PRIMITIVE || LEN(48) || 48B || 00 00<font></font>
</code></pre></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All dies (plus ein paar Kleinigkeiten) erm√∂glicht das Streaming (mit 1000 Bytes Puffer f√ºr Zeichenfolgen), um Objekte zu codieren. Ebenso k√∂nnen Sie </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmap</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Iteratoren verwenden. Die CER-Codierung erfolgt einfach durch Aufrufen der </font><font style="vertical-align: inherit;">Methode </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.encode_cer (writer)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Leider kann PyDERASN die G√ºltigkeit von CER w√§hrend der Dekodierung noch nicht √ºberpr√ºfen, sodass wir gezwungen sind, die Daten als BER zu dekodieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der CMS-Standard erfordert √ºbrigens die Codierung in BER (sowohl DER als auch CER, automatisch, sind BER). Daher k√∂nnen wir unsere riesige Kopie der Datenbank ohne einen DER mit zwei Durchg√§ngen in CER CMS codieren. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jedoch</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist SignedData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erforderlich , um </font><font style="vertical-align: inherit;">ein haben </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SignedAttributes</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Element DER codiert, da das X.509 ist </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certificate</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zertifikate. </font><font style="vertical-align: inherit;">Mit PyDERASN k√∂nnen Sie die Verwendung von DER in bestimmten Strukturen erzwingen, indem Sie einfach das </font><font style="vertical-align: inherit;">Attribut </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der_forced = True</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzuf√ºgen </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stream-Dekodierung: Evgen-Modus</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben das Codieren gelernt, aber nur </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmap</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hilft beim Decodieren </font><font style="vertical-align: inherit;">. Ein "echter" Stream-Decoder mit Steuerkn√∂pfen in Form von "Gib mir mehr Daten", "Hier bist du", einer Art Zustand - w√ºrde eine radikale √Ñnderung von PyDERASN erfordern. Und ich pers√∂nlich sehe es nicht als bequemer an als die aktuelle L√∂sung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und die aktuelle L√∂sung ist extrem einfach. W√§hrend des Dekodierungsprozesses haben wir verschiedene dekodierte primitive Objekte in unseren H√§nden, aus denen √ºberlegene Komponenten (konstruiert) zusammengesetzt sind, von denen andere Komponenten usw. ... Wir sammeln Objekte an, um sie zusammenzusetzen und ganz nach oben zu gelangen gib uns ein gro√ües Objekt. Warum nicht sofort alle Arten von </font><strong><font style="vertical-align: inherit;">entschl√ºsselten</font></strong><font style="vertical-align: inherit;"> "herausgeben"</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objekte, sobald sie auf unseren H√§nden erscheinen? </font><font style="vertical-align: inherit;">Das hei√üt, nicht ein endg√ºltiges Objekt zur√ºckzugeben, sondern einen Generator, der viele dekodierte Objekte generiert. </font><font style="vertical-align: inherit;">Tats√§chlich sind in PyDERASN jetzt alle Decodierungsmethoden zu Generatoren solcher "Ereignisse" geworden (Ereignisgenerierung, evgen). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir den evgen-Decodierungsmodus unserer riesigen CACert.org-CRL aktivieren, sehen wir das folgende Bild:</font></font><br>
<br>
<pre><code class="plaintext hljs">$ python -m pyderasn --schema tests.test_crl:CertificateList --evgen revoke.crl<font></font>
[][T,L,  V len]<font></font>
     10   [1,1,      1]   . . version: Version INTEGER v2 (01) OPTIONAL<font></font>
     15   [1,1,      9]   . . . algorithm: OBJECT IDENTIFIER 1.2.840.113549.1.1.13<font></font>
     26   [0,0,      2]   . . . parameters: [UNIV 5] ANY OPTIONAL<font></font>
     13   [1,1,     13]   . . signature: AlgorithmIdentifier SEQUENCE<font></font>
     34   [1,1,      3]   . . . . . . type: AttributeType OBJECT IDENTIFIER 2.5.4.10<font></font>
     39   [0,0,      9]   . . . . . . value: [UNIV 19] AttributeValue ANY<font></font>
     32   [1,1,     14]   . . . . . 0: AttributeTypeAndValue SEQUENCE<font></font>
     30   [1,1,     16]   . . . . 0: RelativeDistinguishedName SET OF<font></font>
<font></font>
                                 [...]<font></font>
<font></font>
    188   [1,1,      1]   . . . . userCertificate: CertificateSerialNumber INTEGER 17 (11)<font></font>
    191   [1,1,     13]   . . . . . utcTime: UTCTime UTCTime 2003-04-01T14:25:08<font></font>
    191   [0,0,     15]   . . . . revocationDate: Time CHOICE utcTime<font></font>
    191   [1,1,     13]   . . . . . utcTime: UTCTime UTCTime 2003-04-01T14:25:08<font></font>
    186   [1,1,     18]   . . . 0: RevokedCertificate SEQUENCE<font></font>
    208   [1,1,      1]   . . . . userCertificate: CertificateSerialNumber INTEGER 20 (14)<font></font>
    211   [1,1,     13]   . . . . . utcTime: UTCTime UTCTime 2002-10-01T02:18:01<font></font>
    211   [0,0,     15]   . . . . revocationDate: Time CHOICE utcTime<font></font>
    206   [1,1,     18]   . . . 1: RevokedCertificate SEQUENCE<font></font>
<font></font>
                                 [...]<font></font>
<font></font>
9144992   [0,0,     15]   . . . . revocationDate: Time CHOICE utcTime<font></font>
9144985   [1,1,     20]   . . . 415755: RevokedCertificate SEQUENCE<font></font>
    181   [1,4,9144821]   . . revokedCertificates: RevokedCertificates SEQUENCE OF OPTIONAL<font></font>
      5   [1,4,9144997]   . tbsCertList: TBSCertList SEQUENCE<font></font>
9145009   [1,1,      9]   . . algorithm: OBJECT IDENTIFIER 1.2.840.113549.1.1.13<font></font>
9145020   [0,0,      2]   . . parameters: [UNIV 5] ANY OPTIONAL<font></font>
9145007   [1,1,     13]   . signatureAlgorithm: AlgorithmIdentifier SEQUENCE<font></font>
9145022   [1,3,    513]   . signatureValue: BIT STRING 4096 bits<font></font>
      0   [1,4,9145534]  CertificateList SEQUENCE<font></font>
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zu Beginn der Dekodierung sahen wir das </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CertificateList </font></font></em> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEQUENCE-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tag, die </font><em><font style="vertical-align: inherit;">Datenl√§nge</font></em><font style="vertical-align: inherit;"> , aber das Objekt ist noch nicht bekannt, ob es bis zum Ende dekodiert werden kann. </font><font style="vertical-align: inherit;">Bisher arbeiten wir nur daran.</font></font></li>
<li>    <em>SEQUENCE</em>:  <em>version</em>,     <em>INTEGER</em>.   .   ,      . ( <strong>10</strong>)</li>
<li>   <em>signature</em>,  <em>SEQUENCE</em>-   : <em>algorithm</em>  <em>parameters</em>.   <em>OBJECT IDENTIFIER</em>  <em>ANY</em>     . ( <strong>15</strong>, <strong>26</strong>)</li>
<li>   ,  ,   <em>signature</em> <em>SEQUENCE</em>    ,    ,    :  . ( <strong>13</strong>)</li>
<li>,   <em>RevokedCertificate</em>        . ( <strong>186</strong>, <strong>206</strong>,  ..)</li>
<li> <em>tbsCertList</em>       . ( <strong>5</strong>)</li>
<li> <em>CertificateList</em>,   <em>SEQUENCE</em>,  ,        ,         . ( <strong>0</strong>)</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nat√ºrlich haben alle </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRING</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Listen ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) keine wirkliche Bedeutung. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DER </font><em><font style="vertical-align: inherit;">.offset</font></em><font style="vertical-align: inherit;"> und </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.vlen kennt,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> k√∂nnen Sie den Wert einer Zeile aus einer Datei lesen (ein St√ºck Speicher?). </font><font style="vertical-align: inherit;">Sequenzobjekte k√∂nnen nach Bedarf gesammelt und aggregiert werden, w√§hrend alle Ereignisse empfangen werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dekodierter Pfad und evgen_mode_upto</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie kann man verstehen, welche Art von Objekt, welche </font><font style="vertical-align: inherit;">Art von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTEGER</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir zur Hand haben? </font><font style="vertical-align: inherit;">Jedes Objekt hat einen eigenen sogenannten Dekodierungspfad, der ein bestimmtes Objekt in der Struktur eindeutig identifiziert. </font><font style="vertical-align: inherit;">Zum Beispiel f√ºr CACert.org CRL-Dekodierungspfadereignisse:</font></font><br>
<br>
<pre><code class="plaintext hljs">tbsCertList:version<font></font>
tbsCertList:signature:algorithm<font></font>
tbsCertList:signature:parameters<font></font>
tbsCertList:signature<font></font>
tbsCertList:issuer:rdnSequence:0:0:type<font></font>
                                 [...]<font></font>
tbsCertList:issuer:rdnSequence<font></font>
tbsCertList:issuer<font></font>
                                 [...]<font></font>
tbsCertList:revokedCertificates:0:userCertificate<font></font>
tbsCertList:revokedCertificates:0:revocationDate:utcTime<font></font>
tbsCertList:revokedCertificates:0:revocationDate<font></font>
tbsCertList:revokedCertificates:0<font></font>
tbsCertList:revokedCertificates:1:userCertificate<font></font>
tbsCertList:revokedCertificates:1:revocationDate:utcTime<font></font>
tbsCertList:revokedCertificates:1:revocationDate<font></font>
tbsCertList:revokedCertificates:1<font></font>
                                 [...]<font></font>
tbsCertList:revokedCertificates:415755:userCertificate<font></font>
tbsCertList:revokedCertificates:415755:revocationDate:utcTime<font></font>
tbsCertList:revokedCertificates:415755:revocationDate<font></font>
tbsCertList:revokedCertificates:415755<font></font>
tbsCertList:revokedCertificates<font></font>
tbsCertList<font></font>
signatureAlgorithm:algorithm<font></font>
signatureAlgorithm:parameters<font></font>
signatureAlgorithm<font></font>
signatureValue<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So k√∂nnen wir die Liste der Seriennummern f√ºr die Sperrung von Zertifikaten aus dieser CRL drucken:</font></font><br>
<br>
<pre><code class="plaintext hljs">raw = file_mmaped(open("....crl", "rb"))<font></font>
for decode_path, obj, tail in CertificateList().decode_evgen(raw):<font></font>
    if (len(decode_path) == 5) and (decode_path[-1] == "userCertificate"):<font></font>
        print(int(obj))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RevokedCertificate-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Struktur </font><font style="vertical-align: inherit;">kann viele Informationen enthalten, einschlie√ülich verschiedener Erweiterungen. </font><font style="vertical-align: inherit;">Rein technisch erhalten wir alle Daten √ºber das widerrufene Zertifikat im evgen-Modus, aber das Aggregieren von Ereignissen, die sich auf ein </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revokedCertificates-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Element </font><em><font style="vertical-align: inherit;">beziehen</font></em><font style="vertical-align: inherit;"> , </font><em><font style="vertical-align: inherit;">ist</font></em><font style="vertical-align: inherit;"> nicht sehr praktisch. </font><font style="vertical-align: inherit;">Da jedes endg√ºltige </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RevokedCertificate</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Praxis nicht viel Platz </font><em><font style="vertical-align: inherit;">beansprucht</font></em><font style="vertical-align: inherit;"> , w√§re es gro√üartig, wenn es alle gleich w√§re und nicht alle Objekte so gr√ºndlich in Ereignisse ‚Äûsortiert‚Äú werden. </font><font style="vertical-align: inherit;">Mit PyDERASN kann die Liste Dekodierungspfade angeben, bei denen der evgen-Modus deaktiviert ist. </font><font style="vertical-align: inherit;">So k√∂nnen wir den Dekodierungspfad festlegen (jedes Element aus der </font><font style="vertical-align: inherit;">Liste </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">("tbsCertList", "revokedCertificates")</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), f√ºr das das vollst√§ndige </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RevokedCertificate-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objekt </font><font style="vertical-align: inherit;">empfangen werden </font><em><font style="vertical-align: inherit;">soll</font></em><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">for decode_path, obj, _ in CertificateList().decode_evgen(raw, ctx={<font></font>
    "evgen_mode_upto": (<font></font>
        (("tbsCertList", "revokedCertificates", any), True),<font></font>
    ),<font></font>
}):<font></font>
    if (len(decode_path) == 3) and (decode_path[1] == "revokedCertificates"):<font></font>
        print(int(obj["userCertificate"]))<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aggregierte Zeichenfolgen: agg_octet_string</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt haben wir keine Probleme mehr, Objekte jeder Gr√∂√üe zu dekodieren. Es gibt auch kein Problem beim Decodieren eines DER-codierten CMS mit einer Kopie der Datenbank: Wir warten auf ein Ereignis mit einem Decodierungspfad, der auf die signierten / verschl√ºsselten Daten im CMS verweist, und verarbeiten die Daten aus der Datei mit Offset + Vlen. Was aber, wenn das CMS im CER-Format vorliegt? Dann hilft Offset + Vlen nicht weiter, da alle unsere 10 GiBs in St√ºcke von 1000 Bytes unterteilt sind, zwischen denen sich der DER-Header befindet. Aber was ist, wenn wir eine BER haben, in der das Verschachteln von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRINGs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alles sein kann?</font></font><br>
<br>
<pre><code class="plaintext hljs">SOME STRING[CONSTRUCTED]<font></font>
    OCTET STRING[CONSTRUCTED]<font></font>
        OCTET STRING[PRIMITIVE]<font></font>
            DATA CHUNK<font></font>
        OCTET STRING[PRIMITIVE]<font></font>
            DATA CHUNK<font></font>
        OCTET STRING[PRIMITIVE]<font></font>
            DATA CHUNK<font></font>
    OCTET STRING[PRIMITIVE]<font></font>
        DATA CHUNK<font></font>
    OCTET STRING[CONSTRUCTED]<font></font>
        OCTET STRING[PRIMITIVE]<font></font>
            DATA CHUNK<font></font>
        OCTET STRING[PRIMITIVE]<font></font>
            DATA CHUNK<font></font>
    OCTET STRING[CONSTRUCTED]<font></font>
        OCTET STRING[CONSTRUCTED]<font></font>
            OCTET STRING[PRIMITIVE]<font></font>
                DATA CHUNK<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Dekodieren im evgen-Modus erhalten wir f√ºr jedes St√ºck das entsprechende Ereignis und es reicht aus, nur primitive (nicht konstruierte) </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* STRING-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ereignisse </font><font style="vertical-align: inherit;">zu erfassen </font><font style="vertical-align: inherit;">, bei denen Offset + Vlen echte Daten enthalten. PyDERASN verf√ºgt √ºber eine praktische </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hilfsfunktion agg_octet_string</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die dies ausf√ºhrt. Es reicht aus, einen Ereignisgenerator zu √ºbergeben, dessen Dekodierungspfad ‚Äûdarunter‚Äú eine Zeichenfolge, Bin√§rdaten (oder </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speicheransicht</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) und einen </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Writer</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aggregieren muss </font><font style="vertical-align: inherit;">- eine Funktion, die mit jedem empfangenen Datenelement aufgerufen wird. Wir m√∂chten den SHA512-Hash berechnen und gleichzeitig den Inhalt von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encapContentInfo.eContent</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CMS </font><em><font style="vertical-align: inherit;">speichern</font></em><font style="vertical-align: inherit;"> . Suchen Sie den Speicherort des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inhaltsfelds</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (in dem sich </font><em><font style="vertical-align: inherit;">SignedData</font></em><font style="vertical-align: inherit;"> befindet</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) und dekodieren dann den CER-Inhalt, schreiben gleichzeitig in den FS und hashen:</font></font><br>
<br>
<pre><code class="plaintext hljs">fdIn = open("data.p7m", "rb")<font></font>
raw = file_mmaped(fdIn)<font></font>
for decode_path, obj, _ in ContentInfo().decode_evgen(raw, ctx={"bered": True}):<font></font>
    if decode_path == ("content",):<font></font>
        content = obj<font></font>
        break<font></font>
hasher_state = sha512()<font></font>
fdOut = open("dump.sql.zst", "wb")<font></font>
def hash_n_save(data):<font></font>
    write_full(fdOut, data)<font></font>
    hasher_state.update(data)<font></font>
    return len(data)<font></font>
evgens = SignedData().decode_evgen(<font></font>
    raw[content.offset:],<font></font>
    offset=content.offset,<font></font>
    ctx={"bered": True},<font></font>
)<font></font>
agg_octet_string(evgens, ("encapContentInfo", "eContent"), raw, hash_n_save)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier wird ein </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anderes</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dienstprogramm </font><em><font style="vertical-align: inherit;">write_full verwendet</font></em><font style="vertical-align: inherit;"> , das den </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Writer</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aufruft, </font><font style="vertical-align: inherit;">bis alle Daten geschrieben sind, da das Betriebssystem beim Schreiben in eine Datei im Allgemeinen nicht alle √ºbertragenen Daten verarbeiten muss und Sie den Vorgang fortsetzen m√ºssen, bis sie vollst√§ndig geschrieben sind.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar liebevolle √ºber SET OF</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rein technisch gesehen kann </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in DER- und CER-Codierungen nicht im laufenden Betrieb codiert werden, da codierte Darstellungen aller Elemente sortiert werden m√ºssen. </font><font style="vertical-align: inherit;">Weder CER noch ein DER mit zwei Durchg√§ngen helfen hier. </font><font style="vertical-align: inherit;">Der moderne ASN.1-Standard empfiehlt daher nicht die Verwendung von </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (das eine √§hnliche Sortierung in DER erfordert) und </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET OF</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und was ist dieses Bild am Anfang des Artikels?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In PyDERASN erschien ein interaktiver, unpr√§tenti√∂ser </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASN.1-Browser</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der mir pers√∂nlich mehrmals half, Handler f√ºr komplexe Strukturen zu schreiben. </font><font style="vertical-align: inherit;">Erm√∂glicht es Ihnen, die gesamte dekodierte Struktur zu durchlaufen und alle Details zu jedem Objekt, seine Position in Bin√§rdaten und den Dekodierungspfad anzuzeigen. </font><font style="vertical-align: inherit;">Dar√ºber hinaus kann jedes Element in einer separaten Datei gespeichert werden, z. B. Zertifikate oder CRLs, die im CMS enthalten sind. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sergey Matveev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chiffrierpunk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Python / Go-Entwickler, Chefspezialist des FSUE ‚ÄûScientific and Technical Center‚Äú Atlas ‚Äú.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de498000/index.html">Dinge, die ich gerne wissen w√ºrde, bevor ich mein eigenes Spiel entwickle</a></li>
<li><a href="../de498002/index.html">Taschenanleitung zum Z3</a></li>
<li><a href="../de498004/index.html">Workstation in einem Docker-Container</a></li>
<li><a href="../de498006/index.html">Wahl eines Patentanwalts</a></li>
<li><a href="../de498012/index.html">Mikrotik RouterOS in Docker mit Qemu</a></li>
<li><a href="../de498018/index.html">Online-Analyse in der Microservice-Architektur: Hilfe und Vorschlag Postgres FDW –∏ –∏ Post Post Ã∂–øÃ∂—ÄÃ∂–æÃ∂—ÅÃ∂—ÇÃ∂—Ç –∏—åÃ∂</a></li>
<li><a href="../de498020/index.html">Etwa ein Indikator f√ºr die visuelle Beurteilung schnell wachsender Funktionen</a></li>
<li><a href="../de498022/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 341 (vom 13. bis 19. April)</a></li>
<li><a href="../de498024/index.html">St√§dte mit einem Mausklick mit Houdini und Python bauen</a></li>
<li><a href="../de498026/index.html">FOSS News Nr. 12 - √úberpr√ºfung der kostenlosen und Open Source-Nachrichten f√ºr den 13. bis 19. April 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>