<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚èèÔ∏è üö§ üà∂ How to stop worrying and start believing in A / B tests üìÉ üôÖüèø ‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When you develop a product, each new iteration is a risk of dropping metrics and losing users. Nevertheless, sometimes, especially at the initial stag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How to stop worrying and start believing in A / B tests</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/498174/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When you develop a product, each new iteration is a risk of dropping metrics and losing users. Nevertheless, sometimes, especially at the initial stages, companies unknowingly take this risk - change the product, relying only on their instincts and hypotheses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We at Badoo do not trust feelings, but we believe in numbers. In total, our services have more than 500 million users, and we wrote our test framework for a long time. In six years, 2962 tests passed through it, and A / B testing proved its importance, reliability and effectiveness.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pz/-4/w8/pz-4w80gfbql819rnm3sdztl49m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in this article I will not talk about how our system works. </font><font style="vertical-align: inherit;">One article is not enough for this. </font><font style="vertical-align: inherit;">In addition, many things are specific to our company and will not suit others. </font><font style="vertical-align: inherit;">Today I will talk about the evolution of our ideas about A / B tests: what kind of rake we stepped in the process and how we checked the correctness of the tests. </font><font style="vertical-align: inherit;">This article is for those who have not yet started testing, but think about it, as well as for those who are not sure about their test system.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is an A / B test?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine a situation: a new feature is to be launched, and our product manager is not ready to risk a small but stable income for the product. After some deliberation, he suggests launching the feature through the A / B test and see if it will take off and users will not go to competitors.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We did not conduct A / B tests before, so the first thing we learn is what they are. Wikipedia says: ‚ÄúA / B testing is a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marketing research</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> method </font><font style="vertical-align: inherit;">, the essence of which is that the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">control group of</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> elements is compared with a set of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test groups</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in which one or more indicators have been changed in order to find out which of Change Improve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">It turns out that we need to conduct a study in which there should be a control group, at least one test group and a target indicator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the test group, we will show an alternative version of the payment page. </font><font style="vertical-align: inherit;">On it, we want to change the text, highlight the discount, replace the picture - and all this for users from Eurasia, so that they buy more. </font><font style="vertical-align: inherit;">And for users from America, we do not want to change anything.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We will have targets. </font><font style="vertical-align: inherit;">Let's take the basic ones:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARPU (average revenue per user) - the profit that we will receive on average from the user;&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number of clicks on CTA (call to action) elements - buttons and links on the payment page.&nbsp;</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technical task</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It is planned to change three elements on the page at the same time: text, button and image with discount information. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d8/tj/kb/d8tjkbvmd88gjqn2gkbiorlpgsc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It will be quite difficult to understand which of these changes influenced the result if tested simultaneously. </font><font style="vertical-align: inherit;">Perhaps the new text will repel users and lead to a decrease in the number of purchases, but highlighting the discount will increase it: as a result, we get zero. </font><font style="vertical-align: inherit;">Development resources will be wasted and the working hypothesis will be rejected.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, we will not do this. </font><font style="vertical-align: inherit;">We‚Äôll leave only one change for testing - allocation of discounts.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/e1/gl/3v/e1gl3vdgdkv7kiys8lhiv6nzaq4.png"><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First test</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The plan is this: we divide users into two equal groups and wait for the result. </font><font style="vertical-align: inherit;">When we receive it, we will compare the indicators in the control and test groups.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything looks pretty simple: we divide users into even and odd and then look at the statistics.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We write the code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (userId % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) {<font></font>
&nbsp; &nbsp; showNewAwesomeFeature();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We look forward to a couple of weeks: the results are amazing! </font><font style="vertical-align: inherit;">ARPU increased by 100%! </font><font style="vertical-align: inherit;">People click, pay, the product manager asks to quickly roll out the change at all.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vd/ae/pu/vdaepupz_vcruvwxj78tjlvngtc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We turn it on, another couple of weeks pass, but there are no results. </font><font style="vertical-align: inherit;">Total profit has not increased.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What are we doing wrong?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We select a test group</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We simply divided the users into two equal groups and ran the test, but you can‚Äôt do this. </font><font style="vertical-align: inherit;">After all, something has changed only for users from Eurasia. </font><font style="vertical-align: inherit;">And we have much less of them than users from America. </font><font style="vertical-align: inherit;">Therefore, it turned out that a sudden surge in user activity from America influenced the results of our test, although in reality they were not the best. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conclusion: always select in the test group only those users for whom the changes are implemented. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's fix our code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (user.continent === ‚Äòeurasia‚Äô &amp;&amp; userId % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) {<font></font>
    showNewAwesomeFeature();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now everything should work as it should! </font><font style="vertical-align: inherit;">Run the test. </font><font style="vertical-align: inherit;">We are waiting for a couple of weeks. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mg/fv/d2/mgfvd2oml6iwvkuuseq8cplljew.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Happened! </font><font style="vertical-align: inherit;">ARPU is up 80%! </font><font style="vertical-align: inherit;">Roll out the change to all users.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And ... after the same period of time, the graphs again do not look the way we planned.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculate Statistical Significance</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The test cannot be stopped simply ‚Äúafter a couple of weeks‚Äù: the results obtained may be inaccurate. </font><font style="vertical-align: inherit;">The less the metric we are following has changed, and the fewer people participate in the test, the more likely it is to be random.&nbsp;&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This probability can be calculated. </font><font style="vertical-align: inherit;">The value denoting it is called p-value. </font><font style="vertical-align: inherit;">I'll tell you how it works. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When conducting any testing, there is a chance to get random results. </font><font style="vertical-align: inherit;">For example, users who visited the site may be unevenly distributed - and the entire paying audience will fall into one of the groups. </font><font style="vertical-align: inherit;">In real tests, the difference in metrics is usually not so big: it is difficult or even impossible to notice a problem on the graphs, and statistical tests cannot be dispensed with. </font><font style="vertical-align: inherit;">In particular, we need to fix the probability</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">errors of the first and second kind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - in other words, the probability of finding changes where they do not exist, and, conversely, not finding them if they exist. Depending on the value of the metric and the established probabilities, we will need a different number of users. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can calculate it using the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">online calculator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : specify the current and target values ‚Äã‚Äãof the monitored metrics - you get the required number of users for the test, and vice versa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qa/ep/2n/qaep2njz7uksfic4ou5tnny5axy.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation for conversion at 10% and changes at 0.2% relative to the current value.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Now we have received all the necessary data and we understand when to stop the test. There are no more obstacles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's run our A / B test and look at the results.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x7/ly/lz/x7lylzz-bnv7ubeednaezw02qwa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This time, the results are more like the truth, but still excellent: ARPU growth by 55%.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We stop the test, apply the test group at all. </font><font style="vertical-align: inherit;">And ... the metrics are falling again. </font><font style="vertical-align: inherit;">Why?&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check the number of users</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's figure out how many users actually visited our site while testing was underway. Judging by the logs, only 10% of our test groups, but we did not take this into account.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If your DAU (the number of unique users per day) is 1000 people, this does not mean that in ten days you will have 10,000 users in the test. Always log real hits to the test (test hits) and count only them. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We implement simple logic. For each user who visits the site, we send a request to the server with the names of the A / B test and control group. Thanks to this, we will know exactly how many users have visited us, and we won‚Äôt be mistaken anymore. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We launch the A / B test.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The results are excellent. We earn more money again! We turn on our test for everyone - and something goes wrong again: in a couple of weeks, the metrics are again lower than predicted.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remember, we started sending hits for all users who visited the site? Never do that. Hits should be sent only to those users who interacted with the tested part of the resource. And the more accurately you define them, the better.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fortunately, this is easy to verify. To do this, you can conduct an A / A / B test. It looks like an A / B test, but in this case you have two control groups and one test group. Why is this needed? If the moment for sending a hit was chosen incorrectly, then users who did not interact with the tested part of the site will fall into the test. In this case, there will be big differences in the metrics in groups A and A, and you can immediately understand that something is wrong.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We launch the A / A / B test.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In group B, leave 50% of users, and divide the remaining 50% equally between groups A and A (we call them control and control_check). Yes, the results will have to wait longer, but by whether the results of groups A and A converge, you will understand whether the hit is sent correctly.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mh/k1/tr/mhk1trrev59vya_trkha7dkpvuy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The results are modest (growth of only 20%), but realistic. </font><font style="vertical-align: inherit;">Let's roll the change at all.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything works perfectly!&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But after a month, the metrics fell again.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testing what we can control</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It turns out that our third-party billing also conducted its A / B test, which directly affected our results. </font><font style="vertical-align: inherit;">Therefore, always follow the results on production and try to test what you control in full.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A / B tests can help the product grow. </font><font style="vertical-align: inherit;">But in order to trust the tests, it is important to conduct them correctly and always check the results. </font><font style="vertical-align: inherit;">This approach will allow you to qualitatively test your product and test hypotheses before they drop all metrics.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Always check the target group.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Submit hits.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Send the right hits.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test what you control in full.</font></font></li>
<li>    /-!</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en498160/index.html">GlusterFS as external storage for Kubernetes</a></li>
<li><a href="../en498162/index.html">We invite you to an IT internship at Alfa Bank</a></li>
<li><a href="../en498164/index.html">Product Strategies for Transition Costs</a></li>
<li><a href="../en498168/index.html">New neural network architectures</a></li>
<li><a href="../en498172/index.html">Java Digest for April 21</a></li>
<li><a href="../en498178/index.html">We work from home: photo spread</a></li>
<li><a href="../en498180/index.html">Rechecking Newton Game Dynamics with PVS-Studio static analyzer</a></li>
<li><a href="../en498186/index.html">Services based on neural networks for designers</a></li>
<li><a href="../en498188/index.html">Probability Theories: Preparing for an Interview and Solving ‚ÄúParadoxes‚Äù</a></li>
<li><a href="../en498192/index.html">Steroid Cosmetic Bag: XD Design Urban Bumbag Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>