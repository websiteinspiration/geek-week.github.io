<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßù üî∫ üóÉÔ∏è Buat API TODO untuk Golang dengan Kubernetes üë®üèº‚Äçüî¨ üßëüèæ‚Äçü§ù‚Äçüßëüèæ üîô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! Menjelang peluncuran kursus Platform Infrastruktur berbasis Kubernetes, kami menyiapkan terjemahan materi menarik lainnya.
 
 
 Artikel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Buat API TODO untuk Golang dengan Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/498130/"><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya! </font><font style="vertical-align: inherit;">Menjelang peluncuran </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kursus Platform Infrastruktur berbasis Kubernetes, kami</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyiapkan terjemahan materi menarik lainnya.</font></font></b></i><br>
<br>
<hr><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel ini ditujukan bagi para pendatang baru di Kubernetes, yang akan tertarik untuk memahami contoh praktis tentang cara menulis Golang API untuk mengelola daftar TODO, dan kemudian bagaimana cara menyebarkannya ke Kubernetes. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap pengembang menyukai daftar TODO yang bagus, bukan? </font><font style="vertical-align: inherit;">Bagaimana lagi kita bisa mengatur diri kita sendiri sebaliknya? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gd/jy/vw/gdjyvw5u8cexjnsseoybworcx7a.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setiap pengembang menyukai aplikasi TODO yang bagus, bukan? </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan mulai dengan meninjau daftar komponen yang diperlukan, kemudian pergi untuk mengkonfigurasi Kubernetes, menyediakan database Postgresql, dan kemudian menginstal kerangka kerja aplikasi yang akan membantu kami dengan mudah menggunakan Go API di Kubernetes, tanpa berfokus pada detail.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan membuat dua titik akhir di API - satu untuk membuat catatan TODO baru, yang lain untuk memilih semua catatan TODO. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semua kode dari tutorial </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini tersedia di GitHub.</font></font></a></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daftar komponen yang diperlukan:</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker yang Diinstal Secara Lokal</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes menjalankan kode dalam gambar kontainer, jadi Anda harus menginstal Docker di komputer Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instal Docker: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.docker.com</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Daftarkan akun Docker Hub untuk menyimpan gambar Docker Anda: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://hub.docker.com/</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster Kubernetes</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat memilih salah satu kluster lokal atau jauh, tetapi yang mana yang lebih baik? </font><font style="vertical-align: inherit;">Opsi yang disederhanakan, seperti k3d, berfungsi di komputer mana pun yang dapat dijalankan Docker, jadi menjalankan cluster lokal tidak lagi membutuhkan banyak RAM. </font><font style="vertical-align: inherit;">Cluster jarak jauh juga bisa menjadi solusi yang sangat efisien, tetapi perlu diingat bahwa semua gambar Docker Anda perlu diunggah dan diunggah untuk setiap perubahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instal k3d: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/rancher/k3d</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
k3d tidak akan menginstal kubectl (ini adalah CLI untuk Kubernetes), jadi instal secara terpisah dari sini: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://kubernetes.io/docs/tasks/tools / install-kubectl</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Golang</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga perlu menginstal Golang dengan IDE di komputer Anda. </font><font style="vertical-align: inherit;">Go gratis dan Anda dapat mengunduhnya untuk MacOS, Windows atau Linux dari tautan berikut: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://golang.org/dl</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDE</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan merekomendasikan menggunakan Visual Studio Code, ini gratis dan memiliki satu set plugin untuk Go yang dapat Anda tambahkan. </font><font style="vertical-align: inherit;">Beberapa rekan lebih suka Goland dari Jetbrains. </font><font style="vertical-align: inherit;">Jika Anda seorang programmer Java, Anda mungkin lebih suka membayar untuk Goland, karena akan mengingatkan Anda pada produk mereka yang lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instal </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VSCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Golang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat sebuah cluster</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda perlu menginstal semua perangkat lunak yang ditentukan di bagian sebelumnya.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat cluster baru menggunakan k3d:</font></font></h4><br>
<code>k3d create</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasikan kubectl sehingga menunjuk ke sebuah cluster baru. </font><font style="vertical-align: inherit;">Ingatlah bahwa banyak kluster dapat digunakan dari satu komputer, jadi sangat penting untuk menunjuk ke yang benar:</font></font><br>
<br>
<pre><code class="go hljs">export KUBECONFIG=<span class="hljs-string">"$(k3d get-kubeconfig --name='k3s-default')"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pastikan bahwa cluster memiliki setidaknya satu simpul. </font><font style="vertical-align: inherit;">Di sini Anda dapat melihat bahwa saya telah menginstal Kubernetes 1.17 - versi yang relatif baru:</font></font><br>
<br>
<pre><code class="go hljs">kubectl get node<font></font>
NAME                     STATUS   ROLES    AGE   VERSION<font></font>
k3d-k3s-<span class="hljs-keyword">default</span>-server   Ready    master   <span class="hljs-number">48</span>s   v1<span class="hljs-number">.17</span><span class="hljs-number">.0</span>+k3s<span class="hljs-number">.1</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan menyimpan catatan TODO kami di tabel database, jadi sekarang kita perlu menginstalnya. </font><font style="vertical-align: inherit;">Postgresql adalah database relasional populer yang dapat kita instal dalam sebuah cluster menggunakan grafik Helm.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal bahtera</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arkade</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah CLI Go, mirip dengan "buatan" atau "apt-get", tetapi untuk aplikasi Kubernetes. </font><font style="vertical-align: inherit;">Ini menggunakan proyek Helm, kubectl, atau CLI untuk menginstal proyek atau produk ke cluster Anda.</font></font><br>
<br>
<pre><code class="go hljs">curl -sLS https:<span class="hljs-comment">//dl.get-arkade.dev | sudo sh</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang instal Postgresql</font></font><br>
<br>
<pre><code class="go hljs">arkade install postgresql<font></font>
===================================================================== = PostgreSQL has been installed.                                    =<font></font>
=====================================================================</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda juga akan melihat informasi tentang string koneksi dan cara memulai CLI Postgresql melalui gambar Docker di dalam cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat memperoleh informasi ini kapan saja menggunakan </font></font><code>arkade info postgresql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan merancang tata letak tabel</font></font><br>
<br>
<pre><code class="go hljs">CREATE TABLE todo (<font></font>
 id              INT GENERATED ALWAYS AS IDENTITY,<font></font>
 description     text NOT NULL,<font></font>
 created_date    timestamp NOT NULL,<font></font>
 completed_date  timestamp NOT NULL<font></font>
);</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan </font></font><code>arkade info postgresql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk mendapatkan informasi koneksi lagi. </font><font style="vertical-align: inherit;">Seharusnya terlihat seperti ini:</font></font><br>
<br>
<pre><code class="go hljs">export POSTGRES_PASSWORD=$(kubectl get secret --namespace <span class="hljs-keyword">default</span> postgresql -o jsonpath=<span class="hljs-string">"{.data.postgresql-password}"</span> | base64 --decode)<font></font>
kubectl run postgresql-client --rm --tty -i --restart=<span class="hljs-string">'Never'</span> --namespace <span class="hljs-keyword">default</span> --image docker.io/bitnami/postgresql:<span class="hljs-number">11.6</span><span class="hljs-number">.0</span>-debian<span class="hljs-number">-9</span>-r0 --env=<span class="hljs-string">"PGPASSWORD=$POSTGRES_PASSWORD"</span> --command -- psql --host postgresql -U postgres -d postgres -p <span class="hljs-number">5432</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda memiliki command prompt :, </font></font><code>postgres = #</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat membuat tabel dengan menyalinnya di dalam, lalu jalankan </font></font><code>\dt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk memperlihatkan tabel:</font></font><br>
<br>
<pre><code class="go hljs">postgres=# \dt<font></font>
List of relations<font></font>
Schema | Name | Type  |  Owner<font></font>
--------+------+-------+----------<font></font>
public | todo | table | postgres<font></font>
(<span class="hljs-number">1</span> row)</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal kerangka kerja aplikasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sama seperti pengembang PHP mempercepat alur kerja mereka menggunakan LAMP (Linux Apache + Mysql + PHP) dan pengembang Rails menggunakan tumpukan yang sudah disiapkan, pengembang Kubernetes dapat menggunakan kerangka kerja aplikasi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tumpukan PLONK adalah singkatan dari Prometheus, Linux, OpenFaaS, NATS, dan Kubernetes.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus menyediakan metrik, penskalaan otomatis, dan kemampuan pengamatan untuk menguji kesehatan sistem Anda, memungkinkannya merespons lonjakan permintaan dan memangkas biaya dengan menyediakan metrik untuk membuat keputusan tentang penskalaan ke nol.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux, meskipun bukan satu-satunya pilihan untuk menjalankan beban kerja di Kubernetes, adalah standar dan termudah untuk digunakan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awalnya, OpenFaaS menyediakan fungsi portabel untuk pengembang, tetapi berfungsi dengan baik ketika menggunakan API dan layanan mikro. </font><font style="vertical-align: inherit;">Fleksibilitasnya berarti bahwa setiap wadah Docker dengan server HTTP dapat digunakan dan dikelola.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NATS adalah proyek CNCF populer yang digunakan untuk pengiriman pesan dan pub / sub. </font><font style="vertical-align: inherit;">Dalam tumpukan PLONK, ia menyediakan kemampuan untuk mengeksekusi permintaan secara tidak sinkron dan untuk antri.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes adalah alasan kita ada di sini. </font><font style="vertical-align: inherit;">Ini menyediakan infrastruktur terukur, penyembuhan diri, dan deklaratif. </font><font style="vertical-align: inherit;">Dan jika Anda tidak lagi membutuhkan bagian dari semua keagungan ini, API-nya disederhanakan dengan OpenFaaS.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instal tumpukan PLONK melalui bahtera:</font></font><br>
<br>
<pre><code class="go hljs">arkade install openfaas</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baca pesan informasi dan jalankan setiap perintah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal faas-cli.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dapatkan kata sandi Anda.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redirect gateway OpenFaaS UI (melalui port 8080)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan masuk ke sistem melalui CLI.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti sebelumnya, Anda dapat menerima pesan informasi menggunakan </font></font><code> info openfaas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebarkan API Go Pertama Anda</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada beberapa cara untuk membuat API Go menggunakan PLONK. </font><font style="vertical-align: inherit;">Opsi pertama adalah menggunakan Dockerfile dan secara manual menentukan port TCP, pemeriksaan kesehatan, server HTTP, dan sebagainya. </font><font style="vertical-align: inherit;">Ini dapat dilakukan dengan menggunakan </font></font><code>faas-cli new --lang dockerfile API_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi ada cara yang lebih sederhana dan lebih otomatis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara kedua adalah dengan menggunakan templat bawaan yang ditawarkan oleh Function Store:</font></font><br>
<br>
<pre><code class="go hljs">faas-cli template store list | grep <span class="hljs-keyword">go</span>
<span class="hljs-keyword">go</span>                       openfaas           Classic Golang template<font></font>
golang-http              openfaas-incubator Golang HTTP template<font></font>
golang-middleware        openfaas-incubator Golang Middleware template</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kami ingin membuat API gaya HTTP tradisional, templat golang-middleware akan paling tepat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di awal tutorial, Anda mendaftar dengan akun Docker Hub Anda untuk menyimpan gambar Docker Anda. </font><font style="vertical-align: inherit;">Setiap beban kerja Kubernet harus tertanam dalam gambar Docker sebelum dapat digunakan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarik pola khusus:</font></font><br>
<br>
<pre><code class="go hljs">faas-cli template store pull golang-middleware</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gunakan Scaffold untuk API Anda dengan golang-middleware dan nama pengguna Anda di Docker Hub:</font></font><br>
<br>
<pre><code class="go hljs">export PREFIX=alexellis2<font></font>
export LANG=golang-middleware<font></font>
export API_NAME=todo<font></font>
faas-cli <span class="hljs-built_in">new</span> --lang $LANG --prefix $PREFIX $API_NAME</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda akan melihat dua file yang dihasilkan:</font></font><br>
<br>
<ul>
<li><code>./todo.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - menyediakan cara untuk mengkonfigurasi, menyebarkan, dan menginstal templat dan nama</font></font></li>
<li><code>./todo/handler.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - di sini Anda menulis kode dan menambahkan file atau paket lain yang Anda butuhkan</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita lakukan beberapa pengeditan dan kemudian kembangkan kode.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">package</span> function
<span class="hljs-keyword">import</span> (
   <span class="hljs-string">"net/http"</span>
   <span class="hljs-string">"encoding/json"</span><font></font>
)<font></font>
<span class="hljs-keyword">type</span> Todo <span class="hljs-keyword">struct</span> {<font></font>
   Description <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"description"`</span><font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Handle</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {<font></font>
   todos := []Todo{}<font></font>
   todos = <span class="hljs-built_in">append</span>(todos, Todo{Description: <span class="hljs-string">"Run faas-cli up"</span>})<font></font>
   res, _ := json.Marshal(todos)<font></font>
   w.WriteHeader(http.StatusOK)<font></font>
   w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)<font></font>
   w.Write([]<span class="hljs-keyword">byte</span>(res))<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda tidak menggunakan VScode dan pluginnya untuk mengedit dan memformat kode, kemudian jalankan setelah setiap perubahan untuk memastikan bahwa file diformat dengan benar.</font></font><br>
<br>
<pre><code class="go hljs">gofmt -w -s ./todo/handler.<span class="hljs-keyword">go</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang sebarkan kode - pertama buat gambar baru, luncurkan di Hub Docker dan sebarkan ke cluster menggunakan OpenFaaS API:</font></font><br>
<br>
<pre><code class="go hljs">Invoke your endpoint when ready:<font></font>
curl http:<span class="hljs-comment">//127.0.0.1:8080/function/todo</span><font></font>
{<font></font>
<span class="hljs-string">"description"</span>: <span class="hljs-string">"Run faas-cli up"</span>
}</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Izinkan pengguna membuat catatan TODO baru</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita izinkan pengguna untuk membuat entri baru dalam daftar TODO mereka. </font><font style="vertical-align: inherit;">Pertama, Anda perlu menambahkan tautan atau "ketergantungan" untuk Pergi ke perpustakaan Postgresql. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita bisa mendapatkannya menggunakan modul vending atau Go yang diperkenalkan di Go 1.11 dan diinstal secara default di Go 1.13. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Edit </font></font><code>handler.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan tambahkan modul yang kita butuhkan untuk mengakses Postgresql:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">import</span> (
   <span class="hljs-string">"database/sql"</span>
   _ <span class="hljs-string">"github.com/lib/pq"</span>
...</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agar modul Go untuk mendeteksi dependensi, kita perlu mendeklarasikan sesuatu di dalam file, yang akan kita gunakan nanti. </font><font style="vertical-align: inherit;">Jika tidak, maka VSCode akan menghapus baris-baris ini ketika disimpan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan ini di bawah impor dalam file</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">var</span> db *sql.DB</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selalu jalankan perintah ini di </font></font><code>todo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folder di mana ia berada </font></font><code>handler.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan bukan di level root c </font></font><code>todo.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inisialisasi modul Go yang baru:</font></font><br>
<br>
<pre><code class="go hljs">cd todo/<font></font>
ls<font></font>
handler.<span class="hljs-keyword">go</span><font></font>
export GO111MODULE=on<font></font>
<span class="hljs-keyword">go</span> mod init</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang perbarui file menggunakan pq library:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">go</span> get
<span class="hljs-keyword">go</span> mod tidy<font></font>
cat <span class="hljs-keyword">go</span>.mod<font></font>
module github.com/alexellis/todo1/todo<font></font>
<span class="hljs-keyword">go</span> <span class="hljs-number">1.13</span>
require github.com/lib/pq v1<span class="hljs-number">.3</span><span class="hljs-number">.0</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa pun yang ada di dalam </font></font><code>go.mod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, salin isinya ke</font></font><code>GO_REPLACE.txt</code><br>
<br>
<pre><code class="go hljs">cat <span class="hljs-keyword">go</span>.mod &gt; GO_REPLACE.txt</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita pastikan bahwa perakitan masih berfungsi sebelum menambahkan kode yang dimasukkan.</font></font><br>
<br>
<pre><code class="go hljs">faas-cli build -f todo.yml --build-arg GO111MODULE=on</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda mungkin memperhatikan bahwa sekarang kami masuk </font></font><code>--build-arg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk melaporkan pola penggunaan modul Go. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama perakitan, Anda akan melihat bahwa modul diunduh sesuai kebutuhan dari Internet.</font></font><br>
<br>
<pre><code class="go hljs">Step <span class="hljs-number">16</span>/<span class="hljs-number">29</span> : RUN <span class="hljs-keyword">go</span> test ./... -cover<font></font>
---&gt; Running in <span class="hljs-number">9</span>a4017438500
<span class="hljs-keyword">go</span>: downloading github.com/lib/pq v1<span class="hljs-number">.3</span><span class="hljs-number">.0</span>
<span class="hljs-keyword">go</span>: extracting github.com/lib/pq v1<span class="hljs-number">.3</span><span class="hljs-number">.0</span>
<span class="hljs-keyword">go</span>: finding github.com/lib/pq v1<span class="hljs-number">.3</span><span class="hljs-number">.0</span><font></font>
?       github.com/alexellis/todo1/todo [no test files]<font></font>
Removing intermediate container <span class="hljs-number">9</span>a4017438500</code></pre><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengkonfigurasi Rahasia untuk Akses Postgresql</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kita dapat membuat kumpulan koneksi </font></font><code>init ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, metode yang hanya akan berjalan sekali ketika program dimulai.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-comment">// init       .   ,     ,   /   /</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> {
       <span class="hljs-keyword">if</span> _, err := os.Stat(<span class="hljs-string">"/var/openfaas/secrets/password"</span>); err == <span class="hljs-literal">nil</span> {<font></font>
               password, _ := sdk.ReadSecret(<span class="hljs-string">"password"</span>)<font></font>
               user, _ := sdk.ReadSecret(<span class="hljs-string">"username"</span>)<font></font>
               host, _ := sdk.ReadSecret(<span class="hljs-string">"host"</span>)<font></font>
               dbName := os.Getenv(<span class="hljs-string">"postgres_db"</span>)<font></font>
               port := os.Getenv(<span class="hljs-string">"postgres_port"</span>)<font></font>
               sslmode := os.Getenv(<span class="hljs-string">"postgres_sslmode"</span>)<font></font>
               connStr := <span class="hljs-string">"postgres://"</span> + user + <span class="hljs-string">":"</span> + password + <span class="hljs-string">"@"</span> + host + <span class="hljs-string">":"</span> + port + <span class="hljs-string">"/"</span> + dbName + <span class="hljs-string">"?sslmode="</span> + sslmode
<span class="hljs-keyword">var</span> err error<font></font>
               db, err = sql.Open(<span class="hljs-string">"postgres"</span>, connStr)
               <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                       <span class="hljs-built_in">panic</span>(err.Error())<font></font>
               }<font></font>
               err = db.Ping()<font></font>
               <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                       <span class="hljs-built_in">panic</span>(err.Error())<font></font>
               }<font></font>
       }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda perhatikan, beberapa informasi diambil dari apa yang </font></font><code> os.Getenv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dibaca dari lingkungan. </font><font style="vertical-align: inherit;">Saya akan menganggap nilai-nilai ini non-rahasia, mereka ditetapkan dalam file </font></font><code>todo.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selebihnya, seperti kata sandi dan host, yang bersifat rahasia, disimpan dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rahasia Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat membuatnya melalui </font></font><code>faas-cli secret create</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau melalui </font></font><code>kubectl create secret generic -n openfaas-fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
String </font></font><code>sdk.ReadSecret</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">berasal dari OpenFaaS Cloud SDK, dengan impor berikut: </font></font><code>github.com/openfaas/openfaas-cloud/sdk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Itu membaca file rahasia dari disk dan mengembalikan nilai atau kesalahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dapatkan nilai rahasia dari </font></font><code>arkade info postgresql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang untuk setiap kata sandi, lakukan hal berikut:</font></font><br>
<br>
<pre><code class="go hljs">export POSTGRES_PASSWORD=$(kubectl get secret --namespace <span class="hljs-keyword">default</span> postgresql -o jsonpath=<span class="hljs-string">"{.data.postgresql-password}"</span> | base64 --decode)<font></font>
export USERNAME=<span class="hljs-string">"postgres"</span><font></font>
export PASSWORD=$POSTGRES_PASSWORD<font></font>
export HOST=<span class="hljs-string">"postgresql.default"</span><font></font>
faas-cli secret create username --from-literal $USERNAME<font></font>
faas-cli secret create password --from-literal $PASSWORD<font></font>
faas-cli secret create host --from-literal $HOST</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periksa rahasia untuk ketersediaan dan kepatuhan:</font></font><br>
<br>
<pre><code class="go hljs">faas-cli secret ls<font></font>
NAME<font></font>
username<font></font>
password<font></font>
host<font></font>
# And via kubectl:<font></font>
kubectl get secret -n openfaas-fn<font></font>
NAME                  TYPE                                  DATA   AGE<font></font>
username              Opaque                                <span class="hljs-number">1</span>      <span class="hljs-number">13</span>s<font></font>
password              Opaque                                <span class="hljs-number">1</span>      <span class="hljs-number">13</span>s<font></font>
host                  Opaque                                <span class="hljs-number">1</span>      <span class="hljs-number">12</span>s</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Edit file YAML kami dan tambahkan yang berikut:</font></font><br>
<br>
<pre><code class="go hljs">secrets:<font></font>
   - host<font></font>
   - password<font></font>
   - username<font></font>
   environment:<font></font>
     postgres_db: postgres<font></font>
     postgres_sslmode: <span class="hljs-string">"disable"</span>
     postgres_port: <span class="hljs-number">5432</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, perbarui modul Go dan jalankan build lagi:</font></font><br>
<br>
<pre><code class="go hljs">cd todo
<span class="hljs-keyword">go</span> get
<span class="hljs-keyword">go</span> mod tidy<font></font>
cd ..<font></font>
faas-cli build -f todo.yml --build-arg GO111MODULE=on<font></font>
Successfully built d2c609f8f559<font></font>
Successfully tagged alexellis2/todo:latest<font></font>
Image: alexellis2/todo:latest built.<font></font>
[<span class="hljs-number">0</span>] &lt; Building todo done in <span class="hljs-number">22.50</span>s.<font></font>
[<span class="hljs-number">0</span>] Worker done.<font></font>
Total build time: <span class="hljs-number">22.50</span>s</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Majelis berfungsi seperti yang diharapkan, jadi mari kita jalankan </font></font><code>faas-cli</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan argumen yang sama untuk memulai dan menggunakan gambar. </font><font style="vertical-align: inherit;">Jika kredensial dan konfigurasi SQL benar, kami tidak akan melihat kesalahan dalam log, namun, jika mereka salah, kami akan mendapatkan kode panik di init (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periksa log:</font></font><br>
<br>
<pre><code class="go hljs">faas-cli logs todo
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z Forking - ./handler []
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Started logging stderr from function.
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Started logging stdout from function.
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> OperationalMode: http
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Timeouts: read: <span class="hljs-number">10</span>s, write: <span class="hljs-number">10</span>s hard: <span class="hljs-number">10</span>s.
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Listening on port: <span class="hljs-number">8080</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Metrics listening on port: <span class="hljs-number">8081</span>
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">10</span>:<span class="hljs-number">03</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">10</span>:<span class="hljs-number">03</span> Writing lock-file to: /tmp/.lock</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sementara semuanya terlihat bagus, sekarang mari kita coba memanggil titik akhir:</font></font><br>
<br>
<pre><code class="go hljs">echo | faas-cli invoke todo -f todo.yml
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">11</span>:<span class="hljs-number">02</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">02</span> POST / - <span class="hljs-number">200</span> OK - ContentLength: <span class="hljs-number">35</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, sekarang kami telah berhasil membuat koneksi ke database, dan kami dapat melakukan insert. </font><font style="vertical-align: inherit;">Bagaimana kita tahu itu? </font><font style="vertical-align: inherit;">Karena itu </font></font><code>db.Ping ()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengembalikan kesalahan, jika tidak maka akan membuat panik:</font></font><br>
<br>
<pre><code class="go hljs">err = db.Ping()
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
   <span class="hljs-built_in">panic</span>(err.Error())<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ikuti tautan untuk detail lebih lanjut tentang paket </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">database / sql</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menulis kode penyisipan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini menyisipkan baris baru ke dalam tabel </font></font><code>todo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan menggunakan sintaksis khusus di mana nilainya tidak dilampirkan dalam tanda kutip, tetapi diganti dengan kode db.Query. </font><font style="vertical-align: inherit;">Dalam "masa lalu" pemrograman LAMP, kesalahan umum yang menyebabkan banyak sistem menjadi tidak aman adalah kurangnya sanitasi data input dan penyatuan input pengguna langsung ke pernyataan SQL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bayangkan seseorang memasukkan deskripsi; </font></font><code>drop table todo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itu tidak akan terlalu menyenangkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, kita menjalankan </font></font><code>db.Query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lalu meneruskan pernyataan SQL menggunakan </font></font><code>$1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>$2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dll untuk setiap nilai, dan kemudian kita bisa mendapatkan hasil dan / atau kesalahan. </font><font style="vertical-align: inherit;">Kita juga harus menutup hasil ini, jadi gunakan penundaan untuk ini.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">insert</span><span class="hljs-params">(description <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> {<font></font>
       res, err := db.Query(<span class="hljs-string">`insert into todo (id, description, created_date) values (DEFAULT, $1, now());`</span>,<font></font>
               description)<font></font>
       <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
               <span class="hljs-keyword">return</span> err<font></font>
       }<font></font>
       <span class="hljs-keyword">defer</span> res.Close()
       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita hubungkan ini ke kode.</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Handle</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
       <span class="hljs-keyword">if</span> r.Method == http.MethodPost &amp;&amp; r.URL.Path == <span class="hljs-string">"/create"</span> {
               <span class="hljs-keyword">defer</span> r.Body.Close()<font></font>
               body, _ := ioutil.ReadAll(r.Body)<font></font>
               <span class="hljs-keyword">if</span> err := insert(<span class="hljs-keyword">string</span>(body)); err != <span class="hljs-literal">nil</span> {<font></font>
                       http.Error(w, fmt.Sprintf(<span class="hljs-string">"unable to insert todo: %s"</span>, err.Error()), http.StatusInternalServerError)<font></font>
               }<font></font>
       }<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita gunakan dan jalankan.</font></font><br>
<br>
<pre><code class="go hljs">echo | faas-cli invoke todo -f todo.yml<font></font>
curl http:<span class="hljs-comment">//127.0.0.1:8080/function/todo/create --data "faas-cli build"</span>
curl http:<span class="hljs-comment">//127.0.0.1:8080/function/todo/create --data "faas-cli push"</span>
curl http:<span class="hljs-comment">//127.0.0.1:8080/function/todo/create --data "faas-cli deploy"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periksa log API:</font></font><br>
<br>
<pre><code class="go hljs">faas-cli logs todo
<span class="hljs-number">2020</span><span class="hljs-number">-03</span><span class="hljs-number">-26</span>T14:<span class="hljs-number">35</span>:<span class="hljs-number">29</span>Z <span class="hljs-number">2020</span>/<span class="hljs-number">03</span>/<span class="hljs-number">26</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">29</span> POST /create - <span class="hljs-number">200</span> OK - ContentLength: <span class="hljs-number">0</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Periksa isi tabel menggunakan pgsql:</font></font><br>
<br>
<pre><code class="sql hljs">export POSTGRES_PASSWORD=$(kubectl get secret <span class="hljs-comment">--namespace default postgresql -o jsonpath="{.data.postgresql-password}" | base64 --decode)</span>
kubectl run postgresql-client <span class="hljs-comment">--rm --tty -i --restart='Never' --namespace default --image docker.io/bitnami/postgresql:11.6.0-debian-9-r0 --env="PGPASSWORD=$POSTGRES_PASSWORD" --command -- psql --host postgresql -U postgres -d postgres -p 5432</span>
postgres=<span class="hljs-comment"># select * from todo;</span><font></font>
id |   description   |        created_date        | completed_date<font></font>
<span class="hljs-comment">----+-----------------+----------------------------+----------------</span><font></font>
1 | faas-cli build  | 2020-03-26 14:36:03.367789 |<font></font>
2 | faas-cli push   | 2020-03-26 14:36:03.389656 |<font></font>
3 | faas-cli deploy | 2020-03-26 14:36:03.797881 |</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selamat, Anda sekarang memiliki API TODO yang dapat menerima permintaan masuk melalui </font></font><code>curl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atau klien HTTP lainnya dan menuliskannya ke tabel database.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catat Permintaan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita membuat fungsi baru untuk meminta catatan TODO dari tabel:</font></font><br>
<br>
<pre><code class="sql hljs">func selectTodos() ([]Todo, error) {<font></font>
   var error err<font></font>
   var todos []Todo<font></font>
   return todos, err<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tidak dapat memberi nama metode pemilihan ini karena ini adalah kata kunci yang disediakan untuk bekerja dengan goroutine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang hubungkan metode ke pengendali utama:</font></font><br>
<br>
<pre><code class="sql hljs">} else if r.Method == http.MethodGet &amp;&amp; r.URL.Path == "/list" {<font></font>
   todos, err := selectTodos()<font></font>
   if err != nil {<font></font>
       http.Error(w, fmt.Sprintf("unable to get todos: %s", err.Error()), http.StatusInternalServerError)<font></font>
   }<font></font>
   out, _ := json.Marshal(todos)<font></font>
   w.Header().Set("Content-Type", "application/json")<font></font>
   w.Write(out)<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang ada bidang tambahan untuk tanggal dalam skema data kami, perbarui struktur Todo:</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> Todo <span class="hljs-keyword">struct</span> {<font></font>
   ID <span class="hljs-keyword">int</span> <span class="hljs-string">`json:"id"`</span>
   Description   <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"description"`</span>
   CreatedDate   *time.Time <span class="hljs-string">`json:"created_date"`</span>
   CompletedDate *time.Time <span class="hljs-string">`json:"completed_date"`</span>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita tambahkan </font></font><code>selectTodos()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kode permintaan </font><font style="vertical-align: inherit;">ke metode kami </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="sql hljs">func selectTodos() ([]Todo, error) {<font></font>
       rows, getErr := db.Query(`<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>, description, created_date, completed_date <span class="hljs-keyword">from</span> todo;`)<font></font>
   if getErr != nil {<font></font>
       return []Todo{}, errors.Wrap(getErr, "unable to get from todo table")<font></font>
   }<font></font>
   todos := []Todo{}<font></font>
   defer rows.Close()<font></font>
   for rows.Next() {<font></font>
       result := Todo{}<font></font>
       scanErr := rows.Scan(&amp;result.ID, &amp;result.Description, &amp;result.CreatedDate, &amp;result.CompletedDate)<font></font>
       if scanErr != nil {<font></font>
           log.Println("scan err:", scanErr)<font></font>
       }<font></font>
       todos = append(todos, result)<font></font>
   }<font></font>
   return todos, nil<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti sebelumnya, kita perlu menunda menutup baris untuk permintaan. </font><font style="vertical-align: inherit;">Setiap nilai dimasukkan ke dalam struktur baru menggunakan metode rows.Scan. </font><font style="vertical-align: inherit;">Di akhir metode, kami memiliki konten Todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari mencoba:</font></font><br>
<br>
<pre><code class="sql hljs">faas-cli up -f todo.yml <span class="hljs-comment">--build-arg GO111MODULE=on</span>
curl http://127.0.0.1:8080/function/todo/list</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inilah hasilnya:</font></font><br>
<br>
<pre><code class="sql hljs">[<font></font>
 {<font></font>
   "id": 2,<font></font>
   "description": "faas-cli build",<font></font>
   "created_date": "2020-03-26T14:36:03.367789Z",<font></font>
   "completed_date": null<font></font>
 },<font></font>
 {<font></font>
   "id": 3,<font></font>
   "description": "faas-cli push",<font></font>
   "created_date": "2020-03-26T14:36:03.389656Z",<font></font>
   "completed_date": null<font></font>
 },<font></font>
 {<font></font>
   "id": 4,<font></font>
   "description": "faas-cli deploy",<font></font>
   "created_date": "2020-03-26T14:36:03.797881Z",<font></font>
   "completed_date": null<font></font>
 }<font></font>
]</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menghapus nilai, kita dapat memperbarui anotasi struktur dengan menambahkan </font></font><code>omitempty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="go hljs">CompletedDate *time.Time <span class="hljs-string">`json:"completed_date,omitempty"`</span></code></pre><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk meringkas pekerjaan yang dilakukan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami belum selesai, tetapi ini adalah saat yang tepat untuk berhenti dan meninjau kembali apa yang telah kami capai sejauh ini. </font><font style="vertical-align: inherit;">Kita:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal Go, Docker, kubectl dan VSCode (IDE)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dikerahkan Kubernetes di komputer lokal kami</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menginstal Postgresql menggunakan bahtera dan helm3</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menginstal OpenFaaS dan tumpukan PLONK untuk pengembang aplikasi Kubernetes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Membuat API REST statis awal menggunakan Go dan </font></font><code>golang-middleware</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">templat OpenFaaS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan fungsi "masukkan" ke API TODO kami </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan fungsi pilih ke API TODO kami </font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh kode lengkap yang telah kami buat sejauh ini tersedia di akun GitHub saya: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alexellis / kubernetes-todo-go-app</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Kemudian kita dapat melakukan lebih banyak lagi, misalnya:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan Otentikasi Menggunakan Token Pembawa Statis</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buat halaman web menggunakan HTML statis atau React template untuk merender daftar TODO dan membuat elemen baru.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menambahkan dukungan multi-pengguna ke API</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan banyak lagi. </font><font style="vertical-align: inherit;">Kami juga dapat mempelajari tumpukan PLONK dan menggunakan dasbor Grafana untuk mulai memantau API kami dan memahami berapa banyak sumber daya yang digunakan dengan dasbor Kubernetes atau server metrik (diinstal menggunakan </font></font><code>arkade install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelajari lebih lanjut tentang arkade: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://get-arkade.dev</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Hadiri lokakarya OpenFaaS untuk mempelajari lebih lanjut tentang hal di atas: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/openfaas/workshop/</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anda dapat berlangganan buletin Pembaruan Orang Dalam premium saya di </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https: / /www.alexellis.io/</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dan di twitter saya </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alex Ellis</font></font></a><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelajari lebih lanjut tentang kursus</font></font></a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id498120/index.html">Optimasi Waktu Bangun - Bagian 1</a></li>
<li><a href="../id498122/index.html">Cara menguji dari jarak jauh agar tidak merusak produk dan kehidupan Anda</a></li>
<li><a href="../id498124/index.html">Telegram untuk dukungan teknis: alat dan perangkap</a></li>
<li><a href="../id498126/index.html">Bagaimana Amazon berusaha membuat orang membeli ... lebih sedikit</a></li>
<li><a href="../id498128/index.html">Edisi # 36: Pelatihan TI - masalah saat ini dan tantangan dari perusahaan terkemuka</a></li>
<li><a href="../id498132/index.html">Resep PostgreSQL: kegagalan otomatis dan bergabung kembali secara otomatis di galangan buruh pelabuhan</a></li>
<li><a href="../id498134/index.html">Bagaimana cara menggunakan kembali kode dengan bundel symfony 5? Bagian 1. Bundel minimum</a></li>
<li><a href="../id498136/index.html">Percakapan dengan Polina Gurtova tentang masa depan dan sekarang dari Frontend. Penyelenggara DUMP 2020 mengajukan beberapa pertanyaan penting.</a></li>
<li><a href="../id498138/index.html">Kehidupan setelah studi sarjana: bagaimana saya memutuskan apa yang harus dilakukan selanjutnya ketika pendidikan tinggi dan pekerjaan sudah ada</a></li>
<li><a href="../id498140/index.html">Gandakan ini. Webinar Apache Ignite dan GridGain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>