<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüç≥ üõ∞Ô∏è üöµüèº MVP de ver√£o. Qu√£o flex√≠vel √© o Kotlin? üíæ üå§Ô∏è üíÖüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="/ Original /
 

A sintaxe da linguagem Kotlin √© uma coisa bastante flex√≠vel e a concis√£o do c√≥digo, que em Java pode ser alcan√ßado apenas com a ajuda ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MVP de ver√£o. Qu√£o flex√≠vel √© o Kotlin?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496020/"><p><img src="https://habrastorage.org/webt/n7/aj/xm/n7ajxmxihjfkcum7hddtqeshgie.png"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /</font></font></em></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A sintaxe da linguagem Kotlin √© uma coisa bastante flex√≠vel e a concis√£o do c√≥digo, que em Java pode ser alcan√ßado apenas com a ajuda da gera√ß√£o de c√≥digo, o Kotlin √© frequentemente implementado usando ferramentas de linguagem padr√£o ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">duas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></p><br>
<p>    ,    Kotlin   (   ),  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">MVP- Summer</a>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Kotlin Multiplatform</a>.</p><a name="habracut"></a><br>
<h1 id="zachem-nuzhna-mvp-biblioteka">  MVP ?</h1><br>
<p>    Android,   Fragment  Activity   .      ,      ,  ,  view        view     .   ,    . MVP-  ,  view       .      ,    ,       view,    .         <code></code>.  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Moxy</a>     APT (Annotation Processing Tool). Moxy   MVP-.  ,          . </p><br>
<h1 id="chto-ne-tak-s-apt">    APT?</h1><br>
<ol>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Moxy</a></li>
<li> </li>
<li>  <code>@InjectViewState</code>  Fragment</li>
<li>  ,   ,  .  Moxy  .</li>
</ol><br>
<pre><code class="plaintext hljs">e: &lt;...&gt;/kapt3/stubs/debug/adev/TestFragment.java:16: error: cannot find symbol<font></font>
    public TestPresenterFactory presenterFactory;<font></font>
           ^<font></font>
  symbol:   class TestPresenterFactory<font></font>
  location: class TestFragment</code></pre><br>
<pre><code class="plaintext hljs">e: &lt;...&gt;/kapt3/stubs/debug/adev/ui/TestFragment.java:22:<font></font>
error: [ComponentProcessor:MiscError] dagger.internal.codegen.ComponentProcessor was unable to process this class because not all of its dependencies could be resolved. Check for compilation errors or a circular dependency with generated code.<font></font>
public final class TestFragment extends adev.ui.BaseFragment implements adev.presentation.TestView {<font></font>
             ^</code></pre><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/93a/d55/e3a/93ad55e3ac2060373db1d13f385dc684.jpg"></p><br>
<p>,   ,  Dagger  ,    .  4 ,   ,     . ,          . </p><br>
<p>   Fragment     .  .  Clean Project  ,   ,     .</p><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/49c/b2f/216/49cb2f2165ba1f34ae0254ef2b65ae1a.jpg"></p><br>
<p>        .       ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">AutoFactory</a>,        ,      . </p><br>
<p>          Dagger.   ,            ,   .                 ,     .    APT           .</p><br>
<div class="spoiler"><b class="spoiler_title">APT  Kotlin/Multiplatform</b><div class="spoiler_text"><p> Kotlin/Multiplatform    API .  Annotation Processing   .     API    .</p></div></div><br>
<h1 id="chto-delat"> ?</h1><br>
<p> Android-only       APT. Koin/Kodein  Dagger,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">FragmentArgs</a>. Moxy    .  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Google MVVM</a>,  -      ,  ,  .   ,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a>.</p><br>
<p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Kotlin/JS</a>  2017 .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">property-</a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">VueJS</a>  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a>.     : "           Fragment/Activity?"         .     :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createViewProxy</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state(view::counter, initial = <span class="hljs-number">0</span>)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEnter</span><span class="hljs-params">()</span></span> {<font></font>
        viewProxy.counter = <span class="hljs-number">1</span><font></font>
    }<font></font>
}</code></pre><br>
<p>    view    <code>viewProxy</code>,     view.    view  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">property delegate</a>,     <code>state</code>.          view      view .       ,   ,  view  ,    .          Map.    view  <code>createViewProxy</code>       <code>state</code>        Map .</p><br>
<p>  :</p><br>
<ol>
<li>   <code>createViewProxy</code>    <code>viewProxy</code>.  .    ,     BottomSheet             .</li>
<li>,     view.</li>
</ol><br>
<p>          .         "".</p><br>
<h1 id="perelom-1-sostoyanie"> ‚Ññ1. </h1><br>
<p>    , <code>viewProxy</code>       view.  ,  , .  <code>viewProxy</code>   view ,   ,     <code>state</code>,   view c    .</p><br>
<p>   :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ ::counter }, initial = <span class="hljs-number">0</span>)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {<font></font>
        viewProxy.counter = <span class="hljs-number">1</span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasePresenter</span>&lt;<span class="hljs-type">TView</span>&gt; </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">state</span><span class="hljs-params">(
        rule: <span class="hljs-type">TView</span>.() -&gt; <span class="hljs-type">KMutableProperty0</span>&lt;<span class="hljs-type">T</span>&gt;
    )</span></span>: StateDelegate&lt;T&gt; {}<font></font>
}</code></pre><br>
<p>Kotlin          : <code>obj::prop</code>.            :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
    <span class="hljs-keyword">var</span> b = <span class="hljs-number">1</span>
    <span class="hljs-keyword">val</span> prop = ::b<font></font>
}</code></pre><br>
<p> : ", ,     <code>this</code>     receiver- !". </p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
    <span class="hljs-keyword">var</span> b = <span class="hljs-number">1</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">fun</span> A.<span class="hljs-title">foo</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> prop = ::b<font></font>
}</code></pre><br>
<p> . ! ! </p><br>
<p>  :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span>?<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ ::counter }, initial = <span class="hljs-literal">null</span>)<font></font>
    }<font></font>
}</code></pre><br>
<p>...</p><br>
<pre><code class="plaintext hljs">e: &lt;...&gt;/adev/presentation/Presenter.kt: (7, 22): Type of 'counter' doesn't match the type of the overridden var-property 'public abstract var counter: Int? defined in adev.presentation.View'</code></pre><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/d09/9f5/412/d099f54124ac4cb33c7ccb6e699cb105.jpg"></p><br>
<p> , Android Studio   .   .    ? ,  frontend  Kotlin,    ,    <code>viewProxy</code>,  ,    IDE,  ,   ,  <code>this</code> ,   <code>state</code>. ,    <code>counter</code>         <code>::counter</code>,    <code>this::counter</code>,   .</p><br>
<p>     view      :   <code>this</code>   .</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasePresenter</span>&lt;<span class="hljs-type">TView</span>&gt; </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">state</span><span class="hljs-params">(
        rule: (<span class="hljs-type">TView</span>) -&gt; <span class="hljs-type">KMutableProperty0</span>&lt;<span class="hljs-type">T</span>&gt;
    )</span></span>: StateDelegate&lt;T&gt; {}<font></font>
}</code></pre><br>
<p>    :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span>?<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-literal">null</span>)<font></font>
    }<font></font>
}</code></pre><br>
<p>  .  .   ,        view           . ,      <code>viewProxy</code>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">  Intellij IDEA/Android Studio</a>.</p><br>
<h1 id="proksi-dlya-sobytiy">  </h1><br>
<p>  :   ?</p><br>
<p>   :</p><br>
<div class="spoiler"><b class="spoiler_title">. . .</b><div class="spoiler_text"><pre><code class="kotlin hljs"><span class="hljs-keyword">object</span> View {
    <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">State</span> </span>{
        <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span><font></font>
    }<font></font>
    <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Methods</span> </span>{
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View.State, View.Methods</span>&gt;</span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewStateProxy = <span class="hljs-keyword">object</span> : View.State {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-number">0</span>)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEnter</span><span class="hljs-params">()</span></span> {<font></font>
        viewStateProxy.counter = <span class="hljs-number">1</span>
        viewMethods?.showMessage(<span class="hljs-string">"Hello!"</span>)<font></font>
    }<font></font>
}</code></pre></div></div><br>
<p>  ,        <code>viewMethods</code>       . ,   .    :</p><br>
<div class="spoiler"><b class="spoiler_title">. . .</b><div class="spoiler_text"><pre><code class="kotlin hljs"><span class="hljs-keyword">object</span> View {
    <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">State</span> </span>{
        <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span><font></font>
    }<font></font>
    <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Methods</span> </span>{
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Router</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toNext</span><span class="hljs-params">()</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View.State, View.Methods, Router</span>&gt;</span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewStateProxy = <span class="hljs-keyword">object</span> : View.State {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-number">0</span>)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onEnter</span><span class="hljs-params">()</span></span> {<font></font>
        viewStateProxy.counter = <span class="hljs-number">1</span>
        viewMethods?.showMessage(<span class="hljs-string">"Hello!"</span>)<font></font>
        router.toNext()<font></font>
    }<font></font>
}</code></pre></div></div><br>
<p> ,        ,    .  ,           ,       .   -     .      : Dagger, Retrofit  Moxy. </p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> Moxy    </a>.     ,       view.<br>
 <code>AddToEndSingleStrategy</code>      view.<br>
 <code>OneExecutionStrategy</code>        ,    ,  view  .<br>
 <code>SkipStrategy</code>    .</p><br>
<p> <code>AddToEndSingleStrategy</code>  Summer  <code>state</code>.      .</p><br>
<p> ,  Kotlin             ,  ,  .</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span>?
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showMessage</span><span class="hljs-params">()</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> showMessage = event { it::showMessage }</span><font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasePresenter</span>&lt;<span class="hljs-type">TView</span>&gt; </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">event</span><span class="hljs-params">(
        getAction: (<span class="hljs-type">TView</span>) -&gt; (() -&gt; <span class="hljs-type">Unit</span>)
    )</span></span> = Event(getAction)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event</span>&lt;<span class="hljs-type">TView</span>&gt;</span>(<font></font>
    getAction: (TView) -&gt; (() -&gt; <span class="hljs-built_in">Unit</span>)<font></font>
) : () -&gt; <span class="hljs-built_in">Unit</span></code></pre><br>
<p>    . :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span>?<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Events</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-literal">null</span>)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">val</span> showMessage = event { it::showMessage }<font></font>
}</code></pre><br>
<p> ,      View   .      ,    ,    .</p><br>
<p>      ?</p><br>
<ol>
<li>   -,   ‚Äî .</li>
<li>   .      -,       .</li>
<li> .</li>
</ol><br>
<p>  ‚Äì .    - ,     .   ,    ,  ,     .   ,        .  Kotlin     ,      - .      .  ,   ,       ,   . ,    .</p><br>
<p> -        .      ? </p><br>
<p>  Kotlin:</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showMessage</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> {<font></font>
    Toast.makeText(requireContext(), <span class="hljs-string">"message"</span>, Toast.LENGTH_LONG).show()<font></font>
}</code></pre><br>
<p>  Kotlin:</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage = { message: String -&gt;<font></font>
    Toast.makeText(requireContext(), <span class="hljs-string">"message"</span>, Toast.LENGTH_LONG).show()<font></font>
}</code></pre><br>
<p>  Swift:</p><br>
<pre><code class="swift hljs">fun showMessage(message: <span class="hljs-type">String</span>) {<font></font>
    printMessage(message)<font></font>
}</code></pre><br>
<p>  Swift:</p><br>
<pre><code class="swift hljs"><span class="hljs-built_in">lazy</span> <span class="hljs-keyword">var</span> showMessage: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Void</span> = { message <span class="hljs-keyword">in</span>
    <span class="hljs-keyword">self</span>.printMessage(message)<font></font>
}</code></pre><br>
<p>     („Å§‚úßœâ‚úß)„Å§</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage = { message: String -&gt; <span class="hljs-built_in">Unit</span> <span class="hljs-keyword">in</span><font></font>
    printMessage(message)<font></font>
}</code></pre><br>
<p>-  .  ,       .   5-6 ,      ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a>. </p><br>
<h1 id="perelom-2-fabrika-sobytiy"> ‚Ññ2.  </h1><br>
<p>      view,      .        :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">val</span> showMessage: () -&gt; <span class="hljs-built_in">Unit</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage = doOnlyWhenAttached { it.showMessage }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasePresenter</span>&lt;<span class="hljs-type">TView</span>&gt; </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doOnlyWhenAttached</span><span class="hljs-params">(
        getAction: (<span class="hljs-type">TView</span>) -&gt; (() -&gt; <span class="hljs-type">Unit</span>)
    )</span></span> = Event(getAction)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event</span>&lt;<span class="hljs-type">TView</span>&gt;</span>(<font></font>
    action: (TView) -&gt; (() -&gt; <span class="hljs-built_in">Unit</span>)<font></font>
) : () -&gt; <span class="hljs-built_in">Unit</span></code></pre><br>
<p>  .  ,  Kotlin          .  <code>vararg</code>,         .           view.</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">val</span> showMessage: (message: String) -&gt; <span class="hljs-built_in">Unit</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage = doOnlyWhenAttached { it.showMessage }<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasePresenter</span>&lt;<span class="hljs-type">TView</span>&gt; </span>{<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doOnlyWhenAttached</span><span class="hljs-params">(
        getAction: (<span class="hljs-type">TView</span>) -&gt; (() -&gt; <span class="hljs-type">Unit</span>)
    )</span></span> = Event0(getAction)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T1&gt;</span> <span class="hljs-title">doOnlyWhenAttached</span><span class="hljs-params">(
        getAction: (<span class="hljs-type">TView</span>) -&gt; ((<span class="hljs-type">T1</span>) -&gt; <span class="hljs-type">Unit</span>)
    )</span></span> = Event1(getAction)<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event0</span>&lt;<span class="hljs-type">TView</span>&gt;</span>(<font></font>
    action: (TView) -&gt; (() -&gt; <span class="hljs-built_in">Unit</span>)<font></font>
) : () -&gt; <span class="hljs-built_in">Unit</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event1</span>&lt;<span class="hljs-type">TView, T1</span>&gt;</span>(<font></font>
    action: (TView) -&gt; ((T1) -&gt; <span class="hljs-built_in">Unit</span>)<font></font>
) : (T1) -&gt; <span class="hljs-built_in">Unit</span></code></pre><br>
<pre><code class="plaintext hljs">e: &lt;...&gt;/adev/presentation/View.kt: (10, 22): Type of 'showMessage' is not a subtype of the overridden property 'public abstract val showMessage: (message: String) -&gt; Unit defined in adev.presentation.View'</code></pre><br>
<p><img src="https://habrastorage.org/getpro/habr/post_images/235/571/e23/235571e2366f32ba9d0aa25d26e8ec39.png"></p><br>
<p> Kotlin   ,        .   ,     Kotlin       ,     .    <code>doOnlyWhenAttached</code>  <code>TView</code>  ,       <code>T1</code>. ,   .</p><br>
<p>"" ‚Äì      <code>Event</code>  2 :</p><br>
<ol>
<li>  <code>TView</code>   </li>
<li>  <code>Event</code>     </li>
</ol><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">val</span> showMessage: (message: String) -&gt; <span class="hljs-built_in">Unit</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage = event { it.showMessage }.doOnlyWhenAttached()<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasePresenter</span>&lt;<span class="hljs-type">TView</span>&gt; </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;TAction&gt;</span> <span class="hljs-title">event</span><span class="hljs-params">(getAction: (<span class="hljs-type">TView</span>) -&gt; <span class="hljs-type">TAction</span>)</span></span> = EventBuilder(getAction)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> EventBuilder<span class="hljs-type">&lt;TView, () -&gt;</span> <span class="hljs-built_in">Unit</span>&gt;.<span class="hljs-title">doOnlyWhenAttached</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">return</span> Event0(<span class="hljs-keyword">this</span>.getAction)<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T1&gt;</span> EventBuilder<span class="hljs-type">&lt;TView, (T1) -&gt;</span> <span class="hljs-built_in">Unit</span>&gt;.<span class="hljs-title">doOnlyWhenAttached</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">return</span> Event1(<span class="hljs-keyword">this</span>.getAction)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">inline</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventBuilder</span>&lt;<span class="hljs-type">TView, TAction</span>&gt;</span>(
    <span class="hljs-keyword">val</span> getAction: (TView) -&gt; TAction<font></font>
)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event0</span>&lt;<span class="hljs-type">TView</span>&gt;</span>(<font></font>
    action: (TView) -&gt; (() -&gt; <span class="hljs-built_in">Unit</span>)<font></font>
) : () -&gt; <span class="hljs-built_in">Unit</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event1</span>&lt;<span class="hljs-type">TView, T1</span>&gt;</span>(<font></font>
    action: (TView) -&gt; ((T1) -&gt; <span class="hljs-built_in">Unit</span>)<font></font>
) : (T1) -&gt; <span class="hljs-built_in">Unit</span></code></pre><br>
<p>    .          shorthands    .   :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">val</span> showMessage: (message: String) -&gt; <span class="hljs-built_in">Unit</span>
    <span class="hljs-keyword">val</span> showMessage1: (message: String) -&gt; <span class="hljs-built_in">Unit</span>
    <span class="hljs-keyword">val</span> showMessage2: (message: String) -&gt; <span class="hljs-built_in">Unit</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">BasePresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage = event { it.showMessage }.build(RepeatLastStrategy())
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage1 = event { it.showMessage1 }.doOnlyWhenAttached()
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> showMessage2 = event { it.showMessage2 }.doExactlyOnce()<font></font>
    }<font></font>
}</code></pre><br>
<p>      ,    !</p><br>
<h1 id="blagodarnosti"></h1><br>
<p>         .   ,     30.      ,   ,  production.     2- .  , , !</p><br>
<p>  Summer  5 production . 2   ‚Äì .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">MaksimNovikov</a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">metnyov</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">deks1309</a>  ,            .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">XanderZhu</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">umpteenthdev</a>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">mowenik</a>     iOS . </p><br>
<h1 id="patterny"></h1><br>
<p>  ,     Summer,        .    :</p><br>
<h2 id="podprezenter"></h2><br>
<p>            android.widget.View, UIView  .        ,           - .  ,     . ,     .</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">SummerPresenter</span>&lt;<span class="hljs-type">View</span>&gt; </span>{
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {}
    <span class="hljs-keyword">val</span> subPresenter = SubPresenter(<font></font>
        onAction = { doSomething() }<font></font>
    )<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fragment</span> : <span class="hljs-type">SummerFragment</span></span>(R.layout.fragment), View {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> presenter <span class="hljs-keyword">by</span> bindPresenter { Presenter() }<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> popup: Popup
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(...)</span></span> {
        <span class="hljs-keyword">super</span>.onViewCreated(...)<font></font>
        popup = Popup(presenter.subPresenter)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SubView</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubPresenter</span></span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> onAction: () -&gt; <span class="hljs-built_in">Unit</span><font></font>
): SummerPresenter&lt;SubView&gt;() {<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : SubView {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> counter <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-number">0</span>)<font></font>
    }<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Popup</span></span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> presenter: SubPresenter<font></font>
) : &lt;...&gt;, SubView {<font></font>
    <span class="hljs-keyword">init</span> {<font></font>
        bindPresenter { presenter }<font></font>
    }<font></font>
}</code></pre><br>
<p> -     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">VueJS</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">ReactJS</a>.</p><br>
<h2 id="sealed-state">sealed State</h2><br>
<p> <code>AddToEndSingleTagStrategy</code>  Moxy,  Summer   <code>state</code>  <code>sealed</code> .</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewState</span> </span>{
    <span class="hljs-keyword">object</span> Loading : ViewState()
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Content</span></span>(<span class="hljs-keyword">val</span> counter) : ViewState()<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> state: ViewState<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">SummerPresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> state <span class="hljs-keyword">by</span> state({ it::state }, initial = ViewState.Loading)<font></font>
    }<font></font>
}</code></pre><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">MaksimNovikov</a>   .</p><br>
<h2 id="didset-in-kotlin">didSet in Kotlin</h2><br>
<p> Kotlin      <code>set</code> .     <code>didSet</code>  <code>didSetNotNull</code>,  <code>didSet</code>  Swift. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"> </a></p><br>
<h2 id="obnovlenie-spiska"> </h2><br>
<p>   :</p><br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Item</span></span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> count: <span class="hljs-built_in">Int</span>)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> items: List&lt;Item&gt;<font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">SummerPresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> items <span class="hljs-keyword">by</span> state({ it::items }, initial = emptyList())<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">(id: <span class="hljs-type">Int</span>)</span></span> {<font></font>
        viewProxy.items = viewProxy.items.map { item -&gt;<font></font>
            <span class="hljs-keyword">if</span> (item.id == id)<font></font>
                item.copy(count = item.count + <span class="hljs-number">1</span>)
            <span class="hljs-keyword">else</span><font></font>
                item<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
<p>  ,      view,   . ,   <code>state</code>,     <code>store</code>  view      .</p><br>
<h1 id="vyvody"></h1><br>
<p>      Summer  Kotlin/Multiplatform  :</p><br>
<p>   Kotlin/Multiplatform        .  iOS-,   ,   ,       .  ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a>.     iOS         0. ,         . </p><br>
<p>   Summer        iOS-.    XCode.        Swift.        Kotlin  XCode   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">  TouchLab</a>.   ,    ,    iOS-. VIPER, Clean Swift  ..       MVP.</p><br>
<p>    ,            Kotlin.    Summer     , unsafe casts   ,     Kotlin   .  ,     ,    ‚Äî    iOS  Swift       view.    .</p><br>
<p>    ,   ,  APT,   Summer,      .</p><br>
<p>   ,   <code>viewProxy</code>  boilerplate.</p><br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> counter: <span class="hljs-built_in">Int</span><font></font>
}<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Presenter</span> : <span class="hljs-type">SummerPresenter</span>&lt;<span class="hljs-type">View</span>&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> viewProxy = <span class="hljs-keyword">object</span> : View {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> state <span class="hljs-keyword">by</span> state({ it::counter }, initial = <span class="hljs-number">0</span>)<font></font>
    }<font></font>
}</code></pre><br>
<p> <code>{ it::counter }</code>      . ,          .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"></a>,   -  .    ,   lint  .</p><br>
<div class="spoiler"><b class="spoiler_title">     view</b><div class="spoiler_text"><p>        <code>state</code>       ,   ,  Swift.  Kotlin  <code>didSet</code>  <code>didSetNotNull</code>        view.  Swift  view       .  ,   ,      .              <code>nil</code>.      ‚Äî ,  ,  . </p><br>
<p>   ,  ,      <code>state</code>   <code>initial</code> ,     <code>state</code>,  <code>event</code>  <code>RepeatLastStrategy</code>     <code>init</code>  .</p></div></div><br>
<p>  ,    Moxy  Summer   Summer  Moxy    .       15-20    .  iOS    Android-  Summer     3-4   .    ,       VIPER.     ViewController-,   iOS- .     ,         Kotlin.     iOS,     ,    .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ tamb√©m pode traduzir 1-2 telas para tentar. </font><font style="vertical-align: inherit;">Kotlin tem uma boa interoperabilidade com o Swift, e o Swift n√£o importa em qual idioma o c√≥digo est√° escrito. </font><font style="vertical-align: inherit;">As aulas escritas em Kotlin olham para Swift como se tivessem sido escritas no Objective-C com anota√ß√µes de compatibilidade colocadas nos lugares certos.</font></font></p><br>
<h1 id="zaklyuchenie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado a todos que leram at√© o fim! </font><font style="vertical-align: inherit;">Espero que voc√™ tenha aprendido algo novo sobre Kotlin por si mesmo e talvez at√© tente </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Summer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ficaria muito grato pelo feedback construtivo.</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt495998/index.html">Criando um tema escuro para estouro de pilha</a></li>
<li><a href="../pt496004/index.html">Novos modelos de pesquisa e an√°lise de dados. WSDM 2020 atrav√©s dos olhos da equipe Yandex.Tolki</a></li>
<li><a href="../pt496006/index.html">Supera√ß√£o do proxy reverso - tecnologia para prote√ß√£o remota e otimiza√ß√£o de sites sem alterar os registros A do DNS</a></li>
<li><a href="../pt496010/index.html">O que acontece com o transporte durante a crise (primeira semana de abril)</a></li>
<li><a href="../pt496014/index.html">Semin√°rios semanais da IBM - abril de 2020</a></li>
<li><a href="../pt496022/index.html">Bact√©rias extremas: como sobreviver no fundo do oceano</a></li>
<li><a href="../pt496024/index.html">O cabe√ßalho "Leia artigos para voc√™". Mar√ßo de 2020. Parte 1</a></li>
<li><a href="../pt496026/index.html">N√£o √© s√≥ com voc√™. Internet est√° desacelerando em todo o mundo devido ao aumento do tr√°fego</a></li>
<li><a href="../pt496028/index.html">Coronav√≠rus, crise e implica√ß√µes de TI</a></li>
<li><a href="../pt496030/index.html">Semana 15 de seguran√ßa: Zoom em vulnerabilidades reais e imagin√°rias</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>