<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôêÔ∏è üÜî üßòüèª C√≥mo capturar r√°pidamente el mundo o administrar una red de computadoras con Windows usando OPSI üîú üèÅ üëÜüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Descargo de responsabilidad: al 
 autor le encantan las muletas cortas y rectas, y tambi√©n adora suavemente el software abierto gratuito por la flexib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C√≥mo capturar r√°pidamente el mundo o administrar una red de computadoras con Windows usando OPSI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497826/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargo de responsabilidad: al </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
autor le encantan las muletas cortas y rectas, y tambi√©n adora suavemente el software abierto gratuito por la flexibilidad y escalabilidad que brinda. </font><font style="vertical-align: inherit;">El prop√≥sito de este art√≠culo es el deseo de promover, as√≠ como hablar sobre el sistema de gesti√≥n de software OPSI (Open PC Server Integration), que es inmerecidamente desconocido en la Internet rusa.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estaba sentado en la oficina y tomando caf√© cuando Ilon Mask me llam√≥ y en ruso puro me dijo que ya es suficiente para soportarlo, es hora de reunir las mejores mentes para luchar contra un determinado virus, y para eso ahora, cinco minutos despu√©s, estoy en Llevar√°n 100 computadoras a la oficina, necesito implementar Windows 10 con urgencia, y ma√±ana por la ma√±ana, cient√≠ficos de todo el mundo vendr√°n a la oficina para comenzar a trabajar en el antivirus. </font><font style="vertical-align: inherit;">Bueno, ¬øno es eso lo que he estado esperando toda mi vida? </font><font style="vertical-align: inherit;">Un desaf√≠o digno para una buena herramienta.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar el plan, utilizar√© el sistema OPSI: Open PC Server Integration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI est√° escrito en python en Alemania y, al parecer, las muletas, sin cargo y escalabilidad tambi√©n lo aprecian mucho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caracter√≠sticas b√°sicas del sistema:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementaci√≥n </font><font style="vertical-align: inherit;">autom√°tica del software </font><font style="vertical-align: inherit;">Funciona as√≠: analiza el instalador y crea el paquete opsi, que instala el programa de la manera correcta. </font><font style="vertical-align: inherit;">Funciona mejor con paquetes msi, conoce algunos formatos m√°s con los que tambi√©n hace frente. </font><font style="vertical-align: inherit;">Puede ejecutar un archivo bat o un script de PowerShell, pero en principio, cualquier int√©rprete. </font><font style="vertical-align: inherit;">Hay sistemas de registro integrados, en general, relleno completo, probablemente la mejor parte del sistema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalaci√≥n autom√°tica de sistemas operativos </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo uso la instalaci√≥n desde una imagen, como la m√°s r√°pida, pero hay opciones con la instalaci√≥n fuera de l√≠nea del sistema desde cero.</font></font></li>
<li>   <br>
<br>
         ,          ,       ,      ,      windows.  ,   ,    windows,    ,          . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Varias interfaces de administraci√≥n convenientes con la posibilidad de una integraci√≥n flexible </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un programa con una interfaz gr√°fica, hay una interfaz http a la que puede enviar comandos, desde la consola del servidor puede controlar OPSI, incrustar comandos en sus scripts, puede acceder al backend desde python, pero desafortunadamente yo, , mientras que yo no poseo tal magia.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compatibilidad con varios servidores de dep√≥sito (servidores que contienen directamente el software desde el que se realiza la implementaci√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede agregar muchos servidores a cada subred o grupo de computadoras, cada una de las cuales servir√° su propia red.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caracter√≠sticas del sistema implementadas por m√≥dulos (hay m√≥dulos gratuitos y de pago):</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conector LDAP (pago) Un </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
conector que conecta un dominio y opsi en un solo conjunto</font></font></li>
<li>  ()<br>
<br>
     : , ...</li>
<li>MySQL  () <br>
<br>
  OPSI  mysql   ,  300 </li>
<li>Nagios  ()<br>
<br>
 </li>
<li>   ()<br>
<br>
 , opsi      ,   ,      .</li>
<li>    ()<br>
<br>
    .</li>
<li>  ()<br>
<br>
  ,   ,      ,  . ,    ansible  puppet,    .    linux  windows      .</li>
<li>WAN  ()<br>
<br>
        ,   . </li>
<li>   ()<br>
<br>
 </li>
<li>OTRS::ITSM  ()<br>
<br>
  </li>
<li>   ()<br>
<br>
 ,      ,            ,   ¬´   ¬ª,  ,  . </li>
</ol><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede obtener m√°s informaci√≥n detallada aqu√≠. El</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
modelo de monetizaci√≥n que tienen es el siguiente: venden m√≥dulos hasta que recolectan la cantidad para liberarlos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mientras se traen las computadoras a mi oficina y se ensamblan, instalo el servidor AD en el servidor Windows, levanto el dominio domain.local en √©l, as√≠ como DNS y DHCP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede instalar OPSI en el grupo de trabajo y en el dominio, lo instalaremos en el dominio, pero sin vincularlo al AD (conector LDAP).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementaremos Windows 10 en una red de computadoras de acuerdo con el siguiente esquema: prepararemos una imagen de Windows 10 desplegable con todos los programas, arrancaremos a trav√©s de la red a trav√©s de opsi, usaremos clonezilla para guardarlo autom√°ticamente en un archivo, luego configuraremos todas las computadoras para que se instalen autom√°ticamente a trav√©s de opsi, arranque a trav√©s de la red y autom√°ticamente Derramaremos este archivo en todas las computadoras en el segmento de red de transmisi√≥n a trav√©s de tftp </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, en el √°rea del servidor DHCP, configuraremos el n√∫mero de par√°metro 66 en la ip de nuestro futuro servidor opsi 192.168.1.229 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/at/sl/hj/atslhjfu6ebadvwdih0bcdzzg2q.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y llevaremos el par√°metro 67 a linux / pxelinux.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En DNS, agregue opsiserver.domain.local bajo su direcci√≥n est√°tica 192.168.1.229</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego crearemos una m√°quina virtual para nuestro servidor opsi en hierro, que resistir√° sus cargas y se adaptar√° a usted en t√©rminos de velocidad. Ssd y varias tarjetas de red son bienvenidas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi no es compatible con todos los sistemas; la lista de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compatibilidad se puede encontrar aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalamos inmediatamente en la configuraci√≥n regional en ingl√©s, le recomiendo encarecidamente que no utilice el alfabeto cir√≠lico en ning√∫n lugar de este servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi distribuci√≥n favorita de debian 10 la instalo en una configuraci√≥n m√≠nima con el nombre opsiserver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de la instalaci√≥n y reinicio, por si acaso, configuramos las configuraciones regionales:</font></font><br>
<br>
<pre><code class="bash hljs">dpkg-reconfigure locales</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selecciono todo donde hay de_ en_ y ru_ system leave en_US.UTF8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La instalaci√≥n adicional es un recuento de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este tutorial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adaptado a la tarea </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cambie el nombre del servidor si es diferente de lo que necesitamos:</font></font><br>
<br>
<pre><code class="bash hljs">hostname opsiserver.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificaci√≥n:</font></font><br>
<br>
<pre><code class="bash hljs">hostname -f</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Traigamos / etc / hosts a la siguiente forma:</font></font><br>
<br>
<pre><code class="plaintext hljs">127.0.0.1 localhost<font></font>
127.1.1.1 localhost.localdomain<font></font>
192.168.1.229 opsiserver.domain.local opsiserver</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y nos olvidaremos de su existencia para siempre, ya que opsi es exigente con el contenido de este archivo, y cuando se cambia, a veces comienza a rebelarse y a rociarse de errores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale los paquetes requeridos:</font></font><br>
<br>
<pre><code class="bash hljs">apt install wget host pigz mc -y</code></pre> <br>
<pre><code class="bash hljs">apt install samba samba-common smbclient cifs-utils -y </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalamos el servidor mysql de forma predeterminada, maria-db se levanta para m√≠, tambi√©n funcionar√°.</font></font><br>
<br>
<pre><code class="bash hljs">apt install default-mysql-server -y</code></pre><br>
<pre><code class="bash hljs">sudo mysql_secure_installation</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Respondemos las preguntas afirmativamente, cambiando la contrase√±a de root y record√°ndola. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregue repositorios OPSI al sistema:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">echo</span> <span class="hljs-string">"deb http://download.opensuse.org/repositories/home:/uibmz:/opsi:/4.1:/stable/Debian_10/ /"</span> &gt; /etc/apt/sources.list.d/opsi.list</code></pre><br>
<pre><code class="bash hljs">wget -nv https://download.opensuse.org/repositories/home:uibmz:opsi:4.1:stable/Debian_10/Release.key -O Release.key<font></font>
apt-key add - &lt; Release.key</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualizado:</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eliminamos tftpd si es as√≠, ya que OPSI entrar√° en conflicto con √©l:</font></font><br>
<br>
<pre><code class="bash hljs">apt remove tftpd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eliminamos el soporte tftp de inetd, porque si es as√≠, OPSI entrar√° en conflicto con √©l:</font></font><br>
<br>
<pre><code class="bash hljs">update-inetd --remove tftp<font></font>
apt install opsi-tftpd-hpa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E instale directamente el servidor opsi:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-server</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en el proceso, solicitar√°n los datos necesarios para crear un certificado autofirmado, que a su vez es necesario para la conexi√≥n cifrada de clientes con el servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar soporte de Windows:</font></font><br>
<br>
<pre><code class="bash hljs">apt install opsi-windows-support</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
configurar el backend mysql:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --configure-mysql</code></pre><br>
<img src="https://habrastorage.org/webt/b0/7g/zh/b07gzhpoteem9-pgzopqghvkmga.png" width="600" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Establecemos la direcci√≥n del servidor (localhost), el usuario desde el que estamos actuando (root), la contrase√±a de root en mysql (que recordamos anteriormente), el nombre de la base de datos para opsi (opsi), el nombre del usuario que trabajar√° en esta base de datos (opsi), la contrase√±a para este usuario (inventamos nuevo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, para debian 10 necesita agregar / usr / sbin a PATH:</font></font><br>
<br>
<pre><code class="bash hljs">PATH=<span class="hljs-variable">$PATH</span>:/usr/sbin</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y la misma l√≠nea se debe agregar a .bashrc en su directorio de inicio. </font><font style="vertical-align: inherit;">Si esto no se hace, en el siguiente paso obtendr√° el error "chpasswd no encontrado". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicializamos el sistema y establecemos los derechos necesarios para los archivos y directorios del sistema:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --init-current-config<font></font>
opsi-set-rights</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reinicio del servicio:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart opsiconfd.service<font></font>
systemctl restart opsipxeconfd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configurar samba:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --auto-configure-samba</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los clientes OPSI se conectan al servidor principal a trav√©s de https en el puerto 4447, y si necesita llamar a alg√∫n tipo de instalaci√≥n, los clientes montar√°n la bola de samba desde el servidor opsi e instalar√°n el software desde all√≠. </font><font style="vertical-align: inherit;">Para hacer esto posible, permitimos que OPSI reconfigure samba. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reiniciar Samba:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart smbd.service<font></font>
systemctl restart nmbd.service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Establezca la contrase√±a de administrador para el usuario del sistema pcpatch: </font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin -d task setPcpatchPassword</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora cree un usuario para administrar el sistema:</font></font><br>
<br>
<pre><code class="bash hljs">useradd -m -s /bin/bash adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crea una contrase√±a para √©l:</font></font><br>
<br>
<pre><code class="bash hljs">passwd adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora la contrase√±a para samba, creo lo mismo que en el sistema:</font></font><br>
<br>
<pre><code class="bash hljs">smbpasswd -a adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A√±adir al grupo:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch adminuser</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si haremos algo con OPSI debajo de la ra√≠z, entonces necesitamos agregar la ra√≠z al grupo:</font></font><br>
<br>
<pre><code class="bash hljs">usermod -aG pcpatch root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algunas muletas m√°s:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --patch-sudoers-file</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede descargar paquetes al sistema y, mientras se cargan, tomar caf√©.</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, los paquetes se pueden actualizar con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-updater -v update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora vaya a </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/misc/helper/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , descargue e instale la interfaz de administraci√≥n confinada por opsi desde all√≠ para </font></font><br>
<br>
<code>opsi-configed-setup.exe</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ingresar al servidor, ingrese la direcci√≥n del servidor, nuestro usuario administrador y su contrase√±a, </font></font><br>
<br>
<code>https://opsiserver.domain.local:4447/</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y estamos en el sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este punto, el servidor est√° instalado! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a-/yg/ft/a-ygftvat-_6wioezy6v7rmuszq.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1: todos los clientes conectados a este servidor, se pueden desarmar en grupos, incluidos los anidados, aplicar la asignaci√≥n a todo el grupo a la vez. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 - una pesta√±a con clientes, esta es una lista de las computadoras controladas por opsi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 - los clientes son una lista, aqu√≠ puede seleccionarlos en cualquier orden para aplicar el prop√≥sito </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 - ‚Äúconfiguraci√≥n del producto‚Äù - v√≠ctima de la traducci√≥n. De hecho, hay paquetes que se pueden instalar en Windows, en la terminolog√≠a opsi - localboot products</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 - Productos Netboot - esto es todo lo que se descarga a trav√©s de la red </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 - direcci√≥n opsi-mac - la amapola de la computadora es lo que se determina durante el arranque de red </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 - opsiHostKey es la "contrase√±a" del cliente en el sistema opsi, si la elimina de computer opsi client, y luego reinstalarlo, no funcionar√°, ya que la contrase√±a seguir√° siendo antigua y no ser√° adecuada. Esto es tanto un error como una caracter√≠stica. Y como lo harias </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora prepararemos la imagen de Windows 10 que derramaremos. Clonezilla, que usaremos, no es tan bueno como el acronis, pero todav√≠a sabe c√≥mo derramar la imagen de un disco m√°s peque√±o al mismo o m√°s grande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ponemos en el sistema todos los programas que necesitamos, as√≠ como las Herramientas de administraci√≥n remota del servidor para Windows 10. Tengo Windows 10 1903, instal√© para 1803 y todo lo que necesita ser iniciado. Puedes descargarlo desde aqu√≠:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.microsoft.com/en-us/download/details.aspx?id=45520</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Lo necesitamos para la utilidad netdom, que le permite ingresar autom√°ticamente la computadora al dominio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, descargamos archivos desde aqu√≠ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/renamejoin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> al directorio c: \ renamejoin. Creamos un administrador de dominio en el controlador de dominio con la capacidad de ingresar solo computadoras en el dominio con el inicio de sesi√≥n de Joinadmin con contrase√±a contrase√±a1234QWE. Si un atacante intercepta esta contrase√±a, solo puede traer computadoras a nuestro dominio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute la l√≠nea desde createtesk.txt en la consola de administraci√≥n de Windows completamente preparado, lo que crear√° una tarea para comenzar en el arranque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el esquema funcionar√° de la siguiente manera:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando dividimos la imagen en todos los ordenadores, en el primer arranque, ventanas pondr√° en marcha una tarea </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cambia el nombre del ordenador para </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, reiniciar el ordenador, borrar </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y cambiar el nombre </font></font><code>C:\renamejoin\step2.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. En el pr√≥ximo arranque, se iniciar√° Windows </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que ingresar√° esta computadora en el dominio, lo reiniciar√° y lo eliminar√° </font></font><code>C:\renamejoin\step1.cmd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Podemos eliminar la tarea potencialmente peligrosa de las computadoras de dominio m√°s adelante. A trav√©s de OPSI, por supuesto! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/58/nn/ft58nnalinh1dzsqyx2clhilaym.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es hora de convertir el Windows preparado en una imagen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A trav√©s del icono de la computadora con un signo m√°s, agregue nuestra computadora a la interfaz de administraci√≥n opsi opsi-configed, establezca su direcci√≥n de amapola. </font><font style="vertical-align: inherit;">Salvar. </font><font style="vertical-align: inherit;">Pasamos a los productos Netboot, frente a clonezilla ponemos "setup". </font><font style="vertical-align: inherit;">En la configuraci√≥n para el cliente, exponemos todo como en la captura de pantalla: el nombre del archivo y el comando mediante el cual llenamos todo el disco en la imagen. </font><font style="vertical-align: inherit;">En el BIOS de la computadora con Windows, configuramos la descarga desde la red. </font><font style="vertical-align: inherit;">Reinicia la comp. </font><font style="vertical-align: inherit;">Si hiciste todo correctamente, ver√°s c√≥mo Windows fluye en la imagen sin la ayuda de las manos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/zi/e6/wuzie6bgshbkngnutgpsqw9lfz0.png" width="500" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mientras tanto, las computadoras est√°n ensambladas, pero deben agregarse como clientes en opsi junto con sus direcciones de amapola, agregarlas con bol√≠grafos no es en absoluto un asunto de boyardos, ¬øverdad? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solucion es:</font></font><br>
<br>
<pre><code class="bash hljs">apt install tcpdump</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecutar en opsiserver:</font></font><br>
<br>
<pre><code class="bash hljs">tcpdump -n udp -vvvvv -e port 69 &gt; /var/<span class="hljs-built_in">log</span>/tftp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, estableciendo la configuraci√≥n del BIOS para que todas las computadoras se inicien a trav√©s de la red (y al mismo tiempo se despiertan de los dispositivos PCI-E, a trav√©s de la red, comprender√° por qu√© m√°s adelante), c√°rguelos. Si la ventana azul del men√∫ de inicio de opsi aparece durante el inicio, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/7c/h7/po7ch7eco5daftbhmaqr3fspcjs.png" width="500" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
entonces est√° haciendo todo bien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al arrancar, las computadoras acceden a nuestro servidor, tcpdump escribe sus direcciones poppy en un archivo </font></font><code>/var/log/tftp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y usa un script repo </font></font><code>https://github.com/valmont2k/opsi-hosts-importer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ejecutar en el servidor operativo despu√©s de que todas las computadoras est√°n marcadas en opsi y dejan sus direcciones poppy all√≠. Este script usa la API opsi desde aqu√≠ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/experimental/documentation/html/opsi-api-documentation/opsi_API.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y un poco de magia. Despu√©s de iniciarlo, tendr√° clientes en el servidor opsiser del formulario win% random32% .domain.local</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente paso es transmitir la imagen de Windows (que ya deber√≠a haberse hecho) a todas las computadoras. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yn/6g/ik/yn6gikht6l5aizhym_t839uk7mo.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, seleccione todas las computadoras en las que necesita instalar Windows y en clonezilla opuesta establecemos los valores como en la captura de pantalla. Apaga las computadoras, luego enciende varias de ellas a la vez y observa c√≥mo Windows se instala autom√°ticamente en ellas, cambian su nombre y se ingresan en el dominio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tambi√©n desea automatizar esto, coloque etherwake y escriba un script que con un retraso especificado tome las direcciones mac del archivo / tmp / newmacs y active sus hosts para que se turnen para rodar Windows. Ver </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actualizaci√≥n 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hice un gesto de Ronaldo desde un anuncio de champ√∫ y ya estaba empacando caf√© cuando Ilon Mask volvi√≥ a llamar a mi tel√©fono y agreg√≥:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - S√≠, olvid√© decir que es necesario que la </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√∫ltima versi√≥n est√© </font><font style="vertical-align: inherit;">en todas las computadoras ma√±ana </font><font style="vertical-align: inherit;">, ¬øpuedes manejarlo? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - ¬°Por supuesto, todo ser√° ma√±ana! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No puedo molestar al √≠dolo de los tecn√≥cratas, as√≠ que debes volver a poner tu cerebro en tus manos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ser√≠a bueno que al inicio las computadoras establecieran un cliente opsi llamado opsi-client-agent. Esto se puede hacer a trav√©s de pol√≠ticas de grupo de dominio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que esto suceda sin ingresar una contrase√±a durante la instalaci√≥n, debe </font><font style="vertical-align: inherit;">
agregar la contrase√±a de su usuario </font><font style="vertical-align: inherit;">en el </font><font style="vertical-align: inherit;">archivo </font></font><br>
<code>/var/lib/opsi/depot/opsi-client-agent/files/opsi/cfg/config.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en opsiserver </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como el valor de service_hidden_password</font></font><code>adminuser</code><font style="vertical-align: inherit;"></font><code>base64</code><br>
<br>
<pre><code class="plaintext hljs">[installation]<font></font>
service_user=adminuser<font></font>
service_password=none<font></font>
service_hidden_password=base64HERE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, agregue la pol√≠tica de grupo en el dominio setupOPSI y tome la secuencia de comandos desde aqu√≠. </font></font><code>https://github.com/valmont2k/opsi-install-opsi-client-agent-over-active-directory-domain-policy</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recuerde insertar sus valores en la secuencia de comandos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pi/bq/gr/pibqgrvntzwy6vlhvkwljjs4fki.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hizo todo correctamente, en el primer reinicio en el dominio, los clientes instalar√°n </font></font><code>opsi-client-agent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, reiniciar√°n y aparecer√°n bajo sus nombres </font></font><code>win-%random%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en la interfaz de administraci√≥n de OPSI. </font><font style="vertical-align: inherit;">Los clientes antiguos con las mismas direcciones de poppy se pueden eliminar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora puede continuar con la instalaci√≥n </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos aqu√≠ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://forum.opsi.org/viewtopic.php?f=22&amp;t=7573</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y encontramos un enlace al paquete </font></font><code>*.opsi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con el nombre </font></font><code>packagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, algo as√≠ </font></font><code>"opsi PackageBuilder Windows (opsi Paket)"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue el paquete al directorio </font></font><code>/var/lib/opsi/workbench</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en opsiserver</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /var/lib/opsi/workbench</code></pre><br>
<pre><code class="bash hljs">wget https://opsipackagebuilder.s3.amazonaws.com/opsiPackageBuilder/python/opsipackagebuilder_8.4.4-1.opsi </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e instalarlo:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i opsipackagebuilder_8.4.4-1.opsi</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, en la interfaz de administraci√≥n de opsi, haga clic en el bot√≥n de actualizaci√≥n y vea que tenemos nuevos paquetes </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los pusimos a trav√©s de la interfaz de control en una m√°quina de prueba en Windows. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el programa </font></font><code>opsipackagebuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y la </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradici√≥n y de gesti√≥n </font></font><code>opsi-setup-detector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y el juego fuera de √©l en el programa de instalaci√≥n </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, descargado desde el sitio web de pre-programa oficial. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de instalar, debe configurar los ajustes del programa. Montamos la bola en la m√°quina de prueba \\ opsiserver.domain.local \ opsi_workbench como unidad z: escribimos nuestro nombre y correo en los campos especificados: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/zx/gz/a3zxgzhluvq6-vb6utpdveqfoqi.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI puede hacer un paquete usando 32 y 64 instaladores al mismo tiempo y configur√°ndolos en funci√≥n de la capacidad del sistema, tenemos 64 bits en todas partes, as√≠ que haga clic en "Analizar archivo √∫nico ...":</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n-/ev/s9/n-evs94sic7qrqsafbish6zhjno.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que el detector no entendi√≥ el directorio de instalaci√≥n, podemos averiguarlo por nosotros mismos tratando de instalar el programa a trav√©s del instalador. Pero detect√≥ el tipo de instalador, la versi√≥n del programa, el tama√±o de la aplicaci√≥n en forma ensamblada y desplegada, la clave de instalaci√≥n fuera de l√≠nea, la clave de eliminaci√≥n fuera de l√≠nea y el nombre del desinstalador. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vh/u7/ys/vhu7ysu1f6hjlkxbvuetosk2xcu.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingresamos nosotros mismos al directorio de instalaci√≥n y hacemos clic en Siguiente paso: </font></font><br>
<img src="https://habrastorage.org/webt/wl/lx/nf/wllxnfx3gtvrhtdspigvxznyply.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ puede agregar el nombre del producto, su ID, descripci√≥n y establecer la versi√≥n del paquete, es decir, poner en el intento que hacemos para ensamblar el paquete (en nuestro caso, el primer intento): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/_g/fa/ip_gfarn7c49hwtnvhdy0cnxesm.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
puede dejar las dependencias, esto significa que para instalar el paquete actual, los paquetes que se establecen en los requisitos para los nuestros se instalar√°n: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/be/mn/os/bemnosq2zhjnugxp5ywu8ahysqi.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crear paquete OPSI: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vd/s8/-2/vds8-2ho3zriw5pt7l4dtjouhpq.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creamos el paquete, ahora tenemos que ir a opsiserver en</font></font><code>/var/lib/opsi/workbench/windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recoger paquete:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-makepackage</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalarlo:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-package-manager -d ALL -i windirstat-1.1.2-1.opsi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si todo sali√≥ bien, entonces en la interfaz de administraci√≥n confinada por opsi, haga clic en el bot√≥n "actualizar" y vea que tenemos un nuevo paquete </font></font><code>windirstat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que puede instalarse en computadoras seleccionadas en nuestra red. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Bingo! </font><font style="vertical-align: inherit;">¬°El primer paquete est√° ensamblado! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para complicar nuestra tarea, usando Powershell crearemos una regla en el firewall de Windows que le dar√° acceso al cliente al puerto 4441 y 4447 y haremos que esta aplicaci√≥n cargue autom√°ticamente para el usuario a trav√©s del ajuste del registro, como si fuera, por ejemplo, un mensajero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abrir el generador de paquetes opsi: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ry/35/br/ry35brmfbx9wcefpvejn45ofq1i.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
elija abrir el paquete y abra nuestro paquete con windirstat:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7q/fi/tb/7qfitbgjqlx1kceksjhko2qokc0.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPSI act√∫a de manera predeterminada de la siguiente manera: cuando elimina un programa de uninstall.opsiscript, se llama a delsub.opsiscript, que elimina el programa. Al instalar un programa desde setup.opsiscript, se llama a delsub.opsiscript, que elimina el programa, y ‚Äã‚Äãluego setup.opsiscript lo instala. Por lo tanto, realizamos ediciones para crear algo en setup.opsiscript y ediciones para eliminar algo en delsub.opsiscript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toda la magia de estos scripts se refleja en la documentaci√≥n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://download.uib.de/opsi4.1/documentation/html/en/opsi-winst-manual/opsi-winst-manual.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
setup.opsiscript se puede abrir a trav√©s del √≠cono de l√°piz, y delsub.opsiscript v√≠a Script Tree. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/_s/y_/bk_sy_fdgjsl6x4lbokjcrtjhc0.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√° el men√∫ de archivo completo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/o9/wc/lb/o9wclbi4d3hob_bx9mdrlibnxwi.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada intento de construir un paquete debe incrementarse en uno.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/km/8n/ry/km8nrypi8ie323expcio-ms0kum.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregamos el programa para cargar autom√°ticamente a trav√©s de opsi, para esto, inserte las l√≠neas en setup.opsiscript:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y en delsub.opsiscript, inserte las l√≠neas:</font></font><br>
<br>
<pre><code class="plaintext hljs">Registry_changes  /AllNTUserdats /64bit<font></font>
[Registry_changes]<font></font>
OpenKey [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run]<font></font>
;Set "WinDirStat" = "C:\Program Files (x86)\WinDirStat\windirstat.exe"<font></font>
DeleteVar "WinDirStat"</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agregamos la regla al firewall ejecutando el script de PowerShell, para esto, inserte las l√≠neas en setup.opsiscript:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
<font></font>
New-NetFirewallRule -DisplayName 'OPSI-Inbound' -Profile @('Domain', 'Private', 'Public') -Direction Inbound -Action Allow -Protocol TCP -LocalPort @('4441', '4447')</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y en delsub.opsiscript, inserte las l√≠neas:</font></font><br>
<br>
<pre><code class="plaintext hljs">DosInAnIcon_PowerShell_ExecutionPolicy<font></font>
ExecWith_PowerShell_NichtPDCAktionen powershell.exe winst /sysnative<font></font>
[DosInAnIcon_PowerShell_ExecutionPolicy]<font></font>
echo "powershell set-executionpolicy RemoteSigned ..."<font></font>
powershell.exe set-executionpolicy RemoteSigned<font></font>
exit %ERRORLEVEL%<font></font>
<font></font>
[ExecWith_PowerShell_NichtPDCAktionen]<font></font>
; hier Dein PS-Code<font></font>
Remove-NetFirewallRule -DisplayName 'OPSI-Inbound'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo completo se puede encontrar aqu√≠: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/valmont2k/WinDirStatOpsiPackageTest</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ya me he relajado, viendo c√≥mo opsi lanza la </font></font><code>%program%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√∫ltima versi√≥n a toda la red, mientras Ilon nuevamente interrumpi√≥ mis pensamientos en alto. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - La pr√≥xima semana vendr√°n otras 500 personas, ya se alquilaron oficinas, se est√°n importando computadoras, hay un networker, necesita implementar una red de Windows en seis sucursales alrededor de la ciudad, ¬øpuede manejarlo? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Bueno, por supuesto, esto no es ciencia espacial - brome√© cansinamente en respuesta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clonamos nuestro servidor opsiserver usando el hipervisor y lo implementamos en la sucursal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suponemos que la oficina central est√° conectada a sucursales a trav√©s de una VPN con una velocidad de al menos 10 Mbps.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora crearemos un servidor de dep√≥sito, es decir, un servidor para almacenar paquetes en la sucursal. </font><font style="vertical-align: inherit;">Los clientes en la sucursal utilizar√°n https en el servidor principal, y si necesita instalar software, montar√°n el servidor de dep√≥sito en su sucursal y se instalar√°n desde all√≠, esto se hace en particular para guardar el canal de Internet entre la oficina y la sucursal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuramos en el servidor de sucursal opsiserver-2 una direcci√≥n est√°tica de la red local cambiando el archivo de </font></font><code>/etc/network/interfaces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acuerdo con la nueva red. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cambiar nombre de host y hosts:</font></font><br>
<br>
<pre><code class="bash hljs">sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/'</span> /etc/hostname<font></font>
sed -i <span class="hljs-string">'s/opsiserver/opsiserver-2/g'</span> /etc/hosts</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en / etc / hosts actualizamos los datos conduciendo en una nueva direcci√≥n IP </font></font><br>
<br>
<pre><code class="bash hljs">reboot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cambie el nombre del servidor opsi usando opsi:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-admin --no-depot -d method host_renameOpsiDepotserver opsiserver.domain.local opsiserver-2.domain.local</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el servidor opsiserver-2.domain.local lo conectamos a opsiserver.domain.local como dep√≥sito:</font></font><br>
<br>
<pre><code class="bash hljs">opsi-setup --register-depot</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Especifique el nombre del servidor principal, al que conectamos el nuevo dep√≥sito, el administrador y la contrase√±a: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/02/y_/yx02y_bcvpikxgkubku2-fl8try.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
no necesita cambiar nada aqu√≠ </font><font style="vertical-align: inherit;">: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n2/1j/_l/n21j_lmeiwlsn3ghmkcxr4yadgg.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
puede verificar que todo se haga correctamente en opsi-configed: a </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6u/s9/nu/6us9nurw4d3rsetl0nemcy_x_re.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
continuaci√≥n, debe configurar el sistema para que los clientes elijan el servidor de dep√≥sito por s√≠ mismos. Seleccionamos a todos los clientes y los configuramos como dep√≥sito din√°mico. Por defecto, el cliente mira su direcci√≥n IP y selecciona el dep√≥sito de su red. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/4v/mg/vp4vmg0czhi2vmkwobeddecf1dc.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora configuramos que todos los futuros clientes elijan inmediatamente el dep√≥sito de forma din√°mica: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/-j/c4/h7-jc4kpf-5vyavsz_mckjp44-a.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
eso es todo, la configuraci√≥n del nuevo servidor de dep√≥sito se realiza, puede instalar opsi-client-agent para computadoras en la red local con el mismo script que instalamos en la oficina principal anteriormente, no olvidando cambiar la direcci√≥n IP dentro del script.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cada sucursal configuramos un controlador de dominio (puede leer solo), hacemos nuestro propio direccionamiento de red, dividimos el sitio predeterminado dentro del dominio de Windows en subsitios, cada uno de los cuales hacemos nuestra subred, nuestra pol√≠tica de grupo con su script de instalaci√≥n de agente de cliente-opsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego repetimos en la nueva rama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Termin√© mi caf√© y me fui a casa, y el LED en la tarjeta de red indic√≥ que los sistemas nuevos y nuevos se estaban implementando con el ruido de los enfriadores ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actualizaci√≥n 1: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como result√≥, no hay necesidad de script, opsi-configed permite que el mouse haga clic en el despertar de los clientes a trav√©s del sheduler.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es497814/index.html">Cinco etapas para aceptar lo inevitable, o c√≥mo desarrollamos un programa para la creaci√≥n de perfiles automatizada</a></li>
<li><a href="../es497816/index.html">Russian Railways me env√≠a los boletos de otra persona</a></li>
<li><a href="../es497818/index.html">Acceso remoto a m√°quinas virtuales con GPU con Citrix</a></li>
<li><a href="../es497820/index.html">Regularizaci√≥n estad√≠stica de problemas inversos incorrectos para ellos. Turchin (parte 1)</a></li>
<li><a href="../es497822/index.html">Hombre en una botella</a></li>
<li><a href="../es497828/index.html">2 en 1: cifrado con protecci√≥n de seguridad</a></li>
<li><a href="../es497830/index.html">OWASP Mosc√∫ 2020/1 Grabaciones</a></li>
<li><a href="../es497832/index.html">Lo que se esconde detr√°s de VestaCP</a></li>
<li><a href="../es497834/index.html">Sistema avanzado de autorizaci√≥n de recursos en Laravel. Parte 2. Puertas de enlace, pol√≠ticas</a></li>
<li><a href="../es497836/index.html">Comparaci√≥n de la velocidad de los lenguajes de programaci√≥n usando el ejemplo de resolver el problema de entrenar una red neuronal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>