<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘©ğŸ½ ğŸ¤œ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ä¾‹ã«ã‚ˆã‚‹Goã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ ğŸŠ ğŸ ğŸ˜¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã®è¨˜äº‹ã§ã¯ã€Golangã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®å•é¡Œã«ã¤ã„ã¦æ¤œè¨ã—ã¾ã™ã€‚Goã«é–¢ã™ã‚‹è¨˜äº‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã§ã€ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã¨ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«è¨€åŠã—ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã“ã¨ã«æ°—ä»˜ãã¾ã—ãŸã€‚åŒæ™‚ã«ã€ãƒãƒ–ã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«é–¢ã™ã‚‹è¨˜äº‹ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ãŒã€Goã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã‹ãªã‚Šä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚è¨˜äº‹ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ã¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ä¾‹ã«ã‚ˆã‚‹Goã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501000/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€Golangã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®å•é¡Œã«ã¤ã„ã¦æ¤œè¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">Goã«é–¢ã™ã‚‹è¨˜äº‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã§ã€ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã¨ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«è¨€åŠã—ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã“ã¨ã«æ°—ä»˜ãã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">åŒæ™‚ã«ã€ãƒãƒ–ã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«é–¢ã™ã‚‹è¨˜äº‹ã¯ã»ã¨ã‚“ã©ã‚ã‚Šã¾ã›ã‚“ãŒã€Goã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã‹ãªã‚Šä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">è¨˜äº‹ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ã¯ä½•ã‹ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¯„å›²ã‚’ã‚³ãƒ¼ãƒ‰ä¾‹ã§èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€åå°„ã¯ç„¡è¦–ã—ã¾ã›ã‚“ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HabrÃ©ã§è©±é¡Œã«è‰¯ã„è¨˜äº‹ãŒæ—¢ã«å­˜åœ¨ã—ã¦ã„ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã“ã§</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ç§ã¯ç¹°ã‚Šè¿”ã—ã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¯æ¬¡ã®å ´åˆã«ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã®é€Ÿåº¦ã‚’ä¸Šã’ã‚‹ã€ã¤ã¾ã‚Šãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç½®ãæ›ãˆã‚‹ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã®ãƒ«ãƒ¼ãƒãƒ³ï¼ˆãŠã‚ˆã³ãã‚Œã«é–¢é€£ã™ã‚‹ã‚¨ãƒ©ãƒ¼ï¼‰ã‚’æ¸›ã‚‰ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ãˆã‚‰ã‚ŒãŸãƒ«ãƒ¼ãƒ«ã«å¾“ã£ãŸãƒ©ãƒƒãƒ‘ãƒ¼ã®å®Ÿè£…ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹ã‹ã‚‰ã€æ¨™æº–è¨€èªã®æä¾›ã«å«ã¾ã‚Œã€æ•°å€¤å®šæ•°ã®ã‚»ãƒƒãƒˆã®Stringï¼ˆï¼‰ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•çš„ã«ç”Ÿæˆã§ãã‚‹Stringerãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¤œè¨ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€å¤‰æ•°åã®å‡ºåŠ›ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¾‹ã¯ã€ä¸Šè¨˜ã®è¨˜äº‹ã§è©³ç´°ã«èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æœ€ã‚‚èˆˆå‘³æ·±ã„ä¾‹ã¯ã€ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ã®ã‚«ãƒ©ãƒ¼åã®æ´¾ç”Ÿã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãã“ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’é©ç”¨ã™ã‚‹ã¨ã€ãƒ‘ãƒ¬ãƒƒãƒˆã‚’å¤‰æ›´ã™ã‚‹ã¨ãã«ã„ãã¤ã‹ã®å ´æ‰€ã§ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚ˆã‚Šå®Ÿç”¨çš„ãªä¾‹ã¨ã—ã¦ã€Mail.ruã®easyjsonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¤ã„ã¦è§¦ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ§‹é€ ä½“ã¸ã®/ã‹ã‚‰ã®JSONã®masrshall / unmarshallã®å®Ÿè¡Œã‚’é«˜é€ŸåŒ–ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã§ã®ãã‚Œã‚‰ã®å®Ÿè£…ã¯ã€ã™ã¹ã¦ã®é¸æŠè‚¢ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€easyjsonã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è»¢é€ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã§è¦‹ã¤ã‹ã£ãŸã™ã¹ã¦ã®æ§‹é€ ã€ã¾ãŸã¯// easyjsonï¼šjsonã«ã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹æ§‹é€ ã«å¯¾ã—ã¦ã®ã¿ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¾‹ã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ§‹é€ ã‚’è€ƒãˆã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span>{<font></font>
    ID <span class="hljs-keyword">int</span>
    Login <span class="hljs-keyword">string</span>
    Email <span class="hljs-keyword">string</span>
    Level <span class="hljs-keyword">int</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚ŒãŒå«ã¾ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs">easyjson -all main.go</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®çµæœã€Userã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MarshalEasyJSONï¼ˆw * jwriter.Writerï¼‰-æ§‹é€ ã‚’JSONãƒã‚¤ãƒˆã®é…åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnmarshalEasyJSONï¼ˆl * jlexer.Lexerï¼‰-ãƒã‚¤ãƒˆã®é…åˆ—ã‹ã‚‰æ§‹é€ ä½“ã«å¤‰æ›ã—ã¾ã™ã€‚ </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é–¢æ•°MarshalJSONï¼ˆï¼‰ï¼ˆ[]ãƒã‚¤ãƒˆã€ã‚¨ãƒ©ãƒ¼ï¼‰ãŠã‚ˆã³UnmarshalJSONï¼ˆãƒ‡ãƒ¼ã‚¿[]ãƒã‚¤ãƒˆï¼‰ã‚¨ãƒ©ãƒ¼ã¯ã€æ¨™æº–ã®jsonã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã®äº’æ›æ€§ã®ãŸã‚ã«å¿…è¦ã§ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Easyjsonã‚³ãƒ¼ãƒ‰</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestEasyJSON</span><span class="hljs-params">()</span></span> {<font></font>
	testJSON := <span class="hljs-string">`{"ID":123, "Login":"TestUser", "Email":"user@gmail.com", "Level":12}`</span>
	JSONb := []<span class="hljs-keyword">byte</span>(testJSON)<font></font>
	fmt.Println(testJSON)<font></font>
	recvUser := &amp;User{}<font></font>
	recvUser.UnmarshalJSON(JSONb)<font></font>
	fmt.Println(recvUser)<font></font>
	recvUser.Level += <span class="hljs-number">1</span><font></font>
	outJSON, _ := recvUser.MarshalJSON()<font></font>
	fmt.Println(<span class="hljs-keyword">string</span>(outJSON))<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®é–¢æ•°ã§ã¯ã€æœ€åˆã«JSONã‚’æ§‹é€ ã«å¤‰æ›ã—ã€1ã¤ã®ãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ ã—ã¦ã€çµæœã®JSONã‚’å‡ºåŠ›ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">easyjsonã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¯ã€å®Ÿè¡Œæ™‚ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šé™¤ãã€ã‚³ãƒ¼ãƒ‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¯ã€gRPCã‚’ä»‹ã—ã¦é€šä¿¡ã™ã‚‹ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ç©æ¥µçš„ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸­é–“è¨€èªEDLã‚’ä½¿ç”¨ã—ã¦ã€protobufå½¢å¼ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã®èª¬æ˜ã®å¾Œã€protocã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒèµ·å‹•ã—ã€ç›®çš„ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã«å®Ÿè£…ã™ã‚‹å¿…è¦ã®ã‚ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã€é€šä¿¡ã‚’ç·¨æˆã™ã‚‹ãŸã‚ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚éå¸¸ã«ä¾¿åˆ©ãªã“ã¨ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’å˜ä¸€ã®å½¢å¼ã§è¨˜è¿°ã—ã€å„å¯¾è©±è¦ç´ ãŒè¨˜è¿°ã•ã‚Œã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ãŸã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®é–‹ç™ºã«ä½¿ç”¨ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºè€…ãŒè¨˜è¿°ã™ã‚‹å¿…è¦ã®ãªã„ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ãŒã€æ­£ã—ãå‹•ä½œã™ã‚‹ãŸã‚ã«ã¯å¿…è¦ã§ã™ã€‚</font><font style="vertical-align: inherit;">ãŸã¨ãˆã°ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è‡ªå‹•çš„ã«ç”Ÿæˆã—ã€DBMSã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å‹•çš„ã«ç”Ÿæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å®Ÿè£…</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goã§ã®ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã‚’å®Ÿéš›ã«èª¿ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãšã€AST-æŠ½è±¡æ§‹æ–‡ãƒ„ãƒªãƒ¼ã¾ãŸã¯æŠ½è±¡æ§‹æ–‡ãƒ„ãƒªãƒ¼ã«ã¤ã„ã¦è¨€åŠã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢ã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™</font><font style="vertical-align: inherit;">ã€‚ç§ãŸã¡ã®ç›®çš„ã®ãŸã‚ã«ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ãŒã‚°ãƒ©ãƒ•ã®å½¢ã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã“ã§ã€é ‚ç‚¹ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®æ¼”ç®—å­ã§ãƒãƒƒãƒ—ã•ã‚Œï¼ˆãƒãƒ¼ã‚¯ã•ã‚Œï¼‰ã€è‘‰ã¯å¯¾å¿œã™ã‚‹ã‚ªãƒšãƒ©ãƒ³ãƒ‰ã§ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€æœ€åˆã«ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼š</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">go / ast </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">go / parser / </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">go / token /</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ã‚³ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒ„ãƒªãƒ¼ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™</font></font><br>
<br>
<pre><code class="go hljs"><font></font>
fset := token.NewFileSet()<font></font>
node, err := parser.ParseFile(fset, os.Args[<span class="hljs-number">1</span>], <span class="hljs-literal">nil</span>, parser.ParseComments)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ•ã‚¡ã‚¤ãƒ«åã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®æœ€åˆã®å¼•æ•°ã‹ã‚‰å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚ã¾ãŸã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ„ãƒªãƒ¼ã«è¿½åŠ ã™ã‚‹ã‚ˆã†ã«æ±‚ã‚ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€èˆ¬ã«ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆä»–ã®ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã«åŸºã¥ã„ãŸã‚³ãƒ¼ãƒ‰ã®é–‹ç™ºè€…ï¼‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯ã‚¿ã‚°ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼ˆæ§‹é€ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿‘ãã«ã€Œjsonï¼šã€ã€Œã€ã‚’è¨˜è¿°ã—ã¾ã™ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹ã¨ã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€è»¢é€ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¿ã¹ã€å¯¾å¿œã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã®ã‚ã‚‹æ§‹é€ ã‚’æ¢ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç›¸äº’ä½œç”¨ã®ãŸã‚ã«æ§‹é€ ï¼ˆCRUDãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dbeã‚³ãƒ¡ãƒ³ãƒˆï¼š{"table"ï¼š "users"}ã€‚æ§‹é€ ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç½®ã‹ã‚Œã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®šç¾©ã§ãã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ§‹é€ ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®dbeã‚¿ã‚°ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ã¨å±æ€§ã‚’é…ç½®ã™ã‚‹åˆ—ã®åå‰ã‚’æŒ‡å®šã§ãã¾ã™ï¼šprimary_keyãŠã‚ˆã³not_nullã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‰ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨ãã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¾ãŸã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«ã¯ã€åˆ—ã‚’ä½œæˆã—ãªã„ã‚ˆã†ã«ã€Œ-ã€ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã¾ã æˆ¦é—˜ä¸­ã§ã¯ãªãã€å¿…è¦ãªãƒã‚§ãƒƒã‚¯ã¨ä¿è­·ã®ä¸€éƒ¨ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’äº‹å‰ã«äºˆç´„ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">èˆˆå‘³ãŒã‚ã‚Œã°é–‹ç™ºã‚’ç¶šã‘ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æ±ºå®šã—ãŸã®ã§ã€ã‚³ãƒ¼ãƒ‰ã®ä½œæˆã‚’é–‹å§‹ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã¸ã®ãƒªãƒ³ã‚¯ã¯ã€è¨˜äº‹ã®æœ€å¾Œã«ã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çµæœã®ãƒ„ãƒªãƒ¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã€æœ€åˆã®ãƒ¬ãƒ™ãƒ«ã®å„è¦ç´ ã‚’è§£æã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">Goã«ã¯ã€BadDeclã€GenDeclã€ãŠã‚ˆã³FuncDeclã¨ã„ã†è§£æç”¨ã®å®šç¾©æ¸ˆã¿ã®ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¿ã‚¤ãƒ—èª¬æ˜</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs"><span class="hljs-comment">// A BadDecl node is a placeholder for declarations containing</span>
<span class="hljs-comment">// syntax errors for which no correct declaration nodes can be</span>
<span class="hljs-comment">// created.</span>
<span class="hljs-comment">//</span>
BadDecl <span class="hljs-keyword">struct</span> {<font></font>
    From, To token.Pos <span class="hljs-comment">// position range of bad declaration</span><font></font>
}<font></font>
<span class="hljs-comment">// A GenDecl node (generic declaration node) represents an import,</span>
<span class="hljs-comment">// constant, type or variable declaration. A valid Lparen position</span>
<span class="hljs-comment">// (Lparen.IsValid()) indicates a parenthesized declaration.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Relationship between Tok value and Specs element type:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// token.IMPORT *ImportSpec</span>
<span class="hljs-comment">// token.CONST *ValueSpec</span>
<span class="hljs-comment">// token.TYPE *TypeSpec</span>
<span class="hljs-comment">// token.VAR *ValueSpec</span>
<span class="hljs-comment">//</span>
GenDecl <span class="hljs-keyword">struct</span> {<font></font>
    Doc *CommentGroup <span class="hljs-comment">// associated documentation; or nil</span>
    TokPos token.Pos <span class="hljs-comment">// position of Tok</span>
    Tok token.Token <span class="hljs-comment">// IMPORT, CONST, TYPE, VAR</span>
    Lparen token.Pos <span class="hljs-comment">// position of '(', if any</span><font></font>
    Specs []Spec<font></font>
    Rparen token.Pos <span class="hljs-comment">// position of ')', if any</span><font></font>
}<font></font>
<span class="hljs-comment">// A FuncDecl node represents a function declaration.</span>
FuncDecl <span class="hljs-keyword">struct</span> {<font></font>
    Doc *CommentGroup <span class="hljs-comment">// associated documentation; or nil</span>
    Recv *FieldList <span class="hljs-comment">// receiver (methods); or nil (functions)</span>
    Name *Ident <span class="hljs-comment">// function/method name</span>
    Type *FuncType <span class="hljs-comment">// function signature: parameters, results, and position of "func" keyword</span>
    Body *BlockStmt <span class="hljs-comment">// function body; or nil for external (non-Go) function</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ§‹é€ ã«é–¢å¿ƒãŒã‚ã‚‹ãŸã‚ã€GenDeclã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®æ®µéšã§ã¯ã€FuncDeclãŒå½¹ç«‹ã¤å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€é–¢æ•°ã®å®šç¾©ãŒã‚ã‚Šã€ãã‚Œã‚‰ã‚’ãƒ©ãƒƒãƒ—ã—ã¾ã™ãŒã€ä»Šã§ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">æ¬¡ã«ã€å„ãƒãƒ¼ãƒ‰ã®Specsé…åˆ—ã‚’è¦‹ã¦ã€å‹å®šç¾©ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ* ast.TypeSpecï¼‰ã‚’æ“ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã‚Œã¯æ§‹é€ ï¼ˆ* ast.StructTypeï¼‰ã§ã™ã€‚</font><font style="vertical-align: inherit;">æ§‹é€ ãŒã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆ// dbeãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å®Œå…¨ãªãƒ„ãƒªãƒ¼ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã‚³ãƒ¼ãƒ‰ã¨ã€ä½¿ç”¨ã™ã‚‹æ§‹é€ ã®å®šç¾©ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ„ãƒªãƒ¼ã®èµ°æŸ»ã¨æ§‹é€ ã®å–å¾—</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> node.Decls {<font></font>
	genD, ok := f.(*ast.GenDecl)<font></font>
	<span class="hljs-keyword">if</span> !ok {<font></font>
		fmt.Printf(<span class="hljs-string">"SKIP %T is not *ast.GenDecl\n"</span>, f)
		<span class="hljs-keyword">continue</span><font></font>
	}<font></font>
	targetStruct := &amp;StructInfo{}<font></font>
	<span class="hljs-keyword">var</span> thisIsStruct <span class="hljs-keyword">bool</span>
	<span class="hljs-keyword">for</span> _, spec := <span class="hljs-keyword">range</span> genD.Specs {<font></font>
		currType, ok := spec.(*ast.TypeSpec)<font></font>
		<span class="hljs-keyword">if</span> !ok {<font></font>
			fmt.Printf(<span class="hljs-string">"SKIP %T is not ast.TypeSpec\n"</span>, spec)
			<span class="hljs-keyword">continue</span><font></font>
		}<font></font>
<font></font>
		currStruct, ok := currType.Type.(*ast.StructType)<font></font>
		<span class="hljs-keyword">if</span> !ok {<font></font>
			fmt.Printf(<span class="hljs-string">"SKIP %T is not ast.StructType\n"</span>, currStruct)
			<span class="hljs-keyword">continue</span><font></font>
		}<font></font>
		targetStruct.Name = currType.Name.Name<font></font>
		thisIsStruct = <span class="hljs-literal">true</span><font></font>
	}<font></font>
	<span class="hljs-comment">//Getting comments</span>
	<span class="hljs-keyword">var</span> needCodegen <span class="hljs-keyword">bool</span>
	<span class="hljs-keyword">var</span> dbeParams <span class="hljs-keyword">string</span>
	<span class="hljs-keyword">if</span> thisIsStruct {
		<span class="hljs-keyword">for</span> _, comment := <span class="hljs-keyword">range</span> genD.Doc.List {<font></font>
			needCodegen = needCodegen || strings.HasPrefix(comment.Text, <span class="hljs-string">"// dbe"</span>)
			<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(comment.Text) &lt; <span class="hljs-number">7</span> {<font></font>
				dbeParams = <span class="hljs-string">""</span>
			} <span class="hljs-keyword">else</span> {<font></font>
				dbeParams = strings.Replace(comment.Text, <span class="hljs-string">"// dbe:"</span>, <span class="hljs-string">""</span>, <span class="hljs-number">1</span>)<font></font>
			}<font></font>
		}<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> needCodegen {<font></font>
		targetStruct.Target = genD<font></font>
		genParams := &amp;DbeParam{}<font></font>
		<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(dbeParams) != <span class="hljs-number">0</span> {<font></font>
			err := json.Unmarshal([]<span class="hljs-keyword">byte</span>(dbeParams), genParams)
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
				fmt.Printf(<span class="hljs-string">"Error encoding DBE params for structure %s\n"</span>, targetStruct.Name)
				<span class="hljs-keyword">continue</span><font></font>
			}<font></font>
		} <span class="hljs-keyword">else</span> {<font></font>
			genParams.TableName = targetStruct.Name<font></font>
		}<font></font>
<font></font>
		targetStruct.GenParam = genParams<font></font>
		generateMethods(targetStruct, out)<font></font>
	}<font></font>
}</code></pre><br>
     ,  :<br>
<br>
<pre><code class="go hljs"><span class="hljs-keyword">type</span> DbeParam <span class="hljs-keyword">struct</span> {<font></font>
	TableName <span class="hljs-keyword">string</span> <span class="hljs-string">`json:"table"`</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">type</span> StructInfo <span class="hljs-keyword">struct</span> {<font></font>
	Name     <span class="hljs-keyword">string</span><font></font>
	GenParam *DbeParam<font></font>
	Target   *ast.GenDecl<font></font>
}</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€æ§‹é€ ä½“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æº–å‚™ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å—ã‘å–ã£ãŸæƒ…å ±ã«åŸºã¥ã„ã¦ã€ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆé–¢æ•°ï¼ˆcreateTableï¼‰ã¨CRUDãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ§‹é€ ä½“ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generateMethods</span><span class="hljs-params">(reqStruct *StructInfo, out *os.File)</span></span> {
	<span class="hljs-keyword">for</span> _, spec := <span class="hljs-keyword">range</span> reqStruct.Target.Specs {<font></font>
		fmt.Fprintln(out, <span class="hljs-string">""</span>)<font></font>
		currType, ok := spec.(*ast.TypeSpec)<font></font>
		<span class="hljs-keyword">if</span> !ok {
			<span class="hljs-keyword">continue</span><font></font>
		}<font></font>
		currStruct, ok := currType.Type.(*ast.StructType)<font></font>
		<span class="hljs-keyword">if</span> !ok {
			<span class="hljs-keyword">continue</span><font></font>
		}<font></font>
<font></font>
		fmt.Printf(<span class="hljs-string">"\tgenerating createTable methods for %s\n"</span>, currType.Name.Name)<font></font>
<font></font>
		curTable := &amp;TableInfo{<font></font>
			TableName: reqStruct.GenParam.TableName,<font></font>
			Columns:   <span class="hljs-built_in">make</span>([]*ColInfo, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(currStruct.Fields.List)),<font></font>
		}<font></font>
<font></font>
		<span class="hljs-keyword">for</span> _, field := <span class="hljs-keyword">range</span> currStruct.Fields.List {
			<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(field.Names) == <span class="hljs-number">0</span> {
				<span class="hljs-keyword">continue</span><font></font>
			}<font></font>
			tableCol := &amp;ColInfo{FieldName: field.Names[<span class="hljs-number">0</span>].Name}
			<span class="hljs-keyword">var</span> fieldIsPrimKey <span class="hljs-keyword">bool</span>
			<span class="hljs-keyword">var</span> preventThisField <span class="hljs-keyword">bool</span>
			<span class="hljs-keyword">if</span> field.Tag != <span class="hljs-literal">nil</span> {<font></font>
				tag := reflect.StructTag(field.Tag.Value[<span class="hljs-number">1</span> : <span class="hljs-built_in">len</span>(field.Tag.Value)<span class="hljs-number">-1</span>])<font></font>
				tagVal := tag.Get(<span class="hljs-string">"dbe"</span>)<font></font>
				fmt.Println(<span class="hljs-string">"dbe:"</span>, tagVal)<font></font>
				tagParams := strings.Split(tagVal, <span class="hljs-string">","</span>)<font></font>
			PARAMSLOOP:<font></font>
				<span class="hljs-keyword">for</span> _, param := <span class="hljs-keyword">range</span> tagParams {
					<span class="hljs-keyword">switch</span> param {
					<span class="hljs-keyword">case</span> <span class="hljs-string">"primary_key"</span>:
						<span class="hljs-keyword">if</span> curTable.PrimaryKey == <span class="hljs-literal">nil</span> {<font></font>
							fieldIsPrimKey = <span class="hljs-literal">true</span>
							tableCol.NotNull = <span class="hljs-literal">true</span>
						} <span class="hljs-keyword">else</span> {<font></font>
							log.Panicf(<span class="hljs-string">"Table %s cannot have more then 1 primary key!"</span>, currType.Name.Name)<font></font>
						}<font></font>
					<span class="hljs-keyword">case</span> <span class="hljs-string">"not_null"</span>:<font></font>
						tableCol.NotNull = <span class="hljs-literal">true</span>
					<span class="hljs-keyword">case</span> <span class="hljs-string">"-"</span>:<font></font>
						preventThisField = <span class="hljs-literal">true</span>
						<span class="hljs-keyword">break</span> PARAMSLOOP
					<span class="hljs-keyword">default</span>:<font></font>
						tableCol.ColName = param<font></font>
					}<font></font>
<font></font>
				}<font></font>
				<span class="hljs-keyword">if</span> preventThisField {
					<span class="hljs-keyword">continue</span><font></font>
				}<font></font>
			}<font></font>
			<span class="hljs-keyword">if</span> tableCol.ColName == <span class="hljs-string">""</span> {<font></font>
				tableCol.ColName = tableCol.FieldName<font></font>
			}<font></font>
			<span class="hljs-keyword">if</span> fieldIsPrimKey {<font></font>
				curTable.PrimaryKey = tableCol<font></font>
			}<font></font>
			<span class="hljs-comment">//Determine field type</span>
			<span class="hljs-keyword">var</span> fieldType <span class="hljs-keyword">string</span>
			<span class="hljs-keyword">switch</span> field.Type.(<span class="hljs-keyword">type</span>) {
			<span class="hljs-keyword">case</span> *ast.Ident:<font></font>
				fieldType = field.Type.(*ast.Ident).Name<font></font>
			<span class="hljs-keyword">case</span> *ast.SelectorExpr:<font></font>
				fieldType = field.Type.(*ast.SelectorExpr).Sel.Name<font></font>
			}<font></font>
			<span class="hljs-comment">//fieldType := field.Type.(*ast.Ident).Name</span>
			fmt.Printf(<span class="hljs-string">"%s- %s\n"</span>, tableCol.FieldName, fieldType)
			<span class="hljs-comment">//Check for integers</span>
			<span class="hljs-keyword">if</span> strings.Contains(fieldType, <span class="hljs-string">"int"</span>) {<font></font>
				tableCol.ColType = <span class="hljs-string">"integer"</span>
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-comment">//Check for other types</span>
				<span class="hljs-keyword">switch</span> fieldType {
				<span class="hljs-keyword">case</span> <span class="hljs-string">"string"</span>:<font></font>
					tableCol.ColType = <span class="hljs-string">"text"</span>
				<span class="hljs-keyword">case</span> <span class="hljs-string">"bool"</span>:<font></font>
					tableCol.ColType = <span class="hljs-string">"boolean"</span>
				<span class="hljs-keyword">case</span> <span class="hljs-string">"Time"</span>:<font></font>
					tableCol.ColType = <span class="hljs-string">"TIMESTAMP"</span>
				<span class="hljs-keyword">default</span>:<font></font>
					log.Panicf(<span class="hljs-string">"Field type %s not supported"</span>, fieldType)<font></font>
				}<font></font>
			}<font></font>
			tableCol.FieldType = fieldType<font></font>
			curTable.Columns = <span class="hljs-built_in">append</span>(curTable.Columns, tableCol)<font></font>
			curTable.StructName = currType.Name.Name<font></font>
<font></font>
		}<font></font>
		curTable.generateCreateTable(out)<font></font>
<font></font>
		fmt.Printf(<span class="hljs-string">"\tgenerating CRUD methods for %s\n"</span>, currType.Name.Name)<font></font>
		curTable.generateCreate(out)<font></font>
		curTable.generateQuery(out)<font></font>
		curTable.generateUpdate(out)<font></font>
		curTable.generateDelete(out)<font></font>
	}<font></font>
}</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç›®çš„ã®æ§‹é€ ã®ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª¿ã¹ã€å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¿ã‚°ã®è§£æã‚’é–‹å§‹ã—ã¾ã™ã€‚ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€é–¢å¿ƒã®ã‚ã‚‹ã‚¿ã‚°ã‚’å–å¾—ã—ã¾ã™ï¼ˆçµå±€ã®ã¨ã“ã‚ã€jsonãªã©ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä»–ã®ã‚¿ã‚°ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚ã‚¿ã‚°ã®å†…å®¹ã‚’åˆ†æã—ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸»ã‚­ãƒ¼ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºå®šã—ã¾ã™ï¼ˆè¤‡æ•°ã®ä¸»ã‚­ãƒ¼ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã‚Œã‚’å‘ªã„ã€å®Ÿè¡Œã‚’åœæ­¢ã—ã¾ã™ï¼‰ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚¼ãƒ­ä»¥å¤–ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã—ã¦å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿã‚¿ã‚°ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã‚ŒãŸå ´åˆã®åˆ—åã€‚ã¾ãŸã€æ§‹é€ ä½“ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¿ã‚¤ãƒ—ã«åŸºã¥ã„ã¦ãƒ†ãƒ¼ãƒ–ãƒ«åˆ—ã®ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã«ã¯æœ‰é™ã®ã‚»ãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚åŸºæœ¬çš„ãªã‚¿ã‚¤ãƒ—ã®ã¿ã‚’ç”Ÿæˆã—ã€ã™ã¹ã¦ã®è¡Œã‚’TEXTãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã«æ¸›ã‚‰ã—ã¾ã™ãŒã€ä¸€èˆ¬çš„ã«ã¯ã€åˆ—ã‚¿ã‚¤ãƒ—ã®å®šç¾©ã‚’ã‚¿ã‚°ã«è¿½åŠ ã—ã¦ã€ã‚ˆã‚Šç´°ã‹ãè¨­å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€æ–¹ã€äº‹å‰ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç›®çš„ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ãŸã‚Šã€ä½œæˆã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è‡ªå‹•çš„ã«ä¿®æ­£ã—ãŸã‚Šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ§‹é€ ã‚’è§£æã—ãŸå¾Œã€ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã€Createã€Queryã€Updateã€Deleteé–¢æ•°ã‚’ä½œæˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é–‹å§‹ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">å„é–¢æ•°ã®SQLå¼ã¨å®Ÿè¡Œã™ã‚‹ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’æº–å‚™ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚¨ãƒ©ãƒ¼å‡¦ç†ã«ç…©ã‚ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã‚’æä¾›ã™ã‚‹ã ã‘ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«ã¯ã€text /ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚</font><font style="vertical-align: inherit;">å½¼ã‚‰ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€ã¯ã‚‹ã‹ã«ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸäºˆæ¸¬å¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã‚’å…¥æ‰‹ã§ãã¾ã™ï¼ˆã‚³ãƒ¼ãƒ‰ã¯ã™ãã«è¡¨ç¤ºã•ã‚Œã€ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦æ±šã•ã‚Œã¾ã›ã‚“ï¼‰ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tableD *TableInfo)</span> <span class="hljs-title">generateCreateTable</span><span class="hljs-params">(out *os.File)</span> <span class="hljs-title">error</span></span> {<font></font>
	fmt.Fprint(out, <span class="hljs-string">"func (in *"</span>+tableD.StructName+<span class="hljs-string">") createTable(db *sql.DB) (error) {\n"</span>)
	<span class="hljs-keyword">var</span> resSQLq = fmt.Sprintf(<span class="hljs-string">"\tsqlQ := `CREATE TABLE %s (\n"</span>, tableD.TableName)
	<span class="hljs-keyword">for</span> _, col := <span class="hljs-keyword">range</span> tableD.Columns {<font></font>
		colSQL := col.ColName + <span class="hljs-string">" "</span> + col.ColType
		<span class="hljs-keyword">if</span> col.NotNull {<font></font>
			colSQL += <span class="hljs-string">" NOT NULL"</span><font></font>
		}<font></font>
		<span class="hljs-keyword">if</span> col == tableD.PrimaryKey {<font></font>
			colSQL += <span class="hljs-string">" AUTO_INCREMENT"</span><font></font>
		}<font></font>
		colSQL += <span class="hljs-string">",\n"</span><font></font>
		resSQLq += colSQL<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> tableD.PrimaryKey != <span class="hljs-literal">nil</span> {<font></font>
		resSQLq += fmt.Sprintf(<span class="hljs-string">"PRIMARY KEY (%s)\n"</span>, tableD.PrimaryKey.ColName)<font></font>
	}<font></font>
	resSQLq += <span class="hljs-string">")`\n"</span><font></font>
	fmt.Fprint(out, resSQLq)<font></font>
	fmt.Fprint(out, <span class="hljs-string">"\t_, err := db.Exec(sqlQ)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n"</span>)<font></font>
	fmt.Fprint(out, <span class="hljs-string">"\t return nil\n}\n\n"</span>)
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ </font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs"><font></font>
<font></font>
	fmt.Fprint(out, <span class="hljs-string">"func (in *"</span>+tableD.StructName+<span class="hljs-string">") Create(db *sql.DB) (error) {\n"</span>)
	<span class="hljs-keyword">var</span> columns, valuePlaces, valuesListParams <span class="hljs-keyword">string</span>
	<span class="hljs-keyword">for</span> _, col := <span class="hljs-keyword">range</span> tableD.Columns {
		<span class="hljs-keyword">if</span> col == tableD.PrimaryKey {
			<span class="hljs-keyword">continue</span><font></font>
		}<font></font>
		columns += <span class="hljs-string">"`"</span> + col.ColName + <span class="hljs-string">"`,"</span>
		valuePlaces += <span class="hljs-string">"?,"</span>
		valuesListParams += <span class="hljs-string">"in."</span> + col.FieldName + <span class="hljs-string">","</span><font></font>
	}<font></font>
	columns = columns[:<span class="hljs-built_in">len</span>(columns)<span class="hljs-number">-1</span>]<font></font>
	valuePlaces = valuePlaces[:<span class="hljs-built_in">len</span>(valuePlaces)<span class="hljs-number">-1</span>]<font></font>
	valuesListParams = valuesListParams[:<span class="hljs-built_in">len</span>(valuesListParams)<span class="hljs-number">-1</span>]<font></font>
<font></font>
	resSQLq := fmt.Sprintf(<span class="hljs-string">"\tsqlQ := \"INSERT INTO %s (%s) VALUES (%s);\"\n"</span>,<font></font>
		tableD.TableName,<font></font>
		columns,<font></font>
		valuePlaces)<font></font>
	fmt.Fprintln(out, resSQLq)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"result, err := db.Exec(sqlQ, %s)\n"</span>, valuesListParams)<font></font>
	fmt.Fprintln(out, <span class="hljs-string">`if err != nil {
		return err
	}`</span>)
	<span class="hljs-comment">//Setting id if we have primary key</span>
	<span class="hljs-keyword">if</span> tableD.PrimaryKey != <span class="hljs-literal">nil</span> {<font></font>
		fmt.Fprintf(out, <span class="hljs-string">`lastId, err := result.LastInsertId()
		if err != nil {
			return nil
		}`</span>)<font></font>
		fmt.Fprintf(out, <span class="hljs-string">"\nin.%s = %s(lastId)\n"</span>, tableD.PrimaryKey.FieldName, tableD.PrimaryKey.FieldType)<font></font>
	}<font></font>
	fmt.Fprintln(out, <span class="hljs-string">"return nil\n}\n\n"</span>)
	<span class="hljs-comment">//in., _ := result.LastInsertId()`)</span>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å–å¾—</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tableD *TableInfo)</span> <span class="hljs-title">generateQuery</span><span class="hljs-params">(out *os.File)</span> <span class="hljs-title">error</span></span> {<font></font>
	fmt.Fprint(out, <span class="hljs-string">"func (in *"</span>+tableD.StructName+<span class="hljs-string">") Query(db *sql.DB) ([]*"</span>+tableD.StructName+<span class="hljs-string">", error) {\n"</span>)<font></font>
<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"\tsqlQ := \"SELECT * FROM %s;\"\n"</span>, tableD.TableName)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"rows, err := db.Query(sqlQ)\n"</span>)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"results := make([]*%s, 0)\n"</span>, tableD.StructName)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">`for rows.Next() {`</span>)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"\t tempR := &amp;%s{}\n"</span>, tableD.StructName)
	<span class="hljs-keyword">var</span> valuesListParams <span class="hljs-keyword">string</span>
	<span class="hljs-keyword">for</span> _, col := <span class="hljs-keyword">range</span> tableD.Columns {<font></font>
		valuesListParams += <span class="hljs-string">"&amp;tempR."</span> + col.FieldName + <span class="hljs-string">","</span><font></font>
	}<font></font>
	valuesListParams = valuesListParams[:<span class="hljs-built_in">len</span>(valuesListParams)<span class="hljs-number">-1</span>]<font></font>
<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"\terr = rows.Scan(%s)\n"</span>, valuesListParams)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">`if err != nil {
		return nil, err
		}`</span>)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"\n\tresults = append(results, tempR)"</span>)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">`}
		return results, nil
	}`</span>)<font></font>
	fmt.Fprintln(out, <span class="hljs-string">""</span>)<font></font>
	fmt.Fprintln(out, <span class="hljs-string">""</span>)
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°ï¼ˆä¸»ã‚­ãƒ¼ã§æ©Ÿèƒ½ï¼‰</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tableD *TableInfo)</span> <span class="hljs-title">generateUpdate</span><span class="hljs-params">(out *os.File)</span> <span class="hljs-title">error</span></span> {<font></font>
	fmt.Fprint(out, <span class="hljs-string">"func (in *"</span>+tableD.StructName+<span class="hljs-string">") Update(db *sql.DB) (error) {\n"</span>)
	<span class="hljs-keyword">var</span> updVals, valuesListParams <span class="hljs-keyword">string</span>
	<span class="hljs-keyword">for</span> _, col := <span class="hljs-keyword">range</span> tableD.Columns {
		<span class="hljs-keyword">if</span> col == tableD.PrimaryKey {
			<span class="hljs-keyword">continue</span><font></font>
		}<font></font>
		updVals += <span class="hljs-string">"`"</span> + col.ColName + <span class="hljs-string">"`=?,"</span>
		valuesListParams += <span class="hljs-string">"in."</span> + col.FieldName + <span class="hljs-string">","</span><font></font>
	}<font></font>
	updVals = updVals[:<span class="hljs-built_in">len</span>(updVals)<span class="hljs-number">-1</span>]<font></font>
	valuesListParams += <span class="hljs-string">"in."</span> + tableD.PrimaryKey.FieldName<font></font>
<font></font>
	resSQLq := fmt.Sprintf(<span class="hljs-string">"\tsqlQ := \"UPDATE %s SET %s WHERE %s = ?;\"\n"</span>,<font></font>
		tableD.TableName,<font></font>
		updVals,<font></font>
		tableD.PrimaryKey.ColName)<font></font>
	fmt.Fprintln(out, resSQLq)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"_, err := db.Exec(sqlQ, %s)\n"</span>, valuesListParams)<font></font>
	fmt.Fprintln(out, <span class="hljs-string">`if err != nil {
		return err
	}`</span>)<font></font>
<font></font>
	fmt.Fprintln(out, <span class="hljs-string">"return nil\n}\n\n"</span>)
	<span class="hljs-comment">//in., _ := result.LastInsertId()`)</span>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ï¼ˆä¸»ã‚­ãƒ¼ã§æ©Ÿèƒ½ï¼‰</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(tableD *TableInfo)</span> <span class="hljs-title">generateDelete</span><span class="hljs-params">(out *os.File)</span> <span class="hljs-title">error</span></span> {<font></font>
	fmt.Fprint(out, <span class="hljs-string">"func (in *"</span>+tableD.StructName+<span class="hljs-string">") Delete(db *sql.DB) (error) {\n"</span>)<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"sqlQ := \"DELETE FROM %s WHERE id = ?\"\n"</span>, tableD.TableName)<font></font>
<font></font>
	fmt.Fprintf(out, <span class="hljs-string">"_, err := db.Exec(sqlQ, in.%s)\n"</span>, tableD.PrimaryKey.FieldName)<font></font>
<font></font>
	fmt.Fprintln(out, <span class="hljs-string">`if err != nil {
		return err
	}
	return nil
}`</span>)<font></font>
	fmt.Fprintln(out)<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çµæœã®ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã®é–‹å§‹ã¯ã€é€šå¸¸ã®go runã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹ã‚’-nameãƒ•ãƒ©ã‚°ã§æ¸¡ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã®çµæœã€ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã™ã‚‹_dbeã®ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒä»˜ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ†ã‚¹ãƒˆã®å ´åˆã€æ¬¡ã®æ§‹é€ ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="go hljs">
<span class="hljs-comment">// dbe:{"table": "users"}</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {<font></font>
	ID       <span class="hljs-keyword">int</span>    <span class="hljs-string">`dbe:"id,primary_key"`</span>
	Login    <span class="hljs-keyword">string</span> <span class="hljs-string">`dbe:"login,not_null"`</span>
	Email    <span class="hljs-keyword">string</span>
	Level    <span class="hljs-keyword">uint8</span>
	IsActive <span class="hljs-keyword">bool</span>
	UError   error <span class="hljs-string">`dbe:"-"`</span><font></font>
}<font></font>
</code></pre><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµæœã®ã‚³ãƒ¼ãƒ‰</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-keyword">package</span> main<font></font>
<font></font>
<span class="hljs-keyword">import</span> <span class="hljs-string">"database/sql"</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *User)</span> <span class="hljs-title">createTable</span><span class="hljs-params">(db *sql.DB)</span> <span class="hljs-title">error</span></span> {<font></font>
	sqlQ := <span class="hljs-string">`CREATE TABLE users (
	id integer NOT NULL AUTO_INCREMENT,
	login text NOT NULL,
	Email text,
	Level integer,
	IsActive boolean,
	PRIMARY KEY (id)
	)`</span><font></font>
	_, err := db.Exec(sqlQ)<font></font>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *User)</span> <span class="hljs-title">Create</span><span class="hljs-params">(db *sql.DB)</span> <span class="hljs-title">error</span></span> {<font></font>
	sqlQ := <span class="hljs-string">"INSERT INTO users (`login`,`Email`,`Level`,`IsActive`) VALUES (?,?,?,?);"</span><font></font>
<font></font>
	result, err := db.Exec(sqlQ, in.Login, in.Email, in.Level, in.IsActive)<font></font>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err<font></font>
	}<font></font>
	lastId, err := result.LastInsertId()<font></font>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
	}<font></font>
	in.ID = <span class="hljs-keyword">int</span>(lastId)
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *User)</span> <span class="hljs-title">Query</span><span class="hljs-params">(db *sql.DB)</span> <span class="hljs-params">([]*User, error)</span></span> {<font></font>
	sqlQ := <span class="hljs-string">"SELECT * FROM users;"</span><font></font>
	rows, err := db.Query(sqlQ)<font></font>
	results := <span class="hljs-built_in">make</span>([]*User, <span class="hljs-number">0</span>)
	<span class="hljs-keyword">for</span> rows.Next() {<font></font>
		tempR := &amp;User{}<font></font>
		err = rows.Scan(&amp;tempR.ID, &amp;tempR.Login, &amp;tempR.Email, &amp;tempR.Level, &amp;tempR.IsActive)<font></font>
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<font></font>
		}<font></font>
		results = <span class="hljs-built_in">append</span>(results, tempR)<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> results, <span class="hljs-literal">nil</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *User)</span> <span class="hljs-title">Update</span><span class="hljs-params">(db *sql.DB)</span> <span class="hljs-title">error</span></span> {<font></font>
	sqlQ := <span class="hljs-string">"UPDATE users SET `login`=?,`Email`=?,`Level`=?,`IsActive`=? WHERE id = ?;"</span><font></font>
<font></font>
	_, err := db.Exec(sqlQ, in.Login, in.Email, in.Level, in.IsActive, in.ID)<font></font>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(in *User)</span> <span class="hljs-title">Delete</span><span class="hljs-params">(db *sql.DB)</span> <span class="hljs-title">error</span></span> {<font></font>
	sqlQ := <span class="hljs-string">"DELETE FROM users WHERE id = ?"</span><font></font>
	_, err := db.Exec(sqlQ, in.ID)<font></font>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€ä»»æ„ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ãã®ãŸã‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã¾ã™ï¼‰ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«é…ç½®ã—ãŸã‚‰ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª­ã¿å–ã‚Šã€ãƒ¬ãƒ™ãƒ«å€¤ã‚’æ›´æ–°ã—ã¦ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çµæœã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™</font></font></b>
                        <div class="spoiler_text"><pre><code class="go hljs">
<span class="hljs-keyword">var</span> err error<font></font>
db, err := sql.Open(<span class="hljs-string">"mysql"</span>, DSN)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Unable to connect to DB"</span>, err)
	<span class="hljs-keyword">return</span><font></font>
}<font></font>
err = db.Ping()<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Unable to ping BD"</span>)
	<span class="hljs-keyword">return</span><font></font>
}<font></font>
newUser := &amp;User{<font></font>
	Login:    <span class="hljs-string">"newUser"</span>,<font></font>
	Email:    <span class="hljs-string">"new@test.com"</span>,<font></font>
	Level:    <span class="hljs-number">0</span>,<font></font>
	IsActive: <span class="hljs-literal">false</span>,<font></font>
	UError:   <span class="hljs-literal">nil</span>,<font></font>
}<font></font>
<font></font>
err = newUser.createTable(db)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Error creating table."</span>, err)<font></font>
<font></font>
}<font></font>
err = newUser.Create(db)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Error creating user."</span>, err)
	<span class="hljs-keyword">return</span><font></font>
}<font></font>
<font></font>
nU := &amp;User{}<font></font>
dbUsers, err := nU.Query(db)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Error selecting users."</span>, err)
	<span class="hljs-keyword">return</span><font></font>
}<font></font>
fmt.Printf(<span class="hljs-string">"From table users selected %d fields"</span>, <span class="hljs-built_in">len</span>(dbUsers))
<span class="hljs-keyword">var</span> DBUser *User
<span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> dbUsers {<font></font>
	fmt.Println(user)<font></font>
	DBUser = user<font></font>
}<font></font>
DBUser.Level = <span class="hljs-number">2</span><font></font>
err = DBUser.Update(db)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Error updating users."</span>, err)
	<span class="hljs-keyword">return</span><font></font>
}<font></font>
err = DBUser.Delete(db)<font></font>
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<font></font>
	fmt.Println(<span class="hljs-string">"Error deleting users."</span>, err)
	<span class="hljs-keyword">return</span><font></font>
}<font></font>
</code></pre><br>
</div>
                    </div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¾åœ¨ã®å®Ÿè£…ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ©Ÿèƒ½ã¯éå¸¸ã«åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQLã®ã¿ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECTã«ã¯ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚„åˆ¶é™ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãŸã ã—ã€ãƒã‚°ã®ä¿®æ­£ã¯ã€Goã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è§£æã¨ãã‚Œã«åŸºã¥ãæ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã®ç¯„å›²ã‚’ã™ã§ã«è¶…ãˆã¦ã„ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®ã‚ˆã†ãªã‚·ãƒŠãƒªã‚ªã§ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨æ§‹é€ ã®ã‚¿ã‚¤ãƒ—ã‚’1ã‹æ‰€ã§å¤‰æ›´ã§ãã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã‚„ã‚Šå–ã‚Šã™ã‚‹ãŸã‚ã«ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªã„ãŸã‚ã€æ¯å›ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§æ¸ˆã¿ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¿ã‚¹ã‚¯ã¯ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦è§£æ±ºã§ãã¾ã™ãŒã€ã“ã‚Œã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã„ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Githubã«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŠ•ç¨¿ã•ã‚ŒãŸç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®ä¾‹</font><font style="vertical-align: inherit;">ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja500986/index.html">ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã§ã®ç›£è¦–ï¼šå¤ã„BMSã‚’æ–°ã—ã„BMSã«ã©ã®ã‚ˆã†ã«å¤‰æ›´ã—ãŸã‹ã€‚ãƒ‘ãƒ¼ãƒˆ3</a></li>
<li><a href="../ja500992/index.html">æœ€é«˜ã®ITä¼æ¥­ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†ã¯ã©ã†ã§ã™ã‹</a></li>
<li><a href="../ja500994/index.html">ã‚¢ãƒªã‚’å®Ÿè¡Œã—ã¾ã™ã€‚èµ°ã‚‹</a></li>
<li><a href="../ja500996/index.html">6ã‹æœˆä»¥ä¸Šã§DevOpsã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ãªã‚‹æ–¹æ³• ãƒ‘ãƒ¼ãƒˆ1.ã¯ã˜ã‚ã«</a></li>
<li><a href="../ja500998/index.html">ç•³ã¿è¾¼ã¿ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨iOSã¸ã®çµ±åˆï¼ˆãƒ‘ãƒ¼ãƒˆ1ï¼‰</a></li>
<li><a href="../ja501002/index.html">Umkaï¼šæ–°ã—ã„é™çš„å‹ä»˜ãã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨€èª</a></li>
<li><a href="../ja501004/index.html">ã‚„ã‚Œã€‚ä½œæ¥­</a></li>
<li><a href="../ja501006/index.html">ç§ãŸã¡ã¯ã€STM32ã¨I2Cãƒã‚¹ä¸Šã®LCDãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤1604ï¼ˆHALãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚</a></li>
<li><a href="../ja501008/index.html">ãƒ‰ãƒŸãƒã®èˆ—è£…</a></li>
<li><a href="../ja501010/index.html">Linuxã‚«ãƒ¼ãƒãƒ«TLSãŠã‚ˆã³Nginx</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>