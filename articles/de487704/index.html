<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèΩ üî† üßú Wie wir auf der SSRS 2014 dynamische Berichte erstellt haben ü§±üèª üò° üå¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir haben bereits dar√ºber gesprochen, wie wir einem produzierenden Unternehmen geholfen haben, die Prozesse der Unternehmensschulung und Personalentwi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie wir auf der SSRS 2014 dynamische Berichte erstellt haben</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/487704/"><img src="https://habrastorage.org/webt/_q/hb/qb/_qhbqb8irkmfwui-lrqaktkhe8q.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bereits dar√ºber gesprochen,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie wir einem produzierenden Unternehmen geholfen haben, die Prozesse der Unternehmensschulung und Personalentwicklung zu transformieren. </font><font style="vertical-align: inherit;">Mitarbeiter des Kunden, die in Papierdokumenten und Excel-Tabellen ertranken, erhielten eine praktische iPad-Anwendung und ein Webportal. </font><font style="vertical-align: inherit;">Eine der wichtigsten Funktionen dieses Produkts ist die Erstellung dynamischer Berichte, anhand derer Manager die Arbeit der Mitarbeiter ‚Äûvor Ort‚Äú beurteilen. </font><font style="vertical-align: inherit;">Dies sind riesige Dokumente mit Dutzenden von Feldern und einer durchschnittlichen Gr√∂√üe von 3000 * 1600 Pixel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werden wir dar√ºber sprechen, wie diese Sch√∂nheit basierend auf Microsoft SQL Server Reporting Services bereitgestellt wird, warum ein solches Backend schlechte Freunde des Webportals sein kann und welche Tricks helfen, ihre Beziehung aufzubauen. </font><font style="vertical-align: inherit;">Der gesamte gesch√§ftliche Teil der L√∂sung wurde bereits im vorherigen Artikel beschrieben, daher konzentrieren wir uns hier auf technische Probleme. </font><font style="vertical-align: inherit;">Lass uns anfangen!</font></font><br>
<br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formulierung des Problems</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein Portal, mit dem mehrere hundert Benutzer arbeiten. </font><font style="vertical-align: inherit;">Sie sind in einer schrittweisen Hierarchie angeordnet, in der jeder Benutzer einen Supervisor mit einem h√∂heren Rang hat. </font><font style="vertical-align: inherit;">Diese Differenzierung der Rechte ist erforderlich, damit Benutzer Ereignisse mit untergeordneten Mitarbeitern erstellen k√∂nnen. </font><font style="vertical-align: inherit;">Sie k√∂nnen √ºber Stufen springen, d.h. </font><font style="vertical-align: inherit;">Der Benutzer kann die Aktivit√§t mit einem Mitarbeiter eines niedrigeren Ranges als sich selbst beginnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Welche Ereignisse sind hier gemeint? </font><font style="vertical-align: inherit;">Dies kann eine Schulung, Unterst√ºtzung oder Zertifizierung eines Mitarbeiters eines Handelsunternehmens sein, die der Vorgesetzte an einer Verkaufsstelle durchf√ºhrt. </font><font style="vertical-align: inherit;">Das Ergebnis einer solchen Veranstaltung ist ein Fragebogen, der auf einem iPad mit Mitarbeiterbewertungen f√ºr berufliche Qualit√§ten und F√§higkeiten ausgef√ºllt wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anhand der Fragebogendaten k√∂nnen Sie Statistiken erstellen, zum Beispiel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie viele Ereignisse mit seinen Untergebenen dieser Art hat Vasya Ivanov in einem Monat geschaffen? </font><font style="vertical-align: inherit;">Wie viele von ihnen sind abgeschlossen?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie hoch ist der Prozentsatz zufriedenstellender Bewertungen? </font><font style="vertical-align: inherit;">Welche Fragen beantworten Merchandiser am schlechtesten? </font><font style="vertical-align: inherit;">Welcher Manager kann schlechter Tests machen?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solche Statistiken sind in </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berichten enthalten</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die √ºber die Weboberfl√§che in den Formaten XLS, PDF, DOCX erstellt und gedruckt werden k√∂nnen. </font><font style="vertical-align: inherit;">Alle diese Funktionen sind f√ºr Manager auf verschiedenen Ebenen konzipiert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inhalt und Design der Berichte werden in den </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorlagen</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> definiert </font><font style="vertical-align: inherit;">, sodass Sie die erforderlichen Parameter festlegen k√∂nnen. </font><font style="vertical-align: inherit;">Wenn Benutzer in Zukunft neue Arten von Berichten ben√∂tigen, kann das System Vorlagen erstellen, ver√§nderbare Parameter angeben und dem Portal eine Vorlage hinzuf√ºgen. </font><font style="vertical-align: inherit;">All dies - ohne den Quellcode und die Arbeitsprozesse des Produkts zu beeintr√§chtigen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spezifikationen und Einschr√§nkungen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Portal l√§uft auf einer Microservice-Architektur, die Vorderseite ist in Angular 5 geschrieben. Die Ressource verwendet die JWT-Autorisierung und unterst√ºtzt die Browser Google Chrome, Firefox, Microsoft Edge und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IE 11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Daten werden auf MS SQL Server 2014 gespeichert. SQL Server Reporting Services (SSRS) ist auf dem Server installiert, der Kunde verwendet sie und wird sie nicht ablehnen. </font><font style="vertical-align: inherit;">Daher die wichtigste Einschr√§nkung: Der Zugriff auf SSRS ist von au√üen geschlossen, sodass Sie nur √ºber die NTLM-Autorisierung vom lokalen Netzwerk aus auf die Webschnittstelle und SOAP zugreifen k√∂nnen.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Worte zu SSRS</font></font></b><div class="spoiler_text"><b>SSRS </b>‚Äì    ,        ,     .     docs.microsoft.com,  SSRS        (API)    ( Report Server,  -    HTTP). <br>
</div></div><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achtung, die Frage: Wie kann die Aufgabe ohne manuelle Methoden, mit minimalen Ressourcen und maximalem Nutzen f√ºr den Kunden erledigt werden? </font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Kunde SSRS auf einem dedizierten Server hat, lassen Sie SSRS die ganze Drecksarbeit beim Generieren und Exportieren von Berichten erledigen. </font><font style="vertical-align: inherit;">Dann m√ºssen wir keinen eigenen Berichtsservice schreiben, Module in XLS, PDF, DOCX, HTML und die entsprechende API exportieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher bestand die Aufgabe darin, SSRS mit dem Portal anzufreunden und den Betrieb der in der Aufgabe angegebenen Funktionen sicherzustellen. </font><font style="vertical-align: inherit;">Lassen Sie uns also die Liste dieser Szenarien durchgehen - in fast jedem Punkt wurden interessante Feinheiten gefunden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√∂sungsstruktur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir bereits √ºber SSRS verf√ºgen, gibt es alle Tools zum Verwalten von Berichtsvorlagen: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berichtsserver - verantwortlich f√ºr die gesamte Logik der Arbeit mit Berichten, deren Speicherung, Generierung, Verwaltung und vielem mehr.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berichts-Manager - ein Dienst mit einer Weboberfl√§che zum Verwalten von Berichten. </font><font style="vertical-align: inherit;">Hier k√∂nnen Sie in SQL Server Data Tools erstellte Vorlagen auf den Server hochladen, Zugriffsrechte, Datenquellen und Parameter konfigurieren (einschlie√ülich solcher, die beim Melden von Anforderungen ge√§ndert werden k√∂nnen). </font><font style="vertical-align: inherit;">Er kann Berichte zu heruntergeladenen Vorlagen erstellen und diese in verschiedene Formate hochladen, darunter XLS, PDF, DOCX und HTML.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Insgesamt:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir erstellen Vorlagen in SQL Server-Datentools. Mit Hilfe des Berichts-Managers f√ºllen wir sie auf dem Berichtsserver aus, konfigurieren sie - und sie ist fertig. </font><font style="vertical-align: inherit;">Wir k√∂nnen Berichte erstellen und deren Parameter √§ndern. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die n√§chste Frage: Wie kann die Erstellung von Berichten zu bestimmten Vorlagen √ºber das Portal angefordert und das Ergebnis zur Ausgabe an die Benutzeroberfl√§che oder zum Herunterladen im gew√ºnschten Format nach vorne gebracht werden?</font></font></i></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berichterstattung von SSRS an das Portal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erw√§hnt, verf√ºgt SSRS √ºber eine eigene API f√ºr den Zugriff auf Berichte. Wir wollen seine Funktionen jedoch nicht aus Sicherheits- und digitalen Hygienegr√ºnden herausgeben - wir m√ºssen nur Daten von SSRS in der richtigen Form anfordern und das Ergebnis an den Benutzer √ºbermitteln. Die Berichtsverwaltung wird von speziell geschultem Kundenpersonal durchgef√ºhrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da der Zugriff auf SSRS nur √ºber das lokale Netzwerk erfolgt, erfolgt der Datenaustausch zwischen dem Server und dem Portal √ºber einen Proxy-Dienst. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/kz/f5/9x/kzf59xp7_ltztohtag_orirmn5i.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenaustausch zwischen dem Portal und dem Server Mal</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
sehen, wie es funktioniert und warum ReportProxy hier ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Portalseite haben wir also einen ReportService, auf den das Portal f√ºr Berichte zugreift. Der Dienst pr√ºft die Berechtigung des Nutzers, die H√∂he seiner Rechte, konvertiert Daten von SSRS in die gew√ºnschte Form im Rahmen des Vertrages.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ReportService-API enth√§lt nur zwei Methoden, die f√ºr uns v√∂llig ausreichend sind:</font></font><br>
<br>
<ol>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetReports</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">Gibt</font></i><font style="vertical-align: inherit;"> die Kennungen und Namen aller Vorlagen an, die der aktuelle Benutzer erhalten kann.</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetReportData (Format, Parameter)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - liefert vorgefertigte, exportierte Berichtsdaten im angegebenen Format mit einem bestimmten Parametersatz.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ben√∂tigen Sie diese beiden Methoden, um mit SSRS kommunizieren und die erforderlichen Daten in der richtigen Form daraus entnehmen zu k√∂nnen. </font><font style="vertical-align: inherit;">Aus der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dokumentation ist bekannt,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dass wir √ºber die SOAP-API √ºber HTTP auf den Berichtsserver zugreifen k√∂nnen. </font><font style="vertical-align: inherit;">Es scheint, dass sich das R√§tsel entwickelt ... Aber tats√§chlich erwartet uns hier eine √úberraschung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da SSRS f√ºr die Au√üenwelt geschlossen ist und Sie es nur √ºber die NTLM-Authentifizierung erreichen k√∂nnen, ist es nicht direkt √ºber das SOAP-Portal verf√ºgbar. </font><font style="vertical-align: inherit;">Es gibt auch unsere eigenen W√ºnsche:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geben Sie nur Zugriff auf die erforderlichen Funktionen und verbieten Sie die √Ñnderung sogar.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie zu einem anderen Berichtssystem wechseln m√ºssen, sollten die √Ñnderungen im ReportService minimal sein und besser gar nicht erforderlich sein.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier hilft uns ReportProxy, das sich auf demselben Computer wie SSRS befindet und f√ºr die Weiterleitung von Anforderungen von ReportService an SSRS verantwortlich ist. </font><font style="vertical-align: inherit;">Die Anforderungsverarbeitung ist wie folgt:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Dienst erh√§lt eine Anforderung von ReportService und √ºberpr√ºft die JWT-Autorisierung.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In √úbereinstimmung mit der API-Methode durchl√§uft der Proxy das SOAP-Protokoll in SSRS f√ºr die erforderlichen Daten und meldet sich dabei √ºber NTLM an.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Von SSRS empfangene Daten werden als Antwort auf die Anforderung an ReportService zur√ºckgesendet.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tats√§chlich ist ReportProxy ein Adapter zwischen SSRS und ReportService. </font></font><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Steuerung ist wie folgt:</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">[BasicAuthentication]<font></font>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReportProxyController</span> : <span class="hljs-title">ApiController</span>
</span>{<font></font>
    [HttpGet()]<font></font>
    public List&lt;ReportItem&gt; Get(string rootPath)<font></font>
    {<font></font>
        <span class="hljs-comment">//  ...</span><font></font>
    }<font></font>
<font></font>
    public HttpResponseMessage Post([FromBody]ReportRequest request)<font></font>
    {<font></font>
        <span class="hljs-comment">//  ...</span><font></font>
    }<font></font>
}<font></font>
</code></pre><br>
  BasicAuthentication   :<br>
<br>
<pre><code class="javascript hljs">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAuthenticationAttribute</span> : <span class="hljs-title">AuthorizationFilterAttribute</span>
</span>{<font></font>
    public override <span class="hljs-keyword">void</span> OnAuthorization(HttpActionContext actionContext)<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> authHeader = actionContext.Request.Headers.Authorization;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (authHeader != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> authenticationToken = actionContext.Request.Headers.Authorization.Parameter;
            <span class="hljs-keyword">var</span> tokenFromBase64 = Convert.FromBase64String(authenticationToken);
            <span class="hljs-keyword">var</span> decodedAuthenticationToken = Encoding.UTF8.GetString(tokenFromBase64);
            <span class="hljs-keyword">var</span> usernamePasswordArray = decodedAuthenticationToken.Split(<span class="hljs-string">':'</span>);
            <span class="hljs-keyword">var</span> userName = usernamePasswordArray[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> password = usernamePasswordArray[<span class="hljs-number">1</span>];<font></font>
<font></font>
            <span class="hljs-keyword">var</span> isValid = userName == BasiAuthConf.Login &amp;&amp; password == BasiAuthConf.Password;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (isValid)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> principal = <span class="hljs-keyword">new</span> GenericPrincipal(<span class="hljs-keyword">new</span> GenericIdentity(userName), <span class="hljs-literal">null</span>);<font></font>
                Thread.CurrentPrincipal = principal;<font></font>
<font></font>
                <span class="hljs-keyword">return</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        HandleUnathorized(actionContext);<font></font>
    }<font></font>
<font></font>
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> HandleUnathorized(HttpActionContext actionContext)<font></font>
    {<font></font>
        actionContext.Response = actionContext.Request.CreateResponse(<font></font>
            HttpStatusCode.Unauthorized<font></font>
        );<font></font>
<font></font>
        actionContext.Response.Headers.Add(<font></font>
            <span class="hljs-string">"WWW-Authenticate"</span>, <span class="hljs-string">"Basic Scheme='Data' location = 'http://localhost:"</span><font></font>
        );<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen sieht der Prozess folgenderma√üen aus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Front sendet eine http-Anfrage an ReportService.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportService sendet eine http-Anfrage an ReportProxy.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportProxy empf√§ngt √ºber die SOAP-Schnittstelle Daten von SSRS und sendet das Ergebnis an ReportService.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportService bringt das Ergebnis vertragsgem√§√ü und gibt es an den Kunden weiter.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein funktionierendes System, das eine Liste der verf√ºgbaren Vorlagen anfordert, Berichte an SSRS sendet und sie in allen unterst√ºtzten Formaten an die Front weiterleitet. </font><font style="vertical-align: inherit;">Jetzt m√ºssen Sie die generierten Berichte gem√§√ü den angegebenen Parametern auf der Vorderseite anzeigen, die M√∂glichkeit geben, sie in XLS-, PDF-, DOCX-Dateien hochzuladen und zu drucken. </font><font style="vertical-align: inherit;">Beginnen wir mit der Anzeige.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeiten mit SSRS-Berichten im Portal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf den ersten Blick ist das eine allt√§gliche Angelegenheit - der Bericht ist im HTML-Format erh√§ltlich, sodass wir damit machen k√∂nnen, was wir wollen! </font><font style="vertical-align: inherit;">Wir werden es in die Seite einbetten, es mit Designstilen t√∂nen und das Ding ist im Hut. </font><font style="vertical-align: inherit;">Tats√§chlich stellte sich heraus, dass es gen√ºgend Fallstricke gab. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gem√§√ü dem Entwurfskonzept sollte der Abschnitt der Berichte auf dem Portal aus zwei Seiten bestehen: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) einer Liste von Vorlagen, wo wir k√∂nnen:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anzeigen von Statistiken zu Aktivit√§ten f√ºr das gesamte Portal;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle uns zur Verf√ºgung stehenden Vorlagen anzeigen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klicken Sie auf die gew√ºnschte Vorlage und gehen Sie zum entsprechenden Berichtsgenerator.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/yx/tp/1h/yxtp1h3tvvpujymptptca2gcyew.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) ein Berichtsgenerator, mit dem wir:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legen Sie Vorlagenparameter fest und erstellen Sie einen Bericht dar√ºber.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sehen Sie sich an, was als Ergebnis passiert ist.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hlen Sie das Ausgabedateiformat aus und laden Sie es herunter.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drucken Sie den Bericht in einer praktischen und visuellen Form.</font></font></li>
</ul><br>
 <img src="https://habrastorage.org/webt/au/ct/2f/auct2fiklpvvfad6vpbovv0xat0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab keine besonderen Probleme mit der ersten Seite, daher werden wir nicht weiter darauf eingehen. </font><font style="vertical-align: inherit;">Und der Berichtsgenerator zwang uns, den Ingenieur einzuschalten, damit echte Menschen alle Funktionen von TK bequem nutzen k√∂nnen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problem Nummer 1. </font><font style="vertical-align: inherit;">Riesentische</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entsprechend dem Designkonzept sollte diese Seite einen Anzeigebereich haben, damit der Benutzer seinen Bericht vor dem Export sehen kann. Wenn der Bericht nicht in das Fenster passt, k√∂nnen Sie horizontal und vertikal scrollen. Gleichzeitig kann ein typischer Bericht die Gr√∂√üe mehrerer Bildschirme erreichen, was bedeutet, dass Bl√∂cke mit den Namen von Zeilen und Spalten geklebt werden m√ºssen. Ohne dies m√ºssen Benutzer st√§ndig an den Anfang der Tabelle zur√ºckkehren, um sich zu merken, was eine bestimmte Zelle bedeutet. Im Allgemeinen ist es einfacher, einen Bericht auszudrucken und st√§ndig die erforderlichen Bl√§tter vor den Augen zu halten, aber dann verliert die Tabelle auf dem Bildschirm einfach ihre Bedeutung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen k√∂nnen Klebebl√∂cke nicht vermieden werden. Und SSRS 2014 kann keine Zeilen und Spalten in einem MHTML-Dokument reparieren - nur in seiner eigenen Weboberfl√§che.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier erinnern wir uns, dass moderne Browser die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSS-Sticky-Eigenschaft unterst√ºtzen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , die nur die Funktion bietet, die wir ben√∂tigen. Wir setzen die Position: klebrig auf den markierten Block, geben den Einzug links oder oben an (links, oben), und der Block bleibt w√§hrend des horizontalen und vertikalen Bildlaufs an Ort und Stelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie m√ºssen einen Parameter finden, den CSS abrufen kann. Benutzerdefinierte Zellenwerte, mit denen SSRS 2014 sie in der Weboberfl√§che erfassen kann, gehen beim Export in HTML verloren. OK, wir werden sie selbst markieren - wir w√ºrden nur verstehen, wie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach mehreren Stunden Lesen der Dokumentation und Diskussionen mit Kollegen schien es keine Optionen zu geben. Und hier wurde nach allen Gesetzen des Diagramms das ToolTip-Feld f√ºr uns angezeigt, mit dem wir Tooltips f√ºr Zellen angeben k√∂nnen. Es stellte sich heraus, dass es in den exportierten HTML-Code im Tooltip-Attribut geworfen wird - genau auf dem Tag, das zur benutzerdefinierten Zelle in SQL Server Data Tools geh√∂rt. Es gab keine Wahl - wir haben keinen anderen Weg gefunden, um Zellen f√ºr die Fixierung zu markieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie m√ºssen also Markierungsregeln erstellen und Markierungen in HTML √ºber ToolTip weiterleiten. Anschlie√üend √§ndern wir mit JS das Tooltip-Attribut an der angegebenen Markierung in die CSS-Klasse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt nur zwei M√∂glichkeiten, Zellen zu fixieren: vertikal (feste Spalte) und horizontal (feste Zeile). </font><font style="vertical-align: inherit;">Es ist sinnvoll, einen weiteren Marker auf die Eckzellen zu setzen, die beim Scrollen in beide Richtungen an Ort und Stelle bleiben - fest-beide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der n√§chste Schritt ist die Benutzeroberfl√§che. </font><font style="vertical-align: inherit;">Wenn Sie ein HTML-Dokument erhalten, m√ºssen Sie alle HTML-Elemente mit Markierungen finden, die Werte erkennen, die entsprechende CSS-Klasse festlegen und das Tooltip-Attribut entfernen, damit es beim Bewegen des Mauszeigers nicht angezeigt wird. </font><font style="vertical-align: inherit;">Es ist zu beachten, dass das resultierende Markup aus verschachtelten Tabellen (Tabellen-Tags) besteht.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code anzeigen</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">type FixationType = <span class="hljs-string">'row'</span> | <span class="hljs-string">'column'</span> | <span class="hljs-string">'both'</span>;<font></font>
<font></font>
init(reportHTML: HTMLElement) {<font></font>
    <span class="hljs-comment">//    </span><font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">const</span> rowsFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="RowFixed"]'</span>);
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">const</span> columnFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="ColumnFixed"]'</span>);
    <span class="hljs-comment">// -    </span>
    <span class="hljs-keyword">const</span> bothFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="BothFixed"]'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.prepare(rowsFixed, <span class="hljs-string">'row'</span>);
    <span class="hljs-keyword">this</span>.prepare(columnFixed, <span class="hljs-string">'column'</span>);
    <span class="hljs-keyword">this</span>.prepare(bothFixed, <span class="hljs-string">'both'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
prepare(nodeList: NodeList, <span class="hljs-attr">fixingType</span>: FixationType) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; nodeList.length; i++) {
        <span class="hljs-keyword">const</span> element: HTMLElement = nodeList[i];
        <span class="hljs-comment">//   -</span>
        element.classList.add(fixingType + <span class="hljs-string">'-fixed'</span>);<font></font>
<font></font>
        element.removeAttribute(<span class="hljs-string">'title'</span>);<font></font>
        element.removeAttribute(<span class="hljs-string">'alt'</span>); <span class="hljs-comment">//   SSRS</span><font></font>
<font></font>
        element.parentElement.classList.add(fixingType  + <span class="hljs-string">'-fixed-parent'</span>);<font></font>
<font></font>
        <span class="hljs-comment">//     ,     </span>
        element.style.width = element.getBoundingClientRect().width  + <span class="hljs-string">'px'</span>;
        <span class="hljs-comment">//     ,     </span>
        element.style.height = element.getBoundingClientRect().height  + <span class="hljs-string">'px'</span>;<font></font>
<font></font>
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">this</span>.calculateCellCascadeParams(element, fixingType);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier ist ein neues Problem: Wenn beim Kaskadenverhalten mehrere Bl√∂cke, die sich in eine Richtung bewegen, gleichzeitig in der Tabelle fixiert sind, werden die nacheinander verlaufenden Zellen geschichtet. </font><font style="vertical-align: inherit;">Gleichzeitig ist nicht klar, wie viel sich jeder n√§chste Block zur√ºckziehen soll - die Einr√ºckungen m√ºssen √ºber JavaScript basierend auf der H√∂he des Blocks davor berechnet werden. </font><font style="vertical-align: inherit;">All dies gilt sowohl f√ºr vertikale als auch f√ºr horizontale Anker.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Korrektur-Skript hat das Problem gel√∂st.</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-comment">//      </span>
calculateCellCascadeParams(cell: HTMLElement, <span class="hljs-attr">fixationType</span>: FixationType) {
    <span class="hljs-keyword">const</span> currentTD: HTMLTableCellElement = cell.parentElement;
    <span class="hljs-keyword">const</span> currentCellIndex = currentTD.cellIndex;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    currentTD.style.left = <span class="hljs-string">''</span>;<font></font>
    currentTD.style.top = <span class="hljs-string">''</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> currentTDStyles = getComputedStyle(currentTD);<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (fixationType === <span class="hljs-string">'row'</span> || fixationType === <span class="hljs-string">'both'</span>) {
        <span class="hljs-keyword">const</span> parentRow: HTMLTableRowElement = currentTD.parentElement;<font></font>
<font></font>
        <span class="hljs-comment">//        </span>
        <span class="hljs-comment">//    .</span>
        <span class="hljs-comment">//   ,    .</span>
        <span class="hljs-keyword">let</span> previousRow: HTMLTableRowElement = parentRow;
        <span class="hljs-keyword">let</span> topOffset = <span class="hljs-number">0</span>;<font></font>
<font></font>
        <span class="hljs-keyword">while</span> (previousRow = previousRow.previousElementSibling) {
            <span class="hljs-keyword">let</span> previousCellIndex = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">let</span> cellIndexBulk = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; previousRow.cells.length; i++) {
                <span class="hljs-keyword">if</span> (previousRow.cells[i].colSpan &gt; <span class="hljs-number">1</span>) {<font></font>
                    cellIndexBulk += previousRow.cells[i].colSpan;<font></font>
                } <span class="hljs-keyword">else</span> {<font></font>
                    cellIndexBulk += <span class="hljs-number">1</span>;<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((cellIndexBulk - <span class="hljs-number">1</span>) &gt;= currentCellIndex) {<font></font>
                    previousCellIndex = i;<font></font>
                    <span class="hljs-keyword">break</span>;<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">const</span> previousCell = previousRow.cells[previousCellIndex];<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (previousCell.classList.contains(fixationType + <span class="hljs-string">'_fixed_parent'</span>)) {<font></font>
                topOffset += previousCell.getBoundingClientRect().height;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (topOffset &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (currentTDStyles.top) {<font></font>
                topOffset += &lt;any&gt;currentTDStyles.top.replace('px', '') - 0;<font></font>
            }<font></font>
<font></font>
            currentTD.style.top = topOffset + 'px';<font></font>
        }<font></font>
    }<font></font>
<font></font>
    //  <font></font>
    if (fixationType === 'column' || fixationType === 'both') {<font></font>
        //       <font></font>
        //     .<font></font>
        //   ,    .<font></font>
        let previousCell: HTMLTableCellElement = currentTD;<font></font>
        let leftOffset = 0;<font></font>
<font></font>
        while (previousCell = previousCell.previousElementSibling) {<font></font>
            if (previousCell.classList.contains(fixationType + '_fixed_parent')) {<font></font>
                leftOffset += previousCell.getBoundingClientRect().width;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        if (leftOffset &gt; 0) {<font></font>
            if (currentTDStyles.left) {<font></font>
                leftOffset += &lt;any&gt;currentTDStyles.left.replace('px', '') - 0;<font></font>
            }<font></font>
<font></font>
            currentTD.style.left = leftOffset + 'px';<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code √ºberpr√ºft die Tags markierter Elemente und f√ºgt die Parameter der festen Zellen zum Einr√ºckungswert hinzu. </font><font style="vertical-align: inherit;">Bei anhaftenden Zeilen wird ihre H√∂he f√ºr Spalten ihre Breite addiert. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/vj/ix/bf/vjixbfnbewh6_pb3smfcogdpevc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Beispiel f√ºr einen Bericht mit einer klebrigen oberen Zeile.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Daher sieht der Prozess folgenderma√üen aus:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erhalten das Markup von SSRS und f√ºgen es an der richtigen Stelle im DOM ein.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marker erkennen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passen Sie die Parameter f√ºr das Kaskadenverhalten an.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da das Haftverhalten vollst√§ndig √ºber CSS implementiert wird und JS nur an der Vorbereitung des eingehenden Dokuments beteiligt ist, funktioniert die L√∂sung schnell genug und ohne Verz√∂gerungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leider mussten f√ºr IE IE-Bl√∂cke deaktiviert werden, weil </font><font style="vertical-align: inherit;">es unterst√ºtzt nicht die Position: klebrige Eigenschaft. </font><font style="vertical-align: inherit;">Der Rest - Safari, Mozilla Firefox und Chrome - leistet hervorragende Arbeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mach weiter.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problem Nummer 2. </font><font style="vertical-align: inherit;">Bericht exportieren</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Bericht aus dem System zu ziehen, m√ºssen Sie (1) √ºber ReportService f√ºr ein Blob-Objekt auf das SSRS zugreifen, (2) √ºber die Schnittstelle mithilfe der window.URL.createObjectURL-Methode einen Link zum Objekt erhalten, (3) den Link in das Tag einf√ºgen und einen Klick f√ºr simulieren Datei-Upload. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies funktioniert in Firefox, Safari und in allen Versionen von Chrome au√üer Apple. Damit IE, Edge und Chrome f√ºr iOS die Funktion ebenfalls unterst√ºtzten, musste ich mein Gehirn zur√ºckwerfen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In IE und Edge l√∂st das Ereignis einfach keine Browseranforderung zum Herunterladen der Datei aus. Diese Browser verf√ºgen √ºber eine solche Funktion, dass zur Simulation eines Klicks eine Best√§tigung des Benutzers zum Herunterladen sowie eine eindeutige Angabe weiterer Aktionen erforderlich ist. Die L√∂sung wurde in der window.navigator.msSaveOrOpenBlob () -Methode gefunden, die sowohl im IE als auch in Edge verf√ºgbar ist. Er wei√ü nur, wie er den Benutzer um Erlaubnis f√ºr den Vorgang bitten und kl√§ren kann, was als n√§chstes zu tun ist. Wir bestimmen also, ob die window.navigator.msSaveOrOpenBlob-Methode vorhanden ist, und reagieren auf die Situation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome unter iOS hatte keinen solchen Hack und anstelle eines Berichts wurde nur eine leere Seite angezeigt. </font><font style="vertical-align: inherit;">Beim Durchst√∂bern des Webs fanden wir eine √§hnliche Geschichte, nach der in iOS 13 dieser Fehler h√§tte behoben werden m√ºssen. </font><font style="vertical-align: inherit;">Leider haben wir die Anwendung bereits in den Tagen von iOS 12 geschrieben, sodass wir uns am Ende entschieden haben, keine Zeit mehr zu verschwenden, und einfach die Schaltfl√§che in Chrome f√ºr iOS deaktiviert haben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun dazu, wie der endg√ºltige Exportprozess in die Benutzeroberfl√§che aussieht. </font><font style="vertical-align: inherit;">In der Angular-Berichtskomponente befindet sich eine Schaltfl√§che, mit der eine Reihe von Schritten gestartet wird:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber die Parameter des Ereignisses erh√§lt der Handler die Kennung des Exportformats (z. B. "PDF").</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sendet eine Anforderung an ReportService, um ein Blob-Objekt f√ºr das angegebene Format zu erhalten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√ºft, ob der Browser IE oder Edge ist;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Antwort von ReportService kommt:</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn es sich um IE oder Edge handelt, wird window.navigator.msSaveOrOpenBlob (fileStream, fileName) aufgerufen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andernfalls wird die Methode this.exportDownload (fileStream, fileName) aufgerufen, wobei fileStream der Blob ist, der aus der Anforderung an ReportService erhalten wurde, und fileName der Name der zu speichernden Datei ist. </font><font style="vertical-align: inherit;">Die Methode erstellt ein verstecktes Tag mit einem Link zu window.URL.createObjectURL (fileStream), simuliert einen Klick und entfernt das Tag.</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem dies gekl√§rt war, blieb das letzte Abenteuer bestehen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problem Nummer 3. </font><font style="vertical-align: inherit;">Ausdrucken</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen wir den Bericht auf dem Portal sehen und in die Formate XLS, PDF und DOCX exportieren. </font><font style="vertical-align: inherit;">Der Druck des Dokuments muss noch implementiert werden, um einen genauen mehrseitigen Bericht zu erhalten. </font><font style="vertical-align: inherit;">Wenn sich herausstellte, dass die Tabelle in Seiten unterteilt war, sollte jede von ihnen √úberschriften enthalten - dieselben klebrigen Bl√∂cke, √ºber die wir im vorletzten Abschnitt gesprochen haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am einfachsten ist es, die aktuelle Seite mit dem angezeigten Bericht zu √ºbernehmen, alles √úberfl√ºssige mit CSS auszublenden und mit der Methode window.print () zum Drucken zu senden. </font><font style="vertical-align: inherit;">Diese Methode funktioniert aus mehreren Gr√ºnden nicht sofort:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht standardm√§√üiger Anzeigebereich - Der Bericht selbst befindet sich in einem separat scrollbaren Bereich, sodass sich die Seite nicht auf unglaubliche horizontale Abmessungen erstreckt. </font><font style="vertical-align: inherit;">Durch die Verwendung von window.print () werden Inhalte abgeschnitten, die nicht auf den Bildschirm passen.</font></font></li>
<li>   ,      ;</li>
<li>     ,       .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All dies kann mit JS und CSS behoben werden. Wir haben uns jedoch entschlossen, Entwicklern Zeit zu sparen und nach einer Alternative zu window.print () zu suchen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SSRS kann uns sofort ein fertiges PDF mit einer vorzeigbaren Paginierung geben. Dies erspart uns alle Schwierigkeiten der vorherigen Version. Die einzige Frage ist, ob wir das PDF √ºber einen Browser drucken k√∂nnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da PDF ein Standard von Drittanbietern ist, unterst√ºtzen ihn Browser √ºber verschiedene Viewer-Plugins. Kein Plug-In - keine Cartoons, also brauchen wir wieder eine alternative Option. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wenn Sie das PDF als Bild auf die Seite legen und diese Seite zum Drucken senden? Es gibt bereits Bibliotheken und Komponenten f√ºr Angular, die ein solches Rendering bereitstellen. Gesucht, experimentiert, implementiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um nicht mit den Daten umzugehen, die wir nicht drucken m√∂chten, wurde beschlossen, den gerenderten Inhalt auf eine neue Seite zu √ºbertragen und dort bereits window.print () auszuf√ºhren. </font><font style="vertical-align: inherit;">Infolgedessen ist der gesamte Prozess wie folgt:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fordern Sie ReportService an, den Bericht im PDF-Format zu exportieren.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erhalten das Blob-Objekt, konvertieren es in eine URL (URL.createObjectURL (fileStream)) und geben die URL dem PDF-Viewer zum Rendern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir nehmen Bilder aus dem PDF-Viewer auf.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie eine neue Seite und f√ºgen Sie dort ein kleines Markup hinzu (Titel, ein kleiner Einzug).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie das Bild aus dem PDF-Viewer zum Markup hinzu und rufen Sie window.print () auf.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach mehreren √úberpr√ºfungen wurde auch ein JS-Code auf der Seite angezeigt, der vor dem Drucken √ºberpr√ºft, ob alle Bilder geladen wurden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somit wird das gesamte Erscheinungsbild des Dokuments durch die Parameter der SSRS-Vorlage bestimmt, und die Benutzeroberfl√§che st√∂rt diesen Prozess nicht. </font><font style="vertical-align: inherit;">Dies reduziert die Anzahl m√∂glicher Fehler. </font><font style="vertical-align: inherit;">Da Bilder zum Drucken √ºbertragen werden, sind wir gegen Besch√§digungen oder Verformungen des Layouts versichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch Nachteile:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein umfangreicher Bericht wird viel wiegen, was sich nachteilig auf mobile Plattformen auswirken wird.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Design wird nicht automatisch aktualisiert. Farben, Schriftarten und andere Designelemente m√ºssen auf Vorlagenebene installiert werden.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserem Fall wurde das h√§ufige Hinzuf√ºgen neuer Vorlagen nicht erwartet, sodass die L√∂sung akzeptabel war. </font><font style="vertical-align: inherit;">Mobile Leistung ist selbstverst√§ndlich.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das letzte Wort</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So l√§sst uns ein regul√§res Projekt erneut nach einfachen L√∂sungen f√ºr nicht triviale Aufgaben suchen. </font><font style="vertical-align: inherit;">Das Endprodukt erf√ºllt die Designanforderungen vollst√§ndig und sieht wundersch√∂n aus. </font><font style="vertical-align: inherit;">Und was am wichtigsten ist: Obwohl wir nicht nach den offensichtlichsten Implementierungsmethoden suchen mussten, wurde die Aufgabe schneller erledigt, als wenn wir das urspr√ºngliche Berichtsmodul mit allen Konsequenzen √ºbernommen h√§tten. </font><font style="vertical-align: inherit;">Am Ende konnten wir uns auf die Gesch√§ftsziele des Projekts konzentrieren.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de487690/index.html">PHP Digest Nr. 173 (27. Januar - 10. Februar 2020)</a></li>
<li><a href="../de487694/index.html">Wie Yandex.Cloud von Virtual Private Cloud gehostet wird und wie unsere Benutzer uns bei der Implementierung n√ºtzlicher Funktionen helfen</a></li>
<li><a href="../de487696/index.html">Digitale Veranstaltungen in Moskau vom 10. bis 16. Februar</a></li>
<li><a href="../de487698/index.html">Digitale Veranstaltungen in St. Petersburg vom 10. bis 16. Februar</a></li>
<li><a href="../de487702/index.html">Eine Auswahl von Artikeln zum maschinellen Lernen: Fallstudien, Leitf√§den und Forschungsergebnisse f√ºr Januar 2020</a></li>
<li><a href="../de487706/index.html">Service Discovery in verteilten Systemen anhand des Consul-Beispiels. Alexander Sigachev</a></li>
<li><a href="../de487716/index.html">Perfekt SAST. Parser</a></li>
<li><a href="../de487720/index.html">Zum Wettbewerbskorutinismus (am Beispiel der reaktiven Programmierung)</a></li>
<li><a href="../de487724/index.html">BlazingPizza: Blazor App von Anfang bis Ende. Teil 2. F√ºgen Sie eine Komponente hinzu</a></li>
<li><a href="../de487728/index.html">@ Pythonetc-Zusammenstellung, Januar 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>