<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•Šï¸ ğŸ’ª âš™ï¸ ClickHouse for Advanced Users in Questions and Answers â– ğŸ¤³ ğŸ‘¨â€ğŸ”§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="4æœˆï¼ŒAvitoå·¥ç¨‹å¸ˆä¸ClickHouseé¦–å¸­å¼€å‘äººå‘˜Alexei Milovidovå’ŒIntegrosçš„Golangå¼€å‘äººå‘˜Kirill Shvakovè¿›è¡Œäº†åœ¨çº¿èšä¼šã€‚ä»–ä»¬è®¨è®ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä»¥åŠæˆ‘ä»¬é‡åˆ°çš„å›°éš¾ã€‚
 

åœ¨è¿™æ¬¡ä¼šè®®çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ”¶é›†äº†ä¸€ç¯‡æ–‡ç« ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³å¤‡ä»½å’Œæ•°æ®é‡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ClickHouse for Advanced Users in Questions and Answers</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/500678/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4æœˆï¼ŒAvitoå·¥ç¨‹å¸ˆä¸ClickHouseé¦–å¸­å¼€å‘äººå‘˜Alexei Milovidovå’ŒIntegrosçš„Golangå¼€å‘äººå‘˜Kirill Shvakovè¿›è¡Œäº†åœ¨çº¿èšä¼šã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬è®¨è®ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä»¥åŠæˆ‘ä»¬é‡åˆ°çš„å›°éš¾ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨è¿™æ¬¡ä¼šè®®çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ”¶é›†äº†ä¸€ç¯‡æ–‡ç« ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³å¤‡ä»½å’Œæ•°æ®é‡æ–°åˆ†ç‰‡ï¼Œå¤–éƒ¨è¯å…¸ï¼ŒGolangé©±åŠ¨ç¨‹åºå’ŒClickHouseç‰ˆæœ¬æ›´æ–°çš„é—®é¢˜å’Œæœ‰å…³é—®é¢˜çš„ä¸“å®¶è§£ç­”ã€‚</font><font style="vertical-align: inherit;">å¯¹äºå·²ç»ç§¯æä½¿ç”¨Yandex DBMSå¹¶å¯¹å®ƒçš„ç°åœ¨å’Œæœªæ¥æ„Ÿå…´è¶£çš„å¼€å‘äººå‘˜ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚</font><font style="vertical-align: inherit;">é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™é»˜è®¤ç­”æ¡ˆæ˜¯Alexey Milovidovã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼Œä¸‹åˆ‡äº†å¾ˆå¤šæ–‡å­—ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¸Œæœ›æœ‰é—®é¢˜çš„å†…å®¹èƒ½å¸®åŠ©æ‚¨å¯¼èˆªã€‚</font></font></p><br>
<p><img src="https://habrastorage.org/webt/uv/ix/ou/uvixouffnzvqs2ff5pen32ojsc8.png"></p><a name="habracut"></a><br>
<h2 id="soderzhanie"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å†…å®¹</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClickHouseä¼šä¸æ–­æ›´æ–°ï¼Œä½†æˆ‘ä»¬çš„æ•°æ®å´æ²¡æœ‰æ›´æ–°ã€‚</font><font style="vertical-align: inherit;">æ€ä¹ˆåŠå‘¢ï¼Ÿ</font></font></a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å‰ï¼Œä»ClickHouseå¤‡ä»½æ•°æ®çš„æœ€ä½³åšæ³•æ˜¯ä»€ä¹ˆï¼Ÿ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯å¦å¯ä»¥åœ¨ç«–äº•ä¸­ç»„ç»‡å—æ§çš„å¤åˆ¶å“æ»åï¼Ÿ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æœè¡¨ç»“æ„å·²æ›´æ”¹æ€ä¹ˆåŠï¼Ÿ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨æœ‰ä»€ä¹ˆæœ€ä½³çš„æ•°æ®åˆ†ç‰‡å®è·µï¼Ÿ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> ClickHouse   clickhouse-copier.  &nbsp; ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    ,   .  &nbsp;?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       &nbsp; &nbsp; ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  &nbsp;  ClickHouse,      ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kill query   ,     . ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    &nbsp; ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  &nbsp;ClickHouse,     &nbsp;?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   storage_configuration    ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">      Low Cardinality?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   &nbsp;  &nbsp; &nbsp;  ?</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    &nbsp;ClickHouse &nbsp;  ?</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  &nbsp;    ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> ClickHouse  .     ,   &nbsp; &nbsp;?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  &nbsp;,     &nbsp;OOM?</a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Golang- &nbsp;ClickHouse?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    &nbsp; &nbsp;  lazy_load.  ?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  &nbsp;,  system reload dictionaries     &nbsp; ,     &nbsp;  &nbsp;?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     &nbsp; ClickHouse,     &nbsp;?</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">:    &nbsp;</a></li>
</ul><br>
<blockquote>    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">&nbsp; -</a>.  â€” &nbsp;  &nbsp;.</blockquote><br>
<h2 id="anchorold-dataanchorclickhouse-postoyanno-obnovlyaetsya-a-nashi-dannyenbsp-net-chto-snbspetim-delat"><a name="old-data"></a>ClickHouse  ,   &nbsp;â€” .  &nbsp; ?</h2><br>
<blockquote>ClickHouse  ,   ,   optimize final ,     &nbsp; . <br>
<br>
, &nbsp;  - ,    .   ,  ,   ,   &nbsp; &nbsp; ,    &nbsp; &nbsp;   ClickHouse.   &nbsp; ,    ?</blockquote><p>, &nbsp;   &nbsp;  &nbsp; ,  &nbsp;    , .   &nbsp;,    &nbsp;ClickHouse    .   ,    &nbsp;,    -   . ,   &nbsp;,   ClickHouse    .  . </p><br>
<h2 id="anchorbackup-best-practiciesanchorkakie-luchshie-praktiki-est-nanbspdannyy-moment-ponbsprezervnomu-kopirovaniyu-dannyh-iznbspclickhouse"><a name="backup-best-practicies"></a>    &nbsp;  &nbsp;   &nbsp;ClickHouse?</h2><br>
<blockquote>    &nbsp; ,  &nbsp;   optimize final,    &nbsp;,  ,  , , &nbsp;  ,   &nbsp;    ? <br>
<br>
      &nbsp; :  -  -   .  ,    ,    ? </blockquote><p>&nbsp; &nbsp;  .     &nbsp; &nbsp; &nbsp;  &nbsp; Â«.Â»,     .    ,    . </p><br>
<p> , &nbsp;   &nbsp;ClickHouse, &nbsp; .   ,   .    ,     ,    &nbsp; .</p><br>
<p> &nbsp;       &nbsp;      .    â€”    .</p><br>
<p>  &nbsp;    ,    : </p><br>
<ol>
<li>  ,    â€” <strong>show create table</strong>.</li>
<li>  &nbsp; ClickHouse  â€” <strong>select</strong> * <strong>from table</strong> &nbsp;. &nbsp;    &nbsp; TabSeparated.     â€”  &nbsp; Native. </li>
</ol><br>
<p>   ,        .    ,    &nbsp;  ClickHouse.   ,  &nbsp;        &nbsp;MySQL &nbsp;. </p><br>
<p>    &nbsp;ClickHouse      &nbsp;  .    &nbsp;  <strong>alter table freeze partition</strong>.   <strong>alter table freeze</strong> â€”    . </p><br>
<p>    &nbsp;  &nbsp; ,          .  &nbsp;    ,   &nbsp;       .   &nbsp;       .      &nbsp;-  &nbsp;,   &nbsp;.</p><br>
<p>    . &nbsp;â€”   &nbsp;  .      &nbsp;Directory-Detached &nbsp;     <strong>attach partition</strong>.     &nbsp;   . </p><br>
<p>  -  &nbsp;â€” &nbsp; ,  &nbsp;      &nbsp;    .   ,    &nbsp; &nbsp;Â«.Â».       â€”    ,    . </p><br>
<p>     &nbsp;  .  &nbsp;    ClickHouse     ,        &nbsp;  .    &nbsp;      ,    .    .  &nbsp;â€”  LVM ,  &nbsp;â€” ZFS &nbsp;Linux. </p><br>
<p>      ,      - . ,   ,  &nbsp;    .     &nbsp;    ,    .       &nbsp;,      .</p><br>
<h2 id="anchorreplicationanchormozhno-li-budet-organizovat-kontroliruemoe-otstavanie-replik-vnbspvalah"><a name="replication"></a>       &nbsp;?</h2><br>
<blockquote>       &nbsp;ClickHouse.    &nbsp;    ?    &nbsp;    &nbsp;  &nbsp;   . <br>
<br>
   - roll back  ? , &nbsp;    ,  &nbsp;   ,  &nbsp;    ?<br>
<br>
 &nbsp;      ,  &nbsp;    &nbsp;  ,    ,       &nbsp; ,      &nbsp;   ? </blockquote><p>  &nbsp;  .   &nbsp; ,    issue &nbsp; &nbsp;: Â« -  ,  ,  Â».   ,  issue .   ,      ,  ClickHouse. ,   &nbsp;&nbsp;20.3.</p><br>
<p>ClickHouse  &nbsp;   &nbsp;â€” .   ,      &nbsp;  . &nbsp;  ,   ,   &nbsp; &nbsp;  .</p><br>
<p>-,    &nbsp; ,    select,   , &nbsp;    .  select   &nbsp; .</p><br>
<p>-,     &nbsp;&nbsp;â€”     &nbsp;  .         &nbsp; .     &nbsp;: &nbsp; &nbsp;  ,  &nbsp;      ,    &nbsp;  .    &nbsp;   ClickHouse   &nbsp; .</p><br>
<p>  ,    &nbsp;.    ,   &nbsp;  ClickHouse    ,     .    &nbsp;- ,   , , <strong>alter drop column</strong>.      &nbsp; .</p><br>
<p>  &nbsp; 20.3,     ,      .    &nbsp;â€”      ,  .  ,    &nbsp;,   . &nbsp;  ,   ,  , ,    - ,     &nbsp; .    &nbsp;   ,     , &nbsp;  . </p><br>
<p>     .    <strong>alter delete</strong>  <strong>alter update</strong>,    ,   .    .</p><br>
<h2 id="anchorsoooo-changeableanchorkak-byt-esli-struktura-tablicy-pomenyalas"><a name="soooo-changeable"></a> ,    ?</h2><br>
<blockquote>  ,    &nbsp; ?    &nbsp; &nbsp;    .    Btrfs  ZFS &nbsp;Linux LVM?</blockquote><p>   <strong>attach partition</strong>  &nbsp; ,  ClickHouse  ,   .  . &nbsp;â€”     MergeTree &nbsp; ,    &nbsp; attach,   alter.           attach ,    <strong>alter table move partition</strong>.</p><br>
<p>  &nbsp;â€”    Btrfs.  ,  &nbsp;  LVM,   LVM ,       ext4,    . &nbsp;Btrts   &nbsp;   .    ,       &nbsp; ,    &nbsp; &nbsp; .      ,  &nbsp;  Btrfs &nbsp;.</p><br>
<h2 id="anchorresharding-best-practicesanchorkakie-seychas-luchshie-praktiki-vnbspreshardinge-dannyh"><a name="resharding-best-practices"></a>    &nbsp; ?</h2><br>
<p> &nbsp;   .      .   &nbsp;    &nbsp;â€” &nbsp;ClickHouse    .   ,     .    &nbsp;   ,  &nbsp;ClickHouse     . </p><br>
<p>   &nbsp;     &nbsp;,    .    &nbsp; ,  &nbsp; ,    .    ,      &nbsp;,  &nbsp;, .</p><br>
<p> ,    ,&nbsp;â€”     &nbsp;  &nbsp;  <strong>alter table fetch partition</strong>. ,     &nbsp;,      2017&nbsp;   &nbsp; ,  â€”    &nbsp;-   .   ,    - .</p><br>
<p>    &nbsp; ,    &nbsp;. &nbsp;    ,      .       &nbsp;.   ,       . &nbsp;     ,        .</p><br>
<p>&nbsp;    ,    &nbsp; ,    &nbsp;  ,      . &nbsp;  &nbsp; &nbsp;  &nbsp;â€”   &nbsp;.  &nbsp;  select &nbsp;Distributed ,    &nbsp;      . </p><br>
<p> ,   &nbsp;   ,   &nbsp;  .  ,   &nbsp;   &nbsp; ,    ,  . &nbsp;      ,   &nbsp; select  &nbsp;â€”   ,  ,     &nbsp;â€”    .</p><br>
<p>     .  &nbsp;     &nbsp;  ,     &nbsp;- ,      ,   &nbsp;Distributed .       ClickHouse    <strong>optimize skip unused shards</strong>. &nbsp;  &nbsp;  select  &nbsp; where  ,   , &nbsp;      .   &nbsp;,     &nbsp; &nbsp;  .     ,   .</p><br>
<p>,    .     ,  ,   .</p><br>
<p><strong> , lead system administrator  </strong>: ,  ,       ,     &nbsp;    .    ,        &nbsp; ,     &nbsp; ,     .      ,  , &nbsp; , &nbsp; -    &nbsp;    .</p><br>
<p><strong> :</strong>    â€” , ,    . ,  .   &nbsp; ,   &nbsp; .    ,     ,      &nbsp; . </p><br>
<p>   ,   ,    ,    .      &nbsp; .  ,      &nbsp;      ,    &nbsp;    .   &nbsp; , &nbsp;,   &nbsp;  .</p><br>
<p>  &nbsp;     &nbsp; 2019&nbsp;.  ,     &nbsp;2019&nbsp;,    &nbsp; 2019&nbsp;&nbsp;â€” &nbsp;  ,   &nbsp;-  .        .  &nbsp;    ,    ad hoc ,      .</p><br>
<p>&nbsp;       &nbsp;.  &nbsp;  ,      ,  &nbsp;   .    .</p><br>
<p>, &nbsp;   .    &nbsp; . &nbsp;â€”   . &nbsp;â€”  .  &nbsp;â€”    ,   &nbsp;.     ,   . </p><br>
<p>,  &nbsp;      &nbsp; &nbsp;â€”    .  &nbsp;    &nbsp; ,    &nbsp;select.   &nbsp;select,  ,   &nbsp;  .</p><br>
<p>,  CPU &nbsp;-  - . ,     , &nbsp;    .    &nbsp; ,  ,     &nbsp; .  &nbsp; , &nbsp;. ,    .</p><br>
<p><strong> :</strong>  &nbsp;,        ,    &nbsp;      &nbsp;.  &nbsp;     &nbsp;  ,  ClickHouse &nbsp;  .</p><br>
<p>  ,   &nbsp;   &nbsp; ,     .  &nbsp; &nbsp;     .  &nbsp; &nbsp; ,        ClickHouse: Â«   &nbsp;  .   -  &nbsp; -  ,      &nbsp;Â». </p><br>
<p>   ,    &nbsp;        , &nbsp;      ,     &nbsp;.          .</p><br>
<p><strong> :</strong> &nbsp;, &nbsp;    ,          ,    ,    &nbsp;  . </p><br>
<p>   &nbsp; Â«.Â». &nbsp;â€”   ,   .    &nbsp; -.    Â«.Â»,     â€” avito.ru,  &nbsp;,    &nbsp; .</p><br>
<p>    &nbsp;â€”   ,    . &nbsp;  ,       &nbsp; Â«Â».    ,   Â«Â»    &nbsp; .    &nbsp; ,  &nbsp;  .</p><br>
<p>    ,   &nbsp;    ,    ?    &nbsp;,    &nbsp;ClickHouse &nbsp; Â«Â» â€”   &nbsp;. &nbsp;  , ,   &nbsp;   ClickHouse  .</p><br>
<p> &nbsp;â€”  &nbsp;- .  &nbsp;    Distributed       ,    ,    &nbsp; . &nbsp; ,  &nbsp;,    ,      &nbsp; ,  .</p><br>
<p>   . ,      &nbsp;,   &nbsp;   &nbsp; .         &nbsp;,  &nbsp;  -      .      &nbsp; .     avito.ru.    ,  ,  &nbsp;â€”   &nbsp;   &nbsp;.    &nbsp;    .</p><br>
<p>      .    &nbsp;  ,    .    &nbsp; &nbsp;  .      . </p><br>
<p>   ?    &nbsp;â€”       ,   .    &nbsp;      &nbsp;  .    &nbsp; &nbsp;â€”  &nbsp;   &nbsp;-,     ,   &nbsp; ,     &nbsp;MySQL.  &nbsp;â€” &nbsp; .      &nbsp; .</p><br>
<p>&nbsp;    &nbsp; &nbsp;  .  &nbsp;     ,   ,  &nbsp; &nbsp; &nbsp; .  ,     -  &nbsp; ,   &nbsp; .    &nbsp;,    .  &nbsp;   &nbsp;Distributed ,   &nbsp;   &nbsp; .    .</p><br>
<p>    ,    ,  &nbsp;   . &nbsp;         &nbsp; clickhouse-copier.</p><br>
<p>&nbsp;     &nbsp; &nbsp;â€”   .   ,    ,  &nbsp;  ,     &nbsp; ,  120&nbsp; &nbsp;  &nbsp;&nbsp;â€”   360&nbsp;.    ,      &nbsp; .    &nbsp;Â«.Â»     &nbsp;avito.ru,   &nbsp;120&nbsp;.   &nbsp; .      &nbsp;,    .     Distributed ,   &nbsp;  120&nbsp;.</p><br>
<p>  &nbsp;â€” &nbsp; .    &nbsp; ,      &nbsp; .</p><br>
<h2 id="anchorclickhouse-copieranchorv-clickhouse-est-utilita-clickhouse-copier-mozhete-pronbspneyo-rasskazat"><a name="clickhouse-copier"></a> ClickHouse   clickhouse-copier.  &nbsp; ?</h2><br>
<p> ,         .  &nbsp;,        ,   .    &nbsp;,      .    &nbsp;   &nbsp;  .</p><br>
<p> ,  &nbsp;       .     &nbsp; , ,   ,     ,   . </p><br>
<p>,   ,  .   &nbsp;   Distributed ,      clickhouse-copier,  &nbsp;  ,     ,        .   &nbsp;    &nbsp;  ,   ,      &nbsp; ,   &nbsp;   &nbsp;   .     &nbsp;,       ,    .</p><br>
<p>   clickhouse-copier?     &nbsp;  &nbsp;     &nbsp; .      ,  clickhouse-copier    &nbsp;  &nbsp; ,  ,    &nbsp; &nbsp;â€”      insert select.  , , ,   ,  -, .    .</p><br>
<h2 id="anchorresharding-toolanchoru-vas-byla-pilotnaya-shtuka-kotoraya-nazyvalas-resharding-chto-snbspney"><a name="resharding-tool"></a>    ,   .  &nbsp;?</h2><br>
<blockquote>    &nbsp;2017   ,   .    &nbsp;ClickHouse.   ,   .  ,   ?     .</blockquote><p>  &nbsp;,  &nbsp;   &nbsp;     &nbsp;,    .     &nbsp;,     ,  ,    .       ,       &nbsp;  &nbsp; ,      â€”   .</p><br>
<h2 id="anchormove-to-slow-diskanchormozhno-li-slivat-vse-chasti-dannyh-voedino-perednbspperemescheniem-nanbspmedlennye-diski"><a name="move-to-slow-disk"></a>       &nbsp; &nbsp; ?</h2><br>
<blockquote> &nbsp;TTL &nbsp; move to slow disk &nbsp; .   ,   &nbsp;cron,    &nbsp; &nbsp; &nbsp; ?</blockquote><p> &nbsp;,   -     &nbsp; &nbsp; &nbsp;â€” .  , &nbsp;  .       &nbsp;,    &nbsp;,     &nbsp;  . </p><br>
<p>     . &nbsp;â€” &nbsp; .  &nbsp;    -   ,        &nbsp;  .    ,  &nbsp;â€”  .</p><br>
<p>  â€” &nbsp;.  &nbsp;  .     &nbsp;  &nbsp; ,     .</p><br>
<h2 id="anchorup-to-dateanchorkak-pereezzhat-nanbspnovye-versii-clickhouse-esli-net-vozmozhnosti-zaranee-proverit-sovmestimost"><a name="up-to-date"></a>  &nbsp;  ClickHouse,      ?</h2><br>
<blockquote>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">&nbsp;- ClickHouse</a> &nbsp;  ,   .    &nbsp; 19.11 &nbsp;19.16 , , &nbsp;19.16 &nbsp;20.3.    &nbsp; ,       &nbsp;?</blockquote><p>  Â«Â» . &nbsp;â€” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> changelog</a>.  ,      &nbsp;  .    &nbsp;   &nbsp; .    ,   &nbsp;  , ,  ,    .</p><br>
<p>&nbsp;â€”      &nbsp;,      &nbsp;,  &nbsp;â€”    .     .    ,   ,  ,    ,       &nbsp;   &nbsp; ,    .       &nbsp; .   -    ,     &nbsp;â€”      . </p><br>
<p>  &nbsp;â€”   &nbsp;     &nbsp;   &nbsp;    .   &nbsp;  ClickHouse,   . </p><br>
<p>  20.3.4.  20&nbsp;  &nbsp;â€” 2020. &nbsp;  ,  ,     ,     &nbsp;  . &nbsp;â€” 20.3.  &nbsp;â€”    3 â€”    ,    &nbsp;-  .     &nbsp;ClickHouse - ,     .   &nbsp; 20.4 ClickHouse    .  &nbsp;â€” 20.3.4. &nbsp;4 â€”   -, &nbsp;     ,   - .  4&nbsp;,      .</p><br>
<p>  ,   - .       ,     &nbsp;-  &nbsp; &nbsp;.  ,  &nbsp;-  &nbsp; ,      ,      .    .    -,  ClickHouse  .</p><br>
<p> &nbsp; ClickHouse  &nbsp;,     ClickHouse &nbsp;  â€” ,&nbsp;20.4.1 â€”  ,     &nbsp; &nbsp;  .    ?      ClickHouse,     , ,  ,   .   ClickHouse   ,   &nbsp;  &nbsp;â€”    .</p><br>
<p><strong> :</strong>    &nbsp; .       - , ,       ClickHouse,            &nbsp;  .    .</p><br>
<p>  &nbsp; . &nbsp;  ,    ClickHouse.     &nbsp;&nbsp;â€”    &nbsp;Hetzner &nbsp; ,    .   ,      &nbsp;Ansible,   &nbsp;  ,   â€” &nbsp;     &nbsp;.</p><br>
<p>  ?     &nbsp; ClickHouse ,   &nbsp;  &nbsp;â€” &nbsp;Docker, &nbsp;LXC, ,  Ansible playbook,   &nbsp;   .   .     &nbsp;   ,    &nbsp;- .   ,    &nbsp; ,    &nbsp;â€”   &nbsp;.   ,   .    &nbsp;&nbsp;â€” .</p><br>
<p><strong> , senior backend engineer :</strong>   &nbsp;  &nbsp;   . &nbsp;     ClickHouse, &nbsp;      ,   &nbsp;.    &nbsp;   &nbsp; .      &nbsp;-,     &nbsp; .     &nbsp;â€”  &nbsp;,  &nbsp;, , &nbsp;, &nbsp;   &nbsp;    .      &nbsp;       &nbsp;.  ,   ,   &nbsp;  &nbsp;. </p><br>
<p><strong> :</strong> ,        &nbsp;Â«.Â».    &nbsp;600 &nbsp;- ,  &nbsp;360,       .   &nbsp;  &nbsp;â€”     &nbsp;  &nbsp;.   ?    .     .    ,    .</p><br>
<p>           - -.       ,   ,      &nbsp;.</p><br>
<p> .     ClickHouse.   &nbsp; ,    &nbsp; Â«.Â»,    &nbsp;   &nbsp;,   .  ,    CI.        .</p><br>
<p> .   &nbsp;.   ,  &nbsp;   &nbsp; .   .   &nbsp;  :    &nbsp;  &nbsp; ,   ,  .     .            .    &nbsp;â€”   &nbsp;  ,  .</p><br>
<p>     -   .  : Â« , .  ,   .    &nbsp;,   . Â».  ,   ,   â€”   &nbsp;.     &nbsp;    .</p><br>
<h2 id="anchorkill-queryanchorkill-query-dolzhen-ubivat-zaprosy-no-on-etogo-ne-delaet-pochemu"><a name="kill-query"></a>Kill query   ,     . ?</h2><br>
<blockquote>   , - ,    ,     ClickHouse. -    &nbsp;â€” &nbsp; &nbsp;, &nbsp;     .  ,    &nbsp;CPU &nbsp;  &nbsp;,  .    ClickHouse &nbsp; .   : Â« , , process list,     Â».<br>
<br>
       kill.  ,    .   &nbsp;, ClickHouse    - , ,   ,   .  &nbsp;  &nbsp;  ,   &nbsp; &nbsp;ClickHouse,   kill query  . ?  ,  kill query   ,    .</blockquote><p>    .  &nbsp;,  kill query   . </p><br>
<p>Kill query    &nbsp; Â« ,     Â».    &nbsp;    &nbsp; .   ,   . ,     ,       .     &nbsp; ,    &nbsp;   .     ,    .</p><br>
<p>   &nbsp;,    &nbsp;- . ,  ,    ,  , &nbsp; ,     . ,     &nbsp;     &nbsp; .  &nbsp;    ,  .  ,   ,&nbsp;â€”  ClickHouse.</p><br>
<h2 id="anchorreading-timeanchorkak-rasschitat-vremya-otveta-pri-chitayuschey-nagruzke"><a name="reading-time"></a>      ?</h2><br>
<blockquote> , &nbsp;   &nbsp;item&nbsp;â€”  .  &nbsp;â€”   .    &nbsp;  ,   1K&nbsp;RPS &nbsp;1K&nbsp;itemâ€™? </blockquote><p> &nbsp;,   &nbsp; ,   &nbsp;  &nbsp;â€”  ,   ,        . </p><br>
<p>    . &nbsp;select&nbsp;1 ClickHouse       &nbsp;,    &nbsp;     .      ,  &nbsp;- key-value  ,   &nbsp;      &nbsp;.  &nbsp;    ,   .      &nbsp;â€” &nbsp;8192  &nbsp;.       &nbsp;64&nbsp; &nbsp;1&nbsp;.      &nbsp; .     .</p><br>
<p>    .     &nbsp;,   .      &nbsp; ,     ,   &nbsp;   .     1000&nbsp;RPS ClickHouse   ,  &nbsp; ,  .</p><br>
<p>    ClickHouse &nbsp;  ,     &nbsp;â€”       &nbsp; .    &nbsp;    &nbsp;,   ,  &nbsp;    .</p><br>
<p>, ,   ClickHouse  &nbsp;   .  &nbsp; ? &nbsp;â€”   . &nbsp;     &nbsp;,  &nbsp;,    &nbsp;       &nbsp;.  &nbsp;   ,  &nbsp;    64.</p><br>
<p>    . &nbsp;   <strong>min compress block size</strong>, <strong>max compress block size</strong>.   ,  ,      .    ClickHouse&nbsp;â€”   key-value  .    &nbsp;â€”   .</p><br>
<p><strong> :</strong>   &nbsp;,    .    ,  &nbsp;ClickHouse  - .    ,  &nbsp;- ,  -  ,    - .  MySQL,   &nbsp;â€” &nbsp;MySQL  duplicate key,   PostgreSQL  conflict&nbsp;â€”   .     . </p><br>
<p> &nbsp;  ,   ClickHouse  .    ,    &nbsp; . </p><br>
<h2 id="anchorpimp-my-clickhouseanchorchto-podtyunit-v-clickhouse-chtoby-bolshe-dannyh-bylo-vnbspkeshe"><a name="pimp-my-clickhouse"></a>   ClickHouse,     &nbsp;?</h2><br>
<blockquote> &nbsp;â€” &nbsp;  256&nbsp;&nbsp;, &nbsp;  ClickHouse   60â€”80&nbsp;, &nbsp; â€” &nbsp;130.     ,     &nbsp; , ,    &nbsp;?</blockquote><p> , page cache     &nbsp; .     ,   cached  free&nbsp;â€”   ,  &nbsp;â€”   ,      &nbsp;.    &nbsp;    &nbsp;,  &nbsp;.     ,    ,      .</p><br>
<p>  ,         ,     ClickHouse  &nbsp; .   <strong>uncompressed cache</strong>.    config.xml  uncompressed cache size    &nbsp;â€”       ,     &nbsp;page cache. </p><br>
<p> ,     .   â€” <strong>use uncompressed cache</strong> â€”   .    &nbsp; ,  ,          .    â€”  -     &nbsp; .     ,     .</p><br>
<h2 id="anchorstorage-configurationanchorkak-mozhno-nastroit-storage_configuration-dlya-hraneniya-v-operativke"><a name="storage-configuration"></a>   storage_configuration    ?</h2><br>
<blockquote>   ClickHouse   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">&nbsp;data storage</a>. &nbsp;   &nbsp;fast SSD. <br>
<br>
,       &nbsp;volume hot memory.    .   select &nbsp;  ,         ,   &nbsp;,      &nbsp;?     prewhere &nbsp;  ?</blockquote><p>   &nbsp;  ,      .<br>
  . </p><br>
<p>   &nbsp; . ,   &nbsp;&nbsp;â€”   .   tmpfs ,   &nbsp;-  &nbsp; .    &nbsp;  &nbsp;  &nbsp;  ,       ,  . </p><br>
<p>      -&nbsp; , ,  &nbsp;    &nbsp; -,  .  ,   . ,       .   ,   . ClickHouse  &nbsp; ,  &nbsp;   , ,   ZooKeeper   .  ,     ,    .     . </p><br>
<p>     &nbsp;    &nbsp;  &nbsp;,   &nbsp;  &nbsp;     &nbsp;page cache    .   &nbsp;   .  &nbsp;  ,  ClickHouse   fsync &nbsp;insert.</p><br>
<p>   &nbsp;  &nbsp;   ,   &nbsp;.  select     ,   , &nbsp;    ,   .  prewhere    ,  &nbsp;,   &nbsp;  &nbsp;.</p><br>
<h2 id="anchorlow-cardinalityanchordo-kakogo-kolichestva-unikalnyh-znacheniy-effektiven-low-cardinality"><a name="low-cardinality"></a>      Low Cardinality?</h2><br>
<p>Low Cardinality  .    ,   . -,   &nbsp; , -,         &nbsp; .       &nbsp;â€” -,  &nbsp;â€”   ,   .</p><br>
<p> &nbsp;: &nbsp;   â€” , &nbsp;  â€” - &nbsp;   Low Cardinality .    fallback,       ,   .      ,     string,  ,   ,      . </p><br>
<h2 id="anchorfulltext-searchanchorkakie-luchshie-praktiki-ponbsppolnotekstovomu-poisku-ponbsptablice-snbsppyatyu-milliardami-strok"><a name="fulltext-search"></a>   &nbsp;  &nbsp; &nbsp;  ?</h2><br>
<p>   . &nbsp;â€” ,  ClickHouse&nbsp;â€”    &nbsp; . &nbsp;    , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Elasticsearch</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sphinx</a>.   ,     ,  ,   &nbsp;Elasticsearch &nbsp;ClickHouse.</p><br>
<p>  ?    ,  Elasticsearch  &nbsp;   &nbsp;,  &nbsp;,    .    , ,     &nbsp;ClickHouse, ,    &nbsp;   &nbsp;. &nbsp;      ,    &nbsp;   -  &nbsp; ,   . ,  &nbsp;   &nbsp; &nbsp;-  .</p><br>
<p>    &nbsp;ClickHouse  ,   &nbsp;   &nbsp;.        &nbsp; .     ,  ,      - &nbsp; like.  like &nbsp;ClickHouse&nbsp;â€”     like,    .   &nbsp;â€”  . </p><br>
<p>   like&nbsp;â€”  full scan.  full scan      &nbsp;CPU,   &nbsp;.   &nbsp;    &nbsp;,   &nbsp;  - ,    .    &nbsp;  ,  &nbsp;    ,   &nbsp;  &nbsp;SSH  .</p><br>
<p>         .  &nbsp; &nbsp;â€”  ,   .  ClickHouse    &nbsp;  -.   &nbsp; Arenadata    ,      ,  .</p><br>
<p>     ,   ,    :  &nbsp;   -     .  ,    &nbsp; &nbsp;-  , ,    &nbsp;. &nbsp;  &nbsp;   ,     .</p><br>
<p> &nbsp;ClickHouse      &nbsp; . , -,     &nbsp; , &nbsp;   &nbsp; , &nbsp; , &nbsp; UTF-8   &nbsp;ASCII.   ,   . </p><br>
<p>      &nbsp; .     X&nbsp;like   or&nbsp;X&nbsp;like  .  ,     .</p><br>
<p> â€”         .  -   &nbsp;,    &nbsp; .</p><br>
<h2 id="anchorhello-and-welcomeanchorkak-luchshe-organizovat-dostup-vnbspclickhouse-dlyanbspbolshogo-kolichestva-polzovateley"><a name="hello-and-welcome"></a>    &nbsp;ClickHouse &nbsp;  ?</h2><br>
<blockquote>,     &nbsp;    .   ,   max concurrent queries,   ?</blockquote><p>   ,        ,     &nbsp;.      &nbsp;  ,      ,  ,  &nbsp;    . &nbsp;   &nbsp;   &nbsp; .      &nbsp;  ,     &nbsp; .</p><br>
<p>     ,    &nbsp;   &nbsp; .     &nbsp; ,       .</p><br>
<p>  &nbsp;,   &nbsp;  .     &nbsp; Â«.Â»      <strong>select count from hits</strong>,      ,      .   ,    ,&nbsp;â€”   ,   &nbsp;    &nbsp; .   . </p><br>
<p>,    &nbsp; ,    .     &nbsp;â€”   <strong>force index by date</strong>.     ,      .     ,      .  &nbsp;â€”    where event date between .       ,   and  or â€” or URL match.   ,     URL     .</p><br>
<p> ,  ClickHouse    . &nbsp;,   .    <strong>priority</strong>.  priority&nbsp;â‰ &nbsp;0,    &nbsp;- ,  &nbsp;   &nbsp;,    ,     ,   &nbsp;  ,     ,        &nbsp; .</p><br>
<p>   ,     &nbsp; ,  &nbsp;   .   &nbsp; ,   ,  &nbsp;  ,   .</p><br>
<p>    <strong>OS thread priority</strong>.    &nbsp;     nice &nbsp; Linux.    ,  - .      nice&nbsp;â€”     ,     &nbsp;â€”  &nbsp; &nbsp;   -19,  CPU      &nbsp;  ,  . </p><br>
<p>      &nbsp;â€” ,  .    &nbsp;â€”   .    ,   ,    ,  ClickHouse  ,    .</p><br>
<p>,  :  -       &nbsp;&nbsp;â€”   .     ,    .    .  &nbsp;   .   <strong>min execution speed</strong> â€” &nbsp; &nbsp;,    timeout before checking min execution speed&nbsp;â€”    .     ,  ,  ,     â€”  .</p><br>
<p>   . &nbsp;ClickHouse    ,    . , &nbsp;,     CPU, ,  &nbsp;â€”   ,    .   , ,    &nbsp;      &nbsp;.</p><br>
<p>  ?          &nbsp;ClickHouse .    .   &nbsp; &nbsp;  ,   ,  &nbsp;   .     &nbsp;,    &nbsp; . &nbsp;   .</p><br>
<h2 id="anchorsmorgasbordanchormozhno-li-otdat-rezultaty-odnogo-zaprosa-desyati-klientam"><a name="smorgasbord"></a>       ?</h2><br>
<blockquote>    ,    &nbsp;   &nbsp;     .  ,  &nbsp; ,  - ,     ,   .       ,     ,   ,      ?</blockquote><p> &nbsp;,         &nbsp; .  page cache  ,      &nbsp; , , &nbsp;,     ,    . </p><br>
<p>  -   ,    ,     &nbsp;-     .  &nbsp;     pull request,    ,       in  join â€”    .</p><br>
<p>  , &nbsp;    .   &nbsp;â€”   &nbsp;.  , &nbsp;   ,    limit 10.    ,  limit 10,10.    .  ,       ?    ,     .</p><br>
<p>  ,     &nbsp;ClickHouse â€” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ClickHouse Proxy</a>.</p><br>
<p><strong> :</strong> &nbsp;ClickHouse Proxy        .     ,     . Proxy   ,   &nbsp;,  ,  &nbsp;   .     , Proxy    ,   &nbsp;ClickHouse  .</p><br>
<p> Nginx      ,     . &nbsp;Nginx   , ,    ,    ,    .   &nbsp;ClickHouse Proxy    .    &nbsp;ClickHouse,    ,   .    . </p><br>
<h2 id="anchorasynchronousanchorkak-byt-snbspasinhronnymi-operaciyami-i-materializovannymi-predstavleniyami"><a name="asynchronous"></a>  &nbsp;    ?</h2><br>
<blockquote>  ,   &nbsp;- &nbsp;â€”   ,    .  &nbsp;    &nbsp;- ,   &nbsp; .    -  ,    .    &nbsp;?<br>
<br>
  &nbsp;â€”   &nbsp;   &nbsp;  .   - Â« Â»,  &nbsp;  ?</blockquote><p>  &nbsp;,   . , &nbsp;   ,   &nbsp;,  &nbsp;   &nbsp; .</p><br>
<p>  &nbsp;      .         ,         &nbsp;   ,   .   â€œOkâ€ &nbsp; &nbsp;insert,       ,     .</p><br>
<p>  &nbsp;.  &nbsp;  &nbsp; â€œOkâ€,    .     &nbsp;ClickHouse,    ,    .   &nbsp;   ,    ,    .  &nbsp;â€”    .   &nbsp;   ,     ,   .   &nbsp; . </p><br>
<p>  ,    &nbsp; .     &nbsp; &nbsp; ,  &nbsp;     .</p><br>
<p> &nbsp; . &nbsp;   ,       .      ,    ,   &nbsp; . ,    &nbsp; ,  &nbsp;    ,  &nbsp;  &nbsp;   .    &nbsp;â€”       &nbsp;insert. &nbsp;    &nbsp;  .</p><br>
<p>      .      &nbsp; . ,   &nbsp;     ,   ,  ,    .   ,  .   ,   . </p><br>
<p><strong> :</strong> &nbsp;   &nbsp;    .  ,    ,    ,     &nbsp; â€”   .    , ,   ,      .   ,   &nbsp;â€”     .       .</p><br>
<p>    ?  ,   &nbsp;â€”   &nbsp; ,   &nbsp;.  &nbsp;-     ,     .     ,      ,    ,   &nbsp;   .  &nbsp;-    ,   &nbsp;,    . </p><br>
<p>   API â€” &nbsp;ClickHouse     .  API :  &nbsp;     &nbsp;,     , ,     &nbsp;   &nbsp; . &nbsp;   &nbsp;  ,  &nbsp;  ,    .   ,     ClickHouse.</p><br>
<p> &nbsp; API - &nbsp;â€” &nbsp;, &nbsp; â€”  &nbsp;,  .   ,  .     &nbsp;   &nbsp;- .   &nbsp;  ,       .</p><br>
<h2 id="anchordashboardanchorv-clickhouse-mnogo-logov-kak-ya-mogu-videt-vsyo-chto-proishodit-s-serverom-vnbspmomente"><a name="dashboard"></a> ClickHouse  .     ,    , &nbsp;?</h2><br>
<blockquote> ClickHouse     ,    . &nbsp;  - &nbsp;    , &nbsp;     &nbsp;.   ,     .    &nbsp; ,      &nbsp;,  , &nbsp;-  . <br>
<br>
    &nbsp; ClickHouse,  &nbsp;  ,      ,      &nbsp;   ? &nbsp; ,     &nbsp;ClickHouse â€”  .   ,      &nbsp;  .   &nbsp; . </blockquote><p> ,    . &nbsp; &nbsp; - 60&nbsp;  ClickHouse,   ,    &nbsp; ,     ,  - .      Â«.Â».     ,     . &nbsp; . </p><br>
<p>   &nbsp;Â«Â»    &nbsp;Grafana,      &nbsp;  .        &nbsp; .     ,     .     &nbsp;  ,   Graphite-web.   .    &nbsp;    ,  Grafana, ,     . </p><br>
<p>  &nbsp; .    &nbsp;: CPU, , , . &nbsp;â€”   ,   ,   &nbsp;,    &nbsp;  MergeTree,  ,   ,    &nbsp;,    &nbsp;.  ,    &nbsp;,  &nbsp;.</p><br>
<p><strong> :</strong> ,     .  Grafana. &nbsp;Grafana  datasource,   ClickHouse.     &nbsp;Grafana    &nbsp;ClickHouse. &nbsp;ClickHouse   &nbsp;,  &nbsp; .   &nbsp; &nbsp;Grafana  &nbsp;      ,    .      .</p><br>
<p>   .     &nbsp;â€”    ,  Grafana   ,  &nbsp;Â«Â»    ?</p><br>
<p><strong> :</strong> &nbsp;  datasource,  &nbsp;ClickHouse,   Altinity.      ,     .   &nbsp;,   Â«Â» -  ClickHouse,     . Altinity&nbsp;â€”   ,    ClickHouse.    ,   .   &nbsp;,    &nbsp; Grafana,      &nbsp;â€”   . </p><br>
<p><strong> :</strong>    &nbsp;ClickHouse    &nbsp; .   &nbsp;  &nbsp; .         ,  ,     .     ,        ,    .   -    ,  . </p><br>
<p>  ,   , &nbsp;  &nbsp;â€”    ,  &nbsp; .  &nbsp;-,    ,    .    .    , ,    : Â«,  -    Grafana?Â»,  : Â« &nbsp; Grafana,   â€œâ€,      ,   &nbsp;.   ,   ,    Â».</p><br>
<h2 id="anchorzenanchorkak-vozdeystvovat-na-merdzhi-chtoby-server-ne-padal-vnbspoom"><a name="zen"></a>   ,     &nbsp;OOM?</h2><br>
<blockquote>   , &nbsp;   ,  ReplacingMergeTree.  &nbsp;   &nbsp;  .     &nbsp;    - .<br>
<br>
  ,  &nbsp;        &nbsp;  ,        OOM.     ,       ,   ,    &nbsp;OOM.       .     .<br>
<br>
 ,   &nbsp;  ,   .   ,  .  - .  ,    &nbsp;,      &nbsp;, &nbsp;  &nbsp;â€”        &nbsp;  -  ? ,   &nbsp;   ,  &nbsp; &nbsp; ,      .<br>
<br>
   ,   Â«Â»,   , , &nbsp; .        ,  &nbsp;.  ,  &nbsp;    ,  &nbsp;,   ,   .   ?    ,  -   &nbsp;,  &nbsp;   - ,  - ,     &nbsp;  ,     &nbsp;  .      &nbsp;OOM &nbsp;.     ,    .</blockquote><p> , &nbsp;     &nbsp;OOM,   &nbsp;     &nbsp;   .       &nbsp; .</p><br>
<p><strong> :</strong> .   ,   ,    ,     ,  &nbsp; ,  ,   ,   .  &nbsp;  &nbsp;    100&nbsp;  .    150&nbsp;, 100&nbsp;,    &nbsp;50&nbsp;,   &nbsp;OOM  .</p><br>
<p>  &nbsp;    ,     &nbsp;OOM,     &nbsp;100&nbsp;  ?   &nbsp;,     &nbsp; ?</p><br>
<p><strong> :</strong>   ,      &nbsp;  .     &nbsp;, ,  -   ,    ,     &nbsp; .  &nbsp;â€”   ,  ,    &nbsp; .     ,      ,  ,   , .</p><br>
<p>,       &nbsp;,  Â«  Â»   &nbsp;OOM.     ,    ,  &nbsp;- ,  ,    &nbsp;â€”   &nbsp;  .  &nbsp;      .</p><br>
<h2 id="anchorgoanchorkak-budet-proishodit-razrabotka-golang-drayvera-dlya-clickhouse"><a name="go"></a>    Golang-  ClickHouse?</h2><br>
<blockquote>Golang-,    ,       ClickHouse.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  ClickHouse</a>,     .<br>
<br>
 .           â€”  Vertica.       python-,    Vertica.     ,         ,    -   .   .    ,  ,   Â«Â» â€”    issue,    .<br>
<br>
   .  Golang-  â€”       Golang  ClickHouse.   -  http     ,     .      ?      - breaking changes   ?     issue? </blockquote><p><strong> :</strong> &nbsp;â€”    .    ,    .</p><br>
<p>  &nbsp; &nbsp;issue,    .   &nbsp;, &nbsp;   .     &nbsp;  ,    - .  &nbsp;-   ClickHouse.    ,      ,   ClickHouse .     ,     . </p><br>
<p>    &nbsp;  ClickHouse,     -   .   &nbsp;â€”   ,  .     ,       .</p><br>
<p>    &nbsp;Go,  ,    &nbsp;Go.     &nbsp;â€”     . &nbsp;-    ,      ,  -     .   CloudFlare  &nbsp;  ,   -   &nbsp;   ,          .      &nbsp;ClickHouse ,  &nbsp;. </p><br>
<p> -      ,     &nbsp;  ClickHouse  &nbsp;  .  issues  .  &nbsp;  ,   - .    pull request    -  ,    .</p><br>
<p>   .   ,     , ClickHouse     &nbsp; .    ,   ,   .   ,  &nbsp;2  &nbsp;   -&nbsp; . </p><br>
<p>   ,   .       .  -    ,      ,  .     Â«Â» &nbsp;     . </p><br>
<p><strong> :</strong> &nbsp;      &nbsp;  . &nbsp;â€”   &nbsp; ,        &nbsp; &nbsp;Go.  -  ,    . </p><br>
<p>     &nbsp;  . &nbsp;â€”      ,  &nbsp;  ,  &nbsp;  -,    - . </p><br>
<h2 id="anchorlazy-loadanchorvneshniy-slovar-ne-podnimaetsya-posle-perezagruzki-snbspvklyuchennoy-nastroykoy-lazy_load-chto-delat"><a name="lazy-load"></a>      &nbsp;  lazy_load.  ?</h2><br>
<blockquote>    lazy_load,        .     ,    &nbsp; .  &nbsp;   .   -   ClickHouse  ,       ,     ?<br>
<br>
 &nbsp;   ClickHouse,     .   ?</blockquote><p>-,     &nbsp;  <strong>system reload dictionaries</strong>. -, &nbsp;  â€”    ,     &nbsp; ,   .      ,      &nbsp; .</p><br>
<p>&nbsp;     . ,     &nbsp;MySQL. -   select,   select      .    . &nbsp;â€”  lazy_load. &nbsp;â€”   ,  ,   &nbsp; ,  <strong>system reload dictionary</strong>    ,   .    .      &nbsp;  lazy_load,    ClickHouse   .</p><br>
<p>   &nbsp;â€”    ,    . </p><br>
<h2 id="anchorreload-dictionariesanchorkak-byt-snbsptem-chto-system-reload-dictionaries-ne-podgruzhaet-ni-odin-iznbspmnozhestva-slovarey-esli-hotya-by-odin-iznbspnih-padaet-snbsposhibkoy"><a name="reload-dictionaries"></a>  &nbsp;,  system reload dictionaries     &nbsp; ,     &nbsp;  &nbsp;?</h2><br>
<blockquote>   &nbsp; system reload dictionaries. &nbsp;  &nbsp;â€”   ,  . System reload dictionaries &nbsp;      ,      &nbsp;  c&nbsp; system reload dictionary.    &nbsp; ClickHouse?</blockquote><p> .   . ,    ClickHouse,    .       <strong>system reload dictionaries</strong>, ,   ,    &nbsp; .</p><br>
<h2 id="anchorconnectionanchorest-li-sposob-konfigurirovat-rekvizity-vnbspkonfige-clickhouse-no-ne-svetit-ih-prinbsposhibkah"><a name="connection"></a>     &nbsp; ClickHouse,     &nbsp;?</h2><br>
<blockquote>  &nbsp;,  &nbsp;,   .     &nbsp; ClickHouse &nbsp;,  &nbsp;       &nbsp;. <br>
<br>
      &nbsp;  ODBC.   -    &nbsp; ClickHouse,      &nbsp;?</blockquote><p>  &nbsp;â€”   credentials &nbsp;odbc.ini,  &nbsp; ClickHouse   ODBC Data Source Name. &nbsp;     &nbsp;â€”    &nbsp;MySQL,  &nbsp;      &nbsp;  . &nbsp;ODBC    â€”   ,    .</p><br>
<h2 id="anchorzoom-backgroundsanchorbonus-fony-dlya-zuma-snbspposidelok"><a name="zoom-backgrounds"></a>:    &nbsp;</h2><br>
<p>  &nbsp; &nbsp;      &nbsp;.    &nbsp;  ,  &nbsp; &nbsp;         &nbsp; &nbsp; .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ir/9v/k9/ir9vk9hblhloemqnwftbbatwaao.jpeg"></a></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500666/index.html">Microsoftåœ¨çº¿è®¤è¯-æ‚¨ï¼Œæ‚¨çš„ç©ºé—´å’Œè®¡ç®—æœº</a></li>
<li><a href="../zh-CN500668/index.html">Legoä½¿ç”¨Steam Controllerè¿›è¡Œæ— çº¿ç”µæœºæ§åˆ¶</a></li>
<li><a href="../zh-CN500670/index.html">æˆ‘ä»¬å¦‚ä½•åˆ›é€ æˆ‘ä»¬çš„äº§å“ã€‚ç¬¬ä¸€éƒ¨åˆ†ï¼Œç ”ç©¶</a></li>
<li><a href="../zh-CN500672/index.html">æµ‹è¯•äººå‘˜çš„æŒç»­æµï¼Œè€Œä¸ä»…ä»…æ˜¯</a></li>
<li><a href="../zh-CN500676/index.html">å…³äºæµ‹è¯•è‡ªåŠ¨åŒ–çš„åœ¨çº¿ç ”è®¨ä¼šçš„å…¬å‘Š</a></li>
<li><a href="../zh-CN500688/index.html">åœ¨Flaskä¸­ä½¿ç”¨æ•°æ®åº“ï¼šä»å…­æœˆåˆ°å…­æœˆ</a></li>
<li><a href="../zh-CN500692/index.html">3Dæ¸¸æˆæ¸²æŸ“ï¼šç®€ä»‹</a></li>
<li><a href="../zh-CN500694/index.html">68ä¸è¯·è‡ªæ¥çš„æç¤º</a></li>
<li><a href="../zh-CN500696/index.html">è·‘æ­¥é‹å¦‚ä½•é€‚åº”å¥³æ€§çš„è„š</a></li>
<li><a href="../zh-CN500698/index.html">Evgeny Katyshevï¼šâ€œ OpenStreetMapä¸é€‚åˆä»»ä½•ä¿¡æ¯â€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>