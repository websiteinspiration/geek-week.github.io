<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüëß ü§õüèø ‚è∞ Mikhail Salosin. Golang Meetup. Using Go in the backend of the Watch + application üôçüèΩ üö¥üèª üë®üèΩ‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikhail Salosin (hereinafter - MS): - Hello everyone! My name is Michael. I work as a backend developer at MC2 Software, and I will talk about using G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mikhail Salosin. Golang Meetup. Using Go in the backend of the Watch + application</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/490750/"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Salosin (hereinafter - MS):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hello everyone! </font><font style="vertical-align: inherit;">My name is Michael. </font><font style="vertical-align: inherit;">I work as a backend developer at MC2 Software, and I will talk about using Go in the backend of the Watch + mobile application. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pc/yj/tfpcyjrufa8t1o-_ilgh2iqqb1w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Does anyone present like hockey? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/g7/l_/tdg7l_zyrrg7vw1shoc3fdxywda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then this app is for you. </font><font style="vertical-align: inherit;">It is for Android and iOS, used to watch broadcasts of various sporting events online and in recordings. </font><font style="vertical-align: inherit;">Also in the application there are various statistics, text broadcasts, tables for conferences, tournaments and other information useful for fans. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/cn/fa/pscnfash29d-yqq6ldluvigihoq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also in the application there is such a thing as video moments, that is, you can see the acute moments of matches (goals, fights, shootouts, etc.). </font><font style="vertical-align: inherit;">If you don‚Äôt want to watch the whole broadcast, you can watch only the most interesting.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What was used in development?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The main body was written in Go. The API that the mobile clients communicated with was written in Go. Also, a service was written on Go for sending push notifications to mobile. We also had to write our own ORM, which we may someday talk about. Well, some small services are written on Go: resizing and image uploading for the editors ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We used Postgres (PostgreSQL) as a database. The interface for editors was written in Ruby on Rails using the ActiveAdmin gem. The import of statistics from the statistics provider is also written on Ruby.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For system API tests, we used the Python unittest (Python). </font><font style="vertical-align: inherit;">Memcached is used to throttle API payment requests, Chef to control configuration, Zabbix to collect and monitor internal system statistics. </font><font style="vertical-align: inherit;">Graylog2 - for collecting logs, Slate is an API documentation for clients.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n5/v_/tc/n5v_tcwffefrpa-fxomv5jc_moc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protocol selection</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first problem we encountered: we had to choose a protocol for the interaction of the backend with mobile clients, based on the following points ...</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most important requirement: data on clients must be updated in real time. </font><font style="vertical-align: inherit;">That is, everyone who is currently watching the broadcast should receive updates almost instantly.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For simplicity, we accepted that data that is synchronized with clients is not deleted, but hidden using special flags.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All sorts of rare requests (like statistics, lineups, team statistics) are received by ordinary GET requests.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus, the system was supposed to calmly withstand 100 thousand users at the same time.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Based on this, we had two protocol options:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Websockets. </font><font style="vertical-align: inherit;">But we did not need channels from the client to the server. </font><font style="vertical-align: inherit;">We only needed to send updates from the server to the client, so a web socket is a redundant option.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server-Sent Events (SSE) came up just right! </font><font style="vertical-align: inherit;">It is quite simple and basically satisfies everything that we need.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server-Sent Events</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A few words about how this thing </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
works </font><font style="vertical-align: inherit;">... </font><font style="vertical-align: inherit;">It works on top of the http connection. </font><font style="vertical-align: inherit;">The client sends a request, the server responds with Content-Type: text / event-stream and does not close the connection with the client, but continues to write data to the connection: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0s/qp/5j/0sqp5jdkevts9970rrbpwa0bm9i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data can be sent in a format agreed with the clients. </font><font style="vertical-align: inherit;">In our case, we sent in this form: in the event field the name of the changed structure (person, player) was sent, and in the data field - JSON with new, changed fields for the player. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now about how the interaction itself works.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, the client determines when the last synchronization was made with the service: it looks at its local database and determines the date of the last change recorded from it.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">He sends a request with this date.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In response, we send him all the updates that have occurred on this date.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, he makes a connection to the live channel and does not close until he needs these updates:</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/_v/t9/t1/_vt9t1r7nq_--sskm6vc_-0qydw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We send him a list of changes: if someone scored a goal - we change the score of the match, got injured - also sent in real time. </font><font style="vertical-align: inherit;">Thus, in the event stream of the match, customers instantly receive relevant data. </font><font style="vertical-align: inherit;">Periodically, so that the client understands that the server has not died, that nothing has happened to it, we send a timestamp every 15 seconds - so that it knows that everything is in order and there is no need to reconnect.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How is the live connection served?</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, we create a channel into which updates with a buffer will come.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, we subscribe this channel to receive updates.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set the correct header so that the client knows that everything is ok.</font></font></li>
<li>  ping.    timestamp .</li>
<li>         ,     .       timestamp,  ,       .</li>
</ul><br>
<img src="https://habrastorage.org/webt/rf/hl/s9/rfhls98e0zi4dogfbjpptkb-feg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first problem we encountered was the following: for each connection opened with the client, we created a timer that ticked once every 15 seconds - it turns out if we had 6 thousand connections with one machine (with one API server), 6 thousand timers were created. </font><font style="vertical-align: inherit;">This led to the fact that the machine did not hold the necessary load. </font><font style="vertical-align: inherit;">The problem was not so obvious to us, but they helped us a little, and we eliminated it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, now we have ping coming from the same channel from which update comes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accordingly, there is only one timer that ticks once every 15 seconds. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here are some helper functions - sending the header, ping, and the structure itself. </font><font style="vertical-align: inherit;">That is, the name of the table (person, match, season) and the information about this record are transmitted here:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/g2/rh/qug2rhecowmxbnqmqz7zk5p-_7g.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mechanism for sending updates</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now a little about where the changes come from. </font><font style="vertical-align: inherit;">We have several people, editors, who watch the broadcast in real time. </font><font style="vertical-align: inherit;">They create all the events: someone was removed, someone was injured, some kind of replacement ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the help of CMS, the data gets into the database. </font><font style="vertical-align: inherit;">After that, the database using the Listen / Notify mechanism notifies the API servers about this. </font><font style="vertical-align: inherit;">API servers are already sending this information to clients. </font><font style="vertical-align: inherit;">Thus, in fact, we have only a few servers connected to the database and there is no special load on the database, because the client does not interact directly with the database in any way:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/az/wp/ei/azwpei0ysoe2uspec2ybfe9mdag.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PostgreSQL: Listen / Notify</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Listen / Notify mechanism in Postgres allows you to notify subscribers of events that some event has changed - some kind of record has been created in the database. To do this, we wrote a simple trigger and function: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hj/i_/ms/hji_msz1f-kwrtijbes4flcctr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When inserting or changing a record, we call the notify function on the data_updates channel, transfer the table name and the identifier of the record that was changed or inserted there. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For all tables that should be synchronized with the client, we define a trigger that, after changing / updating the record, calls the function indicated on the slide below. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How does the API subscribe to these changes? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Fanout mechanism is created - it sends messages to the client. He collects all the customer channels and sends out updates that he received through these channels:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kx/op/vl/kxopvlizual_4yyz48t79flo8w8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here the standard pq library, which connects to the database and says that it wants to listen to the channel (data_updates), checks that the connection is open and everything is fine. </font><font style="vertical-align: inherit;">I omit error checking to save space (do not check fraught). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Next, we set the Ticker asynchronously, which will send ping every 15 seconds, and begin to listen to the channel to which we subscribed. </font><font style="vertical-align: inherit;">If we got a ping, we publish this ping. </font><font style="vertical-align: inherit;">If we received a record, then we publish this record to all subscribers of this Fanout.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How does fan-out work?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Russian, this translates as a ‚Äúsplitter‚Äù. We have one object that registers subscribers who want to receive any updates. And as soon as an update to this object arrives, it spreads this update to all subscribers it has. Simple enough: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/tw/76/jetw76q3dzqifpq22yo9dc3j4ha.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
How it is implemented on Go: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/gl/o8/nzglo8wnz5iwzrtjfc39zlqqxa8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a structure, it is synchronized using Mutex's. It has a field that saves the status of the Fanout connection to the database, that is, at the moment it listens and will receive updates, as well as a list of all available channels - map, the key of which is the channel and struct in the form of values ‚Äã‚Äã(in fact, it not used in any way).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Two methods - Connected and Disconnected - allow you to tell Fanout that we have a connection to the base, it appeared and that the connection to the base is disconnected. In the second case, you need to disconnect all clients and tell them that they can no longer listen to anything and that they reconnect, since the connection with them has closed. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also a Subscribe method that adds a channel to listeners: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/hu/rh/i1hurht2d0x5mmdikeem_gpmm3i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is an Unsubscribe method that removes a channel from listeners if the client disconnects, as well as a Publish method that allows you to send a message to all subscribers. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - What is transmitted through this channel? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - A model is transmitted that has changed or ping (essentially just a number, integer). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- You can send anything, publish any structure, it just turns into JSON and that‚Äôs it. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - We get a notification from Postgres - it contains the table name and identifier. </font><font style="vertical-align: inherit;">By the name of the table we get and the identifier we get the record we need, and already this structure is sent for publication.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infrastructure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
What does it look like in terms of infrastructure? We have 7 iron servers: one of them is completely dedicated to the base, virtual computers are spinning on the remaining six. There are 6 copies of the API: each virtual machine with the API runs on a separate iron server - this is for reliability. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/2_/4e/hu2_4eyv8ko_you4ygxuowle6m4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have two frontends on which Keepalived is installed to improve accessibility, so that in case of which one frontend can replace the other. Another two copies of the CMS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is also an importer of statistics. There is a DB Slave from which backups are periodically made. There is Pigeon Pusher - the application that sends pushies to customers, as well as infrastructure things: Zabbix, Graylog2 and Chef.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In fact, this infrastructure is redundant, because 100 thousand can be served with fewer servers. </font><font style="vertical-align: inherit;">But there was iron - we used it (we were told that it is possible - why not).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pros of Go</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After we worked on this application, such obvious advantages of Go were revealed.</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cool http library. </font><font style="vertical-align: inherit;">Using it, you can create quite a lot already out of the box.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus, the channels that allowed us to very easily implement the mechanism for sending notifications to customers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The wonderful Race detector allowed us to eliminate several critical bugs (staging-infrastructure). </font><font style="vertical-align: inherit;">Everything that works on staging is running, compiled with the Race key; </font><font style="vertical-align: inherit;">and, accordingly, we can see what potential problems we have on the staging infrastructure.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimalism and simplicity of language.</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/eb/lc/mo/eblcmow1odoou6z22y2rady3n6k.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are looking for developers! </font><font style="vertical-align: inherit;">If someone wants - please.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Questions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Question from the audience (hereinafter - B): - It seems to me that you missed one important point regarding the Fan-out. I understand correctly that when you send a response to a client, you are blocked if the client does not want to read? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No, we are not blocking. Firstly, we have it all behind nginx, that is, there are no problems with slow clients. Secondly, the client has a channel with a buffer - in fact, we can put up to a hundred updates there ... If we cannot write to the channel, then it deletes it. If we see that the channel is blocked, then we just close the channel, and that‚Äôs it - the client will reconnect if there is any problem. Therefore, in principle, blocking does not occur here. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Could you immediately send to Listen / Notify a record, not an identifier table? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Listen / Notify has a limit of 8 thousand bytes per preload, which it sends. In principle, it would be possible to send if we were dealing with a small amount of data, but it seems to me that the way [as we do] is simply more reliable. Limitations are in Postgres itself. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Do customers receive updates on matches that they are not interested in? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- In general, yes. As a rule, there are 2-3 matches in parallel, and then quite rarely. If the client is watching something, then usually he is watching the match that is going on. Then, on the client there is a local database into which all these updates add up, and even without an Internet connection, the client can see all the past matches for which he has updates. In fact, we synchronize our database on the server with the local database of the client so that it can work offline. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Why did you make your ORM? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexey (one of the developers of ‚ÄúWatch +‚Äù):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- At that time (it was a year ago) ORM was less than now, when there are quite a lot of them. Of the majority of existing ORMs, what I dislike the most is that most of them work on empty interfaces. That is, the methods that in these ORMs are ready to take on anything: structure, structure pointer, number, something irrelevant at all ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our ORM generates structures based on the data model. Itself. And therefore, all methods are concrete, do not use reflection, etc. They accept structures and expect to use the structures that come. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - How many people participated? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - At the initial stage, two people participated. Somewhere in June we started, in August the main part was ready (first version). In September there was a release. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Where you describe SSE, you do not use timeout. Why is that? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - To be honest, SSE is still an html5 protocol: the SSE standard is designed to communicate with browsers, as I understand it. It has additional features so that browsers can reconnect (and so on), but we do not need them, because we had clients that could implement any logic for connecting and receiving information. We did more likely not SSE, but something similar to SSE. This is not the protocol itself. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There was no need. As far as I understand, clients implemented the connection mechanism from scratch. In principle, they didn‚Äôt care. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - What additional utilities did you use? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- The most active we used govet and golint, so that the style was unified, as well as gofmt. They didn‚Äôt use anything else. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - With what did you debug? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - By and large, debugging was done using tests. No debugger, GOP we did not use. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Can you return the slide where the Publish function is implemented? Single-letter variable names do not bother you? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No. They have a fairly "narrow" scope. They are not used anywhere else (except here) (except for the insides of this class), and it is very compact - it takes only 7 lines. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Somehow it‚Äôs still not intuitive ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No, no, this is a real code! It's not about style. It‚Äôs just such a utilitarian, very small class - there are only 3 fields inside the class ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/vb/a8/yxvba8lbupf_3aw2halepbbmlce.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - By and large, all the data that is synchronized with customers (seasonal matches, players) does not change. Roughly speaking, if we are going to do another kind of sport in which it will be necessary to change the match, we will just consider everything in the new version of the client, and the old versions of the client will be banned. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Are there any third-party packages for dependency management? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - We used go dep. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - There was something about the video in the subject of the report, but no about the video in the report. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - No, I have nothing in the topic about the video. It is called ‚ÄúLook +‚Äù - this is the name of the application. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- You said that you are streaming to customers? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - We did not do streaming video. </font><font style="vertical-align: inherit;">This was completely done by Megaphone. </font><font style="vertical-align: inherit;">Yes, I did not say that the application is megaphone. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Go - to send all the data - by score, by match events, statistics ... Go - this is the entire backend for the application. </font><font style="vertical-align: inherit;">The client must find out from somewhere which link to use for the player so that the user can watch the match. </font><font style="vertical-align: inherit;">We have links to videos and streams that are prepared.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Kq0cWRBd1MU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A bit of advertising :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thank you for staying with us. Do you like our articles? Want to see more interesting materials? Support us by placing an order or recommending to your friends </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud-based VPS for developers from $ 4.99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unique analog of entry-level servers that was invented by us for you: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The whole truth about VPS (KVM) E5-2697 v3 (6 Cores) 10GB DDR4 480GB SSD 1Gbps from $ 19 or how to divide the server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (options are available with RAID1 and RAID10, up to 24 cores and up to 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 times cheaper at the Equinix Tier IV data center in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Only we have </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV from $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the Netherlands!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - from $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Read about</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to Build Infrastructure Bldg. </font><font style="vertical-align: inherit;">class c using Dell R730xd E5-2650 v4 servers costing 9,000 euros for a penny?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en490738/index.html">Lisk substitution principle</a></li>
<li><a href="../en490740/index.html">Defecting *** s is not just randomization</a></li>
<li><a href="../en490742/index.html">A new era in robotics has begun</a></li>
<li><a href="../en490746/index.html">Rating in Yandex.Taxi: a short post on a serious topic</a></li>
<li><a href="../en490748/index.html">The task for the developer, or how we scanned hand scanners without a vendor</a></li>
<li><a href="../en490754/index.html">Visual Studio Code Code Editor. The most detailed guide for setting up and installing plugins for beginners</a></li>
<li><a href="../en490756/index.html">Deploy Jenkins as code</a></li>
<li><a href="../en490758/index.html">Mathematicians have proved the universal law of turbulence</a></li>
<li><a href="../en490760/index.html">Ray Casting Visual Search (RCVS). Simple and fast algorithm for finding 3D models similar in geometry</a></li>
<li><a href="../en490762/index.html">How to forecast airfare?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>