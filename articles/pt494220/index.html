<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜë üêß üòì OpenToonz: Por Dentro e Por Fora üôè üî∫ ‚ôüÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quase quatro anos se passaram desde que o PVS-Studio verificou o c√≥digo fonte do OpenToonz. Este projeto √© uma ferramenta muito poderosa para criar an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>OpenToonz: Por Dentro e Por Fora</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/494220/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dea/ccf/6dd/deaccf6dded129be42e3f458e2457c48.png" alt="image1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quase quatro anos se passaram desde que o PVS-Studio verificou o c√≥digo fonte do OpenToonz. </font><font style="vertical-align: inherit;">Este projeto √© uma ferramenta muito poderosa para criar anima√ß√£o bidimensional. </font><font style="vertical-align: inherit;">Desde a √∫ltima verifica√ß√£o, com a ajuda dele, foram criados trabalhos animados como Maria e a Flor das Bruxas, Batman Ninja, Promare e outros. </font><font style="vertical-align: inherit;">Como os grandes est√∫dios continuam usando o Toonz, por que n√£o verificar a qualidade do c√≥digo fonte novamente?</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode se familiarizar com a an√°lise anterior de erros no artigo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo incorreto de um pacote para criar anima√ß√µes 2D do Toonz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Em geral, n√£o parece que a qualidade do c√≥digo tenha melhorado muito; portanto, a impress√£o geral n√£o √© melhor. </font><font style="vertical-align: inherit;">Al√©m disso, muitos dos mesmos erros foram encontrados no artigo anterior. </font><font style="vertical-align: inherit;">N√£o os consideraremos novamente, pois h√° muitas coisas para escolher.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, voc√™ deve entender que a presen√ßa de erros n√£o impede necessariamente o uso ativo e produtivo do produto de software. Muito provavelmente, os erros encontrados est√£o em partes do c√≥digo raramente usadas ou completamente n√£o utilizadas, caso contr√°rio, eles teriam sido identificados no processo de uso do aplicativo e corrigidos. No entanto, isso n√£o significa que a an√°lise est√°tica seja redundante. √â apenas que o significado da an√°lise est√°tica n√£o √© encontrar erros antigos e irrelevantes, mas reduzir o custo do processo de desenvolvimento. Muitos erros ao escrever c√≥digo podem ser detectados imediatamente, e n√£o durante a opera√ß√£o do software. Consequentemente, com o uso regular de um analisador est√°tico, os erros s√£o corrigidos em um est√°gio inicial. Isso economiza tempo dos desenvolvedores e dinheiro da empresa e melhora a percep√ß√£o do produto pelos usu√°rios. Concordo, √© desagrad√°vel cancelar a inscri√ß√£o constantemente para desenvolvedores,que uma coisa ou outra n√£o funciona.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N1 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V610</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comportamento indefinido. </font><font style="vertical-align: inherit;">Verifique o operador de turno '&lt;&lt;'. </font><font style="vertical-align: inherit;">O operando esquerdo '(- 1)' √© negativo.</font></font><br>
<br>
<pre><code class="cpp hljs">decode_mcu_AC_refine (j_decompress_ptr cinfo, JBLOCKROW *MCU_data)<font></font>
{<font></font>
  <span class="hljs-keyword">int</span> p1, m1;<font></font>
  p1 = <span class="hljs-number">1</span> &lt;&lt; cinfo-&gt;Al;    <font></font>
  m1 = (<span class="hljs-number">-1</span>) &lt;&lt; cinfo-&gt;Al; <font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o est√° claro o que o autor do c√≥digo queria alcan√ßar aqui. </font><font style="vertical-align: inherit;">Usar operadores de turno com n√∫meros negativos leva a um comportamento indefinido. </font><font style="vertical-align: inherit;">A maneira como o comportamento dos operadores de turno √© descrito no padr√£o parece um pouco confuso √† primeira vista, mas ainda assim verifique: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. O tipo de resultado √© o do operando esquerdo promovido. </font><font style="vertical-align: inherit;">O comportamento √© indefinido se o operando direito for negativo ou maior ou igual ao comprimento em bits do operando esquerdo promovido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. O valor de E1 &lt;&lt; E2 √© E1 com posi√ß√µes de bits E2 com deslocamento √† esquerda; bits desocupados s√£o preenchidos com zero. Se E1 tiver um tipo n√£o assinado, o valor do resultado ser√° E1 * 2 ^ E2, m√≥dulo reduzido um a mais que o valor m√°ximo represent√°vel no tipo de resultado. Caso contr√°rio, se E1 tiver um tipo assinado e um valor n√£o negativo, e E1 * 2 ^ E2 for represent√°vel no tipo de resultado, esse ser√° o valor resultante; caso contr√°rio, o comportamento √© indefinido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o comportamento n√£o √© definido se o operando direito ou esquerdo tiver um valor negativo. Se o operando for do tipo assinado, com valor n√£o negativo e se encaixar no tipo resultante, o comportamento ser√° normal. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N2 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V517</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O uso do padr√£o 'if (A) {...} else if (A) {...}' foi detectado. </font><font style="vertical-align: inherit;">H√° uma probabilidade de presen√ßa de erro l√≥gico. </font><font style="vertical-align: inherit;">Verifique as linhas: 156, 160. cameracapturelevelcontrol.cpp 156</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CameraCaptureLevelHistogram::mousePressEvent</span><span class="hljs-params">(QMouseEvent* event)</span> </span>{
  <span class="hljs-keyword">if</span> (event-&gt;button() != Qt::LeftButton) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (m_currentItem == Histogram) {<font></font>
    m_histogramCue = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (m_currentItem == None) <span class="hljs-keyword">return</span>;<font></font>
  QPoint pos = event-&gt;pos();<font></font>
  <span class="hljs-keyword">if</span> (m_currentItem == BlackSlider)  <span class="hljs-comment">// &lt;=</span><font></font>
    m_offset = pos.x() - SIDE_MARGIN - m_black;<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_currentItem == GammaSlider)<font></font>
    m_offset = pos.x() - SIDE_MARGIN - gammaToHPos(m_gamma, m_black, m_white);<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_currentItem == BlackSlider)  <span class="hljs-comment">// &lt;=</span><font></font>
    m_offset = pos.x() - SIDE_MARGIN - m_white;<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_currentItem == ThresholdSlider)<font></font>
    m_offset = pos.x() - SIDE_MARGIN - m_threshold;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_offset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recebe valores diferentes, dependendo do valor de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_currentItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No entanto, duplicar a verifica√ß√£o no </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BlackSlider √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in√∫til e, a partir do corpo da condi√ß√£o, voc√™ pode ver que a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_white</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est√° envolvida no c√°lculo </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vejamos os valores poss√≠veis para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_currentItem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cpp hljs">  LevelControlItem m_currentItem;<font></font>
<font></font>
  <span class="hljs-keyword">enum</span> LevelControlItem {<font></font>
    None = <span class="hljs-number">0</span>,<font></font>
    BlackSlider,<font></font>
    WhiteSlider,<font></font>
    GammaSlider,<font></font>
    ThresholdSlider,<font></font>
    Histogram,<font></font>
    NumItems<font></font>
  };</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/664/caa/09b/664caa09b6eca7a582ae4441c232e61e.png" alt="image3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Acontece que o valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WhiteSlider</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamb√©m √© </font><i><font style="vertical-align: inherit;">poss√≠vel</font></i><font style="vertical-align: inherit;"> , para o qual a verifica√ß√£o simplesmente n√£o √© realizada. </font><font style="vertical-align: inherit;">Portanto, √© perfeitamente poss√≠vel que alguns dos cen√°rios de comportamento tenham sido perdidos devido a um erro de copiar e colar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N3 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V517</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O uso do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">padr√£o</font></a><font style="vertical-align: inherit;"> 'if (A) {...} else if (A) {...}' foi detectado. </font><font style="vertical-align: inherit;">H√° uma probabilidade de presen√ßa de erro l√≥gico. </font><font style="vertical-align: inherit;">Verifique as linhas: 784, 867. tpalette.cpp 784</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TPalette::loadData</span><span class="hljs-params">(TIStream &amp;is)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> tagName;
  <span class="hljs-keyword">while</span> (is.openChild(tagName)) {
    <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"version"</span>) {<font></font>
      ....<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"stylepages"</span>) { <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">while</span> (!is.eos()) {
        <span class="hljs-keyword">if</span> (....){<font></font>
          ....<font></font>
        }<font></font>
        ....<font></font>
        is.closeChild();<font></font>
        }<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"refImgPath"</span>) {<font></font>
      ....<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"animation"</span>) {<font></font>
      ....<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"stylepages"</span>) { <span class="hljs-comment">// &lt;=</span>
      <span class="hljs-keyword">int</span> key = <span class="hljs-string">'0'</span>;
      <span class="hljs-keyword">while</span> (!is.eos()) {
        <span class="hljs-keyword">int</span> styleId = <span class="hljs-number">0</span>;<font></font>
        ....<font></font>
      }<font></font>
    } <font></font>
      ....<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro erro semelhante. </font><font style="vertical-align: inherit;">Aqui, as mesmas condi√ß√µes t√™m corpos diferentes, mas n√£o √© </font><font style="vertical-align: inherit;">mais </font><font style="vertical-align: inherit;">poss√≠vel concluir sobre as op√ß√µes poss√≠veis para o valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tagName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Provavelmente, apenas alguma op√ß√£o foi perdida e, no final, temos um c√≥digo que nunca ser√° executado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O fragmento N4 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V547 A</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> express√£o 'n√∫mero da conta == 2' √© sempre verdadeira. </font><font style="vertical-align: inherit;">psd.cpp 720</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TPSDReader::readImageData</span><span class="hljs-params">(...., <span class="hljs-keyword">int</span> chancount)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (depth == <span class="hljs-number">1</span> &amp;&amp; chancount == <span class="hljs-number">1</span>) { <span class="hljs-comment">// &lt;= 1</span><font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depth == <span class="hljs-number">8</span> &amp;&amp; chancount &gt; <span class="hljs-number">1</span>) {<font></font>
    ....<font></font>
    <span class="hljs-keyword">for</span> (....) {
      <span class="hljs-keyword">if</span> (chancount &gt;= <span class="hljs-number">3</span>) {<font></font>
        ....<font></font>
        <span class="hljs-keyword">if</span> (chancount == <span class="hljs-number">4</span>)  <font></font>
          ....<font></font>
        <span class="hljs-keyword">else</span><font></font>
          ....<font></font>
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (chancount &lt;= <span class="hljs-number">2</span>)  <span class="hljs-comment">// &lt;= 2</span><font></font>
      {<font></font>
        ....<font></font>
        <span class="hljs-keyword">if</span> (chancount == <span class="hljs-number">2</span>) <span class="hljs-comment">// &lt;= 3</span><font></font>
          ....<font></font>
        <span class="hljs-keyword">else</span><font></font>
          ....<font></font>
      }<font></font>
      ....<font></font>
    }<font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m_headerInfo.depth == <span class="hljs-number">8</span> &amp;&amp; chancount == <span class="hljs-number">1</span>) {<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um pequeno erro l√≥gico entrou nessas verifica√ß√µes. </font><font style="vertical-align: inherit;">No teste sob o n√∫mero um, o n√∫mero de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canais √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comparado com 1 e no n√∫mero de teste 2, √© verificado se essa vari√°vel √© menor ou igual a 2. Como resultado, o √∫nico valor poss√≠vel do n√∫mero de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canais</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© 2 </font><font style="vertical-align: inherit;">para a condi√ß√£o sob o n√∫mero </font><font style="vertical-align: inherit;">3. Esse erro pode n√£o levar √† opera√ß√£o incorreta do programa, mas complica a leitura e a compreens√£o do c√≥digo. </font><font style="vertical-align: inherit;">Por exemplo, n√£o est√° claro por que o ramo else ent√£o ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, a fun√ß√£o considerada neste fragmento ocupa pouco mais de 300 linhas de c√≥digo e consiste em montes de condi√ß√µes e loops.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/725/c28/39a/725c2839a5774ec76b0143ec64531fda.png" alt="image4.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N5 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V614</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vari√°vel n√£o inicializada 'precSegmentIndex' usada. </font><font style="vertical-align: inherit;">Considere verificar o quinto argumento real da fun√ß√£o 'insertBoxCorners'. </font><font style="vertical-align: inherit;">rasterselection.cpp 803</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">TStroke <span class="hljs-title">getIntersectedStroke</span><span class="hljs-params">(TStroke &amp;stroke, TRectD bbox)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> precSegmentIndex, currentSegmentIndex, startSegmentIndex,<font></font>
      precChunkIndex = <span class="hljs-number">-1</span>;<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (....) {<font></font>
    insertBoxCorners(bbox, points, outPoints, currentSegmentIndex,<font></font>
                     precSegmentIndex);<font></font>
    ....<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertBoxCorners</span><span class="hljs-params">(...., <span class="hljs-keyword">int</span> currentSegmentIndex, <span class="hljs-keyword">int</span> precSegmentIndex)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">bool</span> sameIndex = (precSegmentIndex == currentSegmentIndex);<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> segmentIndex = precSegmentIndex;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez um erro tenha sido cometido aqui, mesmo durante a inicializa√ß√£o das vari√°veis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precSegmentIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">currentSegmentIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startSegmentIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precChunkIndex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O desenvolvedor pode esperar que a inicializa√ß√£o do √∫ltimo elemento -1 seja inicializada com o mesmo valor que outras vari√°veis ‚Äã‚Äãdeclaradas na mesma linha. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N6 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V590</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Considere inspecionar a </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">express√£o</font></a><font style="vertical-align: inherit;"> 's! = "" &amp;&amp; s == "color"'. </font><font style="vertical-align: inherit;">A express√£o √© excessiva ou cont√©m uma impress√£o incorreta. </font><font style="vertical-align: inherit;">cleanupparameters.cpp 416</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CleanupParameters::loadData</span><span class="hljs-params">(TIStream &amp;is, <span class="hljs-keyword">bool</span> globalParams)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> s = is.getTagAttribute(<span class="hljs-string">"sharpness"</span>);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (....)<font></font>
  {<font></font>
    ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"lineProcessing"</span>)<font></font>
    ....<font></font>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-string">""</span> &amp;&amp; isDouble(s)) <font></font>
      ....<font></font>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-string">""</span> &amp;&amp; isDouble(s))<font></font>
      ....<font></font>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-string">""</span> &amp;&amp; s == <span class="hljs-string">"color"</span>) <span class="hljs-comment">// &lt;=</span><font></font>
      ....<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName == <span class="hljs-string">"despeckling"</span>) {<font></font>
    ....  <font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse erro, mesmo uma falha, leva em si apenas a uma compara√ß√£o desnecess√°ria. </font><font style="vertical-align: inherit;">No entanto, se observarmos o c√≥digo como um todo, ficar√° claro que a compara√ß√£o extra apareceu como resultado da c√≥pia e colagem das condi√ß√µes anteriores.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bcc/077/857/bcc077857a8341d45e6fcf504129353c.png" alt="image5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse macarr√£o, que ocupa dezenas ou mais linhas de c√≥digo, pode muito bem conter outros erros de l√≥gica, e sua pesquisa com essa formata√ß√£o pode se transformar em tormento. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N7 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V772</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chamar um operador 'delete' para um ponteiro nulo causar√° um comportamento indefinido. </font><font style="vertical-align: inherit;">pluginhost.cpp 1327</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_interface</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *interf)</span> </span>{
  <span class="hljs-keyword">if</span> (interf) <span class="hljs-keyword">delete</span> interf;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, a pr√≥pria mensagem do analisador j√° √© bastante exaustiva: chamar o operador de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclus√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em um ponteiro para um tipo de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nulo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> leva a um comportamento indefinido. </font><font style="vertical-align: inherit;">Se uma fun√ß√£o universal fosse necess√°ria para remover interfaces, pode valer a pena torn√°-la um padr√£o.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;class T&gt;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release_interface</span><span class="hljs-params">(T *interf)</span> </span>{
  <span class="hljs-keyword">if</span> (interf) <span class="hljs-keyword">delete</span> interf;<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N8 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √â estranho que o operador 'sizeof ()' avalie o tamanho de um ponteiro para uma classe, mas n√£o o tamanho do objeto de classe 'm_xshHandle'. </font><font style="vertical-align: inherit;">tstageobjectcmd.cpp 455</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DVAPI</span> <span class="hljs-title">TStageObjectParams</span> {</span><font></font>
  ....<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RemovePegbarNodeUndo</span> <span class="hljs-title">final</span> :</span> <span class="hljs-keyword">public</span> TUndo {<font></font>
  ....<font></font>
  TXsheetHandle *m_xshHandle;<font></font>
<font></font>
<span class="hljs-keyword">public</span>:
  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">sizeof</span> *<span class="hljs-keyword">this</span> + <span class="hljs-keyword">sizeof</span>(TStageObjectParams) + <span class="hljs-keyword">sizeof</span>(m_xshHandle);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erro </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">bastante comum</font></a><font style="vertical-align: inherit;"> que pode ocorrer por desaten√ß√£o e ignor√¢ncia. </font><font style="vertical-align: inherit;">Aqui, muito provavelmente, o assunto foi desatento, uma vez que, no primeiro mandato, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi desreferenciado. </font><font style="vertical-align: inherit;">Se voc√™ precisar do tamanho de um objeto, lembre-se sempre de que o ponteiro de um objeto deve ser desreferenciado. </font><font style="vertical-align: inherit;">Caso contr√°rio, apenas obtemos o tamanho do ponteiro em si.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">return</span> <span class="hljs-keyword">sizeof</span> *<span class="hljs-keyword">this</span> + <span class="hljs-keyword">sizeof</span>(TStageObjectParams) + <span class="hljs-keyword">sizeof</span>(*m_xshHandle);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N9 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √â estranho que o operador 'sizeof ()' avalie o tamanho de um ponteiro para uma classe, mas n√£o o tamanho do objeto de classe 'this'. </font><font style="vertical-align: inherit;">shaderfx.cpp 107</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">RectF</span> {</span>
  GLfloat m_val[<span class="hljs-number">4</span>];<font></font>
  ....<font></font>
  <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> RectF &amp;rect) <span class="hljs-keyword">const</span> {
    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">memcmp</span>(m_val, rect.m_val, <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">this</span>)) == <span class="hljs-number">0</span>);<font></font>
  }<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui, obviamente, eles esqueceram de desreferenciar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ponteiro </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como resultado, obtemos n√£o o tamanho do objeto, mas o tamanho do ponteiro. </font><font style="vertical-align: inherit;">Como resultado, apenas os primeiros 4 ou 8 bytes s√£o comparados (dependendo da profundidade dos bits). </font><font style="vertical-align: inherit;">A vers√£o correta do c√≥digo:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">return</span> (<span class="hljs-built_in">memcmp</span>(m_val, rect.m_val, <span class="hljs-keyword">sizeof</span>(*<span class="hljs-keyword">this</span>)) == <span class="hljs-number">0</span>);</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N10 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V554</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Uso incorreto de unique_ptr. </font><font style="vertical-align: inherit;">A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'. </font><font style="vertical-align: inherit;">screensavermaker.cpp 29</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">makeScreenSaver</span><span class="hljs-params">(TFilePath scrFn, TFilePath swfFn,
                     <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> screenSaverName)</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">stat</span> <span class="hljs-title">results</span>;</span><font></font>
....<font></font>
  <span class="hljs-keyword">int</span> swfSize = results.st_size;
  <span class="hljs-function"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;<span class="hljs-keyword">char</span>&gt; <span class="hljs-title">swf</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[swfSize])</span></span>;<font></font>
....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â frequentemente esquecido que o tipo pelo qual unique_ptr √© instanciado depende se delete ou delete [] ser√° usado. Como resultado, se voc√™ instanciar o ponteiro como no fragmento em considera√ß√£o, ao alocar mem√≥ria atrav√©s de um novo [], pode ocorrer um comportamento indefinido, pois a libera√ß√£o ocorrer√° atrav√©s da exclus√£o. Para evitar isso, voc√™ precisa adicionar colchetes ao tipo de ponteiro: std :: unique_ptr &lt;char []&gt;. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N11 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V521</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tais express√µes usando o operador ',' s√£o perigosas. Certifique-se de que a express√£o 'm_to, m_de = it-&gt; first.getNumber ()' esteja correta. flipbook.cpp 509</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadImagesPopup</span> <span class="hljs-title">final</span> :</span> <span class="hljs-keyword">public</span> FileBrowserPopup {<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> m_from, m_to, ....;<font></font>
  ....<font></font>
}<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">LoadImagesPopup::onFilePathClicked</span><span class="hljs-params">(....)</span> </span>{<font></font>
  TLevel::Iterator it;<font></font>
  ....<font></font>
  it = level-&gt;begin();<font></font>
  m_to, m_from = it-&gt;first.getNumber();  <span class="hljs-comment">// &lt;=</span>
  <span class="hljs-keyword">for</span> (; it != level-&gt;end(); ++it) m_to = it-&gt;first.getNumber();<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (m_from == <span class="hljs-number">-2</span> &amp;&amp; m_to == <span class="hljs-number">-2</span>) m_from = m_to = <span class="hljs-number">1</span>;<font></font>
<font></font>
  m_minFrame = m_from;<font></font>
  m_maxFrame = m_to;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez o programador esperasse que voc√™ pudesse atribuir um valor a v√°rias vari√°veis ‚Äã‚Äãsimplesmente escrevendo-as com uma v√≠rgula. No entanto, o operador "," no C ++ funciona de maneira diferente. Nele, o primeiro operando √© executado e o resultado √© "redefinido", e o segundo operando √© calculado. E, embora a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_to seja</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inicializada em um ciclo subsequente, se algo der errado ou algu√©m refatorar incorretamente, √© poss√≠vel que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_to</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o receba um valor. E, em geral, em qualquer caso, esse c√≥digo parece estranho. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N12 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V532</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Considere </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">examinar</font></a><font style="vertical-align: inherit;"> a instru√ß√£o do padr√£o '* pointer ++'. Provavelmente significava: '(* ponteiro) ++'. trop.cpp 140</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-title">class</span> <span class="hljs-title">Q</span>&gt;
<span class="hljs-title">void</span> <span class="hljs-title">doGammaCorrect</span>(<span class="hljs-title">TRasterPT</span>&lt;T&gt; <span class="hljs-title">raster</span>, <span class="hljs-title">double</span> <span class="hljs-title">gamma</span>) {</span>
  <span class="hljs-function">Gamma_Lut&lt;Q&gt; <span class="hljs-title">lut</span><span class="hljs-params">(....)</span></span>;<font></font>
<font></font>
  <span class="hljs-keyword">int</span> j;
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; raster-&gt;getLy(); j++) {<font></font>
    T *pix    = raster-&gt;pixels(j);<font></font>
    T *endPix = pix + raster-&gt;getLx();<font></font>
    <span class="hljs-keyword">while</span> (pix &lt; endPix) {<font></font>
      pix-&gt;r = lut.m_table[pix-&gt;r];<font></font>
      pix-&gt;b = lut.m_table[pix-&gt;b];<font></font>
      pix-&gt;g = lut.m_table[pix-&gt;g];<font></font>
      *pix++; <span class="hljs-comment">// &lt;=</span><font></font>
    }<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma pequena falha, que pode confundir ainda mais a pessoa que est√° lendo o c√≥digo. O incremento, como pretendido, muda o ponteiro. No entanto, ap√≥s isso, h√° uma desreferencia√ß√£o sem sentido. Melhor escrever apenas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pix ++</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N13 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V773</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A fun√ß√£o foi encerrada sem liberar o ponteiro 'autoCloseUndo'. √â poss√≠vel um vazamento de mem√≥ria. vectortapetool.cpp 575</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">joinLineToLine</span><span class="hljs-params">(....)</span> </span>{<font></font>
  ....<font></font>
  UndoAutoclose *autoCloseUndo = <span class="hljs-number">0</span>;<font></font>
  ....<font></font>
  autoCloseUndo = <span class="hljs-keyword">new</span> UndoAutoclose(....);<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<font></font>
  ....<font></font>
  TUndoManager::manager()-&gt;add(autoCloseUndo);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Havia mais de 20 avisos desse tipo. Freq√ºentemente, em algum lugar no final da fun√ß√£o, a mem√≥ria √© liberada, mas para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorno</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anterior, </font><font style="vertical-align: inherit;">essa etapa necess√°ria √© ignorada. Ent√£o √© aqui. No final, o ponteiro √© passado para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TUndoManager :: manager () -&gt; add ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que cuida da exclus√£o do ponteiro, mas h√° um </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorno</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acima </font><font style="vertical-align: inherit;">para o qual voc√™ esqueceu de chamar esse m√©todo. Portanto, sempre vale a pena lembrar seus ponteiros sempre que voc√™ sair da fun√ß√£o e n√£o apenas digitar a exclus√£o em algum lugar no final do bloco ou antes do √∫ltimo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retorno</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, se, para uma vers√£o abreviada do c√≥digo, esse erro parecer √≥bvio, ent√£o, em c√≥digo real e mais complicado, rastrear esse problema pode ser dif√≠cil. Aqui, o analisador est√°tico, sempre cansado, ajudar√°. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N14 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522 A</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desreferencia√ß√£o do ponteiro nulo 'regi√£o' pode ocorrer. palettecmd.cpp 94</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isStyleUsed</span><span class="hljs-params">(<span class="hljs-keyword">const</span> TVectorImageP vi, <span class="hljs-keyword">int</span> styleId)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">int</span> regionCount = vi-&gt;getRegionCount();
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; regionCount; i++) {<font></font>
    TRegion *region = vi-&gt;getRegion(i);<font></font>
    <span class="hljs-keyword">if</span> (region || region-&gt;getStyle() != styleId) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, podemos assumir que o desenvolvedor misturou as regras da avalia√ß√£o de curto-circuito e pensou que, se a primeira verifica√ß√£o do ponteiro retornar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falsa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a desreferencia√ß√£o de um ponteiro nulo n√£o ocorrer√°. No entanto, para o operador "||" √© exatamente o contr√°rio. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragmento N15 </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V561</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Provavelmente √© melhor atribuir valor √† vari√°vel 'ca' do que declar√°-lo novamente. Declara√ß√£o anterior: xshcellmover.cpp, linha 319. xshcellmover.cpp 323 </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V561</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Provavelmente √© melhor atribuir valor √† vari√°vel 'cb' do que declar√°-lo novamente. Declara√ß√£o anterior: xshcellmover.cpp, linha 320. xshcellmover.cpp 324xshcellmover.cpp 323</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">redo</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{
  <span class="hljs-keyword">int</span> ca       = m_cellsMover.getStartPos().x;
  <span class="hljs-keyword">int</span> cb       = m_cellsMover.getPos().x;<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (!m_cellsMover.getOrientation()-&gt;isVerticalTimeline()) {
    <span class="hljs-keyword">int</span> ca = m_cellsMover.getStartPos().y;
    <span class="hljs-keyword">int</span> cb = m_cellsMover.getPos().y;<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (ca != cb) {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Talvez outra c√≥pia e colagem, mas com uma ess√™ncia n√£o muito comum do erro. A chamada para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foi substitu√≠da por </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas eles esqueceram de remover o tipo da vari√°vel no in√≠cio da linha, devido ao qual ocorre o reporte local. Como resultado, em vez de alterar a orienta√ß√£o da posi√ß√£o para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inicial </font><font style="vertical-align: inherit;">, novos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> locais </font><i><font style="vertical-align: inherit;">s√£o criados</font></i><font style="vertical-align: inherit;"> , com os quais nada acontece mais. Mas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ca</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> externos </font><font style="vertical-align: inherit;">continuam a existir com valores para </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o N1</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No processo de escrever o artigo, tornou-se interessante para mim cutucar e tentar fazer algo neste programa. </font><font style="vertical-align: inherit;">Talvez eu tive sorte, mas o comportamento estranho n√£o tarda em chegar: cair, exposi√ß√£o minha manipula√ß√£o do comprimido ap√≥s a flacidez ea pra√ßa estranho pressionando </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as teclas Ctrl + Z</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Infelizmente, n√£o pude repetir esse comportamento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35d/a67/350/35da67350bc54eb9cbada817d91a04c8.png" alt="image6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, de fato, apesar desse comportamento e instilando o h√°bito de pressionar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ctrl + S</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> regularmente </font><font style="vertical-align: inherit;">, o OpenToonz impressiona com sua escala e funcionalidade. </font><font style="vertical-align: inherit;">Ainda assim, n√£o √© em v√£o que os grandes est√∫dios tamb√©m o usam. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E minha arte como um b√¥nus:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e88/a95/8e3/e88a958e3dd8c85b3894de88f140b7e0.gif" alt="image7.gif"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o N2</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No caso do OpenToonz, √© √≥bvio que tentar corrigir todos os erros detectados pelo analisador de uma s√≥ vez ser√° uma grande tarefa que interromper√° o processo de desenvolvimento. </font><font style="vertical-align: inherit;">Para esses casos, existe a abordagem "Supress√£o de massa", quando a d√≠vida t√©cnica √© inserida na base de supressores do analisador e o trabalho adicional com o analisador √© realizado com base em novas respostas. </font><font style="vertical-align: inherit;">Bem, se o tempo aparecer, voc√™ poder√° resolver a d√≠vida t√©cnica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Lembro que os desenvolvedores de projetos de c√≥digo aberto podem usar a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">op√ß√£o de licenciamento gratuita PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link da tradu√ß√£o: Victoria Khanieva. </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">OpenToonz</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt494202/index.html">Classifica√ß√£o dos distritos de Moscou por pre√ßo de aluguel com Python</a></li>
<li><a href="../pt494204/index.html">Bloco de notas com um oscilosc√≥pio e um gerador de frequ√™ncia (placa de som)</a></li>
<li><a href="../pt494206/index.html">Os problemas biol√≥gicos da corre√ß√£o de bugs</a></li>
<li><a href="../pt494210/index.html">Instale o Ubuntu no Microsoft Surface Pro</a></li>
<li><a href="../pt494214/index.html">Como o coronav√≠rus ajuda os gigantes de TI a dominar o mundo</a></li>
<li><a href="../pt494222/index.html">Voc√™ parou de trabalhar em quarentena?</a></li>
<li><a href="../pt494224/index.html">Todas as estradas levam ao Fullstack</a></li>
<li><a href="../pt494226/index.html">Posi√ß√£o acordada</a></li>
<li><a href="../pt494228/index.html">Impress√£o 3D na cria√ß√£o do Boeing 777</a></li>
<li><a href="../pt494230/index.html">AI vs. COVID-19: Experi√™ncia em Hubei e na Fl√≥rida</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>