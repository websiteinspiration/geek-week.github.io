<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👦‍👦 🕛 ⛲️ WebGPUアプリケーション開発 😚 🖲️ 👩‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebGPUは、コンピューターグラフィックスで動作するように設計された最新のAPIの 1つです。他の同様のAPIには、Vulkan、DirectX 12、およびMetalが含まれます。このようなソリューションがWebグラフィックの分野に登場するという事実は、Webアプリケーションのユーザーに、通常の...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>WebGPUアプリケーション開発</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/485644/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebGPUは</font><font style="vertical-align: inherit;">、コンピューターグラフィックスで動作</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように設計され</font><font style="vertical-align: inherit;">た最新の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">APIの</font></a><font style="vertical-align: inherit;"> 1つです</font><font style="vertical-align: inherit;">。他の同様のAPIには、Vulkan、DirectX 12、およびMetalが含まれます。このようなソリューションがWebグラフィックの分野に登場するという事実は、Webアプリケーションのユーザーに、通常のアプリケーションのユーザーと同じ機会を与えます。つまり、これはビデオアクセラレータの使用によりプログラムの速度が向上することであり、グラフィックスドライバーによって引き起こされる問題の数が減少することです。これは、Webアプリケーションの新機能の出現です。このような機能は、高度なブラウザ機能と</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仕様の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">両方に依存できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/oc/uo/kn/ocuoknino3wuuyp1ilf1otn0sn0.jpeg"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebGPU向けの開発は、気の弱い人のための活動ではないことを言わなければなりません。</font><font style="vertical-align: inherit;">これは、Web上で利用できる最も洗練されたグラフィカルAPIの1つです。</font><font style="vertical-align: inherit;">しかし、開発に伴う不便さは、WebGPUの使用が生産性の向上を意味し、これが標準であること、つまり将来的にはどこにも行かないことを期待できるという事実によって平準化されます。</font><font style="vertical-align: inherit;">WebGPU仕様はまだ開発中です。</font><font style="vertical-align: inherit;">したがって、以下で説明する内容は、時間とともに変化する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、WebGPUの可能性を習得しながら、TypeScriptでHello Triangleアプリケーションを開発します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここに</font><font style="vertical-align: inherit;">、WebGPUの使用を開始するために必要なすべてを見つけることができる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります。</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仕事の準備</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebGPUアプリケーションの開発の準備をするには、以下をインストールする必要があります。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chromiumベースのブラウザー（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Edge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">や</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Chromeなど</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">カナリアビルド</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ブラウザをインストールした後、ページにアクセスし</font></font><code>&lt;browsername&gt;://flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（たとえば、- </font></font><code>chrome://flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font></font><code>edge://flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、フラグを有効にする必要があります</font></font><code>unsafe-webgpu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ギット</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></a></li>
<li><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">VS Codeの</font></a><font style="vertical-align: inherit;">ようなコードエディター</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、任意の端末で、少なくとも統合VS Code端末で、次のコマンドを入力する必要があります。</font></font><br>
<br>
<pre><code class="plaintext hljs">#  <font></font>
git clone https://github.com/alaingalvan/webgpu-seed<font></font>
<font></font>
#   <font></font>
cd webgpu-seed<font></font>
<font></font>
#   <font></font>
npm start</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、必要に応じて、Node.js、パッケージなどの詳細を確認できる資料を入手してください。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのアーキテクチャ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの複雑さが増すにつれ、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンピュータゲームエンジン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または</font><font style="vertical-align: inherit;">リアルタイム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ツールの</font><font style="vertical-align: inherit;">ファイルが通常整理される方法でファイルを整理することが必要になる場合があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これが私たちのプロジェクトの仕組みです：</font></font><br>
<br>
<pre><code class="plaintext hljs">├─ node_modules/ &nbsp; # <font></font>
│&nbsp; ├─ gl-matrix&nbsp; &nbsp; &nbsp; #  <font></font>
│&nbsp; └─ ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #   (TypeScript, Webpack,   .)<font></font>
├─ src/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #    <font></font>
│&nbsp; ├─ renderer.ts&nbsp; &nbsp; #   <font></font>
│&nbsp; └─ main.ts&nbsp; &nbsp; &nbsp; &nbsp; #   <font></font>
├─ .gitignore&nbsp; &nbsp; &nbsp; # ,      git-<font></font>
├─ package.json&nbsp; &nbsp; #   Node.js-<font></font>
├─ license.md&nbsp; &nbsp; &nbsp; # <font></font>
└─ readme.md &nbsp; &nbsp; &nbsp; #  readme</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
依存関係：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gl-matrix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、GLSLで記述されたコードと同様のJSコードを記述できるJavaScriptライブラリです。</font><font style="vertical-align: inherit;">これは、ベクトル、行列、およびその他のオブジェクトのタイプを提供します。</font><font style="vertical-align: inherit;">このライブラリはこの例では使用されていませんが、より深刻なアプリケーションをプログラミングするときに非常に役立ちます。</font><font style="vertical-align: inherit;">たとえば、カメラを制御するための行列を作成する場合。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TypeScript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はJavaScript言語の型付きスーパーセットであり、その使用により、コード補完機能と型チェック機能により、Webアプリケーションの作成が簡素化されます。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webpack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、コンパクトなコードファイルを作成し、アプリケーションテストを簡略化できるJavaScriptプロジェクトビルドツールです。</font></font></li>
</ul><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトの概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これから作成するアプリケーションでは、次の手順を実行する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIの初期化。</font><font style="vertical-align: inherit;">オブジェクトが存在するかどうかを確認し、存在する</font></font><code>navigator.gpu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合はそこから要求し</font></font><code>GPUAdapter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、次に</font><font style="vertical-align: inherit;">要求し</font><font style="vertical-align: inherit;">、その後</font><font style="vertical-align: inherit;">デフォルトで使用されて</font></font><code>GPUDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いる</font></font><code>GPUQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存のデバイスの</font><font style="vertical-align: inherit;">オブジェクトを取得する必要があり</font><font style="vertical-align: inherit;">ます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレーム形成の補助メカニズムの構成。</font><font style="vertical-align: inherit;">現在のフレーム</font></font><code>GPUSwapchain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を受信する</font></font><code>GPUTexture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ための</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">、および-他のアタッチメント（深度テクスチャなど）</font><font style="vertical-align: inherit;">を受信する</font><font style="vertical-align: inherit;">ための</font><font style="vertical-align: inherit;">作成</font><font style="vertical-align: inherit;">。</font></font><code>GPUTextureView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テクスチャを一致させるための</font><font style="vertical-align: inherit;">オブジェクト</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成します</font><font style="vertical-align: inherit;">。</font></font></li>
<li> .   <code>GPUBuffer</code>    ,       SPIR-V     SPIR-V-   <code>GPUShaderModule</code>.   <code>GPURenderPipeline</code>      . , ,  <code>GPUCommandEncoder</code>   ,   ,   —  <code>GPURenderPassEncoder</code>     ,        .</li>
<li>.    <code>GPUCommandEncoder</code>      .<code>finish()</code>    <code>GPUQueue</code>.          <code>requestAnimationFrame</code>.</li>
<li> .         API.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例に移りましょう。</font><font style="vertical-align: inherit;">ここではコードスニペットを使用します。そのフルバージョンは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリにあります。</font><font style="vertical-align: inherit;">ここでは、さらに、クラスメンバー変数（一種の</font></font><code>this.memberVariable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）が、キーワードを使用せずにクラス内で宣言されています</font></font><code>.this</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、タイプを簡単に把握できます。</font><font style="vertical-align: inherit;">さらに、ここに示した例はそれ自体で機能するという事実につながります。</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIの初期化</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍入力点</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4a/16c/44a/f4a16c44abec4328723511f68f034441.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebGPU APIにアクセスするに</font></font><code>gpu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、グローバルオブジェクト内の</font><font style="vertical-align: inherit;">オブジェクトの存在を確認する必要があり</font><font style="vertical-align: inherit;">ます</font></font><code>navigator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">対応するTypeScriptコードは次のとおりです。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    WebGPU<font></font>
const entry: GPU = navigator.gpu;<font></font>
if (!entry) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;throw new Error('WebGPU is not supported on this browser.')<font></font>
}</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍アダプター</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c4/1c3/0d4/3c41c30d428260de6fef51360516272d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクト</font></font><code>GPUAdapter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、名前、拡張機能、デバイス制限など、特定のGPUの物理プロパティを記述します。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
let adapter: GPUAdapter = null;<font></font>
<font></font>
//   ...<font></font>
<font></font>
//   <font></font>
adapter = await entry.requestAdapter();</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍デバイス</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/340/f2b/d29/340f2bd299a3cbe4abac3dc562399204.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タイプのオブジェクトは</font></font><code>GPUDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">論理デバイスを表し、WebGPU APIの主な機能へのアクセスを提供し、必要なデータ構造を作成できるようにします。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
let device: GPUDevice = null;<font></font>
<font></font>
//   ...<font></font>
<font></font>
<font></font>
//  <font></font>
device = await adapter.requestDevice();</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍キュー</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/428/8c9/2d2/4288c92d24448965427df4d151ade92e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オブジェクト</font></font><code>GPUQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">である</font><font style="vertical-align: inherit;">キューを</font><font style="vertical-align: inherit;">使用すると、GPUジョブを非同期モードで送信できます。</font><font style="vertical-align: inherit;">現在、この資料を書いている間は、</font></font><code>defaultQueue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定のデバイスの</font><font style="vertical-align: inherit;">キューでのみ作業でき</font><font style="vertical-align: inherit;">ます</font></font><code>GPUDevice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
let queue: GPUQueue = null;<font></font>
<font></font>
// <font></font>
queue = device.defaultQueue;</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームの形成の補助メカニズム</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍バッファチェーン</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ac/f12/1e1/2acf121e11d15af28300c302ba00d829.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画面に何を描くかを確認するには、HTML要素が必要</font></font><code>canvas</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">さらに、オブジェクトによって表されるこの要素のバッファチェーンを作成する必要があります</font></font><code>GPUSwapChain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">//     <font></font>
let swapchain: GPUSwapchain = null;<font></font>
<font></font>
const context: GPUCanvasContext = canvas.getContext('gpupresent') as any;<font></font>
<font></font>
//   <font></font>
const swapChainDesc: GPUSwapChainDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;device: device,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;format: 'bgra8unorm',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;usage: GPUTextureUsage.OUTPUT_ATTACHMENT | GPUTextureUsage.COPY_SRC<font></font>
};<font></font>
swapchain = context.configureSwapChain(swapChainDesc);</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frameフレームベースバッファーに取り付けられたバッファー</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a5/0d2/f86/9a50d2f86ab80c7b7b181b6c34466dd2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レンダリングシステムのさまざまなパスを実行する場合、データを書き込むことができる出力テクスチャが必要です。</font><font style="vertical-align: inherit;">深度テストまたはシャドウの計算のための深度テクスチャについてです。</font><font style="vertical-align: inherit;">これらは、法線やPBR効果の使用など、遅延レンダリングのさまざまな側面を実装するアタッチメントにすることができます。たとえば、反射と表面テクスチャの形成の実装です。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
let depthTexture: GPUTexture = null;<font></font>
let depthTextureView: GPUTextureView = null;<font></font>
<font></font>
//       <font></font>
const depthTextureDesc: GPUTextureDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;size: {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width: canvas.width,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height: canvas.height,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depth: 1<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;arrayLayerCount: 1,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mipLevelCount: 1,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;sampleCount: 1,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;dimension: '2d',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;format: 'depth24plus-stencil8',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;usage: GPUTextureUsage.OUTPUT_ATTACHMENT | GPUTextureUsage.COPY_SRC<font></font>
};<font></font>
<font></font>
depthTexture = device.createTexture(depthTextureDesc);<font></font>
depthTextureView = depthTexture.createView();<font></font>
<font></font>
//      <font></font>
let colorTexture: GPUTexture = null;<font></font>
let colorTextureView: GPUTextureView = null;<font></font>
<font></font>
colorTexture = swapchain.getCurrentTexture();<font></font>
colorTextureView = colorTexture.createView();</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースの初期化</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍バッファ</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0b0/b7e/5bd/0b0b7e5bd6f26fb0e46671cfd9822e68.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バッファーは、グリッド頂点の位置に関するデータ、カラーデータ、インデックスデータなどのデータを持つ配列です。</font><font style="vertical-align: inherit;">ビットマップ画像を形成するグラフィカルパイプラインを使用して三角形をレンダリングする場合、頂点データを含む1つのバッファー（またはこれらのバッファーの多くは、通常、頂点バッファーオブジェクト-頂点バッファーオブジェクト-VBOと呼ばれます）が必要です。</font><font style="vertical-align: inherit;">また、出力する三角形の頂点バッファーのポインターを含む1つのインデックスバッファーも必要です（このようなバッファーは、インデックスバッファーオブジェクト-IBOと呼ばれます）。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
const positions = new Float32Array([<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;1.0, -1.0, 0.0,<font></font>
&nbsp;&nbsp;&nbsp;-1.0, -1.0, 0.0,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.0,&nbsp; 1.0, 0.0<font></font>
]);<font></font>
<font></font>
//     <font></font>
const colors = new Float32Array([<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;1.0, 0.0, 0.0, // <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.0, 1.0, 0.0, // <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.0, 0.0, 1.0&nbsp; // <font></font>
]);<font></font>
<font></font>
//    <font></font>
const indices = new Uint16Array([ 0, 1, 2 ]);<font></font>
<font></font>
//   <font></font>
let positionBuffer: GPUBuffer = null;<font></font>
let colorBuffer: GPUBuffer = null;<font></font>
let indexBuffer: GPUBuffer = null;<font></font>
<font></font>
//      GPUBuffer   <font></font>
let createBuffer = (arr: Float32Array | Uint16Array, usage: number) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let desc = { size: arr.byteLength, usage };<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let [ buffer, bufferMapped ] = device.createBufferMapped(desc);<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;const writeArray =<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arr instanceof Uint16Array ? new Uint16Array(bufferMapped) : new Float32Array(bufferMapped);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;writeArray.set(arr);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;buffer.unmap();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;return buffer;<font></font>
};<font></font>
<font></font>
positionBuffer = createBuffer(positions, GPUBufferUsage.VERTEX);<font></font>
colorBuffer = createBuffer(colors, GPUBufferUsage.VERTEX);<font></font>
indexBuffer = createBuffer(indices, GPUBufferUsage.INDEX);</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shadeシェーダーのコンパイル</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/236/a86/b7e/236a86b7e4b2310b19a6dd468456375b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、頂点シェーダーは次のGLSLコードで記述されています。</font></font><br>
<br>
<pre><code class="plaintext hljs">#version 450<font></font>
<font></font>
layout (location = 0) in vec3 inPos;<font></font>
layout (location = 1) in vec3 inColor;<font></font>
<font></font>
layout (location = 0) out vec3 outColor;<font></font>
<font></font>
void main()<font></font>
{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;outColor = inColor;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position = vec4(inPos.xyz, 1.0);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがフラグメントシェーダーコードです。これもGLSLで記述されています。</font></font><br>
<br>
<pre><code class="plaintext hljs">#version 450<font></font>
<font></font>
// <font></font>
layout (location = 0) in vec3 inColor;<font></font>
<font></font>
//  <font></font>
layout (location = 0) out vec4 outFragColor;<font></font>
<font></font>
void main()<font></font>
{<font></font>
&nbsp;&nbsp;outFragColor = vec4(inColor, 1.0);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">glslangが</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インストールされ</font><font style="vertical-align: inherit;">ている</font><font style="vertical-align: inherit;">必要があり</font><font style="vertical-align: inherit;">、対応するツールへのパスが変数</font></font><code>PATH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に含ま</font><font style="vertical-align: inherit;">れている場合</font><font style="vertical-align: inherit;">、ターミナルで次のコマンドを実行してシェーダーをコンパイルします。</font></font><br>
<br>
<pre><code class="plaintext hljs">glslangValidator -V triangle.vert -o triangle.vert.spv<font></font>
glslangValidator -V triangle.frag -o triangle.frag.spv</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍シェーダーモジュール</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/570/bef/63a/570bef63a947bb2ed8e40ed6183f6ad1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シェーダーモジュールは、特定のパイプラインを実行するときにGPUで実行されるコンパイル済みのシェーダーバイナリです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シェーダーはWebGPUで使用するためにプリコンパイルする必要があるため、SPIR-V形式でシェーダーをコンパイルするためのツールが必要になります。</font><font style="vertical-align: inherit;">私は現在、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CrossShaderの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいバージョン（</font><font style="vertical-align: inherit;">この操作を実行できるツール）に</font><font style="vertical-align: inherit;">取り組んでい</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">このツールは、操作するのにあまり便利ではありません。</font><font style="vertical-align: inherit;">たとえば、Webpackやその他の同様の改善を使用してシェーダーをロードしても、彼に害はありません。</font></font><br>
<br>
<pre><code class="plaintext hljs">//     <font></font>
let vertModule: GPUShaderModule = null;<font></font>
let fragModule: GPUShaderModule = null;<font></font>
<font></font>
//      GPUShaderModule  SPIR-V-<font></font>
let loadShader = (shaderPath: string) =&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fetch(new Request(shaderPath), { method: 'GET', mode: 'cors' }).then((res) =&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.arrayBuffer().then((arr) =&gt; new Uint32Array(arr))<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;);<font></font>
<font></font>
//   ...<font></font>
//    ,        JavaScript-    .<font></font>
<font></font>
const vsmDesc: any = { code: await loadShader('triangle.vert.spv') };<font></font>
vertModule = device.createShaderModule(vsmDesc);<font></font>
<font></font>
const fsmDesc: any = { code: await loadShader('triangle.frag.spv') };<font></font>
fragModule = device.createShaderModule(fsmDesc);</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍グルーピング</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c8/730/a33/7c8730a33f56a3c9e668b51564e82713.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの場合、シェーダーモジュールに直接データを転送する必要があります。</font><font style="vertical-align: inherit;">これを行うには、均一なバッファが必要です。</font><font style="vertical-align: inherit;">シェーダーでこのようなバッファーを作成するには、関数の前に、</font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の</font><font style="vertical-align: inherit;">コードをコードに追加し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="plaintext hljs">//       <font></font>
layout (set = 0, binding = 0) uniform UBO<font></font>
{<font></font>
&nbsp;&nbsp;mat4 modelViewProj;<font></font>
&nbsp;&nbsp;vec4 primaryColor;<font></font>
&nbsp;&nbsp;vec4 accentColor;<font></font>
};<font></font>
<font></font>
//         <font></font>
gl_Position = modelViewProj * vec4(inPos, 1.0);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、JavaScriptコードで、均一なバッファーを作成します。これまでと同じようにして、頂点バッファーとインデックスバッファーを作成します。</font></font><br>
<br>
<pre><code class="plaintext hljs">// Uniform-<font></font>
const uniformData = new Float32Array([<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//  ModelViewProjection&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;1.0, 0.0, 0.0, 0.0<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.0, 1.0, 0.0, 0.0<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.0, 0.0, 1.0, 0.0<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.0, 0.0, 0.0, 1.0<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//  <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.9, 0.1, 0.3, 1.0<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//  <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;0.8, 0.2, 0.8, 1.0<font></font>
]);<font></font>
<font></font>
//    <font></font>
let uniformBuffer: GPUBuffer = null;<font></font>
<font></font>
uniformBuffer = createBuffer(uniformData, GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行列乗算などの行列計算をより適切に処理するには、前述の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gl-matrixの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ような専用のライブラリが必要になる場合があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">//  <font></font>
let uniformBindGroupLayout: GPUBindGroupLayout = null;<font></font>
let uniformBindGroup: GPUBindGroup = null;<font></font>
let layout: GPUPipelineLayout = null;<font></font>
<font></font>
//  <font></font>
uniformBindGroupLayout = device.createBindGroupLayout({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;bindings: [{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binding: 0,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visibility: GPUShaderStage.VERTEX,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type: "uniform-buffer"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}]<font></font>
});<font></font>
<font></font>
//  <font></font>
uniformBindGroup = device.createBindGroup({<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;layout: uniformBindGroupLayout,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;bindings: [{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;binding: 0,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resource: {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer: uniformBuffer<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}]<font></font>
});<font></font>
<font></font>
//  <font></font>
layout = device.createPipelineLayout({bindGroupLayouts: [sceneUniformBindGroupLayout]}),</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グラフィックコンベア</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ラスターグラフィックコンベア</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d70/f5d/0ad/d70f5d0ad957d1cff143336b491e2224.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グラフィックスパイプラインは、処理に転送されるすべてのデータの記述です。</font><font style="vertical-align: inherit;">以下が含まれます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力アセンブリ。</font><font style="vertical-align: inherit;">各頂点はどのように見えますか？</font><font style="vertical-align: inherit;">各属性はどこにあり、メモリ内でどのように整列されていますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シェーダーモジュール </font><font style="vertical-align: inherit;">このグラフィックパイプラインを実行するときに使用されるシェーダーモジュールは何ですか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深度記述子。</font><font style="vertical-align: inherit;">深度テストを実行する必要がありますか？</font><font style="vertical-align: inherit;">もしそうなら、どの関数がこれのために使用されるべきか。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カラーミックス記述子。</font><font style="vertical-align: inherit;">現在の色と既に記録されている色をどのように混合する必要がありますか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラスタライズ </font><font style="vertical-align: inherit;">ラスタライズはどのように行われますか？</font><font style="vertical-align: inherit;">顔は切り取られていますか？</font><font style="vertical-align: inherit;">もしそうなら、それはどの方向に実装されるべきですか？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">均一なデータ。</font><font style="vertical-align: inherit;">シェーダーが期待する均一データは何ですか？</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebGLアプリケーションの開発におけるこれらすべての質問への回答は、パイプラインのアセンブリ中に提供されます。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
let pipeline: GPURenderPipeline = null;<font></font>
<font></font>
//  <font></font>
<font></font>
//  <font></font>
const positionAttribDesc: GPUVertexAttributeDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;shaderLocation: 0, // [[attribute(0)]]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;offset: 0,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;format: 'float3'<font></font>
};<font></font>
const colorAttribDesc: GPUVertexAttributeDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;shaderLocation: 1, // [[attribute(1)]]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;offset: 0,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;format: 'float3'<font></font>
};<font></font>
const positionBufferDesc: GPUVertexBufferLayoutDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;attributes: [ positionAttribDesc ],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;arrayStride: 4 * 3, // sizeof(float) * 3<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;stepMode: 'vertex'<font></font>
};<font></font>
const colorBufferDesc: GPUVertexBufferLayoutDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;attributes: [ colorAttribDesc ],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;arrayStride: 4 * 3, // sizeof(float) * 3<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;stepMode: 'vertex'<font></font>
};<font></font>
<font></font>
const vertexState: GPUVertexStateDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;indexFormat: 'uint16',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;vertexBuffers: [ positionBufferDesc, colorBufferDesc ]<font></font>
};<font></font>
<font></font>
//  <font></font>
const vertexStage = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;module: vertModule,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;entryPoint: 'main'<font></font>
};<font></font>
<font></font>
const fragmentStage = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;module: fragModule,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;entryPoint: 'main'<font></font>
};<font></font>
<font></font>
//&nbsp;  <font></font>
const depthStencilState: GPUDepthStencilStateDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;depthWriteEnabled: true,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;depthCompare: 'less',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;format: 'depth24plus-stencil8'<font></font>
};<font></font>
<font></font>
//   <font></font>
const colorState: GPUColorStateDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;format: 'bgra8unorm',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;alphaBlend: {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcFactor: 'src-alpha',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstFactor: 'one-minus-src-alpha',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operation: 'add'<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;colorBlend: {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srcFactor: 'src-alpha',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dstFactor: 'one-minus-src-alpha',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operation: 'add'<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;writeMask: GPUColorWrite.ALL<font></font>
};<font></font>
<font></font>
// <font></font>
const rasterizationState: GPURasterizationStateDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frontFace: 'cw',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;cullMode: 'none'<font></font>
};<font></font>
<font></font>
// Uniform-<font></font>
const pipelineLayoutDesc = { bindGroupLayouts: [] };<font></font>
const layout = device.createPipelineLayout(pipelineLayoutDesc);<font></font>
<font></font>
const pipelineDesc: GPURenderPipelineDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;layout,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;vertexStage,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fragmentStage,<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;primitiveTopology: 'triangle-list',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;colorStates: [ colorState ],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;depthStencilState,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;vertexState,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;rasterizationState<font></font>
};<font></font>
pipeline = device.createRenderPipeline(pipelineDesc);</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍チームエンコーダー</font></font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/05a/6fc/6c5/05a6fc6c5b94ea3d27de07263f632d97.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コマンドエンコーダーは、レンダリング中に実行される予定の描画コマンドをエンコードします。</font><font style="vertical-align: inherit;">コマンドのエンコードが完了すると、キューに送信できるコマンドのバッファーを自由に使用できるようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この意味で、コマンドバッファーはコールバックに似ており、キューに送信されると、GPUで描画機能を実行します。</font></font><br>
<br>
<pre><code class="plaintext hljs">//    <font></font>
let commandEncoder: GPUCommandEncoder = null;<font></font>
let passEncoder: GPURenderPassEncoder = null;<font></font>
<font></font>
//     GPU<font></font>
function encodeCommands() {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;let colorAttachment: GPURenderPassColorAttachmentDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachment: colorTextureView,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loadValue: { r: 0, g: 0, b: 0, a: 1 },<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storeOp: 'store'<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;const depthAttachment: GPURenderPassDepthStencilAttachmentDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachment: depthTextureView,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depthLoadValue: 1,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depthStoreOp: 'store',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stencilLoadValue: 'load',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stencilStoreOp: 'store'<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;const renderPassDesc: GPURenderPassDescriptor = {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colorAttachments: [ colorAttachment ],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depthStencilAttachment: depthAttachment<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;};<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;commandEncoder = device.createCommandEncoder();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//   <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder = commandEncoder.beginRenderPass(renderPassDesc);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.setPipeline(pipeline);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.setViewport(0, 0, canvas.width, canvas.height, 0, 1);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.setScissorRect(0, 0, canvas.width, canvas.height);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.setVertexBuffer(0, positionBuffer);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.setVertexBuffer(1, colorBuffer);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.setIndexBuffer(indexBuffer);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.drawIndexed(3, 1, 0, 0, 0);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;passEncoder.endPass();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;queue.submit([ commandEncoder.finish() ]);<font></font>
}</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レンダリング</font></font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d29/43c/108/d2943c1080ac81f485aa89fc0f628e98.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WebGPUでのレンダリングは、更新するすべての均一データを更新し、バッファーチェーンから次のアタッチメントを取得し、エンコードされたコマンドを送信して実行し、</font></font><code>requestAnimationFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これらすべての操作を再度</font><font style="vertical-align: inherit;">実行するように呼び出し</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<pre><code class="plaintext hljs">let render = () =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//      <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;colorTexture = swapchain.getCurrentTexture();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;colorTextureView = colorTexture.createView();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//       <font></font>
&nbsp;&nbsp;&nbsp;&nbsp;encodeCommands();<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;//   canvas<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;requestAnimationFrame(render);<font></font>
};</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他のグラフィックAPIよりもWebGPUで書くのは難しいかもしれませんが、このAPIは、最新のグラフィックカードの機能の点で他のAPIより優れています。</font><font style="vertical-align: inherit;">その結果、WebGPUを使用するとより高速なアプリケーションを作成できるというだけでなく、WebGPUテクノロジ自体が長期間使用されなくなることもなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、WebGPUの操作に関するいくつかの高度な問題が考慮されていないことに注意してください。</font><font style="vertical-align: inherit;">特に、以下について話します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マトリックスを使用してカメラを操作する。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グラフィックパイプラインのすべての可能な状態の詳細な概要。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンピューティングコンベヤ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テクスチャを読み込んでいます。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読者の皆様！</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトでWebGPUを使用する予定はありますか？</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485634/index.html">Dungeons and Dragonsダッシュボードは英語を学ぶのに役立ちました</a></li>
<li><a href="../ja485636/index.html">CRISPR耐性ウイルスは、DNA侵入酵素からゲノムを保護するためのシェルターを構築します</a></li>
<li><a href="../ja485638/index.html">見ることを学ぶ</a></li>
<li><a href="../ja485640/index.html">Webページを隠す方法</a></li>
<li><a href="../ja485642/index.html">Angularアプリケーションの動作が遅い主な理由</a></li>
<li><a href="../ja485646/index.html">これまでに会ったことのない役立つPythonのヒント。パート2</a></li>
<li><a href="../ja485648/index.html">forへのpythonicアプローチ：range（）とenumerate（）ループ</a></li>
<li><a href="../ja485650/index.html">Dockerイメージ削減テクニック</a></li>
<li><a href="../ja485652/index.html">Confluenceインラインコメント統計</a></li>
<li><a href="../ja485654/index.html">物理学からのアイデアは、AIがより高い次元で機能するのに役立ちます。</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>