<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß‚Äçüëß üëãüèª üëçüèΩ HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100 kNVPS auf einem Server üë©üèæ‚Äç‚öïÔ∏è üñ§ üöµüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die n√§chste HighLoad ++ - Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt. Details und Tickets hier . HighLoad ++ Moskau 2018. Moskau...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100 kNVPS auf einem Server</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/486540/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die n√§chste HighLoad ++ - Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt. Details und Tickets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . HighLoad ++ Moskau 2018. Moskauer Halle. 9. November, 15 Uhr Abstracts und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pr√§sentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/dm/mu/sadmmupp8vt5l5vl5obukgut36a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* √úberwachung - Online und Analyse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Die Hauptbeschr√§nkungen der ZABBIX-Plattform. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* L√∂sung zur Skalierung des Analytics-Speichers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* ZABBIX-Serveroptimierung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* UI-Optimierung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Erfahrung im Betrieb des Systems mit Lasten von mehr als 40.000 NVPS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Kurz Schlussfolgerungen.</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Makurov (im Folgenden - MM):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hallo allerseits! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxim Chernetsov (im Folgenden - MCH):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Guten Tag! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lassen Sie mich Maxim vorstellen. Max ist ein talentierter Ingenieur, der beste Netzwerker, den ich kenne. Maxim befasst sich mit Netzwerken und Diensten, deren Entwicklung und Betrieb. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/pn/q6/ujpnq61idhrrwq2dszdhb3hxjza.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und ich w√ºrde gerne √ºber Michael sprechen. Michael ist ein C-Entwickler. Er hat einige hoch geladene Verkehrsverarbeitungsl√∂sungen f√ºr unser Unternehmen geschrieben. Wir leben und arbeiten im Ural, in der Stadt der strengen Bauern von Tscheljabinsk, in der Firma Intersvyaz. Unser Unternehmen ist ein Anbieter von Internet- und Kabelfernsehdiensten f√ºr eine Million Menschen in 16 St√§dten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Und es ist erw√§hnenswert, dass Intersvyaz viel mehr als nur ein Anbieter ist, es ist ein IT-Unternehmen. </font><font style="vertical-align: inherit;">Die meisten unserer Entscheidungen werden von unserer IT-Abteilung getroffen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Von Servern, die Datenverkehr verarbeiten, bis zum Call Center und zur mobilen Anwendung. </font><font style="vertical-align: inherit;">In der IT-Abteilung gibt es etwa 80 Mitarbeiter mit sehr, sehr unterschiedlichen Kompetenzen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber Zabbix und seine Architektur</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und jetzt werde ich versuchen, einen pers√∂nlichen Rekord aufzustellen und in einer Minute zu sagen, was Zabbix ist (im Folgenden "Zabbiks"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix positioniert sich auf Unternehmensebene als ‚Äûout of the box‚Äú -√úberwachungssystem. </font><font style="vertical-align: inherit;">Es verf√ºgt √ºber viele lebensvereinfachende Funktionen: erweiterte Eskalationsregeln, APIs f√ºr die Integration, Gruppierung und automatische Erkennung von Hosts und Metriken. </font><font style="vertical-align: inherit;">In Zabbix gibt es sogenannte Skalierungswerkzeuge - Proxys. </font><font style="vertical-align: inherit;">Zabbix ist ein Open Source System. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz √ºber Architektur. </font><font style="vertical-align: inherit;">Wir k√∂nnen sagen, dass es aus drei Komponenten besteht:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/fn/xv/ocfnxvdx0gy8qi4055lipyifl1q.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server. </font><font style="vertical-align: inherit;">Es ist in C geschrieben. </font><font style="vertical-align: inherit;">Mit ziemlich komplizierter Verarbeitung und √úbertragung von Informationen zwischen Streams. </font><font style="vertical-align: inherit;">Die gesamte Verarbeitung findet darin statt: vom Empfang bis zum Speichern in der Datenbank.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle Daten werden in der Datenbank gespeichert. </font><font style="vertical-align: inherit;">Zabbix unterst√ºtzt MySQL, PostreSQL und Oracle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Webinterface ist in PHP geschrieben. </font><font style="vertical-align: inherit;">Auf den meisten Systemen wird ein Apache-Server mitgeliefert, der jedoch im nginx + php-Bundle effizienter arbeitet.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute m√∂chten wir aus dem Leben unseres Unternehmens eine Geschichte √ºber Zabbix erz√§hlen ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebensgeschichte der Firma Intersvyaz. </font><font style="vertical-align: inherit;">Was haben wir und was wird ben√∂tigt?</font></font></h3><br>
<img src="https://habrastorage.org/webt/d2/cr/rk/d2crrkodjpn2arv0aojibu6vsq4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor 5 oder 6 Monaten. Einmal nach der Arbeit ... </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mischa, hallo! Ich bin froh, dass ich dich erwischt habe - es gibt ein Gespr√§ch. Wir hatten wieder Probleme mit der √úberwachung. W√§hrend eines schweren Unfalls verlangsamte sich alles und es gab keine Informationen √ºber den Status des Netzwerks. Leider wird dies nicht das erste Mal wiederholt. Ich brauche deine Hilfe. Lassen Sie unsere √úberwachung unter keinen Umst√§nden funktionieren! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber lassen Sie uns zuerst synchronisieren. Ich habe dort seit ein paar Jahren nicht mehr gesucht. Soweit ich mich erinnere, haben wir Nagios abgelehnt und sind vor 8 Jahren zu Zabbix gewechselt. Und jetzt scheinen wir 6 leistungsstarke Server und ungef√§hr ein Dutzend Proxys zu haben. Verwechsle ich etwas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Fast. 15 Server, von denen einige virtuelle Maschinen sind. Vor allem rettet uns dies nicht in dem Moment, in dem wir es am dringendsten brauchen. Wie ein Unfall - die Server werden langsamer und nichts ist sichtbar. Wir haben versucht, die Konfiguration zu optimieren, dies f√ºhrt jedoch nicht zu einem optimalen Leistungsgewinn. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. Hast du etwas gesucht, hast du etwas aus der Diagnose herausgegraben? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Das erste, was Sie tun m√ºssen, ist nur die Datenbank. </font><font style="vertical-align: inherit;">MySQL wird so st√§ndig geladen, dass neue Metriken erhalten bleiben. Wenn Zabbix eine Reihe von Ereignissen generiert, wird die Datenbank buchst√§blich mehrere Stunden lang in sich selbst gespeichert. </font><font style="vertical-align: inherit;">Ich habe Ihnen bereits von der Optimierung der Konfiguration erz√§hlt, aber dieses Jahr haben wir die Hardware buchst√§blich aktualisiert: Auf den Servern und Festplatten-Arrays von SSD RAID-ahs befinden sich mehr als hundert Gigabyte Speicher - es macht keinen Sinn, sie linear zu erweitern. </font><font style="vertical-align: inherit;">Was werden wir machen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. </font><font style="vertical-align: inherit;">Im Allgemeinen ist MySQL eine LTP-Datenbank. </font><font style="vertical-align: inherit;">Anscheinend ist es nicht mehr zum Speichern eines Archivs von Metriken unserer Gr√∂√üe geeignet. </font><font style="vertical-align: inherit;">Lass es uns herausfinden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Komm schon!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration von Zabbix und Clickhouse als Ergebnis eines Hackathons</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach einiger Zeit erhielten wir interessante Daten: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2r/vp/of/2rvpofn2alwwhizhv4e7qrwhpsm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gr√∂√üte Teil des Speicherplatzes in unserer Datenbank wurde vom Archiv der Metriken belegt, und weniger als 1% wurden f√ºr Konfiguration, Vorlagen und Einstellungen verwendet. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt betreiben wir seit mehr als einem Jahr die Big-Data-L√∂sung auf Basis von Clickhouse. </font><font style="vertical-align: inherit;">Die Bewegungsrichtung war f√ºr uns offensichtlich. </font><font style="vertical-align: inherit;">Bei unserem Fr√ºhjahrs-Hackathon schrieb er die Integration von Zabbix mit Clickhouse f√ºr den Server und das Frontend. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt hatte Zabbix bereits Unterst√ºtzung f√ºr ElasticSearch, und wir haben beschlossen, diese zu vergleichen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/jv/hq/bgjvhq9lwget5l-hy1xt9zz2mvo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vergleichen Sie Clickhouse und Elasticsearch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Zum Vergleich haben wir dieselbe Last generiert, die der Zabbix-Server bereitstellt, und uns angesehen, wie sich die Systeme verhalten w√ºrden. Wir haben Daten in Stapeln von 1000 Zeilen geschrieben und CURL verwendet. Wir haben zuvor vorgeschlagen, dass das Clickhouse f√ºr das Lastprofil von Zabbix effektiver ist. Die Ergebnisse √ºbertrafen sogar unsere Erwartungen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter den gleichen Testbedingungen schrieb das Clickhouse dreimal so viele Daten. Gleichzeitig verbrauchten beide Systeme beim Lesen von Daten sehr effizient (eine kleine Menge an Ressourcen). F√ºr ‚ÄûElastix‚Äú war jedoch bei der Aufnahme eine gro√üe Menge an Prozessor erforderlich:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt hat Clickhouse Elastix in Bezug auf Prozessorverbrauch und -geschwindigkeit deutlich √ºbertroffen. Gleichzeitig verwendet ‚ÄûClickhouse‚Äú aufgrund der Datenkomprimierung 11-mal weniger Festplattenlaufwerke und f√ºhrt etwa 30-mal weniger Festplattenvorg√§nge aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/0u/ce/yf0uceb3lvfa4e3mdwz1fsgufkw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, die Arbeit mit dem Festplattensubsystem bei ‚ÄûClickhouse‚Äú ist sehr effektiv. Unter den Basen k√∂nnen Sie riesige SATA-Festplatten verwenden und eine Schreibgeschwindigkeit von Hunderttausenden von Zeilen pro Sekunde erreichen. Das System "out of the box" unterst√ºtzt Sharding, Replikation, es ist sehr einfach zu konfigurieren. Wir sind mehr als zufrieden mit dem Betrieb seit einem Jahr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Ressourcen zu optimieren, k√∂nnen Sie "Clickhouse" neben der vorhandenen Hauptbasis installieren und so viel Prozessorzeit und Festplattenvorg√§nge sparen. Wir haben das Metrikarchiv f√ºr die vorhandenen ‚ÄûClickhouse‚Äú -Cluster herausgenommen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/xr/p9/quxrp9ah4u-nhwlbkkcgynf2to0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die MySQL-Hauptdatenbank so weit entladen, dass wir sie auf demselben Computer mit dem Zabbix-Server kombinieren und den dedizierten Server f√ºr MySQL aufgeben konnten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie funktioniert das Polling in Zabbix?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor 4 Monaten </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nun, Sie k√∂nnen die Probleme mit der Basis vergessen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das ist sicher! Ein weiteres Problem, das wir l√∂sen m√ºssen, ist die langsame Datenerfassung. Jetzt sind alle unsere 15 Proxys mit SNMP- und Polling-Prozessen √ºberlastet. Und es gibt nichts anderes als das Einrichten neuer und neuer Server. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Gro√üartig. Aber sagen Sie mir zuerst, wie Polling in Zabbix funktioniert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Kurz gesagt, es gibt 20 Arten von Metriken und ein Dutzend M√∂glichkeiten, diese zu erhalten. Zabbix kann Daten entweder im "Request-Response" -Modus erfassen oder neue Daten √ºber die "Trapper-Schnittstelle" erwarten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/dd/jc/f1ddjcw--iidqz7psmv82znkwk0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erw√§hnenswert, dass diese Methode (Trapper) im urspr√ºnglichen Zabbix die schnellste ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Proxys f√ºr den Lastausgleich:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/n3/2v/qln32vd8mjkz2xbe0bowbswrpsu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxies k√∂nnen dieselben Erfassungsfunktionen wie der Zabbix-Server ausf√ºhren, Aufgaben von ihm empfangen und erfasste Metriken √ºber die Trapper-Schnittstelle senden. </font><font style="vertical-align: inherit;">Dies ist die offiziell empfohlene Lastausgleichsmethode. </font><font style="vertical-align: inherit;">Proxys sind auch n√ºtzlich f√ºr die √úberwachung einer Remote-Infrastruktur, die √ºber NAT oder einen langsamen Kanal funktioniert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/uv/mh/bauvmh-9-mcmokuu7ldhtx59--0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mit der Architektur ist alles klar. </font><font style="vertical-align: inherit;">Wir m√ºssen uns die Quelle ansehen ... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Tage sp√§ter</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geschichte, wie nmap fping gewonnen hat</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es scheint, dass ich etwas ausgegraben habe. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sag es mir! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich habe festgestellt, dass Zabbix bei Verf√ºgbarkeitspr√ºfungen bis zu 128 Hosts gleichzeitig √ºberpr√ºft. Ich habe versucht, diese Zahl auf 500 zu erh√∂hen, und das Intervall zwischen den Paketen in ihrem Ping (Ping) entfernt - dies hat die Leistung um den Faktor zwei erh√∂ht. Aber ich h√§tte gerne gro√üe Zahlen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In meiner Praxis muss ich manchmal die Verf√ºgbarkeit von Tausenden von Hosts √ºberpr√ºfen, und ich habe nichts schnelleres als nmap gesehen. Ich bin sicher, dass dies der schnellste Weg ist. Lass es uns versuchen! Sie m√ºssen die Anzahl der Hosts in einer Iteration erheblich erh√∂hen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mehr als f√ºnfhundert pr√ºfen? 600? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mindestens ein paar Tausend. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Okay. Das Wichtigste, was ich sagen wollte: Ich stellte fest, dass die meisten Umfragen in Zabbix synchron durchgef√ºhrt wurden. Wir m√ºssen es asynchron wiederholen. Dann k√∂nnen wir die Anzahl der von den Pollern gesammelten Metriken drastisch erh√∂hen, insbesondere wenn wir die Anzahl der Metriken in einer Iteration erh√∂hen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Gro√üartig! Und wann? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wie immer gestern. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir haben beide Versionen von fping und nmap verglichen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/du/ii/qoduiid8hzk_wy8sxvgityvungo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf einer gro√üen Anzahl von Hosts wurde erwartet, dass nmap bis zu f√ºnfmal effizienter ist. </font><font style="vertical-align: inherit;">Da nmap nur die Verf√ºgbarkeit und die Antwortzeit √ºberpr√ºft, haben wir die Verlustberechnung auf Trigger √ºbertragen und die Intervalle f√ºr die Verf√ºgbarkeitspr√ºfung erheblich reduziert. </font><font style="vertical-align: inherit;">Wir haben die optimale Anzahl von Hosts f√ºr nmap im Bereich von 4.000 pro Iteration gefunden. </font><font style="vertical-align: inherit;">Mit Nmap konnten wir die CPU-Kosten f√ºr Verf√ºgbarkeitspr√ºfungen um das Dreifache reduzieren und das Intervall von 120 Sekunden auf 10 Sekunden verk√ºrzen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polling-Optimierung</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dann haben wir uns f√ºr Meinungsforscher entschieden. Wir waren haupts√§chlich an SNMP-Entfernung und Agenten interessiert. In Zabbix wurden die Abfragen synchron durchgef√ºhrt und spezielle Ma√ünahmen ergriffen, um die Effizienz des Systems zu erh√∂hen. Im synchronen Modus f√ºhrt die Nichtverf√ºgbarkeit des Hosts zu einer erheblichen Verschlechterung der Abfrage. Es gibt ein ganzes System von Zust√§nden, es gibt spezielle Prozesse - die sogenannten nicht erreichbaren Poller, die nur mit unzug√§nglichen Hosts arbeiten: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/h1/fm/3gh1fmfnq3nqxkpwsow7j4h80ra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein Kommentar, der die Zustandsmatrix zeigt, die Komplexit√§t des √úbergangssystems, die erforderlich ist, damit das System effektiv bleibt. Dar√ºber hinaus ist die synchrone Abfrage selbst eher langsam:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/0r/tm/h70rtmvjonmj3itlmq4wk44vpr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund konnten Tausende von Poller-Threads auf einem Dutzend Proxys nicht die erforderliche Datenmenge f√ºr uns erfassen. Die asynchrone Implementierung l√∂ste nicht nur die Probleme mit der Anzahl der Threads, sondern vereinfachte auch das </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/te/bj/retebjsm9vthvrjy7rmpobeiwqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Statussystem </font><font style="vertical-align: inherit;">unzug√§nglicher Hosts erheblich, da f√ºr jede in einer Iteration der Abfrage √ºberpr√ºfte Anzahl die maximale Wartezeit 1 Zeit√ºberschreitung betrug: </font><font style="vertical-align: inherit;">Zus√§tzlich haben wir das Abfragesystem f√ºr SNMP- modifiziert und verbessert. Anfragen. Tatsache ist, dass die meisten nicht gleichzeitig auf mehrere SNMP-Anfragen antworten k√∂nnen. Aus diesem Grund haben wir einen Hybridmodus erstellt, wenn die SNMP-Abfrage desselben Hosts asynchron erfolgt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/9a/sj/mj9asjfzaisviljstpkdjpvmnya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies erfolgt f√ºr das gesamte Host-Bundle. Dieser Modus ist am Ende nicht langsamer als vollst√§ndig asynchron, da das Abrufen von eineinhalb hundert SNMP-Werten immer noch viel schneller als eine Zeit√ºberschreitung ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Experimente haben gezeigt, dass die optimale Anzahl von Anforderungen in einer Iteration bei SNMP-Abfragen etwa 8.000 betr√§gt. </font><font style="vertical-align: inherit;">Insgesamt konnte durch den √úbergang in den asynchronen Modus die Abfrageleistung um das 200-fache, mehrere hundertfache beschleunigt werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die erhaltenen Abfrageoptimierungen haben gezeigt, dass wir nicht nur alle Proxys entfernen, sondern auch die Intervalle f√ºr viele √úberpr√ºfungen verk√ºrzen k√∂nnen und keine Proxys ben√∂tigt werden, um die Last zu teilen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor ungef√§hr drei Monaten</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ñndern Sie die Architektur - erh√∂hen Sie die Last!</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nun, Max, ist es Zeit, produktiv zu sein? Ich brauche einen leistungsstarken Server und einen guten Ingenieur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nun, wir planen. Es ist Zeit, mit 5.000 Metriken pro Sekunde loszulegen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morgen nach dem </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH- </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Upgrade </font></i><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> - Mischa, wir haben aktualisiert, aber am Morgen zur√ºckgesetzt ... Ratet mal, welche Geschwindigkeit Sie erreicht haben? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Maximal tausend. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, 25! Leider sind wir dort, wo wir angefangen haben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und so? Haben Sie eine Diagnose erhalten? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja nat√ºrlich! Hier zum Beispiel ein interessantes Top: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6c/zv/6s/6czv6sdkoykmdkm0vn-sddnbbpw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mal sehen. Ich sehe, dass wir eine gro√üe Anzahl von Abfragethreads ausprobiert haben: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/a0/cl/qba0clfwpherpsufnk_7fbn5ioy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig konnten wir das System nicht einmal zur H√§lfte nutzen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/wv/8b/spwv8blrzyggfwo5ps-objpypak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und die Gesamtleistung ist mit etwa 4.000 Metriken pro Sekunde recht gering: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/6o/zr/tt6ozrt2ortiof4kckeghltzrnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gibt es noch etwas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, Strace eines der Poller: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p8/ny/y3/p8nyy3kb_ffjhsjynlpz4wjfh8w.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hier ist deutlich zu sehen, dass der Polling-Prozess auf ‚ÄûSemaphoren‚Äú wartet. Dies sind Sperren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z7/ks/mh/z7ksmh8kes9yc23tm0vuyu5g8r8.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es ist nicht klar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sehen Sie, dies ist wie eine Situation, in der eine Reihe von Threads versuchen, mit Ressourcen zu arbeiten, mit denen jeweils nur einer arbeiten kann. Dann k√∂nnen sie diese Ressource nur noch nach Zeit teilen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/ce/mo/incemofethgxpp3fwyabr8kstd4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Gesamtproduktivit√§t der Arbeit mit einer solchen Ressource wird durch die Geschwindigkeit eines Kerns begrenzt: Es </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/oh/9f/oqoh9fqs9ppftn5mab3aivoo2nq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gibt zwei M√∂glichkeiten, dieses Problem zu l√∂sen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aktualisieren Sie das Maschineneisen und wechseln Sie zu schnelleren Kerneln:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/bd/zi/iobdziopu3g_vkfoengg2zhhcro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder √§ndern Sie die Architektur und </font><font style="vertical-align: inherit;">gleichzeitig </font><font style="vertical-align: inherit;">die Last: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/sl/wt/nuslwtjkx-poqob5ciqyyfifq48.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - √úbrigens verwenden wir auf einer Testmaschine weniger Kerne als auf einer Kampfmaschine, aber die Frequenz pro Kern ist 1,5-mal schneller! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ist das klar? </font><font style="vertical-align: inherit;">Es ist notwendig, den Servercode zu √ºberpr√ºfen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenpfad in Zabbix Server</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um zu verstehen, haben wir angefangen zu analysieren, wie die Daten innerhalb des Zabbix-Servers √ºbertragen werden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/iu/a2/v9iua26a6om3flgzj_vb3te0hak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cooles Bild, richtig? Lassen Sie uns Schritt f√ºr Schritt durchgehen, um mehr oder weniger zu kl√§ren. Es gibt Streams und Dienste, die f√ºr das Sammeln von Daten verantwortlich sind: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h3/m9/kt/h3m9ktuwhpgwe1g4mbqjiw8l_zs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie √ºbertragen die gesammelten Metriken √ºber den Socket an den Pr√§prozessor-Manager, wo sie in die Warteschlange gestellt werden: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/ct/fv/9dctfvdiw2zaves1vn34gliuvmu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pr√§prozessor-Manager √ºbertr√§gt Daten an seine Mitarbeiter, die die Vorverarbeitungsanweisungen ausf√ºhren, und gibt sie √ºber denselben Socket zur√ºck: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ma/qd/ss/maqdssje-vzlzzpfzl0x2cuthwo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach den Pr√§prozessor -manager speichert sie im Verlaufs-Cache:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/9q/vw/5r9qvwyriydt0pcroma7n-14fsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von dort aus werden sie von Verlaufssenkern erfasst, die eine Vielzahl von Funktionen ausf√ºhren: zum Beispiel das Berechnen von Triggern, das F√ºllen des Wertecaches und vor allem das Speichern von Metriken im Verlaufsspeicher. </font><font style="vertical-align: inherit;">Im Allgemeinen ist der Prozess komplex und sehr verwirrend. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/o8/ih/f7o8ihzf_g5_2ecganu1t0zoss0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das erste, was wir gesehen haben, ist, dass die meisten Threads um den sogenannten "Konfigurationscache" konkurrieren (ein Speicherbereich, in dem alle Serverkonfigurationen gespeichert sind). </font><font style="vertical-align: inherit;">Besonders viele Sperren werden von den f√ºr die Datenerfassung verantwortlichen Streams vorgenommen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/oo/48/baoo48qthdg_pcp0ojgqh0de5us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... da in der Konfiguration nicht nur Metriken mit ihren Parametern gespeichert werden, sondern auch Warteschlangen, aus denen die Poller Informationen dar√ºber abrufen, was als N√§chstes zu tun ist. </font><font style="vertical-align: inherit;">Wenn es viele Poller gibt und einer die Konfiguration blockiert, warten die anderen auf Anfragen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y5/zb/np/y5zbnpqumrszencyhaasflytwvm.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meinungsforscher d√ºrfen nicht in Konflikt geraten</font></font></h3><br>
<img src="https://habrastorage.org/webt/kw/11/4f/kw114ff5k91eqlycs-yg8p8bmem.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher haben wir als erstes die Warteschlange in vier Teile unterteilt und den Pollern erm√∂glicht, diese Warteschlangen gleichzeitig sicher zu blockieren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/gi/xu/lagixuseh1aghovklgd6m3blkxu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadurch wurde die Konkurrenz um den Konfigurationscache beseitigt und die Geschwindigkeit der Poller wurde erheblich erh√∂ht. </font><font style="vertical-align: inherit;">Aber dann wurden wir mit der Tatsache konfrontiert, dass der Pr√§prozessor-Manager begann, eine Job-Warteschlange aufzubauen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/0c/4i/ui0c4i7aae8kqdvkdtorchzft-y.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Pr√§prozessor-Manager sollte Priorit√§ten setzen k√∂nnen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies geschah, als ihm die Produktivit√§t fehlte. </font><font style="vertical-align: inherit;">Dann konnte er nur noch Anforderungen aus den Datenerfassungsprozessen sammeln und deren Puffer hinzuf√ºgen, bis er den gesamten Speicher verbraucht und abst√ºrzt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/iy/oz/9yiyozxavyibcw8pog3tidwy-xc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dieses Problem zu l√∂sen, haben wir einen zweiten Socket hinzugef√ºgt, der speziell f√ºr Mitarbeiter zugewiesen wurde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/sz/25/rbsz25axpkn6a832h9k7otp9je4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So. Der Pr√§prozessor-Manager hatte die M√∂glichkeit, seine Arbeit zu priorisieren, und falls der Puffer w√§chst, besteht die Aufgabe darin, das Essen zu verlangsamen und den Arbeitern die M√∂glichkeit zu geben, diesen Puffer aufzunehmen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/og/cg/qiogcgztt1an1ewlrear7oqxt7g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann stellten wir fest, dass einer der Gr√ºnde f√ºr die Verlangsamung darin bestand, dass die Arbeiter selbst im Wettbewerb standen </font><font style="vertical-align: inherit;">wichtige Ressource f√ºr ihre Arbeit. </font><font style="vertical-align: inherit;">Wir haben dieses Problem mit einer Fehlerbehebung registriert und in den neuen Versionen von Zabbix wurde es bereits behoben:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/6q/lr/yd6qlrqamuxreroffkeracyrnim.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erh√∂hen die Anzahl der Steckdosen - wir erhalten das Ergebnis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au√üerdem wurde der Pr√§prozessor-Manager selbst zu einem engen Link, da es sich um einen einzelnen Thread handelt. </font><font style="vertical-align: inherit;">Es beruhte auf der Geschwindigkeit des Kerns und ergab eine maximale Geschwindigkeit von ungef√§hr 70.000 Metriken pro Sekunde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/s1/2_/uks12_i65kx3ohfqdfmvedyqdqw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deshalb haben wir vier mit vier Sockels√§tzen als Arbeiter erstellt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/-u/ws/qt-uwsmlriplii491ao0we3jhg4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dies erm√∂glichte es uns, die Geschwindigkeit auf ungef√§hr 130.000 Metriken zu erh√∂hen: Die </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/vp/cf/qlvpcfggoinhdxc4dfkniaz9po8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nichtlinearit√§t des Wachstums erkl√§rt sich aus der Tatsache, dass es Konkurrenz um den Cache gab Geschichten. </font><font style="vertical-align: inherit;">F√ºr ihn traten 4 Pr√§prozessor-Manager und historische Synker an. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt haben wir auf einer Testmaschine ungef√§hr 130.000 Metriken pro Sekunde erhalten, die zu 95% auf dem Prozessor verwendet wurden: vor </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/7l/mh/yo7lmhcfcdbhek5blp5xdz0osfy.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ungef√§hr 2,5 Monaten</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ablehnung der snmp-Community erh√∂hte die NVPs um das Eineinhalbfache</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Max, ich brauche eine neue Testmaschine! Wir passen nicht mehr in die aktuelle. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und was ist jetzt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Jetzt - 130.000 NVPs und ein "Regal" -Prozessor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wow! Cool! Warten Sie, ich habe zwei Fragen. Nach meinen Berechnungen liegt unser Bedarf im Bereich von 15 bis 20.000 Metriken pro Sekunde. Warum brauchen wir mehr? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich m√∂chte den Job bis zum Ende beenden. Ich m√∂chte sehen, wie viel wir aus diesem System herausholen k√∂nnen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber es ist f√ºr das Gesch√§ft nutzlos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. Und die zweite Frage: Was wir jetzt haben, k√∂nnen wir uns ohne die Hilfe eines Entwicklers selbst unterst√ºtzen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich denke nicht. Das √Ñndern des Konfigurationscaches ist ein Problem. Es behandelt √Ñnderungen in den meisten Threads und ist schwer zu pflegen. H√∂chstwahrscheinlich wird es sehr schwierig sein, sie zu unterst√ºtzen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dann brauchen Sie eine Alternative. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es gibt eine solche Option. Wir k√∂nnen auf schnelle Kerne umsteigen und gleichzeitig das neue Schlie√üsystem aufgeben. Wir erhalten immer noch die Leistung von 60-80.000 Metriken. In diesem Fall k√∂nnen wir den Rest des Codes belassen. Clickhouse, asynchrones Polling funktioniert. Und es wird leicht zu warten sein. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Gro√üartig! Ich schlage vor, darauf einzugehen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die Serverseite optimiert hatten, konnten wir den neuen Code endlich produktiv ausf√ºhren. </font><font style="vertical-align: inherit;">Wir haben einen Teil der √Ñnderungen zugunsten des Wechsels zu einem Computer mit schnellen Kerneln und der Minimierung der Anzahl der √Ñnderungen im Code aufgegeben. </font><font style="vertical-align: inherit;">Wir haben auch die Konfiguration vereinfacht und die Makros in den Datenelementen nach M√∂glichkeit aufgegeben, da sie die Quelle zus√§tzlicher Sperren sind. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/v7/tp/bkv7tps-i9usalann4sbqpdbkqm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ablehnung des snmp-community-Makros, das h√§ufig in Dokumentationen und Beispielen zu finden ist, erm√∂glichte es uns in unserem Fall, NVPs zus√§tzlich um das 1,5-fache zu beschleunigen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach zwei Tagen in der Produktion</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entfernen Sie Popups zum Vorfallverlauf</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mischa, wir benutzen das System zwei Tage lang und alles funktioniert. Aber nur wenn alles funktioniert! Wir hatten die Arbeit mit der √úbertragung eines ausreichend gro√üen Teils des Netzwerks geplant und erneut mit unseren H√§nden √ºberpr√ºft, ob es gestiegen war, nicht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das kann nicht sein! Wir haben alles 10 mal √ºberpr√ºft. Der Server verarbeitet sogar die vollst√§ndige Unzug√§nglichkeit des Netzwerks sofort. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, ich verstehe alles: Server, Basis, Top, Austat, Protokolle - alles ist schnell ... Aber wir schauen uns die Weboberfl√§che an und dort haben wir den Prozessor "im Regal" auf dem Server und dies: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/un/p2/vjunp2evh3whasvpw4hwsipeshk.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. Schauen wir uns das Web an. Wir haben festgestellt, dass in einer Situation mit einer gro√üen Anzahl aktiver Vorf√§lle die meisten betrieblichen Widgets sehr langsam zu arbeiten begannen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/vw/kz/nzvwkzfbeg-4r1iue0y4178eg2q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Grund daf√ºr war die Generierung von Popups mit einer Historie von Vorf√§llen, die f√ºr jedes Element in der Liste generiert werden. </font><font style="vertical-align: inherit;">Daher haben wir uns geweigert, diese Fenster zu generieren (5 Zeilen im Code auskommentiert), und dies hat unsere Probleme gel√∂st. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ladezeit des Widgets wurde, selbst wenn sie nicht zug√§nglich war, von einigen Minuten auf 10-15 Sekunden reduziert, und der Verlauf kann weiterhin angezeigt werden, indem Sie auf die Zeit klicken: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/dc/4l/hudc4lsz_skbshg7jphleuprc4a.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach der Arbeit. </font><font style="vertical-align: inherit;">Vor 2 Monaten </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mischa, gehst du? </font><font style="vertical-align: inherit;">Wir m√ºssen reden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich werde nicht. </font><font style="vertical-align: inherit;">Wieder etwas mit Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oh nein, entspann dich! </font><font style="vertical-align: inherit;">Ich wollte nur sagen: alles funktioniert, danke! </font><font style="vertical-align: inherit;">Bier mit mir.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix ist wirksam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix ist ein ziemlich vielseitiges und reichhaltiges System und Funktion. </font><font style="vertical-align: inherit;">Es kann sofort f√ºr kleine Installationen verwendet werden, muss jedoch mit zunehmendem Bedarf optimiert werden. </font><font style="vertical-align: inherit;">Verwenden Sie den entsprechenden Speicher, um ein gro√ües Archiv von Metriken zu speichern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen die integrierten Tools in Form einer Integration mit Elastixerch oder des Hochladens des Verlaufs in Textdateien (verf√ºgbar ab der vierten Version) verwenden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen unsere Erfahrung und Integration mit Clickhouse nutzen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Geschwindigkeit beim Sammeln von Metriken drastisch zu erh√∂hen, erfassen Sie diese asynchron und √ºbertragen Sie sie √ºber die Trapper-Schnittstelle an den Zabbix-Server. </font><font style="vertical-align: inherit;">oder Sie k√∂nnen den Patch f√ºr asynchrone Poller von Zabbix selbst verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix ist in C geschrieben und sehr effektiv. </font><font style="vertical-align: inherit;">Die L√∂sung mehrerer enger architektonischer Bereiche erm√∂glicht es, die Produktivit√§t weiter zu steigern und nach unserer Erfahrung mehr als 100.000 Metriken auf einem Computer mit einem Prozessor zu erhalten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/db/d2/5rdbd2jcvr75sosfvfa6ziniwps.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der gleiche Zabbix-Patch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich m√∂chte ein paar Punkte hinzuf√ºgen. </font><font style="vertical-align: inherit;">Der gesamte aktuelle Bericht, alle Tests und Nummern sind f√ºr die Konfiguration angegeben, die bei uns verwendet wird. </font><font style="vertical-align: inherit;">Wir nehmen jetzt ungef√§hr 20.000 Metriken pro Sekunde davon. </font><font style="vertical-align: inherit;">Wenn Sie versuchen zu verstehen, ob dies f√ºr Sie funktioniert, k√∂nnen Sie vergleichen. </font><font style="vertical-align: inherit;">Wor√ºber sie heute gesprochen haben, wird auf GitHub als Patch ver√∂ffentlicht: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/miklert/zabbix</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xb/wd/y1/xbwdy18hq9dolceyxku_2wxsj4a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der Patch enth√§lt:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vollst√§ndige Integration mit Clickhouse (sowohl Zabbix-Server als auch Frontend);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√∂sen von Problemen mit dem Pr√§prozessor-Manager;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asynchrones Polling.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Patch ist mit allen Versionen 4 kompatibel, einschlie√ülich lts. </font><font style="vertical-align: inherit;">H√∂chstwahrscheinlich funktioniert es mit minimalen √Ñnderungen unter Version 3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank f√ºr Ihre Aufmerksamkeit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frage des Publikums (im Folgenden - A): - Guten Tag! Bitte sagen Sie mir, haben Sie Pl√§ne f√ºr eine intensive Interaktion mit dem Zabbix-Team oder haben sie mit Ihnen, damit dies kein Patch ist, sondern das normale Verhalten von Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, wir werden sicherlich einen Teil der √Ñnderungen vornehmen. Etwas wird sein, etwas wird im Patch bleiben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vielen Dank f√ºr den hervorragenden Bericht! Sagen Sie mir bitte, nachdem Sie den Patch angewendet haben, bleibt die Unterst√ºtzung von der Seite von Zabbix bestehen und wie k√∂nnen Sie weiterhin auf h√∂here Versionen aktualisieren? Wird es m√∂glich sein, Zabbix nach Ihrem Patch auf 4.2, 5.0 zu aktualisieren? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich kann nichts √ºber Unterst√ºtzung sagen. Wenn ich der technische Support von Zabbix w√§re, w√ºrde ich wahrscheinlich nein sagen, da dies der Code eines anderen ist. In Bezug auf die Codebasis 4.2 lautet unsere Position wie folgt: "Wir werden mit der Zeit gehen und wir werden auf die n√§chste Version aktualisiert." Daher werden wir den Patch f√ºr einige Zeit auf aktualisierte Versionen hochladen. Ich habe bereits im Bericht gesagt: Die Anzahl der √Ñnderungen an den Versionen ist immer noch recht gering. Ich denke, der √úbergang von 3,4 auf 4 hat anscheinend 15 Minuten gedauert. Dort hat sich etwas ge√§ndert, aber nicht sehr wichtig. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sie planen also, Ihren Patch zu warten und k√∂nnen ihn sicher in Betrieb nehmen, um in Zukunft auf irgendeine Weise Updates zu erhalten? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir empfehlen es dringend. Dies l√∂st viele Probleme f√ºr uns. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich m√∂chte noch einmal betonen, dass √Ñnderungen, die sich nicht auf die Architektur und nicht auf Sperren und Warteschlangen beziehen, modular sind und sich in separaten Modulen befinden. Selbst mit geringf√ºgigen √Ñnderungen k√∂nnen sie problemlos gewartet werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wenn die Details interessant sind, verwendet ‚ÄûClickhouse‚Äú die sogenannte Verlaufsbibliothek. Es ist nicht gebunden - dies ist eine Kopie der Unterst√ºtzung von Elastic, dh es ist konfigurierbar. Durch das Abrufen werden nur die Poller ge√§ndert. Wir glauben, dass dies noch lange funktionieren wird. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vielen Dank. Aber sagen Sie mir, gibt es eine Dokumentation der vorgenommenen √Ñnderungen? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/vv/h3/r7vvh3optatasclqsm9tjftkmja.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dokumentation ist ein Patch. </font><font style="vertical-align: inherit;">Offensichtlich ergeben sich mit der Einf√ºhrung von ‚ÄûClickhouse‚Äú und der Einf√ºhrung neuer Poller-Typen neue Konfigurationsoptionen. </font><font style="vertical-align: inherit;">Der Link von der letzten Folie enth√§lt eine kurze Beschreibung der Verwendung.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber das Ersetzen von fping durch nmap</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wie haben Sie das letztendlich umgesetzt? </font><font style="vertical-align: inherit;">K√∂nnen Sie konkrete Beispiele nennen: Sind es Ihre Strapper und ein externes Skript? </font><font style="vertical-align: inherit;">Was √ºberpr√ºft schlie√ülich so viele Hosts so schnell? </font><font style="vertical-align: inherit;">Wie bekommt man diese Gastgeber? </font><font style="vertical-align: inherit;">Muss nmap sie irgendwie f√ºttern, von irgendwoher holen, hineinstecken, etwas anfangen? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Cool. Sehr richtige Frage! Der Punkt ist dies. Wir haben die Bibliothek (ICMP-Ping, Teil von Zabbix) f√ºr ICMP-√úberpr√ºfungen ge√§ndert, die die Anzahl der Pakete - Einheit (1) angeben, und der Code versucht, nmap zu verwenden. Das hei√üt, dies ist die interne Arbeit von Zabbix, es ist die interne Arbeit des Pingers geworden. Dementsprechend ist keine Synchronisation oder Verwendung eines Trappers erforderlich. Dies wurde absichtlich gemacht, um das System koh√§rent zu lassen und nicht an der Synchronisation zweier Basissysteme teilzunehmen: Was ist zu √ºberpr√ºfen, durch den Poller auszuf√ºllen und ob die F√ºllung in uns gebrochen ist? Dies ist viel einfacher. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">Funktioniert</font></b><font style="vertical-align: inherit;"> es auch f√ºr einen Proxy? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, aber wir haben es nicht √ºberpr√ºft. Der Abrufcode ist sowohl in Zabbix als auch auf dem Server gleich. Sollte arbeiten. Ich betone noch einmal: Die Systemleistung ist so, dass wir keinen Proxy ben√∂tigen.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die richtige Antwort auf die Frage lautet: "Warum brauchen Sie einen Proxy mit einem solchen System?" </font><font style="vertical-align: inherit;">Nur wegen NAT'a oder um √ºber einen langsamen Kanal einige zu √ºberwachen ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und Sie verwenden Zabbix als Allergen, wenn ich das richtig verstehe. </font><font style="vertical-align: inherit;">Oder die Grafiken (wo befindet sich die Archivschicht), die Sie f√ºr ein anderes System wie Grafana hinterlassen haben? </font><font style="vertical-align: inherit;">Oder nutzen Sie diese Funktionalit√§t nicht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich werde noch einmal betonen: Wir haben die vollst√§ndige Integration vorgenommen. </font><font style="vertical-align: inherit;">Wir gie√üen Geschichte in "Clickhouse", haben aber gleichzeitig das PHP-Frontend ge√§ndert. </font><font style="vertical-align: inherit;">Das PHP-Frontend geht zu "Clickhouse" und macht alle Grafiken von dort. </font><font style="vertical-align: inherit;">Gleichzeitig haben wir, um ehrlich zu sein, einen Teil, der aus demselben ‚ÄûClickhouse‚Äú, denselben Zabbix-Daten und Daten in anderen grafischen Anzeigesystemen besteht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Auch in "Grafan".</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie wurde die Entscheidung getroffen, Ressourcen zuzuweisen?</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Teilen Sie eine kleine innere K√ºche. </font><font style="vertical-align: inherit;">Wie wurde die Entscheidung getroffen, Ressourcen f√ºr eine ernsthafte Produktverarbeitung bereitzustellen? </font><font style="vertical-align: inherit;">Dies sind im Allgemeinen bestimmte Risiken. </font><font style="vertical-align: inherit;">Und bitte sagen Sie mir im Zusammenhang mit der Tatsache, dass Sie neue Versionen unterst√ºtzen werden: Wie ist diese Entscheidung aus Managementsicht gerechtfertigt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Anscheinend haben wir das Drama der Geschichte nicht sehr gut erz√§hlt. </font><font style="vertical-align: inherit;">Wir befanden uns in einer Situation, in der etwas getan werden musste, und gingen im Wesentlichen zwei parallele Befehle aus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einer war damit besch√§ftigt, ein √úberwachungssystem mit neuen Methoden zu starten: Monitoring as a Service, ein Standardsatz von Open Source-L√∂sungen, die wir kombinieren und dann versuchen, den Gesch√§ftsprozess zu √§ndern, um mit dem neuen √úberwachungssystem zu arbeiten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parallel dazu hatten wir einen begeisterten Programmierer, der dies tat (√ºber sich selbst). </font><font style="vertical-align: inherit;">So kam es, dass er gewann.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und wie gro√ü ist das Team? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sie ist vor dir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das hei√üt, wie immer wird ein Leidenschaftlicher gebraucht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich wei√ü nicht, was ein Leidenschaftlicher ist. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In diesem Fall anscheinend Sie. </font><font style="vertical-align: inherit;">Vielen Dank, du bist cool. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Danke.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber Patches f√ºr Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bei einem System, das Proxys verwendet (z. B. in einigen verteilten Systemen), k√∂nnen Sie beispielsweise Poller, Proxys und teilweise den Pr√§prozessor von Zabbix selbst anpassen und patchen. und ihre Interaktion? Ist es m√∂glich, bestehende Entwicklungen f√ºr ein System mit mehreren Proxys zu optimieren? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich wei√ü, dass der Zabbix-Server mithilfe eines Proxys zusammengestellt wird (er wird kompiliert und der Code wird abgerufen). Wir haben dies im Produkt nicht getestet. Ich bin mir nicht sicher, aber meiner Meinung nach wird der Pr√§prozessor-Manager nicht im Proxy verwendet. Die Aufgabe des Proxys besteht darin, eine Reihe von Metriken von Zabbix zu √ºbernehmen, sie auszuf√ºllen (es schreibt auch die Konfiguration und die lokale Datenbank) und sie an den Zabbix-Server zur√ºckzugeben. Dann f√ºhrt der Server selbst die Vorverarbeitung durch, wenn er sie empf√§ngt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Interesse an Stimmrechtsvertretern ist verst√§ndlich. </font><font style="vertical-align: inherit;">Wir werden dies √ºberpr√ºfen. </font><font style="vertical-align: inherit;">Dies ist ein interessantes Thema. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Idee war folgende: Wenn Sie Poller patchen k√∂nnen, k√∂nnen sie auf Proxys gepatcht und die Interaktion mit dem Server gepatcht werden, und der Pr√§prozessor kann nur auf dem Server f√ºr diese Zwecke angepasst werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich denke, alles ist noch einfacher. </font><font style="vertical-align: inherit;">Sie nehmen den Code, wenden den Patch an und konfigurieren ihn nach Bedarf. Sammeln Sie die Proxyserver (z. B. mit ODBC) und verteilen Sie den gepatchten Code an die Systeme. </font><font style="vertical-align: inherit;">Wo n√∂tig - Proxies sammeln, wo n√∂tig - Server. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Au√üerdem m√ºssen Sie die Proxy-√úbertragung h√∂chstwahrscheinlich nicht auf den Server patchen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nein, es ist Standard. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eigentlich klang eine der Ideen nicht. </font><font style="vertical-align: inherit;">Wir haben immer ein Gleichgewicht zwischen einer Explosion von Ideen und der Anzahl der √Ñnderungen und der Leichtigkeit der Unterst√ºtzung gehalten.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3yRt9jSwrlg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Werbung :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank f√ºr Ihren Aufenthalt bei uns. Gef√§llt dir unser Artikel? M√∂chten Sie weitere interessante Materialien sehen? Unterst√ºtzen Sie uns, indem Sie eine Bestellung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgeben</font></a><font style="vertical-align: inherit;"> oder Ihren Freunden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud-basiertes VPS f√ºr Entwickler ab 4,99 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfehlen </font><font style="vertical-align: inherit;">, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzigartiges Analogon von Einstiegsservern, das von uns f√ºr Sie erfunden wurde: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ganze Wahrheit √ºber VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 $ oder wie teilt man den Server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verf√ºgbar). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2-mal g√ºnstiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nur wir haben </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV von 199 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den Niederlanden!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie mehr √ºber</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Aufbau eines Infrastrukturgeb√§udes. </font><font style="vertical-align: inherit;">Klasse C mit Dell R730xd E5-2650 v4-Servern f√ºr 9.000 Euro f√ºr einen Cent?</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de486540/">https://habr.com/ru/post/de486540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486518/index.html">Wie vor 20 Jahren</a></li>
<li><a href="../de486528/index.html">Dies ist die Norm - 3: normale Kartentypen</a></li>
<li><a href="../de486530/index.html">Mainstream. Ehrenarbeiter. Biographischer Roman</a></li>
<li><a href="../de486532/index.html">Datensicherung mit einer Reihe von FreeFileSync und 7-zip</a></li>
<li><a href="../de486538/index.html">Wie ich Soft Skills online hochgeladen habe und was es mir gab</a></li>
<li><a href="../de486542/index.html">Analysieren Sie den Sound eines DF√ú-Modems</a></li>
<li><a href="../de486544/index.html">Zwei Stunden und 3,5 Dollar. Wie ich eine einfache Seite mit Visualisierung der Verbreitung von Coronavirus erstellt habe</a></li>
<li><a href="../de486548/index.html">Primitive rekursive Funktionen und Ackerman-Funktion</a></li>
<li><a href="../de486552/index.html">‚ÄûKulturcode: Die Geheimnisse √§u√üerst erfolgreicher Gruppen und Organisationen‚Äú - Notizen aus dem Buch</a></li>
<li><a href="../de486554/index.html">Slurm DevOps. Drei Tage Eintauchen in DevOps. Und ein Vortrag von Anatoly Wasserman "Das Computerproblem des Sozialismus"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>