<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👨‍👧‍👧 👋🏻 👍🏽 HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100 kNVPS auf einem Server 👩🏾‍⚕️ 🖤 🚵🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die nächste HighLoad ++ - Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt. Details und Tickets hier . HighLoad ++ Moskau 2018. Moskau...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Makurov, Maxim Chernetsov (Intersvyaz): Zabbix, 100 kNVPS auf einem Server</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/486540/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die nächste HighLoad ++ - Konferenz findet am 6. und 7. April 2020 in St. Petersburg statt. Details und Tickets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . HighLoad ++ Moskau 2018. Moskauer Halle. 9. November, 15 Uhr Abstracts und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Präsentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/dm/mu/sadmmupp8vt5l5vl5obukgut36a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Überwachung - Online und Analyse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Die Hauptbeschränkungen der ZABBIX-Plattform. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Lösung zur Skalierung des Analytics-Speichers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* ZABBIX-Serveroptimierung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* UI-Optimierung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Erfahrung im Betrieb des Systems mit Lasten von mehr als 40.000 NVPS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* Kurz Schlussfolgerungen.</font></font><a name="habracut"></a><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Makurov (im Folgenden - MM):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hallo allerseits! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maxim Chernetsov (im Folgenden - MCH):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Guten Tag! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lassen Sie mich Maxim vorstellen. Max ist ein talentierter Ingenieur, der beste Netzwerker, den ich kenne. Maxim befasst sich mit Netzwerken und Diensten, deren Entwicklung und Betrieb. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/pn/q6/ujpnq61idhrrwq2dszdhb3hxjza.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und ich würde gerne über Michael sprechen. Michael ist ein C-Entwickler. Er hat einige hoch geladene Verkehrsverarbeitungslösungen für unser Unternehmen geschrieben. Wir leben und arbeiten im Ural, in der Stadt der strengen Bauern von Tscheljabinsk, in der Firma Intersvyaz. Unser Unternehmen ist ein Anbieter von Internet- und Kabelfernsehdiensten für eine Million Menschen in 16 Städten. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Und es ist erwähnenswert, dass Intersvyaz viel mehr als nur ein Anbieter ist, es ist ein IT-Unternehmen. </font><font style="vertical-align: inherit;">Die meisten unserer Entscheidungen werden von unserer IT-Abteilung getroffen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Von Servern, die Datenverkehr verarbeiten, bis zum Call Center und zur mobilen Anwendung. </font><font style="vertical-align: inherit;">In der IT-Abteilung gibt es etwa 80 Mitarbeiter mit sehr, sehr unterschiedlichen Kompetenzen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Über Zabbix und seine Architektur</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und jetzt werde ich versuchen, einen persönlichen Rekord aufzustellen und in einer Minute zu sagen, was Zabbix ist (im Folgenden "Zabbiks"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix positioniert sich auf Unternehmensebene als „out of the box“ -Überwachungssystem. </font><font style="vertical-align: inherit;">Es verfügt über viele lebensvereinfachende Funktionen: erweiterte Eskalationsregeln, APIs für die Integration, Gruppierung und automatische Erkennung von Hosts und Metriken. </font><font style="vertical-align: inherit;">In Zabbix gibt es sogenannte Skalierungswerkzeuge - Proxys. </font><font style="vertical-align: inherit;">Zabbix ist ein Open Source System. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz über Architektur. </font><font style="vertical-align: inherit;">Wir können sagen, dass es aus drei Komponenten besteht:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/fn/xv/ocfnxvdx0gy8qi4055lipyifl1q.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server. </font><font style="vertical-align: inherit;">Es ist in C geschrieben. </font><font style="vertical-align: inherit;">Mit ziemlich komplizierter Verarbeitung und Übertragung von Informationen zwischen Streams. </font><font style="vertical-align: inherit;">Die gesamte Verarbeitung findet darin statt: vom Empfang bis zum Speichern in der Datenbank.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle Daten werden in der Datenbank gespeichert. </font><font style="vertical-align: inherit;">Zabbix unterstützt MySQL, PostreSQL und Oracle.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Webinterface ist in PHP geschrieben. </font><font style="vertical-align: inherit;">Auf den meisten Systemen wird ein Apache-Server mitgeliefert, der jedoch im nginx + php-Bundle effizienter arbeitet.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Heute möchten wir aus dem Leben unseres Unternehmens eine Geschichte über Zabbix erzählen ...</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebensgeschichte der Firma Intersvyaz. </font><font style="vertical-align: inherit;">Was haben wir und was wird benötigt?</font></font></h3><br>
<img src="https://habrastorage.org/webt/d2/cr/rk/d2crrkodjpn2arv0aojibu6vsq4.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor 5 oder 6 Monaten. Einmal nach der Arbeit ... </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mischa, hallo! Ich bin froh, dass ich dich erwischt habe - es gibt ein Gespräch. Wir hatten wieder Probleme mit der Überwachung. Während eines schweren Unfalls verlangsamte sich alles und es gab keine Informationen über den Status des Netzwerks. Leider wird dies nicht das erste Mal wiederholt. Ich brauche deine Hilfe. Lassen Sie unsere Überwachung unter keinen Umständen funktionieren! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber lassen Sie uns zuerst synchronisieren. Ich habe dort seit ein paar Jahren nicht mehr gesucht. Soweit ich mich erinnere, haben wir Nagios abgelehnt und sind vor 8 Jahren zu Zabbix gewechselt. Und jetzt scheinen wir 6 leistungsstarke Server und ungefähr ein Dutzend Proxys zu haben. Verwechsle ich etwas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Fast. 15 Server, von denen einige virtuelle Maschinen sind. Vor allem rettet uns dies nicht in dem Moment, in dem wir es am dringendsten brauchen. Wie ein Unfall - die Server werden langsamer und nichts ist sichtbar. Wir haben versucht, die Konfiguration zu optimieren, dies führt jedoch nicht zu einem optimalen Leistungsgewinn. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. Hast du etwas gesucht, hast du etwas aus der Diagnose herausgegraben? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Das erste, was Sie tun müssen, ist nur die Datenbank. </font><font style="vertical-align: inherit;">MySQL wird so ständig geladen, dass neue Metriken erhalten bleiben. Wenn Zabbix eine Reihe von Ereignissen generiert, wird die Datenbank buchstäblich mehrere Stunden lang in sich selbst gespeichert. </font><font style="vertical-align: inherit;">Ich habe Ihnen bereits von der Optimierung der Konfiguration erzählt, aber dieses Jahr haben wir die Hardware buchstäblich aktualisiert: Auf den Servern und Festplatten-Arrays von SSD RAID-ahs befinden sich mehr als hundert Gigabyte Speicher - es macht keinen Sinn, sie linear zu erweitern. </font><font style="vertical-align: inherit;">Was werden wir machen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. </font><font style="vertical-align: inherit;">Im Allgemeinen ist MySQL eine LTP-Datenbank. </font><font style="vertical-align: inherit;">Anscheinend ist es nicht mehr zum Speichern eines Archivs von Metriken unserer Größe geeignet. </font><font style="vertical-align: inherit;">Lass es uns herausfinden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Komm schon!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration von Zabbix und Clickhouse als Ergebnis eines Hackathons</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach einiger Zeit erhielten wir interessante Daten: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2r/vp/of/2rvpofn2alwwhizhv4e7qrwhpsm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
größte Teil des Speicherplatzes in unserer Datenbank wurde vom Archiv der Metriken belegt, und weniger als 1% wurden für Konfiguration, Vorlagen und Einstellungen verwendet. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt betreiben wir seit mehr als einem Jahr die Big-Data-Lösung auf Basis von Clickhouse. </font><font style="vertical-align: inherit;">Die Bewegungsrichtung war für uns offensichtlich. </font><font style="vertical-align: inherit;">Bei unserem Frühjahrs-Hackathon schrieb er die Integration von Zabbix mit Clickhouse für den Server und das Frontend. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt hatte Zabbix bereits Unterstützung für ElasticSearch, und wir haben beschlossen, diese zu vergleichen.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/jv/hq/bgjvhq9lwget5l-hy1xt9zz2mvo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vergleichen Sie Clickhouse und Elasticsearch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Zum Vergleich haben wir dieselbe Last generiert, die der Zabbix-Server bereitstellt, und uns angesehen, wie sich die Systeme verhalten würden. Wir haben Daten in Stapeln von 1000 Zeilen geschrieben und CURL verwendet. Wir haben zuvor vorgeschlagen, dass das Clickhouse für das Lastprofil von Zabbix effektiver ist. Die Ergebnisse übertrafen sogar unsere Erwartungen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter den gleichen Testbedingungen schrieb das Clickhouse dreimal so viele Daten. Gleichzeitig verbrauchten beide Systeme beim Lesen von Daten sehr effizient (eine kleine Menge an Ressourcen). Für „Elastix“ war jedoch bei der Aufnahme eine große Menge an Prozessor erforderlich:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zz/iz/pj/zzizpjgv0rf9zjuuasv7mds7is8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Insgesamt hat Clickhouse Elastix in Bezug auf Prozessorverbrauch und -geschwindigkeit deutlich übertroffen. Gleichzeitig verwendet „Clickhouse“ aufgrund der Datenkomprimierung 11-mal weniger Festplattenlaufwerke und führt etwa 30-mal weniger Festplattenvorgänge aus: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yf/0u/ce/yf0uceb3lvfa4e3mdwz1fsgufkw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, die Arbeit mit dem Festplattensubsystem bei „Clickhouse“ ist sehr effektiv. Unter den Basen können Sie riesige SATA-Festplatten verwenden und eine Schreibgeschwindigkeit von Hunderttausenden von Zeilen pro Sekunde erreichen. Das System "out of the box" unterstützt Sharding, Replikation, es ist sehr einfach zu konfigurieren. Wir sind mehr als zufrieden mit dem Betrieb seit einem Jahr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Ressourcen zu optimieren, können Sie "Clickhouse" neben der vorhandenen Hauptbasis installieren und so viel Prozessorzeit und Festplattenvorgänge sparen. Wir haben das Metrikarchiv für die vorhandenen „Clickhouse“ -Cluster herausgenommen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/xr/p9/quxrp9ah4u-nhwlbkkcgynf2to0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben die MySQL-Hauptdatenbank so weit entladen, dass wir sie auf demselben Computer mit dem Zabbix-Server kombinieren und den dedizierten Server für MySQL aufgeben konnten.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie funktioniert das Polling in Zabbix?</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor 4 Monaten </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nun, Sie können die Probleme mit der Basis vergessen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das ist sicher! Ein weiteres Problem, das wir lösen müssen, ist die langsame Datenerfassung. Jetzt sind alle unsere 15 Proxys mit SNMP- und Polling-Prozessen überlastet. Und es gibt nichts anderes als das Einrichten neuer und neuer Server. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Großartig. Aber sagen Sie mir zuerst, wie Polling in Zabbix funktioniert. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Kurz gesagt, es gibt 20 Arten von Metriken und ein Dutzend Möglichkeiten, diese zu erhalten. Zabbix kann Daten entweder im "Request-Response" -Modus erfassen oder neue Daten über die "Trapper-Schnittstelle" erwarten. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f1/dd/jc/f1ddjcw--iidqz7psmv82znkwk0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist erwähnenswert, dass diese Methode (Trapper) im ursprünglichen Zabbix die schnellste ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Proxys für den Lastausgleich:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/n3/2v/qln32vd8mjkz2xbe0bowbswrpsu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxies können dieselben Erfassungsfunktionen wie der Zabbix-Server ausführen, Aufgaben von ihm empfangen und erfasste Metriken über die Trapper-Schnittstelle senden. </font><font style="vertical-align: inherit;">Dies ist die offiziell empfohlene Lastausgleichsmethode. </font><font style="vertical-align: inherit;">Proxys sind auch nützlich für die Überwachung einer Remote-Infrastruktur, die über NAT oder einen langsamen Kanal funktioniert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/uv/mh/bauvmh-9-mcmokuu7ldhtx59--0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mit der Architektur ist alles klar. </font><font style="vertical-align: inherit;">Wir müssen uns die Quelle ansehen ... </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Tage später</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geschichte, wie nmap fping gewonnen hat</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es scheint, dass ich etwas ausgegraben habe. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sag es mir! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich habe festgestellt, dass Zabbix bei Verfügbarkeitsprüfungen bis zu 128 Hosts gleichzeitig überprüft. Ich habe versucht, diese Zahl auf 500 zu erhöhen, und das Intervall zwischen den Paketen in ihrem Ping (Ping) entfernt - dies hat die Leistung um den Faktor zwei erhöht. Aber ich hätte gerne große Zahlen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In meiner Praxis muss ich manchmal die Verfügbarkeit von Tausenden von Hosts überprüfen, und ich habe nichts schnelleres als nmap gesehen. Ich bin sicher, dass dies der schnellste Weg ist. Lass es uns versuchen! Sie müssen die Anzahl der Hosts in einer Iteration erheblich erhöhen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mehr als fünfhundert prüfen? 600? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mindestens ein paar Tausend. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Okay. Das Wichtigste, was ich sagen wollte: Ich stellte fest, dass die meisten Umfragen in Zabbix synchron durchgeführt wurden. Wir müssen es asynchron wiederholen. Dann können wir die Anzahl der von den Pollern gesammelten Metriken drastisch erhöhen, insbesondere wenn wir die Anzahl der Metriken in einer Iteration erhöhen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Großartig! Und wann? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wie immer gestern. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir haben beide Versionen von fping und nmap verglichen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/du/ii/qoduiid8hzk_wy8sxvgityvungo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf einer großen Anzahl von Hosts wurde erwartet, dass nmap bis zu fünfmal effizienter ist. </font><font style="vertical-align: inherit;">Da nmap nur die Verfügbarkeit und die Antwortzeit überprüft, haben wir die Verlustberechnung auf Trigger übertragen und die Intervalle für die Verfügbarkeitsprüfung erheblich reduziert. </font><font style="vertical-align: inherit;">Wir haben die optimale Anzahl von Hosts für nmap im Bereich von 4.000 pro Iteration gefunden. </font><font style="vertical-align: inherit;">Mit Nmap konnten wir die CPU-Kosten für Verfügbarkeitsprüfungen um das Dreifache reduzieren und das Intervall von 120 Sekunden auf 10 Sekunden verkürzen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polling-Optimierung</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dann haben wir uns für Meinungsforscher entschieden. Wir waren hauptsächlich an SNMP-Entfernung und Agenten interessiert. In Zabbix wurden die Abfragen synchron durchgeführt und spezielle Maßnahmen ergriffen, um die Effizienz des Systems zu erhöhen. Im synchronen Modus führt die Nichtverfügbarkeit des Hosts zu einer erheblichen Verschlechterung der Abfrage. Es gibt ein ganzes System von Zuständen, es gibt spezielle Prozesse - die sogenannten nicht erreichbaren Poller, die nur mit unzugänglichen Hosts arbeiten: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3g/h1/fm/3gh1fmfnq3nqxkpwsow7j4h80ra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist ein Kommentar, der die Zustandsmatrix zeigt, die Komplexität des Übergangssystems, die erforderlich ist, damit das System effektiv bleibt. Darüber hinaus ist die synchrone Abfrage selbst eher langsam:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h7/0r/tm/h70rtmvjonmj3itlmq4wk44vpr8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus diesem Grund konnten Tausende von Poller-Threads auf einem Dutzend Proxys nicht die erforderliche Datenmenge für uns erfassen. Die asynchrone Implementierung löste nicht nur die Probleme mit der Anzahl der Threads, sondern vereinfachte auch das </font></font><br>
<br>
<img src="https://habrastorage.org/webt/re/te/bj/retebjsm9vthvrjy7rmpobeiwqa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Statussystem </font><font style="vertical-align: inherit;">unzugänglicher Hosts erheblich, da für jede in einer Iteration der Abfrage überprüfte Anzahl die maximale Wartezeit 1 Zeitüberschreitung betrug: </font><font style="vertical-align: inherit;">Zusätzlich haben wir das Abfragesystem für SNMP- modifiziert und verbessert. Anfragen. Tatsache ist, dass die meisten nicht gleichzeitig auf mehrere SNMP-Anfragen antworten können. Aus diesem Grund haben wir einen Hybridmodus erstellt, wenn die SNMP-Abfrage desselben Hosts asynchron erfolgt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mj/9a/sj/mj9asjfzaisviljstpkdjpvmnya.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies erfolgt für das gesamte Host-Bundle. Dieser Modus ist am Ende nicht langsamer als vollständig asynchron, da das Abrufen von eineinhalb hundert SNMP-Werten immer noch viel schneller als eine Zeitüberschreitung ist.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Experimente haben gezeigt, dass die optimale Anzahl von Anforderungen in einer Iteration bei SNMP-Abfragen etwa 8.000 beträgt. </font><font style="vertical-align: inherit;">Insgesamt konnte durch den Übergang in den asynchronen Modus die Abfrageleistung um das 200-fache, mehrere hundertfache beschleunigt werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die erhaltenen Abfrageoptimierungen haben gezeigt, dass wir nicht nur alle Proxys entfernen, sondern auch die Intervalle für viele Überprüfungen verkürzen können und keine Proxys benötigt werden, um die Last zu teilen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor ungefähr drei Monaten</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ändern Sie die Architektur - erhöhen Sie die Last!</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nun, Max, ist es Zeit, produktiv zu sein? Ich brauche einen leistungsstarken Server und einen guten Ingenieur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nun, wir planen. Es ist Zeit, mit 5.000 Metriken pro Sekunde loszulegen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Morgen nach dem </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH- </font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">Upgrade </font></i><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> - Mischa, wir haben aktualisiert, aber am Morgen zurückgesetzt ... Ratet mal, welche Geschwindigkeit Sie erreicht haben? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Maximal tausend. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, 25! Leider sind wir dort, wo wir angefangen haben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und so? Haben Sie eine Diagnose erhalten? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja natürlich! Hier zum Beispiel ein interessantes Top: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6c/zv/6s/6czv6sdkoykmdkm0vn-sddnbbpw.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mal sehen. Ich sehe, dass wir eine große Anzahl von Abfragethreads ausprobiert haben: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/a0/cl/qba0clfwpherpsufnk_7fbn5ioy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gleichzeitig konnten wir das System nicht einmal zur Hälfte nutzen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/wv/8b/spwv8blrzyggfwo5ps-objpypak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und die Gesamtleistung ist mit etwa 4.000 Metriken pro Sekunde recht gering: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tt/6o/zr/tt6ozrt2ortiof4kckeghltzrnq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gibt es noch etwas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, Strace eines der Poller: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/p8/ny/y3/p8nyy3kb_ffjhsjynlpz4wjfh8w.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hier ist deutlich zu sehen, dass der Polling-Prozess auf „Semaphoren“ wartet. Dies sind Sperren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z7/ks/mh/z7ksmh8kes9yc23tm0vuyu5g8r8.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es ist nicht klar. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sehen Sie, dies ist wie eine Situation, in der eine Reihe von Threads versuchen, mit Ressourcen zu arbeiten, mit denen jeweils nur einer arbeiten kann. Dann können sie diese Ressource nur noch nach Zeit teilen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/in/ce/mo/incemofethgxpp3fwyabr8kstd4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Gesamtproduktivität der Arbeit mit einer solchen Ressource wird durch die Geschwindigkeit eines Kerns begrenzt: Es </font></font><br>
<br>
<img src="https://habrastorage.org/webt/oq/oh/9f/oqoh9fqs9ppftn5mab3aivoo2nq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gibt zwei Möglichkeiten, dieses Problem zu lösen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aktualisieren Sie das Maschineneisen und wechseln Sie zu schnelleren Kerneln:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/bd/zi/iobdziopu3g_vkfoengg2zhhcro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder ändern Sie die Architektur und </font><font style="vertical-align: inherit;">gleichzeitig </font><font style="vertical-align: inherit;">die Last: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/sl/wt/nuslwtjkx-poqob5ciqyyfifq48.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Übrigens verwenden wir auf einer Testmaschine weniger Kerne als auf einer Kampfmaschine, aber die Frequenz pro Kern ist 1,5-mal schneller! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ist das klar? </font><font style="vertical-align: inherit;">Es ist notwendig, den Servercode zu überprüfen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenpfad in Zabbix Server</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Um zu verstehen, haben wir angefangen zu analysieren, wie die Daten innerhalb des Zabbix-Servers übertragen werden: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/v9/iu/a2/v9iua26a6om3flgzj_vb3te0hak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cooles Bild, richtig? Lassen Sie uns Schritt für Schritt durchgehen, um mehr oder weniger zu klären. Es gibt Streams und Dienste, die für das Sammeln von Daten verantwortlich sind: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h3/m9/kt/h3m9ktuwhpgwe1g4mbqjiw8l_zs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie übertragen die gesammelten Metriken über den Socket an den Präprozessor-Manager, wo sie in die Warteschlange gestellt werden: Der </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9d/ct/fv/9dctfvdiw2zaves1vn34gliuvmu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Präprozessor-Manager überträgt Daten an seine Mitarbeiter, die die Vorverarbeitungsanweisungen ausführen, und gibt sie über denselben Socket zurück: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ma/qd/ss/maqdssje-vzlzzpfzl0x2cuthwo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach den Präprozessor -manager speichert sie im Verlaufs-Cache:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/9q/vw/5r9qvwyriydt0pcroma7n-14fsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von dort aus werden sie von Verlaufssenkern erfasst, die eine Vielzahl von Funktionen ausführen: zum Beispiel das Berechnen von Triggern, das Füllen des Wertecaches und vor allem das Speichern von Metriken im Verlaufsspeicher. </font><font style="vertical-align: inherit;">Im Allgemeinen ist der Prozess komplex und sehr verwirrend. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f7/o8/ih/f7o8ihzf_g5_2ecganu1t0zoss0.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das erste, was wir gesehen haben, ist, dass die meisten Threads um den sogenannten "Konfigurationscache" konkurrieren (ein Speicherbereich, in dem alle Serverkonfigurationen gespeichert sind). </font><font style="vertical-align: inherit;">Besonders viele Sperren werden von den für die Datenerfassung verantwortlichen Streams vorgenommen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ba/oo/48/baoo48qthdg_pcp0ojgqh0de5us.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... da in der Konfiguration nicht nur Metriken mit ihren Parametern gespeichert werden, sondern auch Warteschlangen, aus denen die Poller Informationen darüber abrufen, was als Nächstes zu tun ist. </font><font style="vertical-align: inherit;">Wenn es viele Poller gibt und einer die Konfiguration blockiert, warten die anderen auf Anfragen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/y5/zb/np/y5zbnpqumrszencyhaasflytwvm.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meinungsforscher dürfen nicht in Konflikt geraten</font></font></h3><br>
<img src="https://habrastorage.org/webt/kw/11/4f/kw114ff5k91eqlycs-yg8p8bmem.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daher haben wir als erstes die Warteschlange in vier Teile unterteilt und den Pollern ermöglicht, diese Warteschlangen gleichzeitig sicher zu blockieren: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/la/gi/xu/lagixuseh1aghovklgd6m3blkxu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadurch wurde die Konkurrenz um den Konfigurationscache beseitigt und die Geschwindigkeit der Poller wurde erheblich erhöht. </font><font style="vertical-align: inherit;">Aber dann wurden wir mit der Tatsache konfrontiert, dass der Präprozessor-Manager begann, eine Job-Warteschlange aufzubauen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ui/0c/4i/ui0c4i7aae8kqdvkdtorchzft-y.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Präprozessor-Manager sollte Prioritäten setzen können</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies geschah, als ihm die Produktivität fehlte. </font><font style="vertical-align: inherit;">Dann konnte er nur noch Anforderungen aus den Datenerfassungsprozessen sammeln und deren Puffer hinzufügen, bis er den gesamten Speicher verbraucht und abstürzt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9y/iy/oz/9yiyozxavyibcw8pog3tidwy-xc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dieses Problem zu lösen, haben wir einen zweiten Socket hinzugefügt, der speziell für Mitarbeiter zugewiesen wurde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rb/sz/25/rbsz25axpkn6a832h9k7otp9je4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So. Der Präprozessor-Manager hatte die Möglichkeit, seine Arbeit zu priorisieren, und falls der Puffer wächst, besteht die Aufgabe darin, das Essen zu verlangsamen und den Arbeitern die Möglichkeit zu geben, diesen Puffer aufzunehmen: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/og/cg/qiogcgztt1an1ewlrear7oqxt7g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann stellten wir fest, dass einer der Gründe für die Verlangsamung darin bestand, dass die Arbeiter selbst im Wettbewerb standen </font><font style="vertical-align: inherit;">wichtige Ressource für ihre Arbeit. </font><font style="vertical-align: inherit;">Wir haben dieses Problem mit einer Fehlerbehebung registriert und in den neuen Versionen von Zabbix wurde es bereits behoben:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yd/6q/lr/yd6qlrqamuxreroffkeracyrnim.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir erhöhen die Anzahl der Steckdosen - wir erhalten das Ergebnis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Außerdem wurde der Präprozessor-Manager selbst zu einem engen Link, da es sich um einen einzelnen Thread handelt. </font><font style="vertical-align: inherit;">Es beruhte auf der Geschwindigkeit des Kerns und ergab eine maximale Geschwindigkeit von ungefähr 70.000 Metriken pro Sekunde: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uk/s1/2_/uks12_i65kx3ohfqdfmvedyqdqw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deshalb haben wir vier mit vier Sockelsätzen als Arbeiter erstellt: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qt/-u/ws/qt-uwsmlriplii491ao0we3jhg4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dies ermöglichte es uns, die Geschwindigkeit auf ungefähr 130.000 Metriken zu erhöhen: Die </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ql/vp/cf/qlvpcfggoinhdxc4dfkniaz9po8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nichtlinearität des Wachstums erklärt sich aus der Tatsache, dass es Konkurrenz um den Cache gab Geschichten. </font><font style="vertical-align: inherit;">Für ihn traten 4 Präprozessor-Manager und historische Synker an. </font><font style="vertical-align: inherit;">Zu diesem Zeitpunkt haben wir auf einer Testmaschine ungefähr 130.000 Metriken pro Sekunde erhalten, die zu 95% auf dem Prozessor verwendet wurden: vor </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yo/7l/mh/yo7lmhcfcdbhek5blp5xdz0osfy.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ungefähr 2,5 Monaten</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ablehnung der snmp-Community erhöhte die NVPs um das Eineinhalbfache</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Max, ich brauche eine neue Testmaschine! Wir passen nicht mehr in die aktuelle. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und was ist jetzt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Jetzt - 130.000 NVPs und ein "Regal" -Prozessor. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wow! Cool! Warten Sie, ich habe zwei Fragen. Nach meinen Berechnungen liegt unser Bedarf im Bereich von 15 bis 20.000 Metriken pro Sekunde. Warum brauchen wir mehr? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich möchte den Job bis zum Ende beenden. Ich möchte sehen, wie viel wir aus diesem System herausholen können. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Aber es ist für das Geschäft nutzlos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. Und die zweite Frage: Was wir jetzt haben, können wir uns ohne die Hilfe eines Entwicklers selbst unterstützen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich denke nicht. Das Ändern des Konfigurationscaches ist ein Problem. Es behandelt Änderungen in den meisten Threads und ist schwer zu pflegen. Höchstwahrscheinlich wird es sehr schwierig sein, sie zu unterstützen. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dann brauchen Sie eine Alternative. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Es gibt eine solche Option. Wir können auf schnelle Kerne umsteigen und gleichzeitig das neue Schließsystem aufgeben. Wir erhalten immer noch die Leistung von 60-80.000 Metriken. In diesem Fall können wir den Rest des Codes belassen. Clickhouse, asynchrones Polling funktioniert. Und es wird leicht zu warten sein. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Großartig! Ich schlage vor, darauf einzugehen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die Serverseite optimiert hatten, konnten wir den neuen Code endlich produktiv ausführen. </font><font style="vertical-align: inherit;">Wir haben einen Teil der Änderungen zugunsten des Wechsels zu einem Computer mit schnellen Kerneln und der Minimierung der Anzahl der Änderungen im Code aufgegeben. </font><font style="vertical-align: inherit;">Wir haben auch die Konfiguration vereinfacht und die Makros in den Datenelementen nach Möglichkeit aufgegeben, da sie die Quelle zusätzlicher Sperren sind. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bk/v7/tp/bkv7tps-i9usalann4sbqpdbkqm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ablehnung des snmp-community-Makros, das häufig in Dokumentationen und Beispielen zu finden ist, ermöglichte es uns in unserem Fall, NVPs zusätzlich um das 1,5-fache zu beschleunigen. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach zwei Tagen in der Produktion</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entfernen Sie Popups zum Vorfallverlauf</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mischa, wir benutzen das System zwei Tage lang und alles funktioniert. Aber nur wenn alles funktioniert! Wir hatten die Arbeit mit der Übertragung eines ausreichend großen Teils des Netzwerks geplant und erneut mit unseren Händen überprüft, ob es gestiegen war, nicht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das kann nicht sein! Wir haben alles 10 mal überprüft. Der Server verarbeitet sogar die vollständige Unzugänglichkeit des Netzwerks sofort. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, ich verstehe alles: Server, Basis, Top, Austat, Protokolle - alles ist schnell ... Aber wir schauen uns die Weboberfläche an und dort haben wir den Prozessor "im Regal" auf dem Server und dies: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vj/un/p2/vjunp2evh3whasvpw4hwsipeshk.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich verstehe. Schauen wir uns das Web an. Wir haben festgestellt, dass in einer Situation mit einer großen Anzahl aktiver Vorfälle die meisten betrieblichen Widgets sehr langsam zu arbeiten begannen:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nz/vw/kz/nzvwkzfbeg-4r1iue0y4178eg2q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Grund dafür war die Generierung von Popups mit einer Historie von Vorfällen, die für jedes Element in der Liste generiert werden. </font><font style="vertical-align: inherit;">Daher haben wir uns geweigert, diese Fenster zu generieren (5 Zeilen im Code auskommentiert), und dies hat unsere Probleme gelöst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ladezeit des Widgets wurde, selbst wenn sie nicht zugänglich war, von einigen Minuten auf 10-15 Sekunden reduziert, und der Verlauf kann weiterhin angezeigt werden, indem Sie auf die Zeit klicken: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hu/dc/4l/hudc4lsz_skbshg7jphleuprc4a.jpeg"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach der Arbeit. </font><font style="vertical-align: inherit;">Vor 2 Monaten </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mischa, gehst du? </font><font style="vertical-align: inherit;">Wir müssen reden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich werde nicht. </font><font style="vertical-align: inherit;">Wieder etwas mit Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oh nein, entspann dich! </font><font style="vertical-align: inherit;">Ich wollte nur sagen: alles funktioniert, danke! </font><font style="vertical-align: inherit;">Bier mit mir.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix ist wirksam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix ist ein ziemlich vielseitiges und reichhaltiges System und Funktion. </font><font style="vertical-align: inherit;">Es kann sofort für kleine Installationen verwendet werden, muss jedoch mit zunehmendem Bedarf optimiert werden. </font><font style="vertical-align: inherit;">Verwenden Sie den entsprechenden Speicher, um ein großes Archiv von Metriken zu speichern:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können die integrierten Tools in Form einer Integration mit Elastixerch oder des Hochladens des Verlaufs in Textdateien (verfügbar ab der vierten Version) verwenden.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie können unsere Erfahrung und Integration mit Clickhouse nutzen.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Geschwindigkeit beim Sammeln von Metriken drastisch zu erhöhen, erfassen Sie diese asynchron und übertragen Sie sie über die Trapper-Schnittstelle an den Zabbix-Server. </font><font style="vertical-align: inherit;">oder Sie können den Patch für asynchrone Poller von Zabbix selbst verwenden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zabbix ist in C geschrieben und sehr effektiv. </font><font style="vertical-align: inherit;">Die Lösung mehrerer enger architektonischer Bereiche ermöglicht es, die Produktivität weiter zu steigern und nach unserer Erfahrung mehr als 100.000 Metriken auf einem Computer mit einem Prozessor zu erhalten.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5r/db/d2/5rdbd2jcvr75sosfvfa6ziniwps.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der gleiche Zabbix-Patch</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich möchte ein paar Punkte hinzufügen. </font><font style="vertical-align: inherit;">Der gesamte aktuelle Bericht, alle Tests und Nummern sind für die Konfiguration angegeben, die bei uns verwendet wird. </font><font style="vertical-align: inherit;">Wir nehmen jetzt ungefähr 20.000 Metriken pro Sekunde davon. </font><font style="vertical-align: inherit;">Wenn Sie versuchen zu verstehen, ob dies für Sie funktioniert, können Sie vergleichen. </font><font style="vertical-align: inherit;">Worüber sie heute gesprochen haben, wird auf GitHub als Patch veröffentlicht: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/miklert/zabbix</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/xb/wd/y1/xbwdy18hq9dolceyxku_2wxsj4a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der Patch enthält:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vollständige Integration mit Clickhouse (sowohl Zabbix-Server als auch Frontend);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lösen von Problemen mit dem Präprozessor-Manager;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">asynchrones Polling.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Patch ist mit allen Versionen 4 kompatibel, einschließlich lts. </font><font style="vertical-align: inherit;">Höchstwahrscheinlich funktioniert es mit minimalen Änderungen unter Version 3.4. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank für Ihre Aufmerksamkeit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fragen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Frage des Publikums (im Folgenden - A): - Guten Tag! Bitte sagen Sie mir, haben Sie Pläne für eine intensive Interaktion mit dem Zabbix-Team oder haben sie mit Ihnen, damit dies kein Patch ist, sondern das normale Verhalten von Zabbix? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, wir werden sicherlich einen Teil der Änderungen vornehmen. Etwas wird sein, etwas wird im Patch bleiben. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vielen Dank für den hervorragenden Bericht! Sagen Sie mir bitte, nachdem Sie den Patch angewendet haben, bleibt die Unterstützung von der Seite von Zabbix bestehen und wie können Sie weiterhin auf höhere Versionen aktualisieren? Wird es möglich sein, Zabbix nach Ihrem Patch auf 4.2, 5.0 zu aktualisieren? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich kann nichts über Unterstützung sagen. Wenn ich der technische Support von Zabbix wäre, würde ich wahrscheinlich nein sagen, da dies der Code eines anderen ist. In Bezug auf die Codebasis 4.2 lautet unsere Position wie folgt: "Wir werden mit der Zeit gehen und wir werden auf die nächste Version aktualisiert." Daher werden wir den Patch für einige Zeit auf aktualisierte Versionen hochladen. Ich habe bereits im Bericht gesagt: Die Anzahl der Änderungen an den Versionen ist immer noch recht gering. Ich denke, der Übergang von 3,4 auf 4 hat anscheinend 15 Minuten gedauert. Dort hat sich etwas geändert, aber nicht sehr wichtig. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sie planen also, Ihren Patch zu warten und können ihn sicher in Betrieb nehmen, um in Zukunft auf irgendeine Weise Updates zu erhalten? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wir empfehlen es dringend. Dies löst viele Probleme für uns. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ich möchte noch einmal betonen, dass Änderungen, die sich nicht auf die Architektur und nicht auf Sperren und Warteschlangen beziehen, modular sind und sich in separaten Modulen befinden. Selbst mit geringfügigen Änderungen können sie problemlos gewartet werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wenn die Details interessant sind, verwendet „Clickhouse“ die sogenannte Verlaufsbibliothek. Es ist nicht gebunden - dies ist eine Kopie der Unterstützung von Elastic, dh es ist konfigurierbar. Durch das Abrufen werden nur die Poller geändert. Wir glauben, dass dies noch lange funktionieren wird. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vielen Dank. Aber sagen Sie mir, gibt es eine Dokumentation der vorgenommenen Änderungen? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r7/vv/h3/r7vvh3optatasclqsm9tjftkmja.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Dokumentation ist ein Patch. </font><font style="vertical-align: inherit;">Offensichtlich ergeben sich mit der Einführung von „Clickhouse“ und der Einführung neuer Poller-Typen neue Konfigurationsoptionen. </font><font style="vertical-align: inherit;">Der Link von der letzten Folie enthält eine kurze Beschreibung der Verwendung.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Über das Ersetzen von fping durch nmap</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Wie haben Sie das letztendlich umgesetzt? </font><font style="vertical-align: inherit;">Können Sie konkrete Beispiele nennen: Sind es Ihre Strapper und ein externes Skript? </font><font style="vertical-align: inherit;">Was überprüft schließlich so viele Hosts so schnell? </font><font style="vertical-align: inherit;">Wie bekommt man diese Gastgeber? </font><font style="vertical-align: inherit;">Muss nmap sie irgendwie füttern, von irgendwoher holen, hineinstecken, etwas anfangen? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Cool. Sehr richtige Frage! Der Punkt ist dies. Wir haben die Bibliothek (ICMP-Ping, Teil von Zabbix) für ICMP-Überprüfungen geändert, die die Anzahl der Pakete - Einheit (1) angeben, und der Code versucht, nmap zu verwenden. Das heißt, dies ist die interne Arbeit von Zabbix, es ist die interne Arbeit des Pingers geworden. Dementsprechend ist keine Synchronisation oder Verwendung eines Trappers erforderlich. Dies wurde absichtlich gemacht, um das System kohärent zu lassen und nicht an der Synchronisation zweier Basissysteme teilzunehmen: Was ist zu überprüfen, durch den Poller auszufüllen und ob die Füllung in uns gebrochen ist? Dies ist viel einfacher. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">Funktioniert</font></b><font style="vertical-align: inherit;"> es auch für einen Proxy? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ja, aber wir haben es nicht überprüft. Der Abrufcode ist sowohl in Zabbix als auch auf dem Server gleich. Sollte arbeiten. Ich betone noch einmal: Die Systemleistung ist so, dass wir keinen Proxy benötigen.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die richtige Antwort auf die Frage lautet: "Warum brauchen Sie einen Proxy mit einem solchen System?" </font><font style="vertical-align: inherit;">Nur wegen NAT'a oder um über einen langsamen Kanal einige zu überwachen ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und Sie verwenden Zabbix als Allergen, wenn ich das richtig verstehe. </font><font style="vertical-align: inherit;">Oder die Grafiken (wo befindet sich die Archivschicht), die Sie für ein anderes System wie Grafana hinterlassen haben? </font><font style="vertical-align: inherit;">Oder nutzen Sie diese Funktionalität nicht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich werde noch einmal betonen: Wir haben die vollständige Integration vorgenommen. </font><font style="vertical-align: inherit;">Wir gießen Geschichte in "Clickhouse", haben aber gleichzeitig das PHP-Frontend geändert. </font><font style="vertical-align: inherit;">Das PHP-Frontend geht zu "Clickhouse" und macht alle Grafiken von dort. </font><font style="vertical-align: inherit;">Gleichzeitig haben wir, um ehrlich zu sein, einen Teil, der aus demselben „Clickhouse“, denselben Zabbix-Daten und Daten in anderen grafischen Anzeigesystemen besteht. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Auch in "Grafan".</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie wurde die Entscheidung getroffen, Ressourcen zuzuweisen?</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Teilen Sie eine kleine innere Küche. </font><font style="vertical-align: inherit;">Wie wurde die Entscheidung getroffen, Ressourcen für eine ernsthafte Produktverarbeitung bereitzustellen? </font><font style="vertical-align: inherit;">Dies sind im Allgemeinen bestimmte Risiken. </font><font style="vertical-align: inherit;">Und bitte sagen Sie mir im Zusammenhang mit der Tatsache, dass Sie neue Versionen unterstützen werden: Wie ist diese Entscheidung aus Managementsicht gerechtfertigt? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Anscheinend haben wir das Drama der Geschichte nicht sehr gut erzählt. </font><font style="vertical-align: inherit;">Wir befanden uns in einer Situation, in der etwas getan werden musste, und gingen im Wesentlichen zwei parallele Befehle aus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einer war damit beschäftigt, ein Überwachungssystem mit neuen Methoden zu starten: Monitoring as a Service, ein Standardsatz von Open Source-Lösungen, die wir kombinieren und dann versuchen, den Geschäftsprozess zu ändern, um mit dem neuen Überwachungssystem zu arbeiten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parallel dazu hatten wir einen begeisterten Programmierer, der dies tat (über sich selbst). </font><font style="vertical-align: inherit;">So kam es, dass er gewann.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Und wie groß ist das Team? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sie ist vor dir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das heißt, wie immer wird ein Leidenschaftlicher gebraucht? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich weiß nicht, was ein Leidenschaftlicher ist. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - In diesem Fall anscheinend Sie. </font><font style="vertical-align: inherit;">Vielen Dank, du bist cool. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Danke.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Über Patches für Zabbix</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Bei einem System, das Proxys verwendet (z. B. in einigen verteilten Systemen), können Sie beispielsweise Poller, Proxys und teilweise den Präprozessor von Zabbix selbst anpassen und patchen. und ihre Interaktion? Ist es möglich, bestehende Entwicklungen für ein System mit mehreren Proxys zu optimieren? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich weiß, dass der Zabbix-Server mithilfe eines Proxys zusammengestellt wird (er wird kompiliert und der Code wird abgerufen). Wir haben dies im Produkt nicht getestet. Ich bin mir nicht sicher, aber meiner Meinung nach wird der Präprozessor-Manager nicht im Proxy verwendet. Die Aufgabe des Proxys besteht darin, eine Reihe von Metriken von Zabbix zu übernehmen, sie auszufüllen (es schreibt auch die Konfiguration und die lokale Datenbank) und sie an den Zabbix-Server zurückzugeben. Dann führt der Server selbst die Vorverarbeitung durch, wenn er sie empfängt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Interesse an Stimmrechtsvertretern ist verständlich. </font><font style="vertical-align: inherit;">Wir werden dies überprüfen. </font><font style="vertical-align: inherit;">Dies ist ein interessantes Thema. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Idee war folgende: Wenn Sie Poller patchen können, können sie auf Proxys gepatcht und die Interaktion mit dem Server gepatcht werden, und der Präprozessor kann nur auf dem Server für diese Zwecke angepasst werden. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ich denke, alles ist noch einfacher. </font><font style="vertical-align: inherit;">Sie nehmen den Code, wenden den Patch an und konfigurieren ihn nach Bedarf. Sammeln Sie die Proxyserver (z. B. mit ODBC) und verteilen Sie den gepatchten Code an die Systeme. </font><font style="vertical-align: inherit;">Wo nötig - Proxies sammeln, wo nötig - Server. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Außerdem müssen Sie die Proxy-Übertragung höchstwahrscheinlich nicht auf den Server patchen? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCH:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nein, es ist Standard. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MM:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eigentlich klang eine der Ideen nicht. </font><font style="vertical-align: inherit;">Wir haben immer ein Gleichgewicht zwischen einer Explosion von Ideen und der Anzahl der Änderungen und der Leichtigkeit der Unterstützung gehalten.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3yRt9jSwrlg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein bisschen Werbung :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielen Dank für Ihren Aufenthalt bei uns. Gefällt dir unser Artikel? Möchten Sie weitere interessante Materialien sehen? Unterstützen Sie uns, indem Sie eine Bestellung </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgeben</font></a><font style="vertical-align: inherit;"> oder Ihren Freunden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cloud-basiertes VPS für Entwickler ab 4,99 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> empfehlen </font><font style="vertical-align: inherit;">, ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzigartiges Analogon von Einstiegsservern, das von uns für Sie erfunden wurde: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ganze Wahrheit über VPS (KVM) E5-2697 v3 (6 Kerne) 10 GB DDR4 480 GB SSD 1 Gbit / s ab 19 $ oder wie teilt man den Server?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verfügbar). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2-mal günstiger im Equinix Tier IV-Rechenzentrum in Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nur wir haben </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2,6 GHz 14C 64 GB DDR4 4 x 960 GB SSD 1 Gbit / s 100 TV von 199 US-Dollar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in den Niederlanden!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2,2 GHz 6C 128 GB DDR3 2x960 GB SSD 1 Gbit / s 100 TB - ab 99 US-Dollar! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lesen Sie mehr über</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den Aufbau eines Infrastrukturgebäudes. </font><font style="vertical-align: inherit;">Klasse C mit Dell R730xd E5-2650 v4-Servern für 9.000 Euro für einen Cent?</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de486540/">https://habr.com/ru/post/de486540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de486518/index.html">Wie vor 20 Jahren</a></li>
<li><a href="../de486528/index.html">Dies ist die Norm - 3: normale Kartentypen</a></li>
<li><a href="../de486530/index.html">Mainstream. Ehrenarbeiter. Biographischer Roman</a></li>
<li><a href="../de486532/index.html">Datensicherung mit einer Reihe von FreeFileSync und 7-zip</a></li>
<li><a href="../de486538/index.html">Wie ich Soft Skills online hochgeladen habe und was es mir gab</a></li>
<li><a href="../de486542/index.html">Analysieren Sie den Sound eines DFÜ-Modems</a></li>
<li><a href="../de486544/index.html">Zwei Stunden und 3,5 Dollar. Wie ich eine einfache Seite mit Visualisierung der Verbreitung von Coronavirus erstellt habe</a></li>
<li><a href="../de486548/index.html">Primitive rekursive Funktionen und Ackerman-Funktion</a></li>
<li><a href="../de486552/index.html">„Kulturcode: Die Geheimnisse äußerst erfolgreicher Gruppen und Organisationen“ - Notizen aus dem Buch</a></li>
<li><a href="../de486554/index.html">Slurm DevOps. Drei Tage Eintauchen in DevOps. Und ein Vortrag von Anatoly Wasserman "Das Computerproblem des Sozialismus"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>