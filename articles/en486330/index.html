<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèæ üëæ üàÇÔ∏è Yarn 2 - with Prolog and plug-ins ü§ê üçä üßì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yarn - the package manager for the node - released the second version . And, it seems, the guys seriously set out to change the status quo in the node...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Yarn 2 - with Prolog and plug-ins</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486330/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yarn - the package manager for the node - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">released the second version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And, it seems, the guys seriously set out to change the status quo in the node ecosystem, or even package managers in general. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delete all the pictures about gigabyte </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nurse</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> node_modules, remove </font></font><code>yarn install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from scripts CI, we start another great JavaScript-confusion. </font><font style="vertical-align: inherit;">In short:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plug'n'Play mode became default, and node_modules became secondary, through the plugin.</font></font></b></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We made a plugin and workflow for monorep - maybe lerna will not be needed.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They built in their mini-shell so that the scripts of the package can be run without these of your cross-envs in Windows.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Added a prolog to check the rules between workspaces.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npx again washed down their.</font></font></li>
</ul><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you do not want to update all your projects, just run </font></font><code>yarn policies set-version ^1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(see </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">legacy.yarnpkg.com/en/docs/cli/policies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in the repositories that should remain on Yarn 1 and commit the result. </font><font style="vertical-align: inherit;">Then Yarn will use the local Yarn 1 binaries instead of the global ones, so everyone on the team will use the same version!</font></font></blockquote><br>
<div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1221167427288911872"></twitter-widget>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, two directions of development can be traced: a) maximum reproducibility of the environment and b) movement towards a platform for package management. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regarding the first point, yarn always drove - in fact, this was the reason why it once appeared, immediately pushing npm (I recall, then running npm install could give different results, because the lock file in the node world is the merit of yarn) . Although I personally switched to it because of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">furious line in the npm logs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But now they decided, so to speak, to push to the limit. When you add a package, it (and all its dependencies), in the form of a zip archive, is added to the cache, in the .yarn folder in the package folder (like .git). Instead of node_modules, a .pnp.js file is created, which processes module imports. There are two important consequences:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can add this cache directly to git - and then after the checkout you will immediately have the current version of the application with all the dependencies.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yarn link works much better - now peer dependencies are also processed correctly</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As for the platform, the guys switched to the plugin architecture (that is, yarn primarily as an API, and then later as the CLI) and even announced that </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">they want to get rid of the node itself, making yarn a generic solution for building your own package managers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It sounds interesting, ambitious, and slightly arrogant. </font><font style="vertical-align: inherit;">Let's see if they can cope or stall already at the PnP-first stage.</font></font><br>
<div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1221625066347089925"></twitter-widget>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In any case, I will try to transfer our project to yarn 2, if it works out - it will be nice. </font><font style="vertical-align: inherit;">How are you? </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: About the prologue in the title is not a joke, it will be possible to write the rules for checking workspaces on it, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next.yarnpkg.com/features/constraints</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Next - an extract from the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official announcement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most important</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Output in the console redesigned for better readability </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CLI Commands ( </font></font><code>yarn add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...) Now consider vorkspeysy </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You can get rid of </font></font><code>yarn install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">within its repository </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
of less hazardous alternative npx: </font></font><code>yarn dlx</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, to run a one-time things </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run command on all vorkspeysah with </font></font><code>yarn workspaces foreach</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mankipatching packets through the patch log: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Links to local packages through the portal protocol: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A new workflow to release workspaces normally </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Declarative check and workspace fixes (PROLOG INCLUDED)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And also ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Packages are built only if without this it is completely </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
impossible. Package builds can be turned on / off. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scripts are run in the universal shell. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peer dependencies work even through yarn link. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lockfile has become regular YAML. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All code is now on TypeScript. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plug-in support.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breaking changes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Settings have become uniform. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Packages must comply with their boundaries. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bundle dependencies are no longer supported. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Packages are stored in read-only archives. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Detailed changelog is </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , update instructions are </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will it be difficult to move to Yarn 2?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanks to our beta testers and overall ecosystem support, we have eased a lot of the pain associated with such a massive upgrade. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The relocation guide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will tell in more detail, but in general, while you use the latest versions of tools (ESLint, Babel, TypeScript, Gatsby, etc.), everything should be normal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But there is one significant cant: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flow and React-Native cannot be used with Plug'n'Play (PnP) right now</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We are looking for ways to work with their teams to make it work. </font><font style="vertical-align: inherit;">Right now, you can stay on Yarn 1 or use the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node_modules plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which provides backward compatibility to facilitate the transition (it is still in operation, there may be bugs). </font><font style="vertical-align: inherit;">More </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What will happen to the old version?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yarn 1.22 will be released next week. </font><font style="vertical-align: inherit;">After this, the 1.x branch will officially enter live mode - that is, there will be no releases other than vulnerability fixes. </font><font style="vertical-align: inherit;">New features will be made exclusively in Yarn 2. In practice, this means:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The old repository (yarnpkg / yarn) will leave for yarnpkg / legacy to reflect its surviving status. </font><font style="vertical-align: inherit;">It will be open for some time, but most likely we will archive it in a year or two.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The new repository will not be renamed to yarnpkg / yarn, as this will break many old links. </font><font style="vertical-align: inherit;">For the foreseeable future, he will remain at </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yarnpkg / berry</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The old site will go to legacy.yarnpkg.com, the new site (now next.yarnpkg.com) will move to the main domain yarnpkg.com</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The yarn package on npm will be updated like this:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The berry tag will always show on the latest 2.x release</font></font></li>
<li> legacy       1.x</li>
<li> latest    legacy  ,     berry.         ,      Yarn 2.</li>
</ul></li>
<li>- Node <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">     Yarn 2   Node 14</a>,    2020 .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow">yarnPath</a>    Yarn 2         .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are switching to fully automatic GitHub Actions and some batch repositories (in particular Homebrew, Chocolatey, etc.) are not yet screwed. </font><font style="vertical-align: inherit;">As a result, they will receive a Yarn 2 update later than the rest. </font><font style="vertical-align: inherit;">We recommend using </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yarn set version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (or yarn policies set-version on Yarn 1).</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We expect that most of these changes will be completed by February 1, 2020.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en486330/">https://habr.com/ru/post/en486330/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486318/index.html">How to make money on emotion recognition</a></li>
<li><a href="../en486320/index.html">Domain Driven Design Meetup at Raiffeisenbank: Broadcast + Presentations</a></li>
<li><a href="../en486322/index.html">OSINT on Telegram</a></li>
<li><a href="../en486326/index.html">Who is who in world microelectronics</a></li>
<li><a href="../en486328/index.html">Privacy policy and terms of use as a mandatory attribute of an IT product</a></li>
<li><a href="../en486334/index.html">Two-level link building + smooth and stable proportions of growth = increased visibility in search engines</a></li>
<li><a href="../en486336/index.html">Automatic verification of technical requirements in the process of dynamic modeling</a></li>
<li><a href="../en486338/index.html">Facebook cries, Social Links laughs, Maltego smokes</a></li>
<li><a href="../en486346/index.html">Just about NModbus (RTU)</a></li>
<li><a href="../en486348/index.html">CRUD operations with Entities in DialogFlow (C #)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>