<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèéÔ∏è üÜò üßìüèª Introdu√ß√£o √† explora√ß√£o e revers√£o usando o IDA FREE e outras ferramentas gratuitas. Cap√≠tulo 2 üéÖ ü¶â üë®üèΩ‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na primeira parte, instalamos v√°rias ferramentas que ser√£o √∫teis para fazermos este curso. Sua caracter√≠stica √© que eles s√£o todos gratuitos. N√£o usar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Introdu√ß√£o √† explora√ß√£o e revers√£o usando o IDA FREE e outras ferramentas gratuitas. Cap√≠tulo 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496672/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na primeira parte, instalamos v√°rias ferramentas que ser√£o √∫teis para fazermos este curso. </font><font style="vertical-align: inherit;">Sua caracter√≠stica √© que eles s√£o todos gratuitos. </font><font style="vertical-align: inherit;">N√£o usaremos nenhuma ferramenta paga e, daqueles que possuem uma vers√£o paga, como IDA ou PYCHARM, usaremos a vers√£o GRATUITA ou COMUNIT√ÅRIA.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar uma olhada em alguns conceitos antes de come√ßarmos os exerc√≠cios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que √© um BAG? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O BAG √© o resultado de uma falha ou falta no processo de cria√ß√£o de programas de computador (software) ou um computador. A falha especificada pode ocorrer em qualquer est√°gio do ciclo de vida do software, embora a falha mais √≥bvia ocorra no est√°gio de desenvolvimento e programa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como sempre digo, um programador pode cometer erros, e esses erros podem causar falhas ou bugs no programa. At√© agora, eu n√£o disse nada de novo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A quest√£o √© saber a diferen√ßa entre BAG e VULNERABILITY, ent√£o vamos ver o que √© VULNERABILITY. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que √© VULNERABILIDADE?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VULNERABILITY √© um certo tipo de bug em um programa que permite us√°-lo para violar a seguran√ßa de um sistema de computador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, as vulnerabilidades permitem executar a√ß√µes para as quais o programa n√£o foi planejado e abusar delas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outras palavras, a vulnerabilidade √© um certo tipo de bug, um subconjunto entre eles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/xv/dz/vexvdzddt1ik8nomu0jbz2yxjyi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, existem muitos tipos de vulnerabilidades. </font><font style="vertical-align: inherit;">Vamos nos concentrar no estudo e na explora√ß√£o de vulnerabilidades no WINDOWS.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© EXPLOIT?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EXPLOIT √© um programa de computador que tenta explorar algumas vulnerabilidades de outro programa. O objetivo final de uma explora√ß√£o pode ser malicioso, por exemplo, como destruir ou desligar um sistema atacado, embora geralmente seja uma viola√ß√£o das medidas de seguran√ßa para obter acesso a informa√ß√µes de forma n√£o autorizada e us√°-las em seus pr√≥prios interesses ou como fonte de outros ataques a terceiros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O abuso da vulnerabilidade pode levar √† falha do aplicativo ou do pr√≥prio sistema, √† execu√ß√£o do c√≥digo nativo em m√°quinas locais ou remotas. Sua opera√ß√£o e complexidade dependem da pr√≥pria vulnerabilidade, do ambiente e das medidas que a meta possui durante a opera√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O primeiro tipo de vulnerabilidades que examinaremos ser√° o estouro de buffer. </font><font style="vertical-align: inherit;">Come√ßaremos com os exemplos mais simples e aumentaremos gradualmente a complexidade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, os recursos de seguran√ßa do sistema n√£o ser√£o ativados, mas gradualmente os ativaremos para descobrir como podemos lidar com eles e em que situa√ß√µes.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© um BUFFER?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BUFFER √© um espa√ßo de mem√≥ria de um determinado tamanho reservado para armazenamento e gerenciamento de dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo b√°sico √© um frasco de 20 litros, que eu tenho para armazenar conte√∫do. </font><font style="vertical-align: inherit;">Pode ser menor ou igual a 20 litros, que √© o tamanho m√°ximo. </font><font style="vertical-align: inherit;">Se voc√™ deseja armazenar mais em um tanque, deve encontrar uma maneira de aumentar o tamanho do buffer, caso contr√°rio, ao tentar economizar, por exemplo, 40 litros em uma lata de 20 litros, ele transbordar√°.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© um buffer overflow?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O FLUXO DE BUFFER ocorre quando um programa de computador excede a quantidade de mem√≥ria reservada gravando dados em um bloco de mem√≥ria cont√≠guo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.welivesecurity.com/la-es/tag/buffer-overflow-la-es</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Na verdade, um estouro de buffer ocorre em um aplicativo quando ele n√£o possui as verifica√ß√µes de seguran√ßa necess√°rias em seu c√≥digo de programa, como medir a quantidade de dados que ser√£o copiados para o buffer e que n√£o excedem o tamanho do buffer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os tipos mais comuns de estouros de buffer s√£o estouros de buffer de pilha e estouros de buffer de heap.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos a defini√ß√£o de estouro de buffer e, no exemplo anterior, se eu tentar derramar 40 litros em um tanque de 20 litros, ele transbordar√°, como o entendemos. </font><font style="vertical-align: inherit;">Este √© um estouro que causa um estouro de buffer, ou seja, </font><font style="vertical-align: inherit;">transbordamento do meu tanque quando sua capacidade m√°xima √© excedida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora explique a diferen√ßa entre a pilha e a pilha.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© uma PILHA?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STACK √© usado para armazenar vari√°veis ‚Äã‚Äãde fun√ß√£o local necess√°rias apenas enquanto a fun√ß√£o √© executada. </font><font style="vertical-align: inherit;">Na maioria das linguagens de programa√ß√£o, √© importante saber, em tempo de compila√ß√£o, qual o tamanho de uma vari√°vel, se queremos mant√™-la na pilha.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© MUITO?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O heap √© usado para reservar mem√≥ria din√¢mica, cuja vida √∫til n√£o √© conhecida antecipadamente, mas espera-se que dure algum tempo. Se n√£o soubermos seu tamanho ou for determinado em tempo de execu√ß√£o, o tamanho dever√° ser calculado e reservado na pilha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O heap tamb√©m √© usado para objetos que variam em tamanho, porque n√£o sabemos em tempo de compila√ß√£o por quanto tempo eles ser√£o usados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalho na nossa empresa h√° mais de 13 anos como autor de fa√ßanhas, e a primeira coisa que fizemos com todas as pessoas contratadas at√© me fez quando entrei foi tentar desvendar as pilhas e os montes do famoso GERARDO RICHART. Ele √© um dos fundadores da CORE SECURITY e um guru de an√°lise de explora√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar devagar com as pilhas mais simples. Obviamente, como eu disse, eles s√£o compilados no momento com prote√ß√£o m√≠nima e s√£o de 32 bits para facilitar a opera√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar uma olhada no c√≥digo fonte da tarefa STACK1. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://drive.google.com/open?id=16btJAetpa1V5yHDZE2bnnFWTQNpsUR4H</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vemos uma pasta com exerc√≠cios e, dentro, est√° o c√≥digo-fonte STACK1 chamado STACK1_VS_2017.CPP.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#define _CRT_SECURE_NO_WARNINGS</span>
<span class="hljs-comment">#define _CRT_SECURE_NO_DEPRECATE</span><font></font>
<font></font>
<span class="hljs-comment">#include &lt;stdlib.h&gt;</span>
<span class="hljs-comment">#include  &lt;stdio.h&gt; </span>
<span class="hljs-comment">#include "Windows.h"</span><font></font>
<font></font>
<font></font>
int main(int argc, char **argv) <font></font>
{<font></font>
<font></font>
<font></font>
	MessageBoxA((HWND)<span class="hljs-number">-0</span>, (LPCSTR) <span class="hljs-string">"Imprimir You win..\n"</span>, (LPCSTR)<span class="hljs-string">"Vamosss"</span>, (UINT)<span class="hljs-number">0</span>);<font></font>
<font></font>
	int cookie;<font></font>
	char buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	printf(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) printf(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar entender esse c√≥digo e ver onde o estouro de buffer pode ocorrer e se haver√° um estouro de buffer na pilha ou no heap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A chamada da fun√ß√£o MessageBoxA foi adicionada ao c√≥digo-fonte STACK1 para mostrar uma pequena mensagem nos solicitando a resolv√™-la. Esta √© apenas uma adi√ß√£o que n√£o afeta nada. Essa √© uma chamada padr√£o para a fun√ß√£o WINDOWS especificada, que n√£o analisaremos aqui. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem precisa de informa√ß√µes sobre esta fun√ß√£o, pode obt√™-lo aqui.N√≥s</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
sabemos que dentro da fun√ß√£o, se houver vari√°veis ‚Äã‚Äãlocais, voc√™ deve reservar um local para elas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, ficamos com esse c√≥digo-fonte criado por GERARDO RICHART.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos em vermelho a primeira parte do programa, onde espa√ßo reservado para vari√°veis ‚Äã‚Äãlocais. Nesse caso, existem duas vari√°veis ‚Äã‚Äãlocais, COOKIE e BUF. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode ver os tipos de dados na tabela</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Outros tipos de vari√°veis ‚Äã‚Äãtamb√©m est√£o localizados l√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo ser√° compilado em 32 bits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que a vari√°vel COOKIE ser√° do tipo INT, portanto, 4 bytes de mem√≥ria ser√£o reservados para essa vari√°vel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1x/xh/qr/1xxhqrcrft6amjldaqun6yvffro.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso da vari√°vel BUF, vemos que √© uma matriz ou uma sequ√™ncia de caracteres (tamanho do caractere = 1 byte). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5j/0f/py/5j0fpyugggmbrkvzktqjibwstuk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa. ser√° uma matriz de 80 caracteres, ou seja, seu comprimento ser√° 80x1 = 80 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qualquer pessoa que n√£o saiba o que uma matriz pode ler sobre isso aqui: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.programiz.com/c-programming/c-arrays</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, uma matriz pode armazenar muitos valores do mesmo tipo de dados. </font><font style="vertical-align: inherit;">Voc√™ apenas precisa dizer a ele que tipo de dados ser√£o e quanto haver√°. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e8/do/ab/e8doabufhyuyqjdwz95qlikvcim.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No primeiro exemplo, essa √© uma matriz de n√∫meros inteiros, ou seja, </font><font style="vertical-align: inherit;">ser√° 100 bytes e, como cada n√∫mero inteiro ocupa 4 bytes, o comprimento da matriz ser√° 100 x 4 = 400 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No segundo exemplo, FLOAT usa 4 bytes, portanto, ser√° uma matriz de 5 FLOAT; portanto, seu comprimento ser√° 5 x 4 = 20 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando analisamos a matriz em um n√≠vel baixo, veremos que √© um espa√ßo de mem√≥ria ou buffer reservado. </font><font style="vertical-align: inherit;">Esta n√£o √© a √∫nica maneira de reservar espa√ßo na mem√≥ria. </font><font style="vertical-align: inherit;">Existem outros tipos de dados vari√°veis ‚Äã‚Äãque tamb√©m exigem espa√ßo de reserva na mem√≥ria que ser√£o buffers para armazenar seu conte√∫do.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voltando ao nosso exerc√≠cio: </font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© uma matriz de caracteres de 80 x 1 = 80 bytes, ou seja, parece o nosso frasco de 20 litros. Se tentarmos armazenar mais de 80 bytes, o banco transbordar√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver onde o buffer BUF √© usado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/ac/nt/kpacnt_0dfwci5pzs4ubozc4tou.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o buffer √© usado em dois locais marcados com setas vermelhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira instru√ß√£o possui uma fun√ß√£o PRINTF, usada para exibir uma mensagem no console, que ser√° uma cadeia de caracteres entre aspas.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-string">"buf: %08x cookie: %08x\n"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas a fun√ß√£o PRINTF n√£o apenas imprime a sequ√™ncia entre aspas, mas tamb√©m imprime a sequ√™ncia no formato especificado. As porcentagens contidas nos informam que uma linha de sa√≠da ser√° criada. Vemos que a string √© apenas o primeiro argumento para a fun√ß√£o. O formato de sa√≠da e outros argumentos podem ser v√°rios (haver√° um para cada argumento% no formato). No nosso caso, existem dois deles. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hq/j5/ol/hqj5ollvpzgitrc29p3ywimufvm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, temos dois formatos% X, por isso, se eu me referir √† tabela de formatos PRINTF: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vn/bt/b7/vnbtb7zfdmzy19wtmyd6mzxkit4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vemos que a fun√ß√£o pega esses n√∫meros inteiros (INT) e os insere na linha de sa√≠da com a base do sistema num√©rico 16, ou seja em formato hexadecimal. 08 indica que se o n√∫mero contiver menos de 8 d√≠gitos, a fun√ß√£o o preencher√° com espa√ßos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sa√≠da para "buf:% 31x", &amp; buf ser√° assim</font></font><br>
<br>
<pre><code class="cpp hljs">buf:             <span class="hljs-number">19F</span>ED4 
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que, neste exemplo, s√£o preenchidos com espa√ßos antes do n√∫mero. Existem v√°rios modificadores para mostrar a sa√≠da. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os casos poss√≠veis est√£o listados aqui: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.cplusplus.com/reference/cstdio/printf/</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nosso caso √© o seguinte: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/pa/g_/tfpag_nbzmhvrzf1gzsqczecfw4.png"><br>
<br>
<img src="https://habrastorage.org/webt/ja/yq/wo/jayqwocmor7ctp0y1tnykptorle.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vemos que o resultado n√£o √© truncado, √© preenchido com espa√ßos apenas se o comprimento do argumento a ser inserido for menor que o valor antes de X. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, sabemos que a fun√ß√£o imprime dois n√∫meros hexadecimais, que s√£o obtidos de dois argumentos.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sabemos que uma vari√°vel tem um endere√ßo de mem√≥ria e um valor que pode ser armazenado. </font><font style="vertical-align: inherit;">Parece o nosso frasco de 20 litros. </font><font style="vertical-align: inherit;">Tem o seu conte√∫do ou significado, ou seja, </font><font style="vertical-align: inherit;">litros armazenados no interior, mas tamb√©m se eu tiver uma garagem cheia de latas semelhantes, preciso de uma maneira de determinar onde a lata que quero est√° entre todas as que tenho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O s√≠mbolo &amp; indica isso. </font><font style="vertical-align: inherit;">Ele retorna o endere√ßo ou o local do jar, n√£o seu conte√∫do ou valor.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defini√ß√£o de AMPERSAND</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AMPERSAND √© usado para indicar o endere√ßo de mem√≥ria da vari√°vel na qual os dados ser√£o armazenados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se eu executar o arquivo execut√°vel no console, verei, por exemplo, que quando executar a fun√ß√£o PRINTF, ele imprimir√°: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ry/bs/g6/rybsg6crsldpimnhgfopd2-oddq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os endere√ßos podem mudar no seu PC, mas como o endere√ßo inferior de ambos os endere√ßos corresponde ao endere√ßo BUF, vemos que eles est√£o localizados desta maneira: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xf/-j/yc/xf-jycqtfpqcdyu_5tfsuv19uae.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O endere√ßo BUF √© menor que o endere√ßo de COOKIE, portanto aumentar√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o que esses endere√ßos vari√°veis ‚Äã‚Äãnos dizem? (No meu caso, &amp; BUF = 0x19FED4 e &amp; COOKIE = 0x19FF24) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6s/xy/8a/6sxy8am2y6d2skgyu7pmsz-wd7i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos est√£o no formato hexadecimal. Lembra que este era o formato% X? Ent√£o, coloquei 0x √† frente para distinguir n√∫meros decimais que representaremos sem acr√©scimos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se eu fizer uma subtra√ß√£o no console PYTHON ou no PYCHARM: Obtemos </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/-u/hw/rd-uhwhszxlontfjic1tl7cqmvo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
um resultado de 80 bytes, pois a vari√°vel COOKIE supostamente inicia exatamente onde o buffer BUF termina, ent√£o a diferen√ßa nos d√° o tamanho do buffer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Freq√ºentemente, quando fazemos esse tipo de vari√°vel com base no c√≥digo-fonte, pode acontecer que o compilador nos d√™ um tamanho maior que o que est√° reservado no c√≥digo-fonte. O compilador garante que reservar√° pelo menos 80 bytes, ou seja, ele pode reservar mais, n√£o menos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O fato √© que j√° sabemos algo sobre o c√≥digo, o tamanho das vari√°veis ‚Äã‚Äãe sua localiza√ß√£o, devido ao fato de ele possuir a fun√ß√£o PRINTF.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, vamos ver outro local em que o buffer BUF √© usado, porque agora o programa apenas imprime seu endere√ßo, mas n√£o o usa para armazenar dados nele.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, na linha vermelha, GET √© uma fun√ß√£o para inserir dados do teclado. Os dados ser√£o inseridos at√© eu pressionar Enter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O programa n√£o pode limitar a quantidade de dados inseridos pelo usu√°rio e tamb√©m n√£o h√° como verificar esses dados. Tudo o que √© digitado antes de pressionar a tecla ENTER √© copiado para o buffer BUF. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© o problema. Dissemos que o BUF s√≥ pode armazenar 80 bytes no m√°ximo; portanto, se inserirmos mais, criaremos um buffer overflow, e aqui est√£o todas as condi√ß√µes para isso, porque se o usu√°rio gravar mais de 80 bytes, nosso tanque transbordar√° e o l√≠quido escorrer√° . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pr/tv/0e/prtv0eh97rud78cpbrvpqmn7vd4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O fato √© que, sob o BUF, √© a vari√°vel COOKIE, o excesso excede e o preenche com um valor que voc√™ pode controlar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, se algu√©m que imprime escreve 80 * A e 4 * B, 80 * A preenche BUF e 4 * B preenche COOKIE e, como sabemos, quando algu√©m imprime um caractere no console, o valor permanecer√° baixo. ASCII. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/ff/lh/bxfflhk6qfthec5v64o3kr90ey8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o cookie ser√° preenchido com quatro letras B, que s√£o equivalentes a um valor de 0x42, podemos garantir que o valor do cookie seja 0x42424242, ou seja, no meu computador, o endere√ßo de cookie 0x19FF24 ter√° 0x42424242 como o conte√∫do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0x19FF24 =&gt; 42424242 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mn/zl/zb/mnzlzbrka2otg0rszogmqu3xwmo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O fato √© que j√° vimos como </font><font style="vertical-align: inherit;">estourar </font><font style="vertical-align: inherit;">e controlar o valor de COOKIE.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ deve imprimir "voc√™ venceu" para concluir o exerc√≠cio. Para isso, o COOKIE deve ser igual ao valor 0x41424344 e, se n√£o houver excesso, isso seria imposs√≠vel, pois o valor do COOKIE nunca foi alterado desde o in√≠cio do programa. N√£o conseguiremos imprimir "voc√™ ganha" e, para isso, usamos um estouro de buffer, o que indica que isso pode fazer com que o programa execute alguma a√ß√£o diferente da que foi programada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, voc√™ nunca pode digitar ‚Äúvoc√™ ganha‚Äù, apenas o estouro permitir√° que voc√™ fa√ßa isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AAAAAAAA </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outras palavras, em vez de passar, por exemplo, 80 * A e 4 * B, para imprimir "voc√™ ganha", voc√™ deve passar 80 * A e depois as letras DCBA, pois isso far√° com que os valores sejam armazenados no COOKIE ASCII. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
44434241</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.arumeinformatica.es/blog/los-formatos-big-endian-y-little-endian/</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O formato no qual os dados s√£o armazenados √© LITTLE ENDIAN. Em outras palavras, os dados na mem√≥ria s√£o armazenados em ordem inversa, para simplificar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/91/jh/wo/91jhwoo4rj058xjbp9jdp089vw4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se a sequ√™ncia 0x41424344 for salva, o sistema a salvar√° na mem√≥ria como: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
44 43 42 41 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por esse motivo, ao copiar para a mem√≥ria, a c√≥pia ocorrer√° enquanto digitamos, portanto, devemos escrever o valor na ordem inversa para que, ao ler na mem√≥ria, estava na forma correta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s podemos executar o execut√°vel no console. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wn/sn/yo/wnsnyolnlocppvkl573pmu-luva.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E o cursor piscar√°, pois a fun√ß√£o GET me pede para inserir a entrada. Digite com cuidado 80 caracteres A e depois DCBA.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No console PYTHON ou PYCHARM, posso imprimir a linha, copi√°-la sem aspas e col√°-la no console para n√£o imprimi-la como louca e, em seguida, pressione a tecla ENTER para inseri-la. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/9n/bh/um9nbhsmtv_w2cko2d1lwvelqwq.png"><br>
<br>
<img src="https://habrastorage.org/webt/rm/nr/be/rmnrbe4pvbxovetmml_n85dwc4q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que conseguimos "voc√™ ganha". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos ver isso no depurador. Para isso, usaremos o X64DBG. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/el/2x/db/el2xdbqsgxwi5rh22txd_hqnnx0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu escolhi a vers√£o de 32 bits. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ly/ep/e2/lyepe2znpbsedu8edqur13iocau.png"><br>
<br>
<img src="https://habrastorage.org/webt/ux/4u/pt/ux4upt903tftde_hfpteze3irho.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se pararmos na biblioteca NTDLL.DLL, pressionaremos RUN novamente com F9. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o depurador para na primeira instru√ß√£o do m√≥dulo STACK1, chamada ENTRY POINT ou na primeira instru√ß√£o executada pelo m√≥dulo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/va/y-/qf/vay-qf4tqfkxmlik0892lukku7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, isso n√£o √© como o nosso c√≥digo-fonte. Voc√™ deve entender que o compilador adiciona muito c√≥digo para fazer o execut√°vel funcionar e executar corretamente. Vamos tentar encontrar nossa fun√ß√£o principal. Podemos nos orientar olhando as linhas do programa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/hv/c9/pghvc9kf8f8xjzdpk4yigw5w5vy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selecionamos apenas a pesquisa na regi√£o atual. Sabemos que as linhas estar√£o na mesma se√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a3/fj/qc/a3fjqcvl8iqrupyr4oz2trl0viw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos que existem linhas de programa e outras que o compilador adicionou. Clicamos duas vezes em uma de nossas linhas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ua/fc/b6/uafcb61zxgu6jbg2yraawefum50.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ pode ver muito mais. Vemos uma chamada para a fun√ß√£o MessageBoxA, PRINTF, GETS e uma compara√ß√£o com o valor 0x41424344.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, estamos adicionando um plugin para descompilar o SNOWMAN. Podemos tentar ver como ele descompila o c√≥digo, ou seja, como ele est√° tentando obter o c√≥digo fonte ou algo o mais semelhante poss√≠vel do arquivo compilado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r0/hs/-w/r0hs-w2cpoquwejdry_pogmxlpu.png"><br>
<br>
<img src="https://habrastorage.org/webt/8h/ib/j_/8hibj_rzmyn_5gwvlg-bqhg4upk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que isso n√£o √© perfeito, mas √© melhor do que era. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou colocar o BP no in√≠cio da fun√ß√£o e pressionar F9 at√© o depurador parar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9j/wz/em/9jwzemcr76ij1vfdvy9pcdx9gaa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para quem n√£o sabe o que √© um argumento de fun√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/su/31/rtsu317d7gmqo_u7parcbcxfagg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, a fun√ß√£o principal possui argumentos, mas eles n√£o s√£o usados ‚Äã‚Äãdentro da fun√ß√£o.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> 
</span>{<font></font>
<font></font>
	<span class="hljs-keyword">int</span> cookie;
	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">80</span>];<font></font>
<font></font>
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"buf: %08x cookie: %08x\n"</span>, &amp;buf, &amp;cookie);<font></font>
	gets(buf);<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cookie == <span class="hljs-number">0x41424344</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"you win!\n"</span>);<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos que existem dois argumentos, e eles s√£o passados ‚Äã‚Äãpela pilha quando o execut√°vel √© compilado em 32 bits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pouco antes da chamada da fun√ß√£o, os argumentos ser√£o armazenados na pilha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando paramos no in√≠cio da fun√ß√£o, o primeiro valor na pilha ser√° RETURN ADDRESS, ou seja, onde a fun√ß√£o retornar√° ap√≥s a conclus√£o da fun√ß√£o e, abaixo desse valor, estar√£o os argumentos dessa fun√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se clicar com o bot√£o direito do mouse em RETURN ADDRESS e selecionar SIGA DWORD IN DISASSEMBLER, verei para onde o depurador deve retornar ap√≥s a conclus√£o da fun√ß√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9o/jb/1s/9ojb1skptq9fvde0hlbque803qs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele voltar√° aqui. Isso significa que a fun√ß√£o principal foi chamada a partir de uma chamada que √© mais alta. Eu posso colocar a BP aqui, reiniciar o exerc√≠cio e ter certeza de que est√°.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/8c/sc/8w8cscopqchym1ubcx2zuazrohq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou colocar a BP um pouco mais cedo e reiniciar o programa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w8/hc/te/w8hctep2w06vcaqzx_ouz4zguws.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O depurador ir√° parar aqui. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hy/mk/3h/hymk3hx1u-myzmmlnygmmeadmww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele salvar√° os argumentos na fun√ß√£o principal usando estas instru√ß√µes PUSH. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√° um link para quem deseja saber mais sobre os argumentos da fun√ß√£o: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://publications.gbdirect.co.uk/c_book/chapter10/arguments_to_main.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Isso n√£o √© muito dif√≠cil. O primeiro argumento para ARGC √© INT, que indica o n√∫mero de par√¢metros do console usados ‚Äã‚Äãpara executar o programa, incluindo o caminho para o execut√°vel, e ARGV √© uma matriz de ponteiros para seq√º√™ncias de caracteres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que, se eu alterar a linha de comando, passarei mais argumentos e recarregarei.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_a/1o/jc/_a1ojcg0g9lie1le3ouoyuyrtxo.png"><br>
<br>
<img src="https://habrastorage.org/webt/9f/pb/uy/9fpbuygn9gtz4osszzcffsurz9m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, o depurador para quando est√° prestes a salvar argumentos usando a instru√ß√£o PUSH. O primeiro argumento armazenado √© o mais distante e o √∫ltimo que voc√™ salvar ser√° o primeiro argumento da fun√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu rastreio e cada instru√ß√£o PUSH salva os argumentos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1u/yj/rp/1uyjrps22gzfc0re25uhcu-p8a8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui eu posso ver os argumentos da fun√ß√£o. Acima est√° o primeiro argumento para o ARGC. √â 3, pois marca o n√∫mero de argumentos que s√£o passados ‚Äã‚Äãpara o console. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vk/il/0i/vkil0istebtffechadwuwyqt2u8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o tr√™s argumentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora pressionamos F7 para fazer o STEP INTO e entrar na fun√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos que, ao entrar na CALL, o depurador salva o RETURN ADDRESS na pilha.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gp/xc/fw/gpxcfwbg8jr538d3c45oyrqke6e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, como dissemos ao inserir a fun√ß√£o, a primeira coisa que ser√° salva na pilha √© RETURN ADDRESS (na compila√ß√£o de 32 bits) e abaixo est√£o os argumentos para a fun√ß√£o, primeiro o primeiro argumento e depois o restante em sequ√™ncia. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qk/s4/bi/qks4bikctvy6i3oxg7sy2ipop_o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo argumento, como vimos, √© uma matriz de indicadores. Aqui vemos na mem√≥ria que existem tr√™s ponteiros para tr√™s linhas que s√£o passados ‚Äã‚Äãcomo argumentos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c5/f3/kn/c5f3knt9kreq8r5kmfzqgvnv2zw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui paramos no in√≠cio da fun√ß√£o, um pouco mais baixo, temos RETORNOS ENDERE√áOS e ARGUMENTOS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esclarecemos que o arquivo √© compilado em 32 bits, porque na vers√£o de 64 bits, os argumentos s√£o transmitidos de maneira diferente. Veremos mais tarde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o a fun√ß√£o come√ßa a executar. A primeira coisa √© o chamado PROLOGUE, que armazena o valor EBP da fun√ß√£o que chamou nossa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ka/ss/9k/kass9k6zty8_-nxgxomh2zb6iui.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso manter√° o valor EBP logo acima do endere√ßo de retorno. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/da/gi/uodagirflnltomk1uqlo9dawbjo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se eu seguir as instru√ß√µes usando F7. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejo que o valor EBP GUARDADO est√° na pilha acima do endere√ßo de retorno. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gw/ml/wi/gwmlwilzarr_u67xp_-6dg5-m0w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguinte instru√ß√£o em PROLOGUE: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MOV EBP, ESP </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Define o valor de EBP para a fun√ß√£o atual que foi salva e foi a fun√ß√£o pai que chama nossa (neste caso, minha principal fun√ß√£o √© a fun√ß√£o baseada em EBP, em outros casos, pode ser diferente e n√≥s veja-os mais tarde) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao colocar o valor atual do ESP no EBP, garantimos a cria√ß√£o de um quadro para nossa fun√ß√£o atual.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bw/d0/8u/bwd08ut1gamkdw-5m9y58cqmdrw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, como essa fun√ß√£o √© baseada em EBP ou EBP BASED, o valor de EBP ser√° armazenado dentro da fun√ß√£o e ser√° aceito como refer√™ncia, e o ESP ser√° alterado. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/fm/rm/31fmrm3jsa9gz0dwzonyf4lh4wa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este valor EBP √© tomado como base. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas fun√ß√µes baseadas em EBP, vari√°veis ‚Äã‚Äãe argumentos podem ser nomeados pela dist√¢ncia deste endere√ßo, que ser√° armazenado no valor EBP at√© o seu ep√≠logo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos ver v√°rias vari√°veis ‚Äã‚Äãna lista denominadas EBP-4 ou EBP-54, referentes ao valor de EBP que est√° aceitando no momento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Podemos dizer que, assim que o EBP assumir seu valor ap√≥s o PROLOGUE, parecer√° um ralo, portanto os argumentos sempre seguir√£o nessa dire√ß√£o; portanto, EBP + XXX se refere aos argumentos (o EBP armazenado e o RETURN ADDRESS tamb√©m s√£o mais baixos, mas n√£o ter√£o links no c√≥digo), enquanto as vari√°veis, como veremos, estar√£o acima desse endere√ßo, portanto o link para EBP-XXX se refere a alguma vari√°vel local. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, em fun√ß√µes baseadas em EBP: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBP + XXXX = argumentos passados ‚Äã‚Äãpara a fun√ß√£o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EBP - XXXX = vari√°veis ‚Äã‚Äãde fun√ß√£o local</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s o PROLOGUE, haver√° uma maneira de reservar espa√ßo para as vari√°veis. No nosso caso, isso √© feito movendo o ESP para cima, para que o espa√ßo restante abaixo seja reservado para a soma de todos os comprimentos vari√°veis ‚Äã‚Äãe, √†s vezes, um pouco mais apenas no caso, o que depende do compilador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00401043 83EC 54 | SUB ESP, 54 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o ESP est√° localizado acima do EBP, que permanecer√° o link, e que 0x54 convertido em decimal √© 84, que √© a soma dos comprimentos BUF e COOKIE. Lembre-se que eles eram 80 e 4, respectivamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/h8/sz/hxh8sz1xa-15otyztxyu8dl6g34.png"><br>
<br>
<img src="https://habrastorage.org/webt/1a/84/bv/1a84bvou8z1bdrr0rkcjyqvqvg8.png"><br>
<br>
<img src="https://habrastorage.org/webt/yv/sh/tv/yvshtvouwajuyoqcvfptuhfa7oa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na execu√ß√£o, um espa√ßo √© criado para as vari√°veis ‚Äã‚ÄãBUF e COOKIE de 84 bytes de tamanho. Voc√™ pode clicar na primeira coluna na dire√ß√£o horizontal, examinar o valor EBP e encontrar esse valor na pilha. Obviamente, agora ser√° mais baixo.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w1/eg/vc/w1egvc6xx-pgpprzf6pfvcuicn0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clico duas vezes aqui. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/1s/i2/gl1si2koeosh8u7seukoagohri4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, teremos valores em rela√ß√£o √† EBP tamb√©m na pilha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, EBP-4 corresponde √† listagem, -4 √© exibido na primeira coluna da pilha e, na explica√ß√£o, tamb√©m √© exibido como EBP-4. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pw/_w/2l/pw_w2lyzbza2xlwmthujrqsdado.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se eu rastrear, vemos que a partir do local em que o ESP foi localizado para reservar as vari√°veis, ele sempre subir√°, pois deve levar em considera√ß√£o o espa√ßo alocado para as vari√°veis. Ao executar 4 PUSHs para MessageBoxA, o depurador coloca as vari√°veis ‚Äã‚Äãacima do espa√ßo reservado e aumenta o ESP. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ny/sm/cn/nysmcnqbcdrmrl-q4nbtfi85r_8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se eu olhar para a pilha, vejo 4 argumentos verdes que adiciono sobre o espa√ßo reservado marcado em vermelho. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dg/-t/ty/dg-ttymvnjmjq3u-68oeoixwcgw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voc√™ insere a fun√ß√£o MessageBoxA, o RETURN ADDRESS dessa fun√ß√£o √© armazenado na pilha.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ac/gb/kg/acgbkgp58eatqpqgducvgxoqzca.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° o endere√ßo de retorno da MessageBoxA. Quando chego ao RET dessa fun√ß√£o, rastreando com F8, e executo o MessageBoxA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/nb/qm/vvnbqmlpj06asy7qqwuwipvvzjq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o depurador retornar√° logo abaixo da chamada MessageBoxA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/ct/do/fmctdoieugal4uiig_pzcvvwfr8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E os valores PUSH que voc√™ passou para a fun√ß√£o MessageBoxA e o RETURN ADDRESS para essa fun√ß√£o j√° foram usados, e o ESP est√° novamente logo acima da √°rea reservada, como antes de qualquer fun√ß√£o ser chamada. O mesmo acontecer√° com a chamada da fun√ß√£o PRINTF. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de passar na fun√ß√£o PRINTF, os endere√ßos BUF e COOKIE ser√£o impressos. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qo/tj/8z/qotj8zivsh5xnhiglbkibu53dh4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O endere√ßo BUF na minha m√°quina ser√° 0x19FED4 e o endere√ßo de COOKIE ser√° 0x19FF24. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, o programa l√™ o endere√ßo BUF para pass√°-lo para a fun√ß√£o GETS e preencher o BUF. Podemos verificar se o endere√ßo corresponde ao que o console 0x19FED4 mostra.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6b/kg/-l/6bkg-lgioczisxsz0s9mlp1omz0.png"><br>
<br>
<img src="https://habrastorage.org/webt/sg/qp/e1/sgqpe1ypgqar2o_5plt8tjlcb0o.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos que √© o EBP-54. Se clicar duas vezes na pilha onde mostra -54, mostrar√° que o endere√ßo √© BUF = 0x19FED4 na minha m√°quina. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/d2/ff/wh/d2ffwhnayhtqxh8h1vgknmubaji.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, quando vou salvar os dados inseridos nesse endere√ßo, posso coloc√°-los em um despejo para ver como os bytes s√£o armazenados l√°. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fu/mz/9h/fumz9hojfwk_mzv4fwhx9rjzfjw.png"><br>
<br>
<img src="https://habrastorage.org/webt/r6/hx/lm/r6hxlmsrelhvlr-tjfdss11mulm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o eles. Al√©m disso, nada √© exibido abaixo, pois n√£o h√° dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando eu chamo a fun√ß√£o GETS usando F8, precisarei ir ao console, digite e pressione ENTER para preencher o buffer BUF e reescrever o COOKIE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z2/ye/e6/z2yee6bmvi02vjrqpz5-dscio0a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que a vari√°vel COOKIE estava em 19FF24 na minha m√°quina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, o programa compara o cookie com 0x41424344. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/am/p4/ja/amp4ja-l9lkyf8trocairpbj3e0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o EBP-4 diz que √© um BOLINHO, al√©m do endere√ßo, se definirmos o HORIZON para o valor do EBP, como antes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/p4/uo/0u/p4uo0ufah0vdsro_ngyrym3txxm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clico duas vezes aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o EBP-4 √© um BOLINHO, pois a vari√°vel est√° no n√≠vel da pilha -4, zerando o HORIZONTE. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x2/gu/kx/x2gukxgn7arw1lk9_w9fj3y3qbu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vemos que o programa n√£o vai pular e vai nos mostrar que voc√™ ganhou! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0e/qv/cl/0eqvclf1uxc7dg8hmgp22ka_3sm.png"><br>
<br>
<img src="https://habrastorage.org/webt/5b/fs/mj/5bfsmjqijpcan7zdmidh-pqj6eg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, alcan√ßamos manualmente o objetivo que voc√™ conquista !, </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
analisamos dinamicamente o STACK1 usando o X64DBG, que √© um depurador e n√£o nos permite analisar o programa sem inici√°-lo. Para fazer isso, precisamos usar outras ferramentas, como IDA PRO, GHIDRA ou RADARE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu posso criar um modelo de script para operar o exerc√≠cio da PYTHON.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen, PIPE<font></font>
<font></font>
payload = <span class="hljs-string">b"A"</span> * <span class="hljs-number">80</span> + <span class="hljs-string">b"\x44\x43\x42\x41"</span><font></font>
<font></font>
p1 = Popen(<span class="hljs-string">r"C:\Users\ricardo\Desktop\abos y stack nuevos\STACK1_VS_2017.exe"</span>, stdin=PIPE)
<span class="hljs-keyword">print</span> (<span class="hljs-string">"PID: %s"</span> % hex(p1.pid))
<span class="hljs-keyword">print</span> (<span class="hljs-string">"Enter para continuar"</span>)<font></font>
p1.communicate(payload)<font></font>
p1.wait()<font></font>
input()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso do PYTHON 3, preciso colocar par√™nteses na fun√ß√£o PRINT e ter cuidado ao adicionar linhas que devem ser bytes (coloque b na frente das linhas no PYTHON 2). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifico se o caminho est√° correto e quando executo o arquivo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5b/fs/mj/5bfsmjqijpcan7zdmidh-pqj6eg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Boa. J√° temos um modelo de script para o PYTHON 3 para operar STACK1. Na pr√≥xima parte, continuaremos a an√°lise est√°tica em IDA, RADARE e GHIDRA. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xg/65/w_/xg65w_m85xv1anv5a7uhbuvatuc.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, al√©m da tarefa STACK1, tamb√©m existem vers√µes 2, 3 e 4. Voc√™ pode tentar resolv√™-las. Eles s√£o muito simples e semelhantes ao STACK1, portanto, n√£o fique entediado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na pr√≥xima parte, veremos a IDA FREE, RADARE e GHIDRA. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejo voc√™ na pr√≥xima parte 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ricardo Narvaha </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
25/10/2019 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS # 1</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um belo PDF pode ser baixado na minha p√°gina inicial - yasha.su </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS # 2 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em breve, escreverei uma continua√ß√£o do artigo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://habr.com/en/post/464117/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre como coletei ajuda para o padre Chris Kaspersky e o que √© isso aconteceu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o fique entediado.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496652/index.html">Como adicionar notifica√ß√µes em tempo real ao Laravel usando o Pusher</a></li>
<li><a href="../pt496654/index.html">Edi√ß√£o 35: Treinamento em TI - problemas e desafios atuais das principais empresas</a></li>
<li><a href="../pt496664/index.html">Trabalhos diferentes, preto, branco, vermelho</a></li>
<li><a href="../pt496666/index.html">Estudamos o mecanismo VoIP do Mediastreamer2. Parte 8</a></li>
<li><a href="../pt496670/index.html">A sociedade mudar√° ap√≥s uma pandemia?</a></li>
<li><a href="../pt496674/index.html">Como geramos demonstra√ß√µes financeiras consolidadas?</a></li>
<li><a href="../pt496680/index.html">Setor 4.1: Propriedade de rob√¥s, redes neurais e monetiza√ß√£o de c√≥digo aberto</a></li>
<li><a href="../pt496682/index.html">Como permanecer profissional sob demanda</a></li>
<li><a href="../pt496686/index.html">Como os sistemas de an√°lise de tr√°fego detectam t√°ticas de hackers por MITRE ATT & CK, parte 4</a></li>
<li><a href="../pt496690/index.html">Tecnologias de controle de coronav√≠rus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>