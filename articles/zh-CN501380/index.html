<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¾â€ğŸ­ ğŸ½ ğŸ“µ æ•°æ®æ„å»ºå·¥å…·æˆ–æ•°æ®ä»“åº“å’Œå±…å®‰æ€å±å‹ä¹‹é—´çš„å…±åŒç‚¹ ğŸ¤µ ğŸ‘¶ğŸ» ğŸ§•ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç†æƒ³çš„æ•°æ®ä»“åº“çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
 
 åœ¨æ²¡æœ‰æ ·æ¿ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸“æ³¨äºä¸šåŠ¡ä»·å€¼å’Œåˆ†æã€‚å°†DWHä½œä¸ºä»£ç åº“è¿›è¡Œç®¡ç†ï¼šç‰ˆæœ¬æ§åˆ¶ï¼Œå®¡é˜…ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å’ŒCIã€‚æ¨¡å—åŒ–ï¼Œå¯æ‰©å±•æ€§ï¼Œå¼€æºå’Œç¤¾åŒºã€‚å‹å¥½çš„ç”¨æˆ·æ–‡æ¡£å’Œä¾èµ–å…³ç³»å¯è§†åŒ–ï¼ˆæ•°æ®æ²¿è¢­ï¼‰ã€‚
 
 æœ‰å…³æ‰€æœ‰è¿™äº›ä»¥åŠDBTåœ¨å¤§æ•°æ®å’Œåˆ†æç”Ÿæ€ç³»ç»Ÿä¸­çš„ä½œç”¨çš„æ›´å¤šä¿¡æ¯ï¼Œæ¬¢è¿å…³æ³¨ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>æ•°æ®æ„å»ºå·¥å…·æˆ–æ•°æ®ä»“åº“å’Œå±…å®‰æ€å±å‹ä¹‹é—´çš„å…±åŒç‚¹</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/501380/"><img src="https://habrastorage.org/webt/94/m4/yy/94m4yy6-3edqwrae5dja92zyiya.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç†æƒ³çš„æ•°æ®ä»“åº“çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ²¡æœ‰æ ·æ¿ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸“æ³¨äºä¸šåŠ¡ä»·å€¼å’Œåˆ†æã€‚</font><font style="vertical-align: inherit;">å°†DWHä½œä¸ºä»£ç åº“è¿›è¡Œç®¡ç†ï¼šç‰ˆæœ¬æ§åˆ¶ï¼Œå®¡é˜…ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å’ŒCIã€‚</font><font style="vertical-align: inherit;">æ¨¡å—åŒ–ï¼Œå¯æ‰©å±•æ€§ï¼Œå¼€æºå’Œç¤¾åŒºã€‚</font><font style="vertical-align: inherit;">å‹å¥½çš„ç”¨æˆ·æ–‡æ¡£å’Œä¾èµ–å…³ç³»å¯è§†åŒ–ï¼ˆæ•°æ®æ²¿è¢­ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰å…³æ‰€æœ‰è¿™äº›ä»¥åŠDBTåœ¨å¤§æ•°æ®å’Œåˆ†æç”Ÿæ€ç³»ç»Ÿä¸­çš„ä½œç”¨çš„æ›´å¤šä¿¡æ¯ï¼Œæ¬¢è¿å…³æ³¨ã€‚</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§å®¶å¥½</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸Artemy Kozyrè”ç³»ã€‚</font><font style="vertical-align: inherit;">äº”å¹´å¤šæ¥ï¼Œæˆ‘ä¸€ç›´åœ¨ä¸æ•°æ®ä»“åº“åˆä½œï¼Œæ„å»ºETL / ELTï¼Œä»¥åŠæ•°æ®åˆ†æå’Œå¯è§†åŒ–ã€‚</font><font style="vertical-align: inherit;">æˆ‘ç›®å‰åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wheely</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·¥ä½œï¼Œåœ¨</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">OTUS</font></a><font style="vertical-align: inherit;">æ•™æˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®å·¥ç¨‹å¸ˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¾ç¨‹</font><font style="vertical-align: inherit;">ï¼Œä»Šå¤©æˆ‘æƒ³ä¸å¤§å®¶åˆ†äº«æˆ‘åœ¨</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–°è¯¾ç¨‹æ³¨å†Œ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€å§‹å‰å¤•å†™çš„ä¸€ç¯‡æ–‡ç« </font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®€çŸ­è¯„è®º</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTæ¡†æ¶å…¨éƒ½ä¸ç¼©å†™è¯ELTï¼ˆæå–-è½¬æ¢-åŠ è½½ï¼‰ä¸­çš„å­—æ¯Tæœ‰å…³ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
éšç€BigQueryï¼ŒRedshiftï¼ŒSnowflakeç­‰é«˜æ•ˆä¸”å¯æ‰©å±•çš„åˆ†ææ•°æ®åº“çš„å‡ºç°ï¼Œåœ¨æ•°æ®ä»“åº“å¤–éƒ¨è¿›è¡Œè½¬æ¢çš„ä»»ä½•æ„ä¹‰éƒ½æ¶ˆå¤±äº†ã€‚&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTä¸ä¼šä»æºä¸‹è½½æ•°æ®ï¼Œä½†æ˜¯æä¾›äº†å·¨å¤§çš„æœºä¼šæ¥å¤„ç†å·²ç»åŠ è½½åˆ°å­˜å‚¨ï¼ˆå†…éƒ¨æˆ–å¤–éƒ¨å­˜å‚¨ï¼‰ä¸­çš„æ•°æ®ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99f/db8/537/99fdb8537040978a7f704780435bdded.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTçš„ä¸»è¦ç›®çš„æ˜¯è·å–ä»£ç ï¼Œåœ¨SQLä¸­è¿›è¡Œç¼–è¯‘ï¼Œå¹¶åœ¨å­˜å‚¨åº“ä¸­ä»¥æ­£ç¡®çš„é¡ºåºæ‰§è¡Œå‘½ä»¤ã€‚</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBTé¡¹ç›®ç»“æ„</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥é¡¹ç›®ä»…ç”±ä¸¤ç§ç±»å‹çš„ç›®å½•å’Œæ–‡ä»¶ç»„æˆï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å‹ï¼ˆ.sqlï¼‰-SELECTæŸ¥è¯¢è¡¨ç¤ºçš„è½¬æ¢å•ä½</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é…ç½®æ–‡ä»¶ï¼ˆ.ymlï¼‰-å‚æ•°ï¼Œè®¾ç½®ï¼Œæµ‹è¯•ï¼Œæ–‡æ¡£</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼Œå·¥ä½œçš„ç»“æ„å¦‚ä¸‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨æˆ·åœ¨ä»»ä½•æ–¹ä¾¿çš„IDEä¸­å‡†å¤‡æ¨¡å‹ä»£ç </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨CLIå¯åŠ¨æ¨¡å‹ï¼ŒDBTç”¨SQLç¼–è¯‘æ¨¡å‹ä»£ç </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ä»“åº“ä¸­æŒ‰æŒ‡å®šé¡ºåºæ‰§è¡Œå·²ç¼–è¯‘çš„SQLä»£ç ï¼ˆå›¾å½¢ï¼‰</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹æ˜¯ä»CLIå¯åŠ¨çš„æ ·å­ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/893/fd8/a9c/893fd8a9c5ef3206e4568259b7ec1660.gif"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€åˆ‡éƒ½æ˜¯é€‰æ‹©</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æ•°æ®æ„å»ºå·¥å…·æ¡†æ¶çš„è‡´å‘½åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">æ¢å¥è¯è¯´ï¼ŒDBTæå–ä¸ä»“åº“ä¸­æŸ¥è¯¢çš„å®ç°ç›¸å…³çš„æ‰€æœ‰ä»£ç ï¼ˆæ¥è‡ªCREATEï¼ŒINSERTï¼ŒUPDATEï¼ŒDELETE ALTERï¼ŒGRANTç­‰å‘½ä»¤çš„å˜ä½“ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»»ä½•æ¨¡å‹éƒ½æ¶‰åŠç¼–å†™ä¸€ä¸ªSELECTæŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å®šä¹‰äº†ç»“æœæ•°æ®é›†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŒæ—¶ï¼Œè½¬æ¢é€»è¾‘å¯ä»¥æ˜¯å¤šçº§çš„ï¼Œå¯ä»¥åˆå¹¶æ¥è‡ªå…¶ä»–å‡ ä¸ªæ¨¡å‹çš„æ•°æ®ã€‚</font><font style="vertical-align: inherit;">å°†æ„å»ºè®¢å•å±•ç¤ºï¼ˆf_ordersï¼‰çš„æ¨¡å‹ç¤ºä¾‹ï¼š</font></font><br>
<br>
<pre><code class="sql hljs">{% <span class="hljs-keyword">set</span> payment_methods = [<span class="hljs-string">'credit_card'</span>, <span class="hljs-string">'coupon'</span>, <span class="hljs-string">'bank_transfer'</span>, <span class="hljs-string">'gift_card'</span>] %}<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">with</span> orders <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> {{ <span class="hljs-keyword">ref</span>(<span class="hljs-string">'stg_orders'</span>) }}<font></font>
&nbsp;<font></font>
),<font></font>
&nbsp;<font></font>
order_payments <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> {{ <span class="hljs-keyword">ref</span>(<span class="hljs-string">'order_payments'</span>) }}<font></font>
&nbsp;<font></font>
),<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.order_id,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.customer_id,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.order_date,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.status,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">for</span> payment_method <span class="hljs-keyword">in</span> payment_methods -%}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_payments.{{payment_method}}_amount,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% endfor -%}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_payments.total_amount <span class="hljs-keyword">as</span> amount
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">from</span> orders
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> order_payments <span class="hljs-keyword">using</span> (order_id)<font></font>
&nbsp;<font></font>
)<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">final</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åœ¨è¿™é‡Œèƒ½çœ‹åˆ°ä»€ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼šCTEï¼ˆå…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼‰ç”¨äºç»„ç»‡å’Œç†è§£åŒ…å«è®¸å¤šè½¬æ¢å’Œä¸šåŠ¡é€»è¾‘çš„</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»£ç ï¼›å…¶æ¬¡ï¼šæ¨¡å‹ä»£ç æ˜¯SQLå’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jinja</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯­è¨€</font><font style="vertical-align: inherit;">ï¼ˆæ¨¡æ¿è¯­è¨€ï¼‰çš„æ··åˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç¤ºä¾‹ä¸­ï¼Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾ªç¯ç”¨äº</font><font style="vertical-align: inherit;">ä¸º</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡¨è¾¾å¼ä¸­æŒ‡å®šçš„æ¯ç§ä»˜æ¬¾æ–¹å¼å½¢æˆé‡‘é¢</font><font style="vertical-align: inherit;">ã€‚</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ref</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨</font><font style="vertical-align: inherit;">-å¯ä»¥åœ¨ä»£ç å†…éƒ¨å¼•ç”¨å…¶ä»–æ¨¡å‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç¼–è¯‘æ—¶ï¼Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ref</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†è¢«è½¬æ¢ä¸ºæŒ‡å‘å­˜å‚¨åº“ä¸­è¡¨æˆ–è§†å›¾çš„ç›®æ ‡æŒ‡é’ˆ</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ref</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è®¸æ‚¨æ„å»ºæ¨¡å‹ä¾èµ–å…³ç³»å›¾</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¥ç¤¾çš„æ˜¯</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢åŠ äº†å‡ ä¹æ— é™çš„å¯èƒ½æ€§ï¼ŒDBTã€‚</font><font style="vertical-align: inherit;">æœ€å¸¸ç”¨çš„ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if / elseè¯­å¥-åˆ†æ”¯è¯­å¥</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forå¾ªç¯-å¾ªç¯</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å˜é‡-å˜é‡</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·¨é›†-å»ºç«‹å·¨é›†</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰©åŒ–ï¼šè¡¨ï¼Œè§†å›¾ï¼Œå¢é‡</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç‰©åŒ–ç­–ç•¥-ä¸€ç§æ–¹æ³•ï¼Œæ ¹æ®è¯¥æ–¹æ³•å°†ç»“æœæ¨¡å‹æ•°æ®é›†å­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»æ ¹æœ¬ä¸Šè€ƒè™‘ï¼Œè¿™æ˜¯ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¡¨-å­˜å‚¨ä¸­çš„ç‰©ç†è¡¨</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§†å›¾-å­˜å‚¨åº“ä¸­çš„è™šæ‹Ÿè¡¨è§†å›¾</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰æ›´å¤æ‚çš„ç‰©åŒ–ç­–ç•¥ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¢é‡-å¢é‡åŠ è½½ï¼ˆå¤§å‹äº‹å®è¡¨ï¼‰ï¼›</font><font style="vertical-align: inherit;">æ·»åŠ æ–°è¡Œï¼Œæ›´æ–°å·²ä¿®æ”¹çš„è¡Œï¼Œæ¸…é™¤å·²åˆ é™¤çš„è¡Œ&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æš‚æ—¶çš„-è¯¥æ¨¡å‹ä¸èƒ½ç›´æ¥å®ç°ï¼Œä½†å¯ä»¥ä½œä¸ºCTEå‚ä¸å…¶ä»–æ¨¡å‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‚¨å¯ä»¥æ·»åŠ è‡ªå·±çš„ä»»ä½•å…¶ä»–ç­–ç•¥</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†ç‰©åŒ–ç­–ç•¥å¤–ï¼Œè¿˜ä¸ºç‰¹å®šä»“åº“æä¾›äº†ä¼˜åŒ–çš„æœºä¼šï¼Œä¾‹å¦‚ï¼š</font></font><br>
<br>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snowflake</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä¸´æ—¶è¡¨ï¼Œåˆå¹¶è¡Œä¸ºï¼Œè¡¨é›†ç¾¤ï¼Œå¤åˆ¶æˆæƒï¼Œå®‰å…¨è§†å›¾</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redshift</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šDistkeyï¼ŒSortkeyï¼ˆäº¤é”™ï¼Œå¤åˆï¼‰ï¼ŒåæœŸç»‘å®šè§†å›¾</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BigQuery</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šè¡¨åˆ†åŒºå’Œé›†ç¾¤ï¼Œåˆå¹¶è¡Œä¸ºï¼ŒKMSåŠ å¯†ï¼Œæ ‡ç­¾å’Œæ ‡ç­¾</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spark</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šæ–‡ä»¶æ ¼å¼ï¼ˆé•¶æœ¨åœ°æ¿ï¼Œcsvï¼Œjsonï¼Œå…½äººï¼Œä¸‰è§’æ´²ï¼‰ï¼Œpartition_byï¼Œclustered_byï¼Œå­˜å‚¨æ¡¶ï¼Œincremental_strategy</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“å‰æ”¯æŒä»¥ä¸‹å­˜å‚¨åº“ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postgres</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¢ç§»</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§æŸ¥è¯¢</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é›ªèŠ±</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prestoï¼ˆéƒ¨åˆ†ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sparkï¼ˆéƒ¨åˆ†ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft SQL Serverï¼ˆç¤¾åŒºé€‚é…å™¨ï¼‰</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬æ”¹è¿›æ¨¡å‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿å…¶å¡«å……å¢é‡ï¼ˆå¢é‡ï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºRedshiftæ·»åŠ ç»†åˆ†å’Œæ’åºé”®</font></font></li>
</ul><br>
<pre><code class="sql hljs"><span class="hljs-comment">--  :&nbsp;</span>
<span class="hljs-comment">--  ,      (unique_key)</span>
<span class="hljs-comment">--   (dist),   (sort)</span><font></font>
{{<font></font>
&nbsp;&nbsp;config(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;materialized='incremental',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unique_key='order_id',<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dist="customer_id",<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort="order_date"<font></font>
&nbsp;&nbsp;&nbsp;)<font></font>
}}<font></font>
&nbsp;<font></font>
{% <span class="hljs-keyword">set</span> payment_methods = [<span class="hljs-string">'credit_card'</span>, <span class="hljs-string">'coupon'</span>, <span class="hljs-string">'bank_transfer'</span>, <span class="hljs-string">'gift_card'</span>] %}<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">with</span> orders <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> {{ <span class="hljs-keyword">ref</span>(<span class="hljs-string">'stg_orders'</span>) }}
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">where</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span>
&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">if</span> is_incremental() -%}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">--        </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">and</span> order_date &gt;= (<span class="hljs-keyword">select</span> <span class="hljs-keyword">max</span>(order_date) <span class="hljs-keyword">from</span> {{ this }})<font></font>
&nbsp;&nbsp;&nbsp;{%- endif %}&nbsp;<font></font>
&nbsp;<font></font>
),<font></font>
&nbsp;<font></font>
order_payments <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> {{ <span class="hljs-keyword">ref</span>(<span class="hljs-string">'order_payments'</span>) }}<font></font>
&nbsp;<font></font>
),<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.order_id,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.customer_id,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.order_date,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orders.status,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">for</span> payment_method <span class="hljs-keyword">in</span> payment_methods -%}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_payments.{{payment_method}}_amount,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% endfor -%}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_payments.total_amount <span class="hljs-keyword">as</span> amount
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">from</span> orders
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> order_payments <span class="hljs-keyword">using</span> (order_id)<font></font>
&nbsp;<font></font>
)<font></font>
&nbsp;<font></font>
<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">final</span>
</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¨¡å‹ä¾èµ–å›¾</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»–æ˜¯ä¸€æ£µä¾èµ–æ ‘ã€‚</font><font style="vertical-align: inherit;">ä»–æ˜¯DAGï¼ˆæœ‰å‘æ— ç¯å›¾-å®šå‘æ— ç¯å›¾ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTæ ¹æ®æ‰€æœ‰é¡¹ç›®æ¨¡å‹çš„é…ç½®æ¥æ„å»ºå›¾å½¢ï¼Œæˆ–è€…å°†æ¨¡å‹å†…éƒ¨çš„refï¼ˆï¼‰é“¾æ¥é“¾æ¥åˆ°å…¶ä»–æ¨¡å‹ã€‚</font><font style="vertical-align: inherit;">æ‹¥æœ‰å›¾ä½¿æ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥æ­£ç¡®çš„é¡ºåºè¿è¡Œæ¨¡å‹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çª—é¥°çš„å¹¶è¡ŒåŒ–</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿è¡Œä»»æ„å­å›¾&nbsp;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›¾å½¢å¯è§†åŒ–ç¤ºä¾‹ï¼š</font></font><br>
<br>
<strong><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5d/9f7/bc4/b5d9f7bc41fb5563b8337b04ee123e9a.png"></div></strong><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å›¾çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ¨¡å‹ï¼Œå›¾çš„è¾¹ç¼˜ç”±è¡¨è¾¾å¼refç»™å‡ºã€‚</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®è´¨é‡å’Œæ–‡æ¡£</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†æ¨¡å‹æœ¬èº«çš„å½¢æˆä¹‹å¤–ï¼ŒDBTè¿˜å…è®¸æ‚¨æµ‹è¯•æœ‰å…³ç»“æœæ•°æ®é›†çš„è®¸å¤šæ–­è¨€ï¼Œä¾‹å¦‚ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ä¸ºç©º</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‹¬ç‰¹</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚è€ƒå®Œæ•´æ€§-å‚è€ƒå®Œæ•´æ€§ï¼ˆä¾‹å¦‚ï¼Œè®¢å•è¡¨ä¸­çš„customer_idå¯¹åº”äºå®¢æˆ·è¡¨ä¸­çš„idï¼‰</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ¹é…æœ‰æ•ˆåˆ—è¡¨</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥æ·»åŠ è‡ªå·±çš„æµ‹è¯•ï¼ˆè‡ªå®šä¹‰æ•°æ®æµ‹è¯•ï¼‰ï¼Œä¾‹å¦‚ï¼Œä¸€å¤©ï¼Œä¸€å‘¨ï¼Œä¸€ä¸ªæœˆå‰çš„æ”¶å…¥ä¸æŒ‡æ ‡çš„åå·®ç™¾åˆ†æ¯”ã€‚</font><font style="vertical-align: inherit;">å…¬å¼åŒ–ä¸ºSQLæŸ¥è¯¢çš„ä»»ä½•å‡è®¾éƒ½å¯ä»¥ä½œä¸ºæµ‹è¯•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ ·ï¼Œå¯ä»¥åœ¨å­˜å‚¨çš„åº—é¢ä¸­æ•è·ä¸å¿…è¦çš„æ•°æ®åå·®å’Œé”™è¯¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ–‡æ¡£æ–¹é¢ï¼ŒDBTæä¾›äº†ç”¨äºåœ¨æ¨¡å‹çº§åˆ«ç”šè‡³å±æ€§ä¸Šæ·»åŠ ï¼Œç‰ˆæœ¬æ§åˆ¶å’Œåˆ†å‘å…ƒæ•°æ®å’Œæ³¨é‡Šçš„æœºåˆ¶ã€‚&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯åœ¨é…ç½®æ–‡ä»¶çº§åˆ«æ·»åŠ æµ‹è¯•å’Œæ–‡æ¡£çš„æ ·å­ï¼š</font></font><br>
<br>
<pre><code class="ruby hljs">&nbsp;- <span class="hljs-symbol">name:</span> fct_orders
&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">description:</span> This table has basic information about orders, as well as some derived facts based on payments
&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">columns:</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="hljs-symbol">name:</span> order_id
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">tests:</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- unique <span class="hljs-comment">#    </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- not_null <span class="hljs-comment">#    null</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">description:</span> This is a unique identifier <span class="hljs-keyword">for</span> an order<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="hljs-symbol">name:</span> customer_id
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">description:</span> Foreign key to the customers table
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">tests:</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- not_null<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="hljs-symbol">relationships:</span> <span class="hljs-comment">#   </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">to:</span> ref(<span class="hljs-string">'dim_customers'</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">field:</span> customer_id<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="hljs-symbol">name:</span> order_date
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">description:</span> Date (UTC) that the order was placed<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="hljs-symbol">name:</span> status
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">description:</span> <span class="hljs-string">'{{ doc("orders_status") }}'</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">tests:</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="hljs-symbol">accepted_values:</span> <span class="hljs-comment">#    </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-symbol">values:</span> [<span class="hljs-string">'placed'</span>, <span class="hljs-string">'shipped'</span>, <span class="hljs-string">'completed'</span>, <span class="hljs-string">'return_pending'</span>, <span class="hljs-string">'returned'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯æ­¤æ–‡æ¡£åœ¨ç”Ÿæˆçš„ç½‘ç«™ä¸Šçš„å¤–è§‚ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/854/8b6/27e/8548b627ea48caab60c524697984ef77.gif"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®å’Œæ¨¡å—</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTçš„ç›®çš„ä¸ä»…ä»…æ˜¯æˆä¸ºä¸€ç»„SQLè„šæœ¬ï¼Œè€Œæ˜¯ä¸ºç”¨æˆ·æä¾›åŠŸèƒ½å¼ºå¤§ä¸”åŠŸèƒ½ä¸°å¯Œçš„å·¥å…·ï¼Œä»¥æ„å»ºè‡ªå·±çš„è½¬æ¢å¹¶åˆ†å‘è¿™äº›æ¨¡å—ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®æ˜¯å¯åœ¨æ¨¡å‹ä¸­ç§°ä¸ºå‡½æ•°çš„æ„é€ å’Œè¡¨è¾¾å¼é›†ã€‚</font><font style="vertical-align: inherit;">å®ä½¿æ‚¨å¯ä»¥æ ¹æ®DRYï¼ˆä¸è¦è‡ªå·±é‡å¤ï¼‰å·¥ç¨‹åŸç†åœ¨æ¨¡å‹å’Œé¡¹ç›®ä¹‹é—´é‡ç”¨SQLã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ç¤ºä¾‹ï¼š</font></font><br>
<br>
<pre><code class="sql hljs">{% macro rename_category(column_name) %}<font></font>
case<font></font>
&nbsp;when {{ column_name }} ilike&nbsp; '%osx%' then 'osx'<font></font>
&nbsp;when {{ column_name }} ilike&nbsp; '%android%' then 'android'<font></font>
&nbsp;when {{ column_name }} ilike&nbsp; '%ios%' then 'ios'<font></font>
&nbsp;else 'other'<font></font>
<span class="hljs-keyword">end</span> <span class="hljs-keyword">as</span> renamed_product<font></font>
{% endmacro %}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŠå…¶ç”¨é€”ï¼š</font></font><br>
<br>
<pre><code class="sql hljs">{% <span class="hljs-keyword">set</span> column_name = <span class="hljs-string">'product'</span> %}
<span class="hljs-keyword">select</span><font></font>
&nbsp;product,<font></font>
&nbsp;{{ rename_category(column_name) }} <span class="hljs-comment">--  </span>
<span class="hljs-keyword">from</span> my_table
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTå¸¦æœ‰ç¨‹åºåŒ…ç®¡ç†å™¨ï¼Œè¯¥ç¨‹åºåŒ…ç®¡ç†å™¨å…è®¸ç”¨æˆ·å‘å¸ƒå’Œé‡ç”¨å•ä¸ªæ¨¡å—å’Œå®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ„å‘³ç€å¯ä»¥ä¸‹è½½å’Œä½¿ç”¨åº“ï¼Œä¾‹å¦‚â€‹â€‹ï¼š</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dbt_utils</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼šä½¿ç”¨æ—¥æœŸ/æ—¶é—´ï¼Œä»£ç†é”®ï¼Œæ¨¡å¼æµ‹è¯•ï¼Œæ•°æ®é€è§†/å–æ¶ˆé€è§†åŠå…¶ä»–</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°æˆçš„å±•ç¤ºæ¨¡æ¿ï¼Œç”¨äº</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™¤é›ªæœº</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¡çº¹æœåŠ¡</font></font></a>&nbsp;</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç‰¹å®šæ•°æ®ä»“åº“çš„åº“ï¼Œä¾‹å¦‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redshift</font></font></a>&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ—¥å¿—è®°å½•</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -DBT </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">æ—¥å¿—è®°å½•</font></a><font style="vertical-align: inherit;">æ¨¡å—</font></font></li>
</ul><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dbt hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ä¸Šæä¾›äº†è½¯ä»¶åŒ…çš„å®Œæ•´åˆ—è¡¨</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´å¤šåŠŸèƒ½</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨è¿™é‡Œï¼Œæˆ‘å°†æè¿°æˆ‘å’Œå›¢é˜Ÿç”¨æ¥åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wheelyä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ„å»ºæ•°æ®ä»“åº“çš„å…¶ä»–ä¸€äº›æœ‰è¶£çš„åŠŸèƒ½å’Œå®ç°</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿è¡Œæ—¶ç¯å¢ƒçš„åˆ†ç¦»DEV-TEST-PROD</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å³ä½¿åœ¨ç›¸åŒçš„DWHç¾¤é›†ä¸­ï¼ˆé‡‡ç”¨ä¸åŒçš„æ–¹æ¡ˆï¼‰ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹è¡¨è¾¾å¼ï¼š</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">with</span> <span class="hljs-keyword">source</span> <span class="hljs-keyword">as</span> (<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> {{ <span class="hljs-keyword">source</span>(<span class="hljs-string">'salesforce'</span>, <span class="hljs-string">'users'</span>) }}
&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">where</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span>
&nbsp;&nbsp;&nbsp;{%- <span class="hljs-keyword">if</span> target.name <span class="hljs-keyword">in</span> [<span class="hljs-string">'dev'</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">'ci'</span>] -%}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">where</span> <span class="hljs-built_in">timestamp</span> &gt;= <span class="hljs-keyword">dateadd</span>(<span class="hljs-keyword">day</span>, <span class="hljs-number">-3</span>, <span class="hljs-keyword">current_date</span>)&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;{%- endif -%}<font></font>
&nbsp;<font></font>
)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥ä»£ç ä»å­—é¢ä¸Šè¯´ï¼šå¯¹äº</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼€å‘ï¼Œæµ‹è¯•ï¼Œci</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¯å¢ƒ</font><strong><font style="vertical-align: inherit;">ï¼Œ</font></strong><font style="vertical-align: inherit;">ä»…è·å–æœ€è¿‘3å¤©çš„æ•°æ®ï¼Œè€Œä¸å†è·å–æ•°æ®ã€‚</font><font style="vertical-align: inherit;">ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™äº›ç¯å¢ƒä¸­è¿è¡Œå°†æ›´å¿«å¹¶ä¸”éœ€è¦æ›´å°‘çš„èµ„æºã€‚</font><font style="vertical-align: inherit;">åœ¨</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº§å“</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¯å¢ƒä¸­å¯åŠ¨æ—¶ï¼Œ</font><font style="vertical-align: inherit;">è¿‡æ»¤æ¡ä»¶å°†è¢«å¿½ç•¥ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›¿ä»£åˆ—ç¼–ç å®ç°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redshiftæ˜¯åˆ—DBMSï¼Œå®ƒå…è®¸æ‚¨ä¸ºæ¯ä¸ªå•ç‹¬çš„åˆ—æŒ‡å®šæ•°æ®å‹ç¼©ç®—æ³•ã€‚</font><font style="vertical-align: inherit;">é€‰æ‹©æœ€ä½³ç®—æ³•å¯ä»¥å‡å°‘20-50ï¼…çš„ç£ç›˜å ç”¨ç©ºé—´ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong><font style="vertical-align: inherit;">redshift.compress_table</font></strong></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å®</font><font style="vertical-align: inherit;">å°†æ‰§è¡ŒANALYZE COMPRESSIONå‘½ä»¤ï¼Œä½¿ç”¨åˆ†æ®µé”®ï¼ˆdist_keyï¼‰å’Œæ’åºï¼ˆkey_keyï¼‰æŒ‡ç¤ºçš„å»ºè®®åˆ—ç¼–ç ç®—æ³•åˆ›å»ºæ–°è¡¨ï¼Œå°†æ•°æ®ä¼ è¾“è‡³è¯¥è¡¨ï¼Œå¹¶åœ¨å¿…è¦æ—¶åˆ é™¤æ—§å‰¯æœ¬ã€‚</font><font style="vertical-align: inherit;">
å®ç­¾åï¼š</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong><font style="vertical-align: inherit;"></font></strong></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs">{{ compress_table(schema, table,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop_backup=False,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comprows=none|Integer,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort_style=none|compound|interleaved,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort_keys=none|List&lt;String&gt;,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dist_style=none|all|even,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dist_key=none|String) }}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®°å½•æ¨¡å‹å¯åŠ¨</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæ¨¡å‹çš„æ¯æ¬¡æ‰§è¡Œï¼Œæ‚¨éƒ½å¯ä»¥æŒ‚èµ·åœ¨å¯åŠ¨æ¨¡å‹ä¹‹å‰æˆ–åˆ›å»ºæ¨¡å‹ä¹‹åç«‹å³æ‰§è¡Œçš„é’©å­ï¼š</font></font><br>
<br>
<pre><code class="ruby hljs">&nbsp;&nbsp;&nbsp;pre-<span class="hljs-symbol">hook:</span> <span class="hljs-string">"{{ logging.log_model_start_event() }}"</span>
&nbsp;&nbsp;&nbsp;post-<span class="hljs-symbol">hook:</span> <span class="hljs-string">"{{ logging.log_model_end_event() }}"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ—¥å¿—è®°å½•æ¨¡å—å°†å…è®¸æ‚¨å°†æ‰€æœ‰å¿…è¦çš„å…ƒæ•°æ®è®°å½•åœ¨ä¸€ä¸ªå•ç‹¬çš„è¡¨ä¸­ï¼Œæ®æ­¤æ‚¨å¯ä»¥éšåå®¡æ ¸å’Œåˆ†æé—®é¢˜åŒºåŸŸï¼ˆç“¶é¢ˆï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯ä»ªè¡¨æ¿åœ¨Lookerä¸­çš„æŸ¥æ‰¾æ•°æ®ä¸Šçš„å¤–è§‚ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0b/0f4/d7c/d0b0f4d7c7074880fa7ad5d9de6fc196.png"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»“å‚¨è‡ªåŠ¨åŒ–</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨ä½¿ç”¨æ‰€ç”¨å­˜å‚¨çš„åŠŸèƒ½çš„ä»»ä½•æ‰©å±•ï¼Œä¾‹å¦‚UDFï¼ˆç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼‰ï¼Œåˆ™å¯¹è¿™äº›å‡½æ•°è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œè®¿é—®æ§åˆ¶ä»¥åŠè‡ªåŠ¨æ¨å‡ºæ–°å‘è¡Œç‰ˆåœ¨DBTä¸­éå¸¸æ–¹ä¾¿åœ°å®ç°ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬åœ¨Pythonä¸­ä½¿ç”¨UDFæ¥è®¡ç®—å“ˆå¸Œå€¼ï¼Œé‚®ä»¶åŸŸåŸŸå’Œè§£ç ä½æ©ç ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä»»ä½•è¿è¡Œæ—¶ï¼ˆå¼€å‘ï¼Œæµ‹è¯•ï¼Œç”Ÿäº§ï¼‰ä¸Šåˆ›å»ºUDFçš„ç¤ºä¾‹å®ï¼š</font></font><br>
<br>
<pre><code class="sql hljs">{% macro create_udf() -%}<font></font>
&nbsp;<font></font>
&nbsp;{% <span class="hljs-keyword">set</span> <span class="hljs-keyword">sql</span> %}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">REPLACE</span> <span class="hljs-keyword">FUNCTION</span> {{ target.schema }}.f_sha256(mes <span class="hljs-string">"varchar"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">RETURNS</span> <span class="hljs-built_in">varchar</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">LANGUAGE</span> plpythonu<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STABLE<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">AS</span> $$&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">import</span> hashlib
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> hashlib.sha256(mes).hexdigest()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<font></font>
&nbsp;{% endset %}<font></font>
&nbsp;&nbsp;<font></font>
&nbsp;{% <span class="hljs-keyword">set</span> <span class="hljs-keyword">table</span> = run_query(<span class="hljs-keyword">sql</span>) %}<font></font>
&nbsp;<font></font>
{%- endmacro %}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨Wheelyï¼Œæˆ‘ä»¬ä½¿ç”¨åŸºäºPostgreSQLçš„Amazon Redshiftã€‚</font><font style="vertical-align: inherit;">å¯¹äºRedshiftï¼Œå®šæœŸæ”¶é›†è¡¨ç»Ÿè®¡ä¿¡æ¯å¹¶é‡Šæ”¾ç£ç›˜ç©ºé—´éå¸¸é‡è¦-åˆ†åˆ«æ˜¯ANALYZEå’ŒVACUUMå‘½ä»¤ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºæ­¤ï¼Œæ¯æ™šéƒ½ä¼šæ‰§è¡Œredshift_maintenanceå®ä¸­çš„å‘½ä»¤ï¼š</font></font><br>
<br>
<pre><code class="sql hljs">{% macro redshift_maintenance() %}<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">set</span> vacuumable_tables=run_query(vacuumable_tables_sql) %}<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">for</span> <span class="hljs-keyword">row</span> <span class="hljs-keyword">in</span> vacuumable_tables %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">set</span> message_prefix=loop.index ~ <span class="hljs-string">" of "</span> ~ loop.length %}<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{%- <span class="hljs-keyword">set</span> relation_to_vacuum = adapter.get_relation(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">database</span>=<span class="hljs-keyword">row</span>[<span class="hljs-string">'table_database'</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">schema</span>=<span class="hljs-keyword">row</span>[<span class="hljs-string">'table_schema'</span>],<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;identifier=<span class="hljs-keyword">row</span>[<span class="hljs-string">'table_name'</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) -%}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">do</span> run_query(<span class="hljs-string">"commit"</span>) %}<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">if</span> relation_to_vacuum %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">set</span> <span class="hljs-keyword">start</span>=modules.datetime.datetime.now() %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ dbt_utils.log_info(message_prefix ~ <span class="hljs-string">" Vacuuming "</span> ~ relation_to_vacuum) }}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">do</span> run_query(<span class="hljs-string">"VACUUM "</span> ~ relation_to_vacuum ~ <span class="hljs-string">" BOOST"</span>) %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ dbt_utils.log_info(message_prefix ~ <span class="hljs-string">" Analyzing "</span> ~ relation_to_vacuum) }}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">do</span> run_query(<span class="hljs-string">"ANALYZE "</span> ~ relation_to_vacuum) %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">set</span> <span class="hljs-keyword">end</span>=modules.datetime.datetime.now() %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">set</span> total_seconds = (<span class="hljs-keyword">end</span> - <span class="hljs-keyword">start</span>).total_seconds() | <span class="hljs-keyword">round</span>(<span class="hljs-number">2</span>)&nbsp; %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ dbt_utils.log_info(message_prefix ~ <span class="hljs-string">" Finished "</span> ~ relation_to_vacuum ~ <span class="hljs-string">" in "</span> ~ total_seconds ~ <span class="hljs-string">"s"</span>) }}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% <span class="hljs-keyword">else</span> %}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ dbt_utils.log_info(message_prefix ~ <span class="hljs-string">' Skipping relation "'</span> ~ row.values() | <span class="hljs-keyword">join</span> (<span class="hljs-string">'"."'</span>) ~ <span class="hljs-string">'" as it does not exist'</span>) }}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% endif %}<font></font>
&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;{% endfor %}<font></font>
&nbsp;<font></font>
{% endmacro %}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBTäº‘</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯ä»¥å°†DBTç”¨ä½œæœåŠ¡ï¼ˆæ‰˜ç®¡æœåŠ¡ï¼‰ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸€ç»„ä¸­ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºå¼€å‘é¡¹ç›®å’Œæ¨¡å‹çš„Web IDE</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œä¸šé…ç½®å’Œè®¡åˆ’è®¾ç½®</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®€å•æ–¹ä¾¿åœ°è®¿é—®æ—¥å¿—</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰æ‚¨çš„é¡¹ç›®æ–‡æ¡£çš„ç½‘ç«™</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIï¼ˆæŒç»­é›†æˆï¼‰è¿æ¥</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cc/9bc/923/8cc9bc9236411e74d49472864f81fd06.gif"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çƒ¹é¥ªå’Œé¥®ç”¨DWHä¸å–å†°æ²™ä¸€æ ·ä»¤äººæ„‰æ‚¦å’Œæœ‰ç›Šã€‚</font><font style="vertical-align: inherit;">DBTç”±Jinjaï¼Œè‡ªå®šä¹‰æ‰©å±•ï¼ˆæ¨¡å—ï¼‰ï¼Œç¼–è¯‘å™¨ï¼Œå¼•æ“ï¼ˆæ‰§è¡Œç¨‹åºï¼‰å’ŒåŒ…ç®¡ç†å™¨ç»„æˆã€‚</font><font style="vertical-align: inherit;">ä¸€èµ·æ”¶é›†è¿™äº›å…ƒç´ ï¼Œæ‚¨å°†ä¸ºæ•°æ®ä»“åº“æä¾›ä¸€ä¸ªå®Œå–„çš„å·¥ä½œç¯å¢ƒã€‚</font><font style="vertical-align: inherit;">ä»Šå¤©ï¼Œåœ¨DWHä¸­å‡ ä¹æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•æ¥ç®¡ç†è½¬æ¢ã€‚</font></font><br>
<br>
<h1><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/869/0b7/b1e/8690b7b1e979e07c3afdd7cf2c839769.png"></div><br>
</h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DBTå¼€å‘äººå‘˜éµå¾ªçš„ä¿¡å¿µå¦‚ä¸‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£ç è€Œä¸æ˜¯GUIæ˜¯è¡¨è¾¾å¤æ‚åˆ†æé€»è¾‘çš„æœ€ä½³æŠ½è±¡</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤„ç†æ•°æ®åº”é€‚åº”è½¯ä»¶å¼€å‘çš„æœ€ä½³å®è·µï¼ˆè½¯ä»¶å·¥ç¨‹ï¼‰</font></font></li>
</ul><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…³é”®æ•°æ®åŸºç¡€æ¶æ„å¿…é¡»ç”±ç”¨æˆ·ç¤¾åŒºä½œä¸ºå¼€æºè½¯ä»¶è¿›è¡Œæ§åˆ¶</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ä»…åˆ†æå·¥å…·ï¼Œä»£ç ä¹Ÿå°†è¶Šæ¥è¶Šå¤šåœ°æˆä¸ºå¼€æºç¤¾åŒºçš„ä¸€éƒ¨åˆ†ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™äº›æ ¸å¿ƒä¿¡å¿µå‚¬ç”Ÿäº†ç›®å‰æœ‰850å¤šå®¶å…¬å¸ä½¿ç”¨çš„äº§å“ï¼Œå®ƒä»¬æ„æˆäº†å°†æ¥å°†è¦åˆ›å»ºçš„è®¸å¤šæœ‰è¶£æ‰©å±•çš„åŸºç¡€ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºé‚£äº›æ„Ÿå…´è¶£çš„äººï¼Œæœ‰ä¸€ä¸ªæˆ‘åœ¨å‡ ä¸ªæœˆå‰èŠ±è´¹çš„å…¬å¼€è¯¾ç¨‹çš„è§†é¢‘ï¼Œè¿™æ˜¯OTUS- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon Redshiftå­˜å‚¨åº“çš„æ•°æ®æ„å»ºå·¥å…·</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸­çš„å…¬å¼€è¯¾ç¨‹çš„ä¸€éƒ¨åˆ†</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é™¤äº†DBTå’Œæ•°æ®ä»“åº“ä¹‹å¤–ï¼Œä½œä¸ºOTUSå¹³å°ä¸Šçš„æ•°æ®å·¥ç¨‹å¸ˆè¯¾ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘å’Œæˆ‘çš„åŒäº‹ä»¬è¿˜å°±å…¶ä»–ä¸€äº›ç›¸å…³çš„ç°ä»£ä¸»é¢˜è¿›è¡Œè¯¾ç¨‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§æ•°æ®åº”ç”¨çš„æ¶æ„æ¦‚å¿µ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»ƒä¹ Sparkå’ŒSpark Streaming</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠ è½½æ•°æ®æºçš„å­¦ä¹ æ–¹æ³•å’Œå·¥å…·</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨DWHä¸­å»ºç«‹åˆ†æå±•ç¤ºæŸœ</font></font></li>
<li> NoSQL: HBase, Cassandra, ElasticSearch</li>
<li>    &nbsp;</li>
<li> :       </li>
</ul><br>
<h1>:</h1><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DBT documentation â€” Introduction</a> â€”  </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">What, exactly, is dbt?</a> â€”      DBT&nbsp;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Data Build Tool   Amazon Redshift</a> â€” YouTube,    OTUS</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  Greenplum</a> â€”    15  2020</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  Data Engineering</a> â€” OTUS</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Building a Mature Analytics Workflow</a> â€”        </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Itâ€™s time for open source analytics</a> â€”     Open Source</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Continuous Integration and Automated Build Testing with dbtCloud</a> â€”   CI   DBT</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Getting started with DBT tutorial</a> â€” ,     </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jaffle shop â€” Github DBT Tutorial</a> â€” Github,   </li>
</ol><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  .</a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN501368/index.html">5æœˆ11æ—¥è‡³17æ—¥åœ¨è«æ–¯ç§‘ä¸¾è¡Œçš„æ•°å­—æ´»åŠ¨</a></li>
<li><a href="../zh-CN501370/index.html">Trello-ä¸€ä¸ªå°å‹ITå›¢é˜Ÿçš„æœ‰æ•ˆçŸ¥è¯†ç®¡ç†ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN501374/index.html">ä»¿çœŸå‡†å°†65</a></li>
<li><a href="../zh-CN501376/index.html">æ•æ·æ•™ä¼šäº†æˆ‘ä»¬å»ºç­‘çš„çœŸæ­£å«ä¹‰</a></li>
<li><a href="../zh-CN501378/index.html">åœ¨SwiftUIä¸­ä½¿ç”¨@EnvironmentObjectåœ¨è§†å›¾ä¹‹é—´å¯¼èˆª</a></li>
<li><a href="../zh-CN501386/index.html">MNTæ”¹é©-å®Œå…¨å¼€æ”¾å¼ç¬”è®°æœ¬ï¼Œæ¶ˆé™¤åæ‰§</a></li>
<li><a href="../zh-CN501388/index.html">æ•´ä¸ªå…¬å¸éƒ½å¯ä»¥æ•æ·å—ï¼Ÿ</a></li>
<li><a href="../zh-CN501392/index.html">å“åº”å­—ä½“ã€‚åœ¨å¸ƒå±€å’Œæœ€å°å€¼ä¹‹é—´è°ƒæ•´æ–‡æœ¬</a></li>
<li><a href="../zh-CN501394/index.html">å…³äºæ²¡æœ‰ç†è®º/ç†è®ºçš„â€œç†è®ºâ€ /â€œç†è®ºä¸Šâ€çš„ç¿»è¯‘</a></li>
<li><a href="../zh-CN501396/index.html">è°¢å°”ç›–Â·æœ±å…‹ï¼ˆSergey Zhukï¼‰è®¿è°ˆ-ReactPHPä¹¦ç±å’Œå±å¹•å½•åƒçš„ä½œè€…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>