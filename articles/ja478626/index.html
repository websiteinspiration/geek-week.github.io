<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèø ‚öñÔ∏è üí™üèª strace„Çí‰ΩøÁî®„Åó„Åü„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢Â±ïÈñã„ÅÆ„Éá„Éê„ÉÉ„Ç∞ üëä üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üë©üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ÁßÅ„ÅÆ‰∏ª„Å™‰ªï‰∫ã„ÅØ„ÄÅ„Åª„Å®„Çì„Å©„ÅÆÂ†¥Âêà„ÄÅ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„Ç∑„Çπ„ÉÜ„É†„ÅÆÂ±ïÈñã„Åß„Åô„ÄÇ„Å§„Åæ„Çä„ÄÅÁßÅ„ÅØÂ§ö„Åè„ÅÆÊôÇÈñì„ÇíË≤ª„ÇÑ„Åó„Å¶Ê¨°„ÅÆË≥™Âïè„Å´Á≠î„Åà„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
 

- „Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÅØÈñãÁô∫ËÄÖ„Å´„ÅØÊ©üËÉΩ„Åó„Åæ„Åô„Åå„ÄÅÁßÅ„Å´„ÅØÊ©üËÉΩ„Åó„Åæ„Åõ„Çì„ÄÇ„Å©„ÅÜ„Åó„Å¶Ôºü
- Êò®Êó•„Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÅØÁßÅ„Å´„Å®„Å£„Å¶„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Åç„Åæ„Åó„Åü„Åå„ÄÅ‰ªäÊó•„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>strace„Çí‰ΩøÁî®„Åó„Åü„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢Â±ïÈñã„ÅÆ„Éá„Éê„ÉÉ„Ç∞</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/478626/"><p><img src="https://habrastorage.org/webt/zi/se/d3/zised39h1shd8invmnqtcvxxdgu.jpeg"></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÁßÅ„ÅÆ‰∏ª„Å™‰ªï‰∫ã„ÅØ„ÄÅ„Åª„Å®„Çì„Å©„ÅÆÂ†¥Âêà„ÄÅ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„Ç∑„Çπ„ÉÜ„É†„ÅÆÂ±ïÈñã„Åß„Åô„ÄÇ„Å§„Åæ„Çä„ÄÅÁßÅ„ÅØÂ§ö„Åè„ÅÆÊôÇÈñì„ÇíË≤ª„ÇÑ„Åó„Å¶Ê¨°„ÅÆË≥™Âïè„Å´Á≠î„Åà„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">„Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÅØÈñãÁô∫ËÄÖ„Å´„ÅØÊ©üËÉΩ„Åó„Åæ„Åô„Åå„ÄÅÁßÅ„Å´„ÅØÊ©üËÉΩ„Åó„Åæ„Åõ„Çì„ÄÇ</font><font style="vertical-align: inherit;">„Å©„ÅÜ„Åó„Å¶Ôºü</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Êò®Êó•„Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÅØÁßÅ„Å´„Å®„Å£„Å¶„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Åç„Åæ„Åó„Åü„Åå„ÄÅ‰ªäÊó•„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</font><font style="vertical-align: inherit;">„Å©„ÅÜ„Åó„Å¶Ôºü</font></font></li>
</ul><br>
<p> ‚Äî   ,       .   ‚Äî    ,     ‚Äî      .     ‚Äî  ,  ,      ,    ‚Äî , ,      .</p><br>
<p>       <strong>gdb</strong>         .          "      ?"  <strong>strace</strong>.</p><a name="habracut"></a><br>
<h3 id="chto-zhe-takoe-strace">   strace?</h3><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">strace</a> ‚Äî    "  ".    Linux,               (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">DTrace</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ktrace</a>).</p><br>
<p>   .    strace c           (, , ,    <strong>strace</strong>):</p><br>
<pre><code class="plaintext hljs">$ strace echo Hello<font></font>
...Snip lots of stuff...<font></font>
write(1, "Hello\n", 6)                  = 6<font></font>
close(1)                                = 0<font></font>
close(2)                                = 0<font></font>
exit_group(0)                           = ?<font></font>
+++ exited with 0 +++</code></pre><br>
<p>    ?    API    . -       "",    . , ,    -  ,     \      -.      ,  ,       "".        ,     .       ( " ").    :      "",    ,           "" ‚Äî   .</p><br>
<p>          ,        . ..   POSIX C    <strong>write()</strong>,           <strong>write</strong>.</p><br>
<p><img src="https://habrastorage.org/webt/cr/qx/_-/crqx_-ucgqzecn4942nlgmuhaek.png"></p><br>
<p> ,        ( )    .       ,    ,        .   ,      ,        :</p><br>
<ul>
<li> -</li>
<li> -</li>
<li>      -</li>
<li>   \</li>
<li>  </li>
<li>    </li>
</ul><br>
<h3 id="kogda-ispolzovat-strace">  strace?</h3><br>
<p> , <strong>strace</strong>       ,          .     ,  ,       Python  ,           .</p><br>
<p>   <strong>strace</strong>      ,      ,      ,     ,      -    ‚Ä¶ ,             .     <strong>strace</strong>,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">ltrace</a>      (    <strong>openssl</strong>   ).</p><br>
<p>      ,             .     .</p><br>
<h3 id="primer-prostoy-otladki">  </h3><br>
<p>,       foo,    :</p><br>
<pre><code class="plaintext hljs">$ foo<font></font>
Error opening configuration file: No such file or directory</code></pre><br>
<p>,         .  ,   ,   ,  ,    .         ,       ,  .        ,      ,     ,      .   ?</p><br>
<p>     ,      .   ,     .       <strong>gdb</strong>  ,   ,     ,       : <strong>strace</strong>.</p><br>
<p> <strong>strace</strong>   ,     ,       .     -o,       :</p><br>
<pre><code class="plaintext hljs">$ strace -o /tmp/trace foo<font></font>
Error opening configuration file: No such file or directory<font></font>
$ cat /tmp/trace<font></font>
execve("foo", ["foo"], 0x7ffce98dc010 /* 16 vars */) = 0<font></font>
brk(NULL)                               = 0x56363b3fb000<font></font>
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)<font></font>
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3<font></font>
fstat(3, {st_mode=S_IFREG|0644, st_size=25186, ...}) = 0<font></font>
mmap(NULL, 25186, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f2f12cf1000<font></font>
close(3)                                = 0<font></font>
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3<font></font>
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\260A\2\0\0\0\0\0"..., 832) = 832<font></font>
fstat(3, {st_mode=S_IFREG|0755, st_size=1824496, ...}) = 0<font></font>
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f2f12cef000<font></font>
mmap(NULL, 1837056, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f2f12b2e000<font></font>
mprotect(0x7f2f12b50000, 1658880, PROT_NONE) = 0<font></font>
mmap(0x7f2f12b50000, 1343488, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22000) = 0x7f2f12b50000<font></font>
mmap(0x7f2f12c98000, 311296, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x16a000) = 0x7f2f12c98000<font></font>
mmap(0x7f2f12ce5000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1b6000) = 0x7f2f12ce5000<font></font>
mmap(0x7f2f12ceb000, 14336, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f2f12ceb000<font></font>
close(3)                                = 0<font></font>
arch_prctl(ARCH_SET_FS, 0x7f2f12cf0500) = 0<font></font>
mprotect(0x7f2f12ce5000, 16384, PROT_READ) = 0<font></font>
mprotect(0x56363b08b000, 4096, PROT_READ) = 0<font></font>
mprotect(0x7f2f12d1f000, 4096, PROT_READ) = 0<font></font>
munmap(0x7f2f12cf1000, 25186)           = 0<font></font>
openat(AT_FDCWD, "/etc/foo/config.json", O_RDONLY) = -1 ENOENT (No such file or directory)<font></font>
dup(2)                                  = 3<font></font>
fcntl(3, F_GETFL)                       = 0x2 (flags O_RDWR)<font></font>
brk(NULL)                               = 0x56363b3fb000<font></font>
brk(0x56363b41c000)                     = 0x56363b41c000<font></font>
fstat(3, {st_mode=S_IFCHR|0620, st_rdev=makedev(0x88, 0x8), ...}) = 0<font></font>
write(3, "Error opening configuration file"..., 60) = 60<font></font>
close(3)                                = 0<font></font>
exit_group(1)                           = ?<font></font>
+++ exited with 1 +++</code></pre><br>
<p>     <strong>strace</strong> ‚Äî      . (  <strong>mmap</strong>, <strong>mprotect</strong>, <strong>brk</strong>          .) -,     <strong>strace</strong>     .    <strong>write</strong>,    .  ,       ‚Äî  <strong>openat</strong>,   <strong>ENOENT</strong> ("    "),   <strong>/etc/foo/config.json</strong>. ,      .</p><br>
<p>   ,    ,  90% ,    <strong>strace</strong>,        .  ‚Äî     :</p><br>
<ul>
<li> -    system-y   </li>
<li>    <strong>strace</strong></li>
<li>      </li>
<li> ,        </li>
</ul><br>
<p> ,     4-  ,    .</p><br>
<h3 id="podskazki"></h3><br>
<p>      ,        <strong>strace</strong>:</p><br>
<p><strong>man ‚Äî  </strong></p><br>
<p>  *nix         ,  <strong>man syscalls</strong>.     <strong>brk(2)</strong>,  ,    ,  <strong>man 2 brk</strong>.</p><br>
<p> : <strong>man 2 fork</strong>      <strong>fork()</strong>  <strong>GNU libc</strong>, , ,      <strong>clone()</strong>.   <strong>fork</strong>   ,   ,  <strong>fork()</strong>,    ‚Äî     <strong>fork</strong>,    <strong>clone()</strong>.     ,       <strong>strace</strong>.</p><br>
<p><strong> -,     </strong></p><br>
<p><strong>strace</strong>    ,           (    ).           <strong>strace</strong>  .</p><br>
<p><strong> -s,     </strong></p><br>
<p>  ,             .  ,  <strong>strace</strong>      32   .    ,  -  <strong>-s 128</strong>   <strong>strace</strong>.</p><br>
<p><strong>-   \\ .</strong></p><br>
<p>" ‚Äî " ,  *nix    -,   ,       ,   .    ,     ,     ,    <strong>read</strong>  <strong>write</strong>     .</p><br>
<p>  <strong>-</strong>,   <strong>strace</strong>        ,    .</p><br>
<p>      -p**</p><br>
<p>      ,     ,   .  ,      1337 (,   <strong>ps</strong>),       :</p><br>
<pre><code class="plaintext hljs">$ strace -p 1337<font></font>
...system call trace output...</code></pre><br>
<p>,   root-.</p><br>
<p><strong> -f,     </strong></p><br>
<p><strong>strace</strong>      .       ,         ,        .</p><br>
<p> ,   ‚Äî   ,   <strong>-f</strong>,    .    ,        .  <strong>strace</strong>      ,      .      , , , ,   ,   <strong>&lt;unfinished ...&gt;</strong>,  ‚Äî      ,    ‚Äî    <strong>&lt;‚Ä¶ foocall resumed&gt;</strong>.        ,    <strong>-ff</strong> ( ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  <strong>strace</strong>).</p><br>
<p><strong>    -e</strong></p><br>
<p> ,   ‚Äî      .  <strong>-e</strong>    (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>  <strong>strace</strong>).    ,      ,    ,   <strong>grep</strong>`.  ,     .</p><br>
<p><strong>   </strong></p><br>
<p>    ‚Äî ,      ,  , ,   \   :</p><br>
<pre><code class="plaintext hljs">$ strace sh -c uname<font></font>
...<font></font>
stat("/home/user/bin/uname", 0x7ffceb817820) = -1 ENOENT (No such file or directory)<font></font>
stat("/usr/local/bin/uname", 0x7ffceb817820) = -1 ENOENT (No such file or directory)<font></font>
stat("/usr/bin/uname", {st_mode=S_IFREG|0755, st_size=39584, ...}) = 0<font></font>
...</code></pre><br>
<p>  "      "     .     ,     .</p><br>
<p><strong>          </strong></p><br>
<p>     ‚Äî   ,     .  ,     ,      ,         . ,         ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">"   " </a>.</p><br>
<h3 id="primer-otladki-poslozhnee">  </h3><br>
<p>  ,     ‚Äî   ,   ,   ,       <strong>strace</strong>.     ,        .</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">bcron</a> ‚Äî   ,     *nix <strong>cron</strong>.    ,   -   ,   :</p><br>
<pre><code class="plaintext hljs"># crontab -e -u logs<font></font>
bcrontab: Fatal: Could not create temporary file</code></pre><br>
<p>, , <strong>bcron</strong>    ,     ,     .  <strong>strace</strong>:</p><br>
<pre><code class="plaintext hljs"># strace -o /tmp/trace crontab -e -u logs<font></font>
bcrontab: Fatal: Could not create temporary file<font></font>
# cat /tmp/trace<font></font>
...<font></font>
openat(AT_FDCWD, "bcrontab.14779.1573691864.847933", O_RDONLY) = 3<font></font>
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f82049b4000<font></font>
read(3, "#Ansible: logsagg\n20 14 * * * lo"..., 8192) = 150<font></font>
read(3, "", 8192)                       = 0<font></font>
munmap(0x7f82049b4000, 8192)            = 0<font></font>
close(3)                                = 0<font></font>
socket(AF_UNIX, SOCK_STREAM, 0)         = 3<font></font>
connect(3, {sa_family=AF_UNIX, sun_path="/var/run/bcron-spool"}, 110) = 0<font></font>
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f82049b4000<font></font>
write(3, "156:Slogs\0#Ansible: logsagg\n20 1"..., 161) = 161<font></font>
read(3, "32:ZCould not create temporary f"..., 8192) = 36<font></font>
munmap(0x7f82049b4000, 8192)            = 0<font></font>
close(3)                                = 0<font></font>
write(2, "bcrontab: Fatal: Could not creat"..., 49) = 49<font></font>
unlink("bcrontab.14779.1573691864.847933") = 0<font></font>
exit_group(111)                         = ?<font></font>
+++ exited with 111 +++</code></pre><br>
<p>        <strong>write</strong>,     - . -,     ,     . -, ,  - -     .   ,    ‚Äî -   ,  <strong>bcrontab</strong>   .</p><br>
<p>   <strong>man 2 read</strong>,   ,    (3) ‚Äî   ,  *nix      -.  ,     3?       <strong>strace</strong>   <strong>-</strong> (. ),    , ,    ,  ,      .</p><br>
<p>          (   ,    ‚Äî  ,  ,    - ),      ,   ,  3 (..  "= 3"   ).     2: <strong>openat</strong>     <strong>socket</strong>  . <strong>openat</strong>  ,  <strong>close</strong>(3)   ,    . (:     ,     ).  <strong>socket()</strong> ,     <strong>read()</strong>,  ,  bcrontab   -  .   ,      <strong>unix domain socket</strong>   <strong>/var/run/bcron-spool</strong>.</p><br>
<p>,   ,   <strong>unix socket</strong>   .       ,       .  ‚Äî  <strong>netstat</strong>    <strong>ss</strong> (socket status).           <strong>-l</strong>    ,    <strong>-p</strong>   ,      . (   ,        .)</p><br>
<pre><code class="plaintext hljs"># ss -pl | grep /var/run/bcron-spool<font></font>
u_str LISTEN 0   128   /var/run/bcron-spool 1466637   * 0   users:(("unixserver",pid=20629,fd=3))</code></pre><br>
<p>   ,   ‚Äî   <strong>inixserver</strong>,   ID  20629. (,  ,     3   .)</p><br>
<p>          <strong>lsof</strong>.      (  )  .         :</p><br>
<pre><code class="plaintext hljs"># lsof /var/run/bcron-spool<font></font>
COMMAND   PID   USER  FD  TYPE  DEVICE              SIZE/OFF  NODE    NAME<font></font>
unixserve 20629 cron  3u  unix  0x000000005ac4bd83  0t0       1466637 /var/run/bcron-spool type=STREAM</code></pre><br>
<p> 20629 ‚Äî   ,       <strong>strace</strong>   -  <strong>strace -o /tmp/trace -p 20629</strong>.    cron    ‚Äî       .    :</p><br>
<pre><code class="plaintext hljs">accept(3, NULL, NULL)                   = 4<font></font>
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7faa47c44810) = 21181<font></font>
close(4)                                = 0<font></font>
accept(3, NULL, NULL)                   = ? ERESTARTSYS (To be restarted if SA_RESTART is set)<font></font>
--- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=21181, si_uid=998, si_status=0, si_utime=0, si_stime=0} ---<font></font>
wait4(0, [{WIFEXITED(s) &amp;&amp; WEXITSTATUS(s) == 0}], WNOHANG|WSTOPPED, NULL) = 21181<font></font>
wait4(0, 0x7ffe6bc36764, WNOHANG|WSTOPPED, NULL) = -1 ECHILD (No child processes)<font></font>
rt_sigaction(SIGCHLD, {sa_handler=0x55d244bdb690, sa_mask=[CHLD], sa_flags=SA_RESTORER|SA_RESTART, sa_restorer=0x7faa47ab9840}, {sa_handler=0x55d244bdb690, sa_mask=[CHLD], sa_flags=SA_RESTORER|SA_RESTART, sa_restorer=0x7faa47ab9840}, 8) = 0<font></font>
rt_sigreturn({mask=[]})                 = 43<font></font>
accept(3, NULL, NULL)                   = 4<font></font>
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7faa47c44810) = 21200<font></font>
close(4)                                = 0<font></font>
accept(3, NULL, NULL)                   = ? ERESTARTSYS (To be restarted if SA_RESTART is set)<font></font>
--- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=21200, si_uid=998, si_status=111, si_utime=0, si_stime=0} ---<font></font>
wait4(0, [{WIFEXITED(s) &amp;&amp; WEXITSTATUS(s) == 111}], WNOHANG|WSTOPPED, NULL) = 21200<font></font>
wait4(0, 0x7ffe6bc36764, WNOHANG|WSTOPPED, NULL) = -1 ECHILD (No child processes)<font></font>
rt_sigaction(SIGCHLD, {sa_handler=0x55d244bdb690, sa_mask=[CHLD], sa_flags=SA_RESTORER|SA_RESTART, sa_restorer=0x7faa47ab9840}, {sa_handler=0x55d244bdb690, sa_mask=[CHLD], sa_flags=SA_RESTORER|SA_RESTART, sa_restorer=0x7faa47ab9840}, 8) = 0<font></font>
rt_sigreturn({mask=[]})                 = 43<font></font>
accept(3, NULL, NULL</code></pre><br>
<p>( <strong>accept()</strong>     .)  ,   ,      ,   .      ,   bcrontag      .      (<strong>clone</strong>, <strong>wait4</strong>, <strong>SIGCHLD</strong>  .)     , ,   ,    .      ,    <strong>strace -f</strong>.    ,         strace <strong>-f -o /tmp/trace -p 20629</strong>:</p><br>
<pre><code class="plaintext hljs">21470 openat(AT_FDCWD, "tmp/spool.21470.1573692319.854640", O_RDWR|O_CREAT|O_EXCL, 0600) = -1 EACCES (Permission denied) <font></font>
21470 write(1, "32:ZCould not create temporary f"..., 36) = 36<font></font>
21470 write(2, "bcron-spool[21470]: Fatal: logs:"..., 84) = 84<font></font>
21470 unlink("tmp/spool.21470.1573692319.854640") = -1 ENOENT (No such file or directory)<font></font>
21470 exit_group(111)                   = ?<font></font>
21470 +++ exited with 111 +++</code></pre><br>
<p>,   -.  21470   "  "       <strong>tmp/spool.21470.1573692319.854640</strong> (    ).        ,         ,          .  ,   ,      <strong>lsof -p 21470</strong>  ,    ,       ‚Äî    PID 21470,  . (  , PID 21470,  ,    ,     <strong>lsof -p</strong>  .)    ‚Äî <strong>chdir</strong> (        ).         ,    PID 20629:</p><br>
<pre><code class="plaintext hljs">20629 clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7faa47c44810) = 21470<font></font>
...<font></font>
21470 execve("/usr/sbin/bcron-spool", ["bcron-spool"], 0x55d2460807e0 /* 27 vars */) = 0<font></font>
...<font></font>
21470 chdir("/var/spool/cron")          = 0<font></font>
...<font></font>
21470 openat(AT_FDCWD, "tmp/spool.21470.1573692319.854640", O_RDWR|O_CREAT|O_EXCL, 0600) = -1 EACCES (Permission denied) <font></font>
21470 write(1, "32:ZCould not create temporary f"..., 36) = 36<font></font>
21470 write(2, "bcron-spool[21470]: Fatal: logs:"..., 84) = 84<font></font>
21470 unlink("tmp/spool.21470.1573692319.854640") = -1 ENOENT (No such file or directory)<font></font>
21470 exit_group(111)                   = ?<font></font>
21470 +++ exited with 111 +++</code></pre><br>
<p>( ,  , ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   *nix  </a>.) ,  PID 20629        <strong>/var/spool/cron/tmp/spool.21470.1573692319.854640</strong>.  ,   ‚Äî     . :</p><br>
<pre><code class="plaintext hljs"># ls -ld /var/spool/cron/tmp/<font></font>
drwxr-xr-x 2 root root 4096 Nov  6 05:33 /var/spool/cron/tmp/<font></font>
# ps u -p 20629<font></font>
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<font></font>
cron     20629  0.0  0.0   2276   752 ?        Ss   Nov14   0:00 unixserver -U /var/run/bcron-spool -- bcron-spool</code></pre><br>
<p>   !     cron,    root      <strong>/var/spool/cron/tmp/</strong>.   <strong>chown cron /var/spool/cron/tmp/</strong>  <strong>bcron</strong>  . (     ,      ‚Äî     SELinux  AppArmor,           <strong>dmesg</strong>.)</p><br>
<h3 id="itogo"></h3><br>
<p>       ,  , , ,   ‚Äî         . ,     <strong>bcron</strong>,   .</p><br>
<p>           ,     ,  ,  <strong>strace</strong>,        ,   .   , <strong>strace</strong>       . ,      .</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478606/index.html">„Äå„Åä„ÇÑ„Åô„Åø„Äç-„Çπ„Éû„Éº„Éà„Ç¨„Ç∏„Çß„ÉÉ„Éà„Åå‰∫∫„ÄÖ„ÅÆÁù°Áú†„ÇíÂ•™„ÅÜÊñπÊ≥ï</a></li>
<li><a href="../ja478616/index.html">Windows UAC„ÅØÈ©ö„Åã„Åö„Å´„ÅØ„ÅÑ„Çâ„Çå„Åæ„Åõ„Çì„ÄÅ„Åæ„Åü„ÅØ„Ç§„É≥„Çµ„Ç§„ÉÄ„Éº„ÇíÊ§úÂá∫„Åô„ÇãÊñπÊ≥ï</a></li>
<li><a href="../ja478618/index.html">È≠îÊ≥ï„ÅÆPHP„ÅÆÂ≠¶Ê†°</a></li>
<li><a href="../ja478620/index.html">FastAPI„ÇíË©¶„ÅôÂøÖË¶Å„Åå„ÅÇ„Çã„ÅÆ„ÅØ„Å™„Åú„Åß„Åô„ÅãÔºü</a></li>
<li><a href="../ja478622/index.html">A / B„ÉÜ„Çπ„Éà„ÄÅ„Éë„Ç§„Éó„É©„Ç§„É≥„ÄÅÂ∞èÂ£≤ÔºöGeekBrains„Å®X5 Retail Group„ÅÆ„Éì„ÉÉ„Ç∞„Éá„Éº„Çø„Å´Èñ¢„Åô„Çã„Éñ„É©„É≥„ÉâÂõõÂçäÊúü</a></li>
<li><a href="../ja478628/index.html">‰∏≠ÂõΩË™û„ÅÆÈ´ò„ÅÑCRI</a></li>
<li><a href="../ja478630/index.html">„Éë„Çπ„Ç´„É´„ÅØÂõ≤Á¢Å„ÇíÊºî„Åò„Åæ„Åô„ÄÇ„Ç¢„Éû„ÉÅ„É•„Ç¢„Ç≥„É≥„Éë„Ç§„É©„Åß„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„Å®„Ç§„É≥„Çø„Éº„Éï„Çß„Ç§„Çπ„ÅÆÂÆüË£Ö</a></li>
<li><a href="../ja478634/index.html">Ê©üÊ¢∞Â≠¶Áøí„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁÆ°ÁêÜ„ÅÆËêΩ„Å®„ÅóÁ©¥</a></li>
<li><a href="../ja478636/index.html">„ÉÜ„Ç≠„Çπ„Éà„Ç®„É≥„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„ÅÆ‰ªïÁµÑ„Åø„ÄÇ„Äå„ÉØ„Éã„Äç„ÅØ„Å©„Åì„Åã„ÇâÊù•„Åü„ÅÆ„Åß„Åô„ÅãÔºü„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„ÅÆÂéüÂâá„ÄÇ‰∏ÄËà¨Âåñ„Å®Ë©≥Á¥∞ÂàÜÊûê</a></li>
<li><a href="../ja478638/index.html">db-treeÔºö„Éá„Éº„Çø„Éô„Éº„Çπ„ÅÆÊ§úÁ¥¢„Å®„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>