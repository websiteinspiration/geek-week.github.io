<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧜🏿 🧓🏻 👨‍👩‍👦 CI / CD-Prozessaktualisierung: Teamcity 😾 ⛹🏿 🧒🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist der zweite Artikel in einer Reihe zum Aktualisieren von CI / CD-Prozessen. Bis zu diesem Zeitpunkt wurden Vorbereitungen für die Einrichtung ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CI / CD-Prozessaktualisierung: Teamcity</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/496342/"><img src="https://habrastorage.org/webt/cu/y-/hg/cuy-hgxvywohqkg_tbyr2wn268c.png" alt="Bild" align="left" width="300"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist der zweite Artikel in einer Reihe zum Aktualisieren von CI / CD-Prozessen. Bis zu diesem Zeitpunkt wurden Vorbereitungen für die Einrichtung neuer Instrumente getroffen, nämlich: Planung, tägliche Kundgebungen, Beilegung von Meinungsverschiedenheiten im Allgemeinen, ohne die es nicht möglich wäre, einen Arbeitsprozess kompetent aufzubauen. Und jetzt sind alle Probleme gelöst. Wir sind zuversichtlich, dass wir die Entwicklung fortsetzen können, und unser Code wird zu Beginn des Sommers nicht im Schwarzen Loch versinken.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte Sie an das Inhaltsverzeichnis der Artikelliste sowie an die kurzen Ergebnisse des vorherigen Teils erinnern. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 1: Was ist, warum ist es nicht so, Planung, ein kleiner Schlag.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ich würde diesen Teil als nahezu technisch bezeichnen. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 2: Teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teil 3: Octopus Deploy.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Teil 4: hinter den Kulissen. Unangenehme Momente, Pläne für die Zukunft, möglicherweise FAQ. Höchstwahrscheinlich kann es auch als nahezu technisch bezeichnet werden.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben dem Kunden einen Proof-of-Concept für ein neues Update-Delivery-System zur Verfügung gestellt, die Mängel des vorhandenen Systems identifiziert, die Basis für das neue System ausgewählt, einen Übergangsplan erstellt und unser Quecksilber-Repository auf Git umgestellt. Außerdem haben wir im vorherigen Teil die Funktionen des Projekts beschrieben, die sich auf den gesamten nachfolgenden Prozess auswirken.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bereits erwähnt, entsprach die vorhandene Lösung nicht den modernen Anforderungen. Anfangs wurde höchstwahrscheinlich ein Build in ccnet konfiguriert. Der allererste Build, mit dem alles begann (wie ein Urknall, ja). Dann drückte anscheinend die Person, die alles eingerichtet hatte, Strg + C, Strg + V, korrigierte einige Zeilen und erhielt eine neue Konfiguration. Und für die gesamte nachfolgende Zeit wurde dies so oft durchgeführt, dass der Quellcode auf dem Build-Server mehr als 60 GB beanspruchte. Und das ist nur die Quelle! Und es gibt Protokolle, Build-Artefakte, temporäre Dateien und so weiter. Nur das brachte mich zum Nachdenken. Wenn man sich das alte System ansieht, sieht man Folgendes: Für jedes Modul wurde ein Erstellungsschritt ausgeführt. Tatsächlich wurde der gleiche Kern zusammengebaut. Diese Assembly wurde für jedes Modul (zusammen mit der Quelle) auf dem Server gespeichert.Die Build-Ergebnisse (90% identisch) wurden in lokale Repositorys verschoben (Git-Bereitstellung) und nahmen natürlich auch ihren Platz ein. Es war möglich und notwendig, dies zu verlassen.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allgemeine Einstellungen&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu diesem Zeitpunkt wird davon ausgegangen, dass bereits eine Teamstadt und ein Oktopus konfiguriert sind. </font><font style="vertical-align: inherit;">Bei der Installation und Konfiguration hören wir nicht im Detail auf. </font><font style="vertical-align: inherit;">Der Einfachheit halber schreiben wir die URL und das API-Token des Octopus in env teamcity auf, was für das Root-Projekt </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sa/vw/ir/savwiryxdsw8fpgrgvdzavejho0.png" alt="Bild"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">übrigens </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folgendermaßen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aussieht: </font><i><font style="vertical-align: inherit;">env.apiUserName</font></i><font style="vertical-align: inherit;"> und </font><i><font style="vertical-align: inherit;">env.apiUserPassword</font></i><font style="vertical-align: inherit;"> sind API-Zugriffe auf den teamcity-Benutzer (wird später benötigt), </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.buildPath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env .sourcePath</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - der Standardpfad zu den Build- bzw. Quelldateien </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoApiKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - das Token und die URL des Octopus. </font><font style="vertical-align: inherit;">Sie </font><font style="vertical-align: inherit;">fügten </font><font style="vertical-align: inherit;">immer noch </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.teamcityUrl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzu. </font><font style="vertical-align: inherit;">Nun, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tt.exe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Pfad zum Dienstprogramm zur Texttransformation. </font><font style="vertical-align: inherit;">Dieses Dienstprogramm generiert alle Konfigurationen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von den Plugins von Drittanbietern ist nur die Octopus Deploy-Integration installiert.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die ohnehin schon große Textmenge nicht zu überladen, werden nur die Schritte im Detail untersucht, in denen es etwas gibt, das Aufmerksamkeit verdient. </font><font style="vertical-align: inherit;">Es wird davon ausgegangen, dass alles andere aufgrund der präsentierten Daten und des Wissens des Lesers verständlich ist. </font><font style="vertical-align: inherit;">Wenn Sie Fragen haben, beantworte ich diese auf jeden Fall gerne.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projektaufschlüsselung, Versionierung, Namen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Ergebnis war ein solches Projektschema (als Bild, da beim Anzeigen einer mehrstufigen Liste ein Problem </font></font><br>
<img src="https://habrastorage.org/webt/-4/oq/gh/-4oqghadht5sr4rdpk7f3igz5do.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
auftritt </font><font style="vertical-align: inherit;">): </font><font style="vertical-align: inherit;">Wir werden die Pakete wie folgt versionieren: major.minor.patch, wobei major bisher 1 ist, minor der Build-Zähler aus der Build-Konfiguration, patch der Build-Zähler für die Konfiguration Bereitstellen (für die Build-Konfiguration nicht erforderlich, daher immer 0). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinweis: Die</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alte Version wird hier beschrieben. Wir gestalten es so um, dass es auf dem Git-Tag basiert. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3v/kl/ov/3vklovvjqjnhwa8yg0b3lxtduns.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Beispiel ist hier 1 Dur, 95 Moll und 1 Patch.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im neuen Prozess für Module wird es einen Build geben, der dann für jedes Modul bereitgestellt wird. Das heißt, der Quellcode wird für jede Umgebung in einer einzigen Kopie gespeichert. Das Build-Ergebnis ist auch, da es für alle Module gleich ist. Einzigartige Konfigurationen und Bibliotheken werden in der Bereitstellungsphase in einem einzelnen Paket zusammengefasst. Dadurch wird der Speicherplatz effektiv genutzt und die Lieferzeit jedes Pakets verkürzt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Vorbereitungsphase gab es ein separates kurzes Treffen zur Konvention der Benennung von Konfigurationsdateien. Früher war es (es war nur), aber nicht immer dasselbe. Außerdem enthielt der Konfigurationsname nicht immer genügend Informationen. Infolgedessen lauteten alle Konfigurationsnamen wie folgt: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConfigurationType.Environment.ModName.config</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dabei kann ConfigurationType AppSettings, Web usw. sein. </font><font style="vertical-align: inherit;">Umwelt - Entwicklung, Test, Inszenierung, Produktion. </font><font style="vertical-align: inherit;">ModName ist der eindeutige Name des Moduls.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Modulprojekte arbeiten nach dem gleichen Prinzip.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Umgebung verfügt über eine Build-Konfiguration, die:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Führt eine Nuget-Wiederherstellung durch (NuGet-Installationsprogramm, Nuget-Wiederherstellung)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erzeugt Konfigurationen (Befehlszeile, Texttransformation)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buildit-Lösung (Visual Studio SLN)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nimmt Dateien von env.buildPath in zip auf und verschiebt sie in octopus (Octopus deploy: Push-Pakete)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Release-Erstellung (keine Bereitstellung) (Octopus Deploy-Release erstellen)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setzt die Patch-Version zurück (Powershell)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt auch Bereitstellungskonfigurationen, die auf der Vorlage basieren und Folgendes ausführen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nimmt die Konfigurationen auf, die in der Erstellungsphase generiert wurden (Schritt 2) (Octopus stellt Push-Pakete bereit).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bereitstellen der Kernversion (die in Schritt 6 des Builds erstellt wurde) (Octopus Deploy: Bereitstellen der Version)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einzelne Release-Version (die in Schritt 1 der aktuellen Konfiguration erstellt wurde) (Octopus Deploy: Deployment-Version)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zeigt eine Liste aller Domänen für dieses Modul im Protokoll an (Schritt zur Vereinfachung für Tester und Entwickler). </font><font style="vertical-align: inherit;">(Power Shell).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für jede Bereitstellungskonfiguration wird die Buildkonfiguration zur Abhängigkeit hinzugefügt. </font><font style="vertical-align: inherit;">Auf diese Weise kann der Build automatisch gestartet werden, wenn er bereitgestellt wird, wenn er nicht relevant ist, und die Patch-Version kann zurückgesetzt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deploy_all-Konfiguration. </font><font style="vertical-align: inherit;">Tatsächlich handelt es sich um eine Build-Kette, die beschreibt, dass Sie zuerst Build ausführen müssen, wenn dies nicht relevant ist, und dann alle Modi gleichzeitig installieren müssen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rq/ps/ck/rqpsckl2g8rrt9voltbt082itcu.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ungefähr so ​​aus </font><font style="vertical-align: inherit;">: Schauen </font><font style="vertical-align: inherit;">wir </font><font style="vertical-align: inherit;">uns </font><font style="vertical-align: inherit;">einige Schritte etwas genauer an.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.Allgemeine Einstellungen</font></font></h3><br>
<img src="https://habrastorage.org/webt/g_/5j/b9/g_5jb95h7ei6qexbvckqd8sxs7e.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus ungewöhnlichem Build-Number-Format. </font><font style="vertical-align: inherit;">Wird später erklärt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.env</font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/nr/bx/a4nrbxt_8ol6yjuo64npqfxuota.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interessant sind hier: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.coreProjectName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - für das gesamte Projekt festgelegt. </font><font style="vertical-align: inherit;">Wird benötigt, um das Projekt in Octopus zu identifizieren. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.Environment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Set für das Teilprojekt Modules. </font><font style="vertical-align: inherit;">Abhängig von der Umgebung müssen die richtigen Konfigurationen ausgewählt werden. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.octoChannel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - der Kanal im Oktopus, in den das Paket fällt. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleich</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie </font><i><font style="vertical-align: inherit;">env.Environment</font></i><font style="vertical-align: inherit;"> . </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.serviceName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist der Name der Lösung. </font><font style="vertical-align: inherit;">Grundsätzlich wird die Variable zur einfacheren Visualisierung hinzugefügt. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantRoleTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><i><font style="vertical-align: inherit;">Tenant-</font></i><font style="vertical-align: inherit;"> Tag im Octopus. </font><font style="vertical-align: inherit;">Weitere Details im Abschnitt Oktopus.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.4 </font></font></h3><br>
<img src="https://habrastorage.org/webt/a4/da/r1/a4dar1z6_kawzfttqbuvoivu_mm.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie dem Archiv mit dem Namen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% env.serviceName%.% Build.number% .zip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dateien aus dem Verzeichnis mit dem Ergebnis des </font><i><font style="vertical-align: inherit;">Builds</font></i><font style="vertical-align: inherit;"> , ausgenommen alle Konfigurationen, und DLL aus dem Ordner bin / native hinzu. </font><font style="vertical-align: inherit;">Die letzten wurden einmal manuell zum Webserver hinzugefügt und niemand wird sie erneut berühren. </font><font style="vertical-align: inherit;">Bei Bedarf werden sie auch manuell aktualisiert (dafür ist geplant, ein separates Skript zu schreiben, aber wir werden ehrlich sein). </font><font style="vertical-align: inherit;">Dies liegt an der Tatsache, dass diese Bibliotheken vom IIS-Pool „gehalten“ werden. Für eine erfolgreiche Bereitstellung muss sie gestoppt und dann gestartet werden, was einige Zeit in Anspruch nimmt. </font><font style="vertical-align: inherit;">Durch das Ausschließen dieser Bibliotheken von der Bereitstellung können wir den Schritt des Stoppens des Pools überspringen, wodurch die Bereitstellungszeit und dementsprechend Ausfallzeiten verkürzt werden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.5</font></font></h3><br>
<img src="https://habrastorage.org/webt/us/hu/zx/ushuzxwer8u3iwqnuuqpjbuoodo.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich denke, hier ist alles klar, außer warum das Feld Umwelt leer ist. </font><font style="vertical-align: inherit;">In welcher Umgebung das Paket erhält, trifft der Octopus eine Entscheidung basierend auf dem Pre-Release-Tag (in den Kanälen konfiguriert). </font><font style="vertical-align: inherit;">Dieses Tag ist in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.number% enthalten</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (dieselbe Einstellung auf dem Bildschirm in Build.General). </font><font style="vertical-align: inherit;">In diesem Fall stellte sich heraus, dass es bequemer war. </font><font style="vertical-align: inherit;">Beachten Sie auch das Kontrollkästchen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bereitstellungsprozess anzeigen"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wenn es nicht installiert ist, betrachtet timsity den Build als erfolgreich, sobald der Octopus begonnen hat (aber noch nicht fertig ist!). </font><font style="vertical-align: inherit;">Wenn das Kontrollkästchen nicht installiert ist und während der Bereitstellungsphase ein Fehler aufgetreten ist, wissen wir nichts darüber, ohne auf die Octopus-Oberfläche zu schauen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.6</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nichts Ungewöhnliches, nur ein Powershell-Skript und Informationen aus der Teamcity-Dokumentation.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$pair</span> = <span class="hljs-string">"%env.apiUserName%:%env.apiUserPassword%"</span>
<span class="hljs-variable">$encodedCreds</span> = [<span class="hljs-type">System.Convert</span>]::ToBase64String([<span class="hljs-type">System.Text.Encoding</span>]::ASCII.GetBytes(<span class="hljs-variable">$pair</span>))
<span class="hljs-variable">$basicAuthValue</span> = <span class="hljs-string">"Basic <span class="hljs-variable">$encodedCreds</span>"</span>
<span class="hljs-variable">$depUri</span>=<span class="hljs-string">"%env.teamcityUrl%/app/rest/buildTypes?locator=snapshotDependency:(from:(build:(id:%teamcity.build.id%)),includeInitial:false)"</span>
<span class="hljs-comment"># Get all dependencies of main build</span>
<span class="hljs-variable">$result</span> = (<span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$depUri</span>)
<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$result</span>.buildTypes.buildType.Count) { <span class="hljs-variable">$buildId</span> += <span class="hljs-variable">$result</span>.buildTypes.buildType.id }
<span class="hljs-variable">$buildId</span> = <span class="hljs-variable">$buildId</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span> <span class="hljs-operator">-ne</span> <span class="hljs-string">'Module_DeployAll'</span> }
<span class="hljs-comment"># Reset all child build counters to 1. This build counters are patch versions in every build. (1.build.patch)</span>
<span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$buildId</span>.Count; <span class="hljs-variable">$i</span>++) {
  <span class="hljs-variable">$buildCounterUri</span> = <span class="hljs-string">"%env.teamcityUrl%/httpAuth/app/rest/buildTypes/"</span>+<span class="hljs-variable">$buildId</span>[<span class="hljs-variable">$i</span>]+<span class="hljs-string">"/settings/buildNumberCounter"</span>
  <span class="hljs-built_in">Invoke-RestMethod</span> <span class="hljs-literal">-Method</span> Put <span class="hljs-literal">-Headers</span> <span class="hljs-selector-tag">@</span>{<span class="hljs-string">'accept'</span>=<span class="hljs-string">'text/plain'</span>; <span class="hljs-string">'Origin'</span>=<span class="hljs-string">'http://localhost:8090'</span>; <span class="hljs-string">"Authorization"</span>=<span class="hljs-string">"<span class="hljs-variable">$basicAuthValue</span>"</span>} <span class="hljs-literal">-Uri</span> <span class="hljs-variable">$buildCounterUri</span> <span class="hljs-literal">-ContentType</span> <span class="hljs-string">"text/plain"</span> <span class="hljs-literal">-Body</span> <span class="hljs-number">1</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier brauchen wir einen API-Benutzer in Teamcity (env ist für ihn erstellt). </font><font style="vertical-align: inherit;">Wir melden uns an, nehmen alle Konfigurationen, die von der Build-Konfiguration abhängig sind, und setzen ihren Build-Zähler auf 1 zurück. Dies ist in der Tat für jede Patch-Version ein Indikator dafür, wie oft derselbe Build für ein bestimmtes Modul bereitgestellt wurde. </font><font style="vertical-align: inherit;">Wenn es keine 1 gibt, bedeutet dies, dass beim Bereitstellen oder Bearbeiten des Moduls in der aktuellen Version ein Fehler aufgetreten ist, und dass besondere Aufmerksamkeit erforderlich ist.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.General</font></font></h3><br>
<img src="https://habrastorage.org/webt/aa/lx/p4/aalxp4uzeiofjnfo0tfdx57z0cs.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versionsformat: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.% dep.Module_Build.build.counter%.% Build.counter% -staging</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wobei </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Teamcity-Systemvariable ist, deren Wert dem Build-Zähler der entsprechenden Build-Konfiguration entspricht (sollte hinzugefügt werden) Abhängigkeiten). </font><font style="vertical-align: inherit;">Tatsächlich ist hier 1 die Hauptversion, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% dep.Module_Build.build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist minor und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">% build.counter%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist patch. </font><font style="vertical-align: inherit;">Staging ist ein Pre-Release-Tag.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.Env</font></font></h3><br>
<img src="https://habrastorage.org/webt/wl/lc/sv/wllcsv3zxji40gzu-p1ef-vlgu4.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Hinzufügen eines neuen Moduls wird nur die Konfiguration für dessen Bereitstellung hinzugefügt und der Wert der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName angegeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Alle anderen Variablen werden von den übergeordneten Projekten geerbt. </font><font style="vertical-align: inherit;">Die Variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.tenantModTag</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für einen Oktopus wird aus </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName gebildet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.2</font></font></h3><br>
<img src="https://habrastorage.org/webt/zt/yx/2q/ztyx2q7ffqxfpwxtsrrol6ojfqy.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stellen Sie das Kernpaket bereit.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Versionsnummer spätestens - Verwenden Sie die neueste verfügbare Version für diese Umgebung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mandanten-Tag - Client- / Organisations-Tag. </font><font style="vertical-align: inherit;">Weitere Details im Abschnitt Oktopus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzliche CLI-Parameter. </font><font style="vertical-align: inherit;">Hier geben wir den Kanal an, in den unser Paket fallen wird, sowie zusätzliche Parameter. </font><font style="vertical-align: inherit;">Dies wird auch im Abschnitt über Tintenfische gesondert erläutert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.3</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie bei Deploy.2 wird nur ein einzelnes Modulpaket bereitgestellt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.4</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Schritt wird im Folgenden ebenfalls ausführlich beschrieben, da er Daten von Octopus empfängt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Konfigurationen für die Unternehmenswebsite und das Spezialmodul basieren auf demselben Prinzip, und die Hauptpunkte in ihnen sind dieselben. Daher sehe ich keinen Grund, sie im selben Detail zu beschreiben. Sie sind eins, sie müssen nicht viele Male bereitgestellt werden, und tatsächlich gibt es Nuget-Wiederherstellung, Texttransformation, MSbuild, Octopus Push, Octopus Create Release + Deploy.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erfahren Sie mehr über einzigartige Konfigurationen. </font><font style="vertical-align: inherit;">Für einige Mods gibt es möglicherweise keine Umgebungen (z. B. Staging), sie müssen auf anderen Servern bereitgestellt werden oder Sie müssen die Client-ID manuell festlegen (nehmen Sie die Grundkonfiguration und ändern Sie einige Felder darin mit Powershell). </font><font style="vertical-align: inherit;">Das heißt, sie arbeiten nach dem gleichen Prinzip wie die Hauptmodule. </font><font style="vertical-align: inherit;">Ihre Einzigartigkeit liegt in der Tatsache, dass Schritte für sie hinzugefügt / geändert werden oder der Bereitstellungsserver geändert wird und sie nicht in die Vorlage passen, sodass das Erstellen etwas länger dauert. </font><font style="vertical-align: inherit;">Zum Glück gibt es nur wenige.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teamcity: Zusammenfassung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Implementierung von Teamcity ermöglichte einen optimaleren Ansatz für den Prozess der Anwendungsmontage. Jetzt dauert es viel weniger Zeit: Anstatt jedes Mal denselben Code zu erstellen, erstellen wir ihn einmal. Wir nutzen auch den Speicherplatz, den Netzwerkverkehr und die Rechenzeit besser. Bisher entsprach die Anzahl der Pakete für die Bereitstellung (Repositorys mit Artefakten) der Anzahl der Module. Jede Packung wog ungefähr 100 M in komprimierter Form. Jetzt haben wir die Anzahl der Pakete eins mehr als die Anzahl der Module, wobei ein Paket ungefähr die gleichen 100 Millionen wiegt und der Rest ungefähr 500 KB. Plus eine benutzerfreundlichere Oberfläche, bequeme Protokolle und vor allem - Verkürzung der Zeit für die Wartung des Build-Systems und Hinzufügen von Konfigurationen. Das Hinzufügen eines neuen Moduls dauert nun 15 Minuten bis eine halbe Stunde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Separat sollte über die Vorlagen gesprochen werden, da es die Standardisierung ist, die es uns ermöglicht, Zeit bei der Erstellung neuer Konfigurationen und deren weiterer Wartung zu sparen. Alle Konfigurationen für die Interaktion mit Octopus (Deployment) basieren auf einer einzigen Vorlage. Erstens ermöglicht es die Vereinheitlichung und damit die Vereinfachung des Prozesses. Zweitens spart es, wie bereits erwähnt, Zeit beim Hinzufügen neuer Konfigurationen: Wir haben eine Vorlage verbunden, eine Variable geändert und fertig. Und vor allem vereinfachen Vorlagen die Wartung. Alle an der Vorlage vorgenommenen Änderungen werden von darauf basierenden Konfigurationen übernommen. Wenn Sie also allen Konfigurationen gleichzeitig einen Schritt hinzufügen müssen, müssen Sie nicht auf alle klicken. Fügen Sie diesen Schritt einfach der Vorlage hinzu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich ging der Teamcity-Setup-Prozess mit dem Octopus-Setup einher. </font><font style="vertical-align: inherit;">Es ist einfach unmöglich, im Text parallel zu beschreiben, da große Verwechslungsgefahr besteht. </font><font style="vertical-align: inherit;">Daher wurde die Beschreibung geteilt, und in diesem Teil werden nur die Schritte zum Bereitstellen von CI beschrieben. </font><font style="vertical-align: inherit;">Der Octopus-Setup-Prozess wird im Folgenden beschrieben.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de496332/index.html">Antidron: Reflexion von UAV- und Quadrocopter-Angriffen</a></li>
<li><a href="../de496334/index.html">Dell U4919DW Test: Ultra-breiter 49-Zoll-Monitor mit gebogenem Bildschirm</a></li>
<li><a href="../de496336/index.html">Wofür sind intelligente Zähler?</a></li>
<li><a href="../de496338/index.html">Krise und das wars</a></li>
<li><a href="../de496340/index.html">Wir trainieren ein generativ-wettbewerbsfähiges Netzwerk für das Zeichnen von Bildern in Azure ML</a></li>
<li><a href="../de496344/index.html">Ist die Quarantäne von Online-Hackathons der richtige Zeitpunkt?</a></li>
<li><a href="../de496346/index.html">Wir fügen dem täglichen Skript einen Rootkit-Hunter-Hash-Check hinzu</a></li>
<li><a href="../de496348/index.html">Web Storage API-Fallstudien</a></li>
<li><a href="../de496350/index.html">Du darfst nicht passieren! - 3D-Drucker antworten auf Coronavirus</a></li>
<li><a href="../de496354/index.html">Ternäre Computerprogrammierung: Spielen Sie mit dem Emulator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>