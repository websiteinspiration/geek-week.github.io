<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçü§ù‚Äçüë®üèø ü§ê üë®üèª‚Äçüåæ Realization of search for stamps on OpenCV without neurons, registration and SMS ü§∞üèº üëΩ üê¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, we were faced with the task of finding and extracting stamps from documents. What for? For example, to verify the presence of seals i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Realization of search for stamps on OpenCV without neurons, registration and SMS</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/directum/blog/486476/"><p><img src="https://habrastorage.org/webt/6q/4h/pq/6q4hpqklwmxrpx8mj6gnso29yg4.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not so long ago, we were faced with the task of finding and extracting stamps from documents. </font><font style="vertical-align: inherit;">What for? </font><font style="vertical-align: inherit;">For example, to verify the presence of seals in contracts from two parties (parties to the contract). </font><font style="vertical-align: inherit;">We in the bins already had a prototype for finding them, written in OpenCV, but it was damp. </font><font style="vertical-align: inherit;">We decided to dig out this relic, shake off the dust from it and make a working solution on its basis.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most of the techniques described here can be applied outside the search for stamps. </font><font style="vertical-align: inherit;">For instance:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">color segmentation;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">search for round objects / circles;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image conversion to polar coordinate system;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intersection of objects, Intersection over Union (IoU, Jacquard coefficient).</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, we had two options: to solve using neural networks or to resurrect a prototype on OpenCV. </font><font style="vertical-align: inherit;">Why did we decide to take OpenCV? </font><font style="vertical-align: inherit;">The answer is at the end of the article.</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code examples will be presented in Python and C #. </font><font style="vertical-align: inherit;">For Python, you need the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opencv-python</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">numpy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> packages </font><font style="vertical-align: inherit;">, for C # you </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">need OpenCvSharp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opencv</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hope you are familiar with the basic OpenCV algorithms. </font><font style="vertical-align: inherit;">I won‚Äôt dive deep into them, since most of them deserve a separate, detailed article, but I‚Äôll leave links with the mat. </font><font style="vertical-align: inherit;">part of all thirsty.</font></font></p><br>
<p>  ,        (    HLS-),       .        -    ,    ,      .</p><br>
<p>   .    ‚Äì            .</p><br>
<p>,   ?   .</p><br>
<h3 id="ocenka-raboty-algoritma">  </h3><br>
<p>   .       /  ,       ,      -,    ,      . </p><br>
<p>    , ,    python     .        (  ,      ,      ).             (  Intersection over Union),      .</p><br>
<p>             :</p><br>
<p><img src="https://habrastorage.org/webt/ab/nn/7c/abnn7chjw4veobohpkbxo4ivxse.png"></p><br>
<p>     :</p><br>
<p><img src="https://habrastorage.org/webt/hs/q4/gi/hsq4gi-bim8ymscnun5rudlmm9o.png"></p><br>
<p>  ,        ,  ,   ,       -    . ,    ,      , :</p><br>
<p><img src="https://habrastorage.org/webt/ea/sf/5h/easf5hkcpzaj_1o90oxz2ovfnfs.png"></p><br>
<p>       (  0.6)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> ,   F1-</a>    (   ‚Äî ).</p><br>
<div class="spoiler"><b class="spoiler_title">     IoU</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple<font></font>
<font></font>
Metrics = namedtuple(<span class="hljs-string">"metrics"</span>, [<span class="hljs-string">"tp"</span>, <span class="hljs-string">"fp"</span>, <span class="hljs-string">"fn"</span>])<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bb_intersection_over_union</span>(<span class="hljs-params">a, b</span>):</span>
   <span class="hljs-comment">#           .</span>
   <span class="hljs-comment"># 0 -  X    ,</span>
   <span class="hljs-comment"># 1 -  Y    ,</span>
   <span class="hljs-comment"># 2 -  X    ,</span>
   <span class="hljs-comment"># 3 -  Y    .</span>
   x_a = max(a[<span class="hljs-number">0</span>], b[<span class="hljs-number">0</span>])<font></font>
   y_a = max(a[<span class="hljs-number">1</span>], b[<span class="hljs-number">1</span>])<font></font>
   x_b = min(a[<span class="hljs-number">2</span>], b[<span class="hljs-number">2</span>])<font></font>
   y_b = min(a[<span class="hljs-number">3</span>], b[<span class="hljs-number">3</span>])<font></font>
<font></font>
   <span class="hljs-comment">#  .</span>
   inter_area = max(<span class="hljs-number">0</span>, x_b - x_a + <span class="hljs-number">1</span>) * max(<span class="hljs-number">0</span>, y_b - y_a + <span class="hljs-number">1</span>)<font></font>
<font></font>
   <span class="hljs-comment">#  .</span>
   a_area = (a[<span class="hljs-number">2</span>] - a[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>) * (a[<span class="hljs-number">3</span>] - a[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>)<font></font>
   b_area = (b[<span class="hljs-number">2</span>] - b[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>) * (b[<span class="hljs-number">3</span>] - b[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>)<font></font>
<font></font>
   <span class="hljs-comment"># Intersection over Union.</span><font></font>
   iou = inter_area / float(a_area + b_area - inter_area)<font></font>
<font></font>
   <span class="hljs-keyword">return</span> iou<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">same_stamp</span>(<span class="hljs-params">a, b</span>):</span>
   <span class="hljs-string">""",         """</span><font></font>
   iou = bb_intersection_over_union(a, b)<font></font>
   print(<span class="hljs-string">f'iou: <span class="hljs-subst">{iou}</span>'</span>)
   <span class="hljs-keyword">return</span> iou &gt; <span class="hljs-number">0.6</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_stamps</span>(<span class="hljs-params">extracted, mapped</span>):</span>
   <span class="hljs-string">"""
    
   :param extracted: ,  .
   :param mapped:  () .
   """</span><font></font>
   tp = []<font></font>
   fp = []<font></font>
   fn = list(mapped)<font></font>
   <span class="hljs-keyword">for</span> stamp <span class="hljs-keyword">in</span> extracted:
       <span class="hljs-keyword">for</span> check <span class="hljs-keyword">in</span> fn:
           <span class="hljs-keyword">if</span> same_stamp(stamp, check):<font></font>
               tp.append(check)<font></font>
               fn.remove(check)<font></font>
               <span class="hljs-keyword">break</span>
       <span class="hljs-keyword">else</span>:<font></font>
           fp.append(stamp)<font></font>
   <span class="hljs-keyword">return</span> Metrics(len(tp), len(fp), len(fn))<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare</span>(<span class="hljs-params">file, sectors</span>):</span>
   <span class="hljs-string">"""
       .
   :param file:   .
   :param sectors:  .
   """</span>
   print(<span class="hljs-string">f'file: <span class="hljs-subst">{file}</span>'</span>)
   <span class="hljs-keyword">try</span>:<font></font>
       stamps = extract_stamps(file) <span class="hljs-comment">#  ,     .</span>
       metrics = compare_stamps(stamps, [ss <span class="hljs-keyword">for</span> ss <span class="hljs-keyword">in</span> sectors <span class="hljs-keyword">if</span> <span class="hljs-string">'stamp'</span> <span class="hljs-keyword">in</span> ss[<span class="hljs-string">'tags'</span>]])
       <span class="hljs-keyword">return</span> file, metrics
   <span class="hljs-keyword">except</span>:<font></font>
       print(sys.exc_info())<font></font>
       <span class="hljs-keyword">return</span> file, Metrics(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
   file_metrics = {}<font></font>
<font></font>
   <span class="hljs-comment"># dataset - ,            () .</span>
   <span class="hljs-keyword">for</span> file, sectors <span class="hljs-keyword">in</span> dataset.items():<font></font>
       file_metrics[file] = compare(file, sectors)<font></font>
<font></font>
   <span class="hljs-comment">#  ,   F1-.</span>
   total_metrics = Metrics(*(sum(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> zip(*file_metrics.values())))<font></font>
   precision = total_metrics.tp / (total_metrics.tp + total_metrics.fp) <span class="hljs-keyword">if</span> total_metrics.tp &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
   recall = total_metrics.tp / (total_metrics.tp + total_metrics.fn) <span class="hljs-keyword">if</span> total_metrics.tp &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
   f1 = <span class="hljs-number">2</span> * precision * recall / (precision + recall) <span class="hljs-keyword">if</span> (precision + recall) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><font></font>
<font></font>
   print(<span class="hljs-string">'precision\trecall\tf1'</span>)<font></font>
   print(<span class="hljs-string">'{:.4f}\t{:.4f}\t{:.4f}'</span>.format(precision * <span class="hljs-number">100</span>, recall * <span class="hljs-number">100</span>, f1 * <span class="hljs-number">100</span>).replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">','</span>))<font></font>
   print(<span class="hljs-string">'tp\tfp\tfn'</span>)<font></font>
   print(<span class="hljs-string">'{}\t{}\t{}'</span>.format(total_metrics.tp, total_metrics.fp, total_metrics.fn))<font></font>
<font></font>
   print(<span class="hljs-string">'tp\tfp\tfn'</span>)
   <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> dataset.keys():<font></font>
       metric = file_metrics.get(file)<font></font>
       print(<span class="hljs-string">f'<span class="hljs-subst">{metric.tp}</span>\t<span class="hljs-subst">{metric.fp}</span>\t<span class="hljs-subst">{metric.fn}</span>'</span>)<font></font>
<font></font>
   print(<span class="hljs-string">f'precision: <span class="hljs-subst">{precision}</span>, recall: <span class="hljs-subst">{recall}</span>, f1: <span class="hljs-subst">{f1}</span>, <span class="hljs-subst">{total_metrics}</span>'</span>)</code></pre></div></div><br>
<h3 id="hls-segmentaciya">HLS-</h3><br>
<p>    ()      -   .   ,      .       (<em>  </em>):</p><br>
<p><img src="https://habrastorage.org/webt/vz/lc/72/vzlc72vx0p3izy6zgnm5ygss4z4.jpeg"></p><br>
<p>    .</p><br>
<p>  HLS .     Hue, Lightness, Saturation,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>.      :</p><br>
<p><img src="https://habrastorage.org/webt/ou/qx/5n/ouqx5n_do_-chltc10lfnabwxss.png"></p><br>
<p>       ?       -       .        ,     ~180  ~280.</p><br>
<p><img src="https://habrastorage.org/webt/g2/bo/g3/g2bog35vzpxfewky6jsaif_ovug.png"></p><br>
<p>      ,        -   ,   ,         . </p><br>
<div class="spoiler"><b class="spoiler_title">  (Python)</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">colored_mask</span>(<span class="hljs-params">img, threshold = <span class="hljs-number">-1</span></span>):</span>
   <span class="hljs-comment">#     .</span>
   denoised = cv2.medianBlur(img, <span class="hljs-number">3</span>)<font></font>
   cv2.imwrite(<span class="hljs-string">'denoised.bmp'</span>, denoised)<font></font>
<font></font>
   <span class="hljs-comment">#      .</span><font></font>
   gray = cv2.cvtColor(denoised, cv2.COLOR_BGR2GRAY)<font></font>
   cv2.imwrite(<span class="hljs-string">'gray.bmp'</span>, gray)<font></font>
<font></font>
   <span class="hljs-comment">#    .</span>
   adaptiveThreshold = threshold <span class="hljs-keyword">if</span> threshold &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> cv2.mean(img)[<span class="hljs-number">0</span>]<font></font>
   color = cv2.cvtColor(denoised, cv2.COLOR_BGR2HLS)<font></font>
   mask = cv2.inRange(color, (<span class="hljs-number">0</span>, int(adaptiveThreshold / <span class="hljs-number">6</span>), <span class="hljs-number">60</span>), (<span class="hljs-number">180</span>, adaptiveThreshold, <span class="hljs-number">255</span>))<font></font>
<font></font>
   <span class="hljs-comment">#     .</span><font></font>
   dst = cv2.bitwise_and(gray, gray, mask=mask)<font></font>
   cv2.imwrite(<span class="hljs-string">'colors_mask.bmp'</span>, dst)
   <span class="hljs-keyword">return</span> dst</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">  (C#)</b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ColoredMask</span>(<span class="hljs-params">Mat src, Mat dst, <span class="hljs-keyword">double</span> threshold = <span class="hljs-number">-1</span></span>)</span><font></font>
{<font></font>
 <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> gray = <span class="hljs-keyword">new</span> Mat())
 <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> color = <span class="hljs-keyword">new</span> Mat())
 <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> mask = <span class="hljs-keyword">new</span> Mat())
 <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> denoised = <span class="hljs-keyword">new</span> Mat())<font></font>
 {<font></font>
   <span class="hljs-comment">//     .</span>
   Cv2.MedianBlur(src, denoised, <span class="hljs-number">3</span>);<font></font>
  denoised.Save(<span class="hljs-string">"colors_denoised.bmp"</span>);<font></font>
<font></font>
   <span class="hljs-comment">//      .</span><font></font>
   Cv2.CvtColor(denoised, gray, ColorConversionCodes.BGR2GRAY);<font></font>
   gray.Save(<span class="hljs-string">"colors_gray.bmp"</span>);<font></font>
<font></font>
   <span class="hljs-comment">//    .</span>
   <span class="hljs-keyword">var</span> adaptiveThreshold = threshold &lt; <span class="hljs-number">0</span> ? src.Mean()[<span class="hljs-number">0</span>] : threshold;<font></font>
   Cv2.CvtColor(denoised, color, ColorConversionCodes.BGR2HLS);<font></font>
   Cv2.InRange(color, <span class="hljs-keyword">new</span> Scalar(<span class="hljs-number">0</span>, adaptiveThreshold / <span class="hljs-number">6</span>, <span class="hljs-number">60</span>), <span class="hljs-keyword">new</span> Scalar(<span class="hljs-number">180</span>, adaptiveThreshold, <span class="hljs-number">255</span>), mask);<font></font>
<font></font>
   <span class="hljs-comment">//     .</span><font></font>
   Cv2.BitwiseAnd(gray, gray, dst, mask);<font></font>
   dst.Save(<span class="hljs-string">"colors_mask.bmp"</span>);<font></font>
 }<font></font>
}</code></pre></div></div><br>
<p>       :</p><br>
<p><img src="https://habrastorage.org/webt/9d/k-/c2/9dk-c2hxeixjye7lkyqm4k9yb8k.png"></p><br>
<p>    ,    HLS  OpenCV     0  360,   0  180.   ‚Äî       uint8/uchar/byte,     0  255,    360  2.</p><br>
<h3 id="poisk-okruzhnostey"> </h3><br>
<p>,   ,   ?     ,   ,    ‚Äú  ‚Äù.</p><br>
<p>        ,          . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a> (    )        ,   ,    ‚Äî   .    ,       .</p><br>
<p> ,  ,     .   OpenCV   ,          ,    .   ,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a>,    .</p><br>
<div class="spoiler"><b class="spoiler_title">     (Python)</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"># mask - ,   ;</span>
<span class="hljs-comment"># method:    ( OpenCV   Gradient);</span>
<span class="hljs-comment"># dp: ,      (1 ‚Äî    , 2 ‚Äî  /  ..     (..  ),   ‚Äú‚Äù   - ,     .   ,   ‚Äú‚Äù    );</span>
<span class="hljs-comment"># minDist:     (  %   );</span>
<span class="hljs-comment"># param1:   ,     (     2  );</span>
<span class="hljs-comment"># param2:     ;</span>
<span class="hljs-comment"># minRadius:   ;</span>
<span class="hljs-comment"># maxRadius:   ;</span>
circles = cv2.HoughCircles(mask, cv2.HOUGH_GRADIENT, <span class="hljs-number">1</span>, <span class="hljs-number">20</span>, param1, param2, minRadius, maxRadius)<font></font>
<font></font>
<span class="hljs-comment">#   .</span><font></font>
circles = np.uint16(np.around(circles))<font></font>
cimg = cv2.cvtColor(img,cv2.COLOR_GRAY2BGR)<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> circles[<span class="hljs-number">0</span>,:]:<font></font>
    cv2.circle(cimg,(i[<span class="hljs-number">0</span>],i[<span class="hljs-number">1</span>]),i[<span class="hljs-number">2</span>],(<span class="hljs-number">165</span>,<span class="hljs-number">25</span>,<span class="hljs-number">165</span>),<span class="hljs-number">2</span>)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">     (C#)</b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment">// mask - ,   ;</span>
<span class="hljs-comment">// method:    ( OpenCV   Gradient);</span>
<span class="hljs-comment">// dp: ,      (1 ‚Äî    , 2 ‚Äî  /  ..     (..  ),   ‚Äú‚Äù   - ,     .   ,   ‚Äú‚Äù    );</span>
<span class="hljs-comment">// minDist:     (  %   );</span>
<span class="hljs-comment">// param1:   ,     (     2  );</span>
<span class="hljs-comment">// param2:     ;</span>
<span class="hljs-comment">// minRadius:   ;</span>
<span class="hljs-comment">// maxRadius:   ;</span>
<span class="hljs-keyword">var</span> houghCircles = Cv2.HoughCircles(morphed, HoughMethods.Gradient, <span class="hljs-number">1</span>, max, cannyEdgeThreshold, houghThreshold, min, max);<font></font>
<font></font>
<span class="hljs-comment">//   .</span>
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> circle <span class="hljs-keyword">in</span> houghCircles)<font></font>
 Cv2.Circle(morphed, circle.Center, (<span class="hljs-keyword">int</span>)circle.Radius, <span class="hljs-keyword">new</span> Scalar(<span class="hljs-number">165</span>, <span class="hljs-number">25</span>, <span class="hljs-number">165</span>), <span class="hljs-number">2</span>);</code></pre></div></div><br>
<p>    :</p><br>
<p><img src="https://habrastorage.org/webt/qw/eu/uc/qweuucfjdtoefrmtyvdxoj0wazy.png"></p><br>
<p>   ,    ,   .      ,  ,    . ,         ,     ,   .         (-  ‚Äú‚Äù   -      , -    ).</p><br>
<h3 id="filtraciya"></h3><br>
<p>     -    .     . </p><br>
<p>   ,      ,     .        ‚Äú‚Äù  ,  ,        .   ‚Äî  , .</p><br>
<p><img src="https://habrastorage.org/webt/io/zw/gq/iozwgqabifnjlswodk0obpowtfc.png"></p><br>
<p>   ,     ,      ,   .     .     ,       .    ‚Äú‚Äù     .</p><br>
<div class="spoiler"><b class="spoiler_title">   (Python)</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">equals</span>(<span class="hljs-params">first, second, epsilon</span>):</span><font></font>
   diff = cv2.subtract(first, second)<font></font>
   nonZero = cv2.countNonZero(diff)<font></font>
   area = first.size * epsilon<font></font>
   <span class="hljs-keyword">return</span> nonZero &lt;= area<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> circles[<span class="hljs-number">0</span>, :]:<font></font>
   empty = np.zeros((<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, <span class="hljs-number">1</span>), dtype=<span class="hljs-string">"uint8"</span>)<font></font>
   cv2.circle(empty, (i[<span class="hljs-number">0</span>], i[<span class="hljs-number">1</span>]), i[<span class="hljs-number">2</span>], (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), <span class="hljs-number">-1</span>)<font></font>
   crop = img * (empty.astype(img.dtype))<font></font>
<font></font>
   cv2.imwrite(<span class="hljs-string">'crop.bmp'</span>, crop)<font></font>
<font></font>
   <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> equals(crop, empty, threshold):<font></font>
       result.append(i)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">   (C#)</b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> circle <span class="hljs-keyword">in</span> circles)<font></font>
{<font></font>
  <span class="hljs-keyword">var</span> x = (<span class="hljs-keyword">int</span>) circle.Center.X;
  <span class="hljs-keyword">var</span> y = (<span class="hljs-keyword">int</span>) circle.Center.Y;
  <span class="hljs-keyword">var</span> radius = (<span class="hljs-keyword">int</span>) Math.Floor(circle.Radius);<font></font>
<font></font>
  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> empty = Mat.Zeros(src.Rows, src.Cols, MatType.CV_8UC1))
  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> mask = empty.ToMat())
  <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> crop = <span class="hljs-keyword">new</span> Mat())<font></font>
  {<font></font>
    <span class="hljs-comment">//   ()   .</span>
    Cv2.Circle(mask, x, y, radius, Scalar.White, <span class="hljs-number">-1</span>);<font></font>
    src.CopyTo(crop, mask);<font></font>
<font></font>
    crop.Save(<span class="hljs-string">"crop.bmp"</span>);<font></font>
<font></font>
    <span class="hljs-comment">//    .</span>
    <span class="hljs-keyword">if</span> (!MatEquals(crop, empty, threshold))<font></font>
    result.Add(circle);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">MatEquals</span>(<span class="hljs-params">Mat a, Mat b, <span class="hljs-keyword">double</span> epsilon = <span class="hljs-number">0.0</span></span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> notEquals = a.NotEquals(b);
  <span class="hljs-keyword">var</span> nonZero = Cv2.CountNonZero(notEquals);
  <span class="hljs-keyword">var</span> area = a.Rows * epsilon * a.Cols;
  <span class="hljs-keyword">return</span> nonZero &lt;= area;<font></font>
}</code></pre></div></div><br>
<p>       .     , ,   ,      -       ? </p><br>
<p>         ,         ‚Äì ,   ‚Äì   (minor)    (major) (     ,        ,      ).</p><br>
<p><img src="https://habrastorage.org/webt/01/qn/in/01qniniaa9l98w-6hcmrie5c9q0.png"></p><br>
<p>   : ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>,         ,       .</p><br>
<p>  ()   ,      ,  voila ‚Äì    .</p><br>
<p><img src="https://habrastorage.org/webt/oo/_u/6w/oo_u6wwv6n7jwpgjfbc4bqiib7i.png"></p><br>
<p><em>  ‚Äì  ,  ‚Äì    ,  ‚Äì    ,  ‚Äì  ,      .</em></p><br>
<div class="spoiler"><b class="spoiler_title">       (Python)</b><div class="spoiler_text"><pre><code class="python hljs">segments = []<font></font>
contours, hierarchy = cv2.findContours(img, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)<font></font>
<span class="hljs-keyword">for</span> contour <span class="hljs-keyword">in</span> contours:
   <span class="hljs-keyword">if</span> contour.shape[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">5</span>:
       <span class="hljs-keyword">continue</span><font></font>
<font></font>
   ellipse = cv2.fitEllipse(contour)<font></font>
   width = ellipse[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]<font></font>
   height = ellipse[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]<font></font>
   minor = min(width, height)<font></font>
   major = max(width, height)<font></font>
<font></font>
   <span class="hljs-keyword">if</span> minor / <span class="hljs-number">2</span> &gt; minorMin <span class="hljs-keyword">and</span> major / <span class="hljs-number">2</span> &lt; majorMax:<font></font>
       r1 = math.fabs(<span class="hljs-number">1</span> - math.fabs(major - minor) / max(minor, major))<font></font>
       cv2.ellipse(src, ellipse, (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">3</span>)<font></font>
<font></font>
       <span class="hljs-keyword">if</span> r1 &gt; roundness:<font></font>
           segments.append((ellipse[<span class="hljs-number">0</span>], major / <span class="hljs-number">2</span>))<font></font>
           cv2.ellipse(src, ellipse, (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>), <span class="hljs-number">3</span>)
   <span class="hljs-keyword">else</span>: cv2.ellipse(src, ellipse, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">1</span>)<font></font>
<font></font>
cv2.imwrite(<span class="hljs-string">'test_res.bmp'</span>, src)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">   (Python)</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">distance</span>(<span class="hljs-params">p1, p2</span>):</span>
   <span class="hljs-keyword">return</span> math.sqrt(math.pow(p2[<span class="hljs-number">0</span>] - p1[<span class="hljs-number">0</span>], <span class="hljs-number">2</span>) + math.pow(p2[<span class="hljs-number">1</span>] - p1[<span class="hljs-number">1</span>], <span class="hljs-number">2</span>))<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">isNested</span>(<span class="hljs-params">inner, outer, epsilon</span>):</span>
   distance = distance(inner[<span class="hljs-number">0</span>], outer[<span class="hljs-number">0</span>])<font></font>
   radius = outer[<span class="hljs-number">1</span>] * epsilon
   <span class="hljs-keyword">return</span> distance &lt; radius <span class="hljs-keyword">and</span> inner[<span class="hljs-number">1</span>] &lt; radius - distance<font></font>
<font></font>
nested = []<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> inner:
   <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> outer:
       <span class="hljs-keyword">if</span> (isNested(i, o, <span class="hljs-number">1.3</span>)):
           <span class="hljs-keyword">if</span> (distance(i[<span class="hljs-number">0</span>], i[<span class="hljs-number">1</span>]) &lt; <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> i[<span class="hljs-number">1</span>] / o[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0.75</span>):<font></font>
               nested.append(i)<font></font>
           <span class="hljs-keyword">else</span>: nested.append(o)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">       (C#)</b><div class="spoiler_text"><pre><code class="cs hljs">Cv2.FindContours(src, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> contours, hierarchy, RetrievalModes.External, ContourApproximationModes.ApproxSimple);
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> contour <span class="hljs-keyword">in</span> contours)<font></font>
  {<font></font>
    <span class="hljs-comment">//      5 .</span>
    <span class="hljs-keyword">if</span> (contour.Height &lt; <span class="hljs-number">5</span>)
    <span class="hljs-keyword">continue</span>;<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ellipse = Cv2.FitEllipse(contour);
    <span class="hljs-keyword">var</span> minor = Math.Min(ellipse.Size.Width, ellipse.Size.Height);
    <span class="hljs-keyword">var</span> major = Math.Max(ellipse.Size.Width, ellipse.Size.Height);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (minor / <span class="hljs-number">2</span> &gt; minorSize &amp;&amp; major / <span class="hljs-number">2</span> &lt; majorSize)<font></font>
    {<font></font>
    <span class="hljs-comment">//     .   ,      .</span>
    <span class="hljs-keyword">var</span> r1 = Math.Abs(<span class="hljs-number">1</span> - Math.Abs(major - minor) / Math.Max(minor, major));
    <span class="hljs-keyword">if</span> (r1 &gt; roundness)<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> circle = <span class="hljs-keyword">new</span> CircleSegment(ellipse.Center, major / <span class="hljs-number">2</span>);<font></font>
        segments.Add(circle);<font></font>
    }<font></font>
    }<font></font>
    contour.Dispose();<font></font>
  }<font></font>
}</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">   (C#)</b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsCirclesNested</span>(<span class="hljs-params">CircleSegment inner, CircleSegment outer, <span class="hljs-keyword">double</span> epsilon</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">var</span> distance = inner.Center.DistanceTo(outer.Center);
  <span class="hljs-keyword">var</span> secondRadius = outer.Radius * epsilon;
  <span class="hljs-keyword">return</span> distance &lt; secondRadius &amp;&amp; inner.Radius &lt; secondRadius - distance;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">var</span> nested = <span class="hljs-keyword">new</span> List&lt;CircleSegment&gt;();
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> inner)
<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> o <span class="hljs-keyword">in</span> outer)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (IsCirclesNested(i, o, <span class="hljs-number">1.3</span>))<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span> (i.Center.DistanceTo(o.Center) &lt; <span class="hljs-number">30</span> &amp;&amp;<font></font>
        i.Radius / o.Radius &gt; <span class="hljs-number">0.75</span>)<font></font>
    nested.Add(i);<font></font>
    <span class="hljs-keyword">else</span> nested.Add(o);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> outer.Union(inner).Except(nested).ToList();</code></pre></div></div><br>
<p>  ,     ,    ,  .         .       ‚Äî  ,      .</p><br>
<p>        ‚Äú ‚Äù,         ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">- </a>.      ‚Äú    ‚Äù?     ‚Äú‚Äù .  ?    ,   -   .   :</p><br>
<p><img src="https://habrastorage.org/webt/uf/1p/jy/uf1pjyqiflqf2fkigkhqkenxduq.jpeg"></p><br>
<p>,  ,    :      ,    ,    .   :</p><br>
<p><img src="https://habrastorage.org/webt/a0/x4/qz/a0x4qz7ced9vgvksahdnkvbab6c.jpeg"></p><br>
<p>    ‚Äî    X  Y              ,      X,      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a>,   ,     ,    .</p><br>
<p><img src="https://habrastorage.org/webt/xt/hi/yy/xthiyys8euwaeosqi7z7e8mcjgw.jpeg"></p><br>
<p>    ‚Äî   ,        ,         ( ). ,      ,    ( ,      ,    ,  ).</p><br>
<p>     ,      ,   .  ( )    90      .</p><br>
<div class="spoiler"><b class="spoiler_title">     (Python)</b><div class="spoiler_text"><pre><code class="python hljs">maxRadius = math.sqrt(math.pow(src.shape[<span class="hljs-number">0</span>], <span class="hljs-number">2</span>) + math.pow(src.shape[<span class="hljs-number">1</span>], <span class="hljs-number">2</span>)) / <span class="hljs-number">2</span>
magnitude = src.shape[<span class="hljs-number">0</span>] / math.log(maxRadius)<font></font>
center = (src.shape[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>, src.shape[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>)<font></font>
polar = cv2.logPolar(src, center, magnitude, cv2.INTER_AREA)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">     (C#)</b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">var</span> maxRadius = Math.Sqrt(Math.Pow(stampImage.Width, <span class="hljs-number">2</span>) + Math.Pow(stampImage.Height, <span class="hljs-number">2</span>)) / <span class="hljs-number">2</span>;
<span class="hljs-keyword">var</span> magnitude = stampImage.Width / Math.Log(maxRadius);
<span class="hljs-keyword">var</span> center = <span class="hljs-keyword">new</span> Point2f(stampImage.Width / <span class="hljs-number">2</span>, stampImage.Height / <span class="hljs-number">2</span>);<font></font>
Cv2.LogPolar(stampImage, cartesianImage, center, magnitude, InterpolationFlags.Area);</code></pre></div></div><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>,         ,   OpenCV‚Äô    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>. ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>, , ,       OpenCV.   ,      .</p><br>
<p>         :</p><br>
<p><img src="https://habrastorage.org/webt/mu/eq/b3/mueqb3cm4bjob3ubkj3hkd3vafk.jpeg"></p><br>
<p>,  ,           90 ,        .</p><br>
<div class="spoiler"><b class="spoiler_title">     (Python)</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment">#  .</span>
sobel = cv2.Sobel(polar, cv2.CV_16S, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<font></font>
kernel = cv2.getStructuringElement(shape=cv2.MORPH_RECT, ksize=(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<font></font>
img = cv2.convertScaleAbs(sobel)<font></font>
img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<font></font>
img = cv2.threshold(img, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, cv2.THRESH_BINARY + cv2.THRESH_OTSU)[<span class="hljs-number">1</span>]<font></font>
img = cv2.morphologyEx(img, cv2.MORPH_OPEN, kernel)<font></font>
img = cv2.morphologyEx(img, cv2.MORPH_CLOSE, kernel)<font></font>
<font></font>
<span class="hljs-comment">#   .</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_vertical</span>(<span class="hljs-params">img_src, line</span>):</span>
   tolerance = <span class="hljs-number">10</span>
   coords = line[<span class="hljs-number">0</span>]<font></font>
   angle = math.atan2(coords[<span class="hljs-number">3</span>] - coords[<span class="hljs-number">1</span>], coords[<span class="hljs-number">2</span>] - coords[<span class="hljs-number">0</span>]) * <span class="hljs-number">180.0</span> / math.pi<font></font>
   edge = img_src.shape[<span class="hljs-number">0</span>] * <span class="hljs-number">0.66</span>
   out_of_bounds = coords[<span class="hljs-number">0</span>] &lt; edge <span class="hljs-keyword">and</span> coords[<span class="hljs-number">2</span>] &lt; edge
   <span class="hljs-keyword">return</span> math.fabs(<span class="hljs-number">90</span> - math.fabs(angle)) &lt;= tolerance <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> out_of_bounds<font></font>
<font></font>
lines = cv2.HoughLinesP(img, <span class="hljs-number">1</span>, math.pi / <span class="hljs-number">180</span>, <span class="hljs-number">15</span>, img.shape[<span class="hljs-number">0</span>] / <span class="hljs-number">5</span>, <span class="hljs-number">10</span>)<font></font>
vertical = [line <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines <span class="hljs-keyword">if</span> is_vertical(img, line)]<font></font>
correct_lines = len(vertical)</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title">     (C#)</b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment">//  .</span>
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> sobel = <span class="hljs-keyword">new</span> Mat())
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> kernel = Cv2.GetStructuringElement(MorphShapes.Rect, <span class="hljs-keyword">new</span> Size(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)))<font></font>
{<font></font>
  Cv2.Sobel(img, sobel, MatType.CV_16S, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<font></font>
  Cv2.ConvertScaleAbs(sobel, img);<font></font>
  Cv2.Threshold(img, img, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>, ThresholdTypes.Binary | ThresholdTypes.Otsu);<font></font>
  Cv2.MorphologyEx(img, img, MorphTypes.Open, kernel);<font></font>
  Cv2.MorphologyEx(img, img, MorphTypes.Close, kernel);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//   .</span>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">AlmostVerticalLine</span>(<span class="hljs-params">LineSegmentPoint line</span>)</span><font></font>
{<font></font>
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> tolerance = <span class="hljs-number">10</span>;
  <span class="hljs-keyword">var</span> angle = Math.Atan2(line.P2.Y - line.P1.Y, line.P2.X - line.P1.X) * <span class="hljs-number">180.0</span> / Math.PI;
  <span class="hljs-keyword">var</span> edge = edges.Width * <span class="hljs-number">0.66</span>;
  <span class="hljs-keyword">var</span> outOfBounds = line.P1.X &lt; edge &amp;&amp; line.P2.X &lt; edge;
  <span class="hljs-keyword">return</span> Math.Abs(<span class="hljs-number">90</span> - Math.Abs(angle)) &lt;= tolerance &amp;&amp; !outOfBounds;<font></font>
}<font></font>
<span class="hljs-keyword">var</span> lines = Cv2.HoughLinesP(img, <span class="hljs-number">1</span>, Math.PI / <span class="hljs-number">180</span>, <span class="hljs-number">15</span>, img.Width / <span class="hljs-number">5</span>, <span class="hljs-number">10</span>);
<span class="hljs-keyword">var</span> correctLinesCount = lines.Count(AlmostVerticalLine);</code></pre></div></div><br>
<p>       ,         85%.     :</p><br>
<ul>
<li>      (       ,    );</li>
<li>      (         ‚Äî     );</li>
<li>     , ,      ;</li>
<li>       ,   .</li>
</ul><br>
<p>,       ‚Äî ‚Äú  ?‚Äù.  :</p><br>
<ul>
<li>    ;</li>
<li>      (   );</li>
<li>   ;</li>
<li> .</li>
</ul><br>
<p>    ,    ,    , .   OpenCV          ,       .      U-Net,      OpenCV  ,     .</p></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486454/index.html">Introducing the Web Animations API</a></li>
<li><a href="../en486456/index.html">Censorship in the .NET Framework Source Code</a></li>
<li><a href="../en486460/index.html">Interface Bikes Toxic Grandfather. ‚ÄúExplore it!‚Äù (s1 e1)</a></li>
<li><a href="../en486462/index.html">Amateur rocket science, how I make rockets and my mistakes I learn from (part 1)</a></li>
<li><a href="../en486472/index.html">The most detailed images of the surface of the sun</a></li>
<li><a href="../en486478/index.html">Connecting Multifactor Authentication Multifactor in .NET Core</a></li>
<li><a href="../en486480/index.html">Waymo Robocars (Google) start delivering packages in Phoenix, USA</a></li>
<li><a href="../en486482/index.html">Unique faces: counting visitors, searching for outsiders, identification in recognition systems</a></li>
<li><a href="../en486484/index.html">Novel Coronavirus nCOV / 2019-nCoV / NCP / COVID19: Forecasts, Statistics, Protection, News [4th reprint, rev.07.03]</a></li>
<li><a href="../en486488/index.html">Sivelkiriya Operating System: Introductory Description</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>