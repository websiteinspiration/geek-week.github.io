<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧝🏾 🙏🏿 🔽 AWS Lambda in Action in Java 11.サーバーレスから本番環境へ 🤞🏿 🌴 👩🏽‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事は、簡単な例でAWS Lambdaをすばやく簡単に使い始める方法に関するガイドです。Lambdaをまったく使用しなかった開発者と、サーバーレスアプリケーションを開発するための別のビジョンを評価するクラウドを知っている開発者の両方に適しています。
 
 
 
 
 前書き
 みなさん、こんにち...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>AWS Lambda in Action in Java 11.サーバーレスから本番環境へ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dins/blog/486648/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事は、簡単な例でAWS Lambdaをすばやく簡単に使い始める方法に関するガイドです。</font><font style="vertical-align: inherit;">Lambdaをまったく使用しなかった開発者と、サーバーレスアプリケーションを開発するための別のビジョンを評価するクラウドを知っている開発者の両方に適しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bd/y8/lu/bdy8luzeox9qq09msokx8yzoba4.jpeg" alt="画像"><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
みなさん、こんにちは。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の名前はAlexander Gruzdevです。DINSのJava Team Leadです。私は2年以上にわたり、AWSインフラストラクチャと密接に連携しており、AWS用のアプリケーションの作成とこれらのアプリケーションのデプロイの両方の経験を持っています。私の作業では、ElasticBeanstalk、ECS、Fargate、EKS、そしてもちろんAWS Lambdaを使用する必要がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのサービスはそれぞれ独自の点で優れており、この記事の枠組みの中で、AWS Lambdaのみを他のすべてのオプションの代わりとして使用することはお勧めしません。 Lambdaを使い始めるのがいかに簡単か、そしてどのような場合にLambdaを使用するメリットが得られるかをお見せしたいと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者からマネージャーまで、誰もが顧客に変更を提供するための明確なプロセスを望んでいます。</font><font style="vertical-align: inherit;">このパスがより透明で、必要な労力が少ないほど、収益性が高くなります。</font><font style="vertical-align: inherit;">ほとんどの場合、開発者とテスターは、アプリケーションが展開される場所、選択するハードウェアの一部、レプリカを配置するリージョンなどを知りたくありません。</font><font style="vertical-align: inherit;">次の図では、「サービス」としての「aaS」クラスのサービスを確認できます。AWSLambdaはFaaSカテゴリを表します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z8/nj/wl/z8njwlqjrgatljwptthtqe9ealu.png" alt="画像"><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一言で言えばFaaS</font></font></b>
                        <div class="spoiler_text">FaaS ,            .     ,  , CRUD   C, R, U, D     Create   Read.      ,   —  .<br>
</div>
                    </div><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考え</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーレスソリューションの開発とは何かを示すために、かなり平凡な例を取り上げることにしました。</font><font style="vertical-align: inherit;">メールや電話を残して、後で回答するための質問をすることができる多くのサイトで、お問い合わせフィードバックフォームをご覧になったと思います。</font><font style="vertical-align: inherit;">下の画面、フォームはスーパーではありませんが、この記事の主題はマテリアルデザインではありません。</font></font><br>
<img src="https://habrastorage.org/webt/gv/5g/iv/gv5givju7glj8vftkb1cdhupdiw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このフォームに記入することにより、潜在的な顧客はあなたからの電話または手紙を待っています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたが必要とする技術的な側面から：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォームからデータベースにデータを保存します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">質問に答えるエージェントに手紙を送ってください。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おそらく、エージェントが同じデータベース（記事の範囲には含まれていません）に基づいて完了した作業をマークする別のサービスを作成します。</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アイデアの実装は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建築</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装時に最初に頭に浮かぶのは、必要なものです。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背面、前面、画像などの下のマシン、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベース付き車</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メールサービス付きのマシン。</font></font></li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/9a/7h/83/9a7h83iyieeicpht4-bcwy8l-ja.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
裏側と台座は、適切な方法で複製する必要がありますが、ミニストアでこれを行うと、このフォームへの負荷は最小限になります。</font><font style="vertical-align: inherit;">したがって、これらすべてのマシンを1つに組み合わせて、1つのセットに展開できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、サーバーレスを検討しているので、完全にサーバーレスコンポーネントでアーキテクチャを構築しましょう。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どのように有望なサーバーレスが聞こえるとしても、サーバーはまだここにあると私たちは皆理解しています。</font><font style="vertical-align: inherit;">そして今、あなたは自分でできる雑用をすることができるそのクラウド作業。</font><font style="vertical-align: inherit;">しかし、そのようなサーバーレスコンポーネントのみを使用してみましょう</font></font><br>
<img src="https://habrastorage.org/webt/mf/iw/6i/mfiw6if-6nlss4pl-brkgxenxuc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。図は、各コンポーネントの機能の非常に明確な分離を示しています。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambdaは、コード/ロジックを含むメインコンポーネントです。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3は静的リソースとJSスクリプトの保存を担当し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CloudFront-キャッシングメカニズムとマルチリージョンサポート</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SES-メールサービス、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DynamoDB-フォームからのデータを保存するためのベース（誰から、どの質問、どこに回答を送信するか）、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gateway API-ラムダ用のHTTP API、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route53-美しいドメイン名を追加したい場合に必要です。</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのコンポーネントのすべてが記事を引き延ばさないようにするためだけに、次のガイドで使用されるわけではありません。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Route53とCloudFrontは、個別に読むことができるかなり単純なコンポーネントです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちにそのような解決策を与える小さなネタバレ：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EC2マシンのサポートは廃止され、sshによるデバッグは行われません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">簡単な構成：ワンクリックでスロットル/キャッシング/アクセスを構成し、</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクセスポリシーをサポート：権限を制限してアクセスを許可</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぐに使えるロギング/モニタリング</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用したリソース/リクエストに対してのみ支払います。</font></font></li>
</ul><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デモ</font></font></h1><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トレーニング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーレスソリューションの開発を開始するには、次の要件を満たす必要があります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブなAWSアカウント</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-cli</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サムクリ</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gradle</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のツールをすべてインストールしたら、AWSへのリモートアクセス用にaws-cliを設定する必要があります。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示に</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">従って</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これには、新しいユーザーを作成し、アクセスキーとシークレットキーをアンロードする必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトアセンブリ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.テンプレートからプロジェクトを作成する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来のプロジェクトのディレクトリを開き、そこからSAM CLIを起動します。</font><font style="vertical-align: inherit;">指示に従ってください：</font></font><br>
<img src="https://habrastorage.org/webt/kn/gu/7f/kngu7fr3q_h_7t7bq-ygr7baccs.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：SAM-CLIのバージョンによっては、コマンドが若干異なる場合がありますが、すべて直感的です。</font><font style="vertical-align: inherit;">上記で使用したものに最も類似したものを選択してください。</font><font style="vertical-align: inherit;">Gradleが適切でない場合は、別のビルドツールを選択することもできます。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクト「Hello、World！」</font><font style="vertical-align: inherit;">準備ができています。</font><font style="vertical-align: inherit;">これで、プロジェクトとパッケージの名前、依存関係、ソースコードを操作できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.中毒に対処しましょう</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の依存関係をbuild.gradleに追加します。</font></font><br>
<pre><code class="javascript hljs">dependencies {
    <span class="hljs-comment">// AWS</span>
    implementation group: <span class="hljs-string">'com.amazonaws.serverless'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-serverless-java-container-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.4'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.2.0'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-ses'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-java-sdk-dynamodb'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.11.670'</span>
    implementation group: <span class="hljs-string">'com.amazonaws'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'aws-lambda-java-log4j2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'1.1.0'</span><font></font>
<font></font>
    <span class="hljs-comment">// Utils</span>
    implementation group: <span class="hljs-string">'com.fasterxml.jackson.core'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'jackson-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.10.0'</span>
    implementation group: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'commons-io'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.6'</span><font></font>
<font></font>
    <span class="hljs-comment">// Test</span>
    testImplementation group: <span class="hljs-string">'org.mockito'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'mockito-core'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'3.1.0'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-api-mockito2'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'org.powermock'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'powermock-module-junit4'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.4'</span>
    testImplementation group: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'junit'</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">'4.12'</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主なものはAWS SDKです。</font><font style="vertical-align: inherit;">SES、DynamoDBなどの特定のサービスを使用できるようになります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.ラムダを書く</font></font></h3><br>
<ul>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RequestHandlerのテンプレートリクエストおよびレスポンスクラスをAwsProxyRequestおよびContactUsProxyResponseに変更します。</font></font></b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RequestHandler</span>&lt;<span class="hljs-title">AwsProxyRequest</span>, <span class="hljs-title">ContactUsProxyResponse</span>&gt;
...
<span class="hljs-title">public</span> <span class="hljs-title">ContactUsProxyResponse</span> <span class="hljs-title">handleRequest</span>(<span class="hljs-title">AwsProxyRequest</span> <span class="hljs-title">request</span>, <span class="hljs-title">Context</span> <span class="hljs-title">context</span>) </span></code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">  AwsClientFactory   AWS SDK-.</b>
                        <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment">/**
 * Just an util class for an eager initialization of sdk clients.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwsClientFactory</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LogManager.getLogger(AwsClientFactory.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AmazonSimpleEmailService sesClient;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DynamoDB dynamoDB;<font></font>
<font></font>
    /**<font></font>
     * AWS regions should be env variables <span class="hljs-keyword">if</span> you want to generalize the solution.<font></font>
     */<font></font>
    AwsClientFactory() {<font></font>
        LOG.debug("AWS clients factory initialization.");<font></font>
        sesClient = AmazonSimpleEmailServiceClient.builder().withRegion(Regions.EU_WEST_1).build();<font></font>
        AmazonDynamoDB dynamoDBClient = AmazonDynamoDBClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();<font></font>
        dynamoDB = <span class="hljs-keyword">new</span> DynamoDB(dynamoDBClient);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">DynamoDB <span class="hljs-title">getDynamoDB</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> dynamoDB;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function">AmazonSimpleEmailService <span class="hljs-title">getSesClient</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sesClient;<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    ObjectMapper   .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ObjectMapper OBJECT_MAPPER = <span class="hljs-keyword">new</span> ObjectMapper();
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AwsClientFactory AWS_CLIENT_FACTORY = <span class="hljs-keyword">new</span> AwsClientFactory();
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
 <span class="hljs-function"><span class="hljs-keyword">private</span> SendEmailResult <span class="hljs-title">sendEmail</span><span class="hljs-params">(ContactUsRequest contactUsRequest)</span> </span>{<font></font>
        String emailTemplate = getEmailTemplate();<font></font>
        String email = fillTemplate(emailTemplate, contactUsRequest);<font></font>
<font></font>
        SendEmailRequest sendEmailRequest =<font></font>
                <span class="hljs-keyword">new</span> SendEmailRequest(<font></font>
                        System.getenv(<span class="hljs-string">"SENDER_EMAIL"</span>),
                        <span class="hljs-keyword">new</span> Destination(List.of(System.getenv(<span class="hljs-string">"RECIPIENT_EMAIL"</span>))),
                        <span class="hljs-keyword">new</span> Message()<font></font>
                                .withSubject(<font></font>
                                        <span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(contactUsRequest.getSubject()))<font></font>
                                .withBody(<span class="hljs-keyword">new</span> Body()<font></font>
                                        .withHtml(<span class="hljs-keyword">new</span> Content()<font></font>
                                                .withCharset(UTF_8.name())<font></font>
                                                .withData(email))));<font></font>
        LOG.info(<span class="hljs-string">"Email template is ready"</span>);
        <span class="hljs-keyword">return</span> AWS_CLIENT_FACTORY.getSesClient().sendEmail(sendEmailRequest);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fillTemplate</span><span class="hljs-params">(String emailTemplate, ContactUsRequest contactUsRequest)</span> </span>{
        <span class="hljs-keyword">return</span> String.format(<font></font>
                emailTemplate,<font></font>
                contactUsRequest.getUsername(),<font></font>
                contactUsRequest.getEmail(),<font></font>
                contactUsRequest.getPhone(),<font></font>
                contactUsRequest.getQuestion());<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getEmailTemplate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> IOUtils.toString(<font></font>
                    Objects.requireNonNull(<span class="hljs-keyword">this</span>.getClass().getClassLoader()<font></font>
                                               .getResourceAsStream(<span class="hljs-string">"email_template.html"</span>)),<font></font>
                    UTF_8);<font></font>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Loading an email template failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addEmailDetailsToDb</span><span class="hljs-params">(ContactUsRequest contactUsRequest, SendEmailResult sendEmailResult)</span> </span>{<font></font>
        AWS_CLIENT_FACTORY.getDynamoDB().getTable(<span class="hljs-string">"ContactUsTable"</span>)<font></font>
                          .putItem(<span class="hljs-keyword">new</span> Item()<font></font>
                                  .withPrimaryKey(<span class="hljs-string">"Id"</span>, sendEmailResult.getMessageId())<font></font>
                                  .withString(<span class="hljs-string">"Subject"</span>, contactUsRequest.getSubject())<font></font>
                                  .withString(<span class="hljs-string">"Username"</span>, contactUsRequest.getUsername())<font></font>
                                  .withString(<span class="hljs-string">"Phone"</span>, contactUsRequest.getPhone())<font></font>
                                  .withString(<span class="hljs-string">"Email"</span>, contactUsRequest.getEmail())<font></font>
                                  .withString(<span class="hljs-string">"Question"</span>, contactUsRequest.getQuestion()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         .</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-function"><span class="hljs-keyword">private</span> ContactUsProxyResponse <span class="hljs-title">buildResponse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> statusCode, String body)</span> </span>{<font></font>
        ContactUsProxyResponse awsProxyResponse =<font></font>
                <span class="hljs-keyword">new</span> ContactUsProxyResponse();<font></font>
        awsProxyResponse.setStatusCode(statusCode);<font></font>
        awsProxyResponse.setBody(getBodyAsString(body));<font></font>
        awsProxyResponse.addHeader(CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());<font></font>
        awsProxyResponse.addHeader(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"*"</span>);
        <span class="hljs-keyword">return</span> awsProxyResponse;<font></font>
}<font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getBodyAsString</span><span class="hljs-params">(String body)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OBJECT_MAPPER.writeValueAsString(<span class="hljs-keyword">new</span> ContactUsResponseBody(body));<font></font>
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Writing ContactUsResponseBody as string failed."</span>, e);<font></font>
        }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    .      «// WARMING UP».</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
<li><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">         handleRequest()</b>
                        <div class="spoiler_text"><pre><code class="java hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ContactUsProxyResponse <span class="hljs-title">handleRequest</span><span class="hljs-params">(AwsProxyRequest request, Context context)</span> </span>{<font></font>
        LOG.info(<span class="hljs-string">"Request was received"</span>);<font></font>
        LOG.debug(getAsPrettyString(request));<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (Optional.ofNullable(request.getMultiValueHeaders()).map(headers -&gt; headers.containsKey(<span class="hljs-string">"X-WARM-UP"</span>)).orElse(FALSE)) {<font></font>
            LOG.info(<span class="hljs-string">"Lambda was warmed up"</span>);
            <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">201</span>, <span class="hljs-string">"Lambda was warmed up. V1"</span>);<font></font>
        }<font></font>
<font></font>
        ContactUsRequest contactUsRequest = getContactUsRequest(request);<font></font>
<font></font>
        SendEmailResult sendEmailResult = sendEmail(contactUsRequest);<font></font>
        LOG.info(<span class="hljs-string">"Email was sent"</span>);<font></font>
<font></font>
        addEmailDetailsToDb(contactUsRequest, sendEmailResult);<font></font>
        LOG.info(<span class="hljs-string">"DB is updated"</span>);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> buildResponse(<span class="hljs-number">200</span>,<font></font>
                String.format(<span class="hljs-string">"Message %s has been sent successfully."</span>, sendEmailResult.getMessageId()));<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
基本的なロジックは非常に単純なので、詳細に説明する価値はないと思います。注意すべき点がいくつかあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つはロギングです。 Context lambdaメソッドの引数の1つには、ロガーだけでなく多くの補助情報が含まれています。したがって、別のロガーを作成することはできませんが、提供されたラムダコンテキストを使用できます。これを行うには、使用前に呼び出すだけで十分です。</font></font><br>
<blockquote><code>LambdaLogger logger = context.getLogger(); </code></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
二つ目はウォーミングアップです。ラムダの実行可能環境を作成するのは面倒なので、JVMの起動、クラスパスのロード、コードの実行には時間がかかります。最初の呼び出しには数秒かかる場合がありますが、異なる同期APIを作成する場合は適切ではありません。そのような場合、自分でAWSに、複数のラムダインスタンスを警告する必要があることを伝えることができます。しかし、これにはラムダを呼び出す必要があります。コードの基本バージョンでこれを行うと、実際には、手紙を送信して不正確なデータをデータベースに書き込みます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを回避するために、ある種のリクエスト処理を追加して、実際のリクエストとウォームアップリクエストを区別することができます。たとえば、リクエストに特別なヘッダーを追加できます。私たちの場合、「X-WARM-UP」ヘッダーは任意の値で使用されます-これはウォームアップリクエストであり、ビジネスロジックを実行せずに何らかの応答を返すだけでよいことを理解するためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に注目したいのは、静的変数の使用です。</font><font style="vertical-align: inherit;">この場合、ステートフルなラムダインスタンスは作成されません。既存の初期化されたオブジェクトを再利用できるようにするだけです。</font><font style="vertical-align: inherit;">コードの実行中に初期化するオブジェクトが静的に変更される場合は、これがラムダへの後続の呼び出しの操作に干渉するかどうかをもう一度考えてみてください。</font><font style="vertical-align: inherit;">また、これらのオブジェクトが初期化中に環境変数を使用する場合は、それらを静的にしないでください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.テストを書く</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lambdaコードは、ほとんどの場合に使用するのと同じタイプのテストでカバーできます。</font><font style="vertical-align: inherit;">ただし、この記事がさらに拡大しないように、AWS Lambdaのテストとローカル開発に関する次の記事で、サーバーレスアプリケーションのテストについて説明します。</font><font style="vertical-align: inherit;">単体テストはすでに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用可能</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ですが</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. SAMリソースのテンプレートを作成します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラムダをローカルで作成してテストした後、これらすべてのリソースをAWSにデプロイするためのSAMテンプレートを作成する必要があります。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMについて</font></font></b>
                        <div class="spoiler_text">Serverless Application Model –     serverless .  ,      CloudFormation DSL,     –   Lambda, Gateway, DynamoDB  . . <br>
SAM, CloudFormation, Terraform –   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">IaC-</a>. SAM     Serverless-,   Terraform        . <br>
 Terraform   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">    DINS</a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際に、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAM-templateで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宣言する必要のあるリソースを見てみましょう</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS ::サーバーレス::関数</font></font></b></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
SAM initを使用してプロジェクトを作成した場合、主な機能はすでに入力されています。</font><font style="vertical-align: inherit;">しかし、ここに私の例で彼らがどのように見えるかがあります：</font></font><br>
<pre><code class="plaintext hljs">CodeUri: contact-us-function<font></font>
Handler: com.gralll.sam.App::handleRequest<font></font>
Runtime: java8<font></font>
MemorySize: 256<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、すべてが十分に明確であると思います。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CodeUri</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハンドラ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラムダのあるディレクトリです。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランタイム</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッドへのフルパス</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-MemorySize</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラムダが書き込ま</font><i><font style="vertical-align: inherit;">れ</font></i><font style="vertical-align: inherit;">ているもの自体が読み上げ</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">メモリと言えば</font></b><font style="vertical-align: inherit;">、ラムダで最大3 GBのRAMを使用できます。これは、2 CPUのリソースに対応します。つまり、CPUを個別に調整することはできず、メモリの量を増減するだけです。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
次のブロックは、展開方法を選択するために必要です。</font></font><br>
<pre><code class="plaintext hljs">AutoPublishAlias: live<font></font>
DeploymentPreference:<font></font>
  Type: Canary10Percent10Minutes<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoPublishAlias-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しくデプロイされた各バージョンに</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エイリアス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">追加</font></a><font style="vertical-align: inherit;">できます</font><font style="vertical-align: inherit;">。これは、カナリアデプロイメントを実装するために必要です。</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canary10Percent10Minutes-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ラムダの2つのバージョン（新旧のラムダ）を同時に保持できるようにするデプロイメントのタイプですが、トラフィックの10％のみを新しいものにリダイレクトします。 10分以内に問題がなければ、残りのトラフィックも新しいバージョンにリダイレクトされます。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">SAMページで</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
高度な機能の使用についての詳細を読むことができ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次は、コードから使用される環境変数です。その後、ラムダの別のブロック：</font></font><br>
<pre><code class="plaintext hljs">Events:<font></font>
  ContactUs:<font></font>
    Type: Api<font></font>
    Properties:<font></font>
      Path: /contact<font></font>
      Method: post<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その中で、ラムダを呼び出すためのトリガーを説明する必要があります。私たちの場合、これらは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Gatewayリクエストになります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、APIを説明するかなり単純化された形式ですが、新しく作成されたゲートウェイAPIがすべての</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST /連絡</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求</font><font style="vertical-align: inherit;">をラムダ</font><font style="vertical-align: inherit;">にリダイレクトするのに十分です</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、セキュリティの側面を説明する必要があります。そのままでは、作成されたラムダはデータベースにもメールサービスにもアクセスできません。したがって、何が許可されるかを明示的に規定する必要があります。</font><font style="vertical-align: inherit;">AWS内でアクセスを許可</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いくつかあります</font></a><font style="vertical-align: inherit;">。リソースベースのポリシーを使用します。</font></font><br>
<pre><code class="plaintext hljs">Policies:<font></font>
  - AWSLambdaExecute<font></font>
  - Version: '2012-10-17'<font></font>
    Statement:<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - ses:SendEmail<font></font>
          - ses:SendRawEmail<font></font>
        Resource: 'arn:aws:ses:eu-west-1:548476639829:identity/aleksandrgruzdev11@gmail.com'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:List*<font></font>
        Resource: '*'<font></font>
      - Effect: Allow<font></font>
        Action:<font></font>
          - dynamodb:Get*<font></font>
          - dynamodb:PutItem<font></font>
          - dynamodb:DescribeTable<font></font>
        Resource: 'arn:aws:dynamodb:*:*:table/ContactUsTable'<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベーステーブルには特定の名前を指定したため、同じ名前のテーブルを作成する必要があることに注意してください。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SESについて：私のメールアドレスが表示されます。あなたの場合、それはあなた自身の確認された住所でなければなりません。これを行う方法については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご覧</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その直後に、作成されたアドレスをクリックしてこのリソースのID ARNを見つけ、上記の例の電子メールに置き換えます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らは一種のラムダを考え出した。次に、データベースに移りましょう。</font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS ::サーバーレス:: SimpleTable</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このタスクでは、</font><b><i><font style="vertical-align: inherit;">ContactUsTable</font></i></b><font style="vertical-align: inherit;">テーブルを1つだけ作成します。</font></font><br>
<pre><code class="plaintext hljs">ContactUsTable:<font></font>
  Type: AWS::Serverless::SimpleTable<font></font>
  Properties:<font></font>
    PrimaryKey:<font></font>
      Name: Id<font></font>
      Type: String<font></font>
    TableName: ContactUsTable<font></font>
    ProvisionedThroughput:<font></font>
      ReadCapacityUnits: 2<font></font>
      WriteCapacityUnits: 2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必須フィールドのうち、Idのみで、ReadCapacityUnitsとWriteCapacityUnitsも示します。</font><font style="vertical-align: inherit;">これはかなり広範囲にわたるトピックでもあるため、選択する値については詳しく説明しません。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">読むことができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">テストアプリケーションの場合、1〜2程度の小さな値でも十分です。</font><font style="vertical-align: inherit;">
たとえば、関数またはAPIタイプの複数のリソースを宣言する場合、</font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グローバル</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般パラメーターをこのブロックで取り出すことができます。</font></font><br>
<pre><code class="plaintext hljs">Globals:<font></font>
  Function:<font></font>
    Timeout: 15<font></font>
  Api:<font></font>
    Cors:<font></font>
      AllowOrigin: "'*'"<font></font>
      AllowHeaders: "'Content-Type,X-WARM-UP,X-Amz-Date,Authorization,X-Api-Key'"<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを使用して関数のタイムアウトといくつかのCors設定を設定し、後でContactUsフォームを使用して静的ページからゲートウェイAPIを呼び出しました。</font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力</font></font></i></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
このブロックを使用すると、グローバルAWS CloudFormationコンテキストでいくつかの変数を動的に定義できます。</font></font><br>
<pre><code class="plaintext hljs">Outputs:<font></font>
  ContactUsApi:<font></font>
    Description: "API Gateway endpoint URL for Prod stage for ContactUs function"<font></font>
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/contact/"<font></font>
  ContactUsFunction:<font></font>
    Description: "ContactUs Lambda Function ARN"<font></font>
    Value: !GetAtt ContactUsFunction.Arn<font></font>
  ContactUsFunctionIamRole:<font></font>
    Description: "Implicit IAM Role created for ContactUs function"<font></font>
    Value: !GetAtt ContactUsFunctionRole.Arn<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、値に設定されるContactUsApi変数を、作成されたAPIエンドポイントのパブリックアドレスとして宣言しました。</font><b><font style="vertical-align: inherit;">$ {ServerlessRestApi}</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用しているため</font><font style="vertical-align: inherit;">、AWSは新しいゲートウェイAPIの一意の識別子を文字列に挿入します。その結果、CloudFormationにアクセスできるすべてのアプリケーションがこのアドレスを取得できるようになるため、サービスのURLをハードコーディングすることはできません。さて、もう1つの利点は、出力のリスト（スタックに関するメタ情報）を確認するのが非常に便利なことです。</font><font style="vertical-align: inherit;">
関数と使用可能なパラメーターの完全なリストは、</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">こちらにあります</font></a><font style="vertical-align: inherit;">。</font><b><i><font style="vertical-align: inherit;">パラメータは、</font></i></b><font style="vertical-align: inherit;"> 
上記のすべてに加えて、あなたは追加することができます</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">パラメータ</font></a><font style="vertical-align: inherit;">ブロックを</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<b><i><font style="vertical-align: inherit;"></font></i></b><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これらのオプションは、テンプレートをより用途の広いものにするのに役立ちます。</font><font style="vertical-align: inherit;">テンプレートの他のブロックでは、これらのパラメーターを参照できるため、一部の値をハードコーディングすることはできません。</font><font style="vertical-align: inherit;">たとえば、私のテンプレートには、電子メール、SES ARN、メモリ容量などがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがテンプレート全体です。</font><font style="vertical-align: inherit;">たとえば、S3バケット、その他のCloudFormationリソース、一般的な</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタムリソース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など、近くにいくつかのリソースを追加することを禁じている人はいません</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.展開に進みます</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトを組み立てるために、GradleではなくSAMを使用します。</font></font><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセンブリ</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam build<font></font>
Building resource <span class="hljs-string">'ContactUsFunction'</span><font></font>
Running JavaGradleWorkflow:GradleBuild<font></font>
Running JavaGradleWorkflow:CopyArtifacts<font></font>
<font></font>
Build Succeeded<font></font>
<font></font>
Built Artifacts  : .aws-sam\build<font></font>
Built Template   : .aws-sam\build\template.yaml<font></font>
<font></font>
Commands you can use next<font></font>
=========================<font></font>
[*] Invoke Function: sam <span class="hljs-built_in">local</span> invoke<font></font>
[*] Deploy: sam deploy –guided<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロジェクトのルートから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sam build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コマンドを</font><font style="vertical-align: inherit;">
実行すると、</font><font style="vertical-align: inherit;">クラス、依存関係、SAMテンプレートなど、必要なすべてのファイル</font><font style="vertical-align: inherit;">が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.aws-sam</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォルダーに</font><font style="vertical-align: inherit;">自動的に収集され</font><font style="vertical-align: inherit;">ます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、S3バケットを作成する必要があります。この場合、SAMはその後、収集されたすべてのアーティファクトをアップロードします。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、ブラウザーベースのAWSコンソールを介して、またはコマンドを使用して実行できます</font></font><br>
<blockquote><code>aws s3 mb s3://bucket-name</code></blockquote><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：すべてのバケットはグローバルコンテキストで作成され、すべてのアカウント間で調整されます。</font><font style="vertical-align: inherit;">そのため、誰かがすでにアカウントでバケットを作成している場合は、バケットを作成できません。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バケットの準備ができたら、次のコマンドを実行します。</font></font><br>
<blockquote><code>sam package --output-template-file packaged.yaml --s3-bucket &lt;YOUR_BACKET&gt;</code></blockquote><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ結果</font></font></b>
                        <div class="spoiler_text"><pre><code class="bash hljs">F:\aws\projects\contact-us-sam-app&gt;sam package --output-template-file packaged.yaml --s3-bucket contact-us-sam-app<font></font>
Uploading to ea0c122c06a50d9676fbf9000a80a3bf  9212768 / 9212768.0  (100.00%)<font></font>
<font></font>
Successfully packaged artifacts and wrote output template to file packaged.yaml.<font></font>
Execute the following <span class="hljs-built_in">command</span> to deploy the packaged template<font></font>
sam deploy --template-file F:\aws\projects\contact-us-sam-app\packaged.yaml --stack-name &lt;YOUR STACK NAME&gt;<font></font>
</code></pre></div>
                    </div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はcontact-us-sam-appバケットをポイントし、SAMはすべてのリソースを指定された場所にアップロードしました。</font><font style="vertical-align: inherit;">次に、SAMは、リソースを含むスタックを作成するコマンドをすでに指示しているため、決定を埋め込むことができます。</font><font style="vertical-align: inherit;">少し確定して、コマンドを実行します。</font></font><br>
<blockquote><code>sam deploy --template-file packaged.yaml --region eu-west-1 --capabilities CAPABILITY_IAM --stack-name contact-us-sam-app </code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、-- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capabilities CAPABILITY_IAM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を追加しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、CloudFormationがIAMリソースを作成できるようになります。</font><font style="vertical-align: inherit;">そうしないと、作成時にInsufficientCapabilitiesエラーが発生します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、このコマンドの作業のログです（画像はクリック可能です）。</font><font style="vertical-align: inherit;">各リソースのステータスや出力の値などの詳細は、SAM CLIの最新バージョンの1つでのみ利用可能になりました。</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/nv/7p/4z/nv7p4zreqati1wd8c8vy3ubuzcm.png"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. CloudFormationのステータスを確認する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタックがデプロイされたことを示すメッセージが表示されるまで、デプロイがコンソールで完了するまで待機できます（前の段落のデプロイコマンドのログ）。</font></font><br>
<blockquote><code>Successfully created/updated stack - contact-us-sam-app in eu-west-1</code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私たちの場合、カナリアデプロイメントモードのため、このメッセージは10分後にのみ表示されます。したがって、ブラウザコンソールを開いてスタックを監視する方が簡単です。</font></font><br>
<img src="https://habrastorage.org/webt/97/ki/k8/97kik8apukwxsvqwyvsd_wtmaqo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しばらくすると、ステータスが</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE_COMPLETE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">変わり</font><font style="vertical-align: inherit;">ます。これは、正常に完了したことを意味します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベント</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブで、</font><font style="vertical-align: inherit;">すべてのリソースのステータスを確認できます。スタックがフロップした場合、ここで詳細なエラーメッセージを見つけることができます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、次の</font><font style="vertical-align: inherit;">ようになります</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。UPDATE_FAILED-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テンプレートでゲートウェイAPIを誤って構成した場合。</font></font><br>
<img src="https://habrastorage.org/webt/ce/mh/aq/cemhaqtl6uvdmlvnr0bsvrbokok.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
[リソース]タブでは、作成されたすべてのリソースを見つけることができます。</font><font style="vertical-align: inherit;">それらの量に驚かないでください。</font><font style="vertical-align: inherit;">SAMテンプレートでは関数とデータベーステーブルのみを宣言しましたが、CloudFormationは他の多くのリソースを作成しました。</font><font style="vertical-align: inherit;">タイプを見ると、どのサービスに属しているかがわかります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIゲートウェイの場合、暗黙的に作成されました。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApi</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiDeployment</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServerlessRestApiProdStage</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ラムダ用にいくつかの追加オブジェクトが作成されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">開き</font><font style="vertical-align: inherit;">、APIのURLを見つけます。</font><font style="vertical-align: inherit;">それをコピーしてください、すぐに重宝します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8. HTML ContactUsフォーム</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
覚えているように、ContactUsフォームを作成することにしました。ローカルマシンだけでなく、なんらかの形で使用できるようにする必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンフィギュレーション</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フォーム自体については、例えば、私は最も簡単なHTMLフォームを取ることにしたとAjaxによるゲートウェイAPIの呼び出しを追加しました。</font></font><br>
<img src="https://habrastorage.org/webt/ps/e-/4h/pse-4hta3mojfuamij0dhj3bmyg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フォーム自体に加えて、デバッグと入力の簡略化のためにいくつかのボタンを追加しました：</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの設定</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -予想どおり、HTML内で指定されたデフォルトのパラメーターを置き換えます。</font></font><br>
<pre><code class="javascript hljs">$(<span class="hljs-string">"#url-input"</span>).val(<span class="hljs-string">"https://4ykskscuq0.execute-api.eu-west-1.amazonaws.com/Prod/contact"</span>);<font></font>
$(<span class="hljs-string">"#name-input"</span>).val(<span class="hljs-string">"Mike"</span>);<font></font>
$(<span class="hljs-string">"#email-input"</span>).val(<span class="hljs-string">"Mike@somemail.com"</span>);<font></font>
$(<span class="hljs-string">"#phone-input"</span>).val(<span class="hljs-string">"+79999999999"</span>);<font></font>
$(<span class="hljs-string">"#description-input"</span>).val(<span class="hljs-string">"How much does it cost?"</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはからコピーし、あなたのゲートウェイAPIへのパスに、この機能は、変更のURL入力を使用する場合は</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出力</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ホスティング</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新しいS3バケットを作成します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルを公開するオプションを選択して、HTMLファイルをバケットにロードします。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルをアップロードしたバケットに移動します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[プロパティ]に移動し、静的Webサイトホスティングをオンにして、新しく公開されたエンドポイントを確認します。</font></font></li>
</ul><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.健康診断</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準リクエスト</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
フォームへのリンクをたどって、[デフォルトに設定して送信]をクリックします。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようにして、ゲートウェイAPIを経由してAWS Lambdaへのリクエストを行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しばらくしてすべてを正しく設定すると、次のようなメッセージが表示されます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功：メッセージ0102016f28b06243-ae897a1e-b805-406b-9987-019f21547682-000000が正常に送信されました。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、メッセージが正常に配信されたことを意味します。 SAMテンプレートで指定したメールボックスを確認してください。テンプレートを変更していない場合、レターは次の形式になり</font></font><br>
<img src="https://habrastorage.org/webt/0z/wy/sv/0zwysv5ytv3uzn9fb9az7bsa6lg.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。DynamoDBを開いて、新しいエントリが表示されていることを確認することもできます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールドスタートの機能</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
送信が成功したというメッセージは、かなり長い時間が経過した後に通知されたと思います。これは、処理のリクエストを受け取ったAWS LambdaサービスがJavaアプリケーションのインスタンスを生成し始めたことに起因します。これには、オペレーティングシステムとJREを使用してコンテナーを持ち上げ、クラスパスをロードし、すべての変数を初期化し、その後で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">handleRequest（ ）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。これはコールドスタートと呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フォームに記入して送信し直してください。今回はほぼ瞬時に答えが出ましたね。最初のリクエストと2番目のリクエストの間に20〜30分以上経過した場合、結果は異なる場合があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これの理由は何ですか？また、AWS Lambdaは、ラムダを含むコンテナをすでに再利用のためにキャッシュしているという事実もあります。これにより、メソッドを開始するためのコンテキスト全体の初期化時間が短縮されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ラムダがどれだけ長くキャッシュされるかについて明確な相関関係はありませんが、一部の人々はこれ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">がRAMの選択された値に直接依存する</font></a><font style="vertical-align: inherit;">ことを実験的に発見しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。つまり、128MBのメモリを搭載したラムダは、3GBよりも長く利用できます。おそらく、ラムダが実行される領域の平均負荷など、他のパラメーターがあるかもしれませんが、これは不正確です。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、同期リクエストを使用する場合は、自分で実験してキャッシュ時間を計画してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウォーミングアップ</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
追加オプションとして、ラムダヒーターを使用できます。コードには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-WAMP-UPヘッダー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックを追加しました</font><font style="vertical-align: inherit;">。ラムダがある場合、ラムダはビジネスロジックを実行せずに応答を返すだけですが、コンテナは後続の呼び出しの準備ができています。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CloudWatchを使用して、たとえばクラウンタイマーでラムダを自分で呼び出すことができます。これは、顧客をコールドスタートに参加させたくない場合に役立ちます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTMLフォームには、リクエストにこの特別なヘッダーを追加するWarmUpモードボタンがあります。</font><font style="vertical-align: inherit;">レターの送信もデータベースへの書き込みも行われていないことを確認できますが、ラムダからの応答が到着し、その後の実際の要求の呼び出しにはそれほど時間がかかりません。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まとめ</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、アプリケーションの設計から、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いわゆる本番</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">環境でのリリースまで、すべての主要な段階を通過しました</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーレスとAWS Lambdaについてすでに聞いたことがあるが、実際の経験がない人も、このガイドを使用して、これだけでなく、いくつかのソフトウェアソリューションの展開速度に大きな利点があると感じていただければ幸いです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利点</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私自身にとって、最も価値のある利点を特定しました。</font></font><br>
<ul>
<li>     Free Tier      ,     ,       .</li>
<li>           1-2 .        /.</li>
<li>  ,          ,         .</li>
<li>  Serverless      .   ,  —  .   SAM          AWS. AWS    ,         ,   .</li>
<li>      Lambda ,     .</li>
<li>   Serverless    , , .          ELK/Promethes/Grafana      .</li>
<li>   ,             API.          API Key,   IAM ,                      .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まあ、おそらく最も基本的なものはサーバーレスです。</font><font style="vertical-align: inherit;">お支払いが必要なEC2インスタンス、インスタンスへのアクセスを構成する方法、アプリケーションがクラッシュした場合のアラートを構成する方法、自動スケーリングを構成する方法などについて考える必要はありません。</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欠点</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
残念ながら、これは、このソリューションを採用して、cuberでお気に入りのマイクロサービスの代わりにエンタープライズシステムの一部として使用できることを意味するものではありません。</font><font style="vertical-align: inherit;">多くの場合、特定のケースでより適切なソリューションを決定するために、より深く掘り下げる必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、Lambdaを選択する際に注意する必要があるコメントもあります。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールドスタート。</font><font style="vertical-align: inherit;">同期クエリ、およびJavaやC＃などの言語を使用する場合は特に重要です。</font><font style="vertical-align: inherit;">問題はウォームアップによって適度に解決されますが、そのようなソリューションを事前に検討し、コストと考えられるメリットを比較することをお勧めします</font></font></li>
<li>    .       3GB  ,    2   ,    ,     - Fargate,       ,     .</li>
<li>          API,       ,           .</li>
<li>    /   1-2     Serverless,                .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CooberでマイクロサービスとCI / CDを開発するためのインフラストラクチャがすでにある場合、別のCI / CDプロセスをサポートする必要がある（特にマネージャーの場合）と主張することは再び問題になります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まあ、テストなしで。</font><font style="vertical-align: inherit;">また、ラムダのスループットをテストすることは、通常のパフォーマンステストとは依然として異なり、多くの要因を考慮する必要があるため、非常に困難です。</font></font></li>
</ul><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用法</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一般に、AWS Lambdaおよびその他のサーバーレスサービスの使用は、非同期およびイベント駆動型開発の原則に非常によく適合します。</font><font style="vertical-align: inherit;">そして、非同期処理を使用することで、パフォーマンスとコストの両方の点で最適な結果を達成できます。</font><font style="vertical-align: inherit;">Serveressソリューションが重要な役割を果たすソリューションのリストは次のとおりです。</font></font><br>
<img src="https://habrastorage.org/webt/i6/ov/y6/i6ovy6ha2pszsiui5jvyewbf-dk.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事は非常に広範囲であることが判明し、これ以上インフレートしたくないので、AWSコンソール、SAMフレームワーク、さらにはIntelljIDEAのすべての機能を使用して開発をより効率的に行う方法を示す続きを準備する可能性があります。</font><font style="vertical-align: inherit;">さて、テストの部分を省略したので、この開発の側面について詳しく説明します。</font><font style="vertical-align: inherit;">また、次の記事に何を追加したいか、または質問がある場合は、コメントまたはプライベートメッセージに自由に書いてください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加：</font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambdaの動作。</font><font style="vertical-align: inherit;">パート2</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
記事からのいくつかの重要で有用なリンク：</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubプロジェクト</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS-CLIをダウンロード</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAM-CLIをダウンロード</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS-CLI構成</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードとしてのインフラストラクチャ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraformの使用経験</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMリソースの説明</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWS Lambda関数のエイリアス</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高度なラムダ展開</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAM APIリソース構成</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AWS IAM   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">       SES</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Read/Write capacity  DynamoDB </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">SAM/CloudFormation  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> Parameters   </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  CloudFormation </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">      </a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486634/index.html">Visual Studio 2019バージョン16.3および16.4でのMSVCバックエンドの更新</a></li>
<li><a href="../ja486638/index.html">Blazor WebAssembly 3.2.0 Preview 1が利用可能になりました</a></li>
<li><a href="../ja486640/index.html">モバイル開発者向けの興味深い資料の要約＃331（1月27日-2月2日）</a></li>
<li><a href="../ja486644/index.html">5分でDIYアンテナ</a></li>
<li><a href="../ja486646/index.html">jQueryからSvelteに移行する</a></li>
<li><a href="../ja486650/index.html">ハードリアルタイムシステムの動的メモリ</a></li>
<li><a href="../ja486652/index.html">プログラマーのための「純粋な理由の批判」</a></li>
<li><a href="../ja486654/index.html">Raspberry piのホームアシスタントでのモーションセンサーとアラームおよびビデオ登録接続</a></li>
<li><a href="../ja486656/index.html">Unicodeに新しい文字を追加する方法：素人の経験</a></li>
<li><a href="../ja486658/index.html">Moxy Strategyプラグイン</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>