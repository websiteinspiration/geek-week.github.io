<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥔 📑 ✊🏿 Le script de lancement de serveur Minecraft parfait ♍️ 👨🏿‍🎨 🤚🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'auteur aime beaucoup le jeu et il est lui-même l'administrateur d'un petit serveur "purement pour les amis". Comme d'habitude chez les amateurs, tou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Le script de lancement de serveur Minecraft parfait</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/495192/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/p4/ej/aj/p4ejajdnio8gldb2bw8zo6v3uxe.jpeg"></div></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur aime beaucoup le jeu et il est lui-même l'administrateur d'un petit serveur "purement pour les amis". </font><font style="vertical-align: inherit;">Comme d'habitude chez les amateurs, tout est modulé sur le serveur, et cela entraîne l'instabilité du travail et du fait de la chute. </font><font style="vertical-align: inherit;">Étant donné que l'auteur connaît mieux Powershell que l'emplacement des magasins dans sa rue, il a décidé de faire "Le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meilleur script de lancement de Minecraft 2020</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">Le même script a servi de base au modèle sur le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">marché Ruvds</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mais toutes les sources sont déjà dans l'article. </font><font style="vertical-align: inherit;">Maintenant, dans l'ordre, comment tout cela s'est produit.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons besoin d'équipes</font></font></font></h2><br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Journalisation alternative</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir mis quelques mods de plus, j'ai trouvé que le serveur semblait planter sans déclarer la guerre. </font><font style="vertical-align: inherit;">Le serveur n'a pas écrit d'erreurs dans latest.log ou debug, et la console, qui était censée écrire et arrêter cette erreur, a été fermée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ne veut pas écrire - pas besoin. </font><font style="vertical-align: inherit;">Nous avons Powershell avec l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">applet de commande Tee-Object</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui prend un objet et l'affiche dans un fichier et dans la console en même temps.</font></font><br>
<br>
<pre><code class="powershell hljs">.\handler.ps1 | <span class="hljs-built_in">Tee-Object</span> .\StandardOutput.txt <span class="hljs-literal">-Append</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette façon, Powershell récupérera StandardOutput et l'écrira dans un fichier. </font><font style="vertical-align: inherit;">N'essayez pas d'utiliser </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start-Process</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> car il renverra System.ComponentModel.Component, pas StandardOutput, et -RedirectStandardOutput rendra impossible l'accès à la console, ce que nous voulons éviter.</font></font><br>
<br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer des arguments</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mettant la même paire de mods, l'auteur a remarqué que le serveur manque également de RAM. Et cela doit changer les arguments de démarrage. Au lieu de les changer à chaque fois dans start.bat, que tout le monde utilise, utilisez simplement ce script. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque Tee-Object ne lit StandardOutput que lorsque l'exécutable est appelé «Right So», vous devrez créer un autre script. Ce script exécutera Minecraft lui-même. Commençons par les arguments. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de se livrer à la paresse ultime à l'avenir, le script doit collecter les arguments de démarrage à la volée. Pour ce faire, commencez par rechercher la dernière version de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forge</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$forge</span> = ((<span class="hljs-built_in">Get-ChildItem</span> | <span class="hljs-built_in">Where-Object</span> Name <span class="hljs-operator">-Like</span> <span class="hljs-string">"forge*"</span>).Name | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Descending</span>) | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-last</span> <span class="hljs-number">1</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'aide de sort-object, nous prendrons toujours l'objet avec le plus grand chiffre, peu importe combien vous les y mettez. </font><font style="vertical-align: inherit;">La paresse ultime. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous devez maintenant affecter de la mémoire au serveur. </font><font style="vertical-align: inherit;">Pour ce faire, prenez la quantité de mémoire système et écrivez sa quantité en chaîne.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$ram</span> = ((<span class="hljs-built_in">Get-CimInstance</span> Win32_PhysicalMemory | <span class="hljs-built_in">Measure-Object</span> <span class="hljs-literal">-Property</span> capacity <span class="hljs-literal">-Sum</span>).sum /<span class="hljs-number">1</span>gb)
<span class="hljs-variable">$xmx</span> = <span class="hljs-string">"-Xms"</span> + <span class="hljs-variable">$ram</span> + <span class="hljs-string">"G"</span></code></pre><br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redémarrage automatique correct</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur a vu des fichiers .bat d'autres personnes, mais ils n'ont pas pris en compte la raison pour laquelle le serveur a été arrêté. Est-il gênant que si vous avez juste besoin de modifier le fichier mod ou de supprimer quelque chose? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faisons maintenant le bon redémarrage. L'auteur a précédemment rencontré d'étranges scripts qui ont redémarré le serveur malgré le fait que le serveur s'est arrêté. Nous utiliserons exitcode. Java utilise 0 comme réussite, donc nous danserons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Créez d'abord une fonction qui redémarrera le serveur s'il ne se termine pas.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get-MinecraftExitCode</span></span> {<font></font>
   <font></font>
    <span class="hljs-keyword">do</span> {<font></font>
        <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$global:Process</span>.ExitCode <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">Write-Log</span>
            <span class="hljs-built_in">Restart-Minecraft</span><font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">Write-Log</span><font></font>
        }<font></font>
 <font></font>
    } <span class="hljs-keyword">until</span> (<span class="hljs-variable">$global:Process</span>.ExitCode <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>)<font></font>
    <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script restera dans la boucle jusqu'à ce que le serveur de sa propre console s'arrête normalement à l'aide de la commande / stop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous décidions tous d'automatiser, ce serait bien de recueillir la date de lancement, l'achèvement, ainsi que la raison de l'achèvement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, nous écrivons le résultat Start-Process dans une variable. </font><font style="vertical-align: inherit;">Dans le script, cela ressemble à ceci:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$global:Process</span> = <span class="hljs-built_in">Start-Process</span> <span class="hljs-literal">-FilePath</span>  <span class="hljs-string">"C:\Program Files (x86)\common files\Oracle\Java\javapath_target_*\java.exe"</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">"<span class="hljs-variable">$xmx</span> -server -jar <span class="hljs-variable">$forge</span> nogui"</span> <span class="hljs-literal">-Wait</span> <span class="hljs-literal">-NoNewWindow</span> <span class="hljs-literal">-PassThru</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis nous écrivons les résultats dans un fichier. </font><font style="vertical-align: inherit;">Voici ce qui nous revient dans la variable:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$global:Process</span>.StartTime
<span class="hljs-variable">$global:Process</span>.ExitCode	
<span class="hljs-variable">$global:Process</span>.ExitTime</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout cela en utilisant Add-Content peut être ajouté au fichier. </font><font style="vertical-align: inherit;">Après avoir peigné un peu, nous obtenons un tel script, et l'appelons handler.ps1.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Add-Content</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">"Start time:"</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$Logfile</span> 
<span class="hljs-variable">$global:Process</span>.StartTime<font></font>
 <font></font>
<span class="hljs-built_in">Add-Content</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">"Exit code:"</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$Logfile</span> 
<span class="hljs-variable">$global:Process</span>.ExitCode | <span class="hljs-built_in">Add-Content</span> <span class="hljs-variable">$Logfile</span><font></font>
    <font></font>
<span class="hljs-built_in">Add-Content</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">"Exit time:"</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$Logfile</span> 
<span class="hljs-variable">$global:Process</span>.ExitTime | <span class="hljs-built_in">Add-Content</span> <span class="hljs-variable">$Logfile</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exécutons maintenant le script avec le lancement du gestionnaire. </font></font><br>
<br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Démarrage correct</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur veut qu'un module lance Minecraft de différentes versions à partir de n'importe quel chemin, et puisse également mettre les journaux dans un dossier spécifique. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le problème est que le processus doit être démarré par l'utilisateur qui est sur le système. Cela peut être fait via le bureau ou WinRm. Si vous démarrez le serveur au nom du système ou même de l'administrateur, mais que vous ne vous connectez pas, Server.jar ne pourra même pas lire eula.txt et démarrer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous pouvons activer la connexion automatique au système en ajoutant trois entrées au registre.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> DefaultUserName <span class="hljs-literal">-Value</span> <span class="hljs-variable">$Username</span> <span class="hljs-literal">-ErrorAction</span> SilentlyContinue
<span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> DefaultPassword <span class="hljs-literal">-Value</span> <span class="hljs-variable">$Password</span>  <span class="hljs-literal">-ErrorAction</span> SilentlyContinue
<span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> AutoAdminLogon <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span> <span class="hljs-literal">-ErrorAction</span> SilentlyContinue</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas prudent. </font><font style="vertical-align: inherit;">Le login et le mot de passe sont indiqués ici en texte clair, vous devez donc démarrer un utilisateur individuel qui a accès au niveau utilisateur, ou dans un groupe encore plus restreint, pour démarrer le serveur. </font><font style="vertical-align: inherit;">L'utilisation d'un administrateur standard pour cela est fortement déconseillée. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec saisie automatique triée. </font><font style="vertical-align: inherit;">Vous devez maintenant enregistrer une nouvelle tâche sous le serveur. </font><font style="vertical-align: inherit;">Nous exécuterons la commande à partir de Powershell, elle ressemblera donc à ceci:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$Trigger</span> = <span class="hljs-built_in">New-ScheduledTaskTrigger</span> <span class="hljs-literal">-AtLogOn</span>
<span class="hljs-variable">$User</span> = <span class="hljs-string">"ServerAdmin"</span>
<span class="hljs-variable">$PS</span> = <span class="hljs-built_in">New-ScheduledTaskAction</span> <span class="hljs-literal">-Execute</span> <span class="hljs-string">'PowerShell.exe" -Argument "Start-Minecraft -Type Forge -LogFile "C:\minecraft\stdout.txt" -MinecraftPath "C:\minecraft\"'</span>
<span class="hljs-built_in">Register-ScheduledTask</span> <span class="hljs-literal">-TaskName</span> <span class="hljs-string">"StartSSMS"</span> <span class="hljs-literal">-Trigger</span> <span class="hljs-variable">$Trigger</span> <span class="hljs-literal">-User</span> <span class="hljs-variable">$User</span> <span class="hljs-literal">-Action</span> <span class="hljs-variable">$PS</span> <span class="hljs-literal">-RunLevel</span> Highest</code></pre><br>
<h2><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assembler le module</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, transformons tout en modules qui peuvent être utilisés plus tard. </font><font style="vertical-align: inherit;">Tout le code des scripts prêts à l'emploi est ici, importez et utilisez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez utiliser séparément tout ce qui est décrit ci-dessus si vous ne voulez pas vous embêter avec les modules.</font></font><br>
<br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start-minecraft</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous allons créer un module qui ne fera que cela, exécuter un script qui écoutera et enregistrera la sortie standard. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le bloc de paramètres, il demande à partir de quel dossier lancer Minecraft et où mettre le journal.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Set-Location</span> (<span class="hljs-built_in">Split-Path</span> <span class="hljs-variable">$MyInvocation</span>.MyCommand.Path)
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Start-Minecraft</span></span> {
    <span class="hljs-function">[<span class="hljs-type">CmdletBinding</span>()]</span>
    <span class="hljs-keyword">param</span> (<font></font>
        [<span class="hljs-type">Parameter</span>()]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>]
        <span class="hljs-variable">$LogFile</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>)]  <font></font>
        [<span class="hljs-type">ValidateSet</span>(<span class="hljs-string">'Vanilla'</span>, <span class="hljs-string">'Forge'</span>)]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>]
        <span class="hljs-variable">$Type</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>)]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>[]]
        <span class="hljs-variable">$MinecraftPath</span><font></font>
 <font></font>
    )<font></font>
    powershell.exe <span class="hljs-operator">-file</span> .\handler.ps1 <span class="hljs-literal">-type</span> <span class="hljs-variable">$type</span> <span class="hljs-literal">-MinecraftPath</span> <span class="hljs-variable">$MinecraftPath</span> | <span class="hljs-built_in">Tee-Object</span> <span class="hljs-variable">$LogFile</span> <span class="hljs-literal">-Append</span><font></font>
}<font></font>
<span class="hljs-built_in">Export-ModuleMember</span> <span class="hljs-literal">-Function</span> <span class="hljs-built_in">Start-Minecraft</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et vous devrez exécuter minecraft comme ceci:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Start-Minecraft</span> <span class="hljs-literal">-Type</span> Forge <span class="hljs-literal">-LogFile</span> <span class="hljs-string">"C:\minecraft\stdout.txt"</span> <span class="hljs-literal">-MinecraftPath</span> <span class="hljs-string">"C:\minecraft\"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passons maintenant au Handler.ps1 prêt à l'emploi </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que notre script puisse accepter des paramètres lors de son appel, nous devons également spécifier un bloc de paramètres. </font><font style="vertical-align: inherit;">Veuillez noter qu'il démarre Oracle Java, si vous utilisez une distribution différente, vous devrez modifier le chemin d'accès au fichier exécutable.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-keyword">param</span> (<font></font>
    [<span class="hljs-type">Parameter</span>()]<font></font>
    [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
    [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$type</span>,<font></font>
 <font></font>
    [<span class="hljs-type">Parameter</span>()]<font></font>
    [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
    [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$MinecraftPath</span>,<font></font>
 <font></font>
    [<span class="hljs-type">Parameter</span>()]<font></font>
    [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
    [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$StandardOutput</span><font></font>
)<font></font>
 <font></font>
<span class="hljs-built_in">Set-Location</span> <span class="hljs-variable">$MinecraftPath</span><font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Restart-Minecraft</span></span> {<font></font>
 <font></font>
    <span class="hljs-built_in">Write-host</span> <span class="hljs-string">"=============== Starting godlike game server ============"</span><font></font>
 <font></font>
    <span class="hljs-variable">$forge</span> = ((<span class="hljs-built_in">Get-ChildItem</span> | <span class="hljs-built_in">Where-Object</span> Name <span class="hljs-operator">-Like</span> <span class="hljs-string">"forge*"</span>).Name | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Descending</span>) | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-first</span> <span class="hljs-number">1</span><font></font>
 <font></font>
    <span class="hljs-variable">$ram</span> = ((<span class="hljs-built_in">Get-CimInstance</span> Win32_PhysicalMemory | <span class="hljs-built_in">Measure-Object</span> <span class="hljs-literal">-Property</span> capacity <span class="hljs-literal">-Sum</span>).sum /<span class="hljs-number">1</span>gb)
    <span class="hljs-variable">$xmx</span> = <span class="hljs-string">"-Xms"</span> + <span class="hljs-variable">$ram</span> + <span class="hljs-string">"G"</span>
    <span class="hljs-variable">$global:Process</span> = <span class="hljs-built_in">Start-Process</span> <span class="hljs-literal">-FilePath</span>  <span class="hljs-string">"C:\Program Files (x86)\common files\Oracle\Java\javapath_target_*\java.exe"</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">"<span class="hljs-variable">$xmx</span> -server -jar <span class="hljs-variable">$forge</span> nogui"</span> <span class="hljs-literal">-Wait</span> <span class="hljs-literal">-NoNewWindow</span> <span class="hljs-literal">-PassThru</span><font></font>
    <font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Write-Log</span></span> {
    <span class="hljs-built_in">Write-host</span> <span class="hljs-string">"Start time:"</span> <span class="hljs-variable">$global:Process</span>.StartTime<font></font>
 <font></font>
    <span class="hljs-built_in">Write-host</span> <span class="hljs-string">"Exit code:"</span> <span class="hljs-variable">$global:Process</span>.ExitCode<font></font>
    <font></font>
    <span class="hljs-built_in">Write-host</span> <span class="hljs-string">"Exit time:"</span> <span class="hljs-variable">$global:Process</span>.ExitTime<font></font>
 <font></font>
    <span class="hljs-built_in">Write-host</span> <span class="hljs-string">"=============== Stopped godlike game server ============="</span><font></font>
}<font></font>
 <font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Get-MinecraftExitCode</span></span> {<font></font>
   <font></font>
    <span class="hljs-keyword">do</span> {<font></font>
        <font></font>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$global:Process</span>.ExitCode <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">Restart-Minecraft</span>
            <span class="hljs-built_in">Write-Log</span><font></font>
        }<font></font>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">Write-Log</span><font></font>
        }<font></font>
 <font></font>
    } <span class="hljs-keyword">until</span> (<span class="hljs-variable">$global:Process</span>.ExitCode <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>)<font></font>
    <font></font>
}<font></font>
 <font></font>
<span class="hljs-built_in">Get-MinecraftExitCode</span>
</code></pre><br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Register-minecraft</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le script répète pratiquement Start-Minecraft, sauf qu'il n'enregistre qu'une nouvelle tâche. </font><font style="vertical-align: inherit;">Accepte les mêmes arguments. </font><font style="vertical-align: inherit;">Le nom d'utilisateur, s'il n'est pas spécifié, prend le nom actuel.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Register-Minecraft</span></span> {
    <span class="hljs-function">[<span class="hljs-type">CmdletBinding</span>()]</span>
    <span class="hljs-keyword">param</span> (<font></font>
        [<span class="hljs-type">Parameter</span>()]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>]
        <span class="hljs-variable">$LogFile</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>)]  <font></font>
        [<span class="hljs-type">ValidateSet</span>(<span class="hljs-string">'Vanilla'</span>, <span class="hljs-string">'Forge'</span>)]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Type</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>)]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$MinecraftPath</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>)]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]<font></font>
        [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$User</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>)]<font></font>
        [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$TaskName</span> = <span class="hljs-variable">$env:USERNAME</span><font></font>
    )<font></font>
 <font></font>
    <span class="hljs-variable">$Trigger</span> = <span class="hljs-built_in">New-ScheduledTaskTrigger</span> <span class="hljs-literal">-AtLogOn</span>
    <span class="hljs-variable">$arguments</span> = <span class="hljs-string">"Start-Minecraft -Type <span class="hljs-variable">$Type</span> -LogFile <span class="hljs-variable">$LogFile</span> -MinecraftPath <span class="hljs-variable">$MinecraftPath</span>"</span>
    <span class="hljs-variable">$PS</span> = <span class="hljs-built_in">New-ScheduledTaskAction</span> <span class="hljs-literal">-Execute</span> <span class="hljs-string">"PowerShell"</span> <span class="hljs-literal">-Argument</span> <span class="hljs-string">"-noexit -command <span class="hljs-variable">$arguments</span>"</span>
    <span class="hljs-built_in">Register-ScheduledTask</span> <span class="hljs-literal">-TaskName</span> <span class="hljs-variable">$TaskName</span> <span class="hljs-literal">-Trigger</span> <span class="hljs-variable">$Trigger</span> <span class="hljs-literal">-User</span> <span class="hljs-variable">$User</span> <span class="hljs-literal">-Action</span> <span class="hljs-variable">$PS</span> <span class="hljs-literal">-RunLevel</span> Highest<font></font>
    <font></font>
}<font></font>
 <font></font>
<span class="hljs-built_in">Export-ModuleMember</span> <span class="hljs-literal">-Function</span> <span class="hljs-built_in">Register-Minecraft</span></code></pre><br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'inscrire-connexion automatique</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le bloc de paramètres, le script accepte le paramètre Username et Password. </font><font style="vertical-align: inherit;">Si le nom d'utilisateur n'a pas été spécifié, le nom de l'utilisateur actuel est utilisé.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Set-Autologon</span></span> {<font></font>
 <font></font>
    <span class="hljs-keyword">param</span> (<font></font>
        [<span class="hljs-type">Parameter</span>(
        <span class="hljs-type">HelpMessage</span>=<span class="hljs-string">"Username for autologon"</span>)]
        <span class="hljs-variable">$Username</span> = <span class="hljs-variable">$env:USERNAME</span>,<font></font>
 <font></font>
        [<span class="hljs-type">Parameter</span>(<span class="hljs-type">Mandatory</span>=<span class="hljs-variable">$true</span>,
        <span class="hljs-type">HelpMessage</span>=<span class="hljs-string">"User password"</span>)]<font></font>
        [<span class="hljs-type">ValidateNotNullOrEmpty</span>()]
        <span class="hljs-variable">$Password</span><font></font>
    )<font></font>
 <font></font>
    <span class="hljs-variable">$i</span> = <span class="hljs-built_in">Get-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span><font></font>
 <font></font>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$null</span> <span class="hljs-operator">-eq</span> <span class="hljs-variable">$i</span>) {
        <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> DefaultUserName <span class="hljs-literal">-Value</span> <span class="hljs-variable">$Username</span>
        <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> DefaultPassword <span class="hljs-literal">-Value</span> <span class="hljs-variable">$Password</span> 
        <span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> AutoAdminLogon <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span>
        <span class="hljs-built_in">Write-Verbose</span> <span class="hljs-string">"Set-Autologon will enable user auto logon."</span><font></font>
 <font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> DefaultUserName <span class="hljs-literal">-Value</span> <span class="hljs-variable">$Username</span>
        <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> DefaultPassword <span class="hljs-literal">-Value</span> <span class="hljs-variable">$Password</span>
        <span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">"HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> <span class="hljs-literal">-Name</span> AutoAdminLogon <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span><font></font>
    }<font></font>
 <font></font>
    <font></font>
    <span class="hljs-built_in">Write-Verbose</span> <span class="hljs-string">"Autologon was set successfully."</span><font></font>
 <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'exécution de ce script ressemble à ceci:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Set-Autologon</span> <span class="hljs-literal">-Password</span> <span class="hljs-string">"PlaintextPassword"</span></code></pre><br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment utiliser</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant examiner comment l'auteur lui-même utilise tout cela. </font><font style="vertical-align: inherit;">Comment déployer le serveur public Minecraft sur Windows. </font><font style="vertical-align: inherit;">Commençons par le tout début. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Créez un utilisateur</font></font></b><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$pass</span> = <span class="hljs-built_in">Get-Credential</span>
<span class="hljs-built_in">New-LocalUser</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">"MinecraftServer"</span> <span class="hljs-literal">-Password</span> <span class="hljs-variable">$pass</span>.Password <span class="hljs-literal">-AccountNeverExpires</span> <span class="hljs-literal">-PasswordNeverExpires</span> <span class="hljs-literal">-UserMayNotChangePassword</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Enregistrez la tâche d'exécution du script.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vous pouvez vous inscrire à l'aide du module, comme suit:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Register-Minecraft</span> <span class="hljs-literal">-Type</span> Forge <span class="hljs-literal">-LogFile</span> <span class="hljs-string">"C:\minecraft\stdout.txt"</span> <span class="hljs-literal">-MinecraftPath</span> <span class="hljs-string">"C:\minecraft\"</span> <span class="hljs-literal">-User</span> <span class="hljs-string">"MInecraftServer"</span> <span class="hljs-literal">-TaskName</span> <span class="hljs-string">"MinecraftStarter"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou utilisez les outils standard:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$Trigger</span> = <span class="hljs-built_in">New-ScheduledTaskTrigger</span> <span class="hljs-literal">-AtLogOn</span>
<span class="hljs-variable">$User</span> = <span class="hljs-string">"ServerAdmin"</span>
<span class="hljs-variable">$PS</span> = <span class="hljs-built_in">New-ScheduledTaskAction</span> <span class="hljs-literal">-Execute</span> <span class="hljs-string">'PowerShell.exe" -Argument "Start-Minecraft -Type Forge -LogFile "C:\minecraft\stdout.txt" -MinecraftPath "C:\minecraft\"'</span>
<span class="hljs-built_in">Register-ScheduledTask</span> <span class="hljs-literal">-TaskName</span> <span class="hljs-string">"StartSSMS"</span> <span class="hljs-literal">-Trigger</span> <span class="hljs-variable">$Trigger</span> <span class="hljs-literal">-User</span> <span class="hljs-variable">$User</span> <span class="hljs-literal">-Action</span> <span class="hljs-variable">$PS</span> <span class="hljs-literal">-RunLevel</span> Highest</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Activez la connexion automatique au système et redémarrez la machine</font></font></b><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Set-Autologon</span> <span class="hljs-literal">-Username</span> <span class="hljs-string">"MinecraftServer"</span> <span class="hljs-literal">-Password</span> <span class="hljs-string">"Qw3"</span></code></pre><br>
<h3><font color="“#3AC1EF”"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achèvement</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'auteur a fait le script, y compris pour lui-même, par conséquent, il sera heureux d'entendre vos suggestions pour améliorer le script. </font><font style="vertical-align: inherit;">L'auteur espère que tout ce code vous a été au moins d'une utilité minimale, et l'article est intéressant.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr495176/index.html">Correction de la sérialisation des objets dans Kotlin une fois pour toutes</a></li>
<li><a href="../fr495178/index.html">Il est temps pour les sites gratuits</a></li>
<li><a href="../fr495180/index.html">We pump Ikea: comment transformer la musique légère en Big Brother</a></li>
<li><a href="../fr495184/index.html">Les difficultés de la substitution des importations: un outil pour les sociétés d'État est supprimé du registre des logiciels nationaux</a></li>
<li><a href="../fr495188/index.html">Difficultés dans l'enseignement des langues étrangères (je recommanderais également aux étudiants)</a></li>
<li><a href="../fr495194/index.html">Carte audio minimale STM-32</a></li>
<li><a href="../fr495196/index.html">Si l'IB avait un «Darwin Award», ou 7 histoires sur la stupidité, les ordures, la crédulité et leurs conséquences</a></li>
<li><a href="../fr495200/index.html">Nous célébrons l'anniversaire d'OTUS avec la quête «Les spécialistes informatiques vont-ils sauver notre 2020e?»</a></li>
<li><a href="../fr495202/index.html">Forces spéciales d'ingénierie: chaleur et froid</a></li>
<li><a href="../fr495204/index.html">Modèle de gestion informatique dans une entreprise de produits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>