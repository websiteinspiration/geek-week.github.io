<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“³ ğŸ™ƒ ğŸ§›ğŸ¼ PuppetConf 2016. Kubernetes para administradores de sistema. Parte 1 â™¥ï¸ ğŸ†š ğŸª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu sou um administrador de sistemas, lidando com computadores, e hoje falaremos sobre o Kubernetes. Tentarei me aprofundar no tÃ³pico, considerando os ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>PuppetConf 2016. Kubernetes para administradores de sistema. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503970/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu sou um administrador de sistemas, lidando com computadores, e hoje falaremos sobre o Kubernetes. Tentarei me aprofundar no tÃ³pico, considerando os problemas que o administrador do sistema pode resolver com esse aplicativo e tambÃ©m abordar alguns aspectos da operaÃ§Ã£o do Puppet, que pareciam se encaixar nesse mundo com a ajuda de um novo conjunto de abstraÃ§Ãµes para o aplicativo funcionar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HÃ¡ cinco ou seis anos, Luis Andre Barroso e Urs Hoesl no artigo â€œData Center como um computadorâ€ sugeriram que deverÃ­amos perceber o data center como um computador enorme. Ã‰ necessÃ¡rio abstrair do fato de que o data center consiste em mÃ¡quinas separadas e considerÃ¡-lo como uma entidade lÃ³gica. Assim que vocÃª tenta usar essa idÃ©ia na prÃ¡tica, pode aplicar os princÃ­pios de construÃ§Ã£o de sistemas distribuÃ­dos e computaÃ§Ã£o distribuÃ­da aos data centers.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/w9/q7/sg/w9q7sgxchzl3fuuhlrymsv4xcsa.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para tratar o datacenter como um computador, vocÃª precisa de um sistema operacional. Parece muito semelhante ao que vocÃª usa em um computador separado, mas deve ter uma interface diferente, porque vocÃª nÃ£o precisa de acesso a uma mÃ¡quina separada e nÃ£o precisa de acesso ao kernel. EntÃ£o, vamos pensar no data center como um grande computador. Hoje vou lhe dizer o que fazer se vocÃª parecer privado da capacidade de controlar qualquer mÃ¡quina usando SSH. VocÃª nÃ£o poderÃ¡ fazer login e, embora algumas pessoas acreditem que sem isso Ã© impossÃ­vel controlar o sistema, eu vou lhe dizer o quanto pode ser feito com o Kubernetes. Primeiro, vocÃª deve pensar no Kubernetes como uma estrutura para criar plataformas distribuÃ­das.</font></font><a name="habracut"></a><br>
<br>
<img src="https://habrastorage.org/webt/wf/d2/5c/wfd25cjupilzhtu1ndkpci11cfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso nÃ£o significa que, apÃ³s o download do Kubernetes, vocÃª receberÃ¡ uma interface do usuÃ¡rio que fornecerÃ¡ tudo o que vocÃª deseja fazer com o sistema. NÃ£o, essa Ã© apenas a base para criar as ferramentas necessÃ¡rias para executar sua infraestrutura. Mostrarei como criar a integraÃ§Ã£o usando a autoridade de certificaÃ§Ã£o Let's Encrypt Certificate para automatizar o processo de certificaÃ§Ã£o do meu aplicativo usando o Kubernetes como estrutura.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ol/ty/g3/oltyg3s-gtbgticzc-omgefrq04.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitas pessoas perguntam exatamente para que serve o Kubernetes. Eu trabalhei com o Puppet Labs por muitos anos e vi que essa coisa estava instalada em computadores para fornecer ao sistema uma API que nÃ£o existia atÃ© o momento. Em vez de Bash, scripts YAML e coisas semelhantes, o Puppet forneceu um usuÃ¡rio DSL que permitiu que ele interagisse com as mÃ¡quinas programaticamente sem scripts de shell. A diferenÃ§a entre Kubernetes Ã© que ele estÃ¡ localizado acima do nÃ­vel de "ferro". Vamos nos concentrar nÃ£o tanto na automaÃ§Ã£o e abstraÃ§Ã£o deste sistema, mas tambÃ©m nos relacionamentos, ou no contrato, entre nossa infraestrutura e aplicativos que vamos extrair de qualquer nÃ³. No Kubernetes, nÃ£o atribuÃ­mos aplicativos a mÃ¡quinas, nÃ£o existe um "manifesto de nÃ³", o agendador considera os nÃ³s individuais simplesmente como recursos do datacenter,representando um grande computador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perguntas: â€œO Kubernetes roda no OpenStack, no VMware, no Bare Metal, na nuvem?â€ nÃ£o faz sentido. A pergunta correta Ã©: "Posso executar o agente Kubernetes para recuperar esses recursos?" E a resposta serÃ¡ "sim". Porque a operaÃ§Ã£o desta aplicaÃ§Ã£o Ã© completamente independente da plataforma que vocÃª escolher. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/km/hl/ankmhlzzmnaitmix8t0hppm8idi.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes Ã© independente de plataforma. Kubernetes Ã© declarativo da mesma maneira que Puppet. Portanto, vocÃª estÃ¡ relatando para qual aplicativo vocÃª o usarÃ¡ - neste exemplo, Ã© nginx. Este Ã© um contrato entre vocÃª, o desenvolvedor e o Kubernetes como um meio de criar imagens de contÃªiner.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu gosto de usar a analogia com a empresa de courier da FedEx - vocÃª nÃ£o pode arrastÃ¡-los por um vagÃ£o inteiro de coisas e esperar atÃ© que eles resolvam tudo e enviem para onde deveria estar. Eles tÃªm uma regra: coloque suas coisas em uma caixa. Quando vocÃª fizer isso, eles enviarÃ£o sua caixa e poderÃ£o saber quando ela chegarÃ¡ ao seu destino. "Se vocÃª nÃ£o tiver uma caixa, nÃ£o poderÃ¡ trabalhar com nosso sistema".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, ao trabalhar com contÃªineres, Ã© inÃºtil discutir o que vocÃª tem - Python, Java e outras coisas, nÃ£o importa - apenas pegue todas as suas dependÃªncias e coloque-as no contÃªiner. Muitas pessoas dizem sobre contÃªineres que parecem resolver os problemas de toda a infraestrutura. No entanto, o problema Ã© que as pessoas nÃ£o percebem os contÃªineres como duas coisas diferentes. A primeira coisa Ã© a ideia de um formato de embalagem, a segunda Ã© a idÃ©ia de um tempo de execuÃ§Ã£o do contÃªiner. Essas sÃ£o duas coisas diferentes que nÃ£o necessariamente exigem as mesmas ferramentas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qual dos presentes criou os contÃªineres? E quem usa o Puppet para construir contÃªineres? Ã‰ isso mesmo, eu tambÃ©m nÃ£o concordo! VocÃª pode dizer: â€œcomo assim? VocÃª estÃ¡ na conferÃªncia Puppet, precisa concordar! â€ O motivo pelo qual discordo da idÃ©ia de construir contÃªineres no Puppet Ã© o seguinte: nÃ£o sei se precisamos disso, porque as coisas que precisamos para criar uma imagem sÃ£o diferentes das que precisamos para iniciar o processo de produÃ§Ã£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos pensar nisso como construir um pipeline de software e dar uma olhada neste Dockerfile. Feche os olhos para aqueles que nunca viram esses arquivos, pois eles podem parecer intimidadores. Este arquivo mostra como criar um aplicativo Ruby on Rails - um aplicativo Ruby com uma estrutura Rails.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/f3/ra/3r/f3ra3rkhngjp08t7beuyoeihc7i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele diz â€œFROM ruby â€‹â€‹2.3.1â€, que provavelmente inserirÃ¡ todo o sistema operacional no contÃªiner, neste caso, a imagem bÃ¡sica do Ruby alpino-linux. AlguÃ©m sabe por que incorporamos imagens do Ubuntu ou Red Hat nesses contÃªineres? A maioria das pessoas nÃ£o sabe o que sÃ£o dependÃªncias e usa uma abordagem aleatÃ³ria, apenas colocando todo o sistema operacional em um contÃªiner para garantir que elas tenham suas dependÃªncias em algum lugar dentro. EntÃ£o, depois de criar isso, vocÃª precisarÃ¡ executÃ¡-lo apenas uma vez. Ã‰ daÃ­ que vem o mal-entendido: se isso nÃ£o funcionar, altere a linha do cÃ³digo atÃ© que funcione. Apenas verifique! VocÃª nÃ£o precisa ser muito inteligente com esses arquivos, seu objetivo Ã© criar uma representaÃ§Ã£o offline do seu aplicativo com todas as dependÃªncias. Esta Ã© apenas uma muleta que usamos no Ubuntu como ponto de partida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se vocÃª apenas criou o aplicativo e o lanÃ§ou, usaria algo como um link estÃ¡tico. Sem dependÃªncias no host, em seu contÃªiner vocÃª teria apenas um arquivo binÃ¡rio de um Docker de linha Ãºnica e nenhuma imagem bÃ¡sica. Na verdade, Ã© apenas uma transferÃªncia de coisas que nos sÃ£o familiares. Veja como esta montagem ficarÃ¡. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/pr/uq/jfpruqpgtrrrwwchkadl34kxn_y.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu criei esse arquivo anteriormente, mas geralmente parece uma tentativa de criar toda a Internet. Eu tenho um pouco de medo desta montagem, porque nÃ£o tenho certeza de que a Internet local possa lidar com Ruby. Veja o que aconteceu.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jo/1i/a6/jo1ia6qqo37wr63tazkn-yco38e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como vocÃª gosta deste volume de 1 Gig? AlÃ©m disso, o arquivo de origem, ou seja, o prÃ³prio aplicativo, pode ocupar, digamos, apenas 100 kB. EntÃ£o, como conseguimos um gigabyte inteiro? Isso ocorre porque usamos ferramentas ineficientes para criar aplicativos independentes. Todos eles foram projetados para rodar em computadores e usar bibliotecas dinÃ¢micas carregadas do ambiente externo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, tentaremos fazer o que fazemos em um telefone mÃ³vel - versÃµes portÃ¡teis de aplicativos para as quais existe um contrato entre vocÃª e a infraestrutura. Assim que tivermos esse contrato, poderemos dizer ao sistema exatamente o que ele deve fazer e ele nÃ£o se importarÃ¡ com o que fazer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª nÃ£o possui nenhum aplicativo especial criado especialmente. Me deparei com empresas que dizem: "temos uma aplicaÃ§Ã£o especial!". Eu digo: "Vamos adivinhar o que faz: ele inicia, liga-se Ã  porta, recebe trÃ¡fego, faz algo com os dados" e eles sÃ£o: "Uau, como vocÃª sabe disso?" Eu sei, porque nÃ£o hÃ¡ nada de especial aqui!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EntÃ£o, pegamos a amostra que colocamos no contÃªiner e a enviamos ao servidor da API. Em seguida, precisamos transformar isso em algo que funcione em nossa mÃ¡quina. No entanto, para coletar recursos da mÃ¡quina, precisamos instalar vÃ¡rias coisas: um tempo de execuÃ§Ã£o do contÃªiner para o arquivo Docker, um agente que entenda como se comunicar com o assistente para executar tudo o necessÃ¡rio, qual deve ser a resposta do sistema para que o aplicativo comece a funcionar. . Esse agente estÃ¡ simplesmente observando - nÃ£o hÃ¡ intervalos de 30 segundos, verificaÃ§Ãµes repetidas, nada disso. Ele simplesmente observa, dizendo: â€œse houver trabalho para mim, informe-me, e eu comeÃ§arei e o informarei constantemente sobre o status do processoâ€, para que vocÃª saiba que funciona.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2q/s1/dq/2qs1dq2ks5exprh4iljfwyiyydu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que fazemos isso de carro, precisamos de um agendador. Quantas pessoas usam o agendador? VocÃªs todos tÃªm que levantar as mÃ£os! Ã‰ o mesmo que a resposta Ã  pergunta: "qual de vocÃªs tem um laptop com mais de um processador de nÃºcleo Ãºnico?". De fato, quando faÃ§o uma pergunta sobre o planejador, a maioria nÃ£o levanta as mÃ£os. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando vocÃª inicia seu processo em uma mÃ¡quina, algo deve escolher qual processador usar. Quem trabalha isso? Ã‰ isso mesmo, o nÃºcleo. Agora vou explicar para vocÃªs o que Ã© um planejador. A maneira mais rÃ¡pida de fazer isso Ã© jogar Tetris. A primeira coisa que discutiremos Ã© a implantaÃ§Ã£o automÃ¡tica.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/on/qu/bb/onqubbexwsv2hscesmqhfvanli4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quantos de vocÃªs usaram a implantaÃ§Ã£o totalmente automÃ¡tica? Claramente, acho que Ã© por isso que estamos todos aqui. EntÃ£o, pressiono o botÃ£o, os blocos comeÃ§am a cair de cima e agora vocÃª pode ir tomar uma cerveja. Mas observe o que acontece Ã  esquerda e Ã  direita: seu processador e sua memÃ³ria se transformam em lixo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9c/gc/nd/9cgcndnl9ybdbg7t5fdhjei0930.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso acontece porque a maioria das pessoas usa no mÃ¡ximo 5% dos recursos do computador. VocÃª automatiza processos, mas perde muito dinheiro. Eu trabalho como um provedor de nuvem, tenho enormes reservas de recursos, mas Ã© horrÃ­vel quando as pessoas gastam dinheiro de maneira semelhante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando vocÃª usa o agendador, por analogia com o Tetris, controla o campo de jogo e controla cada bloco, direcionando-o para o lugar certo, ou seja, use os recursos da mÃ¡quina da melhor maneira possÃ­vel. O Kubernetes usa alguns algoritmos para isso. O algoritmo principal Ã© chamado Bin Packing - o mesmo "Tetris" ajudarÃ¡ a entendÃª-lo. O Kubernetes recebe uma carga de trabalho de vÃ¡rias formas e tamanhos, e nossa tarefa Ã© embalÃ¡-lo em mÃ¡quinas da melhor maneira possÃ­vel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nosso objetivo Ã© reutilizar todos os recursos disponÃ­veis Ã  medida que o trabalho avanÃ§a. Nem todas as cargas de trabalho sÃ£o iguais, por isso Ã© difÃ­cil colocÃ¡-las na mesma caixa. Mas no Kubernetes, quando uma â€œparteâ€ da carga de trabalho aparece (ou o bloco Tetris, se continuarmos nossa analogia), sempre existe o cluster certo onde vocÃª pode colocÃ¡-lo e executÃ¡-lo. E, como em qualquer processamento em lote, apÃ³s a conclusÃ£o da tarefa, recuperamos todos os recursos anteriormente ocupados para que possamos usÃ¡-los em tarefas futuras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como nÃ£o vivemos no jogo, mas no mundo real, vocÃª tem soluÃ§Ãµes desenvolvidas hÃ¡ muitos anos. EntÃ£o vocÃª se torna um administrador de sistema, os empregadores mostram sua produÃ§Ã£o e vocÃª percebe que a implantaÃ§Ã£o nÃ£o Ã© boa o suficiente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/2u/h_/hs/2uh_hsyrdmkfnkg5pnes9jlopr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª pode instalar gerenciadores de cluster em partes de suas mÃ¡quinas e deixÃ¡-los gerenciar certos recursos. Nesse caso especÃ­fico, vocÃª pode usar o Kubernetes, que comeÃ§arÃ¡ a preencher os espaÃ§os vazios do seu Tetris Ã  medida que avanÃ§ar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que aqueles que trabalham na indÃºstria levantem as mÃ£os. Sim, este Ã© um clÃ¡ssico chamado salÃ¡rio. Suponha que vocÃª tenha vÃ¡rios problemas em sua empresa. A primeira Ã© que tudo Ã© escrito em Java ou mesmo em COBOL - normalmente ninguÃ©m estÃ¡ pronto para isso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo problema frequentemente encontrado nas empresas Ã© o Oracle DBMS. Isso Ã© algo, localizado na parte traseira do software e dizendo: "NÃ£o tente automatizar nada!". Se vocÃª automatizar o software, seu custo aumentarÃ¡. Portanto, sem automaÃ§Ã£o - estamos promovendo nosso ecossistema de consultoria! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalmente, nessas circunstÃ¢ncias, as pessoas perguntam se o Kubernetes pode simplesmente ser usado para resolver esses problemas. Eu respondo: "nÃ£o", porque em uma situaÃ§Ã£o semelhante Ã  perda em Tetris, nada irÃ¡ ajudÃ¡-lo. VocÃª precisa fazer outra coisa, a saber, usar o agendador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora que temos um agendador que entende com Ãªxito as cargas de trabalho, vocÃª pode simplesmente colocar tudo em caixas e o agendador comeÃ§arÃ¡ seu trabalho.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rg/yz/ei/rgyzeivhzivkgknoock70b7rcym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos falar sobre as principais entidades do Kubernetes. Em primeiro lugar, esses sÃ£o os pods, que sÃ£o uma coleÃ§Ã£o de contÃªineres. Na maioria dos casos, um aplicativo consiste em mais de um componente. VocÃª pode anexar a si mesmo um aplicativo gravado sem scripts Java, mas convÃ©m usar o nginx para concluir o TLS e apenas um proxy no plano de fundo do aplicativo, e essas coisas devem ser conectadas, pois sÃ£o dependÃªncias codificadas. Uma dependÃªncia fracamente acoplada Ã© um banco de dados que vocÃª dimensiona independentemente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/e4/ca/zh/e4cazhfmbeim5egpejksnv42ce8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda coisa importante Ã© o Replication Controller, que Ã© um gerenciador dos processos que ocorrem no cluster Kubernetes. Permite criar vÃ¡rias instÃ¢ncias de lareiras e monitorar suas condiÃ§Ãµes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando vocÃª diz que deseja iniciar algum processo, significa que ele funcionarÃ¡ o tempo todo em algum lugar do cluster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O terceiro elemento importante Ã© o ServiÃ§o, um conjunto de lares colaborativos. Sua implantaÃ§Ã£o Ã© baseada na determinaÃ§Ã£o dinÃ¢mica do estado desejado - onde os aplicativos devem funcionar, com qual endereÃ§o IP etc., para que vocÃª precise de algum tipo de serviÃ§o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O quarto elemento sÃ£o os repositÃ³rios Volumes, que podem ser visualizados como diretÃ³rios disponÃ­veis para contÃªineres na lareira. O Kubernetes possui diferentes tipos de volumes que determinam como essa loja Ã© criada e o que ela contÃ©m. O conceito de Volume tambÃ©m estava presente no Docker, mas o problema era que o armazenamento era limitado a uma lareira especÃ­fica. TÃ£o logo deixou de existir, o Volume desapareceu com ele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O armazenamento que o Kubernetes cria nÃ£o se limita a nenhum contÃªiner. Ele suporta todos ou alguns contÃªineres implantados dentro da lareira. Uma das principais vantagens do Kubernetes Volume Ã© o suporte a vÃ¡rios tipos de armazenamento que o Pod pode usar simultaneamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver o que Ã© um contÃªiner. Este Ã© o formato da imagem em que nosso aplicativo com todas as dependÃªncias Ã© compactado e a principal configuraÃ§Ã£o do ambiente de tempo de execuÃ§Ã£o, mostrando como esse aplicativo deve funcionar. Esses sÃ£o dois elementos diferentes, embora vocÃª possa incluir o que quiser, especialmente o Root Filesystem como um arquivo tar Tarball compactado que contÃ©m muitos arquivos de configuraÃ§Ã£o para um sistema especÃ­fico. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/lg/9w/edlg9wz2ttlinfb3udleerb0id0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em seguida, podemos executar a distribuiÃ§Ã£o, um processo que Ã© familiar a todos - o RPM ou outro sistema de repositÃ³rio Ã© usado aqui. VocÃª pega todas essas coisas e as coloca no repositÃ³rio. Esse processo Ã© muito semelhante ao que fazemos com pacotes de SO, apenas para contÃªineres criados a partir de imagens.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pe/4p/dg/pe4pdggvudbe3l5ufp5l6gei6pc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Pod permite compor tudo o que nosso aplicativo lÃ³gico precisa. Um aplicativo lÃ³gico Ã© uma ferramenta para gerenciar vÃ¡rios aplicativos no mesmo perfil do sistema. Um sub Ã© um pacote de recursos que inclui um ou mais contÃªineres e armazenamentos, um espaÃ§o para nome comum e um endereÃ§o IP por sub. Os cofres podem ser distribuÃ­dos entre contÃªineres.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ht/rw/cf/htrwcfvuetyk6vhgqjh6zgsjeoe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, o design da lareira se assemelha a uma mÃ¡quina virtual. Ele garante que o aplicativo inicie e pare como uma unidade atÃ´mica. O prÃ³ximo slide mostra como Ã© o controlador de replicaÃ§Ã£o. Se eu enviar esta declaraÃ§Ã£o para o servidor e disser: "Ei, eu quero que uma rÃ©plica do aplicativo" Foo "funcione!", O controlador a criarÃ¡ a partir do modelo e a enviarÃ¡ ao agendador, que colocarÃ¡ o aplicativo no NÃ³ 1. NÃ£o especificamos em qual mÃ¡quina ela deve funcionar, embora possamos fazÃª-lo. Agora aumente o nÃºmero de rÃ©plicas para 3. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ta/qe/ld/taqeldbd6scvq7oyst2ff3dooyu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que aÃ§Ãµes vocÃª espera do sistema se uma das mÃ¡quinas falhar? Nesse caso, o controlador de replicaÃ§Ã£o levarÃ¡ o estado atual do sistema ao estado desejado, movendo-o sob o contÃªiner da terceira mÃ¡quina que nÃ£o estÃ¡ funcionando para a segunda.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oy/d7/_i/oyd7_i1a1dvfpllkj_s7hek_37e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª nÃ£o precisa se aprofundar nesse processo e direcionÃ¡-lo - confiando o trabalho ao controlador, pode ter certeza de que o aplicativo serÃ¡ assegurado adequadamente, monitorando constantemente as mudanÃ§as no estado atual da infraestrutura e tomando decisÃµes que garantam que o sistema esteja funcionando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas coisas estÃ£o Ã  frente do tempo delas - vocÃª apenas diz ao sistema: â€œQuero que essas trÃªs mÃ¡quinas funcionem!â€, E Ã© aÃ­ que o seu controle termina. Essa abordagem Ã© muito diferente de scripts e automaÃ§Ã£o pura, quando vocÃª realmente precisa gerenciar o que estÃ¡ acontecendo agora para influenciar a decisÃ£o futura. VocÃª nÃ£o pode codificar tudo isso sem a capacidade de receber informaÃ§Ãµes de entrada para responder adequadamente Ã  situaÃ§Ã£o. A abordagem descrita acima fornece essa oportunidade.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como vocÃª imagina a configuraÃ§Ã£o - o conceito de arquivos de configuraÃ§Ã£o para serviÃ§os? Muitas pessoas ficam caladas sobre esse problema quando se trata de contÃªineres, mas ainda precisamos de configuraÃ§Ã£o, ele nÃ£o desaparece em lugar nenhum! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Kubernetes tambÃ©m usa o conceito Secrets, que Ã© usado para armazenar e transferir dados criptografados entre gerentes e nÃ³s do Nods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nunca executamos o Puppet em um contÃªiner porque nÃ£o hÃ¡ razÃ£o para fazer isso. VocÃª pode usar o Puppet para gerar um arquivo de configuraÃ§Ã£o, mas ainda deseja armazenÃ¡-lo no Kubernetis, pois permite distribuÃ­-lo usando o tempo de execuÃ§Ã£o. Vamos ver como fica.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/i3/f3/vvi3f3c-8dhftpdedfe23me1xbg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste exemplo, criamos um segredo a partir de um arquivo e o salvamos no servidor da API Kubernetes. VocÃª pode imaginar que substituiu esta parte por algo como Puppet, que usa o modelo eRB e dados ocultos para preencher o conteÃºdo do segredo - nÃ£o importa quem o faÃ§a, mas vocÃª pode fazÃª-lo de qualquer maneira. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o segredo estÃ¡ no lugar, ele pode servir como um link para criar uma implantaÃ§Ã£o que diz: "Quero usar esse segredo!" Nesse caso, o Kubernetes faz o seguinte.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/cm/um/nu/cmumnufkw4ffxmhcggn2ppulcva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ele cria um pod, pega os dados em segredo, os coloca em um sistema de arquivos temporÃ¡rio e os apresenta como um contÃªiner, assim como o Puppet cria uma cÃ³pia em uma mÃ¡quina. Isso segue o ciclo de vida do aplicativo e, quando o aplicativo morre, a configuraÃ§Ã£o desaparece com ele. Se vocÃª precisar de 10.000 instÃ¢ncias de aplicativos, precisarÃ¡ criar e injetar em menos de 10.000 sistemas de arquivos temporÃ¡rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ServiÃ§os permite executar todos esses elementos em um cluster e sincronizÃ¡-los com outro ponto de extremidade. De fato, um serviÃ§o Ã© um grupo de lareiras que funcionam como uma Ãºnica lareira. Ele contÃ©m um endereÃ§o IP e uma porta permanentes, fornece integraÃ§Ã£o ao DNS, usa balanceamento de carga e Ã© atualizado quando o firmware Ã© alterado.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8t/cr/co/8tcrcolf5hrgnqfcrdf3nzkdr2a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, vejamos a colaboraÃ§Ã£o dos componentes conceituais do Kubernetes. Temos peÃ§as e configuraÃ§Ãµes de Lego que precisam interagir entre si. Se vocÃª deseja executar um banco de dados em um cluster, pode realmente fazÃª-lo no Kubernetes. Muitos dizem que vocÃª nÃ£o poderÃ¡ executar aplicativos com estado em contÃªineres, mas isso estÃ¡ completamente errado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se vocÃª pensar em como os hipervisores funcionam, poderÃ¡ entender que eles fazem quase a mesma coisa que vocÃª: crie uma mÃ¡quina virtual, o planejador a move para o hipervisor e anexa o armazenamento. Ã€s vezes, vocÃª trabalha com armazenamento local proveniente do hipervisor e nÃ£o hÃ¡ motivos para que os contÃªineres nÃ£o possam fazer o mesmo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, o problema com os contÃªineres Ã© que a maioria das pessoas nÃ£o estÃ¡ acostumada a ter uma lista explÃ­cita de caminhos de arquivos que eles devem fornecer ao aplicativo. A maioria das pessoas nÃ£o poderÃ¡ informar exatamente os dispositivos e arquivos que o data warehouse precisa. Eles empacotam tudo em contÃªineres e, como resultado, nada de bom vem disso. Portanto, nÃ£o acredite que os contÃªineres nÃ£o sejam capazes de executar aplicativos de economia de estado - vocÃª pode muito bem fazer isso. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bj/hm/ve/bjhmvetwbvkbjbqirup-xb_ya-0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No slide, vocÃª vÃª um exemplo de Ruby-on-Rails e, antes de podermos usar nosso aplicativo, precisamos migrar o banco de dados. Vamos Ã  demonstraÃ§Ã£o ao vivo do programa. Para realizar a implantaÃ§Ã£o, eu uso MY_SQL e vocÃª vÃª muitos dados na tela.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dp/ai/or/dpaioryaowiq9c4yevmvd9uqkqg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estou mostrando tudo isso porque, como administrador do sistema, vocÃª precisa entender muitas coisas. Nesta implantaÃ§Ã£o, refino alguns dos metadados do meu aplicativo, mas a principal coisa que destacarei em cinza: quero iniciar 1 cÃ³pia do aplicativo mysql e usar o contÃªiner mysql versÃ£o 5.6.32. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/kr/ev/qvkrev67_otmvqqvdhtiha07mec.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que aqui eu seleciono algum segredo do Kubernetes como links, que neste caso vou injetar como variÃ¡veis â€‹â€‹de ambiente. Mais tarde, mostrarei outro caso quando os inserirmos no sistema de arquivos. Portanto, nÃ£o preciso â€œguardarâ€ segredos em minha configuraÃ§Ã£o. A prÃ³xima linha importante Ã© o bloco de recursos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hm/b4/jt/hmb4jtgyd1dupdt4dfoapzcppli.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VocÃª nÃ£o pode jogar Tetris atÃ© saber o tamanho dos blocos. </font><font style="vertical-align: inherit;">Muitas pessoas comeÃ§am a implantar sem usar limites de recursos para esse processo. </font><font style="vertical-align: inherit;">Como resultado, a RAM estÃ¡ completamente entupida e vocÃª "empilha" o servidor inteiro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22:09 min </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para continuar em breve ...</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/HlAXp0-M6SY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. VocÃª gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analÃ³gico exclusivo de servidores </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bÃ¡sicos </font></font></a><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">que foi inventado por nÃ³s para vocÃª: </font></b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 nÃºcleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></a><font style="vertical-align: inherit;"> (as opÃ§Ãµes estÃ£o disponÃ­veis com RAID1 e RAID10, atÃ© 24 nÃºcleos e atÃ© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em AmsterdÃ£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente nÃ³s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um prÃ©dio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt503960/index.html">Como a classificaÃ§Ã£o do Linux classifica seqÃ¼Ãªncias de caracteres</a></li>
<li><a href="../pt503962/index.html">DireÃ§Ã£o AutÃ´noma - exagere nos carros, mas a necessidade de serviÃ§os de rede de data center</a></li>
<li><a href="../pt503964/index.html">DataStore - CRUD (Criar exclusÃ£o de atualizaÃ§Ã£o de leitura)</a></li>
<li><a href="../pt503966/index.html">O aplicativo Social Monitoring foi criado a partir de um rastreador de caminhÃ£o de lixo</a></li>
<li><a href="../pt503968/index.html">Como fazer o robÃ´ se mover com precisÃ£o? VisÃ£o geral e recursos da robÃ³tica da plataforma Studuino</a></li>
<li><a href="../pt503972/index.html">Teste de streaming em 4 redes sociais e escolha a melhor opÃ§Ã£o</a></li>
<li><a href="../pt503980/index.html">Monitorar a temperatura em um local remoto por meios "improvisados"</a></li>
<li><a href="../pt503982/index.html">Sobre orcs e estruturas</a></li>
<li><a href="../pt503988/index.html">Como a "luz rodopiante" entrou nas redes Ã³pticas</a></li>
<li><a href="../pt503990/index.html">Estou cansado do fato de que programadores comuns personificam desenvolvedores e desonram o setor. Eles pioram o mundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>