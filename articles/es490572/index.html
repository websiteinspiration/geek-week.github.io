<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüíº üíÜ üõ•Ô∏è Piloto autom√°tico casero en una placa de computadora de placa √∫nica (SBC) y Arduino DUE üéÑ üÖ±Ô∏è üïí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La idea de construir un piloto autom√°tico surgi√≥ hace aproximadamente 2 a√±os. Quer√≠a crear un aparato totalmente aut√≥nomo capaz de llegar del punto A ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Piloto autom√°tico casero en una placa de computadora de placa √∫nica (SBC) y Arduino DUE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490572/"><img src="https://habrastorage.org/getpro/habr/post_images/61d/7fa/23b/61d7fa23bfc1c4a76018dbf13eb0adb6.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea de construir un piloto autom√°tico surgi√≥ hace aproximadamente 2 a√±os. </font><font style="vertical-align: inherit;">Quer√≠a crear un aparato totalmente aut√≥nomo capaz de llegar del punto A al punto B con la posibilidad de evitar colisiones y volar alrededor de obst√°culos, capaz de superar zonas de interferencia o la ausencia de una se√±al de sat√©lite. </font><font style="vertical-align: inherit;">Tambi√©n quer√≠a tener un control conveniente y simple con el mouse, ya que se implementa en juegos (estrategias) que controlan el movimiento del avi√≥n con la ayuda de puntos. </font><font style="vertical-align: inherit;">Tuve que comenzar todo desde cero, como este art√≠culo, as√≠ que si hay errores, escr√≠balo en los comentarios. </font><font style="vertical-align: inherit;">Comenzar√© en orden.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hardware</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, no sab√≠a qu√© hardware es mejor usar para este proyecto, pero al final llegu√© a la conclusi√≥n de que la mejor opci√≥n ser√≠a un mont√≥n de microcontrolador (MK) + computadora de placa √∫nica. Cuando MK resuelve el problema de la estabilizaci√≥n de una aeronave (LA), su movimiento en un rumbo y altitud determinados, y una computadora de una sola placa resuelve el problema de navegaci√≥n y movimiento a lo largo de una ruta. Dado que el plan era evitar colisiones, la computadora ten√≠a que ser lo suficientemente potente como para procesar la informaci√≥n de los sensores de detecci√≥n de obst√°culos, compacta y no demasiado cara en ese momento. TinkerBoard era el m√°s adecuado para esta descripci√≥n, Raspbery era entonces 3B + y ten√≠a caracter√≠sticas muy inferiores. Como MK, quer√≠a tener un controlador compatible con Arduino porque Arduino ten√≠a una gran base de bocetos listos y, por lo tanto, la elecci√≥n recay√≥ en DUE 84 MHz, 32 bits ARM Cortex-M3 porque√©l era el m√°s poderoso y ten√≠a que compensar la franqueza de mis manos)).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, plane√© usar el MPU 9250 con un filtro Majevik como sensores de orientaci√≥n, y sus resultados fueron excelentes. La principal ventaja de esta opci√≥n era que todos los c√°lculos, incluida la calibraci√≥n de los sensores (aceler√≥metro, giroscopio y magnet√≥metro), se realizaban en el MK. Pero hab√≠a un problema, el filtro compensaba poco la aceleraci√≥n lineal, que se produce constantemente durante los golpes o un cambio brusco de rumbo. Esto se expresa en las lecturas de cabeceo y balanceo, en el momento de la aceleraci√≥n comienzan a alejarse flotando, y pasando a trav√©s del regulador proporcionalmente diferencial (PD) y especialmente la parte diferencial, la flotaci√≥n cre√≥ problemas. Por lo tanto, tuve que usar un sensor con un filtro BNO 055 ya implementado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A diferencia del MPU 9250, el BNO tiene integrado el Cortex M0 MK integrado, que calcula inmediatamente la orientaci√≥n en √°ngulos de Euler, la orientaci√≥n absoluta en cuaternina y calcula la aceleraci√≥n lineal, aunque este sensor tambi√©n tiene varias desventajas. El principal problema de este sensor es la autocalibraci√≥n, o mejor dicho, que no se puede apagar, es un "ajuste" de este sensor y esta calibraci√≥n tiene una propiedad desagradable de desaparecer, a veces de forma absolutamente repentina incluso estando en un solo lugar sin movimiento. Esto se refleja principalmente en la gui√±ada que est√° unida al magnet√≥metro en este sensor y debe mostrar la direcci√≥n hacia el polo norte magn√©tico (curso), pero a veces muestra 100 grados en estrona, y luego, despu√©s de la calibraci√≥n, puede volver))). En otros asuntos, el problema del curso a√∫n se puede resolver utilizando la sincronizaci√≥n con GPS. De lo contrario, el sensor funciona bien,siempre determina el cabeceo y balanceo correctamente, y las aceleraciones lineales no afectan en gran medida su trabajo, a menos, por supuesto, que la aceleraci√≥n no exceda de 2G, porque Este umbral se utiliza para medir el vector de gravedad y compensar la deriva de los giroscopios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resto del conjunto de hierro es el siguiente: GPS Ublox Neo M8N con salida USB, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bar√≥metro BMP 280, sonda HSCR 04 para recibir datos sobre disponibilidad en el suelo y velocidad vertical m√°s precisa, EEPROM 24c16 para almacenar datos de calibraci√≥n y configuraciones PID, m√≥dulo Neoway M509E GSM para enviar mensajes sobre las coordenadas de la aeronave en caso de accidente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El diagrama funcional se muestra en la Figura 1: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/7f7/9e3/9df/7f79e39df3579c4508abd884aba32236.png" alt="imagen"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 1 - Diagrama funcional del piloto autom√°tico</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Software</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para el desarrollo de software, uso QT junto con QT Creator IDE. me es muy familiar y, gracias a la funcionalidad multiplataforma, puedo ejecutar mis programas tanto en una PC de una sola placa con Debian como en un escritorio con Windows, lo cual es muy conveniente. Para desarrollar el software del microcontrolador, se utiliza el IDE Arduino. Para mayor claridad, intentar√© presentar todas las secciones de la Figura 2. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/6fa/dcb/48d/6fadcb48dd175a45e40ca07bf2870961.png" alt="imagen"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 2. - Arquitectura del AP (BNO 080 agregado para el futuro).</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
1) Interfaz gr√°fica de control: es un mapa satelital con la ayuda de la cual se controla el avi√≥n. El programa de visualizaci√≥n de im√°genes satelitales en s√≠ no es m√≠o, fue robado por m√≠ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (su autor tambi√©n trat√≥ de hacer algo similar).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede controlar la aeronave utilizando puntos (marcadores) o botones WADS. Para controlar los puntos, es necesario establecer la ruta de vuelo con marcadores verdes, se colocan con el mouse (RMB) y hacer clic en cargar ruta, o usar el marcador de movimiento instant√°neo (rojo) (LMB) y luego el avi√≥n desde la posici√≥n actual volar√° a este punto, para su operaci√≥n es necesario establecer casilla de verificaci√≥n en la casilla de verificaci√≥n "Manual" de clics accidentales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos los par√°metros de marcador se ingresan en los campos apropiados en el formulario, puede eliminar los marcadores haciendo doble clic en el bot√≥n central del mouse, mientras que a√∫n permanecer√°n en la memoria del avi√≥n, debe usar el bot√≥n Eliminar ruta para eliminarlos de la memoria. Al llegar al punto, como en las estrategias de la aeronave, girar√° a su alrededor. Control de botones WADS controla directamente los volantes usando controladores PD. Cuando se presiona cada bot√≥n, se ingresa un valor a la entrada del controlador, por ejemplo, cuando se presiona S, el tono 30 y cuando se suelta es 0. Cuando se presiona W -30, etc. WADS se activa mediante casillas de verificaci√≥n: "manual", "botones". Este modo ayuda a verificar la funcionalidad de todos los timones antes de comenzar. La interfaz gr√°fica se ejecuta en la computadora port√°til, los comandos de control desde la interfaz gr√°fica que usa el socket TCP se transfieren al kernel. La interfaz de control gr√°fico se muestra en la Figura 3:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/687/2ad/ff3/6872adff36543236e64e5f75af0842cd.jpg" alt="imagen"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 3 - Interfaz gr√°fica de gesti√≥n.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) El n√∫cleo del piloto autom√°tico es esa parte del software que se calcula en una computadora de placa √∫nica TinkerBoard. </font><font style="vertical-align: inherit;">El n√∫cleo es responsable de la navegaci√≥n y el movimiento a lo largo de la ruta. </font><font style="vertical-align: inherit;">Para hacer esto, se conecta un sensor GPS a la computadora. </font><font style="vertical-align: inherit;">Al usarlo, puede obtener la posici√≥n actual de la aeronave (latitud y longitud) y comparar esta posici√≥n con lo que est√° en la ruta de vuelo. </font><font style="vertical-align: inherit;">Como resultado de esta operaci√≥n, se obtiene el acimut al objetivo, que se env√≠a al microcontrolador junto con el resto de los par√°metros de vuelo. </font><font style="vertical-align: inherit;">En el futuro, el kernel puede equiparse con su sensor IMU para implementar el ANN. </font><font style="vertical-align: inherit;">Por ejemplo, puede usar BNO 080 para integrar, acelerar y obtener velocidad, y al integrar la velocidad, obtener la distancia. </font><font style="vertical-align: inherit;">La distancia recibida del ANN deber√° traducirse al sistema de coordenadas GPS (latitud y longitud) para su uso en el c√°lculo del acimut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tal ANN puede usarse junto con un sensor GPS en caso de p√©rdida temporal de comunicaci√≥n con el sat√©lite para que la aeronave no pierda un "giro" a un punto. En el momento de la operaci√≥n desde el GPS, el ANN se ajustar√° constantemente por sus lecturas y completar√° los espacios entre los per√≠odos de actualizaci√≥n del sensor GPS. Del mismo modo, el algoritmo de visi√≥n artificial o SLAM debe ajustarse cambiando la altura del punto y creando sesgos del acimut calculado. Una vez que se completa el c√°lculo de la ruta, el n√∫cleo env√≠a datos UART: acimut, altitud, √°ngulo de ataque, tipo de punto y tambi√©n si es necesaria la rotaci√≥n alrededor de este punto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) El microcontrolador ejecuta los comandos principales, la tarea principal del MK es seguir el curso dado a una altura determinada. Para esto, el MKU est√° equipado con un sensor IMU BNO 055, un bar√≥metro bmp 280 y un sonar. Para el movimiento a lo largo del curso, se utiliza el acimut obtenido del n√∫cleo, se compara con la velocidad actual y el desajuste resultante se transmite a los controladores PD para gui√±ar y rodar. El control de tono se lleva a cabo mediante 2 controladores PD: el primero determina la falta de coincidencia de las alturas actual y predeterminada, que se alimenta a la entrada del segundo controlador, mientras que la salida del controlador de altura est√° limitada por el √°ngulo de ataque actual para controlar su conjunto. Si en la interfaz gr√°fica se selecciona el tipo de punto para despegar o aterrizar, se utiliza un sonar para determinar la altura. Su testimonio se combina con los datos del bar√≥metro,para determinar con mayor precisi√≥n la distancia al suelo y la velocidad vertical. Adem√°s de las funciones b√°sicas, MK tambi√©n recopila telemetr√≠a sobre el funcionamiento de los sensores IMU, la direcci√≥n y altitud actuales, los transfiere al n√∫cleo, donde estos datos se complementan con datos del GPS e ingresan a la interfaz gr√°fica.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusi√≥n </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por el momento, el piloto autom√°tico todav√≠a est√° en la etapa de prueba de vuelo y no est√° completamente configurado. </font><font style="vertical-align: inherit;">Sin embargo, pas√© solo dos inicios y a√∫n no he recogido los coeficientes para los reguladores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, los reguladores de DP me parecen inestables y quiero reemplazarlos por algo m√°s confiable, especialmente porque ya est√°n desactualizados. </font><font style="vertical-align: inherit;">Tambi√©n es necesario reemplazar los c√°lculos con √°ngulos de Euler con c√°lculos en cuaterniones, porque </font><font style="vertical-align: inherit;">estos √∫ltimos se comportan de manera m√°s estable cuando giran la aeronave en √°ngulos superiores a 120 grados y vuelan durante el viento.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una toma m√°s detallada de la avi√≥nica</font></font></b>
                        <div class="spoiler_text"> <br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/d4d/ff2/ca1/d4dff2ca14a27c848142db0092ba0c9b.jpg" alt="imagen"><br>
<br>
</div>
                    </div><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlace al c√≥digo fuente del veneno (con bibliotecas) </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github aqu√≠ solo la fuente pero m√°s reciente</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es490558/index.html">Evangelistas contra hombres lobo</a></li>
<li><a href="../es490560/index.html">Hackathon desde cero en dos semanas</a></li>
<li><a href="../es490566/index.html">Entornos de implementaci√≥n de software</a></li>
<li><a href="../es490568/index.html">Disparo de pl√°stico: munici√≥n at√≠pica</a></li>
<li><a href="../es490570/index.html">Ir: ¬øDebo usar un puntero en lugar de una copia de mi estructura?</a></li>
<li><a href="../es490574/index.html">¬øQu√© tienen en com√∫n la recursividad, las p√°ginas de destino y el marketing de contenidos? Dice el fundador de la agencia Embacy</a></li>
<li><a href="../es490576/index.html">Ba√±o ultras√≥nico. Parte 1</a></li>
<li><a href="../es490578/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 335 (24 de febrero - 1 de marzo)</a></li>
<li><a href="../es490584/index.html">Infineon ha implementado certificados de firma cruzada en sus chips criptogr√°ficos</a></li>
<li><a href="../es490586/index.html">¬øQu√© es Spring Framework? De la inyecci√≥n de dependencia a MVC web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>