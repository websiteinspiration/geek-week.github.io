<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ üë©üèº‚Äçüç≥ üëçüèæ Stas Afanasyev. Juno. Pipelines baseados em io.Reader / io.Writer. Parte 2 üë©üèº‚Äçüè´ üë®üèø‚Äçüîß üìñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No relat√≥rio, falaremos sobre o conceito de io.Reader / io.Writer, por que eles s√£o necess√°rios, como implement√°-los corretamente e que armadilhas exi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Stas Afanasyev. Juno. Pipelines baseados em io.Reader / io.Writer. Parte 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/491524/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No relat√≥rio, falaremos sobre o conceito de io.Reader / io.Writer, por que eles s√£o necess√°rios, como implement√°-los corretamente e que armadilhas existem a esse respeito, bem como sobre a constru√ß√£o de pipelines com base em implementa√ß√µes padr√£o e personalizadas de io.Reader / io.Writer .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rd/nv/uj/rdnvujcjwsukejxq_6a9syayawu.jpeg"><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stas Afanasyev. </font><font style="vertical-align: inherit;">Juno. </font><font style="vertical-align: inherit;">Pipelines baseados em io.Reader / io.Writer. </font><font style="vertical-align: inherit;">Parte 1</font></font></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bug "na confian√ßa"</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra nuance: nesta implementa√ß√£o, h√° um "bagul". </font><font style="vertical-align: inherit;">Este bug √© confirmado pelos desenvolvedores (escrevi a eles sobre isso). </font><font style="vertical-align: inherit;">Talvez algu√©m saiba o que √© esse "bagul"? </font><font style="vertical-align: inherit;">No slide, est√° a pen√∫ltima linha: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c9/kc/xj/c9kcxjodwjtycg7o2n62tfavto0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
est√° associada a muita confian√ßa no Reader empacotado: se o Reader retornar um n√∫mero negativo de bytes, o limite que gostar√≠amos de obter pelo n√∫mero de bytes subtra√≠dos aumenta. </font><font style="vertical-align: inherit;">E, em alguns casos, esse √© um bug muito s√©rio que voc√™ n√£o consegue entender imediatamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu escrevi na edi√ß√£o: vamos fazer alguma coisa, vamos consertar! E ent√£o uma camada de problemas foi revelada ... Primeiro, eles me disseram que se voc√™ adicionar essa verifica√ß√£o agora aqui, precisar√° adicion√°-la em todos os lugares, e h√° uma d√∫zia desses lugares. Se queremos mudar isso para o lado do cliente, precisamos determinar um n√∫mero de regras pelas quais o cliente validar√° os dados (e tamb√©m podem haver cinco ou dois). Acontece que tudo isso precisa ser copiado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu concordo que isso n√£o √© o ideal. Ent√£o vamos a uma vers√£o consistente! Por que temos uma implementa√ß√£o da biblioteca padr√£o que n√£o confia em nada, enquanto outros confiam em absolutamente tudo?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, enquanto eu escrevia minha opini√£o c√≠vica, refletindo sobre o assunto, encerramos a quest√£o com coment√°rios: ‚ÄúN√£o faremos nada. </font><font style="vertical-align: inherit;">Tchau"! </font><font style="vertical-align: inherit;">Eles me fizeram parecer um tipo de idiota ... Educadamente, √© claro, voc√™ n√£o encontra falhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, agora temos um problema. </font><font style="vertical-align: inherit;">Consiste no fato de que n√£o est√° claro quem deve validar os dados do Reader empacotado. </font><font style="vertical-align: inherit;">Ou o cliente, ou confiamos totalmente no contrato ... Temos uma solu√ß√£o! </font><font style="vertical-align: inherit;">Se ainda houver tempo, eu falarei sobre isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos para o pr√≥ximo caso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teereader</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vimos um exemplo de como agrupar dados do Reader. O pr√≥ximo exemplo de canal √© ultrapassar os dados do Reader no Writer. Existem duas situa√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeira situa√ß√£o Precisamos ler os dados do Reader, copi√°-los para o Writer (de forma transparente) e trabalhar com eles como no Reader. Existe uma implementa√ß√£o do TeeReader para isso. √â apresentado no trecho de implementa√ß√£o superior: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ef/rl/jy/efrljy0zmyzxqk-7cbsbdkqialw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funciona como a equipe de Tee no Unix. Eu acho que muitos de voc√™s j√° ouviram falar disso.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que esta implementa√ß√£o verifica o n√∫mero de bytes que l√™ do Reader empacotado. Veja as condi√ß√µes na segunda linha? Porque quando voc√™ escreve essa implementa√ß√£o, fica intuitivamente claro: no caso de um n√∫mero negativo, voc√™ entrar√° em p√¢nico. E este √© outro lugar em que confiamos no leitor embrulhado! Lembro que essas s√£o todas as bibliotecas padr√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos passar para um caso, por exemplo, como us√°-lo. O que faremos no trecho inferior? Baixaremos o arquivo robot.txt do golang.org usando o cliente http padr√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ sabe, o cliente http nos retorna uma estrutura de resposta, na qual o campo Corpo √© uma implementa√ß√£o da interface do Reader. </font><font style="vertical-align: inherit;">Deve ser esclarecido dizendo que esta √© uma implementa√ß√£o da interface ReadCloser. </font><font style="vertical-align: inherit;">Mas o ReadCloser √© apenas uma interface criada a partir do Reader e do Closer. </font><font style="vertical-align: inherit;">Ou seja, este √© um Reader, que pode, em geral, ser fechado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste exemplo (no snippet inferior), coletamos o TeeReader, que ler√° os dados deste corpo e os gravar√° em um arquivo. </font><font style="vertical-align: inherit;">A cria√ß√£o do arquivo hoje, infelizmente, permaneceu nos bastidores, porque tudo n√£o se encaixava. </font><font style="vertical-align: inherit;">Mas, novamente, se voc√™ olhar para o dendograma, o tipo de arquivo implementa a interface do Writer, ou seja, podemos escrever para ele. </font><font style="vertical-align: inherit;">√â √≥bvio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Montamos nosso TeeReader e o lemos usando ReadAll. </font><font style="vertical-align: inherit;">Tudo funciona como esperado: subtra√≠mos o corpo resultante, escrevemos em um arquivo e o vemos em Assad.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maneira iniciante</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda situa√ß√£o. </font><font style="vertical-align: inherit;">S√≥ precisamos ler os dados do Reader e grav√°-los no Writer. </font><font style="vertical-align: inherit;">A solu√ß√£o √© √≥bvia ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando comecei a trabalhar com o Go, resolvi problemas como em um slide: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yu/yh/wx/yuyhwxfzki71ar1yp2myfgjffdc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
localizei o buffer, preenchi-o com dados do Reader e transferi a fatia preenchida para o Writer. </font><font style="vertical-align: inherit;">Tudo √© simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dois pontos. </font><font style="vertical-align: inherit;">Em primeiro lugar, n√£o h√° garantia de que todo o Reader seja subtra√≠do em uma chamada para o m√©todo Read, pois pode haver dados restantes (no bom sentido, isso deve ser feito em loop). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo ponto √© que esse caminho n√£o √© o ideal. </font><font style="vertical-align: inherit;">Aqui est√° um c√≥digo bastante padronizado, escrito antes de n√≥s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para isso, h√° uma fam√≠lia especial de ajudantes na biblioteca padr√£o - s√£o Copy, CopyN e CopyBuffer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">io.Copy. </font><font style="vertical-align: inherit;">WriterTo e ReaderFrom</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
io.Copy basicamente faz o que era no slide anterior: ele aloca um buffer padr√£o de 32 KB e grava dados do Reader no Writer (a assinatura desta c√≥pia √© mostrada no snippet superior): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lx/wi/bd/lxwibd_hiz09op5baq0-d77ukrk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m dessa rotina de modelo, ela tamb√©m cont√©m uma s√©rie de otimiza√ß√µes complicadas. </font><font style="vertical-align: inherit;">E antes de falarmos sobre essas otimiza√ß√µes, precisamos nos familiarizar com mais duas interfaces:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WriterTo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReadFrom.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Situa√ß√£o hipot√©tica. O seu Reader trabalha com um buffer de mem√≥ria. Ele j√° o mudou, escreve, l√™ algo a partir da√≠, ou seja, um lugar sob ele j√° foi realocado. Voc√™ quer ler este leitor em algum lugar do lado de fora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J√° vimos como isso acontece: um buffer √© criado, o buffer √© passado, que √© passado para o m√©todo Read; O Reader, que trabalha com mem√≥ria, joga-o fora da pe√ßa replicada ... Mas isso n√£o √© mais o ideal - o local foi reposicionado. Por que fazer de novo? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/0h/sd/0b/0hsd0ba3ikgudka2q1ujxt9rtbc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em algum lugar h√° 5 a 6 anos (h√° um link para a lista de altera√ß√µes), foram feitas duas interfaces: WriteTo e ReadFrom, que s√£o implementadas localmente. O Reader implementa WriteTo e o Writer implementa ReadFrom. Acontece que o Reader, com uma fatia com os dados j√° replicados, pode evitar um local adicional e aceitar os m√©todos Write To Writer e passar um buffer dispon√≠vel no interior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que a implementa√ß√£o de bytes.Buffer e bufio funciona. </font><font style="vertical-align: inherit;">E se voc√™ olhar o dendrograma novamente, ver√° que essas duas interfaces n√£o s√£o muito populares. </font><font style="vertical-align: inherit;">Eles s√£o implementados apenas para os tipos que trabalham com o buffer interno - onde a mem√≥ria j√° foi realocada. </font><font style="vertical-align: inherit;">Isso n√£o ajudar√° voc√™ a evitar eloq√º√™ncia todas as vezes, mas apenas se voc√™ j√° estiver trabalhando com uma pe√ßa realocada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ReaderFrom funciona de maneira semelhante (√© implementado apenas pelo Writer). </font><font style="vertical-align: inherit;">O ReaderFrom l√™ o Reader inteiro, que √© um argumento para ele (antes do EOF) e grava em algum lugar na implementa√ß√£o interna do Writer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementa√ß√£o CopyBuffer</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este trecho mostra a implementa√ß√£o do auxiliar copyBuffer. Este copyBuffer n√£o export√°vel √© usado sob o cap√¥ de io.Copy, CopyN e CopyBuffer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui h√° uma pequena nuance que vale a pena mencionar. CopyN foi recentemente otimizado - desamarrado dessa l√≥gica. Essa √© exatamente a otimiza√ß√£o sobre a qual falei anteriormente: antes de criar um buffer adicional de 32 KB, √© feita uma verifica√ß√£o - talvez a fonte de dados implemente a interface WriterTo e esse buffer adicional n√£o seja necess√°rio? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se isso n√£o acontecer, verificamos: talvez o Writer implemente o ReaderFrom para conect√°-los sem esse intermedi√°rio? Se isso n√£o acontecer, a √∫ltima esperan√ßa permanece: talvez tenhamos recebido algum tipo de buffer realocado que poder√≠amos usar? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lz/yr/3q/lzyr3qrkehj5qudwoerwitlr6uq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â assim que a io.Copy funciona.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma quest√£o, que √© uma semi-proposta, um semi-bug - n√£o est√° claro o que. </font><font style="vertical-align: inherit;">Est√° pendurado h√° um ano e meio. </font><font style="vertical-align: inherit;">Parece assim: CopyBuffer est√° semanticamente incorreto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, n√£o h√° assinatura para este copyBuffer, mas ele se parece exatamente com esse m√©todo n√£o export√°vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voc√™ chama copyBuffer na esperan√ßa de evitar um local adicional, transfere algum tipo de byte de fatia realocado para l√°, a seguinte l√≥gica funciona: se o Reader ou o Writer implementarem as interfaces WriterTo e ReaderFrom, n√£o haver√° garantia de que voc√™ poder√° evitar esse local. </font><font style="vertical-align: inherit;">Isso foi aceito como uma proposta e prometeu pensar nisso no Go 2.0. </font><font style="vertical-align: inherit;">Por enquanto, voc√™ s√≥ precisa saber.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhe com io.Pipe. </font><font style="vertical-align: inherit;">PipeReader e pipeWriter</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro caso: voc√™ precisa obter dados do Writer de alguma forma no Reader. Caso de vida bonito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que voc√™ j√° possui alguns dados, eles implementam a interface do Reader - tudo fica claro com isso. Voc√™ precisa compactar esses dados, ‚Äúajust√°-los‚Äù e envi√°-los ao S3. Qual √© a nuance? .. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quem trabalhou com o tipo gzip no pacote compess sabe que o pr√≥prio gzip'er √© apenas um proxy: ele coleta dados, implementa a interface Writer, grava os dados, algo far√° com eles e ent√£o eu tenho que deix√°-los em algum lugar. No construtor, √© necess√°ria uma implementa√ß√£o da interface do Writer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, aqui precisamos de algum tipo de gravador intermedi√°rio, onde descartamos os dados j√° compactados que s√£o arquivados no primeiro est√°gio. Nosso pr√≥ximo passo √© fazer o upload desses dados para o S3. E o cliente padr√£o da AWS aceita a interface io.Reader como fonte de dados. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-u/ai/hl/-uaihlpfwlyjeil6iorgelvue2a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O slide mostra o pipeline - mostra como fica: precisamos ultrapassar os dados do Reader para o Writer, do Writer para o Reader. Como fazer isso? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A biblioteca padr√£o possui um recurso interessante - io.Pipe. Ele retorna dois valores: pipeReader e pipeWriter. Este par est√° inextricavelmente vinculado. Imagine um ‚Äútelefone para beb√™s‚Äù em copos com cordas: n√£o faz sentido falar em um copo enquanto ningu√©m est√° ouvindo do outro lado ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rf/zm/kj/rfzmkj2jivwatxxbukwdesrxvoe.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que esse io.Pipe faz? </font><font style="vertical-align: inherit;">Ele n√£o ser√° lido at√© que ningu√©m grave os dados. </font><font style="vertical-align: inherit;">E vice-versa, ele n√£o escrever√° nada at√© que ningu√©m leia esses dados do outro lado. </font><font style="vertical-align: inherit;">Aqui est√° um exemplo de implementa√ß√£o: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fk/qa/ze/fkqazendof7z_uoop8kbfzmtxuk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faremos o mesmo aqui. </font><font style="vertical-align: inherit;">Vamos ler o arquivo robot.txt, que foi lido antes, compact√°-lo usando nosso gzip e envi√°-lo para o S3.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na primeira linha, um par √© criado - pipeReader, pipeWriter. </font><font style="vertical-align: inherit;">Em seguida, precisamos executar pelo menos uma goroutine, que ler√° os dados de uma extremidade (um tipo de tubo). </font><font style="vertical-align: inherit;">Neste gorutin, execute o uploader com uma fonte de dados (source - pipeReader).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na pr√≥xima etapa, precisamos compactar os dados. </font><font style="vertical-align: inherit;">N√≥s compactamos os dados e os escrevemos no pipeWriter (ser√° a outra extremidade do pipe), e a goroutine j√° em execu√ß√£o recebe os dados na outra extremidade do pipe e os l√™. </font><font style="vertical-align: inherit;">Quando todo esse sandu√≠che estiver pronto, tudo o que resta √© atear fogo ao pavio ...</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copiar na √∫ltima linha grava dados do corpo no gzip que criamos (ou seja, do Reader para o Writer). </font><font style="vertical-align: inherit;">Tudo isso funciona como esperado.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este exemplo pode ser resolvido de outra maneira. </font><font style="vertical-align: inherit;">Se voc√™ usar qualquer implementa√ß√£o que implemente o Reader e o Writer. </font><font style="vertical-align: inherit;">Voc√™ primeiro grava dados nele e depois os l√™. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi uma demonstra√ß√£o clara de como trabalhar com o io.Pipe.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outras implementa√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© basicamente tudo para mim. Chegamos a implementa√ß√µes interessantes sobre as quais gostaria de falar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ei/9n/wd/ei9nwdzzrqc7ynwdvghvlokaujo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu n√£o disse nada sobre o MultiReader, nem sobre o MultiWriter. E essa √© outra implementa√ß√£o interessante da biblioteca padr√£o, que permite conectar diferentes implementa√ß√µes. Por exemplo, o MultiWriter grava em todos os Writers simultaneamente e o MultiReader l√™ os Leitores sequencialmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra implementa√ß√£o √© chamada limio. Permite definir um limite para subtra√ß√£o. Voc√™ pode definir a velocidade em bytes por segundo na qual seu Reader precisa ser lido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra implementa√ß√£o interessante √© apenas uma visualiza√ß√£o do progresso da leitura - a barra Progress (de algum cara). √â chamado ioprogress. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que eu disse tudo isso? O que eu quis dizer com isso?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ha/eq/hq/haeqhquljxa3dyvbxvhpdgn0cvu.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ precisar implementar de repente as interfaces Reader e Writer, fa√ßa-o corretamente. </font><font style="vertical-align: inherit;">Ainda n√£o existe uma decis√£o √∫nica sobre quem √© respons√°vel pela implementa√ß√£o - assumiremos que todos confiam no contrato. </font><font style="vertical-align: inherit;">Ent√£o voc√™ precisa cumpri-lo impecavelmente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o seu caso estiver trabalhando com um buffer reposicionado, n√£o se esque√ßa das interfaces ReaderFrom e WriterTo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ estiver em um beco sem sa√≠da e precisar de exemplos - consulte a biblioteca padr√£o, existem muitas implementa√ß√µes interessantes nas quais voc√™ pode confiar. </font><font style="vertical-align: inherit;">H√° documenta√ß√£o l√°.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se algo √© completamente incompreens√≠vel para voc√™, fique √† vontade para escrever problemas. </font><font style="vertical-align: inherit;">Os caras l√° s√£o adequados, respondem rapidamente, muito educadamente e com compet√™ncia ajudam voc√™.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/vf/0y/cy/vf0ycy0f6kuyuyuygxoulwpy538.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© tudo para mim. </font><font style="vertical-align: inherit;">Obrigado por vir!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quest√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pergunta da plat√©ia (B): - Eu tenho uma pergunta simples, eu acho. Conte-nos sobre alguns casos de uso da vida: quais foram usados ‚Äã‚Äãe por qu√™? Voc√™ disse que o Reader / Writer retorna o tamanho que leu. Voc√™ j√° teve algum problema com isso? quando voc√™ exigiu a leitura (n√£o existe apenas ReadAll), mas algo n√£o funcionou? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Devo admitir honestamente que nunca tive casos assim, porque sempre trabalhei com implementa√ß√µes da biblioteca padr√£o. Mas hipoteticamente, essa situa√ß√£o, √© claro, √© poss√≠vel. Em casos espec√≠ficos, geralmente coletamos tubos multicamadas e, se voc√™ permitir um erro desse tipo, o tubo inteiro desmoronar√° ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Isso n√£o √© um bug. Vamos falar sobre minha pequena experi√™ncia. Eu tive um problema com o Booking.com: eles usaram o driver que eu escrevi e eles tiveram um problema - algo n√£o estava funcionando. Existe um protocolo bin√°rio padr√£o que fizemos; localmente, tudo funciona bem, todo mundo est√° bem, mas descobriu-se que eles t√™m uma rede muito ruim com um data center. O Reader realmente n√£o retornou tudo (placas de rede ruins, outra coisa). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mas se ele n√£o devolveu tudo, n√£o deveria ter retornado o sinal do fim (fim) e o cliente deveria voltar. Sob o contrato descrito, o Reader n√£o deve ... Digamos que o Reader, √© claro, decide quando ele quer vir, quando ele n√£o quer, no entanto, se ele quiser ler tudo, ele deve esperar pelo EOF. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mas isso √© precisamente por causa da conex√£o." Esse √© exatamente o problema que ocorreu no pacote de rede padr√£o. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - E ele devolveu o EOF? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ele n√£o devolveu tudo - ele simplesmente n√£o leu tudo. Eu disse a ele: "Leia os pr√≥ximos 20 bytes". Ele l√™. E eu n√£o leio tudo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Hipoteticamente, isso √© poss√≠vel, porque √© apenas uma interface que descreve um protocolo de comunica√ß√£o. √â necess√°rio assistir e desmontar especificamente o estojo. Aqui s√≥ posso responder que o cliente, em teoria, deveria ter voltado novamente se n√£o recebesse tudo o que queria. Voc√™ pediu uma fatia de 20 bytes, ele subtraiu 15 para voc√™, mas o EOF n√£o veio - voc√™ deve voltar ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Existe um io.ReadFull para esta situa√ß√£o. Foi especialmente projetado para ler a fatia at√© o fim. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Sim. Eu n√£o disse nada sobre o ReadFull. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Essa √© uma situa√ß√£o completamente normal quando o Read n√£o preenche toda a fatia. Voc√™ precisa estar preparado para isso. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Este √© um caso muito esperado! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Obrigado pelo relat√≥rio - foi interessante. Eu uso os leitores em um proxy pequeno e simples que l√™ http e grava de outra maneira. Uso o Close Reader para resolver um problema - para fechar o que leio o tempo todo. Preciso confiar cegamente em um contrato? Voc√™ disse que pode haver problemas. Ou adicionar verifica√ß√µes adicionais? √â teoricamente poss√≠vel que algo n√£o aconte√ßa completamente neste site. Preciso fazer essas verifica√ß√µes adicionais e n√£o confiar no contrato? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Eu diria o seguinte: se o seu aplicativo tolerar esses erros (por exemplo, se voc√™ confiar totalmente no contrato), talvez n√£o. Mas se voc√™ n√£o gostaria de ter um "p√¢nico" em si mesmo (como mostrei na leitura negativa no byte.Buffer), ainda assim verificaria. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas isso depende de voc√™. O que posso recomendar para voc√™? Eu acho que apenas pesar os pr√≥s e contras. O que acontece se voc√™ repentinamente receber um n√∫mero negativo de bytes? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Obrigado pelo relat√≥rio. Infelizmente, n√£o sei nada no Go. Se um "p√¢nico" ocorreu, existe alguma maneira de interceptar essas informa√ß√µes e obter informa√ß√µes sobre o que, onde, como ser tendencioso, para evitar problemas na sexta √† noite? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sim. O mecanismo de recupera√ß√£o permite "pegar" um p√¢nico e evit√°-lo sem cair, relativamente falando. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q_/xq/37/q_xq37jx6hjicmvwwhfhqdmyl7e.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Como suas recomenda√ß√µes para o uso de implementa√ß√µes do Writer e Reader s√£o consistentes com os erros retornados ao implementar soquetes da web. N√£o vou dar um exemplo concreto, mas o fim do arquivo sempre √© usado l√°? Tanto quanto me lembro, a mensagem termina com alguns outros significados ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Essa √© uma boa pergunta, porque simplesmente n√£o tenho nada a responder. Deve observar! Se o EOF n√£o vier, o cliente, se ele quiser obter tudo, dever√° ir novamente. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quanto tempo o tubo foi capaz de montar? Existe alguma cren√ßa interna de que n√£o vale a pena coletar mais de cinco participantes ou com filiais? Quanto tempo voc√™ conseguiu construir uma √°rvore a partir desses tubos (leitura, grava√ß√£o)? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Na minha pr√°tica, cerca de cinco chamadas consecutivas s√£o √≥timas, porque √© mais dif√≠cil depurar, lembre-se do que flui e para onde vai. Estrutura bastante ramificada √© obtida. Mas eu diria em algum lugar 5-7 no m√°ximo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 5-7 - nesse caso? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Est√° lendo, por exemplo, alguns dados. Voc√™ precisa prometer, e o que faz login, precisa aparar. Prometido - depois de ler esses dados - voc√™ precisar√° envi√°-los de volta para algum armazenamento (bem, hipoteticamente). Em qualquer armazenamento implementado pela interface do Writer. Com esse canal, ocorrem de 5 a 6 etapas, embora em uma delas ainda se ramifique para o lado e voc√™ continue trabalhando com o Reader. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AT:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- De acordo com a maneira Iniciante, voc√™ teve um slide interessante. Voc√™ pode indicar outros 2-3 pontos interessantes que estavam l√°, mas agora √© melhor n√£o faz√™-los, mas faz√™-lo de maneira diferente agora? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Com esse slide, eu queria mostrar exatamente como faz√™-lo sem a necessidade de ler o Reader. Nunca me passou pela cabe√ßa que algo parecido com o jeito Iniciante ... Este √© provavelmente o principal erro, o principal padr√£o que deve ser evitado ao trabalhar com Leitores. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apresentador: - Gostaria de acrescentar que √© muito importante para um iniciante ler toda a documenta√ß√£o do pacote io, todas as interfaces existentes e compreend√™-las. Porque, na verdade, existem muitos deles, e voc√™ frequentemente come√ßa a fazer algo por conta pr√≥pria, embora ele j√° exista l√° e seja implementado corretamente (‚Äúcerto‚Äù - levando em considera√ß√£o todos os recursos). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pergunta do l√≠der: - Como viver mais?</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Boa pergunta! Prometi dizer se temos tempo. Como resultado da discuss√£o sobre o bug, o LimitedReader teve a seguinte decis√£o: criar um preservativo de leitor em algum sentido, que proteja contra amea√ßas externas, envolver um leitor em que voc√™ n√£o confia - para impedir que qualquer infec√ß√£o entre no sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E neste Reader, voc√™ implementa todas as verifica√ß√µes que n√£o pode fazer: por exemplo, leitura negativa, experimentos com o n√∫mero de bytes (digamos que voc√™ enviou uma fatia de 10 bytes e recuperou 15 - como reagir a isso?) ... Reader e voc√™ pode implementar um conjunto dessas verifica√ß√µes. Eu disse: ‚ÄúTalvez vamos adicionar √† biblioteca padr√£o, porque seria √∫til para todos usarem‚Äù?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recebi a resposta de que parece n√£o haver sentido nisso - isso √© algo simples que voc√™ pode implementar. Todos. N√≥s vivemos. Confiamos no pessoal do contrato. Mas eu n√£o confiaria. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gj/e0/_c/gje0_c2o6hhots_d3d5hvnfhgnm.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Quando trabalhamos com leitores, gravadores e h√° uma oportunidade de encontrar uma "bomba" gzip ... Quanto confiamos nos fluxos ReadAll e WriteAll? Ou, no entanto, implementar a leitura do buffer e trabalhar apenas com o buffer? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CA:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- O ReadAll em si usa apenas bytes. Bufer sob o cap√¥. </font><font style="vertical-align: inherit;">Quando voc√™ quiser usar isso ou aquilo, √© aconselh√°vel entrar e ver como essas "tripas" s√£o implementadas. </font><font style="vertical-align: inherit;">Novamente, isso depende dos seus requisitos: se voc√™ √© intolerante com esses erros que mostrei, precisa verificar se o que vem do Reader empacotado est√° marcado. </font><font style="vertical-align: inherit;">Se n√£o estiver marcado, use, por exemplo, bufio (l√° est√° tudo marcado). </font><font style="vertical-align: inherit;">Ou fa√ßa o que acabei de dizer: um certo proxy Reader, que, de acordo com sua lista de requisitos, verificar√° esses dados e os devolver√° ao cliente ou ao cliente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ye/of/v1/yeofv1zmhlx3zoyv26wsh5mxway.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kuyjuGk1USY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de publicidade :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obrigado por ficar com a gente. Voc√™ gosta dos nossos artigos? Deseja ver materiais mais interessantes? Ajude-nos fazendo um pedido ou recomendando aos seus amigos o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS na nuvem para desenvolvedores a partir de US $ 4,99</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anal√≥gico exclusivo de servidores de n√≠vel b√°sico que foi inventado por n√≥s para voc√™: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10 GB DDR4 480 GB SSD 1 Gbps de US $ 19 ou como dividir o servidor?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Somente n√≥s temos </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na Holanda!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de $ 99! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leia sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como criar um pr√©dio de infraestrutura. </font><font style="vertical-align: inherit;">classe c usando servidores Dell R730xd E5-2650 v4 que custam 9.000 euros por um centavo?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt491510/index.html">Crie sua imagem com o CentOS 8.1 puro na nuvem da Amazon</a></li>
<li><a href="../pt491512/index.html">Por que Mr. Robot √© a melhor s√©rie sobre o setor de TI</a></li>
<li><a href="../pt491518/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 501 (18/02/2020/24/02/2020)</a></li>
<li><a href="../pt491520/index.html">Converter xls em xlsx e xml em c #</a></li>
<li><a href="../pt491522/index.html">Por que as mulheres vivem mais</a></li>
<li><a href="../pt491528/index.html">Minha experi√™ncia est√° realizando 1000 entrevistas. Sinopse do relat√≥rio por Yegor Bugaenko</a></li>
<li><a href="../pt491530/index.html">Mais uma vez cerca de 433 MHz transmissores e receptores</a></li>
<li><a href="../pt491532/index.html">Laravel + Docker + Gitlab. Por onde come√ßar</a></li>
<li><a href="../pt491534/index.html">Um breve guia para usar o GDB</a></li>
<li><a href="../pt491536/index.html">YouTube - Erro. Por favor, tente novamente mais tarde. ID de reprodu√ß√£o: <...></a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>