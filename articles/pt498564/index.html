<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèª üìó ü§´ Otimiza√ß√£o de renderiza√ß√£o para dispositivos m√≥veis, parte 2. As principais fam√≠lias de GPUs m√≥veis modernas üë©üèæ üïµüèø ‚öíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√µes, queridos amantes e profissionais, programadores gr√°ficos! Vamos come√ßar a segunda parte de nossa s√©rie de artigos sobre otimiza√ß√£o de rende...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Otimiza√ß√£o de renderiza√ß√£o para dispositivos m√≥veis, parte 2. As principais fam√≠lias de GPUs m√≥veis modernas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/498564/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sauda√ß√µes, queridos amantes e profissionais, programadores gr√°ficos! </font><font style="vertical-align: inherit;">Vamos come√ßar a segunda parte de nossa s√©rie de artigos sobre otimiza√ß√£o de renderiza√ß√£o para celular. </font><font style="vertical-align: inherit;">Nesta parte, consideraremos as principais fam√≠lias de GPUs apresentadas pelos jogadores no celular.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36d/cf7/711/36dcf7711d7ce68544c97bb8dc69ee32.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, considere v√°rios crit√©rios pelos quais as GPUs m√≥veis podem ser classificadas. </font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫cleos de shader unificados ou especializados</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na era das primeiras placas de v√≠deo m√≥veis, antes da dissemina√ß√£o de efeitos complexos, havia um ponto de vista de que, para shaders de fragmentos, o suporte a c√°lculos com precis√£o reduzida √© suficiente. De fato, em um modo de exibi√ß√£o t√≠pico, 8 ou menos bits s√£o usados ‚Äã‚Äãpara cada canal de cores. Essa vis√£o levou ao uso de n√∫cleos de shader especializados. Para os v√©rtices, usamos kernels otimizados para transforma√ß√µes de matriz com maior precis√£o FP24 / FP32 ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Para pixels, n√∫cleos que funcionam mais eficientemente com precis√£o reduzida FP16 ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mediump</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Com este </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eles n√£o eram suportados. </font><font style="vertical-align: inherit;">√Ä primeira vista, essa especializa√ß√£o nos permite obter uma distribui√ß√£o mais racional dos transistores no chip. </font><font style="vertical-align: inherit;">No entanto, na pr√°tica, isso leva a dificuldades no desenvolvimento de efeitos complexos, bem como no uso de texturas de alta resolu√ß√£o. </font><font style="vertical-align: inherit;">Al√©m disso, a especializa√ß√£o principal pode levar a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um gargalo de v√©rtice / fragmento</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este termo refere-se √† situa√ß√£o em que, devido √† carga assim√©trica nos n√∫cleos de v√©rtice e pixel, alguns n√∫cleos estavam "inativos".&nbsp;</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/307/144/547/30714454751e34703835ce904cf5f40a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, arquiteturas modernas usam n√∫cleos unificados. </font><font style="vertical-align: inherit;">Esses kernels podem assumir v√©rtices, pixels e outras tarefas computacionais, dependendo da carga.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/d7c/363/ffed7c363ebecf0d390a0271c1a8b014.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conjunto de instru√ß√µes vetorial (SIMD) ou escalar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No esp√≠rito do desejo de economizar nos transistores descritos acima, especializado em n√∫cleos, ocorreu o design de um conjunto de instru√ß√µes de shader. As transforma√ß√µes mais comuns para gr√°ficos tridimensionais operam com 4 vetores de componentes. Portanto, as primeiras GPUs trabalhavam especificamente com esses operandos. Se o c√≥digo do sombreador continha opera√ß√µes escalares heterog√™neas que n√£o podiam ser empacotadas em opera√ß√µes vetoriais pelo otimizador, parte da capacidade de computa√ß√£o n√£o era usada. Este fen√¥meno pode ser ilustrado da seguinte forma:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b7/3dd/34a/6b73dd34a79eb4376ed816a37de4a4ae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um sombreador que implementa a opera√ß√£o comum de adi√ß√£o de multiplica√ß√£o: multiplique 2 operandos e adicione o terceiro. Ao compilar em uma arquitetura vetorial condicional (Vector ISA = Arquitetura de conjunto de instru√ß√µes vetoriais), obtemos uma instru√ß√£o vetorial </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vMADD</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© executada por 1 rel√≥gio. Na arquitetura escalar condicional, obtemos 4 instru√ß√µes escalares que, gra√ßas a um pipeline aprimorado, tamb√©m s√£o executadas em 1 ciclo de clock. Agora considere um sombreador sofisticado que executa 2 opera√ß√µes, mas em 2 operandos componentes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/333/539/b2f/333539b2fb573f8f93ff518ca25f6e5c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso da arquitetura vetorial, j√° temos 2 instru√ß√µes que requerem 2 ciclos de clock para serem executadas. No entanto, nenhuma </font><font style="vertical-align: inherit;">a√ß√£o √© executada </font><font style="vertical-align: inherit;">nos componentes </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.zw</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e a capacidade de processamento fica inativa. No caso da arquitetura escalar, essas mesmas opera√ß√µes podem ser empacotadas em 4 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sMADDs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escalares </font><font style="vertical-align: inherit;">que s√£o executados no mesmo ciclo de 1 rel√≥gio. Assim, na arquitetura escalar, devido √† melhoria do pipeline, √© alcan√ßada uma maior densidade de c√°lculos. No entanto, como ser√° mostrado abaixo, o vetor </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ainda √© relevante. Portanto, faz sentido aplicar t√©cnicas de vetoriza√ß√£o para c√≥digo de sombreador. Eles permitem obter maior desempenho em placas de v√≠deo com o vetor </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ao mesmo tempo, como regra, isso n√£o prejudica o desempenho em escalares mais modernos.</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O ISA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base nas caracter√≠sticas acima, consideraremos as fam√≠lias de GPUs m√≥veis que s√£o comuns em nosso tempo. </font><font style="vertical-align: inherit;">Vamos come√ßar com a fam√≠lia mais comum. </font><font style="vertical-align: inherit;">Muitas pessoas sabem que estamos falando sobre placas gr√°ficas do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da empresa brit√¢nica </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARM</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A ARM n√£o est√° diretamente envolvida na produ√ß√£o de chips, oferecendo propriedade intelectual. </font><font style="vertical-align: inherit;">Como outras placas de v√≠deo para celular, o Mali faz parte do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System on Chip (SoC)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, </font><font style="vertical-align: inherit;">trabalha com compartilhada </font><font style="vertical-align: inherit;">mem√≥ria </font><font style="vertical-align: inherit;">para a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e √¥nibus.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali utgard</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2008, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasceram</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> os primeiros representantes da arquitetura do </font><strong><font style="vertical-align: inherit;">Mali Utgard</font></strong><font style="vertical-align: inherit;"> , relevantes at√© os dias atuais. </font><font style="vertical-align: inherit;">Essas placas de v√≠deo s√£o nomeadas de acordo com o esquema Mali-4 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MP </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , em que </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o n√∫mero do modelo </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o n√∫mero de n√∫cleos de fragmento. </font><font style="vertical-align: inherit;">Na especialidade do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Utgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shader core, e todos os modelos v√™m com um v√©rtice apenas 1 n√∫cleo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outras caracter√≠sticas da arquitetura Mali Utgard:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL ES 2.0&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Falta de suporte </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">highp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em kernels fragmentados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conjunto de instru√ß√µes vetoriais (faz sentido vetorizar c√°lculos)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar da especifica√ß√£o do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL ES</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , os </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drivers da</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> placa de v√≠deo </font><strong><font style="vertical-align: inherit;">Mali Utgard</font></strong><font style="vertical-align: inherit;"> compilam com √™xito os shaders de fragmentos que usam </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alta</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> precis√£o </font><font style="vertical-align: inherit;">(por exemplo, a precis√£o √© definida por padr√£o usando a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precis√£o highp float</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Mas a precis√£o do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mediump √©</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realmente usada </font><font style="vertical-align: inherit;">. Portanto, √© aconselh√°vel testar adicionalmente todos os shaders para jogos para celular nessas placas de v√≠deo. De acordo com dados coletados pela </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no final de 2019, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Utgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trabalhou em dispositivos para cerca de 10% dos jogadores. E se voc√™ definir os filtros apropriados no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">market.yandex.ru</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , poder√° ver em 2019 mais de 10 novos telefones com placas de v√≠deo dessa arquitetura.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/779/5a9/8ae/7795a98ae2da31ecf49131939087c21e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ estiver pronto para abandonar esse p√∫blico, basta definir o requisito para o suporte ao OpenGL ES 3.0 no AndroidManifest.xml: </font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:glEsVersion</span>=<span class="hljs-string">"0x00030000"</span> <span class="hljs-attr">android:required</span>=<span class="hljs-string">"true"</span>‚ÅÑ&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Utgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , atualmente n√£o existem GPUs m√≥veis comuns sem suporte ao OpenGL ES 3.0. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Destaca-se o uso de texturas de alta resolu√ß√£o no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Utgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dez bits da mantissa com precis√£o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©dia</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><strong><font style="vertical-align: inherit;">s√£o</font></strong><font style="vertical-align: inherit;"> suficientes para texturas de alta qualidade com uma resolu√ß√£o de textura superior a 1024 em um lado. </font><font style="vertical-align: inherit;">No entanto, apesar de oferecer suporte apenas </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√†</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> precis√£o de </font><strong><font style="vertical-align: inherit;">m√©dios m√©dios</font></strong><font style="vertical-align: inherit;"> nos n√∫cleos de fragmentos do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Utgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , √© poss√≠vel obter a </font><font style="vertical-align: inherit;">precis√£o das coordenadas de textura </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fp24</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao usar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">varia√ß√µes</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diretamente.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// vertex shader</span><font></font>
varying highp vec2 v_texc;<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    v_texc = ‚Ä¶;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  fragment shader</span><font></font>
...<font></font>
varying highp vec2 v_texc;<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
    gl_FragColor = texture2D(u_sampler, v_texc); <span class="hljs-comment">//  v_texc </span>
                                                 <span class="hljs-comment">//  </span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como um b√¥nus em algumas arquiteturas, essa abordagem permite </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><strong><font style="vertical-align: inherit;">buscar o</font></strong><font style="vertical-align: inherit;"> conte√∫do da textura antes de executar um </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sombreador de fragmento</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o que minimiza as </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paradas</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enquanto aguarda os resultados da amostragem de textura.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali midgard</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Utgard foi</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> substitu√≠do pela arquitetura do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Midgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Existem v√°rias gera√ß√µes dessa arquitetura com os nomes das esp√©cies </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali-6xx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali-7xx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali-8xx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Apesar da idade de 8 anos, o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Midgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser chamado de arquitetura moderna que fornece suporte para a maioria dos novos recursos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gr√£os de shader unificados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL ES 3.2 (sombreadores de computa√ß√£o e geometria, mosaico ...)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, o Mali Midgard mant√©m o vetor </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dado o amplo uso do Mali Midgard (cerca de 25% da nossa audi√™ncia), a vetoriza√ß√£o da computa√ß√£o se torna apropriada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro recurso do Mali Midgard √© a tecnologia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forward Pixel Kill</font></font></strong></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cada pixel √© calculado em um fluxo separado do n√∫cleo do fragmento. </font><font style="vertical-align: inherit;">Se durante a execu√ß√£o do fluxo se souber que o pixel resultante ser√° bloqueado por um pixel opaco de outro primitivo, o fluxo ser√° encerrado prematuramente e os recursos liberados ser√£o utilizados para outros c√°lculos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali bifrost</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao lado de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Midgard, a</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquitetura </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bifrost se</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destaca por sua transi√ß√£o para o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escalar </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comparado √† arquitetura anterior, o n√∫mero m√°ximo de n√∫cleos foi aumentado (de 16 para 32), e uma interface aprimorada com uma CPU √© suportada, o que permite acesso coerente √† mem√≥ria compartilhada: altera√ß√µes no conte√∫do da mem√≥ria da CPU / GPU tornam-se imediatamente "vis√≠veis" entre si, apesar dos caches, que permite simplificar a sincroniza√ß√£o.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De n√£o oficial</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muitas tentativas foram feitas para fazer engenharia reversa das placas de v√≠deo do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para criar </font><font style="vertical-align: inherit;">drivers de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo aberto</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Os trabalhos das pessoas dedicadas que tentam fazer isso nos permitem dar uma olhada nos recursos n√£o documentados das placas de v√≠deo do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Portanto, no projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PanFrost</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">h√°</font></a><font style="vertical-align: inherit;"> um desmontador para o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Midgard / Bifrost</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , com o qual voc√™ pode se familiarizar com um conjunto de instru√ß√µes de sombreador (n√£o h√° informa√ß√µes oficiais abertas sobre esse t√≥pico).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/f31/751/bbdf3175137a886431a23de54239900e.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adreno</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda fam√≠lia mais comum de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√≥veis </font><font style="vertical-align: inherit;">√© o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adreno</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta placa de v√≠deo √© instalada no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SoC</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , conhecido sob a marca </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snapdragon</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , da empresa americana </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualcomm</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O Snapdragon √© instalado nos smartphones de √∫ltima gera√ß√£o da </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Samsung</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sony</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><strong><font style="vertical-align: inherit;">outros.As</font></strong></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
placas de v√≠deo </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adreno</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atuais </font><font style="vertical-align: inherit;">s√£o as fam√≠lias das s√©ries 3xx - 6xx. </font><font style="vertical-align: inherit;">Todas essas s√©ries combinam os seguintes recursos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gr√£os de shader unificados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pseudo TBR (tamanhos grandes de blocos localizados em uma mem√≥ria GPU dedicada tradicional)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Troca autom√°tica no modo Imediato Rendering, dependendo da natureza da cena ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FlexRender</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conjunto de instru√ß√µes escalares</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adreno 4xx</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© introduzido o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suporte ao </font><strong><font style="vertical-align: inherit;">OpenGL ES 3.1</font></strong><font style="vertical-align: inherit;"> e com o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adreno 5xx - Vulkan</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL ES 3.2</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Renderiza√ß√£o baseada em mosaico Adreno</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As placas de v√≠deo Adreno t√™m uma GPU "tradicional" chamada </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GMEM</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aplicam-se volumes de 128kb a 1536kb. Isso permite que voc√™ use um tamanho de bloco maior em compara√ß√£o com arquiteturas de outros desenvolvedores de GPUs m√≥veis. No Adreno, o tamanho dos ladrilhos √© din√¢mico e depende do formato de cor usado, do buffer de profundidade e do est√™ncil. Ao trabalhar no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modo imediato, a</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renderiza√ß√£o ocorre na mem√≥ria do sistema.H√° uma extens√£o GL ES que permite especificar o modo preferido: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QCOM_binning_control</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No entanto, as recomenda√ß√µes mais recentes da Qualcomm sugerem confiar inteiramente nos drivers da GPU, que determinam o modo mais preferido para o buffer de comando gerado pelo aplicativo.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao trabalhar no modo </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TBR</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adreno faz 2 passes de v√©rtice:</font></font><br>
<br>
<ol>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Binning pass</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - distribui√ß√£o de primitivas por bin ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caixas</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sin√¥nimo de blocos)</font></font></li>
<li><font style="vertical-align: inherit;"></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passagem</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> completa do </font><strong><font style="vertical-align: inherit;">v√©rtice</font></strong><font style="vertical-align: inherit;"> para renderizar apenas as primitivas que se enquadram na Lixeira atual</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passe de Binning, o</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adreno calcula apenas as posi√ß√µes dos v√©rtices. </font><font style="vertical-align: inherit;">Outros atributos n√£o s√£o calculados e o c√≥digo desnecess√°rio √© removido pelo otimizador. </font><font style="vertical-align: inherit;">Na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o oficial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (9.2 Otimizar o processamento de v√©rtices), h√° uma recomenda√ß√£o para armazenar as informa√ß√µes de v√©rtices necess√°rias para calcular as posi√ß√µes separadamente do restante dos dados. </font><font style="vertical-align: inherit;">Isso torna o cache de dados de v√©rtices mais eficiente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Freedreno</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/83e/c3d/15d/83ec3d15dc03e81e81e7d867cae2b3a3.png" align="left" width="120"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diferentemente da ARM e da Imagination Technologies, a Qualcomm reluta em compartilhar os detalhes da estrutura interna de suas GPUs. </font><font style="vertical-align: inherit;">No entanto, gra√ßas aos esfor√ßos do engenheiro reverso Rob Clark, muito pode ser aprendido com o projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Freedreno</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o driver de c√≥digo aberto </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adreno</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para Linux. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rob Clark por Freedreno</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerVR por Imagination Technologies</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A Imagination Technologies</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© uma empresa brit√¢nica famosa por desenvolver GPUs para produtos da Apple. </font><font style="vertical-align: inherit;">A empresa desempenhou esse papel at√© o advento do iPhone 8 / X, que usa o desenvolvimento interno da Apple. </font><font style="vertical-align: inherit;">Embora as recomenda√ß√µes sobre otimiza√ß√µes para esses chips, bem como sobre reivindica√ß√µes de patentes contra a Apple da Imagination, que permaneceram inalteradas, sugiram que a Apple continuou a desenvolver a arquitetura PowerVR, um desenvolvimento original da Imagination. </font><font style="vertical-align: inherit;">No in√≠cio de 2020, a Apple </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voltou</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √†s pr√°ticas de licenciamento com a Imagination Technologies. </font><font style="vertical-align: inherit;">Al√©m dos dispositivos com iOS / iPadOS, as placas de v√≠deo PowerVR s√£o instaladas em um grande n√∫mero de smartphones e tablets Android.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9d/86d/b66/a9d86db66b2293beaf3b01d3d809573f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere a fam√≠lia de placas gr√°ficas PowerVR que ainda podem ser encontradas entre os usu√°rios.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerVR SGX</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As primeiras placas gr√°ficas PowerVR SGX apareceram em 2009. </font><font style="vertical-align: inherit;">Existem v√°rias gera√ß√µes dessa arquitetura: Series5, Series5XT e Series5XE. </font><font style="vertical-align: inherit;">A Apple usou essas GPUs at√© o iPAD 4 / iPhone 5 / iPOD Touch 5. Os seguintes recursos SGX podem ser citados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gr√£os de shader unificados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL ES 2.0</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto de instru√ß√µes do vetor</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporte para precis√£o lowp de 10 bits em shaders</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baixo desempenho de leituras de textura dependentes</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos nos debru√ßar sobre alguns deles com mais detalhes.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Precis√£o Lowp</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O PowerVR SGX s√£o as √∫nicas GPUs m√≥veis atualizadas com suporte de hardware </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Os modelos PowerVR mais recentes, bem como todas as GPUs modernas de outros fornecedores, na verdade usam precis√£o de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©dios</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O uso de </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no PowerVR SXG permite alcan√ßar uma densidade de computa√ß√£o mais alta (mais opera√ß√µes por ciclo). Ao mesmo tempo, a opera√ß√£o swizzle (permuta√ß√£o dos componentes vetoriais) para </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diferentemente de outra precis√£o, n√£o √© livre. Esse recurso, assim como a faixa estreita de valores que lowp fornece ([-2,2]), limita seu escopo. Ao mesmo tempo, o </font><strong><font style="vertical-align: inherit;">lowp</font></strong><font style="vertical-align: inherit;"> mal definido</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resultando em artefatos na fam√≠lia SGX n√£o ser√£o vistos em todas as outras placas gr√°ficas em que a precis√£o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©dia</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° realmente usada </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Por esse motivo, considere recusar-se a usar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lowp</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em shaders.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leituras de textura dependente</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ sabe, as opera√ß√µes de amostragem de textura s√£o as mais lentas devido √† necessidade de esperar pelos resultados da leitura da mem√≥ria. No caso do SoC m√≥vel, estamos falando de mem√≥ria compartilhada do sistema com uma CPU. Para reduzir o n√∫mero de acessos √† mem√≥ria lenta, s√£o usados ‚Äã‚Äãcaches de textura. Para evitar o tempo de inatividade no in√≠cio da rasteriza√ß√£o usando uma textura, faz sentido armazenar em cache as √°reas usadas com anteced√™ncia. Se o shader de fragmento usar a coordenada de textura passada pelo shader de v√©rtice sem altera√ß√µes, a se√ß√£o de textura necess√°ria para o armazenamento em cache poder√° ser determinada antes da execu√ß√£o do shader de fragmento. Se o sombreador do fragmento alterar a coordenada da textura ou calcul√°-la usando dados de outra textura, isso nem sempre √© poss√≠vel. Como resultado, a execu√ß√£o do sombreador de fragmento pode ficar mais lenta.As placas de v√≠deo PowerVR SGX s√£o particularmente dolorosas nesse cen√°rio. Al√©m disso, mesmo o uso de uma permuta√ß√£o dos componentes da coordenada de textura (swizzle) leva a</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">textura dependente lida</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Aqui est√° um programa de shader de exemplo sem a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leitura de textura dependente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programa de v√©rtice</font></font></strong><br>
<br>
<pre><code class="cpp hljs">attribute highp vec2 a_texc;<font></font>
varying highp vec2 v_texc;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
	gl_Position = ‚Ä¶<font></font>
	v_texc = a_texc;<font></font>
}<font></font>
<font></font>
</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programa de fragmento</font></font></strong><br>
<br>
<pre><code class="cpp hljs">precision mediump <span class="hljs-keyword">float</span>;<font></font>
uniform sampler u_sampler;<font></font>
varying highp vec2 v_texc;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
	gl_FragColor = texture2D( u_sampler, v_texc ); <span class="hljs-comment">//  dependent texture read</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso: </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programa de fragmento</font></font></strong><br>
<br>
<pre><code class="cpp hljs">precision mediump <span class="hljs-keyword">float</span>;<font></font>
uniform sampler u_sampler;<font></font>
varying highp vec2 v_texc;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
	gl_FragColor = texture2D( u_sampler, v_texc.yx ); <span class="hljs-comment">// dependent texture read!</span><font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerVR Rogue</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As placas de v√≠deo PowerVR foram desenvolvidas na arquitetura </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rogue e</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existem v√°rias gera√ß√µes dessa arquitetura: da S√©rie6 √† S√©rie9. </font><font style="vertical-align: inherit;">Todos os </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerVR Rogue</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> possuem esses recursos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gr√£os de shader unificados</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquitetura de instru√ß√µes escalares</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suporte para OpenGL ES 3.0+ (at√© 3.2, bem como a API Vulkan para novas r√©guas)&nbsp;</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerVR TBDR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como todas as GPUs m√≥veis comuns, o PowerVR usa um pipeline de blocos. Mas, diferentemente dos concorrentes, o Imagination foi al√©m e implementou a </font><font style="vertical-align: inherit;">rasteriza√ß√£o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adiada</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de primitivas, permitindo pular o sombreamento de pixels invis√≠veis, independentemente da ordem de renderiza√ß√£o. Essa abordagem √© chamada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renderiza√ß√£o adiada com base em bloco</font></font></strong></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o processo de elimina√ß√£o de pixels invis√≠veis √© </font><font style="vertical-align: inherit;">chamado de </font><font style="vertical-align: inherit;">remo√ß√£o de superf√≠cie oculta (HSR).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff2/2db/1dd/ff22db1dd631bb54e964aa24c96b437f.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remo√ß√£o de superf√≠cies ocultas</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Recomenda-se desenhar uma geometria opaca para ficar transparente e n√£o usar o Z Prepass, que no caso das placas de v√≠deo PowerVR na maioria dos cen√°rios levar√° a trabalhos desnecess√°rios. </font><font style="vertical-align: inherit;">No entanto, v√°rios pixels transparentes consecutivos que se sobrep√µem s√£o completamente sombreados para obter a cor correta, levando em considera√ß√£o a mistura. </font><font style="vertical-align: inherit;">O √∫ltimo pixel transparente pode ser descartado se for seguido por um pixel opaco.&nbsp;</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tecnologias de imagina√ß√£o de abertura</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os criadores do PowerVR forneceram acesso aberto a mais documenta√ß√£o do que outros desenvolvedores de GPU. </font><font style="vertical-align: inherit;">A arquitetura do pipeline gr√°fico √© descrita em detalhes, bem como um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conjunto de instru√ß√µes para a arquitetura Rogue</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Existe uma ferramenta conveniente </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVRShaderEditor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que permite que voc√™ receba </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">instantaneamente</font></a><font style="vertical-align: inherit;"> informa√ß√µes de perfil no shader, bem como sua lista desmontada do Rogue.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aba/b9a/19e/abab9a19e78e6ff40638d5cdf971615a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar da presen√ßa limitada de placas de v√≠deo PowerVR no ambiente de dispositivos baseados no Android, faz sentido estudar sua arquitetura para a programa√ß√£o competente de gr√°ficos para iOS.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUs m√≥veis de modo imediato</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinamos as fam√≠lias mais comuns de placas de v√≠deo m√≥veis. </font><font style="vertical-align: inherit;">Todas essas fam√≠lias usavam arquitetura de renderiza√ß√£o de blocos. </font><font style="vertical-align: inherit;">No entanto, existem placas de v√≠deo m√≥veis que usam a </font><font style="vertical-align: inherit;">abordagem </font><font style="vertical-align: inherit;">tradicional do </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modo imediato</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Aqui est√£o alguns deles:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nVIdia (Tegra SoC)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toda a fam√≠lia Intel, exceto a recente gera√ß√£o 11</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vivante GCxxxx (+ Arcturus GC8000)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um recurso das placas de v√≠deo m√≥veis que operam no </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modo imediato</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© a cara opera√ß√£o de limpeza da FBO. </font><font style="vertical-align: inherit;">Lembre-se de que na arquitetura do bloco, a limpeza em tela cheia acelera a renderiza√ß√£o, permitindo que o driver n√£o adicione a opera√ß√£o Carregar do conte√∫do antigo √† mem√≥ria do bloco. </font><font style="vertical-align: inherit;">Nas </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUs</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> m√≥veis de </font><strong><font style="vertical-align: inherit;">modo imediato,</font></strong><font style="vertical-align: inherit;"> a limpeza em tela cheia √© uma opera√ß√£o demorada que permite, entre outras coisas, que essas GPUs ‚Äúcalculem‚Äù. </font><font style="vertical-align: inherit;">Se a adi√ß√£o de limpeza n√£o acelerar, mas diminuir a renderiza√ß√£o, provavelmente estaremos trabalhando com </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a GPU no modo imediato</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Bem, √© claro, n√£o vamos esquecer de mencionar que nas </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUs de modo imediato,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alterar um alvo √© um procedimento "condicionalmente livre".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Distribui√ß√£o de diferentes fam√≠lias de GPUs m√≥veis entre nossos players</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o as estat√≠sticas de GPUs m√≥veis coletadas de nossos jogadores no final de 2019:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7f/184/634/e7f1846345e5e8bf798bbf207a11885d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo, abrimos o segmento "Outros"</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a3/f61/604/8a3f61604361a8c8e426ae0ae8920f05.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base nesses dados, analisamos a distribui√ß√£o da GPU em termos de seus principais recursos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b41/b97/3d5/b41b973d5d8d01e817a558d838396d63.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As ALUs vetoriais (unidade l√≥gica aritm√©tica) tornam-se obsoletas e substitu√≠das por escalares. Hoje, a maior parte das GPUs m√≥veis com um conjunto de instru√ß√µes vetoriais √© o </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali Midgard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que pode ser considerado com desempenho m√©dio. Porque a vetoriza√ß√£o, por via de regra, n√£o diminui a execu√ß√£o nas ALUs escalares; vale a pena considerar a vetoriza√ß√£o como uma t√©cnica real para otimizar shaders para dispositivos m√≥veis.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os kernels shader especializados foram descontinuados e substitu√≠dos pelos unificados. O gargalo de v√©rtice na malha esquel√©tica n√£o √© mais assustador. N√∫cleos especializados s√£o usados ‚Äã‚Äãapenas na fam√≠lia </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mali-4xx (Utgard)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Lembre-se de que essas GPUs oferecem suporte apenas ao </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenGL ES 2.0</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nosso p√∫blico-alvo possui cerca de 3,5% deles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, a grande maioria das GPUs m√≥veis usa a abordagem de blocos. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Modo Imediato</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ficou marginalizado e est√° sendo espremido rapidamente junto com as placas de v√≠deo que o utilizam. </font><font style="vertical-align: inherit;">A participa√ß√£o de </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPUs de modo imediato</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> em nossos jogadores √© de cerca de 0,7%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Links √öteis:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developer.arm.com/solutions/graphics</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developer.qualcomm.com/software/adreno-gpu-sdk/tools</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.imgtec.com/developers/powervr-sdk-tools/documentation/</font></font></a></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado pela aten√ß√£o! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No pr√≥ximo artigo da s√©rie, consideraremos t√©cnicas para otimizar shaders para dispositivos m√≥veis.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498548/index.html">Criando seu pr√≥prio pacote para o Laravel Nova: OptimalImage</a></li>
<li><a href="../pt498552/index.html">Quais erros os gerentes em um site remoto</a></li>
<li><a href="../pt498556/index.html">Hans Peter Lun e o nascimento do algoritmo de hash</a></li>
<li><a href="../pt498560/index.html">Componentes da Web em um projeto real</a></li>
<li><a href="../pt498562/index.html">Ao contr√°rio da quarentena: como transferimos nossos est√°gios para um formato remoto</a></li>
<li><a href="../pt498566/index.html">Engenharia de resili√™ncia: notas da confer√™ncia REDeploy</a></li>
<li><a href="../pt498568/index.html">Por dentro do microprocessador secional multi-chip Am2901 da AMD nos anos 70</a></li>
<li><a href="../pt498572/index.html">Descontos esquisitos? A√ß√µes de fornecedores de CRM por ocasi√£o da transi√ß√£o para o remoto</a></li>
<li><a href="../pt498574/index.html">Por que eu decidi desenvolver jogos ou uma viagem nost√°lgica por zero</a></li>
<li><a href="../pt498576/index.html">Como desenvolvemos o campo para inserir novas mensagens em nosso messenger (Gem4me)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>