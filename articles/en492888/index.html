<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèæ ‚è≤Ô∏è üìü Why you should not use WireGuard üë®üèº‚Äç‚öñÔ∏è üíÄ üßô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently WireGuard attracts a lot of attention, in fact - this is a new "star" among VPNs. But is he as good as he seems? I would like to discuss some...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Why you should not use WireGuard</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/492888/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recently WireGuard attracts a lot of attention, in fact - this is a new "star" among VPNs. But is he as good as he seems? I would like to discuss some observations and consider the implementation of WireGuard to explain why it is not a solution that will replace IPsec or OpenVPN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this article, I would like to debunk some myths [around WireGuard]. Yes, it will take a long time to read, so if you have not made a cup of tea or coffee, then it's time to do it. I would also like to thank Peter for proofreading my chaotic thoughts.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I do not set myself the goal of discrediting WireGuard developers, of devaluing their efforts or ideas. Their product is a working one, but I personally think that it is presented completely different from what it really is - it is presented as a replacement for IPsec and OpenVPN, which in reality just doesn't exist now. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a note, I want to add that the responsibility for such a positioning of WireGuard lies with the media that spoke about it, and not the project itself or its creators.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There hasn't been too much good news on the Linux kernel topic lately. </font><font style="vertical-align: inherit;">So, we were told about the monstrous vulnerabilities of the processor, which were leveled by software, and Linus Torvalds talked about it too rude and boring, utilitarian language of the developer. </font><font style="vertical-align: inherit;">Scheduler or network stack zero level - also not too clear topics for glossy magazines. </font><font style="vertical-align: inherit;">And then WireGuard appears. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Everything sounds great on paper: an exciting new technology. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But let's look at her a little more carefully.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WireGuard Technical Documentation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This article is based on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">official WireGuard documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> written by Jason Donenfeld. </font><font style="vertical-align: inherit;">There he explains the concept, purpose, and technical implementation of [WireGuard] in the Linux kernel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first sentence reads:</font></font><br>
<br>
<blockquote>WireGuard [...]    IPsec     ,         / TLS,   OpenVPN,     ,      []. </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Of course, the main advantage of all new technologies is their </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplicity</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [in comparison with their predecessors]. </font><font style="vertical-align: inherit;">But a VPN must also be </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">efficient and secure</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, what is next? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you say that you [from the VPN] do not need this, then you can end the reading. </font><font style="vertical-align: inherit;">However, I will notice that such tasks are posed before any other tunneling technology. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most interesting of the above quotations lies in the words ‚Äúin most cases‚Äù, which, of course, were ignored by the press. </font><font style="vertical-align: inherit;">And here we are, where we ended up because of the chaos created by this negligence - in this article.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6a/6i/mh/6a6imhnuzbtscbkm7rdwladwddm.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will WireGuard replace my [IPsec] VPN connection between sites?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No. </font><font style="vertical-align: inherit;">There is simply no chance that large vendors such as Cisco, Juniper and others will purchase WireGuard for their products. </font><font style="vertical-align: inherit;">They do not ‚Äúhop past trains‚Äù on the go, unless there is some great need for it. </font><font style="vertical-align: inherit;">Later I will talk about some of the reasons why they probably would not be able to install WireGuard products on board, even if they wanted to.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will WireGuard transfer my RoadWarrior from a laptop to a data center?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No. WireGuard hasn‚Äôt implemented a huge number of important functions right now so that it can do something like this. For example, it cannot use the dynamic IP address on the server side of the tunnel, and this alone breaks the whole scenario of a similar use of the product. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPFire is often used for low-cost Internet channels, such as DSL or cable connection. This makes sense for a small or medium business that does not need fast fiber.</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Note from the translator: do not forget that in terms of communications, Russia and some CIS countries are far ahead of Europe and the USA, because we started building our networks much later and with the advent of Ethernet and fiber optic networks as a standard, it was easier for us to rebuild. In the same EU countries or the USA, xDSL broadband access at a speed of 3-5 Mbps is still the universal norm, and fiber-optic connection costs some unrealistic money by our standards. Therefore, the author of the article speaks of DSL or cable connection as normal, rather than the ancient past.]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> However, DSL, cable, LTE (and other wireless access methods) have dynamic IP addresses. Of course, at times they do not change often, but still change. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is a subproject called </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"wg-dynamic"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The user space daemon adds to overcome this shortcoming. </font><font style="vertical-align: inherit;">A huge problem with the user scenario described above is the aggravation of the situation by dynamic IPv6 addressing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
From the point of view of the distributor, all this also does not look very good. </font><font style="vertical-align: inherit;">One of the design goals was to keep the protocol simple and clean. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, all this actually became too simple and primitive, so we have to use additional software to make this whole design viable in real-life conditions.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is WireGuard so easy to use?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not yet. I'm not saying that WireGuard will never be a good alternative for forwarding a tunnel between two points, but so far it is just an alpha version of the product that it should become. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But then what does he really do? Is IPsec really that much harder to operate? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously not. The IPsec provider has considered this point and is delivering its product along with an interface such as IPFire. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To configure a VPN tunnel through IPsec, you will need five sets of data that you will need to enter into the configuration: your own public IP address, the public IP address of the receiving side, subnets that you want to make public through this VPN connection and pre-shared key. Thus, the VPN is configured in a few minutes and it is compatible with any vendor.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, there are a few exceptions to this story. </font><font style="vertical-align: inherit;">Everyone who tried to forward a VPN tunnel through IPsec to a machine on OpenBSD understands what I'm talking about. </font><font style="vertical-align: inherit;">There are a couple more painful examples, but in fact, the good practice of using IPsec is much, much more.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About protocol complexity</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The end user does not have to worry about the complexity of the protocol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If we lived in a world where this was the real concern of the user, then we would have long ago got rid of SIP, H.323, FTP and other protocols created more than ten years ago that do not work well with NAT. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There are reasons why IPsec is more complicated than WireGuard: it does a lot more. For example, user authentication using a login / password or SIM card with EAP. It has the expanded ability to add new </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cryptographic primitives</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But WireGuard doesn‚Äôt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And this means that WireGuard will break at some point, because one of the cryptographic primitives will weaken or be completely compromised. The author of the technical documentation says this:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth noting that WireGuard is cryptographically self-confident. </font><font style="vertical-align: inherit;">He intentionally lacks the flexibility of ciphers and protocols. </font><font style="vertical-align: inherit;">If serious holes are found in the underlying primitives, all endpoints will need to be updated. </font><font style="vertical-align: inherit;">As you can see from the ongoing stream of SLL / TLS vulnerabilities, encryption flexibility has now increased tremendously.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The last sentence is absolutely true. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Building consensus on which encryption to use makes protocols like IKE and TLS </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">more</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> complex. </font><font style="vertical-align: inherit;">Too complicated? </font><font style="vertical-align: inherit;">Yes, vulnerabilities are quite common in TLS / SSL, and there is no alternative to them.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About ignoring real issues</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine you have a VPN server with 200 combat clients, somewhere around the world. This is a very standard use case. If you have to change the encryption, you need to deliver the update to all copies of WireGuard on these laptops, smartphones and so on. </font><font style="vertical-align: inherit;">Deliver at the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">same time</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . It is literally impossible. Administrators who try to do this will take months to deploy the necessary configurations, and medium-sized companies will literally take years to host such an event.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPsec and OpenVPN offer cipher negotiation. Therefore, some time after which you enable the new encryption, the old one will work. Thanks to this, current customers will be able to upgrade to the new version. After the update is rolled out, you simply turn off vulnerable encryption. And that‚Äôs all! Done! you are gorgeous! And customers will not even notice it. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is actually a very common case for large deployments, and even OpenVPN has some difficulties. Backward compatibility is important, and although you use weaker encryption, for many this does not cause the closure of the business. Because it will lead to paralysis of hundreds of customers due to inability to do their job.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WireGuard team has made their protocol simpler, but completely unsuitable for people who do not have constant control over both peers of their tunnel. </font><font style="vertical-align: inherit;">In my experience, this is the most common scenario.</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/xz/8g/un/xz8gunpa9bqpa5viwsssog6fbv0.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cryptography!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But what is this interesting new encryption that WireGuard uses?</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WireGuard uses Curve25519 for key exchange, ChaCha20 for encryption, and Poly1305 for data authentication. </font><font style="vertical-align: inherit;">It also works with SipHash for hash keys and BLAKE2 for hashing.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ChaCha20-Poly1305 is standardized for IPsec and OpenVPN (via TLS). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously, the development of Daniel Bernstein is used very often. BLAKE2 is the successor to BLAKE, the SHA-3 finalist who did not win due to his resemblance to SHA-2. If SHA-2 were hacked, there was a high probability that BLAKE would be compromised. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPsec and OpenVPN do not need SipHash because of their design. Thus, the only thing that cannot be used with them at the moment is BLAKE2, and only until it is standardized. This is not a big drawback, because VPNs use HMAC to create integrity, which is considered a strong solution even in conjunction with MD5.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So I came to the conclusion that all VPNs use almost the same set of cryptographic tools. </font><font style="vertical-align: inherit;">Therefore, WireGuard is no more and no less secure than any other relevant products when it comes to encryption or data integrity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But even this is not the most important thing that you should pay attention to according to the official documentation of the project. </font><font style="vertical-align: inherit;">After all, the main thing is speed.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is WireGuard faster than other VPN solutions?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In short: no, not faster. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ChaCha20 is a stream cipher that is easier to implement in software. It encrypts one bit at a time. Block protocols, such as AES, encrypt a block 128 bits at a time. To implement hardware support, much more transistors will be required, therefore larger processors come with AES-NI, an extension to the instruction set that performs some tasks of the encryption process to speed it up.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was expected that AES-NI will never hit smartphones [and it hit, - approx. trans.]. For this, the ChaCha20 was developed - as an easy and economical alternative that saves battery power. Therefore, it may be news for you that every smartphone that you can purchase today has one or another acceleration for AES and works with this encryption faster and with less power consumption than with ChaCha20. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviously, almost every desktop / server processor purchased in the last couple of years has AES-NI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Therefore, I expect AES to surpass ChaCha20 in every single scenario. The official WireGuard documentation mentions that thanks to the AVX512, the ChaCha20-Poly1305 will outperform AES-NI, but this command set extension will only be available on large processors, which again will not help with smaller and more mobile equipment that will always work faster with AES- NI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I'm not sure if this could have been foreseen during the development of WireGuard, but today the fact that it is nailed to one encryption is already a drawback that may not affect its work very well. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IPsec allows you to freely choose which encryption is best for your application. And of course, this is necessary if, for example, you want to transfer 10 or more gigabytes of data through a VPN connection.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux integration issues</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although WireGuard has chosen a modern encryption protocol, this is already causing a lot of problems. </font><font style="vertical-align: inherit;">And so, instead of using what is supported by the kernel out of the box, WireGuard integration has been delayed for years due to the lack of these primitives in Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I am not fully aware of the situation in other operating systems, but probably it is not much different from the situation with Linux.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does reality look like?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unfortunately, every time a client asks me to set up a VPN connection for him, I come across the topic that they use outdated credentials and encryption. 3DES in conjunction with MD5 is still a common practice, as are AES-256 and SHA1. And although the latter is slightly better - this is not something that should be used in 2020. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For key exchange </font><font style="vertical-align: inherit;">, RSA is </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">always</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used - a slow but fairly safe tool.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
My clients are connected with customs authorities and other state organizations and institutions, as well as with large corporations, whose names are known all over the world. They all use a request form that was created decades ago, and the ability to use SHA-512 was simply never added. I can‚Äôt say that this somehow clearly affects technological progress, but obviously it slows down the corporate process. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It pains me to see this, because IPsec has supported elliptical curves off the curve since the year 2005. Curve25519 is also newer and more accessible. There are still alternatives to AES, such as Camellia and ChaCha20, but, obviously, not all of them are supported by large suppliers, such as Cisco and others.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And people use it. </font><font style="vertical-align: inherit;">There are many Cisco kits; there are many kits designed to work with Cisco. </font><font style="vertical-align: inherit;">They are market leaders in this segment and are not very interested in any innovations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yes, the situation [in the corporate segment] is terrible, but we will not see any changes due to WireGuard. </font><font style="vertical-align: inherit;">Manufacturers are likely to never identify any performance issues with the tools and encryption already in use, they will not see problems when using IKEv2 - and therefore they are not looking for alternatives. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In general, have you ever thought about abandoning Cisco?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benchmarks</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now let's move on to the benchmarks from the WireGuard documentation. Although this [documentation] is not a scientific article, I still expected the developers to take a more scientific approach, or use a scientific approach as a reference. Any benchmarks are useless if they cannot be reproduced, and even more so they are useless when obtained in the laboratory. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the WireGuard build for Linux, he takes advantage of the GSO - Generic Segmentation Offloading. Thanks to him, the client creates a huge packet of 64 kilobytes in size and encrypts / decrypts it in one approach. Thus, the cost of calling and implementing cryptographic operations is reduced. If you want to maximize the bandwidth of your VPN connection, this is a good idea.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, as usual, in reality it is not so simple. Sending such a large packet to a network adapter requires that it be sliced ‚Äã‚Äãinto many smaller packets. The typical send size is 1,500 bytes. That is, our giant 64 kilobytes will be divided into 45 packets (1240 bytes of information and 20 bytes of IP-header). Then, for a while, they completely block the operation of the network adapter, because they must be sent together and immediately. As a result, this will lead to a jump in priority, and packets such as, for example, VoIP, will be queued. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, the high throughput, which WireGuard so boldly claims, is achieved by slowing down the network operation of other applications. And the WireGuard team has already </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">confirmed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this conclusion of mine.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But let's move on. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
According to the benchmarks in the technical documentation, the connection shows a bandwidth of 1011 Mbit / s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Impressive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is especially impressive because the maximum theoretical bandwidth of one gigabit Ethernet connection is 966 Mbit / s with a packet size of 1,500 bytes minus 20 bytes per IP header, 8 bytes per UDP header and 16 bytes per wire header itself. . There is another IP header in the encapsulated packet and another in 20 byte TCP. So where did this extra bandwidth come from?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With the huge frames and advantages of GSO, which we talked about above, the theoretical maximum with a frame size of 9000 bytes will be 1014 Mbit / s. Usually, such a throughput is unattainable in reality, because it is associated with great difficulties. Thus, I can only assume that the test was performed using even more bold frames exceeding the size of 64 kilobytes with a theoretical maximum of 1023 Mbit / s, which is supported only by some network adapters. But this is absolutely not applicable in real conditions, or it can be used only between two stations directly connected to each other, exclusively within the test stand.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But since the VPN tunnel is forwarded between two hosts using an Internet connection that does not support large frames at all, the result achieved at the stand cannot be taken as a standard. </font><font style="vertical-align: inherit;">This is simply an unrealistic laboratory achievement, which is impossible and not applicable in real combat conditions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Even sitting in the data center, I would not be able to transfer frames larger than 9000 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The criterion of applicability in real life is completely violated and, as I think, the author of the "measurement" seriously discredited himself for obvious reasons.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/ra/2b/pora2bzrbixbty-gnnngbffbc-i.png"><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last glimmer of hope</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WireGuard website talks a lot about containers and it becomes clear what it is actually intended for. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A simple and fast VPN that does not require configuration and can be deployed and configured with massive orchestration tools, such as Amazon‚Äôs in their cloud. Specifically, Amazon uses the latest hardware features that I mentioned earlier, for example - AVX512. This is done in order to speed up the work and not be tied to x86 or any other architecture.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
They optimize bandwidth and packets whose size exceeds 9000 bytes - this will result in huge encapsulated frames for communicating containers with each other, or for backup operations, creating snapshots or deploying these containers. </font><font style="vertical-align: inherit;">Even dynamic IP addresses will not affect the operation of WireGuard in the case of the scenario I described. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Not bad played. </font><font style="vertical-align: inherit;">Brilliant implementation and a very thin, almost reference protocol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But it just is not suitable for the world outside the data center you completely control. </font><font style="vertical-align: inherit;">If you take the risk and start using WireGuard, you will have to make constant compromises in the development and implementation of the encryption protocol.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It‚Äôs easy for me to conclude that WireGuard is not ready yet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was conceived as a lightweight and quick solution to a number of problems with existing solutions. Unfortunately, for the sake of these solutions, he sacrificed many features that will be relevant for most users. That is why it cannot replace IPsec or OpenVPN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order for WireGuard to become competitive, it needs to add at least the IP address configuration and the routing and DNS configuration. Obviously, this is what encrypted channels are needed for. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Security is my top priority, and right now I have no reason to believe that IKE or TLS is somehow compromised or broken. Modern encryption is supported in both of them, and they have been tested for decades of operation. If something newer does not mean that it is something, it is better.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interoperability is crucial when you contact third parties whose stations you do not control. </font><font style="vertical-align: inherit;">IPsec is the de facto standard and is supported almost universally. </font><font style="vertical-align: inherit;">And it works. </font><font style="vertical-align: inherit;">And no matter how it looks, in theory, WireGuard in the future may not be compatible even with different versions of itself. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Any cryptographic protection is hacked sooner or later and, accordingly, must be replaced or updated. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Denying all these facts and blindly wanting to use WireGuard to connect your iPhone to your home workstation is just a workshop on sticking your head in the sand.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en492874/index.html">Rendering optimization for Mobile</a></li>
<li><a href="../en492878/index.html">Geek slippers: looking for positive in temporary office closures</a></li>
<li><a href="../en492880/index.html">What should we build a smart home?</a></li>
<li><a href="../en492884/index.html">Receiving messages from youtube broadcasts + google authorization in PHP</a></li>
<li><a href="../en492886/index.html">Mass recruitment testers recipe</a></li>
<li><a href="../en492892/index.html">What they offer for free or at a discount try in quarantine. Business selection</a></li>
<li><a href="../en492894/index.html">How not to lose all the money in a couple of minutes or risk management in algorithmic trading</a></li>
<li><a href="../en492898/index.html">On the taste and color: gradations of approaches to the Smart home</a></li>
<li><a href="../en492900/index.html">Music generator Web Audio API Beginner Experience</a></li>
<li><a href="../en492906/index.html">How different MBTI types respond to stress</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>