<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽 📴 🐎 Goコードを1行も書かずにNoVerifyにチェックを追加する方法 🕦 ♠️ 🧞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="キラー機能がNoVerify静的アナライザーに登場しました：Goプログラミングとコードコンパイルを必要としない検査を説明する宣言的な方法。
 

興味をそそられるように、簡単だが便利な検査の説明を示します。
 

/** @warning duplicated sub-expressions ins...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Goコードを1行も書かずにNoVerifyにチェックを追加する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/473718/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キラー機能が</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoVerify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的アナライザーに</font><font style="vertical-align: inherit;">登場しました：Goプログラミングとコードコンパイルを必要としない検査を説明する宣言的な方法。</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味をそそられるように、簡単だが便利な検査の説明を示します。</font></font></p><br>
<pre><code class="php hljs"><span class="hljs-comment">/** <span class="hljs-doctag">@warning</span> duplicated sub-expressions inside boolean expression */</span>
$x &amp;&amp; $x;</code></pre><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この検査では</font></font><code>&amp;&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、左と右のオペランドが同じである</font><font style="vertical-align: inherit;">すべての論理式</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">検出されます</font><font style="vertical-align: inherit;">。</font></font></p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoVerify</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記述されたPHPの静的アナライザーです</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これについては、「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NoVerify：VKontakteチームのPHP用リンター</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」の記事を参照してください</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このレビューでは、新しい機能と、それがどのようにして実現されたかについてお話します。</font></font></p><br>
<p><img src="https://habrastorage.org/webt/gv/ru/74/gvru74yeqcbjdphiuwj4tieehoq.png"></p><a name="habracut"></a><br>
<h1 id="predposylki"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックグラウンド</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単純な新しいチェックでさえ、Goで数十行のコードを記述する必要がある場合、不思議に思い始めます。それ以外の場合は可能ですか？</font></font></p><br>
<p> Go     ,   ,       ,    NoVerify .   ,     «   X    Y» — .           .</p><br>
<p>         .         —    ,       NoVerify.      (     ).</p><br>
<p>,        ,          -   —      .        <code>nil</code>-     .</p><br>
<h1 id="yazyk-opisaniya-shablonov">  </h1><br>
<p>     PHP.    ,        ,    PhpStorm. </p><br>
<p>       ,   IDE:</p><br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">/**
 *      ,
 *        PHP-.
 *
 * <span class="hljs-doctag">@noinspection</span> ALL
 */</span><font></font>
<font></font>
<span class="hljs-comment">// ...  —   .</span></code></pre><br>
<p>           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">phpgrep</a>.        ,   NoVerify    ,          .</p><br>
<p>     phpgrep  ,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<p> phpgrep   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">gogrep</a>  PHP (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">cgrep</a>).         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>.</p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">structural search and replace</a> (SSR)  PhpStorm.   —    ,        ,   phpgrep. , ,   :    PHP   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>   , —    «»     .</p><br>
<div class="spoiler"><b class="spoiler_title">  ,    </b><div class="spoiler_text"><hr><br>
<p>      PHP-     —    :   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">S-</a>.</p><br>
<pre><code class="plaintext hljs">PHP-like    Lisp-like<font></font>
-----------------------------<font></font>
$x = $y   | (expr = $x $y)<font></font>
fn($x, 1) | (expr call fn $x 1)<font></font>
<font></font>
         :<font></font>
<font></font>
(or (expr == (type string (expr)) (expr))<font></font>
    (expr == (expr) (type string (expr))))</code></pre><br>
<p>   ,      ,        phpdoc.</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">clang-query</a> —   ,      .</p><br>
<hr></div></div><br>
<h1 id="sozdayom-i-zapuskaem-svoyu-diagnostiku">    !</h1><br>
<p>       .</p><br>
<p>     NoVerify.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,     Go-   ( ,     ).</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>    NoVerify,    ,   ,       !<br>
</td>
</tr>
</tbody></table></div><br>
<h2 id="postanovka-zadachi"> </h2><br>
<p> PHP   ,    — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">parse_str</a>.  :</p><br>
<pre><code class="php hljs"><span class="hljs-comment">//   encoded_string,    </span>
<span class="hljs-comment">//   URL,     </span>
<span class="hljs-comment">//   (  ,    result). </span>
parse_str ( <span class="hljs-keyword">string</span> $encoded_string [, <span class="hljs-keyword">array</span> &amp;$result ] ) : <span class="hljs-keyword">void</span></code></pre><br>
<p> ,    ,       :</p><br>
<pre><code class="php hljs">$str = <span class="hljs-string">"first=value&amp;arr[]=foo+bar&amp;arr[]=baz"</span>;<font></font>
<font></font>
parse_str($str);<font></font>
<span class="hljs-keyword">echo</span> $first;  <span class="hljs-comment">// value</span>
<span class="hljs-keyword">echo</span> $arr[<span class="hljs-number">0</span>]; <span class="hljs-comment">// foo bar</span>
<span class="hljs-keyword">echo</span> $arr[<span class="hljs-number">1</span>]; <span class="hljs-comment">// baz</span></code></pre><br>
<p>--,        .    ,           , <code>$result</code>,      .</p><br>
<h2 id="sozdanie-svoey-diagnostiki">  </h2><br>
<p>  <code>myrules.php</code>:</p><br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">/** <span class="hljs-doctag">@warning</span> parse_str without second argument */</span>
parse_str($_);</code></pre><br>
<p>           ,      phpgrep-.       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">phpdoc</a>-.      —     .</p><br>
<p>    : <code>error</code>, <code>warning</code>, <code>info</code>  <code>maybe</code>.   — :      ,        .      ,        .</p><br>
<p> ,   ,  <code>$_</code> —    .     , , <code>$x</code>,         ,    «» .      PHP  ,       ,     «» .  :       ,    .</p><br>
<h2 id="zapusk-novoy-diagnostiki">  </h2><br>
<p>     , <code>test.php</code>:</p><br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params">$x</span>) </span>{<font></font>
  parse_str($x); <span class="hljs-comment">//     </span>
}</code></pre><br>
<p>  NoVerify      :</p><br>
<pre><code class="bash hljs">$ noverify -rules myrules.php test.php</code></pre><br>
<p>     :</p><br>
<pre><code class="plaintext hljs">WARNING myrules.php:4: parse_str without second argument at test.php:4<font></font>
  parse_str($x);<font></font>
  ^^^^^^^^^^^^^</code></pre><br>
<p>      rules-  ,    .     <code>myrules.php:4</code>.</p><br>
<p>   ,   <code>@name &lt;name&gt;</code>.</p><br>
<div class="spoiler"><b class="spoiler_title">  @name</b><div class="spoiler_text"><hr><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@name</span> parseStrResult
 * <span class="hljs-doctag">@warning</span> parse_str without second argument
 */</span>
parse_str($_);</code></pre><br>
<pre><code class="plaintext hljs">WARNING parseStrResult: parse_str without second argument at test.php:4<font></font>
  parse_str($x);<font></font>
  ^^^^^^^^^^^^^</code></pre><br>
<p>     :</p><br>
<ul>
<li>   <code>-exclude-checks</code></li>
<li>     <code>-critical</code></li>
</ul><br>
<hr></div></div><br>
<h1 id="rabota-s-tipami">  </h1><br>
<p>    hello world —       ,     </p><br>
<p>,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">in_array</a>    <code>$strict=true</code> ,    (<code>$needle</code>)   .</p><br>
<p>      .</p><br>
<p>    — <code>@type &lt;type&gt; &lt;var&gt;</code>.     ,      .</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@warning</span> 3rd arg of in_array must be true when comparing strings
 * <span class="hljs-doctag">@type</span> string $needle
 */</span>
in_array($needle, $_);</code></pre><br>
<p>       <code>in_array</code>,      .     ,   <code>$needle</code>  <code>string</code>.</p><br>
<p>     <code>@or</code>:</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 *     -.
 *
 * <span class="hljs-doctag">@warning</span> strings must be compared using '===' operator
 * <span class="hljs-doctag">@type</span> string $x
 * <span class="hljs-doctag">@or</span>
 * <span class="hljs-doctag">@type</span> string $y
 */</span>
$x == $y;</code></pre><br>
<p>          <code>==</code>,       <code>string</code>.  ,   <code>@or</code>     <code>@and</code>,      .</p><br>
<h1 id="ogranichivaem-oblast-deystviya-diagnostiki">   </h1><br>
<p>     <code>@scope &lt;name&gt;</code>:</p><br>
<ul>
<li><code>@scope all</code> —   ,   ;</li>
<li><code>@scope root</code> —     ;</li>
<li><code>@scope local</code> —      .</li>
</ul><br>
<p>,     <code>return</code>   .  PHP     — ,     …        .</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@warning</span> don't use return outside of functions
 * <span class="hljs-doctag">@scope</span> root
 */</span>
<span class="hljs-keyword">return</span> $_;</code></pre><br>
<p>,      :</p><br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> <span class="hljs-string">"NOT OK"</span>; <span class="hljs-comment">// Gives a warning</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> </span>{
  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">m</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ALSO OK"</span>;<font></font>
  }<font></font>
}</code></pre><br>
<p>     <code>*_once</code>  <code>require</code>  <code>include</code>:</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@maybe</span> prefer require_once over require
 * <span class="hljs-doctag">@scope</span> root
 */</span>
<span class="hljs-keyword">require</span> $_;<font></font>
<font></font>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@maybe</span> prefer include_once over include
 * <span class="hljs-doctag">@scope</span> root
 */</span>
<span class="hljs-keyword">include</span> $_;</code></pre><br>
<blockquote>        .  <code>(($x))</code>   «    »,    ,  .   , <code>$x+$y*$z</code>  <code>($x+$y)*$z</code>   ,  .         <code>(</code>  <code>)</code>,   ,         .</blockquote><br>
<h1 id="gruppirovanie-shablonov"> </h1><br>
<p>   phpdoc-  ,      .</p><br>
<p>   :</p><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th> ( )</th>
</tr>
<tr>
<td><pre>/** @maybe don't use exit or die */<font></font>
die($_);<font></font>
<font></font>
/** @maybe don't use exit or die */<font></font>
exit($_);<font></font>
</pre></td>
<td><pre>/** @maybe don't use exit or die */<font></font>
{<font></font>
  die($_);<font></font>
  exit($_);<font></font>
}<font></font>
</pre></td>
</tr>
</tbody></table></div><br>
<p>   ,            !</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@warning</span> don't compare arrays with numeric types
 * <span class="hljs-doctag">@type</span> array $x
 * <span class="hljs-doctag">@type</span> int|float $y
 * <span class="hljs-doctag">@or</span>
 * <span class="hljs-doctag">@type</span> int|float $x
 * <span class="hljs-doctag">@type</span> array $y
 */</span><font></font>
{<font></font>
  $x &gt; $y;<font></font>
  $x &lt; $y;<font></font>
  $x &gt;= $y;<font></font>
  $x &lt;= $y;<font></font>
  $x == $y;<font></font>
}</code></pre><br>
<p> ,   , —      .      ,      :   +1  ,     .  —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a>.</p><br>
<h1 id="kak-integrirovany-dinamicheskie-pravila">   </h1><br>
<p><img src="https://habrastorage.org/webt/1l/hl/x4/1lhlx4vcasmxii4zhwf6fmzlgn8.jpeg"></p><br>
<p>   NoVerify     ,     <code>rules</code>.</p><br>
<p>      PHP-,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AST</a>   -     phpgrep-.</p><br>
<p>       —    ,           .   ,  .</p><br>
<p>    phpgrep-         (  <code>@or</code>).</p><br>
<p>           ,      .</p><br>
<h2 id="algoritm-matchinga"> </h2><br>
<p>     AST-      .    ,        :     ,      .</p><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a>,     NFA   «»    .</p><br>
<p>      :</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/** <span class="hljs-doctag">@warning</span> duplicated then/else parts of ternary */</span><font></font>
$_ ? $x : $x;<font></font>
<font></font>
<span class="hljs-comment">/** <span class="hljs-doctag">@warning</span> don't call explode with delim="" */</span>
explode(<span class="hljs-string">""</span>, ${<span class="hljs-string">"*"</span>});<font></font>
<font></font>
<span class="hljs-comment">/** <span class="hljs-doctag">@maybe</span> suspicious empty body of the if statement */</span>
<span class="hljs-keyword">if</span> ($_);</code></pre><br>
<p>   N   M ,     N*M   .           <code>O(N)</code> —          ,   , ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">regexp</a>  Go.</p><br>
<p>          .          ,    AST,     ,  ,  .          .</p><br>
<p>           ,   .         .</p><br>
<h2 id="muki-vybora-ili-nemnogo-o-forme-zapisi-type"> ,      <code>@type</code></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td>:        phpdoc-.<br>
</td>
</tr>
</tbody></table></div><br>
<p>   <code>@var</code>  <code>@param</code>,      , , "  ". ,     .</p><br>
<p>      :</p><br>
<ol>
<li>    .</li>
<li>    IDE   .</li>
</ol><br>
<p> PhpStorm   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">php-annotations</a>,   ,   -       phpdoc-.</p><br>
<p> (2)   ,    ,     IDE  . ,      ,     php-annotations:</p><br>
<pre><code class="php hljs"><span class="hljs-comment">/**
 * Type is a filter that checks that $value
 * satisfies the given type constraints.
 *
 * <span class="hljs-doctag">@Annotation</span>
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Filter</span> </span>{
  <span class="hljs-comment">/** Variable name that is being filtered */</span>
  <span class="hljs-keyword">public</span> $value;<font></font>
<font></font>
  <span class="hljs-comment">/** Check that value type is equal to $type */</span>
  <span class="hljs-keyword">public</span> $type;
  <span class="hljs-comment">/** Check that value text is equal to $text */</span>
  <span class="hljs-keyword">public</span> $text;<font></font>
}</code></pre><br>
<p>       - :</p><br>
<pre><code class="plaintext hljs">@Type($needle, eq=string)<font></font>
@Type($x, not_eq=Foo)</code></pre><br>
<p>      <code>Filter</code>,      (type/text/etc).</p><br>
<p>  ,      :</p><br>
<pre><code class="plaintext hljs">@type string $needle<font></font>
@type !Foo $x<font></font>
<font></font>
@type $needle == string<font></font>
@type $x != Foo<font></font>
<font></font>
@type(==) string $needle<font></font>
@type(!=) Foo $x<font></font>
<font></font>
@type($needle) == string<font></font>
@type($x) != Foo<font></font>
<font></font>
@filter type($needle) == string<font></font>
@filter type($x) != Foo</code></pre><br>
<p>     ,     phpdoc, —   :</p><br>
<pre><code class="lisp hljs">(<span class="hljs-name">eq</span> string (<span class="hljs-name">typeof</span> $needle))<font></font>
(<span class="hljs-name">neq</span> Foo (<span class="hljs-name">typeof</span> $x))</code></pre><br>
<p>        .            sixth:</p><br>
<pre><code class="plaintext hljs">@eval string $needle typeof =<font></font>
@eval Foo $x typeof &lt;&gt;</code></pre><br>
<p>       ...</p><br>
<h1 id="sravnenie-rasshiryaemosti-s-phan">   Phan</h1><br>
<p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">Phan</a>   "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  PHP-   PHPStan, Phan  Psalm</a>"  .</p><br>
<p> ,     -:</p><br>
<blockquote>  ,      PHP 7.3 ( , ,     case-insensitive-).      ,    ,   12     —  .      Phan,   ,    define()   .</blockquote><p>    (   ):</p><br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-keyword">use</span> <span class="hljs-title">Phan</span>\<span class="hljs-title">AST</span>\<span class="hljs-title">ContextNode</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Phan</span>\<span class="hljs-title">CodeBase</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Phan</span>\<span class="hljs-title">Language</span>\<span class="hljs-title">Context</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Phan</span>\<span class="hljs-title">Language</span>\<span class="hljs-title">Element</span>\<span class="hljs-title">Func</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Phan</span>\<span class="hljs-title">PluginV2</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Phan</span>\<span class="hljs-title">PluginV2</span>\<span class="hljs-title">AnalyzeFunctionCallCapability</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">ast</span>\<span class="hljs-title">Node</span>;<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefineThirdParamTrue</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">PluginV2</span>
  <span class="hljs-keyword">implements</span> <span class="hljs-title">AnalyzeFunctionCallCapability</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAnalyzeFunctionCallClosures</span>(<span class="hljs-params">CodeBase $code_base</span>) </span>{<font></font>
    $def = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">CodeBase $cb, Context $ctx, Func $fn, $args</span>) </span>{
      <span class="hljs-keyword">if</span> (count($args) &lt; <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">return</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">$this</span>-&gt;emitIssue(<font></font>
        $cb, $ctx,<font></font>
        <span class="hljs-string">'PhanDefineCaseInsensitiv'</span>,
        <span class="hljs-string">'define with 3 arguments'</span>, []<font></font>
      );<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'define'</span> =&gt; $def];<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefineThirdParamTrue();</code></pre><br>
<p>         NoVerify:</p><br>
<pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span><font></font>
<font></font>
<span class="hljs-comment">/** <span class="hljs-doctag">@warning</span> define with 3 arguments */</span>
define($_, $_, $_);</code></pre><br>
<p>       —        .</p><br>
<h1 id="zaklyuchenie"></h1><br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">NoVerify</a>   .</li>
<li>          , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   </a>.</li>
<li>     , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">welcome</a>!</li>
</ul><br>
<h1 id="ssylki-poleznye-materialy">,  </h1><br>
<p>   ,        ,           .</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  NoVerify  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  phpgrep  </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">   phpgrep  IT Nights</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">gogrep</a> —  Go    </li>
<li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">AST selectors</a>  ESLint</li>
</ul><br>
<p>     ,   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> NoVerify</a>.</p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja473706/index.html">Zoia：迅速なWebサイト開発のための軽量の反応性CMS</a></li>
<li><a href="../ja473708/index.html">自家製の電気自動車-すべてがあなたの考えているものではありません</a></li>
<li><a href="../ja473710/index.html">ドキュメントとローカリゼーションの原則、または最小限のコストで適切なローカリゼーションを取得する方法</a></li>
<li><a href="../ja473714/index.html">F＃でRISC-Vプロセッサの正式な仕様に到達した方法</a></li>
<li><a href="../ja473716/index.html">マウス駆動のウィジェット。ウィンドウ内でドラッグアンドドロップ</a></li>
<li><a href="../ja473720/index.html">信頼できる単体テストを作成する2つの方法</a></li>
<li><a href="../ja473722/index.html">遠隔隔離、不安、抑うつ</a></li>
<li><a href="../ja473726/index.html">Mutex、Semaphore、およびasync / awaitが何であるかを知るだけでは十分ではありません。量子からすべてを知る必要があります</a></li>
<li><a href="../ja473728/index.html">モニタリングの一般的な実装。ニコライ・シブコ</a></li>
<li><a href="../ja473732/index.html">10億ドルの北極圏下のケーブルネットワークの構築における詐欺の歴史</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>