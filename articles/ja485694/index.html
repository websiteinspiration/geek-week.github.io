<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥦 👆🏿 🐥 ElbrusプロセッサのEmbox。または、インテリジェンスで得たものを決して忘れない 🎿 👆🏾 💛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、と論理的な結論である一連の 「クライミングElbrus」記事 導入のエムボックスをにElbrusプロセッサアーキテクチャ（E2K） 。結果として、画面上に画像を表示するアプリケーションをtelnetを介して起動することが可能になったため、つまり、このアーキテクチャでEmboxのすべての...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ElbrusプロセッサのEmbox。または、インテリジェンスで得たものを決して忘れない</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/485694/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、と論理的な結論である</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一連の</font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">「クライミングElbrus」</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">導入の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">エムボックスを</font></a><font style="vertical-align: inherit;">に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Elbrusプロセッサアーキテクチャ（E2K） </font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">結果として、画面上に画像を表示するアプリケーションをtelnetを介して起動することが可能になったため、つまり、このアーキテクチャでEmboxのすべての機能を実現することができました。さらなる研究は序論とは言い難いが、もちろん、多くは不明確なままである。また、アーキテクチャ自体には多くの興味深い機能があり、これらも現在理解されていません。この記事では、仮想メモリの構成に焦点を当て、PCIに触れ、ネットワークカードについて少し説明し、特定のハードウェアのビデオカードに触れます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
怠惰で記事を読むことができない人のために、私はすぐに結果を含む短いビデオをあげます。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FqOSFJ36B48" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、興味のある方のために、プロセスで理解できた技術的な詳細を明らかにします。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想メモリ</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スタックエラー</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想メモリから始めましょう。実際、これは</font><font style="vertical-align: inherit;">シリーズの</font><font style="vertical-align: inherit;">前回の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解決したもの</font><font style="vertical-align: inherit;">です。 Emboxは仮想メモリがなくても機能するため、仮想メモリが必要な理由をすぐに覚えておく価値があります。それは簡単です：事はキャッシングです。 Vidyahaは機能しましたが、信頼性の高い画像検索のためにビデオメモリーに同じものを2回書き込む必要がありました。もちろん、キャッシュを処理することは可能でしたが、私たちの例では、キャッシュ管理などの核となるものなしで、ユーザーアプリケーションから直接ビデオメモリを使用することを提案しているため、メモリをキャッシュ不可としてマップする方法を学ぶのは正しかったです。 Linuxでもデバイスfbをマッピングすることで同じことができます（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elbrusについて長い間書いていないので、このアーキテクチャのMMUはある種の超複雑であるように見えるかもしれませんが、状況は異なります。実際、私たちは夏にサポートを追加しましたが、それについて書く手が届きませんでした。そして、私たちの愚かな間違いのために長い時間（数ヶ月）が費やされました。この間違いは、記事のタイトルにもありました（「または、インテリジェンス中に得たものを決して忘れないでください」）。私たちがよく扱っているスタックについて話しており、Climbing </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Elbrus-Reconnaissanceの</font></a><font style="vertical-align: inherit;">記事でこれについて説明しています</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。テクニカルパート1.レジスタ、スタック、その他の技術的な詳細」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちは非常に長い間苦しみ、外部のどこかから（システムが初期化される）初期スタックを取得し、すべてをマッピングするという事実を見失うことになります。</font><font style="vertical-align: inherit;">Emboxが機能するために必要なもので、このデータはマッピングしていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
猫の下</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、シリーズの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2番目の記事で説明されている新しい関数e2k_entryを提供します</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必要に応じて、比較することができます。</font></font><br>
<br>
<pre><code class="cpp hljs">__attribute__ ((__section__(<span class="hljs-string">".e2k_entry"</span>)))
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">e2k_entry</span><span class="hljs-params">(struct pt_regs *regs)</span> </span>{
    <span class="hljs-comment">/* Since we enable exceptions only when all CPUs except the main one
     * reached the idle state (cpu_idle), we can rely that order and can
     * guarantee exceptions happen strictly after all CPUS entries. */</span>
    <span class="hljs-keyword">if</span> (entries_count &gt;= CPU_COUNT) {
        <span class="hljs-comment">/* Entering here because of exception or interrupt */</span><font></font>
        e2k_trap_handler(regs);<font></font>
<font></font>
        RESTORE_COMMON_REGS(regs);<font></font>
<font></font>
        E2K_DONE;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* It wasn't exception, so we decide this usual program execution,
     * that is, Embox started on CPU0 or CPU1 */</span><font></font>
<font></font>
    e2k_wait_all();<font></font>
<font></font>
    entries_count = __e2k_atomic32_add(<span class="hljs-number">1</span>, &amp;entries_count);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (entries_count &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-comment">/* XXX currently we support only single core */</span>
        <span class="hljs-comment">/* Run cpu_idle on 2nd CPU */</span><font></font>
<font></font>
        <span class="hljs-comment">/* it's just needed if log_debug enabled in e2k_context module
         * else output will be wrong because 2 cpu printing at the same time */</span>
        <span class="hljs-keyword">while</span>(!sync_count);<font></font>
<font></font>
        context_init(&amp;cpu_ctx[<span class="hljs-number">0</span>], CONTEXT_PRIVELEGED | CONTEXT_IRQDISABLE, cpu_idle, idle_stack, <span class="hljs-keyword">sizeof</span>(idle_stack));<font></font>
        context_switch(&amp;cpu_ctx_prev[<span class="hljs-number">0</span>], &amp;cpu_ctx[<span class="hljs-number">0</span>]);<font></font>
    }<font></font>
    <span class="hljs-comment">/* Run e2k_kernel_start on 1st CPU */</span>
    context_init(&amp;cpu_ctx[<span class="hljs-number">1</span>], CONTEXT_PRIVELEGED | CONTEXT_IRQDISABLE, e2k_kernel_start, &amp;_stack_top, KERNEL_STACK_SZ);<font></font>
    sync_count = __e2k_atomic32_add(<span class="hljs-number">1</span>, &amp;sync_count);<font></font>
    context_switch(&amp;cpu_ctx_prev[<span class="hljs-number">1</span>], &amp;cpu_ctx[<span class="hljs-number">1</span>]);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタックをEmbox空間のメモリに切り替えるためにのみcontext_init（）およびcontext_switch（）関数を使用することを説明します。</font><font style="vertical-align: inherit;">そして、使用されていないものを含むすべてのコアに対してこれを行います。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MMUの組織 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、E2kアーキテクチャにおけるMMUの構成について少しお話します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般に、MMUアーキテクチャはごく普通で、4レベルのテーブル（4MBページを使用する場合は3つ）があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E2kアーキテクチャにはいくつかのサービスレジスタがあります。これらのサービスレジスタには、代替のスペース、および記事</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「EmboxがElbrusを登り始める」</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で簡単に説明したI / Oスペースへのアクセスコマンドを使用してアクセスします</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのようなレジスタが必要です：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_CR          0x00  <span class="hljs-comment">/* Control register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_CONT        0x10  <span class="hljs-comment">/* Context register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_CR3_RG      0x20  <span class="hljs-comment">/* CR3 register for INTEL only */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_ELB_PTB     0x30  <span class="hljs-comment">/* ELBRUS page table virtual base */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_ROOT_PTB    0x40  <span class="hljs-comment">/* Root Page Table Base register */</span>/</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、これは制御レジスタ、コンテキスト番号レジスタ、テーブルのルートレジスタ、および少しあいまいなMMU_REG_ELB_PTBです。それから始めましょう。このレジスタは何らかの値に設定する必要があります。次の512GBは機器のニーズのためにプロセッサによって使用され、プログラマはこれらのアドレスにアクセスできなくなります。 ICSTスペシャリストからの手紙で説明しますが、これ以上の説明はできません。</font></font><br>
<br>
<blockquote> Linux   MMU_ELB_PTB  0xff1 &lt;&lt; 39,  <br>
    (0xff8000000000 — 0xffffffffffff)<br>
   ,  , TLB.  <br>
  ()       ,<br>
      ,   <br>
  .  .. TLB    <br>
,          TLB<br>
     ,     .<br>
<br>
  /,    TLB  <br>
  ,    .<br>
<br>
 ,    TLB     <br>
   (pgd*),       (pte*).<br>
      , .  <br>
        TLB.   ,   <br>
 pgd       .  <br>
  .     <br>
 4   ff80'0000'0000 — ffff'ffff'ffff — ..  <br>
  .     pgd* <br>
 /,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その結果、単純にこのレジスターに大きな値を入れることになりました。結局のところ、提案されたソリューションではページの検索を最適化することができますが、まだ最適化に取り組んでいません。 Linuxと同じように提供されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に制御レジスタ。 MMUを有効にする必要があります。既知のビットは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_TLB_EN   0x0000000000000001 <span class="hljs-comment">/* translation enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CD_MASK  0x0000000000000006 <span class="hljs-comment">/* cache disable bits */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_SET1     0x0000000000000008 <span class="hljs-comment">/* set #1 enable for 4 MB pages */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_SET2     0x0000000000000010 <span class="hljs-comment">/* set #2 enable for 4 MB pages */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_SET3     0x0000000000000020 <span class="hljs-comment">/* set #3 enable for 4 MB pages */</span></span>
<span class="hljs-comment">/* paging enable for second space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CR0_PG   0x0000000000000040</span>
<span class="hljs-comment">/* page size 4Mb enable for second space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CR4_PSE  0x0000000000000080</span>
<span class="hljs-comment">/* cache disable for secondary space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CR0_CD   0x0000000000000100</span>
<span class="hljs-comment">/* TLU enable for secondary space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_TLU2_EN  0x0000000000000200</span>
<span class="hljs-comment">/* memory protection table enable for LD from secondary space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_LD_MPT   0x0000000000000400</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_IPD_MASK 0x0000000000000800 <span class="hljs-comment">/* Instruction Prefetch Depth */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_UPT_EN   0x0000000000001000 <span class="hljs-comment">/* enable UPT */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アドレスの変換を含む最初のビットに興味があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_MMU_CR_SET3も設定しますが、特定のケースでこれを行う必要があるかどうかはわかりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンテスト登録まあ、単純であれば、これはプロセスまたはアドレス空間のPIDです。より技術的には、これは11ビットのアドレス拡張です。私たちの場合、すべてのページに少しグローバル性を設定することにより、すべてのページを核にし、1つのアドレス空間を使用するため、このレジスタでゼロを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ルートテーブルのレジスタには、変換テーブルの先頭の物理アドレスへのポインタがあります。 MMU_REG_ELB_PTBレジスタで指定されたアドレスにテーブルをマッピングすることで不正行為を行うことができますが、前述のとおり、最適化に重点を置いていませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
他に何が言えるか、テーブルの構造はごく普通で、フラグは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_P       0x0000000000000001ULL <span class="hljs-comment">/* Page Present bit */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_W       0x0000000000000002ULL <span class="hljs-comment">/* Writable (0 - only read) */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_UU2     0x0000000000000004ULL <span class="hljs-comment">/* unused bit # 2 */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_PWT     0x0000000000000008ULL <span class="hljs-comment">/* Write Through */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_CD1     0x0000000000000010ULL <span class="hljs-comment">/* Cache disable (right bit) */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_A       0x0000000000000020ULL <span class="hljs-comment">/* Accessed Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_D       0x0000000000000040ULL <span class="hljs-comment">/* Page Dirty */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_HUGE    0x0000000000000080ULL <span class="hljs-comment">/* Page Size */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_G       0x0000000000000100ULL <span class="hljs-comment">/* Global Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_CD2     0x0000000000000200ULL <span class="hljs-comment">/* Cache disable (left bit) */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_NWA     0x0000000000000400ULL <span class="hljs-comment">/* Prohibit address writing */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_AVAIL   0x0000000000000800ULL <span class="hljs-comment">/* Available page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_PFN     0x000000fffffff000ULL <span class="hljs-comment">/* Physical Page Number */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_VALID   0x0000010000000000ULL <span class="hljs-comment">/* Valid Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_PV      0x0000020000000000ULL <span class="hljs-comment">/* PriVileged Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_INT_PR  0x0000040000000000ULL <span class="hljs-comment">/* Integer address access Protection */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_NON_EX  0x0000080000000000ULL <span class="hljs-comment">/* Non Executable Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_RES     0x0000f00000000000ULL <span class="hljs-comment">/* Reserved bits */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_C_UNIT  0xffff000000000000ULL <span class="hljs-comment">/* Compilation Unit */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第4レベルのテーブルの場合、アドレスシフトは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __MMU_PGD_SHIFT      (PAGE_SHIFT + 3 * (PAGE_SHIFT-3)) <span class="hljs-comment">/* 39 */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __MMU_PUD_SHIFT      (PAGE_SHIFT + 2 * (PAGE_SHIFT-3)) <span class="hljs-comment">/* 30 */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __MMU_PMD_SHIFT      (PAGE_SHIFT + 1 * (PAGE_SHIFT-3)) <span class="hljs-comment">/* 21 */</span></span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCIについて少し</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替アドレス空間を介した通信</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vidyahaとネットワークカードに移る前に、簡単にPCIに戻りましょう。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Emboxがエルブルス山に登り始める」の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の部分で、これについて少し話しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">代替アドレス空間と通信するためのマクロを示しました。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \
({ \
    register type res; \
    asm volatile (<span class="hljs-meta-string">"ld"</span> #size_letter <span class="hljs-meta-string">","</span> #chan_letter <span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span> \
                  : <span class="hljs-meta-string">"=r"</span> (res) \
                  : <span class="hljs-meta-string">"r"</span> ((__e2k_ptr_t) (addr)), \
                    <span class="hljs-meta-string">"i"</span> (mas)); \
    res; \
})</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \
({ \
    asm volatile (<span class="hljs-meta-string">"st"</span> #size_letter <span class="hljs-meta-string">","</span> #chan_letter <span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span> \
                  : \
                  : <span class="hljs-meta-string">"r"</span> ((__e2k_ptr_t) (addr)), \
                    <span class="hljs-meta-string">"r"</span> ((type) (val)), \
            <span class="hljs-meta-string">"i"</span> (mas) \
          : <span class="hljs-meta-string">"memory"</span>); \
})</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、アドレス空間の原理への言及がありました。</font><font style="vertical-align: inherit;">異なるアドレス空間は、MAS（メモリアドレス指定子）を使用して定義されます。</font><font style="vertical-align: inherit;">そして、たとえば、PCIへのアクセスに使用されるIOにアクセスするには、6を使用し、MMU 7を使用する必要があり</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。</font><font style="vertical-align: inherit;">そして、e2kコマンドの説明を見ると、</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDD dddダブルワード読み取り</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ldd [アドレス] mas、dst</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、一見すると、チャネルはありません。</font><font style="vertical-align: inherit;">しかし、リンクをたどると、特定の操作lddのコードは67であることがわかります。しかし、67は、チャネルAL0 / AL3およびAL2 / AL5のlddのコードであり、チャネルAL1 / AL4の場合、このコードは操作POPCNTdに対応します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、Elbrusの用語に含まれるチャネルを完全に理解することはできませんでした。</font><font style="vertical-align: inherit;">このタイプのアーキテクチャでは、機能の1つが複数の独立したコンピューティングデバイスの存在であるため、使用するaluを指定できる場合、これは既にvliwの原則に関連していると思います。</font><font style="vertical-align: inherit;">もちろん、間違いはありますが、PCIまたはMMUにアクセスするには、2番目または5番目のチャネルを使用する必要があります。</font><font style="vertical-align: inherit;">したがって、コマンドは次のようになります。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ldd、2 0x0、[addr_in_mas] mas_id、％reg</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lspci</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、所有しているデバイスでのlspciコマンドの出力結果を示します。</font></font><br>
<blockquote>root@embox:(null)#lspci<br>
00: 0.0 (PCI dev E3E3:ABCD) [6 4]<br>
 PCI-to-PCI bridge: (null) Elbrus PCIe bridge (rev 01)<br>
00: 1.0 (PCI dev 8086:E3E3) [6 4]<br>
 PCI-to-PCI bridge: Intel Corporation Elbrus Virt PCI bridge (rev 01)<br>
01: 0.0 (PCI dev 1FFF:8000) [6 4]<br>
 PCI-to-PCI bridge: (null) Elbrus PCI bridge (rev 05)<br>
01: 1.0 (PCI dev 8086:4D45) [2 0]<br>
 Ethernet controller: Intel Corporation MCST ETH1000 Gigabit Ethernet (rev 01)<br>
01: 2.0 (PCI dev 8086:4D49) [1 1]<br>
 IDE controller: Intel Corporation MCST IDE (rev 128)<br>
01: 2.1 (PCI dev 8086:0002) [7 2]<br>
 Simple comm. controller: Intel Corporation (null) (rev 05)<br>
01: 2.2 (PCI dev 8086:8000) [7 128]<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 シンプルなコミュニケーション。</font><font style="vertical-align: inherit;">コントローラ：Intel Corporation Elbrus PCIブリッジ（rev 00）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01：2.3（PCI dev 1013：6005）[4 1] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 マルチメディアデバイス：Cirrus Logic Crystal CS4281 PCI Audio（rev 01）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01：3.0（PCI dev 8086：4748）[1 6] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 大容量記憶コントローラ：Intel Corporation MCST SATA（rev 00）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01：4.0（PCI dev 8086：554F）[12 3] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 USBデバイス：Intel Corporation OHCI for Elbrus（rev 00）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01：4.1（PCI dev 8086：5545） [12 3] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 USBデバイス：Intel Corporation EHCI for Elbrus（rev 00）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
02：1.0（PCI dev 126F：0718）[3 0] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 VGA互換コントローラー：Silicon Motion、Inc. </font><font style="vertical-align: inherit;">SM718 LynxSE +（rev 160）</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
root @ embox：（null）＃</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01：2.2（PCI dev 8086：8000）[7 128] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 シンプルな通信。</font><font style="vertical-align: inherit;">コントローラ：Intel Corporation Elbrus PCIブリッジ（rev 00）</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、これは、am85c30と同様のMCSTからのシリアルポートであり、少なくともこのデバイスではminicomを介して通信します。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LANカード</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的な構造</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、ネットワークカードを見てみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が正しく理解していれば、これは元のネットワークカードです。操作はe1000と少し似ていますが、操作の点でのみです（受信キューと送信キュー内の記述子の存在など）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、私たちが遭遇した重要なポイントについて詳しく説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークカードPCI VID：PID 0x8086：0x4D45。</font><font style="vertical-align: inherit;">VIDがIntelと同じであることに驚かないでください。MCSTはこの特定のVIDをよく使用します。少なくとも上記のシリアルポートデバイスを確認してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BAR0にはレジスタベースが含まれています。</font><font style="vertical-align: inherit;">レジスターは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_E_CSR         0x00 <span class="hljs-comment">/* Ethernet Control/Status Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_MGIO_CSR      0x04 <span class="hljs-comment">/* MGIO Control/Status Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_MGIO_DATA     0x08 <span class="hljs-comment">/* MGIO Data Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_E_BASE_ADDR   0x0c <span class="hljs-comment">/* EthernetBase Address Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_DMA_BASE_ADDR 0x10 <span class="hljs-comment">/* DMA Base Address Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_PSF_CSR       0x14 <span class="hljs-comment">/* Pause Frame Control/Status Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_PSF_DATA      0x18 <span class="hljs-comment">/* Pause Frame Data Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_INT_DELAY     0x1c <span class="hljs-comment">/* Interrupt Delay Register */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の3つ（L_E1000_PSF_CSR、L_E1000_PSF_DATA、L_E1000_INT_DELAY）は使用しなかったので、それらについては触れません。</font><font style="vertical-align: inherit;">MGIOから始めましょう。MIIプロトコルを使用した読み書き、つまりPHYチップとの通信はすべて単純です。</font><font style="vertical-align: inherit;">具体的には、チップDP83865があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手順は特に注目に値するものではなく、一覧を提供するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
読書：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">e1000_mii_readreg</span><span class="hljs-params">(struct net_device *dev, <span class="hljs-keyword">int</span> phy_id, <span class="hljs-keyword">int</span> reg_num)</span> </span>{
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_priv</span> *<span class="hljs-title">ep</span> = <span class="hljs-title">netdev_priv</span>(<span class="hljs-title">dev</span>);</span>
	<span class="hljs-keyword">uint32_t</span> rd;
	<span class="hljs-keyword">uint16_t</span> val_out = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<font></font>
<font></font>
	rd = <span class="hljs-number">0</span>;<font></font>
	rd |= <span class="hljs-number">0x2</span> &lt;&lt; MGIO_CS_OFF;<font></font>
	rd |= <span class="hljs-number">0x1</span> &lt;&lt; MGIO_ST_OF_F_OFF;<font></font>
	rd |= <span class="hljs-number">0x2</span> &lt;&lt; MGIO_OP_CODE_OFF; <span class="hljs-comment">/* Read */</span>
	rd |= (phy_id  &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_PHY_AD_OFF;<font></font>
	rd |= (reg_num &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_REG_AD_OFF;<font></font>
<font></font>
	e1000_write_mgio_data(ep, rd);<font></font>
	rd = <span class="hljs-number">0</span>;<font></font>
<font></font>
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i != <span class="hljs-number">1000</span>; i++) {
		<span class="hljs-keyword">if</span> (e1000_read_mgio_csr(ep) &amp; MGIO_CSR_RRDY) {<font></font>
			rd = (<span class="hljs-keyword">uint16_t</span>)e1000_read_mgio_data(ep);<font></font>
<font></font>
			val_out = rd &amp; <span class="hljs-number">0xffff</span>;<font></font>
			log_debug(<span class="hljs-string">"reg 0x%x &gt;&gt;&gt; 0x%x"</span>, reg_num, val_out);
			<span class="hljs-keyword">return</span> val_out;<font></font>
		}<font></font>
		usleep(<span class="hljs-number">100</span>);<font></font>
	}<font></font>
<font></font>
	log_error(<span class="hljs-string">"mdio_read: Unable to read from MGIO_DATA reg\n"</span>);<font></font>
<font></font>
	<span class="hljs-keyword">return</span> val_out;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記録：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">e1000_mii_writereg</span><span class="hljs-params">(struct net_device *dev, <span class="hljs-keyword">int</span> phy_id, <span class="hljs-keyword">int</span> reg_num, <span class="hljs-keyword">int</span> val)</span> </span>{
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_priv</span> *<span class="hljs-title">ep</span> = <span class="hljs-title">netdev_priv</span>(<span class="hljs-title">dev</span>);</span>
	<span class="hljs-keyword">uint32_t</span> wr;
	<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<font></font>
<font></font>
	wr = <span class="hljs-number">0</span>;<font></font>
	wr |= <span class="hljs-number">0x2</span> &lt;&lt; MGIO_CS_OFF;<font></font>
	wr |= <span class="hljs-number">0x1</span> &lt;&lt; MGIO_ST_OF_F_OFF;<font></font>
	wr |= <span class="hljs-number">0x1</span> &lt;&lt; MGIO_OP_CODE_OFF; <span class="hljs-comment">/* Write */</span>
	wr |= (phy_id  &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_PHY_AD_OFF;<font></font>
	wr |= (reg_num &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_REG_AD_OFF;<font></font>
	wr |= val &amp; <span class="hljs-number">0xffff</span>;<font></font>
<font></font>
	log_debug(<span class="hljs-string">"reg 0x%x &lt;&lt;&lt; 0x%x"</span>, reg_num, val);<font></font>
	e1000_write_mgio_data(ep, wr);<font></font>
<font></font>
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i != <span class="hljs-number">1000</span>; i++) {
		<span class="hljs-keyword">if</span> (e1000_read_mgio_csr(ep) &amp; MGIO_CSR_RRDY) {
			<span class="hljs-keyword">return</span>;<font></font>
		}<font></font>
		usleep(<span class="hljs-number">100</span>);<font></font>
	}<font></font>
	log_error(<span class="hljs-string">"Unable to write MGIO_DATA reg: val = 0x%x"</span>, wr);
	<span class="hljs-keyword">return</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在、L_E1000_DMA_BASE_ADDRおよびL_E1000_E_BASE_ADDRは、実際には1つのパラメーター、ネットワークカード記述ブロックのアドレスを記述しています。</font><font style="vertical-align: inherit;">つまり、Elbrusのアドレスは64ビットで、レジスターは32ビットです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際にコード：</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-comment">/* low 32 bits */</span>
    init_block_addr_part = (<span class="hljs-keyword">uint32_t</span>)((<span class="hljs-keyword">uintptr_t</span>)ep-&gt;init_block &amp; <span class="hljs-number">0xffffffff</span>);<font></font>
    e1000_write_e_base_addr(ep, init_block_addr_part);<font></font>
    log_debug(<span class="hljs-string">"Init Block Low  DMA addr: 0x%x"</span>, init_block_addr_part);
    <span class="hljs-comment">/* high 32 bits */</span>
    init_block_addr_part = (<span class="hljs-keyword">uint32_t</span>)(((<span class="hljs-keyword">uintptr_t</span>)(ep-&gt;init_block) &gt;&gt; <span class="hljs-number">32</span>) &amp; <span class="hljs-number">0xffffffff</span>);<font></font>
    e1000_write_dma_base_addr(ep, init_block_addr_part);<font></font>
    log_debug(<span class="hljs-string">"Init Block High DMA addr: 0x%x"</span>, init_block_addr_part);
    <span class="hljs-comment">/************************************************************************/</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここから、L_E1000_DMA_BASE_ADDRは上部であり、L_E1000_DMA_BASE_ADDRは特定の初期化ブロック（実際にはカード記述ブロック）のアドレスの下部であることがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記述構造は次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_init_block</span> {</span>
    <span class="hljs-keyword">uint16_t</span> mode;
    <span class="hljs-keyword">uint8_t</span>  paddr[<span class="hljs-number">6</span>];
    <span class="hljs-keyword">uint64_t</span> laddrf;
    <span class="hljs-comment">/* 31:4 = addr of rx desc ring (16 bytes align) +
     * 3:0  = number of descriptors (the power of two)
     * 0x09 is max value (desc number = 512 if [3:0] &gt;= 0x09)
     */</span>
    <span class="hljs-keyword">uint32_t</span> rdra;
    <span class="hljs-comment">/* 31:4 = addr of tx desc ring (16 bytes align) +
     * 3:0  = number of descriptors (the power of two)
     * 0x09 is max value (desc number = 512 if [3:0] &gt;= 0x09)
     */</span>
    <span class="hljs-keyword">uint32_t</span> tdra;<font></font>
} __attribute__((packed));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C laddrf-理解できませんでした。何らかの理由でゼロになり、同じことを行いました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
paddr-ご想像のとおり、macはネットワークカードのアドレスです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rdraとtdraにはメモリ記述子のリングのアドレスが含まれ、下位4ビットがリングのサイズに割り当てられます。これはサイズの対数です。</font><font style="vertical-align: inherit;">つまり、8がある場合、リング内の記述子の数は2 ^ 8（1 &lt;&lt; 8 == 256）になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
modeはカードの動作モードで、ビットは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DRX     (1 &lt;&lt; 0)  <span class="hljs-comment">/* Receiver disable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DTX     (1 &lt;&lt; 1)  <span class="hljs-comment">/* Transmitter disable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LOOP    (1 &lt;&lt; 2)  <span class="hljs-comment">/* loopback */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DTCR    (1 &lt;&lt; 3)  <span class="hljs-comment">/* disable transmit crc */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> COLL    (1 &lt;&lt; 4)  <span class="hljs-comment">/* force collision */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DRTY    (1 &lt;&lt; 5)  <span class="hljs-comment">/* disable retry */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTL    (1 &lt;&lt; 6)  <span class="hljs-comment">/* Internal loopback */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EMBA    (1 &lt;&lt; 7)  <span class="hljs-comment">/* enable modified back-off algorithm */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EJMF    (1 &lt;&lt; 8)  <span class="hljs-comment">/* enable jambo frame */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EPSF    (1 &lt;&lt; 9)  <span class="hljs-comment">/* enable pause frame */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FULL    (1 &lt;&lt; 10)  <span class="hljs-comment">/* full packet mode */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PROM    (1 &lt;&lt; 15) <span class="hljs-comment">/* promiscuous mode */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、すべてを構成したら、ビット10を設定する必要があります。混合モードが必要な場合は、15も設定します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パケット記述子</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、パケット記述子の形式について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
予約：</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_rx_desc</span> {</span>
    <span class="hljs-keyword">uint32_t</span>    base;
    <span class="hljs-keyword">int16_t</span>     buf_length;
    <span class="hljs-keyword">int16_t</span>     status;
    <span class="hljs-keyword">int16_t</span>     msg_length;
    <span class="hljs-keyword">uint16_t</span>    reserved1;
    <span class="hljs-keyword">uint32_t</span>    etmr;<font></font>
} __attribute__((packed));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベース-これがパッケージのバッファーのアドレスであることはおそらく明らかです</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
buf_length- </font><font style="vertical-align: inherit;">バッファー</font><font style="vertical-align: inherit;">のサイズ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
msg_length-実際には、受信後、受信したパケットの長さ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-記述子のステータスが含まれています。</font><font style="vertical-align: inherit;">パケットが準備されてDMA（カード）に渡されると、ビット15（RD_OWN）を設定する必要があります。</font><font style="vertical-align: inherit;">すべてが順調であれば、この記述子でパケットを受信した後、このビットはリセットされ、9（RD_STP）および8（RD_ENP）が設定されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのステータスビットは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* RX Descriptor status bits */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_OWN     (1 &lt;&lt; 15)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_ERR     (1 &lt;&lt; 14)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_FRAM    (1 &lt;&lt; 13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_OFLO    (1 &lt;&lt; 12)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_CRC     (1 &lt;&lt; 11)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_BUFF    (1 &lt;&lt; 10)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_STP     (1 &lt;&lt; 9)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_ENP     (1 &lt;&lt; 8)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_PAM     (1 &lt;&lt; 6)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_LAFM    (1 &lt;&lt; 4)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_BAM     (1 &lt;&lt; 3)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
転送時：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_tx_desc</span> {</span>
    <span class="hljs-keyword">uint32_t</span>    base;
    <span class="hljs-keyword">int16_t</span>     buf_length;
    <span class="hljs-keyword">int16_t</span>     status;
    <span class="hljs-keyword">uint32_t</span>    misc;
    <span class="hljs-keyword">uint32_t</span>    etmr;<font></font>
} __attribute__((packed));<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
受信とほぼ同じで、ステータスビットは次のとおりです。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* TX Descriptor status bits */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_OWN      (1 &lt;&lt; 15)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_ERR      (1 &lt;&lt; 14)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_AFCS     (1 &lt;&lt; 13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_NOINTR   (1 &lt;&lt; 13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_MORE     (1 &lt;&lt; 12)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_ONE      (1 &lt;&lt; 11)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_DEF      (1 &lt;&lt; 10)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_STP      (1 &lt;&lt; 9)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_ENP      (1 &lt;&lt; 8)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットを送信するときは、15（TD_OWN）、9（TD_STP）、8（TD_ENP）を適宜設定する必要があります。</font><font style="vertical-align: inherit;">ビット8は、これが処理される最後のパケットであることを意味します。したがって、パケットが送信される場合、最後のパケットにのみインストールする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重要な機能も忘れてしまいました。記述子のバッファー長は、おそらく追加のコードで、マイナス記号で書かれています。</font><font style="vertical-align: inherit;">リトルエンディアンでも、Elbrusのバイトオーダーは同じであるため、これはおそらく重要ではありません。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理登録</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、最後のアセンブルされていないレジスタL_E1000_E_CSRについて説明します。</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-comment">/* E_CSR register bits */</span>
<span class="hljs-comment">/* 31:21 unused, readed as 0 */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_ATME        (1 &lt;&lt; 24) <span class="hljs-comment">/* RW, Add Timer Enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TMCE        (1 &lt;&lt; 23) <span class="hljs-comment">/* RW, Timer Clear Enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_DRIN        (1 &lt;&lt; 22) <span class="hljs-comment">/* RW, Disable RX Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_DTIN        (1 &lt;&lt; 21) <span class="hljs-comment">/* RW, Disable TX Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_ESLE        (1 &lt;&lt; 20) <span class="hljs-comment">/* RW, Enable Slave Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_SLVE        (1 &lt;&lt; 19) <span class="hljs-comment">/* RW1c, Slave Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_PSFI        (1 &lt;&lt; 18) <span class="hljs-comment">/* RW1c, Pause Frame Interrupt */</span></span>
<span class="hljs-comment">/* 17 unused, read as 0  */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_SINT       (1 &lt;&lt; 16) <span class="hljs-comment">/* R, Status Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_ERR        (1 &lt;&lt; 15) <span class="hljs-comment">/* R, Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_BABL       (1 &lt;&lt; 14) <span class="hljs-comment">/* RW1c, Babble */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_CERR       (1 &lt;&lt; 13) <span class="hljs-comment">/* RW1c, Collision Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_MISS       (1 &lt;&lt; 12) <span class="hljs-comment">/* RW1c, Missed Packet */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_MERR       (1 &lt;&lt; 11) <span class="hljs-comment">/* RW1c, Memory Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_RINT       (1 &lt;&lt; 10) <span class="hljs-comment">/* RW1c, Receiver Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TINT       (1 &lt;&lt; 9)  <span class="hljs-comment">/* RW1c, Transmiter Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_IDON       (1 &lt;&lt; 8)  <span class="hljs-comment">/* RW1c, Initialization Done */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_INTR       (1 &lt;&lt; 7)  <span class="hljs-comment">/* R, Interrupt Flag */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_INEA       (1 &lt;&lt; 6)  <span class="hljs-comment">/* RW, Interrupt Enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_RXON       (1 &lt;&lt; 5)  <span class="hljs-comment">/* R, Receiver On */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TXON       (1 &lt;&lt; 4)  <span class="hljs-comment">/* R, Transmiter On */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TDMD       (1 &lt;&lt; 3)  <span class="hljs-comment">/* RW1, Transmit Demand */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_STOP       (1 &lt;&lt; 2)  <span class="hljs-comment">/* RW1, Stop */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_STRT       (1 &lt;&lt; 1)  <span class="hljs-comment">/* RW1, Start */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_INIT       (1 &lt;&lt; 0)  <span class="hljs-comment">/* RW1, Initialize */</span></span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初期化</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
やや珍しい初期化シーケンスがあります：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STOP-&gt; INIT-&gt; IDON-&gt; STRT</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、RXONおよびTXONビットは個別に立ち上がります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
詳細については、ドライバーをご覧ください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオカード</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、私たちのデバイスはSM718 LynxSE +と呼ばれるSilicon Motion vidyah会社を使用しています。</font><font style="vertical-align: inherit;">したがって、すべてがシンプルで、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ドライバーソース</font></a><font style="vertical-align: inherit;">があり、</font><font style="vertical-align: inherit;">実際に説明することは何もありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、ビデオがそれが非常に低いfpsであることが判明したことを除いて、それはメモリへの遅いアクセスのように感じます。</font><font style="vertical-align: inherit;">しかし、これはコンパイラの最適化なしであり、一般的に、これはおそらくe2kアーキテクチャの誤った使用に関連する私たちの問題です。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さて、</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サハリン</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エルブラス</font><font style="vertical-align: inherit;">について他に何を言い</font><font style="vertical-align: inherit;">ますか？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、天候は正常です:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやら、エルブルスが存在し、働いています。個人的には、この興味深いアーキテクチャの開発の主な問題は、その近さだと思います。比較的小さな会社がプロセッサやコンパイラを作成し、サポートやその他すべてを提供できるとは考えられていません。はい、サードパーティのソフトウェア開発者が登場し始めました。同じBasalt-SPO </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がElbrusにインストールできるAlt-Linuxを</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サポートして</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">います</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
はい、サードパーティの開発者が、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fastwel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">などのElbrusプロセッサをベースにしたハードウェアを作成しているという報告があり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ました</font></a><font style="vertical-align: inherit;">。しかし、これらはすべて、開放性に向けた小さな進歩にすぎません。非常に単純な例で、我々が言ったとここに示されているものを再現するために、我々はコンパイラが必要、とだけ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCSTはそれを持っています</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、記事に記載されている情報は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から受け取った情報に追加されたもの</font><font style="vertical-align: inherit;">であり、まだICSTからでも金属片が見つかる可能性は低いとは言えません。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はかなり古く、</font><font style="vertical-align: inherit;">新しいモデルを提供しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS当然、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emboxリポジトリの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてを見ることができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPS Embox（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://t.me/embox_chat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">介してロシアの電報チャネルに</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アクセスします</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPS Emboxがバージョンの2番目のコンポーネントを更新しました。現在のバージョンは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.4.0です。</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485672/index.html">Redisのベストプラクティス、パート1</a></li>
<li><a href="../ja485678/index.html">Javaバックエンド、Javaコアをインタビューするための質問（60の質問）</a></li>
<li><a href="../ja485682/index.html">時間管理は役に立たない：先延ばしは時間ではなく感情を調整する問題</a></li>
<li><a href="../ja485688/index.html">Myappが休日を延長</a></li>
<li><a href="../ja485692/index.html">ITスペシャリストによるお客様へのアドバイス、または混乱を自動化する方法</a></li>
<li><a href="../ja485696/index.html">最も用途の広い7セグメントディスプレイ。パート1-ハードウェア</a></li>
<li><a href="../ja485698/index.html">リーフレット。キャンバスで友達の画像</a></li>
<li><a href="../ja485702/index.html">FunCorp iOSミートアップ＃2</a></li>
<li><a href="../ja485704/index.html">初心者のためのピクセルアート：一般的な間違いの修正</a></li>
<li><a href="../ja485706/index.html">会議「デジタルトランスフォーメーションとデータサイエンスにおける新しい役割」にご招待します。</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>