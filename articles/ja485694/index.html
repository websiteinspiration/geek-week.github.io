<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥¦ ğŸ‘†ğŸ¿ ğŸ¥ Elbrusãƒ—ãƒ­ã‚»ãƒƒã‚µã®Emboxã€‚ã¾ãŸã¯ã€ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ã§å¾—ãŸã‚‚ã®ã‚’æ±ºã—ã¦å¿˜ã‚Œãªã„ ğŸ¿ ğŸ‘†ğŸ¾ ğŸ’›</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã®è¨˜äº‹ã§ã¯ã€ã¨è«–ç†çš„ãªçµè«–ã§ã‚ã‚‹ä¸€é€£ã® ã€Œã‚¯ãƒ©ã‚¤ãƒŸãƒ³ã‚°Elbrusã€è¨˜äº‹ å°å…¥ã®ã‚¨ãƒ ãƒœãƒƒã‚¯ã‚¹ã‚’ã«Elbrusãƒ—ãƒ­ã‚»ãƒƒã‚µã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆE2Kï¼‰ ã€‚çµæœã¨ã—ã¦ã€ç”»é¢ä¸Šã«ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’telnetã‚’ä»‹ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã£ãŸãŸã‚ã€ã¤ã¾ã‚Šã€ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§Emboxã®ã™ã¹ã¦ã®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Elbrusãƒ—ãƒ­ã‚»ãƒƒã‚µã®Emboxã€‚ã¾ãŸã¯ã€ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ã§å¾—ãŸã‚‚ã®ã‚’æ±ºã—ã¦å¿˜ã‚Œãªã„</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/485694/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§ã¯ã€ã¨è«–ç†çš„ãªçµè«–ã§ã‚ã‚‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€é€£ã®</font></font></a> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã€Œã‚¯ãƒ©ã‚¤ãƒŸãƒ³ã‚°Elbrusã€</font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°å…¥ã®</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã‚¨ãƒ ãƒœãƒƒã‚¯ã‚¹ã‚’</font></a><font style="vertical-align: inherit;">ã«</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Elbrusãƒ—ãƒ­ã‚»ãƒƒã‚µã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆE2Kï¼‰ </font></a><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">çµæœã¨ã—ã¦ã€ç”»é¢ä¸Šã«ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’telnetã‚’ä»‹ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã£ãŸãŸã‚ã€ã¤ã¾ã‚Šã€ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§Emboxã®ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã•ã‚‰ãªã‚‹ç ”ç©¶ã¯åºè«–ã¨ã¯è¨€ã„é›£ã„ãŒã€ã‚‚ã¡ã‚ã‚“ã€å¤šãã¯ä¸æ˜ç¢ºãªã¾ã¾ã§ã‚ã‚‹ã€‚ã¾ãŸã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è‡ªä½“ã«ã¯å¤šãã®èˆˆå‘³æ·±ã„æ©Ÿèƒ½ãŒã‚ã‚Šã€ã“ã‚Œã‚‰ã‚‚ç¾åœ¨ç†è§£ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€ä»®æƒ³ãƒ¡ãƒ¢ãƒªã®æ§‹æˆã«ç„¦ç‚¹ã‚’å½“ã¦ã€PCIã«è§¦ã‚Œã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ã«ã¤ã„ã¦å°‘ã—èª¬æ˜ã—ã€ç‰¹å®šã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®ãƒ“ãƒ‡ã‚ªã‚«ãƒ¼ãƒ‰ã«è§¦ã‚Œã¾ã™ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ€ æƒ°ã§è¨˜äº‹ã‚’èª­ã‚€ã“ã¨ãŒã§ããªã„äººã®ãŸã‚ã«ã€ç§ã¯ã™ãã«çµæœã‚’å«ã‚€çŸ­ã„ãƒ“ãƒ‡ã‚ªã‚’ã‚ã’ã¾ã™ã€‚</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/FqOSFJ36B48" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€èˆˆå‘³ã®ã‚ã‚‹æ–¹ã®ãŸã‚ã«ã€ãƒ—ãƒ­ã‚»ã‚¹ã§ç†è§£ã§ããŸæŠ€è¡“çš„ãªè©³ç´°ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»®æƒ³ãƒ¡ãƒ¢ãƒª</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¹ã‚¿ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»®æƒ³ãƒ¡ãƒ¢ãƒªã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚å®Ÿéš›ã€ã“ã‚Œã¯</font><font style="vertical-align: inherit;">ã‚·ãƒªãƒ¼ã‚ºã®</font><font style="vertical-align: inherit;">å‰å›ã®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨˜äº‹ã§</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£æ±ºã—ãŸã‚‚ã®</font><font style="vertical-align: inherit;">ã§ã™ã€‚ Emboxã¯ä»®æƒ³ãƒ¡ãƒ¢ãƒªãŒãªãã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã€ä»®æƒ³ãƒ¡ãƒ¢ãƒªãŒå¿…è¦ãªç†ç”±ã‚’ã™ãã«è¦šãˆã¦ãŠãä¾¡å€¤ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯ç°¡å˜ã§ã™ï¼šäº‹ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã§ã™ã€‚ Vidyahaã¯æ©Ÿèƒ½ã—ã¾ã—ãŸãŒã€ä¿¡é ¼æ€§ã®é«˜ã„ç”»åƒæ¤œç´¢ã®ãŸã‚ã«ãƒ“ãƒ‡ã‚ªãƒ¡ãƒ¢ãƒªãƒ¼ã«åŒã˜ã‚‚ã®ã‚’2å›æ›¸ãè¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å‡¦ç†ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã—ãŸãŒã€ç§ãŸã¡ã®ä¾‹ã§ã¯ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ãªã©ã®æ ¸ã¨ãªã‚‹ã‚‚ã®ãªã—ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ç›´æ¥ãƒ“ãƒ‡ã‚ªãƒ¡ãƒ¢ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ¡ãƒ¢ãƒªã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¸å¯ã¨ã—ã¦ãƒãƒƒãƒ—ã™ã‚‹æ–¹æ³•ã‚’å­¦ã¶ã®ã¯æ­£ã—ã‹ã£ãŸã§ã™ã€‚ Linuxã§ã‚‚ãƒ‡ãƒã‚¤ã‚¹fbã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§åŒã˜ã“ã¨ãŒã§ãã¾ã™ï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¾‹</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elbrusã«ã¤ã„ã¦é•·ã„é–“æ›¸ã„ã¦ã„ãªã„ã®ã§ã€ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®MMUã¯ã‚ã‚‹ç¨®ã®è¶…è¤‡é›‘ã§ã‚ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€çŠ¶æ³ã¯ç•°ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã€ç§ãŸã¡ã¯å¤ã«ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸãŒã€ãã‚Œã«ã¤ã„ã¦æ›¸ãæ‰‹ãŒå±Šãã¾ã›ã‚“ã§ã—ãŸã€‚ãã—ã¦ã€ç§ãŸã¡ã®æ„šã‹ãªé–“é•ã„ã®ãŸã‚ã«é•·ã„æ™‚é–“ï¼ˆæ•°ãƒ¶æœˆï¼‰ãŒè²»ã‚„ã•ã‚Œã¾ã—ãŸã€‚ã“ã®é–“é•ã„ã¯ã€è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚‚ã‚ã‚Šã¾ã—ãŸï¼ˆã€Œã¾ãŸã¯ã€ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ä¸­ã«å¾—ãŸã‚‚ã®ã‚’æ±ºã—ã¦å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€ï¼‰ã€‚ç§ãŸã¡ãŒã‚ˆãæ‰±ã£ã¦ã„ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã«ã¤ã„ã¦è©±ã—ã¦ãŠã‚Šã€Climbing </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">Elbrus-Reconnaissanceã®</font></a><font style="vertical-align: inherit;">è¨˜äº‹ã§ã“ã‚Œã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãƒ‘ãƒ¼ãƒˆ1.ãƒ¬ã‚¸ã‚¹ã‚¿ã€ã‚¹ã‚¿ãƒƒã‚¯ã€ãã®ä»–ã®æŠ€è¡“çš„ãªè©³ç´°ã€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ç§ãŸã¡ã¯éå¸¸ã«é•·ã„é–“è‹¦ã—ã¿ã€å¤–éƒ¨ã®ã©ã“ã‹ã‹ã‚‰ï¼ˆã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹ï¼‰åˆæœŸã‚¹ã‚¿ãƒƒã‚¯ã‚’å–å¾—ã—ã€ã™ã¹ã¦ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã¨ã„ã†äº‹å®Ÿã‚’è¦‹å¤±ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">EmboxãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚‚ã®ã§ã€ã“ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çŒ«ã®ä¸‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ã€ã‚·ãƒªãƒ¼ã‚ºã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2ç•ªç›®ã®è¨˜äº‹ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹æ–°ã—ã„é–¢æ•°e2k_entryã‚’æä¾›ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¿…è¦ã«å¿œã˜ã¦ã€æ¯”è¼ƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">__attribute__ ((__section__(<span class="hljs-string">".e2k_entry"</span>)))
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">e2k_entry</span><span class="hljs-params">(struct pt_regs *regs)</span> </span>{
    <span class="hljs-comment">/* Since we enable exceptions only when all CPUs except the main one
     * reached the idle state (cpu_idle), we can rely that order and can
     * guarantee exceptions happen strictly after all CPUS entries. */</span>
    <span class="hljs-keyword">if</span> (entries_count &gt;= CPU_COUNT) {
        <span class="hljs-comment">/* Entering here because of exception or interrupt */</span><font></font>
        e2k_trap_handler(regs);<font></font>
<font></font>
        RESTORE_COMMON_REGS(regs);<font></font>
<font></font>
        E2K_DONE;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/* It wasn't exception, so we decide this usual program execution,
     * that is, Embox started on CPU0 or CPU1 */</span><font></font>
<font></font>
    e2k_wait_all();<font></font>
<font></font>
    entries_count = __e2k_atomic32_add(<span class="hljs-number">1</span>, &amp;entries_count);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (entries_count &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-comment">/* XXX currently we support only single core */</span>
        <span class="hljs-comment">/* Run cpu_idle on 2nd CPU */</span><font></font>
<font></font>
        <span class="hljs-comment">/* it's just needed if log_debug enabled in e2k_context module
         * else output will be wrong because 2 cpu printing at the same time */</span>
        <span class="hljs-keyword">while</span>(!sync_count);<font></font>
<font></font>
        context_init(&amp;cpu_ctx[<span class="hljs-number">0</span>], CONTEXT_PRIVELEGED | CONTEXT_IRQDISABLE, cpu_idle, idle_stack, <span class="hljs-keyword">sizeof</span>(idle_stack));<font></font>
        context_switch(&amp;cpu_ctx_prev[<span class="hljs-number">0</span>], &amp;cpu_ctx[<span class="hljs-number">0</span>]);<font></font>
    }<font></font>
    <span class="hljs-comment">/* Run e2k_kernel_start on 1st CPU */</span>
    context_init(&amp;cpu_ctx[<span class="hljs-number">1</span>], CONTEXT_PRIVELEGED | CONTEXT_IRQDISABLE, e2k_kernel_start, &amp;_stack_top, KERNEL_STACK_SZ);<font></font>
    sync_count = __e2k_atomic32_add(<span class="hljs-number">1</span>, &amp;sync_count);<font></font>
    context_switch(&amp;cpu_ctx_prev[<span class="hljs-number">1</span>], &amp;cpu_ctx[<span class="hljs-number">1</span>]);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¹ã‚¿ãƒƒã‚¯ã‚’Emboxç©ºé–“ã®ãƒ¡ãƒ¢ãƒªã«åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã«ã®ã¿context_initï¼ˆï¼‰ãŠã‚ˆã³context_switchï¼ˆï¼‰é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’èª¬æ˜ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã‚’å«ã‚€ã™ã¹ã¦ã®ã‚³ã‚¢ã«å¯¾ã—ã¦ã“ã‚Œã‚’è¡Œã„ã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MMUã®çµ„ç¹” </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€E2kã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹MMUã®æ§‹æˆã«ã¤ã„ã¦å°‘ã—ãŠè©±ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€èˆ¬ã«ã€MMUã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã”ãæ™®é€šã§ã€4ãƒ¬ãƒ™ãƒ«ã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ4MBãƒšãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯3ã¤ï¼‰ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E2kã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¯ã„ãã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ã‚¿ã«ã¯ã€ä»£æ›¿ã®ã‚¹ãƒšãƒ¼ã‚¹ã€ãŠã‚ˆã³è¨˜äº‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ŒEmboxãŒElbrusã‚’ç™»ã‚Šå§‹ã‚ã‚‹ã€</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã§ç°¡å˜ã«èª¬æ˜ã—ãŸI / Oã‚¹ãƒšãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™</font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®ã‚ˆã†ãªãƒ¬ã‚¸ã‚¹ã‚¿ãŒå¿…è¦ã§ã™ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_CR          0x00  <span class="hljs-comment">/* Control register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_CONT        0x10  <span class="hljs-comment">/* Context register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_CR3_RG      0x20  <span class="hljs-comment">/* CR3 register for INTEL only */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_ELB_PTB     0x30  <span class="hljs-comment">/* ELBRUS page table virtual base */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MMU_REG_ROOT_PTB    0x40  <span class="hljs-comment">/* Root Page Table Base register */</span>/</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Ÿéš›ã«ã¯ã€ã“ã‚Œã¯åˆ¶å¾¡ãƒ¬ã‚¸ã‚¹ã‚¿ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç•ªå·ãƒ¬ã‚¸ã‚¹ã‚¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ã‚¿ã€ãŠã‚ˆã³å°‘ã—ã‚ã„ã¾ã„ãªMMU_REG_ELB_PTBã§ã™ã€‚ãã‚Œã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã¯ä½•ã‚‰ã‹ã®å€¤ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã®512GBã¯æ©Ÿå™¨ã®ãƒ‹ãƒ¼ã‚ºã®ãŸã‚ã«ãƒ—ãƒ­ã‚»ãƒƒã‚µã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã€ãƒ—ãƒ­ã‚°ãƒ©ãƒã¯ã“ã‚Œã‚‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚Šã¾ã™ã€‚ ICSTã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã‹ã‚‰ã®æ‰‹ç´™ã§èª¬æ˜ã—ã¾ã™ãŒã€ã“ã‚Œä»¥ä¸Šã®èª¬æ˜ã¯ã§ãã¾ã›ã‚“ã€‚</font></font><br>
<br>
<blockquote> Linux   MMU_ELB_PTB  0xff1 &lt;&lt; 39,  <br>
    (0xff8000000000 â€” 0xffffffffffff)<br>
   ,  , TLB.  <br>
  ()       ,<br>
      ,   <br>
  .  .. TLB    <br>
,          TLB<br>
     ,     .<br>
<br>
  /,    TLB  <br>
  ,    .<br>
<br>
 ,    TLB     <br>
   (pgd*),       (pte*).<br>
      , .  <br>
        TLB.   ,   <br>
 pgd       .  <br>
  .     <br>
 4   ff80'0000'0000 â€” ffff'ffff'ffff â€” ..  <br>
  .     pgd* <br>
 /,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã®çµæœã€å˜ç´”ã«ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ¼ã«å¤§ããªå€¤ã‚’å…¥ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚çµå±€ã®ã¨ã“ã‚ã€ææ¡ˆã•ã‚ŒãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãƒšãƒ¼ã‚¸ã®æ¤œç´¢ã‚’æœ€é©åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ã¾ã æœ€é©åŒ–ã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã›ã‚“ã€‚ Linuxã¨åŒã˜ã‚ˆã†ã«æä¾›ã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«åˆ¶å¾¡ãƒ¬ã‚¸ã‚¹ã‚¿ã€‚ MMUã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ—¢çŸ¥ã®ãƒ“ãƒƒãƒˆã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_TLB_EN   0x0000000000000001 <span class="hljs-comment">/* translation enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CD_MASK  0x0000000000000006 <span class="hljs-comment">/* cache disable bits */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_SET1     0x0000000000000008 <span class="hljs-comment">/* set #1 enable for 4 MB pages */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_SET2     0x0000000000000010 <span class="hljs-comment">/* set #2 enable for 4 MB pages */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_SET3     0x0000000000000020 <span class="hljs-comment">/* set #3 enable for 4 MB pages */</span></span>
<span class="hljs-comment">/* paging enable for second space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CR0_PG   0x0000000000000040</span>
<span class="hljs-comment">/* page size 4Mb enable for second space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CR4_PSE  0x0000000000000080</span>
<span class="hljs-comment">/* cache disable for secondary space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_CR0_CD   0x0000000000000100</span>
<span class="hljs-comment">/* TLU enable for secondary space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_TLU2_EN  0x0000000000000200</span>
<span class="hljs-comment">/* memory protection table enable for LD from secondary space INTEL */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_LD_MPT   0x0000000000000400</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_IPD_MASK 0x0000000000000800 <span class="hljs-comment">/* Instruction Prefetch Depth */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _MMU_CR_UPT_EN   0x0000000000001000 <span class="hljs-comment">/* enable UPT */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¤‰æ›ã‚’å«ã‚€æœ€åˆã®ãƒ“ãƒƒãƒˆã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
_MMU_CR_SET3ã‚‚è¨­å®šã—ã¾ã™ãŒã€ç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã§ã“ã‚Œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚‹ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚³ãƒ³ãƒ†ã‚¹ãƒˆç™»éŒ²ã¾ã‚ã€å˜ç´”ã§ã‚ã‚Œã°ã€ã“ã‚Œã¯ãƒ—ãƒ­ã‚»ã‚¹ã¾ãŸã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã®PIDã§ã™ã€‚ã‚ˆã‚ŠæŠ€è¡“çš„ã«ã¯ã€ã“ã‚Œã¯11ãƒ“ãƒƒãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹æ‹¡å¼µã§ã™ã€‚ç§ãŸã¡ã®å ´åˆã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã«å°‘ã—ã‚°ãƒ­ãƒ¼ãƒãƒ«æ€§ã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã‚’æ ¸ã«ã—ã€1ã¤ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ã“ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã§ã‚¼ãƒ­ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚¸ã‚¹ã‚¿ã«ã¯ã€å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…ˆé ­ã®ç‰©ç†ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®ãƒã‚¤ãƒ³ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚ MMU_REG_ELB_PTBãƒ¬ã‚¸ã‚¹ã‚¿ã§æŒ‡å®šã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§ä¸æ­£è¡Œç‚ºã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ãŒã€å‰è¿°ã®ã¨ãŠã‚Šã€æœ€é©åŒ–ã«é‡ç‚¹ã‚’ç½®ã„ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»–ã«ä½•ãŒè¨€ãˆã‚‹ã‹ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ§‹é€ ã¯ã”ãæ™®é€šã§ã€ãƒ•ãƒ©ã‚°ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_P       0x0000000000000001ULL <span class="hljs-comment">/* Page Present bit */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_W       0x0000000000000002ULL <span class="hljs-comment">/* Writable (0 - only read) */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_UU2     0x0000000000000004ULL <span class="hljs-comment">/* unused bit # 2 */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_PWT     0x0000000000000008ULL <span class="hljs-comment">/* Write Through */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_CD1     0x0000000000000010ULL <span class="hljs-comment">/* Cache disable (right bit) */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_A       0x0000000000000020ULL <span class="hljs-comment">/* Accessed Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_D       0x0000000000000040ULL <span class="hljs-comment">/* Page Dirty */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_HUGE    0x0000000000000080ULL <span class="hljs-comment">/* Page Size */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_G       0x0000000000000100ULL <span class="hljs-comment">/* Global Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_CD2     0x0000000000000200ULL <span class="hljs-comment">/* Cache disable (left bit) */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_NWA     0x0000000000000400ULL <span class="hljs-comment">/* Prohibit address writing */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_AVAIL   0x0000000000000800ULL <span class="hljs-comment">/* Available page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_PFN     0x000000fffffff000ULL <span class="hljs-comment">/* Physical Page Number */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_VALID   0x0000010000000000ULL <span class="hljs-comment">/* Valid Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_PV      0x0000020000000000ULL <span class="hljs-comment">/* PriVileged Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_INT_PR  0x0000040000000000ULL <span class="hljs-comment">/* Integer address access Protection */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_NON_EX  0x0000080000000000ULL <span class="hljs-comment">/* Non Executable Page */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_RES     0x0000f00000000000ULL <span class="hljs-comment">/* Reserved bits */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E2K_MMU_PAGE_C_UNIT  0xffff000000000000ULL <span class="hljs-comment">/* Compilation Unit */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¬¬4ãƒ¬ãƒ™ãƒ«ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®å ´åˆã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚·ãƒ•ãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __MMU_PGD_SHIFT      (PAGE_SHIFT + 3 * (PAGE_SHIFT-3)) <span class="hljs-comment">/* 39 */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __MMU_PUD_SHIFT      (PAGE_SHIFT + 2 * (PAGE_SHIFT-3)) <span class="hljs-comment">/* 30 */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __MMU_PMD_SHIFT      (PAGE_SHIFT + 1 * (PAGE_SHIFT-3)) <span class="hljs-comment">/* 21 */</span></span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCIã«ã¤ã„ã¦å°‘ã—</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»£æ›¿ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ä»‹ã—ãŸé€šä¿¡</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vidyahaã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ã«ç§»ã‚‹å‰ã«ã€ç°¡å˜ã«PCIã«æˆ»ã‚Šã¾ã—ã‚‡ã†ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€ŒEmboxãŒã‚¨ãƒ«ãƒ–ãƒ«ã‚¹å±±ã«ç™»ã‚Šå§‹ã‚ã‚‹ã€ã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆã®éƒ¨åˆ†ã§ã€ã“ã‚Œã«ã¤ã„ã¦å°‘ã—è©±ã—ã¾ã—ãŸ</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä»£æ›¿ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®ãƒã‚¯ãƒ­ã‚’ç¤ºã—ã¾ã—ãŸã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \
({ \
    register type res; \
    asm volatile (<span class="hljs-meta-string">"ld"</span> #size_letter <span class="hljs-meta-string">","</span> #chan_letter <span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span> \
                  : <span class="hljs-meta-string">"=r"</span> (res) \
                  : <span class="hljs-meta-string">"r"</span> ((__e2k_ptr_t) (addr)), \
                    <span class="hljs-meta-string">"i"</span> (mas)); \
    res; \
})</span><font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \
({ \
    asm volatile (<span class="hljs-meta-string">"st"</span> #size_letter <span class="hljs-meta-string">","</span> #chan_letter <span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span> \
                  : \
                  : <span class="hljs-meta-string">"r"</span> ((__e2k_ptr_t) (addr)), \
                    <span class="hljs-meta-string">"r"</span> ((type) (val)), \
            <span class="hljs-meta-string">"i"</span> (mas) \
          : <span class="hljs-meta-string">"memory"</span>); \
})</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã®åŸç†ã¸ã®è¨€åŠãŒã‚ã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ç•°ãªã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¯ã€MASï¼ˆãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹æŒ‡å®šå­ï¼‰ã‚’ä½¿ç”¨ã—ã¦å®šç¾©ã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€ãŸã¨ãˆã°ã€PCIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ä½¿ç”¨ã•ã‚Œã‚‹IOã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€6ã‚’ä½¿ç”¨ã—ã€MMU 7ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãã—ã¦ã€e2kã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜ã‚’è¦‹ã‚‹ã¨ã€</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDD dddãƒ€ãƒ–ãƒ«ãƒ¯ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ldd [ã‚¢ãƒ‰ãƒ¬ã‚¹] masã€dst</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¤ã¾ã‚Šã€ä¸€è¦‹ã™ã‚‹ã¨ã€ãƒãƒ£ãƒãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ãƒªãƒ³ã‚¯ã‚’ãŸã©ã‚‹ã¨ã€ç‰¹å®šã®æ“ä½œlddã®ã‚³ãƒ¼ãƒ‰ã¯67ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€67ã¯ã€ãƒãƒ£ãƒãƒ«AL0 / AL3ãŠã‚ˆã³AL2 / AL5ã®lddã®ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Šã€ãƒãƒ£ãƒãƒ«AL1 / AL4ã®å ´åˆã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯æ“ä½œPOPCNTdã«å¯¾å¿œã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã—ãŸãŒã£ã¦ã€Elbrusã®ç”¨èªã«å«ã¾ã‚Œã‚‹ãƒãƒ£ãƒãƒ«ã‚’å®Œå…¨ã«ç†è§£ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã®ã‚¿ã‚¤ãƒ—ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ã€æ©Ÿèƒ½ã®1ã¤ãŒè¤‡æ•°ã®ç‹¬ç«‹ã—ãŸã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ãƒã‚¤ã‚¹ã®å­˜åœ¨ã§ã‚ã‚‹ãŸã‚ã€ä½¿ç”¨ã™ã‚‹aluã‚’æŒ‡å®šã§ãã‚‹å ´åˆã€ã“ã‚Œã¯æ—¢ã«vliwã®åŸå‰‡ã«é–¢é€£ã—ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚‚ã¡ã‚ã‚“ã€é–“é•ã„ã¯ã‚ã‚Šã¾ã™ãŒã€PCIã¾ãŸã¯MMUã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€2ç•ªç›®ã¾ãŸã¯5ç•ªç›®ã®ãƒãƒ£ãƒãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ã‚³ãƒãƒ³ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lddã€2 0x0ã€[addr_in_mas] mas_idã€ï¼…reg</font></font></blockquote><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lspci</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€æ‰€æœ‰ã—ã¦ã„ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã§ã®lspciã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›çµæœã‚’ç¤ºã—ã¾ã™ã€‚</font></font><br>
<blockquote>root@embox:(null)#lspci<br>
00: 0.0 (PCI dev E3E3:ABCD) [6 4]<br>
 PCI-to-PCI bridge: (null) Elbrus PCIe bridge (rev 01)<br>
00: 1.0 (PCI dev 8086:E3E3) [6 4]<br>
 PCI-to-PCI bridge: Intel Corporation Elbrus Virt PCI bridge (rev 01)<br>
01: 0.0 (PCI dev 1FFF:8000) [6 4]<br>
 PCI-to-PCI bridge: (null) Elbrus PCI bridge (rev 05)<br>
01: 1.0 (PCI dev 8086:4D45) [2 0]<br>
 Ethernet controller: Intel Corporation MCST ETH1000 Gigabit Ethernet (rev 01)<br>
01: 2.0 (PCI dev 8086:4D49) [1 1]<br>
 IDE controller: Intel Corporation MCST IDE (rev 128)<br>
01: 2.1 (PCI dev 8086:0002) [7 2]<br>
 Simple comm. controller: Intel Corporation (null) (rev 05)<br>
01: 2.2 (PCI dev 8086:8000) [7 128]<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼šIntel Corporation Elbrus PCIãƒ–ãƒªãƒƒã‚¸ï¼ˆrev 00ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01ï¼š2.3ï¼ˆPCI dev 1013ï¼š6005ï¼‰[4 1] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒã‚¤ã‚¹ï¼šCirrus Logic Crystal CS4281 PCI Audioï¼ˆrev 01ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01ï¼š3.0ï¼ˆPCI dev 8086ï¼š4748ï¼‰[1 6] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 å¤§å®¹é‡è¨˜æ†¶ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼šIntel Corporation MCST SATAï¼ˆrev 00ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01ï¼š4.0ï¼ˆPCI dev 8086ï¼š554Fï¼‰[12 3] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 USBãƒ‡ãƒã‚¤ã‚¹ï¼šIntel Corporation OHCI for Elbrusï¼ˆrev 00ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01ï¼š4.1ï¼ˆPCI dev 8086ï¼š5545ï¼‰ [12 3] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 USBãƒ‡ãƒã‚¤ã‚¹ï¼šIntel Corporation EHCI for Elbrusï¼ˆrev 00ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
02ï¼š1.0ï¼ˆPCI dev 126Fï¼š0718ï¼‰[3 0] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 VGAäº’æ›ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼šSilicon Motionã€Inc. </font><font style="vertical-align: inherit;">SM718 LynxSE +ï¼ˆrev 160ï¼‰</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
root @ emboxï¼šï¼ˆnullï¼‰ï¼ƒ</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ³¨æ„</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01ï¼š2.2ï¼ˆPCI dev 8086ï¼š8000ï¼‰[7 128] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ã‚·ãƒ³ãƒ—ãƒ«ãªé€šä¿¡ã€‚</font><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ï¼šIntel Corporation Elbrus PCIãƒ–ãƒªãƒƒã‚¸ï¼ˆrev 00ï¼‰</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Ÿéš›ã€ã“ã‚Œã¯ã€am85c30ã¨åŒæ§˜ã®MCSTã‹ã‚‰ã®ã‚·ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒˆã§ã‚ã‚Šã€å°‘ãªãã¨ã‚‚ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã¯minicomã‚’ä»‹ã—ã¦é€šä¿¡ã—ã¾ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LANã‚«ãƒ¼ãƒ‰</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸€èˆ¬çš„ãªæ§‹é€ </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã‚Œã§ã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§ãŒæ­£ã—ãç†è§£ã—ã¦ã„ã‚Œã°ã€ã“ã‚Œã¯å…ƒã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ã§ã™ã€‚æ“ä½œã¯e1000ã¨å°‘ã—ä¼¼ã¦ã„ã¾ã™ãŒã€æ“ä½œã®ç‚¹ã§ã®ã¿ã§ã™ï¼ˆå—ä¿¡ã‚­ãƒ¥ãƒ¼ã¨é€ä¿¡ã‚­ãƒ¥ãƒ¼å†…ã®è¨˜è¿°å­ã®å­˜åœ¨ãªã©ï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ç§ãŸã¡ãŒé­é‡ã—ãŸé‡è¦ãªãƒã‚¤ãƒ³ãƒˆã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰PCI VIDï¼šPID 0x8086ï¼š0x4D45ã€‚</font><font style="vertical-align: inherit;">VIDãŒIntelã¨åŒã˜ã§ã‚ã‚‹ã“ã¨ã«é©šã‹ãªã„ã§ãã ã•ã„ã€‚MCSTã¯ã“ã®ç‰¹å®šã®VIDã‚’ã‚ˆãä½¿ç”¨ã—ã¾ã™ã€‚å°‘ãªãã¨ã‚‚ä¸Šè¨˜ã®ã‚·ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BAR0ã«ã¯ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_E_CSR         0x00 <span class="hljs-comment">/* Ethernet Control/Status Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_MGIO_CSR      0x04 <span class="hljs-comment">/* MGIO Control/Status Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_MGIO_DATA     0x08 <span class="hljs-comment">/* MGIO Data Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_E_BASE_ADDR   0x0c <span class="hljs-comment">/* EthernetBase Address Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_DMA_BASE_ADDR 0x10 <span class="hljs-comment">/* DMA Base Address Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_PSF_CSR       0x14 <span class="hljs-comment">/* Pause Frame Control/Status Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_PSF_DATA      0x18 <span class="hljs-comment">/* Pause Frame Data Register */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> L_E1000_INT_DELAY     0x1c <span class="hljs-comment">/* Interrupt Delay Register */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€å¾Œã®3ã¤ï¼ˆL_E1000_PSF_CSRã€L_E1000_PSF_DATAã€L_E1000_INT_DELAYï¼‰ã¯ä½¿ç”¨ã—ãªã‹ã£ãŸã®ã§ã€ãã‚Œã‚‰ã«ã¤ã„ã¦ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚</font><font style="vertical-align: inherit;">MGIOã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚MIIãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ãŸèª­ã¿æ›¸ãã€ã¤ã¾ã‚ŠPHYãƒãƒƒãƒ—ã¨ã®é€šä¿¡ã¯ã™ã¹ã¦å˜ç´”ã§ã™ã€‚</font><font style="vertical-align: inherit;">å…·ä½“çš„ã«ã¯ã€ãƒãƒƒãƒ—DP83865ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰‹é †ã¯ç‰¹ã«æ³¨ç›®ã«å€¤ã™ã‚‹ã‚‚ã®ã§ã¯ãªãã€ä¸€è¦§ã‚’æä¾›ã™ã‚‹ã ã‘ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
èª­æ›¸ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">e1000_mii_readreg</span><span class="hljs-params">(struct net_device *dev, <span class="hljs-keyword">int</span> phy_id, <span class="hljs-keyword">int</span> reg_num)</span> </span>{
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_priv</span> *<span class="hljs-title">ep</span> = <span class="hljs-title">netdev_priv</span>(<span class="hljs-title">dev</span>);</span>
	<span class="hljs-keyword">uint32_t</span> rd;
	<span class="hljs-keyword">uint16_t</span> val_out = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<font></font>
<font></font>
	rd = <span class="hljs-number">0</span>;<font></font>
	rd |= <span class="hljs-number">0x2</span> &lt;&lt; MGIO_CS_OFF;<font></font>
	rd |= <span class="hljs-number">0x1</span> &lt;&lt; MGIO_ST_OF_F_OFF;<font></font>
	rd |= <span class="hljs-number">0x2</span> &lt;&lt; MGIO_OP_CODE_OFF; <span class="hljs-comment">/* Read */</span>
	rd |= (phy_id  &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_PHY_AD_OFF;<font></font>
	rd |= (reg_num &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_REG_AD_OFF;<font></font>
<font></font>
	e1000_write_mgio_data(ep, rd);<font></font>
	rd = <span class="hljs-number">0</span>;<font></font>
<font></font>
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i != <span class="hljs-number">1000</span>; i++) {
		<span class="hljs-keyword">if</span> (e1000_read_mgio_csr(ep) &amp; MGIO_CSR_RRDY) {<font></font>
			rd = (<span class="hljs-keyword">uint16_t</span>)e1000_read_mgio_data(ep);<font></font>
<font></font>
			val_out = rd &amp; <span class="hljs-number">0xffff</span>;<font></font>
			log_debug(<span class="hljs-string">"reg 0x%x &gt;&gt;&gt; 0x%x"</span>, reg_num, val_out);
			<span class="hljs-keyword">return</span> val_out;<font></font>
		}<font></font>
		usleep(<span class="hljs-number">100</span>);<font></font>
	}<font></font>
<font></font>
	log_error(<span class="hljs-string">"mdio_read: Unable to read from MGIO_DATA reg\n"</span>);<font></font>
<font></font>
	<span class="hljs-keyword">return</span> val_out;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¨˜éŒ²ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">e1000_mii_writereg</span><span class="hljs-params">(struct net_device *dev, <span class="hljs-keyword">int</span> phy_id, <span class="hljs-keyword">int</span> reg_num, <span class="hljs-keyword">int</span> val)</span> </span>{
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_priv</span> *<span class="hljs-title">ep</span> = <span class="hljs-title">netdev_priv</span>(<span class="hljs-title">dev</span>);</span>
	<span class="hljs-keyword">uint32_t</span> wr;
	<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<font></font>
<font></font>
	wr = <span class="hljs-number">0</span>;<font></font>
	wr |= <span class="hljs-number">0x2</span> &lt;&lt; MGIO_CS_OFF;<font></font>
	wr |= <span class="hljs-number">0x1</span> &lt;&lt; MGIO_ST_OF_F_OFF;<font></font>
	wr |= <span class="hljs-number">0x1</span> &lt;&lt; MGIO_OP_CODE_OFF; <span class="hljs-comment">/* Write */</span>
	wr |= (phy_id  &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_PHY_AD_OFF;<font></font>
	wr |= (reg_num &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; MGIO_REG_AD_OFF;<font></font>
	wr |= val &amp; <span class="hljs-number">0xffff</span>;<font></font>
<font></font>
	log_debug(<span class="hljs-string">"reg 0x%x &lt;&lt;&lt; 0x%x"</span>, reg_num, val);<font></font>
	e1000_write_mgio_data(ep, wr);<font></font>
<font></font>
	<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i != <span class="hljs-number">1000</span>; i++) {
		<span class="hljs-keyword">if</span> (e1000_read_mgio_csr(ep) &amp; MGIO_CSR_RRDY) {
			<span class="hljs-keyword">return</span>;<font></font>
		}<font></font>
		usleep(<span class="hljs-number">100</span>);<font></font>
	}<font></font>
	log_error(<span class="hljs-string">"Unable to write MGIO_DATA reg: val = 0x%x"</span>, wr);
	<span class="hljs-keyword">return</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¾åœ¨ã€L_E1000_DMA_BASE_ADDRãŠã‚ˆã³L_E1000_E_BASE_ADDRã¯ã€å®Ÿéš›ã«ã¯1ã¤ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰è¨˜è¿°ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã¤ã¾ã‚Šã€Elbrusã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯64ãƒ“ãƒƒãƒˆã§ã€ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ¼ã¯32ãƒ“ãƒƒãƒˆã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-comment">/* low 32 bits */</span>
    init_block_addr_part = (<span class="hljs-keyword">uint32_t</span>)((<span class="hljs-keyword">uintptr_t</span>)ep-&gt;init_block &amp; <span class="hljs-number">0xffffffff</span>);<font></font>
    e1000_write_e_base_addr(ep, init_block_addr_part);<font></font>
    log_debug(<span class="hljs-string">"Init Block Low  DMA addr: 0x%x"</span>, init_block_addr_part);
    <span class="hljs-comment">/* high 32 bits */</span>
    init_block_addr_part = (<span class="hljs-keyword">uint32_t</span>)(((<span class="hljs-keyword">uintptr_t</span>)(ep-&gt;init_block) &gt;&gt; <span class="hljs-number">32</span>) &amp; <span class="hljs-number">0xffffffff</span>);<font></font>
    e1000_write_dma_base_addr(ep, init_block_addr_part);<font></font>
    log_debug(<span class="hljs-string">"Init Block High DMA addr: 0x%x"</span>, init_block_addr_part);
    <span class="hljs-comment">/************************************************************************/</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã‹ã‚‰ã€L_E1000_DMA_BASE_ADDRã¯ä¸Šéƒ¨ã§ã‚ã‚Šã€L_E1000_DMA_BASE_ADDRã¯ç‰¹å®šã®åˆæœŸåŒ–ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå®Ÿéš›ã«ã¯ã‚«ãƒ¼ãƒ‰è¨˜è¿°ãƒ–ãƒ­ãƒƒã‚¯ï¼‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä¸‹éƒ¨ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¨˜è¿°æ§‹é€ ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_init_block</span> {</span>
    <span class="hljs-keyword">uint16_t</span> mode;
    <span class="hljs-keyword">uint8_t</span>  paddr[<span class="hljs-number">6</span>];
    <span class="hljs-keyword">uint64_t</span> laddrf;
    <span class="hljs-comment">/* 31:4 = addr of rx desc ring (16 bytes align) +
     * 3:0  = number of descriptors (the power of two)
     * 0x09 is max value (desc number = 512 if [3:0] &gt;= 0x09)
     */</span>
    <span class="hljs-keyword">uint32_t</span> rdra;
    <span class="hljs-comment">/* 31:4 = addr of tx desc ring (16 bytes align) +
     * 3:0  = number of descriptors (the power of two)
     * 0x09 is max value (desc number = 512 if [3:0] &gt;= 0x09)
     */</span>
    <span class="hljs-keyword">uint32_t</span> tdra;<font></font>
} __attribute__((packed));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C laddrf-ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ä½•ã‚‰ã‹ã®ç†ç”±ã§ã‚¼ãƒ­ã«ãªã‚Šã€åŒã˜ã“ã¨ã‚’è¡Œã„ã¾ã—ãŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
paddr-ã”æƒ³åƒã®ã¨ãŠã‚Šã€macã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒ‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
rdraã¨tdraã«ã¯ãƒ¡ãƒ¢ãƒªè¨˜è¿°å­ã®ãƒªãƒ³ã‚°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå«ã¾ã‚Œã€ä¸‹ä½4ãƒ“ãƒƒãƒˆãŒãƒªãƒ³ã‚°ã®ã‚µã‚¤ã‚ºã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã‚µã‚¤ã‚ºã®å¯¾æ•°ã§ã™ã€‚</font><font style="vertical-align: inherit;">ã¤ã¾ã‚Šã€8ãŒã‚ã‚‹å ´åˆã€ãƒªãƒ³ã‚°å†…ã®è¨˜è¿°å­ã®æ•°ã¯2 ^ 8ï¼ˆ1 &lt;&lt; 8 == 256ï¼‰ã«ãªã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
modeã¯ã‚«ãƒ¼ãƒ‰ã®å‹•ä½œãƒ¢ãƒ¼ãƒ‰ã§ã€ãƒ“ãƒƒãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DRX     (1 &lt;&lt; 0)  <span class="hljs-comment">/* Receiver disable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DTX     (1 &lt;&lt; 1)  <span class="hljs-comment">/* Transmitter disable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LOOP    (1 &lt;&lt; 2)  <span class="hljs-comment">/* loopback */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DTCR    (1 &lt;&lt; 3)  <span class="hljs-comment">/* disable transmit crc */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> COLL    (1 &lt;&lt; 4)  <span class="hljs-comment">/* force collision */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DRTY    (1 &lt;&lt; 5)  <span class="hljs-comment">/* disable retry */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> INTL    (1 &lt;&lt; 6)  <span class="hljs-comment">/* Internal loopback */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EMBA    (1 &lt;&lt; 7)  <span class="hljs-comment">/* enable modified back-off algorithm */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EJMF    (1 &lt;&lt; 8)  <span class="hljs-comment">/* enable jambo frame */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> EPSF    (1 &lt;&lt; 9)  <span class="hljs-comment">/* enable pause frame */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FULL    (1 &lt;&lt; 10)  <span class="hljs-comment">/* full packet mode */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PROM    (1 &lt;&lt; 15) <span class="hljs-comment">/* promiscuous mode */</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¤ã¾ã‚Šã€ã™ã¹ã¦ã‚’æ§‹æˆã—ãŸã‚‰ã€ãƒ“ãƒƒãƒˆ10ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ··åˆãƒ¢ãƒ¼ãƒ‰ãŒå¿…è¦ãªå ´åˆã¯ã€15ã‚‚è¨­å®šã—ã¾ã™ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ‘ã‚±ãƒƒãƒˆè¨˜è¿°å­</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€ãƒ‘ã‚±ãƒƒãƒˆè¨˜è¿°å­ã®å½¢å¼ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
äºˆç´„ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_rx_desc</span> {</span>
    <span class="hljs-keyword">uint32_t</span>    base;
    <span class="hljs-keyword">int16_t</span>     buf_length;
    <span class="hljs-keyword">int16_t</span>     status;
    <span class="hljs-keyword">int16_t</span>     msg_length;
    <span class="hljs-keyword">uint16_t</span>    reserved1;
    <span class="hljs-keyword">uint32_t</span>    etmr;<font></font>
} __attribute__((packed));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ™ãƒ¼ã‚¹-ã“ã‚ŒãŒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒƒãƒ•ã‚¡ãƒ¼ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚‹ã“ã¨ã¯ãŠãã‚‰ãæ˜ã‚‰ã‹ã§ã™</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
buf_length- </font><font style="vertical-align: inherit;">ãƒãƒƒãƒ•ã‚¡ãƒ¼</font><font style="vertical-align: inherit;">ã®ã‚µã‚¤ã‚º</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
msg_length-å®Ÿéš›ã«ã¯ã€å—ä¿¡å¾Œã€å—ä¿¡ã—ãŸãƒ‘ã‚±ãƒƒãƒˆã®é•·ã•</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-è¨˜è¿°å­ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ‘ã‚±ãƒƒãƒˆãŒæº–å‚™ã•ã‚Œã¦DMAï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ã«æ¸¡ã•ã‚Œã‚‹ã¨ã€ãƒ“ãƒƒãƒˆ15ï¼ˆRD_OWNï¼‰ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã™ã¹ã¦ãŒé †èª¿ã§ã‚ã‚Œã°ã€ã“ã®è¨˜è¿°å­ã§ãƒ‘ã‚±ãƒƒãƒˆã‚’å—ä¿¡ã—ãŸå¾Œã€ã“ã®ãƒ“ãƒƒãƒˆã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã€9ï¼ˆRD_STPï¼‰ãŠã‚ˆã³8ï¼ˆRD_ENPï¼‰ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ“ãƒƒãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* RX Descriptor status bits */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_OWN     (1 &lt;&lt; 15)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_ERR     (1 &lt;&lt; 14)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_FRAM    (1 &lt;&lt; 13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_OFLO    (1 &lt;&lt; 12)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_CRC     (1 &lt;&lt; 11)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_BUFF    (1 &lt;&lt; 10)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_STP     (1 &lt;&lt; 9)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_ENP     (1 &lt;&lt; 8)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_PAM     (1 &lt;&lt; 6)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_LAFM    (1 &lt;&lt; 4)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RD_BAM     (1 &lt;&lt; 3)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è»¢é€æ™‚ï¼š</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">l_e1000_tx_desc</span> {</span>
    <span class="hljs-keyword">uint32_t</span>    base;
    <span class="hljs-keyword">int16_t</span>     buf_length;
    <span class="hljs-keyword">int16_t</span>     status;
    <span class="hljs-keyword">uint32_t</span>    misc;
    <span class="hljs-keyword">uint32_t</span>    etmr;<font></font>
} __attribute__((packed));<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å—ä¿¡ã¨ã»ã¼åŒã˜ã§ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ“ãƒƒãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* TX Descriptor status bits */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_OWN      (1 &lt;&lt; 15)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_ERR      (1 &lt;&lt; 14)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_AFCS     (1 &lt;&lt; 13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_NOINTR   (1 &lt;&lt; 13)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_MORE     (1 &lt;&lt; 12)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_ONE      (1 &lt;&lt; 11)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_DEF      (1 &lt;&lt; 10)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_STP      (1 &lt;&lt; 9)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TD_ENP      (1 &lt;&lt; 8)</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ‘ã‚±ãƒƒãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ãã¯ã€15ï¼ˆTD_OWNï¼‰ã€9ï¼ˆTD_STPï¼‰ã€8ï¼ˆTD_ENPï¼‰ã‚’é©å®œè¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ“ãƒƒãƒˆ8ã¯ã€ã“ã‚ŒãŒå‡¦ç†ã•ã‚Œã‚‹æœ€å¾Œã®ãƒ‘ã‚±ãƒƒãƒˆã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ãƒ‘ã‚±ãƒƒãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹å ´åˆã€æœ€å¾Œã®ãƒ‘ã‚±ãƒƒãƒˆã«ã®ã¿ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡è¦ãªæ©Ÿèƒ½ã‚‚å¿˜ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚è¨˜è¿°å­ã®ãƒãƒƒãƒ•ã‚¡ãƒ¼é•·ã¯ã€ãŠãã‚‰ãè¿½åŠ ã®ã‚³ãƒ¼ãƒ‰ã§ã€ãƒã‚¤ãƒŠã‚¹è¨˜å·ã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ã‚‚ã€Elbrusã®ãƒã‚¤ãƒˆã‚ªãƒ¼ãƒ€ãƒ¼ã¯åŒã˜ã§ã‚ã‚‹ãŸã‚ã€ã“ã‚Œã¯ãŠãã‚‰ãé‡è¦ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç®¡ç†ç™»éŒ²</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¬¡ã«ã€æœ€å¾Œã®ã‚¢ã‚»ãƒ³ãƒ–ãƒ«ã•ã‚Œã¦ã„ãªã„ãƒ¬ã‚¸ã‚¹ã‚¿L_E1000_E_CSRã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-comment">/* E_CSR register bits */</span>
<span class="hljs-comment">/* 31:21 unused, readed as 0 */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_ATME        (1 &lt;&lt; 24) <span class="hljs-comment">/* RW, Add Timer Enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TMCE        (1 &lt;&lt; 23) <span class="hljs-comment">/* RW, Timer Clear Enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_DRIN        (1 &lt;&lt; 22) <span class="hljs-comment">/* RW, Disable RX Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_DTIN        (1 &lt;&lt; 21) <span class="hljs-comment">/* RW, Disable TX Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_ESLE        (1 &lt;&lt; 20) <span class="hljs-comment">/* RW, Enable Slave Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_SLVE        (1 &lt;&lt; 19) <span class="hljs-comment">/* RW1c, Slave Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_PSFI        (1 &lt;&lt; 18) <span class="hljs-comment">/* RW1c, Pause Frame Interrupt */</span></span>
<span class="hljs-comment">/* 17 unused, read as 0  */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_SINT       (1 &lt;&lt; 16) <span class="hljs-comment">/* R, Status Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_ERR        (1 &lt;&lt; 15) <span class="hljs-comment">/* R, Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_BABL       (1 &lt;&lt; 14) <span class="hljs-comment">/* RW1c, Babble */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_CERR       (1 &lt;&lt; 13) <span class="hljs-comment">/* RW1c, Collision Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_MISS       (1 &lt;&lt; 12) <span class="hljs-comment">/* RW1c, Missed Packet */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_MERR       (1 &lt;&lt; 11) <span class="hljs-comment">/* RW1c, Memory Error */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_RINT       (1 &lt;&lt; 10) <span class="hljs-comment">/* RW1c, Receiver Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TINT       (1 &lt;&lt; 9)  <span class="hljs-comment">/* RW1c, Transmiter Interrupt */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_IDON       (1 &lt;&lt; 8)  <span class="hljs-comment">/* RW1c, Initialization Done */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_INTR       (1 &lt;&lt; 7)  <span class="hljs-comment">/* R, Interrupt Flag */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_INEA       (1 &lt;&lt; 6)  <span class="hljs-comment">/* RW, Interrupt Enable */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_RXON       (1 &lt;&lt; 5)  <span class="hljs-comment">/* R, Receiver On */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TXON       (1 &lt;&lt; 4)  <span class="hljs-comment">/* R, Transmiter On */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_TDMD       (1 &lt;&lt; 3)  <span class="hljs-comment">/* RW1, Transmit Demand */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_STOP       (1 &lt;&lt; 2)  <span class="hljs-comment">/* RW1, Stop */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_STRT       (1 &lt;&lt; 1)  <span class="hljs-comment">/* RW1, Start */</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> E_CSR_INIT       (1 &lt;&lt; 0)  <span class="hljs-comment">/* RW1, Initialize */</span></span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆæœŸåŒ–</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚„ã‚„çã—ã„åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒã‚ã‚Šã¾ã™ï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STOP-&gt; INIT-&gt; IDON-&gt; STRT</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã®å ´åˆã€RXONãŠã‚ˆã³TXONãƒ“ãƒƒãƒˆã¯å€‹åˆ¥ã«ç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è©³ç´°ã«ã¤ã„ã¦ã¯ã€ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ã”è¦§ãã ã•ã„ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ“ãƒ‡ã‚ªã‚«ãƒ¼ãƒ‰</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã§ã«è¿°ã¹ãŸã‚ˆã†ã«ã€ç§ãŸã¡ã®ãƒ‡ãƒã‚¤ã‚¹ã¯SM718 LynxSE +ã¨å‘¼ã°ã‚Œã‚‹Silicon Motion vidyahä¼šç¤¾ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ãŸãŒã£ã¦ã€ã™ã¹ã¦ãŒã‚·ãƒ³ãƒ—ãƒ«ã§ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã«ã¯</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚½ãƒ¼ã‚¹</font></a><font style="vertical-align: inherit;">ãŒã‚ã‚Šã€</font><font style="vertical-align: inherit;">å®Ÿéš›ã«èª¬æ˜ã™ã‚‹ã“ã¨ã¯ä½•ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¾ã‚ã€ãƒ“ãƒ‡ã‚ªãŒãã‚ŒãŒéå¸¸ã«ä½ã„fpsã§ã‚ã‚‹ã“ã¨ãŒåˆ¤æ˜ã—ãŸã“ã¨ã‚’é™¤ã„ã¦ã€ãã‚Œã¯ãƒ¡ãƒ¢ãƒªã¸ã®é…ã„ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚ˆã†ã«æ„Ÿã˜ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã—ã‹ã—ã€ã“ã‚Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æœ€é©åŒ–ãªã—ã§ã‚ã‚Šã€ä¸€èˆ¬çš„ã«ã€ã“ã‚Œã¯ãŠãã‚‰ãe2kã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®èª¤ã£ãŸä½¿ç”¨ã«é–¢é€£ã™ã‚‹ç§ãŸã¡ã®å•é¡Œã§ã™ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã•ã¦ã€</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒãƒªãƒ³</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¨ãƒ«ãƒ–ãƒ©ã‚¹</font><font style="vertical-align: inherit;">ã«ã¤ã„ã¦ä»–ã«ä½•ã‚’è¨€ã„</font><font style="vertical-align: inherit;">ã¾ã™ã‹ï¼Ÿ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸå‰‡ã¨ã—ã¦ã€å¤©å€™ã¯æ­£å¸¸ã§ã™:) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã©ã†ã‚„ã‚‰ã€ã‚¨ãƒ«ãƒ–ãƒ«ã‚¹ãŒå­˜åœ¨ã—ã€åƒã„ã¦ã„ã¾ã™ã€‚å€‹äººçš„ã«ã¯ã€ã“ã®èˆˆå‘³æ·±ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®é–‹ç™ºã®ä¸»ãªå•é¡Œã¯ã€ãã®è¿‘ã•ã ã¨æ€ã„ã¾ã™ã€‚æ¯”è¼ƒçš„å°ã•ãªä¼šç¤¾ãŒãƒ—ãƒ­ã‚»ãƒƒã‚µã‚„ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½œæˆã—ã€ã‚µãƒãƒ¼ãƒˆã‚„ãã®ä»–ã™ã¹ã¦ã‚’æä¾›ã§ãã‚‹ã¨ã¯è€ƒãˆã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¯ã„ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºè€…ãŒç™»å ´ã—å§‹ã‚ã¾ã—ãŸã€‚åŒã˜Basalt-SPO </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãŒElbrusã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹Alt-Linuxã‚’</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒãƒ¼ãƒˆã—ã¦</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã„ã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã¯ã„ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®é–‹ç™ºè€…ãŒã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fastwel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãªã©ã®Elbrusãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’ä½œæˆã—ã¦ã„ã‚‹ã¨ã„ã†å ±å‘ŠãŒã‚ã‚Š</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã—ãŸ</font></a><font style="vertical-align: inherit;">ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‰ã¯ã™ã¹ã¦ã€é–‹æ”¾æ€§ã«å‘ã‘ãŸå°ã•ãªé€²æ­©ã«ã™ãã¾ã›ã‚“ã€‚éå¸¸ã«å˜ç´”ãªä¾‹ã§ã€æˆ‘ã€…ãŒè¨€ã£ãŸã¨ã“ã“ã«ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’å†ç¾ã™ã‚‹ãŸã‚ã«ã€æˆ‘ã€…ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒå¿…è¦ã€ã¨ã ã‘</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCSTã¯ãã‚Œã‚’æŒã£ã¦ã„ã¾ã™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€è¨˜äº‹ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‹ã‚‰å—ã‘å–ã£ãŸæƒ…å ±ã«è¿½åŠ ã•ã‚ŒãŸã‚‚ã®</font><font style="vertical-align: inherit;">ã§ã‚ã‚Šã€ã¾ã ICSTã‹ã‚‰ã§ã‚‚é‡‘å±ç‰‡ãŒè¦‹ã¤ã‹ã‚‹å¯èƒ½æ€§ã¯ä½ã„ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã¯ã‹ãªã‚Šå¤ãã€</font><font style="vertical-align: inherit;">æ–°ã—ã„ãƒ¢ãƒ‡ãƒ«ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSå½“ç„¶ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emboxãƒªãƒã‚¸ãƒˆãƒªã®</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã™ã¹ã¦ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ã</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPS Emboxï¼ˆ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://t.me/embox_chat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ã‚’</font><font style="vertical-align: inherit;">ä»‹ã—ã¦ãƒ­ã‚·ã‚¢ã®é›»å ±ãƒãƒ£ãƒãƒ«ã«</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPS EmboxãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®2ç•ªç›®ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.4.0ã§ã™ã€‚</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja485672/index.html">Redisã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€ãƒ‘ãƒ¼ãƒˆ1</a></li>
<li><a href="../ja485678/index.html">Javaãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€Javaã‚³ã‚¢ã‚’ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ãŸã‚ã®è³ªå•ï¼ˆ60ã®è³ªå•ï¼‰</a></li>
<li><a href="../ja485682/index.html">æ™‚é–“ç®¡ç†ã¯å½¹ã«ç«‹ãŸãªã„ï¼šå…ˆå»¶ã°ã—ã¯æ™‚é–“ã§ã¯ãªãæ„Ÿæƒ…ã‚’èª¿æ•´ã™ã‚‹å•é¡Œ</a></li>
<li><a href="../ja485688/index.html">MyappãŒä¼‘æ—¥ã‚’å»¶é•·</a></li>
<li><a href="../ja485692/index.html">ITã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã«ã‚ˆã‚‹ãŠå®¢æ§˜ã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€ã¾ãŸã¯æ··ä¹±ã‚’è‡ªå‹•åŒ–ã™ã‚‹æ–¹æ³•</a></li>
<li><a href="../ja485696/index.html">æœ€ã‚‚ç”¨é€”ã®åºƒã„7ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã€‚ãƒ‘ãƒ¼ãƒˆ1-ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢</a></li>
<li><a href="../ja485698/index.html">ãƒªãƒ¼ãƒ•ãƒ¬ãƒƒãƒˆã€‚ã‚­ãƒ£ãƒ³ãƒã‚¹ã§å‹é”ã®ç”»åƒ</a></li>
<li><a href="../ja485702/index.html">FunCorp iOSãƒŸãƒ¼ãƒˆã‚¢ãƒƒãƒ—ï¼ƒ2</a></li>
<li><a href="../ja485704/index.html">åˆå¿ƒè€…ã®ãŸã‚ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆï¼šä¸€èˆ¬çš„ãªé–“é•ã„ã®ä¿®æ­£</a></li>
<li><a href="../ja485706/index.html">ä¼šè­°ã€Œãƒ‡ã‚¸ã‚¿ãƒ«ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã«ãŠã‘ã‚‹æ–°ã—ã„å½¹å‰²ã€ã«ã”æ‹›å¾…ã—ã¾ã™ã€‚</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>