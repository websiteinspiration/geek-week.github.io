<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍩 🎪 ❇️ Game 3D di Instagram Javascript, atau jalur penerbangan sosis 🧛🏻 👉🏿 🏨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah artikel pertama tentang pemrograman game dalam topeng di Instagram, seorang pelanggan meminta saya untuk membuat game di Instagram untuk pizze...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Game 3D di Instagram Javascript, atau jalur penerbangan sosis</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499974/"><img src="https://habrastorage.org/webt/gl/zq/2a/glzq2aogs8xde9o1cauyy8qc838.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah artikel pertama tentang pemrograman game dalam topeng di Instagram, seorang pelanggan meminta saya untuk membuat game di Instagram untuk pizzeria-nya. Game ini rencananya akan digunakan untuk keperluan promosi bisnis. Tentu saja, saya mengerti bahwa, dilihat dari jumlah pandangan artikel pertama, tema Instagram tidak terlalu menarik bagi komunitas Habr. Rupanya, layanan ini masih dianggap sebagai semacam hiburan sembrono untuk pirang, dan sebuah artikel tentang itu hanya cocok sebagai bacaan Jumat untuk koktail malam. Namun, hari ini, baru Jumat. Dapatkan koktail. Dan jangan lupa untuk mengundang pria berambut pirang. Namun, ada kemungkinan bahwa di masa depan teknologi akan mencapai ketinggian seperti itu sehingga kita akan mulai bermain di Instagram di GTA-5. Atau 10.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini akan membahas dua game sekaligus. </font><font style="vertical-align: inherit;">Saya membuat satu untuk memesan, dan kemudian yang kedua untuk diri saya sendiri. </font><font style="vertical-align: inherit;">Dengan setiap permainan baru, saya dihadapkan dengan tugas-tugas baru, pencarian solusi yang membuat saya berkenalan dengan nuansa baru pembangunan. </font><font style="vertical-align: inherit;">Mungkin cerita ini akan bermanfaat bagi pengembang lain dari elemen augmented reality. </font><font style="vertical-align: inherit;">Permainan ini ditulis dalam Javascript murni tanpa menggunakan pustaka tambahan. </font><font style="vertical-align: inherit;">Untuk menampilkan grafik 3D, alat Instagram bawaan digunakan.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game 1. Pizza</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, apa esensi dari game pertama. Pizza berputar. Komponen terbang dari permukaannya - potongan sosis, tomat dan sebagainya. Dua pemain harus menangkap mulut mereka. Pemenangnya adalah orang yang, seperti yang Anda duga, akan menangkap lebih banyak. Seiring waktu, kecepatan rotasi meningkat. Hal terlucu dalam game ini bagi saya adalah pemrograman jalur penerbangan elemen yang dapat dimakan ini. Bayangkan memprogram penerbangan sosis. Tidak, tentu saja, saya tidak pernah memiliki pemrograman yang begitu menyenangkan. Saya tertawa bahkan sekarang, menulis artikel ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika pelanggan melihat prototipe yang berfungsi, dia mengirimi saya ini: ":))". Ada masalah saat menguji hasil akhir. Itu terdiri dari fakta bahwa subjek tidak bisa memainkan permainan: mereka hanya tertawa terbahak-bahak - itu sangat menyenangkan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biarkan saya mengingatkan Anda, pengembangan topeng dan game dibuat di Spark AR Studio. Dan kemudian dari sana Anda dapat mengunggah karya Anda di Instagram untuk dilihat semua orang. Perlu dicatat bahwa teknologi web mengaburkan batas antara sistem operasi untuk pengembang. Anda menulis satu kode, yang kemudian berfungsi di aplikasi Instagram untuk iOS dan Android, tanpa modifikasi atau perubahan apa pun. Tentu saja, pembayaran untuk ini menjadi kecepatan skrip yang pada dasarnya rendah.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadwal untuk permainan disediakan oleh pelanggan. Ada beberapa kesulitan dengan model 3D. Khususnya, ketika menggunakan mesin animasi built-in Spark AR Studio, ternyata jika objek bergerak diskalakan, maka koordinatnya salah ditentukan dalam permainan. Tetapi efek menjengkelkan ini tidak diamati jika Anda tidak skala seluruh objek sepenuhnya, tetapi masing-masing jala secara terpisah. Saya harus meninggalkan skala pizza 1: 1, dan meresepkan koefisien tertentu untuk setiap elemen yang membuatnya. Ada juga masalah dengan format FBX di mana Anda perlu mengekspor model untuk game Instagram. Desainer grafis mengirim model dengan tekstur built-in, yang, apalagi, ditempatkan di sepanjang jalur relatif. Editor 3D melihat mereka, tetapi Spark AR tidak. Saya harus mengemas ulang model sehingga file tekstur terletak terpisah dari model dan sepanjang satu jalur dengan mereka.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan masalah kecil lain yang saya temui adalah bahwa objek AR Saprk api yang bertanggung jawab untuk menampilkan teks pada layar menolak untuk menerima nilai sebagai nilai - skor permainan, misalnya. </font><font style="vertical-align: inherit;">Untuk waktu yang lama saya tidak bisa mengerti mengapa tidak ada yang ditampilkan. </font><font style="vertical-align: inherit;">Apa yang saya lakukan salah? </font><font style="vertical-align: inherit;">Ternyata Anda harus terlebih dahulu mengonversi angka menjadi string (.toString ()). </font><font style="vertical-align: inherit;">Ini tidak perlu dikatakan untuk bahasa lain, tetapi agak tidak biasa untuk javascript, yang selalu melakukan ini sendiri.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animasi sederhana</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu hal baru bagi saya dalam game ini adalah pemrograman animasi objek 3D. (Dalam game Instagram saya sebelumnya "Tic-tac-toe," tidak ada animasi sama sekali.) Mesin animasi di Spark AR Studio sangat spesifik. Dibutuhkan beberapa parameter input, dan kemudian secara reaktif menghubungkan variabel dengan objek di mana Anda ingin mengubah sesuatu. Sebagai contoh, ini akan mengubah koordinat y (startValue, endValue - nilai awal dan akhir) dari beberapa objek 3D dari waktu ke waktu t:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> driverParameters = {
    <span class="hljs-attr">durationMilliseconds</span>: t,
    <span class="hljs-attr">loopCount</span>: <span class="hljs-literal">Infinity</span>,
    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span><font></font>
};<font></font>
<span class="hljs-keyword">var</span> driver = Animation.timeDriver(driverParameters);
<span class="hljs-keyword">var</span> sampler = Animation.samplers.linear(startValue, endValue);<font></font>
sceneObject.transform.y = Animation.animate(driver, sampler);<font></font>
driver.start();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memindahkan bahan pizza yang terbang di luar angkasa, saya memutuskan untuk menjalankan tiga animasi seperti itu secara paralel untuk setiap koordinat. Itu cukup untuk menunjukkan koordinat awal (startValue) dan koordinat akhir dihitung dari sudut rotasi pizza (endValue), sehingga itu berada di suatu tempat yang jauh jika pemain tidak menangkap "cangkang" ini dengan mulutnya. Jika tertangkap - maka gerakan berhenti. Acara pembukaan mulut yang sudah saya jelaskan di artikel sebelumnya. Hanya di sini ada permainan untuk dua orang dan, karenanya, akan ada dua wajah dan dua mulut:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});<font></font>
<font></font>
FaceTracking.face(<span class="hljs-number">1</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Titik kunci dalam permainan ini adalah menangkap bahan-bahan terbang dengan mulut Anda, dengan kata lain, menemukan benda terbang di area kecil tertentu di sekitar tengah mulut seseorang. </font><font style="vertical-align: inherit;">Pada awalnya, perhitungan ini tidak ingin dilakukan dengan benar untuk saya, tetapi solusi untuk masalah itu ditemukan setelah pengenalan benda tersembunyi yang terikat pada koordinat mulut, dan itu berhasil. </font><font style="vertical-align: inherit;">Untuk beberapa alasan, koordinat langsung mulut tidak kembali. </font><font style="vertical-align: inherit;">Di sini cameraTransform.applyTo adalah pengurangan koordinat titik wajah ke koordinat di dunia 3D (metode ini diambil dari dokumentasi).</font></font><br>
<br>
<pre><code class="javascript hljs">move: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//   (   )</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> object = Scene.root.find(<span class="hljs-string">'pizzafly'</span>);
    <span class="hljs-keyword">var</span> olast = {
        <span class="hljs-attr">x</span>: object.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: object.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: object.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   ,       </span>
    <span class="hljs-keyword">var</span> objectHidden = Scene.root.find(<span class="hljs-string">'nullObject'</span>);<font></font>
    objectHidden.transform.x = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).x;<font></font>
    objectHidden.transform.y = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).y;<font></font>
    objectHidden.transform.z = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).z;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> mouth = {
        <span class="hljs-attr">x</span>: objectHidden.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: objectHidden.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: objectHidden.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> d = {
        <span class="hljs-attr">x</span>: <span class="hljs-built_in">Math</span>.abs(olast.x - mouth.x),
        <span class="hljs-attr">y</span>: <span class="hljs-built_in">Math</span>.abs(olast.y - mouth.y),
        <span class="hljs-attr">z</span>: <span class="hljs-built_in">Math</span>.abs(olast.z - mouth.z)<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> ((d.x &gt; <span class="hljs-number">0.03</span>) || (d.y &gt; <span class="hljs-number">0.03</span>) || (d.z &gt; <span class="hljs-number">0.03</span>)) {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    };<font></font>
<font></font>
},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, saya menyadari bahwa Anda harus menghapus pemeriksaan kedalaman (koordinat z), karena dalam permainan khusus ini secara visual sulit untuk memperkirakan kedalaman. </font><font style="vertical-align: inherit;">Artinya, sekarang menjadi mungkin untuk menangkap bahan dengan membuka mulut Anda kapan saja selama penerbangan. </font><font style="vertical-align: inherit;">Yang utama adalah kombinasi dari x dan y.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/v9/dw/nwv9dwt-p5wip4yhnnhtirudgoe.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhirnya, masalah terakhir yang saya temui saat menulis game ini adalah membatasi ukuran build terakhir menjadi 4 MB. Selain itu, sesuai dengan rekomendasi Facebook, agar game dapat ditampilkan pada perangkat seluler sebanyak mungkin, bahkan sesuai dengan 2 MB. Dan 3D-modelers adalah orang-orang kreatif dan ingin membuat model-model berat dengan grid padat dan tekstur besar, sama sekali tidak peduli dengan kita, programmer, atau lebih tepatnya, tentang kinerja akhir dalam game. Saya juga entah bagaimana mengurangi tekstur dalam ukuran dan dikompresi dalam jpg (bukan png), tetapi model pizza itu sendiri harus dikirim untuk direvisi (retopologi). Sebagai hasilnya, bagaimanapun, adalah mungkin untuk masuk ke volume 2MB dengan semua model, tekstur dan skrip. Dan permainan berjalan dengan moderat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan setelah beberapa waktu dia kembali dengan kata-kata bahwa "efeknya mengandung terlalu banyak teks statis." </font><font style="vertical-align: inherit;">Saya harus menghapus angka hitung mundur dan alih-alih mengatur animasi ke panah di stopwatch, yang sekarang mulai menghitung waktu alih-alih. </font><font style="vertical-align: inherit;">Setelah itu, game disetujui.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game 2. Tentang kupu-kupu (ButterFlap)</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/dt/63/wddt63fejsxelpizwyffhzw5zig.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang saya akan berbicara tentang membuat game kedua. Saya tidak dapat membantu membuat game, ini adalah hobi saya. Beberapa hari sebelum 8 Maret, saya memutuskan untuk membuat game Instagram untuk liburan ini. Sesuatu tentang bunga, kupu-kupu, dan permen. Tapi saya tidak bisa memikirkan apa esensi dari game itu. Pikiran itu berputar di kepala saya. Mungkin kupu-kupu akan mengumpulkan permen dan menaruhnya di keranjang? Atau mungkin kupu-kupu akan mengambil permen di udara dan melemparkannya, dan pemain perlu menangkapnya dengan mulutnya? Secara umum, saya scammed selama beberapa hari dan, setelah tidak menemukan solusi, saya menyadari bahwa pada 8 Maret, permainan saya masih tidak punya waktu untuk melewati moderasi, karena yang terakhir membutuhkan 3-4 hari. Aku sudah ingin meninggalkan usaha ini, ketika tiba-tiba idenya datang dengan sendirinya, tiba-tiba. Saya tidak lagi mengikat permainan ke Hari Perempuan, sekarang itu hanya permainan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scroller. </font><font style="vertical-align: inherit;">Dari kiri ke kanan, lansekap dan berbagai rintangan bergerak. </font><font style="vertical-align: inherit;">Pemain harus mengendalikan kupu-kupu yang dapat bergerak bebas di dalam layar dan mengumpulkan berlian yang tergantung di udara. </font><font style="vertical-align: inherit;">Juga, dari kanan ke kiri sedikit lebih cepat dari sisa gambar, awan bergerak, dari mana hujan turun. </font><font style="vertical-align: inherit;">Anda harus bersembunyi dari hujan di bawah bunga. </font><font style="vertical-align: inherit;">Jika seekor kupu-kupu jatuh di bawah air, maka sayapnya menjadi basah dan jatuh, ini adalah akhir dari permainan. </font><font style="vertical-align: inherit;">Saya menyebut permainan itu secara sederhana: ButterFlap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, semua ini terdengar bagus. </font><font style="vertical-align: inherit;">Saya, langsung, ingin bermain sendiri. </font><font style="vertical-align: inherit;">Tetapi saya ingat bahwa saya bukan seorang seniman sama sekali. </font><font style="vertical-align: inherit;">Namun, saya dapat membuat model 3D, dan ini lebih mudah daripada menggambar. </font><font style="vertical-align: inherit;">Jadi, diputuskan, biarlah ada penggulung 3D.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seni grafis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menemukan model online bebas royalti yang harus saya perbaiki. Dia menarik tekstur ke yang tanpa tekstur, setelah sebelumnya menempatkan yang terakhir dalam atlas tekstur: artefak dalam bentuk "tangga" terlihat pada model non-tekstur, dan smoothing dapat diatur untuk tekstur dalam permainan, yang membuat penampilan objek lebih rapi dan tidak begitu datar. Model-model yang mengandung tekstur juga memiliki kekurangannya yang harus diperbaiki. Pertama, ukuran tekstur bukan kelipatan dua dalam kekuasaan. Artinya, misalnya, bisa sama dengan 1200x1200. Saya harus mengompres ke 1024x1024. Pemroses video dapat mengubah skala atau mengisi tekstur yang tidak sesuai dengan ruang kosong, yaitu yang tidak 1024x1024, 512x512, 256x256, dll. Bagaimanapun, tindakan tersebut adalah beban tambahan selama kerja gim dan konsumsi memori yang tidak berarti,oleh karena itu, lebih baik menyiapkan gambar yang benar terlebih dahulu secara manual. Situasi ini juga diselamatkan oleh fakta bahwa saya mendistribusikan semua tekstur dengan atlas tekstur, jadi jika, misalnya, tekstur aslinya berukuran 400x200 piksel, maka saya bisa memasukkannya ke dalam atlas 1024x1024, di samping yang serupa lainnya. Setelah ini, secara alami perlu untuk mengukur pemindaian UV juga, tetapi ini dilakukan dalam beberapa detik. Masih menemukan varian model di mana untuk beberapa alasan tekstur diikat di sepanjang jalur absolut seperti "C: \ Work \ Vasya \ Map.jpg". Ya, tidak ada folder seperti itu di komputer saya! Saya harus menentukan jalur ke tekstur secara manual ... Tapi mengapa Anda mendapat ide bahwa saya harus menyimpan semua proyek saya di drive "C:"!? Oh, pemodel ini, seniman bebas ... Ngomong-ngomong, dengan nama folder di jalur acak yang ditinggalkan, Anda dapat secara tidak sengaja mempelajari lebih lanjut tentang identitas pemodel,misalnya namanya. Senang bertemu denganmu!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang paling sulit adalah menemukan model kupu-kupu yang cocok dengan animasi. Spark AR menggunakan animasi yang dapat diekspor dari editor 3D apa pun ke format FBX. Sayap sepasang model kupu-kupu yang saya unduh entah bagaimana dicerminkan secara aneh - satu sayap dimodelkan, dan yang kedua tercermin dalam beberapa hal yang tidak saya mengerti, dan, dengan demikian, dua di antaranya ternyata. Dengan pendekatan pemodelan ini, pada akhirnya, dalam permainan, salah satu sayap (disalin) tidak ingin menerima cahaya dari sumbernya dan selalu tetap redup. Saya tidak mengambil risiko mengubah model secara drastis, karena animasi akan terbang. Dan dalam animasi saya bukan noob yang lebih besar dari pada pemodelan 3D. Mungkin masalahnya adalah sesuatu yang lain: Saya mencoba, misalnya, untuk memperluas normals, tetapi itu tidak membantu. Singkatnya, model 3D gratis sangat merepotkan. Akibatnya, setelah mandi sepanjang malam,dengan coba-coba, saya menemukan model yang cocok, yang setelah beberapa fine-tuning dengan file mulai terlihat memuaskan. Sesuatu yang saya tidak suka tentang itu, tetapi itu adalah hal-hal kecil: Saya mereduksi tekstur, mengubah geometri di beberapa tempat, dan menyesuaikan parameter material. Akhirnya, kupu-kupu itu lepas landas. Hore. Tapi sekarang aku kelelahan. Jadi saya memutuskan untuk pergi tidur dan melanjutkan keesokan harinya. Ya, saya menghabiskan 7-8 hari untuk membuat game. Tetapi itu adalah pekerjaan yang agak santai di malam hari, membaca dokumentasi, artikel dan menemukan jawaban atas pertanyaan.Jadi saya memutuskan untuk pergi tidur dan melanjutkan keesokan harinya. Ya, saya menghabiskan 7-8 hari untuk membuat game. Tetapi itu adalah pekerjaan yang agak santai di malam hari, membaca dokumentasi, artikel dan menemukan jawaban atas pertanyaan.Jadi saya memutuskan untuk pergi tidur dan melanjutkan keesokan harinya. Ya, saya menghabiskan 7-8 hari untuk membuat game. Tetapi itu adalah pekerjaan yang agak santai di malam hari, membaca dokumentasi, artikel dan menemukan jawaban atas pertanyaan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/zb/iy/rrzbiyezloccrjo_egas613ltry.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sepanjang malam keesokan harinya saya mengerjakan grafik. Kekhasan topeng permainan untuk Instagram, seperti yang telah saya sebutkan, adalah bahwa disarankan untuk tidak melampaui volume 2MB untuk seluruh permainan (maksimum 4 MB). Saya tidak khawatir tentang skrip: ukurannya tidak akan melebihi 50 Kb. Tetapi lebih dari model 3D tanaman harus cukup disulap. Sebagai contoh, bagian dari bunga matahari di mana benih berada dibuat secara geometri. Ratusan poligon ... Ganti dengan sepotong bola beberapa lusin segitiga dan rentangkan tekstur yang diunduh, pada kenyataannya, dari bagian ini. Jumlah daun juga bisa dikurangi. Kami membuat rumput di bagian bawah layar dengan bidang dua segitiga dengan tekstur overlay dengan saluran alfa. Kami mencapai volume dengan bayangan dan menyalin fragmen gambar di dalam tekstur itu sendiri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secara umum, diinginkan untuk meminimalkan jumlah tekstur, serta ukurannya dalam byte. </font><font style="vertical-align: inherit;">Teksturlah yang menciptakan sebagian besar permainan. </font><font style="vertical-align: inherit;">Saya terbiasa dengan tekstur di mana transparansi diperlukan, ditempatkan dalam satu atlas tekstur - dalam png 32 bit, dan tekstur yang tidak menggunakan saluran alfa, kemas dalam atlas lain, menyimpannya dalam jpg. </font><font style="vertical-align: inherit;">Jpg bisa menyusut lebih kuat dari png. </font><font style="vertical-align: inherit;">Elemen rumput dan UI yang membutuhkan transparansi telah pergi ke atlas png, dan segala sesuatu yang lain untuk jpg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total volume. </font><font style="vertical-align: inherit;">Secara total, saya mendapatkan 4 jenis tanaman, batu, kupu-kupu, yang akan dikendalikan pemain, dan awan. </font><font style="vertical-align: inherit;">Tekstur semua model ini dalam bentuk terkompresi mengambil 2 atlas 1024x1024 jpg dan png dengan volume total 500 Kb. </font><font style="vertical-align: inherit;">Modelnya sendiri membutuhkan sekitar 200 Kb. </font><font style="vertical-align: inherit;">Ditambah skrip. </font><font style="vertical-align: inherit;">Suara - 31 Kb. </font><font style="vertical-align: inherit;">Total: sekitar 1 Mb. </font><font style="vertical-align: inherit;">Dalam warna hijau, ukuran build baru saja ditampilkan (ini yang pas dengan 2 MB).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/7r/c1/ak7rc1e09ycyaee13ypwnokgeqm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiba-tiba saya mengalami masalah yang sama sekali tidak terduga. </font><font style="vertical-align: inherit;">Saya menghapus beberapa model yang tidak digunakan, tetapi tidak melalui Spark AR Studio, tetapi dari sistem file. </font><font style="vertical-align: inherit;">Selanjutnya, ketika merakit bangunan, saya menemukan bahwa mereka menghilang dari adegan Spark AR Studio, tetapi masih masuk ke perakitan. </font><font style="vertical-align: inherit;">Dan untuk menghapus proyek dari sumber daya yang tidak digunakan tidak mungkin. </font><font style="vertical-align: inherit;">Tautan ke mereka dari "Ringkasan Aset" tidak mengarah ke mana pun. </font><font style="vertical-align: inherit;">Rupanya, ini adalah cacat di Spark AR Studio. </font><font style="vertical-align: inherit;">Saya harus membuat ulang proyek lagi, menambahkan semua sumber daya yang diperlukan di sana sejak awal.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempat kejadian</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya telah lama berpikir tentang bagaimana menerapkan pengguliran semua objek di layar. </font><font style="vertical-align: inherit;">Dari alat untuk ini, hanya ada javascript dan mesin animasi built-in paling sederhana di Spark AR Studio, yang dapat dengan mudah mengubah koordinat objek dari nilai awal ke final dalam waktu tertentu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, dilema masih muncul sebelum ini: apakah akan membuat seluruh level permainan, adegan dalam editor 3D, dengan menduplikasi tanaman berulang sebanyak yang diperlukan dan menempatkannya di posisi yang tepat, untuk menggulir seluruh adegan dalam permainan, atau memuat hanya satu salinan dari setiap 3D objek dan gantikan mereka ke arah pemain di luar layar. Jawabannya jelas. Pilihan kita adalah pilihan kedua. Kalau tidak, pasti tidak mungkin masuk ke dalam 2 MB: kemungkinan besar, pemandangan sesuai dengan opsi pertama akan berat. Tapi kemudian Anda membutuhkan tata letak objek. Dan saya, tanpa ragu-ragu, memutuskan untuk menggunakan editor 3D sebagai editor level. Ya, ternyata saya melakukan keduanya. Tanaman untuk permainan, saya menyimpan masing-masing dalam satu salinan. Dan dari editor saya hanya perlu koordinat. Setelah menyelesaikan pekerjaan,Saya menulis koordinat semua objek dan membuat array dengan data untuk game.</font></font><br>
<br>
<pre><code class="javascript hljs">lv:[<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">8.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-6.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'cloud'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.1</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'rain'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">6.6</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">14</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-2.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'diamond_red'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">20</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">2.0</span>},<font></font>
	...<font></font>
],</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun - array asosiatif yang terpisah, sesuai dengan jenis objek, di mana ukuran colliders dan perpindahannya relatif terhadap pusat objek 3D disimpan, serta bendera (col) yang menentukan apakah objek tersebut merupakan hambatan (jika tidak, pemain melewatinya). </font><font style="vertical-align: inherit;">Untuk beberapa jenis objek, bendera (hancurkan) diatur, yang menentukan apakah objek harus disembunyikan setelah interaksi, serta (v) parameter, yang menentukan tingkat interaksi tertentu, misalnya, jumlah poin yang didapat atau hilang pemain.</font></font><br>
<br>
<pre><code class="javascript hljs">colld:{
    <span class="hljs-string">'flower1'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">2.3</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1.4</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_green'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">destroy</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_red'</span>:{<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">-2</span>},<font></font>
<font></font>
    ...<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuansa sedikit. </font><font style="vertical-align: inherit;">Rumput di bagian bawah adegan harus bergulir terus menerus. </font><font style="vertical-align: inherit;">Jadi, Anda harus menggunakan dua salinan objek ini dan menggantikannya satu per satu saat Anda bergerak. </font><font style="vertical-align: inherit;">Bunga akan muncul di satu layar tidak lebih dari satu salinan masing-masing.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengingat masalah skala yang saya temui ketika mengembangkan game pertama, saya mengatur ulang skala semua model di editor 3D. Dengan demikian, dalam model AR Saprk segera dimuat dalam ukuran normal. Memang benar, dalam naskah, itu tidak dapat dilakukan tanpa "angka ajaib", koefisien global, kode universal, yang mengandung esensi alam semesta. Alam semesta virtual, tentu saja. Dan saya siap untuk mengungkapkan nomor ini kepada Anda. Gunakan itu, orang-orang! Tidak masalah! Jumlah ini adalah 0,023423. Singkatnya, meskipun pengaturan ulang semua skala, satu meter di editor 3D ternyata sama dengan angka ini di Spark AR Studio. Kemungkinan besar, saya, bagaimanapun, tidak sepenuhnya memahami semua seluk-beluk bekerja dengan grafis 3D, karenanya koefisien. Koordinat (tetapi bukan ukuran) dari semua objek yang diekspor dari editor dikalikan dengan itu, Anda dapat menebaknya.Di mana untuk menyesuaikan skala adegan di Spark AR, saya tidak menemukan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Masalah berikutnya yang saya temui adalah hilangnya urutan objek ketika mengekspor dari editor 3D. </font><font style="vertical-align: inherit;">Benda-benda kompleks yang terdiri dari beberapa jerat dapat muncul secara tak terduga pada adegan dalam permainan sedemikian rupa sehingga, misalnya, jerat yang berada di belakang yang lain tiba-tiba melompat ke depan. </font><font style="vertical-align: inherit;">Dan, jika Anda melihat urutan objek setelah mengekspor ke Spark AR Studio, maka itu benar-benar menunjukkan bahwa mesh ini karena beberapa alasan lebih tinggi dalam daftar, meskipun lebih rendah di editor. </font><font style="vertical-align: inherit;">Saya memecahkan masalah ini dengan membagi adegan menjadi beberapa lapisan dan menyimpannya ke file yang berbeda.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Animasi yang kompleks</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selama tiga malam lagi, saya mengutak-atik pemrograman. Jika saya menggunakan mesin Spark AR Studio standar untuk menggerakkan sayap kupu-kupu, tugas untuk memindahkan latar belakang tidak begitu sederhana. Saya masih tidak mengerti bagaimana cara melampirkan tidak hanya satu parameter variabel untuk iterasi siklus gerak, tetapi fungsi callback penuh. Bagaimanapun, saya tidak bisa melakukannya, parameter animasi saat ini tidak ingin ditransfer ke sana. Dan fungsi seperti itu hanya perlu, karena jika di game pertama (dengan pizza) saya memeriksa tabrakan dengan membuka mulut dengan berlangganan, maka tidak ada acara seperti itu di sini. Dan itu hanya perlu untuk memeriksa tabrakan dengan objek lingkungan saat karakter bergerak, sesuai dengan koordinatnya saat ini. Dan untuk ini, koordinat harus dibandingkan pada setiap iterasi. Dan kemudian saya berpikir. Lagipula, saya sudah menulis game dalam javascript.Dan mengapa tidak menggunakan mesin animasi Anda yang saya tulis sebelumnya untuk game-game itu? Prinsip operasinya kira-kira sama: dalam waktu tertentu, parameter (atau parameter) berubah antara nilai awal dan akhir yang diberikan. Dan nilai saat ini dilewatkan sebagai parameter - Anda tidak akan percaya itu - dalam fungsi callback yang diberikan, di mana, misalnya, Anda dapat mengatur objek 3D pada adegan di koordinat yang sama dengan nilai saat ini, atau memeriksa tabrakan pada mereka. Terima kasih, Cap. Saya harus sedikit menyesuaikan mesin saya dengan "ekosistem" lokal: menghapus referensi ke objek jendela dari sana, karena tidak ada di sini, dan hal-hal kecil lainnya.Dan nilai saat ini dilewatkan sebagai parameter - Anda tidak akan percaya itu - dalam fungsi callback yang diberikan, di mana, misalnya, Anda dapat mengatur objek 3D pada adegan di koordinat yang sama dengan nilai saat ini, atau memeriksa tabrakan pada mereka. Terima kasih, Cap. Saya harus sedikit menyesuaikan mesin saya dengan "ekosistem" lokal: menghapus referensi ke objek jendela dari sana, karena tidak ada di sini, dan hal-hal kecil lainnya.Dan nilai saat ini dilewatkan sebagai parameter - Anda tidak akan percaya itu - dalam fungsi callback yang diberikan, di mana, misalnya, Anda dapat mengatur objek 3D pada adegan di koordinat yang sama dengan nilai saat ini, atau memeriksa tabrakan pada mereka. Terima kasih, Cap. Saya harus sedikit menyesuaikan mesin saya dengan "ekosistem" lokal: menghapus referensi ke objek jendela dari sana, karena tidak ada di sini, dan hal-hal kecil lainnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, namun - tentang menggulir lanskap dan objek lingkungan. Saya memutuskan untuk menempatkan seluruh dunia dalam satu NullObject, yaitu, dalam objek 3D kosong, wadah, dan memindahkannya hanya menggunakan satu parameter untuk animasi - koordinat x-nya. Di dalam wadah, semua model memiliki koordinat yang sama seolah-olah mereka berada di luar, hanya sekarang bagi mereka sistem referensi terkait dengan objek kosong ini. Batuan dan bunga akan diulangi (apalagi, pada ketinggian yang berbeda dari tanah, sesuai dengan diagram level), sehingga Anda dapat menggunakan kembali benda-benda ini saat Anda bergerak, mengaturnya posisi horizontal dan vertikal yang diinginkan di dalam "wadah". Saya menulis sebuah sistem pencarian untuk objek-objek yang jatuh ke dalam frame (pada offset kontainer saat ini), yang mengatur objek yang meninggalkan frame ke posisi baru lebih jauh jika harus muncul di sana. Anda bisa melihat,cara kerjanya pada contoh tiga objek. (Akan ada lebih banyak dari mereka dalam permainan, sehingga di sana Anda tidak akan lagi melihat efek "penataan ulang" objek lingkungan seperti itu.)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3i72svxLHM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi untuk memperbarui koordinat objek terlihat seperti ini:</font></font><br>
<br>
<pre><code class="javascript hljs">oCoordSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-comment">//  :    </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> camx = -ap.oWorld.transform.x.pinLastValue();
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> x1 = camx - ap.game.scro.w2;
    <span class="hljs-keyword">var</span> x2 = camx + ap.game.scro.w2;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> ((ap.d.lv[i].x &gt;= x1) &amp; (ap.d.lv[i].x &lt;= x2)) {
            <span class="hljs-comment">//   </span><font></font>
            ap.d.lv[i].o = Scene.root.find(ap.d.lv[i].n);<font></font>
            <span class="hljs-comment">//  -  </span><font></font>
            ap.d.lv[i].o.transform.y = ap.d.lv[i].y;<font></font>
            <span class="hljs-keyword">if</span> ((ap.d.lv[i].n == <span class="hljs-string">'cloud'</span>) || (ap.d.lv[i].n == <span class="hljs-string">'rain'</span>)) {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//  </span>
                <span class="hljs-comment">//   2.3,</span>
                <span class="hljs-comment">//     </span>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x - (x2 - ap.d.lv[i].x) * <span class="hljs-number">2.3</span> + <span class="hljs-number">0.2</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//      </span><font></font>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x;<font></font>
            };<font></font>
        };<font></font>
    };<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (camx &gt; ap.game.grassPosLast) {<font></font>
        ap.game.grassPosLast += ap.game.grassd;<font></font>
        ap.game.grassi = <span class="hljs-number">1</span> - ap.game.grassi;<font></font>
        ap[ap.game.grassNm[ap.game.grassi]].transform.x = ap.game.grassPosLast;<font></font>
    };<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karakter utama</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karakter utama dalam permainan adalah kupu-kupu yang tidak dapat tenggelam, yang dengan berani terbang ke depan, mengatasi rintangan. </font><font style="vertical-align: inherit;">Saya memutuskan untuk melakukan manajemen dengan menetapkan penanda, atau kursor (titik cahaya), dengan memutar dan memiringkan kepala. </font><font style="vertical-align: inherit;">Dan ke arah titik ini seekor kupu-kupu akan terbang perlahan (pada kenyataannya, itu bukan pejuang, juga tidak bisa berteleportasi). </font><font style="vertical-align: inherit;">Misalnya, jika Anda berlangganan acara head tilt, maka Anda dapat menerapkan kontrol vertikal seperti ini:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> v = event.newValue;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> scrH2 = ap.game.scr.h2;
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">var</span> p = -v * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (p &lt; -scrH2) {<font></font>
        p = -scrH2;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p &gt; scrH2) {<font></font>
        p = scrH2;<font></font>
    };<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">0.006</span>;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> cur = ap.oPers.transform.y.pinLastValue();
    <span class="hljs-keyword">if</span> (p &lt; cur) {<font></font>
        cur -= d;<font></font>
        <span class="hljs-keyword">if</span> (cur &lt; p) {cur = p;};<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        cur += d;<font></font>
        <span class="hljs-keyword">if</span> (cur &gt; p) {cur = p;};<font></font>
    };<font></font>
    <span class="hljs-comment">//    ()</span><font></font>
    ap.oPointer1.transform.y = p;<font></font>
    <span class="hljs-comment">//   ,</span>
    <span class="hljs-comment">// ,    </span><font></font>
    ap.game.pers.dy + = cur - ap.game.pers.y;<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Begitu pula untuk horizontal. </font><font style="vertical-align: inherit;">Hanya di sana perlu untuk berlangganan ke acara bukan dari kemiringan, tetapi dari rotasi kepala (rotasiY), dan bukannya ketinggian layar, pertimbangkan lebarnya.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colliders</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua ini luar biasa, dunia bergerak, dan karakter permainan dapat dengan bebas bergerak di sekitar layar. Tetapi sekarang Anda membutuhkan penangan benturan, jika tidak, tidak ada permainan yang akan berhasil. Ada tiga peristiwa dalam permainan, yang menurutnya posisi karakter dapat berubah. Ini adalah rotasi dan kemiringan kepala, serta pergerakan dunia, di mana koordinat horizontal pemain (x) secara otomatis meningkat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena saya tidak tahu bagaimana iterasi dari face handler bekerja di Spark AR - apakah mereka dipanggil dengan frekuensi tertentu atau diatur ke frekuensi jam maksimum yang dimungkinkan, dan di mesin animasi saya, saya dapat mengontrol parameter ini, saya memutuskan untuk menentukan tabrakan di fungsi saya. pergerakan dunia, yang disebut pada frekuensi yang saya setel (60 frame per detik). Dalam acara pemrosesan wajah, kami hanya akan "menumpuk" gerakan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsipnya akan seperti itu. Dalam peristiwa memiringkan kepala dan memutar kepala, offset sepanjang sumbu x dan y diakumulasikan. Selanjutnya, dalam fungsi menggulir dunia, perpindahan horisontal juga ditambahkan ke "celengan". Dan kemudian diperiksa, jika perpindahan akumulasi ditambahkan ke koordinat asli, maka akan ada tabrakan dengan salah satu benda di dunia. Jika tidak, maka koordinat asli pemain plus offset dilakukan oleh koordinat saat ini. Dan kemudian kami memperbarui yang sumber ke yang saat ini (reset) dan mengatur ulang offset. Jika demikian, maka gulung kembali koordinat ke aslinya. Selain itu, kita perlu menentukan sumbu tabrakan mana, karena kedua koordinat tidak dapat diputar kembali. Kalau tidak, pemain hanya "menempel" ke satu titik di ruang dan tidak bisa lagi bergerak ke mana pun. Adalah perlu untuk memberinya kebebasan bergerak di sepanjang poros sepanjang tabrakan itu tidak terjadi.Jadi Anda bisa memberinya kesempatan untuk terbang di sekitar rintangan.</font></font><br>
<br>
<pre><code class="javascript hljs">setPersPos: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">camx, camdx</span>) </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">//       (camx,camdx)</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">var</span> persx = ap.game.pers.x;
    <span class="hljs-keyword">var</span> persy = ap.game.pers.y;
    <span class="hljs-keyword">var</span> dx = ap.game.pers.dx;
    <span class="hljs-keyword">var</span> dy = ap.game.pers.dy;<font></font>
<font></font>
    <span class="hljs-comment">// ,     </span>
    <span class="hljs-keyword">var</span> col = ap.collisionDetect(<font></font>
        {<span class="hljs-attr">x</span>: persx, <span class="hljs-attr">y</span>: persy, <span class="hljs-attr">dx</span>: dx, <span class="hljs-attr">dy</span>: dy},<font></font>
        {<span class="hljs-attr">x</span>: camx, <span class="hljs-attr">dx</span>: camdx, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>}<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (col.f == <span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.colx == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//(    ,    )</span><font></font>
            ap.game.pers.x = col.x;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span><font></font>
            ap.game.pers.x = persx + dx;<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.coly == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// -  </span><font></font>
            ap.game.pers.y = col.y;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            ap.game.pers.y = persy + dy;<font></font>
        };<font></font>
<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//  ,   </span><font></font>
        ap.game.pers.x = persx + dx;<font></font>
        ap.game.pers.y = persy + dy;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// </span>
    ap.game.pers.dx = <span class="hljs-number">0</span>;<font></font>
    ap.game.pers.dy = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    ap.oPers.transform.x = ap.game.pers.x;<font></font>
    ap.oPers.transform.y = ap.game.pers.y;<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi deteksi tabrakan itu sendiri:</font></font><br>
<br>
<pre><code class="javascript hljs">collisionDetect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opers, ow</span>) </span>{
    <span class="hljs-comment">// , opers -   , ow -  </span><font></font>
<font></font>
    <span class="hljs-keyword">var</span> res = {<span class="hljs-attr">f</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">colx</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">coly</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ocoll, x, y, w, h, persx, persy, persx0, persy0, od, colx1, coly1, colx2, coly2;
    <span class="hljs-keyword">var</span> collw = <span class="hljs-literal">false</span>, collh = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//(  ,  "" )</span><font></font>
    persx0 = opers.x + ow.x - ow.dx;<font></font>
    persy0 = opers.y + ow.y;<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    persx = persx0 + opers.dx;<font></font>
    persy = persy0 + opers.dy;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {<font></font>
        od = ap.d.lv[i]; <span class="hljs-comment">//obj data</span><font></font>
<font></font>
        <span class="hljs-comment">//    (   ),</span>
        <span class="hljs-comment">//     </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ap.d.colld[od.n] !== <span class="hljs-string">"undefined"</span>) {<font></font>
<font></font>
            <span class="hljs-comment">//       </span><font></font>
            ocoll = ap.d.colld[od.n];<font></font>
            colx1 = od.x + ocoll.x1;<font></font>
            colx2 = od.x + ocoll.x2;<font></font>
            coly1 = od.y + ocoll.y1;<font></font>
            coly2 = od.y + ocoll.y2;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ((persx &lt; colx1) || (persx &gt; colx2) || (persy &lt; coly1) || (persy &gt; coly2)) {} <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//   </span>
                res.f = <span class="hljs-literal">true</span>;<font></font>
<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persx0 &lt; colx1) || (persx0 &gt; colx2)) {<font></font>
                    collw = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persy0 &lt; coly1) || (persy0 &gt; coly2)) {<font></font>
                    collh = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
<font></font>
            };<font></font>
        };<font></font>
<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
<font></font>
    <span class="hljs-comment">//  ,     ,</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (collw == <span class="hljs-literal">true</span>) {<font></font>
        res.colx = <span class="hljs-literal">true</span>;<font></font>
        res.x = persx0 - ow.x;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.x = opers.x;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">if</span> (collh == <span class="hljs-literal">true</span>) {<font></font>
        res.coly = <span class="hljs-literal">true</span>;<font></font>
        res.y = persy0 + ow.y;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.y = opers.y;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res;<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hujan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan mesin partikel standar Spark AR Studio untuk menghidupkan hujan. </font><font style="vertical-align: inherit;">Tidak ada yang istimewa di sini. </font><font style="vertical-align: inherit;">Kami menambahkan objek Emtter ke adegan, tidak lupa untuk menanyakannya Emitter -&gt; Space -&gt; Local (bukan Dunia). </font><font style="vertical-align: inherit;">Ini untuk memastikan bahwa tetesan tidak secara dinamis tertinggal di belakang awan selama pergerakan, tetapi selalu jatuh secara langsung. </font><font style="vertical-align: inherit;">Metode ini lebih nyaman untuk penentuan lebih mudah saat kupu-kupu jatuh dalam hujan - tidak perlu melakukan koreksi ketinggian. </font><font style="vertical-align: inherit;">Untuk tetesnya sendiri, saya menyiapkan tekstur yang sesuai. </font><font style="vertical-align: inherit;">Nah dan, tentu saja, objek hujan akan bergerak bersama dengan objek cloud. </font><font style="vertical-align: inherit;">Kemudian saya menambahkan kondisi cloud hit ke kode penanganan tabrakan. </font><font style="vertical-align: inherit;">Dan, jika tidak ada halangan di atas pemain pada saat ini, maka kupu-kupu jatuh dan permainan berakhir.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moderasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk moderasi yang berhasil, video wajib dari game tidak boleh mengandung teks statis yang tidak terikat ke objek. </font><font style="vertical-align: inherit;">Jika tidak, robot langsung menghentikan moderasi. </font><font style="vertical-align: inherit;">Namun, setelah itu, seseorang memeriksa permainan selama beberapa hari. </font><font style="vertical-align: inherit;">Dan dia tidak menyukai banyaknya teks sebelum pertandingan, dan juga pada akhirnya. </font><font style="vertical-align: inherit;">Saya harus mengurangi jumlah teks. </font><font style="vertical-align: inherit;">Setelah itu, game disetujui.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ringkasan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bukan berarti permainan saya sangat menarik. </font><font style="vertical-align: inherit;">Dia mungkin tidak memiliki dinamika dan mekanika tambahan. </font><font style="vertical-align: inherit;">Saya akan merilis pembaruan. </font><font style="vertical-align: inherit;">Tapi saya menyadari bahwa membuat game di Instagram itu menarik. </font><font style="vertical-align: inherit;">Ini semacam tantangan. </font><font style="vertical-align: inherit;">Saya sangat menikmati proses pemrograman dan menyelesaikan semua jenis tugas di bawah minimalis dalam hal alat dan jumlah memori yang dialokasikan. </font><font style="vertical-align: inherit;">Saya ingat seseorang mengatakan bahwa 640 Kb sudah cukup untuk semua orang. </font><font style="vertical-align: inherit;">Sekarang coba pas game 3D 2 MB. </font><font style="vertical-align: inherit;">Saya, mungkin, tidak akan berdebat bahwa mereka cukup untuk semua orang ... Tetapi cobalah!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/g7/kr/7fg7kra8uhidburs19pognju5vc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai penutup, saya ingin menyatukan semua daftar saat-saat tidak jelas yang saya temui. </font><font style="vertical-align: inherit;">Mungkin ini berguna bagi seseorang sebagai lembar contekan saat membuat game untuk Instagram.</font></font><br>
<br>
<i><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skala. </font><font style="vertical-align: inherit;">Sesuaikan skala semua model 3D di editor 3D sehingga ia segera 1: 1 di atas panggung dalam permainan.</font></font></li>
<li>       .              .   ,            .</li>
<li>.          FBX,     .        -.           ,    .</li>
<li>  .  JPG   ,     ,   ,       -,    JPG,    PNG.</li>
<li>   . , ,        .   Spark AR  ,         . , , ,   3D-.</li>
<li>   3D ,    :     ,    .       .             .</li>
<li>,    ,      .   javascript   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam konteks Spark AR, tidak ada objek jendela dan semua jenis objek browser spesifik seperti webkitRequestAnimationFrame, mozRequestAnimationFrame, dan sebagainya. </font><font style="vertical-align: inherit;">Ini adalah takdir ketika pemrograman dalam animasi javascript.</font></font></li>
</ul></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499962/index.html">Beberapa fakta tentang pengklasifikasi cascading, yang jarang dipertimbangkan secara serius dalam artikel ilmiah.</a></li>
<li><a href="../id499964/index.html">NASA telah memilih tiga perusahaan yang akan berpartisipasi dalam program ini untuk membuat kapal untuk mendarat di bulan</a></li>
<li><a href="../id499968/index.html">Daftar mitaps online paling gigih yang terjadi bahkan di bulan Mei</a></li>
<li><a href="../id499970/index.html">Kami mempelajari mesin VoIP Mediastreamer2. Bagian 12</a></li>
<li><a href="../id499972/index.html">Semoga acara online dicerna</a></li>
<li><a href="../id499978/index.html">Terjemahan buku Andrew Un, Passion for Machine Learning, Bab 36 dan 37</a></li>
<li><a href="../id499982/index.html">Rencana Penguji Pemula: Dari "Masukkan TI" ke "Saya Seorang Insinyur!"</a></li>
<li><a href="../id499986/index.html">Dan lagi tentang tertanam: mencari bug di proyek Embox</a></li>
<li><a href="../id499988/index.html">Gula dan COVID-19</a></li>
<li><a href="../id499990/index.html">Geocoding Bagaimana cara mengikat 250 ribu alamat ke koordinat dalam 10 menit?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>