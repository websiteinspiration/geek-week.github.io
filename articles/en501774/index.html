<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äç‚úàÔ∏è ü§±üèº üê® Why clouds become thunderclouds: cloud deployment failures üíà ü§¶üèº üö£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A cloud implementation in a large organization usually includes many services from various providers, each of which has its own rules for interaction,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Why clouds become thunderclouds: cloud deployment failures</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/trendmicro/blog/501774/"><img src="https://habrastorage.org/webt/k7/we/li/k7weli9ajjkbmlox6c3gutp7idq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A cloud implementation in a large organization usually includes many services from various providers, each of which has its own rules for interaction, settings, and even protocols. As a result, the security configuration becomes so complex that it is difficult to track and even harder to understand. In our new study, we collected the most common </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mistakes in deploying a cloud infrastructure</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using Amazon Web Services as an example, and we will share some of them in this post.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cloud providers today offer services that go beyond the trivial ‚Äúdedication‚Äù or file storage. </font><font style="vertical-align: inherit;">Every aspect of every service can be programmed. </font><font style="vertical-align: inherit;">This gives developers and operators more control over security than a traditional data center. </font><font style="vertical-align: inherit;">However, the wealth of functions and their configuration tools leads to the fact that you can configure from several interfaces, and - and this is important - the default parameters are different for different methods. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For experienced users this is not a problem - on the contrary, they will use the most suitable tool for the task. </font><font style="vertical-align: inherit;">However, for others, the result may not live up to their expectations.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amazon S3 Storage</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon Simple Storage Services or Amazon S3 is one of the most sought after cloud services used by many customers, from small companies to large corporations. </font><font style="vertical-align: inherit;">Popularity has turned S3 into a favorite target for attackers who are looking for flaws in the implementation of services and errors in their configuration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most common Amazon S3 attack vectors used by cybercriminals are:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public storage facilities for recording;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interception of accounts;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abuse of privileges.</font></font></li>
</ul><br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recording Sharing</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In February 2018, the Monero cryptocurrency miner was discovered on the site of one of the largest American newspapers. Each reader who visited the site mined coins for criminals who added malicious code to the publication‚Äôs JavaScript files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The newspaper‚Äôs site was hosted by Amazon and stored all the pictures, scripts and style files in the S3 repository. Access to this repository was limited only by reading, so hacking was a complete surprise for site administrators. They simply could not understand how they were hacked until the cloud service specialists explained that the reason was the incorrect access rights.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Amazon S3 repositories can be used via http / https, and in this part, site administrators did everything right, restricting access only to reading. However, S3 can also be accessed through the AWS native protocol via the command line, and the access rights for such calls must be set separately, and by default, storage access via AWS CLI is allowed for all AWS authorized users. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/en/t3/if/ent3ifvnv9gb24gwu1mbds92jrc.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The result of running the console command aws s3api get-bucket-acl --bucket &lt;BUCKET_NAME&gt; for the default vault</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
for new Amazon S3 users, the need to double-restrict their vault permissions is far from obvious, which led to numerous incidents.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
At the end of 2018, AWS redefined the security policy by prohibiting public access from the console for new S3 repositories, but this policy was not applied when using the command line. Access still had to be limited to a separate team. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In 2018-2019, the compromise of S3 storage became widespread. Some security professionals and friendly hackers specifically looked for AWS resources that were open for writing and left warning files there. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tu/8u/sd/tu8usdycbhhz7vpop78lrhjy3sw.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anonymous warning about an unsafe configuration of AWS S3</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Someone even offered their services for setting up secure storage parameters: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jn/5r/vm/jn5rvm1zms55zvl1qk0pypj00fm.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warning and offering services from Pentester Random Robbie</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Random Robbie is the pseudonym for Robbie Wiggins, who in 2018 left his warning on the thousands of S3 storage open for recording. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The ability to freely modify sites hosted in S3 repositories was immediately taken advantage of by hackers. The Magecart group massively introduced malicious code to steal bank card data and user account information. After all, all that was required was to find a site that accepts payments and uses AWS. As a result, criminals managed to steal the data of hundreds of thousands of visitors to such resources. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2p/1x/-l/2p1x-low--j169mpaxup2nmo5mm.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example of data that a skimmer passed to criminals</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Among the victims of the actions of Magecart are hundreds of online stores, including well-known brands.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the course of the study, we found that, despite the many publications and recommendations regarding the safe configuration of AWS services, at least five online stores out of the number of compromised ones continue to use the S3 stores available for recording. </font><font style="vertical-align: inherit;">To date, their sites do not contain skimmers, but they can be added at any time, since cybercriminals have convenient tools at their disposal to facilitate the search for vulnerable resources.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S3 Open Storage Search Tools</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slurp, Bucket Stream and s3scanner tools help you find readable and writable storage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Slurp helps you find possible storage names for a given domain and check write permissions in them: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wd/ky/lj/wdkyljs5j01vt3zy9opd0subxeu.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slurp output example. Access by http is closed.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
To check the availability of the found storage through the AWS CLI, you can use the get-bucket-acl command: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vf/lg/9c/vflg9celodeoqev2zx6ds2gucb8.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Access to the resource through the AWS API is also closed.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The s3scanner utility written in Python uses a simple heuristic to find possible storage names and checks access to them. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c9/fs/l4/c9fsl4a8algsrngfg4pbpdec_n4.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Searching and checking the availability of S3 storage using s3scanner</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The Bucket Stream utility searches for potentially vulnerable S3 storage in public sources, for example, in Certificate Transparency and other magazines.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AWSBucketDump utility lists the repository files whose names contain specific keywords: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/de/bg/opdebgf5jekoulq7uk4cuxkbmcc.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AWSBucketDump utility result</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Using these utilities, from December 2018 to January 2019 we found more than 5200 unique S3 storages. </font><font style="vertical-align: inherit;">About 4,400 of these were available for standard AWS command-line utilities. </font><font style="vertical-align: inherit;">Only 79 of them were available for reading, and 40 for writing. </font><font style="vertical-align: inherit;">To access part of them, it was simply necessary to assign the necessary rights.</font></font><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How Accounts Leak</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Access rights to resources are a source of headache for developers. And in the case of cloud funds, the problem becomes even more acute. Processes must be authenticated in order to gain access to resources, otherwise there is a risk of data theft or compromise. The whole question is how to do this without risking compromising the data when publishing the code in the repository, as the author of the following fragment posted on Pastebin did: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cp/pb/56/cppb56rwub-ff07tcwnakjmmk3y.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A fragment of the code published on Pastebin with valid AWS API ID and key</font></font><br>
</i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Using this data, the attacker can gain all rights that are provided by the account of this application.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Another source of credential leaks is the Kubernetes API client certificates. </font><font style="vertical-align: inherit;">On the one hand, in the default configuration, this container orchestration system requires mandatory protection in the form of a client certificate. </font><font style="vertical-align: inherit;">On the other hand, developers with surprising naivete publish certificates along with code on GitHub, Pastebin and other services. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Only at Pastebin did we manage to find about fifty different client certificates placed with configuration scripts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If publishing certificates in clear text anywhere is a bad idea, then posting it on GitHub is just disgusting, because:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To delete a certificate, you have to delete it from all saved versions in the repository;</font></font></li>
<li> -     ,       ,      ;</li>
<li>        ,  ,   ,     . </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compromised API keys and certificates can become a source of serious financial damage, like a Russian company </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">owed Amazon $ 12 thousand for one day</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : it hacked a website on Bitrix, which, among other things, indicated an API key for access to the S3 storage. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m8/lw/q1/m8lwq1zcfg5gmlk-c2cxrkwaafk.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Screenshot from the billing panel of a Russian company, whose stolen API key was used to create many virtual machines and cryptocurrency mining. Source: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habr.com/en/post/357764</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
The leakage of customer data can become no less painful, as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at Imperva in 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Imperva also stole the API key and merged all client data.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The stolen accounts can be used by cybercriminals to illegally trade dedicated AWS servers, which will have to be paid for by the real owners. On the lolzteam forum, we found more than 250 ads offering "pure zero Dedicos." </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gx/vc/dc/gxvcdc_b7sokbplcpmqjk0eets4.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Announcement on the forum lolzteam. Who will pay Amazon in the end?</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A third source of API key leaks is a variety of training courses for programmers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trying to explain the process of connecting to AWS services to beginners as simple as possible, the authors replicate bad practice, which in the future leads to new and new cases of compromise. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/dd/0c/vldd0c-tucgmzuiy78o53ed0hbq.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A snippet from a Python course that explains how to work with Amazon S3 services. Keys are offered to hardcode into the program</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The authors of the course on the progressive and safe Java language demonstrate such a careless attitude to the security of API keys: the </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q7/lj/p4/q7ljp4_ydefa8wsvk4tkbrdm934.png" alt="image"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">language is different, but the advice is the same - the keys are right in the program text.</font></font></i><br>
<br>
<b><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Our recommendations</font></font></h3></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incorrect configuration of cloud services poses many risks from the illegal use of leased computing resources for cryptocurrency mining to data theft and the introduction of online skimmers. In this regard, we recommend that security personnel analyze cloud deployment scenarios to identify potential vulnerabilities before the process is completed. Cloud validation scripts like AWS CloudFormation provide insight into how the resulting infrastructure will work, where to look for incorrect or missing security settings or logs. Among the security tools developed by Trend Micro, there is a product aimed at protecting cloud environments - Deep Security for Amazon EC2 instances.And the Cloud Conformity tool allows the company's cloud environment for insecure settings.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For programmers using AWS API keys to interact with S3 repositories, we suggest switching to work through AWS Secrets Manager, Docker Secrets, Blackbox, git-secrets and other similar tools that will allow to avoid compromising and malicious use of credentials stored along with the original application texts.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en501762/index.html">Silicon Valley in Moscow. All truth and news</a></li>
<li><a href="../en501764/index.html">Wireless communication for remote work - a backup channel and not only</a></li>
<li><a href="../en501766/index.html">Personal experience: how to build a career in the DevOps department</a></li>
<li><a href="../en501768/index.html">Scantech KSCAN20 3D Scanner Review</a></li>
<li><a href="../en501772/index.html">Trading the stock market: how not to lose, safety precautions</a></li>
<li><a href="../en501782/index.html">DeepPavlov: Keras for Natural Language Processing helps answer questions about COVID-2019</a></li>
<li><a href="../en501784/index.html">If my car gets in the way</a></li>
<li><a href="../en501786/index.html">New application "Jellyfish". Why flutter?</a></li>
<li><a href="../en501788/index.html">Creating parametric objects in nanoCAD Design BIM</a></li>
<li><a href="../en501790/index.html">Nontrivial animations in SwiftUI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>