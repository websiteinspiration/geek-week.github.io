<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÅ ‚Ñ¢Ô∏è ü§≤üèø 3D-Spiele auf Instagram Javascript oder Wurstflugbahn üè• üë®üèº‚Äçüöí üßóüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nach dem ersten Artikel √ºber das Programmieren von Spielen in Masken auf Instagram bat mich ein Kunde, ein Spiel auf Instagram f√ºr seine Pizzeria zu e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>3D-Spiele auf Instagram Javascript oder Wurstflugbahn</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499974/"><img src="https://habrastorage.org/webt/gl/zq/2a/glzq2aogs8xde9o1cauyy8qc838.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem ersten Artikel √ºber das Programmieren von Spielen in Masken auf Instagram bat mich ein Kunde, ein Spiel auf Instagram f√ºr seine Pizzeria zu erstellen. Dieses Spiel sollte f√ºr Werbezwecke verwendet werden. Nat√ºrlich verstehe ich, dass das Instagram-Thema nach der Anzahl der Aufrufe des ersten Artikels f√ºr die Habr-Community nicht besonders interessant ist. Anscheinend wird dieser Service immer noch als eine Art frivole Unterhaltung f√ºr Blondinen angesehen, und ein Artikel dar√ºber eignet sich nur als Freitagslesung f√ºr einen Abendcocktail. Heute jedoch nur Freitag. Hol dir einen Cocktail. Und vergessen Sie nicht, Blondinen einzuladen. Es ist jedoch wahrscheinlich, dass die Technologie in Zukunft solche H√∂hen erreichen wird, dass wir beginnen werden, in GTA-5 auf Instagram zu spielen. Oder 10.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werden zwei Spiele gleichzeitig behandelt. </font><font style="vertical-align: inherit;">Ich habe einen auf Bestellung angefertigt und dann den zweiten f√ºr mich. </font><font style="vertical-align: inherit;">Mit jedem neuen Spiel stand ich vor neuen Aufgaben, bei der Suche nach L√∂sungen, mit denen ich mich mit den neuen Nuancen der Entwicklung vertraut machte. </font><font style="vertical-align: inherit;">Vielleicht ist diese Geschichte f√ºr andere Entwickler von Elementen der Augmented Reality n√ºtzlich. </font><font style="vertical-align: inherit;">Die Spiele sind in reinem Javascript ohne die Verwendung zus√§tzlicher Bibliotheken geschrieben. </font><font style="vertical-align: inherit;">Zur Anzeige von 3D-Grafiken werden die integrierten Instagram-Tools verwendet.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spiel 1. Pizza</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also, was ist die Essenz des ersten Spiels. Pizza drehen. Komponenten fliegen von seiner Oberfl√§che ab - Wurstst√ºcke, Tomaten und so weiter. Zwei Spieler m√ºssen ihren Mund fangen. Der Gewinner ist derjenige, der, wie Sie sich vorstellen k√∂nnen, mehr f√§ngt. Mit der Zeit nimmt die Drehzahl zu. Das Lustigste in diesem Spiel war f√ºr mich, die Flugwege dieser essbaren Elemente zu programmieren. Stellen Sie sich vor, Sie programmieren einen Wurstflug. Nein, definitiv, ich hatte noch nie so viel Spa√ü beim Programmieren. Ich lache schon jetzt und schreibe diesen Artikel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als der Kunde den funktionierenden Prototyp sah, schickte er mir Folgendes: ":))". Beim Testen des Endergebnisses ist ein Problem aufgetreten. Es bestand darin, dass die Probanden das Spiel nicht spielen konnten: Sie platzten einfach vor Lachen - es machte so viel Spa√ü.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich m√∂chte Sie daran erinnern, dass die Entwicklung von Masken und Spielen in Spark AR Studio erfolgt. Und von dort aus k√∂nnen Sie Ihre Arbeit auf Instagram hochladen, damit jeder sie sehen kann. Es ist bemerkenswert, dass Webtechnologien die Grenzen zwischen Betriebssystemen f√ºr einen Entwickler verwischen. Sie schreiben einen Code, der dann in der Instagram-Anwendung f√ºr iOS und Android ohne √Ñnderungen oder Modifikationen funktioniert. Nat√ºrlich wird die Zahlung daf√ºr zu einer grunds√§tzlich niedrigen Skriptgeschwindigkeit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Zeitplan f√ºr das Spiel wurde vom Kunden zur Verf√ºgung gestellt. Es gab einige Schwierigkeiten mit 3D-Modellen. Insbesondere bei Verwendung der integrierten Animations-Engine Spark AR Studio stellte sich heraus, dass bei einer Skalierung des sich bewegenden Objekts dessen Koordinaten im Spiel falsch bestimmt werden. Dieser st√∂rende Effekt wird jedoch nicht beobachtet, wenn Sie nicht das gesamte Objekt vollst√§ndig skalieren, sondern jedes seiner Netze separat. Ich musste den Ma√üstab der Pizza 1: 1 verlassen und f√ºr jedes Element einen bestimmten Koeffizienten vorschreiben. Es gab auch Probleme mit dem FBX-Format, in das Sie Modelle f√ºr ein Instagram-Spiel exportieren m√ºssen. Der Grafikdesigner schickte Modelle mit eingebauten Texturen, die au√üerdem entlang eines relativen Pfades platziert wurden. Der 3D-Editor hat sie gesehen, Spark AR jedoch nicht. Ich musste die Modelle neu verpacken, damit die Texturdateien getrennt von den Modellen und entlang eines Pfades mit ihnen lagen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiteres kleines Problem, auf das ich gesto√üen bin, war, dass das API-Saprk-AR-Objekt, das f√ºr die Anzeige von Text auf dem Bildschirm verantwortlich ist, sich weigerte, den Wert als Wert zu akzeptieren - beispielsweise als Spielstand. </font><font style="vertical-align: inherit;">Ich konnte lange nicht verstehen, warum nichts angezeigt wird. </font><font style="vertical-align: inherit;">Was mache ich falsch? </font><font style="vertical-align: inherit;">Es stellte sich heraus, dass Sie zuerst die Zahlen in Zeichenfolgen konvertieren m√ºssen (.toString ()). </font><font style="vertical-align: inherit;">Dies ist f√ºr andere Sprachen selbstverst√§ndlich, f√ºr Javascript jedoch eher untypisch, was dies immer selbst getan hat.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einfache Animation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines der neuen Dinge in diesem Spiel war f√ºr mich die Programmierung der Animation von 3D-Objekten. (In meinem vorherigen Instagram-Spiel "Tic-Tac-Toe" gab es √ºberhaupt keine Animation.) Die Animations-Engine in Spark AR Studio ist sehr spezifisch. Es ben√∂tigt einige Eingabeparameter und verbindet die Variable dann reaktiv mit dem Objekt, in dem Sie etwas √§ndern m√∂chten. Dies √§ndert beispielsweise die y-Koordinate (startValue, endValue - ihre Anfangs- und Endwerte) eines 3D-Objekts √ºber die Zeit t:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> driverParameters = {
    <span class="hljs-attr">durationMilliseconds</span>: t,
    <span class="hljs-attr">loopCount</span>: <span class="hljs-literal">Infinity</span>,
    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span><font></font>
};<font></font>
<span class="hljs-keyword">var</span> driver = Animation.timeDriver(driverParameters);
<span class="hljs-keyword">var</span> sampler = Animation.samplers.linear(startValue, endValue);<font></font>
sceneObject.transform.y = Animation.animate(driver, sampler);<font></font>
driver.start();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die im Weltraum abfliegenden Pizza-Zutaten zu bewegen, habe ich beschlossen, einfach drei solcher Animationen f√ºr jede Koordinate parallel auszuf√ºhren. Es gen√ºgte, die Anfangskoordinate (startValue) und die Endkoordinate anzugeben, die durch den Drehwinkel der Pizza (endValue) berechnet wurden, so dass sie irgendwo weit entfernt waren, falls der Spieler diese ‚ÄûMuschel‚Äú nicht mit dem Mund auffing. Wenn gefangen - dann stoppt die Bewegung. Das Ereignis zum √ñffnen des Mundes, das ich bereits in einem fr√ºheren Artikel beschrieben habe. Nur hier gibt es ein Spiel f√ºr zwei und dementsprechend wird es bereits zwei Gesichter und zwei M√ºnder geben:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});<font></font>
<font></font>
FaceTracking.face(<span class="hljs-number">1</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der entscheidende Punkt in diesem Spiel ist das Fangen fliegender Zutaten mit dem Mund, dh das Finden eines Flugobjekts in einem bestimmten kleinen Bereich um die Mitte des Mundes einer Person. </font><font style="vertical-align: inherit;">Anfangs wollte diese Berechnung f√ºr mich nicht richtig durchgef√ºhrt werden, aber nach der Einf√ºhrung eines versteckten Objekts, das an die Koordinaten des Mundes gebunden ist, wurde eine L√∂sung f√ºr das Problem gefunden, und es funktionierte. </font><font style="vertical-align: inherit;">Aus irgendeinem Grund kehrten die direkten Koordinaten des Mundes nicht zur√ºck. </font><font style="vertical-align: inherit;">Hier ist cameraTransform.applyTo die Reduktion der Koordinaten von Gesichtspunkten auf die Koordinaten in der 3D-Welt (die Methode ist der Dokumentation entnommen).</font></font><br>
<br>
<pre><code class="javascript hljs">move: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//   (   )</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> object = Scene.root.find(<span class="hljs-string">'pizzafly'</span>);
    <span class="hljs-keyword">var</span> olast = {
        <span class="hljs-attr">x</span>: object.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: object.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: object.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   ,       </span>
    <span class="hljs-keyword">var</span> objectHidden = Scene.root.find(<span class="hljs-string">'nullObject'</span>);<font></font>
    objectHidden.transform.x = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).x;<font></font>
    objectHidden.transform.y = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).y;<font></font>
    objectHidden.transform.z = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).z;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> mouth = {
        <span class="hljs-attr">x</span>: objectHidden.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: objectHidden.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: objectHidden.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> d = {
        <span class="hljs-attr">x</span>: <span class="hljs-built_in">Math</span>.abs(olast.x - mouth.x),
        <span class="hljs-attr">y</span>: <span class="hljs-built_in">Math</span>.abs(olast.y - mouth.y),
        <span class="hljs-attr">z</span>: <span class="hljs-built_in">Math</span>.abs(olast.z - mouth.z)<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> ((d.x &gt; <span class="hljs-number">0.03</span>) || (d.y &gt; <span class="hljs-number">0.03</span>) || (d.z &gt; <span class="hljs-number">0.03</span>)) {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    };<font></font>
<font></font>
},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anschlie√üend wurde mir klar, dass Sie die Tiefenpr√ºfung (z-Koordinate) entfernen sollten, da es in diesem speziellen Spiel visuell schwierig ist, die Tiefe abzusch√§tzen. </font><font style="vertical-align: inherit;">Das hei√üt, jetzt wurde es m√∂glich, die Zutat zu fangen, indem Sie jederzeit w√§hrend des Fluges den Mund √∂ffnen. </font><font style="vertical-align: inherit;">Die Hauptsache ist die Kombination von x und y.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/v9/dw/nwv9dwt-p5wip4yhnnhtirudgoe.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das letzte Problem, auf das ich beim Schreiben dieses Spiels gesto√üen bin, war die Begrenzung der Gr√∂√üe des endg√ºltigen Builds auf 4 MB. Dar√ºber hinaus ist es laut der Empfehlung von Facebook w√ºnschenswert, dass sogar 2 MB vorhanden sind, damit das Spiel auf m√∂glichst vielen Mobilger√§ten angezeigt werden kann. Und 3D-Modellierer sind kreative Menschen und m√∂chten schwere Modelle mit einem dichten Raster und riesigen Texturen erstellen, ohne sich um uns, Programmierer oder vielmehr um die endg√ºltige Leistung in Spielen zu k√ºmmern. Ich habe auch irgendwie die Texturen verkleinert und in JPG (anstelle von PNG) komprimiert, aber das Pizzamodell selbst musste zur √úberarbeitung gesendet werden (Retopologie). Infolgedessen war es dennoch m√∂glich, mit allen Modellen, Texturen und einem Skript in das 2-MB-Volume zu passen. Und das Spiel ging in Ma√üen weiter.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und nach einiger Zeit kehrte sie mit der Formulierung zur√ºck, dass "der Effekt zu viel statischen Text enth√§lt". </font><font style="vertical-align: inherit;">Ich musste die Countdown-Nummern entfernen und stattdessen die Animation auf den Pfeil auf der Stoppuhr setzen, der nun begann, die Zeit anstelle von ihnen zu z√§hlen. </font><font style="vertical-align: inherit;">Danach wurde das Spiel genehmigt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spiel 2. √úber den Schmetterling (ButterFlap)</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/dt/63/wddt63fejsxelpizwyffhzw5zig.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt werde ich √ºber das Erstellen eines zweiten Spiels sprechen. Ich kann nicht anders, als Spiele zu machen, das ist mein Hobby. Einige Tage vor dem 8. M√§rz habe ich beschlossen, ein Instagram-Spiel f√ºr diesen Feiertag zu erstellen. Etwas √ºber Blumen, Schmetterlinge und S√º√üigkeiten. Aber ich konnte mir nicht vorstellen, was das Wesentliche des Spiels sein k√∂nnte. Der Gedanke drehte sich in meinem Kopf. Vielleicht sammelt der Schmetterling S√º√üigkeiten und legt sie in einen Korb? Oder nehmen Schmetterlinge vielleicht S√º√üigkeiten in die Luft und werfen sie, und der Spieler muss sie mit dem Mund fangen? Im Allgemeinen habe ich ein paar Tage lang betrogen und nachdem ich keine L√∂sung gefunden hatte, wurde mir klar, dass mein Spiel bis zum 8. M√§rz immer noch keine Zeit hatte, die Moderation zu durchlaufen, da letzteres 3-4 Tage dauert. Ich wollte dieses Unternehmen bereits verlassen, als pl√∂tzlich die Idee von selbst kam, pl√∂tzlich. Ich habe das Spiel nicht mehr an den Frauentag gebunden, jetzt war es nur noch ein Spiel.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scroller. </font><font style="vertical-align: inherit;">Von links nach rechts bewegen sich Landschaft und verschiedene Hindernisse. </font><font style="vertical-align: inherit;">Der Spieler muss einen Schmetterling kontrollieren, der sich frei auf dem Bildschirm bewegen und in der Luft h√§ngende Diamanten sammeln kann. </font><font style="vertical-align: inherit;">Au√üerdem bewegen sich von rechts nach links etwas schneller als der Rest des Bildes Wolken, aus denen Regen str√∂mt. </font><font style="vertical-align: inherit;">Sie m√ºssen sich vor dem Regen unter den Blumen verstecken. </font><font style="vertical-align: inherit;">Wenn ein Schmetterling unter Wasser f√§llt, werden seine Fl√ºgel nass und er f√§llt. Dies ist das Ende des Spiels. </font><font style="vertical-align: inherit;">Ich habe das Spiel einfach genannt: ButterFlap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, das h√∂rt sich alles gut an. </font><font style="vertical-align: inherit;">Ich wollte mich direkt spielen. </font><font style="vertical-align: inherit;">Aber ich erinnerte mich, dass ich √ºberhaupt kein K√ºnstler war. </font><font style="vertical-align: inherit;">Ich kann jedoch 3D-Modelle erstellen, was einfacher ist als das Zeichnen. </font><font style="vertical-align: inherit;">Also wurde beschlossen, dass es einen 3D-Scroller geben sollte.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafik</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich fand lizenzfreie Online-Modelle, die ich verfeinern musste. Ich habe Texturen auf jene ohne Texturen gezogen, nachdem ich diese zuvor in den Texturatlas eingef√ºgt hatte: Artefakte in Form von ‚ÄûLeitern‚Äú sind auf nicht texturierten Modellen sichtbar, und Texturen im Spiel k√∂nnen gegl√§ttet werden, wodurch das Erscheinungsbild von Objekten pr√§sentabler und nicht so flach wird. Die Modelle, die Texturen enthielten, hatten auch ihre Fehler, die behoben werden mussten. Erstens war die Gr√∂√üe der Texturen kein Vielfaches von zwei. Das hei√üt, es k√∂nnte zum Beispiel 1200x1200 sein. Ich musste auf 1024x1024 komprimieren. Videoprozessoren k√∂nnen unangemessene Texturen mit leerem Raum skalieren oder ausf√ºllen, d. H. Solche, die nicht 1024 x 1024, 512 x 512, 256 x 256 usw. sind. In jedem Fall sind solche Aktionen eine zus√§tzliche Belastung w√§hrend der Arbeit des Spiels und ein bedeutungsloser Speicherverbrauch.Daher ist es besser, die richtigen Bilder zuerst manuell vorzubereiten. Die Situation wurde auch durch die Tatsache gerettet, dass ich alle Texturen nach Texturatlanten verteilt habe. Wenn also beispielsweise die urspr√ºngliche Textur 400 x 200 Pixel gro√ü war, konnte ich sie einfach neben anderen √§hnlichen in den Atlas 1024 x 1024 einf√ºgen. Danach ist es nat√ºrlich notwendig, auch den UV-Scan zu skalieren, dies geschieht jedoch in wenigen Sekunden. Es gab immer noch Modellvarianten, bei denen die Texturen aus irgendeinem Grund entlang eines absoluten Pfades wie ‚ÄûC: \ Work \ Vasya \ Map.jpg‚Äú gebunden waren. Nun, es gibt keinen solchen Ordner auf meinem Computer! Ich musste die Pfade zu den Texturen manuell angeben ... Aber warum kamen Sie auf die Idee, dass ich alle meine Projekte auf dem Laufwerk "C:" behalten sollte! Oh, diese Modellierer, freie K√ºnstler ... √úbrigens, auf diese Weise k√∂nnen Sie durch die Namen von Ordnern in zuf√§llig linken Pfaden versehentlich mehr √ºber die Identit√§t des Modellierers erfahren.zum Beispiel sein Name. Freut mich, dich kennenzulernen!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am schwierigsten war es, ein geeignetes Schmetterlingsmodell mit Animation zu finden. Spark AR verwendet Animationen, die aus jedem 3D-Editor in das FBX-Format exportiert werden k√∂nnen. Die Fl√ºgel eines Paares von Schmetterlingsmodellen, die ich heruntergeladen habe, waren irgendwie seltsam gespiegelt - ein Fl√ºgel wurde modelliert, und der zweite wurde auf eine Weise reflektiert, die ich nicht verstand, und so stellten sich zwei heraus. Mit dieser Herangehensweise an die Modellierung wollte am Ende im Spiel einer der Fl√ºgel (kopiert) kein Licht von der Quelle empfangen und blieb immer dunkel. Ich habe nicht riskiert, das Modell drastisch zu √§ndern, da dann die Animation geflogen w√§re. Und in der Animation bin ich ein noch gr√∂√üerer Neuling als in der 3D-Modellierung. Vielleicht war das Problem etwas anderes: Ich habe zum Beispiel versucht, die Normalen zu erweitern, aber das hat nicht geholfen. Kurz gesagt, kostenlose 3D-Modelle sind ein Schmerz. Infolgedessen, den ganzen Abend gewaschen,Durch Versuch und Irrtum fand ich ein geeignetes Modell, das nach einiger Feinabstimmung mit einer Datei zufriedenstellend aussah. Etwas, das mir nicht gefallen hat, aber es waren kleine Dinge: Ich habe die Textur √ºberarbeitet, die Geometrie an einigen Stellen ge√§ndert und die Materialparameter angepasst. Schlie√ülich startete der Schmetterling. Hurra. Aber jetzt bin ich ersch√∂pft. Also beschloss ich, ins Bett zu gehen und am n√§chsten Tag fortzufahren. Ja, ich habe 7-8 Tage damit verbracht, das Spiel zu erstellen. Aber es war eine ziemlich gem√§chliche Arbeit am Abend, Dokumentation, Artikel zu lesen und Antworten auf Fragen zu finden.Also beschloss ich, ins Bett zu gehen und am n√§chsten Tag fortzufahren. Ja, ich habe 7-8 Tage damit verbracht, das Spiel zu erstellen. Aber es war eine ziemlich gem√§chliche Arbeit am Abend, Dokumentation, Artikel zu lesen und Antworten auf Fragen zu finden.Also beschloss ich, ins Bett zu gehen und am n√§chsten Tag fortzufahren. Ja, ich habe 7-8 Tage damit verbracht, das Spiel zu erstellen. Aber es war eine ziemlich gem√§chliche Arbeit am Abend, Dokumentation, Artikel zu lesen und Antworten auf Fragen zu finden.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/zb/iy/rrzbiyezloccrjo_egas613ltry.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Den ganzen Abend am n√§chsten Tag habe ich an Grafiken gearbeitet. Die Besonderheit von Spielmasken f√ºr Instagram ist, wie bereits erw√§hnt, dass es ratsam ist, das 2-MB-Volumen f√ºr das gesamte Spiel (maximal 4 MB) nicht zu √ºberschreiten. Ich habe mir keine Sorgen um das Skript gemacht: Es ist unwahrscheinlich, dass seine Gr√∂√üe 50 KB √ºberschreitet. Aber √ºber 3D mussten Modelle von Pflanzen ziemlich beschworen werden. Zum Beispiel wurde der Teil der Sonnenblume, in dem sich die Samen befinden, durch Geometrie hergestellt. Hunderte von Polygonen ... Ersetzen Sie es durch ein Fragment einer Kugel aus ein paar Dutzend Dreiecken und dehnen Sie die heruntergeladene Textur dieses Teils. Die Anzahl der Bl√§tter kann ebenfalls reduziert werden. Wir machen Gras am unteren Rand der Szene mit einer Ebene von zwei Dreiecken mit einer √ºberlagerten Textur mit einem Alphakanal. Wir erreichen das Volumen mit Schatten und kopieren Fragmente des Bildes in die Textur selbst.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen ist es w√ºnschenswert, die Anzahl der Texturen sowie deren Gr√∂√üe in Bytes zu minimieren. </font><font style="vertical-align: inherit;">Es sind die Texturen, die den Gro√üteil des Spiels ausmachen. </font><font style="vertical-align: inherit;">Ich bin es gewohnt, Texturen, bei denen Transparenz erforderlich ist, in einem Texturatlas zu platzieren - in PNG 32-Bit - und Texturen, die den Alphakanal nicht verwenden, in einen anderen Atlas zu packen und ihn in JPG zu speichern. </font><font style="vertical-align: inherit;">Jpg kann st√§rker als png geschrumpft werden. </font><font style="vertical-align: inherit;">Gras- und UI-Elemente, die Transparenz ben√∂tigen, wurden in den PNG-Atlas und alles andere in JPG aufgenommen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gesamtvolumen. </font><font style="vertical-align: inherit;">Insgesamt habe ich 4 Arten von Pflanzen, einen Stein, einen Schmetterling, den der Spieler kontrollieren wird, und eine Wolke. </font><font style="vertical-align: inherit;">Die Texturen aller dieser Modelle in komprimierter Form nahmen 2 Atlanten 1024 x 1024 jpg und png mit einem Gesamtvolumen von 500 KB an. </font><font style="vertical-align: inherit;">Die Modelle selbst nahmen etwa 200 Kb. </font><font style="vertical-align: inherit;">Plus ein Skript. </font><font style="vertical-align: inherit;">Sounds - 31 Kb. </font><font style="vertical-align: inherit;">Gesamt: ca. 1 MB. </font><font style="vertical-align: inherit;">In Gr√ºn wird nur die Gr√∂√üe des Builds angezeigt (dies sollte in 2 MB passen).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/7r/c1/ak7rc1e09ycyaee13ypwnokgeqm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pl√∂tzlich stie√ü ich auf ein v√∂llig unerwartetes Problem. </font><font style="vertical-align: inherit;">Ich habe mehrere nicht verwendete Modelle gel√∂scht, jedoch nicht √ºber Spark AR Studio, sondern aus dem Dateisystem. </font><font style="vertical-align: inherit;">Beim Zusammenstellen des Builds stellte ich anschlie√üend fest, dass sie aus der Spark AR Studio-Szene verschwunden waren, aber dennoch in die Assembly aufgenommen wurden. </font><font style="vertical-align: inherit;">Und das Projekt von ungenutzten Ressourcen zu befreien, ist unm√∂glich. </font><font style="vertical-align: inherit;">Links zu ihnen aus der "Asset Summary" f√ºhren nirgendwo hin. </font><font style="vertical-align: inherit;">Anscheinend ist dies ein Defekt in Spark AR Studio. </font><font style="vertical-align: inherit;">Ich musste das Projekt erneut erstellen und von Anfang an alle erforderlichen Ressourcen hinzuf√ºgen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Szene</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe lange dar√ºber nachgedacht, wie das Scrollen aller Objekte auf dem Bildschirm implementiert werden kann. </font><font style="vertical-align: inherit;">Von den Tools hierf√ºr gibt es in Spark AR Studio nur Javascript und die einfachste integrierte Animations-Engine, mit der die Koordinaten des Objekts in einer bestimmten Zeit einfach vom Anfangswert zum Endwert ge√§ndert werden k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, das Dilemma war noch vorher aufgetreten: ob das gesamte Level des Spiels, eine Szene in einem 3D-Editor, erstellt werden soll, indem die sich wiederholenden Pflanzen die erforderliche Anzahl von Malen dupliziert und an den richtigen Positionen platziert werden, um die gesamte Szene im Spiel zu scrollen oder nur eine Kopie jedes 3D zu laden Objekt und ersetzen Sie sie in Richtung des Spielers direkt au√üerhalb des Bildschirms. Die Antwort war offensichtlich. Unsere Wahl ist die zweite Option. Andernfalls ist es definitiv nicht m√∂glich, in 2 MB zu passen: H√∂chstwahrscheinlich ist die Szene gem√§√ü der ersten Option schwer. Aber dann brauchen Sie ein Layout von Objekten. Und ich habe mich ohne zu z√∂gern entschieden, den 3D-Editor als Level-Editor zu verwenden. Ja, es stellt sich heraus, dass ich beides getan habe. Pflanzen f√ºr das Spiel habe ich jeweils in einer Kopie gespeichert. Und vom Editor brauchte ich nur die Koordinaten. Nach Abschluss der Arbeit,Ich schrieb die Koordinaten aller Objekte auf und erstellte ein Array mit den Daten f√ºr das Spiel.</font></font><br>
<br>
<pre><code class="javascript hljs">lv:[<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">8.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-6.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'cloud'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.1</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'rain'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">6.6</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">14</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-2.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'diamond_red'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">20</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">2.0</span>},<font></font>
	...<font></font>
],</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und doch - ein separates assoziatives Array nach Objekttypen, in dem die Gr√∂√üe der Kollider und ihre Verschiebungen relativ zu den Zentren von 3D-Objekten gespeichert sind, sowie eine Flagge (Spalte), die bestimmt, ob das Objekt ein Hindernis ist (andernfalls passiert der Spieler es). </font><font style="vertical-align: inherit;">F√ºr einige Objekttypen wird ein (Zerst√∂rungs-) Flag gesetzt, das bestimmt, ob das Objekt nach der Interaktion ausgeblendet werden soll, sowie ein (v) -Parameter, der einen bestimmten Interaktionsgrad bestimmt, z. B. die Anzahl der Punkte, die ein Spieler gewinnt oder verliert.</font></font><br>
<br>
<pre><code class="javascript hljs">colld:{
    <span class="hljs-string">'flower1'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">2.3</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1.4</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_green'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">destroy</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_red'</span>:{<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">-2</span>},<font></font>
<font></font>
    ...<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine kleine Nuance. </font><font style="vertical-align: inherit;">Das Gras am unteren Rand der Szene sollte kontinuierlich scrollen. </font><font style="vertical-align: inherit;">Sie m√ºssen also zwei Kopien dieses Objekts verwenden und sie beim Verschieben nacheinander ersetzen. </font><font style="vertical-align: inherit;">Blumen erscheinen auf einem Bildschirm nicht mehr als jeweils in einer Kopie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter Ber√ºcksichtigung des Skalierungsproblems, auf das ich bei der Entwicklung des ersten Spiels gesto√üen bin, habe ich die Skalierung aller Modelle im 3D-Editor zur√ºckgesetzt. So werden bei Saprk AR-Modellen sofort normale Gr√∂√üen geladen. Zwar konnte es im Skript ohnehin nicht ohne die "magische Zahl", den globalen Koeffizienten, den universellen Code, der die Essenz des Universums enth√§lt, auskommen. Nat√ºrlich ein virtuelles Universum. Und ich bin bereit, Ihnen diese Nummer mitzuteilen. Benutze es, Leute! Es ist mir egal! Diese Nummer ist 0.023423. Kurz gesagt, trotz des Zur√ºcksetzens aller Skalen stellte sich heraus, dass ein Meter im 3D-Editor genau dieser Zahl in Spark AR Studio entspricht. H√∂chstwahrscheinlich verstehe ich jedoch nicht alle Feinheiten der Arbeit mit 3D-Grafiken, daher der Koeffizient. Die Koordinaten (aber nicht die Gr√∂√üe) aller Objekte, die aus dem Editor exportiert wurden, werden damit multipliziert, Sie haben es erraten.Wo ich den Ma√üstab der Szene in Spark AR anpassen konnte, habe ich nicht gefunden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das n√§chste Problem, auf das ich stie√ü, war der Verlust der Sortierreihenfolge von Objekten beim Exportieren aus einem 3D-Editor. </font><font style="vertical-align: inherit;">Komplexe Objekte, die aus mehreren Maschen bestehen, k√∂nnen im Spiel unvorhersehbar auf der Szene erscheinen, so dass beispielsweise ein Netz, das sich hinter einem anderen befindet, pl√∂tzlich nach vorne springt. </font><font style="vertical-align: inherit;">Wenn Sie sich die Reihenfolge der Objekte nach dem Export in Spark AR Studio ansehen, zeigt dies, dass dieses Netz aus irgendeinem Grund in der Liste h√∂her ist, obwohl es im Editor niedriger war. </font><font style="vertical-align: inherit;">Ich habe dieses Problem gel√∂st, indem ich die Szene in Ebenen unterteilt und in verschiedenen Dateien gespeichert habe.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komplexe Animation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr weitere drei Abende spielte ich mit dem Programmieren. Wenn ich die Standard-Spark AR Studio-Engine zum Animieren der Fl√ºgel eines Schmetterlings verwendet habe, war das Verschieben des Hintergrunds nicht so einfach. Ich verstand immer noch nicht, wie man nicht nur einen variablen Parameter an Iterationen des Bewegungszyklus anf√ºgt, sondern eine vollwertige R√ºckruffunktion. Auf jeden Fall konnte ich es nicht tun, die aktuellen Animationsparameter wollten dort nicht √ºbertragen werden. Und eine solche Funktion ist einfach notwendig, denn wenn ich im ersten Spiel (mit Pizza) die Kollision durch das √ñffnen des Mundes durch Abonnieren √ºberpr√ºft habe, gab es hier kein solches Ereignis. Und es war nur notwendig, Kollisionen mit Umgebungsobjekten zu √ºberpr√ºfen, w√§hrend sich der Charakter gem√§√ü seinen aktuellen Koordinaten bewegt. Und daf√ºr m√ºssen die Koordinaten bei jeder Iteration verglichen werden. Und dann dachte ich. Immerhin habe ich schon Spiele in Javascript geschrieben.Und warum nicht Ihre Animations-Engine verwenden, die ich zuvor f√ºr diese Spiele geschrieben habe? Das Funktionsprinzip ist ungef√§hr dasselbe: In einer bestimmten Zeit √§ndert sich der Parameter (oder die Parameter) zwischen den angegebenen Anfangs- und Endwerten. Und der aktuelle Wert wird in der angegebenen R√ºckruffunktion als Parameter √ºbergeben - Sie werden es nicht glauben -, in der Sie beispielsweise ein 3D-Objekt in der Szene an Koordinaten festlegen k√∂nnen, die diesen aktuellen Werten entsprechen, oder auf Kollisionen pr√ºfen k√∂nnen. Danke, Cap. Ich musste meine Engine leicht an das lokale ‚Äû√ñkosystem‚Äú anpassen: Entfernen Sie Verweise auf das Fensterobjekt von dort, da es nicht hier ist, und andere kleine Dinge.Und der aktuelle Wert wird in der angegebenen R√ºckruffunktion als Parameter √ºbergeben - Sie werden es nicht glauben -, in der Sie beispielsweise ein 3D-Objekt in der Szene an Koordinaten festlegen k√∂nnen, die diesen aktuellen Werten entsprechen, oder auf Kollisionen pr√ºfen k√∂nnen. Danke, Cap. Ich musste meine Engine leicht an das lokale ‚Äû√ñkosystem‚Äú anpassen: Entfernen Sie Verweise auf das Fensterobjekt von dort, da es nicht hier ist, und andere kleine Dinge.Und der aktuelle Wert wird in der angegebenen R√ºckruffunktion als Parameter √ºbergeben - Sie werden es nicht glauben -, in der Sie beispielsweise ein 3D-Objekt in der Szene an Koordinaten festlegen k√∂nnen, die diesen aktuellen Werten entsprechen, oder auf Kollisionen pr√ºfen k√∂nnen. Danke, Cap. Ich musste meine Engine leicht an das lokale ‚Äû√ñkosystem‚Äú anpassen: Entfernen Sie Verweise auf das Fensterobjekt von dort, da es nicht hier ist, und andere kleine Dinge.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja, noch - √ºber das Scrollen der Landschaft und der Objekte der Umgebung. Ich beschloss, die ganze Welt in ein NullObject zu setzen, dh in ein leeres 3D-Objekt, einen Container, und es mit nur einem Parameter f√ºr die Animation zu verschieben - seiner x-Koordinate. Innerhalb des Containers haben alle Modelle die gleichen Koordinaten wie au√üerhalb, nur f√ºr sie ist das Referenzsystem jetzt an dieses leere Objekt gebunden. Steine ‚Äã‚Äãund Blumen werden wiederholt (au√üerdem in unterschiedlichen H√∂hen vom Boden gem√§√ü dem Niveaudiagramm), sodass Sie diese Objekte w√§hrend der Bewegung wiederverwenden k√∂nnen und sie in der gew√ºnschten horizontalen und vertikalen Position innerhalb des "Containers" einstellen k√∂nnen. Ich habe ein Suchsystem f√ºr Objekte geschrieben, die in den Rahmen fallen (am aktuellen Container-Offset), das das Objekt, das den Rahmen verl√§sst, weiter an eine neue Position setzt, falls es dort erscheinen soll. Du kannst sehen,wie es am Beispiel von drei Objekten funktioniert. (Es werden mehr davon im Spiel sein, so dass Sie dort keinen solchen Effekt der "Neuanordnung" von Umgebungsobjekten mehr sehen.)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3i72svxLHM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Funktion zum Aktualisieren der Koordinaten von Objekten sieht folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="javascript hljs">oCoordSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-comment">//  :    </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> camx = -ap.oWorld.transform.x.pinLastValue();
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> x1 = camx - ap.game.scro.w2;
    <span class="hljs-keyword">var</span> x2 = camx + ap.game.scro.w2;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> ((ap.d.lv[i].x &gt;= x1) &amp; (ap.d.lv[i].x &lt;= x2)) {
            <span class="hljs-comment">//   </span><font></font>
            ap.d.lv[i].o = Scene.root.find(ap.d.lv[i].n);<font></font>
            <span class="hljs-comment">//  -  </span><font></font>
            ap.d.lv[i].o.transform.y = ap.d.lv[i].y;<font></font>
            <span class="hljs-keyword">if</span> ((ap.d.lv[i].n == <span class="hljs-string">'cloud'</span>) || (ap.d.lv[i].n == <span class="hljs-string">'rain'</span>)) {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//  </span>
                <span class="hljs-comment">//   2.3,</span>
                <span class="hljs-comment">//     </span>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x - (x2 - ap.d.lv[i].x) * <span class="hljs-number">2.3</span> + <span class="hljs-number">0.2</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//      </span><font></font>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x;<font></font>
            };<font></font>
        };<font></font>
    };<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (camx &gt; ap.game.grassPosLast) {<font></font>
        ap.game.grassPosLast += ap.game.grassd;<font></font>
        ap.game.grassi = <span class="hljs-number">1</span> - ap.game.grassi;<font></font>
        ap[ap.game.grassNm[ap.game.grassi]].transform.x = ap.game.grassPosLast;<font></font>
    };<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protagonist</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Hauptfigur im Spiel ist ein unsinkbarer Schmetterling, der mutig vorw√§rts fliegt und Hindernisse √ºberwindet. </font><font style="vertical-align: inherit;">Ich entschied mich f√ºr das Management, indem ich einen Marker oder Cursor (Lichtpunkt) setzte, indem ich meinen Kopf drehte und neigte. </font><font style="vertical-align: inherit;">Und in Richtung dieses Punktes fliegt ein Schmetterling langsam (tats√§chlich ist er kein K√§mpfer und kann sich auch nicht teleportieren). </font><font style="vertical-align: inherit;">Wenn Sie beispielsweise das Ereignis "Kopfneigung" abonnieren, k√∂nnen Sie die vertikale Steuerung folgenderma√üen implementieren:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> v = event.newValue;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> scrH2 = ap.game.scr.h2;
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">var</span> p = -v * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (p &lt; -scrH2) {<font></font>
        p = -scrH2;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p &gt; scrH2) {<font></font>
        p = scrH2;<font></font>
    };<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">0.006</span>;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> cur = ap.oPers.transform.y.pinLastValue();
    <span class="hljs-keyword">if</span> (p &lt; cur) {<font></font>
        cur -= d;<font></font>
        <span class="hljs-keyword">if</span> (cur &lt; p) {cur = p;};<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        cur += d;<font></font>
        <span class="hljs-keyword">if</span> (cur &gt; p) {cur = p;};<font></font>
    };<font></font>
    <span class="hljs-comment">//    ()</span><font></font>
    ap.oPointer1.transform.y = p;<font></font>
    <span class="hljs-comment">//   ,</span>
    <span class="hljs-comment">// ,    </span><font></font>
    ap.game.pers.dy + = cur - ap.game.pers.y;<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ñhnliches gilt f√ºr die Horizontale. </font><font style="vertical-align: inherit;">Nur dort ist es notwendig, das Ereignis nicht einer Neigung, sondern einer Kopfdrehung (Rotation Y) zu abonnieren und anstelle der H√∂he des Bildschirms dessen Breite zu ber√ºcksichtigen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collider</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das alles ist wunderbar, die Welt bewegt sich und der Spielcharakter kann sich frei auf dem Bildschirm bewegen. Aber jetzt brauchst du einen Kollisionshandler, sonst funktioniert kein Spiel. Es gibt drei Ereignisse im Spiel, nach denen sich die Position des Charakters √§ndern kann. Dies ist die Drehung und Neigung des Kopfes sowie die Bewegung der Welt, bei der die horizontale Koordinate des Spielers (x) automatisch zunimmt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich nicht wei√ü, wie Iterationen des Face-Handlers in Spark AR funktionieren - ob sie mit einer bestimmten Frequenz aufgerufen oder auf die maximal m√∂gliche Taktfrequenz eingestellt sind und ich diesen Parameter in meiner Animations-Engine steuern kann, habe ich beschlossen, Kollisionen in meiner Funktion zu definieren die Bewegung der Welt, die mit einer von mir festgelegten Frequenz (60 Bilder pro Sekunde) aufgerufen wird. Bei Gesichtsverarbeitungsereignissen werden wir nur Bewegungen ‚Äûakkumulieren‚Äú.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Prinzip wird so sein. Bei Kopfneigungs- und Kopfdrehereignissen wird ein Versatz entlang der x- und y-Achse akkumuliert. Dar√ºber hinaus wird beim Scrollen der Welt dem ‚ÄûSparschwein‚Äú eine horizontale Verschiebung hinzugef√ºgt. Und dann wird gepr√ºft, ob es zu einer Kollision mit einem der Objekte auf der Welt kommt, wenn die akkumulierte Verschiebung zu den urspr√ºnglichen Koordinaten addiert wird. Wenn nicht, werden die urspr√ºnglichen Koordinaten des Spielers plus der Versatz durch die aktuellen Koordinaten gebildet. Und dann aktualisieren wir die Quell-Offsets auf die aktuellen (Reset) und setzen die Offsets zur√ºck. Wenn ja, rollen Sie die Koordinaten auf das Original zur√ºck. Dar√ºber hinaus m√ºssen wir bestimmen, auf welcher Achse die Kollision stattfinden w√ºrde, da beide Koordinaten nicht zur√ºckgesetzt werden k√∂nnen. Andernfalls ‚Äûhaftet‚Äú der Spieler einfach an einem Punkt im Raum und kann sich nirgendwo mehr bewegen. Es ist notwendig, ihm Bewegungsfreiheit entlang der Achse zu geben, entlang der die Kollision nicht auftritt.So k√∂nnen Sie ihm die Chance geben, um ein Hindernis herumzufliegen.</font></font><br>
<br>
<pre><code class="javascript hljs">setPersPos: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">camx, camdx</span>) </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">//       (camx,camdx)</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">var</span> persx = ap.game.pers.x;
    <span class="hljs-keyword">var</span> persy = ap.game.pers.y;
    <span class="hljs-keyword">var</span> dx = ap.game.pers.dx;
    <span class="hljs-keyword">var</span> dy = ap.game.pers.dy;<font></font>
<font></font>
    <span class="hljs-comment">// ,     </span>
    <span class="hljs-keyword">var</span> col = ap.collisionDetect(<font></font>
        {<span class="hljs-attr">x</span>: persx, <span class="hljs-attr">y</span>: persy, <span class="hljs-attr">dx</span>: dx, <span class="hljs-attr">dy</span>: dy},<font></font>
        {<span class="hljs-attr">x</span>: camx, <span class="hljs-attr">dx</span>: camdx, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>}<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (col.f == <span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.colx == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//(    ,    )</span><font></font>
            ap.game.pers.x = col.x;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span><font></font>
            ap.game.pers.x = persx + dx;<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.coly == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// -  </span><font></font>
            ap.game.pers.y = col.y;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            ap.game.pers.y = persy + dy;<font></font>
        };<font></font>
<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//  ,   </span><font></font>
        ap.game.pers.x = persx + dx;<font></font>
        ap.game.pers.y = persy + dy;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// </span>
    ap.game.pers.dx = <span class="hljs-number">0</span>;<font></font>
    ap.game.pers.dy = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    ap.oPers.transform.x = ap.game.pers.x;<font></font>
    ap.oPers.transform.y = ap.game.pers.y;<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Kollisionserkennungsfunktion selbst:</font></font><br>
<br>
<pre><code class="javascript hljs">collisionDetect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opers, ow</span>) </span>{
    <span class="hljs-comment">// , opers -   , ow -  </span><font></font>
<font></font>
    <span class="hljs-keyword">var</span> res = {<span class="hljs-attr">f</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">colx</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">coly</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ocoll, x, y, w, h, persx, persy, persx0, persy0, od, colx1, coly1, colx2, coly2;
    <span class="hljs-keyword">var</span> collw = <span class="hljs-literal">false</span>, collh = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//(  ,  "" )</span><font></font>
    persx0 = opers.x + ow.x - ow.dx;<font></font>
    persy0 = opers.y + ow.y;<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    persx = persx0 + opers.dx;<font></font>
    persy = persy0 + opers.dy;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {<font></font>
        od = ap.d.lv[i]; <span class="hljs-comment">//obj data</span><font></font>
<font></font>
        <span class="hljs-comment">//    (   ),</span>
        <span class="hljs-comment">//     </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ap.d.colld[od.n] !== <span class="hljs-string">"undefined"</span>) {<font></font>
<font></font>
            <span class="hljs-comment">//       </span><font></font>
            ocoll = ap.d.colld[od.n];<font></font>
            colx1 = od.x + ocoll.x1;<font></font>
            colx2 = od.x + ocoll.x2;<font></font>
            coly1 = od.y + ocoll.y1;<font></font>
            coly2 = od.y + ocoll.y2;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ((persx &lt; colx1) || (persx &gt; colx2) || (persy &lt; coly1) || (persy &gt; coly2)) {} <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//   </span>
                res.f = <span class="hljs-literal">true</span>;<font></font>
<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persx0 &lt; colx1) || (persx0 &gt; colx2)) {<font></font>
                    collw = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persy0 &lt; coly1) || (persy0 &gt; coly2)) {<font></font>
                    collh = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
<font></font>
            };<font></font>
        };<font></font>
<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
<font></font>
    <span class="hljs-comment">//  ,     ,</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (collw == <span class="hljs-literal">true</span>) {<font></font>
        res.colx = <span class="hljs-literal">true</span>;<font></font>
        res.x = persx0 - ow.x;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.x = opers.x;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">if</span> (collh == <span class="hljs-literal">true</span>) {<font></font>
        res.coly = <span class="hljs-literal">true</span>;<font></font>
        res.y = persy0 + ow.y;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.y = opers.y;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res;<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die Standard-Partikelmaschine Spark AR Studio verwendet, um Regen zu animieren. </font><font style="vertical-align: inherit;">Hier gibt es nichts Besonderes. </font><font style="vertical-align: inherit;">Wir f√ºgen der Szene ein Emtter-Objekt hinzu und vergessen nicht, es nach Emitter -&gt; Space -&gt; Local (anstelle von World) zu fragen. </font><font style="vertical-align: inherit;">Dies soll sicherstellen, dass die Tropfen w√§hrend der Bewegung nicht dynamisch hinter den Wolken zur√ºckbleiben, sondern immer direkt fallen. </font><font style="vertical-align: inherit;">Diese Methode ist bequemer, um den Moment, in dem der Schmetterling in den Regen f√§llt, leichter bestimmen zu k√∂nnen - es ist keine H√∂henkorrektur erforderlich. </font><font style="vertical-align: inherit;">F√ºr die Tropfen selbst habe ich die passende Textur vorbereitet. </font><font style="vertical-align: inherit;">Nun, und nat√ºrlich bewegt sich das Regenobjekt zusammen mit dem Wolkenobjekt. </font><font style="vertical-align: inherit;">Dann habe ich dem Kollisionsbehandlungscode eine Cloud-Trefferbedingung hinzugef√ºgt. </font><font style="vertical-align: inherit;">Und wenn sich in diesem Moment kein Hindernis √ºber dem Spieler befindet, f√§llt der Schmetterling und das Spiel endet.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√§√üigung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr eine erfolgreiche Moderation sollte das obligatorische Video aus dem Spiel keinen statischen Text enthalten, der nicht an Objekte gebunden ist. </font><font style="vertical-align: inherit;">Andernfalls stoppt der Roboter sofort die Moderation. </font><font style="vertical-align: inherit;">Danach √ºberpr√ºft eine Person das Spiel jedoch mehrere Tage lang. </font><font style="vertical-align: inherit;">Und er mochte die F√ºlle an Texten vor und am Ende nicht. </font><font style="vertical-align: inherit;">Ich musste die Textmenge reduzieren. </font><font style="vertical-align: inherit;">Danach wurde das Spiel genehmigt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusammenfassung</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nicht dass mein Spiel besonders aufregend gewesen w√§re. </font><font style="vertical-align: inherit;">Ihr fehlen wahrscheinlich Dynamik und zus√§tzliche Mechanik. </font><font style="vertical-align: inherit;">Ich werde ein Update ver√∂ffentlichen. </font><font style="vertical-align: inherit;">Aber mir wurde klar, dass es interessant ist, Spiele auf Instagram zu machen. </font><font style="vertical-align: inherit;">Dies ist eine Art Herausforderung. </font><font style="vertical-align: inherit;">Ich habe den Prozess des Programmierens und L√∂sens aller Arten von Aufgaben unter Minimalismus in Bezug auf Werkzeuge und die Menge des zugewiesenen Speichers wirklich genossen. </font><font style="vertical-align: inherit;">Ich erinnere mich, dass jemand gesagt hat, dass 640 Kb f√ºr alle ausreichen. </font><font style="vertical-align: inherit;">Versuchen Sie nun, ein 3D-Spiel mit 2 MB zu installieren. </font><font style="vertical-align: inherit;">Ich werde vielleicht nicht argumentieren, dass sie f√ºr alle genug sind ... Aber probieren Sie es aus!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/g7/kr/7fg7kra8uhidburs19pognju5vc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abschlie√üend m√∂chte ich alle nicht offensichtlichen Momente, denen ich begegnet bin, in einer Liste zusammenfassen. </font><font style="vertical-align: inherit;">Vielleicht ist dies f√ºr jemanden als Spickzettel n√ºtzlich, wenn er Spiele f√ºr Instagram erstellt.</font></font><br>
<br>
<i><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rahmen. </font><font style="vertical-align: inherit;">Passen Sie den Ma√üstab aller 3D-Modelle im 3D-Editor so an, dass er sofort 1: 1 auf der B√ºhne des Spiels steht.</font></font></li>
<li>       .              .   ,            .</li>
<li>.          FBX,     .        -.           ,    .</li>
<li>  .  JPG   ,     ,   ,       -,    JPG,    PNG.</li>
<li>   . , ,        .   Spark AR  ,         . , , ,   3D-.</li>
<li>   3D ,    :     ,    .       .             .</li>
<li>,    ,      .   javascript   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Kontext von Spark AR gibt es kein Fensterobjekt und alle Arten von browserspezifischen Objekten wie webkitRequestAnimationFrame, mozRequestAnimationFrame usw. </font><font style="vertical-align: inherit;">Dies ist ein Schicksal beim Programmieren in Javascript-Animationen.</font></font></li>
</ul></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de499962/index.html">Einige Fakten √ºber kaskadierende Klassifikatoren, die in wissenschaftlichen Artikeln selten ernsthaft ber√ºcksichtigt werden.</a></li>
<li><a href="../de499964/index.html">Die NASA hat drei Firmen ausgew√§hlt, die an dem Programm teilnehmen werden, um ein Schiff f√ºr die Landung auf dem Mond zu schaffen</a></li>
<li><a href="../de499968/index.html">Liste der best√§ndigsten Online-Mitaps, die auch im Mai stattfinden</a></li>
<li><a href="../de499970/index.html">Wir untersuchen die Mediastreamer2 VoIP-Engine. Teil 12</a></li>
<li><a href="../de499972/index.html">M√∂gen Online-Events verdauen</a></li>
<li><a href="../de499978/index.html">√úbersetzung von Andrew Un's Buch, Leidenschaft f√ºr maschinelles Lernen, Kapitel 36 und 37</a></li>
<li><a href="../de499982/index.html">Anf√§nger-Tester-Plan: Von "IT eingeben" bis "Ich bin Ingenieur!"</a></li>
<li><a href="../de499986/index.html">Und noch einmal zu Embedded: Suche nach Fehlern im Embox-Projekt</a></li>
<li><a href="../de499988/index.html">Zucker und COVID-19</a></li>
<li><a href="../de499990/index.html">Geokodierung Wie binde ich in 10 Minuten 250.000 Adressen an Koordinaten?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>