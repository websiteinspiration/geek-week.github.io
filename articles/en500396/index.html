<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèº üßëüèª‚Äçü§ù‚Äçüßëüèª üçÄ Problems of autonomous access control systems - Where they did not expect üßëüèª üôåüèø üò´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. I will start with the background about what prompted me to conduct this study, but first I will warn you: all practical actions were ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Problems of autonomous access control systems - Where they did not expect</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500396/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Good day to all. I will start with the background about what prompted me to conduct this study, but first I will warn you: all practical actions were performed with the consent of the governing structures. Any attempt to use this material in order to enter a closed territory without the right to be there is a criminal offense. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It all started with the fact that when I was cleaning the table, I accidentally put the RFID key to the entrance to the NFC-reader ACR122 - what was my surprise when Windows played the sound of detecting a new device, and the LED turned green. Until now, I believed that these keys work exclusively in the Proximity standard.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/7t/yr/ly7tyrpzkzrzju1c25dwlmxyhts.jpeg" alt="image"></div><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 But once the reader saw it, it means the key meets one of the protocols on top of the ISO 14443 standard (It is Near Field Communication, 13.56 MHz). Cleaning was immediately forgotten, since I saw the opportunity to completely get rid of the keychain, and save the key to the entrance to the phone (the apartment has long been equipped with an electronic lock). Sowing the study, I found out that under the plastic is the NFC tag Mifare 1k - the same model as in the badges, badges of enterprises, transport cards, etc. Attempts to get into the contents of the sectors at first did not bring success, but when the key was still able to be cracked, it turned out that only the 3rd sector was used, and the UID of the chip itself was duplicated in it. It looked too simple, and it turned out and there would be no article if everything went exactly as intended. So I got the key offal, and there are no problems,if you need to copy the key to another one. But the task was to transfer the key to a mobile device, which I did. This is where the fun began - we have a phone -</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iPhone SE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS 13.4.5 Beta build 17F5044d installed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and some custom components for NFC free work - I won‚Äôt dwell on this for some objective reasons. </font><font style="vertical-align: inherit;">If desired, all of the following applies to the Android system, but with some simplifications. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The list of tasks to solve:</font></font></b><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get access to the contents of the key.</font></font></b></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implement the ability to emulate a key device.</font></font></b></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 If the first was relatively simple, then the second had problems. The first version of the emulator did not work. The problem was quickly detected - for mobile devices (iOS, Android) in emulation mode - the UID is dynamic and regardless of what is wired in the image, it floats. The second version (run as superuser) rigidly fixed the serial number on the selected one - the door opened. However, I wanted to do everything perfectly, and in the end I put together a complete version of the emulator that could open Mifare dumps and emulate them. Yielding to a sudden impulse, I changed the keys of the sectors to arbitrary, and tried to open the door. And she ... </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OPENED!</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After a while, I realized that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doors with this lock, even those to which the original key did not fit. </font><font style="vertical-align: inherit;">In this regard, I formed a new list of tasks to perform:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Find out what controller is responsible for working with keys</font></font></b> </li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Understand if there is a network connection and a common base</font></font></b> </li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Find out why a virtually unreadable key becomes universal</font></font></b> </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After talking with the engineer of the management company, I found out that simple Iron Logic z5r controllers are used without connecting to an external network.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CP-Z2 MF reader and IronLogic z5r controller</font></font></b>
                        <div class="spoiler_text">      :<br>
<br>
<img src="https://habrastorage.org/webt/tu/-t/c9/tu-tc9uc7txys8sxcyrwxgy0niu.jpeg" alt="image"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As it is clear from here - the system is completely autonomous and extremely primitive. </font><font style="vertical-align: inherit;">At first I thought that the controller is in the learning mode - the meaning is that it reads the key, stores it in the memory and opens the door - this mode is used when you need to record all the keys, for example, when replacing the lock in an apartment building. </font><font style="vertical-align: inherit;">But this theory was not confirmed - this mode is turned off by software, the jumper is in the working position - and nevertheless, when we bring the device up, we see the following:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Screenshot of the emulation process on the device</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/fr/sw/fn/frswfn3yvw-xmuv9qr2qdnlml5y.jpeg" alt="image"><br>
‚Ä¶        .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So the problem lies in the software of either the controller or the reader. </font><font style="vertical-align: inherit;">Let's check the reader - it works in iButton mode, so we will connect the Bolid security board - we will have the opportunity to see the output from the reader.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The board will later be connected via RS232</font></font></b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/webt/15/_m/xk/15_mxkazcejs0gbucc_zjofmpsy.jpeg" alt="image"><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Using the method of multiple tests, we find out that the reader broadcasts the same code with in case of authorization failure: 1219191919 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The situation begins to clear up, but at the moment I do not understand why the controller responds positively to this code. There is an assumption - that when they filled the base - accidentally or specially brought up a card with other sector keys - the reader sent this code and the controller saved it. Unfortunately, I do not have a proprietary programmer from IronLogic to look into the controller key database, but I hope I managed to draw attention to the fact that the problem exists. A video demonstration of working with this vulnerability is available </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Against the theory with a random addition is the fact that in the same business center in Krasnoyarsk I also managed to open the door by the same method.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en500380/index.html">Processing personal data remotely: risks and possible consequences</a></li>
<li><a href="../en500382/index.html">Aviasales API integration with Amazon Kinesis and serverless simplicity</a></li>
<li><a href="../en500384/index.html">Pixar Studio Pioneers Received Turing Award and $ 1 Million</a></li>
<li><a href="../en500386/index.html">Adapting your existing business solution for SwiftUI. Part 2</a></li>
<li><a href="../en500390/index.html">Actual models of linguistic localization in the field of IT and digital communications. Part 1</a></li>
<li><a href="../en500398/index.html">Remote Marathon Week 3: Inoperative Processes</a></li>
<li><a href="../en500400/index.html">Trimming Threads: Migrating from Puppet Enterprise to Ansible Tower. Part 1</a></li>
<li><a href="../en500402/index.html">[Part 1/2] Guide to FFmpeg and SDL or How to write a video player in less than 1000 lines</a></li>
<li><a href="../en500404/index.html">How to make friends Electron and Webix. Part 2. Create an application with your View</a></li>
<li><a href="../en500406/index.html">The Story of the First Paralysis of the Internet: The Curse of the Busy Signal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>