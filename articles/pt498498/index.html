<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õàÔ∏è üö™ ü§≥üèΩ Investiga√ß√£o: o que √© maior do que as prioridades de thread no Windows? üçΩÔ∏è ‚úäüèΩ ‚ö±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Essa investiga√ß√£o, como muitas outras, come√ßou com o fato de eu estar fazendo meu pr√≥prio neg√≥cio, sem tentar procurar problemas para mim. Desta vez, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Investiga√ß√£o: o que √© maior do que as prioridades de thread no Windows?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498498/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa investiga√ß√£o, como muitas outras, come√ßou com o fato de eu estar fazendo meu pr√≥prio neg√≥cio, sem tentar procurar problemas para mim. Desta vez, tudo o que fiz foi abrir a tampa do laptop e tentar fazer login no sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelas primeiras vezes, quando isso resultou em um atraso de vinte segundos, eu ignorei o problema, esperando que ele se resolvesse. Nas pr√≥ximas vezes, pensei na investiga√ß√£o, mas os problemas de desempenho que surgem mesmo antes de voc√™ fazer login s√£o mais dif√≠ceis de resolver e eu fiquei com pregui√ßa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando notei que estava evitando fechar o laptop porque tinha medo desses atrasos muito frequentes, percebi que era hora de fazer isso com seriedade. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Felizmente, recentemente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">corrigi</font></a><font style="vertical-align: inherit;"> o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">rastreamento do</font></a><font style="vertical-align: inherit;"> buffer de anel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIforETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tornando-o confi√°vel, iniciei e comecei a aguardar o pr√≥ximo evento de atraso. N√£o tive que esperar muito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Levei v√°rias vezes para obter o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rastreamento ETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> completamente bem comigo </font><font style="vertical-align: inherit;">. E como esse territ√≥rio n√£o me era familiar, levou algum tempo para descobrir o que estava acontecendo. Ainda n√£o entendi completamente o problema, mas 90% entenderam os motivos de sua ocorr√™ncia. Consegui aprender muito, incluindo alguns novos detalhes sobre o agendador do Windows, e tamb√©m encontrei uma solu√ß√£o absolutamente eficaz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O rastreamento ideal que eu gravei ao carregar no Microsoft Windows Performance Analyzer (WPA) se parece com o seguinte:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/349/031/72d/34903172d4e4c5f85b33a02255942315.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos padr√£o, janelas em foco e uso da CPU.Esta</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tabela e dois gr√°ficos cont√™m uma tonelada de informa√ß√µes. A tabela superior ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos gen√©ricos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) mostra as teclas gravadas no UIforETW. Tentei pressionar uma tecla (c√≥digo de chave virtual 162) uma vez por segundo at√© que um campo de entrada de senha fosse exibido. Como essas 17 teclas s√£o selecionadas, no gr√°fico abaixo, s√£o mostradas com linhas azuis verticais para visualiza√ß√£o simplificada do tempo de execu√ß√£o de eventos cr√≠ticos. O eixo x representa o tempo em segundos.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As barras horizontais no gr√°fico superior ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Janela em foco</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) mostram qual processo foi focado durante esse per√≠odo. </font><font style="vertical-align: inherit;">Existem seis processos diferentes no total. </font><font style="vertical-align: inherit;">O per√≠odo de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rastreamento</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o curto per√≠odo de tempo em que o laptop foi fechado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O gr√°fico inferior mostra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o uso da CPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As informa√ß√µes s√£o obtidas dos dados de troca de contexto, portanto, devem ser completamente precisas e completas. </font><font style="vertical-align: inherit;">Nesse rastreamento, um valor de 100% indica o momento em que todos os oito processadores l√≥gicos do meu notebook de oito threads e quatro n√∫cleos foram usados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de receber os dados de rastreamento, tive que descobrir o que meu laptop faz secretamente quando a tampa √© fechada e at√© o momento em que volto ao sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tempestade antes da calmaria</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como podemos ver, o laptop no in√≠cio do rastreamento √© relativamente simples, como deveria ser. Ent√£o eu fechei a tampa. Isso parece ter causado um pico na atividade da CPU e uma mudan√ßa no foco do Windows. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A janela no Focus</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mudou de UIforETW para Idle, depois para csrss, novamente para Idle, para LogonUI e depois para Idle. Quem teria pensado?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante esse intervalo, o laptop executou aproximadamente 17 segundos de processamento da CPU de v√°rios tipos. Parte disso √© o trabalho necess√°rio para desligar. Parte - s√£o programas (incluindo ferramentas internas do Google) registradas no Agendador de tarefas para a execu√ß√£o de "Quando um usu√°rio bloqueia uma esta√ß√£o de trabalho" - faz sentido. Eu at√© notei que o trabalho est√° sendo feito para criar elementos de interface do usu√°rio para efetuar login quando o usu√°rio continuar trabalhando - voc√™ precisa estar preparado com anteced√™ncia, certo?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
17 segundos de CPU - muito tempo para o laptop dormir. </font><font style="vertical-align: inherit;">Mesmo no meu laptop com quatro n√∫cleos e oito threads, o processo leva mais de quatro segundos. </font><font style="vertical-align: inherit;">No meu laptop em casa, s√£o necess√°rios mais de 13 segundos de tempo da CPU para adormecer e quase todos eles s√£o usados ‚Äã‚Äãno c√≥digo do Windows. </font><font style="vertical-align: inherit;">O </font><font style="vertical-align: inherit;">servi√ßo de pol√≠tica de diagn√≥stico </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">realmente</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> precisa executar algumas SruDbTableSearches antes que o laptop possa descansar? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu acho que esse trabalho excessivo ao dormir </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><em><font style="vertical-align: inherit;">um</font></em><font style="vertical-align: inherit;"> problema, mas esse n√£o √© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problema que estou procurando. </font><font style="vertical-align: inherit;">Ent√£o eu apenas decidi dar as costas para ela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E s√≥ muito mais tarde eu percebi que foi durante esse per√≠odo que os gr√£os de destrui√ß√£o do meu inseto foram lan√ßados ...</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dormir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de bloquear o laptop, n√£o h√° atividade da CPU. </font><font style="vertical-align: inherit;">Nesse teste em particular, o laptop ficou bloqueado por cerca de 16 segundos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despertar convulsivo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A atividade da CPU ap√≥s a transi√ß√£o para suspens√£o √© incompar√°vel quando ela come√ßou a despertar. </font><font style="vertical-align: inherit;">Durante esse per√≠odo, meu laptop sobrecarregado levou cerca de 172 segundos de tempo de CPU (!!!) por 22,6 segundos. </font><font style="vertical-align: inherit;">Isto √© muito trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos mist√©rios desse processo √© a queda no uso da CPU para quase zero cerca de um segundo ap√≥s a explos√£o inicial de atividade. </font><font style="vertical-align: inherit;">Esse curto per√≠odo de inatividade parece bastante anormal, dado o caos ao seu redor. </font><font style="vertical-align: inherit;">Mas acho que esse recurso n√£o est√° relacionado ao problema, por isso n√£o prestei aten√ß√£o nele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro mist√©rio √© por </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que tantos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programas ganham vida ap√≥s essa breve pausa. √â engra√ßado que o intruso mais s√©rio respons√°vel por 31,6 dos 172 segundos da CPU foi o Windows Performance Analyzer (WPA) - o pr√≥prio programa que eu uso para analisar rastreamentos. As tr√™s c√≥pias que eu deixei em execu√ß√£o est√£o trabalhando duro para renderizar minha interface do usu√°rio, mesmo que ainda n√£o esteja vis√≠vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, ocorrem padr√µes escuros ao tentar inicializar dispositivos laptop. KeStallExecutionProcessor √© um loop de espera, e era estranho ver que essa √© a fun√ß√£o mais execut√°vel de todo o sistema. Um segundo ciclo de espera √≠mpar √© a √∫nica maneira de iniciar o equipamento? </font><font style="vertical-align: inherit;">√â </font><font style="vertical-align: inherit;">realmente necess√°rio gastar 700 ms de tempo de CPU inicializando o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mouse e o teclado</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? A Microsoft e a Intel devem ignorar a recomenda√ß√£o da Microsoft sobre</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um m√°ximo de 50 microssegundos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa7/c4e/cf4/fa7c4ecf4fe56c7c9014ee252f4557b0.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drivers de um ciclo de espera. </font><font style="vertical-align: inherit;">O i8042prt.sys foi escrito pela Microsoft. </font><font style="vertical-align: inherit;">Os dois a seguir s√£o criados pela Intel. </font></font></i> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muitos</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> programas est√£o </font><font style="vertical-align: inherit;">sendo executados ativamente durante esse per√≠odo </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A maioria deles parece estar enfrentando o mesmo problema que o WPA - eles est√£o desesperados para desenhar pixels em uma tela oculta, e isso alude a um bug do Windows. </font><font style="vertical-align: inherit;">Mas mesmo sem esse bug, o explorer.exe e outros programas buscam ativamente </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para fazer. </font><font style="vertical-align: inherit;">Mas, no final, embora esse uso excessivo da CPU seja uma </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parte</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necess√°ria </font><em><font style="vertical-align: inherit;">do</font></em><font style="vertical-align: inherit;"> problema, n√£o √© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> problema em </font><em><font style="vertical-align: inherit;">si</font></em><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ent√£o, novamente, parei de prestar aten√ß√£o nela.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foco</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao analisar rastreamentos, √© importante descobrir quando a√ß√µes importantes ocorrem. A principal evid√™ncia foram os eventos de entrada, porque parei de clicar no controle depois que o formul√°rio de entrada da senha apareceu. Aqui est√£o os tr√™s √∫ltimos pressionamentos de tecla da tecla Control de forma aproximada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gr√°fico </font><em><font style="vertical-align: inherit;">Window in Focus</font></em><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/158/50d/6f9/15850d6f9eecb243c2984cd4988c6bb1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que os eventos cr√≠ticos est√£o recebendo o foco do LockApp.exe, ap√≥s o qual o LogonUI.exe fica quase instantaneamente. </font><font style="vertical-align: inherit;">Presumivelmente, digitei a senha no LogonUI.exe (√© conveniente que o rastreamento n√£o interceptasse os eventos do teclado), ap√≥s o qual o foco mudou brevemente para o explorer e, em seguida, para o UIforETW, a partir do qual iniciei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m parece que o LogonUI.exe n√£o pode obter o foco antes do LockApp.exe - esse padr√£o se repete em todos os rastreamentos que estudei. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, depois de mais de mil palavras dedicadas √† solu√ß√£o desse enigma, finalmente temos uma pergunta clara que podemos investigar: por que o LockApp.exe fica em foco depois de sair do tempo de inatividade, leva vinte segundos?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos uma pergunta? </font><font style="vertical-align: inherit;">√ìtimo, vamos responder</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando dados de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uso da CPU (precisos)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> obtidos com a troca de conte√∫do, </font><font style="vertical-align: inherit;">descobri rapidamente que, em vinte segundos depois de ativar o LockApp.exe, havia recebido menos de um milissegundo de tempo de CPU e por mais de 14 segundos (de 35,158 a 49,827 s) n√£o funcionou. geralmente:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f50/5dc/954/f505dc954915bdbf5a857eac5c4303f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LockApp n√£o funciona por um longo tempo</font></font></i><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A documenta√ß√£o sobre o significado das colunas nas tabelas Uso da CPU (Preciso) est√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se um processo ou encadeamento n√£o estiver em execu√ß√£o h√° algum tempo, e voc√™ quiser descobrir o motivo, geralmente dicas importantes podem ser encontradas na primeira altern√¢ncia de contexto ap√≥s uma longa pausa, ou seja, alternar para 49,827 segundos de rastreamento. </font><font style="vertical-align: inherit;">Reordenei as colunas para mostrar mais dados dessa op√ß√£o de contexto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f4/23d/7ca/7f423d7cad82b87f4c5556551b0e8fec.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LockApp est√° preparado, mas n√£o √© executado. Estranho ...</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Contagem, igual a 1 significa que examinamos os dados para uma √∫nica altern√¢ncia de contexto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tempo desde o √∫ltimo, igual a 38,2 milh√µes de microssegundos, significa que esse encadeamento n√£o ser√° executado em 38,2 segundos. Isso por si s√≥ n√£o √© bom nem ruim. Fluxos ociosos economizam energia e, no final, o laptop estava em sonho por algum tempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O tempo de troca simplesmente nos diz quando exatamente o segmento se encaixa na CPU - quando o contexto muda para esse segmento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora vamos para a coluna Pronto. Ele nos diz quanto tempo o thread ficou </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pronto</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ser executado, mas n√£o foi executado. Em outras palavras, esse segmento estava </font><font style="vertical-align: inherit;">esperando por </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (travar, manipular) e isso </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© algo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi liberado ou iniciado, mas o encadeamento ainda </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o foi executado</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por 19,493 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para entender melhor a coluna </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pronto (nos)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , voc√™ pode dar uma olhada na coluna </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pronto (s)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ele nos diz quando o fluxo est√° preparado. Vemos que, durante 30.333 segundos de rastreamento, esse encadeamento foi preparado para execu√ß√£o, mas n√£o foi executado at√© 49.827 segundos. Isso parece ser importante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse arranjo de colunas nos mostra a mesma op√ß√£o de contexto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07f/b5c/c85/07fb5cc85d3dfc066a6c3cbd508ef7d7.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nova pilha de</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
encadeamentos </font><i><font style="vertical-align: inherit;">e pilha de</font></i><font style="vertical-align: inherit;"> encadeamentos </font><i><font style="vertical-align: inherit;">prontos</font></i><font style="vertical-align: inherit;"> Portanto, esse encadeamento (que o New Thread Stack esperava que o NtWaitForWorkViaWorkerFactory mostrasse) foi solicitado a acordar (o processo do sistema chamando KeSetEvent) logo ap√≥s abrir a tampa do notebook por 30.333 segundos de rastreamento. </font><font style="vertical-align: inherit;">Mas come√ßou n√£o naquela √©poca (o que seria ‚Äúbom‚Äù), mas depois de 19.494 s, e isso √© ruim. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Normalmente, ao conduzir essa an√°lise de expectativas, passo muito tempo descobrindo por que o fluxo est√° aguardando e o que fez com que ele n√£o estivesse pronto. </font><font style="vertical-align: inherit;">Mas foi a primeira vez que fiz uma an√°lise das expectativas, na qual isso n√£o era importante, e a pergunta era por que esse thread pronto n√£o √© executado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Casos ...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria das pessoas n√£o gasta muito tempo estudando tra√ßos ETW, portanto, √© necess√°ria uma explica√ß√£o aqui. </font><font style="vertical-align: inherit;">Isso √© </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muito</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estranho. </font><font style="vertical-align: inherit;">Se o encadeamento estiver pronto, ele geralmente inicia instantaneamente ou ap√≥s alguns milissegundos. </font><font style="vertical-align: inherit;">A disponibilidade do fluxo, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como o nome indica</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , significa que o fluxo est√° pronto para execu√ß√£o e quase nada pode interferir nele. </font><font style="vertical-align: inherit;">Mas vamos descobrir o que pode impedir a execu√ß√£o de um encadeamento conclu√≠do.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linha priorit√°ria</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No come√ßo, sugeri que este √© um caso simples de "fome" da CPU. Dezenas de processos exigem tempo de CPU e, por isso, o LockApp n√£o obt√©m o caminho certo at√© que a carga diminua. No entanto, essa teoria </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corresponde </font><em><font style="vertical-align: inherit;">exatamente</font></em><font style="vertical-align: inherit;"> aos sintomas, porque o processo LockApp pode demorar cerca de 18 segundos, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesmo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sem o tempo de CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A teoria da fome da CPU √© boa porque √© verific√°vel. Consegui aumentar a prioridade do processo LockApp usando o Gerenciador de Tarefas (durante um dos breves per√≠odos em que n√£o foi suspenso pelo sistema UWP); portanto, no rastreio final que usei para este post, o LockApp foi executado com alta prioridade. Um encadeamento regular do Windows √© executado com uma prioridade de 8 a 10. A prioridade mais alta com a qual um encadeamento regular do Windows (n√£o em tempo real) pode ser executado √© 15. Meus rastreamentos de ETW mostraram que o LockApp sempre trabalhava com a prioridade 13 ou superior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° uma linha do tempo da CPU para 19.494 segundos cr√≠ticos, agrupados e coloridos pela prioridade do segmento ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novo no Pri</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a prioridade atual que foi atribu√≠da ao encadeamento). </font><font style="vertical-align: inherit;">Vemos que os threads com prioridades 4, 8, 9 e 10 consomem a grande maioria do tempo da CPU, especialmente no final:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81b/7d5/431/81b7d5431d0a307a93d2250fec9f2b1c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando CPU por prioridade</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqui est√° outra imagem com threads ocultos com prioridades de 0 a 12. </font><font style="vertical-align: inherit;">Cada vez que o gr√°fico cai abaixo de 12,5% (o que significa um processador l√≥gico do tempo de CPU do meu notebook de oito threads), o LockApp </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deve</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser iniciado e torna-se absolutamente inacredit√°vel que a prioridade impe√ßa a execu√ß√£o com tanta frequ√™ncia quando muitos threads com prioridade menor ou igual consiga uma tonelada de tempo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ec/c2c/66b/2ecc2c66b4df4902a3c5be388596524f.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso priorit√°rio da CPU, apenas threads de alta prioridade</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar invers√£o de prioridade</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Especula-se que os algoritmos de invers√£o de prioridade do Windows sejam t√£o prop√≠cios a outros threads que o LockApp.exe seja bloqueado. </font><font style="vertical-align: inherit;">Mas como os gr√°ficos mostrados acima demonstram que verdadeiras prioridades s√£o usadas nas decis√µes de planejamento, essa suposi√ß√£o (sempre n√£o convincente) ter√° que ser abandonada.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descarga do n√∫cleo da pilha</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando falei sobre esse quebra-cabe√ßa no Twitter, um dos comentaristas sugeriu que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a pilha do n√∫cleo do thread estava descarregada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Eu n√£o estava familiarizado com essa situa√ß√£o, mas ap√≥s as explica√ß√µes de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John Werth</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ele entende em seu campo), </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desliguei a troca da pilha do kernel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e reiniciei o computador. </font><font style="vertical-align: inherit;">Nada mudou. </font><font style="vertical-align: inherit;">De fato, n√£o achei que isso ajudaria, pois tenho 32 GB de mem√≥ria e o problema ocorre repetidamente e com frequ√™ncia; </font><font style="vertical-align: inherit;">mas era melhor ter certeza disso.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pausar processo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o LockApp √© um aplicativo UWP moderno, est√° sujeito a restri√ß√µes semelhantes √†s dos aplicativos para smartphones. Entre outras coisas, isso significa que ele pode ser suspenso quando n√£o estiver em primeiro plano e, em seguida, "descongelar" quando retornado ao primeiro plano. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">James Forshaw</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prop√¥s a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grava√ß√£o do ETW Microsoft-Windows-Kernel-Process</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obter dados sobre isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os eventos s√£o projetados para causar confus√£o m√°xima. O nome da tarefa </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Freeze √©</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usado para ‚Äúdegelo‚Äù e ‚Äúcongelamento‚Äù, e a vers√£o do evento </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win: Stop</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> significa que o processo est√° sendo iniciado (parou de congelar) e a vers√£o do </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win: Start</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">significa que o processo para (come√ßa a congelar). Tudo isso √© extremamente l√≥gico, mas muito confuso. Se os nomes dos eventos fossem divididos em Congelar e Descongelar, haveria menos confus√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o h√° documenta√ß√£o para esses eventos, mas, gra√ßas √† an√°lise, determinei que esses eventos s√£o sempre criados pelo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servi√ßo de Infraestrutura de Tarefas em Segundo Plano / Broker</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O nome e o ID do processo correspondente s√£o indicados no campo FrozenProcessID.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e04/32f/424/e0432f42442fa30ad0f7e6ed77f8d1c2.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos ProcessFreeze (tamb√©m usado para degelo) Foi</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
interessante investigar esse provedor - ele tem muitos eventos promissores - mas, no final, descobriu-se que o LockApp n√£o parou ou descongelou durante o rastreamento. </font><font style="vertical-align: inherit;">No entanto, esse provedor parecia bastante √∫til, ent√£o eu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifiquei o UIforETW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que as vers√µes futuras sempre o </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">anotassem</font></a><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J√° descartamos tudo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nenhuma das teorias descritas acima me pareceu muito prov√°vel, e agora todas as exclu√≠mos. </font><font style="vertical-align: inherit;">Comecei a procurar ajuda e pedi que me desse id√©ias de um amigo da Microsoft. </font><font style="vertical-align: inherit;">E, naquele momento, descobri que a prioridade de fluxo de 0 a 31, t√£o conhecida no Windows, na verdade √© apenas cinco bits de baixa prioridade de um </font><font style="vertical-align: inherit;">sistema de prioridade </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">total</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso da posi√ß√£o oficial</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aconteceu que minha ignor√¢ncia foi minha pr√≥pria culpa. </font><font style="vertical-align: inherit;">Se eu ler atentamente todas as 108 p√°ginas da se√ß√£o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Threads</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Internals, 7¬™ Edi√ß√£o, Parte 1</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , entenderia o que estava acontecendo. </font><font style="vertical-align: inherit;">Se voc√™ quiser avan√ßar, esse t√≥pico ser√° revelado nas p√°ginas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">287 a 295</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse campo de super prioridade que eu n√£o conhecia se chama </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele aparece no WPA como uma coluna oculta padr√£o (para encontr√°-lo, voc√™ precisa abrir o View Editor) chamado </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewThreadRank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ao planejar encadeamentos, a Classifica√ß√£o do Encadeamento tem prioridade sobre a prioridade. </font><font style="vertical-align: inherit;">Quase todos os fluxos t√™m classifica√ß√£o 0, e um fluxo com classifica√ß√£o 0 sempre tem uma prioridade mais alta do que um fluxo com classifica√ß√£o 2. Incluindo uma coluna</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewThreadRank</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e olhando para o lado esquerdo da tabela, podemos ver imediatamente o problema:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/745/f0e/374745f0eeaee797c6a8472f62d5b3f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A classifica√ß√£o √© mais importante que a prioridade.Os</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
fluxos do LockApp.exe possuem a Classifica√ß√£o 2, o que significa que, apesar da prioridade 14, eles t√™m a menor prioridade no sistema.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma explica√ß√£o quase completa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde que os threads do LockApp.exe possuem o Rank 2, eles s√≥ podem ser executados quando </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nenhum</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos threads do Rank 0 "desejar" executar. </font><font style="vertical-align: inherit;">Como muitos aplicativos (por raz√µes desconhecidas) ativamente renderizam suas telas invis√≠veis, eles lutam por cada migalha de tempo da CPU, n√£o deixando nada para classifica√ß√µes mais altas. </font><font style="vertical-align: inherit;">Depois que o LockApp.exe recebe uma pequena fra√ß√£o do tempo da CPU, ele passa rapidamente para o Rank 0 (e a carga da CPU cai), ap√≥s o que o processo de login √© realizado da maneira usual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tendo aprendido essas informa√ß√µes, comecei a estudar como a classifica√ß√£o do LockApp muda com o tempo. Nos √∫ltimos segundos antes de dormir, o LockApp mudou repentinamente da classifica√ß√£o 0 para 2. A classifica√ß√£o foi projetada para impedir que a CPU ocupe muito tempo, como quando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Photos est√° muito interessado no processamento indesejado de segundo plano</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e faz a transi√ß√£o do rank 2 ao 19:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbc/b93/e8b/cbcb93e8bc2145f78e5ea10edba3fa8e.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft.Photos diminui a classifica√ß√£o</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Na documenta√ß√£o, voc√™ pode entender que o principal objetivo da classifica√ß√£o do fluxo √© o compartilhamento justo do tempo da CPU entre as sess√µes na m√°quina, para que os processos de um usu√°rio n√£o prejudiquem outros. Ambas as op√ß√µes para usar a classifica√ß√£o deixam claro que a classifica√ß√£o do fluxo deve aumentar apenas se consumir muito tempo da CPU e, quando o laptop entrou no modo de espera, o LockApp.exe usou apenas 79,3 ms do tempo da CPU e o restante do sistema - 17 a partir do tempo da CPU . No entanto, o sistema operacional, por algum motivo, decidiu fazer o downgrade do LockApp para 2 no processo de suspens√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O SO altera a classifica√ß√£o do fluxo apenas se pertencer ao "grupo de planejamento" ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KSCHEDULING_GROUP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e a maioria dos threads em uma instala√ß√£o t√≠pica do Windows n√£o s√£o membros. </font><font style="vertical-align: inherit;">Consequentemente, a maioria dos encadeamentos n√£o est√° sujeita a altera√ß√µes na classifica√ß√£o, portanto, eles podem gastar o tempo da CPU da maneira que desejam.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puzzles restantes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, ainda n√£o est√° claro por que o LockApp.exe cai para o Rank 2. antes de ativar o modo de suspens√£o.Eu assumirei que o LockApp est√° no grupo de planejamento e provavelmente um dos algoritmos se comporta incorretamente. Mas n√£o consegui encontrar uma API para investigar isso, e o tempo estava se esgotando. Se voc√™ conhece algum detalhe, escreva nos coment√°rios do artigo original. O pr√≥prio princ√≠pio de usar a classifica√ß√£o como o componente mais importante nas decis√µes de planejamento deve, parece-me, quebrar-se inevitavelmente se a maioria dos processos no sistema n√£o estiver envolvida nele - os segmentos nos grupos de planejamento sempre correm o risco de ficar sem os recursos necess√°rios. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DFSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Planejamento de Aloca√ß√£o de Recursos Din√¢micos</font></a><font style="vertical-align: inherit;"> ) est√° fadado a falhar se a maioria dos encadeamentos n√£o estiver envolvida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, n√£o sei por que tantos aplicativos permanecem ativos depois de dormir. Isso geralmente √© explicado pelo fato de que "muitos temporizadores terminam quando o laptop est√° no modo de suspens√£o por v√°rias horas", mas essa explica√ß√£o n√£o √© adequada se o laptop estiver em um sonho por apenas alguns segundos, e o comportamento de renderiza√ß√£o WPA indicar que algo acontece no sistema de janelas algo errado. Acrescente a isso aplicativos de mau comportamento e drivers de ciclo de espera, e tudo √© empilhado ao longo do tempo pela CPU.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O fato de as tempestades de CPU diminu√≠rem e o LockApp iniciar ao mesmo tempo leva a uma explica√ß√£o √≥bvia: o LockApp s√≥ pode funcionar quando a demanda da CPU diminui. </font><font style="vertical-align: inherit;">Mas h√° uma explica√ß√£o igualmente convincente: assim que o LockApp obt√©m a capacidade de executar (ou, possivelmente, o LogonUI obt√©m), a demanda da CPU diminui. </font><font style="vertical-align: inherit;">Ambas as explica√ß√µes funcionam, mas acho que a segunda √© mais plaus√≠vel, porque, caso contr√°rio, n√£o podemos explicar por que a renderiza√ß√£o aparentemente intermin√°vel do WPA para de repente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solu√ß√£o para o problema</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim que percebi que o LockApp.exe √© um aplicativo separado que tem problemas de inicializa√ß√£o e que aumentar sua prioridade n√£o ajuda, eu o desativei. </font><font style="vertical-align: inherit;">O arquivo DisableLockScreen.reg me ajudou com isso:</font></font><br>
<br>
<blockquote>Windows Registry Editor Version 5.00<br>
[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Personalization]<br>
‚ÄúNoLockScreen‚Äù=dword:00000001</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao desligar a tela de bloqueio, o laptop acorda imediatamente ap√≥s abrir a tampa. </font><font style="vertical-align: inherit;">N√£o notei freadas ou tempestades da CPU e agora √© preciso um passo a menos para entrar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primeira postagem do twitter que publiquei</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quando encontrei o problema cont√©m uma linha do tempo para uma investiga√ß√£o que pode ser √∫til para algu√©m. </font><font style="vertical-align: inherit;">Al√©m disso, muitas pessoas inteligentes do twitter chegaram ao post, gra√ßas a elas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voltei ao artigo, descobri que, depois de ligar novamente a tela de bloqueio, o problema desapareceu. </font><font style="vertical-align: inherit;">Uma reinicializa√ß√£o simples n√£o foi corrigida - em fevereiro, reiniciei v√°rias vezes, mas provavelmente n√£o saberemos por que ela foi perdida.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discuss√µes</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / programa√ß√£o</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r / Windows10</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Not√≠cias de hackers</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498486/index.html">Como expandir a sem√¢ntica em ingl√™s para publicidade em pesquisas em um nicho estreito</a></li>
<li><a href="../pt498490/index.html">Um sistema de certifica√ß√£o eficaz que permitir√° que voc√™ se torne um l√≠der melhor</a></li>
<li><a href="../pt498492/index.html">Querida, matamos a burocracia: como a digitaliza√ß√£o est√° mudando o di√°logo entre fornecedores e X5</a></li>
<li><a href="../pt498494/index.html">JEP 360: Tipos Selados (Visualiza√ß√£o)</a></li>
<li><a href="../pt498496/index.html">An√∫ncio do mitap on-line PiterJS # 46: desempenho, componentes complexos da interface do usu√°rio e CSS-in-TS</a></li>
<li><a href="../pt498500/index.html">O que ver em quarentena? Uma sele√ß√£o de materiais da Technostream (parte 1)</a></li>
<li><a href="../pt498504/index.html">Sauda√ß√µes de ano novo e COVID-19: como os hackers usam as not√≠cias</a></li>
<li><a href="../pt498510/index.html">X. Uma vis√£o geral da vers√£o em caixa da telefonia e da conex√£o com um site remoto</a></li>
<li><a href="../pt498512/index.html">Combate a engarrafamentos em uma cidade pequena por um pequeno or√ßamento: resultados de 6 meses do projeto</a></li>
<li><a href="../pt498516/index.html">Carteiro - M√©tricas do AutoMetrica no AppMetrica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>