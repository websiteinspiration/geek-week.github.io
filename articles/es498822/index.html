<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèª ‚ôëÔ∏è üë®üèº‚Äçüöí Desarrollo y creaci√≥n desde cero de una m√°quina arcade para cuatro jugadores. üõåüèæ ü§õ ü•£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En noviembre de 2019, dej√© mi trabajo y decid√≠ dedicar varios meses a aprender una nueva habilidad que siempre hab√≠a querido aprender. En ese momento ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Desarrollo y creaci√≥n desde cero de una m√°quina arcade para cuatro jugadores.</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498822/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a6/10f/ede/6a610fede3bc45535fdcd0b8b3d6a9d7.jpg" alt="imagen"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En noviembre de 2019, dej√© mi trabajo y decid√≠ dedicar varios meses a aprender una nueva habilidad que siempre hab√≠a querido aprender. En ese momento trabajaba como desarrollador web. Antes de eso, estudi√© desarrollo de software. E incluso antes, cuando era ni√±o, experimentaba constantemente con electr√≥nica y programas. Por lo tanto, me sent√≠ lo suficientemente seguro en la creaci√≥n de software. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, siempre hubo una cosa m√°gica llamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"hierro"</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que uso a diario, pero no tengo idea de c√≥mo funciona realmente. Un desarrollador de software (y especialmente un desarrollador web) no necesita comprender el hardware. Dado que todo el c√≥digo de desarrollo web es de muy alto nivel, rara vez resulta que el problema con nuestro software est√° relacionado con el hardware.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, nunca trabaj√© en "hierro" y no ten√≠a ning√∫n conocimiento general sobre ingenier√≠a el√©ctrica, excepto los que nos dieron en la escuela secundaria. Y quer√≠a cambiar esta situaci√≥n. Me puse una meta absurda, que en ese momento parec√≠a muy lejos de mi conocimiento. Y luego ... empec√© a experimentar. Planeaba comprobar hasta d√≥nde pod√≠a llegar antes de que me quedara sin motivaci√≥n. No esperaba lograr mi objetivo, pero de alguna manera lo logr√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√° mi resultado:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/npsSCkFGR0g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi incre√≠ble objetivo era crear una consola de juegos arcade para cuatro jugadores desde cero. Utiliza un microcontrolador como cerebro y una tira de LED como pantalla. Usando un joystick y cuatro botones para cada jugador ubicado en los bordes de la mesa, los jugadores controlan un juego que se carga din√°micamente en el sistema desde un chip de memoria. Gracias a esto, el juego en el dispositivo se parece a las viejas consolas. Solo que ahora no necesitamos soplar el cartucho para eliminar los errores.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mi sorpresa ... Realmente pude completar el proyecto. </font><font style="vertical-align: inherit;">Me tom√≥ cerca de tres meses completos de trabajo para ciclos de experimentos, fracasos, lectura de documentaci√≥n, desesperaci√≥n y reintentos. </font><font style="vertical-align: inherit;">Ser√≠a necesario fijar el n√∫mero de horas de trabajo para saber cu√°nto tiempo pas√© en esto. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supongo</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que alrededor de 800-900 horas. </font><font style="vertical-align: inherit;">(Suponiendo que trabaj√© 6/7 d√≠as a la semana durante 8-10 horas al d√≠a, lo que est√° bastante cerca de la verdad). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trat√© de documentar el proceso de mis experimentos de principio a fin, tomando fotos y grabando videos. </font><font style="vertical-align: inherit;">Con esta publicaci√≥n documentar√© el proyecto y mi experiencia por m√≠ mismo. </font><font style="vertical-align: inherit;">Espero que para ti se convierta en una fuente de inspiraci√≥n si tambi√©n decides emprender un proyecto igualmente incre√≠ble.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Llegando al trabajo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije al comienzo del art√≠culo, cuando comenc√© el proyecto, no ten√≠a ning√∫n conocimiento de electr√≥nica, excepto por la f√≥rmula incorrectamente recordada de la ley de Ohm. Por lo tanto, en primer lugar, necesitaba estudiar c√≥mo funciona la electr√≥nica en la pr√°ctica, y solo luego tratar de armar una consola de juegos. Ni siquiera sab√≠a c√≥mo encender el LED usando el microcontrolador. Entonces, mi primer paso: ordenar una electr√≥nica simple y un microcontrolador para experimentos. Para comenzar, intentar√© encender el LED. Estoy casi seguro de que mi primer intento de encender el LED provoc√≥ su quema. Pero esto no fue documentado en la c√°mara, as√≠ que supongamos que no.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65d/3f9/4b4/65d3f94b409f452f2b89b61cebe87851.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Experimentos con un microcontrolador, resistencias, un transistor y un LED. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este fue el primer hito importante. </font><font style="vertical-align: inherit;">Ahora sabemos c√≥mo crear c√≥digo que se ejecute en el microcontrolador. </font><font style="vertical-align: inherit;">Tambi√©n aprendimos a usar transistores como un simple interruptor el√©ctrico para encender un LED. </font><font style="vertical-align: inherit;">¬°Asombroso!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aventura con EEPROM</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b93/544/2b3/b935442b3b1db1c8c8e390c134394a6d.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 1. Uso de registros de desplazamiento para controlar 16 l√≠neas de salida con solo 3 pines de salida.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Parte del proyecto fue la capacidad de escribir la l√≥gica del juego en chips de memoria (EEPROM). Deber√≠an haberse le√≠do cuando se inserta un cartucho con un reproductor en el sistema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la larga, me doli√≥ que no aprendiera suficiente informaci√≥n sobre qu√© tipo de EEPROM deber√≠a usarse en este proyecto. Me apasion√≥ tanto que compr√© los viejos chips EEPROM paralelos (W27C512). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para escribir o leer de ellos, necesitaba la capacidad de establecer una se√±al alta o baja en las 16 l√≠neas. Si no quisiera ocupar todos los contactos de salida del microcontrolador, ser√≠a l√≥gico aprender a usar los registros de desplazamiento.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e51/17c/73e/e5117c73e685322a816450c33a198278.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 2. El circuito utilizado en un intento fallido de leer / escribir datos en un chip EEPROM paralelo.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Con solo un par de contactos, podemos controlar por separado las 16 l√≠neas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Ahora apliquemos este conocimiento a EEPROM! Si pero no. No pude </font><font style="vertical-align: inherit;">escribir datos de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manera estable</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en EEPROM. Este tipo de chip requiere 12-14 V para eliminar o escribir bytes. Trat√© de proporcionarlos utilizando transistores como interruptores para suministrar mayor voltaje. Y como lo entiendo, DEBE funcionar. Pero no funcion√≥. Todav√≠a no entiendo cu√°l es exactamente el problema. En la Fig. La Figura 2 muestra los circuitos que intent√© usar para leer / escribir bytes desde / hacia EEPROM.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c8/55b/2cc/7c855b2cccc52a790973701590912927.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 3. Un circuito que ha logrado leer / escribir bytes en un chip EEPROM serie.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Finalmente, despu√©s de estudiar m√°s informaci√≥n sobre este tema, aprend√≠ que hoy en d√≠a las EEPROM paralelas no se usan con tanta frecuencia. Por lo general, los desarrolladores prefieren EEPROM serie I2C y, por lo tanto, es mucho m√°s f√°cil encontrar tutoriales sobre ellos. (Por ejemplo, este </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incre√≠ble tutorial de Sparkfun</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la Fig. </font><font style="vertical-align: inherit;">La Figura 3 muestra mi esquema para leer y escribir datos en EEPROM seriales ... Es MUCHO m√°s simple y mucho m√°s confiable. </font><font style="vertical-align: inherit;">Esto me ense√±√≥ que no deber√≠a estar muy contento de pedir piezas e intentar desarrollar el proyecto demasiado r√°pido. </font><font style="vertical-align: inherit;">Pasamos alrededor de 1 a 2 semanas en EEPROM paralelas, y finalmente no las usamos en absoluto. </font><font style="vertical-align: inherit;">Sin embargo, en el proceso, aprendimos mucho en electr√≥nica y especificaciones de lectura (que en s√≠ mismo es una habilidad). </font><font style="vertical-align: inherit;">Los esfuerzos no se desperdiciaron por completo.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, ¬øc√≥mo lo hacemos de todos modos?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora podemos leer y escribir en los chips de memoria. </font><font style="vertical-align: inherit;">¬øCu√°l ser√° el pr√≥ximo paso? </font><font style="vertical-align: inherit;">En esta etapa, ser√° l√≥gico describir mi plan de consola con m√°s detalle utilizando varios dibujos como ejemplo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbd/be2/3c5/fbdbe23c5506e650261938ce053e01a5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plan General. Esta ser√° una consola de juegos con controladores para cuatro jugadores. Cada jugador tiene un joystick y varios botones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≠rculo rojo marca el tap√≥n del cartucho del juego. Este conector tendr√° cuatro pines met√°licos que la consola usa para leer EEPROM seriales para cargar juegos en la memoria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El verde muestra c√≥mo planeamos crear una pantalla de tiras de LED. Quer√≠amos que el p√≠xel de la pantalla fuera un parche de color cuadrado y luminoso, no un punto que se mezclara con otros puntos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para lograr el efecto deseado, utilizamos dicho esquema para separar las fuentes de luz entre s√≠. Al mismo tiempo, dispersa la luz que cae sobre la pantalla. (Las rayas blancas debajo de la rejilla indican la tira de LED)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decid√≠ hacer una pantalla LED de 42x42. Es decir, en total se obtienen 1764 LED. Eleg√≠ el n√∫mero 42, porque gracias a esto, el tama√±o de la mesa ser√° el adecuado para cuatro personas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encender tantos LED es una tarea desalentadora en s√≠ misma. Al m√°ximo brillo, el LED RGB consume 60 mA de corriente. (que da blanco con brillo m√°ximo). Si multiplicamos por el n√∫mero total de LED, ¬°obtenemos el consumo de corriente m√°ximo de 105.84 A a 5 V! Para acercarnos a esta corriente, compramos una fuente de alimentaci√≥n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SE-600‚Äì5 MEAN WELL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Puede suministrar corriente hasta 100 A. Lo cual es menos de lo te√≥ricamente posible 105 A. Pero no busco mostrar pantallas completamente blancas con brillo m√°ximo en los juegos. </font><font style="vertical-align: inherit;">Adem√°s, podemos limitar el brillo mediante programaci√≥n. </font><font style="vertical-align: inherit;">Tambi√©n agregaremos fusibles para evitar exceder accidentalmente este l√≠mite de 100 A.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/332/a49/769/332a49769fc921086ed5072e01879586.gif"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. </font><font style="vertical-align: inherit;">4. Prototipo de cart√≥n para una pantalla LED de 3x3. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volver√© al montaje de esta pantalla m√°s tarde. </font><font style="vertical-align: inherit;">Primero necesitas hacer prototipos. </font><font style="vertical-align: inherit;">Veamos si podemos hacer que una peque√±a pantalla LED funcione. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este prototipo 3x3 est√° compuesto por varias piezas de cart√≥n que separan los p√≠xeles y un papel normal para impresoras que dispersa la luz. </font><font style="vertical-align: inherit;">¬°Funcion√≥ muy bien! </font><font style="vertical-align: inherit;">Hemos recibido una confirmaci√≥n maravillosa de la capacidad de trabajo del concepto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar los LED utilizando un microcontrolador, utilizamos la biblioteca FastLED. Sin embargo, result√≥ que si los LED est√°n controlados por un bus de datos, entonces es imposible actualizar 1764 LED a una velocidad suficiente para los juegos. Dada una frecuencia de 800 kHz, podemos lograr una velocidad de cuadro de aproximadamente 17 cuadros por segundo. No es exactamente por lo que nos esforzamos. Personalmente, me gusta jugar con al menos 60FPS. Afortunadamente, esto es posible. Es suficiente usar m√°s de un bus de datos. La pantalla 42x42 se puede dividir convenientemente en 7 partes iguales. Cada una de estas partes se puede controlar por separado, con su propio bus de datos. Esto es posible gracias al </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uso de la funci√≥n de salida paralela de la biblioteca FastLED en el microcontrolador Teensy 4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ¬°Al usar 7 buses de datos, podemos lograr una frecuencia de actualizaci√≥n m√°xima de aproximadamente 120FPS!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No plane√© esto, pero por pura casualidad, al comienzo del proyecto, eleg√≠ este microcontrolador en particular. </font><font style="vertical-align: inherit;">Me pareci√≥ que el buen funcionamiento de los juegos requerir√≠a el r√°pido tiempo de procesamiento proporcionado por este MK. </font><font style="vertical-align: inherit;">El prototipo en la Fig. </font><font style="vertical-align: inherit;">4 ya est√° controlado por la funci√≥n de salida paralela. </font><font style="vertical-align: inherit;">Sin embargo, en este prototipo usamos solo 2 buses de datos, solo para probar si todo realmente funcionar√° como se indica.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo ejecutaremos el c√≥digo con EEPROM?</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, en esta etapa podemos leer y escribir en la EEPROM, y tambi√©n tenemos una prueba del concepto de la pantalla LED. ¬øQue sigue? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo quedan dos tareas t√©cnicas serias: la organizaci√≥n del m√©todo de entrada para todos los jugadores (botones y joysticks). Y tambi√©n necesitamos descubrir c√≥mo ejecutar la l√≥gica del juego desde EEPROM y mostrar los resultados de estas instrucciones en la pantalla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los botones y joysticks ordenados a√∫n no han llegado. Por lo tanto, primero participaremos en la ejecuci√≥n de la l√≥gica del juego desde EEPROM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay muchas formas de ejecutar instrucciones (c√≥digo) desde la EEPROM. Sin embargo, primero debemos establecer ciertos requisitos: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) El c√≥digo debe ser f√°cil de escribir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) El c√≥digo debe ser peque√±o (tama√±o del archivo).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) El c√≥digo deber√≠a poder interactuar con bibliotecas ya preparadas, por ejemplo, FastLED, para reducir la cantidad de mi trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) El c√≥digo debe poder cargarse en la RAM lo m√°s r√°pido posible para reducir el tiempo de carga. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Necesita la capacidad de emular c√≥digo en una PC normal para probar juegos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) Nuestra soluci√≥n debe ser de alto rendimiento (proporcionar al menos 60 FPS). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) Una soluci√≥n no deber√≠a requerir la compra de una gran cantidad de equipo adicional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) La soluci√≥n deber√≠a funcionar en Teensy 4.0 MK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
9) La soluci√≥n debe ser f√°cil de implementar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se me ocurrieron cuatro formas diferentes de ejecutar c√≥digo desde EEPROM:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Escribimos en la EEPROM el c√≥digo Arduino compilado habitual. Luego hacemos que el programador externo de Arduino lea el c√≥digo compilado de la EEPROM y reprograme el Arduino sobre la marcha cada vez que se carga un nuevo juego. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Cargamos el c√≥digo del ensamblador en la RAM y lo ejecutamos desde all√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Utilizamos un int√©rprete de c√≥digo ya preparado, por ejemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArduinoBASIC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bitlash</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Escribimos nuestro propio int√©rprete de c√≥digo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay una breve comparaci√≥n de las ventajas y desventajas de las cuatro soluciones para nuestro proyecto:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75d/9e6/f9c/75d9e6f9c00e8c1067278d2317de5ae3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(1) El tama√±o del archivo para una soluci√≥n con un programador externo es terrible. Junto con la l√≥gica del juego, todas las bibliotecas de c√≥digos que usamos en este proyecto deben almacenarse en EEPROM. Para mostrar el estado del juego, cada EEPROM debe tener su propia copia de la biblioteca FastLED. Esto no es genial en absoluto. Este problema probablemente se puede evitar agregando de alguna manera el c√≥digo b√°sico a un programador externo, que luego se combina con el c√≥digo EEPROM antes de programar el Arduino. Esta ser√≠a una tarea de alto riesgo, porque no es tan f√°cil encontrar tutoriales en Internet. Probablemente pasar√≠amos demasiado tiempo en ello.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(2) Ejecutar ensamblador desde RAM es una gran opci√≥n. Por eso decid√≠ considerarlo. La complejidad de escribir c√≥digo puede reducirse utilizando un lenguaje de alto nivel, por ejemplo, C, que luego se compila en el c√≥digo de ensamblador correcto. Sin embargo, no estaba claro lo f√°cil que ser√≠a lograr que interact√∫e con otras bibliotecas en Arduino, as√≠ que decid√≠ abandonarlo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(3) Usar un int√©rprete listo para usar tambi√©n es una soluci√≥n bastante buena. Sin embargo, hasta donde yo s√©, todos estos int√©rpretes se ejecutan en base a cadenas de caracteres. Estas largas l√≠neas deben escribirse en la EEPROM. Este no es un gran problema, pero definitivamente no es la mejor manera de minimizar el tama√±o del archivo. Adem√°s, no estaba claro si estos int√©rpretes pod√≠an interactuar con las bibliotecas Arduino. Por lo tanto, decid√≠ que usar int√©rpretes prefabricados no es una buena idea. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(4) Finalmente, tenemos la soluci√≥n 4: crear nuestro propio int√©rprete de c√≥digo. Satisface todos los requisitos, porque la forma en que se implementa el int√©rprete depende completamente de m√≠. Lo </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">har√°</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tener alta velocidad si logro la alta velocidad del propio int√©rprete. </font><font style="vertical-align: inherit;">S√≠, el tama√±o del archivo ser√° peque√±o y el c√≥digo ser√° f√°cil de escribir ... si lo proporciono yo mismo. </font><font style="vertical-align: inherit;">En otras palabras, tendremos un control completo sobre todo. </font><font style="vertical-align: inherit;">Y si hago un esfuerzo, todo saldr√° perfectamente. </font><font style="vertical-align: inherit;">El √∫nico inconveniente serio de tal soluci√≥n ser√° un largo tiempo de desarrollo. </font><font style="vertical-align: inherit;">Puede recordar que pas√© entre 800 y 900 horas en este proyecto. </font><font style="vertical-align: inherit;">Es decir, es obvio que decid√≠ elegir la soluci√≥n 4: crear mi propio int√©rprete de c√≥digo. </font><font style="vertical-align: inherit;">El tiempo no fue un problema para m√≠. </font><font style="vertical-align: inherit;">Aprovech√© esta oportunidad para aprender c√≥mo se crean los lenguajes de programaci√≥n. </font><font style="vertical-align: inherit;">Descubrir√© por qu√© se tom√≥ una u otra decisi√≥n arquitect√≥nica en estos idiomas.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El nacimiento de ArcadableScript</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El principio general del int√©rprete es bastante simple. </font><font style="vertical-align: inherit;">No entrar√© en detalles de su estructura interna, porque al momento de escribir, estaba planeando reescribir completamente el int√©rprete para que sea m√°s eficiente y le sea m√°s f√°cil escribir c√≥digo. </font><font style="vertical-align: inherit;">Sin embargo, lo b√°sico sigue siendo el mismo. </font><font style="vertical-align: inherit;">El int√©rprete ejecutar√° un bucle de c√≥digo simple para cada medida del juego:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d38/795/8cf/d387958cf2e11b21d122f66d7f530918.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un gran inconveniente de este esquema es que la entrada y el estado del juego se verifican solo una vez por fotograma. </font><font style="vertical-align: inherit;">Para juegos que no requieren una reacci√≥n r√°pida, esto es normal. </font><font style="vertical-align: inherit;">Sin embargo, en otros juegos, el jugador no podr√° reaccionar entre fotogramas. </font><font style="vertical-align: inherit;">Resolver√© este problema en la pr√≥xima versi√≥n del int√©rprete.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/843/ee2/fe1/843ee2fe188d8a16ea99f0e9e427b9ef.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Higo. 5</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En el diagrama con la fig. La Figura 5 muestra c√≥mo plane√© actualizar el int√©rprete en un futuro cercano, creando dos ciclos separados para el estado del juego y los marcos del juego. Esto nos permitir√° actualizar el estado del juego cientos de veces por segundo y la pantalla, solo 60 veces por segundo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, en Teensy 4.0 no es posible ejecutar c√≥digo multiproceso de hardware. Por lo tanto, no podremos llevar a cabo estos dos ciclos en paralelo. Pero estoy seguro de que se me ocurrir√° algo.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e56/8c7/878/e568c78787bb1b00b2aee6c406071050.gif"></div><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9bd/b45/225/9bdb45225d410ef24bcc8e5fa3b325c3.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de un tiempo, logr√© escribir dos programas simples usando mi propio lenguaje de c√≥digo de bytes inventado. Utilizan n√∫meros sin procesar como entrada para minimizar el tama√±o del archivo. Es decir, complet√© la escritura de estos dos programas, literalmente escribiendo listas de n√∫meros que el int√©rprete puede entender. Para dar una idea de cu√°n legible es este c√≥digo de bytes, demostrar√© las instrucciones reales utilizadas en el programa de ejemplo que mueve un punto por la pantalla:</font></font><br>
<br>
<blockquote><code><pre>// TODO: Write/read all untyped... data to/from ROM
  int untypedGamestate[] = {
    0, // Previous time, to keep track of game time/framerate.
    0, // Player position x.
    0, // Player position y.
    0, // Player R color value.
    0, // Player G color value.
    255, // Player B color value.
  };
  int untypedValues[][3] = {
    // ID, Type, Value
    {0, 0, 0}, // Move up button value 
    {1, 0, 1}, // Move right button value
    {2, 0, 2},  // Move down button value
    {3, 0, 3},  // Move left button value
    {4, 3, 1},  // True/1
    {5, 3, 0},  // False/0
    {6, 4, 0},  // Current millis since game start
    {7, 2, 0},  // Gamestate previous time
    {8, 2, 1},  // Gamestate player x
    {9, 2, 2},  // Gamestate player y
    {10, 2, 3}, // Gamestate player r color
    {11, 2, 4}, // Gamestate player g color
    {12, 2, 5}, // Gamestate player b color
    {13, 3, 1}, // Move player up after button press boundary check
    {14, 1, 0}, // System config screen width
    {15, 1, 1}, // System config screen height
    {16, 3, 3}, // Move player down after button press boundary check
    {17, 3, 5}, // Move player left after button press boundary check
    {18, 3, 7}, // Move player right after button press boundary check
  }
  int untypedCalculations[][5] = {
    // ID, ending, valueLeftID, calculationRightID, calculationOperator
    {0, 0, 9, 1, 1}, // Current player y position - 1
    {1, 1, 4, 0, 0}, // True/1
    {2, 1, 0, 0, 0}, // Up button
    {3, 1, 2, 0, 0}, // Down button
    {4, 1, 5, 0, 0}, // False/0
    {5, 1, 9, 0, 0}, // Current player y position
    {6, 0, 15, 1, 1} // screenheight - 1
    {7, 0, 9, 1, 0}, // Current player y position + 1
    {8, 1, 3, 0, 0}, // Left button
    {9, 1, 1, 0, 0}, // Right button
    {10, 1, 8, 0, 0}, // Current player x position
    {11, 0, 8, 1, 0}, // Current player x position + 1
    {12, 0, 8, 1, 1}, // Current player x position - 1
    {13, 0, 14, 1, 1} // screenwidth - 1
  }
  int untypedInstructions[][10] = {
    // ID, rootInstruction, conditionCalculationLeftID, conditionCalculationRightID, conditionOperator, conditionSuccesValueLeftID,
    // conditionSuccessCalculationRightID, hasFailedCondition, conditionFailedValueLeftID, conditionFailedCalculationRightID
    {0, 1, 2, 1, 0, 13, 0, 0, 0, 0}, // move player up when up button is pressed.
    {1, 0, 5, 4, 1, 9, 0, 0, 0, 0}, // move the player up when the boundary is not reached.
    {2, 1, 3, 1, 0, 16, 0, 0, 0, 0}, // move player down when down button is pressed. 
    {3, 0, 5, 6, 1, 9, 7, 0, 0, 0} // move the player down when the boundary is not reached.
    {4, 1, 8, 1, 0, 17, 0, 0, 0, 0}, // move player left when left button is pressed.
    {5, 0, 10, 4, 1, 8, 12, 0, 0, 0}, // move the player left when the boundary is not reached.
    {6, 1, 9, 1, 0, 18, 0, 0, 0, 0}, // move player right when right button is pressed.
    {7, 0, 10, 13, 1, 8, 11, 0, 0, 0}, // move the player right when the boundary is not reached.
  };</pre></code></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se toma el tiempo de estudiar detenidamente el c√≥digo, puede comprender c√≥mo funcionaba la versi√≥n anterior de este int√©rprete. El principio general de utilizar "valores", "c√°lculos" e "instrucciones" se conserva en la versi√≥n actual. Sin embargo, mucho ha cambiado. Ya no tenemos una lista fija de valores de gamestate, ahora son solo parte de la lista normal de valores. Adem√°s, separamos las "condiciones" de las instrucciones. Gracias a esto, podemos reutilizar las instrucciones en el c√≥digo, lo que reduce el tama√±o del archivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entremos en los detalles del int√©rprete, porque en la versi√≥n redise√±ada, todo esto cambiar√° pronto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora estamos en la etapa en que sabemos c√≥mo leer / escribir en la EEPROM, y podemos ejecutar instrucciones basadas en matrices de n√∫meros ordinarios. </font><font style="vertical-align: inherit;">El siguiente paso l√≥gico ser√° eliminar las listas codificadas de instrucciones del c√≥digo y escribirlas en la EEPROM. </font><font style="vertical-align: inherit;">A partir de ahora, podremos intentar leer y ejecutar las instrucciones almacenadas en la EEPROM.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99f/787/c14/99f787c142065459798925f8a58105c7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°En esta etapa, tenemos todas las pruebas de la capacidad de trabajo de los conceptos que necesitamos para comenzar a crear el resultado final! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, cada parte individual del prototipo que creamos todav√≠a requiere mucho trabajo. </font><font style="vertical-align: inherit;">Pero, en mi opini√≥n, las tareas m√°s dif√≠ciles ya se han resuelto. </font><font style="vertical-align: inherit;">Todo lo que ten√≠a que hacer era desarrollar lo que ya ten√≠a. </font><font style="vertical-align: inherit;">¬°Todo es simple!</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asamblea de pantalla LED</font></font></h1><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9d/661/fa9/f9d661fa96cd940cd19d0dd4c0f49930.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tom√≥ mucho trabajo ensamblar la pantalla. Mucho trabajo Comenc√© por tener que soldar cables a 42 tiras separadas. Cada tira requiere tres cables en un lado y dos en el otro. Es decir, solo unos 200 cables. Antes de este proyecto, no ten√≠a mucha pr√°ctica en la soldadura, por lo que puede notar claramente que cuanto m√°s lo hago, m√°s fuerte es la calidad. Por supuesto, al final, tuve que rehacer muchas de las primeras tiras de LED, porque no me gust√≥ el resultado. ¬°Todo esto es parte del proceso de aprendizaje!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ec/9b3/604/2ec9b36040aadbe6007c8d3e7bf20d34.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El siguiente paso: colocamos todas las tiras de LED en un gran panel de madera. Mirando hacia atr√°s, creo que quiz√°s por el bien de una mejor conductividad t√©rmica vali√≥ la pena usar una l√°mina de metal, porque despu√©s de una hora de funcionamiento, la pantalla ahora se calienta (40-50 ¬∞ C). Pero esto todav√≠a no sucede con tanta frecuencia, por lo que no es un gran problema. Sin embargo, si decidiera repetir el proyecto, corregir√≠a este aspecto.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ba/7b3/ebd/0ba7b3ebdd11e0349049d5bbf6c04761.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, conectamos cables de mayor di√°metro a los conductores positivo y negativo de las tiras de tiras de LED. Debemos asegurarnos de que los cables de gran di√°metro soporten de manera confiable una corriente m√°xima de 100 A. Para protecci√≥n adicional, tambi√©n agregamos fusibles de 15 A a cada parte de la pantalla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, estamos listos para hacer los primeros intentos de controlar la pantalla. Despu√©s de muchas fallas y manipulaciones con los par√°metros y cables del software, finalmente logr√© mostrar un solo color en la pantalla sin distorsiones e interferencias. Tom√≥ mucho tiempo, y el resultado a√∫n estaba lejos de ser perfecto. Durante mucho tiempo, todav√≠a tuve problemas con las se√±ales distorsionadas hasta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que publiqu√© una pregunta al respecto en electronics.stackexchange.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Grandes personas de este sitio me ayudaron a diagnosticar el problema. </font><font style="vertical-align: inherit;">Todav√≠a no entend√≠a completamente lo que era, pero al conectar los cables negativos directamente a lo largo de los buses de datos desde la tierra MK a la terminal de tierra cerca de la entrada de datos, pude resolverlo. </font><font style="vertical-align: inherit;">Desde entonces no he tenido ning√∫n problema con la distorsi√≥n en la pantalla.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78d/f76/e76/78df76e76fa5ca0494056dc1b7546e8c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como vimos en la ilustraci√≥n anterior, dos capas de material se superponen en las tiras de LED. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como material para este recubrimiento, necesitamos algo fuerte, transparente, pero que difunda la luz. </font><font style="vertical-align: inherit;">Sin embargo, no quer√≠a usar vidrio porque es costoso y fr√°gil. </font><font style="vertical-align: inherit;">Por lo tanto, decid√≠ tomar un poliestireno transparente est√°ndar. </font><font style="vertical-align: inherit;">Para que √©l dispersara la luz, la trat√© con un papel de lija fino hasta el punto de que era imposible mirar a trav√©s. </font><font style="vertical-align: inherit;">Todo es muy simple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se dedic√≥ mucho m√°s tiempo a crear una cuadr√≠cula que se ubicar√≠a directamente encima de las tiras. Pens√© en pedir una parrilla con los par√°metros necesarios para ordenar, pero me llamaron un precio de unos 500 euros. En mi opini√≥n, ella no val√≠a la pena. Por lo tanto, tuve que recogerlo nosotros mismos. Para esto necesitamos tiras de pl√°stico blanco opaco, duradero (no m√°s de 2 mm de espesor). Muchos requisitos. Por lo tanto, la selecci√≥n del material correcto tom√≥ mucho tiempo. Al final result√≥ que, las rayas de las persianas (laminillas) son ideales.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4d/069/ecc/c4d069ecc77f2597d1e5093b225333c2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, hicimos un peque√±o soporte para hacer cortes uniformes, incluso en franjas anchas. En este caso, se obtuvieron peque√±as tiras de pl√°stico. Luego tuvimos que hacer incisiones en el medio de cada tira exactamente en los lugares correctos. Esto es necesario para conectar las piezas de pl√°stico y ensamblar la rejilla. Esto es lo que hago en la tercera foto. Antes de hacer esto, debe asegurarse de que el ancho de la sierra sea igual o ligeramente mayor que el ancho de la tira que cort√≥. De lo contrario, la rejilla no se puede ensamblar. En mi caso, result√≥ que una sierra para metales tiene un grosor ideal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la cuarta foto, el resultado de ensamblar todas las tiras en la cuadr√≠cula es visible. </font><font style="vertical-align: inherit;">Fue un trabajo muy molesto y mon√≥tono, pero la parrilla result√≥ ser muy duradera. </font><font style="vertical-align: inherit;">En general, parece que todas las celdas son del mismo tama√±o. </font><font style="vertical-align: inherit;">No hay mucha variaci√≥n entre los tama√±os de celda, de lo contrario la pantalla se ver√≠a extra√±a, por lo que todo result√≥ bastante bien. </font><font style="vertical-align: inherit;">Estoy satisfecho con esta parrilla.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e5/c98/a63/3e5c98a63af67f3ba0102a455a939724.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego encerr√© la rejilla en un marco de madera que realizaba varias tareas. </font><font style="vertical-align: inherit;">Primero, sostiene una l√°mina de poliestireno en la parte superior de la parrilla. </font><font style="vertical-align: inherit;">Asegura que la rejilla no se mueva. </font><font style="vertical-align: inherit;">Adem√°s, un marco de madera presiona todos los cables para que se sujeten de manera m√°s segura y no se puedan soltar accidentalmente (lo que ocurri√≥ un par de veces cuando mov√≠ la pantalla).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/817/19a/c01/81719ac01006db1add78e0f394d1fffb.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta fotograf√≠a muestra una l√°mina de poliestireno lijado sobre una rejilla de alambre. </font><font style="vertical-align: inherit;">Tenga en cuenta que la parrilla ahora es apenas visible, que es lo que quer√≠amos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3eb/a69/4e8/3eba694e869e4fc489af81f01c6de832.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de pasar largas horas experimentando con la implementaci√≥n correcta del control de visualizaci√≥n, finalmente logramos que funcione. Un gran problema fue la preservaci√≥n de la integridad de las se√±ales. Pero como dije anteriormente. ¬°La comunidad de electronics.stackexchange me ayud√≥ con esto! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pantalla es brillante, mucho m√°s brillante de lo que esperaba. Era necesario prever esto, ordenando una unidad de 100 A para su suministro de energ√≠a.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0a/092/371/a0a09237152f40f6ce6cb24aaa8d3e89.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como he dicho varias veces, utilizamos la biblioteca FastLED para controlar los LED. </font><font style="vertical-align: inherit;">Pero no mencion√© que tambi√©n uso una versi√≥n modificada de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la biblioteca FastLED-GFX de </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J√ºrgen Skrocki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (que en s√≠ mismo es un puerto de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la Biblioteca Adafruit-GFX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">para la representaci√≥n simple de figuras en la pantalla </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Los cambios en esta biblioteca son menores, pero fueron necesarios para que el int√©rprete pudiera comunicarse con la biblioteca de manera conveniente.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cerebros y ...</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una de las √∫ltimas tareas t√©cnicas que deben resolverse para completar este proyecto es completar los cerebros de la consola. Debe convertirlos en un conjunto conveniente y compacto. Pero primero tenemos que descubrir c√≥mo manejar todas las se√±ales de entrada de los jugadores. Perm√≠teme recordarte que cada jugador tiene 4 botones y un joystick. Eso es un total de 16 se√±ales de entrada digital y 8 anal√≥gicas. MK nunca tiene suficientes contactos para tal entrada; Adem√°s, dos pines del bus de datos ya se utilizan para leer la EEPROM, y se necesitan 7 pines del bus de datos paralelos para controlar la pantalla. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver este problema, utilizamos un par de registros de desplazamiento para la entrada digital. Y para todas las entradas anal√≥gicas, tomaremos un multiplexor anal√≥gico.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be4/362/3d4/be43623d4bc69b23ee153bf4e0fc191b.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquema para leer / escribir simult√°neamente EEOPROM, procesar la entrada del reproductor y controlar la pantalla.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Y entonces comienza la confusi√≥n. Perm√≠tanme explicar lo que est√° sucediendo en esta foto, de izquierda a derecha. En la parte superior de la placa de pruebas izquierda hay 7 buses de datos utilizados para controlar la pantalla. A continuaci√≥n se muestra el √°rea donde se puede insertar la EEPROM y donde se lee.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte superior de la placa del medio hay un multiplexor anal√≥gico. Este multiplexor puede recibir hasta 16 se√±ales de entrada anal√≥gicas y, dependiendo de las se√±ales de entrada en el multiplexor, conectar una de las se√±ales anal√≥gicas al MK. Por lo tanto, solo necesitamos un pin de entrada anal√≥gica y un par de pines de entrada digital para procesar 16 entradas anal√≥gicas. Parece que no hay una entrada anal√≥gica conectada al multiplexor en esta foto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debajo del multiplexor est√° MK Teensy. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el panel derecho, procesamos se√±ales de entrada digital. En esta foto, 16 se√±ales digitales simplemente se conectan a tierra. Todav√≠a estaba esperando que llegaran los botones, as√≠ que prob√© las 16 se√±ales digitales de esta manera. Gracias a los registros de desplazamiento, solo se necesitaban 4 pines para controlar todas las se√±ales digitales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el sistema es un gran caos poco confiable. </font><font style="vertical-align: inherit;">Es necesario hacerlo m√°s compacto para que no se desmorone de una exhalaci√≥n descuidada. </font><font style="vertical-align: inherit;">¬°Por lo tanto, ped√≠ varias placas de prototipos y comenc√© a soldar nuevamente!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/351/a13/ea7/351a13ea70ae3f30f125304080770dcc.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e86/af8/04c/e86af804cc17b0925735084d862a2204.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Y eso result√≥ ser una tarea dif√≠cil! </font><font style="vertical-align: inherit;">Sin embargo, esta fue una excelente ocasi√≥n para aprender a soldar con precisi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para llegar a este circuito, utilic√© como ejemplo el caos de los cables en la placa de pruebas. </font><font style="vertical-align: inherit;">Luego trat√© de encontrar un circuito m√°s inteligente para que los componentes que deber√≠an comunicarse entre s√≠ est√©n lo m√°s cerca posible. </font><font style="vertical-align: inherit;">As√≠ que trat√© de deshacerme de la necesidad de tirar demasiados cables. </font><font style="vertical-align: inherit;">Ahora creo que podr√≠a usar algunas herramientas de modelado para dise√±ar el circuito. </font><font style="vertical-align: inherit;">Pero a√∫n as√≠ result√≥ bastante bien.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decid√≠ dise√±ar un circuito de dos capas. En la placa del prototipo inferior, se procesan todas las entradas. En cada una de las 4 conexiones de entrada, tengo 8 l√≠neas de entrada (1 - tierra, 1 - positiva, 4 - entrada digital, 2 - entrada anal√≥gica). MK se comunica con la capa inferior utilizando cuatro conexiones al lado de los registros de desplazamiento y cuatro conexiones al lado del multiplexor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fuente de alimentaci√≥n se encuentra en la capa superior, a la derecha hay 7 buses de datos de salida para la pantalla, y en la parte inferior hay contactos para leer la EEPROM. Y finalmente, en el centro, por supuesto, est√° el microcontrolador.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e36/b63/416/e36b63416aa9c6b7cfad5c3c3f3918e7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre los tableros de control principales y la entrada de los jugadores, coloqu√© tableros intermedios para reducir el n√∫mero de cables requeridos en ambos lados de 12 a 8, porque no es necesario usar los 5 cables de tierra que van desde el tablero principal al tablero de entrada. </font><font style="vertical-align: inherit;">Una conexi√≥n a tierra es suficiente para todos los botones y el joystick. </font><font style="vertical-align: inherit;">Por lo tanto, hay cuatro de estos tableros intermedios. </font><font style="vertical-align: inherit;">Me gusta que puedas notar una mejora en la calidad de cada pr√≥ximo tablero que recolectes.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d4/6b0/5ab/6d46b05abd9ced550837adb796becb9e.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como nunca recib√≠ los botones pedidos, ped√≠ otro juego a otro vendedor y despu√©s de un par de d√≠as lo recib√≠. </font><font style="vertical-align: inherit;">Esto nos permiti√≥ finalmente comenzar a probar todos los botones.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd3/083/a72/fd3083a7252ec45ff226ccaf9c3ee18a.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esta etapa, tambi√©n escrib√≠ el primer juego que se puede jugar en la consola. S√≠, ahora lo llamo la consola. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tuve √©xito porque en el proceso de trabajar en la pantalla mejor√© simult√°neamente el int√©rprete. En particular, logr√© mejorar el proceso de desarrollo en s√≠ mismo al escribir el c√≥digo. Este proceso no es tan interesante externamente, as√≠ que decid√≠ no documentarlo particularmente.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6f/fed/54f/a6ffed54fd1a461d601e1424ccf9de2d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cre√© un entorno de desarrollo simple para escribir c√≥digo que se puede ejecutar en la consola. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este entorno funciona en un navegador y le permite escribir c√≥digo para la consola sin meterse con las listas ca√≥ticas de n√∫meros que vimos anteriormente. </font><font style="vertical-align: inherit;">Adem√°s, cre√© un emulador de consola que se ejecuta en la misma aplicaci√≥n web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La capacidad de emular juegos para la consola en una aplicaci√≥n web ahorr√≥ mucho tiempo, porque la depuraci√≥n en una PC es mucho m√°s f√°cil que en un MK. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El emulador no es perfecto. </font><font style="vertical-align: inherit;">Hay algunos errores que distinguen la emulaci√≥n de jugar en una versi√≥n real de la consola. </font><font style="vertical-align: inherit;">Intentar√© eliminarlos en el futuro cuando escriba una nueva versi√≥n del int√©rprete. </font><font style="vertical-align: inherit;">La necesidad de admitir dos versiones del int√©rprete (una escrita en C ++, la otra en TS) fue un poco molesta, pero vali√≥ la pena.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poniendolo todo junto</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo est√° listo. </font><font style="vertical-align: inherit;">Podemos mostrar im√°genes basadas en la l√≥gica del juego tomada de la EEPROM y procesar la entrada del jugador desde botones y joysticks. </font><font style="vertical-align: inherit;">Ahora necesitamos combinar todo esto en un dispositivo duradero.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df9/c7a/ebc/df9c7aebc3b77c16e5332a91ea52c04a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenc√© perforando agujeros en las placas de aluminio que mantendr√°n los botones y joysticks en su lugar. </font><font style="vertical-align: inherit;">Entonces fue posible insertar estas placas en las ranuras de la caja de madera en la que estaban convenientemente empotradas. </font><font style="vertical-align: inherit;">Gracias a esto, los jugadores no podr√°n ara√±ar accidentalmente el metal.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff9/911/305/ff991130552aade0b73c9241f014f781.png"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/989/61b/d54/98961bd54b0b66591cc5de96b952d17f.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recopilamos todo alrededor de la pantalla y agregamos patas plegables confiables (para un f√°cil almacenamiento). </font><font style="vertical-align: inherit;">Las placas de metal pintadas con pintura negra se ven muy hermosas. </font><font style="vertical-align: inherit;">Existe la sensaci√≥n de que el proyecto realmente est√° avanzando hacia su finalizaci√≥n.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/171/5e8/1ee/1715e81ee0aad78e45735d8354761956.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, por supuesto, me equivoqu√© al creer que el proyecto estaba casi completo. </font><font style="vertical-align: inherit;">As√≠ es como se ve√≠a la consola durante aproximadamente un mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recopilamos todo, entendemos que el bot√≥n no funciona. </font><font style="vertical-align: inherit;">Desmontamos de nuevo, solucionamos el problema con el bot√≥n. </font><font style="vertical-align: inherit;">Todo parece funcionar. </font><font style="vertical-align: inherit;">Entendemos que el joystick no funciona. </font><font style="vertical-align: inherit;">Desmontar de nuevo. </font><font style="vertical-align: inherit;">Tarde o temprano, todos los botones y joysticks comienzan a funcionar. </font><font style="vertical-align: inherit;">Pero luego los LED dejan de funcionar. </font><font style="vertical-align: inherit;">Para solucionarlos, debe desmontar toda la consola y volver a armarla desde el principio. </font><font style="vertical-align: inherit;">Esto continu√≥ durante aproximadamente un mes, hasta que finalmente todo funcion√≥.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultado</font></font></h1><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/N37waS4YijA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/797/f90/9fd/797f909fdad045379aa381c6d005422f.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Todo est√° listo! Despu√©s de comenzar a trabajar en el proyecto, ya han pasado 3-4 meses. Por lo tanto, es l√≥gico que mi motivaci√≥n para seguir mejorando el int√©rprete, pintar el √°rbol y desarrollar nuevos juegos ya se haya agotado. Al momento de escribir esto, ya hab√≠a pasado un mes, cuando estuve involucrado por √∫ltima vez en el proyecto. Finalmente gan√© fuerzas para escribir esta publicaci√≥n documental para m√≠ y para ti, mi lector. Aunque no espero que alguien en su sano juicio lea realmente todo lo que escrib√≠, espero que haya disfrutado viendo fotos del desarrollo gradual del proyecto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero si lee todo esto, puede estar interesado en el repositorio de Github del proyecto. ¬°Por supuesto, todo mi c√≥digo es de c√≥digo abierto! </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Arcadable</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Planes de desarrollo de proyectos adicionales:</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - En primer lugar, debes hacer un cartucho m√°s bonito para jugar Pong para cuatro, que se muestra en el √∫ltimo video. </font><font style="vertical-align: inherit;">Si bien es una pieza de cart√≥n con piezas curvas de papel de aluminio, que se utilizan como superficies de contacto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Adem√°s, quiero pintar mejor la consola. </font><font style="vertical-align: inherit;">Inicialmente, plane√© pintarlo con amigos muy experimentados a quienes les gusta pintar. </font><font style="vertical-align: inherit;">Sin embargo, ahora debido a la pandemia esto no es posible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Finalmente, como dije un par de veces, voy a reescribir el int√©rprete de una manera m√°s eficiente. </font><font style="vertical-align: inherit;">Tambi√©n mejorar√© el entorno de desarrollo para facilitar los juegos. </font><font style="vertical-align: inherit;">El dise√±o de aplicaciones web actualmente est√° obstaculizando la productividad.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fb/339/925/2fb3399255938735b58a888c18aaaba8.jpg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compensaci√≥n por la grabaci√≥n de videos verticales.</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498800/index.html">C√≥mo le ense√±√© a mi computadora a jugar Dobble con OpenCV y Deep Learning</a></li>
<li><a href="../es498808/index.html">Vim con soporte YAML para Kubernetes</a></li>
<li><a href="../es498814/index.html">Fallaste una pregunta te√≥rica sobre la Seguridad Social, y te pusieron fin. ¬øEsto es normal? // Estamos condenados # 3</a></li>
<li><a href="../es498816/index.html">La verdad en primer lugar, o por qu√© el sistema debe dise√±arse en funci√≥n del dispositivo de la base de datos</a></li>
<li><a href="../es498820/index.html">Algunas preguntas m√°s dif√≠ciles sobre .NET y C #</a></li>
<li><a href="../es498826/index.html">SIL y Salesforce</a></li>
<li><a href="../es498828/index.html">C√≥mo la sal de mesa y las prote√≠nas aumentar√°n la supervivencia del implante</a></li>
<li><a href="../es498830/index.html">Hash + cach√©: optimizaci√≥n de procesamiento de flujo</a></li>
<li><a href="../es498832/index.html">Descripci√≥n general de las posibilidades de Qt Creator 4.12 y QBS 1.16 para programar microcontroladores</a></li>
<li><a href="../es498834/index.html">33 mitaps en l√≠nea de la semana. ¬øElegir uno o tener tiempo para todo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>