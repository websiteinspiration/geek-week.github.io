<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîê üî∂ „äôÔ∏è Como criamos relat√≥rios din√¢micos no SSRS 2014 üëâ üë®üèº‚Äçüé§ üí≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√≥s j√° conversamos sobre como ajudamos uma empresa de fabrica√ß√£o de transformar os processos de treinamento corporativo e desenvolvimento de pessoal. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Como criamos relat√≥rios din√¢micos no SSRS 2014</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/487704/"><img src="https://habrastorage.org/webt/_q/hb/qb/_qhbqb8irkmfwui-lrqaktkhe8q.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° conversamos sobre</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como ajudamos uma empresa de fabrica√ß√£o de transformar os processos de treinamento corporativo e desenvolvimento de pessoal. </font><font style="vertical-align: inherit;">Os funcion√°rios do cliente, que estavam se afogando em documentos em papel e planilhas do Excel, receberam um aplicativo conveniente para iPad e um portal da web. </font><font style="vertical-align: inherit;">Uma das fun√ß√µes mais importantes deste produto √© a cria√ß√£o de relat√≥rios din√¢micos pelos quais os gerentes julgam o trabalho dos funcion√°rios ‚Äúno campo‚Äù. </font><font style="vertical-align: inherit;">S√£o documentos enormes, com dezenas de campos e tamanhos m√©dios de 3000 * 1600 pixels.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste artigo, falaremos sobre como implantar essa beleza com base no Microsoft SQL Server Reporting Services, por que esse back-end pode ser um mau amigo do portal da Web e quais truques ajudar√£o a estabelecer seu relacionamento. </font><font style="vertical-align: inherit;">Toda a parte comercial da solu√ß√£o j√° foi descrita no artigo anterior; portanto, aqui nos concentramos em quest√µes t√©cnicas. </font><font style="vertical-align: inherit;">Vamos come√ßar!</font></font><br>
<br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formula√ß√£o do problema</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos um portal com o qual v√°rias centenas de usu√°rios trabalham. </font><font style="vertical-align: inherit;">Eles s√£o organizados em uma hierarquia gradual, onde cada usu√°rio tem um supervisor de uma classifica√ß√£o superior. </font><font style="vertical-align: inherit;">Essa diferencia√ß√£o de direitos √© necess√°ria para que os usu√°rios possam criar eventos com qualquer funcion√°rio subordinado. </font><font style="vertical-align: inherit;">Voc√™ pode pular etapas, ou seja, </font><font style="vertical-align: inherit;">o usu√°rio pode iniciar a atividade com um funcion√°rio de qualquer n√≠vel inferior a ele. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que eventos s√£o significados aqui? </font><font style="vertical-align: inherit;">Isso pode ser treinamento, suporte ou certifica√ß√£o de um funcion√°rio de uma empresa comercial, que o supervisor conduz no ponto de venda. </font><font style="vertical-align: inherit;">O resultado desse evento √© um question√°rio preenchido em um iPad com classifica√ß√µes de funcion√°rios para qualidades e habilidades profissionais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com os dados do question√°rio, voc√™ pode preparar estat√≠sticas, por exemplo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quantos eventos com seus subordinados desse tipo Vasya Ivanov criou em um m√™s? </font><font style="vertical-align: inherit;">Quantos deles foram conclu√≠dos?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© a porcentagem de classifica√ß√µes satisfat√≥rias? </font><font style="vertical-align: inherit;">Quais perguntas os comerciantes respondem pior? </font><font style="vertical-align: inherit;">Qual gerente √© pior em fazer testes?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essas estat√≠sticas est√£o contidas nos </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">relat√≥rios</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que podem ser criados via interface da web, nos formatos XLS, PDF, DOCX e impressos. </font><font style="vertical-align: inherit;">Todas essas fun√ß√µes s√£o projetadas para gerentes em diferentes n√≠veis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O conte√∫do e o design dos relat√≥rios s√£o definidos nos </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modelos</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , permitindo definir os par√¢metros necess√°rios. </font><font style="vertical-align: inherit;">Se, no futuro, os usu√°rios precisarem de novos tipos de relat√≥rios, o sistema poder√° criar modelos, especificar par√¢metros modific√°veis ‚Äã‚Äãe adicionar um modelo ao portal. </font><font style="vertical-align: inherit;">Tudo isso - sem interferir no c√≥digo fonte e nos processos de trabalho do produto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especifica√ß√µes e limita√ß√µes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O portal √© executado na arquitetura de microsservi√ßo, a frente est√° escrita em Angular 5. O recurso usa autoriza√ß√£o JWT, suporta navegadores Google Chrome, Firefox, Microsoft Edge e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IE 11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os dados s√£o armazenados no MS SQL Server 2014. O SQL Server Reporting Services (SSRS) est√° instalado no servidor, o cliente usa e n√£o vai recusar. </font><font style="vertical-align: inherit;">Da√≠ a limita√ß√£o mais importante: o acesso ao SSRS √© fechado a partir do exterior, para que voc√™ possa acessar a interface da web e o SOAP somente da rede local atrav√©s da autoriza√ß√£o NTLM.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas palavras sobre o SSRS</font></font></b><div class="spoiler_text"><b>SSRS </b>‚Äì    ,        ,     .     docs.microsoft.com,  SSRS        (API)    ( Report Server,  -    HTTP). <br>
</div></div><br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aten√ß√£o, a pergunta: como concluir a tarefa sem m√©todos manuais, com recursos m√≠nimos e benef√≠cios m√°ximos para o cliente? </font></font></b></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o cliente possui o SSRS em um servidor dedicado, deixe o SSRS fazer todo o trabalho sujo de gerar e exportar relat√≥rios. </font><font style="vertical-align: inherit;">Ent√£o n√£o precisamos escrever nosso pr√≥prio servi√ßo de relat√≥rios, exportar m√≥dulos para XLS, PDF, DOCX, HTML e a API correspondente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, a tarefa era fazer o SSRS fazer amizade com o portal e garantir a opera√ß√£o das fun√ß√µes especificadas na tarefa. </font><font style="vertical-align: inherit;">Ent√£o, vamos examinar a lista desses cen√°rios - sutilezas interessantes foram encontradas em quase todos os pontos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estrutura da solu√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° temos o SSRS, existem todas as ferramentas para gerenciar modelos de relat√≥rio: </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor de Relat√≥rio - respons√°vel por toda a l√≥gica de trabalhar com relat√≥rios, seu armazenamento, gera√ß√£o, gerenciamento e muito mais.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gerenciador de relat√≥rios - um servi√ßo com uma interface da web para gerenciar relat√≥rios. </font><font style="vertical-align: inherit;">Aqui voc√™ pode carregar modelos criados no SQL Server Data Tools para o servidor, configurar direitos de acesso, fontes de dados e par√¢metros (incluindo aqueles que podem ser alterados ao relatar solicita√ß√µes). </font><font style="vertical-align: inherit;">Ele √© capaz de gerar relat√≥rios sobre modelos baixados e envi√°-los para v√°rios formatos, incluindo XLS, PDF, DOCX e HTML.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> criamos modelos no SQL Server Data Tools, com a ajuda do Report Manager, os preenchemos no Report Server, configuramos - e est√° pronto. </font><font style="vertical-align: inherit;">Podemos gerar relat√≥rios, alterar seus par√¢metros. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pr√≥xima pergunta: como solicitar a gera√ß√£o de relat√≥rios sobre modelos espec√≠ficos por meio do portal e obter o resultado inicial para sa√≠da na interface do usu√°rio ou fazer o download no formato desejado?</font></font></i></b><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relat√≥rios do SSRS para o portal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dissemos acima, o SSRS possui sua pr√≥pria API para acessar relat√≥rios. Mas n√£o queremos distribuir suas fun√ß√µes por raz√µes de seguran√ßa e higiene digital - precisamos apenas solicitar dados do SSRS na forma correta e transmitir o resultado ao usu√°rio. O gerenciamento de relat√≥rios ser√° tratado por uma equipe de clientes especialmente treinada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o acesso ao SSRS √© apenas da rede local, a troca de dados entre o servidor e o portal √© feita por meio de um servi√ßo proxy. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/kz/f5/9x/kzf59xp7_ltztohtag_orirmn5i.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Troca de dados entre o portal e o servidor</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vamos ver como funciona e por que o ReportProxy est√° aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, no lado do portal, temos um ReportService, que o portal acessa para relat√≥rios. O servi√ßo verifica a autoriza√ß√£o do usu√°rio, o n√≠vel de seus direitos, converte dados do SSRS na forma desejada no contrato.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A API ReportService cont√©m apenas 2 m√©todos, que s√£o suficientes para n√≥s:</font></font><br>
<br>
<ol>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetReports</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fornece os identificadores e nomes de todos os modelos que o usu√°rio atual pode receber;</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetReportData (formato, par√¢metros)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fornece dados de relat√≥rio exportados e prontos no formato especificado, com um determinado conjunto de par√¢metros.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora voc√™ precisa desses 2 m√©todos para poder se comunicar com o SSRS e obter os dados necess√°rios da forma correta. </font><font style="vertical-align: inherit;">A partir da </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o, sabe-se</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que podemos acessar o servidor de relat√≥rio via HTTP usando a API SOAP. </font><font style="vertical-align: inherit;">Parece que o quebra-cabe√ßa est√° se desenvolvendo ... Mas, de fato, uma surpresa nos espera aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o SSRS est√° fechado para o mundo externo e voc√™ pode alcan√ß√°-lo somente atrav√©s da autentica√ß√£o NTLM, ele n√£o est√° dispon√≠vel diretamente no portal SOAP. </font><font style="vertical-align: inherit;">H√° tamb√©m nossos pr√≥prios desejos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conceda acesso apenas ao conjunto de fun√ß√µes necess√°rio e at√© pro√≠ba a altera√ß√£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ precisar mudar para outro sistema de relat√≥rios, as edi√ß√µes no ReportService dever√£o ser m√≠nimas e, melhor, n√£o ser√£o necess√°rias.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â aqui que o ReportProxy nos ajuda, localizado na mesma m√°quina que o SSRS e respons√°vel por solicita√ß√µes de proxy do ReportService para o SSRS. </font><font style="vertical-align: inherit;">O processamento de solicita√ß√µes √© o seguinte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o servi√ßo recebe uma solicita√ß√£o do ReportService, verifica a autoriza√ß√£o da JWT;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de acordo com o m√©todo API, o proxy passa pelo protocolo SOAP no SSRS para obter os dados necess√°rios, efetuando login no NTLM ao longo do caminho;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os dados recebidos do SSRS s√£o enviados de volta ao ReportService em resposta √† solicita√ß√£o.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, o ReportProxy √© um adaptador entre o SSRS e o ReportService. </font></font><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O controlador √© o seguinte:</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">[BasicAuthentication]<font></font>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReportProxyController</span> : <span class="hljs-title">ApiController</span>
</span>{<font></font>
    [HttpGet()]<font></font>
    public List&lt;ReportItem&gt; Get(string rootPath)<font></font>
    {<font></font>
        <span class="hljs-comment">//  ...</span><font></font>
    }<font></font>
<font></font>
    public HttpResponseMessage Post([FromBody]ReportRequest request)<font></font>
    {<font></font>
        <span class="hljs-comment">//  ...</span><font></font>
    }<font></font>
}<font></font>
</code></pre><br>
  BasicAuthentication   :<br>
<br>
<pre><code class="javascript hljs">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicAuthenticationAttribute</span> : <span class="hljs-title">AuthorizationFilterAttribute</span>
</span>{<font></font>
    public override <span class="hljs-keyword">void</span> OnAuthorization(HttpActionContext actionContext)<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> authHeader = actionContext.Request.Headers.Authorization;<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (authHeader != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> authenticationToken = actionContext.Request.Headers.Authorization.Parameter;
            <span class="hljs-keyword">var</span> tokenFromBase64 = Convert.FromBase64String(authenticationToken);
            <span class="hljs-keyword">var</span> decodedAuthenticationToken = Encoding.UTF8.GetString(tokenFromBase64);
            <span class="hljs-keyword">var</span> usernamePasswordArray = decodedAuthenticationToken.Split(<span class="hljs-string">':'</span>);
            <span class="hljs-keyword">var</span> userName = usernamePasswordArray[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> password = usernamePasswordArray[<span class="hljs-number">1</span>];<font></font>
<font></font>
            <span class="hljs-keyword">var</span> isValid = userName == BasiAuthConf.Login &amp;&amp; password == BasiAuthConf.Password;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (isValid)<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> principal = <span class="hljs-keyword">new</span> GenericPrincipal(<span class="hljs-keyword">new</span> GenericIdentity(userName), <span class="hljs-literal">null</span>);<font></font>
                Thread.CurrentPrincipal = principal;<font></font>
<font></font>
                <span class="hljs-keyword">return</span>;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        HandleUnathorized(actionContext);<font></font>
    }<font></font>
<font></font>
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> HandleUnathorized(HttpActionContext actionContext)<font></font>
    {<font></font>
        actionContext.Response = actionContext.Request.CreateResponse(<font></font>
            HttpStatusCode.Unauthorized<font></font>
        );<font></font>
<font></font>
        actionContext.Response.Headers.Add(<font></font>
            <span class="hljs-string">"WWW-Authenticate"</span>, <span class="hljs-string">"Basic Scheme='Data' location = 'http://localhost:"</span><font></font>
        );<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, o processo fica assim:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A frente envia uma solicita√ß√£o http para ReportService;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReportService envia uma solicita√ß√£o http para ReportProxy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O ReportProxy atrav√©s da interface SOAP recebe dados do SSRS e envia o resultado ao ReportService;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O ReportService traz o resultado de acordo com o contrato e o entrega ao cliente.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos um sistema operacional que solicita uma lista de modelos dispon√≠veis, acessa o SSRS para relat√≥rios e os apresenta √† frente em todos os formatos suportados. </font><font style="vertical-align: inherit;">Agora voc√™ precisa exibir os relat√≥rios gerados na frente, de acordo com os par√¢metros especificados, dar a oportunidade de envi√°-los para arquivos XLS, PDF, DOCX e imprimir. </font><font style="vertical-align: inherit;">Vamos come√ßar com a exibi√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhando com relat√≥rios do SSRS no portal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä primeira vista, √© uma quest√£o cotidiana - o relat√≥rio √© fornecido em formato HTML, para que possamos fazer o que quisermos com ele! </font><font style="vertical-align: inherit;">Vamos incorpor√°-lo √† p√°gina, pint√°-lo com estilos de design, e a coisa est√° no chap√©u. </font><font style="vertical-align: inherit;">De fato, houve armadilhas suficientes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com o conceito de design, a se√ß√£o de relat√≥rios no portal deve consistir em duas p√°ginas: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) uma lista de modelos onde podemos:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualizar estat√≠sticas de atividades para todo o portal;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veja todos os modelos dispon√≠veis para n√≥s;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clique no modelo desejado e v√° para o gerador de relat√≥rios correspondente.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/yx/tp/1h/yxtp1h3tvvpujymptptca2gcyew.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) um gerador de relat√≥rios que nos permite:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defina os par√¢metros do modelo e crie um relat√≥rio sobre eles;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">veja o que aconteceu como resultado;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selecione o formato do arquivo de sa√≠da, fa√ßa o download;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imprima o relat√≥rio de forma conveniente e visual.</font></font></li>
</ul><br>
 <img src="https://habrastorage.org/webt/au/ct/2f/auct2fiklpvvfad6vpbovv0xat0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o houve problemas especiais com a primeira p√°gina, por isso n√£o vamos considerar mais. </font><font style="vertical-align: inherit;">E o gerador de relat√≥rios nos for√ßou a ligar o engenheiro, para que fosse conveniente que pessoas reais usassem todas as fun√ß√µes no TK.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema n√∫mero 1. </font><font style="vertical-align: inherit;">Mesas gigantes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acordo com o conceito de design, esta p√°gina deve ter uma √°rea de visualiza√ß√£o para que o usu√°rio possa ver seu relat√≥rio antes de exportar. Se o relat√≥rio n√£o couber na janela, voc√™ pode rolar horizontal e verticalmente. Ao mesmo tempo, um relat√≥rio t√≠pico pode atingir tamanhos de v√°rias telas, o que significa que precisamos colar blocos com os nomes de linhas e colunas. Sem isso, os usu√°rios ter√£o que retornar constantemente ao topo da tabela para lembrar o que significa uma c√©lula espec√≠fica. Ou, em geral, ser√° mais f√°cil imprimir um relat√≥rio e manter constantemente as folhas necess√°rias diante dos seus olhos, mas a tabela na tela simplesmente perde seu significado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, os blocos colantes n√£o podem ser evitados. E o SSRS 2014 n√£o sabe como corrigir linhas e colunas em um documento MHTML - apenas em sua pr√≥pria interface da web.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, lembramos que os navegadores modernos suportam a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">propriedade adesiva CSS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que apenas fornece a fun√ß√£o que precisamos. Colocamos a posi√ß√£o: pegajosa no bloco marcado, especifica o recuo √† esquerda ou na parte superior (propriedades esquerda, superior) e o bloco permanecer√° no lugar durante a rolagem horizontal e vertical. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ precisa encontrar um par√¢metro que o CSS possa capturar. Valores de c√©lula personalizados que permitem que o SSRS 2014 os capture na interface da Web s√£o perdidos ao exportar para HTML. OK, vamos marc√°-los n√≥s mesmos - s√≥ entender√≠amos como.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de v√°rias horas lendo a documenta√ß√£o e as discuss√µes com os colegas, parecia que n√£o havia op√ß√µes. E aqui, de acordo com todas as leis da plotagem, o campo Dica de ferramenta apareceu para n√≥s, o que nos permite especificar dicas de ferramentas para c√©lulas. Descobriu-se que ele √© lan√ßado no c√≥digo HTML exportado no atributo dica de ferramenta - exatamente na marca que pertence √† c√©lula personalizada no SQL Server Data Tools. N√£o houve escolha - n√£o encontramos outra maneira de marcar as c√©lulas para fixa√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, voc√™ precisa criar regras de marca√ß√£o e encaminhar marcadores em HTML via ToolTip. Em seguida, usando JS, alteramos o atributo dica de ferramenta para a classe CSS no marcador especificado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem apenas duas maneiras de corrigir c√©lulas: verticalmente (coluna fixa) e horizontalmente (linha fixa). </font><font style="vertical-align: inherit;">Faz sentido colocar outro marcador nas c√©lulas dos cantos, que permanecem no lugar ao rolar nas duas dire√ß√µes - fixa-ambas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo passo √© fazer a interface do usu√°rio. </font><font style="vertical-align: inherit;">Ao receber um documento HTML, voc√™ precisa encontrar todos os elementos HTML com marcadores, reconhecer os valores, definir a classe CSS apropriada e remover o atributo dica de ferramenta para que ele n√£o saia quando voc√™ passa o mouse sobre o mouse. </font><font style="vertical-align: inherit;">Note-se que a marca√ß√£o resultante consiste em tabelas aninhadas (tags de tabela).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ver c√≥digo</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs">type FixationType = <span class="hljs-string">'row'</span> | <span class="hljs-string">'column'</span> | <span class="hljs-string">'both'</span>;<font></font>
<font></font>
init(reportHTML: HTMLElement) {<font></font>
    <span class="hljs-comment">//    </span><font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">const</span> rowsFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="RowFixed"]'</span>);
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">const</span> columnFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="ColumnFixed"]'</span>);
    <span class="hljs-comment">// -    </span>
    <span class="hljs-keyword">const</span> bothFixed: NodeList = reportHTML.querySelectorAll(<span class="hljs-string">'[title^="BothFixed"]'</span>);<font></font>
<font></font>
    <span class="hljs-keyword">this</span>.prepare(rowsFixed, <span class="hljs-string">'row'</span>);
    <span class="hljs-keyword">this</span>.prepare(columnFixed, <span class="hljs-string">'column'</span>);
    <span class="hljs-keyword">this</span>.prepare(bothFixed, <span class="hljs-string">'both'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//    </span>
prepare(nodeList: NodeList, <span class="hljs-attr">fixingType</span>: FixationType) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; nodeList.length; i++) {
        <span class="hljs-keyword">const</span> element: HTMLElement = nodeList[i];
        <span class="hljs-comment">//   -</span>
        element.classList.add(fixingType + <span class="hljs-string">'-fixed'</span>);<font></font>
<font></font>
        element.removeAttribute(<span class="hljs-string">'title'</span>);<font></font>
        element.removeAttribute(<span class="hljs-string">'alt'</span>); <span class="hljs-comment">//   SSRS</span><font></font>
<font></font>
        element.parentElement.classList.add(fixingType  + <span class="hljs-string">'-fixed-parent'</span>);<font></font>
<font></font>
        <span class="hljs-comment">//     ,     </span>
        element.style.width = element.getBoundingClientRect().width  + <span class="hljs-string">'px'</span>;
        <span class="hljs-comment">//     ,     </span>
        element.style.height = element.getBoundingClientRect().height  + <span class="hljs-string">'px'</span>;<font></font>
<font></font>
        <span class="hljs-comment">//  </span>
        <span class="hljs-keyword">this</span>.calculateCellCascadeParams(element, fixingType);<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E aqui est√° um novo problema: com o comportamento em cascata, quando v√°rios blocos que se movem em uma dire√ß√£o s√£o fixados ao mesmo tempo na tabela, as c√©lulas que v√£o uma ap√≥s a outra s√£o colocadas em camadas. </font><font style="vertical-align: inherit;">Ao mesmo tempo, n√£o est√° claro quanto cada pr√≥ximo bloco deve recuar - os recuos ter√£o que ser calculados via JavaScript com base na altura do bloco √† sua frente. </font><font style="vertical-align: inherit;">Tudo isso se aplica √†s √¢ncoras verticais e horizontais.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O script de corre√ß√£o resolveu o problema.</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-comment">//      </span>
calculateCellCascadeParams(cell: HTMLElement, <span class="hljs-attr">fixationType</span>: FixationType) {
    <span class="hljs-keyword">const</span> currentTD: HTMLTableCellElement = cell.parentElement;
    <span class="hljs-keyword">const</span> currentCellIndex = currentTD.cellIndex;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    currentTD.style.left = <span class="hljs-string">''</span>;<font></font>
    currentTD.style.top = <span class="hljs-string">''</span>;<font></font>
<font></font>
    <span class="hljs-keyword">const</span> currentTDStyles = getComputedStyle(currentTD);<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (fixationType === <span class="hljs-string">'row'</span> || fixationType === <span class="hljs-string">'both'</span>) {
        <span class="hljs-keyword">const</span> parentRow: HTMLTableRowElement = currentTD.parentElement;<font></font>
<font></font>
        <span class="hljs-comment">//        </span>
        <span class="hljs-comment">//    .</span>
        <span class="hljs-comment">//   ,    .</span>
        <span class="hljs-keyword">let</span> previousRow: HTMLTableRowElement = parentRow;
        <span class="hljs-keyword">let</span> topOffset = <span class="hljs-number">0</span>;<font></font>
<font></font>
        <span class="hljs-keyword">while</span> (previousRow = previousRow.previousElementSibling) {
            <span class="hljs-keyword">let</span> previousCellIndex = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">let</span> cellIndexBulk = <span class="hljs-number">0</span>;<font></font>
<font></font>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; previousRow.cells.length; i++) {
                <span class="hljs-keyword">if</span> (previousRow.cells[i].colSpan &gt; <span class="hljs-number">1</span>) {<font></font>
                    cellIndexBulk += previousRow.cells[i].colSpan;<font></font>
                } <span class="hljs-keyword">else</span> {<font></font>
                    cellIndexBulk += <span class="hljs-number">1</span>;<font></font>
                }<font></font>
<font></font>
                <span class="hljs-keyword">if</span> ((cellIndexBulk - <span class="hljs-number">1</span>) &gt;= currentCellIndex) {<font></font>
                    previousCellIndex = i;<font></font>
                    <span class="hljs-keyword">break</span>;<font></font>
                }<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">const</span> previousCell = previousRow.cells[previousCellIndex];<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (previousCell.classList.contains(fixationType + <span class="hljs-string">'_fixed_parent'</span>)) {<font></font>
                topOffset += previousCell.getBoundingClientRect().height;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (topOffset &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (currentTDStyles.top) {<font></font>
                topOffset += &lt;any&gt;currentTDStyles.top.replace('px', '') - 0;<font></font>
            }<font></font>
<font></font>
            currentTD.style.top = topOffset + 'px';<font></font>
        }<font></font>
    }<font></font>
<font></font>
    //  <font></font>
    if (fixationType === 'column' || fixationType === 'both') {<font></font>
        //       <font></font>
        //     .<font></font>
        //   ,    .<font></font>
        let previousCell: HTMLTableCellElement = currentTD;<font></font>
        let leftOffset = 0;<font></font>
<font></font>
        while (previousCell = previousCell.previousElementSibling) {<font></font>
            if (previousCell.classList.contains(fixationType + '_fixed_parent')) {<font></font>
                leftOffset += previousCell.getBoundingClientRect().width;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        if (leftOffset &gt; 0) {<font></font>
            if (currentTDStyles.left) {<font></font>
                leftOffset += &lt;any&gt;currentTDStyles.left.replace('px', '') - 0;<font></font>
            }<font></font>
<font></font>
            currentTD.style.left = leftOffset + 'px';<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O c√≥digo verifica as tags dos elementos marcados e adiciona os par√¢metros das c√©lulas fixas ao valor do recuo. </font><font style="vertical-align: inherit;">No caso de linhas aderentes, sua altura √© somada, para colunas, sua largura. </font></font><br>
 <br>
<img src="https://habrastorage.org/webt/vj/ix/bf/vjixbfnbewh6_pb3smfcogdpevc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo de relat√≥rio com uma linha superior fixa,</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
como resultado, o processo √© semelhante a este:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s obtemos a marca√ß√£o do SSRS e colamos no lugar certo no DOM;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reconhecer marcadores;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajuste os par√¢metros para o comportamento em cascata.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o comportamento de ader√™ncia √© totalmente implementado por meio do CSS, e o JS est√° envolvido apenas na prepara√ß√£o do documento recebido, a solu√ß√£o funciona com rapidez suficiente e sem atrasos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, para o IE, os blocos aderentes tiveram que ser desativados porque </font><font style="vertical-align: inherit;">n√£o suporta a posi√ß√£o: propriedade pegajosa. </font><font style="vertical-align: inherit;">O restante - Safari, Mozilla Firefox e Chrome - faz um excelente trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ir em frente.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema n√∫mero 2. </font><font style="vertical-align: inherit;">Exporta√ß√£o de relat√≥rios</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para retirar um relat√≥rio do sistema, voc√™ deve (1) acessar o SSRS via ReportService para um objeto Blob, (2) obter um link para o objeto atrav√©s da interface usando o m√©todo window.URL.createObjectURL, (3) colocar o link na tag e simular um clique para upload de arquivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso funciona no Firefox, Safari e em todas as vers√µes do Chrome, exceto a Apple. Para que o IE, Edge e Chrome para iOS tamb√©m suportassem a fun√ß√£o, eu tive que jogar meu c√©rebro de volta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No IE e Edge, o evento simplesmente n√£o acionar√° uma solicita√ß√£o do navegador para baixar o arquivo. Esses navegadores possuem um recurso que, para simular um clique, √© necess√°ria a confirma√ß√£o do usu√°rio para fazer o download, al√©m de uma indica√ß√£o clara de outras a√ß√µes. A solu√ß√£o foi encontrada no m√©todo window.navigator.msSaveOrOpenBlob (), dispon√≠vel no IE e no Edge. Ele apenas sabe como pedir permiss√£o ao usu√°rio para a opera√ß√£o e esclarecer o que fazer em seguida. Portanto, determinamos se o m√©todo window.navigator.msSaveOrOpenBlob existe e atuamos na situa√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Chrome no iOS n√£o teve esse tipo de hack e, em vez de um relat√≥rio, temos apenas uma p√°gina em branco. </font><font style="vertical-align: inherit;">Vagando pela Web, encontramos uma hist√≥ria semelhante, a julgar pela qual no iOS 13 esse bug deveria ter sido corrigido. </font><font style="vertical-align: inherit;">Infelizmente, escrevemos o aplicativo nos dias do iOS 12, por isso decidimos n√£o perder mais tempo e simplesmente desligamos o bot√£o no Chrome para iOS. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, sobre como √© o processo final de exporta√ß√£o para a interface do usu√°rio. </font><font style="vertical-align: inherit;">H√° um bot√£o no componente de relat√≥rio Angular que inicia uma cadeia de etapas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atrav√©s dos par√¢metros do evento, o manipulador recebe o identificador do formato de exporta√ß√£o (por exemplo, ‚ÄúPDF‚Äù);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envia uma solicita√ß√£o ao ReportService para receber um objeto Blob para o formato especificado;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verifica se o navegador √© IE ou Edge;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quando a resposta vier do ReportService:</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se for IE ou Edge, chama window.navigator.msSaveOrOpenBlob (fileStream, fileName);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caso contr√°rio, ele chamar√° o m√©todo this.exportDownload (fileStream, fileName), em que fileStream √© o Blob obtido da consulta ao ReportService e fileName √© o nome do arquivo a ser salvo. </font><font style="vertical-align: inherit;">O m√©todo cria uma marca oculta com um link para window.URL.createObjectURL (fileStream), simula um clique e remove a marca.</font></font></li>
</ul></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com isso resolvido, a √∫ltima aventura permaneceu.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problema n√∫mero 3. </font><font style="vertical-align: inherit;">Imprimir</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora podemos ver o relat√≥rio no portal e export√°-lo para os formatos XLS, PDF e DOCX. </font><font style="vertical-align: inherit;">Resta implementar a impress√£o do documento para obter um relat√≥rio preciso de v√°rias p√°ginas. </font><font style="vertical-align: inherit;">Se a tabela acabou sendo dividida em p√°ginas, cada uma delas deve conter cabe√ßalhos - os mesmos blocos que mencionamos na se√ß√£o anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A op√ß√£o mais f√°cil √© pegar a p√°gina atual com o relat√≥rio exibido, ocultar tudo sup√©rfluo usando CSS e envi√°-la para impress√£o usando o m√©todo window.print (). </font><font style="vertical-align: inherit;">Este m√©todo n√£o funciona imediatamente por v√°rios motivos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Årea de visualiza√ß√£o n√£o padr√£o - o pr√≥prio relat√≥rio est√° contido em uma √°rea de rolagem separada, para que a p√°gina n√£o se estenda a dimens√µes horizontais incr√≠veis. </font><font style="vertical-align: inherit;">Usar window.print () corta o conte√∫do que n√£o se ajusta √† tela;</font></font></li>
<li>   ,      ;</li>
<li>     ,       .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso pode ser corrigido usando JS e CSS, mas decidimos economizar tempo para os desenvolvedores e procurar uma alternativa para window.print (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O SSRS pode nos fornecer imediatamente um PDF pronto com uma pagina√ß√£o apresent√°vel. Isso nos salva de todas as dificuldades da vers√£o anterior, a √∫nica pergunta √©: podemos imprimir o PDF atrav√©s de um navegador? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o PDF √© um padr√£o de terceiros, os navegadores o suportam por meio de v√°rios plugins do visualizador. Sem plug-in - sem desenhos, ent√£o, novamente, precisamos de uma op√ß√£o alternativa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E se voc√™ colocar o PDF na p√°gina como uma imagem e enviar esta p√°gina para impress√£o? J√° existem bibliotecas e componentes para o Angular que fornecem essa renderiza√ß√£o. Pesquisado, experimentado, implementado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o lidar com os dados que n√£o queremos imprimir, foi decidido transferir o conte√∫do renderizado para uma nova p√°gina e j√° executar window.print (). </font><font style="vertical-align: inherit;">Como resultado, todo o processo √© o seguinte:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solicite o ReportService para exportar o relat√≥rio em formato PDF;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtemos o objeto Blob, convertemos para um URL (URL.createObjectURL (fileStream)), fornecemos o URL para o visualizador de PDF para renderiza√ß√£o;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiramos imagens do visualizador de PDF;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra uma nova p√°gina e adicione uma pequena marca√ß√£o l√° (t√≠tulo, um pequeno recuo);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione a imagem do visualizador de PDF √† marca√ß√£o, chame window.print ().</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s v√°rias verifica√ß√µes, tamb√©m apareceu na p√°gina um c√≥digo JS que, antes da impress√£o, verifica se todas as imagens foram carregadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, toda a apar√™ncia do documento √© determinada pelos par√¢metros do modelo SSRS, e a interface do usu√°rio n√£o interfere nesse processo. </font><font style="vertical-align: inherit;">Isso reduz o n√∫mero de poss√≠veis erros. </font><font style="vertical-align: inherit;">Como as imagens est√£o sendo transferidas para impress√£o, estamos seguros contra qualquer dano ou deforma√ß√£o do layout. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m desvantagens:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um relat√≥rio grande pesar√° muito, o que afetar√° adversamente as plataformas m√≥veis;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o design n√£o √© atualizado automaticamente - cores, fontes e outros elementos do design precisam ser instalados no n√≠vel do modelo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, a adi√ß√£o frequente de novos modelos n√£o era esperada, portanto a solu√ß√£o era aceit√°vel. </font><font style="vertical-align: inherit;">O desempenho m√≥vel foi tomado como garantido.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A √∫ltima palavra</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, um projeto regular mais uma vez nos faz procurar solu√ß√µes simples para tarefas n√£o triviais. </font><font style="vertical-align: inherit;">O produto final atende totalmente aos requisitos de design e fica bonito. </font><font style="vertical-align: inherit;">E o mais importante, embora n√£o precis√°ssemos procurar os m√©todos de implementa√ß√£o mais √≥bvios, a tarefa foi conclu√≠da mais rapidamente do que se adot√°ssemos o m√≥dulo de relat√≥rio original com todas as consequ√™ncias. </font><font style="vertical-align: inherit;">E, no final, conseguimos nos concentrar nos objetivos de neg√≥cios do projeto.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487690/index.html">PHP Digest No. 173 (27 de janeiro a 10 de fevereiro de 2020)</a></li>
<li><a href="../pt487694/index.html">Como o Yandex.Cloud √© hospedado pela Virtual Private Cloud e como nossos usu√°rios nos ajudam a implementar recursos √∫teis</a></li>
<li><a href="../pt487696/index.html">Eventos digitais em Moscou, de 10 a 16 de fevereiro</a></li>
<li><a href="../pt487698/index.html">Eventos digitais em S√£o Petersburgo, de 10 a 16 de fevereiro</a></li>
<li><a href="../pt487702/index.html">Uma sele√ß√£o de artigos sobre aprendizado de m√°quina: estudos de caso, guias e pesquisas para janeiro de 2020</a></li>
<li><a href="../pt487706/index.html">Service Discovery em sistemas distribu√≠dos usando o exemplo Consul. Alexander Sigachev</a></li>
<li><a href="../pt487716/index.html">Perfeito SAST. Analisador</a></li>
<li><a href="../pt487720/index.html">Sobre corutinismo competitivo (usando programa√ß√£o reativa como exemplo)</a></li>
<li><a href="../pt487724/index.html">BlazingPizza: aplicativo Blazor do in√≠cio ao fim. Parte 2. Adicione um componente</a></li>
<li><a href="../pt487728/index.html">@Pythonetc compilation, janeiro 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>