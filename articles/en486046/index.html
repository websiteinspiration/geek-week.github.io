<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧓🏽 👝 🍻 Linux kernel included WireGuard VPN 🧜🏻 🎊 👐🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, Linus has migrated its net-next branch with WireGuard VPNs . This event was reported on the WireGuard mailing list. 
 
 
 
 Currently, code col...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Linux kernel included WireGuard VPN</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/486046/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Today, Linus has </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">migrated</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> its net-next branch with </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">WireGuard VPNs</font></a><font style="vertical-align: inherit;"> . This event was </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reported</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on the WireGuard mailing list. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kp/qj/lf/kpqjlfg-kigwemsvbuzdegg_ira.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Currently, code collection continues for the new Linux 5.6 kernel. WireGuard is a new generation fast VPN that incorporates modern cryptography. It was originally developed as a simpler and more convenient alternative to existing VPNs. The author is Canadian information security specialist Jason A. Donenfeld. In August 2018, WireGuard </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">was praised</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by Linus Torvalds. Around the time, work began on incorporating a VPN into the Linux kernel. The process was a little delayed.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
“I see that Jason did a pool request to include WireGuard in the core,” Linus wrote on August 2, 2018. - Can I just once again declare my love for this VPN and hope for a speedy merger? The code may not be perfect, but I looked at it, and compared to the horrors of OpenVPN and IPSec, this is a real work of art. ” </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite the wishes of Linus, the merger dragged on for a year and a half. The main problem turned out to be tied to their own implementations of cryptographic functions, which were used to increase productivity. After lengthy negotiations, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">a compromise decision</font></a><font style="vertical-align: inherit;"> was </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">made</font></a><font style="vertical-align: inherit;"> in September 2019.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">translate patches to the core functions of the Crypto API, which WireGuard developers have complaints about in terms of performance and general security. But they decided to wire the native WireGuard crypto functions into a separate low-level Zinc API and eventually port them to the kernel. In November, the core developers kept their promise and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agreed</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to transfer part of the code from Zinc to the main core. For example, the Crypto API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">includes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WireGuard-prepared fast implementations of the ChaCha20 and Poly1305 algorithms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the end, on December 9, 2019, David S. Miller, responsible for the Linux kernel networking subsystem, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepted </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">patches</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with the implementation of the VPN interface from the WireGuard project </font><font style="vertical-align: inherit;">into the net-next </font><font style="vertical-align: inherit;">branch.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And today, January 29, 2020, the changes went to Linus for inclusion in the kernel. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/c4e/f99/656/c4ef99656b0c2b9db9e69c30f2d16461.svg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The declared advantages of WireGuard over other VPN solutions:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Easy to use.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uses modern cryptography: Noise protocol framework, Curve25519, ChaCha20, Poly1305, BLAKE2, SipHash24, HKDF, etc.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compact readable code, easier to investigate for vulnerabilities.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">High performance.</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clear and detailed </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All the core logic of WireGuard takes up less than 4000 lines of code, while OpenVPN and IPSec are hundreds of thousands of lines. </font></font><br>
<br>
<blockquote>« WireGuard      ,               .           SSH.               Noise_IK  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Noise Protocol Framework</a>,    authorized_keys  SSH.        UDP.   IP- VPN- ()       , — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a> Opennet.<br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">ChaCha20</a>     (MAC) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Poly1305</a>,    (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Daniel J. Bernstein</a>),   (Tanja Lange)    (Peter Schwabe). ChaCha20  Poly1305        AES-256-CTR  HMAC,             .        -      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">Curve25519</a>,    .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">BLAKE2s (RFC7693)</a>».</blockquote><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance test</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
results </font><font style="vertical-align: inherit;">from the official website: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bandwidth (megabits / s) </font></font></b> <br>
<img src="https://habrastorage.org/webt/0p/10/cx/0p10cxvt-fv9qx2ohcgo4urzgwc.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ping (ms)</font></font></b> <br>
<img src="https://habrastorage.org/webt/av/v7/f-/avv7f-woayzkqjhd5zdtsn9hqqw.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Test configuration:</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel Core i7-3820QM and Intel Core i7-5200U</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gigabit Intel 82579LM and Intel I218LM cards</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 4.6.1</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WireGuard Configuration: 256-Bit ChaCha20 with Poly1305 for MAC</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPsec First Configuration: 256-bit ChaCha20 with Poly1305 for MAC</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Second IPsec Configuration: AES-256-GCM-128 (with AES-NI)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVPN Configuration: Equivalent 256-bit AES Encryption Set with HMAC-SHA2-256, UDP Mode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Performance was measured using </font></font><code>iperf3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the average result for 30 minutes is shown.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Theoretically, after integration into the network stack, WireGuard should work even faster. But in reality, this will not necessarily be the case due to the transition to the cryptographic functions built into the kernel of the Crypto API. Perhaps not all of them are still optimized to the performance level of the native WireGuard.</font></font><br>
<br>
<blockquote>«   , WireGuard    .      ,     VPN     .     , — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>    2018 .&nbsp;—   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> </a>   ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="> OpenWRT</a>.               .          ,       SSH-».</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The WireGuard project has been developing since 2015, it has passed an audit and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formal verification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">WireGuard support is integrated into NetworkManager and systemd, and kernel patches are part of the basic distributions of Debian Unstable, Mageia, Alpine, Arch, Gentoo, OpenWrt, NixOS, Subgraph, and ALT.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/en486046/">https://habr.com/ru/post/en486046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en486032/index.html">How to become a dialog designer</a></li>
<li><a href="../en486034/index.html">Quick entry to product management through Open source</a></li>
<li><a href="../en486036/index.html">Text sentiment analysis on Node.js</a></li>
<li><a href="../en486040/index.html">1. CheckFlow - fast and free comprehensive audit of internal network traffic using Flowmon</a></li>
<li><a href="../en486042/index.html">Messengers and telecom legislation</a></li>
<li><a href="../en486050/index.html">Webix JavaScript library through the eyes of a beginner. Part 3. Modules, diagrams, tree tables</a></li>
<li><a href="../en486052/index.html">Scorched Earth is the mother of all games. Interview with the creator</a></li>
<li><a href="../en486056/index.html">From scripts to our own platform: how we automated development at the Cyan Institute</a></li>
<li><a href="../en486058/index.html">Robot beasts, lesson plans, and new details: an overview of the LEGO Education SPIKE Prime</a></li>
<li><a href="../en486060/index.html">Find Order in the Chaos of IT: Organizing Your Own Development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>