<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯУ╜я╕П ЁЯд╢ЁЯП╛ ЁЯЫМЁЯП╜ OpenVPN рдкрд░ рджреВрд░рд╕реНрде рдХрд╛рд░реНрдп SMB рд╕рдВрдЧрдарди рдХрд╛ рд╕рдВрдЧрдарди ЁЯд▓ ЁЯПЙ ЁЯИ╡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдирд┐рд░реВрдкрдг
 рд▓реЗрдЦ рдореЗрдВ рдУрдкрди рд╕реЛрд░реНрд╕ рдЙрддреНрдкрд╛рджреЛрдВ рдкрд░ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд░рд┐рдореЛрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд╕рдВрдЧрдарди рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрд╡рд╛рдпрддреНрдд рдкреНрд░рдгрд╛...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>OpenVPN рдкрд░ рджреВрд░рд╕реНрде рдХрд╛рд░реНрдп SMB рд╕рдВрдЧрдарди рдХрд╛ рд╕рдВрдЧрдарди</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501048/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдирд┐рд░реВрдкрдг</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдЦ рдореЗрдВ рдУрдкрди рд╕реЛрд░реНрд╕ рдЙрддреНрдкрд╛рджреЛрдВ рдкрд░ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд░рд┐рдореЛрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд╕рдВрдЧрдарди рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрд╡рд╛рдпрддреНрдд рдкреНрд░рдгрд╛рд▓реА рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╡рд┐рд╕реНрддрд╛рд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ рдЬрдм рдХрд┐рд╕реА рдореМрдЬреВрджрд╛ рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдХреА рдХрдореА рд╣реИ рдпрд╛ рдЗрд╕рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдЕрдкрд░реНрдпрд╛рдкреНрдд рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдЦ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдХрд┐рд╕реА рд╕рдВрдЧрдарди рдХреЛ рджреВрд░рд╕реНрде рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдкреВрд░реНрдг рдкреНрд░рдгрд╛рд▓реА рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реИ, рдЬреЛ "10 рдорд┐рдирдЯ рдореЗрдВ рдУрдкрдирд╡реАрдкреАрдПрди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ" рд╕реЗ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирддреАрдЬрддрди, рд╣рдореЗрдВ рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдорд┐рд▓рддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдФрд░ (рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ) рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдПрдЧреАред рд╕реЗрд╡рд╛ред рд╣рдореЗрдВ рджреЛ рд╕рддреНрдпрд╛рдкрди рдХрд╛рд░рдХреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдорд┐рд▓рддреА рд╣реИ - рдореЗрд░реЗ рдкрд╛рд╕ рдХреНрдпрд╛ рд╣реИ (рдкреНрд░рдорд╛рдг рдкрддреНрд░) рдФрд░ рдЬреЛ рдореБрдЭреЗ рдкрддрд╛ рд╣реИ (рдкрд╛рд╕рд╡рд░реНрдб)ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рд╕рдВрдХреЗрдд рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рд╡рд╣ myVPNUsr рд╕рдореВрд╣ рдореЗрдВ рдЙрд╕рдХреА рд╕рджрд╕реНрдпрддрд╛ рд╣реИред рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЕрдереЙрд░рд┐рдЯреА рдХрд╛ рд╕реНрдЯреИрдВрдбрдЕрд▓реЛрди рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдорд╛рдзрд╛рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рд▓рд╛рдЧрдд рдХреЗрд╡рд▓ рдЫреЛрдЯреЗ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕рдВрд╕рд╛рдзрди рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ 1 рдШрдВрдЯреЗ рдХрд╛ рдХрд╛рдо рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо CetntOS 7 рдкрд░ рдУрдкрдирд╡реАрдкреАрдПрди рдФрд░ рдИрдЬрд╝реА-рдЖрд░рдПрд╕рдП 3 рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЬреЛ 4 рд╡реАрд╕реАрдкреАрдпреВ, 4 рдЬреАрдИрдмреА рд░реИрдо рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП 100 рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдорд╛рд░реЗ рд╕рдВрдЧрдарди рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ 172.16.0.0/16 рд╣реИ, рдЬрд┐рд╕рдореЗрдВ 172.16.19.123 рдкрддреЗ рдХреЗ рд╕рд╛рде рд╡реАрдкреАрдПрди рд╕рд░реНрд╡рд░ 172.16.19.0/24 рд╕реЗрдЧрдореЗрдВрдЯ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИ, DNS рд╕рд░реНрд╡рд░ 172.16.16.16 рдФрд░ 172.16.17 рд╣реИрдВ, рдФрд░ рд╕рдмрдиреЗрдЯ 172.16.20.0/23 рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмрд╛рд╣рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреЛрд░реНрдЯ 1194 / udp рдкрд░ рдПрдХ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рд╣рдорд╛рд░реЗ рд╕рд░реНрд╡рд░ рдХреЗ DNS рдореЗрдВ A-record gw.abc.ru рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рджреГрдврд╝рддрд╛ рд╕реЗ SELinux рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд╢рдВрд╕рд┐рдд рдирд╣реАрдВ рд╣реИ! </font><font style="vertical-align: inherit;">OpenVPN рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЕрдХреНрд╖рдо рдХрд┐рдП рдмрд┐рдирд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдордЧреНрд░реА</font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OS рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рд╕реЗрдЯрд┐рдВрдЧ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVPN рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдЬреНрдЮрд╛рдкрди рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЙрдиреНрдЪ рдФрд░ рдбрд╛рдпрдЧреНрдиреЛрд╕реНрдЯрд┐рдХреНрд╕</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЬрд╛рд░реА рдХрд░рдирд╛ рдФрд░ рдирд┐рд░рд╕реНрдд рдХрд░рдирд╛</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреЗрдЯрд╡рд░реНрдХ рд╡рд┐рдиреНрдпрд╛рд╕</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реЛрдЧрд╛</font></font></a></li>
</ol><br>
<a name="setup"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OS рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рд╡рд┐рддрд░рдг рдХрд┐рдЯ CentOS 7.8.2003 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдиреНрдпреВрдирддрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдУрдПрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдХрд╕реНрдЯрд╛рд░реНрдЯ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдРрд╕рд╛ рдХрд░рдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ </font><font style="vertical-align: inherit;">, рдкрд╣рд▓реЗ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд OS рдЫрд╡рд┐, рдФрд░ рдЕрдиреНрдп рд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдХреНрд▓реЛрдирд┐рдВрдЧред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ (рдХрд╛рд░реНрдп 172.16.19.123 рдХреА рд╢рд░реНрддреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░) рдХреЗ рд▓рд┐рдП рдПрдХ рдкрддрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛, рд╣рдо рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum update -y &amp;&amp; reboot
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реА рдорд╢реАрди рдкрд░ рд╕рдордп рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдореБрдЦреНрдп рд╕рдВрдкрд╛рджрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдУрдкрдирд╡реАрдкреАрдПрди, рдУрдкрдирд╡реАрдПрдирдкреАрдПрди-рд▓реЙрд░рдк, рдЖрд╕рд╛рди-рдЖрд░рдПрд╕рдП рдФрд░ рд╡реАрдЖрдИрдПрдо рдкреИрдХреЗрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ (рдЖрдкрдХреЛ рдИрдкреАрдИрдПрд▓ рднрдВрдбрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА)ред</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install epel-release<font></font>
$ sudo yum install openvpn openvpn-auth-ldap easy-rsa vim<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХреЗ рд▓рд┐рдП, рдЕрддрд┐рдерд┐ рдПрдЬреЗрдВрдЯ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реИ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install open-vm-tools</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VMware ESXi рд╣реЛрд╕реНрдЯ рдХреЗ рд▓рд┐рдП, рдпрд╛ oVirt рдХреЗ рд▓рд┐рдП</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo yum install ovirt-guest-agent</code></pre><br>
<a name="crypto"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рд╕реЗрдЯрд┐рдВрдЧ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрд╕рд╛рди-рд░реЗрд╕рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдЬрд╛рдПрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">$ <span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдЪрд░ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim vars</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА:</font></font><br>
<br>
<pre><code class="plaintext hljs">export KEY_COUNTRY="RU"<font></font>
export KEY_PROVINCE="MyRegion"<font></font>
export KEY_CITY="MyCity"<font></font>
export KEY_ORG="ABC LLC"<font></font>
export KEY_EMAIL="admin@abc.ru"<font></font>
export KEY_CN="allUsers"<font></font>
export KEY_OU="allUsers"<font></font>
export KEY_NAME="gw.abc.ru"<font></font>
export KEY_ALTNAMES="abc-openvpn-server"<font></font>
export EASYRSA_CERT_EXPIRE=3652<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдмреАрд╕реА рдПрд▓рдПрд▓рд╕реА рдХреЗ рд╕рд╢рд░реНрдд рд╕рдВрдЧрдарди рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдпрд╣рд╛рдВ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХреЗ рд▓рд┐рдП рд╕рд╣реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдорд╛рдкрджрдВрдбреЛрдВ рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЪреАрдЬ рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рд╣реИ, рдЬреЛ рджрд┐рдиреЛрдВ рдореЗрдВ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреА рд╡реИрдзрддрд╛ рдЕрд╡рдзрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, 10 рд╡рд░реНрд╖реЛрдВ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (365 * 10 + 2 рд▓реАрдк рд╡рд░реНрд╖)ред </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЬрд╛рд░реА рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕ рдореВрд▓реНрдп рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓рд╛, рд╕реНрдЯреИрдВрдбрдЕрд▓реЛрди рдкреНрд░рдорд╛рдгрди рдкреНрд░рд╛рдзрд┐рдХрд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдЪрд░ рдирд┐рд░реНрдпрд╛рдд рдХрд░рдирд╛, CA рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдирд╛, рд░реВрдЯ рдХреБрдВрдЬреА рдФрд░ CA рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЬрд╛рд░реА рдХрд░рдирд╛, рдбрд┐рдлреА-рд╣реЗрд▓рдореИрди рдХреБрдВрдЬреА, TLS рдХреБрдВрдЬреА, рд╕рд╛рде рд╣реА рд╕рд░реНрд╡рд░ рдХреБрдВрдЬреА рдФрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдкреНрд░рд╛рдзрд┐рдХрд╛рд░реА рдХреБрдВрдЬреА рдХреЛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЧреБрдкреНрдд рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП! </font><font style="vertical-align: inherit;">рдЕрдиреБрд░реЛрдз рдкрд░ рд╕рднреА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЫреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/<font></font>
. ./vars<font></font>
./easyrsa init-pki<font></font>
./easyrsa build-ca nopass<font></font>
./easyrsa gen-dh<font></font>
./easyrsa gen-req myvpngw nopass<font></font>
./easyrsa sign-req server myvpngw<font></font>
./easyrsa gen-crl<font></font>
openvpn --genkey --secret pki/ta.key<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдкрд░, рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рддрдВрддреНрд░ рд╕реЗрдЯрдЕрдк рдХрд╛ рдореБрдЦреНрдп рднрд╛рдЧ рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИред</font></font><br>
<a name="ovpn"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVPN рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenVPN рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрд░ рдЬрд╛рдПрдВ, рд╕реЗрд╡рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдВ рдФрд░ easy-rsa рд╕реЗ рд▓рд┐рдВрдХ рдЬреЛрдбрд╝реЗрдВ:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /etc/openvpn/<font></font>
mkdir /var/<span class="hljs-built_in">log</span>/openvpn/ /etc/openvpn/ccd /usr/share/easy-rsa/3/client<font></font>
ln -s /usr/share/easy-rsa/3/pki/ /etc/openvpn/<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЦреНрдп OpenVPN рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo vim server.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА</font></font><br>
<br>
<pre><code class="plaintext hljs">port 1194<font></font>
proto udp<font></font>
dev tun<font></font>
ca /etc/openvpn/pki/ca.crt<font></font>
cert /etc/openvpn/pki/issued/myvpngw.crt<font></font>
key /etc/openvpn/pki/private/myvpngw.key<font></font>
crl-verify /etc/openvpn/pki/crl.pem<font></font>
dh /etc/openvpn/pki/dh.pem<font></font>
server 172.16.20.0 255.255.254.0<font></font>
ifconfig-pool-persist ipp.txt<font></font>
push "route 172.16.0.0 255.255.255.0"<font></font>
push "route 172.17.0.0 255.255.255.0"<font></font>
client-config-dir ccd<font></font>
push "dhcp-option DNS 172.16.16.16"<font></font>
push "dhcp-option DNS 172.16.17.17"<font></font>
keepalive 10 120<font></font>
cipher AES-256-CBC<font></font>
user nobody<font></font>
group nobody<font></font>
persist-key<font></font>
persist-tun<font></font>
status /var/log/openvpn/openvpn-status.log<font></font>
log-append  /var/log/openvpn/openvpn.log<font></font>
verb 3<font></font>
explicit-exit-notify 1<font></font>
username-as-common-name<font></font>
plugin /usr/lib64/openvpn/plugin/lib/openvpn-auth-ldap.so /etc/openvpn/ldap.conf<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорд╛рдкрджрдВрдбреЛрдВ рдкрд░ рдХреБрдЫ рдиреЛрдЯ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЬрд╛рд░реА рдХрд░рддреЗ рд╕рдордп рдПрдХ рдЕрд▓рдЧ рдирд╛рдо рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ рдЙрд╕реЗ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкрддрд╛ рдкреВрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ *;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рд░реНрдЧ рдФрд░ DNS рд╕рд░реНрд╡рд░ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AD ** рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдВрддрд┐рдо 2 рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред</font></font></li>
</ul><br>
<i>*         127 , ..   /23,  OpenVPN        /30.<br>
        ,    ,        SELinux,    tcp   , ..   tcp-        .<br>
<br>
**   AD  ,  ,   тАФ ,    <b>  auth-user-pass</b>.</i><br>
<a name="auth"></a><br>
<h4>  AD</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреВрд╕рд░реЗ рдХрд╛рд░рдХ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо AD рдореЗрдВ рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдореЗрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдПрдХ рд╕рдореВрд╣ рдХреЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдбреЛрдореЗрди рдореЗрдВ рдПрдХ рдЦрд╛рддреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреА рд╕рджрд╕реНрдпрддрд╛ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрдЧреАред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<pre><code class="bash hljs">/etc/openvpn/ldap.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;LDAP&gt;<font></font>
        URL             "ldap://ldap.abc.ru"<font></font>
        BindDN          "CN=bindUsr,CN=Users,DC=abc,DC=ru"<font></font>
        Password        b1ndP@SS<font></font>
        Timeout         15<font></font>
        TLSEnable       no<font></font>
        FollowReferrals yes<font></font>
&lt;/LDAP&gt;<font></font>
&lt;Authorization&gt;<font></font>
        BaseDN          "OU=allUsr,DC=abc,DC=ru"<font></font>
        SearchFilter    "(sAMAccountName=%u)"<font></font>
        RequireGroup    true<font></font>
        &lt;Group&gt;<font></font>
                BaseDN          "OU=myGrp,DC=abc,DC=ru"<font></font>
                SearchFilter    "(cn=myVPNUsr)"<font></font>
                MemberAttribute "member"<font></font>
        &lt;/Group&gt;<font></font>
&lt;/Authorization&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореБрдЦреНрдп рдкреИрд░рд╛рдореАрдЯрд░:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URL "ldap: //ldap.abc.ru" - рдбреЛрдореЗрди рдирд┐рдпрдВрддреНрд░рдХ рдХрд╛ рдкрддрд╛;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BindDN "CN = bindUsr, CN = рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, DC = abc, DC = ru" - LDAP (UZ - рдХрдВрдЯреЗрдирд░ рдореЗрдВ bindUsr рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдпрдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд╡рд┐рд╣рд┐рдд рдирд╛рдо) abc.ru/Users);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд╕рд╡рд░реНрдб b1ndP @ рдПрд╕рдПрд╕ - рдмрд╛рдзреНрдпрдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╛рд╕рд╡рд░реНрдб;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseDN "OU = allUsr, DC = abc, DC = ru" - рд╡рд╣ рдорд╛рд░реНрдЧ рдЬрд╣рд╛рдБ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦреЛрдЬ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BaseDN "OU = myGrp, DC = abc, DC = ru" - рдЕрдиреБрдорддрд┐ рд╕рдореВрд╣ рдХрд╛ рдХрдВрдЯреЗрдирд░ (рдХрдВрдЯреЗрдирд░ рдореЗрдВ рд╕рдореВрд╣ myVPNUsr abc.ru \ myGrp);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchFilter "(cn = myVPNUsr)" рд╕рдВрдХрд▓реНрдк рд╕рдореВрд╣ рдХрд╛ рдирд╛рдо рд╣реИред</font></font></li>
</ul><br>
<a name="run"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЙрдиреНрдЪ рдФрд░ рдбрд╛рдпрдЧреНрдиреЛрд╕реНрдЯрд┐рдХреНрд╕</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдм рд╣рдо рдЕрдкрдирд╛ рд╕рд░реНрд╡рд░ рдЪрд╛рд▓реВ рдФрд░ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo systemctl <span class="hljs-built_in">enable</span> openvpn@server.service<font></font>
$ sudo systemctl start openvpn@server.service<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪреЗрдХ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">systemctl status openvpn@server.service<font></font>
journalctl -xe<font></font>
cat /var/<span class="hljs-built_in">log</span>/messages<font></font>
cat /var/<span class="hljs-built_in">log</span>/openvpn/*<span class="hljs-built_in">log</span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЬрд╛рд░реА рдХрд░рдирд╛ рдФрд░ рдирд┐рд░рд╕реНрдд рдХрд░рдирд╛</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪреВрдВрдХрд┐ </font><font style="vertical-align: inherit;">рдЦреБрдж рдХреЛ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдкрдХреЛ рдЪрд╛рдмрд┐рдпрд╛рдБ рдФрд░ рдЕрдиреНрдп рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдпрд╣ рд╕рдм рдПрдХ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рдкреЗрдЯрдирд╛ рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдлрд╝рд╛рдЗрд▓ рддрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА OpenVPN рдХреНрд▓рд╛рдЗрдВрдЯ рдкрд░ рдЖрдпрд╛рдд рдХреА рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЯреЗрдореНрдкрд▓реЗрдЯ рдФрд░ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдПрдВ рдЬреЛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддреА рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдореЗрдВ, рдЖрдкрдХреЛ рд░реВрдЯ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ (ca.crt) рдФрд░ TLS рдХреБрдВрдЬреА (ta.key) рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЬрд╛рд░реА рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, </font><font style="vertical-align: inherit;">рдкреИрд░рд╛рдореАрдЯрд░ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╡реИрдзрддрд╛ рдЕрд╡рдзрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рдЗрд╕реЗ рдмрд╣реБрдд рдмрдбрд╝рд╛ рдирд╣реАрдВ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдореИрдВ рдЗрд╕реЗ рдЕрдзрд┐рдХрддрдо 180 рджрд┐рдиреЛрдВ рддрдХ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВред</font></font><br>
<br>
<pre><code class="bash hljs">vim /usr/share/easy-rsa/3/vars</code></pre><br>
<pre><code class="plaintext hljs">...<font></font>
export EASYRSA_CERT_EXPIRE=180<font></font>
</code></pre><br>
<pre><code class="bash hljs">vim /usr/share/easy-rsa/3/client/template.ovpn</code></pre><br>
<pre><code class="plaintext hljs">client<font></font>
dev tun<font></font>
proto udp<font></font>
remote gw.abc.ru 1194<font></font>
resolv-retry infinite<font></font>
nobind<font></font>
persist-key<font></font>
persist-tun<font></font>
remote-cert-tls server<font></font>
cipher AES-256-CBC<font></font>
verb 3<font></font>
auth-user-pass<font></font>
<font></font>
&lt;ca&gt;<font></font>
-----BEGIN CERTIFICATE-----<font></font>
PUT YOUR CA CERT (ca.crt) HERE<font></font>
-----END CERTIFICATE-----<font></font>
&lt;/ca&gt;<font></font>
<font></font>
key-direction 1<font></font>
&lt;tls-auth&gt;<font></font>
-----BEGIN OpenVPN Static key V1-----<font></font>
PUT YOUR TA KEY (ta.key) HERE<font></font>
-----END OpenVPN Static key V1-----<font></font>
&lt;/tls-auth&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдирд╛ ... </font></font></i><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рдорд╛рдгрдкрддреНрд░ </font><font style="vertical-align: inherit;">рдХреА рд╕рд╛рдордЧреНрд░реА рдореЗрдВ </font><font style="vertical-align: inherit;">рддрд╛рд░ </font><font style="vertical-align: inherit;">рдмрджрд▓ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд┐рд╢рд╛рддреНрдордХ рд░рд┐рдореЛрдЯ рдореЗрдВ рдЕрдкрдиреЗ рдЧреЗрдЯрд╡реЗ рдХрд╛ рдирд╛рдо / рдкрддрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддрд┐рд░рд┐рдХреНрдд рдмрд╛рд╣рд░реА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдкрд╛рд╕ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣реЛрдо рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА (рдпрд╛ рдЕрдиреНрдп рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЬрдЧрд╣) рдореЗрдВ рд╣рдо рдПрдХ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">vim ~/make.profile.sh</code></pre><br>
<pre><code class="bash hljs"><span class="hljs-meta">#!/bin/bash
</span>
<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ] ; <span class="hljs-keyword">then</span>
 <span class="hljs-built_in">echo</span> Missing mandatory client name. Usage: <span class="hljs-variable">$0</span> vpn-username
 <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span><font></font>
<font></font>
<span class="hljs-comment">#Set variables</span><font></font>
basepath=/usr/share/easy-rsa/3<font></font>
clntpath=<span class="hljs-variable">$basepath</span>/client<font></font>
privpath=<span class="hljs-variable">$basepath</span>/pki/private<font></font>
certpath=<span class="hljs-variable">$basepath</span>/pki/issued<font></font>
profile=<span class="hljs-variable">$clntpath</span>/<span class="hljs-variable">$1</span>.ovpn<font></font>
<font></font>
<span class="hljs-comment">#Get current year and lowercase client name</span><font></font>
year=`date +%F`<font></font>
client=<span class="hljs-variable">${1,,}</span>
<span class="hljs-built_in">echo</span> Processing <span class="hljs-variable">$year</span> year cert <span class="hljs-keyword">for</span> user/device <span class="hljs-variable">$client</span><font></font>
<font></font>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$basepath</span><font></font>
<font></font>
<span class="hljs-keyword">if</span> [  -f client/<span class="hljs-variable">$client</span>* ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"*** ERROR! ***"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Certificate <span class="hljs-variable">$client</span> already issued!"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"*** ERROR! ***"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span><font></font>
<font></font>
. ./vars<font></font>
./easyrsa --batch --req-cn=<span class="hljs-variable">$client</span> gen-req <span class="hljs-variable">$client</span> nopass<font></font>
./easyrsa --batch sign-req client <span class="hljs-variable">$client</span><font></font>
<font></font>
<span class="hljs-comment">#Make profile</span>
cp <span class="hljs-variable">$clntpath</span>/template.ovpn <span class="hljs-variable">$profile</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;key&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
cat <span class="hljs-variable">$privpath</span>/<span class="hljs-variable">$1</span>.key &gt;&gt; <span class="hljs-variable">$profile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/key&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span><font></font>
<font></font>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">$certpath</span>/<span class="hljs-variable">$1</span>.crt -out <span class="hljs-variable">$basepath</span>/<span class="hljs-variable">$1</span>.crt<font></font>
<font></font>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;cert&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
cat <span class="hljs-variable">$basepath</span>/<span class="hljs-variable">$1</span>.crt &gt;&gt; <span class="hljs-variable">$profile</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"&lt;/cert&gt;"</span> &gt;&gt; <span class="hljs-variable">$profile</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n"</span> &gt;&gt; <span class="hljs-variable">$profile</span><font></font>
<font></font>
<span class="hljs-comment">#remove tmp file</span>
rm -f <span class="hljs-variable">$basepath</span>/<span class="hljs-variable">$1</span>.crt<font></font>
<font></font>
<span class="hljs-built_in">echo</span> Complete. See <span class="hljs-variable">$profile</span> file.<font></font>
<font></font>
<span class="hljs-built_in">cd</span> ~
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдмрдирд╛рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">chmod a+x ~/make.profile.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдЖрдк рд╣рдорд╛рд░реЗ рдкрд╣рд▓реЗ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЬрд╛рд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br>
<br>
<pre><code class="bash hljs">~/make.profile.sh my-first-user</code></pre><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐рдкреБрд╖реНрдЯрд┐</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рд╣рд╛рдирд┐, рдЪреЛрд░реА), рддреЛ рдЗрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ рдирд┐рд░рд╕реНрдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/<font></font>
./easyrsa revoke my-first-user<font></font>
./easyrsa gen-crl<font></font>
</code></pre><br>
<a name="cert"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдФрд░ рдирд┐рд░рд╕реНрдд рдкреНрд░рдорд╛рдг рдкрддреНрд░ рджреЗрдЦреЗрдВ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рдФрд░ рдирд┐рд░рд╕реНрдд рдкреНрд░рдорд╛рдг рдкрддреНрд░ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ рд╕реВрдЪрдХрд╛рдВрдХ рдлрд╝рд╛рдЗрд▓ рджреЗрдЦреЗрдВ:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /usr/share/easy-rsa/3/<font></font>
cat pki/index.txt<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рд╕рд░реНрд╡рд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реИ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ рдЪрд░рд┐рддреНрд░</font></font><br>
 <ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реА (рдорд╛рдиреНрдп) - рд╡реИрдз;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд░ (рдирд┐рд░рд╕реНрдд) - рд╡рд╛рдкрд╕ рдмреБрд▓рд╛рдпрд╛ рдЧрдпрд╛ред</font></font></li>
</ul></li>
</ul><br>
<a name="net"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреЗрдЯрд╡рд░реНрдХ рд╡рд┐рдиреНрдпрд╛рд╕</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рдЪрд░рдг рдПрдХ рдЯреНрд░рд╛рдВрд╕рдорд┐рд╢рди рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ - рд░реВрдЯрд┐рдВрдЧ рдФрд░ рдлрд╛рдпрд░рд╡реЙрд▓ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдореЗрдВ рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo firewall-cmd --add-service=openvpn<font></font>
$ sudo firewall-cmd --add-service=openvpn --permanent<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓рд╛, IP рдЯреНрд░реИрдлрд╝рд┐рдХ рд░реВрдЯрд┐рдВрдЧ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo sysctl net.ipv4.ip_forward=1<font></font>
$ sudo <span class="hljs-built_in">echo</span> <span class="hljs-string">"net.ipv4.ip_forward=1"</span> &gt; /etc/sysctl.d/50-sysctl.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреЙрд░реНрдкреЛрд░реЗрдЯ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ, рд╢рд╛рдпрдж рд╕рдмрдиреЗрдЯ рдореЗрдВ рдПрдХ рд╡рд┐рднрд╛рдЬрди рд╣реИ рдФрд░ рд╣рдореЗрдВ рд░рд╛рдЙрдЯрд░ рдХреЛ рдпрд╣ рдмрддрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рд╡реАрдкреАрдПрди рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдкреИрдХреЗрдЯ рдХреИрд╕реЗ рднреЗрдЬреЗрдВред рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдкрд░, рдХрдорд╛рдВрдб рдХреЛ рддрд░реАрдХреЗ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ (рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ):</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment"># ip route 172.16.20.0 255.255.254.0 172.16.19.123</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рд╣реЗрдЬреЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмреЙрд░реНрдбрд░ рд░рд╛рдЙрдЯрд░ рдХреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкрд░, рдЬрд╣рд╛рдВ рдмрд╛рд╣рд░реА рдкрддрд╛ gw.abc.ru рдкрд░реЛрд╕рд╛ рдЬрд╛рддрд╛ рд╣реИ, udp / 1194 рдкреИрдХреЗрдЯ рдХреЗ рдкрд╛рд░рд┐рдд рд╣реЛрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдкрдХреЗ рд╕рдВрдЧрдарди рдореЗрдВ рд╕рдЦреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдо рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рд╣рдорд╛рд░реЗ рд╡реАрдкреАрдПрди рд╕рд░реНрд╡рд░ рдкрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреЛ рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, iptables рдлреЙрд░рд╡рд░реНрдб рдЪреЗрди рдХреА рд╕реНрдерд╛рдкрдирд╛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд▓рдЪреАрд▓рд╛рдкрди рджреЗрддреА рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдХрдо рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рдФрд░ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП, "рдкреНрд░рддреНрдпрдХреНрд╖ рдирд┐рдпрдо" - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/firewalld/direct.xml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдкреНрд░рддреНрдпрдХреНрд╖ рдирд┐рдпрдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдирд┐рдпрдо рд╡рд┐рдиреНрдпрд╛рд╕ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo firewall-cmd --direct --get-all-rule</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЗрд╕рдХреА рдПрдХ рдмреИрдХрдЕрдк рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<pre><code class="bash hljs">cp /etc/firewalld/direct.xml /etc/firewalld/direct.xml.`date +%F.%T`.bak</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд╝рд╛рдЗрд▓ рдХреА рдЕрдиреБрдорд╛рдирд┐рдд рд╕рд╛рдордЧреНрд░реА рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">direct</span>&gt;</span>
 <span class="hljs-comment">&lt;!--Common Remote Services--&gt;</span>
  <span class="hljs-comment">&lt;!--DNS--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o ens192 -p udp --dport 53 -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
  <span class="hljs-comment">&lt;!--web--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -p tcp -d 172.16.19.200 --dport 80 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -p tcp -d 172.16.19.201 --dport 443 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
  <span class="hljs-comment">&lt;!--Some Other Systems--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -p udp -d 172.16.19.100 --dport 7000 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
  <span class="hljs-comment">&lt;!--just logging--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">priority</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">table</span>=<span class="hljs-string">"filter"</span> <span class="hljs-attr">ipv</span>=<span class="hljs-string">"ipv4"</span> <span class="hljs-attr">chain</span>=<span class="hljs-string">"FORWARD"</span>&gt;</span>-i tun0 -o eth0 -j LOG --log-prefix 'forward_fw '<span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">direct</span>&gt;</span>
</code></pre><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ, рдпреЗ рд╕рд╛рдорд╛рдиреНрдп iptables рдирд┐рдпрдо рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рдж рдкреИрдХ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрд░ рдЧрдВрддрд╡реНрдп рдЗрдВрдЯрд░рдлрд╝реЗрд╕ tun0 рд╣реИ, рдФрд░ рд╕реБрд░рдВрдЧ рдХреЗ рд▓рд┐рдП рдмрд╛рд╣рд░реА рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, ens192, рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рдЧрд┐рд░рд╛ рдкреИрдХреЗрдЯ рд▓реЙрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╣реИред </font><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдбреАрдмрдЧрд┐рдВрдЧ рд╕реНрддрд░ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="bash hljs">vim /etc/sysconfig/firewalld<font></font>
FIREWALLD_ARGS=--debug=2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реЗрдЯрд┐рдВрдЧ рд▓рд╛рдЧреВ рдХрд░реЗрдВ - рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХрдорд╛рдВрдб:</font></font><br>
<br>
<pre><code class="bash hljs">$ sudo firewall-cmd --reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрди рдкреИрдХреЗрдЯ рдХреЛ рдирд┐рдореНрди рдкреНрд░рдХрд╛рд░ рд╕реЗ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:</font></font><br>
<br>
<pre><code class="bash hljs">grep forward_fw /var/<span class="hljs-built_in">log</span>/messages</code></pre><br>
<a name="next"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реЛрдЧрд╛</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реЗрдЯрдЕрдк рд╣реЛ рдЧрдпрд╛ рд╣реИ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ, рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ рдХреА рдУрд░ рд░рд╣рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд┐рдВрдбреЛрдЬ рдЬреИрд╕реЗ рдУрдПрд╕ рдХреЗ рд▓рд┐рдП, рд╡рд┐рддрд░рдг </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЗрд╡рд▓рдкрд░ рдХреА рд╕рд╛рдЗрдЯ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдВрдд рдореЗрдВ, рд╣рдо рдЕрдкрдиреЗ рдирдП рд╕рд░реНрд╡рд░ рдХреЛ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдФрд░ рдЖрд░реНрдХрд╛рдЗрд╡рд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдФрд░ рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рдирд╣реАрдВ рднреВрд▓рддреЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдерд┐рд░ рдХрдиреЗрдХреНрд╢рди!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi501032/index.html">рдЪреАрдиреА рднрд╛рдЧреЛрдВ рд╕реЗ рд╕рд╕реНрддрд╛ рд╕рд░реНрд╡рд░ред рднрд╛рдЧ 1, рд▓реЛрд╣рд╛</a></li>
<li><a href="../hi501034/index.html">рдЖрдИрдмреАрдПрдо рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рд╕реЗрдорд┐рдирд╛рд░ - рдордИ 2020</a></li>
<li><a href="../hi501040/index.html">рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЬреЛ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдХреНрд╕реНрд▓ рдореЗрдВ рдмреНрд▓реЛрдЯ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИрдВред рдПрдВрдбреНрд░реЗ рд╕рд╛рд▓рдирд┐рдХреЛрд╡</a></li>
<li><a href="../hi501042/index.html">рдЕрдиреБрдкрд╛рд▓рди рдкрд░ рд▓рд╛рдЗрдХрдмреЗрдЬ: рд╣рдо рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдирд┐рдпрд╛рдордХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рд╕рдордЭрддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi501044/index.html">рдмреЗрд╡рдХреВрдлреЛрдВ рдХреЗ рд▓рд┐рдП рд▓реЛрдЧреЛрдВ рдХреЛ рдордд рдкрдХрдбрд╝реЛ рдпрд╛ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдкреГрд╖реНрдарднреВрдорд┐ рд╡рд╛рд▓рд╛ рд╡реНрдпрдХреНрддрд┐ рд╕реЗрд▓ рдЯреЙрд╡рд░ (рд╡реАрдбрд┐рдпреЛ) рдХреЛ рдХреИрд╕реЗ рдЬрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ</a></li>
<li><a href="../hi501050/index.html">рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ LabVIEW рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ</a></li>
<li><a href="../hi501052/index.html">рдЪреАрдиреА рдЕрдВрддрд░рд┐рдХреНрд╖ рдпрд╛рди рдХреА рд╡рд╛рдкрд╕реА</a></li>
<li><a href="../hi501056/index.html">рдкрд╛рдпрдерди рдореЗрдВ рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ рдФрд░ рдорд▓реНрдЯреАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрдпреЛрдВ, рдХрдм рдФрд░ рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi501058/index.html">рдЯреАрдорд╕реЗрдВрдЯрд░ рд░реИрдкрд┐рдб рд╕реНрдЯрд╛рд░реНрдЯ рд╕реЙрд▓реНрдпреВрд╢рди рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдФрджреНрдпреЛрдЧрд┐рдХ рдЙрдкрдХрд░рдг рдирд┐рд░реНрдорд╛рддрд╛</a></li>
<li><a href="../hi501060/index.html">JetBrains .NET рджрд┐рди рдСрдирд▓рд╛рдЗрди, 13-14 рдордИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>