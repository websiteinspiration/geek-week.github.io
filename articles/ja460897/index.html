<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🔧 🏟️ 🌎 Kubernetesを使用したGitLab CIのJUnit 🧖🏻 ♂️ 🎐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ソフトウェアのテストが重要かつ必要であることは誰もが知っているという事実にもかかわらず、多くの人が長い間自動的にテストを行ってきましたが、GitLabやJUnitなどのニッチ市場で人気のある製品をまとめるためのレシピはHabrのオープンスペースにはありません。 。このギャップを埋めてください！
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kubernetesを使用したGitLab CIのJUnit</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/460897/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソフトウェアのテストが重要かつ必要であることは誰もが知っているという事実にもかかわらず、多くの人が長い間自動的にテストを行ってきましたが、GitLabやJUnitなどのニッチ市場で人気のある製品をまとめるためのレシピはHabrのオープンスペースにはありません。 。</font><font style="vertical-align: inherit;">このギャップを埋めてください！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pc/q_/3i/pcq_3iq519cc6s_xqbeivsqyza4.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はじめに</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に、コンテキストの概要を説明します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> アプリケーションはすべてKubernetesで動作するため、適切なインフラストラクチャでテストを実行することを検討します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセンブリとデプロイには</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">（インフラストラクチャコンポーネントの意味では、これは自動的にHelmが関与することも意味します）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> テストを直接作成する方法の詳細については触れません。この場合、クライアントが自分でテストを作成し、テストが実行されることだけを確認します（対応するレポートがマージリクエストで利用可能です）。</font></font></li>
</ul><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクションの全体的なシーケンスはどのようになりますか？</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> アプリケーションのアセンブリ-この段階の説明は省略します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> アプリケーションを別のKubernetesクラスター名前空間にデプロイし、テストを起動します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GitLabによるアーティファクトの検索とJUnitレポートの解析。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 以前に作成した名前空間を削除します。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今-実装に！</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カスタマイズ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gitlab CI</font></font></h3><br><font style="vertical-align: inherit;"></font><code>.gitlab-ci.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションのデプロイメントとテスト</font><font style="vertical-align: inherit;">
の起動を</font><font style="vertical-align: inherit;">説明</font><font style="vertical-align: inherit;">するフラグメントから始めましょう</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">リストはかなりボリュームがあることが判明したため、コメントで完全に補足されています。</font></font><br>
<br>
<pre><code class="bash hljs">variables:
<span class="hljs-comment">#   werf,   </span>
  WERF_VERSION: <span class="hljs-string">"1.0 beta"</span><font></font>
<font></font>
.base_deploy: &amp;base_deploy<font></font>
  script:<font></font>
<span class="hljs-comment">#  namespace  K8s,   </span>
    - kubectl --context=<span class="hljs-string">"<span class="hljs-variable">${WERF_KUBE_CONTEXT}</span>"</span> get ns <span class="hljs-variable">${CI_ENVIRONMENT_SLUG}</span> || kubectl create ns <span class="hljs-variable">${CI_ENVIRONMENT_SLUG}</span>
<span class="hljs-comment">#  werf   —    .  </span>
<span class="hljs-comment"># (https://werf.io/how_to/gitlab_ci_cd_integration.html#deploy-stage)</span>
    - <span class="hljs-built_in">type</span> multiwerf &amp;&amp; <span class="hljs-built_in">source</span> &lt;(multiwerf use <span class="hljs-variable">${WERF_VERSION}</span>)<font></font>
    - werf version<font></font>
    - <span class="hljs-built_in">type</span> werf &amp;&amp; <span class="hljs-built_in">source</span> &lt;(werf ci-env gitlab --tagging-strategy tag-or-branch --verbose)<font></font>
    - werf deploy --stages-storage :<span class="hljs-built_in">local</span>
      --namespace <span class="hljs-variable">${CI_ENVIRONMENT_SLUG}</span>
      --<span class="hljs-built_in">set</span> <span class="hljs-string">"global.commit_ref_slug=<span class="hljs-variable">${CI_COMMIT_REF_SLUG:-''}</span>"</span>
<span class="hljs-comment">#   `run_tests`</span>
<span class="hljs-comment">#      Helm-</span>
      --<span class="hljs-built_in">set</span> <span class="hljs-string">"global.run_tests=<span class="hljs-variable">${RUN_TESTS:-no}</span>"</span>
      --<span class="hljs-built_in">set</span> <span class="hljs-string">"global.env=<span class="hljs-variable">${CI_ENVIRONMENT_SLUG}</span>"</span>
<span class="hljs-comment">#  timeout (  )     </span>
      --<span class="hljs-built_in">set</span> <span class="hljs-string">"global.ci_timeout=<span class="hljs-variable">${CI_TIMEOUT:-900}</span>"</span>
     --timeout <span class="hljs-variable">${CI_TIMEOUT:-900}</span><font></font>
  dependencies:<font></font>
    - Build<font></font>
<font></font>
.<span class="hljs-built_in">test</span>-base: &amp;<span class="hljs-built_in">test</span>-base<font></font>
  extends: .base_deploy<font></font>
  before_script:<font></font>
<span class="hljs-comment">#     ,   $CI_COMMIT_REF_SLUG</span>
    - mkdir /mnt/tests/<span class="hljs-variable">${CI_COMMIT_REF_SLUG}</span> || <span class="hljs-literal">true</span>
<span class="hljs-comment">#  , .. GitLab      build-dir’</span>
    - mkdir ./tests || <span class="hljs-literal">true</span>
    - ln -s /mnt/tests/<span class="hljs-variable">${CI_COMMIT_REF_SLUG}</span> ./tests/<span class="hljs-variable">${CI_COMMIT_REF_SLUG}</span><font></font>
  after_script:<font></font>
<span class="hljs-comment">#        Job’</span>
<span class="hljs-comment"># (, ,  )</span>
    - <span class="hljs-built_in">type</span> multiwerf &amp;&amp; <span class="hljs-built_in">source</span> &lt;(multiwerf use <span class="hljs-variable">${WERF_VERSION}</span>)<font></font>
    - werf version<font></font>
    - <span class="hljs-built_in">type</span> werf &amp;&amp; <span class="hljs-built_in">source</span> &lt;(werf ci-env gitlab --tagging-strategy tag-or-branch --verbose)<font></font>
    - werf dismiss --namespace <span class="hljs-variable">${CI_ENVIRONMENT_SLUG}</span> --with-namespace
<span class="hljs-comment">#   ,     </span>
  allow_failure: <span class="hljs-literal">true</span><font></font>
  variables:<font></font>
    RUN_TESTS: <span class="hljs-string">'yes'</span>
<span class="hljs-comment">#    werf</span>
<span class="hljs-comment"># (https://werf.io/how_to/gitlab_ci_cd_integration.html#infrastructure)</span>
    WERF_KUBE_CONTEXT: <span class="hljs-string">'admin@stage-cluster'</span><font></font>
  tags:<font></font>
<span class="hljs-comment">#     `werf-runner`</span><font></font>
    - werf-runner<font></font>
  artifacts:<font></font>
<span class="hljs-comment">#     ,     </span>
<span class="hljs-comment">#     — ,    </span><font></font>
    paths:<font></font>
      - ./tests/<span class="hljs-variable">${CI_COMMIT_REF_SLUG}</span>/*
<span class="hljs-comment">#     </span><font></font>
    expire_in: 7 day<font></font>
<span class="hljs-comment"># :       GitLab’</span><font></font>
    reports:<font></font>
      junit: ./tests/<span class="hljs-variable">${CI_COMMIT_REF_SLUG}</span>/report.xml<font></font>
<font></font>
<span class="hljs-comment">#       </span>
<span class="hljs-comment">#         —   - </span><font></font>
stages:<font></font>
  - build<font></font>
  - tests<font></font>
<font></font>
build:<font></font>
  stage: build<font></font>
  script:<font></font>
<span class="hljs-comment">#  —     werf</span>
<span class="hljs-comment"># (https://werf.io/how_to/gitlab_ci_cd_integration.html#build-stage)</span>
    - <span class="hljs-built_in">type</span> multiwerf &amp;&amp; <span class="hljs-built_in">source</span> &lt;(multiwerf use <span class="hljs-variable">${WERF_VERSION}</span>)<font></font>
    - werf version<font></font>
    - <span class="hljs-built_in">type</span> werf &amp;&amp; <span class="hljs-built_in">source</span> &lt;(werf ci-env gitlab --tagging-strategy tag-or-branch --verbose)<font></font>
    - werf build-and-publish --stages-storage :<span class="hljs-built_in">local</span><font></font>
  tags:<font></font>
    - werf-runner<font></font>
  except:<font></font>
    - schedules<font></font>
<font></font>
run tests:<font></font>
  &lt;&lt;: *<span class="hljs-built_in">test</span>-base<font></font>
  environment:<font></font>
<span class="hljs-comment"># " "  namespace’</span>
<span class="hljs-comment"># (https://docs.gitlab.com/ce/ci/variables/predefined_variables.html)</span>
    name: tests-<span class="hljs-variable">${CI_COMMIT_REF_SLUG}</span><font></font>
  stage: tests<font></font>
  except:<font></font>
    - schedules</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、ディレクトリで、</font></font><code>.helm/templates</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jobを使用してYAMLを作成</font></font><code>tests-job.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">します。必要なテストとKubernetesリソースを実行するためです。</font><font style="vertical-align: inherit;">リストの後に説明があります：</font></font><br>
<br>
<pre><code class="plaintext hljs">{{- if eq .Values.global.run_tests "yes" }}<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: ConfigMap<font></font>
metadata:<font></font>
  name: tests-script<font></font>
data:<font></font>
  tests.sh: |<font></font>
    echo "======================"<font></font>
    echo "${APP_NAME} TESTS"<font></font>
    echo "======================"<font></font>
<font></font>
    cd /app<font></font>
    npm run test:ci<font></font>
    cp report.xml /app/test_results/${CI_COMMIT_REF_SLUG}/<font></font>
<font></font>
    echo ""<font></font>
    echo ""<font></font>
    echo ""<font></font>
<font></font>
    chown -R 999:999 /app/test_results/${CI_COMMIT_REF_SLUG}<font></font>
---<font></font>
apiVersion: batch/v1<font></font>
kind: Job<font></font>
metadata:<font></font>
  name: {{ .Chart.Name }}-test<font></font>
  annotations:<font></font>
    "helm.sh/hook": post-install,post-upgrade<font></font>
    "helm.sh/hook-weight": "2"<font></font>
    "werf/watch-logs": "true"<font></font>
spec:<font></font>
  activeDeadlineSeconds: {{ .Values.global.ci_timeout }}<font></font>
  backoffLimit: 1<font></font>
  template:<font></font>
    metadata:<font></font>
      name: {{ .Chart.Name }}-test<font></font>
    spec:<font></font>
      containers:<font></font>
      - name: test<font></font>
        command: ['bash', '-c', '/app/tests.sh']<font></font>
{{ tuple "application" . | include "werf_container_image" | indent 8 }}<font></font>
        env:<font></font>
        - name: env<font></font>
          value: {{ .Values.global.env }}<font></font>
        - name: CI_COMMIT_REF_SLUG<font></font>
          value: {{ .Values.global.commit_ref_slug }}<font></font>
       - name: APP_NAME<font></font>
          value: {{ .Chart.Name }}<font></font>
{{ tuple "application" . | include "werf_container_env" | indent 8 }}<font></font>
        volumeMounts:<font></font>
        - mountPath: /app/test_results/<font></font>
          name: data<font></font>
        - mountPath: /app/tests.sh<font></font>
          name: tests-script<font></font>
          subPath: tests.sh<font></font>
      tolerations:<font></font>
      - key: dedicated<font></font>
        operator: Exists<font></font>
      - key: node-role.kubernetes.io/master<font></font>
        operator: Exists<font></font>
      restartPolicy: OnFailure<font></font>
      volumes:<font></font>
      - name: data<font></font>
        persistentVolumeClaim:<font></font>
          claimName: {{ .Chart.Name }}-pvc<font></font>
      - name: tests-script<font></font>
        configMap:<font></font>
          name: tests-script<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: PersistentVolumeClaim<font></font>
metadata:<font></font>
  name: {{ .Chart.Name }}-pvc<font></font>
spec:<font></font>
  accessModes:<font></font>
  - ReadWriteOnce<font></font>
  resources:<font></font>
    requests:<font></font>
      storage: 10Mi<font></font>
  storageClassName: {{ .Chart.Name }}-{{ .Values.global.commit_ref_slug }}<font></font>
  volumeName: {{ .Values.global.commit_ref_slug }}<font></font>
<font></font>
---<font></font>
apiVersion: v1<font></font>
kind: PersistentVolume<font></font>
metadata:<font></font>
  name: {{ .Values.global.commit_ref_slug }}<font></font>
spec:<font></font>
  accessModes:<font></font>
  - ReadWriteOnce<font></font>
  capacity:<font></font>
    storage: 10Mi<font></font>
  local:<font></font>
    path: /mnt/tests/<font></font>
  nodeAffinity:<font></font>
   required:<font></font>
     nodeSelectorTerms:<font></font>
     - matchExpressions:<font></font>
       - key: kubernetes.io/hostname<font></font>
         operator: In<font></font>
         values:<font></font>
         - kube-master<font></font>
  persistentVolumeReclaimPolicy: Delete<font></font>
  storageClassName: {{ .Chart.Name }}-{{ .Values.global.commit_ref_slug }}<font></font>
{{- end }}</code></pre><br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この構成で</font><b><font style="vertical-align: inherit;">はどのリソースが</font></b><font style="vertical-align: inherit;">説明されていますか？</font><font style="vertical-align: inherit;">デプロイするときに、プロジェクトの一意の名前空間を作成し（これは</font></font><code>.gitlab-ci.yaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">で示されています</font></font><code>tests-${CI_COMMIT_REF_SLUG}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、それをロールアウトします。</font></font><br>
<br>
<ol>
<li> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストスクリプトを含む</font><b><font style="vertical-align: inherit;">ConfigMap</font></b><font style="vertical-align: inherit;">。</font></font></li>
<li> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポッドの説明と指定されたディレクティブ</font></font><code>command</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を含む</font><b><font style="vertical-align: inherit;">ジョブ</font></b><font style="vertical-align: inherit;">。テストを実行するだけです。</font></font></li>
<li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVおよびPVC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。テストデータを保存できます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マニフェストの冒頭の</font><font style="vertical-align: inherit;">
導入条件に注意してください。</font><font style="vertical-align: inherit;">したがって、アプリケーションを含むHelmチャートの他のYAMLファイルは、</font><font style="vertical-align: inherit;">テスト中にデプロイされないよう</font><font style="vertical-align: inherit;">に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逆の</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">構造で</font><font style="vertical-align: inherit;">ラップする必要があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">つまり：</font></font><br>
<br>
<pre><code class="plaintext hljs">{{- if ne .Values.global.run_tests "yes" }}<font></font>
---<font></font>
  <font></font>
{{- end }}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、テストに</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフラストラクチャ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Redis、RabbitMQ、Mongo、PostgreSQLなど）が</font><b><font style="vertical-align: inherit;">必要な</font></b><font style="vertical-align: inherit;">場合は</font><font style="vertical-align: inherit;">、YAMLを</font><font style="vertical-align: inherit;">オフに</font><font style="vertical-align: inherit;">する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こと</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">でき</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">それらをテスト環境にデプロイします...もちろん、好きなように調整してください。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最後の仕上げ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜなら </font><font style="vertical-align: inherit;">これまでのところwerfでのビルドとデプロイ</font><font style="vertical-align: inherit;">はビルドサーバー（gitlab-runner）で</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のみ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">機能</font><font style="vertical-align: inherit;">し、テストを含むポッドはウィザードで実行されます。ウィザードでディレクトリを作成し、</font><b><font style="vertical-align: inherit;">たとえばNFSを介し</font></b></font><code>/mnt/tests</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てランナーにそれを与える</font><font style="vertical-align: inherit;">必要があり</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">説明付きの詳細な例は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K8sのドキュメントにあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果は次のようになります。</font></font><br>
<br>
<pre><code class="plaintext hljs">user@kube-master:~$ cat /etc/exports | grep tests<font></font>
/mnt/tests    IP_gitlab-builder/32(rw,nohide,insecure,no_subtree_check,sync,all_squash,anonuid=999,anongid=998)<font></font>
<font></font>
user@gitlab-runner:~$ cat /etc/fstab | grep tests<font></font>
IP_kube-master:/mnt/tests    /mnt/tests   nfs4    _netdev,auto  0       0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gitlab-runnerで直接NFSボールを作成し、それをポッドにマウントすることを禁じている人はいません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シェルランナーで直接テストスクリプトを実行できるのであれば、なぜJobの作成ですべてを複雑にするのでしょうか。</font><font style="vertical-align: inherit;">答えは非常に簡単です... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部のテストでは、インフラストラクチャ（MongoDB、RabbitMQ、PostgreSQLなど）へのアクセスが必要です。</font><font style="vertical-align: inherit;">私たちはテストを統一します-このアプローチにより、そのような追加のエンティティを含めることが容易になります。</font><font style="vertical-align: inherit;">これに加えて</font><font style="vertical-align: inherit;">、展開では</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">標準的な</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプローチを使用します（NFSを使用している場合でも、追加のマウントディレクトリ）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
準備した構成を適用すると何が表示されますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マージ要求は、最後のパイプラインで起動されたテストの要約統計を表示し</font></font><br>
<br>
<img src="https://habrastorage.org/webt/c5/2w/ix/c52wixmvclqqugnkbxbwe7p6brm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。ここで各エラーをクリックして詳細を取得できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/3-/0p/dp/3-0pdpuwwpkbkye-dajzbbdpgde.png"><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：注意深い読者は、NodeJSアプリケーションをテストしていることと、スクリーンショット-.NET ...驚いてください。記事の準備の一部として、最初のアプリケーションのテストでエラーはありませんでしたが、別のアプリケーションで見つかりました。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやら、複雑なことは何もありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、すでにシェルビルダーがあり、それが機能し、Kubernetesが必要ない場合、テストをねじ込むことは、ここで説明するよりもさらに簡単な作業になります。</font><font style="vertical-align: inherit;">また、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab CIのドキュメント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には、Ruby、Go、Gradle、Mavenなどの例があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちのブログも読んでください：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubernetesとGitLabによるベストCI / CDプラクティス（レビューとビデオレポート）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WERFはKubernetes（レビューとビデオレポート）における当社のCI / CDツールです</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">」 </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（; </font><font style="vertical-align: inherit;">DevOpsConfで2019年5月27日ドミトリーStolyarov） </font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitLab CIでカスタムワークフローを作成するためのヒント</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本番環境での継続的な統合と配信のためのGitLab CI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。」</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460883/index.html">変化する要件の世界での生活と小さな機能の利点について</a></li>
<li><a href="../ja460885/index.html">PleskによるHighLoad ++ Siberia 2019に関する興味深いレポート</a></li>
<li><a href="../ja460887/index.html">別のプログラミング言語ではありません。パート3：物理学</a></li>
<li><a href="../ja460891/index.html">量子コンピューティングの創設者のアプローチを使用して、良いSCRUMを悪いものから区別する方法</a></li>
<li><a href="../ja460893/index.html">完全にエストニアへの移転を検討する-長所、短所、および落とし穴</a></li>
<li><a href="../ja460899/index.html">7月26日、Deworkacy-RostelecomのDocOps</a></li>
<li><a href="../ja460901/index.html">シニアデベロッパーが就職できない理由</a></li>
<li><a href="../ja460905/index.html">起業家のための最小限のSEO知識</a></li>
<li><a href="../ja460907/index.html">Liquibaseを使用してSpring Bootアプリケーションのデータベース構造を管理する。パート2</a></li>
<li><a href="../ja460909/index.html">2050年に何を食べるか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>