<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔍 💄 🎉 最佳SQL中难度面试问题 🧢 ㊗️ 🍁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SQL课程的前70％似乎很简单。其余30％的员工开始遇到困难。
 
 从2015年到2019年，我接受了四次面试，分别担任了十几家公司的数据分析师和数据分析专家。在2017年又一次失败的采访之后-当我对复杂的SQL问题感到困惑时-我开始编写一本有关中，高复杂度SQL问题的问题书，以更好地准备面试。本...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>最佳SQL中难度面试问题</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dcmiran/blog/500360/"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL课程的前70％似乎很简单。其余30％的员工开始遇到困难。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
从2015年到2019年，我接受了四次面试，分别担任了十几家公司的数据分析师和数据分析专家。在2017年又一次失败的采访之后-当我对复杂的SQL问题感到困惑时-我开始编写一本有关中，高复杂度SQL问题的问题书，以更好地准备面试。本指南在2019年的最后一轮采访中派上了用场。在过去的一年中，我与几个朋友共享了该指南，并且由于流行病导致额外的空闲时间，因此我完善了该指南并编写了本文档。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于初学者，有许多很棒的SQL教程。我的最爱是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zi Chung Kao </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">编写的Codecademy的交互式SQL</font></a><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star SQL </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">课程</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是实际上，SQL课程的前70％相当简单，而真正的困难始于其余的30％，这在初学者指南中均未涉及。</font><font style="vertical-align: inherit;">因此，在对技术公司的数据分析师和数据分析专家进行采访时，经常会问这30％的问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出乎意料的是，我没有找到有关中等难度此类问题的详尽资料，因此我编写了本指南。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这对面试很有用，但同时会增加您当前和将来工作的效率。</font><font style="vertical-align: inherit;">我个人认为，提到的某些SQL模板对于运行报表工具和数据分析功能以识别趋势的ETL系统也很有用。</font></font><br>
<br>
<blockquote><h1><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></a></h1><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">        SQL</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 1.     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 2.   </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 3.     ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 2</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 3</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 4.  </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 5.  </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 6.   </a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 1.     </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 2.        ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 2</a></li>
</ul></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     </a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 1. </a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 2.   ( )</a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 1</a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> 2</a></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">№ 3.  </a></li>
</ul></li>
</ul></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您需要了解，在与数据分析师和数据分析师进行访谈时，他们不仅提出有关SQL的问题。其他常见主题包括对过去项目的讨论，A / B测试，度量标准开发和开放式分析问题。大约三年前，Quora </font><font style="vertical-align: inherit;">在Facebook上</font><font style="vertical-align: inherit;">发布了</font><font style="vertical-align: inherit;">有关面试产品分析师职位的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技巧</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在那里，将详细讨论该主题。但是，如果提高您的SQL知识对您的面试有帮助，那么本指南非常值得。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将来，我可以将本指南中的代码移植到</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Select Star SQL之</font></a><font style="vertical-align: inherit;">类的网站</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使编写SQL语句更容易-并实时查看代码执行的结果。</font><font style="vertical-align: inherit;">作为选择，将问题添加为平台问题，以准备</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeetCode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采访</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同时，我只想发布此文档，以便人们现在可以了解此信息。</font></font><br>
<br>
<a name="1"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设以及手册的使用方法</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于SQL语言知识的假设：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假定您具有SQL的实际知识。</font><font style="vertical-align: inherit;">您可能经常在工作中使用它，但是想磨练自己的技能，例如自联想和窗口功能。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何使用本手册：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于面试中经常使用写字板或虚拟笔记本电脑（无需编译代码），因此我建议您用铅笔和纸为每个问题写下解决方案，并在完成后将笔记与答案进行比较。</font><font style="vertical-align: inherit;">或与将担任面试官的朋友一起解决您的问题！</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在用白板或记事本采访期间，较小的语法错误并不重要。</font><font style="vertical-align: inherit;">但是他们会分散面试官的注意力，因此理想情况下应尝试减少他们的人数，以便将所有注意力集中在逻辑上。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出的答案不一定是解决每个问题的唯一方法。</font><font style="vertical-align: inherit;">随意写评论以及可以添加到本指南的其他解决方案！</font></font></li>
</ul><br>
<a name="2"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决SQL面试中的复杂任务的提示</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，所有编程面试的标准技巧...</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仔细听问题的描述，向面试官重复问题的实质</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制定边界案例以证明您确实了解问题（即，</font><font style="vertical-align: inherit;">您将要编写的最终SQL查询</font><font style="vertical-align: inherit;">中将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font><font style="vertical-align: inherit;">的行</font><font style="vertical-align: inherit;">）</font></font><br>
</li>
<li>(    )     ,     —     :     ,             <br>
<ul>
<li>,      ,     </li>
</ul></li>
<li>  SQL,   ,     .      ,      .</li>
</ol><br>
<a name="3"></a><h1>   </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这里列出的一些问题是根据旧的Periscope博客文章改编而成的（大部分作者由</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sean Cook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于2014年左右</font><font style="vertical-align: inherit;">撰写</font><font style="vertical-align: inherit;">，尽管在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SiSense与Periscope合并</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后，他的著作似乎已从材料中删除</font><font style="vertical-align: inherit;">），以及关于StackOverflow的讨论。</font><font style="vertical-align: inherit;">如有必要，在每个问题的开头标记来源。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select Star上，SQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明智的选择，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是本文档的补充问题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，这些问题不是我自己采访中问题的字面意思，在我工作或工作的公司中也没有使用过。</font></font><br>
<br>
<a name="4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自我交往任务</font></font></h1><br>
<a name="5"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 1.百分比每月变化</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解关键指标如何变化（例如每月活跃用户的每月受众</font><b><font style="vertical-align: inherit;">）</font></b><font style="vertical-align: inherit;">通常很有用。</font><font style="vertical-align: inherit;">假设我们有一个</font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的表格：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">日期|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 | </font><font style="vertical-align: inherit;">2018-10-04 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：找到活跃用户的每月受众人数（MAU）的每月百分比变化。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决方案：（</font></font></b><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此解决方案与本文档中的其他代码块一样，包含有关SQL语法元素的注释，这些注释在不同的SQL变体之间可能有所不同，以及其他说明）</font></font></i> <br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> mau <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
  <span class="hljs-keyword">SELECT</span> 
   <span class="hljs-comment">/* 
    *       
    *  , .&nbsp;.   ,    . 
    *    ,   
    *
    *  Postgres  DATE_TRUNC(),   
    *      SQL   
    * . https://www.postgresql.org/docs/9.0/functions-datetime.html#FUNCTIONS-DATETIME-TRUNC
    */</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-built_in">date</span>) month_timestamp,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) mau
  <span class="hljs-keyword">FROM</span> <font></font>
    logins <font></font>
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-built_in">date</span>)<font></font>
  )<font></font>
 <font></font>
 <span class="hljs-keyword">SELECT</span> 
    <span class="hljs-comment">/*
    *    SELECT      . 
    * 
    *        ,   
    *    ,   , 
    *        ..
    */</span> <font></font>
    a.month_timestamp previous_month, <font></font>
    a.mau previous_mau, <font></font>
    b.month_timestamp current_month, <font></font>
    b.mau current_mau, <font></font>
    <span class="hljs-keyword">ROUND</span>(<span class="hljs-number">100.0</span>*(b.mau - a.mau)/a.mau,<span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> percent_change 
 <span class="hljs-keyword">FROM</span><font></font>
    mau a <font></font>
 <span class="hljs-keyword">JOIN</span> 
    <span class="hljs-comment">/*
    *   `ON b.month_timestamp = a.month_timestamp + interval '1 month'` 
    */</span>
    mau b <span class="hljs-keyword">ON</span> a.month_timestamp = b.month_timestamp - <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span> </code></pre><br>
<a name="6"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2.标记树结构</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您有一个</font></font><code>tree</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含两列的表：第一列指示节点，第二列指示父节点。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点父</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3 5</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5空 </font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这样的方式编写SQL，即我们将每个节点指定为内部，根或叶或叶，以便对于上述值我们得到以下内容：</font></font><br>
<br>
<pre><code class="sql hljs">node    label  <font></font>
1       Leaf<font></font>
2       Inner<font></font>
3       Inner<font></font>
4       Leaf<font></font>
5       Root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（注意：有关树状数据结构的术语的更多信息，请参见</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。但是，不需要解决此问题！）</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决方案：</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fabian Hoffman在2020年5月2日提出了这种更通用的解决方案。</font><font style="vertical-align: inherit;">感谢Fabian</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> join_table <span class="hljs-keyword">AS</span><font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> <font></font>
        cur.node, <font></font>
        cur.parent, <font></font>
        <span class="hljs-keyword">COUNT</span>(next.node) <span class="hljs-keyword">AS</span> num_children
    <span class="hljs-keyword">FROM</span> <font></font>
        tree cur<font></font>
    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
        tree <span class="hljs-keyword">next</span> <span class="hljs-keyword">ON</span> (next.parent = cur.node)
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
        cur.node, <font></font>
        cur.parent<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span><font></font>
    node,<font></font>
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Root"</span>
        <span class="hljs-keyword">WHEN</span> num_children = <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">"Leaf"</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">"Inner"</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> label
<span class="hljs-keyword">FROM</span> 
    join_table </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
替代的解决方案，没有明确的连接：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">威廉Chardgin于2020年5月2日提请注意需要的条件</font></font><code>WHERE parent IS NOT NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这种解决方案的回报</font></font><code>Leaf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是</font></font><code>NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">谢谢威廉！</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    node,<font></font>
    <span class="hljs-keyword">CASE</span> 
        <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Root'</span>
        <span class="hljs-keyword">WHEN</span> node <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> 
            (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">FROM</span> tree <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Leaf'</span>
        <span class="hljs-keyword">WHEN</span> node <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">FROM</span> tree) <span class="hljs-keyword">AND</span> <span class="hljs-keyword">parent</span> <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Inner'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> label 
 <span class="hljs-keyword">from</span> 
    tree</code></pre><br>
<a name="7"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 3.每月的用户保留（几个部分）</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此任务改编自SiSense博客文章</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“使用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自我关联</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">来计算保留，</font></a><font style="vertical-align: inherit;">流出和重新激活” </font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a name="8"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们在表中具有网站上有关用户授权的统计信息</font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">日期|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-07-02 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 | </font><font style="vertical-align: inherit;">2018-10-04 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个请求，以接收每月保留的用户数。</font><font style="vertical-align: inherit;">在我们的例子中，此参数定义为在本月和上个月登录系统的用户数。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> a.user_id) retained_users 
 <span class="hljs-keyword">FROM</span> <font></font>
    logins a <font></font>
 <span class="hljs-keyword">JOIN</span> 
    logins b <span class="hljs-keyword">ON</span> a.user_id = b.user_id 
        <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, b.date) + 
                                             <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span>
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    date_trunc(<span class="hljs-string">'month'</span>, a.date)</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
汤姆·莫特尔（Tom Moertel）指出，在自动加入之前预先复制user_id可使解决方案更有效，并建议使用以下代码。</font><font style="vertical-align: inherit;">谢谢汤姆！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
替代解决方案：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> DistinctMonthlyUsers <span class="hljs-keyword">AS</span> (
  <span class="hljs-comment">/*
  *     ** , 
  *  
  */</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span>
      DATE_TRUNC(<span class="hljs-string">'MONTH'</span>, a.date) <span class="hljs-keyword">AS</span> month_timestamp,<font></font>
      user_id<font></font>
    <span class="hljs-keyword">FROM</span> logins<font></font>
  )<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span><font></font>
  CurrentMonth.month_timestamp month_timestamp,<font></font>
  <span class="hljs-keyword">COUNT</span>(PriorMonth.user_id) <span class="hljs-keyword">AS</span> retained_user_count
<span class="hljs-keyword">FROM</span> 
    DistinctMonthlyUsers <span class="hljs-keyword">AS</span> CurrentMonth
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 
    DistinctMonthlyUsers <span class="hljs-keyword">AS</span> PriorMonth
  <span class="hljs-keyword">ON</span>
    CurrentMonth.month_timestamp = PriorMonth.month_timestamp + <span class="hljs-built_in">INTERVAL</span> <span class="hljs-string">'1 MONTH'</span>
    <span class="hljs-keyword">AND</span> 
    CurrentMonth.user_id = PriorMonth.user_id</code></pre><br>
<a name="9"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们执行上一个任务，即计算每月保留的用户数-并将其倒置。</font><font style="vertical-align: inherit;">我们将写一个请求，对</font><font style="vertical-align: inherit;">本月</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尚未</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回该网站的</font><font style="vertical-align: inherit;">用户进行计数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，“丢失”的用户。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> b.user_id) churned_users 
<span class="hljs-keyword">FROM</span> <font></font>
    logins a <font></font>
<span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> 
    logins b <span class="hljs-keyword">ON</span> a.user_id = b.user_id 
        <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, b.date) + 
                                         <span class="hljs-built_in">interval</span> <span class="hljs-string">'1 month'</span>
<span class="hljs-keyword">WHERE</span> 
    a.user_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，也可以使用</font></font><code>LEFT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">解决此问题</font></font><code>RIGHT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a name="10"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：这</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能比实际面试时要困难的多。</font><font style="vertical-align: inherit;">认为它更像是一个难题-或者您可以跳过并继续进行下一个任务。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：因此我们很好地解决了之前的两个问题。</font><font style="vertical-align: inherit;">根据新任务的条款，我们现在有了丢失的用户表</font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果用户在过去一个月中处于活动状态，但是在此之后未处于活动状态，则将其输入到该月的表中。</font><font style="vertical-align: inherit;">看起来是这样的</font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">user_id | </font><font style="vertical-align: inherit;">month_date |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">12 | </font><font style="vertical-align: inherit;">2018-05-01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">234 | </font><font style="vertical-align: inherit;">2018-10-01 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：现在您想要进行同类群组分析，即</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对过去已重新激活</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的活动用户总数进行分析</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">与这些用户创建一个表。</font><font style="vertical-align: inherit;">您可以使用表格</font></font><code>user_churns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">创建同类群组</font></font><code>logins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在Postgres中，可通过访问当前时间戳</font></font><code>current_timestamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> user_login_data <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) month_timestamp,<font></font>
        a.user_id,<font></font>
        <span class="hljs-comment">/* 
        *   ,    SQL,   , 
        *      SELECT   HAVING.
        *       .  
        */</span> 
        <span class="hljs-keyword">MAX</span>(b.month_date) <span class="hljs-keyword">as</span> most_recent_churn, 
        <span class="hljs-keyword">MAX</span>(DATE_TRUNC(<span class="hljs-string">'month'</span>, c.date)) <span class="hljs-keyword">as</span> most_recent_active 
     <span class="hljs-keyword">FROM</span> <font></font>
        logins a<font></font>
     <span class="hljs-keyword">JOIN</span> <font></font>
        user_churns b <font></font>
            <span class="hljs-keyword">ON</span> a.user_id = b.user_id <span class="hljs-keyword">AND</span> DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) &gt; b.month_date 
     <span class="hljs-keyword">JOIN</span><font></font>
        logins c <font></font>
            <span class="hljs-keyword">ON</span> a.user_id = c.user_id 
            <span class="hljs-keyword">AND</span> 
            DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) &gt; DATE_TRUNC(<span class="hljs-string">'month'</span>, c.date)
     <span class="hljs-keyword">WHERE</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date) = DATE_TRUNC(<span class="hljs-string">'month'</span>, <span class="hljs-keyword">current_timestamp</span>)
     <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
        DATE_TRUNC(<span class="hljs-string">'month'</span>, a.date),<font></font>
        a.user_id<font></font>
     <span class="hljs-keyword">HAVING</span> 
        most_recent_churn &gt; most_recent_active</code></pre><br>
<a name="11"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4。增加总数</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该任务改编自SiSense博客文章“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL中的现金流建模”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们有一个</font></font><code>transactions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的表格：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">日期| </font><font style="vertical-align: inherit;">现金流量|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ----------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-01 | </font><font style="vertical-align: inherit;">-1000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-02 | </font><font style="vertical-align: inherit;">-100 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-03 | </font><font style="vertical-align: inherit;">50 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font></pre><br><font style="vertical-align: inherit;"></font><code>cash_flow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收入减去每天的费用</font><font style="vertical-align: inherit;">
在哪里</font><font style="vertical-align: inherit;">？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个请求以获取</font><font style="vertical-align: inherit;">每天现金流量的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总计</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以这样的方式最终获得以下表格：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">日期| </font><font style="vertical-align: inherit;">累积|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | --------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-01 | </font><font style="vertical-align: inherit;">-1000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-02 | </font><font style="vertical-align: inherit;">-1100 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-03 | </font><font style="vertical-align: inherit;">-1050 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    a.date <span class="hljs-built_in">date</span>, 
    <span class="hljs-keyword">SUM</span>(b.cash_flow) <span class="hljs-keyword">as</span> cumulative_cf 
<span class="hljs-keyword">FROM</span><font></font>
    transactions a<font></font>
<span class="hljs-keyword">JOIN</span> b <font></font>
    transactions b <span class="hljs-keyword">ON</span> a.date &gt;= b.date 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
    a.date <font></font>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用窗口函数的替代解决方案（更有效！）：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    <span class="hljs-built_in">date</span>, 
    <span class="hljs-keyword">SUM</span>(cash_flow) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span>) <span class="hljs-keyword">as</span> cumulative_cf 
<span class="hljs-keyword">FROM</span><font></font>
    transactions <font></font>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-built_in">date</span> <span class="hljs-keyword">ASC</span></code></pre><br>
<a name="12"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5条。移动平均线</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此任务改编自SiSense博客文章“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL和SQL Server中的移动平均值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动平均值可以通过多种方式计算。</font><font style="vertical-align: inherit;">在这里，我们使用先前的平均值。</font><font style="vertical-align: inherit;">因此，该月第七天的指标将是前六天和他本人的平均值。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：假设我们有一个</font></font><code>signups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种形式的表：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">日期| </font><font style="vertical-align: inherit;">招牌|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ---------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-01 | </font><font style="vertical-align: inherit;">10 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-02 | </font><font style="vertical-align: inherit;">20 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-01-03 | </font><font style="vertical-align: inherit;">50 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">... | </font><font style="vertical-align: inherit;">... |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2018-10-01 | </font><font style="vertical-align: inherit;">35 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：编写请求以获取每日注册的7天移动平均值。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
  a.date, <font></font>
  <span class="hljs-keyword">AVG</span>(b.sign_ups) average_sign_ups 
<span class="hljs-keyword">FROM</span> <font></font>
  signups a <font></font>
<span class="hljs-keyword">JOIN</span> 
  signups b <span class="hljs-keyword">ON</span> a.date &lt;= b.date + <span class="hljs-built_in">interval</span> <span class="hljs-string">'6 days'</span> <span class="hljs-keyword">AND</span> a.date &gt;= b.date
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
  a.date</code></pre><br>
<a name="13"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 6.几种连接条件</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此任务改编自SiSense博客文章</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“使用SQL分析电子邮件”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们的表格</font></font><code>emails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含从该地址发送</font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在其上接收的</font><font style="vertical-align: inherit;">电子邮件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">id | </font><font style="vertical-align: inherit;">主题| </font><font style="vertical-align: inherit;">来自| </font><font style="vertical-align: inherit;">到| </font><font style="vertical-align: inherit;">时间戳|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ---- | ---------- | -------------- | -------------- |- ------------------ |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">优胜美地 </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-02 12:45:03 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">大苏尔| </font><font style="vertical-align: inherit;">sarah@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-02 16:30:01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">优胜美地 </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-02 16:35:04 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">跑步| </font><font style="vertical-align: inherit;">jill@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-03 08:12:45 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">优胜美地 </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">2018-01-03 14:02:01 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">优胜美地 </font><font style="vertical-align: inherit;">thomas@g.com | </font><font style="vertical-align: inherit;">zach@g.com | </font><font style="vertical-align: inherit;">2018-01-03 15:01:05 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写请求以获取</font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送给的</font><font style="vertical-align: inherit;">每个字母（</font><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">响应时间</font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不要包含其他地址的信件。</font><font style="vertical-align: inherit;">假设每个线程都有一个唯一的主题。</font><font style="vertical-align: inherit;">请记住，该线程可能</font></font><code>zach@g.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他收件人</font><font style="vertical-align: inherit;">之间有多个往返信件</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    a.id, <font></font>
    <span class="hljs-keyword">MIN</span>(b.timestamp) - a.timestamp <span class="hljs-keyword">as</span> time_to_respond 
<span class="hljs-keyword">FROM</span> <font></font>
    emails a <font></font>
<span class="hljs-keyword">JOIN</span><font></font>
    emails b <font></font>
        <span class="hljs-keyword">ON</span> <font></font>
            b.subject = a.subject <font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.to = b.from<font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.from = b.to <font></font>
        <span class="hljs-keyword">AND</span> <font></font>
            a.timestamp &lt; b.timestamp <font></font>
 <span class="hljs-keyword">WHERE</span> 
    a.to = <span class="hljs-string">'zach@g.com'</span> 
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    a.id </code></pre><br>
<a name="14"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口功能的任务</font></font></h1><br>
<a name="15"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编号1.找到最大值的标识符</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们有一个表格，</font></font><code>salaries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中包含以下格式的部门和员工薪水数据：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  部门名称| </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">薪水|     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：写一个要求获得</font></font><code>empno</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高薪水</font><font style="vertical-align: inherit;">的请求</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">确保您的解决方案能够处理同等工资的案件！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> max_salary <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">MAX</span>(salary) max_salary
    <span class="hljs-keyword">FROM</span> <font></font>
        salaries<font></font>
    )<font></font>
<span class="hljs-keyword">SELECT</span> <font></font>
    s.empno<font></font>
<span class="hljs-keyword">FROM</span> <font></font>
    salaries s<font></font>
<span class="hljs-keyword">JOIN</span> 
    max_salary ms <span class="hljs-keyword">ON</span> s.salary = ms.max_salary</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用</font></font><code>RANK()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下</font><font style="vertical-align: inherit;">替代方案</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> sal_rank <span class="hljs-keyword">AS</span> 
  (<span class="hljs-keyword">SELECT</span> <font></font>
    empno, <font></font>
    <span class="hljs-keyword">RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) rnk
  <span class="hljs-keyword">FROM</span> <font></font>
    salaries)<font></font>
<span class="hljs-keyword">SELECT</span> <font></font>
  empno<font></font>
<span class="hljs-keyword">FROM</span><font></font>
  sal_rank<font></font>
<span class="hljs-keyword">WHERE</span> 
  rnk = <span class="hljs-number">1</span>;</code></pre><br>
<a name="16"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No. 2.带有窗口函数的平均值和排名（几个部分）</font></font></h2><br>
<a name="17"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：假设我们有一个</font></font><code>salaries</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下格式</font><font style="vertical-align: inherit;">的表</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  部门名称| </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">薪水|     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个查询，该查询返回相同的表，但带有一个新列，以显示部门的平均工资。</font><font style="vertical-align: inherit;">我们期望这样的表：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  部门名称| </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">薪水| </font><font style="vertical-align: inherit;">avg_salary |     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- + ------------ +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">5020 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 | </font><font style="vertical-align: inherit;">3700 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 | </font><font style="vertical-align: inherit;">3700 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">4867 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 | </font><font style="vertical-align: inherit;">4867 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">4867 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    *, <font></font>
    <span class="hljs-comment">/*
    * AVG() is a Postgres command, but other SQL flavors like BigQuery use 
    * AVERAGE()
    */</span> 
    <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(salary),<span class="hljs-number">0</span>) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> depname) avg_salary
<span class="hljs-keyword">FROM</span>
    salaries</code></pre><br>
<a name="18"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个查询，该查询根据其所在部门的薪水在时间表中添加每个雇员的位置的列，薪水最高的雇员将获得该位置的位置1。我们期望使用这种形式的表格：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">  部门名称| </font><font style="vertical-align: inherit;">empno | </font><font style="vertical-align: inherit;">薪水| </font><font style="vertical-align: inherit;">薪金等级|     </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
----------- + ------- + -------- + ------------- +</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">11 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">7 | </font><font style="vertical-align: inherit;">4200 | </font><font style="vertical-align: inherit;">5 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">9 | </font><font style="vertical-align: inherit;">4500 | </font><font style="vertical-align: inherit;">4 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">8 | </font><font style="vertical-align: inherit;">6000 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 发展 </font><font style="vertical-align: inherit;">10 | </font><font style="vertical-align: inherit;">5200 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">3500 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 人员| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">3900 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">5000 | </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 销售| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">4800 | </font><font style="vertical-align: inherit;">2 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <font></font>
    *, <font></font>
    <span class="hljs-keyword">RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> depname <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) salary_rank
 <span class="hljs-keyword">FROM</span>  
    salaries </code></pre><br>
<a name="19"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中高难度的其他任务</font></font></h1><br>
<a name="20"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编号1.直方图</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们有一个表格</font></font><code>sessions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中每一行代表一个视频流会话，长度以秒为单位：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">session_id | </font><font style="vertical-align: inherit;">length_seconds |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------------ | ---------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">23 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">453 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">27 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写一个查询来计算间隔为5秒的会话数，即对于上述片段，结果将如下所示：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">桶| </font><font style="vertical-align: inherit;">数|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">20-25 | </font><font style="vertical-align: inherit;">2 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">450-455 | </font><font style="vertical-align: inherit;">1 |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
适当的行标签（“ 5-10”等）的最大分数计数</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决方案：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> bin_label <span class="hljs-keyword">AS</span> 
(<span class="hljs-keyword">SELECT</span> <font></font>
    session_id, <font></font>
    <span class="hljs-keyword">FLOOR</span>(length_seconds/<span class="hljs-number">5</span>) <span class="hljs-keyword">as</span> bin_label 
 <span class="hljs-keyword">FROM</span><font></font>
    sessions <font></font>
 )<font></font>
 <span class="hljs-keyword">SELECT</span> 
    CONCATENTATE(<span class="hljs-keyword">STR</span>(bin_label*<span class="hljs-number">5</span>), <span class="hljs-string">'-'</span>, <span class="hljs-keyword">STR</span>(bin_label*<span class="hljs-number">5</span>+<span class="hljs-number">5</span>)) <span class="hljs-keyword">bucket</span>, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> session_id) <span class="hljs-keyword">count</span> 
 <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <font></font>
    bin_label<font></font>
 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    bin_label <span class="hljs-keyword">ASC</span> </code></pre><br>
<a name="21"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2号。交叉连接（几个部分）</font></font></h2><br>
<a name="22"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们有一个表格</font></font><code>state_streams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中在每行上标明了州名称和来自视频托管的流式传输的总小时数：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">州| </font><font style="vertical-align: inherit;">total_streams |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------- | --------------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">数控| </font><font style="vertical-align: inherit;">34569 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SC | </font><font style="vertical-align: inherit;">33999 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">CA | </font><font style="vertical-align: inherit;">98324 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">MA | </font><font style="vertical-align: inherit;">19345 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">.. | </font><font style="vertical-align: inherit;">.. |</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（实际上，这种类型的聚合表通常具有日期列，但在此任务中我们将其排除在外）</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写查询以获取状态对，状态对之间的线程总数不超过一千。</font><font style="vertical-align: inherit;">对于以上代码段，我们希望看到以下内容：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">state_a | </font><font style="vertical-align: inherit;">state_b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| --------- | --------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">数控| </font><font style="vertical-align: inherit;">SC |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">SC | </font><font style="vertical-align: inherit;">数控|</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a<font></font>
 <span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> <font></font>
    state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &lt;&gt; b.state </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有关信息，也可以在不显式指定联接的情况下编写交叉联接：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a, state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &lt;&gt; b.state </code></pre><br>
<a name="23"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2部分</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个奖励问题，而不是一个非常重要的SQL模板。</font><font style="vertical-align: inherit;">您可以跳过它！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何从以前的解决方案中修改SQL以删除重复项？</font><font style="vertical-align: inherit;">例如，在同一个表的例子中，蒸汽</font></font><code>NC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>SC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有一个时间，而不是两个。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span>
    a.state <span class="hljs-keyword">as</span> state_a, <font></font>
    b.state <span class="hljs-keyword">as</span> state_b 
 <span class="hljs-keyword">FROM</span>   <font></font>
    state_streams a, state_streams b <font></font>
 <span class="hljs-keyword">WHERE</span> 
    <span class="hljs-keyword">ABS</span>(a.total_streams - b.total_streams) &lt; <span class="hljs-number">1000</span>
    <span class="hljs-keyword">AND</span> 
    a.state &gt; b.state </code></pre><br>
<a name="24"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3号。高级计算</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">致谢：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该任务是根据</font><font style="vertical-align: inherit;">我在StackOverflow上提出的一个问题</font><font style="vertical-align: inherit;">的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改编而成的</font><font style="vertical-align: inherit;">（我的昵称是zthomas.nc）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：这</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能比实际面试时要困难的多。</font><font style="vertical-align: inherit;">认为它更像是一个难题-或者您可以跳过它！</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们有一个这样的表</font></font><code>table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font><code>user</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个类的不同值可以对应</font><font style="vertical-align: inherit;">于同一用户</font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">用户| </font><font style="vertical-align: inherit;">类</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------ | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">一个|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">b |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">一个|</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设一个类只有两个可能的值。</font><font style="vertical-align: inherit;">编写查询以计算每个类中的用户数。</font><font style="vertical-align: inherit;">在这种情况下，具有两个标签</font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须引用class的用户</font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于我们的样本，我们得到以下结果：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">类 </font><font style="vertical-align: inherit;">数|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| ------- | ------- |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">一个| </font><font style="vertical-align: inherit;">1 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">b | </font><font style="vertical-align: inherit;">2 |</font></font></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定：</font></font></b><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">WITH</span> usr_b_sum <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">user</span>, 
        <span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) num_b
    <span class="hljs-keyword">FROM</span> 
        <span class="hljs-keyword">table</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
        <span class="hljs-keyword">user</span><font></font>
), <font></font>
<font></font>
usr_class_label <span class="hljs-keyword">AS</span> <font></font>
(<font></font>
    <span class="hljs-keyword">SELECT</span> 
        <span class="hljs-keyword">user</span>, 
        <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> num_b &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'b'</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'a'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">class</span> 
    <span class="hljs-keyword">FROM</span> <font></font>
        usr_b_sum<font></font>
)<font></font>
<font></font>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-keyword">class</span>, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">user</span>) <span class="hljs-keyword">count</span> 
<span class="hljs-keyword">FROM</span><font></font>
    usr_class_label<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-keyword">class</span> 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
    <span class="hljs-keyword">class</span> <span class="hljs-keyword">ASC</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一种替代解决方案使用操作</font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">员中的说明</font></font><code>SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> 
    <span class="hljs-string">"a"</span> <span class="hljs-keyword">class</span>,
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) - <font></font>
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span>) <span class="hljs-keyword">count</span> 
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> 
    <span class="hljs-string">"b"</span> <span class="hljs-keyword">class</span>,<font></font>
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">class</span> = <span class="hljs-string">'b'</span>) <span class="hljs-keyword">count</span> </code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500346/index.html">Kubernetes中的DNS问题。公开验尸</a></li>
<li><a href="../zh-CN500348/index.html">数学家认为COVID-19大流行，或者经典SEIRD模型不起作用的原因</a></li>
<li><a href="../zh-CN500352/index.html">如何在Facebook上实习并在伦敦获得报价？向Facebook工程师提问</a></li>
<li><a href="../zh-CN500354/index.html">在Google跟踪代码管理器中跟踪数据的新方法-服务器端标记</a></li>
<li><a href="../zh-CN500356/index.html">通过WebRTC在设备之间直接文件传输</a></li>
<li><a href="../zh-CN500364/index.html">在Moodle和BigBlueButton上扩展学校学习门户</a></li>
<li><a href="../zh-CN500368/index.html">生成可预测的随机序列：一种不同的置换方法</a></li>
<li><a href="../zh-CN500370/index.html">面向2020年值得订阅的10个有用的英语播客</a></li>
<li><a href="../zh-CN500378/index.html">工作中有效的信息搜索</a></li>
<li><a href="../zh-CN500380/index.html">远程处理个人数据：风险和可能的后果</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>