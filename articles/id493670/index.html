<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍚 ⛏️ 👌🏼 Sistem Media untuk Toyota Prius (Bagian 2) 👻 👱 🌈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kelanjutan proyek untuk menggantikan sistem media Toyota Prius. 
 
 Dalam artikel ini - PHY, Transport, dan pengiriman paket ke perangkat host, yang a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sistem Media untuk Toyota Prius (Bagian 2)</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/493670/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kelanjutan proyek untuk menggantikan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sistem media Toyota Prius. </font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini - PHY, Transport, dan pengiriman paket ke perangkat host, yang akhirnya berhasil diverifikasi pada kepala asli asli Prius. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan cepat dongeng memengaruhi, tetapi tidak dengan cepat hal itu dilakukan. </font><font style="vertical-align: inherit;">Hari ini saya melanjutkan proyek berlarut-larut untuk mendesain ulang sistem media di Prius, yang dimulai 2 tahun lalu.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offtopik Historis</font></font></b>
                        <div class="spoiler_text">   —  USB-AVC    ,        .           ,     , ..       ++ —     ,  . <br>
<br>
  ,    ,        ,     ,           . <br>
<br>
,      ,     ,   PHY- . <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, sejak awal. </font><font style="vertical-align: inherit;">Menggali di Internet untuk adapter ke AVC-LAN, saya sangat sering melihat solusi yang mirip dengan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dan dalam diskusi, komentar seperti itu sering kali menyelinap:</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jujur, itu tidak bekerja dengan baik, atau lebih tepatnya itu tidak bekerja dengan baik dengan semua kepala. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sementara ban dapat dibaca dengan sempurna di beberapa radio tua dengan Spacio yang berusia 99 tahun.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya pada dasarnya menentang melakukan sesuatu, dan solusi dengan ketidakstabilan struktural tidak cocok untuk saya. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan mengulangi jalur rekayasa balik ban. Pergilah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, kami terhubung ke bus dengan mobil langsung, dan menghapus bentuk gelombang: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cc/cz/uf/ccczuftggnmbqqtebaewgwcx_3e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Awal paket. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ac/v-/wu/acv-wuwaaoywpav08fjqekdyaq8.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit ada di suatu tempat di tengah, lebih besar. </font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/l3/cy/ba/l3cyba6lailk2fcxp9274-eltlk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sesuatu yang sangat mirip dengan ACK.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sedikit lagi tentang langkah aneh ini - di bawah ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya sudah membuat tangkapan layar bentuk gelombang dari data yang disimpan, saat mengambilnya, saya tidak segera memperhatikan rentang tegangan tempat saya mengambil data. Dan ketika dia menggambarnya, dia harus turun ke mobil lagi untuk memastikan bahwa dia tidak selamat dari pikiran. Ya, rentang bus diferensial hanya 200mV (!!!).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya kita pergi ke lembar data yang digunakan oleh rekan ST485, dan kita lihat yang berikut di sana:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/ui/n8/dmuin85kauk3hwji9d6w4d2dx5w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, sebenarnya, akar dari semua masalah ditemukan, karena itu kita harus bermain dengan resistor, dan berdoa kepada para dewa rosin sehingga konverter bekerja pada mesin tertentu. Bekerja di dekat ambang adalah jahat. Tetapi yang lebih menarik adalah bahwa untuk AVC-LAN, yang dalam fisika adalah klon dari beberapa IE-Bus dari NEC, sesuai dengan spesifikasinya (tautannya akan sedikit lebih jauh), keadaan aktif adalah tegangan di atas 120mV, walaupun pada kenyataannya ST485 memiliki hak untuk mempertimbangkan apapun yang kurang dari 200mV adalah nol. Nah, itu adalah, jika, karena penyimpangan produksi, ST485 memiliki level ambang sedikit lebih rendah, dan muncul di bus untuk margin sedikit di atas norma (hingga 6 volt diperbolehkan), maka, tentu saja, ST485 akan dapat menerima sinyal seperti itu. Dan ketidakakuratan pembuatan ini adalah satu-satunya hal yang memaksa perangkat dengan ST485 dalam komposisi </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terkadang</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerja. Tentu saja, kita tidak akan meletakkan kebahagiaan seperti itu dalam pembangunan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi kedua yang tersedia berdasarkan ST485 yang sama dan penguat operasional, saya tidak suka banyak komponen. Ya, pada abad ke-21 kita hidup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solusi: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada konverter khusus untuk AVC-LAN. Tapi saya tidak bisa mendapatkannya dengan harga yang terjangkau untuk perangkat ini. Brotherly China kembali datang untuk menyelamatkan, di mana </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HA12240FP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditemukan </font><font style="vertical-align: inherit;">, yang memiliki perbedaan tegangan untuk menerima kayu. "1" menurut datasheet adalah 80..110 mV. Ini akan memungkinkan ban kami untuk mengatur level aktif dengan margin hampir dua kali lipat. Mengatur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melahirkan skema pada STM32F103 yang disebutkan di bagian pertama: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ds/mj/ey/dsmjeylhhd1tldlydzj7kdf8yky.png"><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skema ini lahir dengan tergesa-gesa, mengandung </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kesalahan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pengemudi bus harus diberdayakan dari 5V. Jika demikian, seperti pada diagram, diferensialnya naik. ambang batas, dan tidak semua paket diterima. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya sederhana untuk primitivisme, saya pikir, tidak perlu deskripsi. Kecuali, mungkin, fakta bahwa pilihan kaki untuk RX1 / 2 tidak disengaja, dan versi pertama dari rangkaian memerlukan "perbaikan file" untuk mendapatkan sinyal ke input tangkapan / perbandingan, karena saya ingin menggunakannya untuk mengukur panjang pulsa. Solusi alternatif - jajak pendapat dan interupsi pada perubahan status kehilangan akurasi dan kompleksitas implementasi perangkat lunak. Plus - Saya ingin menerima setidaknya dua garis secara paralel (ada tiga di kepala), dan jika bagian depan bertepatan dengan dua, Anda dapat mengucapkan selamat tinggal pada gagasan keakuratan yang dapat diterima jika Anda tidak menggunakan tangkapan / perbandingan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisis lebih lanjut dari data dalam paket ditulis dengan baik di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tetapi, mengingat tautan tidak konsisten, saya akan mengulangi secara singkat di sini:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bus diferensial, di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini mereka</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menulis tentang interpretasi tingkat log. </font><font style="vertical-align: inherit;">"1" pada &lt;20mV, masuk. </font><font style="vertical-align: inherit;">"0" -&gt; 110mV.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Panjang bit adalah 40 µs, 20 µs pertama selalu "0", 7 µs terakhir selalu "1", di tengah adalah nilai bit. </font></font><br>
<img src="https://habrastorage.org/webt/vv/6_/_8/vv6__8pbidlx43eqnvjbupnee3g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nah, lampu lalu lintas:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i1/u2/k-/i1u2k-ji3f5mckou9r7mut6nzkm.png"><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mulai bit - lebih panjang dari 180 μs </font></font></li>
<li>        (ACK).    «»,    - :<br>
<br>
<img src="https://habrastorage.org/webt/pg/sl/hq/pgslhqq84ha2ytwegw9njtlq6we.png"><br>
<br>
  ACK-    ,    Dallas 1-wire,      ,  , , .    ,   . 1     ,      «0» ( ,    ),     .2  ,      ,    ,   .  .3 ,        (1),     ,           ,    7  ,    . «1». <br>
 </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya ... kami sudah tahu level fisiknya, menggambar sirkuit, dan memisahkan papannya. Ternyata kira-kira seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_d/4y/gj/_d4ygj2rf315jb9yqodcdfh7dda.png"><br>
<br>
<img src="https://habrastorage.org/webt/fu/om/rm/fuomrmmvbepdwmvpiqrmh1efezm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Papan sirkuit yang dicetak agak tidak berhasil, dan bukan karena kode QR tidak bekerja dalam pencetakan layar sutra. Ada kesalahan di sirkuit di dalamnya (dalam diagram di atas saya sudah memperbaikinya) mengenai pemilihan kaki untuk RX, dan tiga driver garis diceraikan. Dalam proses penulisan dan debugging program, saya menyadari bahwa itu baik jika Anda dapat menjalankan setidaknya dua dengan mantap. Ya, dan lebih banyak tidak perlu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yah ... perangkatnya ternyata sederhana dan efektif, sementara masalah konstruktif dengan ketidakcocokan tingkat telah diselesaikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lebih lanjut dalam program ini:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"> </a>   .   ,        .  : *         USB —     ,    ,     «»  .    . *      ,             8,  6-    ,   4.4   .       ,    ,       . </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitor Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk membalikkan logika bus sepenuhnya. </font><font style="vertical-align: inherit;">Jika seseorang kuat di Android dan Kotlin, saya akan berterima kasih atas kesempatan untuk berkonsultasi. </font><font style="vertical-align: inherit;">Ini adalah upaya malu-malu untuk menguasai semuanya sekaligus, oleh karena itu jangan masukkan repositori dengan referensi tanpa pass baru :)</font></font></li>
</ol><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: sementara tetap </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> data e bukan mikrodetik adalah ms.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id493660/index.html">CSS: panduan fungsi calc penuh ()</a></li>
<li><a href="../id493662/index.html">Kekuatan ruang</a></li>
<li><a href="../id493664/index.html">Analisis tingkat propagasi COVID-19 dan publikasi hasilnya di dstack.ai</a></li>
<li><a href="../id493666/index.html">Bagaimana kami mengajarkan kecerdasan buatan untuk menjawab pertanyaan dukungan. Pengalaman Yandex.Taxi</a></li>
<li><a href="../id493668/index.html">Bagaimana saya membuat pembuat situs selanjutnya</a></li>
<li><a href="../id493674/index.html">Ikhtisar pemutar video untuk web</a></li>
<li><a href="../id493678/index.html">Boston Dynamics: Dari Perintah Angkatan Darat AS ke Spot Robot Komersial</a></li>
<li><a href="../id493680/index.html">10 trik bagaimana untuk tidak menggabungkan konfu online</a></li>
<li><a href="../id493686/index.html">Asal misterius papan permainan tentang kode peretasan Mastermind</a></li>
<li><a href="../id493688/index.html">Kami membuat Tim Microsoft bebas - tetap berhubungan dengan rekan di saat yang sulit ini</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>