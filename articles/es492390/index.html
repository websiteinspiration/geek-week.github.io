<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèº üë®üèΩ‚Äçüç≥ ü•ô Guerra en los frenos. Optimizar el n√∫mero de representaciones de componentes en React Native üò£ üç§ üôçüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Kamo Spertsyan, estoy involucrado en el desarrollo React Native en Profi.ru. Si decide utilizar la tecnolog√≠a React Native par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Guerra en los frenos. Optimizar el n√∫mero de representaciones de componentes en React Native</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492390/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola Habr! Mi nombre es Kamo Spertsyan, estoy involucrado en el desarrollo React Native en Profi.ru. Si decide </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilizar la tecnolog√≠a React Native</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para ofrecer r√°pidamente caracter√≠sticas del producto y centrarse en la velocidad de desarrollo, es probable que tenga problemas de rendimiento. Al menos eso es lo que nos pas√≥. Despu√©s de seis meses de desarrollo activo, el rendimiento de nuestra aplicaci√≥n cay√≥ por debajo de un nivel cr√≠tico: todo fue extremadamente lento. Por lo tanto, retomamos la optimizaci√≥n: eliminamos todos los "frenos" durante el inicio, las transiciones entre pantallas, las pantallas de representaci√≥n, las reacciones a las acciones del usuario. Como resultado, en tres meses llevaron la experiencia del usuario al nivel nativo. En este art√≠culo quiero hablar sobre c√≥mo optimizamos la aplicaci√≥n en React Native y resolvimos el problema de los renders de m√∫ltiples componentes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tv/qy/9b/tvqy9bo_jyqc4cz044_gneepvmw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reun√≠ recomendaciones que ayudar√°n a minimizar la cantidad de redibujos sin sentido de componentes. </font><font style="vertical-align: inherit;">Para mayor claridad, en los ejemplos comparo las implementaciones "malas" y "buenas". </font><font style="vertical-align: inherit;">El art√≠culo ser√° √∫til para aquellos que ya enfrentan un rendimiento deficiente de la aplicaci√≥n y para aquellos que no desean permitirlo en el futuro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usamos React Native emparejado con Redux. </font><font style="vertical-align: inherit;">Algunos de los consejos est√°n relacionados con esta biblioteca. </font><font style="vertical-align: inherit;">Tambi√©n en el ejemplo, uso la biblioteca Redux-thunk para simular el trabajo con la red.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCu√°ndo pensar en el rendimiento?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, vale la pena recordarlo desde el comienzo del trabajo en la aplicaci√≥n. Pero si su aplicaci√≥n ya se est√° ralentizando, no se desespere, todo se puede arreglar. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos lo saben, pero por si acaso, mencionar√©: es mejor verificar el rendimiento en dispositivos d√©biles. Si est√° desarrollando en dispositivos potentes, es posible que no est√© al tanto de los "frenos" de los usuarios finales. Decide por ti mismo los dispositivos que te guiar√°n. Mida el tiempo o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los gr√°ficos de control para compararlos con los resultados despu√©s de la optimizaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
React Native de f√°brica proporciona la capacidad de medir aplicaciones FPS a trav√©s de Developer Tools ‚Üí Show perf monitor. </font><font style="vertical-align: inherit;">El valor de referencia es 60 cuadros por segundo. </font><font style="vertical-align: inherit;">Cuanto m√°s bajo es este indicador, m√°s fuerte se "ralentiza" la aplicaci√≥n, no responde o reacciona con retraso a las acciones del usuario. </font><font style="vertical-align: inherit;">Uno de los principales efectos en FPS es la cantidad de renders, cuya "gravedad" depende de la complejidad de los componentes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n de ejemplo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muestro todas las recomendaciones sobre el ejemplo de una aplicaci√≥n simple con una lista de noticias. </font><font style="vertical-align: inherit;">La aplicaci√≥n tiene una pantalla, que se encuentra </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con las noticias. </font><font style="vertical-align: inherit;">Una noticia es un componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que consta de dos componentes m√°s peque√±os: el t√≠tulo ( </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) y el cuerpo ( </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">El ejemplo completo se puede ver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Adem√°s en el texto hay enlaces a varias ramas del repositorio para ejemplos espec√≠ficos. </font><font style="vertical-align: inherit;">El repositorio se utiliza para la comodidad de los lectores que desean explorar ejemplos m√°s profundamente. </font><font style="vertical-align: inherit;">El c√≥digo en el repositorio y los ejemplos a continuaci√≥n no dicen ser perfectos, se necesitan √∫nicamente con fines de demostraci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, todos los componentes se muestran esquem√°ticamente con enlaces y accesorios.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/d9/ng/z6/d9ngz6hldmphbkjky1a-7-38nlq.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el m√©todo de representaci√≥n de cada componente, agregu√© el resultado a la consola de informaci√≥n √∫nica sobre √©l: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_{no}<font></font>
ITEM_TITLE_{no}<font></font>
ITEM_BODY_{no}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donde se </font></font><code>{no}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encuentra el n√∫mero de serie de la noticia para distinguir entre diferentes representaciones de noticias de m√∫ltiples representaciones de la misma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para probar en cada </font></font><code>refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lista de noticias, se agregan noticias adicionales a su comienzo. </font><font style="vertical-align: inherit;">Al mismo tiempo, se muestra el siguiente mensaje en la consola:</font></font><br>
<br>
<pre><code class="plaintext hljs">--------------[ REFRESHING ]--------------</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estos registros ayudar√°n a comprender si hay un problema en alg√∫n componente en particular y luego a determinar si fue posible optimizarlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si se implementa correctamente, nuestro registro despu√©s del lanzamiento y varias actualizaciones deber√≠an verse as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_4<font></font>
ITEM_TITLE_4<font></font>
ITEM_BODY_4</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el primer inicio, se dibujan la pantalla y dos noticias iniciales. </font><font style="vertical-align: inherit;">Al actualizar el tablero, la pantalla se vuelve a mostrar, porque sus datos realmente han cambiado. </font><font style="vertical-align: inherit;">M√°s noticias surgen. </font><font style="vertical-align: inherit;">Todas las noticias anteriores no se vuelven a dibujar, ya que no hubo cambios en sus datos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCu√°ndo se representa un componente?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En React y React Native, hay dos condiciones para representar un componente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambiando sus accesorios / estado,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">render del componente padre.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una funci√≥n se puede redefinir en un componente </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: recibe nuevos Props y State como entrada y le indica si el componente debe representarse. A menudo, para evitar representaciones innecesarias, </font><font style="vertical-align: inherit;">es suficiente </font><font style="vertical-align: inherit;">una </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comparaci√≥n superficial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de los objetos Props y State. Por ejemplo, esto elimina representaciones innecesarias cuando cambia el componente principal, si no afectan al componente secundario. Para no escribir una comparaci√≥n de superficie manualmente cada vez, puede heredar un componente del </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que encapsula esta verificaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando usamos la funci√≥n de enlace de conexi√≥n, la biblioteca Redux crea un nuevo componente que est√° "conectado" al Estado global. Los cambios en este estado desencadenan un m√©todo</font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que devuelve nuevos accesorios. </font><font style="vertical-align: inherit;">A continuaci√≥n, se inicia una comparaci√≥n de accesorios antiguos y nuevos, independientemente de si el componente se declar√≥ </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o no. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere estos matices en nuestro ejemplo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dejaremos </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que el </font><font style="vertical-align: inherit;">componente </font><font style="vertical-align: inherit;">pase </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">herede de </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- de </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de ejemplo completo</font></font></a><br>
<br>
<pre><code class="plaintext hljs">export class NewsItemTitle extends React.Component<font></font>
export class NewsItemBody extends React.PureComponent</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ se ver√° el registro despu√©s de una actualizaci√≥n de la placa:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede ver que las noticias y los componentes de los titulares se vuelven a dibujar. </font><font style="vertical-align: inherit;">Los consideraremos a su vez. </font></font><br>
<br>
<code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">declarado usando </font></font><code>connect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como accesorio, este componente recibe un identificador, por el cual posteriormente recibe noticias en </font></font><code>mapStateToProps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">const mapStateToProps = (state, ownProps) =&gt; ({<font></font>
  item: state.newsMap[ownProps.itemKey],<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que al actualizar el tablero, todas las noticias se descargan nuevamente, el objeto se </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">actualizar√° y luego se referir√° a varias celdas de memoria. En otras palabras, ser√°n objetos diferentes, incluso si todos los campos contenidos son iguales. Por lo tanto, se obtiene una comparaci√≥n del componente State'ov anterior y el nuevo </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El componente se volver√° a representar, a pesar de que, de hecho, los datos no han cambiado. </font></font><br>
<br>
<code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se hereda de </font></font><code>React.Component</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo que se vuelve a representar cada vez que se representa el componente principal. Esto sucede independientemente de los valores de los accesorios antiguos y nuevos. </font></font><br>
<br>
<code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">heredado de </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo que compara accesorios antiguos y nuevos. En las noticias 1 y 2, sus valores son equivalentes, por lo tanto, el componente se representa solo para las noticias 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para optimizar las representaciones</font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo declaralo como </font></font><code>React.PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En el caso de, </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe redefinir la funci√≥n </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return !shallowEqual(this.props.item, nextProps.item);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de ejemplo completo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Aqu√≠ </font></font><code>shallowEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hay una funci√≥n para la comparaci√≥n de superficie de objetos que proporciona Redux. </font><font style="vertical-align: inherit;">Puedes escribir as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">shouldComponentUpdate(nextProps) {<font></font>
  return (<font></font>
    this.props.item.title !== nextProps.item.title ||<font></font>
    this.props.item.body !== nextProps.item.body<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ver√° nuestro registro despu√©s de esto: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><div class="spoiler_text"> <code>shouldComponentUpdate</code>  <code>NewsItem</code> ,  <code>NewsItemTitle</code>   .        . <code>NewsItemTitle</code>    -         <code>NewsItem</code>,     .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">React.memo y componentes funcionales</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No es </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posible </font><font style="vertical-align: inherit;">anular </font><font style="vertical-align: inherit;">en un componente funcional. </font><font style="vertical-align: inherit;">Pero esto no significa que para optimizar un componente funcional, debe reescribirlo en uno de clase. </font><font style="vertical-align: inherit;">Para tales casos, se </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proporciona la</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> funci√≥n de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">memorizaci√≥n</font></a><font style="vertical-align: inherit;"> React.memo </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Acepta una entrada de componente y una funci√≥n de comparaci√≥n opcional </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cuando se le llama, </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtiene accesorios viejos y nuevos y deber√≠a devolver el resultado de la comparaci√≥n. </font><font style="vertical-align: inherit;">La diferencia con </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lo que </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deber√≠a regresar </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si los accesorios son iguales, y no al rev√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, la </font></font><code>NewsItemTitle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memorizaci√≥n puede verse as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">areEqual(prevProps, nextProps) {<font></font>
  return shallowEqual(prevProps, nextProps);<font></font>
}<font></font>
export OptimizedNewsItemTitle = React.memo(NewsItemTitle, areEqual)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si usted no pasa </font></font><code>areEqual</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font></font><code>React.memo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a continuaci√≥n, se har√° una comparaci√≥n superficial de accesorios, por lo que nuestro ejemplo se puede simplificar:</font></font><br>
<br>
<pre><code class="plaintext hljs">export OptimizedNewsItemTitle = React.memo(NewsItemTitle)</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lambda funciona en accesorios</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para procesar eventos de componentes, las funciones se pueden pasar a sus accesorios. </font><font style="vertical-align: inherit;">El ejemplo m√°s llamativo es la implementaci√≥n </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A menudo se utilizan funciones lambda an√≥nimas para esto. </font><font style="vertical-align: inherit;">Digamos </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que queremos mostrar solo la vista previa, y si hace clic en ella, todo el texto. </font><font style="vertical-align: inherit;">Para hacer esto, al renderizar </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasaremos el siguiente accesorio:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={() =&gt; this.props.expandBody()}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el registro con esta implementaci√≥n cuando </font></font><code>shouldComponentUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elimina </font><font style="vertical-align: inherit;">el m√©todo </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los cuerpos de noticias 1 y 2 se representan, aunque sus datos no han cambiado, pero lo </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√°n </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esto se debe al hecho de que para cada render el </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor de los accesorios </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se crea de nuevo. </font><font style="vertical-align: inherit;">T√©cnicamente, </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con cada render, apunta a una nueva √°rea en la memoria, por lo que una comparaci√≥n superficial de los apoyos en </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve falso. </font><font style="vertical-align: inherit;">El problema se soluciona con la siguiente entrada:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  onPress={this.props.expandBody}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iniciar sesi√≥n: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de ejemplo completo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Desafortunadamente, una funci√≥n an√≥nima no puede reescribirse siempre como m√©todo o campo de clase para dicho registro. El caso m√°s com√∫n es cuando dentro de la funci√≥n lambda se utilizan las variables de alcance de la funci√≥n en la que se declara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere este caso en nuestro ejemplo. Para pasar de la lista general a la pantalla de una noticia, agregamos el procesamiento de hacer clic en el cuerpo de la noticia. El m√©todo del </font></font><code>renderItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">componente </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se ver√° as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={() =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No se puede declarar una </font><font style="vertical-align: inherit;">
funci√≥n an√≥nima </font><font style="vertical-align: inherit;">en una clase, porque la variable </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se necesita para ir a una noticia espec√≠fica </font><font style="vertical-align: inherit;">desaparecer√° del alcance </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soluci√≥n m√°s simple al problema es cambiar la firma de los accesorios del </font></font><code>onBodyPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que el par√°metro requerido se pase a la funci√≥n cuando se llama. </font><font style="vertical-align: inherit;">En este caso, este es el identificador de noticias.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={item =&gt; this.onItemBodyPress(item)}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este caso, ya podemos eliminar la funci√≥n an√≥nima en el m√©todo de clase de componente.</font></font><br>
<br>
<pre><code class="plaintext hljs">const renderItem = ({item}) =&gt; (<font></font>
  &lt;NewsItem<font></font>
    itemKey={item}<font></font>
    onBodyPress={this.onItemBodyPress}<font></font>
  /&gt;<font></font>
);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, tal soluci√≥n requerir√° que cambiemos el componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="plaintext hljs">class NewsItemComponent extends React.Component {<font></font>
render() {<font></font>
  ...<font></font>
  return (<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={() =&gt; this.props.onBodyPress(this.props.item)}<font></font>
        ...<font></font>
      /&gt;<font></font>
      ...<font></font>
  );<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y nuevamente volvemos al problema indicado: pasamos una nueva funci√≥n lambda al componente hijo para cada render del padre. </font><font style="vertical-align: inherit;">Solo que ahora hemos bajado un nivel. </font><font style="vertical-align: inherit;">Iniciar sesi√≥n:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para deshacerse de este problema en la ra√≠z, puede usar el gancho </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useCallback</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permite memorizar una llamada de funci√≥n con pasar un argumento. </font><font style="vertical-align: inherit;">Si el argumento de la funci√≥n no cambia, el resultado de la llamada </font></font><code>useCallback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apuntar√° a la misma √°rea de memoria. </font><font style="vertical-align: inherit;">En nuestro ejemplo, esto significa que al volver a dibujar las mismas noticias, el </font></font><code>onPress</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">componente de </font><font style="vertical-align: inherit;">utiler√≠a </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no cambiar√°. </font><font style="vertical-align: inherit;">Los ganchos solo se pueden usar en componentes funcionales, por lo que el aspecto final del componente </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° el siguiente:</font></font><br>
<br>
<pre><code class="plaintext hljs">function NewsItemComponent(props) {<font></font>
  ...<font></font>
  const {itemKey, onBodyPress} = props.item;<font></font>
  const onPressBody = useCallback(() =&gt; onBodyPress(itemKey), [itemKey, onBodyPress]);<font></font>
  return (<font></font>
    &lt;View&gt;<font></font>
      ...<font></font>
      &lt;NewsItemBody<font></font>
        ...<font></font>
        onPress={onPressBody}<font></font>
        ...<font></font>
      /&gt;<font></font>
    &lt;/View&gt;<font></font>
  );<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y el registro: </font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de ejemplo completo</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matrices y objetos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En JavaScript, las funciones se representan como objetos, junto con las matrices. </font><font style="vertical-align: inherit;">Por lo tanto, el ejemplo del bloque anterior es un caso especial de crear un nuevo objeto en accesorios. </font><font style="vertical-align: inherit;">Es bastante com√∫n, as√≠ que lo puse en un p√°rrafo separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cualquier creaci√≥n de nuevas funciones, matrices u objetos en accesorios lleva a un renderizador de componentes. </font><font style="vertical-align: inherit;">Considere esta regla en el siguiente ejemplo. </font><font style="vertical-align: inherit;">Pasemos en un </font></font><code>NewsItemBody</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estilo combinado de dos valores:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;NewsItemBody<font></font>
  ...<font></font>
  style={[styles.body, styles.item]}<font></font>
  ...<font></font>
/&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y nuevamente, el registro muestra los procesadores de componentes adicionales:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1<font></font>
--------------[ REFRESHING ]--------------<font></font>
SCREEN<font></font>
ITEM_3<font></font>
ITEM_TITLE_3<font></font>
ITEM_BODY_3<font></font>
ITEM_2<font></font>
ITEM_TITLE_2<font></font>
ITEM_BODY_2<font></font>
ITEM_1<font></font>
ITEM_TITLE_1<font></font>
ITEM_BODY_1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver este problema, puede seleccionar un estilo separado que combinar√° </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>item</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por ejemplo, mover√° la declaraci√≥n de la matriz </font></font><code>[styles.body, styles.item]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a una variable global. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de ejemplo completo</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reductores de matriz</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere otra fuente popular de "frenos" asociados con el uso </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Una aplicaci√≥n cl√°sica que contiene una larga lista de elementos del servidor implementa la paginaci√≥n. </font><font style="vertical-align: inherit;">Es decir, carga un conjunto limitado de elementos en forma de la primera p√°gina, cuando finaliza la lista de elementos actuales, carga la p√°gina siguiente, y as√≠ sucesivamente. </font><font style="vertical-align: inherit;">Un reductor de lista de elementos podr√≠a verse as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando cada p√°gina siguiente se carga al estilo de la aplicaci√≥n, se crea una nueva matriz de identificadores. </font><font style="vertical-align: inherit;">Si pasamos esta matriz a los accesorios m√°s </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adelante, as√≠ es como se ver√°n los registros de representaci√≥n del componente:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para este ejemplo, hice algunos cambios en la aplicaci√≥n de prueba.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establezca el tama√±o de la p√°gina en 10 noticias.</font></font></li>
<li>   <code>item</code>   <code>NewsItem</code>  <code>FlatList</code>-,        connect. <code>NewsItem</code>    <code>React.Component</code>    .</li>
<li>     .</li>
<li>       .       ‚Ññ1     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ejemplo muestra que cuando se carga cada p√°gina siguiente, todos los elementos antiguos se procesan nuevamente, luego los elementos antiguos y los elementos de la p√°gina nueva se procesan nuevamente. Para los amantes de las matem√°ticas: si el tama√±o de la p√°gina es igual </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cuando </font></font><code>i</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se </font><font style="vertical-align: inherit;">carga la </font><font style="vertical-align: inherit;">i-√©sima p√°gina </font><font style="vertical-align: inherit;">, en </font><font style="vertical-align: inherit;">lugar de representar solo </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elementos nuevos, se representan los elementos </font></font><code>(i - 1) * X + i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚ÄúOk‚Äù, dices, ‚Äúentiendo por qu√© todos los elementos se dibujan despu√©s de agregar una nueva p√°gina: el reductor devolvi√≥ una nueva matriz, una nueva √°rea de memoria, todo eso. Pero, ¬øpor qu√© necesitamos renderizar la lista anterior antes de agregar nuevos elementos? "Buena pregunta", te responder√©. Esto es una consecuencia de trabajar con el estado del componente </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre cuya base</font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No entrar√© en detalles, ya que sacan un art√≠culo separado. </font><font style="vertical-align: inherit;">A qui√©n le importa, le aconsejo que profundice en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentaci√≥n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y la fuente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo deshacerse de tal falta de optimizaci√≥n? </font><font style="vertical-align: inherit;">Reescribimos el reductor para que no devuelva una nueva matriz para cada p√°gina, sino que agrega elementos a la existente:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Atenci√≥n! </font><font style="vertical-align: inherit;">Antipatr√≥n!</font></font></b><div class="spoiler_text">          .     ,    , ,  <code>PureComponent</code>,          .      ,             .      .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> Redux</a>.<br>
</div></div><br>
<pre><code class="plaintext hljs">const newsIdList = (state = [], action) =&gt; {<font></font>
  if (action.type === 'GOT_NEWS') {<font></font>
    return action.news.map(item =&gt; item.key);<font></font>
  } else if (action.type === 'GOT_OLDER_NEWS') {<font></font>
    action.news.forEach(item =&gt; state.push(item.key));<font></font>
    return state;<font></font>
    // return [...state, ...action.news.map(item =&gt; item.key)];<font></font>
  }<font></font>
  return state;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, nuestro registro se ver√° as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;1..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eliminamos la representaci√≥n de elementos antiguos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">antes de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregar elementos a una nueva p√°gina, pero los elementos antiguos a√∫n se dibujan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">despu√©s de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> actualizar la lista. El n√∫mero de representaciones para la p√°gina siguiente ahora es igual </font></font><code>i * X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La f√≥rmula se ha vuelto m√°s simple, pero no nos detendremos all√≠. Solo tenemos </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuevos elementos, y solo queremos </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuevos renders. Utilizaremos los trucos ya familiares para eliminar los renders de noticias que no han cambiado los accesorios. Volver conectar a </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">SCREEN<font></font>
ITEM_&lt;1..10&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;11..20&gt;<font></font>
--------------[ LOADING NEXT PAGE ]--------------<font></font>
SCREEN<font></font>
ITEM_&lt;21..30&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Multa! Ahora podemos estar satisfechos con nosotros mismos. No hay ning√∫n lugar para optimizar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de ejemplo completo</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un lector atento indicar√° que despu√©s de aplicar connect al </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro, se ver√° como en el √∫ltimo ejemplo, sin importar c√≥mo implemente el reductor. Y ser√° correcto: si el componente de noticias comprueba sus accesorios antes de renderizar, no importa si el reductor usa la matriz anterior o si crea una nueva. Solo se dibujan elementos nuevos y solo una vez. Sin embargo, cambiar la matriz anterior en lugar de crear una nueva nos salva de representaciones innecesarias del componente </font></font><code>FlatList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilizado en ella </font></font><code>VirtualizedList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y de iteraciones innecesarias de comprobaciones de equivalencia de accesorios </font></font><code>NewsItem</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Con una gran cantidad de elementos, esto tambi√©n aumenta el rendimiento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El uso de matrices y objetos mutables en los reductores debe ser con extrema precauci√≥n. </font><font style="vertical-align: inherit;">En este ejemplo, esto est√° justificado, pero si tiene, digamos, normal </font></font><code>PureComponent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cuando agrega elementos a la matriz mutable, los componentes no se procesar√°n. </font><font style="vertical-align: inherit;">De hecho, sus accesorios permanecen sin cambios, ya que antes y despu√©s de actualizar los puntos de la matriz a la misma √°rea de memoria. </font><font style="vertical-align: inherit;">Esto puede conducir a consecuencias inesperadas. </font><font style="vertical-align: inherit;">No es de extra√±ar que el ejemplo descrito viole los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principios de Redux</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y algo m√°s...</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si utiliza bibliotecas de nivel de presentaci√≥n, le aconsejo que se asegure de comprender en detalle c√≥mo se implementan. </font><font style="vertical-align: inherit;">En nuestra aplicaci√≥n, usamos un componente </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la biblioteca </font></font><code>react-native-gesture-handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le permite implementar un bloque de acciones adicionales al deslizar una tarjeta de la lista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En c√≥digo, se ve as√≠:</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Swipeable<font></font>
  ...<font></font>
  renderRightActions={this.renderRightActions}<font></font>
  ...<font></font>
&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√©todo </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>renderLeftActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve el componente que se muestra despu√©s del deslizamiento. Determinamos y cambiamos la altura del panel durante el cambio de componentes para ajustar el contenido necesario. Este es un proceso que requiere muchos recursos, pero si ocurre durante la animaci√≥n de deslizamiento, el usuario no ve interferencia.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wz/n1/vg/wzn1vghiy6-wjclqcy8itdy1fns.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema es que el componente </font></font><code>Swipeable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">llama al m√©todo </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al momento de representar el componente principal. Todos los c√°lculos e incluso la representaci√≥n de la barra de acci√≥n, que no es visible antes del deslizamiento, se realizan por adelantado. Por lo tanto, todas estas acciones se realizan para todas las tarjetas de la lista al mismo tiempo. Esto caus√≥ importantes "frenos" al desplazarse por el tablero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema se resolvi√≥ de la siguiente manera. Si el panel de acci√≥n se dibuja junto con el componente principal, y no como resultado del deslizamiento, el m√©todo </font></font><code>renderRightActions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve uno vac√≠o del </font></font><code>View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tama√±o del componente principal. De lo contrario, dibujamos el panel de acciones adicionales como antes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Doy este ejemplo porque las bibliotecas de soporte no siempre funcionan como se espera. </font><font style="vertical-align: inherit;">Y si se trata de bibliotecas de nivel de presentaci√≥n, entonces es mejor asegurarse de que no est√°n desperdiciando recursos innecesarios.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recomendaciones</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eliminar los problemas descritos en el art√≠culo, aceleramos significativamente la aplicaci√≥n en React Native. </font><font style="vertical-align: inherit;">Ahora es dif√≠cil distinguirlo en rendimiento de uno similar, implementado de forma nativa. </font><font style="vertical-align: inherit;">El exceso de renderizado ralentiz√≥ tanto la carga de pantallas individuales como la reacci√≥n a las acciones del usuario. </font><font style="vertical-align: inherit;">Sobre todo, se notaba en las listas, donde se dibujan docenas de componentes a la vez. </font><font style="vertical-align: inherit;">No hemos optimizado todo, pero las pantallas principales de la aplicaci√≥n ya no se ralentizan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los puntos principales del art√≠culo se enumeran brevemente a continuaci√≥n.</font></font><br>
<br>
<ol>
<li> React Native      :  Props/State-     .</li>
<li>,   <code>React.PureComponent</code>,     ,       .</li>
<li>    ,    <code>shouldComponentUpdate</code>      <code>React.Memo</code>   .</li>
<li>-        .      ,         (shallow compare).               ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El soporte de bibliotecas de nivel de presentaci√≥n puede conducir a un desperdicio inesperado de recursos. </font><font style="vertical-align: inherit;">Vale la pena tener cuidado en su aplicaci√≥n.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. </font><font style="vertical-align: inherit;">Espero que encuentre √∫til la informaci√≥n. </font><font style="vertical-align: inherit;">Estar√© encantado de cualquier comentario!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuentes utiles</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprender la representaci√≥n en React + Redux</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparar objetos en JavaScript</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mejora del rendimiento en componentes funcionales React usando React.memo ()</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo Discord logra el rendimiento nativo de iOS con React Native</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es492374/index.html">Experimento: Redux del mundo OOP</a></li>
<li><a href="../es492376/index.html">C√≥mo hacer que su art√≠culo o documentaci√≥n comprenda de manera r√°pida y precisa</a></li>
<li><a href="../es492378/index.html">Reactjs, Material-UI con JSS. Gu√≠a breve</a></li>
<li><a href="../es492384/index.html">Hack The Box - Tutorial de cartero Redis y WebMin</a></li>
<li><a href="../es492386/index.html">C√≥mo el sector de TI ayuda al mundo a arrojar menos alimentos</a></li>
<li><a href="../es492392/index.html">Consejos y trucos de IntelliJ IDEA: 3. Personalizaci√≥n del estilo de c√≥digo para cada carpeta</a></li>
<li><a href="../es492394/index.html">Universo oscuro Parte 2</a></li>
<li><a href="../es492396/index.html">¬øPor qu√© estropeamos los LED indicadores y qu√© hay que cambiar?</a></li>
<li><a href="../es492398/index.html">Configuramos nuestros dispositivos para trabajo remoto, podcasting, video y transmisi√≥n</a></li>
<li><a href="../es492404/index.html">Flutter + arduino nano 33 BLE sense = sensor BLE muy simple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>