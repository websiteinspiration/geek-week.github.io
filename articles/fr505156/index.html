<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰🏼 🚉 💺 Django: un utilisateur pour tout 📔 👩🏾‍🤝‍👩🏻 🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problème
 

Bonjour à tous. Lors du développement de l'API pour le prochain portail Web, j'ai pris ma pile habituelle:
 

- Django
- django-rest-frame...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Django: un utilisateur pour tout</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505156/"><h1 id="problema"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problème</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bonjour à tous. </font><font style="vertical-align: inherit;">Lors du développement de l'API pour le prochain portail Web, j'ai pris ma pile habituelle:</font></font></p><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Django</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">django-rest-framework</font></font></li>
</ul><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais cette fois, il y avait une tâche plutôt inhabituelle - faire un modèle utilisateur, qui peut avoir plusieurs profils différents (entrepreneur, client). </font><font style="vertical-align: inherit;">Et la présence de chacun des profils donne des pouvoirs différents pour travailler avec les mêmes ressources.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette approche permet aux utilisateurs de ne pas avoir plusieurs comptes pour chaque rôle, ce qui serait souvent impossible, en raison des restrictions sur le modèle: un e-mail ou un numéro de téléphone unique.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous décrirons donc les problèmes rencontrés avant nous:</font></font></p><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un utilisateur - plusieurs profils.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment organiser les droits de chacun des profils.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accès aux mêmes ressources à partir de différents profils.</font></font></li>
</ol><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ci-dessous, je donnerai ma propre façon de résoudre ce problème, qui consistait en des habitudes déjà développées pour organiser un projet Django, ainsi que des tentatives pour trouver la solution la plus flexible et évolutive.</font></font></p><a name="habracut"></a><br>
<h1 id="odin-polzovatel---neskolko-profiley"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisateur unique - plusieurs profils</font></font></h1><br>
<p>            ,        ,   (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://docs.djangoproject.com/en/3.0/topics/auth/customizing/#extending-the-existing-user-model</a>)</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># models.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">AbstractUser</span>):</span>
    username = <span class="hljs-literal">None</span>
    email = models.EmailField(unique=<span class="hljs-literal">True</span>, verbose_name=_(<span class="hljs-string">"email"</span>))<font></font>
    phone = models.CharField(unique=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">11</span>, verbose_name=_(<span class="hljs-string">"phone"</span>))<font></font>
    ...<font></font>
    USERNAME_FIELD = <span class="hljs-string">"email"</span>
    EMAIL_FIELD = <span class="hljs-string">"email"</span><font></font>
    ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Employee</span>(<span class="hljs-params">models.Model</span>):</span><font></font>
    ...<font></font>
    user = models.OneToOneField(<font></font>
        <span class="hljs-string">"user.User"</span>,<font></font>
        on_delete=models.CASCADE,<font></font>
        related_name=<span class="hljs-string">"employee"</span>,<font></font>
        verbose_name=_(<span class="hljs-string">"user"</span>),<font></font>
    )<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Company</span>(<span class="hljs-params">models.Model</span>):</span><font></font>
    ...<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Member</span>(<span class="hljs-params">models.Model</span>):</span>
    is_owner = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=_(<span class="hljs-string">"owner"</span>))<font></font>
    is_manager = models.BooleanField(default=<span class="hljs-literal">False</span>, verbose_name=_(<span class="hljs-string">"manager"</span>))<font></font>
    is_active = models.BooleanField(default=<span class="hljs-literal">True</span>)<font></font>
    user = models.OneToOneField(<font></font>
        <span class="hljs-string">"user.User"</span>,<font></font>
        on_delete=models.CASCADE,<font></font>
        related_name=<span class="hljs-string">"member"</span>,<font></font>
        verbose_name=_(<span class="hljs-string">"user"</span>),<font></font>
    )<font></font>
    company = models.ForeignKey(<font></font>
        <span class="hljs-string">"user.Company"</span>,<font></font>
        on_delete=models.CASCADE,<font></font>
        related_name=<span class="hljs-string">"members"</span>,<font></font>
        verbose_name=_(<span class="hljs-string">"company"</span>),<font></font>
    )</code></pre><br>
<p>       0  2-  ( ,  ).</p><br>
<p>            ,      .</p><br>
<h1 id="kak-organizovat-prava-kazhdogo-iz-profiley">     </h1><br>
<p>         ,  Custom Permissions  drf (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.django-rest-framework.org/api-guide/permissions/#custom-permissions</a>).</p><br>
<p>        .  ,          .</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># permissions.py</span>
<span class="hljs-keyword">from</span> rest_framework.permissions <span class="hljs-keyword">import</span> BasePermission<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeOnly</span>(<span class="hljs-params">BasePermission</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_permission</span>(<span class="hljs-params">self, request, view</span>):</span>
        <span class="hljs-keyword">return</span> request.user.is_authenticated <span class="hljs-keyword">and</span> hasattr(request.user, <span class="hljs-string">"employee"</span>)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CompanyManagerOnly</span>(<span class="hljs-params">BasePermission</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_permission</span>(<span class="hljs-params">self, request, view</span>):</span>
        <span class="hljs-keyword">return</span> (<font></font>
            request.user.is_authenticated<font></font>
            <span class="hljs-keyword">and</span> hasattr(request.user, <span class="hljs-string">"member"</span>)
            <span class="hljs-keyword">and</span> request.user.member.is_active
            <span class="hljs-keyword">and</span> request.user.member.is_manager<font></font>
        )</code></pre><br>
<p> ,       ,    permission</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># permissions.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmployeeAndCompanyManagerOnly</span>(<span class="hljs-params">BasePermission</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_permission</span>(<span class="hljs-params">self, request, view</span>):</span>
        <span class="hljs-keyword">return</span> request.user.is_authenticated <span class="hljs-keyword">and</span> (<font></font>
            hasattr(request.user, <span class="hljs-string">"employee"</span>)
            <span class="hljs-keyword">or</span> (<font></font>
                hasattr(request.user, <span class="hljs-string">"member"</span>)
                <span class="hljs-keyword">and</span> request.user.member.is_active
                <span class="hljs-keyword">and</span> request.user.member.is_manager<font></font>
            )<font></font>
        )</code></pre><br>
<p>    :       2-,       .        ,     ,     .</p><br>
<h3 id="pochemu-neobhodimost-v-takih-sostavnyh-permishnah-voobsche-voznikaet">       </h3><br>
<p> django-rest-framework ,     ,    permissions_class,     AND. </p><br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskView</span>(<span class="hljs-params">APIView</span>):</span><font></font>
    ...<font></font>
    permission_classes = (CompanyManagerOnly, EmployeeOnly)<font></font>
    ...</code></pre><br>
<p>        ,   .</p><br>
<p>           <code>EmployeeAndCompanyManagerOnly</code>         .</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskView</span>(<span class="hljs-params">APIView</span>):</span><font></font>
    ...<font></font>
    permission_classes = (EmployeeAndCompanyManagerOnly,)<font></font>
    ...</code></pre><br>
<p>  3.9  drf       ,    </p><br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskView</span>(<span class="hljs-params">APIView</span>):</span><font></font>
    ...<font></font>
    permission_classes = ((CompanyManagerOnly|EmployeeOnly),)<font></font>
    ...</code></pre><br>
<p>     ,    ,      .</p><br>
<p>       drf 3.11,      .       ,         .</p><br>
<p>P.S.         CompanyOwnerOnly  CompanyMemberOnly,         ,  .</p><br>
<h1 id="dostup-k-odnim-i-tem-zhe-resursam-ot-raznyh-profiley">         </h1><br>
<p>       . </p><br>
<h3 id="nemnogo-o-tom-kak-ya-organizuyu-api">  ,    </h3><br>
<p>- ,       (<em>  -   REST API?      RESTful?      ?    - best practice?</em>),  ,   ,    .      :    ,     .</p><br>
<p>      :</p><br>
<ul>
<li><strong> .</strong>      RESTful,     ,       .   ,   GET POST PUT DELETE,    .     - ,   AuthorBook.</li>
<li><strong>   action endpoint'.</strong>   RPC   REST,  ,       .     . ,      -   .</li>
<li><strong>  action endopoint'.</strong>     ,  ,       ,        .</li>
</ul><br>
<p>     viewsets  drf,       REST    .        .</p><br>
<p><img src="https://habrastorage.org/webt/82/_1/au/82_1aulha4l2plygfseghepqmfk.png"></p><br>
<h3 id="vernemsya-k-nashey-probleme">   </h3><br>
<p>,  ,     :</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># models.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>(<span class="hljs-params">models.Model</span>):</span><font></font>
    ...<font></font>
<font></font>
<span class="hljs-comment"># views.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskViewSet</span>(<span class="hljs-params">
    mixins.CreateModelMixin,
    mixins.UpdateModelMixin,
    mixins.ListModelMixin,
    mixins.RetrieveModelMixin,
    viewsets.GenericViewSet,
</span>):</span><font></font>
    serializer_class = TaskSerializer<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_permissions</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.action <span class="hljs-keyword">in</span> [<span class="hljs-string">"accept_invite"</span>, <span class="hljs-string">"reject_invite"</span>, <span class="hljs-string">"employee_me"</span>]:
            <span class="hljs-keyword">return</span> (EmployeeOnly(),)<font></font>
<font></font>
        <span class="hljs-keyword">if</span> self.action <span class="hljs-keyword">in</span> [
            <span class="hljs-string">"accept_employees"</span>,
            <span class="hljs-string">"reject_employees"</span>,
            <span class="hljs-string">"create"</span>,
            <span class="hljs-string">"update"</span>,
            <span class="hljs-string">"partial_update"</span>,<font></font>
        ]:<font></font>
            <span class="hljs-keyword">return</span> (CompanyManagerOnly(),)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> ((CompanyManagerOnly | EmployeeOnly)(),) <span class="hljs-comment">#     </span><font></font>
<font></font>
    ...</code></pre><br>
<p>C     ("create", "update", "partial_update" —    drf),      .</p><br>
<p>        (  ,    ):</p><br>
<p><img src="https://habrastorage.org/webt/g4/o0/kz/g4o0kz_ch6kgahnns9sr4p7svim.png"></p><br>
<p>    ,     ,      ,     ,       :</p><br>
<p><img src="https://habrastorage.org/webt/9u/6z/h9/9u6zh9w3s_3mhqzddzpz9ecnfre.png"></p><br>
<p>   ,      :</p><br>
<ol>
<li> ,         ,     .</li>
<li>    (    GET /tasks/),        ,       ,         .</li>
</ol><br>
<p>     4- :</p><br>
<ol>
<li><p>  <code>TaskViewSet</code>    .</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>  ,   if</td>
<td>  </td>
</tr>
<tr>
<td>-</td>
<td>    ( )</td>
</tr>
<tr>
<td>-</td>
<td>Employee  ompany  -    ,  ,       , -  "-"    url</td>
</tr>
</tbody>
</table></div><br>
</li>
<li><p>      ,       .</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>   (   )</td>
<td>    :  - - ,  ,      </td>
</tr>
<tr>
<td>-</td>
<td>   (drf_yasg)     ,      </td>
</tr>
</tbody>
</table></div><br>
</li>
<li><p> query   .</p><br>
<div class="scrollable-table"><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>  </td>
<td> ,   :   if else</td>
</tr>
<tr>
<td>,     ()</td>
<td>-</td>
</tr>
</tbody>
</table></div><br>
</li>
<li><p>HATEOAS (    !)</p><br>
<p>       -,         . ,          .<br>
      .<br>
   ,      №1.</p><br>
</li>
</ol><br>
<p>  <strong></strong> ,       .</p><br>
<p>         ,     query .</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># serializers.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ModeSerializer</span>(<span class="hljs-params">serializers.Serializer</span>):</span><font></font>
    mode = serializers.ChoiceField(MODE)<font></font>
<font></font>
<span class="hljs-comment"># views.py</span>
<span class="hljs-meta">@swagger_auto_schema(query_serializer=ModeSerializer)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">list</span>(<span class="hljs-params">self, request, *args, **kwargs</span>):</span>
    <span class="hljs-keyword">return</span> super().list(request, *args, **kwargs)<font></font>
<font></font>
<span class="hljs-meta">@swagger_auto_schema(query_serializer=ModeSerializer)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">retrieve</span>(<span class="hljs-params">self, request, pk, *args, **kwargs</span>):</span>
    <span class="hljs-keyword">return</span> super().retrieve(request, *args, **kwargs)</code></pre><br>
<p><img src="https://habrastorage.org/webt/vw/ps/ub/vwpsubpptp-ulf_-8lar3edjkf0.png"></p><br>
<p>        queryset       mode.</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-keyword">if</span> getattr(self, <span class="hljs-string">"swagger_fake_view"</span>, <span class="hljs-literal">False</span>):
        <span class="hljs-keyword">return</span> Task.objects.none()<font></font>
<font></font>
    mode = self.request.query_params.get(<span class="hljs-string">"mode"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> mode == MODE.COMPANY:
        <span class="hljs-keyword">return</span> Task.objects.filter(author=self.request.user).order_by(<span class="hljs-string">"-created_at"</span>)
    <span class="hljs-keyword">elif</span> mode == MODE.EMPLOYEE:
        <span class="hljs-comment">#    ,     </span>
        <span class="hljs-comment">#   queryset!</span><font></font>
        tasks = set(<font></font>
            taskemployee.task.id<font></font>
            <span class="hljs-keyword">for</span> taskemployee <span class="hljs-keyword">in</span> self.request.user.employee.taskemployee_set.exclude(<font></font>
                invite_status=SUGGEST_STATUS.REJECT<font></font>
            )<font></font>
            <span class="hljs-keyword">if</span> taskemployee.task.status
            <span class="hljs-keyword">in</span> [<font></font>
                TASK_STATUS.IN_WORK,<font></font>
                TASK_STATUS.DONE,<font></font>
            ]<font></font>
        )<font></font>
        <span class="hljs-keyword">return</span> Task.objects.filter(id__in=tasks).order_by(<span class="hljs-string">"-created_at"</span>)</code></pre><br>
<p>,    №1,    ,     .</p><br>
<p>    ,     ,    , ,  ,       (     ,       ).</p><br>
<p>    ,    self.get_object()  drf view.</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># rest_framework.generics.GenericAPIView</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GenericAPIView</span>(<span class="hljs-params">views.APIView</span>):</span><font></font>
    ...<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_object</span>(<span class="hljs-params">self</span>):</span><font></font>
        ...<font></font>
<font></font>
        queryset = self.filter_queryset(self.get_queryset())<font></font>
<font></font>
        ...<font></font>
<font></font>
        obj = get_object_or_404(queryset, **filter_kwargs)<font></font>
<font></font>
        <span class="hljs-comment"># May raise a permission denied</span><font></font>
        self.check_object_permissions(self.request, obj)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> obj</code></pre><br>
<p>    <code>queryset = self.filter_queryset(self.get_queryset())</code>,     ,   - ,         . </p><br>
<p>        :</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-keyword">if</span> getattr(self, <span class="hljs-string">"swagger_fake_view"</span>, <span class="hljs-literal">False</span>):
        <span class="hljs-keyword">return</span> Task.objects.none()<font></font>
<font></font>
    mode = self.request.query_params.get(<span class="hljs-string">"mode"</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> mode == MODE.COMPANY <span class="hljs-keyword">or</span> self.action <span class="hljs-keyword">in</span> [
        <span class="hljs-string">"create"</span>,
        <span class="hljs-string">"update"</span>,
        <span class="hljs-string">"partial_update"</span>,
        <span class="hljs-string">"accept_employees"</span>,
        <span class="hljs-string">"reject_employees"</span>,<font></font>
    ]:<font></font>
        ...<font></font>
    <span class="hljs-keyword">elif</span> mode == MODE.EMPLOYEE <span class="hljs-keyword">or</span> self.action <span class="hljs-keyword">in</span> [
        <span class="hljs-string">"accept_invite"</span>,
        <span class="hljs-string">"reject_invite"</span>,<font></font>
    ]:<font></font>
        ...</code></pre><br>
<p>  :    ,     ,    404 NotFound, .. queryset       <code>MODE.COMPANY</code>      .</p><br>
<p>    :    ,   if    mode  ,    .            .</p><br>
<p>    :</p><br>
<pre><code class="python hljs"><span class="hljs-comment"># views.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskViewSet</span>(<span class="hljs-params">
    mixins.CreateModelMixin,
    mixins.UpdateModelMixin,
    mixins.ListModelMixin,
    mixins.RetrieveModelMixin,
    viewsets.GenericViewSet,
</span>):</span><font></font>
    ...<font></font>
<font></font>
    action_default_mode = {<font></font>
        <span class="hljs-string">"create"</span>: MODE.COMPANY,
        <span class="hljs-string">"update"</span>: MODE.COMPANY,
        <span class="hljs-string">"partial_update"</span>: MODE.COMPANY,
        <span class="hljs-string">"accept_invite"</span>: MODE.EMPLOYEE,
        <span class="hljs-string">"reject_invite"</span>: MODE.EMPLOYEE,
        <span class="hljs-string">"employee_me"</span>: MODE.EMPLOYEE,<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_queryset</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> getattr(self, <span class="hljs-string">"swagger_fake_view"</span>, <span class="hljs-literal">False</span>):
            <span class="hljs-keyword">return</span> Task.objects.none()<font></font>
<font></font>
        mode = self.request.query_params.get(<span class="hljs-string">"mode"</span>) <span class="hljs-keyword">or</span> self.action_default_mode.get(<font></font>
            self.action<font></font>
        )<font></font>
<font></font>
        <span class="hljs-keyword">assert</span> mode, (
            <span class="hljs-string">"You need to add required query param in your urls "</span>
            <span class="hljs-string">"or set an action default mode in self.action_default_mode map"</span>
            <span class="hljs-string">f" for action `<span class="hljs-subst">{self.action}</span>`"</span><font></font>
        )<font></font>
<font></font>
        <span class="hljs-keyword">if</span> mode == MODE.COMPANY:<font></font>
            ...<font></font>
        <span class="hljs-keyword">elif</span> mode == MODE.EMPLOYEE:<font></font>
            ...</code></pre><br>
<p>        ,              . -    -     ,       .</p><br>
<h1 id="zaklyuchenie"></h1><br>
<p>      ,           .</p><br>
<p> ,   ,    ,       .       ,         .</p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur un habr j'ai décidé de poster cet article depuis </font><font style="vertical-align: inherit;">tout en résolvant ce problème, je cherchais depuis longtemps quelque chose de similaire sur Internet, mais j'ai trouvé pas mal de matériel sur le thème "un utilisateur - plusieurs rôles".</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux savoir si j'ai inventé un vélo dans la pile de Django, drf. </font><font style="vertical-align: inherit;">Et si c'est vraiment le bon cas, vous pouvez même l'envelopper dans un petit plugin django.</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci à tous!</font></font></p></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr505128/index.html">Déchiffrer l'air de Habr avec DIT de Moscou</a></li>
<li><a href="../fr505134/index.html">Quand écrire votre plateforme IoT est plus rentable que d'acheter un ready-made</a></li>
<li><a href="../fr505136/index.html">Nibiru</a></li>
<li><a href="../fr505138/index.html">Que faire pour que votre diffusion en ligne ne s'effondre pas (enfin, ou du moins fonctionne pendant un certain temps)</a></li>
<li><a href="../fr505142/index.html">Comment Amazon veut que l'innovation sorte de la pandémie</a></li>
<li><a href="../fr505176/index.html">Quels actifs ont permis aux investisseurs de protéger les ressources lors d'une pandémie?</a></li>
<li><a href="../fr505178/index.html">DIY Exergaming en vase clos</a></li>
<li><a href="../fr505186/index.html">Trois façons de combiner la masse sur une carte de circuit imprimé</a></li>
<li><a href="../fr505190/index.html">Comment recréer l'effet de motif moiré dans la bibliothèque p5.js pour un débutant (guide rapide)</a></li>
<li><a href="../fr505194/index.html">Windows Defender SmartScreen nuit aux développeurs indépendants</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>