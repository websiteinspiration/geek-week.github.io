<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👱🏿 👏🏼 👨🏼‍🎓 セキュリティに関するチートシート：Nodejs 🉑 🖍️ 🐖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="NodeJSの人気については、かなり多くのことがすでに述べられています。アプリケーションの数の増加は明らかです。NodeJSは非常に学習しやすく、膨大な数のライブラリーと動的に発展するエコシステムを備えています。アプリケーションの開発時にセキュリティの問題を予測するのに役立つOWASPチートシートに...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>セキュリティに関するチートシート：Nodejs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acribia/blog/493714/"><img src="https://habrastorage.org/webt/bs/ml/lo/bsmllozt2li3jmn_6ec8vy4krdq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NodeJSの人気については、かなり多くのことがすでに述べられています。</font><font style="vertical-align: inherit;">アプリケーションの数の増加は明らかです。NodeJSは非常に学習しやすく、膨大な数のライブラリーと動的に発展するエコシステムを備えています。</font><font style="vertical-align: inherit;">アプリケーションの開発時にセキュリティの問題を予測するのに役立つOWASPチートシートに基づいて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;">、NodeJS開発者向けの推奨事項を</font></b></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
用意</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しました</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeJSアプリケーションのセキュリティに関する推奨事項は、次のカテゴリに分類できます。</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーション開発中のセキュリティ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーのセキュリティ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォームのセキュリティ。</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーション開発のセキュリティ</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバックの地獄</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を</font><b><font style="vertical-align: inherit;">回避するコール</font></b><font style="vertical-align: inherit;">バック関数（コールバック）の使用はNodeJSの最大の強みの1つですが、コールバックをネストすると、関数の1つでエラーを処理することを忘れてしまいがちです。</font><font style="vertical-align: inherit;">コールバックの地獄を回避する1つの方法は、promiseを使用することです。</font><font style="vertical-align: inherit;">使用しているモジュールがpromiseの操作をサポートしていない場合でも、いつでもPromise.promisifyAll（）を使用できます。</font><font style="vertical-align: inherit;">しかし、promiseを使用する場合でも、ネストに注意を払う価値があります。</font><font style="vertical-align: inherit;">コールバック地獄エラーを完全に回避するには、プロミスの「フラットな」チェーンに固執します。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバック地獄の例：</font></font></i><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">func1</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">500</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func2</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">100</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func3</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">900</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func4</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">3000</span>);<font></font>
}<font></font>
<font></font>
func1(<span class="hljs-string">"input1"</span>, function(err, result1){
   <span class="hljs-keyword">if</span>(err){
      <span class="hljs-comment">// error operations</span><font></font>
   }<font></font>
   <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//some operations</span>
      func2(<span class="hljs-string">"input2"</span>, function(err, result2){
         <span class="hljs-keyword">if</span>(err){
            <span class="hljs-comment">//error operations</span><font></font>
         }<font></font>
         <span class="hljs-keyword">else</span>{
            <span class="hljs-comment">//some operations</span>
            func3(<span class="hljs-string">"input3"</span>, function(err, result3){
               <span class="hljs-keyword">if</span>(err){
                  <span class="hljs-comment">//error operations</span><font></font>
               }<font></font>
               <span class="hljs-keyword">else</span>{
                  <span class="hljs-comment">// some operations</span>
                  func4(<span class="hljs-string">"input 4"</span>, function(err, result4){
                     <span class="hljs-keyword">if</span>(err){
                        <span class="hljs-comment">// error operations</span><font></font>
                     }<font></font>
                     <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// some operations</span><font></font>
                     }<font></font>
                  });<font></font>
               }<font></font>
            });<font></font>
         }<font></font>
      });<font></font>
   }<font></font>
});<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フラットチェーンpromiseを使用した同じコード：</font></font></i><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">function <span class="hljs-title">func1</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">500</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func2</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">100</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func3</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">900</span>);<font></font>
}<font></font>
<span class="hljs-function">function <span class="hljs-title">func4</span><span class="hljs-params">(name, callback)</span> </span>{<font></font>
   setTimeout(function() {<font></font>
      <span class="hljs-comment">// operations</span>
   }, <span class="hljs-number">3000</span>);<font></font>
}<font></font>
<font></font>
func1(<span class="hljs-string">"input1"</span>)<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func2(<span class="hljs-string">"input2"</span>);<font></font>
   })<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func3(<span class="hljs-string">"input3"</span>);<font></font>
   })<font></font>
   .then(function (result){<font></font>
      <span class="hljs-keyword">return</span> func4(<span class="hljs-string">"input4"</span>);<font></font>
   })<font></font>
   .<span class="hljs-keyword">catch</span>(function (error) {
      <span class="hljs-comment">// error operations</span><font></font>
   });<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストのサイズを制限します。リクエストの</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
本文の解析は、かなりのリソースを消費する操作になる可能性があります。リクエストのサイズを制限しないと、攻撃者はすべてのディスク領域を使い尽くしたり、すべてのサーバーリソースを使い果たしたりする可能性のある十分に大きなリクエストを送信できますが、同時に、ファイルのダウンロードなどのリクエストがあるため、すべてのケースでリクエストサイズを制限することは正しくない可能性があります。したがって、さまざまなタイプのコンテンツに制限を設定することをお勧めします。たとえば、高速フレームワークを使用すると、これは次のように実装できます。</font></font><br>
<br>
<pre><code class="java hljs">app.use(express.urlencoded({ limit: <span class="hljs-string">"1kb"</span> }));<font></font>
app.use(express.json({ limit: <span class="hljs-string">"1kb"</span> }));<font></font>
app.use(express.multipart({ limit:<span class="hljs-string">"10mb"</span> }));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 なお、攻撃者はリクエストコンテンツの種類を変更したり、制限を回避したりできるため、リクエストの内容がリクエストヘッダで指定されたコンテンツの種類と一致するか確認する必要があります。</font><font style="vertical-align: inherit;">コンテンツのタイプを確認することがパフォーマンスに影響を与える場合、特定のサイズより大きい特定のタイプまたはクエリのみを確認できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントループをブロックしない</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
言語の重要なコンポーネントはイベントループです。これにより、操作の完了を待たずに実行コンテキストを切り替えることができます。</font><font style="vertical-align: inherit;">ただし、NodeJSがコードを続行する前に待機する必要があるブロッキング操作があります。</font><font style="vertical-align: inherit;">たとえば、ほとんどの同期メソッドはブロッキングです。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.unlinkSync(<span class="hljs-string">'/file.txt'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような操作は非同期で実行することをお勧めします。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.unlink(<span class="hljs-string">'/file.txt'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 同時に、非同期呼び出しの後にあるコードが、前の操作の完了を待たずに実行されることを忘れないでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、以下のコードでは、ファイルは読み取られる前に削除され、競合状態になる可能性があります。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.readFile(<span class="hljs-string">'/file.txt'</span>, (err, data) =&gt; {
  <span class="hljs-comment">// perform actions on file content</span><font></font>
});<font></font>
fs.unlinkSync(<span class="hljs-string">'/file.txt'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 これを回避するには、すべての操作を非ブロッキング関数で記述します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> fs = require(<span class="hljs-string">'fs'</span>);<font></font>
fs.readFile(<span class="hljs-string">'/file.txt'</span>, (err, data) =&gt; {
  <span class="hljs-comment">// perform actions on file content</span>
  fs.unlink(<span class="hljs-string">'/file.txt'</span>, (err) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;<font></font>
  });<font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力フィールドの</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
確認</font><b><font style="vertical-align: inherit;">入力</font></b><font style="vertical-align: inherit;">フィールドの確認は、アプリケーションのセキュリティの重要な部分です。検証エラーが発生すると、SQLインジェクション、xss、コマンドインジェクションなど、さまざまな種類の攻撃に対してアプリケーションがすぐに脆弱になります。フォームの検証を簡略化するには、バリデーターパッケージmongo-express-sanitizeを使用できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザーデータのエスケープ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
xss攻撃から身を守るのに役立つルールの1つは、</font><b><font style="vertical-align: inherit;">ユーザーデータ</font></b><font style="vertical-align: inherit;">を保護することです。これには、escape-htmlまたはnode-esapiライブラリを使用できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログを保持する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さらに、エラーのデバッグに役立ちます。ログはインシデントに対応するために使用できます。ロギングの必要性について詳しくは、</font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらをご覧ください。</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最も人気のあるNodeJSロギングパッケージの1つは、WinstonとBunyanです。</font><font style="vertical-align: inherit;">以下の例は、Winstonを使用してコンソールとファイルの両方にログを出力する方法を示しています。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">new</span> (Winston.Logger) ({<font></font>
    transports: [<font></font>
        <span class="hljs-keyword">new</span> (winston.transports.Console)(),
        <span class="hljs-keyword">new</span> (winston.transports.File)({ filename: <span class="hljs-string">'application.log'</span> })<font></font>
    ],<font></font>
    level: <span class="hljs-string">'verbose'</span><font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントのサイクルを制御</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
するサーバーが集中的なネットワークトラフィックの状態にある場合、ユーザーはサービスの可用性に問題が発生する可能性があります。</font><font style="vertical-align: inherit;">これは本質的にDoS攻撃です。</font><font style="vertical-align: inherit;">この場合、応答時間を追跡し、それが指定された時間を超えている場合は、503サーバーがビジーであることを示すメッセージを送信できます。</font><font style="vertical-align: inherit;">toobusy-jsモジュールが役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールの使用例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> toobusy = require(<span class="hljs-string">'toobusy-js'</span>);
<span class="hljs-keyword">var</span> express = require(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> app = express();<font></font>
app.use(function(req, res, next) {<font></font>
    <span class="hljs-keyword">if</span> (toobusy()) {
        <span class="hljs-comment">// log if you see necessary</span>
        res.send(<span class="hljs-number">503</span>, <span class="hljs-string">"Server Too Busy"</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
    next();<font></font>
    }<font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">総当り攻撃に対する予防策を講じてください。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ここでも、モジュールが助けになります。</font><font style="vertical-align: inherit;">たとえば、エクスプレスブルートやエクスプレスバウンサー。</font><font style="vertical-align: inherit;">使用例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> bouncer = require(<span class="hljs-string">'express-bouncer'</span>);<font></font>
bouncer.whitelist.push(<span class="hljs-string">'127.0.0.1'</span>); <span class="hljs-comment">// whitelist an IP address</span>
<span class="hljs-comment">// give a custom error message</span><font></font>
bouncer.blocked = function (req, res, next, remaining) {<font></font>
    res.send(<span class="hljs-number">429</span>, <span class="hljs-string">"Too many requests have been made. Please wait "</span> + remaining/<span class="hljs-number">1000</span> + <span class="hljs-string">" seconds."</span>);<font></font>
};<font></font>
<span class="hljs-comment">// route to protect</span>
app.post(<span class="hljs-string">"/login"</span>, bouncer.block, function(req, res) {
    <span class="hljs-keyword">if</span> (LoginFailed){  }
    <span class="hljs-keyword">else</span> {<font></font>
        bouncer.reset( req );<font></font>
    }<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CAPTCHAの使用は、もう1つの一般的なブルートフォース対策です。</font><font style="vertical-align: inherit;">CAPTCHAの実装を支援するために頻繁に使用されるモジュールはsvg-captchaです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSRFトークンの使用CSRF</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
攻撃から保護する最も信頼できる方法の1つは、CSRFトークンを使用することです。</font><font style="vertical-align: inherit;">トークンは、高いエントロピーで生成され、厳密にチェックされ、ユーザーのセッションに関連付けられている必要があります。</font><font style="vertical-align: inherit;">CSRFトークンの操作を確認するには、csurfモジュールを使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> csrf = require(<span class="hljs-string">'csurf'</span>);<font></font>
csrfProtection = csrf({ cookie: <span class="hljs-keyword">true</span> });<font></font>
app.get(<span class="hljs-string">'/form'</span>, csrfProtection, function(req, res) {<font></font>
    res.render(<span class="hljs-string">'send'</span>, { csrfToken: req.csrfToken() })<font></font>
})<font></font>
app.post(<span class="hljs-string">'/process'</span>, parseForm, csrfProtection, function(req, res) {<font></font>
    res.send(<span class="hljs-string">'data is being processed'</span>);<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ページの非表示フィールドにトークンを追加することを忘れないでください：</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;input type="hidden" name="_csrf" value="{{ csrfToken }}"&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CSRFトークンの詳細については、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事を</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ご覧</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;">ください</font></b></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要なルートを削除します。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これにより、攻撃対象が増える可能性があるため、ユーザーが使用していないページをWebアプリケーションに含めないでください。したがって、未使用のすべてのAPIルートを無効にする必要があります。 SailsまたはFeathersフレームワークを使用する場合、APIエンドポイントを自動的に生成するため、この質問に特に注意する必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HPP（HTTPパラメーター汚染）から身を守る</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
デフォルトでは、expressはすべてのパラメーターをリクエストから配列に追加します。 OWASPはhppモジュールの使用をお勧めします。これは、req.queryおよび/またはreq.bodyからのすべてのパラメーター値を無視し、重複する値の中から最後の値を選択するだけです。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> hpp = require(<span class="hljs-string">'hpp'</span>);<font></font>
app.use(hpp());<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戻り値を監視します。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
たとえば、userテーブルには、パスワード、電子メールアドレス、生年月日などの重要なデータを格納できます。</font><font style="vertical-align: inherit;">したがって、必要なデータのみを返すことが重要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例えば：</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">exports</span>.sanitizeUser = function(user) {
  <span class="hljs-keyword">return</span> {<font></font>
    id: user.id,<font></font>
    username: user.username,<font></font>
    fullName: user.fullName<font></font>
  };<font></font>
};<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記述子を</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
使用</font><b><font style="vertical-align: inherit;">する記述子を</font></b><font style="vertical-align: inherit;">使用して、さまざまな操作のプロパティの動作を記述します。書き込み可能-プロパティの値を変更できるかどうか、列挙可能-for..inループでプロパティを使用できるかどうか、構成可能-プロパティを上書きできるかどうか。</font><font style="vertical-align: inherit;">オブジェクトのプロパティを定義すると、これらの属性はすべてデフォルトでtrueに設定されるため、リストされているプロパティに注意することをお勧めします。</font><font style="vertical-align: inherit;">プロパティの値は次のように変更できます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> o = {};<font></font>
Object.defineProperty(o, <span class="hljs-string">"a"</span>, {<font></font>
    writable: <span class="hljs-keyword">true</span>,<font></font>
    enumerable: <span class="hljs-keyword">true</span>,<font></font>
    configurable: <span class="hljs-keyword">true</span>,<font></font>
    value: <span class="hljs-string">"A"</span><font></font>
});<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACLの使用ACLは</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
、役割に基づいてデータアクセスを区別するのに役立ちます。</font><font style="vertical-align: inherit;">たとえば、権限の追加は次のようになります。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">// guest is allowed to view blogs</span>
acl.allow(<span class="hljs-string">'guest'</span>, <span class="hljs-string">'blogs'</span>, <span class="hljs-string">'view'</span>)
<span class="hljs-comment">// allow function accepts arrays as any parameter</span>
acl.allow(<span class="hljs-string">'member'</span>, <span class="hljs-string">'blogs'</span>, [<span class="hljs-string">'edit'</span>, <span class="hljs-string">'view'</span>, <span class="hljs-string">'delete'</span>])
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uncaughtExceptionをキャッチ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
するデフォルトでは、キャッチされない例外が発生すると、NodeJSは現在のスタックトレースをスローし、実行スレッドを終了します。</font><font style="vertical-align: inherit;">ただし、NodeJSではこの動作をカスタマイズできます。</font><font style="vertical-align: inherit;">キャッチされない例外が発生すると、プロセスオブジェクトを使用してキャッチできるuncaughtExceptionイベントが発生します。</font></font><br>
<br>
<pre><code class="java hljs">process.on(<span class="hljs-string">"uncaughtException"</span>, function(err) {
    <span class="hljs-comment">// clean up allocated resources</span>
    <span class="hljs-comment">// log necessary error details to log files</span>
    process.exit(); <span class="hljs-comment">// exit the process to avoid unknown state</span><font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uncaughtExceptionが発生した場合、予期しないエラーを回避するために、Zプロセスを完了する前に、割り当てられたすべてのリソース（ファイル記述子やハンドラーなど）をクリアする必要があることを覚えておいてください。</font><font style="vertical-align: inherit;">uncaughtExceptionが発生した場合でも、プログラムの実行は継続することを強くお勧めしません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、エラーメッセージを表示する場合、スタックトレースなどの詳細なエラー情報を公開しないでください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーのセキュリティ</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cookieを使用するときにヘッダーのフラグを設定し</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ます。xssやcsrfなどの攻撃から保護するのに役立つフラグがいくつかあります。</font><font style="vertical-align: inherit;">安全-Cookieをサードパーティのリソースに転送する機能を決定するHTTPSおよびSameSite経由でのみCookieを送信できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用例：</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> session = require(<span class="hljs-string">'express-session'</span>);<font></font>
app.use(session({<font></font>
    secret: <span class="hljs-string">'your-secret-key'</span>,<font></font>
    key: <span class="hljs-string">'cookieName'</span>,<font></font>
    cookie: { secure: <span class="hljs-keyword">true</span>, httpOnly: <span class="hljs-keyword">true</span>, path: <span class="hljs-string">'/user'</span>, sameSite: <span class="hljs-keyword">true</span>}<font></font>
}));<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">セキュリティ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の</font><b><font style="vertical-align: inherit;">ためのHTTPヘッダーの設定</font></b><font style="vertical-align: inherit;">以下は、ヘッダーとそれらを接続して、いくつかの一般的な攻撃から身を守るのに役立つ方法の例です。</font><font style="vertical-align: inherit;">ヘッダーはヘルメットモジュールを使用して設定されます</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•Strict-Transport-Security：HTTP Strict Transport Security（HSTS）は、アプリケーションにHTTPS経由でのみアクセスできることをブラウザーに通知します</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hsts()); <span class="hljs-comment">// default configuration</span>
app.use(helmet.hsts(<span class="hljs-string">"&lt;max-age&gt;"</span>, <span class="hljs-string">"&lt;includeSubdomains&gt;"</span>)); <span class="hljs-comment">// custom configuration</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Frame-Options：ページをフレーム、iframe、埋め込み、またはオブジェクトで使用できるかどうかを決定します</font></font><br>
<br>
<pre><code class="java hljs">app.use(hemlet.xframe()); <span class="hljs-comment">// default behavior (DENY)</span>
helmet.xframe(<span class="hljs-string">'sameorigin'</span>); <span class="hljs-comment">// SAMEORIGIN</span>
helmet.xframe(<span class="hljs-string">'allow-from'</span>, <span class="hljs-string">'http://alloweduri.com'</span>); <span class="hljs-comment">//ALLOW-FROM uri</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-XSS-Protection：反映されたXSS攻撃を検出した場合、ブラウザーはページのロードを停止できます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> xssFilter = require(<span class="hljs-string">'x-xss-protection'</span>);<font></font>
app.use(xssFilter());<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Content-Type-Options：MIMEタイプを使用した攻撃を防止するために使用されます</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.noSniff());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•コンテンツセキュリティポリシー：XSSやデータインジェクション攻撃などの攻撃を防ぎます</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> csp = require(<span class="hljs-string">'helmet-csp'</span>)<font></font>
app.use(csp({<font></font>
   directives: {<font></font>
       defaultSrc: [<span class="hljs-string">"'self'"</span>],  <span class="hljs-comment">// default value for all directives that are absent</span>
       scriptSrc: [<span class="hljs-string">"'self'"</span>],   <span class="hljs-comment">// helps prevent XSS attacks</span>
       frameAncestors: [<span class="hljs-string">"'none'"</span>],  <span class="hljs-comment">// helps prevent Clickjacking attacks</span>
       imgSrc: [<span class="hljs-string">"'self'"</span>, <span class="hljs-string">"'http://imgexample.com'"</span>],<font></font>
       styleSrc: [<span class="hljs-string">"'none'"</span>]<font></font>
    }<font></font>
}))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•Cache-ControlおよびPragma：キャッシングを管理するために、特にこのヘッダーは機密データを含むページに役立ちます。</font><font style="vertical-align: inherit;">ただし、すべてのページでキャッシュを無効にすると、パフォーマンスに影響する可能性があることに注意してください。</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.noCache());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Download-Options：ヘッダーにより、Inter Explorerはダウンロードされたファイルを実行できません。</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.ieNoOpen());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•Expect-CT：証明書の透明性-SSL証明書のインフラストラクチャに関するいくつかの問題を解決するために作成されたメカニズム。このヘッダーは、CTログでの追加の証明書検証の必要性をブラウザに通知します</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">var</span> expectCt = require(<span class="hljs-string">'expect-ct'</span>);<font></font>
app.use(expectCt({ maxAge: <span class="hljs-number">123</span> }));<font></font>
app.use(expectCt({ enforce: <span class="hljs-keyword">true</span>, maxAge: <span class="hljs-number">123</span> }));<font></font>
app.use(expectCt({ enforce: <span class="hljs-keyword">true</span>, maxAge: <span class="hljs-number">123</span>, reportUri: <span class="hljs-string">'http://example.com'</span>}));
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
•X-Powered-By：サーバーで使用されるテクノロジーを示すために使用されるオプションのヘッダー。</font><font style="vertical-align: inherit;">このヘッダーは次のように非表示にできます。</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hidePoweredBy());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 さらに、値を変更して、使用するテクノロジーに関する実際の情報を非表示にすることができます。</font></font><br>
<br>
<pre><code class="java hljs">app.use(helmet.hidePoweredBy({ setTo: <span class="hljs-string">'PHP 4.2.0'</span> }));
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォームのセキュリティ</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージを更新する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
アプリケーション</font><b><font style="vertical-align: inherit;">の</font></b><font style="vertical-align: inherit;">セキュリティは、使用する</font><b><font style="vertical-align: inherit;">パッケージの</font></b><font style="vertical-align: inherit;">セキュリティに依存するため、最新バージョンのパッケージを使用することが重要です。使用しているパッケージに既知の脆弱性が含まれていないことを確認するには、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特別なOWASPリストを</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用できます</font><font style="vertical-align: inherit;">。また、パッケージに既知の脆弱性Retire.jsがないかチェックするライブラリを使用することもできます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全でない機能を使用しないでください。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能な限り破棄することが推奨される関数があります。これらの関数の中には、引数として取得した文字列を実行するeval（）があります。ユーザー入力と組み合わせてこの関数を使用すると、リモートコード実行に脆弱性が生じる可能性があります。同様の理由で、関数は受け取った引数をbin / shに渡すため、child_process.execの使用も安全ではないためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、注意して使用する必要のあるモジュールがいくつかあります。たとえば、ファイルを操作するためのfsモジュール。生成されたユーザー入力が特定の方法で関数に渡される場合、アプリケーションはローカルファイルとディレクトリトラバーサルを含めることに対して脆弱になる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
V8仮想マシンでコードをコンパイルおよび実行するためのAPIを提供するvmモジュールは、サンドボックスでのみ使用する必要があります。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここ</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、アプリケーションを危険にさらす可能性のある他の関数に慣れることができます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正規表現の使用には注意してください。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
正規表現を書くと、表現が指数関数的に増加し、サービス不能につながる可能性があります。このような攻撃はReDoSと呼ばれます。正規表現が安全かどうかを確認するツールはいくつかあります。そのうちの1つはvuln-regex-detectorです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リンターを定期的に実行する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発中、セキュリティを確保するためのすべての推奨事項を覚えておくことは困難です。チーム開発に関しては、すべてのチームメンバーがルールに準拠することは容易ではありません。そのような目的のために、静的セキュリティ分析のためのツールがあります。このようなツールは、コードを実行せずに、脆弱性を探します。さらに、リンターを使用すると、脆弱である可能性のあるコード内の場所を見つけるためのカスタムルールを追加できます。最も一般的に使用されているリンターは、ESLintとJSHintです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストリクトモードを使用します</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。JavaScriptには、使用してはならない、安全ではない古い関数が多数あります。これらの関数を使用する可能性を排除するために、strictモードも提供されています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般的な安全原則を遵守する</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
説明されている推奨事項はNodeJSに焦点を当てていますが、使用するプラットフォームに関係なく遵守する必要のある一般的なセキュリティ原則を忘れないでください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja493702/index.html">リモートワークへの大規模な移行：技術的な問題とセキュリティに対する脅威</a></li>
<li><a href="../ja493704/index.html">TypeScriptを記述せずにJavaScriptでTypeScriptを使用する</a></li>
<li><a href="../ja493706/index.html">敵を知る：Node.jsバックドアを作成する</a></li>
<li><a href="../ja493708/index.html">私のホームKubernetesクラスターの構造</a></li>
<li><a href="../ja493712/index.html">使いやすさを向上させる新しいTypeScript機能</a></li>
<li><a href="../ja493716/index.html">as constコンストラクトとinferキーワードを使用したTypeScriptによる型推論</a></li>
<li><a href="../ja493718/index.html">ディスカッション：使用したことがなく、現在使用している標準のUNIXユーティリティ</a></li>
<li><a href="../ja493720/index.html">完璧な嵐：テクノロジーが外食産業をどのように変えているか</a></li>
<li><a href="../ja493724/index.html">RPA | アナリストの目によるロボット化のプロセス</a></li>
<li><a href="../ja493726/index.html">Intel NUCに基づく写真またはビデオによる喫煙検知複合体</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>