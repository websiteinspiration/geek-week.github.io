<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’  ğŸ¥¤ ğŸ™ HighLoad ++, Mikhail Raichenko (ManyChat): presque sans magie, ni Ã  quel point il est facile de distribuer un flux vidÃ©o tÃ©rabit ğŸ™ğŸ½ ğŸ‘ŠğŸ¿ ğŸ‘¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La prochaine confÃ©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 Ã  Saint-PÃ©tersbourg. DÃ©tails et billets ici . HighLoad ++ Moscou 2018. Salle Â«Del...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HighLoad ++, Mikhail Raichenko (ManyChat): presque sans magie, ni Ã  quel point il est facile de distribuer un flux vidÃ©o tÃ©rabit</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/488148/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prochaine confÃ©rence HighLoad ++ se tiendra les 6 et 7 avril 2020 Ã  Saint-PÃ©tersbourg. </font><font style="vertical-align: inherit;">DÃ©tails et billets </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">HighLoad ++ Moscou 2018. Salle Â«Delhi + CalcuttaÂ». </font><font style="vertical-align: inherit;">8 novembre, 14 h </font><font style="vertical-align: inherit;">RÃ©sumÃ©s et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prÃ©sentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ym/ji/ba/ymjiba---vkcs5ibbqbk9kcz8ny.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je travaille dans l'Ã©quipe VKontakte et je dÃ©veloppe un systÃ¨me de diffusion vidÃ©o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le rapport, je partagerai les caractÃ©ristiques du dÃ©veloppement du backend, l'Ã©volution de notre systÃ¨me et les solutions techniques auxquelles nous sommes parvenus:â€¨</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comment nous avons fait le backend de diffusion vidÃ©o et le processus d'Ã©volution tel qu'il est;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'impact des exigences commerciales et opÃ©rationnelles sur l'architecture;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Â«AttendezÂ» et Â«rÃ©essayezÂ» Ã©chouera;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comment les tÃ¢ches les plus simples sont compliquÃ©es par le nombre d'utilisateurs;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comment rÃ©duire la latence sans UDP;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous effectuons des tests de rÃ©sistance 2 fois par jour, ou ce que Clover nous a aidÃ©.</font></font></li>
</ul><a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Raichenko (ci-aprÃ¨s - MR):</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Une petite excursion. </font><font style="vertical-align: inherit;">Je vais vous parler des personnes qui nous diffusent, du direct (en direct), des plateformes sur lesquelles nous recevons le flux vidÃ©o et que nous distribuons. </font><font style="vertical-align: inherit;">Ã€ la fin, je parlerai de lâ€™architecture actuelle du live, de ses limites et de ses capacitÃ©s, ainsi que de la faÃ§on dont lâ€™architecture actuelle a survÃ©cu Ã  un effet tel que Â«CloverÂ».</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/bm/lt/_hbmlt0c2ek74zfr89jdff3wtsw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã€ propos des diffusions en direct. </font><font style="vertical-align: inherit;">Plan du rapport</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, je vais parler un peu des diffusions en direct et des streamers eux-mÃªmes, en nous envoyant du contenu vidÃ©o que nous montrons Ã  d'autres tÃ©lÃ©spectateurs.</font></font></li>
<li>         .    ?     ,     , , ,   -  - , - , .   ,        :   ,  â€“ .</li>
<li>    . ,      .     .     ,      ,     .</li>
<li>  ,     ,   .   ,         .  ,   ,   ,  , ,   2014-2015 .     ,      .</li>
<li>       .  ,                    .</li>
<li>,    .          ,    . ,    .</li>
<li>    ,    .      .</li>
<li>  ,    ,      Â«Â»,    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/lz/mm/jw/lzmmjwth6qvdlryupzhegpftal0.jpeg"><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les services de diffusion ressemblent Ã  ceci: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dt/2r/va/dt2rvaddozkmjrcp-1ojlaixmr0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nous avons un streamer, il nous envoie un flux RTMP et nous montrons le public - rien de surprenant, rien de surnaturel. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/fx/kq/eefxkq8vknyi57vz-y-_ekw5pd0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D'oÃ¹ vient le flux vidÃ©o? Une source importante de trafic pour nous est notre application mobile VKlife. Qu'est-ce qui est bon chez lui? Dans celui-ci, nous pouvons contrÃ´ler entiÃ¨rement la faÃ§on dont nous encodons la vidÃ©o. Nous pouvons faire de nombreuses optimisations du cÃ´tÃ© client, de sorte que plus tard, avec un minimum de dÃ©lais, le montrer Ã  nos tÃ©lÃ©spectateurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les inconvÃ©nients: les applications mobiles fonctionnent au-dessus des rÃ©seaux. Il peut s'agir de la 3G ... Dans tous les cas, ce sont presque toujours les rÃ©seaux mobiles, qui introduisent quelques retards - vous devez en outre tamponner les donnÃ©es cÃ´tÃ© application, afin que le flux se dÃ©roule aussi bien que possible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La deuxiÃ¨me source est les streamers avec OBS, Wirecast ou ceux qui diffusent Ã  partir d'autres applications de bureau. </font><font style="vertical-align: inherit;">Il s'agit d'un public assez large. </font><font style="vertical-align: inherit;">Parfois ce sont des sÃ©minaires, parfois - des flux de jeu (il y en a surtout beaucoup Ã  partir de telles applications). </font><font style="vertical-align: inherit;">Du positif: il y a peu d'applications de ce type, nous pouvons donner Ã  nos streamers de bonnes recommandations de rÃ©glage. </font><font style="vertical-align: inherit;">Mais en mÃªme temps, il y a beaucoup de paramÃ¨tres et n'envoyez pas tout Ã  fait le flux que nous voulons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La troisiÃ¨me catÃ©gorie est le flux RTMP des serveurs de mÃ©dias. </font><font style="vertical-align: inherit;">Il peut s'agir de trÃ¨s petits serveurs multimÃ©dias, c'est-Ã -dire d'un format domestique: une personne diffuse une vue sur la rue ou autre chose. </font><font style="vertical-align: inherit;">Ou des Ã©missions assez sÃ©rieuses de nos partenaires: il peut y avoir n'importe quoi, il n'y en a pas beaucoup, mais au fond elles sont trÃ¨s importantes pour nous.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qui regarde?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encore une fois, il s'agit d'une application mobile - tout est clair ici. Le plus gros problÃ¨me est la latence du rÃ©seau. Des pros: nous pouvons personnaliser le lecteur - c'est pratique pour nous, bien, mais pas partout il s'avÃ¨re Ã  100%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lecteur Web sur vk.com. Ici aussi, tout est simple - c'est un lecteur Web classique que vous pouvez ouvrir pour regarder. Une audience suffisamment large sur vk.com, beaucoup de tÃ©lÃ©spectateurs sur les Ã©missions. Certaines Ã©missions sont suspendues dans notre section Â«VidÃ©oÂ» - il peut y en avoir des dizaines de milliers (parfois sans aucun RP), surtout s'il s'agit d'un contenu intÃ©ressant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consÃ©quence, les chaÃ®nes sont suffisamment grandes pour les tÃ©lÃ©spectateurs qui sont assis sur un lecteur Web. Par consÃ©quent, il y a beaucoup de trafic, y compris pour une diffusion.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le troisiÃ¨me est le lecteur Web VKontakte sur un site tiers. </font><font style="vertical-align: inherit;">Vous pouvez commencer Ã  diffuser tout ce que vous voulez et accrocher un lecteur Web VKontakte sur votre site Web. </font><font style="vertical-align: inherit;">Vous pouvez devenir notre partenaire si vous avez du contenu intÃ©ressant: vous pouvez le suspendre vous-mÃªme, vous pouvez accrocher avec nous - comme vous le souhaitez. </font><font style="vertical-align: inherit;">Vous pouvez organiser vos Ã©missions de cette maniÃ¨re, et tout fonctionnera.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparaison avec les appels vidÃ©o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les appels vidÃ©o, certaines distorsions d'image seront annulÃ©es. Les appels vidÃ©o sont plus simples: nous pouvons dÃ©grader considÃ©rablement l'image, mais en mÃªme temps nous devons maintenir une trÃ¨s bonne latence. Avec un long dÃ©lai, le service sera absolument impossible Ã  utiliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les Ã©missions dans ce sens, c'est un peu l'inverse: nous devons maintenir une qualitÃ© d'image Ã©levÃ©e, mais en mÃªme temps, nous pouvons augmenter la latence en raison de nombreux facteurs. Par exemple, le lecteur met en mÃ©moire tampon le flux d'une maniÃ¨re ou d'une autre (il peut Ãªtre une seconde, deux afin de survivre Ã  la dÃ©gradation du rÃ©seau, par exemple), par consÃ©quent, il n'a pas besoin de retards d'une seconde, milliseconde dans la plupart des cas. Vous pouvez vous efforcer pour cela, mais la nourriture n'est pas une condition prÃ©alable.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j0/7o/o6/j07oo6ceqiizh_lzdgjsgvgfwtq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec une vidÃ©o ordinaire, la situation est exactement le contraire. </font><font style="vertical-align: inherit;">Nous avons besoin d'une trÃ¨s bonne qualitÃ©. </font><font style="vertical-align: inherit;">Dans le mÃªme temps, il est souhaitable de minimiser la taille de la vidÃ©o, le rapport de dÃ©bit binaire et la qualitÃ©, de sorte qu'avec le dÃ©bit minimum, donner la meilleure solution. </font><font style="vertical-align: inherit;">Des pros: nous ne sommes pas limitÃ©s dans le temps: au moment du tÃ©lÃ©chargement de la vidÃ©o, nous avons suffisamment de temps pour optimiser la vidÃ©o, voir comment la compresser de la meilleure faÃ§on, faire quelque chose, la faire glisser dans des caches, si nÃ©cessaire - en gÃ©nÃ©ral, tout est suffisant D'ACCORD. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r-/cc/jfr-cco9dozhxgqqnuw57opkqjk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En direct, la situation est, encore une fois, le contraire: nous avons trÃ¨s peu de temps pour le transcodage. </font><font style="vertical-align: inherit;">En mÃªme temps, il y a peu d'opportunitÃ©s, mais il n'y a aucune attente pour la diffusion. </font><font style="vertical-align: inherit;">Le public nous pardonnera si nous avons du soutien ou si la qualitÃ© n'est pas trÃ¨s bonne.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PremiÃ¨re version</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est assez attendu: en </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3f/gt/bw/3fgtbwzvl3uf680sfzsf8kjette.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fait, c'est un peu diffÃ©rent: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/9r/zu/vu9rzujgkidpvrb66qzgbvapljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"Streamer - serveur multimÃ©dia - niveau de cache - tÃ©lÃ©spectateurs". </font><font style="vertical-align: inherit;">En principe, cette version vous permet d'Ã©voluer assez fortement. </font><font style="vertical-align: inherit;">Je dirais qu'il devrait dÃ©jÃ  rÃ©sister Ã  des dizaines de milliers de spectateurs. </font><font style="vertical-align: inherit;">Il a d'autres inconvÃ©nients ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, si vous regardez ce circuit (diapositive prÃ©cÃ©dente), vous pouvez voir qu'il n'est pas tolÃ©rant aux pannes. </font><font style="vertical-align: inherit;">Il faut deviner avec le serveur mÃ©dia pour bien Ã©quilibrer l'audience. </font><font style="vertical-align: inherit;">Nous ne pouvons pas bloquer de nombreux caches sur chaque serveur - c'est tout simplement cher. </font><font style="vertical-align: inherit;">Par consÃ©quent, nous avons regardÃ©, rÃ©alisÃ© que c'Ã©tait simple et clair, il y avait quelques possibilitÃ©s de mise Ã  l'Ã©chelle, mais Ã©videmment quelque chose manquait ... Et nous avons commencÃ© Ã  formuler des exigences.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Besoins en infrastructure</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qu'est-ce qui est important?</font></font><br>
<br>
<ul>
<li> .     , ,    .            (       ).       (,  ).</li>
<li>.     : -,    (,    )      ; -,     â€“      ,    ,       .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livraison aux rÃ©gions. </font><font style="vertical-align: inherit;">Aussi un point important! </font><font style="vertical-align: inherit;">Il est stupide de faire glisser tout le contenu vidÃ©o de PÃ©tersbourg ou de Moscou vers une sorte de Novossibirsk, Iekaterinbourg, ou mÃªme de Saint-PÃ©tersbourg Ã  Moscou. </font><font style="vertical-align: inherit;">Ce n'est pas trÃ¨s bon, car le retard du rÃ©seau sera long - il y aura des retards, tout sera en retard, et ce n'est pas bon. </font><font style="vertical-align: inherit;">Par consÃ©quent, notre infrastructure doit tenir compte du fait que nous livrons du contenu aux rÃ©gions.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CommoditÃ© de fonctionnement et de surveillance. </font><font style="vertical-align: inherit;">Une propriÃ©tÃ© importante. </font><font style="vertical-align: inherit;">Ã‰tant donnÃ© que le systÃ¨me est volumineux, il existe de nombreux tÃ©lÃ©spectateurs, il est important d'envoyer des alertes aux administrateurs Ã  temps en cas de problÃ¨me, y compris la surveillance des produits et des mesures techniques.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/km/n1/e_/kmn1e_0ii74m9xilh_5rsic9l5a.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã€ quoi ressemble l'infrastructure de diffusion maintenant?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consÃ©quence, nous sommes arrivÃ©s Ã  une infrastructure assez simple mais efficace ...</font></font><br>
<br>
<ul>
<li> â€“ ,       ( ,  ).   RTMP-,    .        ,  .</li>
<li> ,      ,     ,  ,   .       .  ,   ,   ,   â€“ : , -,  (. .       ); -,     .</li>
<li>      .     â€“    ,   .        ,    ,    .      ,         (    ,  ).</li>
<li>         ,         (edge-).     ,  .    !</li>
<li>   â€“  edge-,      ,   .   :      ,   â€“    .</li>
</ul><br>
<img src="https://habrastorage.org/webt/2e/cu/qp/2ecuqpdeldwtxd6qjyi-x4q0_ke.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De faÃ§on intÃ©ressante? </font><font style="vertical-align: inherit;">Ã‰quilibrage! </font><font style="vertical-align: inherit;">Dans ce schÃ©ma, nous choisissons l'Ã©quilibrage, essayons d'envoyer des tÃ©lÃ©spectateurs qui regardent le mÃªme flux vers chaque serveur de pÃ©riphÃ©rie. </font><font style="vertical-align: inherit;">La localitÃ© du cache est trÃ¨s importante ici, car il peut y avoir de nombreux serveurs pÃ©riphÃ©riques; </font><font style="vertical-align: inherit;">et si nous n'observons pas Ã  la fois le temporaire et la localitÃ© du cache du point de vue du flux, nous surchargerons la couche interne. </font><font style="vertical-align: inherit;">Cela ne nous plairait pas non plus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, nous Ã©quilibrons de la maniÃ¨re suivante: nous sÃ©lectionnons un certain serveur pÃ©riphÃ©rique pour la rÃ©gion dans laquelle nous envoyons des spectateurs, et nous envoyons jusqu'Ã  ce que nous commencions Ã  comprendre qu'un certain remplissage s'est produit et doit Ãªtre envoyÃ© Ã  un autre serveur. </font><font style="vertical-align: inherit;">Le circuit est simple et fonctionne de maniÃ¨re trÃ¨s fiable. </font><font style="vertical-align: inherit;">Naturellement, pour diffÃ©rents flux, vous choisissez une sÃ©quence diffÃ©rente de serveurs Edge (la sÃ©quence dans laquelle nous envoyons des spectateurs). </font><font style="vertical-align: inherit;">Par consÃ©quent, l'Ã©quilibrage fonctionne tout simplement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous donnons Ã©galement au client un lien vers un serveur Edge disponible. </font><font style="vertical-align: inherit;">Ceci est fait pour qu'en cas de panne du serveur de pÃ©riphÃ©rie, nous puissions rediriger le visualiseur vers un autre. </font><font style="vertical-align: inherit;">Autrement dit, lorsque le tÃ©lÃ©spectateur regarde la diffusion, il reÃ§oit un lien vers le serveur souhaitÃ© toutes les quelques secondes. </font><font style="vertical-align: inherit;">S'il comprend que le lien doit Ãªtre diffÃ©rent, il change (le joueur bascule) et continue de regarder la diffusion Ã  partir d'un autre serveur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un autre rÃ´le important des serveurs Edge est la protection du contenu. </font><font style="vertical-align: inherit;">Toute la protection du contenu y a lieu essentiellement. </font><font style="vertical-align: inherit;">Nous avons notre propre module nginx pour cela. </font><font style="vertical-align: inherit;">Il est quelque peu similaire Ã  Security Link.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise Ã  l'Ã©chelle et Ã©quilibrage</font></font></h3><br>
<ul>
<li>   . ,        :     ,       .          edge-,        .     .     .    â€¦   ,     â€“    ,  --    â€“ ,  â€“ , , ,   â€“  !   â€“        .</li>
<li>      .  ,  ,         ,    ,       :     .       (   )    ,    â€“   ,   . ,    ,     ,      edge-.</li>
<li>   ,   ,       ,     .</li>
</ul><br>
<img src="https://habrastorage.org/webt/19/nj/i8/19nji8vwkh_kjrrsm9d698hf5ji.jpeg"><br>
<br>
<h3>   ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'un des principaux protocoles que nous avions Ã©tait RTMP (non seulement pour l'entrÃ©e, mais aussi pour la distribution de contenu). Le principal avantage est une faible latence. Cela peut prendre une demi-seconde, une seconde, deux secondes. En fait, les avantages s'arrÃªtent lÃ  ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u7/fv/al/u7fvaloyunlxmyavp5rjemer4sw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce protocole de streaming est difficile Ã  surveiller - il est fermÃ© dans un sens, malgrÃ© le fait qu'il existe une spÃ©cification. Le lecteur Flash ne fonctionne plus (en fait, c'est Â«dÃ©jÃ  toutÂ»). Besoin d'assistance au niveau CDN - vous avez besoin de modules nginx spÃ©ciaux ou de votre propre logiciel pour transfÃ©rer le flux normalement. Il existe Ã©galement des difficultÃ©s avec les clients mobiles. Dans les clients mobiles, il est trÃ¨s mal pris en charge - des amÃ©liorations spÃ©ciales sont nÃ©cessaires, et tout cela est trÃ¨s difficile.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me protocole que nous avons utilisÃ© est HLS. </font><font style="vertical-align: inherit;">Cela a l'air assez simple: c'est un fichier texte, le soi-disant fichier d'index. </font><font style="vertical-align: inherit;">Il contient des liens vers des fichiers d'index avec diffÃ©rentes autorisations, et les fichiers eux-mÃªmes contiennent des liens vers des segments multimÃ©dias. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w-/hl/vf/w-hlvfylbcsu1n6ksqlv7uy5e5a.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment est-il bon? </font><font style="vertical-align: inherit;">C'est trÃ¨s simple, mÃªme s'il est un peu vieux. </font><font style="vertical-align: inherit;">Il vous permet d'utiliser CDN, c'est-Ã -dire que vous n'avez besoin que de nginx pour distribuer le protocole HLS. </font><font style="vertical-align: inherit;">C'est comprÃ©hensible en termes de suivi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici ses avantages:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facilitÃ© d'utilisation - nginx en tant que serveur proxy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est facile de surveiller et de prendre des mesures (il vous suffit de surveiller Ã  peu prÃ¨s la mÃªme chose que ce que vous surveillez sur votre site Web);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, ce protocole est le principal pour la livraison de contenu.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Moins significatif:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">latence Ã©levÃ©e.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/fa/ko/2_/fako2_ysvwvhaguijmddcna20eu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La latence HLS est en fait imbriquÃ©e dans le protocole lui-mÃªme; </font><font style="vertical-align: inherit;">comme un long temps de mise en mÃ©moire tampon est nÃ©cessaire, le joueur est obligÃ© d'attendre au moins lorsqu'un morceau est chargÃ©, mais dans le bon sens, il doit attendre que deux morceaux (deux segments multimÃ©dias) soient chargÃ©s, sinon en cas de dÃ©calage, le client chargera le lecteur, et cela n'affecte pas trÃ¨s bien expÃ©rience utilisateur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me point qui donne un dÃ©lai dans HLS est la mise en cache. </font><font style="vertical-align: inherit;">La liste de lecture est mise en cache sur la couche interne et sur les serveurs Edge. </font><font style="vertical-align: inherit;">MÃªme si nous mettons en cache, relativement parlant, pendant une seconde ou une demi-seconde, cela reprÃ©sente environ plus 2-3 secondes de retard. </font><font style="vertical-align: inherit;">Au total, il s'avÃ¨re de 12 Ã  18 secondes - ce n'est pas trÃ¨s agrÃ©able, Ã©videmment c'est mieux.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AmÃ©lioration de HLS</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec ces rÃ©flexions, nous avons commencÃ© Ã  amÃ©liorer HLS. Nous l'avons amÃ©liorÃ© de maniÃ¨re assez simple: donnons un peu plus tÃ´t le dernier segment multimÃ©dia de la playlist, pas encore enregistrÃ©. Autrement dit, dÃ¨s que nous avons commencÃ© Ã  Ã©crire le dernier segment mÃ©dia, nous l'annonÃ§ons immÃ©diatement dans la playlist. Que se passe-t-il en ce moment? .. Le </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
temps tampon des joueurs est rÃ©duit. Le joueur croit qu'il a dÃ©jÃ  tout tÃ©lÃ©chargÃ© et commence calmement Ã  tÃ©lÃ©charger les segments souhaitÃ©s. De cette faÃ§on, nous Â«trichonsÂ» un peu le joueur, mais si nous surveillons bien Â«l'acierÂ» (les charges dans le lecteur), cela ne nous fait pas peur - nous pouvons arrÃªter de donner le segment Ã  l'avance, et tout reviendra Ã  la normale.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me point: nous gagnons un total d'environ 5-8 secondes. D'oÃ¹ viennent-ils? Cette durÃ©e de segment est de 2 Ã  4 secondes par segment, plus le temps de mise en cache de la liste de lecture (cela reprÃ©sente encore 2-3 secondes). De plus, notre retard diminue considÃ©rablement. Le dÃ©lai est rÃ©duit de 12-15 secondes Ã  5-7. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quoi d'autre est bon dans cette approche? C'est en fait gratuit! Il suffit de vÃ©rifier si les joueurs sont compatibles avec cette approche. Ceux qui sont incompatibles, nous les envoyons aux anciennes URL et nous envoyons les lecteurs compatibles aux nouvelles URL. Nous n'avons pas besoin de mettre Ã  niveau les anciens clients qui prennent en charge cela, ce qui est Ã©galement important. Nous n'avons en fait pas besoin de modifier, de libÃ©rer les joueurs dans les clients mobiles. Nous n'avons pas besoin de dÃ©velopper un lecteur web. Cela semble assez bon!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0f/gm/tt/0fgmttjysv2w8rg8bmzdgzcdtz4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parmi les inconvÃ©nients - la nÃ©cessitÃ© de contrÃ´ler le flux vidÃ©o entrant. </font><font style="vertical-align: inherit;">Dans le cas d'un client mobile, nous pouvons le faire assez facilement (lorsque le flux provient d'un client mobile), ou transcoder sans Ã©chec, car le lecteur doit savoir combien de temps cela prend pour un segment de temps multimÃ©dia. </font><font style="vertical-align: inherit;">Et puisque nous l'annonÃ§ons avant qu'il ne soit rÃ©ellement enregistrÃ©, nous devons savoir combien de temps il faudra pour l'enregistrer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesures de qualitÃ©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous avons amÃ©liorÃ© HLS. </font><font style="vertical-align: inherit;">Maintenant, je veux dire comment nous surveillons et quelles mesures de qualitÃ© nous tirons: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3h/_y/iz/3h_yizx3clxbb18dzi-urr-oylq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'une des principales mesures de qualitÃ© est l'heure de dÃ©but. </font><font style="vertical-align: inherit;">IdÃ©alement, c'est lorsque vous faites dÃ©filer le client mobile avant la diffusion, appuyez sur le bouton et cela dÃ©marre immÃ©diatement. </font><font style="vertical-align: inherit;">Ce serait idÃ©al si cela commence avant d'appuyer sur le bouton, mais, malheureusement, uniquement lorsque vous appuyez sur.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxiÃ¨me point est le retard du signal. Nous pensons que quelques secondes sont trÃ¨s bonnes, 10 secondes sont tolÃ©rables, 20-30 secondes sont trÃ¨s mauvaises. Pourquoi c'est important? Par exemple, pour les concerts et certains Ã©vÃ©nements publics, il s'agit d'une mÃ©trique absolument sans importance, il n'y a pas de rÃ©troaction; nous montrons simplement le flux - il vaut mieux ne pas prendre de retard qu'un lÃ©ger retard. Et pour un flux oÃ¹ une sorte de confÃ©rence se dÃ©roule ou oÃ¹ une personne dit quelque chose et lui pose des questions, cela commence Ã  Ãªtre important, car ils posent beaucoup de questions dans les commentaires et je veux que le public reÃ§oive des commentaires le plus tÃ´t possible.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre mesure importante est la mise en mÃ©moire tampon et les retards. </font><font style="vertical-align: inherit;">En fait, cette mÃ©trique est importante non seulement du point de vue du client et de la qualitÃ©, mais du point de vue de la mesure dans laquelle nous pouvons Â«Ã©tirerÂ» la livraison de HLS, de la quantitÃ© de donnÃ©es que nous pouvons extraire de nos serveurs. </font><font style="vertical-align: inherit;">Par consÃ©quent, nous surveillons Ã  la fois le temps tampon moyen dans les lecteurs et Â«l'acierÂ». </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le choix de la qualitÃ© des joueurs est comprÃ©hensible: les changements inattendus sont toujours ennuyeux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, il s'agit Ã©galement d'une mesure importante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">surveillance</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons de nombreuses mesures de surveillance, mais ici, j'ai choisi ces mesures qui fonctionnent toujours en cas de problÃ¨me:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ir/wy/me/irwymelifaedclj13razr83a85i.jpeg"><br>
<br>
<ul>
<li>-,    .   -   ,    .  ,  â€“ ,              ( ,  â€“  ).</li>
<li> /     .  , ,  ,      ,        ,    .     .</li>
<li>  edge-.  ,       ,     edge-       .</li>
</ul><br>
<br>
<h3>  Â«Â»,       ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais maintenant vous expliquer comment nous avons gÃ©rÃ© une application telle que "Player" lorsque nous avons utilisÃ© notre infrastructure pour diffuser un flux vidÃ©o avec des questions et des rÃ©ponses. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clover est un quiz en ligne. L'hÃ´te dit quelque chose, demande: des questions tombent - vous rÃ©pondez. 12 questions, 10 minutes de jeu, Ã  la fin - une sorte de prix. Qu'est-ce qui est si compliquÃ©? C'est la croissance! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A droite se trouve ce graphique: Le </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/i8/_e/hwi8_er_sdcw_gxczrgk3z41en0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pic [sur le graphique] est la charge sur les serveurs en termes d'API au moment du dÃ©marrage de Â«CloverÂ». Le reste du temps est le flux habituel d'Ã©missions. Cela ne peut pas Ãªtre Ã©gal au nombre de tÃ©lÃ©spectateurs. C'est peut-Ãªtre le nombre de demandes et la charge.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est difficile: en 5 minutes, un million de spectateurs sont venus vers nous au sommet. </font><font style="vertical-align: inherit;">Ils commencent Ã  regarder la diffusion, Ã  s'inscrire, Ã  effectuer une sorte d'action, Ã  demander une vidÃ©o ... Cela semble Ãªtre un jeu trÃ¨s simple, mais cela se produit dans un laps de temps trÃ¨s court (toutes les actions, y compris le jeu final) - cela donne une charge assez Ã©levÃ©e.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelles questions et quels dÃ©fis avons-nous rencontrÃ©s?</font></font></h3><br>
<img src="https://habrastorage.org/webt/pd/ci/xh/pdcixhln_tmsracssi9qfy5ra5y.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Croissance rapide. </font><font style="vertical-align: inherit;">Parfois, c'Ã©tait + 50% par semaine. </font><font style="vertical-align: inherit;">Si, par exemple, vous avez 200 000 personnes mercredi, alors samedi ou dimanche, il pourrait y en avoir dÃ©jÃ  300. C'est beaucoup! </font><font style="vertical-align: inherit;">Des problÃ¨mes commencent Ã  faire surface qui n'Ã©taient pas visibles auparavant.</font></font></li>
<li>    2   .       .      ,  .       ,  , ,          ,         ,    .<br>
 12         . ,    ,     ,    , ,    -      ,     ,  â€¦</li>
<li>      ,       .     , ,  200-300 ,         400-500.</li>
<li>- ,    ,   ,           3-5 .   ?    Â«Â»,    ,    ,         ,     .<br>
<br>
       (   3   ,   ),          ,       3-5 .    ?  â€“  ,  â€“     exponential backoff,        .<br>
<br>
  exponential on backoff:  â€“ ,       2 ,   4,  8.             backend-.</li>
</ul><br>
<h3>    Â«Â»?</h3><br>
<img src="https://habrastorage.org/webt/-h/c_/gn/-hc_gnjjd-m7ujstbxa9edwnoms.jpeg"><br>
<ul>
<li>-,         .      ,    â€“   .</li>
<li>   Â« Â».  ,     ,    ,      ,     Â«Â».      ,   , -,    ,  -,     .</li>
<li> ,         â€“   ,     Â«Â»    .      Â«Â».     ,  ,   ,    â€¦     â€“ . 10% Â«Â» â€“ , 10% Â«Â»  100  â€“  .</li>
<li> Â«Â»   ,     ,    Â«Â»      .       â€“     -  .    100    â€“  ,  1    15  â€“   .</li>
<li>   .  Â«Â»   , , ,  .   ,      ,     .</li>
<li>   .                   ,    .         ,   latency,    .</li>
<li>   .    â€“     ,       .</li>
<li>  Â«Â»       1           . ,  ,   .      .    ,     ,     .      .</li>
</ul><br>
<h3>  ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'architecture nous convient parfaitement et je peux la recommander en toute sÃ©curitÃ©. HLS restera avec nous le protocole principal pour au moins le site Web et au moins le protocole de sauvegarde pour tout le reste. Peut-Ãªtre que nous passerons au MPEG-DASH. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RTMP abandonnÃ©. MalgrÃ© le fait qu'il donne un dÃ©lai plus faible, nous avons dÃ©cidÃ© de rÃ©gler le HLS. Peut-Ãªtre envisager d'autres vÃ©hicules de livraison, y compris DASH comme alternative. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qz/ut/oq/qzutoqnu3adqhxx0rivblxx9izq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous amÃ©liorerons le solde entrant. Nous voulons Ã©galement effectuer un basculement transparent pour l'Ã©quilibrage entrant, de sorte qu'en cas de problÃ¨me sur l'un des serveurs de mÃ©dias pour le client, la commutation soit complÃ¨tement invisible. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-Ãªtre dÃ©velopperons-nous des systÃ¨mes de livraison des serveurs de pÃ©riphÃ©rie au client. Ce sera probablement une sorte d'UDP. Lequel - nous rÃ©flÃ©chissons maintenant et nous sommes au stade de la recherche.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, c'est tout. </font><font style="vertical-align: inherit;">Merci Ã  tous!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des questions</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Question du public (ci-aprÃ¨s - A): - Merci beaucoup pour le rapport! </font><font style="vertical-align: inherit;">Seul le confÃ©rencier d'Odnoklassniki a pris la parole, et il a dit qu'ils devaient rÃ©Ã©crire le streamer, l'encodeur, l'encodeur ... Utilisez-vous de telles solutions ou utilisez celles en stock qui sont sur le marchÃ© (comme Harmonic, etc.)? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1_/mt/qb/1_mtqbmuiapdtajkn5at3emzwtm.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Maintenant, nous avons des solutions tierces en rotation. </font><font style="vertical-align: inherit;">Parmi les solutions open source que nous avons utilisÃ©es, nous avions nginx, le module RTMP (depuis longtemps). </font><font style="vertical-align: inherit;">D'une part, il nous a plu car il travaillait, assez simple. </font><font style="vertical-align: inherit;">Nous nous sommes battus trÃ¨s longtemps pour qu'il travaille de maniÃ¨re stable. </font><font style="vertical-align: inherit;">Maintenant, il passe de Nginx-RTMP Ã  sa propre solution. </font><font style="vertical-align: inherit;">Nous pensons maintenant avec un transcodeur. </font><font style="vertical-align: inherit;">Le rÃ©cepteur, Ã  savoir la partie rÃ©ceptrice, a Ã©galement Ã©tÃ© rÃ©Ã©crit de Nginx-RTMP vers sa solution. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ET:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Je voulais poser une question sur le dÃ©coupage de RTMP sur HLS, mais si je comprends bien, vous avez dÃ©jÃ  rÃ©pondu ... Dites-moi, vos solutions sont-elles open-source? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous envisageons de le publier en open source. Nous prÃ©fÃ©rons plutÃ´t le publier, mais la question est le moment de la sortie en open source. Il suffit de mettre la source sur Internet - cela ne suffit pas. Vous devez rÃ©flÃ©chir, faire quelques exemples de dÃ©ploiement. Et dans quel but demandez-vous? Voulez-vous utiliser? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Parce que j'ai aussi rencontrÃ© Nginx-RTMP! Il est, pour le moins, pas pris en charge depuis trÃ¨s longtemps. L'auteur ne rÃ©pond mÃªme pas particuliÃ¨rement aux questions ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Si vous voulez, vous pouvez Ã©crire au mail. Donner pour son propre usage? Nous pouvons Ãªtre d'accord. Nous prÃ©voyons vraiment de l'ouvrir. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ET:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Vous avez Ã©galement dit que vous pouvez passer de HLS Ã  DASH. HLS ne convient pas? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M.:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - C'est une question sur ce que nous pouvons, ou peut-Ãªtre pas. Cela dÃ©pend grandement de ce que nous allons faire en termes de recherche de mÃ©thodes de livraison alternatives (c'est-Ã -dire UDP). Si nous trouvons quelque chose de Â«complÃ¨tementÂ» bon, alors nous ne toucherons probablement pas HLS. S'il semble que MPEG-DASH est plus confortable - nous allons peut-Ãªtre le dÃ©placer. Cela ne semble pas trÃ¨s difficile, mais nous ne savons pas si c'est nÃ©cessaire ou non. La synchronisation entre les flux, entre les qualitÃ©s et d'autres choses y est clairement meilleure. Il y a des avantages. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Concernant les alertes. Vous avez parlÃ© du fait que si les flux cessent de couler, alors c'est immÃ©diatement une alerte. Et vous n'avez pas attrapÃ© quelque chose d'indÃ©pendant de vous: le fournisseur est tombÃ©, Megafon est tombÃ© et les gens ont cessÃ© de diffuser? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Disons simplement que quelque chose d'indÃ©pendant de nous est essentiellement toutes sortes de vacances et ainsi de suite. Oui, ils ont. Eh bien, oui. Les administrateurs ont regardÃ© - aujourd'hui c'est les vacances, le reste des caractÃ©ristiques vont bien - ils se sont calmÃ©s. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et sur la mise Ã  l'Ã©chelle. Ã€ quel niveau Ã©volue-t-il? Par exemple, j'ai demandÃ© un flux depuis le tÃ©lÃ©phone - vais-je recevoir immÃ©diatement un certain lien avec le bon serveur ash? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Un lien viendra immÃ©diatement et, si nÃ©cessaire, vous commutera (s'il y a des problÃ¨mes sur un serveur spÃ©cifique). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xz/tn/rq/xztnrqvvbr73gu61lqgpvdt5c-e.jpeg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Qui va changer? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Lecteur mobile ou lecteur web. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Il redÃ©marrera le flux ou quoi? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Un nouveau lien viendra Ã  lui oÃ¹ il devrait aller en direct. Il ira lÃ -bas et demandera Ã  nouveau le flux. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ET:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- A quel niveau avez-vous des caches? Et des listes de lecture, et des morceaux, ou juste Ã§a? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et des listes de lecture, des morceaux! Il se cache un peu diffÃ©remment, Ã  la fois en termes de temps et en termes de retour de temps, mais nous mettons en cache les deux. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Concernant la crÃ©ation de serveurs Ash? Avez-vous eu une telle situation que vous regardez 2 millions de tÃ©lÃ©spectateurs sur une Ã©mission, que vous n'avez pas le temps pour quelque chose et que vous rÃ©cupÃ©rez rapidement un serveur Ash? Ou soulevez-vous tout Ã  l'avance avec une marge? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monsieur:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Peut-Ãªtre que non. PremiÃ¨rement, le stock est toujours petit ou grand - peu importe. DeuxiÃ¨mement, il nâ€™arrive pas quâ€™une Ã©mission devienne soudainement super populaire. Nous pouvons bien prÃ©voir le nombre de tÃ©lÃ©spectateurs. En gros, pour avoir beaucoup de monde, il faut faire un effort. En consÃ©quence, nous pouvons ajuster le nombre de tÃ©lÃ©spectateurs de l'Ã©mission, en fonction des efforts dÃ©ployÃ©s. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Vous avez dit que vous mesurez les retards instrumentaux de la part du joueur. Comment? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - TrÃ¨s simple. Dans les morceaux (dans les segments multimÃ©dias), nous avons un horodatage, au nom du segment multimÃ©dia - dans le lecteur, nous le renvoyons simplement. S'il n'est pas explicitement du tout, il revient. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je me souviens avoir essayÃ© d'exÃ©cuter le peering sur WebRTC. Pourquoi refusÃ©? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monsieur:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Je ne peux pas rÃ©pondre Ã  cette question pour vous - c'est arrivÃ© sans moi." Je ne peux pas dire pourquoi j'ai essayÃ© et je ne peux pas dire pourquoi j'ai refusÃ©. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Concernant le rÃ©cepteur et le serveur multimÃ©dia. Si je comprends bien, vous aviez Nginx-RTMP, maintenant lÃ  et lÃ , vous avez des solutions faites par vous-mÃªme. En fait, il s'agit d'un serveur multimÃ©dia qui fait office de proxy pour d'autres serveurs multimÃ©dia, et ils sont dÃ©jÃ  dans le cache et en pÃ©riphÃ©rie. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Donc, pas vraiment. Il s'agit d'une solution autodidacte, mais elle est diffÃ©rente Ã  la fois en termes de serveur multimÃ©dia et en termes de rÃ©cepteur. Nginx-RTMP - c'Ã©tait une sorte de moissonneuse qui pouvait faire les deux. Nos intÃ©rieurs du rÃ©cepteur et du serveur multimÃ©dia sont trÃ¨s diffÃ©rents - Ã  la fois par code et partout. La seule chose qui les unit est le traitement RTMP. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Concernant l'Ã©quilibre entre les bords. Comment cela peut-il arriver?</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Nous mesurons le trafic, l'envoyer au serveur souhaitÃ©. Je n'ai pas compris un peu la question ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Je vais expliquer: l'utilisateur demande une liste de lecture via le lecteur - il renvoie les chemins relatifs aux manifestes et aux morceaux ou aux chemins absolus, par exemple, par IP ou domaine? .. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Les chemins sont relatifs. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Autrement dit, il n'y a pas d'Ã©quilibrage lors de la visualisation d'un flux par un seul utilisateur? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Ã‡a arrive. Assez dÃ©licat. Nous pouvons utiliser la redirection 301e lors de la surcharge du serveur. Si nous voyons que tout est complÃ¨tement mauvais lÃ -bas, pour les segments, nous pouvons l'envoyer Ã  un autre serveur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Mais cela devrait Ãªtre connectÃ© Ã  la logique du joueur? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monsieur:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Non, juste cette partie ne doit pas Ãªtre cousue. 301e redirection! Simplement, le joueur devrait pouvoir quitter la 301e liaison. Nous pouvons l'envoyer Ã  un autre serveur du cÃ´tÃ© serveur au moment de la surcharge. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Autrement dit, il demande au serveur, et le serveur le lui donne? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MR:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Oui. Ce n'est pas trÃ¨s bon, par consÃ©quent, la logique du joueur est utilisÃ©e pour retweeter les liens vers le cas de dÃ©faillance d'un des serveurs - c'est dÃ©jÃ  dans la logique du joueur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Et vous n'avez pas essayÃ© de travailler non pas de maniÃ¨re relative, mais absolue: lorsque vous demandez au joueur de faire de la magie, dÃ©couvrez oÃ¹ il y a des ressources et oÃ¹ pas, et donnez dÃ©jÃ  des listes de lecture indiquant un serveur spÃ©cifique? </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monsieur:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- En fait, cela ressemble Ã  une solution de travail. </font><font style="vertical-align: inherit;">Si vous Ã©tiez venu alors, nous aurions pesÃ© les deux! </font><font style="vertical-align: inherit;">Mais la solution actuelle fonctionne Ã©galement, donc je ne veux pas vraiment passer de lâ€™un Ã  lâ€™autre, mÃªme si cela ressemble peut-Ãªtre aussi Ã  une solution de travail. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dites-moi, est-ce en quelque sorte amical avec la multidiffusion? </font><font style="vertical-align: inherit;">HLS, si je comprends bien, absolument rien ... </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M.:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Dans la mise en Å“uvre actuelle, nous n'avons probablement rien dans le systÃ¨me avec la multidiffusion en direct. </font><font style="vertical-align: inherit;">Nous n'y incluons pas le concept de multidiffusion. </font><font style="vertical-align: inherit;">Peut-Ãªtre quelque part dans les profondeurs de la magie administrative, il y a quelque chose Ã  l'intÃ©rieur du rÃ©seau, mais il est cachÃ© Ã  tout le monde et personne ne le sait ...</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qr/va/s2/qrvas2mhyryhgck9t6n8ffc1pai.jpeg"><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bA-Y_BfTZZY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un peu de publicitÃ© :)</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Merci de rester avec nous. Aimez-vous nos articles? Vous voulez voir des matÃ©riaux plus intÃ©ressants? Soutenez-nous en passant une commande ou en recommandant Ã  vos amis, le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cloud VPS pour les dÃ©veloppeurs Ã  partir de 4,99 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , un </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analogue unique de serveurs d'entrÃ©e de gamme que nous avons inventÃ© pour vous: </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toute la vÃ©ritÃ© sur VPS (KVM) E5-2697 v3 (6 cÅ“urs) 10 Go DDR4 480 Go SSD 1 Gbit / s Ã  partir de 19 $ ou comment diviser le serveur?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (les options sont disponibles avec RAID1 et RAID10, jusqu'Ã  24 cÅ“urs et jusqu'Ã  40 Go de DDR4). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R730xd 2 fois moins cher au centre de donnÃ©es Equinix Tier IV Ã  Amsterdam?</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous avons seulement </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV Ã  partir de 199 $</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aux Pays-Bas!</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - Ã  partir de 99 $! </font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En savoir plus sur la</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crÃ©ation d'un bÃ¢timent d'infrastructure. </font><font style="vertical-align: inherit;">classe c utilisant des serveurs Dell R730xd E5-2650 v4 coÃ»tant 9 000 euros pour un sou?</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488136/index.html">Comment le robot Atlas a-t-il appris Ã  faire des cascades acrobatiques, insupportables pour une personne ordinaire?</a></li>
<li><a href="../fr488138/index.html">Mesures de petite capacitÃ© (capteur capacitif analogique)</a></li>
<li><a href="../fr488140/index.html">Comment simplifier la vie avec l'aide de la loi Pareto</a></li>
<li><a href="../fr488142/index.html">Avalonia songeur</a></li>
<li><a href="../fr488146/index.html">[Discussion]: Les ingÃ©nieurs informatiques sont-ils des ingÃ©nieurs informatiques?</a></li>
<li><a href="../fr488150/index.html">AntiquitÃ©s: ThinkPad X200 et source fermÃ©e</a></li>
<li><a href="../fr488152/index.html">Un prototype de jeu multijoueur pour 15h?</a></li>
<li><a href="../fr488154/index.html">Nous prenons la place du chef de bureau. Algorithmes d'approvisionnement de base</a></li>
<li><a href="../fr488160/index.html">Windows Server 2019 contre InstantanÃ©s VMware avec mise au repos: une solution Ã©lÃ©gante au problÃ¨me</a></li>
<li><a href="../fr488162/index.html">Plus la note est Ã©levÃ©e, plus il y a d'argent et vice versa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>