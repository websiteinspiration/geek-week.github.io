<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕣 🎂 🤦🏼 プレイステーションドゥームポリゴン 🚩 🍆 🌵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ソニープレイステーション
  
 PlayStationのストーリーは、任天堂とソニーがSNESコンソール用のオプションのCD-ROMリーダーで共同作業を始めた1988年に始まりました。契約条件に基づいて、ソニーはこのプラットフォーム用のゲームを独自に開発し、スーパーディスク形式（任天堂による2つの...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>プレイステーションドゥームポリゴン</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494398/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98b/897/f95/98b897f955dbdf31ff724bbe1a1841f4.png" alt="画像"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソニープレイステーション</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f7/4aa/015/8f74aa015b0e95be13aac769990538a5.svg"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PlayStationのストーリーは、任天堂とソニーがSNESコンソール用のオプションのCD-ROMリーダーで共同作業を始めた1988年に始まりました。契約条件に基づいて、ソニーはこのプラットフォーム用のゲームを独自に開発し、スーパーディスク形式（任天堂による2つの珍しい譲歩）の制御を維持することができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロジェクトは、ソニーがPlay Stationでのコラボレーションを発表したCES '91展示会の前に開発されました。翌日、同じ展示会で任天堂はソニーのサプライズに、フィリップスとのパートナーシップ契約を締結したことを発表しました（はるかに有利な条件で）。忠実で公に屈辱を与えられたソニーはセガの取締役会に上訴しようとしましたが、すぐにその考えは拒否されました。 2013年のインタビューで、SEGAのCEOであるTom Kalinskeは、評議会の決定を思い出しました。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「これは愚かな考えです。ソニーは機器の開発方法を知りません。</font><font style="vertical-align: inherit;">彼らはソフトウェアの書き方を知りません。</font><font style="vertical-align: inherit;">なぜ私たちはそれらを台無しにするのですか？」</font><font style="vertical-align: inherit;">-セガ取締役会</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、それらは間違いではありませんでした、ソニーは実際にゲームを扱う経験がほとんどありませんでした。</font><font style="vertical-align: inherit;">彼女は一人の主導権を握った-朽木健を除いて、ほとんど彼らに興味を示さなかった。</font><font style="vertical-align: inherit;">ニンテンドーファミコンで娘が遊ぶのを見た瞬間から、ケンはこの市場に参入する必要があることをソニーに説得してきました。</font><font style="vertical-align: inherit;">ソニーの副大統領の推薦にもかかわらず、彼は任天堂のためにSNESで使用されるオーディオチップ（SPC700）を開発しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ほとんどのソニーの幹部はこれを危険な賭けだと考えていましたが、クタラギはソニーのCEOである大賀範夫氏の支持を見出しました。 1992年6月、ケンはゲームシステムを最初から作成することを許可されました。取締役会を落ち着かせるために、後に「プレイステーションの父」と呼ばれた彼は、財政的に独立した親会社であるソニーミュージックに異動し、最終的には「プレイステーション」となるもの（すでに名前にスペースがないもの）に取り組み始めました。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当初、開発者は、アーキテクチャがスプライト2Dグラフィックスとポリゴン3Dグラフィックスのどちらに焦点を当てるべきかを決定できませんでした。</font><font style="vertical-align: inherit;">しかし、1993年10月に日本のアーケードマシンでSegaによってリリースされたVirtua Fighterゲームの成功は、すべての疑いを打ち消しました。PSXは3Dパスをたどります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プロジェクトの頂点は2年後の1994年12月3日にソニー・コンピュータエンタテインメントが設立され、コンソールが日本でリリースされたときでした。</font><font style="vertical-align: inherit;">それはすぐに成功し、初日には10万台のデバイス、6か月後に200万台のデバイス、そして1億2千万台のデバイスの流通で販売されました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b1/727/175/6b1727175f25b80b4309c920c0e23115.webp"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソニーPSX（PS1、プレイステーション）。</font><font style="vertical-align: inherit;">写真：ウィキペディア</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建築</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/60b/97c/da3/60b97cda359e2e5c27a9028cc13aa22d.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マシンの心臓部は、MIPSが製造した32ビットRISC R3000Aプロセッサで、周波数は33.8688 MHz </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、2 MB DRAMと組み合わせています。このチップにはモーションデコーダー（MDEC）も搭載されており、30 fpsの周波数で320x240の解像度でビデオを再生できます。 MDECの隣には、ベクトルと行列に対して高速の固定小数点数学演算を実行するために使用されるGeometry Transform Engine（GTE）コプロセッサーがあります。システムは全体として、浮動小数点数を処理できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPUは、「コマンド」を使用して中央プロセッサによって制御される「ブラックボックス」です。 1 MBのVRAMがあり、CPUには使用できません。多くの点で、彼の作品は素晴らしいイミディエイトモードOpenGLの作品に似ています。頂点カラーを使用して「シェーディング」できるテクスチャポリゴンを描画します。グラフィックスパイプラインは固定されており、プログラムできません。 Zバッファ（深度バッファ）はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サウンドプロセッシングユニットサウンドプロセッシングユニット（SPU）は、GPUと同様にブラックボックスです。 24チャネルを処理でき、オーディオを（ADPCM形式で）保存するための512 KBのSRAMを備えており、CD-ROMオーディオトラックをそのオーディオチャネルとミキシングできます。略語SRAMは「スタティックRAM」ではなく「サウンドRAM」を意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ソニーのエンジニアの最も大胆な決定は、データキャリアの選択でした。</font><font style="vertical-align: inherit;">彼らはカートリッジではなく、デュアルスピードCD-ROMモジュールを選択しました。これにより、ゲームのコストが削減され、利用可能なボリュームが大幅に増加しました（最大約650 MB）。</font><font style="vertical-align: inherit;">不利な点は、転送速度が遅い（300 KB /秒）ことと、非常に長いヘッド取り付け時間（300 ms）であることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コンソールにブリッターはありません。</font><font style="vertical-align: inherit;">マシンのプログラミングモデルは、開発者が「裸の」アイアンに触れなかったことです。</font><font style="vertical-align: inherit;">ただし、CD / DRAMからVRAM / SRAMにデータを転送するためのDMAコントローラがあります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビデオシステム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオシステムが24ビットカラーをサポートしているという事実にもかかわらず、（Heart Of Darknessの背景を除いて）ほとんどのゲームがそれを使用していません</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実際には、ほとんどのゲームが1ビットマスクの16ビットカラーを使用したことは良心と言えます。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><img width="300" height="353" src="https://habrastorage.org/getpro/habr/post_images/5ff/164/4dd/5ff1644dd75bfbad9af9b1d61190ebe1.webp"><br>
</td>
<td><img width="300" height="353" src="https://habrastorage.org/getpro/habr/post_images/5ef/828/585/5ef828585512c3315eef5d72087f27b2.png"></td>
</tr>
</tbody></table></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピクセルあたり15ビットの深さを持つPSX色空間</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ビデオシステムのすばらしい機能は、VRAMの編成であり、開発者に完全に依存しています。 1 MB VRAMは、自由に使用できる1024 x 512 x 16ビットのアレイと見なされます。領域は予約、描画、出力システムへの転送に十分なだけなので、ダブルまたはトリプルバッファリングの適用は簡単な方法で実行されます。フレームバッファーの隣のVRAMにもテクスチャがあります。フレームバッファに書き込むために、テクスチャ付きの三角形/四角形をレンダリングするためのGPUコマンドが起動されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テクスチャにはさまざまな形式があります。 16ビットカラーと24ビットカラーの2つの直接ソースと、カラールックアップテーブル（CLUT）と呼ばれるパレットに基づくソースがあります。 8ビットと4ビットのCLUTがサポートされています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解像度に関しては、コンソールはNTSCおよびPALテレビ規格に限定されていました。</font><font style="vertical-align: inherit;">米国および日本市場の場合、開発者は256、320、384、512、または640ピクセルの水平解像度を選択できます。</font><font style="vertical-align: inherit;">垂直解像度は、240ピクセル（2番目のラスターラインをスキップする場合）、または交互の場合は480ピクセルでした。</font><font style="vertical-align: inherit;">どちらの垂直モードも60 Hzの周波数で動作しました。</font><font style="vertical-align: inherit;">NTSCとPALの唯一の違いは、垂直解像度の向上（240/480ではなく256/512）とリフレッシュレートの低下（50 Hz）です。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTSCモード（60Hz）PAL（50Hz）注</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
==================================================== ========</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0256 x 240256 x 256ノンインターレース</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1 320 x 240 320 x 256ノンインターレース</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2 512 x 240512 x 256ノンインターレース</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3640 x 240640 x 256ノンインターレース</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4 256 x 480 256 x 512インターリーブ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5 320 x 480 320 x 512インターリーブ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6 512 x 480 512 x 512インターリーブ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7 640 x 480 640 x 512インターリーブ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8 384 x 240 384 x 256ノンインターレース</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
9 384 x 480 384 x 512インターリーブ</font></font></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
水平解像度が384ピクセルのモード（8および9）に注意してください。これらは、IDから判断すると、後で追加されました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSX上のDOOM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DOOMは、ウィリアムズエンタテインメントによってid Softwareのサポートを得てPSXに移植されました。</font><font style="vertical-align: inherit;">エンジンを移植し、リソースを変更し、ゲームを変更してすべてが3.5 MBのRAMで「のみ」機能するようにするには</font><font style="vertical-align: inherit;">、5人のチームが1年弱</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[5] </font></font></sup><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[6]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">かかりました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「グラフィックが劣化しました。テクスチャのサイズ、スプライト、モンスター、武器も縮小されています。</font><font style="vertical-align: inherit;">[...]アニメーションフレームをカットすることがあります。 " </font><font style="vertical-align: inherit;">-ハリー・ティスリー</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終結果は1995年11月16日に発表されました。</font><font style="vertical-align: inherit;">これはゲームの最高のコンソールポートと見なされており、カラートップやCD品質の音楽により、一部の側面はPCバージョンをも上回っています。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「これまでのところ、これは最高のDOOMです！」</font><font style="vertical-align: inherit;">-ジョン・ロメロ</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">研究計画</font></font></h2><br>
<div style="text-align:center;"><img width="290" height="301" src="https://habrastorage.org/getpro/habr/post_images/9de/26d/ce5/9de26dce56307a9b22370aa22c0c93e9.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発の性質上、DOOM構造はI / Oに6つのサブシステムを使用するカーネルに基づいています。ほとんどの場合、私が最も興味深いと思った3つの部分、つまりCD-ROMベースのファイルシステム、SPUベースのオーディオ、およびGPUベースのビデオを調べました。これらはPSXアーキテクチャに固有であるためです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSXのDOOMソースコードは公開されていませんが、まったく問題ないことが判明しました。入手可能な情報で十分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のソースは素晴らしいPSY-Q SDKで、当時のPSX開発者が使用した「公式」ツールでした。それに関するPDFファイルのセットとして提示される多くのドキュメントがあります。このような豊富な情報は、PSXの開発者に対する親しみやすさについて聞いたすべての良さを裏付けるものです。 Psygnosisによって開発されたライブラリ（libcd、libdsなど）も十分に文書化されています。特に他のコンソールに関する情報がほぼ完全に欠如しているのと比較して、明確な説明を見るのはとても良かったです（そうです、私はSNESについて話しています）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう1つの情報源は、現在利用可能な多くの外部ツールです。 ISOBusterにより、CDの内容を開くことができました。 PSoundはLCDファイルのスキャンに役立ちました。 GPUおよびSPUコマンドをトレースするno $ PSXエミュレーターの驚くべき機能は、真のゴールドになりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、おそらくファンコミュニティからのPSXに対するDOOMの大きな愛に最も感銘を受けました。</font><font style="vertical-align: inherit;">ゲームの完全なリバースエンジニアリングが実行されました。</font><font style="vertical-align: inherit;">PSXDOOM-REは、PSY-Q SDKを使用して本格的なPSXゲームにコンパイルできるCコードベースであるため、特に際立っています。</font><font style="vertical-align: inherit;">機械語コードの各関数をCで書き直したものであるため、信頼性が高い。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDの驚くべき世界</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルシステムの実装を検討する前に、私はCDのすばらしい世界をよりよく理解するために短い小旅行をしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1980年から2000年までの20年間、このトピックを明らかにするいくつかの仕様のボリュームがリリースされました。これらを合わせて「レインボーブック」と呼ばれています。シリーズの最初の本「Red Book」には、オーディオコンパクトディスク（CD）の仕様が含まれています。 「イエローブック」は「レッドブック」を補完するものであり、CD-ROMおよびISO-9600のデータ仕様を追加します。 Orange Bookには、CD-DA、CD-R（書き込み可能）、CR-WR（書き換え可能）の仕様が追加されています。ホワイトブックは、Video-CD（VCD）に特化しています。グリーンブックは、CD-Interactive（CD-I）について語っています。 Blue Bookは、マルチメディアサポート用の拡張CD（ECD）データを提供します。 Scarlet Bookは、高品位オーディオを追加するスーパーオーディオ（SACD）専用です。 Purple Bookには倍密度CD（DDCD）仕様がリストされており、ディスク容量が650 MBから1.3 GBに増加しています。最終的に、Cyan Bookの詳細9660ファイルシステムの仕様</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[7]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/2f6/c60/52b2f6c605024780dcf141bcaf02a6a8.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rainbow Booksには、CDについて知っているすべてが含まれています。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
絶対に最低限として、PSX CDは通常2048バイトのデータを含むセクターで構成されていることを理解する必要があります。</font><font style="vertical-align: inherit;">セクターはトラック（データまたはサウンド）にグループ化されます。</font><font style="vertical-align: inherit;">トラックはセッションでグループ化されます。</font><font style="vertical-align: inherit;">データトラックの情報は、標準のISO-9660ファイルシステムを使用して配置できますが、ゲームにハードコードされたセクターアドレスを含めることもできます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOOMゲームCDの内部</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88b/62c/636/88b62c636572fe1c4617445525220c58.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ISOBusterを使用してCD-ROMの内部を見ると、DOOMが8つのトラックを含む1つのセッションで構成されていることがわかります</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[8]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのうちの7つは、ミッション間および最終シーンで再生されるCD品質のサウンドトラックです。</font><font style="vertical-align: inherit;">最後のトラック（＃7）は、デジタル化された悪魔の声も使用します。</font><font style="vertical-align: inherit;">トラック6はレイブパーティーから直接取られたように見えるため、特に注目に値します。</font><font style="vertical-align: inherit;">これはスーパーシークレットカード59「クラブドゥーム」（シークレットカードからしかアクセスできないシークレットカード）</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[9]で</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演奏されている音楽であることがわかりました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">彼女の狂気に感謝させてください。</font><font style="vertical-align: inherit;">始める前に、音量を確認してください。</font></font><br>
<br>
<div class="oembed"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://fabiensanglard.net/doom_psx/Track06.mp3</font></font></a></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのトラック（番号1）は、ゲームエンジンとほとんどのリソースを含むISO-9660です。</font><font style="vertical-align: inherit;">多くのDOOMポートを調査した後、私は単純にDOOM.EXEと呼ばれるエンジン、PSXDOOM.WADリソースファイル、そしておそらくマニフェストを期待していました。</font><font style="vertical-align: inherit;">私は非常に間違っていました。</font><font style="vertical-align: inherit;">トラック</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">287ファイル</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[10] </font></font></sup><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[11]が</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つかりました</font><font style="vertical-align: inherit;">。60.WAD、120 .IMG、無数の.LCDが含まれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データはレベルごとに並べられます（カードごとに5つのファイル）。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル名説明</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=================================================== =====</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAP01.WAD標準ジオメトリ（BSP /拒否/ ...）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPTEX01.IMG平面/壁のテクスチャ</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPSPR01.IMG THINGSによって作成されたすべてのスプライト</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
音楽/ MUSLEV1.LCD再生可能な音楽</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNDMAPS1 / MAP01.LCD THINGSによるすべてのサウンド</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが新しい方法で配置された理由を尋ねられたとき、Crash Bandicootの開発者Andy Gavinは、Ars Technicaへのインタビューで部分的に答えました。</font><font style="vertical-align: inherit;">[ </font><font style="vertical-align: inherit;">Habréの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ヘッドをCDの任意のポイントに移動するには、約1/3秒かかります。」</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘッドの位置決め速度が300ミリ秒に近かったため（PSY-Qドキュメント</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[12]で</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認されてい</font><sup><font style="vertical-align: inherit;">ます</font></sup><font style="vertical-align: inherit;">）、Williams Entertainmentの開発者は、すべてのリソースを1つのファイルに保存するDOOMエンジンの明確なアーキテクチャを保存できませんでした（たとえば、 DOOM.WAD）、リクエストに応じてダウンロードします。 PSXでは、これはひどいフレームレートにつながります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者たちは、CDに無限に見えるバイト数を投げることで問題を解決しました。レベルに必要なすべてのリソースは、マップのジオメトリ、テクスチャを含む5つのファイルに格納されていました。スプライト、効果音、音楽。これは非常に高価ですが、ゲームプロセス中にCDにアクセスする必要がなくなりました。</font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い事実：</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データトラック上のファイルのリストには、PSXDOOM.WAD（4 806 088バイト）と呼ばれるファイルがありますが、これはパレットといくつかのメニュー画像のロードにのみ使用されます。</font><font style="vertical-align: inherit;">おそらく開発プロセスでより積極的に使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
例として最初のマップを見てください。ダウンロードされたデータの総量は4 MBから900 KBに削減されました。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル名サイズ（バイト）  </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=====================================  	</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAP01.WAD 28 196</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPTEX01.IMG 90 744</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAPDIR0 / MAPSPR01.IMG 590 344</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
音楽/ MUSLEV1.LCD 61232</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SNDMAPS1 / MAP01.LCD 143 632</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
=====================================</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
合計：914,148</font></font></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リソースが914 KBを占めることを知っていると、未使用のDRAMがたくさん残っていると考えるかもしれません。ただし、実行時に変更されるスタックだけでなく、428 KBの実行可能ファイルにも適合する必要があることを覚えておく必要があります。実際、実行時に利用できるDRAMは約1 MBだけでした。</font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い事実：</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PSXDOOM-REのソースコードを調べているときに、CDから最大4回</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を読み取ろうとするP_LoadBlocks関数を発見</font><font style="vertical-align: inherit;">しました。これは、傷が付きやすいメディアで作業できることの1つです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CD-ROMヘッドのインストール時間がゲームのアーキテクチャにそれほど影響を与えるとは思いませんでした。 Crash Bandicootのような一部のゲームは、実行時にCDからデータをストリーミングするためのページシステムでゼロから作成されました。 DOOMの場合、エンジンはこれを行うことができませんでした。 CDはゲーム中には使用されませんが、特定の1曲（クラブDOOMレベルからのもの）を除きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
id Softwareの人たちは、CD-ROMが提供する容量と速度のトレードオフのファンではありませんでした。</font></font><br>
<br>
<blockquote>«    - .     ,       CD.  - ,     Crash 'n Burn —    ?    .  ,     CD      ,  3DO   .   -   CD- DOOM,        „  DOOM“.           ,     .       .<br>
<br>
           ,     CD.       ». —   (ATARI EXPLORER ONLINE, 22  1994 )</blockquote><br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い事実：</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DOOMゲーム内のイベントは、「ストレッチマーク」を使用してトリガーされました。</font><font style="vertical-align: inherit;">特別なプロパティを使用してラインを交差するときに、特別な関数が呼び出されました。</font><font style="vertical-align: inherit;">エンジンの「レガシー」バージョンでは、曲を再生できるプロパティはありませんでした。</font><font style="vertical-align: inherit;">Club DOOMをプレイするために、特別なlinedefアクションが作成されました（番号142）</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [14]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このレベルを作成するのにどれだけ多くの労力を要したかは驚くべきことです。</font><font style="vertical-align: inherit;">おそらく、開発者たちはレイブを楽しんでいたかったのでしょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失われたArchvileの事例</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/daf/8fb/db9/daf8fbdb944deb32c8b6f398615a16ef.webp"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲームエンジンのブラックブックの調査を行ったところ、デザイナーのハリーティーズリーのこのフレーズを完全には理解できませんでした。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Archvileには他のどのモンスターよりも2倍のアニメーションフレームがあり、PSXに詰め込むことはできませんでした。</font><font style="vertical-align: inherit;">彼の攻撃も復活効果も失われなかった。</font><font style="vertical-align: inherit;">彼は大きすぎました。」</font><font style="vertical-align: inherit;">-doomworld.comへのインタビューでのHarry Tisley（デザイナー）</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題はCDの650メガバイトの容量ではないことは明らかでしたが、制限要因が何であるかを理解できませんでした-DRAMまたはVRAM。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CD-ROMの制限を理解して、問題はスプライトをCDに保存することでも、DRAMからVRAMに転送することでもないことに気付きました。</font><font style="vertical-align: inherit;">問題は、DRAMにすべてを収めることです。</font></font><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い事実：</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ArchVileはPSXDOOM-REのソースコードから完全に削除されています。</font><font style="vertical-align: inherit;">彼の#DEFINEもコメントアウトされています</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[15]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_ZOMBIE  <span class="hljs-meta-string">"Zombieman"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_SHOTGUN  <span class="hljs-meta-string">"Shotgun Guy"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_HEAVY  <span class="hljs-meta-string">"Heavy Weapon Dude"</span></span><font></font>
...<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_HELL   <span class="hljs-meta-string">"Hell Knight"</span></span>
<span class="hljs-comment">//#define CC_ARCH "Arch-Vile"</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_SPIDER <span class="hljs-meta-string">"The Spider Mastermind"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_CYBER  <span class="hljs-meta-string">"The Cyberdemon"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CC_HERO   <span class="hljs-meta-string">"Our Hero"</span></span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPUプログラミング</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SPUチップは1つのフォーマット、つまりADPCMのみを理解します。</font><font style="vertical-align: inherit;">最大24チャンネル（CDオーディオトラックを含む）のミキシングが可能で、強力なオーディオ操作機能を備えています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この獣を飼いならすために、DOOM PSXはサウンドエンジニアのスコットパターソンが作成したlibWESSライブラリ（Williams Entertainment Sound System）を使用しています。</font><font style="vertical-align: inherit;">ライブラリは非常に強力で、MiDIシステムを再作成できます。このシステムでは、重いノートバンク（サウンドフォントと呼ばれます）は、ほとんどスペースを取らない楽譜によって制御されます。</font><font style="vertical-align: inherit;">また、ボリューム、トーン、ノートスピード、ADSR機能（アタック、ディケイ、サスティン、リリース）などのリアルタイムサウンド属性を操作することもできます。</font><font style="vertical-align: inherit;">ゲームプレイ中に再生されるすべての音楽は、libWESSを使用して生成されます。</font><font style="vertical-align: inherit;">一つの例外を除いて、あなたはそれを推測しました、これはCDトラック番号6から再生されるClub DOOMです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WESSは2つの独自のファイル形式を使用します。</font><font style="vertical-align: inherit;">これらは、楽譜とサウンドエフェクトを含む.WMDファイルと、PSX VAG形式（タイトルなし）であり、ADPCMサンプルを含む.LCDファイルです。</font><font style="vertical-align: inherit;">DOOMが起動すると、libWESSライブラリーはDOOMSND.WMDと呼ばれる小さな（55 KB）ファイルに保存されているすべてのサウンドエフェクト（SFX、89個）と楽譜（19個）をロードします。</font><font style="vertical-align: inherit;">彼女はまた、キャラクター、ドアなどによって公開された「常に使用される」サンプルをSRAMにロードします。</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">音楽/ DOOMSFX.LCD-&gt; SRAM</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
音楽/ DOOMSND.WMD-&gt; DRAM</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マップをロードした後、libWESSは、このカードの音楽で使用されるADPCMサンプルを含むMUSIC / MUSLEV％.LCD、およびこのレベルの敵に必要なADPCMサンプルを含むSNDMAPS％/ MAP %% LCDを開きます。</font><font style="vertical-align: inherit;">すべてのADPCMサンプルはSRAMに直接ロードされ、DRAMのスペースを占有しません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PSX上のDOOM：GPU</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオ生成の領域では、ウィリアムズエンターテインメントは2つの問題を解決する必要がありました：少量のVRAM（後でこれに戻ります）と視点を考慮した正しいテクスチャマッピングの欠如。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「アーロンサイラーと私は、ニンテンドー64（このゲームはかなり異なっていました）とプレイステーションのバージョンに取り組みました。</font><font style="vertical-align: inherit;">これらはベアメタルで書かれなかった最初のバージョンでした。SonyとNintendoの両方が開発者（少なくともサードパーティのもの）にAPIの記述を強制し、ハードウェアレジスタに関するドキュメントを提供しなかったためです。</font><font style="vertical-align: inherit;">当初、SGIカルチャーは特に開発者を制限していましたが、徐々に任天堂はそのグリップを緩めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プレイステーション用のバージョンの開発に関する面白い話：アーロンと私は異なるエンジンアーキテクチャから始めました。コンソールがハードウェアアクセラレーションを完全に提供していたため、世界の三角形をレンダリングしました。</font><font style="vertical-align: inherit;">N64の場合、サブピクセル精度（SGIの影響の結果）でパースペクティブが正しくレンダリングされたため、これは完全に機能しましたが、Playstationでは、整数座標を使用してアフィンテクスチャマッピングが実行されたため、大きな壁と床の三角形はすごく見えました。</font><font style="vertical-align: inherit;">-ジョン・カーマック（ゲームエンジンブラックブック：DOOM）</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それがどのように「ひどい」ように見えるかを理解するために、アフィンと予想通りに正しいテクスチャリングでレンダリングされた3つの壁を以下に示しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98b/897/f95/98b897f955dbdf31ff724bbe1a1841f4.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パースペクティブテクスチャリング</font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67f/f2a/602/67ff2a6028aea5b8a390b13ecdf23f5c.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affine（PSX）</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
まっすぐな壁でも問題ないことに注意してください。透視角度が大きくなると、歪みがより顕著になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DOOMをSEGA Saturnに移植するときに、同じ認識の問題がRage Software開発者に直面しました。</font></font><br>
<br>
<blockquote>«    ,        id Software.      ,      WAD       Saturn,      ,  3D-.   ,           ,          3D-   .     ,    PC.  ,   ,      :  SH2    ,   PC,  68000     .<br>
<br>
   ,      » —   ( DOOM  Saturn)   RetroGamer №134.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、PSX開発者はより多くの時間を持っていたため、GPUポリゴンレンダラーをラインレンダラーに変換することにより、将来予想される正しいテクスチャマッピングの問題を解決することができました。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「私は言った：すべてをバックアップする（そして、まだバージョン管理システムがなかった！）、私たちはゲームを完全に異なるものにするでしょう。」</font><font style="vertical-align: inherit;">PCのアセンブラーコードと同じように、1ピクセル幅の列または行を表す三角形をレンダリングする機器を使用しました。</font><font style="vertical-align: inherit;">プレイステーションでのより一般的な解決策は、2つの軸に沿ったジオメトリのテッセレーションであることがわかりましたが、私は、ドゥームが当時のプレイステーションのほとんどのゲームよりも「けいれん的」に見えないことが本当に好きでした。」-John Carmack（ゲームエンジンブラックブック：DOOM）</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSXDOOM-REプロジェクト</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[16]の</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">おかげで、</font><font style="vertical-align: inherit;">それがどのように実装されたかを知ることができます。</font><font style="vertical-align: inherit;">レンダリングパイプラインは完全に書き直され、2つのステージに分かれています。</font><font style="vertical-align: inherit;">これについては以下で詳しく説明しますが、R_Render_Wallレンダリング関数が、幅が1ピクセルの明確な描画コマンドを送信していることがわかります。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">R_Render_Wall</span><span class="hljs-params">(...)</span> </span>{<font></font>
  .<font></font>
  <span class="hljs-keyword">int</span> x1 = ... ; <span class="hljs-comment">// Left end of wall.</span>
  <span class="hljs-keyword">int</span> x2 = ... ; <span class="hljs-comment">// Right end of wall.</span><font></font>
  .<font></font>
  <span class="hljs-keyword">while</span>(x1 &lt; x2) {<font></font>
    .<font></font>
    setRGB0(wallpoly);<font></font>
<font></font>
    setXY3(wallpoly,<font></font>
      x1    , ypos1 - <span class="hljs-number">1</span>,<font></font>
      x1 + <span class="hljs-number">1</span>, ypos2 + <span class="hljs-number">1</span>,<font></font>
      x1    , ypos2 + <span class="hljs-number">1</span>);		<font></font>
<font></font>
    setUV3(wallpoly,<font></font>
         upos, v0,<font></font>
         upos, v1,<font></font>
         upos, v1);  <font></font>
    .<font></font>
    x1 += <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壁は1ピクセル幅の列でレンダリングされます。</font><font style="vertical-align: inherit;">OpenGLのイミディエイトモードに似たAPIを確認してください。</font></font></i><br>
<br>
<b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">興味深い事実：</font></font></u></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソニーのハードウェア設計者はMIPSプロセッサーのiキャッシュを保持しましたが、dキャッシュを無効にして1K高速スクラッチパッドに変換しました。</font><font style="vertical-align: inherit;">壁/平面のレンダリング手順は、このスクラッチパッドを広範囲に使用しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VRAM GPU管理</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRAM制御がどのように実行されるかを知るために、私は奇妙な方法を選択しました。リアルタイムVRAMエミュレーター$ $ PSXを表示する機能を使用しました。</font><font style="vertical-align: inherit;">この関数は、1024 x 512 x 16ビットのピクセル配列全体を表示します（ただし、歪んだ形式です）。</font><font style="vertical-align: inherit;">表示機能は、各フレームで中央プロセッサによって送信されたGPU命令のリスト全体も表示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/106/6e1/2c4/1066e12c443fa07e91e8f4793afe655d.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いいえ$ PSX-神様から、GPUの内部を確認できるエミュレータが送られてきました。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRAMの最初のフレームを注意深く検討すると、多くを学ぶことができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfd/e98/57f/dfde9857f541f946c946445fc5feb1ea.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ PSXなしで表示されたゲームの最初のフレーム。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も明白なのは、左上隅の256 x 240 x 16ビットの2つの領域であり、これらはフレームバッファーです（したがって、ゲームはダブルバッファーを使用します）。</font><font style="vertical-align: inherit;">256x240がPSXで可能な最低解像度であることは注目に値します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームバッファーの下には、CLUTパレットというカラフルなピクセルのセットがあります。</font><font style="vertical-align: inherit;">赤の色合いに注意してください。これは、プレーヤーがダメージを受けたときに画面が赤に変わったときに、事前に計算されたパレットが使用されることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
右上隅に、水平方向に奇妙に圧縮され、「間違った」色のテクスチャが表示されます。</font><font style="vertical-align: inherit;">これは、テクスチャが上記のCLUTの8ビットインデックスを使用しているために発生しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS1のDOOMでの火災についてもう一度話しましょう</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2018年、私は火の効果がどのように実現されたかを研究しました</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[17]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [ </font><font style="vertical-align: inherit;">Habréの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻訳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]。</font><font style="vertical-align: inherit;">GPUコマンドを探索しているときに再び彼に戻ってきてよかったです。</font><font style="vertical-align: inherit;">$ PSXが各コマンドのターゲット領域を赤でマークしていないことに注意してください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ1：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームがRAMで更新され、VRAMにロードされます（CpuToVramコマンド）。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d61/e16/8a1/d61e168a1b238160665e78c437c7b2d5.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ2：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フレームテクスチャが画面に沿って4回描画されます（QuadTexコマンド）。</font><font style="vertical-align: inherit;">フレームテクスチャの幅は32テクセルですが、GPUを使用して64ピクセルの幅で描画します。</font><font style="vertical-align: inherit;">ここでは双一次フィルタリングはできません。最も近いテクセルがサンプリングされます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1a/08b/a2c/f1a08ba2c51a31bd57bcf9b45827bb23.png"></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステージ3：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終DOOMプレート（QuadTexコマンド）がすべての上に描画されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7de/30e/f5b/7de30ef5b64d978cf2f632cfe3ac82b4.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フルフレーム、チームごと</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレームで送信されたコマンドを調査すると、エンジンはPCバージョンとはまったく異なることがわかりました。その中で、世界は短い距離から遠くに回っていました。最初に、すべての壁がレンダリングされます。 2番目のパスでは、それらの間に垂直方向のギャップが充填されます（飛行機）（空を含む）。 3番目（最後）のパッセージでは、スプライトは最も遠いところからレンダリングされます。これはすべて、ゼロの再描画ピクセルで行われました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PSXでは、レンダリングはもう少し失礼です。すべてが1つのパスでレンダリングされ、遠くから開始されます。 PCが壁の間の隙間を埋めるために使用したvisplaneシステムはここにはありません。 「葉」と呼ばれる新しいコンセプトのおかげで、平面と壁はサブセクターの順序でレンダリングされます。 「真の3D」でのこのような操作は、GPEマトリックス投影関数のアクティブな使用により可能になりました。スプライトは、オーバーラップや切り捨てチェックなしで壁/平面と同時にレンダリングされるため、少量の再描画が発生します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">R_RenderPlayerView</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{<font></font>
  R_BSP();         <span class="hljs-comment">// Phase 1</span>
  R_RenderSKY();   <span class="hljs-comment">// Phase 2</span>
  <span class="hljs-keyword">for</span> (all subsectors from phase <span class="hljs-number">1</span>) {<font></font>
    R_RenderAll(subsector)<font></font>
  }<font></font>
  R_Render_Hud_Weapons();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初にCopyRectRawを使用してレンダリングされた空から始めて、各ステップを詳しく見てみましょう。 $ PSXはフレームが完了した時点でVRAMを表示しませんが、コマンドの履歴をさかのぼることができます。空のピクセルが見えるのは、$ PSXが1ピクセル幅の列でこのハックを感知するのに問題がないためです（ePSXeなどの他のエミュレーターはこれ以上うまく処理できません</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[18]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）が、これらのピクセルはすべて書き換えられます。空のテクスチャの下で、ドアの鍵のすべてのマーカーがアトラスに収集されていることに注意してください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1d/2ae/868/d1d2ae868238f0282a8495a4e2dd6afd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、BSPが遠から近へと順にトラバースされます。各サブセクターでは、すべての壁/平面/スプライトがレンダリングされます。 DOOM BSPに精通している場合は、doombspコンパイラーがサブセクターの確実なセグメントのみを保持していることを覚えておいてください。プレーンを確実にレンダリングするために、PSXバージョンに「葉」の新しいコンセプトが追加されました。このバージョンでは、BPS分離セグメント（非表示）が保存されていました。これらのセグメントは、平面の境界を生成するためにスクリーン空間に投影されます。これは、たとえば、よく知られている「スラッグの痕跡」から画面スペースやバグのハックを取り除くことができるため、はるかに「クリーン」なアプローチです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/558/cde/f1d/558cdef1d6ef68f1272b1e260333fd3b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のVRAMショットでは、上で見た壁と同じサブセクターの平面が1ピクセルの高さの三角形としてレンダリングされます。</font><font style="vertical-align: inherit;">また、壁/平面のテクスチャにも注意してください。すべて同じサイズです。</font><font style="vertical-align: inherit;">この機能により、VRAMテクスチャの選択が簡略化され、断片化が回避されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be6/092/6ce/be60926ce5304a264da51ab38a3e2c6a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは今でも同じサブセクターにいます。</font><font style="vertical-align: inherit;">これでスプライトは四角形（Quad）としてレンダリングされます。</font><font style="vertical-align: inherit;">これらのスプライトには、敵、シェル、部分的に透明な壁が含まれます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/708/e06/cf6/708e06cf66400378617db2484694433c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
楽しみのために、プラズマシェルを表示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb4/c5a/ebc/fb4c5aebca255019caa7d8c31140c136.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レンダリングコマンドの終わりに近づいています。</font><font style="vertical-align: inherit;">ここでは、長方形を混合することにより、武器がレンダリングされます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac2/061/da0/ac2061da0769c7e614503818d5e59755.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のステップ：インターフェイスレンダリング（HUD）。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a34/be3/7e9/a34be37e93d0991d27b5d4fd8a3356c4.png"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VRAMオーバーフロー！</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/853/a77/9cc/853a779ccdc0280234e53ab3b6aea59a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPUでの作業は、VRAMにスペースを割り当てるための練習でした。フレームバッファー、CLUT、静的コンテンツ（インターフェイス）、さらには壁/平面の場合、すべて同じサイズであるため、タスクは初歩的です。しかし、スプライトを使用すると、状況は少し複雑になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スプライトはサイズが異なるため、断片化が発生します。さらに、テクスチャは画面の広い領域をカバーして繰り返すことができ、スプライトは多くの場合一意であり、予測できないほど多数のスプライトが各フレームで必要になる場合があります。最悪の場合、フレームにはVRAMに配置できない特定の数のスプライトが必要です。これはテクスチャキャッシュオーバーフローと呼ばれ、この問題は解決できません。これが発生すると、ゲームがクラッシュし、不可解なエラーメッセージが表示されます</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[19]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たちの何人かに不吉な「もう飛行機はありません」を思い出させる。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fb/4a4/f9f/1fb4a4f9fecf0b6420b198b08ff2f84d.png"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同時に表示されるスプライトが多いほど、使用されるVRAMも多くなります。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PALとNTSCの違い</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビデオの章の終わりに、NTSCがPALに変換される方法を確認することにしました。</font><font style="vertical-align: inherit;">残念ながら、他の多くのゲームと同様に、DOOM PSXは垂直解像度の増加を考慮していません。</font><font style="vertical-align: inherit;">ヨーロッパのPS1でDOOMを再生すると、黒い境界線が目立つ垂直方向に圧縮された画像が表示されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
VRAMの原理を知った後、開発者を責めることは困難です。</font><font style="vertical-align: inherit;">NTSCのVRAMスキームをよく見ると、フレームバッファーの垂直解像度を上げると、データ割り当て構造全体に違反することに気付くでしょう。</font><font style="vertical-align: inherit;">その下にテクスチャを保存することは不可能です。</font><font style="vertical-align: inherit;">または、CLUTを別の場所に移動する必要があります。</font><font style="vertical-align: inherit;">コストが高すぎて利益が比較的少なく、黒い境界線がゲームを妨害したという事実にもかかわらず、私はそれが価値がなかったと同意します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">謝辞</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
エリックヴァスケス（PSXDOOM-REの作者）、サミュエルビジャレアル（PSXDOOM-REの開発者の1人）、ダンレスリー（PlayStation 1のゲームのプロの開発者）に、知識を惜しみなく教えてくれてありがとう。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考資料</font></font></b><div class="spoiler_text">[ 1] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">The Polygons Of Another World</a><br>
[ 2] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Game Engine Black Book: DOOM</a><br>
[ 3] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Everything You Have Always Wanted to Know about the Playstation</a><br>
[ 4] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">@gmontoir — 'Heart of Darkness uses MDEC frames as background bitmaps'.</a><br>
[ 5] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Five years of DOOM, part 1</a><br>
[ 6] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Five years of DOOM, part 2</a><br>
[ 7] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=https://archive.vn/20121209124333/" rel="nofollow">The Great Books</a><br>
[ 8] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">DOOM PSX tracks</a><br>
[ 9] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">MAP59: Club Doom (PlayStation Doom)</a><br>
[10] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PSXDOOM/tree.txt</a><br>
[11] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PSXDOOM files</a><br>
[12] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PSY-Q SDK, CD Hardware</a><br>
[13] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">P_LoadBlocks</a><br>
[14] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">Linedef #142 plays Club Doom</a><br>
[15] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">//#define CC_ARCH</a><br>
[16] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">PSXDOOM-RE Source code</a><br>
[17] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">How DOOM fire was done</a><br>
[18] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">DOOM on ePSXe</a><br>
[19] : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow">I_Error('Texture Cache Overflow');</a></div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja494384/index.html">機能調査</a></li>
<li><a href="../ja494388/index.html">Instagramのエクスプレスマスク</a></li>
<li><a href="../ja494390/index.html">3Dプリンティングにより、自動調整コストを半分に削減</a></li>
<li><a href="../ja494394/index.html">Xia Peysu：中国のコンピューターサイエンスの母</a></li>
<li><a href="../ja494396/index.html">ウェルカムマット-今ではロシア語でも</a></li>
<li><a href="../ja494400/index.html">コロナウイルスとインターネット</a></li>
<li><a href="../ja494402/index.html">戦略的成熟の段階</a></li>
<li><a href="../ja494406/index.html">教師なしの機械学習。本からの抜粋</a></li>
<li><a href="../ja494408/index.html">青果店で果物を偽造、復元、チェックする方法。本からの抜粋</a></li>
<li><a href="../ja494410/index.html">主流になる前に：非接触型配信を開始する方法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>