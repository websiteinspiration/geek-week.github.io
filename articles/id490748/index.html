<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—¼ ğŸ‘©ğŸ¼ ğŸ Tugas untuk pengembang, atau cara kami memindai pemindai tangan tanpa vendor ğŸ¤›ğŸ¼ ğŸš¶ğŸ» ğŸš±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. 
 
 Kami, Victor Antipov dan Ilya Aleshin, hari ini akan berbicara tentang pengalaman kami dengan perangkat USB melalui Python PyUSB da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Tugas untuk pengembang, atau cara kami memindai pemindai tangan tanpa vendor</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/490748/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Halo semuanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami, Victor Antipov dan Ilya Aleshin, hari ini akan berbicara tentang pengalaman kami dengan perangkat USB melalui Python PyUSB dan sedikit tentang reverse engineering.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j4/ux/va/j4uxvafzrna4qe-37a6miqsyg1u.jpeg"><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada tahun 2019, Keputusan Pemerintah Federasi Rusia No. 224 â€œAtas persetujuan aturan pelabelan produk tembakau dengan cara identifikasi dan spesifikasi memperkenalkan sistem informasi negara untuk memantau sirkulasi barang yang dikenakan pelabelan wajib dengan cara identifikasi dalam kaitannya dengan produk tembakauâ€ mulai berlaku. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dokumen tersebut menjelaskan bahwa mulai 1 Juli 2019, produsen diwajibkan untuk memberi label pada setiap bungkus tembakau. Dan distributor langsung harus menerima produk-produk ini dengan desain dokumen transfer universal (UPD). Toko, pada gilirannya, perlu mendaftarkan penjualan produk berlabel melalui mesin kasir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga, mulai 1 Juli 2020, produk tembakau yang tidak ditandai dilarang. Ini berarti bahwa semua bungkus rokok harus diberi label dengan barcode Datamatrix khusus. Dan - poin penting - ternyata Datamatrix tidak akan menjadi biasa, tetapi terbalik. Artinya, bukan kode hitam di atas putih, tetapi sebaliknya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menguji pemindai kami, dan ternyata sebagian besar perlu direfleksikan / dilatih ulang, jika tidak mereka tidak dapat bekerja secara normal dengan barcode ini. Pergantian peristiwa ini membuat kami sakit kepala parah, karena perusahaan kami memiliki banyak toko yang tersebar di wilayah yang luas. Beberapa puluh ribu meja kas - dan waktu yang sangat sedikit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang harus dilakukan? </font><font style="vertical-align: inherit;">Ada dua opsi. </font><font style="vertical-align: inherit;">Pertama: para insinyur di fasilitas secara manual merefleksikan dan menyesuaikan pemindai. </font><font style="vertical-align: inherit;">Kedua: kami bekerja dari jarak jauh dan, lebih disukai, kami mencakup banyak pemindai sekaligus dalam satu iterasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi pertama, jelas, tidak cocok untuk kita: kita harus mengeluarkan uang untuk kunjungan lapangan para insinyur, dan sulit untuk mengendalikan dan mengoordinasikan proses dalam kasus ini. </font><font style="vertical-align: inherit;">Tetapi yang paling penting adalah bahwa orang akan bekerja, yaitu, berpotensi kita akan mendapatkan banyak kesalahan dan, kemungkinan besar, tidak akan sesuai dengan tenggat waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opsi kedua baik untuk semua orang, jika bukan untuk satu tetapi. </font><font style="vertical-align: inherit;">Beberapa vendor tidak memiliki alat flashing jarak jauh yang kami butuhkan untuk semua sistem operasi yang diperlukan. </font><font style="vertical-align: inherit;">Dan karena tenggat waktu hampir habis, saya harus berpikir dengan kepala sendiri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kami akan menjelaskan bagaimana kami mengembangkan alat untuk pemindai genggam untuk OS Debian 9.x (kami memiliki semua box office Debian).</font></font><br>
<br>
<h3> :   </h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kata Victor Antipov.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Utilitas resmi yang disediakan oleh vendor bekerja di bawah Windows, dan hanya dengan IE. Utilitas dapat menginstal dan mengkonfigurasi pemindai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena sistem targetnya adalah Debian, kami memasang server usb-redirector di server Debian dan klien usb-redirector di Windows. Menggunakan utilitas usb-redirector, pemindai diteruskan dari mesin Linux ke mesin Windows. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilitas dari vendor Windows melihat pemindai dan bahkan mem-flashnya secara normal. Jadi, kesimpulan pertama dibuat: tidak ada yang tergantung pada OS, masalahnya ada di protokol flashing. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
BAIK. Sebuah flashing diluncurkan pada mesin Windows, dan dump dihapus pada mesin Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mereka memasukkan dump ke WireShark dan ... sedih (saya akan menghilangkan bagian dari detail dump, mereka tidak tertarik). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang ditunjukkan dump kepada kami:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5c/ut/sa/5cutsausebu86kbucq6rfksz7wu.png"><br>
<br>
<img src="https://habrastorage.org/webt/9z/ex/jo/9zexjowdglq6cjc88ln5r6tlkcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alamat 0000-0030, dinilai oleh Wireshark, adalah informasi layanan USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami tertarik pada bagian 0040-0070. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang jelas dari satu bingkai transmisi, kecuali untuk karakter MOCFT. Simbol-simbol ini ternyata menjadi simbol dari file firmware, serta simbol-simbol lainnya hingga akhir frame (file firmware disorot): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yb/ls/mf/yblsmf2htqk4n-lsa3u702yy5vm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang dimaksud dengan simbol fd 3e 02 01 fe, saya pribadi, seperti Ilya, tidak tahu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya melihat bingkai berikutnya (informasi layanan dihapus di sini, file firmware disorot): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/sr/ut/r3srutakf1ioytxspf1zurv9pww.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang menjadi jelas? Bahwa dua byte pertama adalah semacam konstanta. Semua blok berikutnya mengkonfirmasi ini, tetapi sebelum akhir blok transmisi:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j7/t6/ux/j7t6uxe8auhqxaxp5azeolv5jwm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bingkai ini juga masuk ke dalam keadaan pingsan, karena konstanta berubah (disorot) dan, anehnya, ada bagian dari file. Ukuran byte yang ditransmisikan dari file menunjukkan bahwa 1024 byte ditransfer. Apa artinya byte yang tersisa - saya tidak tahu lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, seperti nama panggilan BBS lama, saya merevisi protokol transfer standar. 1024 byte, tidak ada protokol yang diteruskan. Dia mulai mempelajari materiil dan menemukan protokol 1K Xmodem. Itu memungkinkan untuk mengirimkan 1024, tetapi dengan nuansa: pada awalnya hanya 128, dan hanya tanpa adanya kesalahan protokol meningkatkan jumlah byte yang dikirim. Saya segera memiliki transmisi 1024 byte. Saya memutuskan untuk mempelajari protokol transmisi, dan khususnya X-modem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada dua variasi modem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, format paket XMODEM dengan dukungan CRC8 (XMODEM asli):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wu/dq/7w/wudq7w7yg59duxo2ok3rcng5bga.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kedua, format paket XMODEM dengan dukungan CRC16 (XmodemCRC): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i2/cz/j3/i2czj3nd212vhlbms9uqrysd5xa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kelihatannya mirip, dengan pengecualian SOH, nomor paket dan CRC dan panjang paket. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya melihat awal blok transmisi kedua (dan sekali lagi melihat file firmware, tetapi dengan indentasi 1024 bytes):</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5v/lk/nb/5vlknbhbecr2d3d7uigb19dh_cg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya melihat tajuk akrab fd 3e 02, tetapi dua byte berikutnya sudah berubah: itu 01 fe, dan itu menjadi 02 fd. Kemudian saya perhatikan bahwa blok kedua sekarang bernomor 02 dan dengan demikian dipahami: di depan saya adalah penomoran blok transmisi. Transmisi 1024 pertama adalah 01, 02 kedua, 03 ketiga dan seterusnya (tetapi dalam hex, tentu saja). Tapi apa artinya perubahan dari fe ke fd? Mata melihat penurunan 1, otak mengingatkan bahwa programmer menghitung dari 0, bukan dari 1. Tapi mengapa blok pertama 1, bukan 0? Saya tidak menemukan jawaban untuk pertanyaan ini. Tapi saya mengerti bagaimana blok kedua dipertimbangkan. Blok kedua tidak lebih dari FF - (minus) jumlah blok pertama. Dengan demikian, blok kedua ditetapkan sebagai = 02 (FF-02) = 02 FD. Pembacaan berikutnya dari dump mengkonfirmasi firasat saya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian gambar program berikut mulai muncul: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awal program</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 3e 02 - Mulai </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01 FE - penghitung transmisi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transmisi (34 blok, 1024 byte ditransmisikan) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 3e 1024 byte data (dibagi menjadi blok 30 byte). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Akhir transmisi </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 25 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sisa data untuk disejajarkan dengan 1024 byte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti apakah bingkai ujung transfer blok: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/ee/t9/dmeet9sttaokhdirciuxag4p9y4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fd 25 - sinyal ke akhir transfer blok. Berikutnya 2f 52 - sisa-sisa file hingga 1024 byte. 2f 52, dilihat dari protokol, adalah checksum CRC 16-bit.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berdasarkan memori lama, saya membuat program dalam C yang menarik 1024 byte dari file dan membaca CRC 16-bit. </font><font style="vertical-align: inherit;">Peluncuran program menunjukkan bahwa ini bukan CRC 16-bit. </font><font style="vertical-align: inherit;">Sekali lagi pingsan - selama sekitar tiga hari. </font><font style="vertical-align: inherit;">Selama ini saya mencoba memahami apa jadinya jika bukan checksum. </font><font style="vertical-align: inherit;">Mempelajari situs berbahasa Inggris, saya menemukan bahwa X-modem menggunakan perhitungan checksum sendiri - CRC-CCITT (XModem). </font><font style="vertical-align: inherit;">Saya tidak menemukan implementasi dalam C untuk perhitungan ini, tetapi saya menemukan situs yang membaca checksum ini secara online. </font><font style="vertical-align: inherit;">Setelah ditransfer ke halaman web 1024 byte dari file saya, situs menunjukkan kepada saya sebuah checksum yang sepenuhnya bertepatan dengan checksum dari file tersebut.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hore! </font><font style="vertical-align: inherit;">Teka-teki terakhir terpecahkan, sekarang Anda harus membuat firmware sendiri. </font><font style="vertical-align: inherit;">Kemudian saya mentransfer pengetahuan saya (dan mereka hanya tinggal di kepala saya) ke Ilya, yang akrab dengan alat yang kuat - Python.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembuatan program</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diceritakan oleh Ilya Aleshin. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menerima instruksi yang sesuai, saya sangat â€œsenangâ€. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di mana untuk memulai? </font><font style="vertical-align: inherit;">Benar, dari awal. </font><font style="vertical-align: inherit;">ïŠ Dari dumping dari port USB. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan USB-pcap </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://desowin.org/usbpcap/tour.html</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Pilih port tempat perangkat terhubung dan file tempat kami akan menyimpan dump. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/ax/xp/gaaxxp3qdqajous7didfd7gwkg8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menghubungkan pemindai ke mesin tempat perangkat lunak EZConfigScanning asli untuk Windows diinstal. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ol/oo/le/olooleeirgestw3q0gzvhqvzr58.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di dalamnya kita menemukan titik mengirim perintah ke perangkat. </font><font style="vertical-align: inherit;">Tapi bagaimana dengan tim? </font><font style="vertical-align: inherit;">Di mana mendapatkannya? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika program dimulai, peralatan diinterogasi secara otomatis (kita akan melihatnya nanti). </font><font style="vertical-align: inherit;">Dan ada barcode pelatihan dari dokumen peralatan resmi. </font><font style="vertical-align: inherit;">DEFALT. </font><font style="vertical-align: inherit;">Ini tim kami. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/8v/dv/gf/8vdvgfiuthogftttgzdsxym22_4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Data yang diperlukan diterima. </font><font style="vertical-align: inherit;">Buka dump.pcap melalui wireshark.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blokir saat startup EZConfigScanning. Poin merah adalah tempat yang harus diperhatikan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/ju/0x/wpju0xwxz9_hgex0jnnyttjxqpa.png"><br>
<br>
<img src="https://habrastorage.org/webt/nw/6s/so/nw6ssotdpggn37qvn9kvayxhxde.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melihat semua ini untuk pertama kalinya, saya kehilangan hati. Tempat menggali lebih jauh tidak jelas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sedikit brainstorming dan-dan-dan ... Aha! Di sebuah dump, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keluar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adalah </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keluar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cari Google apa itu URB_INTERRUPT. Mengetahui bahwa ini adalah metode transfer data. Dan ada 4 metode seperti: kontrol, interupsi, isochronous, bulk. Anda dapat membacanya secara terpisah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan alamat titik akhir di antarmuka perangkat USB dapat diperoleh baik melalui perintah â€œlsusb â€“vâ€, atau dengan menggunakan pyusb. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda perlu menemukan semua perangkat dengan VID ini. Anda dapat mencari secara spesifik dengan VID: PID. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/xp/i_/fnxpi_m69b43p6yzpeoh3atps0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini terlihat seperti ini:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/g0/h4/td/g0h4tdpscytduyzmj4xqe31r5s4.png"><br>
<br>
<img src="https://habrastorage.org/webt/d4/wf/5k/d4wf5k6asqr5nvofve-ntd5sm4g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami memiliki informasi yang diperlukan: perintah P_INFO. atau DEFALT, alamat tempat menulis perintah titik akhir = 03 dan di mana mendapatkan jawaban titik akhir = 86. Tetap hanya menerjemahkan perintah dalam hex. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/io/wf/ui/iowfuid0hhvl6q6zpb9kfds3tny.png"><br>
<br>
<img src="https://habrastorage.org/webt/0p/gr/2j/0pgr2jw1u6tj5vqetitjg3g6chw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kita sudah menemukan perangkat, lepaskan dari kernel ... </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ji/xy/84/jixy849fy7l81g9tenjxpf7uymo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... dan tulis ke titik akhir dengan alamat 0x03, </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/v0/nt/qxv0nttjmnddvekfmbnfq9vebfi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... dan kemudian baca respons dari titik akhir dengan alamat 0x86. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kj/xn/e2/kjxne2x9ab6spmxnk2ac3bnroc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jawaban terstruktur:</font></font><br>
<br>
<pre><code class="plaintext hljs">P_INFOfmt: 1<font></font>
mode: app<font></font>
app-present: 1<font></font>
boot-present: 1<font></font>
hw-sn: 18072B44CA<font></font>
hw-rev: 0x20<font></font>
cbl: 4<font></font>
app-sw-rev: CP000116BBA<font></font>
boot-sw-rev: CP000014BAD<font></font>
flash: 3<font></font>
app-m_name: Voyager 1450g<font></font>
boot-m_name: Voyager 1450g<font></font>
app-p_name: 1450g<font></font>
boot-p_name: 1450g<font></font>
boot-time: 16:56:02<font></font>
boot-date: Oct 16 2014<font></font>
app-time: 08:49:30<font></font>
app-date: Mar 25 2019<font></font>
app-compat: 289<font></font>
boot-compat: 288<font></font>
csum: 0x6986</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melihat data ini di dump.pcap. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/cr/z5/2y/crz52y_j0alhcohhokmry0bx7t8.png"><br>
<br>
<img src="https://habrastorage.org/webt/-s/np/cv/-snpcv4opok9jdsrj8thkshno_4.png"><br>
<br>
<img src="https://habrastorage.org/webt/qj/dq/zl/qjdqzlcwogon9yts12p5awr32ha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baik! Kami menerjemahkan barcode sistem ke hex. Semuanya, fungsionalitas pelatihan siap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang harus dilakukan dengan firmware? Tampaknya semuanya sama, tetapi ada nuansa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menghapus seluruh proses flashing, kami secara kasar memahami apa yang sedang kami hadapi. Berikut adalah artikel tentang XMODEM yang benar-benar membantu untuk memahami bagaimana komunikasi ini terjadi, meskipun secara umum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://microsin.net/adminstuff/others/xmodem-protocol-overview.html Saya</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sarankan membacanya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Melihat di dump, Anda dapat melihat bahwa ukuran frame adalah 1024, dan ukuran data-URB adalah 64. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wi/o6/uj/wio6ujyvlj_bnltlngxf24k9evk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, 1024/64, kami mendapatkan 16 baris dalam satu blok, membaca file firmware dengan 1 karakter dan membentuk sebuah blok. Melengkapi 1 baris dalam satu blok dengan karakter khusus fd3e02 + nomor blok.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
14 baris berikutnya dilengkapi dengan fd25 +, menggunakan XMODEM.calc_crc () kami menghitung checksum dari seluruh blok (butuh banyak waktu untuk memahami bahwa "FF - 1" adalah CSUM) dan baris 16 terakhir ditambah dengan fd3e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampaknya semuanya, baca file firmware, tekan blok, lepaskan pemindai dari kernel dan kirim ke perangkat. </font><font style="vertical-align: inherit;">Tapi tidak sesederhana itu. </font><font style="vertical-align: inherit;">Pemindai harus dimasukkan ke mode firmware dengan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mengirimkannya NEWAPP = '\\ xfd \\ x0a \\ x16 \\ x4e \\ x2c \\ x4e \\ x45 \\ x57 \\ x41 \\ x50 \\ x50 \\ x0d'. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari mana datangnya perintah ini ?? </font><font style="vertical-align: inherit;">Dari tempat sampah. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/au/sd/nd/ausdnd16ikur6ajzdiyk9-ntklw.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetapi kami tidak dapat mengirim seluruh blok ke pemindai karena pembatasan 64: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/db/k6/qg/dbk6qgrapgsxiwdo9jyxqd0svwu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, pemindai dalam mode flashing NEWAPP juga tidak menerima hex. </font><font style="vertical-align: inherit;">Oleh karena itu perlu menerjemahkan setiap baris bytes_array</font></font><br>
<br>
<pre><code class="plaintext hljs">[253, 10, 22, 78, 44, 78, 69, 87, 65, 80, 80, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sudah mengirimkan data ini ke pemindai. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mendapatkan jawabannya:</font></font><br>
<br>
<pre><code class="plaintext hljs">[2, 1, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memeriksa artikel tentang XMODEM, menjadi jelas: data telah diterima. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/po/fd/gj/pofdgjvcgns7oxdeonuldkqbptg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah semua blok ditransfer, kami menyelesaikan transfer END_TRANSFER = '\ xfd \ x01 \ x04'. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya, karena blok ini tidak membawa informasi apa pun untuk orang awam, kami akan membuat firmware dalam mode tersembunyi secara default. </font><font style="vertical-align: inherit;">Dan untuk berjaga-jaga, melalui tqdm kami akan mengatur progress bar. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/da/18/g1/da18g1axnll2zps9qpx2s7opkha.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya, sisanya kecil. </font><font style="vertical-align: inherit;">Tetap hanya untuk membungkus solusi dalam skrip untuk replikasi massal pada waktu yang jelas, agar tidak memperlambat proses bekerja di box office, dan menambahkan logging.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah menghabiskan banyak waktu, energi, </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan rambut di kepala</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , kami dapat mengembangkan solusi yang kami butuhkan, terlebih lagi, kami memenuhi tenggat waktu. </font><font style="vertical-align: inherit;">Pada saat yang sama, pemindai dicetak ulang dan dilatih kembali sekarang secara terpusat, kami jelas mengendalikan seluruh proses. </font><font style="vertical-align: inherit;">Perusahaan menghemat waktu dan uang, dan kami mendapatkan pengalaman yang tak ternilai dalam rekayasa terbalik dari peralatan jenis ini.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id490736/index.html">9 alat yang jelas untuk belajar dan memompa kosakata bahasa Inggris</a></li>
<li><a href="../id490738/index.html">Prinsip substitusi yang cepat</a></li>
<li><a href="../id490740/index.html">Kerusakan seksual bukan hanya pengacakan</a></li>
<li><a href="../id490742/index.html">Era baru dalam robotika telah dimulai</a></li>
<li><a href="../id490746/index.html">Peringkat di Yandex.Taxi: posting pendek tentang topik serius</a></li>
<li><a href="../id490750/index.html">Mikhail Salosin. Meetup Golang. Menggunakan Go di backend aplikasi Watch +</a></li>
<li><a href="../id490754/index.html">Editor Kode Kode Visual Studio. Panduan paling terperinci untuk menyiapkan dan memasang plugin untuk pemula</a></li>
<li><a href="../id490756/index.html">Menyebarkan Jenkins sebagai kode</a></li>
<li><a href="../id490758/index.html">Matematikawan telah membuktikan hukum turbulensi universal</a></li>
<li><a href="../id490760/index.html">Ray Casting Visual Search (RCVS). Algoritma sederhana dan cepat untuk menemukan model 3D yang serupa dalam geometri</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>