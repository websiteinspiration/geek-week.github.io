<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπüèæ üòï üçì IoT donde no esperaste (parte 3). Construyendo un modelo de simulaci√≥n üÜë üßëüèæ‚Äçü§ù‚Äçüßëüèº üë®üèæ‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como ya dije en la √∫ltima parte , al desarrollar un proyecto de IoT, los protocolos para interactuar con los dispositivos son bastante inestables, y l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>IoT donde no esperaste (parte 3). Construyendo un modelo de simulaci√≥n</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/503064/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como ya dije en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√∫ltima parte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , al desarrollar un proyecto de IoT, los protocolos para interactuar con los dispositivos son bastante inestables, y las posibilidades de perder el contacto con los dispositivos de prueba despu√©s de actualizar el firmware eran bastante grandes. </font><font style="vertical-align: inherit;">Varios equipos participaron en el desarrollo, y hab√≠a un requisito estricto: no perder la capacidad de probar la capa empresarial de la aplicaci√≥n, incluso si la actualizaci√≥n de los dispositivos interrumpe todo el flujo de trabajo con sensores.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/z5/tv/zvz5tvvouwnwasl8uerdpzto6eq.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que los analistas de negocios prueben sus hip√≥tesis en datos m√°s o menos similares a la realidad, creamos un modelo de simulaci√≥n del dispositivo. </font><font style="vertical-align: inherit;">Por lo tanto, si el dispositivo se descompuso debido a un nuevo firmware y los datos deb√≠an recibirse con urgencia, lanzamos un modelo de simulaci√≥n en lugar de un dispositivo real en la red, que, seg√∫n el formato anterior, condujo los datos y produjo el resultado.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la ventaja del modelo era que la empresa nunca comprar√≠a un gran lote de dispositivos solo para probar una hip√≥tesis. </font><font style="vertical-align: inherit;">Por ejemplo, el equipo de an√°lisis de negocios decidi√≥ que predecir el tiempo de llenado del contenedor deber√≠a funcionar de manera diferente. </font><font style="vertical-align: inherit;">Y para probar su hip√≥tesis, nadie correr√° a comprar 10,000 sensores.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desarrollo de un modelo de simulaci√≥n.</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El modelo de simulaci√≥n en s√≠ era el siguiente: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ed/bs/pf/edbspfx-ti5ypivxexehovva9ok.gif" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
una m√°quina de estado normal describe el estado y el comportamiento del bote de basura. Primero, inicializamos la m√°quina de estado con el estado `VAC√çO (nivel = 0)` y podemos realizar algunas acciones en ella, es decir, tirar basura al contenedor. Ahora necesitamos determinar si el contenedor permanece vac√≠o `(nivel? MAX_LEVEL)` o est√° lleno` (nivel&gt; = MAX_LEVEL) `. Si es el segundo, el estado cambia a `FULL`. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguien puede descargar la basura de un contenedor lleno, o el conserje ha venido a limpiar su desorden, y debemos decidir a qu√© estado cambiar. El estado `CHOICE` es responsable de elegir una acci√≥n, en la terminolog√≠a de una m√°quina de estados, algo similar a un bloque if.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede quemar otro contenedor, y luego el estado de la m√°quina de estado cambia a 'FUEGO'. </font><font style="vertical-align: inherit;">Adem√°s, el contenedor puede caerse y su condici√≥n se convierte en 'FALL' (en el informe que habl√© sobre las razones inesperadas que pueden causar las gotas del contenedor). </font><font style="vertical-align: inherit;">Pero hay otro estado `PERDIDO`, que es v√°lido desde cualquier otro estado: se establece cuando se pierde la conexi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tal m√°quina de estado describe casi todo el comportamiento del contenedor y el sensor en √©l. </font><font style="vertical-align: inherit;">Pero esto no es suficiente para hacer un modelo de simulaci√≥n, porque sabemos de los posibles estados y transiciones a partir de ellos, pero no sabemos cu√°l es la probabilidad de estos eventos y cu√°ndo ocurrir√°n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, result√≥ que la probabilidad de eventos depend√≠a de la hora del d√≠a, porque:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los transportistas no trabajan de noche;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la gente tira m√°s basura a ciertas horas (en la ma√±ana antes del trabajo y en la noche).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, hicimos posible que el equipo de an√°lisis empresarial personalizara el comportamiento de simulaci√≥n. </font><font style="vertical-align: inherit;">Fue posible establecer la probabilidad de un evento en un momento determinado del d√≠a.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prueba de esfuerzo simple e intuitiva </font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La imitaci√≥n en s√≠ misma tiene muchas ventajas, y una de ellas es la prueba de carga barata. </font><font style="vertical-align: inherit;">Es barato porque la imitaci√≥n es, de hecho, un hilo separado que inicia la m√°quina de estado, le aplica eventos y los eventos mismos se env√≠an al servidor real. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, la simulaci√≥n para el backend no es diferente del sensor real. </font><font style="vertical-align: inherit;">Y si necesitamos ejecutar 1000 sensores, ejecutar 1000 hilos y trabajar. </font><font style="vertical-align: inherit;">Adem√°s, la simulaci√≥n se escala perfectamente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xq/5c/w5/xq5cw5zezhxybxbmk_xuyo7sjxk.gif" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por un lado, es bastante grosero probar la carga, pero por otro lado, la simulaci√≥n permiti√≥ conducir una gran cantidad de datos cerca de la realidad para todo el proyecto. Y no se olvide de los desarrolladores chinos dotados que ignoraron los protocolos est√°ndar como MQTT y cortaron su protocolo en la parte superior de los sockets. Por lo tanto, tuvimos que hacer nuestra propia implementaci√≥n de un servidor que acepta datos en sockets bajo este protocolo propietario.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dicho servidor ten√≠a que ser multiproceso, ya que hay muchos sensores de entrada. y esta parte tambi√©n debe probarse por separado mediante pruebas de rendimiento. Puede tomar JMeter (escribir un script de prueba t√≠pico), JMH / JCStress (probar partes aisladas y hacer un punto de referencia m√°s delgado) o algo m√°s propio. Cuando toma una decisi√≥n en una situaci√≥n similar, le aconsejo que escuche a profesionales, por ejemplo, Alexei Shipilev. En JPoint 2017, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habl√≥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muy fr√≠amente </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">sobre</font></a><font style="vertical-align: inherit;"> c√≥mo comparar diferentes cosas y sobre lo que debe pensar al hacer pruebas de rendimiento.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/p2b4JHESEOc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Elegimos la opci√≥n de hacer algo por nuestra cuenta, ya que el proyecto ten√≠a un enfoque at√≠pico para el control de calidad: no contamos con un equipo de prueba por separado, y el equipo de back-end prob√≥ la funcionalidad. </font><font style="vertical-align: inherit;">Es decir, la persona que escribi√≥ el servidor de socket tuvo que cubrir el c√≥digo con unidades ordinarias, pruebas de integraci√≥n y rendimiento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ten√≠amos una peque√±a herramienta que nos permit√≠a describir r√°pidamente el escenario de carga y ejecutarlo en la cantidad correcta de subprocesos paralelos:</font></font><br>
<br>
<pre><code class="java hljs">StressTestRunner.test()<font></font>
                .mode(ExecutionMode.EXECUTOR_MODE)<font></font>
                .threads(THREADS_COUNT)<font></font>
                .iterations(MESSAGES_COUNT)<font></font>
                .timeout(<span class="hljs-number">5</span>, TimeUnit.SECONDS)<font></font>
                .run(() -&gt; sensor.send(MESSAGE));<font></font>
<font></font>
Awaitility.await()<font></font>
          .atMost(<span class="hljs-number">5</span>, TimeUnit.SECONDS)<font></font>
          .untilAsserted(() -&gt;<font></font>
            verifyReceived(MESSAGES_COUNT)<font></font>
          );<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decimos cu√°ntos hilos necesita ejecutar, cu√°ntos mensajes enviar, cu√°nto tiempo deber√≠a tomar y enviar datos al socket en cada hilo. </font><font style="vertical-align: inherit;">Solo queda esperar a que nuestro servidor procese correctamente todos estos datos. </font><font style="vertical-align: inherit;">Solo se han lanzado unas pocas l√≠neas de c√≥digo que pueden ser escritas por cualquier desarrollador de back-end.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulaci√≥n de problemas de red.</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la ayuda de la imitaci√≥n, pudimos simular trabajos de baja calidad y espec√≠ficos con sockets. </font><font style="vertical-align: inherit;">Las tarjetas SIM GSM en los sensores no tienen direcciones IP "blancas", y podr√≠amos recibir datos de diferentes IP 50 veces al d√≠a. </font><font style="vertical-align: inherit;">Y a menudo sucedi√≥ que se abri√≥ la conexi√≥n, comenzamos a transferir datos, luego la direcci√≥n IP cambia y el servidor abre una nueva conexi√≥n sin cerrar la anterior. </font><font style="vertical-align: inherit;">Si no tom√°ramos esto en cuenta, en un par de d√≠as nos quedar√≠amos sin puertos libres en el servidor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zo/7i/cp/zo7icpvaszptgcfrwhlisznm5aw.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hubo un problema con diferentes sensores de velocidad. </font><font style="vertical-align: inherit;">Un dispositivo lento puede abrir una conexi√≥n y congelarse por un tiempo, mientras que un dispositivo r√°pido enviar√° algo. </font><font style="vertical-align: inherit;">Y todo esto necesita ser procesado correctamente. </font><font style="vertical-align: inherit;">En imitaci√≥n, simular una situaci√≥n similar es f√°cil usando pausas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wh/q2/es/whq2esv39_sverob7195mc6yxtw.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es solo una parte de los escenarios que se pueden incorporar al modelo.</font></font><br>
<br>
<h2><font color="#DB8E0D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recomendaciones</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me parece que es precisamente la posibilidad de simulaci√≥n lo que distingue fuertemente a IoT de otros proyectos. Simular el comportamiento del dispositivo es m√°s f√°cil que el comportamiento humano. En la entrada, obtenemos valores deterministas que se correlacionan bien con nuestro modelo, y no con acciones humanas aleatorias. Debido a que el comportamiento de los dispositivos es l√≥gicamente m√°s f√°cil de describir que el comportamiento de las personas, y probar el sistema se vuelve m√°s f√°cil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analizamos bastantes aspectos diferentes del desarrollo en IoT. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dm/be/gl/dmbeglutox6rwbye8o2jkvgflm4.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si omiti√≥ las dos partes anteriores de este art√≠culo, puede encontrarlas aqu√≠: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT donde no esper√≥ (Parte 1) - El √°rea tem√°tica y los problemas de </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IoT donde no esper√≥ (Parte 2) - Arquitectura de la aplicaci√≥n y prueba de IoT de cosas espec√≠ficas </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github con las herramientas de prueba en cuesti√≥n.</font></font></a><br>
<br>
<blockquote> .  ,     Heisenbug    ,        IoT. ,   !        JPoint,        .          Heisenbug   JPoint    6   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   !</a></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es503042/index.html">5 mitos sobre Red Teaming</a></li>
<li><a href="../es503052/index.html">Automatizaci√≥n de microfrontes, o c√≥mo se prueban las bibliotecas de componentes en Tinkoff</a></li>
<li><a href="../es503054/index.html">¬øQu√© es com√∫n entre las gotas en una taza de caf√© y la mec√°nica cu√°ntica?</a></li>
<li><a href="../es503056/index.html">Pub en l√≠nea del 23 de mayo: holivarim sobre nubes, JS y tel√©fonos celulares</a></li>
<li><a href="../es503062/index.html">El costo real de vida en Silicon Valley para el desarrollador</a></li>
<li><a href="../es503068/index.html">En la encrucijada de tecnolog√≠a y negocios: los l√≠deres de TI abren una nueva universidad en Suiza</a></li>
<li><a href="../es503070/index.html">Taza electrica. Construyendo un loco scooter el√©ctrico / bicicleta el√©ctrica</a></li>
<li><a href="../es503072/index.html">Solo otra herramienta: conocer la configuraci√≥n del servicio con la Configuraci√≥n de estado deseada¬†</a></li>
<li><a href="../es503074/index.html">Detalles sobre el paquete de proveedor para Flutter</a></li>
<li><a href="../es503082/index.html">Telegram como NAS / FTP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>