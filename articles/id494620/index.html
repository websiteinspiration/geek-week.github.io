<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òéÔ∏è ü¶ñ üôåüèΩ Bagaimana cara mengganti target-aksi dan mendelegasikan dengan penutupan üë®üèΩ‚Äçüé§ ü§ôüèΩ üíÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apple menyediakan berbagai opsi untuk memproses data dan acara di aplikasi iOS. Pemrosesan acara UIControl terjadi melalui pola target-aksi. Dokumenta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bagaimana cara mengganti target-aksi dan mendelegasikan dengan penutupan</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/494620/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apple menyediakan berbagai opsi untuk memproses data dan acara di aplikasi iOS. </font><font style="vertical-align: inherit;">Pemrosesan acara UIControl terjadi melalui pola target-aksi. </font><font style="vertical-align: inherit;">Dokumentasi untuk </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIControl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengatakan sebagai berikut:</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mekanisme tindakan-target </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menyederhanakan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kode yang Anda tulis untuk menggunakan kontrol di aplikasi Anda</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita lihat contoh memproses klik tombol:</font></font><a name="habracut"></a><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setupButton</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">let</span> button = <span class="hljs-type">UIButton</span>()<font></font>
    button.addTarget(<span class="hljs-keyword">self</span>, action: #selector(buttonTapped(<span class="hljs-number">_</span>:)), <span class="hljs-keyword">for</span>: .touchUpInside)<font></font>
}<font></font>
<span class="hljs-comment">// -   </span>
<span class="hljs-meta">@objc</span> <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buttonTapped</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: UIButton)</span></span> { }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurasi dan pemrosesan klik tombol terletak secara terpisah dari satu sama lain dalam kode. </font><font style="vertical-align: inherit;">Karena itu, Anda harus menulis lebih banyak kode daripada yang Anda inginkan. </font><font style="vertical-align: inherit;">Masalah muncul dengan peningkatan jumlah acara dan kontrol. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UITextField menggunakan pola </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delegasi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk mengedit dan memvalidasi teks </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kami tidak akan membahas pro dan kontra dari pola ini, baca lebih lanjut di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berbagai metode pemrosesan data dalam satu proyek sering mengarah pada fakta bahwa kode menjadi lebih sulit untuk dibaca dan dipahami. </font><font style="vertical-align: inherit;">Pada artikel ini, kita akan mencari cara untuk membawa semuanya ke gaya tunggal menggunakan sintaks penutupan yang mudah.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa itu perlu?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awalnya, kami melakukan solusi siap pakai di GitHub dan bahkan menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Closures</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk beberapa waktu </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tetapi seiring berjalannya waktu, kami harus meninggalkan solusi pihak ketiga, karena kami menemukan kebocoran memori di sana. </font><font style="vertical-align: inherit;">Dan beberapa fitur-fiturnya tampak tidak nyaman bagi kami. </font><font style="vertical-align: inherit;">Kemudian diputuskan untuk menulis solusi Anda sendiri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan sangat senang dengan hasilnya ketika, menggunakan penutupan, kita bisa menulis ini:</font></font><br>
<br>
<pre><code class="swift hljs">textField.shouldChangeCharacters { textField, range, string <span class="hljs-keyword">in</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tujuan dasar:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai penutup, sediakan akses ke textField, dengan tetap mempertahankan tipe aslinya. </font><font style="vertical-align: inherit;">Ini untuk memanipulasi objek sumber dalam penutupan, misalnya, dengan mengklik tombol untuk menunjukkan indikator tanpa menutup jenis.</font></font></li>
<li> ,  .   ,  <i>.touchUpInside</i>     <i>onTap { }</i>,  <i>shouldChangeCharacters</i>  UITextField  ,       .</li>
</ul><br>
<h3>  </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gagasan utamanya adalah bahwa kita akan memiliki objek pengamat yang akan mencegat semua pesan dan menyebabkan penutupan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama, kita harus memutuskan bagaimana menjaga pengamat. </font><font style="vertical-align: inherit;">Swift memberi kita kekuatan untuk memilih. </font><font style="vertical-align: inherit;">Misalnya, kita dapat membuat objek singleton tambahan yang akan menyimpan kamus, di mana kuncinya adalah id unik dari objek yang diamati, dan nilainya adalah pengamat itu sendiri. </font><font style="vertical-align: inherit;">Dalam hal ini, kita harus mengelola siklus hidup objek secara manual, yang dapat menyebabkan kebocoran memori atau hilangnya informasi. </font><font style="vertical-align: inherit;">Anda dapat menghindari masalah seperti itu jika Anda menyimpan objek sebagai objek terkait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buat protokol ObserverHolder dengan implementasi default sehingga setiap kelas yang sesuai dengan protokol ini memiliki akses ke pengamat:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">ObserverHolder</span>: <span class="hljs-title">AnyObject</span> </span>{
    <span class="hljs-keyword">var</span> observer: <span class="hljs-type">Any?</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> observerAssociatedKey: <span class="hljs-type">UInt8</span> = <span class="hljs-number">0</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">ObserverHolder</span> </span>{
    <span class="hljs-keyword">var</span> observer: <span class="hljs-type">Any?</span> {
        <span class="hljs-keyword">get</span> {<font></font>
            objc_getAssociatedObject(<span class="hljs-keyword">self</span>, &amp;observerAssociatedKey)<font></font>
        }<font></font>
        <span class="hljs-keyword">set</span> {<font></font>
            objc_setAssociatedObject(<font></font>
                <span class="hljs-keyword">self</span>, <font></font>
                &amp;observerAssociatedKey, <font></font>
                newValue, <font></font>
                .<span class="hljs-type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span><font></font>
            )<font></font>
        }<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang sudah cukup untuk menyatakan kepatuhan dengan protokol untuk UIControl:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UIControl</span>: <span class="hljs-title">ObserverHolder</span> </span>{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UIControl (dan semua keturunan, termasuk UITextField) memiliki properti baru tempat pengamat akan disimpan.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh UITextFieldDelegate</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengamat akan menjadi delegasi untuk UITextField, yang berarti bahwa ia harus mematuhi protokol UITextFieldDelegate. </font><font style="vertical-align: inherit;">Kami membutuhkan tipe T generik untuk menyimpan tipe asli UITextField. </font><font style="vertical-align: inherit;">Contoh dari objek seperti itu:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextFieldObserver</span>&lt;<span class="hljs-title">T</span>: <span class="hljs-title">UITextField</span>&gt;: <span class="hljs-title">NSObject</span>, <span class="hljs-title">UITextFieldDelegate</span> </span>{
    <span class="hljs-keyword">init</span>(textField: <span class="hljs-type">T</span>) {
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()<font></font>
        textField.delegate = <span class="hljs-keyword">self</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap metode delegasi akan membutuhkan penutupan terpisah. </font><font style="vertical-align: inherit;">Di dalam metode tersebut, kami akan melemparkan tipe ke T dan menyebabkan penutupan yang sesuai. </font><font style="vertical-align: inherit;">Kami akan menambahkan kode TextFieldObserver, dan sebagai contoh kami hanya akan menambahkan satu metode:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> shouldChangeCharacters: ((<span class="hljs-type">T</span>, <span class="hljs-number">_</span> range: <span class="hljs-type">NSRange</span>, <span class="hljs-number">_</span> replacement: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Bool</span>)?<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">textField</span><span class="hljs-params">(
    <span class="hljs-number">_</span> textField: UITextField,
    shouldChangeCharactersIn range: NSRange,
    replacementString string: String
)</span></span> -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-keyword">guard</span> 
        <span class="hljs-keyword">let</span> textField = textField <span class="hljs-keyword">as</span>? <span class="hljs-type">T</span>, 
        <span class="hljs-keyword">let</span> shouldChangeCharacters = shouldChangeCharacters 
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> shouldChangeCharacters(textField, range, string)<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami siap menulis antarmuka baru dengan penutup:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UITextField</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeCharacters</span><span class="hljs-params">(handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>, NSRange, String)</span></span></span> -&gt; <span class="hljs-type">Bool</span>) { }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terjadi kesalahan, kompilator membuat kesalahan: </font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Cukup' hanya tersedia dalam protokol atau sebagai hasil dari metode di kelas; </font><font style="vertical-align: inherit;">maksud Anda 'UITextField'</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protokol kosong akan membantu kami, dengan ekstensi yang mana kami akan menulis antarmuka baru ke UITextField, sambil membatasi Self:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">HandlersKit</span> </span>{ }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UIControl</span>: <span class="hljs-title">HandlersKit</span> </span>{ }<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">HandlersKit</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UITextField</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeCharacters</span><span class="hljs-params">(handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>, NSRange, String)</span></span></span> -&gt; <span class="hljs-type">Bool</span>) { }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode mengkompilasi, tetap membuat TextFieldObserver dan menunjuknya sebagai delegasi. </font><font style="vertical-align: inherit;">Selain itu, jika pengamat sudah ada, maka Anda perlu memperbaruinya agar tidak kehilangan penutupan lain:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeCharacters</span><span class="hljs-params">(handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>, NSRange, String)</span></span></span> -&gt; <span class="hljs-type">Bool</span>) {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> textFieldObserver = observer <span class="hljs-keyword">as</span>? <span class="hljs-type">TextFieldObserver</span>&lt;<span class="hljs-type">Self</span>&gt; {<font></font>
        textFieldObserver.shouldChangeCharacters = handler<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> textFieldObserver = <span class="hljs-type">TextFieldObserver</span>(textField: <span class="hljs-keyword">self</span>)<font></font>
        textFieldObserver.shouldChangeCharacters = handler<font></font>
        observer = textFieldObserver<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hebat, sekarang kode ini berfungsi dan siap digunakan, tetapi dapat ditingkatkan. </font><font style="vertical-align: inherit;">Kami akan membuat dan memperbarui TextFieldObserver dalam metode terpisah, hanya penugasan penutupan akan berbeda, yang akan kami sampaikan dalam bentuk blok. </font><font style="vertical-align: inherit;">Perbarui kode yang ada di ekstensi HandlersKit:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeCharacters</span><span class="hljs-params">(handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>, NSRange, String)</span></span></span> -&gt; <span class="hljs-type">Bool</span>) {<font></font>
    updateObserver { $<span class="hljs-number">0</span>.shouldChangeCharacters = handler }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateObserver</span><span class="hljs-params">(<span class="hljs-number">_</span> update: <span class="hljs-params">(TextFieldObserver&lt;<span class="hljs-keyword">Self</span>&gt;)</span></span></span> -&gt; <span class="hljs-type">Void</span>) {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> textFieldObserver = observer <span class="hljs-keyword">as</span>? <span class="hljs-type">TextFieldObserver</span>&lt;<span class="hljs-type">Self</span>&gt; {<font></font>
        update(textFieldObserver)<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> textFieldObserver = <span class="hljs-type">TextFieldObserver</span>(textField: <span class="hljs-keyword">self</span>)<font></font>
        update(textFieldObserver)<font></font>
        observer = textFieldObserver<font></font>
    }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbaikan tambahan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan kemampuan untuk metode berantai. </font><font style="vertical-align: inherit;">Untuk melakukan ini, setiap metode harus mengembalikan Self dan memiliki atribut @discardableResult:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@discardableResult</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeCharacters</span><span class="hljs-params">(
    handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>, NSRange, String)</span></span></span> -&gt; <span class="hljs-type">Bool</span>
) -&gt; <span class="hljs-type">Self</span><font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateObserver</span><span class="hljs-params">(<span class="hljs-number">_</span> update: <span class="hljs-params">(TextFieldObserver&lt;<span class="hljs-keyword">Self</span>&gt;)</span></span></span> -&gt; <span class="hljs-type">Void</span>) -&gt; <span class="hljs-type">Self</span> {<font></font>
    ...<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai penutup, akses ke UITextField tidak selalu diperlukan, dan agar di tempat-tempat seperti itu Anda tidak harus menulis ` </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in` setiap kali </font><font style="vertical-align: inherit;">, kami menambahkan metode dengan penamaan yang sama, tetapi tanpa Self yang diperlukan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@discardableResult</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeCharacters</span><span class="hljs-params">(handler: @escaping <span class="hljs-params">(NSRange, String)</span></span></span> -&gt; <span class="hljs-type">Void</span>) -&gt; <span class="hljs-type">Self</span> {<font></font>
    shouldChangeCharacters { handler($<span class="hljs-number">1</span>, $<span class="hljs-number">2</span>) }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat pendekatan ini, Anda dapat membuat metode yang lebih nyaman. </font><font style="vertical-align: inherit;">Misalnya, mengubah teks dengan UITextField terkadang lebih mudah ketika teks akhir diketahui:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-meta">@discardableResult</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">shouldChangeString</span><span class="hljs-params">(
    handler: @escaping <span class="hljs-params">(<span class="hljs-number">_</span> textField: <span class="hljs-keyword">Self</span>, <span class="hljs-number">_</span> from: String, <span class="hljs-number">_</span> to: String)</span></span></span> -&gt; <span class="hljs-type">Bool</span>
) -&gt; <span class="hljs-type">Self</span> {<font></font>
    shouldChangeCharacters { textField, range, string <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">let</span> text = textField.text ?? <span class="hljs-string">""</span>
        <span class="hljs-keyword">let</span> newText = <span class="hljs-type">NSString</span>(string: text)<font></font>
            .replacingCharacters(<span class="hljs-keyword">in</span>: range, with: string)
        <span class="hljs-keyword">return</span> handler(textField, text, newText)<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selesai! </font><font style="vertical-align: inherit;">Dalam contoh yang ditunjukkan, kami mengganti satu metode UITextFieldDelegate, dan untuk mengganti metode yang tersisa, kami perlu menambahkan penutup pada TextFieldObserver dan ke ekstensi protokol HandlersKit sesuai dengan prinsip yang sama.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengganti target-aksi dengan penutupan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa menyimpan satu pengamat untuk tindakan target dan delegasi dalam formulir ini memperumitnya, jadi kami sarankan menambahkan objek terkait lainnya ke UIControl untuk acara. </font><font style="vertical-align: inherit;">Kami akan menyimpan objek terpisah untuk setiap acara, kamus sangat cocok untuk tugas seperti itu:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">EventsObserverHolder</span>: <span class="hljs-title">AnyObject</span> </span>{
    <span class="hljs-keyword">var</span> eventsObserver: [<span class="hljs-type">UInt</span>: <span class="hljs-type">Any</span>] { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jangan lupa untuk menambahkan implementasi default untuk EventsObserverHolder, buat kamus kosong segera di pengambil:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">get</span> {<font></font>
    objc_getAssociatedObject(<span class="hljs-keyword">self</span>, &amp;observerAssociatedKey) <span class="hljs-keyword">as</span>? [<span class="hljs-type">UInt</span>: <span class="hljs-type">Any</span>] ?? [:]<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengamat akan menjadi target untuk satu acara:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventObserver</span>&lt;<span class="hljs-title">T</span>: <span class="hljs-title">UIControl</span>&gt;: <span class="hljs-title">NSObject</span> </span>{
    <span class="hljs-keyword">init</span>(control: <span class="hljs-type">T</span>, event: <span class="hljs-type">UIControl</span>.<span class="hljs-type">Event</span>, handler: @escaping (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Void</span>) {
        <span class="hljs-keyword">self</span>.handler = handler
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()<font></font>
        control.addTarget(<span class="hljs-keyword">self</span>, action: #selector(eventHandled(<span class="hljs-number">_</span>:)), <span class="hljs-keyword">for</span>: event)<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam objek seperti itu, cukup untuk menyimpan satu penutupan. </font><font style="vertical-align: inherit;">Setelah menyelesaikan tindakan, seperti pada TextFieldObserver, kami menyajikan jenis objek dan menyebabkan penutupan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> handler: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Void</span><font></font>
<font></font>
<span class="hljs-meta">@objc</span> <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">eventHandled</span><span class="hljs-params">(<span class="hljs-number">_</span> sender: UIControl)</span></span> {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> sender = sender <span class="hljs-keyword">as</span>? <span class="hljs-type">T</span> {<font></font>
        handler(sender)<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deklarasi Kepatuhan Protokol untuk UIControl:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UIControl</span>: <span class="hljs-title">HandlersKit</span>, <span class="hljs-title">EventsObserverHolder</span> </span>{ }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda sudah mengganti delegasi dengan penutupan, maka Anda tidak perlu mencocokkan HandlersKit lagi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetap menulis antarmuka baru untuk UIControl. </font><font style="vertical-align: inherit;">Di dalam metode baru, buat pengamat dan simpan di dalam eventsObserver menggunakan key event.rawValue:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">HandlersKit</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UIControl</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@discardableResult</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">on</span><span class="hljs-params">(<span class="hljs-number">_</span> event: UIControl.Event, handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>)</span></span></span> -&gt; <span class="hljs-type">Void</span>) -&gt; <span class="hljs-type">Self</span> {
        <span class="hljs-keyword">let</span> observer = <span class="hljs-type">EventObserver</span>(control: <span class="hljs-keyword">self</span>, event: event, handler: handler)<font></font>
        eventsObserver[event.rawValue] = observer<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat menambah antarmuka untuk acara yang sering digunakan:</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">HandlersKit</span> <span class="hljs-title">where</span> <span class="hljs-title">Self</span>: <span class="hljs-title">UIButton</span> </span>{<font></font>
<font></font>
    <span class="hljs-meta">@discardableResult</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onTap</span><span class="hljs-params">(handler: @escaping <span class="hljs-params">(<span class="hljs-keyword">Self</span>)</span></span></span> -&gt; <span class="hljs-type">Void</span>) -&gt; <span class="hljs-type">Self</span> {<font></font>
        on(.touchUpInside, handler: handler)<font></font>
    }<font></font>
}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ringkasan</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hore, kami berhasil mengganti target-aksi dan mendelegasikan dengan penutupan dan mendapatkan antarmuka tunggal untuk kontrol. </font><font style="vertical-align: inherit;">Tidak perlu memikirkan kebocoran memori dan menangkap kontrol sendiri dalam penutupan, karena kami memiliki akses langsung ke mereka. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode lengkap di sini: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HandlersKit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ada lebih banyak contoh dalam repositori ini untuk: UIControl, UIBarButtonItem, UIGestureRecognizer, UITextField dan UITextView. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk wawasan yang lebih dalam tentang topik ini, saya juga mengusulkan untuk membaca artikel tentang </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EasyClosure</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan melihat solusi untuk masalah dari sisi lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyambut umpan balik dalam komentar. </font><font style="vertical-align: inherit;">Sampai!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id494606/index.html">Cara mengamati bulan dan planet-planet</a></li>
<li><a href="../id494608/index.html">Mempersiapkan Ludum Dare</a></li>
<li><a href="../id494610/index.html">Buku untuk podcaster pemula: apa yang harus dibaca tentang mendapatkan dan memonetisasi program percakapan</a></li>
<li><a href="../id494612/index.html">Toko Online Sisi Klien Blazor: Bagian 3 - Showcase Produk</a></li>
<li><a href="../id494614/index.html">Lihat lagi pertanyaan "Apakah saya perlu defragmentasi untuk SSD"</a></li>
<li><a href="../id494622/index.html">Tidak ada topeng, tetapi Anda memegang 2/2</a></li>
<li><a href="../id494630/index.html">Instal micropython di ESP8266 dan bekerja dengannya di Linux (untuk pemula)</a></li>
<li><a href="../id494632/index.html">Kuartet 9: Allegro | Performa</a></li>
<li><a href="../id494636/index.html">Analisis Keuangan Umum dengan Python (Bagian 2)</a></li>
<li><a href="../id494638/index.html">Arsitektur bersih untuk ujung depan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>