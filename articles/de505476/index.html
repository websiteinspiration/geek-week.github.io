<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👧‍👧 🌾 🐓 CRUD API auf Deno und PostegreSQL: Arbeiten mit einem Dinosaurier ↘️ 🖐🏽 🕗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo alle zusammen. Im Vorgriff auf den Start des Kurses „Fullstack JavaScript Developer“ möchten wir einige interessante Materialien veröffentlichen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>CRUD API auf Deno und PostegreSQL: Arbeiten mit einem Dinosaurier</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/505476/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo alle zusammen. </font><font style="vertical-align: inherit;">Im Vorgriff auf den Start des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurses „Fullstack JavaScript Developer“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> möchten wir einige interessante Materialien veröffentlichen, die von unserem freiberuflichen Autor gesendet wurden. </font><font style="vertical-align: inherit;">Dieser Artikel bezieht sich nicht auf das Kursprogramm, wird aber sicherlich als kurzer Rückblick auf Deno interessant sein.</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/1a/5g/sq/1a5gsqglaelsf8jja4zdr0jslbw.png"><br>
<br>
<hr><br>
<blockquote>"-,    CLI   Deno .    secure runtime ?"<br>
"-"<br>
"-,     ,   ,    -  .   ?"<br>
"-"</blockquote><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo alle zusammen. </font><font style="vertical-align: inherit;">Deno wird immer berühmter und beliebter, es gibt eine Vielzahl neuer Videos und Texthandbücher zu diesem Thema, jedoch hauptsächlich in englischer Sprache. </font><font style="vertical-align: inherit;">Einige Artikel über Deno wurden zum Beispiel auch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf Habré veröffentlicht </font><font style="vertical-align: inherit;">, aber hauptsächlich Artikel sprechen theoretisch über Deno. </font><font style="vertical-align: inherit;">Heute werden wir versuchen, eine kleine CRUD-API zu erstellen, die beispielsweise eine Aufgabenanwendung im Frontend bedienen kann, und ich werde Ihnen meine Eindrücke dieses Dinosauriers in echter Codierung mitteilen.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Theoretische Einführung </font></font></h1><br>
<img src="https://habrastorage.org/webt/ou/cz/_q/oucz_qc3vym7u2ftdzkcgnt65pi.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für diejenigen, die im Tank sind, werde ich Ihnen sagen, was Deno ist, wenn Sie zum Beispiel einen der obigen Artikel nicht gelesen haben. Deno ist eine Laufzeitlaufzeit, die unter JavaScript und TypeScript ausgeführt wird (TypeScript wird standardmäßig unterstützt, die TypeScript-Compilerversion ist fest mit der Deno-Version verbunden, Sie können sie nur ändern, wenn Sie die Deno-Version ändern), die auf der V8-Engine und der Programmiersprache Rust basiert. Deno wurde von Ryan Dahl, dem Erfinder von Node.js, entwickelt. Die Hauptqualitäten von Deno sind Leistung und Sicherheit. Deno wurde 2018 angekündigt und was viele Quellen vergessen zu erwähnen - wurde stark von Golang beeinflusst (und zwar ursprünglich in Golang geschrieben, musste aber später in Rust umgeschrieben werden).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Standardbibliothek wurde nach dem Vorbild der Go-Standardbibliothek erstellt, und viele Tools oder deren Implementierungen wurden von Golang auf Deno umgestellt, z. B. das Fehlen eines Ökosystems wie npm und das direkte Pumpen von Bibliotheken aus Webressourcen in der anfänglichen Erstellungsphase (was in Node zu einer Art Stupor führt. js von Entwicklern, die mit einem ähnlichen System mit Go natürlich nicht vertraut waren). </font><font style="vertical-align: inherit;">Für wen ist Deno jetzt? </font><font style="vertical-align: inherit;">Wenn Sie getippte Sprachen mögen, wie Golang-Ideen und -Tools, aber auf etwas Einfacheres zurückgreifen möchten, ist es Zeit, Deno in der Realität auszuprobieren. </font><font style="vertical-align: inherit;">Wenn Sie jedoch auf die Reifung der Plattform warten möchten, werden weitere Bibliotheken und Antworten auf StackOverflow angezeigt. Vielleicht sollten Sie etwas warten.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Beginnen Sie zu erstellen </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trotz der Jugend von Deno hat sich kein Ökosystem gebildet (was natürlich noch nicht mit dem Node.js-Ökosystem verglichen werden kann), wodurch Sie die Grundbedürfnisse für die Erstellung Ihrer eigenen API abdecken können. </font><font style="vertical-align: inherit;">Lassen Sie uns entscheiden, was wir erstellen: Ich möchte eine einfache CRUD-API mit Deno und TypeScript im Backend erstellen (da TypeScript unterstützt wird, warum nicht), PostgreSQL als Datenbank (im Allgemeinen wollte ich MySQL verwenden, habe aber versehentlich meinen Zugriff unterbrochen Eine interessante Tatsache ist, dass auf der externen IP-Adresse der integrierte PHP 7.4-Server eine Verbindung zu meiner MySQL-Datenbank herstellen konnte und Deno Pakete in der falschen Reihenfolge anzeigte. Unsere Anfragen sehen folgendermaßen aus:</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Methode </font></font></b></td>
<td><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Routen </font></font></b></td>
<td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausführungsergebnis </font></font></b></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erhalten </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos / get</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alles erledigen </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Post </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos / post</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein neues Geschäft aufbauen </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATCH </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos /: id</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aktualisieren eines bestimmten Falls </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LÖSCHEN </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / api / todos /: id</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fall durch ID löschen </font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wir haben uns für das Abfrageschema entschieden. Wir haben den PostgreSQL-Server gestartet (wenn Sie ihn </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> herunterladen können </font><font style="vertical-align: inherit;">, es ist ein sehr schöner </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Postico-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GUI-Client </font><font style="vertical-align: inherit;">). Wir haben die Datenbank crud_api erstellt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Was weiter? </font><font style="vertical-align: inherit;">Sie können eine Tabelle mit Ihren Händen natürlich mithilfe von SQL-Abfragen oder einem Client erstellen, aber ich möchte sehen, wie es mit Deno-Migrationen ist. </font><font style="vertical-align: inherit;">In diesem Fall </font><font style="vertical-align: inherit;">ist die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nessia-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">hilfreich</font></a><font style="vertical-align: inherit;"> , mit der Sie Migrationen erstellen können, die Migrationen in Laravel ähneln. </font><font style="vertical-align: inherit;">Bevor wir uns jedoch mit Migration befassen, wollen wir uns mit der Organisation einer Entwicklungsumgebung befassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erst neulich wurde das offizielle JetBrains Deno-Entwicklungs-Plugin veröffentlicht. </font><font style="vertical-align: inherit;">Sie finden es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In Visual Studio müssen Sie das Deno-Plugin installieren und im Projektordner den Ordner mit den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.vscode-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellungen erstellen </font><font style="vertical-align: inherit;">, in dem Sie in settings.json </font><font style="vertical-align: inherit;">die </font><i><font style="vertical-align: inherit;">Deno-</font></i><font style="vertical-align: inherit;"> Unterstützung </font><i><font style="vertical-align: inherit;">aktivieren</font></i><font style="vertical-align: inherit;"> (aber ohne sie schien es für mich zu funktionieren):</font></font><br>
<br>
<pre><code class="json hljs">    <span class="hljs-string">"deno.enable"</span>:<span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles mit der Vorbereitungsphase, wir können zu Migrationen zurückkehren. </font><font style="vertical-align: inherit;">Zuerst müssen wir den Initialisierungsbefehl eingeben und ihn aus der Bibliotheksdokumentation entnehmen:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read --allow-write https://deno.land/x/nessie/cli.ts init
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir erstellen eine Konfigurationsdatei für unsere Bibliothek, mit deren Hilfe wir bestimmen können, mit welchem ​​DBMS und welcher Datenbank Sie eine Verbindung herstellen möchten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst werden drei Vorlagen in der Datei erstellt - für PostgreSQL, MySQL und Sqlite (standardmäßig werden Einstellungen für PostegreSQL exportiert). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sieht</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unsere Datei </font><i><font style="vertical-align: inherit;">nessie.config.ts folgendermaßen</font></i><font style="vertical-align: inherit;"> aus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { ClientPostgreSQL} <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/nessie/mod.ts"</span>; <font></font>
<font></font>
<span class="hljs-keyword">const</span> migrationFolder = <span class="hljs-string">"./migrations"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> configPg = {
  <span class="hljs-attr">client</span>: <span class="hljs-keyword">new</span> ClientPostgreSQL(migrationFolder, {
    <span class="hljs-attr">database</span>: <span class="hljs-string">"deno_crud"</span>,
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">"isakura313"</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">""</span>,<font></font>
  }),<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> configPg;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun können Sie eine Migrationsdatei erstellen, um sie zu bearbeiten, indem Sie angeben, welche Tabelle und welche Daten erstellt werden sollen. </font><font style="vertical-align: inherit;">Geben Sie dazu den folgenden Befehl ein:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read --allow-write https://deno.land/x/nessie/cli.ts make create_todo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht hatte der unerfahrene Leser bereits Fragen, warum so viele Flaggen. </font><font style="vertical-align: inherit;">Dies ist in Deno sicher. Um den Befehl auszuführen, müssen Sie angeben, auf welche Zugriffsebene Sie ihn gewähren ( </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dies ist das ausgeklügelte Sicherheitssystem, auf das wir gewartet haben</font></font></strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Diese Flaggen verursachen bei vielen ein ziemlich scharfes Brennen - müssen sie gedruckt werden? </font><font style="vertical-align: inherit;">Bash-Skripte anhängen, in denen Sie sie immer mit vollen Rechten aufrufen? </font><font style="vertical-align: inherit;">Ich denke, irgendwann wird sich dieses System ändern, aber vorerst so wie es ist. </font><font style="vertical-align: inherit;">Daher </font></font><code>.migrations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollte </font><font style="vertical-align: inherit;">in unserem Ordner </font><font style="vertical-align: inherit;">eine Migrationsdatei </font><font style="vertical-align: inherit;">angezeigt werden </font><font style="vertical-align: inherit;">, die Sie jederzeit bearbeiten können. </font><font style="vertical-align: inherit;">Ich habe es wie folgt bearbeitet:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> up = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"CREATE TABLE todo (id serial, text text, done boolean)"</span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> down = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">"DROP TABLE todo"</span><font></font>
};<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach können wir mit dem folgenden Befehl in die Datenbank migrieren:</font></font><br>
<br>
<pre><code class="bash hljs">deno run --allow-net --allow-read https://deno.land/x/nessie/cli.ts migrate
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Nessia gibt es eine erweiterte Migrationsoption, aber ich habe beschlossen, die Dinge etwas einfacher zu gestalten. </font><font style="vertical-align: inherit;">Weiter können wir unser eigenes Modell erstellen.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir arbeiten mit dem Modell</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Wir erstellen einen Ordner, </font></font><code>models</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in dem wir die Anfragen selbst haben. </font><font style="vertical-align: inherit;">Zuerst müssen Sie eine Datei erstellen, </font></font><code>config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der die Einstellungen für die Verbindung zur Datenbank hinzugefügt werden (ja, wir haben sie bereits erwähnt </font></font><code>nessie.config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber diese Datei wurde für die Migration verwendet). </font><font style="vertical-align: inherit;">Für die Verbindung in der Datei verwenden </font></font><code>config.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deno-Posgres-Bibliothek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Infolgedessen sieht die Konfigurationsdatei folgendermaßen aus:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Client } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/postgres/mod.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Client({
  <span class="hljs-attr">user</span>: <span class="hljs-string">"isakura313"</span>,
  <span class="hljs-attr">database</span>: <span class="hljs-string">"deno_crud"</span>,
  <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
  <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> client;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fein! </font><font style="vertical-align: inherit;">Jetzt gehen wir direkt zum Modell über. </font><font style="vertical-align: inherit;">Um SQL-Abfragen zu erstellen, verwende ich die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dex-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliothek </font><font style="vertical-align: inherit;">, den Port der Knex-Bibliothek auf Deno. </font><font style="vertical-align: inherit;">Dadurch kann ich programmgesteuert bestimmen, welche SQL-Abfrage ich ausführen werde. </font><font style="vertical-align: inherit;">Beginnen wir damit, zu definieren, mit welchem ​​Dialekt Dex in dieser Zeit arbeiten muss, und die Schnittstelle unserer Aufgaben zu definieren:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> dex = Dex({ <span class="hljs-attr">client</span>: <span class="hljs-string">"postgres"</span> });<font></font>
<font></font>
interface Todo {<font></font>
  id?: number;   <span class="hljs-comment">//? -     TypeScript</span><font></font>
  text: string;<font></font>
  done: boolean;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun können wir zum Zellstoff selbst übergehen. </font><font style="vertical-align: inherit;">Definieren Sie zunächst eine Abrufanforderung, die alle Aufgaben erhält. </font><font style="vertical-align: inherit;">Ich werde die asynchrone Funktionsausführung verwenden, um über wait eine Verbindung zur Datenbank herzustellen und das Ergebnis der Abfrage zu erhalten:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllTodo</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).toString();
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
  <span class="hljs-keyword">return</span> result;<font></font>
}<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie mit TypeScript und c async / await ein wenig vertraut sind, haben Sie hier keine Fragen. </font><font style="vertical-align: inherit;">Aber noch mehr - wir müssen eine Nachanfrage schreiben, die den Fall zur Datenbank hinzufügt.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addTodo</span>(<span class="hljs-params">todo: Todo</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> insertQuery = dex.queryBuilder().insert([todo]).into(<span class="hljs-string">"todo"</span>).toString();
  <span class="hljs-keyword">return</span> client.query(insertQuery).then(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).where(<font></font>
      { <span class="hljs-attr">text</span>: todo.text },<font></font>
    ).toString();<font></font>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
    <span class="hljs-keyword">const</span> result_data = result.rows ? result.rows[<span class="hljs-number">0</span>] : {};
    <span class="hljs-keyword">return</span> result_data;<font></font>
  });<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der obige Code kann gekürzt werden, ich habe jedoch versucht, ihn so einfach und ausdrucksstark wie möglich zu gestalten, auch zum Nachteil der Anzahl der Zeilen. </font><font style="vertical-align: inherit;">Im Allgemeinen geschieht dort Folgendes: Innerhalb der Funktion stellen wir eine Verbindung zur Datenbank her, die Einfügung ist eingebaut - die Anforderung, eine Anforderung tritt auf, in der eine neue Anforderung erstellt wird, die den neu erstellten Fall oder ein leeres Objekt zurückgibt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Andere Funktionen - Bearbeiten und Löschen, werde ich zusammen geben. </font><font style="vertical-align: inherit;">Beim Bearbeiten passiert für uns dasselbe wie beim Hinzufügen eines Falls, außer dass wir ein Update in editTodo haben. </font><font style="vertical-align: inherit;">Beim Löschen löschen wir einfach den Fall und geben nichts zurück:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editTodo</span>(<span class="hljs-params">id: number, todo: Todo</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> editQuery = dex.queryBuilder().from(<span class="hljs-string">"todo"</span>).update(todo).where({ id })<font></font>
    .toString();<font></font>
  <span class="hljs-keyword">return</span> client.query(editQuery).then(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> getQuery = dex.queryBuilder().select(<span class="hljs-string">"*"</span>).from(<span class="hljs-string">"todo"</span>).where(<font></font>
      { <span class="hljs-attr">text</span>: todo.text },<font></font>
    ).toString();<font></font>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.query(getQuery);
    <span class="hljs-keyword">const</span> result_data = result.rows ? result.rows[<span class="hljs-number">0</span>] : {};
    <span class="hljs-keyword">return</span> result_data;<font></font>
  });<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteTodo</span>(<span class="hljs-params">id: number</span>) </span>{
  <span class="hljs-keyword">await</span> client.connect();
  <span class="hljs-keyword">const</span> deleteQuery = dex.queryBuilder().from(<span class="hljs-string">"todo"</span>).delete().where({ id })<font></font>
    .toString();<font></font>
  <span class="hljs-keyword">return</span> client.query(deleteQuery);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beeindruckend. </font><font style="vertical-align: inherit;">Es bleibt nur der Export unserer Funktionen, und Sie können mit der Konfiguration des Servers und des Routings beginnen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> {<font></font>
  addTodo,<font></font>
  getAllTodo,<font></font>
  editTodo,<font></font>
  deleteTodo,<font></font>
};<font></font>
<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Routing und Serverbetrieb </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstellen Sie den Routenordner, in dem wir route.ts haben. </font><font style="vertical-align: inherit;">Um unsere Routen zu bearbeiten, verwenden wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">denotrain</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eine Bibliothek, die von expressJS inspiriert wurde und mit URL-Anfragen arbeiten, Routing konfigurieren und viele nützliche Dinge enthalten darf. </font><font style="vertical-align: inherit;">Wir importieren unsere Funktionen und Router:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { Router } <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/denotrain@v0.5.0/mod.ts"</span>;
<span class="hljs-keyword">import</span> { addTodo, getAllTodo, editTodo, deleteTodo } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/models.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> Router();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fügen Sie die Methoden get und post hinzu:</font></font><br>
<br>
<pre><code class="javascript hljs">api.get(<span class="hljs-string">"/"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">return</span> getAllTodo().then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> result.rows;
    <span class="hljs-comment">// </span><font></font>
  });<font></font>
});<font></font>
<font></font>
api.post(<span class="hljs-string">"/"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">const</span> body = {
  <span class="hljs-comment">//  </span>
    <span class="hljs-attr">text</span>: ctx.req.body.text,
    <span class="hljs-attr">done</span>: ctx.req.body.done,<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">return</span> addTodo(body).then(<span class="hljs-function">(<span class="hljs-params">newTodo</span>) =&gt;</span> {<font></font>
    ctx.res.setStatus(<span class="hljs-number">201</span>); <span class="hljs-comment">//   "Created"</span>
    <span class="hljs-keyword">return</span> newTodo;<font></font>
  });<font></font>
});<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ctx ist die Variable, die für den Antwortkontext verantwortlich ist. </font><font style="vertical-align: inherit;">Ich weiß nicht, was ich zu den Kommentaren hinzufügen soll. Meiner Meinung nach ist bereits alles so offensichtlich. </font><font style="vertical-align: inherit;">Es bleibt nur das Hinzufügen der Patch- und Löschmethoden und das Exportieren unserer API:</font></font><br>
<br>
<pre><code class="javascript hljs">api.patch(<span class="hljs-string">"/:id"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">const</span> todo = {
    <span class="hljs-attr">text</span>: ctx.req.body.text,
    <span class="hljs-attr">done</span>: ctx.req.body.done,<font></font>
  };<font></font>
<font></font>
  <span class="hljs-keyword">return</span> editTodo(ctx.req.params.id <span class="hljs-keyword">as</span> number, todo).then(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> result;<font></font>
  });<font></font>
});<font></font>
<font></font>
api.delete(<span class="hljs-string">"/:id"</span>, (ctx) =&gt; {
  <span class="hljs-keyword">return</span> deleteTodo(ctx.req.params.id <span class="hljs-keyword">as</span> number).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    ctx.res.setStatus(<span class="hljs-number">204</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
  });<font></font>
});<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> api;<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es bleibt nur unser Server zu erhöhen. </font><font style="vertical-align: inherit;">Erstellen Sie </font></font><code>server.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im </font><font style="vertical-align: inherit;">Stammordner eine Datei, </font><font style="vertical-align: inherit;">in die wir auch Application aus denotrain importieren, um unseren Server zu erhöhen:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> {Application} <span class="hljs-keyword">from</span> <span class="hljs-string">"https://deno.land/x/denotrain@v0.5.0/mod.ts"</span>;
<span class="hljs-keyword">import</span> api <span class="hljs-keyword">from</span> <span class="hljs-string">"./routes/routes.ts"</span>;<font></font>
<font></font>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Application({<span class="hljs-attr">port</span>: <span class="hljs-number">1337</span>}) <span class="hljs-comment">//      1337</span><font></font>
<font></font>
app.use(<span class="hljs-string">"/api/todos"</span>, api) <span class="hljs-comment">//  ,      </span>
app.run() <span class="hljs-comment">//  </span>
 </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Möglicherweise haben Sie Probleme mit der Anwendung. </font><font style="vertical-align: inherit;">Ich möchte den kompilierten Server nicht jedes Mal manuell neu starten, daher verwende ich das Analogon von nodemon - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denomon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , das Ihren Code originalgetreu neu kompiliert und den Server neu startet. </font><font style="vertical-align: inherit;">In unserem Fall ist der folgende Befehl geeignet:</font></font><br>
<br>
<pre><code class="bash hljs">denomon --allow net,<span class="hljs-built_in">read</span> server.ts
 </code></pre><br>
 <h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meine Eindrücke </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Ich habe es wirklich genossen, auf Deno zu schreiben. Trotz einiger Skepsis in seine Richtung können Sie mit Hilfe von TypeScript und einer gut ausgebauten Entwicklungsumgebung großartige Ergebnisse erzielen, wenn Sie einen äußerst zuverlässigen Dienst schreiben, der so vorhersehbar wie möglich funktioniert. Es gibt noch Raum zum Wachsen (zum Beispiel in Bezug auf die Geschwindigkeit der Neukompilierung des Projekts) und es ist noch zu früh, um Deno für eine ernsthafte Produktion zu verwenden. Ich hoffe jedoch, dass der Dinosaurier das Beste aus Node.js übernehmen, die Kuriositäten der Architektur leicht ändern und seine Entwicklung fortsetzen kann. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das war's bei der Erstellung unserer API. Das gesamte Projekt finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Sie können Postman öffnen und überprüfen, ob alles ordnungsgemäß funktioniert. Traditionell einige nützliche Links: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REST-Mikroframework für Deno ohne Abhängigkeiten </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejs-engine für Deno</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    Deno</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Deno  Discord</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  Chat App  Deno + React</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">    Deno  </a><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a><br>
<br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de505460/index.html">Bezahlen Sie für die Ausbildung in Codierung: Russische Junggesellen können ein Stipendium für ein Masterstudium in der Schweiz erhalten</a></li>
<li><a href="../de505462/index.html">Mikro-Rechenzentrum: Warum brauchen wir Miniatur-Rechenzentren?</a></li>
<li><a href="../de505468/index.html">E-Mail-Archivierung in der Open-Source-Edition der Zimbra Collaboration Suite</a></li>
<li><a href="../de505470/index.html">Notizen des Wissensmanagers. Wie Exness Knowledge Management funktioniert</a></li>
<li><a href="../de505472/index.html">Nützlicher Beitrag: Installieren Sie OpenShift, lernen Sie Kafka und verwenden Sie Ansible auf der Google Cloud Platform</a></li>
<li><a href="../de505478/index.html">Ersetzen eines CRM-Systems durch ein CRM-System</a></li>
<li><a href="../de505488/index.html">12 Tipps zum Implementieren von TypeScript in React-Anwendungen</a></li>
<li><a href="../de505494/index.html">Entwickler-Framing</a></li>
<li><a href="../de505496/index.html">Flutter Dev Podcast mit CTO Meduza Boris Goryachev: Die Hauptsache über die Meduz-Anwendung und die Medienentwicklung</a></li>
<li><a href="../de505498/index.html">Wie wir das Problem des nicht initialisierten Stapelspeichers in Windows lösen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>