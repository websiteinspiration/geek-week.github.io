<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍽️ 👨🏾‍💻 👨🏽‍🎤 DNSパケット構造 📫 👩🏿‍🤝‍👩🏾 🤨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="序文
 私は、いわば楽しみのために、DNSスニファーを書くことにしました。私のシステムで解決しているアドレスを確認してください。プロトコルは古く、たくさんのドキュメントがあるはずです。たくさんの。しかし、すべての記事は非常に不完全で、最も興味深い瞬間に終わります。はい、rfc1035がありますが、ロ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>DNSパケット構造</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478652/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/v0/ri/zj/v0rizjyqwkrweowxbnclgezgqfm.png"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序文</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は、いわば楽しみのために、DNSスニファーを書くことにしました。</font><font style="vertical-align: inherit;">私のシステムで解決しているアドレスを確認してください。</font><font style="vertical-align: inherit;">プロトコルは古く、たくさんのドキュメントがあるはずです。</font><font style="vertical-align: inherit;">たくさんの。</font><font style="vertical-align: inherit;">しかし、すべての記事は非常に不完全で、最も興味深い瞬間に終わります。</font><font style="vertical-align: inherit;">はい、rfc1035がありますが、ロシア語で説明をお願いします。</font><font style="vertical-align: inherit;">実際、経験の蓄積とパッケージの分析により、この記事は熟成してきました。</font><font style="vertical-align: inherit;">DNSとは何かを理解し、要求と応答があることを理解している人向けに設計されています。</font><font style="vertical-align: inherit;">このプロトコルの構造を少し理解したい人のために。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事には理論が含まれており、その後少し練習します。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSパケット構造</font></font></h1><br>
<pre><code class="cpp hljs">    +---------------------+<font></font>
    |        Header       | <font></font>
    +---------------------+<font></font>
    |       Question      |  <font></font>
    +---------------------+<font></font>
    |        Answer       |  <font></font>
    +---------------------+<font></font>
    |      Authority      |     <font></font>
    +---------------------+<font></font>
    |      Additional     |    <font></font>
    +---------------------+</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -12オクテットで構成されるDNSパケットのヘッダー。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">質問セクション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -このセクションでは、DNSクライアントがDNSサーバーにクエリを送信して、DNSレコードを解決（解決）するために必要な名前と、タイプ（NS、A、TXTなど）を通知します。応答すると、サーバーはこの情報をコピーして、同じセクションのクライアントに返します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回答セクション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -サーバーは、要求に対する回答または複数の応答をクライアントに通知します。ここでは、上記のデータが報告されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">権限のあるセクション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -DNS応答セクションに含まれる情報を取得した権限のあるサーバーに関する情報が含まれています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加のレコードセクション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -リクエストに関連する追加のレコードですが、質問に対する厳密な回答ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セクションにいくつかまたはいくつかのエントリがある場合があります。</font><font style="vertical-align: inherit;">すべては見出しによって決まります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNSヘッダー構造</font></font></h1><br>
<pre><code class="cpp hljs">                                    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>
      <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span>  <span class="hljs-number">7</span>  <span class="hljs-number">8</span>  <span class="hljs-number">9</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span><font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                      ID                       |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                    QDCOUNT                    |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                    ANCOUNT                    |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                    NSCOUNT                    |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                    ARCOUNT                    |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（16ビット）-このフィールドは、一意のトランザクション識別子として使用されます。</font><font style="vertical-align: inherit;">パケットが同じ「要求/応答」セッションに属し、16ビットを占めることを示します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1ビット）-このビットは、パケットが要求（QR = 0）か応答（QR = 1）かを識別するために使用されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オペコード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（4ビット）-このコードを使用すると、クライアントはリクエストのタイプを指定できます。通常の値は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0-標準リクエスト </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1-逆リクエスト </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2-サーバーのステータスを要求します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3-15-将来のために予約されています。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1ビット）-このフィールドはサーバーからのDNS応答でのみ意味があり、回答が信頼できるかどうかを報告します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1ビット）-このフラグは、既存の制限のためにサーバーがパケットに必要な情報をすべて送信できなかった場合に、応答パケットに設定されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1ビット）-この1ビットのフラグは要求で設定され、応答にコピーされます。リクエストにフラグが設定されている場合、これはクライアントがサーバーに中間の答えを伝えずにIPアドレスのみを返すようサーバーに要求することを意味します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1ビット）-応答でのみ送信され、サーバーが</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再帰</font><font style="vertical-align: inherit;">（3ビット）を</font><font style="vertical-align: inherit;">サポートしていることを報告します</font><font style="vertical-align: inherit;">-予約されており、常にゼロです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RCODE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （4ビット）-このフィールドは、要求が正常に完了したかエラーで完了したかをクライアントに通知するために使用されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0-要求がエラーなしで渡されたことを意味します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1-エラーは、サーバーがリクエストフォームを理解できなかったことが原因です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2-ネームサーバーの不正な操作によるこのエラー。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3-クライアントを許可する名前はこのドメインに存在しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4-サーバーはこのタイプの要求を満たすことができません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5-このコードは、管理上のセキュリティ制限のために、サーバーがクライアントの要求を満たすことができないことを意味します。</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QDCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（16ビット）-要求セクションのレコード数</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（16ビット）-応答セクションのレコード数</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（16ビット）-権限セクションのレコード数</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（16ビット）-追加レコードセクションのレコード数</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエストセクションの構造</font></font></h1><br>
<pre><code class="cpp hljs">                                    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>
      <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span>  <span class="hljs-number">7</span>  <span class="hljs-number">8</span>  <span class="hljs-number">9</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span><font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                                               |<font></font>
    /                     QNAME                     /<font></font>
    /                                               /<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                     QTYPE                     |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                     QCLASS                    |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QNAME-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各要求および応答レコードはNAMEで始まります。これは、このレコードがリンクされている、または「属している」ドメイン名です。一連のタグとしてエンコードされます。この時点で、さらに詳しく説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が見た記事では、元のDNSプロトコルが最初の2ビットで定義される2種類のラベルを提供していることを忘れています：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00（標準ラベル）-つまり、残りの6ビットがラベルの長さを決定し、その後に所定の数のオクテットが続きます。したがって、ラベルの長さは63バイトを超えることはできません（たとえば、nslookupは、長いラベルのあるホストを停止しようとすると、「正当な名前ではありません（ラベルが長すぎます）」というメッセージを表示します）。記録はコード0x00で終了します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
11（圧縮ラベル）-次の14ビットは、一連のラベルの開始アドレスへのリンクを定義します。</font><font style="vertical-align: inherit;">経験からわかるように、別のアドレスへの圧縮ラベルが含まれている場合もあります。</font><font style="vertical-align: inherit;">リクエストには、原則としてそのようなラベルはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、ラベルには値0x00（長さゼロ）を含めることができます。これは、ルートドメイン名（root）であることを意味します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NAMEの最大長は255以下です。これは、実装を容易にするためです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QTYPE-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探しているDNSレコードのタイプ（NS、A、TXTなど）。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QCLASS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定義要求クラス（インターネットの場合はIN）。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">応答セクションの構造</font></font></h1><br>
<pre><code class="cpp hljs">                                    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>
      <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span>  <span class="hljs-number">7</span>  <span class="hljs-number">8</span>  <span class="hljs-number">9</span>  <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span><font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                                               |<font></font>
    /                                               /<font></font>
    /                      NAME                     /<font></font>
    |                                               |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                      TYPE                     |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                     CLASS                     |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                      TTL                      |<font></font>
    |                                               |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    |                   RDLENGTH                    |<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|<font></font>
    /                     RDATA                     /<font></font>
    /                                               /<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAME</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -要求部におけるQNAMEと同じフォーマット。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TYPE-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースレコードのタイプ。</font><font style="vertical-align: inherit;">このリソースレコードの形式と目的を定義します。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLASS-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リソースレコードクラス。</font><font style="vertical-align: inherit;">理論的には、DNSはTCP / IPだけでなく他のタイプのネットワークでも使用できると信じられており、クラスフィールドのコードがネットワークのタイプを決定します。</font><font style="vertical-align: inherit;">基本的には、インターネットIN（コード0x0001の）</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TTL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - （時間にライブ）は、不適切なDNSサーバのキャッシュにこのリソースレコードの有効な蓄積時間です。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDLENGTH-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データフィールド長（RDATA）。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDATA-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データフィールド。その形式と内容は、レコードのタイプによって異なります。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">練習</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のリクエストとレスポンスからのパッケージを考えます。お気に入りのスニファーを起動し、habrahabr.ruを解決します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リクエスト</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/1r/p2/yd/1rp2ydf6wdmdjyp5ek0qureukya.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dnsヘッダー構造を分析しましょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクションID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0x9bce </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次はフラグです。 01 00はバイナリ値0'0000'0'0'1'0'000'0000として表されます（以下では、フラグの分割をより視覚的に表現するために、ビットをアポストロフィで区切ります）</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0-したがって、このパケットは要求です。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opcode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0000-標準リクエスト。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0-このフィールドはDNS回答でのみ意味があるため、常に0です。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0-このフィールドはDNS回答でのみ意味があるため、常に0です。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1-IPアドレスのみを返してください。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 0-サーバーによってのみ送信されます。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 000-常にゼロ、予約済みフィールド。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RCODE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてがエラーなしで進んだ</font><b><font style="vertical-align: inherit;">QDCOUNT</font></b><font style="vertical-align: inherit;"> = 00 01-要求セクションの1エントリ</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 00 00-要求では常に0、回答のセクション</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 00 00-要求では常に0、回答のセクション</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 00 00-リクエストは常に0 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。回答のセクション次に、リクエストとレスポンスのセクションがあります。 1つのエントリ。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のオクテットは0x09です。これをバイナリ値00'001001と想像してください。最初の2ビットは00になり、これは通常のラベルであることを意味します。タグの長さは9バイト（b001001）。 「68 61 62 72 61 68 61 62 72」これらは9バイトです。 「habrahabr」と表示されます（16進数）。進め。オクテット0x02。最初の2ビットは00で、次に長さが2バイトの通常のラベルです。こちらが「72 75」です。 「る」と書かれています。進め。オクテット0x00。これは、ホストエントリの終わりを意味します。 「habrahabr」と「ru」という2つの単語がありました。それらを1つのポイントと結合し、「habrahabr.ru」を取得します。これが要求したホストです。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QTYPE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">0x0001-</font></b><font style="vertical-align: inherit;">タイプA（ホストアドレス要求）に</font><font style="vertical-align: inherit;">対応</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QCLASS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">0x0001-</font></b><font style="vertical-align: inherit;">クラスINに対応</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回答</font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/mx/oc/ks/mxockspvfkwpgsyk8agkrzsqvps.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
dnsヘッダーの構造を分析しましょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トランザクションID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 0x9bce。リクエストのIDと完全に一致している必要があります。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再びフラグ。 81 80バイナリ値1'0000'0'0'1'1'000'0000 </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1で</font><font style="vertical-align: inherit;">表す</font><font style="vertical-align: inherit;">-したがって、このパケットが答えです。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opcode</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0000-標準リクエスト。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0-サーバーはドメインに対して権限がありません。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0-すべての情報が1つのパッケージに収まります。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1-IPアドレスのみを返してください。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 1-サーバーは再帰をサポートします。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 000-常にゼロ、予約済みフィールド。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RCODE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてがエラーなしで</font><b><font style="vertical-align: inherit;">実行されましたQDCOUNT</font></b><font style="vertical-align: inherit;"> = 00 01-要求セクションに</font><font style="vertical-align: inherit;">1つのエントリ</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ANCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 00 01- </font><b><font style="vertical-align: inherit;">NSCOUNT</font></b><font style="vertical-align: inherit;">応答に1つのエントリがあり</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 00 00-リクエストは常に0、回答のセクション</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARCOUNT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 00 00-リクエストは常に0、回答のセクション</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、リクエストセクションとレスポンスセクションがあります。 2つのエントリ。リクエストの1つのレコード、回答のある別のレコード。リクエストセクションはペイントしません。リクエストパッケージと同じ1v1になります。回答セクションに進んでください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のオクテットは0x09で、最初の2ビットは00です。これは、長さが9バイトの通常のラベルを意味します。 9バイトを読み取り、「HABRAHABR」を取得します。次は0XC0（b11000000）です。ご覧のとおり、最初の2ビットの値は11です。これは、圧縮リンクがあることを意味します。次の8ビット（0x16（b00010110）がある）を調べ、現在の最後の6ビットと組み合わせます。 b00000000010110を取得します。 DNSパケットの22番目のバイト（02 72 75 00）にリンクします。オクテット22から、再びラベルを取得します。同じルールで。 「.ru」を取得します。私たちは受け取ったすべてのものを結合します。それは「HABRAHABR.ru」であることがわかります。これはホストであり、これについては後で説明します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QTYPE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">0x0001-</font></b><font style="vertical-align: inherit;">タイプA（ホストアドレス要求）に</font><font style="vertical-align: inherit;">対応</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QCLASS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">0x0001-</font></b><font style="vertical-align: inherit;">クラスINに対応</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TTL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 0x00000c90-データアップタイム3216秒。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDLENGTH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">0x0004-</font></b><font style="vertical-align: inherit;">データ長は4オクテットです。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDATA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = "b2 f8 ed 44"。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すでに述べたように、フォーマットと内容は録音のタイプによって異なります。</font><font style="vertical-align: inherit;">レコードタイプは「A」です。</font><font style="vertical-align: inherit;">したがって、IPを取得するには、4バイトを読み取る必要があります。</font><font style="vertical-align: inherit;">各バイトは、16進数で書かれた、IPアドレスの対応するオクテットです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
IP：b2.f8.ed.44または「178.248.237.68」を取得します。</font><font style="vertical-align: inherit;">受け取るために必要なもの。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、タイプNSの場合、形式は次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+<font></font>
    /                   NSDNAME                     /<font></font>
    /                                               /<font></font>
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、QNAMEのルールに従って名前を読み取ります。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja478638/index.html">db-tree：データベースの検索とナビゲーション</a></li>
<li><a href="../ja478640/index.html">オープンソースの自動運転車</a></li>
<li><a href="../ja478642/index.html">MOXA Nport-インサイドルック</a></li>
<li><a href="../ja478646/index.html">JetQuad：垂直離着陸を備えた航空機</a></li>
<li><a href="../ja478650/index.html">ドーン3D</a></li>
<li><a href="../ja478654/index.html">推定分布カウント-ほとんどの場合、ソートを再発明</a></li>
<li><a href="../ja478658/index.html">親切に目を覚ますには？新しい夜明けプラス光目覚まし時計</a></li>
<li><a href="../ja478660/index.html">エンジニアはCERNで粒子トラップを最適化</a></li>
<li><a href="../ja478666/index.html">YM3812のUSBサウンドカード</a></li>
<li><a href="../ja478670/index.html">攻撃者がテレグラムで通信を読み取る方法。そして、どうすればそれを防ぐことができますか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>