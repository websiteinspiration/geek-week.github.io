<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèæ üèÜ üôç Mais uma vez cerca de 433 MHz transmissores e receptores üßóüèΩ üï∫üèæ üë®‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O conjunto mais simples de receptor e transmissor ISM de 433 MHz ganhou popularidade merecida entre os amantes de eletr√¥nicos. Os kits s√£o baratos (me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Mais uma vez cerca de 433 MHz transmissores e receptores</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491530/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O conjunto mais simples de receptor e transmissor </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de </font><font style="vertical-align: inherit;">433 MHz ganhou popularidade merecida entre os amantes de eletr√¥nicos. Os kits s√£o baratos (mesmo no Chip-Deep voc√™ pode compr√°-los por 300 rublos, e no Ali, dizem eles, geralmente por cinquenta d√≥lares), s√£o simples e confi√°veis. Al√©m disso (que voc√™ provavelmente n√£o suspeita), este √© o m√©todo mais abrangente e penetrante de troca de dados sem fio - um sinal a uma frequ√™ncia de 433 MHz passa muito melhor por obst√°culos e opera a uma dist√¢ncia maior do que na popular faixa de 2,4 GHz (433 O MHz √© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">completamente atrasado por uma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parede de meio metro de concreto e o Wi-Fi j√° est√° morrendo 10 cent√≠metros). Eu admito que apareceu recentemente m√≥dulos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MBee-868</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por estarem equipados com uma antena (direcional) apropriada, eles ‚Äúdisparam‚Äù ainda mais, mas s√£o pelo menos uma ordem de magnitude mais cara, mais dif√≠cil de conectar, exigem gerenciamento e pr√©-configura√ß√£o de economia de energia. </font><font style="vertical-align: inherit;">Al√©m disso, a frequ√™ncia de 868 MHz passa por obst√°culos duas vezes mais ruins (embora, √© claro, seja incomparavelmente melhor que a frequ√™ncia de 2,4 GHz). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a04/2bb/c3c/a042bbc3ca312c739041b507e7ca4b5e.png" width="500"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muito foi escrito sobre transmissores e receptores de 433 MHz (inclusive no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hub)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , √© claro. </font><font style="vertical-align: inherit;">No entanto, parece que ningu√©m sabe como incluir corretamente este kit no circuito por algum motivo estranho. </font><font style="vertical-align: inherit;">Quando mais uma vez li </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que o kit ‚Äú </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tinha 8 metros dentro da linha de vis√£o, o 9¬∫ metro n√£o podia ser dominado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">", Minha paci√™ncia estalou. </font><font style="vertical-align: inherit;">Que outros 8 metros ?! </font><font style="vertical-align: inherit;">Aos 40-50, eu teria acreditado, embora, na realidade, provavelmente, o alcance seja ainda maior.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale a pena notar que eu resolvo ainda mais o problema de criar uma linha para transfer√™ncia de dados arbitr√°rios, e n√£o apenas controlar quaisquer tomadas inteligentes ou modelos de barcos a motor. Minha tarefa √© mais complicada, mas ainda assim a dist√¢ncia da opera√ß√£o confi√°vel √© muito maior. Al√©m disso, em uma tarefa como essa, √© importante n√£o apenas e n√£o tanto a dist√¢ncia dentro da linha de vis√£o (pode servir apenas para compara√ß√£o), mas a capacidade de penetrar em v√°rios obst√°culos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Meu kit trabalha fora da cidade a uma dist√¢ncia de cerca de 25 a 30 metros em um √¢ngulo agudo em rela√ß√£o √† parede de toras, de modo que aproximadamente um metro (no total) de paredes e divis√≥rias, parcialmente protegidas pelo isolamento da pel√≠cula, esteja no caminho do sinal. A uma dist√¢ncia muito menor, quase diretamente atr√°s da parede, o WiFi j√° est√° perdendo completamente o sinal. Na cidade, o sinal termina de uma extremidade a outra de um apartamento urbano de tr√™s quartos atrav√©s de duas divis√≥rias internas, bem como da varanda, onde em uma linha reta entre o transmissor e o receptor pelo menos 80 cent√≠metros de alvenaria e uma parti√ß√£o de gesso. N√£o usei op√ß√µes de kit mais caras mencionadas na an√°lise acima.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma vantagem adicional do kit √© que, em pausas, o transmissor n√£o consome nada e sem modos especiais de suspens√£o, simplesmente pelo princ√≠pio de seu dispositivo (a corrente de consumo em repouso √© compar√°vel √†s correntes de fuga do coletor de um transistor bloqueado, ou seja, cerca de 100 nA). </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver quais s√£o as armadilhas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o do transmissor</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O transmissor (chamado FS1000A), como podemos ver no diagrama abaixo, √© o gerador mais simples baseado em um ressonador SAW de 433 MHz. </font><font style="vertical-align: inherit;">O gerador √© montado no transistor Q1, e o transistor Q2, com base no qual os dados digitais s√£o fornecidos, √© simplesmente uma chave que conecta o gerador √† energia (ao barramento GND) na presen√ßa de um n√≠vel alto (unidade l√≥gica) na entrada. </font><font style="vertical-align: inherit;">A energia pode variar de 5 a 12 volts e, de acordo com os fabricantes, quanto maior a energia, mais a conex√£o funciona.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/a21/50c/737/a2150c737eb648ed465e060aa2d178ae.png" width="400"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o notei as vantagens fundamentais do aumento da nutri√ß√£o como parte da minha tarefa. No entanto, n√£o se deve negligenciar o fato de que n√£o h√° requisitos especiais de energia aqui e, com o aumento da tens√£o, o dispositivo s√≥ funcionar√° melhor. √â conveniente conectar o transmissor diretamente √† voltagem de um adaptador de 9-12 volts, bateria ou um conjunto de 6 baterias (pino Vin Arduino). Com uma fonte de alimenta√ß√£o n√£o estabilizada, que pode exceder 12 volts (como, por exemplo, com baterias), costumo desacoplar o transmissor do circuito principal com um estabilizador de 9 volts separado (voc√™ pode usar o 78L09 mais simples) e n√£o vejo diferen√ßa na opera√ß√£o entre os 9 e 12 volts. Com o Uno ou o Nano, voc√™ pode usar o estabilizador de 5 volts incorporado para alimentar o pr√≥prio controlador e outros circuitos (por exemplo, sensores)e para o Mini (especialmente seus clones baratos), aconselho a colocar um estabilizador de 5 volts separado, conectando-o ao pino de 5V.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se notar que recentemente surgiram transmissores que parecem um pouco fora do padr√£o (veja a Fig. Abaixo). Aconteceu que a aus√™ncia de um acelerador L1 (tr√™s voltas), do qual restavam apenas orif√≠cios - uma fic√ß√£o, foi simplesmente substitu√≠da pelo componente SMD correspondente. O pior nesta op√ß√£o √© diferente: a impress√£o superficial pode ser enganosa em rela√ß√£o √† conex√£o dos pinos e da alimenta√ß√£o de dados. A conex√£o correta √© mostrada na figura, √© a mesma para todas as op√ß√µes:</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/db4/cfc/e17/db4cfce176c768cc5f3504edfbf91513.png" width="250"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais impressionante nesse assunto √© que, quando os dados e a energia s√£o misturados, o transmissor continua a trabalhar em dist√¢ncias curtas! </font><font style="vertical-align: inherit;">Se voc√™ olhar para o circuito, entender√° o que √©: a base Q2 atrav√©s do resistor est√° conectada √† fonte de alimenta√ß√£o, o transistor est√° sempre aberto e n√£o afeta a opera√ß√£o do circuito. </font><font style="vertical-align: inherit;">Um n√≠vel l√≥gico alto no barramento de for√ßa apenas liga o gerador no momento certo. </font><font style="vertical-align: inherit;">Os absurdos come√ßam a certa dist√¢ncia - √© claro que, a partir de uma conclus√£o l√≥gica, a fonte de energia √© ruim.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conex√£o do receptor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao comprar um receptor (pode ser chamado MX-RM-5V ou XD-RF-5V), preste aten√ß√£o ao comprimento dos terminais - de alguma maneira encontrei um lote inteiro com pinos encurtados, o que fez com que o </font><font style="vertical-align: inherit;">receptor ca√≠sse </font><font style="vertical-align: inherit;">do conector </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PBS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> padr√£o </font><font style="vertical-align: inherit;">com a menor distor√ß√£o e sua Eu tive que me conectar especificamente ao quadro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O circuito do receptor √© muito mais complicado (n√£o o reproduzirei, mas voc√™ pode encontr√°-lo, por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Ele deve receber e amplificar um sinal de alta frequ√™ncia, filtrar a frequ√™ncia de 433 MHz, isolar rajadas e convert√™-las em n√≠veis l√≥gicos. O receptor possui um afunilamento de sintonia (no meio da placa), mas sem instrumentos precisos para medir as caracter√≠sticas de amplitude-frequ√™ncia, eu n√£o recomendo torcer - provavelmente, voc√™ n√£o melhorar√° nada, mas apenas o estragar√°.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° a uma pequena dist√¢ncia o sinal ter√° muito menos interfer√™ncia, √© claro que devemos lidar com a interfer√™ncia em todas as frentes: e m√©todos de circuitos e software. As bibliotecas fazem a √∫ltima coisa para n√≥s, mas n√£o importa qual matem√°tica seja usada no processamento de software, √© aconselh√°vel fazer tudo primeiro para que a unidade l√≥gica na sa√≠da apare√ßa apenas quando um sinal √∫til explodir e n√£o aparecer na presen√ßa de interfer√™ncia. Em outras palavras, seria bom sintonizar ao m√°ximo antecipadamente as interfer√™ncias durante a recep√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√©todo padr√£o de redu√ß√£o de ru√≠do, conhecido em minha √©poca por todo aluno que montou pelo menos um r√°dio ou amplificador, √© que, para os n√≥s sens√≠veis √† interfer√™ncia, √© necess√°rio fazer uma fonte de alimenta√ß√£o separada, isolada ao m√°ximo de outros circuitos. Voc√™ pode fazer isso de maneiras diferentes: depois de instalar um diodo zener separado, agora eles isolam a pot√™ncia de um n√≥ problem√°tico com um filtro LC (isso √© recomendado, por exemplo, para ADCs, consulte as fichas t√©cnicas dos controladores AVR). Por√©m, em nossas condi√ß√µes, quando os componentes modernos s√£o pequenos e baratos, √© mais f√°cil colocar um estabilizador separado do restante no receptor.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/bd3/85b/94a/bd385b94af583fa8c188053297965c1b.png" width="400"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um estabilizador, por exemplo, do tipo LP2950-5.0 mais dois capacitores necess√°rios para ele na op√ß√£o mais barata (quando os dois capacitores s√£o de cer√¢mica, na faixa de 1-3,3 microfarads), adicionar√° sessenta no m√°ximo ao custo do seu circuito. Mas prefiro n√£o economizar: na sa√≠da coloquei uma cer√¢mica comum e na entrada coloquei um eletr√≥lito (10 a 100 microfarads), al√©m disso, no estado s√≥lido (pol√≠mero) ou t√¢ntalo. Os capacitores de cer√¢mica podem ser dispensados ‚Äã‚Äãl√° e ali, se a tens√£o de entrada de 7 a 12 volts vier de baterias ou de outro estabilizador anal√≥gico. Fontes estabilizadas pulsadas e os retificadores n√£o estabilizados mais simples requerem filtragem adicional. Voc√™ pode usar eletr√≥lito de alum√≠nio barato se colocar um micro-radar 0,1 de cer√¢mica paralelo a ele,√© ainda melhor colocar uma indut√¢ncia em s√©rie na entrada de v√°rias fra√ß√µes ou unidades de miligenri.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O estabilizador deve ser instalado diretamente pr√≥ximo ao receptor, o comprimento dos condutores deve ser m√≠nimo. Em vez do LP2950, ‚Äã‚Äãvoc√™ pode usar o LM2931 ou similar com uma pequena tens√£o de passagem (isso √© especialmente importante se o circuito for alimentado por baterias - para um LM78L05 regular, a tens√£o de entrada deve ser de pelo menos 7,5 e, de prefer√™ncia, de 8 a 9 volts).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comparando com o caso de alimentar o receptor diretamente do Arduino, como recomendado em todas as publica√ß√µes (n√£o vi exce√ß√µes), voc√™ ficar√° surpreso com o efeito obtido - o alcance e a capacidade de penetrar pelas paredes imediatamente aumentam significativamente. O receptor, juntamente com o estabilizador, pode ser realizado em uma pequena caixa separada por conveni√™ncia. Voc√™ pode conectar sua sa√≠da ao controlador no corpo principal com qualquer fio de tr√™s fios (duas fontes de alimenta√ß√£o e um condutor de sinal) de at√© 3 metros de comprimento e talvez mais. Isso √© mais conveniente porque as antenas ainda s√£o necess√°rias e, de acordo com as regras, ser√° melhor que elas sejam paralelas uma √† outra no espa√ßo, e nem sempre √© poss√≠vel colocar caixas grandes para que as antenas fiquem na orienta√ß√£o correta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na vers√£o mais simples, como antenas, voc√™ pode fazer com peda√ßos de fio de n√∫cleo √∫nico com uma se√ß√£o transversal de pelo menos 0,5 mm e comprimento de 17 cm ¬± 1-3 mm. </font><font style="vertical-align: inherit;">N√£o use fios de montagem tran√ßados! </font><font style="vertical-align: inherit;">Antenas espirais mais compactas est√£o √† venda, mas eu pessoalmente n√£o testei sua efic√°cia. </font><font style="vertical-align: inherit;">A ponta da antena do transmissor e do receptor √© selada no orif√≠cio correspondente no canto da placa (n√£o se engane na vers√£o atualizada do transmissor - a palavra ANT tamb√©m est√° fora do lugar, veja a fig. Acima).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gera√ß√£o e processamento de dados transmitidos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© a segunda grande desvantagem da maioria das revis√µes sobre o nosso t√≥pico: os autores limitam-se a algum problema local, sem formul√°-lo de uma maneira geral, como transferir dados arbitr√°rios em um pacote. Como voc√™ entendeu a partir da descri√ß√£o acima, apenas uma sequ√™ncia simples de bits pode ser transmitida pelo nosso conjunto. A biblioteca padr√£o do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualWire os</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> codifica de maneira especial (cada tetrad √© codificado com 6 bits, um cabe√ßalho de sincroniza√ß√£o √© adicionado na frente e uma soma de verifica√ß√£o para todo o pacote √© adicionada) e transforma a sa√≠da em uma seq√º√™ncia de bytes mais familiar. Mas o programador j√° tem que lidar com isso sozinho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, assumimos que o transmissor e o receptor est√£o conectados ao Arduino. Al√©m do VirtualWire, em conex√£o com o boom das ‚Äúcasas inteligentes‚Äù, existem muitas outras coisas, como o RC-Switch ou o RemoteSwitch, mas eles est√£o focados em outras tarefas, e claramente n√£o vale a pena us√°-los para transferir dados arbitr√°rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O comprimento m√°ximo de uma √∫nica mensagem no VirtualWire √© de 27 bytes (consulte a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). A transmiss√£o de uma mensagem completa (√© complementada automaticamente com uma assinatura 0xb38, um valor de comprimento de mensagem e uma soma de verifica√ß√£o) na velocidade escolhida de 1200 bps √© de 0,35 segundos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto mais, a prop√≥sito, a velocidade de transmiss√£o selecionada, o alcance da transmiss√£o ser√° menor. Com a experi√™ncia de usar o RS-232, sabe-se que, com o alcance crescente, a velocidade de transmiss√£o permitida diminui exponencialmente: a uma velocidade de 19.200, uma linha n√£o blindada percorre 15 metros, 9600 - 150 metros e a uma velocidade de 1200 - mais de um quil√¥metro. Seria interessante descobrir experimentalmente a natureza dessa depend√™ncia para o nosso caso, porque muito aqui depende da matem√°tica usada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A inicializa√ß√£o do transmissor no VirtualWire √© assim:</font></font><br>
<br>
<pre><code class="cpp hljs">. . . . .
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;VirtualWire.h&gt;</span></span><font></font>
. . . . .<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  vw_setup(<span class="hljs-number">1200</span>); <span class="hljs-comment">//   VirtualWire</span>
  vw_set_tx_pin(<span class="hljs-number">10</span>);   <span class="hljs-comment">//   VirtualWire D10</span><font></font>
. . . . .<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisaremos os princ√≠pios da gera√ß√£o de dados usando um exemplo espec√≠fico. Vamos ter um sensor remoto de temperatura e umidade. Fornece valores (vari√°veis ‚Äã‚Äãde temperatura e umidade) na forma de um n√∫mero real com um sinal (float). Para facilitar a compreens√£o no final de recebimento, todos reduziremos para um n√∫mero inteiro positivo com o n√∫mero de casas decimais de pelo menos 4, converteremos os bits individualmente em caracteres ASCII, transferiremos a string resultante e executaremos opera√ß√µes reversas no final de recebimento. Obviamente, voc√™ pode simplificar a tarefa (por exemplo, sem convers√£o para ASCII e encurtar os n√∫meros), mas dessa forma acaba sendo o mesmo para quase todos os tipos de dados digitais, o que simplifica a desmontagem ao receber. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na pr√°tica, √© conveniente usar o tipo String para compor uma mensagem, algo como isto:</font></font><br>
<br>
<pre><code class="cpp hljs">. . . . .
<span class="hljs-comment">//    </span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ledPin 13 <span class="hljs-comment">//  (D13,  19 ATmega) </span></span>
<span class="hljs-keyword">char</span> msg[<span class="hljs-number">13</span>];
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> tmpr=<span class="hljs-number">0</span>;
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> hum=<span class="hljs-number">0</span>;<font></font>
. . . . .<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  delay(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 1 c</span>
<span class="hljs-keyword">float</span> temperature;
<span class="hljs-keyword">float</span> humidity;<font></font>
. . . . .  <span class="hljs-comment">//   temperature  humidity  </span>
<span class="hljs-comment">//       4 :</span>
  tmpr = temperature*<span class="hljs-number">10</span>+<span class="hljs-number">2731</span>; <span class="hljs-comment">//2731 =     </span>
<span class="hljs-comment">//    4 :</span>
  hum = humidity*<span class="hljs-number">10</span>+<span class="hljs-number">1000</span>; 
<span class="hljs-comment">//  :</span>
  digitalWrite (ledPin,HIGH); <span class="hljs-comment">//  ‚Äî  </span>
  String strMsg=<span class="hljs-string">"DAH"</span>; <span class="hljs-comment">// - </span>
  strMsg+=tmpr; <span class="hljs-comment">//  </span>
  strMsg+=hum; <span class="hljs-comment">// </span>
  strMsg.toCharArray(msg,<span class="hljs-number">12</span>); <span class="hljs-comment">//   , 12 ‚Äì  </span>
<span class="hljs-comment">//  :</span>
  vw_send((<span class="hljs-keyword">uint8_t</span> *)msg, <span class="hljs-built_in">strlen</span>(msg)); <span class="hljs-comment">//  </span>
  vw_wait_tx(); <span class="hljs-comment">//   </span>
  delay(<span class="hljs-number">500</span>); <span class="hljs-comment">// 500 </span>
  digitalWrite (ledPin, LOW); <span class="hljs-comment">//  ‚Äî  </span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ precisar transferir n√∫meros mais precisos com um grande n√∫mero de d√≠gitos, basta aumentar o comprimento da matriz msg. As vari√°veis ‚Äã‚Äãglobais ‚Äúvol√°teis‚Äù tmpr e hum s√£o necess√°rias se voc√™ calcular a m√©dia de v√°rias leituras, caso contr√°rio, elas tamb√©m podem ser declaradas locais dentro da fun√ß√£o loop (). A mensagem, como voc√™ v√™, consiste nos valores convertidos de temperatura e umidade, em cadeias ASCII de quatro bytes cada, precedidas por uma cadeia de tr√™s caracteres ‚ÄúDAH‚Äù (os caracteres podem ser outros da tabela ASCII). Essa √© uma assinatura que permitir√° que voc√™ diferencie essa mensagem entre as poss√≠veis outras enviadas por dispositivos semelhantes. N√£o negligencie a assinatura, mesmo se voc√™ acredita que outros dispositivos pr√≥ximos a esse intervalo n√£o s√£o esperados, ao mesmo tempo em que serve como uma garantia adicional da integridade dos dados recebidos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe tamb√©m que, ao converter uma string em uma matriz, voc√™ deve especificar um caractere a mais que o comprimento total da mensagem (3 + 4 + 4 = 11), isso leva em considera√ß√£o o caractere zero que fecha a string. </font><font style="vertical-align: inherit;">E o tamanho da matriz msg [] deve ser especificado com uma margem e pode ser qualquer, neste caso de 13 a 27 bytes. </font><font style="vertical-align: inherit;">Ao transferir, ele ainda ser√° enviado exatamente como a fun√ß√£o strlen (msg) retornar√°, ou seja, 11 bytes + um caractere nulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na parte receptora, a matriz resultante de c√≥digos ASCII dever√° ser analisada. </font><font style="vertical-align: inherit;">Mas primeiro voc√™ precisa aceit√°-lo. </font><font style="vertical-align: inherit;">Para inicializar a recep√ß√£o, s√£o executadas as seguintes a√ß√µes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;VirtualWire.h&gt;</span></span>
<span class="hljs-keyword">char</span> str[<span class="hljs-number">5</span>];     ASCII  
  <span class="hljs-keyword">uint8_t</span> buf [VW_MAX_MESSAGE_LEN];  <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">uint8_t</span> buflen = VW_MAX_MESSAGE_LEN;  <span class="hljs-comment">// max   </span><font></font>
. . . . .<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{<font></font>
  vw_set_rx_pin(<span class="hljs-number">2</span>); <span class="hljs-comment">//D2   VirtualWire</span>
  vw_setup(<span class="hljs-number">1200</span>); <span class="hljs-comment">//   VirtualWire</span><font></font>
. . . . .<font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, a t√©cnica para analisar uma linha √© a seguinte:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{<font></font>
  vw_rx_start();  <span class="hljs-comment">//  </span>
  buflen = VW_MAX_MESSAGE_LEN; <span class="hljs-comment">//    </span>
 <span class="hljs-keyword">if</span> (vw_have_message()) { <span class="hljs-comment">// </span>
 <span class="hljs-keyword">if</span> (vw_get_message(buf, &amp;buflen)) <span class="hljs-comment">//   </span><font></font>
  {<font></font>
    vw_rx_stop(); <span class="hljs-comment">//   :</span>
        <span class="hljs-keyword">for</span> (byte i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">3</span>; i++)  <span class="hljs-comment">//    </span>
                str[i]= buf[i]; <span class="hljs-comment">// </span>
                str[<span class="hljs-number">3</span>]=<span class="hljs-string">'\0'</span>;
      <span class="hljs-keyword">if</span> ((str[<span class="hljs-number">0</span>]==<span class="hljs-string">'D'</span>)&amp;&amp;(str[<span class="hljs-number">1</span>]==<span class="hljs-string">'A'</span>)&amp;&amp;(str[<span class="hljs-number">2</span>]==<span class="hljs-string">'H'</span>)) {
<span class="hljs-comment">// ,  </span>
       <span class="hljs-keyword">for</span> (byte i=<span class="hljs-number">3</span>;i&lt;<span class="hljs-number">7</span>;i++)  <span class="hljs-comment">//    </span>
                str[i<span class="hljs-number">-3</span>]= buf[i]; <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">int</span> tmpr=atoi(str); <span class="hljs-comment">//   </span>
      tmpr=tmpr<span class="hljs-number">-2731</span>; <span class="hljs-comment">// 2731,     </span>
. . . . .<span class="hljs-comment">//    10    float,  </span>
. . . . . <span class="hljs-comment">//    -</span>
<span class="hljs-comment">// :</span>
      <span class="hljs-keyword">for</span> (byte i=<span class="hljs-number">7</span>;i&lt;<span class="hljs-number">11</span>;i++)  <span class="hljs-comment">//    </span>
                str[i<span class="hljs-number">-7</span>]= buf[i]; <span class="hljs-comment">//    </span>
      <span class="hljs-keyword">int</span> hh = atoi(str); <span class="hljs-comment">//   </span>
      hh=(hh<span class="hljs-number">-1000</span>)/<span class="hljs-number">10</span>;
      <span class="hljs-keyword">if</span> (hh&gt;<span class="hljs-number">99</span>) hh=<span class="hljs-number">99</span>; <span class="hljs-comment">//   %,  </span>
. . . . . <span class="hljs-comment">// -</span>
   } <span class="hljs-comment">//end   DAT</span>
  } <span class="hljs-comment">//end  </span>
 } <span class="hljs-comment">// </span>
} <span class="hljs-comment">// end loop</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espero que agora voc√™ tenha menos perguntas sobre o uso desses dispositivos baratos e f√°ceis de usar.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt491518/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 501 (18/02/2020/24/02/2020)</a></li>
<li><a href="../pt491520/index.html">Converter xls em xlsx e xml em c #</a></li>
<li><a href="../pt491522/index.html">Por que as mulheres vivem mais</a></li>
<li><a href="../pt491524/index.html">Stas Afanasyev. Juno. Pipelines baseados em io.Reader / io.Writer. Parte 2</a></li>
<li><a href="../pt491528/index.html">Minha experi√™ncia est√° realizando 1000 entrevistas. Sinopse do relat√≥rio por Yegor Bugaenko</a></li>
<li><a href="../pt491532/index.html">Laravel + Docker + Gitlab. Por onde come√ßar</a></li>
<li><a href="../pt491534/index.html">Um breve guia para usar o GDB</a></li>
<li><a href="../pt491536/index.html">YouTube - Erro. Por favor, tente novamente mais tarde. ID de reprodu√ß√£o: <...></a></li>
<li><a href="../pt491540/index.html">Redes para um especialista em TI iniciante. Base obrigat√≥ria</a></li>
<li><a href="../pt491542/index.html">Transforma√ß√£o de cores: pesquisas de tabela de desbaste</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>