<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜„ ğŸ¤°ğŸ¿ ğŸ“ ä½¿æ‚¨ç°æœ‰çš„ä¸šåŠ¡è§£å†³æ–¹æ¡ˆé€‚åº”SwiftUIã€‚ç¬¬2éƒ¨åˆ† ğŸ“ ğŸ¤¸ğŸ½ ğŸ€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¥å¤§å®¶æœ‰ç¾å¥½çš„ä¸€å¤©ï¼æœ‰äº†ä½ ï¼Œæˆ‘ï¼Œå®‰å¨œZharkovaï¼Œé¢†å…ˆçš„ç§»åŠ¨å¼€å‘è€…Usetechã€‚
 åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå·²ç»å¦‚ä½•é€‚åº”ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åœ¨SwiftUIä¸€ä¸ªé¡¹ç›®çš„æƒ…å†µã€‚å¦‚æœæ‚¨å¯¹è¿™é¡¹æŠ€æœ¯ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œå»ºè®®æ‚¨ç†Ÿæ‚‰è¯¥ä¸»é¢˜çš„ç®€è¦ä»‹ç»ã€‚
 
 å› æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åœ¨SwiftUI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ä½¿æ‚¨ç°æœ‰çš„ä¸šåŠ¡è§£å†³æ–¹æ¡ˆé€‚åº”SwiftUIã€‚ç¬¬2éƒ¨åˆ†</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500386/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¥å¤§å®¶æœ‰ç¾å¥½çš„ä¸€å¤©ï¼</font><font style="vertical-align: inherit;">æœ‰äº†ä½ ï¼Œæˆ‘ï¼Œå®‰å¨œZharkovaï¼Œé¢†å…ˆçš„ç§»åŠ¨å¼€å‘è€…</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usetechã€‚</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå·²ç»å¦‚ä½•é€‚åº”ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åœ¨SwiftUIä¸€ä¸ªé¡¹ç›®çš„æƒ…å†µã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å¯¹è¿™é¡¹æŠ€æœ¯ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œå»ºè®®æ‚¨ç†Ÿæ‚‰</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥ä¸»é¢˜</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ç®€è¦ä»‹ç»</font></a><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åœ¨SwiftUIä¸Šçš„åº”ç”¨ç¨‹åºä¸­ä¸ºæ ‡å‡†iOSåº”ç”¨ç¨‹åºä½¿ç”¨ç°æˆçš„åº“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬é‡‡ç”¨ç»å…¸çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨SDWebImageåº“å¼‚æ­¥ä¸Šä¼ å›¾åƒã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m8/b2/we/m8b2wexc6kdy6r2vrbs28x2thsq.png" width="40%"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå°†åº“ä½¿ç”¨çš„å›¾åƒå°è£…åœ¨ImageManagerä¸­ï¼Œè¯¥å›¾åƒè°ƒç”¨ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDWebImageDownloader</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDImageCache</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”¨äºä¸‹è½½å›¾åƒå’Œç¼“å­˜ã€‚</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æŒ‰ç…§ä¼ ç»Ÿï¼Œä¸æ¥æ”¶UIImageViewç»“æœçš„é€šä¿¡ä»¥ä¸¤ç§æ–¹å¼å®ç°ï¼š </font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å°†å¼±é“¾æ¥ä¼ é€’åˆ°åŒä¸€UIImageViewï¼› </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å°†é—­åŒ…ä¼ é€’ç»™ImageManageræ–¹æ³•</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nb/gs/_g/nbgs_gqfxcqejinm7hcprmlhx14.png" width="75%"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ï¼Œå°†å¯¹ImageManagerçš„è°ƒç”¨å°è£…åœ¨UIImageViewæ‰©å±•ä¸­ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UIImageView</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">(by key: String)</span></span> {
        <span class="hljs-type">ImageManager</span>.sharedInstance.setImage(toImageView: <span class="hljs-keyword">self</span>, forKey: key)<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨åç»§ç±»ä¸­ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedImageView</span> : <span class="hljs-title">UIImageView</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _imageUrl: <span class="hljs-type">String?</span>
    <span class="hljs-keyword">var</span> imageUrl: <span class="hljs-type">String?</span>  {
        <span class="hljs-keyword">get</span> {
            <span class="hljs-keyword">return</span> _imageUrl<font></font>
        }<font></font>
        <span class="hljs-keyword">set</span> {
            <span class="hljs-keyword">self</span>._imageUrl = newValue
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url = newValue, !url.isEmpty {
                <span class="hljs-keyword">self</span>.setup(by: url)<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span><span class="hljs-params">(by key: String)</span></span> {
        <span class="hljs-type">ImageManager</span>.sharedInstance.setImage(toImageView: <span class="hljs-keyword">self</span>, forKey: key)<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•å°†æ­¤è§£å†³æ–¹æ¡ˆå›ºå®šåˆ°SwiftUIã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œåœ¨è¿›è¡Œè°ƒæ•´æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘æ¡†æ¶çš„ä»¥ä¸‹åŠŸèƒ½ï¼š</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -è§†å›¾-ç»“æ„ã€‚</font><font style="vertical-align: inherit;">ä¸æ”¯æŒç»§æ‰¿</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ym/8x/hc/ym8xhcod2mar5nwlioi6eo60kxc.png" width="50%"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -é€šå¸¸æ„ä¹‰ä¸Šçš„æ‰©å±•æ˜¯æ²¡æœ‰ç”¨çš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€äº›æ–¹æ³•æ¥æ‰©å±•åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éœ€è¦ä»¥æŸç§æ–¹å¼å°†å…¶ç»‘å®šåˆ°DataFlow</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼›</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬é‡åˆ°äº†è·å–åé¦ˆçš„é—®é¢˜ï¼Œå¹¶ä¸”éœ€è¦ä½¿ä¸UIäº¤äº’çš„æ•´ä¸ªé€»è¾‘é€‚åº”äºDataDriven Flowã€‚</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
å¯¹äºè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ä»â€œè§†å›¾â€ç«¯å’Œâ€œæ•°æ®æµâ€é€‚é…ç«¯è¿›è¡Œæ“ä½œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ä»Viewå¼€å§‹ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œè¯·å›æƒ³ä¸€ä¸‹</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUIæœ¬èº«å¹¶ä¸å­˜åœ¨ï¼Œè€Œæ˜¯ä½œä¸ºUIKitçš„ä¸€ä¸ªé™„åŠ ç»„ä»¶</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">SwiftUIå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§åœ¨SwiftUI UIViewä¸­ä½¿ç”¨çš„æœºåˆ¶ï¼Œå…¶ç±»ä¼¼ç‰©ä¸åœ¨ç°æˆçš„æ§ä»¶ä¸­ã€‚</font><font style="vertical-align: inherit;">å¯¹äºè¿™ç§æƒ…å†µï¼Œå­˜åœ¨UIViewRepresentableå’ŒUIViewControllerRepresentableåè®®ï¼Œåˆ†åˆ«ç”¨äºè°ƒæ•´UIViewå’ŒUIViewControllerã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªå®ç°UIViewRepresentableçš„Viewç»“æ„ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬é‡æ–°å®šä¹‰æ–¹æ³•ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makeUiView;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updateUIView</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬æŒ‡ç¤ºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å“ªä¸ªUIViewå¹¶è®¾ç½®å…¶åŸºæœ¬è®¾ç½®ã€‚</font><font style="vertical-align: inherit;">å¹¶ä¸”ä¸è¦å¿˜è®°PropertyWrapperså…·æœ‰å¯å˜å±æ€§ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">WrappedCachedImage</span> : <span class="hljs-title">UIViewRepresentable</span> </span>{
    <span class="hljs-keyword">let</span> height: <span class="hljs-type">CGFloat</span>
    @<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> imageUrl: <span class="hljs-type">String</span><font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">makeUIView</span><span class="hljs-params">(context: Context)</span></span> -&gt; <span class="hljs-type">CachedImageView</span> {
        <span class="hljs-keyword">let</span> frame = <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">20</span>, y: <span class="hljs-number">0</span>, width: <span class="hljs-type">UIScreen</span>.main.bounds.size.width - <span class="hljs-number">40</span>, <font></font>
                                     height: height)<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-type">CachedImageView</span>(frame: frame)<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateUIView</span><span class="hljs-params">(<span class="hljs-number">_</span> uiView: CachedImageView, context: Context)</span></span> {<font></font>
        uiView.imageUrl = imageUrl<font></font>
        uiView.contentMode = .scaleToFill<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆçš„æ–°æ§ä»¶åµŒå…¥åˆ°View SwiftUIä¸­ï¼š</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lf/sg/er/lfsgerqzeqovuxkyomwuwh5ll1w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ç§æ–¹æ³•å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ— éœ€æ›´æ”¹ç°æœ‰åº“çš„æ“ä½œ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€»è¾‘å°è£…åœ¨åµŒå…¥å¼UIViewä¸­ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯æœ‰æ–°çš„è´£ä»»ã€‚é¦–å…ˆï¼Œæ‚¨éœ€è¦åœ¨View-UIViewæ†ç»‘è½¯ä»¶ä¸­ç›‘è§†å†…å­˜ç®¡ç†ã€‚ç”±äºé‡‡ç”¨äº†Viewç»“æ„ï¼Œå› æ­¤ä¸å®ƒä»¬ä¸€èµ·è¿›è¡Œçš„æ‰€æœ‰å·¥ä½œéƒ½æ˜¯ç”±æ¡†æ¶æœ¬èº«åœ¨åå°æ‰§è¡Œçš„ã€‚ä½†æ˜¯æ¸…æ´æ–°ç‰©ä½“è½åœ¨æ˜¾å½±å‰‚çš„è‚©è†€ä¸Šã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¶æ¬¡ï¼Œéœ€è¦å…¶ä»–æ­¥éª¤æ¥è¿›è¡Œè‡ªå®šä¹‰ï¼ˆå°ºå¯¸ï¼Œæ ·å¼ï¼‰ã€‚å¦‚æœé»˜è®¤æƒ…å†µä¸‹å¯ç”¨äº†Viewé€‰é¡¹ï¼Œåˆ™å¿…é¡»å°†å®ƒä»¬ä¸UIViewåŒæ­¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œè¦è°ƒæ•´å¤§å°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨GeometryReaderï¼Œä»¥ä¾¿æˆ‘ä»¬çš„å›¾åƒå æ®å±å¹•çš„æ•´ä¸ªå®½åº¦å’Œæˆ‘ä»¬å®šä¹‰çš„é«˜åº¦ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
      <span class="hljs-type">GeometryReader</span> { geometry <span class="hljs-keyword">in</span> 
        <span class="hljs-type">VStack</span> {
           <span class="hljs-type">WrappedCachedImage</span>(height:<span class="hljs-number">300</span>, imageUrl: imageUrl) <font></font>
           .frame(minWidth: <span class="hljs-number">0</span>, maxWidth: geometry.size.width,<font></font>
                     minHeight: <span class="hljs-number">0</span>, maxHeight: <span class="hljs-number">300</span>)<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸåˆ™ä¸Šï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥å°†åµŒå…¥å¼UIViewçš„ä½¿ç”¨è§†ä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿‡åº¦è®¾è®¡</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œç°åœ¨è®©æˆ‘ä»¬å°è¯•é€šè¿‡DataFlow SwiftUIè§£å†³é—®é¢˜ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬æ‹¥æœ‰çš„è§†å›¾å–å†³äºçŠ¶æ€å˜é‡æˆ–ä¸€ç»„å˜é‡ï¼Œå³ </font><font style="vertical-align: inherit;">æ¥è‡ªæŸä¸ªæ¨¡å‹ï¼Œè¯¥æ¨¡å‹æœ¬èº«å¯ä»¥æ˜¯æ­¤çŠ¶æ€å˜é‡ã€‚</font><font style="vertical-align: inherit;">æœ¬è´¨ä¸Šï¼Œè¿™ç§äº¤äº’æ˜¯åŸºäºMVVMæ¨¡å¼çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å®ç°å¦‚ä¸‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬å°†ä½¿ç”¨SwiftUIæ§ä»¶ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºä¸€ä¸ªViewModelï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Modelï¼ˆImageManagerï¼‰çš„é€»è¾‘è½¬ç§»åˆ°å…¶ä¸­ã€‚ </font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ex/e6/am/exe6am9d0tuyhoau1v8nezurrnm.png" width="75%"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†åœ¨Viewå’ŒViewModelä¹‹é—´å»ºç«‹è¿æ¥ï¼ŒViewModelå¿…é¡»å®ç°</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObservableObject</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åè®®ï¼Œ</font><font style="vertical-align: inherit;">å¹¶ä»¥</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObservedObjectçš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">èº«ä»½è¿æ¥åˆ°View </font><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CachedImageModel</span> : <span class="hljs-title">ObservableObject</span> </span>{<font></font>
    @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> image: <span class="hljs-type">UIImage</span> = <span class="hljs-type">UIImage</span>()<font></font>
    <font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> urlString: <span class="hljs-type">String</span> = <span class="hljs-string">""</span><font></font>
    <font></font>
    <span class="hljs-keyword">init</span>(urlString:<span class="hljs-type">String</span>) {
        <span class="hljs-keyword">self</span>.urlString = urlString<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">loadImage</span><span class="hljs-params">()</span></span> {
        <span class="hljs-type">ImageManager</span>.sharedInstance<font></font>
        .receiveImage(forKey: urlString) {[<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (im) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> = <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> {<span class="hljs-keyword">return</span>}
            <span class="hljs-type">DispatchQueue</span>.main.async {
                <span class="hljs-keyword">self</span>.image = im<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å…¶ç”Ÿå‘½å‘¨æœŸçš„onAppearæ–¹æ³•ä¸­çš„Viewè°ƒç”¨ViewModelæ–¹æ³•ï¼Œå¹¶ä»å…¶@Publishedå±æ€§è·å–æœ€ç»ˆå›¾åƒï¼š </font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">CachedLoaderImage</span> : <span class="hljs-title">View</span> </span>{<font></font>
    @<span class="hljs-type">ObservedObject</span> <span class="hljs-keyword">var</span>  model:<span class="hljs-type">CachedImageModel</span><font></font>
    <font></font>
    <span class="hljs-keyword">init</span>(withURL url:<span class="hljs-type">String</span>) {
        <span class="hljs-keyword">self</span>.model = <span class="hljs-type">CachedImageModel</span>(urlString: url)<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">Image</span>(uiImage: model.image)<font></font>
            .resizable()<font></font>
            .onAppear{<font></font>
                <span class="hljs-keyword">self</span>.model.loadImage()<font></font>
        }<font></font>
    }<font></font>
    <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿˜æœ‰ä¸€ä¸ªå£°æ˜æ€§çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸DataFlow SwiftUIä¸€èµ·ä½¿ç”¨</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½¿ç”¨å®ƒä¸ä½¿ç”¨å“åº”å¼æ¡†æ¶ï¼ˆç›¸åŒçš„RxSwiftï¼‰éå¸¸ç›¸ä¼¼ï¼šæœ‰ä¸»é¢˜ï¼Œæœ‰è®¢é˜…è€…ï¼Œæœ‰ç±»ä¼¼çš„ç®¡ç†æ–¹æ³•ï¼Œæœ‰å¯å–æ¶ˆçš„ï¼ˆè€Œä¸æ˜¯Disposableï¼‰ã€‚</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageLoader</span>: <span class="hljs-title">ObservableObject</span> </span>{<font></font>
 @<span class="hljs-type">Published</span> <span class="hljs-keyword">var</span> image: <span class="hljs-type">UIImage?</span>
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cancellable: <span class="hljs-type">AnyCancellable?</span><font></font>
<font></font>
 <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">load</span><span class="hljs-params">(url: String)</span></span> {<font></font>
     cancellable = <span class="hljs-type">ImageManager</span>.sharedInstance.publisher(<span class="hljs-keyword">for</span>: url)<font></font>
         .<span class="hljs-built_in">map</span> { <span class="hljs-type">UIImage</span>(data: $<span class="hljs-number">0</span>.data) }<font></font>
         .replaceError(with: <span class="hljs-literal">nil</span>)<font></font>
         .receive(on: <span class="hljs-type">DispatchQueue</span>.main)<font></font>
         .assign(to: \.image, on: <span class="hljs-keyword">self</span>)<font></font>
 }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 å¦‚æœæˆ‘ä»¬çš„ImageManageræœ€åˆæ˜¯ä½¿ç”¨Combineç¼–å†™çš„ï¼Œåˆ™è§£å†³æ–¹æ¡ˆå°†å¦‚ä¸‹æ‰€ç¤ºã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ç”±äº </font><font style="vertical-align: inherit;">ImageManageræ˜¯ç”¨å…¶ä»–åŸç†å®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å°è¯•å¦ä¸€ç§æ–¹æ³•ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ç”Ÿæˆäº‹ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨PasstroughSubjectæœºåˆ¶ï¼Œè¯¥æœºåˆ¶æ”¯æŒè®¢é˜…çš„è‡ªåŠ¨å®Œæˆã€‚</font></font><br>
<br>
<pre><code class="swift hljs">    <span class="hljs-keyword">var</span> didChange = <span class="hljs-type">PassthroughSubject</span>&lt;<span class="hljs-type">UIImage</span>, <span class="hljs-type">Never</span>&gt;()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸ºæ¨¡å‹çš„UIImageå±æ€§åˆ†é…å€¼æ—¶ï¼Œæˆ‘ä»¬å°†å‘é€ä¸€ä¸ªæ–°å€¼ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"><span class="hljs-keyword">var</span> data = <span class="hljs-type">UIImage</span>() {
        <span class="hljs-keyword">didSet</span> {<font></font>
            didChange.send(data)<font></font>
        }<font></font>
    }<font></font>
 ,    .<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬çš„Viewçš„æœ€ç»ˆå€¼åœ¨onReceiveæ–¹æ³•ä¸­â€œä¾¦å¬â€ï¼š</font></font><br>
<br>
<pre><code class="swift hljs"> <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
       <span class="hljs-type">Image</span>(uiImage: image)<font></font>
            .onReceive(imageLoader.didChange) { im <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">self</span>.image = im
           <span class="hljs-comment">//-   </span><font></font>
        }<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæˆ‘ä»¬çœ‹äº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç°æœ‰ä»£ç é€‚åº”SwiftUIã€‚</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿˜æœ‰ä»€ä¹ˆè¦è¡¥å……çš„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœç°æœ‰çš„iOSè§£å†³æ–¹æ¡ˆå¯¹UIéƒ¨åˆ†çš„å½±å“æ›´å¤§ï¼Œåˆ™æœ€å¥½é€šè¿‡UIViewRepresentableä½¿ç”¨é€‚åº”åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œéœ€è¦ä»çŠ¶æ€çš„è§†å›¾æ¨¡å‹è¿›è¡Œè°ƒæ•´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä»¥ä¸‹å„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•ä½¿ç°æœ‰é¡¹ç›®çš„ä¸šåŠ¡é€»è¾‘é€‚åº”SwiftUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨å¯¼èˆªï¼Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åæ·±å…¥é€‚åº”ä»¥è¿›è¡Œæ›´æ·±å…¥çš„ç»„åˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ‰å…³åœ¨SwiftUIä¸‹ä½¿ç”¨Viewçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤å¤„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500370/index.html">é¢å‘2020å¹´å€¼å¾—è®¢é˜…çš„10ä¸ªæœ‰ç”¨çš„è‹±è¯­æ’­å®¢</a></li>
<li><a href="../zh-CN500378/index.html">å·¥ä½œä¸­æœ‰æ•ˆçš„ä¿¡æ¯æœç´¢</a></li>
<li><a href="../zh-CN500380/index.html">è¿œç¨‹å¤„ç†ä¸ªäººæ•°æ®ï¼šé£é™©å’Œå¯èƒ½çš„åæœ</a></li>
<li><a href="../zh-CN500382/index.html">Aviasales APIä¸Amazon Kinesisçš„é›†æˆä»¥åŠæ— æœåŠ¡å™¨çš„ç®€å•æ€§</a></li>
<li><a href="../zh-CN500384/index.html">çš®å…‹æ–¯å·¥ä½œå®¤å…ˆé”‹è·å¾—å›¾çµå¥–å’Œä¸€ç™¾ä¸‡ç¾å…ƒ</a></li>
<li><a href="../zh-CN500390/index.html">ITå’Œæ•°å­—é€šä¿¡é¢†åŸŸä¸­è¯­è¨€æœ¬åœ°åŒ–çš„å®é™…æ¨¡å‹ã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN500396/index.html">è‡ªä¸»è®¿é—®æ§åˆ¶ç³»ç»Ÿçš„é—®é¢˜-ä»–ä»¬æ²¡æœ‰æƒ³åˆ°çš„åœ°æ–¹</a></li>
<li><a href="../zh-CN500398/index.html">è¿œç¨‹é©¬æ‹‰æ¾å‘¨3ï¼šæ— æ•ˆçš„è¿‡ç¨‹</a></li>
<li><a href="../zh-CN500400/index.html">ä¿®å‰ªçº¿ç¨‹ï¼šä»Puppet Enterpriseè¿ç§»åˆ°Ansible Towerã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN500402/index.html">[Part 1/2] FFmpegå’ŒSDLæŒ‡å—æˆ–å¦‚ä½•ç¼–å†™å°‘äº1000è¡Œçš„è§†é¢‘æ’­æ”¾å™¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>