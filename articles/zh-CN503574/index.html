<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“Š ğŸ“­ âš±ï¸ å“ˆè¨å…‹æ–¯å¦å…±å’Œå›½ç”µå­æ”¿åºœæ–‡ä»¶å‰ç«¯QRç å†…å®¹åˆ†æã€‚ ğŸˆšï¸ ğŸš› ğŸ•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘å°†æ¼”ç¤ºå¦‚ä½•åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ä½¿ç”¨JavaScriptï¼Œæ‚¨å¯ä»¥ä»å“ˆè¨å…‹æ–¯å¦å…±å’Œå›½ç”µå­æ”¿åºœé—¨æˆ·ç½‘ç«™ç”Ÿæˆçš„æ–‡æ¡£ï¼ˆä¾‹å¦‚https://egov.kzï¼‰ä¸­åŒ…å«çš„QRç æå–å’Œåˆ†ææ•°æ®ã€‚
 

åœ¨ç”µå­æ–‡æ¡£ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹æªè¯ï¼š
 *æ¡å½¢ç åŒ…å«ä»GDB PHçš„ä¿¡æ¯ç³»ç»Ÿæ¥æ”¶çš„æ•°æ®ï¼Œå¹¶ç”±å›½å®¶å…¬å¸â€œå…¬æ°‘æ”¿åºœâ€ NAOçš„åˆ†æ”¯æœºæ„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>å“ˆè¨å…‹æ–¯å¦å…±å’Œå›½ç”µå­æ”¿åºœæ–‡ä»¶å‰ç«¯QRç å†…å®¹åˆ†æã€‚</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/503574/"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†æ¼”ç¤ºå¦‚ä½•åœ¨æµè§ˆå™¨ä¸­ç›´æ¥ä½¿ç”¨JavaScriptï¼Œæ‚¨å¯ä»¥ä»å“ˆè¨å…‹æ–¯å¦å…±å’Œå›½ç”µå­æ”¿åºœé—¨æˆ·ç½‘ç«™ç”Ÿæˆçš„æ–‡æ¡£ï¼ˆä¾‹å¦‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://egov.kz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ä¸­</font><font style="vertical-align: inherit;">åŒ…å«çš„QRç æå–å’Œåˆ†ææ•°æ®</font><font style="vertical-align: inherit;">ã€‚</font></font></p><a name="habracut"></a><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç”µå­æ–‡æ¡£ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹æªè¯ï¼š</font></font></p><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*æ¡å½¢ç åŒ…å«ä»GDB PHçš„ä¿¡æ¯ç³»ç»Ÿæ¥æ”¶çš„æ•°æ®ï¼Œå¹¶ç”±å›½å®¶å…¬å¸â€œå…¬æ°‘æ”¿åºœâ€ NAOçš„åˆ†æ”¯æœºæ„çš„ç”µå­æ•°å­—ç­¾åç­¾åã€‚</font></font></blockquote><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ®æˆ‘æ‰€çŸ¥ï¼Œè¿˜æ²¡æœ‰ç°æˆçš„å·¥å…·å¯ä»¥æå–å’Œåˆ†æQRç ä¸­çš„æ•°æ®ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘çš„æœ€ç»ˆç›®æ ‡æ˜¯æå–ç­¾åæ•°æ®å’Œç­¾åï¼ŒéªŒè¯ç­¾åæ•°æ®çš„å®Œæ•´æ€§ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤è¯´æ˜ä¸­ï¼Œæ²¡æœ‰è°ˆè®ºéªŒè¯æ•°å­—ç­¾åçš„å†…å®¹ï¼Œä»…è®¨è®ºäº†å“ˆå¸Œå€¼ã€‚</font><font style="vertical-align: inherit;">ä¸‡ä¸€å…¬ä¼—å¯¹è¯¥ä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå°†æ¥å¯ä»¥æè¿°æ•°å­—ç­¾åéªŒè¯çš„è¯¦ç»†ä¿¡æ¯ã€‚</font></font></p><br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é‡è¦è¯´æ˜ï¼š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬è¯´æ˜æœªæè¿°é»‘å®¢æŠ€æœ¯ï¼Œä¹Ÿæ— åŠ©äºè·å¾—å¯¹æ•°æ®çš„æœªæˆæƒè®¿é—®ï¼›æˆ‘ä»¬å°†è®¨è®ºå°†æ•°æ®ä»ä¸€ç§è§†å›¾è½¬æ¢ä¸ºå¦ä¸€ç§è§†å›¾ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†å±•ç¤ºå¦‚ä½•å¤„ç†å½¢æˆçš„åŸå§‹PDFæ–‡ä»¶å¹¶æä¾›å“ˆè¨å…‹æ–¯å¦å…±å’Œå›½ç”µå­æ”¿åºœçš„ä¸‹è½½é—¨æˆ·ã€‚</font><font style="vertical-align: inherit;">è¿™äº›PDFæ–‡ä»¶åŒ…å«QRç ä½œä¸ºå•ç‹¬çš„åµŒå…¥å›¾åƒã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†å°è¯•ä½¿ç”¨æ²¡æœ‰çŠ¯ç½ªè®°å½•çš„è¯ä¹¦ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘å°†ä½¿ç”¨ä»¥ä¸‹åº“ï¼š</font></font></p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PDF.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»PDFæ–‡æ¡£ä¸­æå–å›¾åƒï¼›</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsQR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºè§£ç QRç ï¼›</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSZip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºè§£å‹ç¼©ZIPæ–‡ä»¶ï¼›</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XMLDSIGjs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºXMLå¤„ç†ï¼›</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebCrypto GOSTï¼ˆgostCryptoï¼‰</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨äºè®¡ç®—å“ˆå¸Œå€¼å’Œç¼–ç /è§£ç æ•°æ®ã€‚</font></font></li>
</ul><br>
<h1 id="0-schityvanie-pdf-fayla-v-arraybuffer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.åœ¨ArrayBufferä¸­è¯»å–PDFæ–‡ä»¶</font></font></h1><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿ç”¨å¸¦æœ‰æ ‡ç­¾</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>&lt;input type="file"&gt;</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠå…¶å±æ€§çš„</font><font style="vertical-align: inherit;">æ ‡å‡†HTMLå·¥å…·å¯ä»¥è®¿é—®PDFæ–‡ä»¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>files</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font></p><br>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œæ‚¨å¯ä»¥</font></font><code>ArrayBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‰ä»¥ä¸‹æ–¹å¼</font><font style="vertical-align: inherit;">è·å–æ–‡ä»¶çš„å†…å®¹</font><font style="vertical-align: inherit;">ï¼š</font></font></p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> fileContents = <span class="hljs-keyword">await</span> fileInput.files[<span class="hljs-number">0</span>].arrayBuffer();</code></pre><br>
<h1 id="1-izvlechenie-izobrazheniy-iz-pdf-dokumenta"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.ä»PDFæ–‡æ¡£ä¸­æå–å›¾åƒ</font></font></h1><br>
<p> PDF.js     ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://mozilla.github.io/pdf.js/examples/index.html#interactive-examples</a></p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> pdfjsLib = <span class="hljs-built_in">window</span>[<span class="hljs-string">'pdfjs-dist/build/pdf'</span>];<font></font>
pdfjsLib.GlobalWorkerOptions.workerSrc = <span class="hljs-string">'pdf.worker.js'</span>;</code></pre><br>
<p> PDF.js         .     ,     :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> ops = [<font></font>
  pdfjsLib.OPS.paintJpegXObject,<font></font>
  pdfjsLib.OPS.paintImageXObject,<font></font>
];</code></pre><br>
<p>      PDF :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> loadingTask = pdfjsLib.getDocument(fileContents);
<span class="hljs-keyword">const</span> pdf = <span class="hljs-keyword">await</span> loadingTask.promise;<font></font>
<font></font>
<span class="hljs-keyword">const</span> objIDs = [];
<span class="hljs-keyword">const</span> images = [];<font></font>
<font></font>
<span class="hljs-keyword">await</span> (<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> pageIndex = <span class="hljs-number">1</span>; pageIndex &lt;= pdf.numPages; pageIndex += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> pdf.getPage(pageIndex);<font></font>
<font></font>
    <span class="hljs-comment">//    ,   .</span>
    <span class="hljs-keyword">const</span> operators = <span class="hljs-keyword">await</span> page.getOperatorList();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; operators.fnArray.length; i++) {
      <span class="hljs-keyword">const</span> fn = operators.fnArray[i];<font></font>
<font></font>
      <span class="hljs-keyword">if</span> (ops.indexOf(fn) !== <span class="hljs-number">-1</span>) {
        <span class="hljs-comment">//       ,   -  .</span>
        <span class="hljs-keyword">const</span> objID = operators.argsArray[i][<span class="hljs-number">0</span>];<font></font>
<font></font>
        <span class="hljs-comment">//          ,   .</span>
        <span class="hljs-keyword">if</span> (objIDs.indexOf(objID) === <span class="hljs-number">-1</span>) {<font></font>
          objIDs.push(objID);<font></font>
<font></font>
          <span class="hljs-comment">//       .</span>
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> imageInfo = page.objs.get(objID);<font></font>
            images.push(imageInfo);<font></font>
          } <span class="hljs-keyword">catch</span> (err) {
            <span class="hljs-built_in">console</span>.log(err);<font></font>
          }<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
})()</code></pre><br>
<h1 id="2-dekodirovanie-qr-kodov">2.  QR </h1><br>
<p> <strong>jsQR</strong>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">RGBA</a>      PDF        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">RGB</a>,    RGB  RGBA:</p><br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extractRGBAData</span>(<span class="hljs-params">image</span>) </span>{
  <span class="hljs-keyword">if</span> (image.kind === <span class="hljs-number">3</span>) { <span class="hljs-comment">// ImageKind.RGBA_32BPP  https://github.com/mozilla/pdf.js/blob/master/src/shared/util.js</span>
    <span class="hljs-keyword">return</span> image.data;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (image.kind !== <span class="hljs-number">2</span>) { <span class="hljs-comment">// ImageKind.RGB_24BPP  https://github.com/mozilla/pdf.js/blob/master/src/shared/util.js</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`Image kind "<span class="hljs-subst">${image.kind}</span>" is not supported.`</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8ClampedArray</span>(image.width * image.height * <span class="hljs-number">4</span>);<font></font>
<font></font>
  <span class="hljs-keyword">let</span> destPosition = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> srcPosition = <span class="hljs-number">0</span>; srcPosition &lt; image.data.length;) {<font></font>
    data[destPosition++] = image.data[srcPosition++];<font></font>
    data[destPosition++] = image.data[srcPosition++];<font></font>
    data[destPosition++] = image.data[srcPosition++];<font></font>
    data[destPosition++] = <span class="hljs-number">255</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> data;<font></font>
}</code></pre><br>
<p>    :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> qrCodes = [];<font></font>
images.forEach(<span class="hljs-function">(<span class="hljs-params">image</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (image.data) {
    <span class="hljs-keyword">const</span> data = extractRGBAData(image);<font></font>
<font></font>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> code = jsQR(data, image.width, image.height);
      <span class="hljs-built_in">console</span>.log(code);<font></font>
      qrCodes.push(code);<font></font>
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-built_in">console</span>.log(err);<font></font>
    }<font></font>
  }<font></font>
});</code></pre><br>
<p>      7  â€”     QR   .     URL  â€” QR         ,    .  6   XML   (  ):</p><br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">BarcodeElement</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://barcodes.pdf.shep.nitec.kz/"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">creationDate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">creationDate</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">elementData</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">elementData</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">elementNumber</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">elementNumber</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">elementsAmount</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">elementsAmount</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">FavorID</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">FavorID</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">BarcodeElement</span>&gt;</span></code></pre><br>
<p>     :</p><br>
<ul>
<li><code>&lt;elementData&gt;...&lt;/elementData&gt;</code> â€”  </li>
<li><code>&lt;elementNumber&gt;1&lt;/elementNumber&gt;</code> â€”   </li>
<li><code>&lt;elementsAmount&gt;6&lt;/elementsAmount&gt;</code> â€”       </li>
</ul><br>
<h1 id="3-izvlechenie-chastey-dannyh">3.   </h1><br>
<p>          :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> qrCodesBlocks = [];<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addQRCodeBlock</span>(<span class="hljs-params">code</span>) </span>{
  <span class="hljs-keyword">if</span> (!code || !code.data) {
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//    .</span>
  <span class="hljs-keyword">const</span> elementsAmountRegexp = <span class="hljs-regexp">/&lt;elementsAmount&gt;((.|\r|\n)+?)&lt;\/elementsAmount&gt;/</span>;
  <span class="hljs-keyword">const</span> elementsAmountResult = elementsAmountRegexp.exec(code.data);
  <span class="hljs-keyword">if</span> (!elementsAmountResult || elementsAmountResult.length &lt;= <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">return</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">const</span> elementsAmount = +elementsAmountResult[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Number</span>.isSafeInteger(elementsAmount)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'        &lt;elementsAmount&gt;'</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//       .</span>
  <span class="hljs-keyword">if</span> (qrCodesBlocks.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; elementsAmount; i++) {<font></font>
      qrCodesBlocks.push(<span class="hljs-string">''</span>);<font></font>
    }<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (qrCodesBlocks.length !== elementsAmount) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`  QR      QR : "<span class="hljs-subst">${qrCodesBlocks.length}</span>"  "<span class="hljs-subst">${elementsAmount}</span>"`</span>);<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//   .</span>
  <span class="hljs-keyword">const</span> elementNumberRegexp = <span class="hljs-regexp">/&lt;elementNumber&gt;((.|\r|\n)+?)&lt;\/elementNumber&gt;/</span>;
  <span class="hljs-keyword">const</span> elementNumberResult = elementNumberRegexp.exec(code.data);
  <span class="hljs-keyword">if</span> (!elementNumberResult || elementNumberResult.length &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">` QR   "&lt;elementNumber&gt;"`</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">const</span> elementNumber = +elementNumberResult[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Number</span>.isSafeInteger(elementNumber)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`"&lt;elementNumber&gt;"  QR    `</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//    .</span>
  <span class="hljs-keyword">if</span> (elementNumber &gt; elementsAmount) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">` QR  "<span class="hljs-subst">${elementNumber}</span>"    QR  "<span class="hljs-subst">${elementsAmount}</span>"`</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (qrCodesBlocks[elementNumber - <span class="hljs-number">1</span>] !== <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">` QR  "<span class="hljs-subst">${elementNumber}</span>"    `</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment">//     .</span>
  <span class="hljs-keyword">const</span> elementDataRegexp = <span class="hljs-regexp">/&lt;elementData&gt;((.|\r|\n)+?)&lt;\/elementData&gt;/</span>;
  <span class="hljs-keyword">const</span> elementDataResult = elementDataRegexp.exec(code.data);
  <span class="hljs-keyword">if</span> (!elementDataResult || elementDataResult.length &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">' QR   "&lt;elementData&gt;"'</span>);<font></font>
  }<font></font>
  <span class="hljs-keyword">const</span> elementData = elementDataResult[<span class="hljs-number">1</span>];<font></font>
<font></font>
  qrCodesBlocks[elementNumber - <span class="hljs-number">1</span>] = elementData;<font></font>
}</code></pre><br>
<p>        .</p><br>
<pre><code class="javascript hljs">qrCodes.forEach(addQRCodeBlock);<font></font>
<font></font>
<span class="hljs-keyword">if</span> (qrCodesBlocks.length === <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'     QR :     QR    '</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> foundBlocks = qrCodesBlocks.filter(<span class="hljs-function">(<span class="hljs-params">block</span>) =&gt;</span> !!block);
<span class="hljs-keyword">if</span> (qrCodesBlocks.length !== foundBlocks.length) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'     QR :      QR '</span>);<font></font>
}</code></pre><br>
<h1 id="4-vosstanovlenie-dannyh">4.  </h1><br>
<p>      ZIP          Base64.</p><br>
<p>       Base64:</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> zippedParts = qrCodesBlocks.map(<span class="hljs-function"><span class="hljs-params">block</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(gostCrypto.coding.Base64.decode(block)));</code></pre><br>
<p>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> totalLength = zippedParts.reduce(<span class="hljs-function">(<span class="hljs-params">accumulator, part</span>) =&gt;</span> accumulator + part.length, <span class="hljs-number">0</span>);<font></font>
<font></font>
<span class="hljs-keyword">const</span> zippedData = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(totalLength);
<span class="hljs-keyword">let</span> zippedDataIndex = <span class="hljs-number">0</span>;<font></font>
zippedParts.forEach(<span class="hljs-function">(<span class="hljs-params">part</span>) =&gt;</span> {<font></font>
  zippedData.set(part, zippedDataIndex);<font></font>
  zippedDataIndex += part.length;<font></font>
});</code></pre><br>
<p>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> zip = <span class="hljs-keyword">await</span> JSZip.loadAsync(zippedData, { <span class="hljs-attr">checkCRC32</span>: <span class="hljs-literal">true</span> });</code></pre><br>
<p>       <code>one</code>,     :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> file = zip.file(<span class="hljs-string">'one'</span>);
<span class="hljs-keyword">if</span> (!file) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'     "one"'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> recoveredContents = <span class="hljs-keyword">await</span> file.async(<span class="hljs-string">"string"</span>);</code></pre><br>
<h1 id="5-podgotovka-dannyh-k-analizu">5.    </h1><br>
<p>  â€”  XML   (  ):</p><br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p1001Response</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SystemInfo</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">messageId</span> <span class="hljs-attr">xsi:nil</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">chainId</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">chainId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">messageDate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">messageDate</span>&gt;</span><font></font>
        `1`<font></font>
        <span class="hljs-tag">&lt;<span class="hljs-name">responseInfoRu</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">responseInfoRu</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">responseInfoKz</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">responseInfoKz</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">digiSign</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">digiSign</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">SystemInfo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ResponseData</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ResponseType</span>&gt;</span>UNJUDGED<span class="hljs-tag">&lt;/<span class="hljs-name">ResponseType</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Person</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">IIN</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">IIN</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">SurName</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">SurName</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Name</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">MiddleName</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">MiddleName</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">BirthDate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">BirthDate</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">BirthPlace</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Country</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Country</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">CountryKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">CountryKz</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">District</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">District</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">DistrictKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">DistrictKz</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">City</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">City</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">CityKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">CityKz</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Locality</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Locality</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">LocalityKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">LocalityKz</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">BirthPlace</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Person</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Untried</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CheckDate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">CheckDate</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ResponseData</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">p1001Response</span>&gt;</span></code></pre><br>
<p>      <code>digiSign</code> â€”    XML   Base64.       ,      .</p><br>
<p>    XML:</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> regexp = <span class="hljs-regexp">/&lt;digiSign&gt;((.|\r|\n)+?)&lt;\/digiSign&gt;/</span>;
<span class="hljs-keyword">const</span> regexpResult = regexp.exec(recoveredContents);
<span class="hljs-keyword">if</span> (!regexpResult &amp;&amp; regexpResult.length !== <span class="hljs-number">2</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">' XML  "&lt;digiSign&gt;"'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> digiSignBytes = gostCrypto.coding.Base64.decode(regexpResult[<span class="hljs-number">1</span>]);
<span class="hljs-keyword">const</span> xmlDataAndSignature = gostCrypto.coding.Chars.encode(digiSignBytes, <span class="hljs-string">'utf8'</span>);</code></pre><br>
<h1 id="6-analiz-dannyh">6.  </h1><br>
<p>  XML    (  ):</p><br>
<pre><code class="xml hljs"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ResponseData</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ResponseType</span>&gt;</span>UNJUDGED<span class="hljs-tag">&lt;/<span class="hljs-name">ResponseType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Person</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">IIN</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">IIN</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SurName</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">SurName</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Name</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">MiddleName</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">MiddleName</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">BirthDate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">BirthDate</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">BirthPlace</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Country</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Country</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CountryKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">CountryKz</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">District</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">District</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DistrictKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">DistrictKz</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">City</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">City</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CityKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">CityKz</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Locality</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Locality</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">LocalityKz</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">LocalityKz</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BirthPlace</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Person</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Untried</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">CheckDate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">CheckDate</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ds:Signature</span> <span class="hljs-attr">xmlns:ds</span>=<span class="hljs-string">"http://www.w3.org/2000/09/xmldsig#"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ds:SignedInfo</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ds:CanonicalizationMethod</span> <span class="hljs-attr">Algorithm</span>=<span class="hljs-string">"http://www.w3.org/TR/2001/REC-xml-c14n-20010315"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ds:SignatureMethod</span> <span class="hljs-attr">Algorithm</span>=<span class="hljs-string">"http://www.w3.org/2001/04/xmldsig-more#gost34310-gost34311"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ds:Reference</span> <span class="hljs-attr">URI</span>=<span class="hljs-string">""</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ds:Transforms</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ds:Transform</span> <span class="hljs-attr">Algorithm</span>=<span class="hljs-string">"http://www.w3.org/2000/09/xmldsig#enveloped-signature"</span>/&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ds:Transform</span> <span class="hljs-attr">Algorithm</span>=<span class="hljs-string">"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ds:Transforms</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ds:DigestMethod</span> <span class="hljs-attr">Algorithm</span>=<span class="hljs-string">"http://www.w3.org/2001/04/xmldsig-more#gost34311"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ds:DigestValue</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">ds:DigestValue</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ds:Reference</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ds:SignedInfo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ds:SignatureValue</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">ds:SignatureValue</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ds:KeyInfo</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ds:X509Data</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ds:X509Certificate</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">ds:X509Certificate</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ds:X509Data</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ds:KeyInfo</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ds:Signature</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ResponseData</span>&gt;</span></code></pre><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">XML </a>     ,   ,       <code>&lt;ResponseType&gt;UNJUDGED&lt;/ResponseType&gt;</code>,           <code>&lt;Person&gt;...&lt;/Person&gt;</code>.</p><br>
<h1 id="7-proverka-celostnosti-podpisannyh-dannyh">7.    </h1><br>
<p>         XML     .</p><br>
<p>  XML :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> xml = XmlDSigJs.Parse(xmlDataAndSignature);</code></pre><br>
<p>     <code>&lt;ds:DigestValue&gt;...&lt;/ds:DigestValue&gt;</code>:</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> xmlSignatures = XmlDSigJs.Select(xml, <span class="hljs-string">"//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']"</span>);
<span class="hljs-keyword">if</span> (xmlSignatures.length === <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`      ( "&lt;Signature&gt;"): "<span class="hljs-subst">${xmlDataAndSignature}</span>"`</span>);<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (xmlSignatures.length &gt; <span class="hljs-number">1</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`       ( "&lt;Signature&gt;"): "<span class="hljs-subst">${xmlDataAndSignature}</span>"`</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> hashElementsInSignature = XmlDSigJs.Select(xmlSignatures[<span class="hljs-number">0</span>], <span class="hljs-string">"//*[local-name(.)='DigestValue']"</span>);
<span class="hljs-keyword">if</span> (hashElementsInSignature.length === <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">` XML    ( "&lt;DigestValue&gt;"): "<span class="hljs-subst">${xmlDataAndSignature}</span>"`</span>);<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (hashElementsInSignature.length &gt; <span class="hljs-number">1</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">` XML     ( "&lt;DigestValue&gt;"): "<span class="hljs-subst">${xmlDataAndSignature}</span>"`</span>);<font></font>
}<font></font>
<span class="hljs-keyword">const</span> hashInSignature = hashElementsInSignature[<span class="hljs-number">0</span>].textContent;</code></pre><br>
<p>     â€”        <code>&lt;ds:Transforms&gt;...&lt;/ds:Transforms&gt;</code> XML :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> xmlDsigEnvelopedSignatureTransform = <span class="hljs-keyword">new</span> XmlDSigJs.XmlDsigEnvelopedSignatureTransform();<font></font>
xmlDsigEnvelopedSignatureTransform.LoadInnerXml(xml.documentElement);<font></font>
xmlDsigEnvelopedSignatureTransform.GetOutput();<font></font>
<font></font>
<span class="hljs-keyword">const</span> xmlDsigC14NWithCommentsTransform = <span class="hljs-keyword">new</span> XmlDSigJs.XmlDsigC14NWithCommentsTransform();<font></font>
xmlDsigC14NWithCommentsTransform.LoadInnerXml(xml.documentElement);<font></font>
<span class="hljs-keyword">const</span> signedDataXML = xmlDsigC14NWithCommentsTransform.GetOutput();<font></font>
<font></font>
<span class="hljs-keyword">const</span> dataToHash = gostCrypto.coding.Chars.decode(signedDataXML, <span class="hljs-string">'utf8'</span>);</code></pre><br>
<p>     <code>"http://www.w3.org/2001/04/xmldsig-more#gost34311"</code>,  <strong> 34.311-95</strong>   <code>GOST R 34.11-94</code>   <code>gostCrypto</code>.          <code>D-TEST</code>.</p><br>
<p>  :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> hashBytes = <span class="hljs-keyword">await</span> gostCrypto.subtle.digest({<span class="hljs-attr">name</span>: <span class="hljs-string">'GOST R 34.11-94'</span>, <span class="hljs-attr">version</span>: <span class="hljs-number">1994</span>, <span class="hljs-attr">sBox</span>: <span class="hljs-string">'D-TEST'</span>}, dataToHash);
<span class="hljs-keyword">const</span> signedDataXMLHash = gostCrypto.coding.Base64.encode(hashBytes);</code></pre><br>
<p>       :</p><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (signedDataXMLHash !== hashInSignature) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`    XML  "<span class="hljs-subst">${signedDataXMLHash}</span>"      "<span class="hljs-subst">${hashInSignature}</span>"`</span>);<font></font>
}</code></pre><br>
<h1 id="zaklyuchenie"></h1><br>
<p>  ,   .     ,            â€”    ,      XML    .</p><br>
<p>    ,          :        XML ,    <code>digiSign</code>     Base64,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">HTML </a>,    .                 .</p><br>
<p> :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">        </a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">  â€œ      â€</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆè¨å…‹æ–¯å¦å…±å’Œå›½æŠ•èµ„ä¸å‘å±•éƒ¨é•¿çš„å‘½ä»¤â€œå…³äºæ‰¹å‡†ç”µå­æ•°å­—ç­¾åéªŒè¯è§„åˆ™çš„æ‰¹å‡†â€</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN503560/index.html">å­¦ä¹ Scalaï¼šç¬¬1éƒ¨åˆ†-è›‡æ¸¸æˆ</a></li>
<li><a href="../zh-CN503562/index.html">345å·ç§»åŠ¨å¼€å‘äººå‘˜çš„æœ‰è¶£ææ–™æ‘˜è¦ï¼ˆ5æœˆ18æ—¥è‡³24æ—¥ï¼‰</a></li>
<li><a href="../zh-CN503566/index.html">æ˜¯å¦å¯ä»¥åœ¨WindowsåŸºç¡€ç»“æ„ä¸­ä½¿ç”¨Linuxæ¡Œé¢ï¼Ÿ</a></li>
<li><a href="../zh-CN503570/index.html">å°ç±³ç½‘å…³2ä¸èƒ½ç„Šæ¥</a></li>
<li><a href="../zh-CN503572/index.html">ä¹Œè¾¾ä¼¦å¡ã€‚å¦ä¸€ä¸ªè‡ªæˆ‘éš”ç¦»VPNéƒ¨ç½²çš„æ•…äº‹</a></li>
<li><a href="../zh-CN503576/index.html">â€œé€šè¿‡â€ï¼šæ‚¨å¿˜äº†åœ¨ä¿„è¯­ç½‘ç«™ä¸Šè®¨è®ºçš„æœ‰å…³åˆ›ä¸šå…¬å¸å’ŒæŠ€æœ¯çš„ä¸»é¢˜</a></li>
<li><a href="../zh-CN503578/index.html">å¥½çš„ç¨‹åºå‘˜å¤åˆ¶ï¼Œä¼Ÿå¤§çš„ç¨‹åºå‘˜å·</a></li>
<li><a href="../zh-CN503580/index.html">ä»€ä¹ˆæ˜¯å¤§æ•°æ®ï¼Ÿ</a></li>
<li><a href="../zh-CN503588/index.html">æ¯”å°”Â·ç›–èŒ¨ï¼šæ‚¨éœ€è¦äº†è§£çš„COVID-19ç–«è‹—</a></li>
<li><a href="../zh-CN503594/index.html">è¿œç¨‹è§‚å¯Ÿè€…</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>