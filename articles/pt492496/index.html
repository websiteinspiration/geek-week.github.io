<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê† üßê üíò Exemplo de SPA do Simple Notes no Mithril.js üññüèª üò≤ üôã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mithril.js √© uma ferramenta impopular para a cria√ß√£o de aplicativos Web clientes. Praticamente n√£o h√° publica√ß√µes sobre Habr√© sobre esse assunto. Nest...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Exemplo de SPA do Simple Notes no Mithril.js</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492496/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© uma ferramenta impopular para a cria√ß√£o de aplicativos Web clientes. </font><font style="vertical-align: inherit;">Praticamente n√£o h√° publica√ß√µes sobre Habr√© sobre esse assunto. </font><font style="vertical-align: inherit;">Neste post, quero mostrar como voc√™ pode fazer um pequeno aplicativo no Mithril. </font><font style="vertical-align: inherit;">O aplicativo ser√° baseado nesta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">publica√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tradu√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que √© Mihtril</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Mithril √© uma estrutura reativa projetada para criar SPA (aplicativos da Web de p√°gina √∫nica). Em suma, s√£o apenas javascript e 13 assinaturas de fun√ß√µes da API. Al√©m disso, existe uma biblioteca de mithril-stream que n√£o est√° inclu√≠da no mithril e √© usada separadamente. O n√∫cleo do mithril inclui rotear o aplicativo e trabalhar com solicita√ß√µes XHR. O conceito central √© abstra√ß√£o - um n√≥ virtual (vnode). Um n√≥ virtual √© apenas um objeto js com algum conjunto de atributos. N√≥s virtuais s√£o criados pela fun√ß√£o especial m (). O estado atual da interface √© armazenado em uma lista de n√≥s virtuais (DOM virtual). Na renderiza√ß√£o inicial da p√°gina do aplicativo, o DOM virtual √© convertido no DOM. Quando o manipulador de eventos da API DOM √© iniciado, quando a promessa m.request () √© conclu√≠da e quando o URL √© alterado (navega√ß√£o pelas rotas do aplicativo), um novo array DOM virtual √© gerado,compara com o antigo e os n√≥s alterados alteram o DOM do navegador. Al√©m dos eventos DOM e da conclus√£o da solicita√ß√£o m.request (), o redesenho pode ser chamado manualmente com a fun√ß√£o m.redraw ().</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o existem modelos similares a HTML no mithril, n√£o h√° suporte para JSX, embora voc√™ possa usar tudo isso com v√°rios plugins para criar, se desejar. N√£o vou usar essas oportunidades aqui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o primeiro argumento para m () for uma sequ√™ncia (por exemplo, 'div'), a fun√ß√£o retornar√° um n√≥ virtual simples e, como resultado, uma tag HTML ser√° exibida no DOM</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o primeiro argumento para m () for o objeto ou fun√ß√£o que retorna o objeto, esse objeto dever√° ter um m√©todo view (), e esse objeto ser√° chamado de componente. O m√©todo view () do componente, por sua vez, sempre deve retornar a fun√ß√£o m () (ou uma matriz do tipo: [m (),]). Assim, podemos construir uma hierarquia de objetos componentes. E est√° claro que, em √∫ltima an√°lise, todos os componentes retornam n√≥s vnode simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os n√≥s e componentes virtuais t√™m m√©todos de ciclo de vida e s√£o chamados da mesma oninit (), oncreate (), onbeforeupdate () etc. Cada um desses m√©todos √© chamado em um momento muito espec√≠fico na renderiza√ß√£o da p√°gina.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode passar par√¢metros para o n√≥ ou componente virtual como um objeto, que deve ser o segundo argumento para a fun√ß√£o m (). Voc√™ pode obter um link para este objeto dentro do n√≥ usando a nota√ß√£o vnode.attrs. O terceiro argumento para a fun√ß√£o m () s√£o os descendentes desse n√≥ e podem ser acessados ‚Äã‚Äãatrav√©s do link vnode.children. Al√©m da fun√ß√£o m (), n√≥s simples s√£o retornados pela fun√ß√£o m.trust (). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O autor do mithril n√£o oferece nenhum padr√£o especial de design de aplicativo, embora ele recomende evitar algumas solu√ß√µes malsucedidas, por exemplo, componentes "muito grossos" ou manipular os descendentes da √°rvore de componentes. O autor tamb√©m n√£o oferece maneiras ou m√©todos especiais para controlar o estado do aplicativo como um todo ou componentes. Embora a documenta√ß√£o declare que voc√™ n√£o deve usar o estado do pr√≥prio n√≥, manipule-o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos esses recursos do mithril parecem muito inconvenientes, e a estrutura parece estar inacabada, n√£o h√° recomenda√ß√µes especiais, n√£o h√° estado / armazenamento, n√£o h√° redutor / expedidor de eventos, n√£o h√° modelos. </font><font style="vertical-align: inherit;">Em geral, fa√ßa o que puder.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que voc√™ precisa para um exemplo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√≥s vamos usar:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mithril.js vers√£o 2.0.4</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca css </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pure.css</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers√£o 1.0.1</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fontawesome v5.12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para √≠cones</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rollup.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers√£o 1.32 para criar o aplicativo</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgREST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers√£o 5.2.0, como servidor REST de back-end</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgresql vers√£o 9.6 ou superior como um banco de dados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O servidor front-end n√£o √© importante aqui, apenas fornece ao cliente index.html e arquivos de script e estilo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o instalaremos o mithril no node_modules e vincularemos o c√≥digo do aplicativo e a estrutura em um arquivo. </font><font style="vertical-align: inherit;">O c√≥digo do aplicativo e o mithril ser√£o enviados para a p√°gina separadamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o descreverei o procedimento de instala√ß√£o das ferramentas, embora eu possa dizer sobre o postgREST, basta baixar o arquivo bin√°rio, coloc√°-lo em uma pasta separada, criar um arquivo de configura√ß√£o test.conf como este:</font></font><br>
<br>
<pre><code class="plaintext hljs">db-uri = "postgres://postgres:user1@localhost:5432/testbase"<font></font>
server-port= 5000<font></font>
# The name of which database schema to expose to REST clients<font></font>
db-schema= "public"<font></font>
# The database role to use when no client authentication is provided.<font></font>
# Can (and probably should) differ from user in db-uri<font></font>
db-anon-role = "postgres" </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao mesmo tempo, seu cluster postgesql deve ter uma base de teste e usu√°rio1. </font><font style="vertical-align: inherit;">Nesta base de teste, crie uma tabela:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-comment">-- Postgrest sql notes table </span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> notes (
<span class="hljs-keyword">id</span> <span class="hljs-built_in">serial</span> primary <span class="hljs-keyword">key</span>,<font></font>
title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">127</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
<span class="hljs-keyword">content</span> <span class="hljs-built_in">text</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<font></font>
created <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,<font></font>
completed <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">with</span> <span class="hljs-built_in">time</span> zone,<font></font>
ddel <span class="hljs-built_in">smallint</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>
)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O in√≠cio do servidor postgREST √© feito com o comando:</font></font><br>
<br>
<pre><code class="bash hljs">postgrest test.conf
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s iniciar o servidor, ele exibe mensagens informativas sobre a conex√£o com o banco de dados e em qual porta ele escuta os clientes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planejando um projeto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, se √© compreens√≠vel como o mitril funciona, voc√™ precisa descobrir como fazer a aplica√ß√£o. </font><font style="vertical-align: inherit;">Aqui est√° o plano:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos armazenar dados do aplicativo em um objeto local, vamos chamar seu modelo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os aplicativos de API ser√£o armazenados em um arquivo separado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Armazenaremos rotas de aplicativos em um arquivo separado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O arquivo de caminho ser√° o ponto de entrada para a cria√ß√£o do aplicativo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada componente separado (e eu usarei o esquema de renderiza√ß√£o de componentes) e as fun√ß√µes associadas a ele ser√£o armazenadas em um arquivo separado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada componente que renderiza dados do modelo ter√° acesso ao modelo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os manipuladores de eventos DOM do componente est√£o localizados no componente</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, n√£o precisamos de eventos personalizados, mas eventos DOM nativos, os retornos de chamada para esses eventos est√£o localizados nos componentes. </font><font style="vertical-align: inherit;">Vou usar a liga√ß√£o em dois sentidos. </font><font style="vertical-align: inherit;">Talvez nem todos gostem dessa abordagem, mas nem todo mundo gosta de redux ou vuex. </font><font style="vertical-align: inherit;">Al√©m disso, a t√©cnica de liga√ß√£o unidirecional tamb√©m pode ser elegantemente implementada no mitril usando mithril-sream. </font><font style="vertical-align: inherit;">Mas, neste caso, esta √© uma solu√ß√£o redundante.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estrutura de pastas do aplicativo</font></font></h3><br>
<img src="https://habrastorage.org/webt/yp/uy/fa/ypuyfap4tlxl_ccqo86wbtb9h98.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pasta p√∫blica ser√° servida pelo servidor frontal, h√° um arquivo index.html e diret√≥rios com estilos e scripts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pasta src cont√©m a raiz do roteador e a defini√ß√£o da API e dois diret√≥rios para o modelo e as visualiza√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na raiz do projeto, h√° um arquivo de configura√ß√£o rollup.config, e o projeto √© criado usando o comando:</font></font><br>
<br>
<pre><code class="bash hljs">rollup ‚Äìc</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√£o aborrecer o leitor com os longos trechos de c√≥digo dispon√≠veis no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comentarei apenas os principais elementos de implementa√ß√£o para demonstrar uma abordagem idiom√°tica para mitral.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API e roteador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo da API:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// used by backend server</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> restApi= {
  <span class="hljs-attr">notes</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">'notes'</span>, <span class="hljs-attr">editable</span>: [<span class="hljs-string">'add'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'del'</span>] }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// used by routers</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appApi = {
  <span class="hljs-attr">root</span>: <span class="hljs-string">"/"</span>,<font></font>
}<font></font>
<span class="hljs-comment">// used by navBar</span>
<span class="hljs-comment">// here array of arrays though it may be hash eg</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> appMenu = [<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Home'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'About'</span>],<font></font>
  [<span class="hljs-string">`<span class="hljs-subst">${appApi.root}</span>`</span>, <span class="hljs-string">'Contacts'</span>],<font></font>
]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu defini uma API para o servidor REST e para o roteador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Roteador:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { restApi, appApi } <span class="hljs-keyword">from</span> <span class="hljs-string">'./appApi'</span>;
<span class="hljs-keyword">import</span> { moModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./model/moModel'</span>;
<span class="hljs-keyword">import</span> { vuView, vuApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuApp'</span>;
<span class="hljs-keyword">import</span> { vuNavBar } <span class="hljs-keyword">from</span> <span class="hljs-string">'./view/vuNavBar'</span>;<font></font>
<font></font>
<span class="hljs-comment">// application router</span>
<span class="hljs-keyword">const</span> appRouter = { [appApi.root]: {<font></font>
  render() {<font></font>
    <span class="hljs-keyword">const</span> view = m(vuApp, {
      <span class="hljs-attr">model</span>: moModel.getModel( restApi.notes ),<font></font>
    });<font></font>
    <span class="hljs-keyword">return</span> vuView( {<span class="hljs-attr">menu</span>: vuNavBar}, view);<font></font>
  }<font></font>
}};<font></font>
<font></font>
<span class="hljs-comment">// once per app</span>
m.route(<span class="hljs-built_in">document</span>.body, <span class="hljs-string">"/"</span>, appRouter);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui o roteador est√° montado no corpo do documento. </font><font style="vertical-align: inherit;">O pr√≥prio roteador √© um objeto que descreve as rotas e os componentes que ser√£o usados ‚Äã‚Äãnessa rota; a fun√ß√£o render () deve retornar vnode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objeto appApi define todas as rotas v√°lidas do aplicativo e o objeto appMenu define todos os elementos de navega√ß√£o poss√≠veis para o aplicativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fun√ß√£o de renderiza√ß√£o, quando chamada, gera um modelo de aplicativo e o passa para o n√≥ raiz.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo de aplica√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A estrutura que armazena dados relevantes, chamei de modelo. </font><font style="vertical-align: inherit;">O c√≥digo fonte da fun√ß√£o que retorna o modelo:</font></font><br>
<br>
<pre><code class="javascript hljs">getModel(<font></font>
    {url=<span class="hljs-literal">null</span>, method=<span class="hljs-string">"GET"</span>, order_by=<span class="hljs-string">'id'</span>, editable=<span class="hljs-literal">null</span>} = {}<font></font>
  ) {<font></font>
<span class="hljs-comment">/**
  * url - string of model's REST API url
  * method - string of model's REST method
  * order_by - string "order by" with initially SELECT 
  * editable - array defines is model could changed
*/</span>
    <span class="hljs-keyword">const</span> model = {
      <span class="hljs-attr">url</span>: url,
      <span class="hljs-attr">method</span>: method,
      <span class="hljs-attr">order_by</span>: order_by,
      <span class="hljs-attr">editable</span>: editable,
      <span class="hljs-attr">key</span>: order_by, <span class="hljs-comment">// here single primary key only</span>
      <span class="hljs-attr">list</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// main data list </span>
      <span class="hljs-attr">item</span>: {}, <span class="hljs-comment">// note item</span>
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// Promise error</span>
      <span class="hljs-attr">save</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// save status</span>
      <span class="hljs-attr">editMode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// view switch flag</span>
      <span class="hljs-attr">word</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// dialog header word</span><font></font>
    };  <font></font>
    model.getItem= <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {<font></font>
      model.item= {};<font></font>
      <span class="hljs-keyword">if</span> ( !id ) {<font></font>
        model.editMode= <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
      }<font></font>
      <span class="hljs-keyword">const</span> key= model.key;
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">let</span> it <span class="hljs-keyword">of</span> model.list ) {
        <span class="hljs-keyword">if</span> (it[key] == id) {<font></font>
          model.item= <span class="hljs-built_in">Object</span>.assign({}, it);
          <span class="hljs-keyword">break</span>;<font></font>
        }<font></font>
      }<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    };<font></font>
    <span class="hljs-keyword">return</span> model;<font></font>
  },</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Aqui, ele √© inicializado e retorna o objeto de modelo. </font><font style="vertical-align: inherit;">Os links dentro do objeto podem mudar, mas o link para o pr√≥prio objeto permanece constante. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m da fun√ß√£o getModel, o objeto moModel global possui fun√ß√µes de wrapper para a fun√ß√£o mitry m.request (), s√£o getList (model) e formSubmit (evento, modelo, m√©todo). </font><font style="vertical-align: inherit;">O par√¢metro model √© na verdade uma refer√™ncia ao objeto model, event √© o objeto de evento gerado quando o formul√°rio √© enviado, method √© o m√©todo HTTP com o qual queremos salvar a anota√ß√£o (POST √© uma nova anota√ß√£o, PATCH, DELETE √© antigo).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Representa√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pasta de exibi√ß√£o cont√©m fun√ß√µes respons√°veis ‚Äã‚Äãpela renderiza√ß√£o de elementos de p√°gina individuais. </font><font style="vertical-align: inherit;">Dividi-os em 4 partes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuApp - o componente raiz do aplicativo, </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNavBar - barra de navega√ß√£o,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes - uma lista de notas,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm - formul√°rio de edi√ß√£o de notas,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuDialog - elemento de di√°logo HTML </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O roteador determina que vuView (menu, vista) √© retornado em uma √∫nica rota. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Defini√ß√£o desta fun√ß√£o:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuView= <span class="hljs-function">(<span class="hljs-params">appMenu, view</span>)=&gt;</span> m(vuMain, appMenu, view);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse √© apenas um inv√≥lucro que retorna o componente vuMain, se o objeto appMenu for complexo o suficiente para ter objetos aninhados em estrutura semelhante a um objeto externo, esse inv√≥lucro √© uma maneira adequada de retornar um componente com diferentes elementos de navega√ß√£o e componentes filhos (voc√™ s√≥ precisa escrever menos c√≥digo) . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Componente VuMain:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> vuMain= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-comment">// We use ivnode as argument as it is initial vnode</span>
  <span class="hljs-keyword">const</span> { menu }= ivnode.attrs;
  <span class="hljs-keyword">return</span> { view(vnode) {
    <span class="hljs-comment">// IMPORTANT !</span>
    <span class="hljs-comment">// If we use vnode inside the view function we MUST provide it for view</span>
    <span class="hljs-keyword">return</span> [<font></font>
      m(menu),<font></font>
      m(<span class="hljs-string">'#layout'</span>, vnode.children)<font></font>
    ];<font></font>
  }};<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso simplesmente retorna os vnodes da navega√ß√£o e o conte√∫do real da p√°gina. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A seguir, onde for poss√≠vel definir um componente, usarei fechamentos. </font><font style="vertical-align: inherit;">Os fechamentos s√£o chamados uma vez durante a renderiza√ß√£o inicial da p√°gina e armazenam localmente todos os links passados ‚Äã‚Äãpara objetos e defini√ß√µes de suas pr√≥prias fun√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fechar como defini√ß√£o deve sempre retornar um componente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, na verdade, o componente de conte√∫do do aplicativo:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuApp= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-comment">//initially get notes</span><font></font>
  moModel.getList( model );<font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() { 
    <span class="hljs-keyword">return</span> [<font></font>
      m(vuNotes, { model }),<font></font>
      m(vuNoteForm, { model }),<font></font>
      vuModalDialog(model)<font></font>
    ];<font></font>
  }};<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como j√° temos um modelo, quando chamo de fechamento, quero obter a lista inteira de anota√ß√µes do banco de dados. </font><font style="vertical-align: inherit;">Haver√° tr√™s componentes na p√°gina:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNotes - uma lista de notas com o bot√£o Adicionar,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuNoteForm - formul√°rio de edi√ß√£o de notas,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuModalDialog - um elemento de di√°logo que mostraremos modalmente, e bateremos quando necess√°rio. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como cada um desses componentes precisa saber como se desenhar, passamos um link para o objeto de modelo em cada um. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lista de notas de componentes:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//Notes List</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> vuNotes= <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ivnode</span>) </span>{
  <span class="hljs-keyword">const</span> { model }= ivnode.attrs;
  <span class="hljs-keyword">const</span> _display= <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> model.editMode ? <span class="hljs-string">'display:none'</span>: <span class="hljs-string">'display:block'</span>;
  <span class="hljs-keyword">const</span> vuNote= noteItem(model); <span class="hljs-comment">// returns note function</span><font></font>
  <font></font>
  <span class="hljs-keyword">return</span> { view() {
    <span class="hljs-keyword">return</span> model.error ? m(<span class="hljs-string">'h2'</span>, {<span class="hljs-attr">style</span>: <span class="hljs-string">'color:red'</span>}, model.error) :<font></font>
    !model.list ? m(<span class="hljs-string">'h1'</span>, <span class="hljs-string">'...LOADING'</span> ) :<font></font>
    m(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">style</span>: _display() }, [<font></font>
      m(addButton , { model } ),<font></font>
      m(<span class="hljs-string">'.pure-g'</span>, m(<span class="hljs-string">'.pure-u-1-2.pure-u-md-1-1'</span>,<font></font>
        m(<span class="hljs-string">'.notes'</span>, model.list.map( vuNote ) )<font></font>
      ))<font></font>
    ]);<font></font>
  }};<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sinalizador bool editMode √© armazenado no objeto de modelo; se o valor do sinalizador for verdadeiro, mostraremos o formul√°rio de edi√ß√£o, caso contr√°rio - uma lista de notas. </font><font style="vertical-align: inherit;">Voc√™ pode elevar o teste um n√≠vel mais alto, mas o n√∫mero de n√≥s virtuais e os n√≥s DOM reais mudam toda vez que o sinalizador √© alternado, e isso √© um trabalho desnecess√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui somos idiom√°ticos para o mitril, geramos uma p√°gina, verificando a presen√ßa ou aus√™ncia de atributos no modelo usando operadores tern√°rios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° o fechamento que retorna a fun√ß√£o de exibi√ß√£o de notas:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> noteItem= <span class="hljs-function"><span class="hljs-params">model</span>=&gt;</span> {
  <span class="hljs-comment">// click event handler</span>
  <span class="hljs-keyword">const</span> event= <span class="hljs-function">(<span class="hljs-params"> msg, word=<span class="hljs-string">''</span>, time=<span class="hljs-literal">null</span></span>)=&gt;</span> <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    model.getItem(e.target.getAttribute(<span class="hljs-string">'data'</span>));
    <span class="hljs-keyword">if</span> ( !!msg ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">msg</span>: msg };<font></font>
      model.word= word;<font></font>
      <span class="hljs-keyword">if</span> ( !!time )<font></font>
        model.item.completed= time;<font></font>
      vuDialog.open();<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      model.editMode= <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
  };<font></font>
  <span class="hljs-comment">// trash icon's click handler</span>
  <span class="hljs-keyword">const</span> _trash= event(<span class="hljs-string">'trash'</span>, <span class="hljs-string">'Dlelete'</span>);<font></font>
  <font></font>
  <span class="hljs-comment">// check icon's click handler</span>
  <span class="hljs-keyword">const</span> _check= event(<span class="hljs-string">'check'</span>, <span class="hljs-string">'Complete'</span>,
    <span class="hljs-comment">// postgre timestamp string</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString().split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">'T'</span>, <span class="hljs-string">' '</span>));<font></font>
  <font></font>
  <span class="hljs-comment">// edit this note</span>
  <span class="hljs-keyword">const</span> _edit= event(<span class="hljs-string">''</span>);<font></font>
  <font></font>
  <span class="hljs-keyword">const</span> _time= <span class="hljs-function"><span class="hljs-params">ts</span>=&gt;</span> ts.split(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>];<font></font>
  <font></font>
  <span class="hljs-comment">// Single Note </span>
  <span class="hljs-keyword">const</span> _note= <span class="hljs-function"><span class="hljs-params">note</span>=&gt;</span> m(<span class="hljs-string">'section.note'</span>, {<span class="hljs-attr">key</span>: note.id}, [<font></font>
    m(<span class="hljs-string">'header.note-header'</span>, [ m(<span class="hljs-string">'p.note-meta'</span>, [
      <span class="hljs-comment">// note metadata</span>
      m(<span class="hljs-string">'span'</span>, { <span class="hljs-attr">style</span>: <span class="hljs-string">'padding: right: 3em'</span> }, <span class="hljs-string">`Created: <span class="hljs-subst">${_time( note.created )}</span>`</span>),<font></font>
      note.completed ? m(<span class="hljs-string">'span'</span>, <span class="hljs-string">`  Completed: <span class="hljs-subst">${_time( note.completed )}</span>`</span>) : <span class="hljs-string">''</span>, 
      <span class="hljs-comment">// note right panel </span>
      m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-trash'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _trash } )),<font></font>
      note.completed ? <span class="hljs-string">''</span> : [<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-pen'</span>, {<span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _edit } )),<font></font>
        m(<span class="hljs-string">'a.note-pan'</span>, m(<span class="hljs-string">'i.fas.fa-check'</span>, { <span class="hljs-attr">data</span>: note.id, <span class="hljs-attr">onclick</span>: _check} ))<font></font>
      ]<font></font>
    ]),<font></font>
      m(<span class="hljs-string">'h2.note-title'</span>, { <span class="hljs-attr">style</span>: note.completed ? <span class="hljs-string">'text-decoration: line-through'</span>: <span class="hljs-string">''</span>}, note.title)<font></font>
    ]),<font></font>
    m(<span class="hljs-string">'.note-content'</span>, m(<span class="hljs-string">'p'</span>, note.content))<font></font>
  ]);<font></font>
  <span class="hljs-keyword">return</span> _note;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todos os manipuladores de clique s√£o definidos localmente. O modelo n√£o sabe como o objeto de nota est√° estruturado; apenas defini a propriedade key, com a qual podemos selecionar o elemento desejado na matriz model.list. No entanto, o componente deve saber exatamente como o objeto que ele desenha √© estruturado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o fornecerei o texto completo do c√≥digo para o formul√°rio de edi√ß√£o da nota; apenas analisamos o manipulador de envio de formul√°rios separadamente:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// form submit handler</span>
  <span class="hljs-keyword">const</span> _submit= <span class="hljs-function"><span class="hljs-params">e</span>=&gt;</span> {<font></font>
    e.preventDefault();<font></font>
    model.item.title= clean(model.item.title);<font></font>
    model.item.content= clean(model.item.content);<font></font>
    <span class="hljs-keyword">const</span> check= check_note(model.item);
    <span class="hljs-keyword">if</span> ( !!check ) {<font></font>
      model.save= { <span class="hljs-attr">err</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">msg</span>: check }; <font></font>
      model.word= <span class="hljs-string">'Edit'</span>;<font></font>
      vuDialog.open();<font></font>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">return</span> moModel.formSubmit(e, model, _method() ).then(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { model.editMode=<span class="hljs-literal">false</span>; <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;}).catch(
      <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span> { vuDialog.open(); <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; } );<font></font>
  };</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Como a defini√ß√£o ocorre no fechamento, temos um link para o modelo e retornamos uma promessa com o processamento subsequente do resultado: proibi√ß√£o de mostrar o formul√°rio quando a solicita√ß√£o for conclu√≠da normalmente ou em caso de erro - abrir uma caixa de di√°logo com o texto do erro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada vez que voc√™ acessa o servidor back-end, a lista de notas √© relida. </font><font style="vertical-align: inherit;">Neste exemplo, n√£o h√° necessidade de ajustar a lista na mem√≥ria, embora isso possa ser feito. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O componente de di√°logo pode ser visualizado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reposit√≥rio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a √∫nica coisa que precisa ser enfatizada √© que, neste caso, usei um literal de objeto para definir o componente, porque quero que as fun√ß√µes de abertura e fechamento de janela estejam dispon√≠veis para outros componentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclus√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escrevemos um pequeno aplicativo SPA em javascript e mithril.js, tentando manter os idiomas dessa estrutura. </font><font style="vertical-align: inherit;">Quero prestar aten√ß√£o mais uma vez que este √© apenas c√≥digo javascript. </font><font style="vertical-align: inherit;">Talvez n√£o seja muito limpo. </font><font style="vertical-align: inherit;">A abordagem permite encapsular pequenos peda√ßos de c√≥digo, isolar a mec√¢nica de um componente e usar um estado comum para todos os componentes.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt492482/index.html">Eventos digitais em Moscou de 16 a 22 de mar√ßo</a></li>
<li><a href="../pt492484/index.html">Eventos digitais em S√£o Petersburgo, de 16 a 22 de mar√ßo</a></li>
<li><a href="../pt492486/index.html">Nuxt + Django + GraphQL por exemplo</a></li>
<li><a href="../pt492488/index.html">OpenID Connect: autoriza√ß√£o de aplicativos internos, do gen√©rico ao padr√£o</a></li>
<li><a href="../pt492492/index.html">NikiRobot - uma evolu√ß√£o na rob√≥tica educacional</a></li>
<li><a href="../pt492500/index.html">Science Garage em russo. Experi√™ncia na tradu√ß√£o de um programa americano</a></li>
<li><a href="../pt492502/index.html">MIP * = RE: evid√™ncias de √©poca do campo da ci√™ncia da computa√ß√£o que causaram o efeito domin√≥ na f√≠sica e na matem√°tica</a></li>
<li><a href="../pt492504/index.html">O que acontece quando um m√≥dulo JS √© importado duas vezes?</a></li>
<li><a href="../pt492506/index.html">3 maneiras de renderizar grandes listas em Angular</a></li>
<li><a href="../pt492508/index.html">Livro Kubernetes para DevOps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>