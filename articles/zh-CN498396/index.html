<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💚 🔪 👴🏽 .NET Framework应用程序的Linux容器（当很难使用.Net Core时） 👎🏿 ☝🏻 ♣️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="哈Ha 
 
 我想与世界分享至少对我来说是一项非典型的任务及其解决方案，在我看来这是可以接受的。下面描述的方法可能不是解决问题的理想方法，但是它可以正常工作，并且可以按预期工作。
 
 设置和背景
 有一项工作要做：您需要在现场制作各种设备，材料和物体的BIM模型的3D预览。需要轻巧，简单的东西。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.NET Framework应用程序的Linux容器（当很难使用.Net Core时）</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498396/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈Ha </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想与世界分享至少对我来说是一项非典型的任务及其解决方案，在我看来这是可以接受的。</font><font style="vertical-align: inherit;">下面描述的方法可能不是解决问题的理想方法，但是它可以正常工作，并且可以按预期工作。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置和背景</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有一项工作要做：您需要在现场制作各种设备，材料和物体的BIM模型的3D预览。</font><font style="vertical-align: inherit;">需要轻巧，简单的东西。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这些对象的模型以各种</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CAD系统的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专有格式</font><font style="vertical-align: inherit;">以及3D模型的开放格式的形式</font><font style="vertical-align: inherit;">存储在网站上，并可供下载</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其中包括</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFC</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我将其用作解决此任务的资源。</font></font><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项之一及其功能</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
形式上，人们可能会限制自己编写某种* .ifc转换器，以便将某些内容显示在网页上。</font><font style="vertical-align: inherit;">这是我开始的地方。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择了一个很棒的工具箱</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM工具箱</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行了这种转换</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用此工具的示例简单明了地</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述了</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何使用IFC和专门用于Web格式的* .wexBIM。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，将* .ifc转换为* .wexBIM：</font></font></b>
                        <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> Xbim.Ifc;
<span class="hljs-keyword">using</span> Xbim.ModelGeometry.Scene;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">CreateWexBIM</span><font></font>
{<font></font>
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">string</span> fileName = <span class="hljs-string">"SampleHouse.ifc"</span>;
            <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> model = IfcStore.Open(fileName))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> Xbim3DModelContext(model);<font></font>
                context.CreateContext();<font></font>
<font></font>
                <span class="hljs-keyword">var</span> wexBimFilename = Path.ChangeExtension(fileName, <span class="hljs-string">"wexBIM"</span>);
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBiMfile = File.Create(wexBimFilename))<font></font>
                {<font></font>
                    <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> wexBimBinaryWriter = <span class="hljs-keyword">new</span> BinaryWriter(wexBiMfile))<font></font>
                    {<font></font>
                        model.SaveAsWexBim(wexBimBinaryWriter);<font></font>
                        wexBimBinaryWriter.Close();<font></font>
                    }<font></font>
                    wexBiMfile.Close();<font></font>
                }<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，在“播放器” </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM WeXplorer中</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用生成的文件</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在页面中嵌入* .wexBIM的示例：</font></font></b>
                        <div class="spoiler_text"><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello building!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/xbim-viewer.debug.bundle.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"viewer"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">var</span> viewer = <span class="hljs-keyword">new</span> xViewer(<span class="hljs-string">'viewer'</span>);
            viewer.load(<span class="hljs-string">'data/SampleHouse.wexbim'</span>);
            viewer.start();
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，走吧。</font><font style="vertical-align: inherit;">我从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xBIM中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取细节。</font><font style="vertical-align: inherit;">我正在编写一个控制台应用程序，该应用程序接收一堆* .ifc文件的路径作为输入，并且在它们旁边添加了一堆* .wexBIM文件。</font><font style="vertical-align: inherit;">一切都可以上传到站点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是以某种方式它很简单...我希望该程序成为一种服务，它在向门户网站发送* .ifc事件后，立即创建必要的* .wexBIM，并立即出现在准备好的容器中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好的，我提出了新的要求：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让转换任务来自我们的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想以二进制消息的形式查看任务本身，实际上它已准备好由</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protobuf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">描述的类进行反序列</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">化</font></a><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该任务将包含一个链接，可从我们的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载源* .ifc文件</font><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 该任务还将告诉我在Minio的哪个存储桶中添加结果；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让应用程序本身在.net core 3.1下构建，并在“ docker farm”上的Linux docker容器内工作；</font></font></li>
</ol><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初的困难和约定</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我不会详细描述实施的前四点。</font><font style="vertical-align: inherit;">也许以后。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使应用程序侦听作业队列，并将包含结果的消息从</font><font style="vertical-align: inherit;">作业消息</font><font style="vertical-align: inherit;">的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CorrelationId</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送到队列</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">拧紧了protobuf生成的请求/响应类。</font><font style="vertical-align: inherit;">教用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载/上传文件</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我在控制台应用程序项目中所做的所有工作。</font><font style="vertical-align: inherit;">在项目设置中：</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netcoreapp3.1<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在装有Windows 10的计算机上，所有内容均已完全调试并正常工作。</font><font style="vertical-align: inherit;">但是，当我尝试在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSL中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行应用程序时</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">，出现</font></a><font style="vertical-align: inherit;">了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.IO.FileLoadException</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整的错误信息：</font></font></b>
                        <div class="spoiler_text"><pre><code class="json hljs">{
  <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileLoadException"</span>,
  <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Failed to load Xbim.Geometry.Engine64.dll"</span>,
  <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"Void .ctor(Microsoft.Extensions.Logging.ILogger`1[Xbim.Geometry.Engine.Interop.XbimGeometryEngine])"</span>,
  <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.get_Engine()\r\n at Xbim.ModelGeometry.Scene.Xbim3DModelContext.CreateContext(ReportProgressDelegate progDelegate, Boolean adjustWcs)\r\n at My.Converter.ConvertIfc.CreateWebIfc(String ifcFileFullPath, String wexBIMFolder)"</span>,
  <span class="hljs-attr">"Data"</span>: {},
  <span class="hljs-attr">"InnerException"</span>: {
    <span class="hljs-attr">"Type"</span>: <span class="hljs-string">"System.IO.FileNotFoundException"</span>,
    <span class="hljs-attr">"Message"</span>: <span class="hljs-string">"Could not load file or assembly 'Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified."</span>,
    <span class="hljs-attr">"FileName"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.dll, Culture=neutral, PublicKeyToken=null"</span>,
    <span class="hljs-attr">"FusionLog"</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">"TargetSite"</span>: <span class="hljs-string">"System.Reflection.RuntimeAssembly nLoad(System.Reflection.AssemblyName, System.String, System.Reflection.RuntimeAssembly, System.Threading.StackCrawlMark ByRef, Boolean, System.Runtime.Loader.AssemblyLoadContext)"</span>,
    <span class="hljs-attr">"StackTrace"</span>: <span class="hljs-string">" at System.Reflection.RuntimeAssembly.nLoad(AssemblyName fileName, String codeBase, RuntimeAssembly assemblyContext, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, StackCrawlMark&amp; stackMark, AssemblyLoadContext assemblyLoadContext)\r\n at System.Reflection.Assembly.Load(String assemblyString)\r\n at Xbim.Geometry.Engine.Interop.XbimGeometryEngine..ctor(ILogger`1 logger)"</span>,
    <span class="hljs-attr">"Data"</span>: {},
    <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"System.Private.CoreLib"</span>,
    <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2147024894</span><font></font>
  },<font></font>
  <span class="hljs-attr">"Source"</span>: <span class="hljs-string">"Xbim.Geometry.Engine.Interop"</span>,
  <span class="hljs-attr">"HResult"</span>: <span class="hljs-number">-2146232799</span>
}</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一段积极的谷歌搜索和深思熟虑的阅读告诉我，我非常专心：</font></font><br>
<blockquote>Recently at work, we were evaluating a few options to render building models in the browser. Building Information Modeling (BIM) in interoperability scenarios is done via Industry Foundation Classes, mostly in the STEP Physical File format. The schema is quite huge and complex with all the things you have to consider, so we were glad to find the xBim open source project on GitHub. They've got both projects to visualize building models in the browser with WebGL as well as conversion tools to create the binary-formatted geometry mesh. To achieve that, native C++ libraries are dynamically loaded (so no .Net Core compatibility) which must be present in the bin folder. The C++ libraries are expected either in the same folder as the application binaries or in a x64 (or x86, respectively) sub folder (See <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">here</a> for more details). In regular projects, the xBim.Geometry NuGet package adds a build task to copy the dlls into the build output folder, but this doesn't work with the new tooling. You can, however, get it to work in Visual Studio 2015 by taking care of supplying the interop dlls yourself.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类似的困难并不仅仅针对我。</font><font style="vertical-align: inherit;">很多人都希望</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在.Net Core下使用xBIM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并不是很关键，但是它发生了很大的变化……这都</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">归结</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为无法</font><i><font style="vertical-align: inherit;">正常</font></i><font style="vertical-align: inherit;">加载</font><i><font style="vertical-align: inherit;">Xbim.Geometry.Engine64.dll</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您需要在</font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上安装</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">vc_redist.x64.exe</font></a></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我有什么选择？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我想到的第一件事是：“可以使用具有完整.Net框架的Windows容器吗？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将适用于Visual Studio 2015、2017和2019的Microsoft Visual C ++可再发行组件交付到此容器，一切都会好吗？” </font><font style="vertical-align: inherit;">我尝试了这个：</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为Docker测试Windows映像：</font></font></b>
                        <div class="spoiler_text"> .Net Core :<br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>net47<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span></code></pre><br>
Dockerfile:<br>
<br>
<pre><code class="powershell hljs">FROM microsoft/dotnet<span class="hljs-literal">-framework</span>:<span class="hljs-number">4.7</span><font></font>
WORKDIR /bimlibconverter<font></font>
<span class="hljs-built_in">COPY</span> lib/VC_redist.x64.exe /VC_redist.x64.exe<font></font>
RUN C:\VC_redist.x64.exe /quiet /install<font></font>
<span class="hljs-built_in">COPY</span> bin/Release .<font></font>
ENTRYPOINT [<span class="hljs-string">"MyConverter.exe"</span>]</code></pre></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好吧，它奏效了...还活着！</font><font style="vertical-align: inherit;">但。</font><font style="vertical-align: inherit;">但是带docker的主机Linux机器呢？</font><font style="vertical-align: inherit;">使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server Core</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的映像来驱动容器将不起作用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">需要下车...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥协与掩饰</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
网上的另一次搜索带给我</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一篇文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在其中，作者需要类似的实现：</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更糟的是：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有二进制文件都是32位（x86）。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有些需要可视化的C ++可再发行运行时组件。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有些需要.NET运行时。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使我们仅使用命令行界面（CLI），有些也需要开窗系统。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这篇文章描述了在Linux容器中的wine中运行Windows应用程序的潜力。</font><font style="vertical-align: inherit;">很好奇，我决定。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
经过一些测试，错误和补充后，收到了Dockerfile：</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有Wine，.Net Framework和vcredist的基于Ubuntu的Docker镜像：</font></font></b>
                        <div class="spoiler_text"><pre><code class="powershell hljs"><font></font>
FROM ubuntu:latest<font></font>
<span class="hljs-comment">#  x86</span>
RUN dpkg -<span class="hljs-literal">-add</span><span class="hljs-literal">-architecture</span> i386 \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-get</span> update \
    <span class="hljs-comment">#   </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        software<span class="hljs-literal">-properties</span><span class="hljs-literal">-common</span> \<font></font>
        gnupg2 \<font></font>
        <span class="hljs-built_in">wget</span> \<font></font>
        xvfb \<font></font>
        cabextract \<font></font>
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; <span class="hljs-built_in">wget</span> <span class="hljs-literal">-nv</span> https://dl.winehq.org/wine<span class="hljs-literal">-builds</span>/winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-key</span> add winehq.key \<font></font>
    &amp;&amp; apt<span class="hljs-literal">-add</span><span class="hljs-literal">-repository</span> <span class="hljs-string">'deb https://dl.winehq.org/wine-builds/ubuntu/ bionic main'</span> \
    <span class="hljs-comment">#     Wine</span>
    &amp;&amp; <span class="hljs-built_in">add-apt</span><span class="hljs-literal">-repository</span> ppa:cybermax<span class="hljs-literal">-dexter</span>/sdl2<span class="hljs-literal">-backport</span> \
    <span class="hljs-comment">#  Wine</span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> install <span class="hljs-literal">-qfy</span> -<span class="hljs-literal">-install</span><span class="hljs-literal">-recommends</span> \<font></font>
        winehq<span class="hljs-literal">-staging</span> \<font></font>
        winbind \<font></font>
    <span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo<font></font>
<span class="hljs-comment">#    Wine</span>
ENV WINEDEBUG=fixme<span class="hljs-literal">-all</span><font></font>
ENV WINEPREFIX=/root/.net<font></font>
ENV WINEARCH=win64<font></font>
<span class="hljs-comment">#  Wine</span><font></font>
RUN winecfg \<font></font>
    <span class="hljs-comment"># winetricks,   .Net Framework  </span>
    &amp;&amp; <span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks \
    <span class="hljs-literal">-O</span> /usr/local/bin/winetricks \<font></font>
    &amp;&amp; chmod +x /usr/local/bin/winetricks \<font></font>
<span class="hljs-comment"># </span>
    &amp;&amp; apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> clean \<font></font>
    &amp;&amp; <span class="hljs-built_in">rm</span> <span class="hljs-literal">-rf</span> \<font></font>
      /var/lib/apt/lists/* \<font></font>
      /usr/share/doc \<font></font>
      /usr/share/doc<span class="hljs-literal">-base</span> \<font></font>
      /usr/share/<span class="hljs-built_in">man</span> \<font></font>
      /usr/share/locale \<font></font>
      /usr/share/zoneinfo \<font></font>
    <span class="hljs-comment"># Wine   </span>
    &amp;&amp; wineboot <span class="hljs-literal">-u</span> &amp;&amp; winetricks <span class="hljs-literal">-q</span> dotnet472 &amp;&amp; xvfb<span class="hljs-literal">-run</span> winetricks <span class="hljs-literal">-q</span> vcrun2015<font></font>
<font></font>
WORKDIR /root/.net/drive_c/myconverter/<font></font>
<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-built_in">COPY</span> /bin/Release/ /root/.net/drive_c/myconverter/<font></font>
<font></font>
ENTRYPOINT [<span class="hljs-string">"wine"</span>, <span class="hljs-string">"MyConverter.exe"</span>]
</code></pre><br>
UPD:        .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">rueler</a><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
构建不是很快，但是成功结束了。</font><font style="vertical-align: inherit;">我尝试，检查一下。</font><font style="vertical-align: inherit;">作品！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果，结论，想法</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有效。</font><font style="vertical-align: inherit;">输出是docker容器的Linux映像。</font><font style="vertical-align: inherit;">它是“蓬松的”（〜5.2GB），但是启动非常快，并且在.Net Framework 4.7上运行Windows控制台应用程序，该应用程序侦听RabbitMQ，将日志写入</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graylog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将文件下载并上传</font><font style="vertical-align: inherit;">到</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Minio</font></a><font style="vertical-align: inherit;">中。</font><font style="vertical-align: inherit;">我将通过远程docker API更新应用程序。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
解决了功利主义专用任务的解决方案。</font><font style="vertical-align: inherit;">也许而且很可能不是普遍的。</font><font style="vertical-align: inherit;">但原则上我感到满意。</font><font style="vertical-align: inherit;">也许有人也会派上用场。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
谢谢阅读。</font><font style="vertical-align: inherit;">我第一次在Habr上写作。</font><font style="vertical-align: inherit;">在评论中见。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN498378/index.html">敏捷宣布Slurm的夜校</a></li>
<li><a href="../zh-CN498380/index.html">欧弗顿的行动之窗：如何利用大流行来限制我们的自由</a></li>
<li><a href="../zh-CN498390/index.html">IAR + Clion =友谊</a></li>
<li><a href="../zh-CN498392/index.html">18个GitLab功能开源</a></li>
<li><a href="../zh-CN498394/index.html">尖叫的青蛙和Netpeak蜘蛛的7个免费类似物</a></li>
<li><a href="../zh-CN498398/index.html">KOMPAS开发人员-设计师还是程序员？</a></li>
<li><a href="../zh-CN498402/index.html">葡萄糖及其食用</a></li>
<li><a href="../zh-CN498404/index.html">视频会议既简单又免费</a></li>
<li><a href="../zh-CN498406/index.html">一位杰出的年轻程序员的个性是如何被摧毁的</a></li>
<li><a href="../zh-CN498410/index.html">适用于PC的Vivaldi和适用于Android的Vivaldi-得分为3.0的团队游戏</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>