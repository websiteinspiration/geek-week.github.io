<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèº ü§¶üèΩ ü§úüèº .NET: Tratamento de Depend√™ncias üÜñ üèÇüèª ‚õπüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quem n√£o encontrou problemas devido ao redirecionamento de montagem? Provavelmente, todos que desenvolveram um aplicativo relativamente grande enfrent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.NET: Tratamento de Depend√™ncias</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/499838/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem n√£o encontrou problemas devido ao redirecionamento de montagem? </font><font style="vertical-align: inherit;">Provavelmente, todos que desenvolveram um aplicativo relativamente grande enfrentar√£o mais cedo ou mais tarde esse problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, trabalho no JetBrains, no projeto JetBrains Rider, e estou envolvido na tarefa de migrar o Rider para o .NET Core. </font><font style="vertical-align: inherit;">Anteriormente envolvido em infraestrutura compartilhada no Circuit, uma plataforma de hospedagem de aplicativos baseada em nuvem. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/je/f5/e-/jef5e-nc0okqm_ssla0qhniugio.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sob a cena, est√° a transcri√ß√£o do meu relat√≥rio da confer√™ncia DotNext 2019 em Moscou, onde falei sobre as dificuldades ao trabalhar com assemblies no .NET e mostrei com exemplos pr√°ticos o que acontece e como lidar com isso.</font></font><a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/fMlTLw1agE0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em todos os projetos em que trabalhei como desenvolvedor .NET, tive que lidar com v√°rios problemas ao conectar depend√™ncias e carregar assemblies. </font><font style="vertical-align: inherit;">N√≥s vamos falar sobre isso.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estrutura do cargo:</font></font></h2><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problemas de depend√™ncia</font></font></b></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carga rigorosa da plataforma</font></font></b></a><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redirecionamentos de liga√ß√£o</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomea√ß√£o forte</font></font></a></li>
</ul><br>
</li>
<li><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET Core</font></font></a></b> <br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estruturas compartilhadas, .runtimeconfig.json</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manifesto de depend√™ncia (.deps.json)</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hacks para executar o JetBrains Rider no Core</font></font></a></li>
</ul><br>
</li>
<li><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depurar downloads de assembly</font></font></a> </b><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logs de fus√£o</font></font></a> </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos de tempo de execu√ß√£o</font></font></a></li>
</ul><br>
</li>
</ol><br>
<a name="problems"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quais s√£o alguns problemas de depend√™ncia?</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando eles come√ßaram a desenvolver o .NET Framework no in√≠cio dos anos 2000, o problema do inferno da Depend√™ncia j√° era conhecido quando os desenvolvedores de todas as bibliotecas permitiam quebrar altera√ß√µes, e essas bibliotecas se tornaram incompat√≠veis para uso com o c√≥digo j√° compilado. </font><font style="vertical-align: inherit;">Como resolver esse problema? </font><font style="vertical-align: inherit;">A primeira solu√ß√£o √© √≥bvia. </font><font style="vertical-align: inherit;">Sempre mantenha compatibilidade com vers√µes anteriores. </font><font style="vertical-align: inherit;">Obviamente, isso n√£o √© muito realista, porque quebrar as mudan√ßas √© muito f√°cil de inserir no c√≥digo. </font><font style="vertical-align: inherit;">Por exemplo: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/un/gj/tv/ungjtvaiofi7qkm6a4if5cpgh10.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quebrando Altera√ß√µes e Bibliotecas .NET</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© um exemplo espec√≠fico para o .NET. Temos um m√©todo e decidimos adicionar um par√¢metro com um valor padr√£o. O c√≥digo continuar√° a ser compilado se o montarmos novamente, mas bin√°rios ser√£o dois m√©todos completamente diferentes: um m√©todo tem zero argumentos, o segundo m√©todo tem um argumento. Se o desenvolvedor dentro da depend√™ncia quebrou a compatibilidade com vers√µes anteriores dessa maneira, n√£o poderemos usar o c√≥digo que foi compilado com essa depend√™ncia na vers√£o anterior.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda solu√ß√£o para problemas de depend√™ncia √© adicionar controle de vers√£o de bibliotecas, assemblies - qualquer coisa. Pode haver regras de vers√£o diferentes, o ponto √© que, de alguma forma, podemos distinguir vers√µes diferentes da mesma biblioteca uma da outra, e voc√™ pode entender se a atualiza√ß√£o ser√° interrompida ou n√£o. Infelizmente, assim que apresentamos as vers√µes, um tipo diferente de problema aparece. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vg/xc/wu/vgxcwufmesq4jly-ecfrh5p-ko8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vers√£o infernal √© a incapacidade de usar uma depend√™ncia que √© compat√≠vel com bin√°rios, mas ao mesmo tempo possui uma vers√£o que n√£o se encaixava no tempo de execu√ß√£o ou outro componente que verifica essas vers√µes. No .NET, uma manifesta√ß√£o t√≠pica da vers√£o infernal √© FileLoadException, embora o arquivo esteja no disco, mas, por algum motivo, n√£o √© carregado com o tempo de execu√ß√£o.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qy/wg/5m/qywg5mjhpkuogm6yez7uhnxitji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No .NET, os assemblies t√™m muitas vers√µes diferentes - eles tentaram corrigir os infernos da vers√£o de v√°rias maneiras e ver o que aconteceu. N√≥s temos um pacote </font></font><code>System.Collections.Immutable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Muitas pessoas o conhecem. Ele tem a vers√£o mais recente do pacote NuGet 1.6.0. Ele cont√©m uma biblioteca, um assembly com a vers√£o 1.2.4.0. Voc√™ recebeu que voc√™ n√£o possui uma vers√£o 1.2.4.0 da biblioteca de compila√ß√£o. Como entender que ele se encontra no pacote 1.6.0 NuGet? N√£o vai ser f√°cil. Al√©m da vers√£o do assembly, esta biblioteca possui v√°rias outras vers√µes. Por exemplo, Vers√£o do arquivo de montagem, Vers√£o de informa√ß√µes da montagem. Na verdade, este pacote NuGet cont√©m tr√™s assemblies diferentes com as mesmas vers√µes (para vers√µes diferentes do .NET Standard). </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documenta√ß√£o do .NET </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opbuild padr√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muita documenta√ß√£o foi escrita sobre como trabalhar com assemblies no .NET. </font><font style="vertical-align: inherit;">Existe um Guia .NET para o desenvolvimento de aplicativos modernos para o .NET, levando em considera√ß√£o o .NET Framework, .NET Standard, .NET Core, c√≥digo aberto e tudo o que pode ser. </font><font style="vertical-align: inherit;">Cerca de 30% de todo o documento √© dedicado ao carregamento de montagens. </font><font style="vertical-align: inherit;">Analisaremos problemas e exemplos espec√≠ficos que possam surgir.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por que tudo isso √© necess√°rio? </font><font style="vertical-align: inherit;">Em primeiro lugar, para evitar pisar em um ancinho. </font><font style="vertical-align: inherit;">Em segundo lugar, voc√™ pode facilitar a vida dos usu√°rios de suas bibliotecas, pois com a biblioteca eles n√£o ter√£o os problemas de depend√™ncia aos quais est√£o acostumados. </font><font style="vertical-align: inherit;">Tamb√©m ajudar√° voc√™ a lidar com a migra√ß√£o de aplicativos complexos para o .NET Core. </font><font style="vertical-align: inherit;">E ainda por cima, voc√™ pode se tornar um SRE, este √© um engenheiro de redirecionamento s√™nior (obrigat√≥rio), para o qual todos da equipe v√™m e perguntam como escrever outro redirecionamento.</font></font><a name="assembly"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem rigorosa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O carregamento estrito do assembly √© o principal problema que os desenvolvedores do .NET Framework est√£o enfrentando. </font><font style="vertical-align: inherit;">√â expresso em </font></font><code>FileLoadException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Antes de passar para o carregamento restrito da montagem, deixe-me lembr√°-lo de algumas coisas b√°sicas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao criar um aplicativo .NET, voc√™ acaba com algum artefato, geralmente localizado na Lixeira / Depura√ß√£o ou na Lixeira / Libera√ß√£o, e cont√©m um determinado conjunto de assemblies de montagem e arquivos de configura√ß√£o. </font><font style="vertical-align: inherit;">Assemblies se referem um ao outro por nome, nome do assembly. </font><font style="vertical-align: inherit;">√â importante entender que os links de montagem est√£o localizados diretamente na montagem que faz refer√™ncia a essa montagem; n√£o h√° arquivos de configura√ß√£o m√°gica nos quais as refer√™ncias de montagem s√£o gravadas. </font><font style="vertical-align: inherit;">Embora possa parecer que esses arquivos existem. </font><font style="vertical-align: inherit;">As refer√™ncias est√£o nas pr√≥prias assembl√©ias na forma bin√°ria.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No .NET, existe um processo de resolu√ß√£o de montagem - √© quando a defini√ß√£o de montagem j√° √© convertida em uma montagem real, que est√° em disco ou carregada em algum lugar da mem√≥ria. A resolu√ß√£o de montagem √© realizada duas vezes: no est√°gio de constru√ß√£o, quando voc√™ tem refer√™ncias em * .csproj, e em tempo de execu√ß√£o, quando voc√™ tem refer√™ncias dentro dos assemblies, e por algumas regras eles se transformam em assemblies que podem ser baixados. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// Nome simples </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MyAssembly, Vers√£o = 6.0.0.0, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cultura = neutra, PublicKeyToken = null </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
// Nome forte </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Newtonsoft.Json, Vers√£o = 6.0.0.0, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cultura = neutra, PublicKeyToken = 30ad4fe6b2a6aeed // PublicKey</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos para o problema. Nome da montagem, existem dois tipos principais. O primeiro tipo de nome de montagem √© Nome simples. Eles s√£o f√°ceis de identificar pelo fato de terem PublicKeyToken = null. H√° um nome Forte, √© f√°cil identific√°-los pelo fato de que o PublicKeyToken n√£o √© nulo, mas sim algum valor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/40/0v/uf/400vuf0e3w-ykw2fkdx2-ufdutq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos dar um exemplo. Temos um programa que depende da biblioteca com os utilit√°rios do MyUtils, e a vers√£o do MyUtils √© 9.0.0.0. O mesmo programa possui um link para outra biblioteca. Essa biblioteca tamb√©m deseja usar o MyUtils, mas a vers√£o 6.0.0.0. MyUtils vers√£o 9.0.0.0 e vers√£o 6.0.0.0 t√™m PublicKeyToken = null, ou seja, eles t√™m um nome simples. Qual vers√£o cair√° no artefato bin√°rio, 6.0.0.0 ou 9.0.0.0? 9¬™ vers√£o. O MyLibrary pode usar o MyUtils vers√£o 9.0.0.0, que entrou no artefato bin√°rio?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/js/fs/2x/jsfs2xd1erckl8dkphbrhojfhxk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, pode, porque MyUtils tem um nome Simples e, portanto, o carregamento de montagem Rigoroso n√£o existe para ele. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/kz/tn/a6/kztna61effl0kkiuwnkvi1gpad8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro exemplo. </font><font style="vertical-align: inherit;">Em vez de MyUtils, temos uma biblioteca completa do NuGet, que tem um nome Forte. </font><font style="vertical-align: inherit;">A maioria das bibliotecas do NuGet tem um nome Forte.</font></font><br>
<br>
<a name="redirects"></a><img src="https://habrastorage.org/webt/rr/xp/qi/rrxpqilvehdbvemijol2iuutbie.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No est√°gio de compila√ß√£o, a vers√£o 9.0.0.0 √© copiada para o BIN, mas em tempo de execu√ß√£o obtemos o famoso </font></font><code>FileLoadException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para que MyLibrary, que deseja a vers√£o 6.0.0.0 </font></font><code>Newtonsoft.Json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, possa usar a vers√£o 9.0.0.0, voc√™ deve escrever o redirecionamento Binding </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redirecionamentos de liga√ß√£o</font></font></h3><br>
<br>
<img src="https://habrastorage.org/webt/lw/d_/yq/lwd_yq2otb7kqsbpkpglszjlr-y.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redirecionando vers√µes de assembly</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Declara que um assembly com esse nome e publicKeyToken deve ser redirecionado de um intervalo de vers√µes para um intervalo de vers√µes. </font><font style="vertical-align: inherit;">Parece ser um registro muito simples, mas, no entanto, est√° localizado aqui </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas pode estar em outros arquivos. </font><font style="vertical-align: inherit;">H√° um arquivo </font></font><code>machine.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dentro do .NET Framework, dentro do tempo de execu√ß√£o, no qual √© definido um conjunto padr√£o de redirecionamentos, que podem diferir de vers√£o para vers√£o do .NET Framework. </font><font style="vertical-align: inherit;">Pode acontecer que no 4.7.1 nada funcione para voc√™, mas no 4.7.2 ele j√° funciona, ou vice-versa. </font><font style="vertical-align: inherit;">Voc√™ precisa ter em mente que os redirecionamentos podem vir n√£o apenas do seu </font></font><code>.App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e isso deve ser levado em considera√ß√£o durante a depura√ß√£o.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplificamos a escrita de redirecionamentos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ningu√©m quer escrever redirecionamentos de encaderna√ß√£o com as m√£os. Vamos dar esta tarefa ao MSBuild! </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pg/qk/ct/pgqkctk1hwcp0lewpamhi5wn35o.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como habilitar e desabilitar o redirecionamento autom√°tico de liga√ß√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Algumas dicas sobre como simplificar o trabalho com o redirecionamento de liga√ß√£o. Dica um: Habilite a gera√ß√£o autom√°tica de redirecionamento de liga√ß√£o no MSBuild. Ativado por propriedade em </font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ao criar um projeto, ele cair√° em um artefato bin√°rio </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que indica redirecionamentos para vers√µes de bibliotecas que est√£o no mesmo artefato. Isso funciona apenas para aplicativos em execu√ß√£o, aplicativo de console, WinExe. Para bibliotecas, isso n√£o funciona, porque para bibliotecas</font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na maioria das vezes, simplesmente n√£o √© relevante, porque √© relevante para um aplicativo que inicia e carrega os pr√≥prios conjuntos. Se voc√™ fez uma configura√ß√£o para a biblioteca, no aplicativo algumas depend√™ncias tamb√©m podem diferir daquelas que estavam ao criar a biblioteca, e acontece que a configura√ß√£o da biblioteca n√£o faz muito sentido. No entanto, √†s vezes para configura√ß√µes de bibliotecas ainda fazem sentido. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ik/g6/6n/ikg66nyqel3ejmqbln9xb1magyq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A situa√ß√£o quando escrevemos testes. Os testes geralmente s√£o encontrados na ClassLibrary e tamb√©m precisam de redirecionamentos. As estruturas de teste s√£o capazes de reconhecer que a biblioteca com testes possui uma configura√ß√£o de dll e trocar os redirecionamentos neles pelo c√≥digo dos testes. Voc√™ pode gerar esses redirecionamentos automaticamente. Se tivermos um formato antigo</font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o no estilo SDK, voc√™ pode seguir o caminho simples, alterar o OutputType para Exe e adicionar um ponto de entrada vazio, isso for√ßar√° o MSBuild a gerar redirecionamentos. Voc√™ pode ir para o outro lado e usar o hack. Voc√™ pode adicionar outra propriedade a </font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o que faz o MSBuild considerar que, para esse OutputType, voc√™ ainda precisa gerar redirecionamentos de liga√ß√£o. Esse m√©todo, embora pare√ßa um hack, permitir√° gerar redirecionamentos para bibliotecas que n√£o podem ser refeitas no Exe e para outros tipos de projetos (exceto testes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o novo formato, os </font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√≥prios redirecionamentos ser√£o gerados se voc√™ usar o Microsoft.NET.Test.Sdk moderno.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terceira dica: n√£o use a gera√ß√£o de redirecionamento Binding com o NuGet. O NuGet tem a capacidade de gerar redirecionamento de liga√ß√£o para bibliotecas que passam de pacotes para as vers√µes mais recentes, mas essa n√£o √© a melhor op√ß√£o. Todos esses redirecionamentos precisar√£o ser adicionados </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e confirmados e, se voc√™ gerar redirecionamentos usando o MSBuild, os redirecionamentos ser√£o gerados durante a compila√ß√£o. Se voc√™ os confirmar, pode haver conflitos de mesclagem. Voc√™ mesmo pode simplesmente esquecer de atualizar o redirecionamento de Liga√ß√£o no arquivo e, se eles forem gerados durante a compila√ß√£o, voc√™ n√£o esquecer√°. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/yi/fr/zq/yifrzq4fnvwitenrhkteup1cjfq.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resolver refer√™ncia de montagem </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerar redirecionamentos de encaderna√ß√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Li√ß√£o de casa para quem quer entender melhor como a gera√ß√£o de redirecionamentos Binding funciona: descubra como funciona, veja isso no c√≥digo. V√° para o diret√≥rio .NET, esbarre em qualquer lugar com a propriedade name, que √© usada para habilitar a gera√ß√£o. Geralmente, essa √© uma abordagem comum; se houver alguma propriedade estranha para o MSBuild, voc√™ poder√° aproveitar o uso. Felizmente, a propriedade geralmente √© usada nas configura√ß√µes XML, e voc√™ pode facilmente encontrar seu uso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ examinar o que h√° nesses destinos XML, ver√° que essa propriedade dispara duas tarefas do MSBuild. A primeira tarefa √© chamada </font></font><code>ResolveAssemblyReferences</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e gera um conjunto de redirecionamentos que s√£o gravados nos arquivos. A segunda tarefa </font></font><code>GenerateBindingRedirects</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grava os resultados da primeira tarefa em</font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Existe uma l√≥gica XML que corrige levemente a opera√ß√£o da primeira tarefa e remove alguns redirecionamentos desnecess√°rios ou adiciona novos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alternativa √†s configura√ß√µes XML</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nem sempre √© conveniente manter os redirecionamentos na configura√ß√£o XML. </font><font style="vertical-align: inherit;">Podemos ter uma situa√ß√£o em que o aplicativo baixa o plug-in, e esse plug-in usa outras bibliotecas que exigem redirecionamentos. </font><font style="vertical-align: inherit;">Nesse caso, podemos n√£o estar cientes do conjunto de redirecionamentos de que precisamos ou talvez n√£o desejemos gerar XML. </font><font style="vertical-align: inherit;">Em tal situa√ß√£o, podemos criar um AppDomain e, quando ele √© criado, ainda transferir para onde o XML com os redirecionamentos necess√°rios est√° localizado. </font><font style="vertical-align: inherit;">Tamb√©m podemos lidar com erros de carregamento de montagem diretamente no tempo de execu√ß√£o. </font><font style="vertical-align: inherit;">O Rantime .NET oferece essa oportunidade.</font></font><br>
<br>
<pre><code class="cs hljs">AppDomain.CurrentDomain.AssemblyResolve += (sender, eventArgs) =&gt; <font></font>
{ <font></font>
   <span class="hljs-keyword">var</span> name = eventArgs.Name; 
   <span class="hljs-keyword">var</span> requestingAssembly = eventArgs.RequestingAssembly; <font></font>
   <font></font>
   <span class="hljs-keyword">return</span> Assembly.LoadFrom(...); <span class="hljs-comment">// PublicKeyToken should be equal</span><font></font>
};<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tem um evento, √© chamado </font></font><code>CurrentDomain.AssemblyResolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ao assinar este evento, receberemos erros sobre todos os downloads de montagem com falha. Obtemos o nome da montagem que n√£o foi carregada e obtemos a montagem que solicitou o carregamento da primeira montagem. Aqui, podemos carregar manualmente o assembly do lugar certo, por exemplo, descartando a vers√£o, apenas retirando-a do arquivo e retornando esse evento do manipulador. Ou retorne null se n√£o tivermos o que retornar, se n√£o pudermos carregar a montagem. PublicKeyToken deve ser o mesmo; assemblies com diferentes PublicKeyToken n√£o s√£o de forma alguma amigos um do outro.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8q/m7/ge/8qm7ge64h4pbldvju9ya91uz8zm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este evento se aplica a apenas um dom√≠nio de aplicativo. </font><font style="vertical-align: inherit;">Se nosso plugin criar um AppDomain dentro de si, esse redirecionamento no tempo de execu√ß√£o n√£o funcionar√° neles. </font><font style="vertical-align: inherit;">De alguma forma, voc√™ precisa se inscrever neste evento em todo o AppDomain que o plug-in criou. </font><font style="vertical-align: inherit;">Podemos fazer isso usando o AppDomainManager. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AppDomainManager √© um assembly separado que cont√©m uma classe que implementa uma interface espec√≠fica e um dos m√©todos dessa interface permitir√° que voc√™ inicialize qualquer novo AppDomain criado no aplicativo. </font><font style="vertical-align: inherit;">Depois que o AppDomain √© criado, esse m√©todo ser√° chamado. </font><font style="vertical-align: inherit;">Nele voc√™ pode se inscrever neste evento.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamento rigoroso de montagem e .NET Core</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No .NET Core, n√£o h√° problema chamado "Carregamento estrito de assembly", devido ao fato de os assemblies assinados exigirem exatamente a vers√£o solicitada. H√° outro requisito. Para todos os assemblies, independentemente de serem ou n√£o assinados pelo nome Strong, √© verificado se a vers√£o que foi carregada em tempo de execu√ß√£o √© maior ou igual √† anterior. Se estivermos na situa√ß√£o de um aplicativo com plug-ins, √© poss√≠vel que o plug-in tenha sido criado, por exemplo, a partir de uma nova vers√£o do SDK, e o aplicativo para o qual ele √© baixado use a vers√£o antiga do SDK at√© o momento e, em vez de desmoronar, tamb√©m podemos assinar este evento, mas j√° no .NET Core, e tamb√©m carregar o assembly que temos. Podemos escrever este c√≥digo:</font></font><br>
<pre><code class="cs hljs">AppDomain.CurrentDomain.AssemblyResolve += (s, eventArgs) =&gt; <font></font>
{ <font></font>
     CheckForRecursion(); <font></font>
     <span class="hljs-keyword">var</span> name = eventArgs.Name;
     <span class="hljs-keyword">var</span> requestingAssembly = eventArgs.RequestingAssembly; <font></font>
    <font></font>
     name.Version = <span class="hljs-keyword">new</span> Version(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <font></font>
     <font></font>
     <span class="hljs-keyword">return</span> Assembly.Load(name); <font></font>
};<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos o nome do assembly que n√£o inicializou, anulamos a vers√£o e a chamamos </font></font><code>Assembly.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da mesma vers√£o. N√£o haver√° recurs√£o aqui, porque eu j√° verifiquei a recurs√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/mt/cs/kr/mtcskrokxuvcn8i4gueywowb3_m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi necess√°rio fazer o download do MyUtils vers√£o 0.0.2.0. No BIN, temos o MyUtils vers√£o 0.0.1.0. Fizemos um redirecionamento da vers√£o 0.0.2.0 para a vers√£o 0.0. A vers√£o 0.0.1.0 n√£o ser√° carregada conosco. Ser√° emitida uma sa√≠da para n√≥s, que n√£o foi poss√≠vel carregar o conjunto com a vers√£o 0.0.2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16‚Äì1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16-1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">new</span> Version(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == <span class="hljs-keyword">new</span> Version(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>) <font></font>
<font></font>
<span class="hljs-keyword">class</span> <span class="hljs-title">Version</span> { 
     <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> _Build; 
     <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> _Revision; 
     <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> _Major; 
     <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> _Minor; <font></font>
} <font></font>
(<span class="hljs-keyword">ushort</span>) <span class="hljs-number">-1</span> == <span class="hljs-number">65535</span>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na classe Vers√£o, nem todos os componentes s√£o obrigat√≥rios e, em vez dos componentes opcionais ‚Äì1, s√£o armazenados, mas em algum lugar interno ocorre um estouro e os 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16‚Äì1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s√£o obtidos </font><font style="vertical-align: inherit;">. Se estiver interessado, voc√™ pode tentar encontrar exatamente onde ocorre o estouro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/m5/bl/vl/m5blvl8u1xrfdigr0ay45_ps3q8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ trabalha com montagens de reflex√£o e deseja obter todos os tipos, pode ser que nem todos os tipos possam obter o seu m√©todo GetTypes. Um assembly tem uma classe que herda de outra classe que est√° em um assembly que n√£o est√° carregado.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> IEnumerable <span class="hljs-title">GetTypesSafe</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Assembly assembly</span>)</span> <font></font>
{ <font></font>
    <span class="hljs-keyword">try</span> <font></font>
    { <font></font>
        <span class="hljs-keyword">return</span> assembly.GetTypes(); <font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span> (ReflectionTypeLoadException e) <font></font>
   { <font></font>
        <span class="hljs-keyword">return</span> e.Types.Where(x =&gt; x != <span class="hljs-literal">null</span>); <font></font>
    } <font></font>
}<font></font>
<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse caso, o problema ser√° que um ReflectionTypeLoadException ser√° lan√ßado. </font><font style="vertical-align: inherit;">Dentro, </font></font><code>ReflectionTypeLoadException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√° uma propriedade na qual existem esses tipos que ainda conseguiram ser carregados. </font><font style="vertical-align: inherit;">Nem todas as bibliotecas populares levam isso em considera√ß√£o. </font><font style="vertical-align: inherit;">O AutoMapper, pelo menos uma de suas vers√µes, se confrontado com ReflectionTypeLoadException, caiu, em vez de ir e escolher os tipos por dentro da exce√ß√£o.</font></font><a name="name"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomea√ß√£o forte</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagens com nome forte</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Vamos falar sobre o que causa o carregamento restrito de montagem, este √© o nome Forte. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nome forte √© a assinatura do assembly por alguma chave privada usando criptografia assim√©trica. PublicKeyToken √© o hash da chave p√∫blica deste assembly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A nomea√ß√£o forte permite distinguir entre diferentes montagens que t√™m o mesmo nome. Por exemplo, MyUtils n√£o √© um nome exclusivo, pode haver v√°rios assemblies com o mesmo nome, mas se voc√™ assinar Nome forte, eles ter√£o PublicKeyToken diferente e podemos distingui-los dessa maneira. O nome forte √© necess√°rio para alguns cen√°rios de carregamento de montagem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, para instalar um assembly no Global Assembly Cache ou fazer o download de v√°rias vers√µes lado a lado de uma s√≥ vez. </font><font style="vertical-align: inherit;">Mais importante, assemblies nomeados fortes s√≥ podem fazer refer√™ncia a outros assemblies nomeados fortes. </font><font style="vertical-align: inherit;">Como alguns usu√°rios desejam assinar suas constru√ß√µes com o nome Strong, os desenvolvedores da biblioteca tamb√©m assinam suas bibliotecas, para facilitar a instala√ß√£o dos usu√°rios, para que os usu√°rios n√£o precisem assinar novamente essas bibliotecas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nome forte: Legado?</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomea√ß√£o forte e bibliotecas .NET A</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Microsoft diz explicitamente no MSDN que voc√™ n√£o deve usar o nome Forte para fins de seguran√ßa, pois eles fornecem apenas para distinguir diferentes assemblies com o mesmo nome. A chave de montagem n√£o pode ser alterada de forma alguma; se voc√™ a alterou, quebrar√° os redirecionamentos para todos os seus usu√°rios. Se houver uma parte privada da chave do nome Forte vazada para acesso p√∫blico, n√£o ser√° poss√≠vel retirar esta assinatura de nenhuma maneira. O formato de arquivo SNK no qual o nome Strong est√° localizado n√£o oferece essa oportunidade e outros formatos para armazenar chaves cont√™m pelo menos um link para a Lista de revoga√ß√£o de certificados CRL, pelo qual √© poss√≠vel entender que esse certificado n√£o √© mais v√°lido. N√£o h√° nada parecido no SNK.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O guia de c√≥digo aberto tem as seguintes recomenda√ß√µes. Em primeiro lugar, adicionalmente, para fins de seguran√ßa, use outras tecnologias. Em segundo lugar, se voc√™ tem uma biblioteca de c√≥digo aberto, geralmente √© sugerido que voc√™ comprometa a parte privada da chave no reposit√≥rio, para que seja mais f√°cil para as pessoas bifurcarem sua biblioteca, reconstru√≠-la e coloc√°-la em um aplicativo pronto. Em terceiro lugar, nunca mude o nome Forte. Muito destrutivo. Apesar de ser muito destrutivo e estar escrito sobre isso no guia de c√≥digo-fonte aberto, a Microsoft √†s vezes tem problemas com suas pr√≥prias bibliotecas.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ue/kg/l3/uekgl3iwrexq7ejjbabccq4y4p4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° uma biblioteca chamada System.Reactive. </font><font style="vertical-align: inherit;">Anteriormente, esses eram v√°rios pacotes NuGet, um deles √© o Rx-Linq. </font><font style="vertical-align: inherit;">Este √© apenas um exemplo, o mesmo para o restante dos pacotes. </font><font style="vertical-align: inherit;">Na segunda vers√£o, foi assinado com uma chave da Microsoft. </font><font style="vertical-align: inherit;">Na terceira vers√£o, ele foi para o reposit√≥rio no projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/dotnet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e come√ßou a ter uma assinatura do .NET Foundation. </font><font style="vertical-align: inherit;">A biblioteca, de fato, mudou o nome Strong. </font><font style="vertical-align: inherit;">O pacote NuGet foi renomeado, mas o assembly √© chamado dentro da mesma exatamente como antes. </font><font style="vertical-align: inherit;">Como redirecionar da segunda vers√£o para a terceira? </font><font style="vertical-align: inherit;">Este redirecionamento n√£o pode ser feito.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valida√ß√£o de nome forte</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como desativar o recurso de desvio de nome forte</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro argumento de que o nome Strong j√° √© algo do passado e permanece puramente formal √© que eles n√£o s√£o validados. Temos um assembly assinado e queremos corrigir algum tipo de bug, mas n√£o temos acesso √†s fontes. Podemos usar o dnSpy - este √© um utilit√°rio que permite descompilar e consertar os assemblies j√° compilados. Tudo vai funcionar para n√≥s. Como, por padr√£o, o desvio de valida√ß√£o de nome forte est√° ativado, ou seja, ele apenas verifica se o PublicKeyToken √© igual e se a integridade da assinatura em si n√£o √© verificada. Pode haver estudos ambientais nos quais a assinatura ainda √© verificada, e aqui um exemplo v√≠vido √© o IIS. A integridade da assinatura √© verificada no IIS (o desvio de valida√ß√£o de nome forte est√° desativado por padr√£o) e tudo ser√° interrompido se editarmos o assembly assinado. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adi√ß√£o:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode desativar a verifica√ß√£o de assinatura para a montagem usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinal p√∫blico.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Com ele, apenas a chave p√∫blica √© usada para assinatura, o que garante a seguran√ßa do nome do assembly. As chaves p√∫blicas usadas pela Microsoft est√£o publicadas </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No Rider, o sinal p√∫blico pode ser ativado nas propriedades do projeto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/_j/ct/vl_jctjjgui-mbcgo5uyzd26lrc.png"><br>
<br>
<img src="https://habrastorage.org/webt/ni/if/hp/niifhpriuvymkfhz78sdeaigs54.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando alterar as vers√µes do conjunto de arquivos</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O guia de c√≥digo-fonte aberto tamb√©m oferece algumas pol√≠ticas de controle de vers√£o, cujo objetivo √© reduzir o n√∫mero de redirecionamentos de liga√ß√£o necess√°rios e as altera√ß√µes para os usu√°rios no NET Framework. Esta pol√≠tica de controle de vers√£o √© que n√£o devemos alterar a vers√£o do assembly constantemente. Obviamente, isso pode levar a problemas com a instala√ß√£o no GAC, para que a imagem nativa instalada n√£o corresponda ao assembly e voc√™ precise executar a compila√ß√£o JIT novamente, mas, na minha opini√£o, isso √© menos grave que os problemas com o controle de vers√£o. No caso do CrossGen, os assemblies nativos n√£o s√£o instalados globalmente - n√£o haver√° problemas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, o pacote NuGet Newtonsoft.Json, possui v√°rias vers√µes: 12.0.1, 12.0.2 e assim por diante - todos esses pacotes t√™m um assembly com a vers√£o 12.0.0.0. </font><font style="vertical-align: inherit;">A recomenda√ß√£o √© que a vers√£o do assembly seja atualizada quando uma vers√£o principal do pacote NuGet for alterada.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Siga as dicas para o .NET Framework: gere redirecionamentos manualmente e tente usar a mesma vers√£o das depend√™ncias em todos os projetos em sua solu√ß√£o. </font><font style="vertical-align: inherit;">Isso deve minimizar significativamente o n√∫mero de redirecionamentos. </font><font style="vertical-align: inherit;">Voc√™ precisar√° de nomes fortes apenas se tiver um cen√°rio espec√≠fico de carregamento de constru√ß√£o, onde for necess√°rio, ou estiver desenvolvendo uma biblioteca e desejar simplificar a vida dos usu√°rios que realmente precisam de nomes fortes. </font><font style="vertical-align: inherit;">N√£o mude Nome forte.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET Standard</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passamos para o .NET Standard. Est√° bastante relacionado √† vers√£o infernal no .NET Framework. O .NET Standard √© uma ferramenta para escrever bibliotecas compat√≠veis com v√°rias implementa√ß√µes da plataforma .NET. As implementa√ß√µes referem-se ao .NET Framework, .NET Core, Mono, Unity e Xamarin. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hk/-a/-u/hk-a-u16d-oitjurhvta7lhafdi.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Link para documenta√ß√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© a tabela de suporte do .NET Standard para v√°rias vers√µes de diferentes vers√µes dos tempos de execu√ß√£o. E aqui podemos ver que o .NET Framework n√£o oferece suporte √† .NET Standard vers√£o 2.1. O lan√ßamento do .NET Framework, que dar√° suporte ao .NET Standard 2.1 e posterior, ainda n√£o est√° planejado. Se voc√™ estiver desenvolvendo uma biblioteca e desejar que ela funcione para usu√°rios no .NET Framework, ser√° necess√°rio ter um destino para o .NET Standard 2.0. Al√©m do fato de o .NET Framework n√£o suportar a vers√£o mais recente do .NET Standard, vamos prestar aten√ß√£o ao asterisco. O .NET Framework 4.6.1 oferece suporte ao .NET Standard 2.0, mas com um asterisco. Existe uma nota de rodap√© diretamente na documenta√ß√£o, onde eu consegui essa tabela.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ay/mq/yu/aymqyunvnqjivv13dpqkrzvac6i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere um projeto de exemplo. Um aplicativo no .NET Framework que possui uma depend√™ncia direcionada ao .NET Standard. Algo assim: ConsoleApp e ClassLibrary. Biblioteca de destino .NET Standard. Quando montarmos esse projeto, ser√° assim em nosso BIN. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/62/og/fh62og_vou9gzibnv5gdd2mp_uk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teremos uma centena de DLLs, das quais apenas uma relacionada ao aplicativo, tudo o mais veio para dar suporte ao .NET Standard. O fato √© que o .NET Standard 2.0 apareceu mais tarde que o .NET Framework 4.6.1, mas ao mesmo tempo se mostrou compat√≠vel com a API, e os desenvolvedores decidiram adicionar o suporte ao Standard 2.0 ao .NET 4.6.1. Fizemos isso n√£o de forma nativa (por inclus√£o </font></font><code>netstandard.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no pr√≥prio tempo de execu√ß√£o), mas de maneira que o .NET Standard * .dll e todas as outras fachadas de montagem sejam colocadas diretamente no BIN.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/af/15/am/af15amgkrw698xqylhfwemd67uy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se observarmos as depend√™ncias da vers√£o do .NET Framework que visamos e o n√∫mero de bibliotecas que ca√≠ram no BIN, veremos que n√£o h√° muitas delas na 4.7.1 e, desde a 4.7.2, n√£o h√° bibliotecas adicionais, e .NET O padr√£o √© suportado l√° nativamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rf/wu/va/rfwuvalfp3bi6zijyw5kjz-wjva.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© um tweet de um dos desenvolvedores do .NET, que descreve esse problema e recomenda o uso do .NET Framework vers√£o 4.7.2 se tivermos bibliotecas do .NET Standard. </font><font style="vertical-align: inherit;">Nem mesmo com a vers√£o 2.0 aqui, mas com a vers√£o 1.5.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se poss√≠vel, aumente o Target Framework em seu projeto para pelo menos 4.7.1, preferencialmente 4.7.2. </font><font style="vertical-align: inherit;">Se voc√™ estiver desenvolvendo uma biblioteca para facilitar a vida dos usu√°rios da biblioteca, fa√ßa um Destino separado para o .NET Framework, evitar√° um grande n√∫mero de dlls que podem entrar em conflito com alguma coisa.</font></font><a name="dotnet"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.NET Core</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar com uma teoria geral. </font><font style="vertical-align: inherit;">Discutiremos como lan√ßamos o JetBrains Rider no .NET Core e por que dever√≠amos falar sobre isso. </font><font style="vertical-align: inherit;">O Rider √© um projeto muito grande, possui uma enorme solu√ß√£o corporativa com um grande n√∫mero de projetos diferentes, um sistema complexo de depend√™ncias, voc√™ n√£o pode simplesmente peg√°-lo e migrar para outro tempo de execu√ß√£o ao mesmo tempo. </font><font style="vertical-align: inherit;">Para fazer isso, temos que usar alguns hacks, que tamb√©m ser√£o analisados.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplicativo .NET Core</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como √© um aplicativo t√≠pico do .NET Core? Depende de como exatamente √© implantado, para o que est√° indo. N√≥s podemos ter v√°rios cen√°rios. A primeira √© uma implanta√ß√£o dependente da estrutura. √â o mesmo que no .NET Framework quando o aplicativo usa o tempo de execu√ß√£o pr√©-instalado no computador. Pode ser uma implanta√ß√£o aut√¥noma, √© quando o aplicativo carrega um tempo de execu√ß√£o. E pode haver uma implanta√ß√£o de arquivo √∫nico, √© quando obtemos um arquivo exe, mas no caso do .NET Core dentro desse arquivo exe, h√° um artefato do aplicativo Aut√¥nomo, esse √© um arquivo de extra√ß√£o autom√°tica. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/yi/3c/hxyi3c3yxhavujn9ljcmtxkuvj0.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consideraremos apenas a implanta√ß√£o dependente da estrutura. Temos uma DLL com o aplicativo, existem dois arquivos de configura√ß√£o, o primeiro dos quais √© necess√°rio, este </font></font><code>runtimeconfig.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">A partir do .NET Core 3.0, √© gerado um arquivo exe, necess√°rio para tornar o aplicativo mais conveniente para a execu√ß√£o, para que voc√™ n√£o precise digitar o comando .NET se estiver no Windows. </font><font style="vertical-align: inherit;">As depend√™ncias se enquadram nesse artefato, come√ßando no .NET Core 3.0, no .NET Core 2.1 em que voc√™ precisa publicar ou usar outra propriedade </font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><a name="config"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estruturas compartilhadas, </font></font><code>.runtimeconfig.json</code></h3><br>
<br>
<img src="https://habrastorage.org/webt/cc/a5/ab/cca5ab5zhb3v6b1itc9jjbsiwje.jpeg"><br>
<br>
<code>.runtimeconfig.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m as configura√ß√µes de tempo de execu√ß√£o necess√°rias para execut√°-lo. Indica em qual estrutura compartilhada o aplicativo ser√° iniciado e se parece com isso. Indicamos que o aplicativo ser√° executado sob "Microsoft.NETCore.App" vers√£o 3.0.0; pode haver outra Estrutura Compartilhada. Outras configura√ß√µes tamb√©m podem estar aqui. Por exemplo, voc√™ pode ativar o coletor de lixo do servidor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/c5/un/ic/c5unicttj2dp5ol0jiewknhb48i.jpeg"><br>
<br>
<code>.runtimeconfig.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerado durante a montagem do projeto. E se queremos incluir o GC do servidor, precisamos modificar esse arquivo com anteced√™ncia, mesmo antes de montar o projeto ou adicion√°-lo manualmente. Voc√™ pode adicionar suas configura√ß√µes aqui assim. Podemos incluir propriedade em </font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se essa propriedade for fornecida por desenvolvedores .NET, ou se a propriedade n√£o for fornecida, podemos criar um arquivo chamado</font></font><code>runtimeconfig.template.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e escreva as configura√ß√µes necess√°rias aqui. Durante a montagem, outras configura√ß√µes necess√°rias ser√£o adicionadas a este modelo, por exemplo, a mesma Estrutura Compartilhada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/bu/e9/rlbue9y7cikkyzwenefcu2rdxy8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A Estrutura Compartilhada √© um conjunto de tempo de execu√ß√£o e bibliotecas. De fato, o mesmo que o tempo de execu√ß√£o do .NET Framework, que costumava ser instalado apenas uma vez na m√°quina e para todos era uma vers√£o. O Shared Framework e, diferentemente de um √∫nico tempo de execu√ß√£o do .NET Framework, podem ser versionados, aplicativos diferentes podem usar vers√µes diferentes dos tempos de execu√ß√£o instalados. Tamb√©m o Shared Framework pode ser herdado. A pr√≥pria estrutura compartilhada pode ser visualizada nos locais do disco geralmente instalados no sistema.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nc/df/7i/ncdf7ioj8afrolkvnlouh77jiaq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem v√°rias estruturas compartilhadas padr√£o, por exemplo, Microsoft.NETCore.App, que executa aplicativos de console convencionais, AspNetCore.App, para aplicativos Web, e WindowsDesktop.App, a nova estrutura compartilhada no .NET Core 3, que executa aplicativos de √°rea de trabalho. no Windows Forms e WPF. Os dois √∫ltimos Shared Framework complementam essencialmente o primeiro necess√°rio para aplicativos de console, ou seja, eles n√£o carregam um tempo de execu√ß√£o totalmente novo, mas simplesmente complementam o existente com as bibliotecas necess√°rias. Parece que essa heran√ßa tamb√©m existe nos diret√≥rios do Framework compartilhado </font></font><code>runtimeconfig.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos quais o Framework compartilhado base √© especificado.</font></font><a name="man"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manifesto de depend√™ncia ( </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qb/sc/qv/qbscqv1sh6jb_r19ps_qrusogfi.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Teste padr√£o - .NET Core O</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
segundo arquivo de configura√ß√£o √© este </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este arquivo cont√©m uma descri√ß√£o de todas as depend√™ncias do aplicativo ou da Estrutura Compartilhada, ou da biblioteca, as bibliotecas </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m o possuem. Ele cont√©m todas as depend√™ncias, incluindo transitivas. E o comportamento do tempo de execu√ß√£o do .NET Core difere dependendo se </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o aplicativo o possui ou n√£o. Caso </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contr√°rio, o aplicativo poder√° carregar todos os assemblies que est√£o em sua Estrutura Compartilhada ou em seu diret√≥rio BIN. Se houver </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, a valida√ß√£o ser√° ativada. Se um dos assemblies listados </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o estiver, o aplicativo simplesmente n√£o ser√° iniciado. Voc√™ ver√° o erro apresentado acima. Se o aplicativo tentar carregar algum assembly em tempo de execu√ß√£o, o que</font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se, por exemplo, usando m√©todos de carregamento de montagem ou durante o processo de resolu√ß√£o de montagens, voc√™ ver√° um erro muito semelhante ao carregamento restrito de montagem.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetbrains rider</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rider √© um IDE .NET. Nem todo mundo sabe que o Rider √© um IDE que consiste em um front-end baseado no IntelliJ IDEA e escrito em Java e Kotlin, e um back-end. O back-end √© essencialmente R #, que pode se comunicar com o IntelliJ IDEA. Esse back-end √© um aplicativo .NET multiplataforma agora. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para onde ele funciona? O Windows usa o .NET Framework, que est√° instalado no computador do usu√°rio. Em outros sistemas de informa√ß√£o, no Linux e Mac, o Mono √© usado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa n√£o √© uma solu√ß√£o ideal quando h√° tempos de execu√ß√£o diferentes em todos os lugares, e eu quero ir para o pr√≥ximo estado para que o Rider seja executado no .NET Core. Para melhorar o desempenho, porque no .NET Core todos os recursos mais recentes est√£o associados a isso. Para reduzir o consumo de mem√≥ria. Agora, h√° um problema com o modo como o Mono trabalha com mem√≥ria.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A mudan√ßa para o .NET Core permitir√° que voc√™ abandone as tecnologias herdadas e n√£o suportadas e corrija algumas corre√ß√µes para os problemas encontrados no tempo de execu√ß√£o. </font><font style="vertical-align: inherit;">A mudan√ßa para o .NET Core permitir√° que voc√™ controle a vers√£o do tempo de execu√ß√£o, ou seja, o Rider n√£o ser√° mais executado no .NET Framework instalado no computador do usu√°rio, mas em uma vers√£o espec√≠fica do .NET Core, que pode ser banida, na forma de uma implanta√ß√£o aut√¥noma. </font><font style="vertical-align: inherit;">A transi√ß√£o para o .NET Core eventualmente permitir√° o uso de novas APIs importadas especificamente no Core. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, o objetivo √© lan√ßar um prot√≥tipo, inici√°-lo, apenas para verificar como ele funcionar√°, quais s√£o os poss√≠veis pontos de falha, quais componentes ter√£o que ser reescritos novamente, o que exigir√° processamento global.</font></font><br>
<br>
<a name="rider"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recursos que dificultam a tradu√ß√£o do Rider para o .NET Core</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Visual Studio, mesmo que o R # n√£o esteja instalado, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trava de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> falta </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">de mem√≥ria em solu√ß√µes grandes, nas quais existem projetos com * .csproj no estilo SDK</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O estilo SDK * .csproj √© uma das principais condi√ß√µes para uma realoca√ß√£o completa do .NET Core. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© um problema porque o Rider √© baseado em R #, eles vivem no mesmo reposit√≥rio, os desenvolvedores de R # desejam usar o Visual Studio para desenvolver seu pr√≥prio produto em seu produto, a fim de torn√°-lo um alimento. </font><font style="vertical-align: inherit;">No R #, existem links para bibliotecas espec√≠ficas para a estrutura com a qual voc√™ precisa fazer algo. </font><font style="vertical-align: inherit;">No Windows, podemos usar o Framework para aplicativos de desktop e, no Linux e Mac, o Mock j√° √© usado para bibliotecas do Windows com funcionalidade m√≠nima.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decis√£o</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos permanecer nos antigos por enquanto </font></font><code>*.csproj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, montando sob o Framework completo, mas como os assemblies do Framework e Core s√£o compat√≠veis com bin√°rios, execute-os no Core. </font><font style="vertical-align: inherit;">N√£o usamos recursos incompat√≠veis, adicionamos todos os arquivos de configura√ß√£o necess√°rios manualmente e baixamos vers√µes especiais de depend√™ncias para o .NET Core, se houver.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para quais hacks voc√™ teve que ir?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um truque: queremos chamar um m√©todo que esteja dispon√≠vel apenas no Framework, por exemplo, esse m√©todo √© necess√°rio em R #, mas n√£o no Core. </font><font style="vertical-align: inherit;">O problema √© que, se n√£o houver m√©todo, o m√©todo que o chama durante a compila√ß√£o JIT cair√° mais cedo </font></font><code>MissingMethodException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ou seja, um m√©todo que n√£o existe estragou o m√©todo que o chama.</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Method</span>(<span class="hljs-params"></span>)</span> { 
  <span class="hljs-keyword">if</span> (NetFramework) <font></font>
     CallNETFrameworkOnlyMethod();<font></font>
<font></font>
  ... <font></font>
} <font></font>
[<span class="hljs-meta">MethodImpl(MethodImplOptions.NoInlining)</span>] 
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CallNETFrameworkOnlyMethod</span>(<span class="hljs-params"></span>)</span> { <font></font>
  NETFrameworkOnlyMethod(); <font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o est√° aqui: fazemos chamadas para m√©todos incompat√≠veis em m√©todos separados. H√° mais um problema: esse m√©todo pode ficar embutido, portanto, marcamos com um atributo </font></font><code>NoInlining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hack n√∫mero dois: precisamos ser capazes de carregar assemblies em caminhos relativos. Temos um assembly para o Framework, existe uma vers√£o especial para o .NET Core. Como fazemos o download da vers√£o do .NET Core para o .NET Core? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qm/zm/w7/qmzmw79gtllee8uyswgrn0oqnum.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles v√£o nos ajudar </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Vamos dar uma olhada na </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca System.Diagnostics.PerformanceCounter. Tal biblioteca √© not√°vel em termos de</font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Possui uma se√ß√£o de tempo de execu√ß√£o, na qual √© indicada uma vers√£o da biblioteca com seu caminho relativo. Nesta biblioteca, o assembly ser√° carregado em todos os tempos de execu√ß√£o e apenas lan√ßa as execu√ß√µes. Se, por exemplo, ele for carregado no Linux, o PerformanceCounter n√£o funcionar√° no design do Linux e uma PlatformNotSupportedException voar√° de l√°. H√° tamb√©m </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma se√ß√£o runtimeTargets e aqui j√° est√° indicada a vers√£o deste assembly especificamente para Windows, onde o PerformanceCounter deve funcionar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se pegarmos a se√ß√£o de tempo de execu√ß√£o e escrevermos nela o caminho relativo para a biblioteca que queremos carregar, isso n√£o nos ajudar√°. A se√ß√£o de tempo de execu√ß√£o realmente define o caminho relativo dentro do pacote NuGet, e n√£o em rela√ß√£o ao BIN. Se procurarmos por esse assembly no BIN, somente o nome do arquivo ser√° usado a partir da√≠. A se√ß√£o runtimeTargets j√° cont√©m um caminho relativo honesto, um caminho honesto em rela√ß√£o ao BIN. Vamos prescrever um caminho relativo para nossos assemblies na se√ß√£o runtimeTargets. Em vez do identificador de tempo de execu√ß√£o, que √© "win" aqui, podemos usar outro que gostamos. Por exemplo, escreveremos o identificador de tempo de execu√ß√£o ‚Äúany‚Äù e esse assembly ser√° carregado geralmente em todas as plataformas. Ou ent√£o, escreveremos ‚Äúunix‚Äù, e ele inicializar√° no Linux e no Mac, e assim por diante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pr√≥ximo corte: queremos fazer o download no Linux e no Mac Mock para criar o WindowsBase. O problema √© que o assembly chamado WindowsBase j√° est√° presente na Estrutura Compartilhada </font></font><code>Microsoft.NETCore.App</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mesmo que n√£o estejamos no Windows. No Windows Shared Framework, o </font></font><code>Microsoft.WindowsDesktop.App</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WindowsBase redefine a vers√£o em que est√° </font></font><code>NETCore.App</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Vamos dar uma olhada </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nesses Framework, mais precisamente nas se√ß√µes que descrevem o WindowsBase. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gc/ox/f3/gcoxf3q7mbfm_a9hzmcujfin5zc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° a diferen√ßa: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/5q/pz/wq/5qpzwq-n21m38b_0xedi9txpwoc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
se alguma biblioteca entra em conflito e est√° presente em v√°rias </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o m√°ximo delas √© selecionado para o par que consiste em </font></font><code>assemblyVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>fileVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O guia .NET diz que </font></font><code>fileVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© necess√°rio apenas mostr√°-lo no Windows Explorer, mas n√£o √©, ele se encaixa</font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este √© o √∫nico caso que eu conhe√ßo quando a vers√£o prescrita em </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>assemblyVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>fileVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √© realmente usada. Em todos os outros casos, vi um comportamento em que, independentemente das vers√µes </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escritas, o assembly continuava carregando de qualquer maneira. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bw/re/j8/bwrej8fa8_gyuyvcjnt3ixvljce.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quarto hack. Tarefa: temos um arquivo .deps.json para os dois hacks anteriores e precisamos dele apenas para depend√™ncias espec√≠ficas. Como eles s√£o </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gerados no modo semi-manual, temos um script que, de acordo com alguma descri√ß√£o do que deve chegar l√°, o gera durante a compila√ß√£o, queremos manter isso o </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√≠nimo poss√≠vel para que possamos entender o que est√° nele. Queremos desativar a valida√ß√£o e permitir o download de montagens que est√£o no BIN, mas que n√£o est√£o descritas em </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solu√ß√£o: ative a configura√ß√£o personalizada em runtimeconfig. </font><font style="vertical-align: inherit;">Essa configura√ß√£o √© realmente necess√°ria para compatibilidade com vers√µes anteriores do .NET Core 1.0.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, </font></font><code>.runtime.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no .NET Core - esses s√£o tipos de an√°logos </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permitem fazer o mesmo, por exemplo, carregar montagens de maneiras relativas. </font><font style="vertical-align: inherit;">Usando </font></font><code>.deps.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, reescrevendo-o manualmente, voc√™ pode personalizar o carregamento de assemblies no .NET Core, se voc√™ tiver um cen√°rio muito complexo.</font></font><a name="load"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depurar downloads de assembly</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu falei sobre alguns tipos de problemas, ent√£o voc√™ precisa ser capaz de depurar problemas ao carregar assemblies. </font><font style="vertical-align: inherit;">O que pode ajudar nisso? </font><font style="vertical-align: inherit;">Primeiro, os tempos de execu√ß√£o escrevem logs sobre como eles carregam assemblies. </font><font style="vertical-align: inherit;">Em segundo lugar, voc√™ pode olhar mais de perto as execu√ß√µes que voam para voc√™. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode se concentrar em eventos de tempo de execu√ß√£o.</font></font><a name="fusion"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logs de fus√£o</font></font></h3><br>
<br>
<img src="https://habrastorage.org/webt/jl/4v/be/jl4vbeqsyjzmab2rx0xvdg-lpi4.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De volta ao b√°sico: Usando o Fusion Log Viewer para depurar erros obscuros </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fusion</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O mecanismo para carregar assemblies no .NET Framework √© chamado Fusion e ele sabe como registrar o que fez no disco. Para habilitar o log, voc√™ precisa adicionar configura√ß√µes especiais ao registro. Isso n√£o √© muito conveniente, por isso faz sentido usar utilit√°rios, como o Fusion Log Viewer e o Fusion ++. O Fusion Log Viewer √© um utilit√°rio padr√£o que acompanha o Visual Studio e pode ser iniciado na linha de comando do Visual Studio, Prompt de Comando do Visual Studio Developer. O Fusion ++ √© um an√°logo de c√≥digo aberto desta ferramenta com uma interface melhor.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ou/9h/bt/ou9hbtdgx1yjp6rjjdm3q61efpu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Fusion Log Viewer fica assim. Isso √© pior que o WinDbg porque essa janela nem se estende. No entanto, voc√™ pode perfurar as marcas de verifica√ß√£o aqui, embora nem sempre seja √≥bvio qual conjunto de marcas de verifica√ß√£o est√° correto. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gu/h2/by/guh2byfmgazm8yvbxfa_jhf25wo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Fusion ++ possui um bot√£o "Iniciar registro" e, em seguida, o bot√£o "Interromper registro" √© exibido. Nele, voc√™ pode ver todos os registros sobre o carregamento de montagens, ler os logs sobre o que exatamente estava acontecendo. Esses logs s√£o parecidos com isso de maneira concisa.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zf/ep/5m/zfep5myuovdov4t7mmtw4czhwqc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma isen√ß√£o do carregamento rigoroso da montagem. </font><font style="vertical-align: inherit;">Se olharmos para os logs do Fusion, veremos que precis√°vamos baixar a vers√£o 9.0.0.0 depois de processarmos todas as configura√ß√µes. </font><font style="vertical-align: inherit;">Encontramos um arquivo no qual suspeita-se que temos a montagem de que precisamos. </font><font style="vertical-align: inherit;">Vimos que a vers√£o 6.0.0.0 est√° neste arquivo. </font><font style="vertical-align: inherit;">Temos um aviso de que comparamos os nomes completos das assembl√©ias e elas diferem na vers√£o principal. </font><font style="vertical-align: inherit;">E, em seguida, ocorreu um erro - incompatibilidade de vers√£o.</font></font><a name="events"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eventos de tempo de execu√ß√£o</font></font></h3><br>
<br>
<img src="https://habrastorage.org/webt/pu/np/bn/punpbnrdvfv_mm5bpweej75ofq8.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registrando eventos de tempo de execu√ß√£o</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
No Mono, voc√™ pode ativar o registro usando vari√°veis ‚Äã‚Äãde ambiente, e os registros ser√£o gravados em </font></font><code>stdout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>stderr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. N√£o √© t√£o conveniente, mas a solu√ß√£o est√° funcionando. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rj/vv/g9/rjvvg9dfv0ji5sbxm_crgu3ok0a.jpeg"><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An√°lise padr√£o - </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documenta√ß√£o do </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">.NET Core </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">/ documentos de design / rastreamento de host.O</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
.NET Core tamb√©m possui uma vari√°vel de ambiente especial </font></font><code>COREHOST_TRACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que inclui o logon </font></font><code>stderr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Com o .NET Core 3.0, voc√™ pode gravar logs em um arquivo, especificando o caminho para ele em uma vari√°vel </font></font><code>COREHOST_TRACEFILE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<img src="https://habrastorage.org/webt/eo/b5/yf/eob5yf90z7cgilees68uxtrhw0w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° um evento que √© acionado quando os conjuntos falham ao carregar. Este √© um evento </font></font><code>AssembleResolve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. H√° um segundo evento √∫til, esse </font></font><code>FirstChanceException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Voc√™ pode se inscrever e obter um erro sobre o carregamento de assemblies, mesmo que algu√©m tenha escrito try..catch e tenha perdido todas as execu√ß√µes no local em que</font></font><code>FileLoadException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ocorreu. </font><font style="vertical-align: inherit;">Se o aplicativo j√° tiver sido compilado, voc√™ poder√° inici√°-lo </font></font><code>perfview</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e monitorar as execu√ß√µes do .NET, e poder√° encontrar as relacionadas ao download de arquivos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">achados</font></font></h2> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Transfira o trabalho para ferramentas, ferramentas de desenvolvimento, para um IDE, para MSBuild, o que permite gerar redirecionamentos. </font><font style="vertical-align: inherit;">Voc√™ pode mudar para o .NET Core, depois esquecer√° o que √© o Strict Assembly Loading, e poder√° usar a nova API exatamente como queremos alcan√ßar no Rider. </font><font style="vertical-align: inherit;">Se voc√™ conectar a biblioteca .NET Standard, aumente a vers√£o de destino do .NET Framework para pelo menos 4.7.1. </font><font style="vertical-align: inherit;">Se voc√™ parece estar em uma situa√ß√£o sem esperan√ßa, procure por hacks, use-os ou crie seus pr√≥prios hacks para situa√ß√µes sem esperan√ßa. </font><font style="vertical-align: inherit;">E arme-se com ferramentas de depura√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu recomendo fortemente que voc√™ leia os seguintes links:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">.NET Guide</a>;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     .NET Core</a>.</li>
</ul><br>
<br>
<blockquote>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DotNext 2020 Piter</a> .       ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 8   JUG Ru Group</a>.</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499824/index.html">Resumo dos eventos para recrutadores de RH e TI em maio de 2020</a></li>
<li><a href="../pt499826/index.html">Press√£o arterial distribu√≠da</a></li>
<li><a href="../pt499832/index.html">Como organizar com rapidez e seguran√ßa o trabalho remoto dos funcion√°rios? Falamos sobre diferentes abordagens: com VDI e n√£o apenas</a></li>
<li><a href="../pt499834/index.html">Conhe√ßa o aritm√¥metro Felix</a></li>
<li><a href="../pt499836/index.html">Udalenka vs. escrit√≥rio para a equipe de desenvolvimento</a></li>
<li><a href="../pt499842/index.html">Por que as pessoas reaprendem</a></li>
<li><a href="../pt499846/index.html">Quando a coleta de lixo separada come√ßar√° a funcionar e por que √© necess√°rio o monitoramento em v√≠deo de sites para cont√™ineres de lixo</a></li>
<li><a href="../pt499850/index.html">Como analisar os concorrentes e estabelecer uma estrat√©gia digital em 40 minutos</a></li>
<li><a href="../pt499852/index.html">Documenta√ß√£o em ingl√™s para Angular</a></li>
<li><a href="../pt499854/index.html">Apache Bigtop e a escolha da distribui√ß√£o do Hadoop hoje</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>