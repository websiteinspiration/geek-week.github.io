<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😫 🔀 🐡 Kubernetes最佳实践 正确终止禁用 ✊🏾 🤾🏿 🤹🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes最佳实践创建小型容器
 Kubernetes最佳实践。具有Kubernetes 
 最佳实践命名空间的Kubernetes组织。 Kubernetes可行性测试与就绪性和活力测试Kubernetes 
 最佳实践。配置请求和资源限制
 
 
 
 分布式系统操作中的重要一点是处理...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Kubernetes最佳实践 正确终止禁用</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/503488/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes最佳实践创建小型容器</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes最佳实践。具有Kubernetes </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最佳实践命名空间的</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Kubernetes组织</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">。 Kubernetes可行性测试与就绪性和活力测试Kubernetes </font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最佳实践。配置请求和资源限制</font></font></a><br>
<br>
<img src="https://habrastorage.org/webt/tm/pw/un/tmpwunqsjdjy_abzbl8c0t-exzo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
分布式系统操作中的重要一点是处理故障。 Kubernetes通过使用控制器来监视系统状态并重新启动已停止工作的服务，从而对此提供帮助。但是，Kubernetes可以强制关闭您的应用程序以确保整个系统的可行性。在本系列中，我们将研究如何帮助Kubernetes更有效地完成其工作并减少应用程序停机时间。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在使用容器之前，大多数应用程序都在虚拟机或物理机上运行。如果应用程序崩溃或崩溃，则需要很长时间才能删除正在进行的任务并重新下载程序。在最坏的情况下，有人必须在最不合时宜的夜晚手动解决此问题。如果只有1-2台工作机执行一项重要任务，那么这种故障是完全不能接受的。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，他们开始使用进程级别的监视来在异常终止的情况下自动重新启动应用程序，而不是手动重新启动。如果程序崩溃，监视过程将捕获退出代码并重新启动服务器。随着诸如Kubernetes之类的系统的出现，这种类型的系统故障响应已被简单地集成到基础架构中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes使用“观察-提交差异-提交”事件循环来确保资源在从容器到节点本身的整个过程中都是可操作的。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6n/rw/f9/6nrwf9r4k54zb99ghrykicqtc78.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这意味着您不再需要手动启动过程监视。如果资源未通过运行状况检查，Kubernetes将简单地自动提供替换。 Kubernetes不仅可以监视您的应用程序崩溃。它可以创建应用程序的更多副本以在多台计算机上工作，更新应用程序或同时运行应用程序的多个版本。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，Kubernetes可以中断一个非常健康的容器有很多原因。例如，如果升级部署，Kubernetes将在启动新Pod的同时缓慢停止旧Pod。如果断开节点的连接，Kubernetes将终止该节点上的所有炉床。最后，如果节点资源不足，Kubernetes将禁用所有Pod释放这些资源。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，非常重要的一点是，您的应用程序停止工作对最终用户的影响应最小，而恢复时间也应尽可能短。这意味着在断开连接之前，它必须保存所有需要保存的数据，关闭所有网络连接，完成剩余的工作，并有时间完成其他紧急任务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，这意味着您的应用程序应该能够处理SIGTERM消息-进程终止信号，这是Unix系列OS中kill工具的默认信号。收到此消息后，应用程序应断开连接。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在Kubernetes决定完成吊舱之后，发生了一系列的事件。让我们看一下容器或炉床完成时Kubernetes采取的每个步骤。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
假设我们要完成其中一个炉床。在这一点上，它将停止接收新的流量-在炉膛中工作的容器不会受到影响，但是所有新的流量都将被阻止。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/go/iq/swgoiqnkzgrbf1g9ikbyc7kq6ym.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们看一下preStop挂钩-这是发送到炉膛中容器的特殊命令或HTTP请求。如果收到SIGTERM时应用程序未正确关闭，则可以使用preStop正确退出。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rc/rk/a-/rcrka-cajxoq76gtcdaopdabeak.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大多数程序在收到SIGTERM信号时都可以正确完成其工作，但是，如果您使用第三方代码或无法完全控制的某些系统，则preStop挂钩是一种在不更改应用程序的情况下正常关闭的好方法。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
执行完此钩子后，Kubernetes将向壁炉中的容器发送SIGTERM信号，这将使他们知道它们将很快断开连接。收到此信号后，您的代码将进入关机过程。此过程可能包括停止任何长期存在的连接，例如连接到数据库或WebSocket流，保存当前状态等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
即使您使用preStop挂钩，在向您的应用程序发送SIGTERM信号时，检查应用程序会发生什么情况也很重要，它的行为方式会导致炉床关闭导致事件或系统操作发生变化，这并不会让您感到惊讶。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此时，在采取进一步行动之前，Kubernetes将等待一个指定的时间，称为TerminationGracePeriodSecond，或者它在收到SIGTERM信号后正确关闭的时间段。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_9/uq/gj/_9uqgjt61tblfxn6kgbrjnh3zs8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
默认情况下，此时间段是30秒。重要的是要注意，它与preStop挂钩和SIGTERM信号并行运行。 Kubernetes不会等待preStop挂钩和SIGTERM结束-如果您的应用程序在TerminationGracePeriod到期之前退出，Kubernetes将立即进行下一步。因此，请确保该时间段的秒数不小于炉床正确关闭所需的时间，如果超过30 s，则将时间段增加到YAML中的所需值。在上面的示例中，它是60s。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，最后一步-如果终止TerminationGracePeriod过期后容器仍继续工作，则它们将发送SIGKILL信号并被强制删除。</font><font style="vertical-align: inherit;">此时，Kubernetes还将清除所有其他pod对象。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/zp/t9/ptzpt92xzjuszc3tw0mwhgbp80m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kubernetes关闭壁炉的原因有很多，因此请确保在任何情况下您的应用程序都能正确完成，以确保服务的稳定运行。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes最佳实践 </font><font style="vertical-align: inherit;">映射外部服务</font></font></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/Z_l_kE1MDTc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一点广告：）</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
感谢您与我们在一起。你喜欢我们的文章吗？想看更多有趣的资料吗？通过下订单或向您的朋友推荐给</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发人员的基于云的VPS，</font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">最低</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">价格为4.99美元</font></a><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是我们为您发明的入门级服务器</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><b><font style="vertical-align: inherit;">独特类似物：</font></b></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于VPS（KVM）E5-2697 v3（6核）的全部真相10GB DDR4 480GB SSD 1Gbps从$ 19还是如何划分服务器？</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（RAID1和RAID10提供选件，最多24个内核和最大40GB DDR4）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阿姆斯特丹的Equinix Tier IV数据中心的戴尔R730xd便宜2倍吗？</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅</font><b><font style="vertical-align: inherit;">在荷兰，</font></b><font style="vertical-align: inherit;">我们有</font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2台Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100电视</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戴尔R420-2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB-$ 99起！</font></font></b></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读有关</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何构建基础设施大厦的信息。</font><font style="vertical-align: inherit;">使用Dell R730xd E5-2650 v4服务器花费一欧元9000欧元的c类？</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN503472/index.html">无现金支付，播客和人造肉：其他公司如何应对冠状病毒危机</a></li>
<li><a href="../zh-CN503474/index.html">我作为PM的应用程序开发经验</a></li>
<li><a href="../zh-CN503476/index.html">在无头Chrome中录制视频UI自动测试</a></li>
<li><a href="../zh-CN503480/index.html">多达4万：超过10个黑胶唱机评论</a></li>
<li><a href="../zh-CN503486/index.html">x86中有多少条指令？</a></li>
<li><a href="../zh-CN503490/index.html">使用R和文本挖掘技术比较俄罗斯说唱场景。Noize Mc，Oxxxymiron，Zhenya叔叔。第2集</a></li>
<li><a href="../zh-CN503494/index.html">为Zigbee设备组装DIY网关</a></li>
<li><a href="../zh-CN503504/index.html">最成功，最丑闻的数据科学项目：Cambridge Analytica</a></li>
<li><a href="../zh-CN503508/index.html">学校，老师，学生，他们的等级和等级</a></li>
<li><a href="../zh-CN503518/index.html">使用SwiftUI的新态。第2部分：可访问性可以做什么？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>