<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😽 📯 🈷️ Surveillance de toute la mémoire utilisée par une page Web: performance.measureMemory () 👇 🏙️ 👃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'auteur de l'article, dont nous publions la traduction aujourd'hui, explique comment surveiller la mémoire allouée aux pages Web. Une attention parti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Surveillance de toute la mémoire utilisée par une page Web: performance.measureMemory ()</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/497986/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'auteur de l'article, dont nous publions la traduction aujourd'hui, explique comment surveiller la mémoire allouée aux pages Web. </font><font style="vertical-align: inherit;">Une attention particulière à la mémoire des pages travaillant en production permet de maintenir la productivité des projets Web à un niveau élevé.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/uj/ux/6i/ujux6ittjoa4u5aoapnuhggx4ca.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les navigateurs contrôlent automatiquement la mémoire allouée aux pages Web. Lorsqu'une page crée un objet, le navigateur, en utilisant ses mécanismes internes, alloue de la mémoire pour stocker cet objet. Étant donné que la mémoire n'est pas une ressource infinie, le navigateur effectue périodiquement la collecte des ordures, au cours de laquelle les objets inutiles sont détectés et la mémoire qu'ils occupent est effacée. Le processus de détection de tels objets n'est cependant pas idéal. Il </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">a</font></a><font style="vertical-align: inherit;"> été </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prouvé</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que l'identification absolument exacte et complète de ces objets est une tâche insoluble. En conséquence, les navigateurs remplacent l'idée de trouver des «objets inutiles» par l'idée de trouver des «objets inaccessibles». Si une page Web ne peut pas accéder à l'objet via ses variables et champs d'autres objets qui lui sont accessibles, cela signifie que le navigateur peut effacer en toute sécurité la mémoire occupée par un tel objet. La différence entre «inutile» et «inaccessible» entraîne des fuites de mémoire, comme illustré dans l'exemple suivant:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> object = { <span class="hljs-attr">a</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">1000</span>), <span class="hljs-attr">b</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">2000</span>) };<font></font>
setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(object.a), <span class="hljs-number">1000</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un grand tableau inutile ici </font></font><code>b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais le navigateur ne libère pas la mémoire qu'il occupe en raison du fait qu'il est accessible via la propriété d'objet </font></font><code>object.b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le rappel. Par conséquent, la mémoire occupée par ce tableau fuit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les fuites de mémoire sont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fréquentes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le développement Web. Ils apparaissent très facilement dans les programmes lorsque, par exemple, les développeurs oublient de se désinscrire de l'écouteur d'événements, lorsqu'ils capturent accidentellement des objets dans un élément </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lorsqu'ils oublient de fermer le travailleur, lorsqu'ils collectent des objets dans des tableaux. Si une page Web présente des fuites de mémoire, cela conduit au fait qu'au fil du temps, la consommation de mémoire de la page augmente. Une telle page semble lente et lente pour les utilisateurs.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première étape pour résoudre ce problème consiste à prendre des mesures. </font><font style="vertical-align: inherit;">La nouvelle API </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performance.measureMemory ()</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permet aux développeurs de mesurer l'utilisation de la mémoire par les pages Web en production et, par conséquent, de détecter les fuites de mémoire qui glissent à travers les tests locaux.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En quoi la nouvelle API performance.measureMemory () est-elle différente de l'ancienne performance.memory?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous êtes familiarisé avec l'API non standard existante </font></font><code>performance.memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors vous pourriez être intéressé par la question de savoir comment la nouvelle API diffère de l'ancienne. La principale différence est que l'ancienne API renvoie la taille du tas JavaScript et la nouvelle évalue l'utilisation de la mémoire de la page Web entière. Cette distinction est importante lorsque Chrome organise le partage de segments de mémoire entre plusieurs pages Web (ou plusieurs instances de la même page). Dans de tels cas, les résultats renvoyés par l'ancienne API peuvent être déformés. Étant donné que l'ancienne API est définie en termes spécifiques à l'implémentation, comme un tas, la normalisation est une entreprise désespérée.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre différence est que dans Chrome, la nouvelle API prend des mesures de mémoire lors de la collecte des ordures. </font><font style="vertical-align: inherit;">Cela réduit le «bruit» dans les résultats de mesure, mais peut prendre un certain temps pour obtenir les résultats. </font><font style="vertical-align: inherit;">Veuillez noter que les créateurs d'autres navigateurs peuvent décider d'implémenter la nouvelle API sans se lier à la récupération de place.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Façons recommandées d'utiliser la nouvelle API</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de la mémoire par les pages Web dépend de l'occurrence d'événements, des actions de l'utilisateur, de la récupération de place. </font><font style="vertical-align: inherit;">C'est pourquoi l'API est </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conçue pour étudier le niveau d'utilisation de la mémoire en production. </font><font style="vertical-align: inherit;">Les résultats de l'appel de cette API dans un environnement de test sont moins utiles. </font><font style="vertical-align: inherit;">Voici des exemples d'options pour l'utiliser:</font></font><br>
<br>
<ul>
<li>          -     .</li>
<li>A/B-  ,            .</li>
<li>            .</li>
<li>    ,  .           .</li>
</ul><br>
<h2><font color="#3AC1EF"> </font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Actuellement, l'API en question n'est prise en charge que dans Chrome 83, selon le schéma Origin Trial. </font><font style="vertical-align: inherit;">Les résultats renvoyés par l'API dépendent fortement de l'implémentation, car différents navigateurs utilisent différentes manières de représenter les objets en mémoire et différentes façons d'évaluer le niveau d'utilisation de la mémoire. </font><font style="vertical-align: inherit;">Les navigateurs peuvent exclure certaines zones de mémoire de la comptabilité si la comptabilité complète de toute la mémoire utilisée est une tâche déraisonnablement difficile ou impossible. </font><font style="vertical-align: inherit;">Par conséquent, nous pouvons dire que les résultats produits par cette API dans différents navigateurs ne sont pas comparables. </font><font style="vertical-align: inherit;">Il est logique de comparer uniquement les résultats obtenus dans le même navigateur.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avancement des travaux en cours</font></font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Étape</font></font></strong></td>
<td><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">état</font></font></strong></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Création d'explications d'API</font></font><br>
</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminé</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Création d'un projet de spécification</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Effectué</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Rassembler les commentaires et finaliser le projet</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Effectué</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Tests d'essai d'origine</font></font><br>
</td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Effectué</font></font></a></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Lancement</font></font><br>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pas commencé</font></font></td>
</tr>
</tbody></table></div><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisation de performance.measureMemory ()</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Activer la prise en charge de l'essai d'origine</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'API </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est disponible dans Chrome 83 selon le schéma d'essai d'origine. </font><font style="vertical-align: inherit;">Cette phase devrait se terminer avec la sortie de Chrome 84. L' </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
essai d'origine permet aux développeurs de profiter des nouvelles fonctionnalités de Chrome et de partager leurs commentaires sur la commodité, la convivialité et l'efficacité de ces fonctionnalités avec la communauté Web. </font><font style="vertical-align: inherit;">Des détails sur ce programme peuvent être trouvés </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez vous abonner au programme sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page d'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inscription.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Inscription au programme Origin Trial</font></font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demandez un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jeton pour l'opportunité qui vous intéresse.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez le jeton aux pages du projet pilote. </font><font style="vertical-align: inherit;">Il y a 2 façons de procéder:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez une </font></font><code>&lt;meta&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balise </font></font><code>origin-trial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au titre de chaque page. </font><font style="vertical-align: inherit;">Par exemple, il pourrait ressembler à </font><font style="vertical-align: inherit;">ceci: </font></font><code>&lt;meta http-equiv="origin-trial" content="TOKEN_GOES_HERE"&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez accès aux paramètres du serveur, il peut ajouter un jeton à l'aide d'un en-tête HTTP </font></font><code>Origin-Trial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En conséquence, l' en- </font><font style="vertical-align: inherit;">tête de réponse devrait apparaître quelque chose comme ce qui </font><font style="vertical-align: inherit;">suit: </font></font><code>Origin-Trial: TOKEN_GOES_HERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul></li>
</ol><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Activer une nouvelle fonctionnalité via les drapeaux Chrome</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'expérimenter </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pendant la </font><font style="vertical-align: inherit;">distribution avec le jeton Origin Trial, vous devez activer le drapeau </font></font><code>#experimental-web-platform-features</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans </font></font><code>chrome://flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Vérification de l'utilisation de l'API</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un appel de fonction </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut échouer, avec une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityError levée</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela peut se produire si l'environnement ne répond pas aux exigences de sécurité pour les fuites d'informations. </font><font style="vertical-align: inherit;">Lors du test Origin Trial dans Chrome, cette API nécessite l'inclusion de l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isolement</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">site</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Lorsque l'API est prête pour une utilisation normale, elle s'appuiera sur la propriété </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crossOriginIsolated</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Une page Web peut fonctionner dans ce mode en définissant les en-têtes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COOP et COEP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voici un exemple de code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (performance.measureMemory) {
&nbsp;&nbsp;<span class="hljs-keyword">let</span> result;
&nbsp;&nbsp;<span class="hljs-keyword">try</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;result = <span class="hljs-keyword">await</span> performance.measureMemory();<font></font>
&nbsp;&nbsp;} <span class="hljs-keyword">catch</span> (error) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> DOMException &amp;&amp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error.name === <span class="hljs-string">"SecurityError"</span>) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"The context is not secure."</span>);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;} <span class="hljs-keyword">else</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> error;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(result);<font></font>
}<font></font>
</code></pre><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Test local</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chrome prend une mesure de mémoire lors de la collecte des ordures. </font><font style="vertical-align: inherit;">Cela signifie que l'accès à l'API ne résout pas instantanément la promesse. </font><font style="vertical-align: inherit;">Pour obtenir le résultat, vous devez attendre la prochaine session de récupération de place. </font><font style="vertical-align: inherit;">L'API démarre de force la récupération de place après un certain délai, qui est actuellement défini sur 20 secondes. </font><font style="vertical-align: inherit;">Si vous exécutez Chrome avec un indicateur de ligne de commande </font></font><code>--enable-blink-features='ForceEagerMeasureMemory'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le délai sera réduit à zéro, ce qui est utile pour le débogage local et les tests locaux.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est recommandé d'utiliser la nouvelle API en définissant un moniteur de mémoire global qui mesure le niveau d'utilisation de la mémoire de la page entière et envoie les résultats au serveur, où ils peuvent être agrégés et analysés. La façon la plus simple de travailler avec cette API est de prendre des mesures périodiques. Par exemple, ils peuvent s'exécuter toutes les </font></font><code>M</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">minutes. Cependant, cela introduit des distorsions dans les données, car des pics d'utilisation de la mémoire peuvent survenir entre les mesures. L'exemple suivant montre comment, à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aide </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">du processus de Poisson</font></a><font style="vertical-align: inherit;"> , effectuer des mesures sans erreurs systématiques. Cette approche garantit que les sessions de mesure peuvent, avec une probabilité égale, avoir lieu à tout moment ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici une</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> démonstration de cette approche,</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> le code source). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, déclarez une fonction qui planifie le prochain démarrage d'une session pour mesurer la quantité de mémoire consommée à l'aide d'une fonction </font></font><code>setTimeout()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec un intervalle défini de manière aléatoire. </font><font style="vertical-align: inherit;">Cette fonction doit être appelée après le chargement de la page dans la fenêtre du navigateur.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scheduleMeasurement</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;<span class="hljs-keyword">if</span> (!performance.measureMemory) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"performance.measureMemory() is not available."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;<span class="hljs-keyword">const</span> interval = measurementInterval();
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Scheduling memory measurement in "</span> +
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">Math</span>.round(interval / <span class="hljs-number">1000</span>) + <span class="hljs-string">" seconds."</span>);<font></font>
&nbsp;&nbsp;setTimeout(performMeasurement, interval);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//       .</span>
<span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{<font></font>
&nbsp;&nbsp;scheduleMeasurement();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction </font></font><code>measurementInterval()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouve un intervalle aléatoire, exprimé en millisecondes, défini de telle sorte qu'une mesure soit effectuée environ toutes les cinq minutes. </font><font style="vertical-align: inherit;">Si vous êtes intéressé par les concepts mathématiques sur lesquels cette fonction est basée, lisez la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distribution exponentielle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">measurementInterval</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;<span class="hljs-keyword">const</span> MEAN_INTERVAL_IN_MS = <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
&nbsp;&nbsp;<span class="hljs-keyword">return</span> -<span class="hljs-built_in">Math</span>.log(<span class="hljs-built_in">Math</span>.random()) * MEAN_INTERVAL_IN_MS;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, la fonction asynchrone </font></font><code>performMeasurement()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appelle notre API, enregistre le résultat et planifie la prochaine mesure.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">performMeasurement</span>(<span class="hljs-params"></span>) </span>{
&nbsp;&nbsp;<span class="hljs-comment">// 1.  performance.measureMemory().</span>
&nbsp;&nbsp;<span class="hljs-keyword">let</span> result;
&nbsp;&nbsp;<span class="hljs-keyword">try</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;result = <span class="hljs-keyword">await</span> performance.measureMemory();<font></font>
&nbsp;&nbsp;} <span class="hljs-keyword">catch</span> (error) {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> DOMException &amp;&amp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error.name === <span class="hljs-string">"SecurityError"</span>) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"The context is not secure."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//    .</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">throw</span> error;<font></font>
&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;<span class="hljs-comment">// 2.  .</span>
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Memory usage:"</span>, result);
&nbsp;&nbsp;<span class="hljs-comment">// 3.   .</span><font></font>
&nbsp;&nbsp;scheduleMeasurement();<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les résultats des mesures peuvent ressembler à ceci:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">// ,    :</span><font></font>
{<font></font>
&nbsp;&nbsp;<span class="hljs-attr">bytes</span>: <span class="hljs-number">60</span>_000_000,
&nbsp;&nbsp;<span class="hljs-attr">breakdown</span>: [<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">bytes</span>: <span class="hljs-number">40</span>_000_000,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">attribution</span>: [<span class="hljs-string">"https://foo.com"</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">userAgentSpecificTypes</span>: [<span class="hljs-string">"Window"</span>, <span class="hljs-string">"JS"</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;},<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;{<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">bytes</span>: <span class="hljs-number">20</span>_000_000,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">attribution</span>: [<span class="hljs-string">"https://foo.com/iframe"</span>],
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">userAgentSpecificTypes</span>: [<span class="hljs-string">"Window"</span>, <span class="hljs-string">"JS"</span>]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;]<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une estimation du niveau global d'utilisation de la mémoire s'affiche dans le champ </font></font><code>bytes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour dériver cette estimation, les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">séparateurs des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chiffres sont utilisés. Ces valeurs dépendent fortement de l'implémentation. S'ils sont reçus pour différents navigateurs, vous ne pouvez pas les comparer. La façon dont ils sont obtenus peut varier même dans différentes versions du même navigateur. Pendant la durée du programme Origin Trial, les valeurs de retour incluent des indicateurs d'utilisation de la mémoire JavaScript par la fenêtre principale, des indicateurs d'utilisation de la mémoire des éléments </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du même site et des indicateurs de fenêtres associées. Lorsque l'API est prête, cette valeur représentera des informations sur la mémoire consommée par JavaScript, le DOM, tous les éléments </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">associés aux fenêtres et aux travailleurs Web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
liste</font></font><code>breakdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">donne des informations plus détaillées sur la mémoire utilisée. </font><font style="vertical-align: inherit;">Chaque entrée décrit un morceau de mémoire et associe ce fragment à un ensemble de fenêtres, d'éléments </font></font><code>iframe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou de travailleurs identifiés par une URL. </font><font style="vertical-align: inherit;">Le champ </font></font><code>userAgentSpecificTypes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">répertorie les types de mémoire déterminés par les fonctionnalités d'implémentation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est important de considérer ces listes de manière générale et de ne pas essayer, en s'appuyant sur les fonctionnalités d'un certain navigateur, d'analyser tout en fonction de celles-ci. </font><font style="vertical-align: inherit;">Par exemple, certains navigateurs peuvent renvoyer une liste </font></font><code>breakdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vide ou des champs vides </font></font><code>attribution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">D'autres navigateurs peuvent renvoyer </font></font><code>attribution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs URL </font><font style="vertical-align: inherit;">dans un élément </font><font style="vertical-align: inherit;">, indiquant qu'ils ne peuvent pas identifier à laquelle de ces URL appartient la mémoire.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retour d'information</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le groupe de la communauté des performances Web</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l'équipe de développement Chrome seront ravis de savoir ce que vous en pensez </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et d'en savoir plus sur votre expérience d'utilisation de cette API.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Partagez vos idées sur le périphérique API avec nous</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y a-t-il quelque chose dans cette API qui ne fonctionne pas comme prévu? </font><font style="vertical-align: inherit;">Peut-être qu'il manque quelque chose dont vous avez besoin pour mettre en œuvre votre idée? </font><font style="vertical-align: inherit;">Ouvrez une nouvelle tâche dans le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suivi de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> projet ou commentez une tâche existante.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signaler un problème de mise en œuvre</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous avez trouvé un bug dans votre implémentation Chrome? </font><font style="vertical-align: inherit;">Ou peut-être que la mise en œuvre est différente de la spécification? </font><font style="vertical-align: inherit;">Enregistrez l'erreur ici: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new.crbug.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Essayez d'inclure autant de détails que possible dans votre message, incluez des instructions simples sur la façon de reproduire l'erreur et indiquez que le problème est lié à </font></font><code>Blink&gt;PerformanceAPIs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Glitch est un</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> très bon moyen de démontrer les erreurs </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soutenez-nous</font></font></font></h2><br><font style="vertical-align: inherit;"></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envisagez-vous </font><font style="vertical-align: inherit;">
d'utiliser </font><font style="vertical-align: inherit;">? </font><font style="vertical-align: inherit;">Si c'est comme ça, dis nous en plus à propos. </font><font style="vertical-align: inherit;">Ces histoires aident l'équipe de développement Chrome à établir des priorités. </font><font style="vertical-align: inherit;">Ces histoires montrent aux créateurs d'autres navigateurs l'importance de prendre en charge de nouvelles fonctionnalités. </font><font style="vertical-align: inherit;">Si vous le souhaitez, envoyez un tweet à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ChromiumDev</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dites-nous où et comment vous utilisez la nouvelle API. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As-tu essayé </font></font><code>performance.measureMemory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr497964/index.html">Télémédecine. Stéthoscope électronique à ingénierie inverse</a></li>
<li><a href="../fr497968/index.html">Ressources pour les développeurs Web: API et éléments d'interface utilisateur</a></li>
<li><a href="../fr497980/index.html">Combien d'eau a fui? Nous résolvons le problème par un moonwalk sur Haskell</a></li>
<li><a href="../fr497982/index.html">Approche fonctionnelle et processus de la gestion. Comment et quoi gérer?</a></li>
<li><a href="../fr497984/index.html">Migration de reCAPTCHA vers hCaptcha dans Cloudflare</a></li>
<li><a href="../fr497988/index.html">Profilage des performances des applications React</a></li>
<li><a href="../fr497990/index.html">PostgreSQL: Développement d'extensions (fonctions) en langage C</a></li>
<li><a href="../fr497994/index.html">Analyse des échappées par la mécanique du langage</a></li>
<li><a href="../fr497996/index.html">Vous ne voulez pas renforcer l'immunité. Ou les extrêmes du corps humain</a></li>
<li><a href="../fr498000/index.html">Ce que j'aimerais savoir avant de développer mon propre jeu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>