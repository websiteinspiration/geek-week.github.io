<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèø üë®üèΩ‚Äçüåæ ü§±üèª Blitz.Engine: sistema de activos üçò üèÅ üë®‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antes de comprender c√≥mo funciona el sistema de activos del motor Blitz.Engine , debemos decidir qu√© es un activo y qu√© entendemos exactamente por sis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Blitz.Engine: sistema de activos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/498300/"><img src="https://habrastorage.org/webt/yk/rv/sv/ykrvsv2-nadxe5rvvs7gj8iw-9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comprender c√≥mo funciona el sistema de activos del motor </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blitz.Engine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , debemos decidir qu√© es un activo y qu√© entendemos exactamente por sistema de activo. Seg√∫n Wikipedia, un activo de juego es un objeto digital, que consiste principalmente en los mismos datos, una entidad indivisible que representa parte del contenido del juego y tiene ciertas propiedades. Desde el punto de vista del modelo de programa, un activo puede aparecer como un objeto creado en alg√∫n conjunto de datos. Los activos se pueden almacenar como un archivo separado. A su vez, un sistema de activos es una gran cantidad de c√≥digo de programa responsable de cargar y operar activos de varios tipos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, un sistema de activos es una gran parte del motor del juego, que puede convertirse en un asistente fiel para los desarrolladores de juegos o convertir sus vidas en un infierno. </font><font style="vertical-align: inherit;">En mi opini√≥n, la decisi√≥n l√≥gica fue concentrar este "infierno" en un lugar, protegiendo cuidadosamente a los desarrolladores de otros equipos. </font><font style="vertical-align: inherit;">Le diremos lo que hicimos en esta serie de art√≠culos. ¬°Vamos!</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Art√≠culos planificados sobre el tema:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Declaraci√≥n de requisitos y descripci√≥n general de la arquitectura</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ciclo de vida de los activos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n detallada de la clase AssetManager</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integraci√≥n en ECS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GlobalAssetCache</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos y razones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los requisitos del sistema de carga de activos nacieron entre una roca y un lugar duro. </font><font style="vertical-align: inherit;">Un yunque era el deseo de hacer algo encerrado en s√≠ mismo para que funcionara sin escribir c√≥digo externo. </font><font style="vertical-align: inherit;">Bueno, o casi sin escribir c√≥digo externo. </font><font style="vertical-align: inherit;">El martillo se hizo realidad. </font><font style="vertical-align: inherit;">Y esto es lo que terminamos con:</font></font><br>
<br>
<ol>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Administraci√≥n autom√°tica de memoria</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lo que significa que no hay necesidad de llamar a la funci√≥n de liberaci√≥n del activo. </font><font style="vertical-align: inherit;">Es decir, tan pronto como se destruyen todos los objetos externos que usan el activo, el activo se destruye. </font><font style="vertical-align: inherit;">La motivaci√≥n aqu√≠ es simple: escriba menos c√≥digo. </font><font style="vertical-align: inherit;">Menos c√≥digo significa menos errores.</font></font></li>
<li><i> <b></b>  </i>,           (    AssetManager‚Äôa).   ,      .   ‚Äî      .       ,     ¬´¬ª    .<br>
    ,      ,       ().       ‚Äî    ,  . ,     ,              .         ,      ,    .        ,   ,    .</li>
<li><i>   </i>      .  :        .         ,         .</li>
<li><i> (shared)  </i>. ,         .  ,    .           ¬´¬ª ,               .</li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorizar la carga de activos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Solo hay 3 niveles de prioridad: Alto, Medio, Bajo. </font><font style="vertical-align: inherit;">Dentro de la misma prioridad, los activos se cargan en el orden de la solicitud. </font><font style="vertical-align: inherit;">Imagine una situaci√≥n: un jugador hace clic en "Para luchar", y comienza la carga de nivel. </font><font style="vertical-align: inherit;">Junto con esto, la tarea de preparar el sprite de la pantalla de carga cae en la cola de descarga. </font><font style="vertical-align: inherit;">Pero dado que algunos de los activos de nivel entraron en la cola antes del sprite, el jugador mira la pantalla en negro durante bastante tiempo.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, formulamos una regla simple para nosotros: "Todo lo que se puede hacer en el hilo AssetManager debe hacerse en el hilo AssetManager". </font><font style="vertical-align: inherit;">Por ejemplo, preparar una partici√≥n del paisaje y la textura de las normales en funci√≥n de un mapa de altura, vincular un programa de GPU, etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algunos detalles de implementaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar a comprender c√≥mo funciona el sistema de carga de activos, debemos familiarizarnos con dos clases que se utilizan ampliamente en el motor Blitz.Engine:</font></font><br>
<br>
<ul>
<li><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: informaci√≥n de tiempo de ejecuci√≥n sobre alg√∫n tipo. </font><font style="vertical-align: inherit;">Este tipo es similar a un tipo </font></font><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del lenguaje C #, con la excepci√≥n de que no proporciona acceso a los campos y m√©todos del tipo. </font><font style="vertical-align: inherit;">Contiene: nombre del tipo, una serie de signos como </font></font><code>is_floating, is_pointer, is_const</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, etc. </font><font style="vertical-align: inherit;">El m√©todo </font></font><code>Type::instance&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve una constante dentro del inicio de una aplicaci√≥n </font></font><code>const Type*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, lo que le permite hacer verificaciones del formulario</font></font><code>if (type == Type::instance&lt;T&gt;())</code></li>
<li><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: le permite empaquetar el valor de cualquier tipo m√≥vil o copiable. </font><font style="vertical-align: inherit;">El conocimiento de qu√© tipo est√° empaquetado se </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">almacena como constante </font></font><code>Type*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sabe c√≥mo calcular un hash de acuerdo con su contenido, y tambi√©n sabe c√≥mo comparar contenidos para la igualdad. </font><font style="vertical-align: inherit;">En el camino, le permite realizar conversiones del tipo actual a otro. </font><font style="vertical-align: inherit;">Este es un tipo de replanteamiento de cualquier clase de la biblioteca est√°ndar o biblioteca de impulso.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el sistema de carga de la lista de activos se basa en tres clases: </font></font><code>AssetManager, AssetBase, IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Sin embargo, antes de continuar con la descripci√≥n de estas clases, se debe decir que el c√≥digo externo usa un alias </font></font><code>Asset&lt;T&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se declara as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs">Asset = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
donde T es un AssetBase o un tipo espec√≠fico de activo. Usando shared_ptr en todas partes, logramos el cumplimiento del requisito n√∫mero 1 (Administraci√≥n autom√°tica de memoria). </font></font><br>
<br>
<code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta es una clase finita que no tiene herederos. Esta clase define el ciclo de vida de un activo y env√≠a mensajes sobre cambios en el estado de un activo. Tambi√©n </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">almacena un √°rbol de dependencia entre activos y un enlace de activos a archivos en el disco, escucha </font></font><code>FileWatcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e implementa una recarga de activos. Y lo m√°s importante, </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lanza un subproceso separado, implementa una cola de tareas para preparar el activo y encapsula toda la sincronizaci√≥n con otros subprocesos de aplicaci√≥n (la solicitud del activo se puede realizar desde cualquier subproceso de aplicaci√≥n, incluida la secuencia de descarga). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opera con un activo abstracto</font></font><code>AssetBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, delegando la tarea de crear y cargar un activo de un tipo espec√≠fico al heredero de </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Te contar√© m√°s sobre c√≥mo sucede esto en art√≠culos posteriores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como parte del requisito n√∫mero 4 (intercambio de activos), una de las preguntas m√°s importantes fue "¬øqu√© usar como identificador de activos?" </font><font style="vertical-align: inherit;">La soluci√≥n m√°s simple y aparentemente obvia ser√≠a usar la ruta al archivo que se va a descargar. </font><font style="vertical-align: inherit;">Sin embargo, esta decisi√≥n impone una serie de limitaciones serias:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para crear un activo, este √∫ltimo debe representarse como un archivo en el disco, lo que elimina la capacidad de crear activos en tiempo de ejecuci√≥n basados ‚Äã‚Äãen otros activos.</font></font></li>
<li>    . ,    GPUProgram     (defines).      ,       .</li>
<li>         ,   .</li>
<li>        .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No consideramos los p√°rrafos 3 y 4 como un argumento al principio, ya que ni siquiera se pensaba que esto pudiera ser √∫til. Sin embargo, estas caracter√≠sticas posteriormente facilitaron enormemente el desarrollo del editor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, decidimos usar la clave del activo como un identificador, que en el nivel </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√° representado por el tipo </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">heredero sabe </font><font style="vertical-align: inherit;">interpretar </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. S√≠ </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√≥lo conoce la relaci√≥n entre el tipo de clave y el heredero </font></font><code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. El c√≥digo que solicita un activo generalmente sabe qu√© tipo de activo necesita y funciona con una clave de un tipo espec√≠fico. Todo va m√°s o menos as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Texture</span>:</span> <span class="hljs-keyword">public</span> AssetBase<font></font>
{<font></font>
<span class="hljs-keyword">public</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PathKey</span>
    {</span><font></font>
        FilePath path;<font></font>
        <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">hash</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> PathKey&amp; other);<font></font>
    };<font></font>
<font></font>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryKey</span>
    {</span>
        u32 width = <span class="hljs-number">1</span>;<font></font>
        u32 height = <span class="hljs-number">1</span>;<font></font>
        u32 level_count = <span class="hljs-number">1</span>;<font></font>
        TextureFormat format = RBGA8;<font></font>
        TextureType type = TEX_2D;<font></font>
        <span class="hljs-function">Vector&lt;Vector&lt;u8*&gt;&gt; data</span>; <span class="hljs-comment">// Face&lt;MipLevels&lt;Image&gt;&gt;</span><font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">hash</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span></span>;
        <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>==(<span class="hljs-keyword">const</span> MemoryKey&amp; other);<font></font>
    };<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextureSerializer</span>:</span> <span class="hljs-keyword">public</span> IAssetSerializer<font></font>
{<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AssetManager</span> <span class="hljs-title">final</span>
{</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    Asset&lt;T&gt; <span class="hljs-title">get_asset</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Any&amp; key, ...)</span></span>;
    <span class="hljs-function">Asset&lt;AssetBase&gt; <span class="hljs-title">get_asset</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Any&amp; key, ...)</span></span>;<font></font>
};<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{<font></font>
   ...<font></font>
   <span class="hljs-function">Texture::PathKey <span class="hljs-title">key</span><span class="hljs-params">(<span class="hljs-string">"/path_to_asset"</span>)</span></span>;<font></font>
   Asset&lt;Texture&gt; asset = asset_manager-&gt;get_asset&lt;Texture&gt;(key);<font></font>
   ...<font></font>
<font></font>
   Texture::MemoryKey mem_key;<font></font>
   mem_key.width = <span class="hljs-number">128</span>;<font></font>
   mem_key.format = <span class="hljs-number">128</span>;<font></font>
   mem_key.level_count = <span class="hljs-number">1</span>;<font></font>
   mem_key.format = A8;<font></font>
   mem_key.type = TEX_2D;<font></font>
   Vector&lt;u8*&gt;&amp; mip_chain = mem_key.data.emplace_back();<font></font>
   mip_chain.push_back(generage_sdf_font());<font></font>
   <font></font>
   Asset&lt;Texture&gt; sdf_font_texture = asset_manager-&gt;get_asset&lt;Texture&gt;(mem_key);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√©todo </font></font><code>hash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y el operador de comparaci√≥n en el interior </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son necesarios para el funcionamiento de las operaciones de clase correspondientes </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pero no nos detendremos en esto en detalle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, qu√© sucede en el c√≥digo anterior: en el momento de la llamada, la </font></font><code>get_asset(key)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clave se copiar√° en un objeto temporal del tipo </font></font><code>Any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que, a su vez, se pasar√° al m√©todo </font></font><code>get_asset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A continuaci√≥n, </font></font><code>AssetManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tome el tipo de clave del argumento. En nuestro caso, ser√°:</font></font><br>
<br>
<pre><code class="cpp hljs">Type::instance&lt;MyAsset::PathKey&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por este tipo, encontrar√° el objeto del serializador y delegar√° al serializador todas las operaciones posteriores (creaci√≥n y carga). </font></font><br>
<br>
<code>AssetBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Esta es la clase base para todo tipo de activos en el motor. </font><font style="vertical-align: inherit;">Esta clase almacena la clave del activo, el estado actual del activo (cargado, en cola, etc.), as√≠ como el texto de error si falla la carga del activo. </font><font style="vertical-align: inherit;">De hecho, la estructura interna es un poco m√°s complicada, pero consideraremos esto junto con el ciclo de vida de los activos. </font></font><br>
<br>
<code>IAssetSerializer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como su nombre lo indica, es la clase base para la entidad que se dedica a la preparaci√≥n del activo. </font><font style="vertical-align: inherit;">De hecho, el heredero de esta clase no solo est√° cargando el activo:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asignaci√≥n y desasignaci√≥n de un objeto activo de un tipo espec√≠fico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cargando un activo de un tipo espec√≠fico.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilar una lista de rutas de archivos en funci√≥n de la cual se construye el activo. </font><font style="vertical-align: inherit;">Esta lista es necesaria para el mecanismo de recarga de activos cuando cambia un archivo. </font><font style="vertical-align: inherit;">Surge la pregunta: ¬øpor qu√© la lista de rutas, y no una ruta? </font><font style="vertical-align: inherit;">Los activos simples, como las texturas, realmente se pueden construir sobre la base de un solo archivo. </font><font style="vertical-align: inherit;">Sin embargo, si miramos el sombreador, veremos que el reinicio deber√≠a ocurrir no solo si el texto del sombreador cambia, sino tambi√©n si el archivo conectado al sombreador cambia a trav√©s de la directiva include.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guardando activo en el disco. </font><font style="vertical-align: inherit;">Se usa activamente tanto al editar activos como al preparar activos para el juego.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informa los tipos de claves que admite.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y la √∫ltima pregunta que quiero destacar en el marco de este art√≠culo: ¬øpor qu√© podr√≠a necesitar tener varios tipos de claves en un serializador / activo? </font><font style="vertical-align: inherit;">Vamos a resolverlo por turnos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un serializador: varios tipos de claves</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tomemos un ejemplo de un activo </font></font><code>GPUProgram</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(es decir, un sombreador). </font><font style="vertical-align: inherit;">Para cargar un sombreador en nuestro motor, se requiere la siguiente informaci√≥n:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ruta al archivo del sombreador.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de definiciones de preprocesador.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La etapa para la que se ensambla y compila el sombreador (v√©rtice, fragmento, c√°lculo).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El nombre del punto de entrada.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al reunir esta informaci√≥n, obtenemos la tecla de sombreador, que se utiliza en el juego. Sin embargo, durante el desarrollo de un juego o motor, a menudo es necesario mostrar cierta informaci√≥n de depuraci√≥n en la pantalla, a veces con un sombreador espec√≠fico. Y en esta situaci√≥n, puede ser conveniente escribir el texto del sombreador directamente en el c√≥digo. Para hacer esto, podemos obtener el segundo tipo de clave, que en lugar de la ruta al archivo y la lista de definiciones de preprocesador contendr√° el texto del sombreador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere otro ejemplo: textura. La forma m√°s f√°cil de crear una textura es cargarla desde el disco. Para hacer esto, necesitamos la ruta al archivo ( </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Pero tambi√©n podemos generar contenidos de textura algor√≠tmicamente y crear una textura a partir de una matriz de bytes ( </font></font><code>MemoryKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). El tercer tipo de clave puede ser una clave para crear una </font></font><code>RenderTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">textura ( </font></font><code>RTKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dependiendo del tipo de clave, se pueden usar varios motores de rasterizaci√≥n de glifos: stb (StbFontKey), FreeType (FTFontKet) o un generador de fuentes de campo de distancia firmado y autofirmado (SDFFontKey). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La animaci√≥n de fotogramas clave se puede cargar ( </font></font><code>PathKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) o generar mediante c√≥digo ( </font></font><code>MemoryKey</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un activo: varios tipos de claves</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que tenemos un </font></font><code>ParticleEffect</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">activo que describe las reglas para la generaci√≥n de part√≠culas. Adem√°s, tenemos un editor conveniente para este activo. Al mismo tiempo, el editor de niveles y el editor de part√≠culas son una aplicaci√≥n de m√∫ltiples ventanas. Esto es conveniente porque puede abrir un nivel, colocar una fuente de part√≠culas en √©l y observar el efecto en el entorno del nivel, mientras edita el efecto en s√≠. Si tenemos un tipo de clave, entonces el objeto de efecto que se usa en el mundo de edici√≥n de efectos y en el mundo de nivel es el mismo. Todos los cambios realizados en el editor de efectos ser√°n visibles inmediatamente en el nivel. A primera vista, esto puede parecer una idea genial, pero veamos los siguientes escenarios:</font></font><br>
<br>
<ol>
<li>    ,   ,    ,    .   ,            . </li>
<li>-       ,    .        ,            .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, es posible una situaci√≥n en la que creamos dos tipos diferentes de activos a partir de un archivo en un disco usando dos tipos diferentes de claves. </font><font style="vertical-align: inherit;">Utilizando el tipo de clave "juego", creamos una estructura de datos optimizada para un trabajo r√°pido en el juego. </font><font style="vertical-align: inherit;">Usando el tipo de clave "editorial", creamos una estructura de datos que es conveniente para la edici√≥n. </font><font style="vertical-align: inherit;">De esta manera, nuestro editor implementa la edici√≥n </font></font><code>BlendTree</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para animaciones esquel√©ticas. </font><font style="vertical-align: inherit;">Basado en un tipo de clave, el sistema de activos nos crea un activo con un √°rbol honesto dentro y un mont√≥n de se√±ales sobre el cambio de topolog√≠a, lo cual es muy conveniente cuando se edita, pero es bastante lento en el juego. </font><font style="vertical-align: inherit;">Seg√∫n un tipo diferente de clave, el serializador crea otro tipo de activo: el activo no tiene m√©todos para cambiar el √°rbol, y el √°rbol en s√≠ mismo se convierte en una matriz de nodos, donde el enlace al nodo es un √≠ndice en la matriz.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ep√≠logo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En resumen, me gustar√≠a concentrar su atenci√≥n en las soluciones que m√°s han influido en el desarrollo posterior del motor:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usar una estructura personalizada como clave de activo, no una ruta de archivo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carga de activos solo en modo as√≠ncrono.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un esquema flexible para administrar el intercambio de activos (un activo - varios tipos de claves).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La capacidad de recibir activos del mismo tipo utilizando diferentes fuentes de datos (soporte para varios tipos de claves en un serializador).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aprender√° c√≥mo exactamente estas decisiones influyeron en la implementaci√≥n del c√≥digo interno y externo en la pr√≥xima serie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autor:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exmix</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es498290/index.html">Hidrolog√≠a de procedimiento: simulaci√≥n din√°mica de r√≠os y lagos.</a></li>
<li><a href="../es498292/index.html">Ahorre mucho dinero en grandes vol√∫menes en PostgreSQL</a></li>
<li><a href="../es498294/index.html">Detecci√≥n de objetos Reconocer y gobernar. Parte 1</a></li>
<li><a href="../es498296/index.html">Dise√±o a nivel de sistema. Parte 1. De la idea al sistema</a></li>
<li><a href="../es498298/index.html">Las empresas usan recompensas de errores para comprar silencio de hackers</a></li>
<li><a href="../es498302/index.html">Licencia avanzada de la OIT. ¬øPor qu√© se necesita en este momento?</a></li>
<li><a href="../es498304/index.html">Automatice las tareas de administraci√≥n de VMware vSphere API con Ansible</a></li>
<li><a href="../es498308/index.html">Algoritmo gen√©tico de Python para encontrar extremos globales</a></li>
<li><a href="../es498310/index.html">Tres trampas del aprendizaje autom√°tico y c√≥mo evitarlas</a></li>
<li><a href="../es498312/index.html">Desarrollo de una red el√©ctrica de aeronaves utilizando dise√±o orientado a modelos.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>