<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ•Ô∏è üòò üê¨ ROS y Neural Grid Beggar Robot üëπ üë©‚Äçüë¶ üë©üèº‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por lo general, surgen dos preguntas para tales manualidades: "¬øc√≥mo?" ¬øy para qu√©?" La publicaci√≥n en s√≠ est√° dedicada a la primera pregunta, y respo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ROS y Neural Grid Beggar Robot</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500150/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo general, surgen dos preguntas para tales manualidades: "¬øc√≥mo?" ¬øy para qu√©?" La publicaci√≥n en s√≠ est√° dedicada a la primera pregunta, y responder√© inmediatamente a la segunda: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
comenc√© este proyecto para dominar la rob√≥tica, comenzando con la Raspberry Pi y la c√°mara. Como saben, una de las mejores maneras de aprender algo es idear una tarea t√©cnica e intentar cumplirla, mientras obtienen las habilidades necesarias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ese momento, todav√≠a no ten√≠a ideas brillantes en el campo de la rob√≥tica, as√≠ que decid√≠ hacer un proyecto exclusivamente divertido: un robot mendigo. El resultado es un robot independiente en Raspberry Pi y ROS, que usa el Stick Neural Cumpute de Movidius para detectar rostros. Se pasea por la habitaci√≥n buscando gente y sacude una lata frente a ellos. As√≠ es como se ve este robot:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pt/wp/nt/ptwpntdd13lkskxbxjuhoyx1oom.jpeg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El robot se mueve aleatoriamente por la habitaci√≥n, y si se da cuenta de una persona, se enrolla y sacude un frasco para buscar cosas peque√±as. </font><font style="vertical-align: inherit;">Por diversi√≥n, le agregu√© una peque√±a expresi√≥n facial: sabe c√≥mo mover las cejas: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2x/lm/aw/2xlmaw5tm_hogsuqfuvqwjmeblk.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
despu√©s del primer intento, el robot intenta encontrar su rostro nuevamente a la vista, se vuelve hacia la persona y vuelve a sacudir el banco. </font><font style="vertical-align: inherit;">Pero qu√© pasa si te vas en este momento:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ko/8x/xz/ko8xxzvzo_owit62gkv8z3wn1ik.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tom√© la idea de un robot de mendicidad de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revista Popular Mechanics</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La autor√≠a prototipo de Chris Eckert llamada Gimme se ve muy est√©ticamente agradable.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/374/8d6/dbc/3748d6dbcb97d04751dacd866eb94e07.jpg" alt="imagen" width="300" height="300"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quer√≠a concentrarme m√°s en la funcionalidad, por lo que la caja se ensambl√≥ con materiales improvisados. </font><font style="vertical-align: inherit;">En particular, las esquinas de PVC demostraron ser el material m√°s vers√°til con el que puede conectar casi dos partes. </font><font style="vertical-align: inherit;">Parece que en este momento el robot est√° compuesto en un cinco por ciento por esquinas de PVC y tornillos M3. </font><font style="vertical-align: inherit;">La caja en s√≠ consiste en tres plataformas laminadas en las que se montan el cabezal y todos los componentes electr√≥nicos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base del robot es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y el c√≥digo est√° escrito en C ++ y se encuentra en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para percibir la realidad, el robot utiliza la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√°mara Paspberry Pi Camera Module v2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que se puede controlar con la biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RaspiCam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la detecci√≥n de rostros, prob√© varios enfoques diferentes. La calidad de los detectores cl√°sicos de OpenCV no me satisfizo, as√≠ que al final llegu√© a una soluci√≥n bastante no est√°ndar. Detecci√≥n de personas involucradas en la red neuronal, que se ejecutan en el dispositivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movidius Neural Compute Stick (NCS)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bajo el marco de control </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenVINO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NCS es una pieza de hardware para el lanzamiento efectivo de redes neuronales, dentro de las cuales hay varios procesadores vectoriales especialmente dise√±ados para esto. El dispositivo est√° conectado a trav√©s de USB y consume solo 1 vatio de energ√≠a. Por lo tanto, el NCS act√∫a como un coprocesador para la Raspberry Pi, que no tira de la red neuronal. Mientras el NCS procesa el siguiente cuadro, el procesador Paspberry es gratuito para otras operaciones. Vale la pena se√±alar que para un funcionamiento √≥ptimo del dispositivo, se requiere una interfaz USB 3.0, que no est√° disponible en versiones anteriores de Raspberry; con USB 2.0 tambi√©n funciona, solo que m√°s lento. Adem√°s, para no bloquear los conectores USB Raspberry, conecto el NCS a trav√©s de un cable USB corto. Escrib√≠ en detalle sobre trabajar con el Neural Compute Stick </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en mi art√≠culo anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al principio trat√© de entrenar</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detector de rostros propio con arquitectura MobileNet + SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en conjuntos de datos abiertos. El detector realmente funcion√≥, pero no muy estable: con el inevitable deterioro de las condiciones de disparo (exposici√≥n y disparos borrosos), la calidad del detector se redujo enormemente. Sin embargo, despu√©s de un tiempo, aparecieron detectores faciales listos para usar en OpenVINO, y cambi√© a un detector con la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arquitectura SqueezeNet light + SSD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que no solo funcion√≥ mejor en una variedad de condiciones de disparo, sino que tambi√©n fue m√°s r√°pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de cargar la imagen al NCS para obtener las predicciones del detector, la imagen debe ser preprocesada. El detector de mi elecci√≥n funciona con im√°genes en color.</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>300</mn><mo>&amp;#x00D7;</mo><mn>300</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.815ex" height="2.009ex" viewBox="0 -755.5 4225.9 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-D7" x="1723" y="0"></use><g transform="translate(2724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>300</mn><mo>√ó</mo><mn>300</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">300 \times 300</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo que la imagen debe comprimirse primero. Para hacer esto, uso el algoritmo de escala m√°s ligero: el m√©todo vecino m√°s cercano (INTER_NEAREST en la biblioteca OpenCV). Funciona un poco m√°s r√°pido que los m√©todos de interpolaci√≥n, y casi no afecta el resultado. Tambi√©n vale la pena prestar atenci√≥n al orden de los canales de imagen: el detector espera el orden de BGR, por lo que debe configurar lo mismo para la c√°mara.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n intent√© separar el procesamiento de video en dos transmisiones, una de las cuales recibi√≥ el siguiente cuadro de la c√°mara y la proces√≥, y el otro en ese momento carg√≥ el cuadro anterior a NCS y esper√≥ los resultados del detector. Con este esquema, t√©cnicamente, la velocidad de procesamiento aumenta, pero tambi√©n aumenta el retraso entre la recepci√≥n de la trama y la recepci√≥n de detecciones. Debido a este retraso en la realidad, el monitoreo de la cara se vuelve m√°s dif√≠cil, por lo que al final rechac√© este esquema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de detectar rostros, tambi√©n deben rastrearse para evitar errores del detector. Para hacer esto, utilizo el rastreador liviano </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple Online Realtime Tracker (SORT)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Este rastreador simple consta de dos partes: el </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">algoritmo h√∫ngaro</font></a><font style="vertical-align: inherit;"> se usa para unir objetos en cuadros adyacentes</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y para predecir la trayectoria del objeto, si de repente desaparece: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filtro de Kalman</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mientras jugaba con el seguimiento facial, descubr√≠ que las trayectorias predichas por el filtro de Kalman pueden ser muy inveros√≠miles con movimientos repentinos, lo que nuevamente complica el proceso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, apagu√© el filtro de Kalman, dejando solo el algoritmo de coincidencia de caras y el contador del n√∫mero secuencial de fotogramas en los que se detect√≥ la cara, de esta manera me deshago de los falsos positivos del detector. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plataforma superior, de izquierda a derecha: c√°mara, servos para controlar la cabeza y las cejas, interruptor, terminales de alimentaci√≥n, bot√≥n rojo grande.</font></font></i><br>
<img src="https://habrastorage.org/webt/hb/ky/kk/hbkykkpwtkhtfl39aonaop5indg.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√°fico</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para el movimiento, el robot tiene cinco servos: dos servos de rotaci√≥n continua FS5103R hacen girar las ruedas; Hay dos FS5109M m√°s comunes, uno de los cuales gira la cabeza y el otro sacude la lata; Finalmente, el peque√±o SG90 mueve las cejas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser honesto, los mini servos SG90 me parecieron basura: uno de mis servos ten√≠a el ancho de pulso de control incorrecto y solo uno sobrevivi√≥ entre los otros cuatro. Para ser justos, accidentalmente tom√© a uno de los sirvientes con el codo, pero los otros dos simplemente no pod√≠an soportar la carga (sol√≠a usarlos para la cabeza y los bancos). Incluso el √∫ltimo servo, que obtuvo el trabajo m√°s simple: mover las cejas, tiene que pinchar un palo de vez en cuando para que no se acu√±e. Con otros servos, no not√© ning√∫n problema. Es cierto que los servos de rotaci√≥n continua a veces tienen que calibrarse para que no giren en el estado inactivo; para esto hay un peque√±o regulador que se puede girar con un destornillador de cabeza de reloj. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resulta que administrar servos con Raspberry no es tan simple. Primero, son controlados por</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modulaci√≥n de ancho de pulso (PWM / PWM)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y en Raspberry solo hay dos pines en los que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM es compatible con el hardware</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . En segundo lugar, por supuesto, Raspberry no podr√° alimentar los servos, no lo soportar√°. Afortunadamente, estos problemas se resuelven utilizando un controlador PWM externo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adafruit PCA9685</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es un controlador PWM de 16 canales que se puede controlar a trav√©s de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interfaz I2C</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Tambi√©n es muy conveniente que tenga terminales para suministrar energ√≠a a los servos. Adem√°s, [te√≥ricamente] es posible encadenar hasta 62 controladores, mientras recibe hasta 992 pines de control; para esto, debe asignar una direcci√≥n √∫nica a cada controlador utilizando puentes especiales. Entonces, si de repente necesitas un ej√©rcito de servos, sabes qu√© hacer.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar el PCA9685, hay una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">biblioteca de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alto nivel </font><font style="vertical-align: inherit;">que act√∫a como una extensi√≥n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiringPi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Trabajar con esto es bastante conveniente: durante la inicializaci√≥n, crea 16 pines virtuales en los que puede escribir una se√±al PWM, pero primero debe calcular el n√∫mero de ticks. </font><font style="vertical-align: inherit;">Para girar la palanca del servo a un cierto √°ngulo en el rango [0, 180], primero debe traducir este √°ngulo al rango de longitudes de pulso de control en milisegundos [SERVO_MS_MIN, SERVO_MS_MAX]. </font><font style="vertical-align: inherit;">Para todos mis servos, estos valores son aproximadamente 0.6 ms y 2.4 ms, respectivamente. </font><font style="vertical-align: inherit;">En general, estos valores se pueden encontrar en la hoja de datos del servo, pero la pr√°ctica ha demostrado que pueden diferir, por lo que puede ser necesario seleccionarlos. </font><font style="vertical-align: inherit;">Luego divida el valor resultante entre 20 ms (el valor est√°ndar de la duraci√≥n del ciclo de control) y multiplique por el n√∫mero m√°ximo de tics PCA9685 (4096):</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">driveDegs</span><span class="hljs-params">(<span class="hljs-keyword">float</span> angle, <span class="hljs-keyword">int</span> pin)</span> </span>{
    <span class="hljs-keyword">int</span> ticks = (<span class="hljs-keyword">int</span>) (PCA_MAX_PWM * (angle/<span class="hljs-number">180.0f</span>*(SERVO_MS_MAX-SERVO_MS_MIN) + SERVO_MS_MIN) / <span class="hljs-number">20.0f</span>); <font></font>
    pwmWrite(pin, ticks);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Del mismo modo, esto se hace con servos de rotaci√≥n continua: en lugar de un √°ngulo, establecemos la velocidad en el rango [-1,1].</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensambl√© el chasis del robot, as√≠ como el cuerpo, por medios improvisados: puse ruedas de muebles en los servomotores de rotaci√≥n continua, y un soporte de bolas de muebles act√∫a como la tercera rueda. Anteriormente, en lugar de eso, una rueda se encontraba sobre un soporte giratorio, pero con tal chasis era dif√≠cil hacer giros precisos, as√≠ que tuve que reemplazarlo. Tambi√©n hay una peque√±a rueda debajo de la lata para transferir parte del peso del servo a la carcasa. Al principio, algo simple que no era obvio para m√≠ era que las palancas servo se deben fijar con un tornillo, especialmente para las ruedas, para que no se caigan en el camino. Debido a tal estupidez, tuve que rehacer el chasis una vez. Tambi√©n hice del robot un parachoques ancho hecho de esquinas de PVC para que no se atasque con tanta frecuencia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora sobre lo que puedes hacer al respecto. En primer lugar, puede sacudir el frasco y mover las cejas; para esto solo tiene que girar la palanca del servo a √°ngulos preseleccionados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En segundo lugar, puedes girar la cabeza. No quer√≠a que la cabeza girara a la velocidad m√°xima del servo, porque tiene una c√°mara. Por lo tanto, decid√≠ reducir la velocidad mediante programaci√≥n: necesito girar la palanca un √°ngulo peque√±o, luego esperar unos milisegundos, y as√≠ sucesivamente hasta alcanzar el √°ngulo deseado. En este caso, es necesario recordar la posici√≥n absoluta actual de la cabeza y cada vez verificar si ha excedido los l√≠mites permitidos (en mi robot est√° en el rango [10, 90] grados).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tercer lugar, puede cambiar la direcci√≥n del movimiento cambiando la velocidad de rotaci√≥n de las ruedas. </font><font style="vertical-align: inherit;">Del mismo modo, puede girar la plataforma, por ejemplo, para seguir la cara. </font><font style="vertical-align: inherit;">La velocidad angular de rotaci√≥n depende tanto de los servos como de su ubicaci√≥n en el chasis, por lo que es m√°s f√°cil medirlo una vez y luego tenerlo en cuenta en las curvas. </font><font style="vertical-align: inherit;">Para encontrar el retraso necesario entre encender los motores para la rotaci√≥n y apagarlos, debe dividir el m√≥dulo de √°ngulo por la velocidad angular. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, puede girar la cabeza y el chasis simult√°neamente y asincr√≥nicamente para no perder el tiempo. </font><font style="vertical-align: inherit;">Lo hago as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">auto</span> waitRotation = <span class="hljs-built_in">std</span>::async(<span class="hljs-built_in">std</span>::launch::async, rotatePlatform, platformAngle);<font></font>
success = driveHead(headAngle);<font></font>
waitRotation.wait();<font></font>
</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plataforma central, de izquierda a derecha: PCA9685, bus de alimentaci√≥n, Raspberry Pi, MCP3008 ADC</font></font></i><br>
<img src="https://habrastorage.org/webt/bq/q1/8_/bqq18_ilwmgadlcsz0ydepdk44u.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navegaci√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces no complicaba nada, por lo que el robot usa solo dos buscadores de alcance infrarrojos Sharp GP2Y0A02YK para la navegaci√≥n. Esto tampoco es tan simple, porque los sensores son anal√≥gicos, pero Raspberry, a diferencia de Arduino, </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">no</font></a><font style="vertical-align: inherit;"> tiene </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entradas anal√≥gicas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Este problema se resuelve con el convertidor anal√≥gico a digital (ADC / ADC): utilizo el MCP3008 de 10 bits y 8 canales. Se vende como un microcircuito separado, por lo que tuvo que soldarse a una placa de circuito impreso y los pines tambi√©n se soldaron all√≠ para que sea m√°s conveniente conectarse. Adem√°s, siguiendo el consejo de mi bati, que se mete m√°s en los circuitos, solde dos condensadores (cer√°mica y electrol√≠ticos) entre las patas de la fuente de alimentaci√≥n y el suelo para absorber el ruido de la parte digital de todo el circuito. Los sensores no emiten m√°s de tres voltios en la salida, por lo que se pueden conectar 3.3v con Raspberry como voltaje ADC de referencia (VREF), lo mismo que para la fuente de alimentaci√≥n MCP3008 (VDD). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El MCP3008 se puede controlar a trav√©s de la interfaz </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y para esto es incluso m√°s f√°cil encontrar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo listo para usar en GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A pesar de esto, para un trabajo conveniente con el ADC, necesitar√° algunos bailes con una pandereta.</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> <span class="hljs-title">analogRead</span><span class="hljs-params">(mcp3008Spi &amp;adc, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> channel)</span>
</span>{
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> spi_data[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> val = <span class="hljs-number">0</span>;<font></font>
<font></font>
    spi_data[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;  <span class="hljs-comment">// start bit</span>
    spi_data[<span class="hljs-number">1</span>] = <span class="hljs-number">0b10000000</span> | ( channel &lt;&lt; <span class="hljs-number">4</span>); <span class="hljs-comment">// mode and channel</span>
    spi_data[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">// anything</span>
    adc.spiWriteRead(spi_data, <span class="hljs-keyword">sizeof</span>(spi_data));<font></font>
  <font></font>
    <span class="hljs-comment">// read value, combine last two bits of second byte with whole third byte</span>
    val = (spi_data[<span class="hljs-number">1</span>]&lt;&lt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0b1100000000</span>; <font></font>
    val |= (spi_data[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>);
    <span class="hljs-keyword">return</span> val;<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se deben enviar tres bytes al MCP3008, donde el bit de inicio se escribe en el primer byte, y el modo y el n√∫mero de canal (0-7) en el segundo. </font><font style="vertical-align: inherit;">Tambi√©n recuperamos tres bytes, despu√©s de lo cual debemos pegar los dos bits menos significativos del segundo byte con todos los bits del tercero. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora que podemos obtener los valores de los sensores, necesitamos calibrarlos, porque los dos sensores pueden diferir ligeramente entre s√≠. </font><font style="vertical-align: inherit;">En general, la visualizaci√≥n desde una distancia debido a la intensidad de la se√±al de estos sensores no es lineal y no es muy simple ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para m√°s detalles, consulte la hoja de datos, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Por lo tanto, es suficiente recoger dos coeficientes, cuando se multiplican por los cuales los sensores dar√°n un valor de 1.0 a alguna distancia significativa e igual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las lecturas del sensor pueden ser bastante ruidosas, especialmente en obst√°culos dif√≠ciles, por lo que utilizo un promedio m√≥vil ponderado exponencialmente (EWMA) para suavizar la se√±al de cada sensor. </font><font style="vertical-align: inherit;">Seleccion√© los par√°metros de suavizado a simple vista, para que la se√±al no haga ruido y no quede muy por detr√°s de la realidad. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vista frontal: banco, tel√©metros y parachoques.</font></font></i><br>
<img src="https://habrastorage.org/webt/kb/vw/l-/kbvwl-usmln86iqj8aq236ifhpo.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrici√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, eval√∫e qu√© corriente consumir√° el robot ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre el consumo actual de Raspberry y perif√©ricos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raspberry Pi 2B: no menos de 350 mA, pero m√°s bajo carga (hasta 750-820 mA (?));</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√°mara: aproximadamente 250 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neural Compute Stick: consumo de energ√≠a declarado de 1 vatio, a un voltaje de 5 voltios en USB es de 200 mA;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sensores IR: 33 mA cada uno ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hoja de datos, pdf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li>MCP3008:  ,  0.5  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>PCA9685:  , 6  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">, pdf</a>);</li>
<li>:  ~150-200   1500-2000     (stall current),          (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> FS5109M, pdf</a>)</li>
<li>HDMI (   ): 50 ;</li>
<li> +  ( ): ~200 .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En total, se puede estimar que 1.5-2.5 amperios deber√≠an ser suficientes, siempre que todos los servos no se muevan simult√°neamente bajo una carga pesada. Al mismo tiempo, Raspberry necesita un voltaje condicional de 5 voltios y para servos: 4.8-6 voltios. Queda por encontrar una fuente de energ√≠a que cumpla con estos requisitos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, decid√≠ alimentar el robot con bater√≠as </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18650.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si toma dos </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">bater√≠as ROBITON 3.4 / Li18650</font></a><font style="vertical-align: inherit;"> (3.6 voltios, 3400 mAh, corriente de descarga m√°xima 4875 mA) y las conecta en serie, pueden producir hasta 4.8 amperios a un voltaje de 7.2 voltios. Con una corriente de consumo de 1.5-2.5 amperios, deber√≠an ser suficientes durante una o dos horas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las bater√≠as, por cierto, tienen un inconveniente: a pesar del factor de forma indicado 18650, sus tama√±os est√°n lejos de ser</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>18</mn><mo>&amp;#x00D7;</mo><mn>650</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.653ex" height="2.009ex" viewBox="0 -755.5 3725.4 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-D7" x="1223" y="0"></use><g transform="translate(2223,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-36"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>18</mn><mo>√ó</mo><mn>650</mn></math></span></span><script type="math/tex" id="MathJax-Element-2">18 \times 650</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mm: son varios mil√≠metros m√°s largos debido al circuito de control de carga incorporado. Debido a esto, tuve que apu√±alar el compartimento de la bater√≠a con un cuchillo para que quepan all√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo queda bajar el voltaje a 5 voltios. Para esto, uso dos convertidores DC-DC </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reductores separados DFRobot Power Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esta pieza de hierro le permite bajar el voltaje a un voltaje de entrada de 3.6-25 voltios y una diferencia de voltaje de al menos 0.6 voltios. Por conveniencia, tiene un interruptor que le permite seleccionar exactamente 5 voltios en la salida, o puede configurar un voltaje de salida arbitrario utilizando un regulador especial. Puse ambos convertidores a 5 voltios; uno de ellos alimenta Raspberry a trav√©s de un conector Micro-USB, y el segundo alimenta servos a trav√©s de terminales PCA9685. Esto es necesario para maximizar la fuente de alimentaci√≥n de las partes l√≥gicas y de potencia del robot para que no interfieran entre s√≠.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la etapa de depuraci√≥n, utilic√© una fuente de alimentaci√≥n china de 9 voltios y 2 amperios en lugar de las bater√≠as, y fue suficiente para que el robot funcionara: la conect√©, como las bater√≠as, a dos convertidores CC-CC. Por lo tanto, para mayor comodidad, hice terminales en el robot, a los que puede conectar una fuente de alimentaci√≥n o un compartimento de bater√≠a para elegir. Esto ayud√≥ mucho cuando reescrib√≠ completamente todo el c√≥digo en ROS, y tuve que depurar el robot durante mucho tiempo, incluidos los servos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por conveniencia, tambi√©n tuve que hacer un "bus de energ√≠a", de hecho, solo un pedazo de la placa con tres filas de pines conectados para tierra, 3.3v y 5v, respectivamente. El bus se conecta a los pines Raspberry correspondientes. Solo los tel√©metros IR se alimentan desde el bus de 5v, y MCP3008 y PCA9685 desde el bus de 3.3v.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, por supuesto, de acuerdo con la vieja tradici√≥n, puse el Big Red Button en el robot: cuando se presiona, simplemente interrumpe todo el circuito de alimentaci√≥n. </font><font style="vertical-align: inherit;">No fue necesario usarlo para una parada de emergencia, pero encender el robot con la ayuda de un bot√≥n es realmente m√°s conveniente. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plataforma inferior, de izquierda a derecha: compartimento de la bater√≠a, convertidores NCS, DC-DC, servoaccionamientos con ruedas, tel√©metros.</font></font></i><br>
<img src="https://habrastorage.org/webt/od/tf/6b/odtf6b5gksijt0nhbflim7wrh1m.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control de robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay Wi-Fi en la Raspberry Pi 2B, por lo que tengo que conectarme a trav√©s de ssh a trav√©s de un cable Ethernet (por cierto, esto se puede hacer </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directamente desde la computadora port√°til, sin usar un enrutador</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Resulta este esquema: nos conectamos a trav√©s de ssh a trav√©s del cable, arrancamos el robot y tiramos del cable. Luego puede regresar a su lugar para acceder a la Frambuesa nuevamente. Hay soluciones m√°s elegantes, pero decid√≠ no complicarme. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que el robot pueda detenerse f√°cilmente sin apagarse, agregu√© un interruptor sovi√©tico masivo (¬ødesde un submarino?) A √©l, cuando lo apaga, el programa termina y el robot se detiene. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El conmutador se conecta al suelo y a uno de los pines Raspberry GPIO, y puede leerlo usando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la biblioteca WiringPi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">wiringPiSetup();<font></font>
pinMode(PIN_SWITCH, INPUT);<font></font>
pullUpDnControl(PIN_SWITCH, PUD_UP);<font></font>
<span class="hljs-keyword">bool</span> value = digitalRead(BB_PIN_SWITCH);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vale la pena se√±alar que con esta conexi√≥n, el voltaje en el pin debe elevarse hasta 3.3v, y al mismo tiempo producir√° una se√±al alta en el estado abierto y una se√±al baja en el estado cerrado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poniendolo todo junto</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subprocesos</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ahora, todo lo anterior debe combinarse en un solo programa que controle el robot. </font><font style="vertical-align: inherit;">En la primera versi√≥n del robot, hice esto usando hilos ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pthread</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Esta versi√≥n est√° en la rama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maestra</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero el c√≥digo all√≠ es bastante aterrador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El programa funciona en cuatro subprocesos: un subproceso toma fotogramas de la c√°mara e inicia el detector en el NCS; </font><font style="vertical-align: inherit;">el segundo flujo lee datos de tel√©metros; </font><font style="vertical-align: inherit;">el tercer subproceso supervisa el conmutador y establece la variable global </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si est√° apagado El hilo principal es responsable del comportamiento del robot y del servo control. Los hilos tienen punteros en com√∫n con el hilo principal, por el cual escriben los resultados de su trabajo. Limit√© los vectores que almacenan informaci√≥n sobre las caras encontradas por el detector al mutex, y declar√≥ las otras variables comunes m√°s simples como at√≥micas. Para coordinar el flujo del detector de rostros con el hilo principal, hay un indicador </font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que se restablece cuando sale un nuevo resultado del detector, y se eleva cuando el hilo principal usa este resultado para seleccionar un comportamiento; esto es necesario para no procesar datos antiguos que pueden no ser relevantes despues de mudarse. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
versi√≥n </font><b><font style="vertical-align: inherit;">ROS</font></b><font style="vertical-align: inherit;"> con streams funcion√≥ bien, pero comenc√© todo esto para aprender algo, entonces ¬øpor qu√© no al mismo tiempo master?</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font><font style="vertical-align: inherit;">He estado escuchando este marco durante mucho tiempo, e incluso tuve que trabajar un poco con √©l en un hackathon, as√≠ que al final decid√≠ volver a escribir todo el c√≥digo en ROS. </font><font style="vertical-align: inherit;">Esta versi√≥n del c√≥digo se encuentra en la rama predeterminada de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y se ve mucho m√°s decente. </font><font style="vertical-align: inherit;">Est√° claro que la implementaci√≥n en ROS seguramente ser√° m√°s lenta que la implementaci√≥n en los flujos debido a la sobrecarga de enviar mensajes y todo lo dem√°s; la √∫nica pregunta es ¬øcu√°nto?</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concepto ROS</font></font></b>
                        <div class="spoiler_text">ROS (Robot Operating System) ‚Äî     ,             ,   ,        .<br>
<br>
    ,  ,  ,     (node), ,    ,       .<br>
<br>
      (topic)      (message)  ,         -    . <br>
<br>
    ‚Äî   (service).         ,       ,     .      ¬´ ¬ª,    .<br>
<br>
         <code>.msg</code>  <code>.srv</code> .          .<br>
<br>
 ROS    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> </a>.<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mi robot, no utilic√© ning√∫n paquete listo con algoritmos de ROS, solo dise√±√© el c√≥digo del robot en un paquete separado que consta de cinco nodos que se comunican entre s√≠ mediante mensajes y servicios de ROS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El nodo m√°s simple </font></font><code>switch_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, supervisa el estado del conmutador. Tan pronto como se apaga el interruptor, el nodo comienza a enviar mensajes no informativos del tipo </font></font><code>bool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el tema </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esta es una se√±al para el nodo principal de que es hora de completar el trabajo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo nodo, </font></font><code>sensor_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lee peri√≥dicamente las lecturas de ambos tel√©metros IR y los env√≠a al tema en </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un mensaje. Adem√°s, este nodo es responsable del procesamiento de la se√±al: escalado por factores de calibraci√≥n y promedio m√≥vil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tercer nudo</font></font><code>camera_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âl es responsable de todo lo relacionado con las caras: toma im√°genes de la c√°mara, las procesa, recibe los resultados del detector, las pasa a trav√©s del rastreador y luego encuentra la cara m√°s cercana al centro del marco: el robot no usa el resto de todos modos, pero desea hacer mensajes m√°s peque√±os. Los mensajes que el nodo env√≠a al tema </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contienen el n√∫mero de cuadro, el hecho de tener una cara (porque tambi√©n necesita saber sobre la ausencia de una cara), las coordenadas relativas de la esquina superior izquierda, el ancho y la altura de la cara. As√≠ es como se ve la descripci√≥n del tipo de mensaje en el archivo </font></font><code>DetectionBox.msg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">int64 count<font></font>
bool present<font></font>
float32 x<font></font>
float32 y<font></font>
float32 width<font></font>
float32 height<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cuarto nodo, </font></font><code>servo_node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es responsable de los servos. En primer lugar, admite un servicio </font></font><code>servo_action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite que una de las acciones sea realizada por los servos por su n√∫mero: poner todo el nodo en su estado inicial (cejas, banco, cabeza, detener el chasis); transfiere la cabeza a su estado inicial; agite el frasco; representa con una ceja una de las tres expresiones (buena, neutral, mala). En segundo lugar, utilizando el servicio, </font></font><code>servo_speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede establecer nuevas velocidades para ambas ruedas envi√°ndolas en la solicitud. Ambos servicios no devuelven nada. Finalmente, hay un servicio </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que le permite rotar el cabezal y / o el chasis un cierto √°ngulo con respecto a la posici√≥n actual. Este servicio regresa </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si fue posible girar la cabeza al menos parcialmente, y</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de lo contrario, en el caso en que la cabeza ya est√© en el borde del √°ngulo permitido, y estamos tratando de girarla a√∫n m√°s. </font><font style="vertical-align: inherit;">Si ambos √°ngulos en la solicitud son distintos de cero, el servicio gira de forma asincr√≥nica, como se indic√≥ anteriormente. </font><font style="vertical-align: inherit;">En el bucle principal, el servo nodo no hace nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠, por ejemplo, hay una descripci√≥n del servicio </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">float32 head_delta<font></font>
float32 platform_delta<font></font>
---<font></font>
bool head_success<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada uno de los nodos enumerados admite un servicio </font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con una solicitud de respuesta vac√≠a, que detiene la operaci√≥n del nodo. </font><font style="vertical-align: inherit;">Se implementa de esta manera:</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algun codigo</font></font></b>
                        <div class="spoiler_text"><pre><code class="cpp hljs">...
<span class="hljs-built_in">std</span>::<span class="hljs-keyword">atomic_bool</span> is_running; <span class="hljs-comment">// global</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">terminate_node</span><span class="hljs-params">(std_srvs::Empty::Request &amp;req, std_srvs::Empty::Response &amp;ignored)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{<font></font>
    is_running = <span class="hljs-literal">true</span>;<font></font>
    ...<font></font>
    <span class="hljs-keyword">while</span> (is_running &amp;&amp; ros::ok()) {
        <span class="hljs-comment">// do stuff</span><font></font>
    }<font></font>
    ...<font></font>
}<font></font>
</code></pre><br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El nodo tiene una variable global </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cuyo valor determina el ciclo principal del nodo. El servicio simplemente restablece esta variable y se interrumpe el bucle principal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n hay un nodo principal </font></font><code>beggar_bot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el que se implementa la l√≥gica b√°sica del robot. Antes del inicio del bucle principal, se suscribe a temas </font></font><code>sensor_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guarda el contenido de los mensajes en variables globales en las funciones de devoluci√≥n de llamada. Tambi√©n est√° suscrito al tema </font></font><code>terminator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cuya devoluci√≥n de llamada restablece el indicador </font></font><code>is_running</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e interrumpe el bucle principal. Adem√°s, antes de que comience el ciclo, el nodo anuncia las interfaces para los servicios del servo nodo y espera unos segundos a que se inicien los otros nodos. Despu√©s de que finaliza el bucle principal, este nodo llama a los servicios</font></font><code>terminate_{switch, camera, sensor, servo}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apagando todos los dem√°s nodos y luego apag√°ndolo a s√≠ mismo. Es decir, cuando el interruptor est√° apagado, los cinco nodos completan la operaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cambiar a ROS me oblig√≥ a cambiar bastante la estructura del programa. Por ejemplo, antes era posible cambiar la velocidad de la rueda con una frecuencia alta, y esto funcion√≥ bien, pero el servicio ROS funciona un orden de magnitud m√°s lento, por lo que tuve que volver a escribir el c√≥digo para que se llamara al servicio solo cuando la velocidad realmente cambia (en "modo perezoso"). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ROS tambi√©n le permite ejecutar de manera bastante conveniente todos los nodos del robot. Para hacer esto, debe escribir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un archivo de lanzamiento .launch que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enumere todos los nodos y otros atributos del robot en formato xml, y luego ejecute el comando:</font></font><br>
<br>
<pre><code class="plaintext hljs">roslaunch beggar_bot robot.launch</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ROS vs. pthread</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ahora, finalmente, puede comparar la velocidad de la versi√≥n ROS y la versi√≥n pthread. </font><font style="vertical-align: inherit;">Lo hago de esta manera: el hilo / nodo responsable de trabajar con la c√°mara considera su FPS (como el elemento m√°s lento), siempre que todo lo dem√°s tambi√©n funcione. </font><font style="vertical-align: inherit;">Para la versi√≥n pthread, constantemente recib√≠ FPS 9.99 m√°s o menos, para la versi√≥n ROS result√≥ aproximadamente 8.3. </font><font style="vertical-align: inherit;">De hecho, esto es suficiente para tal juguete, pero la sobrecarga es bastante notable.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comportamiento del robot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea es bastante simple: si el robot ve a una persona, debe conducir hacia √©l y agitar la lata. Agitar el frasco es bastante simple y divertido, pero primero debes llegar a la persona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe una funci√≥n </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que, si hay una cara en el marco, gira el chasis y la cabeza del robot en su direcci√≥n (solo se tiene en cuenta la cara m√°s cercana al centro). Esto es necesario para que el robot siempre siga su curso en una persona, si est√° en el marco, y tambi√©n mire directamente a la cara cuando agite un frasco. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La </font></font><code>camera_state</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">misma variable se utiliza </font><font style="vertical-align: inherit;">para sincronizar esta funci√≥n con el tema </font><font style="vertical-align: inherit;">.</font></font><code>face_processed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, como en la versi√≥n con secuencias. La idea es la misma: queremos procesar datos solo una vez, porque el robot est√° en constante movimiento. La funci√≥n primero espera hasta que la devoluci√≥n de llamada del tema con las detecciones baje el indicador de que se ha procesado el √∫ltimo fotograma. Mientras espera, llama constantemente </font></font><code>ros::spinOnce()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para recibir nuevos mensajes (en general, esto debe hacerse siempre que el programa espere nuevos datos). Si hay una cara en el marco, se calculan los √°ngulos, que deben rotar la plataforma y la cabeza, esto se puede hacer conociendo las coordenadas relativas del centro de la cara y el campo de visi√≥n de la c√°mara horizontal y verticalmente. Despu√©s de eso, puede llamar al servicio </font></font><code>servo_head_platform</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y mover el robot.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un punto sutil: la informaci√≥n sobre la posici√≥n de la cara se retrasa detr√°s del movimiento real de la cara y puede retrasarse respecto de los movimientos del propio robot. Por lo tanto, el robot puede sobreestimar el √°ngulo de rotaci√≥n, por lo que la cabeza comienza a moverse hacia adelante y hacia atr√°s con una amplitud creciente. Para evitar esto, hago retrasos despu√©s del movimiento (300 ms), y tambi√©n omito un cuadro despu√©s del movimiento. Para el mismo prop√≥sito, los √°ngulos de rotaci√≥n del chasis y la cabeza se multiplican por un factor de 0.8 (los componentes P del </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controlador PID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tienen sentido </font><font style="vertical-align: inherit;">). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Funci√≥n</font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devuelve el estado de una persona. </font><font style="vertical-align: inherit;">Una persona puede: estar ausente, estar lo suficientemente cerca del centro, estar demasiado lejos del robot; </font><font style="vertical-align: inherit;">otra opci√≥n: cuando giramos el robot y no sabemos qu√© pas√≥ con la cara (en el proceso de b√∫squeda); </font><font style="vertical-align: inherit;">Todav√≠a hay un caso raro cuando la cabeza est√° en el borde, por lo que es imposible voltear hacia la cara. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algo bastante simple sucede en el bucle principal:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Llame </font></font><code>follow_face</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasta que la persona tenga un cierto estado (cualquiera, excepto "en el proceso de b√∫squeda"). </font><font style="vertical-align: inherit;">Al final de este paso, el robot mirar√° directamente a la cara.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si se encuentra la cara y est√° cerca: </font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agite la lata;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encuentra la cara otra vez;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la cara est√° en su lugar, haga una buena expresi√≥n con las cejas y agite el frasco nuevamente;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si la cara ha desaparecido, haga una expresi√≥n enojada con las cejas;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Date la vuelta, ve al comienzo del ciclo.</font></font></li>
</ol><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no hay una persona (o est√° muy lejos), navegue por la habitaci√≥n:</font></font><br>
 <ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si hay lejos de obst√°culos en ambos lados, conduzca hacia adelante (si se encontr√≥ la cara, pero result√≥ estar demasiado lejos, el robot ir√° hacia la persona);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si los obst√°culos est√°n cerca en ambos lados, haga un giro aleatorio en el rango </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el obst√°culo est√° solo en un lado, gire en la direcci√≥n opuesta en un √°ngulo aleatorio </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.815ex" height="2.634ex" viewBox="0 -809.3 2503.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5D" x="2225" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">[0, 90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el movimiento hacia adelante contin√∫a durante demasiado tiempo (posiblemente atascado), retroceda un poco y gire al azar en el rango </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy=&quot;false&quot;>]</mo><mo>&amp;#x222A;</mo><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>180</mn><mo>,</mo><mo>&amp;#x2212;</mo><mn>90</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.479ex" height="2.634ex" viewBox="0 -809.3 9678.3 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2C" x="1279" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5D" x="3226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-222A" x="3726" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5B" x="4616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2212" x="4895" y="0"></use><g transform="translate(5673,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-38" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2C" x="7175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-2212" x="7620" y="0"></use><g transform="translate(8398,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-39"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/500150/&amp;usg=ALkJrhiMqDE1eEU4LQG63YBKsPvhk6ALhQ#MJMAIN-5D" x="9399" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>90</mn><mo>,</mo><mn>180</mn><mo stretchy="false">]</mo><mo>‚à™</mo><mo stretchy="false">[</mo><mo>‚àí</mo><mn>180</mn><mo>,</mo><mo>‚àí</mo><mn>90</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">[90, 180] \cup [-180, -90]</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font></font></li>
</ol><br>
 </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este algoritmo no pretende ser una inteligencia artificial fuerte, sin embargo, el comportamiento aleatorio y un parachoques ancho permiten que el robot salga de casi cualquier posici√≥n, tarde o temprano.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pesar de su aparente simplicidad, este proyecto cubre muchos temas no triviales: trabajar con sensores anal√≥gicos, trabajar con PWM, visi√≥n por computadora, coordinaci√≥n de tareas asincr√≥nicas. </font><font style="vertical-align: inherit;">Adem√°s, es incre√≠blemente divertido. </font><font style="vertical-align: inherit;">Probablemente, adem√°s har√© algo m√°s significativo, pero m√°s con un sesgo en el aprendizaje profundo. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como beneficio adicional, la galer√≠a:</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/el/cw/jd/elcwjdoa21liogjvhakstzg-yru.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/il/12/fp/il12fpucbbreblnwyb2ojwsfmwu.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/3w/kr/7m/3wkr7mfjqjo2b_f9kvekia82ztq.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/z4/3q/wr/z43qwrmlfgwndbi3dw-jnvxzqew.jpeg"></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es500140/index.html">"Hasta 10 mil": m√°s de 25 rese√±as de auriculares</a></li>
<li><a href="../es500142/index.html">Gestionar derechos a nivel de instalaci√≥n</a></li>
<li><a href="../es500144/index.html">David O'Brien (Xirus): ¬°M√©tricas! ¬°M√©trica! ¬°M√©trica! Parte 1</a></li>
<li><a href="../es500146/index.html">B√∫squeda de empleo en Alemania como gerente de producto y m√°s. Parte 3/5. Lo que debe hacer antes de comenzar a enviar CV</a></li>
<li><a href="../es500148/index.html">Filtro de firewall Mikrotik: script que genera la base para una pol√≠tica de filtrado</a></li>
<li><a href="../es500152/index.html">C√≥mo integr√© POS-terminal y FR IKKM-Touch en 1C: empresa</a></li>
<li><a href="../es500154/index.html">Aprendizaje autom√°tico confidencial. Biblioteca PySyft</a></li>
<li><a href="../es500158/index.html">Interacci√≥n de SwiftUI con Redux</a></li>
<li><a href="../es500160/index.html">Elementos visuales</a></li>
<li><a href="../es500162/index.html">Gran tutorial de procesamiento de datos deportivos de Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>