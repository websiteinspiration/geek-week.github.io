<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚨 🤳🏾 ✋🏿 SAST sempurna. Parser 🤜🏽 🖨️ 😨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Serangkaian artikel dikhususkan untuk menggambarkan pendekatan optimal untuk mengimplementasikan alat analisis kode statis, yang dirancang untuk spesi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>SAST sempurna. Parser</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/487716/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Serangkaian artikel dikhususkan untuk menggambarkan pendekatan optimal untuk mengimplementasikan alat analisis kode statis, yang dirancang untuk spesialis. </font><font style="vertical-align: inherit;">Tujuan dari pekerjaan ini adalah pendekatan, model, dan teknik untuk mendapatkan kinerja alat yang maksimal sambil meminimalkan kerumitan dalam mengembangkan dan mendukung / mengubah alat tersebut. </font><font style="vertical-align: inherit;">Artikel ini membahas cara untuk mempercepat pengurai dan mengurangi konsumsi memori. </font><font style="vertical-align: inherit;">Artikel ini disusun sehingga pembaca membaca manual yang ditulis oleh Terrence Parr.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan ANTLR secara maksimal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ANTLR berfungsi dengan baik antara 1 kb dan 10 kb, file yang lebih besar tidak akan diuraikan oleh pustaka ini dengan kecepatan maksimum. </font><font style="vertical-align: inherit;">Juga pekerjaan debug pada file besar menjadi hampir tidak mungkin. </font><font style="vertical-align: inherit;">Alasan utama mengapa Anda perlu menyimpan data input untuk parser dalam batas yang ditentukan adalah bahwa algoritma prediksi cabang untuk ANTLR secara aktif menggunakan stack, jadi dengan cara apa pun Anda perlu menyingkirkan loop dalam tata bahasa ketika satu aturan menyebut dirinya sendiri melalui banyak aturan lain, termasuk tertentu kondisi aktivasi untuk koneksi seperti itu, pertimbangkan sebuah contoh:</font></font><br>
<br>
<pre><code class="plaintext hljs">var f = fun a(b) { b = 10; return b; }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode ini dapat dijelaskan dengan tata bahasa berikut:</font></font><br>
<br>
<pre><code class="plaintext hljs">start: stmt* EOF;<font></font>
stmt: varDecl | funDecl | expr ';' | 'return' expr ';';<font></font>
varDecl: 'var' id '=' expr;<font></font>
expr: id ('=' expr)? | number;<font></font>
funDecl: 'fun' id '(' id* ')' '{' stmt* '}'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat mudah untuk melihat bahwa stmt disebut di dalam aturan funDecl, yang membentuk sebuah loop yang dalam aplikasi nyata dapat menyebabkan file 100 kb memerlukan tumpukan RAM 4 GB untuk kinerja maksimum, atau bahkan kemampuan untuk bekerja, yang merupakan situasi yang sama sekali tidak dapat diterima . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Salah satu cara untuk mengatasi kelemahan ini adalah dengan menambahkan modifikasi khusus dalam proses pembuatan token, yaitu, konvolusi blok {} menjadi token, dengan pemrosesan token ini nanti dalam parser baru, ke input yang token yang diciutkan akan ditransmisikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, di ANTLR Anda dapat mengganti metode org.antlr.v4.runtime.Lexer # nextToken dari lexer, di mana Anda dapat mengimplementasikan fungsi konvolusi:</font></font><br>
<br>
<pre><code class="scala hljs">  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nextToken</span></span>(): <span class="hljs-type">Token</span> = <span class="hljs-keyword">super</span>.nextToken() <span class="hljs-keyword">match</span> {
      <span class="hljs-keyword">case</span> x: <span class="hljs-type">RScanToken</span> <span class="hljs-keyword">if</span> x.getType == foldOpen =&gt; buildFoldToken(x)
      <span class="hljs-keyword">case</span> x: <span class="hljs-type">Token</span> =&gt; x<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">buildFoldToken</span></span>(start: <span class="hljs-type">RScanToken</span>): <span class="hljs-type">RScanToken</span> = {
    <span class="hljs-keyword">val</span> (token, list) = createFoldBlockBody(<font></font>
      mutable.<span class="hljs-type">MutableList</span>[<span class="hljs-type">RScanToken</span>]()<font></font>
        ++ <span class="hljs-type">List</span>(start.asInstanceOf[<span class="hljs-type">RScanToken</span>])<font></font>
    )<font></font>
    <span class="hljs-keyword">val</span> result = <span class="hljs-keyword">new</span> <span class="hljs-type">RScanToken</span>(path, _tokenFactorySourcePair, foldBlock, <span class="hljs-type">Lexer</span>.<span class="hljs-type">DEFAULT_TOKEN_CHANNEL</span>, start.getStartIndex, token.getStopIndex)<font></font>
    result.setLine(start.getLine)<font></font>
    result.setCharPositionInLine(start.getCharPositionInLine)<font></font>
    result.setFoldedTokens(list)<font></font>
    result<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">createFoldBlockBody</span></span>(list: mutable.<span class="hljs-type">MutableList</span>[<span class="hljs-type">RScanToken</span>]): (<span class="hljs-type">RScanToken</span>, mutable.<span class="hljs-type">MutableList</span>[<span class="hljs-type">RScanToken</span>]) = {
    <span class="hljs-keyword">var</span> current: <span class="hljs-type">RScanToken</span> = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">while</span> (current == <span class="hljs-literal">null</span> || current.getType != <span class="hljs-type">Token</span>.<span class="hljs-type">EOF</span> &amp;&amp; current.getType != foldClose) {<font></font>
      current = nextToken().asInstanceOf[<span class="hljs-type">RScanToken</span>]<font></font>
      list += current<font></font>
    }<font></font>
    <span class="hljs-keyword">if</span> (current.getType == <span class="hljs-type">Token</span>.<span class="hljs-type">EOF</span>)
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">IllegalStateException</span>()<font></font>
    (current, list)<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tata bahasa harus dilengkapi dengan:</font></font><br>
<br>
<pre><code class="plaintext hljs">startJavaScript <font></font>
    :   HashBangLine? jsFileBody? EOF<font></font>
    ;<font></font>
<font></font>
startFoldBlock<font></font>
   :   block EOF<font></font>
   ;<font></font>
<font></font>
block<font></font>
    :   LBRACE stmtList? RBRACE<font></font>
    |   FoldBlock <font></font>
//     ,<font></font>
//     startFoldBlock<font></font>
    ;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dengan pendekatan ini, isi konvolusi tidak akan diproses sekali lagi, karena algoritma rekursif akan menyerap token dan menyimpannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kecepatan pemrosesan tumbuh dari 2 menjadi 10 kali, perbedaannya menjadi sangat nyata pada file js yang diperkecil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dampak pada operasi ANTLR dari optimasi yang diusulkan menggunakan beberapa file javascript sebagai contoh:</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengajukan</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ukuran kb</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebelum optimasi, ms</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah optimasi, ms</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menormalkan-dan-memuat-metadata.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1839</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1372</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rewrite-live-Reference.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">899</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">528</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dom.umd.min.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">130</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43852</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6607</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">react.pure.umd.min.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51668</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6495</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tsserver.js</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8151</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">362857</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">117787</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tanpa optimasi, pekerjaan dilakukan dalam satu utas, dengan optimasi, jika mungkin, pemrosesan paralel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peluncuran ini dilakukan pada mesin dengan RAM 64 GB, Intel® Core (TM) i7-9700K CPU @ 3,60GHz, OpenJDK Runtime Environment AdoptOpenJDK (build 11.0.4 + 11). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kunci startup JVM: -Xmx4G -XX: + UseG1GC -XX: MaxHeapFreeRatio = 30 -XX: MinHeapFreeRatio = 10 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk file tsserver.js, kuncinya adalah -Xmx32G, sementara konsumsi memori telah mencapai 22 GB! </font><font style="vertical-align: inherit;">Sementara file yang diperkecil hingga 200 kb dengan optimisasi dianalisis dengan batas tumpukan 128 mb dalam mode paralel tanpa perlu pengumpul sampah untuk memuat prosesor, maksimum 2%!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembuatan profil</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ANTLR mendukung pembuatan profil parser / lexer dalam runtime. Untuk mengaktifkannya, Anda perlu memanggil metode: org.antlr.v4.runtime.Parser # setProfile sebelum aturan dijalankan. </font><font style="vertical-align: inherit;">Maka Anda bisa mendapatkan semua informasi, misalnya dengan cara ini:</font></font><br>
<br>
<pre><code class="scala hljs">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printProfileInfo</span></span>(parser: <span class="hljs-type">AbstractRScanParser</span>, tokenStream: <span class="hljs-type">TokenStream</span>): <span class="hljs-type">Unit</span> = {
      <span class="hljs-comment">// do the actual parsing</span>
      <span class="hljs-keyword">val</span> parseInfo = parser.getParseInfo
      <span class="hljs-keyword">val</span> atn = parser.getATN
      <span class="hljs-keyword">for</span> (di &lt;- parseInfo.getDecisionInfo <span class="hljs-keyword">if</span> di.ambiguities.size() &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">val</span> ds = atn.decisionToState.get(di.decision)
        <span class="hljs-keyword">val</span> ruleName = parser.ruleName(ds.ruleIndex)<font></font>
        log.debug(<span class="hljs-string">"Ambiguity in rule '"</span> + ruleName + <span class="hljs-string">"' -&gt; {}"</span>, di)<font></font>
        log.debug(<span class="hljs-string">"========================="</span>)<font></font>
        log.debug(tokenStream.getText)<font></font>
        log.debug(<span class="hljs-string">"========================="</span>)<font></font>
      }<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nilai tambah yang jelas dengan metode ini adalah pengurangan jumlah data yang perlu Anda analisis, karena konvolusi dapat diganti dengan {} dan selalu bekerja dalam konvolusi lokal, yang sangat mempercepat proses optimalisasi tata bahasa.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini mengusulkan metode untuk mengoptimalkan kerja tata bahasa formal yang dilaksanakan menggunakan perpustakaan ANTLR, meskipun pendekatan itu sendiri dapat dicoba untuk diterapkan ke perpustakaan lain juga. Fitur optimasi adalah pengurangan jumlah transisi ke depan untuk memvalidasi aliran token input. Ini juga memungkinkan Anda untuk menganalisis file besar (lebih dari 1 mb) dengan biaya memori 512 mb untuk pemrosesan single-threaded, sementara kurangnya optimasi akan membutuhkan 50 kali lebih banyak memori untuk bekerja cepat menggunakan tata bahasa yang sama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode sumber tersedia di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Proyek ini dibuat untuk menunjukkan pekerjaan optimasi. Proyek ini disederhanakan sebanyak mungkin, disarankan untuk memulai studi di kelas GrammarTester, konfigurasi peluncuran telah dibuat untuk itu, Anda hanya perlu mendaftarkan jalur ke folder dengan data input. Perhatikan kunci rscan.tester.cache.dir, file sementara akan ditulis ke folder ini, analisis file yang berhasil diperbaiki dalam folder ini dan tidak akan membiarkan parser menganalisisnya untuk kedua kalinya - nyaman untuk memperbaiki kesalahan. Saat ini, tata bahasa telah diuji pada 17 ribu file dari node_modules yang dibuat untuk aplikasi reaksi inti. Hanya node_modules bersarang yang diabaikan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel berikutnya, kami akan mempertimbangkan opsi untuk mengatur data dan model R (Reflection) untuk representasi optimal dari sumber data sebagai objek analisis dengan konsumsi memori minimal, kemampuan untuk mengimplementasikan algoritma pencarian untuk elemen dengan kompleksitas O (1), dan dapat menyimpan ke disk dalam bentuk serial. semua objek, serta bagian unit pengujian alat.</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id487696/index.html">Acara digital di Moskow dari 10 hingga 16 Februari</a></li>
<li><a href="../id487698/index.html">Acara digital di St. Petersburg dari 10 hingga 16 Februari</a></li>
<li><a href="../id487702/index.html">Pilihan artikel tentang pembelajaran mesin: studi kasus, panduan dan penelitian untuk Januari 2020</a></li>
<li><a href="../id487704/index.html">Bagaimana kami membuat laporan dinamis di SSRS 2014</a></li>
<li><a href="../id487706/index.html">Service Discovery dalam sistem terdistribusi menggunakan contoh Konsul. Alexander Sigachev</a></li>
<li><a href="../id487720/index.html">Tentang persaingan ketat (menggunakan pemrograman reaktif sebagai contoh)</a></li>
<li><a href="../id487724/index.html">BlazingPizza: Aplikasi Blazor dari awal hingga akhir. Bagian 2. Tambahkan komponen</a></li>
<li><a href="../id487728/index.html">@Pythonetc kompilasi, Januari 2020</a></li>
<li><a href="../id487730/index.html">Pemrosesan Bahasa Alami. Hasil 2019 dan tren untuk 2020</a></li>
<li><a href="../id487734/index.html">Mempercepat Inti Kerangka Entitas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>