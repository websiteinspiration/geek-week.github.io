<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚂 🧖🏻 🐒 Bagaimana kami melakukan inti bisnis investasi Alfa-Bank berdasarkan Tarantool 🕡 🆕 🔤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bidikan dari film "Our Secret Universe: The Hidden Life of the Cell"
 
 Bisnis investasi adalah salah satu bidang yang paling sulit di dunia perbankan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami melakukan inti bisnis investasi Alfa-Bank berdasarkan Tarantool</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/495326/"><img src="https://habrastorage.org/webt/tc/or/26/tcor26cmqrsph9b0nioj_ic4cwa.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bidikan dari film "Our Secret Universe: The Hidden Life of the Cell"</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bisnis investasi adalah salah satu bidang yang paling sulit di dunia perbankan, karena tidak hanya pinjaman, pinjaman dan simpanan, tetapi juga sekuritas, mata uang, barang, turunan dan segala macam kesulitan dalam bentuk produk struktural.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baru-baru ini, kita telah melihat peningkatan literasi keuangan populasi. Semakin banyak orang terlibat dalam perdagangan di pasar sekuritas. Akun investasi individu muncul belum lama ini. Mereka memungkinkan Anda untuk berdagang di pasar sekuritas dan pada saat yang sama menerima potongan pajak atau tidak membayar pajak. Dan semua pelanggan yang datang kepada kami ingin mengelola portofolio mereka dan melihat pelaporan waktu nyata. Selain itu, paling sering portofolio ini adalah multi-produk, yaitu, orang adalah pelanggan dari berbagai lini bisnis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, persyaratan regulator, baik Rusia maupun asing, semakin meningkat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk memenuhi kebutuhan saat ini dan meletakkan dasar untuk peningkatan di masa depan, kami telah mengembangkan inti dari bisnis investasi berdasarkan Tarantool.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beberapa statistik. </font><font style="vertical-align: inherit;">Bisnis investasi Alfa-Bank menyediakan layanan broker untuk perorangan dan badan hukum untuk memberikan peluang perdagangan di berbagai pasar sekuritas, layanan penyimpanan untuk penyimpanan sekuritas, layanan manajemen kepercayaan untuk individu dengan modal besar dan swasta, layanan penerbitan sekuritas untuk perusahaan lain. </font><font style="vertical-align: inherit;">Bisnis investasi Alfa-Bank lebih dari 3 ribu penawaran per detik, yang diunduh dari berbagai platform perdagangan. </font><font style="vertical-align: inherit;">Selama hari kerja, lebih dari 300 ribu transaksi diselesaikan di pasar atas nama bank atau pelanggannya. </font><font style="vertical-align: inherit;">Pada platform eksternal dan internal, hingga 5 ribu pesanan dieksekusi per detik. </font><font style="vertical-align: inherit;">Pada saat yang sama, semua pelanggan, baik internal maupun eksternal, ingin melihat posisi mereka secara real time.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Latar Belakang</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di suatu tempat dari awal tahun 2000-an, bidang bisnis investasi kami telah berkembang secara independen: perdagangan pertukaran, layanan perantara, perdagangan mata uang, perdagangan bebas di sekuritas dan berbagai derivatif. Akibatnya, kami jatuh ke dalam perangkap sumur fungsional. Apa itu? Setiap lini bisnis memiliki sistem sendiri yang menduplikasi fungsi masing-masing. Setiap sistem memiliki model datanya sendiri, meskipun mereka beroperasi pada konsep yang sama: transaksi, instrumen, rekanan, penawaran dan banyak lagi. Dan karena setiap sistem dikembangkan secara independen, beragam kebun binatang teknologi muncul. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, basis kode sistem sudah usang, karena beberapa produk berasal pada pertengahan 1990-an. Dan di beberapa daerah, memperlambat proses pengembangan, ada masalah dengan produktivitas.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persyaratan Solusi Baru</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisnis menyadari bahwa pengembangan teknologi sangat penting untuk pengembangan lebih lanjut. </font><font style="vertical-align: inherit;">Kami diberi tugas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kumpulkan semua data bisnis dalam satu penyimpanan cepat dan dalam model data tunggal. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami tidak boleh kehilangan atau mengubah informasi ini. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diperlukan versi data, karena setiap saat regulator dapat meminta statistik untuk tahun-tahun sebelumnya. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kita seharusnya tidak hanya membawa beberapa DBMS baru yang modis, tetapi menciptakan platform untuk memecahkan masalah bisnis. </font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, arsitek kami menetapkan kondisinya: </font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi baru harus kelas perusahaan, yaitu harus sudah diuji di beberapa perusahaan besar. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cara pengoperasian solusi harus kritis misi. </font><font style="vertical-align: inherit;">Ini berarti bahwa kita harus hadir pada saat yang sama di beberapa pusat data dan dengan tenang mengalami pemutusan satu pusat data.</font></font></li>
<li>    .   ,        ,       -    .   ,         . </li>
<li>    ,     . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan cara standar: merumuskan persyaratan dan menghubungi departemen pengadaan. Dari sana kami mendapat daftar perusahaan yang, secara umum, siap untuk kami lakukan. Mereka memberi tahu semua orang tentang tugas itu, dan enam dari mereka menerima penilaian solusi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami di bank tidak percaya dengan kata-kata siapa pun, kami senang menguji semuanya sendiri. Karena itu, prasyarat kompetisi tender kami adalah lulus tes stres. Kami merumuskan tugas pengujian untuk beban, dan sudah tiga dari enam perusahaan sepakat dengan biaya mereka sendiri untuk mengimplementasikan prototipe solusi berdasarkan pada teknologi dalam memori untuk mengujinya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan memberi tahu bagaimana kami menguji semuanya dan berapa lama, saya hanya akan meringkas: kinerja terbaik dalam uji beban ditunjukkan oleh prototipe solusi berbasis Tarantool dari tim pengembangan Grup Mail.ru. </font><font style="vertical-align: inherit;">Kami menandatangani kontrak dan memulai pengembangan. </font><font style="vertical-align: inherit;">Empat orang berasal dari Mail.ru Group, dan dari Alfa-Bank ada tiga pengembang, tiga analis sistem, arsitek solusi, pemilik produk, dan master Scrum. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, saya akan berbicara tentang bagaimana sistem kami tumbuh, bagaimana itu berkembang, apa yang kami lakukan dan mengapa.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengembangan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pertama-tama, kami bertanya-tanya bagaimana cara mendapatkan data dari sistem kami saat ini. Kami memutuskan bahwa HTTP cukup cocok untuk kami, karena semua sistem saat ini berkomunikasi satu sama lain, mengirimkan XML atau JSON melalui HTTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menggunakan server HTTP Tarantool bawaan, karena kami tidak perlu mengakhiri sesi SSL, dan kinerjanya cukup bagi kami.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang sudah saya katakan, kita memiliki semua sistem yang hidup dalam model data yang berbeda, dan pada input kita perlu membawa objek ke model yang akan kita gambarkan di rumah. Diperlukan bahasa untuk mengubah data. Kami memilih Lua imperatif. Kami menjalankan semua kode untuk konversi data di kotak pasir - ini adalah tempat yang aman, di luar itu kode yang berjalan tidak melampaui. Untuk melakukan ini, cukup lakukan loadstring dari kode yang diperlukan, menciptakan lingkungan dengan fungsi yang tidak dapat memblokir apa pun atau menjatuhkan sesuatu.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e3/04c/45f/4e304c45ff56974d624be577ebb8258d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah konversi, data harus diperiksa untuk kesesuaian dengan model yang kami buat. </font><font style="vertical-align: inherit;">Kami sudah lama berdiskusi tentang model apa, bahasa apa yang digunakan untuk menggambarkannya. </font><font style="vertical-align: inherit;">Kami berhenti di Apache Avro, karena bahasanya sederhana dan mendapat dukungan dari Tarantool. </font><font style="vertical-align: inherit;">Versi baru model dan kode pengguna dapat dioperasikan beberapa kali sehari, bahkan di bawah beban, bahkan tanpa, kapan saja, dan sangat cepat beradaptasi dengan perubahan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d28/172/bea/d28172beab19e37ef1fd30597d21d321.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah verifikasi, data harus disimpan. </font><font style="vertical-align: inherit;">Kami melakukan ini dengan vshard (kami memiliki replika pecahan geo-spaced).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5a/619/7b4/d5a6197b44b2d8f1f43b33004241f221.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, spesifikasinya sedemikian rupa sehingga bagi sebagian besar sistem yang mengirimkan data kepada kami, tidak masalah apakah kami menerimanya atau tidak. Karena itu, sejak awal kami menerapkan jalur perbaikan. Apa itu? Jika karena alasan tertentu objek tidak lulus transformasi data atau verifikasi, maka kami masih mengkonfirmasi tanda terima, tetapi pada saat yang sama kami menyimpan objek dalam antrian perbaikan. Itu konsisten, terletak di repositori utama dengan data bisnis. Kami segera menulis antarmuka admin untuk itu, berbagai metrik, dan peringatan. Akibatnya, kami tidak kehilangan data. Bahkan jika sesuatu telah berubah di sumbernya, jika model data telah berubah, kami akan segera menemukannya dan dapat beradaptasi.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ad/2a7/c23/7ad2a7c235467068ccec89b9eb025b12.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda perlu belajar cara mengambil data yang tersimpan. Kami dengan hati-hati menganalisis sistem kami dan melihat bahwa pada tumpukan klasik dari Java dan Oracle selalu ada semacam ORM yang mengubah data dari tampilan relasional ke objek. Jadi mengapa tidak segera memberikan objek ke sistem dalam bentuk grafik? Karena itu, kami dengan senang hati mengambil GraphQL, yang memenuhi semua kebutuhan kami. Ini memungkinkan Anda untuk menerima data dalam bentuk grafik, hanya untuk menarik apa yang Anda butuhkan saat ini. Anda bahkan dapat membuat versi API dengan fleksibilitas yang cukup.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d90/636/a7a/d90636a7ac34c91eefd299a88d902d44.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hampir segera, kami menyadari bahwa data yang diekstraksi tidak cukup bagi kami. </font><font style="vertical-align: inherit;">Kami membuat fungsi yang dapat dilampirkan ke objek dalam model - pada kenyataannya, bidang yang dihitung. </font><font style="vertical-align: inherit;">Artinya, kami melampirkan fungsi tertentu ke bidang, yang, misalnya, mempertimbangkan harga rata-rata penawaran. </font><font style="vertical-align: inherit;">Dan konsumen eksternal yang meminta data bahkan tidak tahu bahwa bidang ini dihitung.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f77/51f/ce9/f7751fce9a424fa80aba0c701cb9295e.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menerapkan sistem otentikasi. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/768/d24/2f7/768d242f7825460594a79ff0c3e07449.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kemudian mereka memperhatikan bahwa beberapa peran mengkristal dalam solusi kami. </font><font style="vertical-align: inherit;">Peran adalah sejenis agregator fungsi. </font><font style="vertical-align: inherit;">Sebagai aturan, peran memiliki profil penggunaan peralatan yang berbeda:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T-Connect: menangani koneksi yang masuk, dibatasi oleh prosesor, menghabiskan sedikit memori, tidak menyimpan status.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IB-Core: mengubah data yang diterimanya melalui protokol Tarantool, yaitu, beroperasi dengan tablet. </font><font style="vertical-align: inherit;">Juga tidak menyimpan status dan dapat diskalakan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyimpanan: hanya menyimpan data, tidak menggunakan logika apa pun. </font><font style="vertical-align: inherit;">Antarmuka paling sederhana diimplementasikan dalam peran ini. </font><font style="vertical-align: inherit;">Terukur berkat vshard.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/292/66e/613/29266e613da2a34c5df9463884873267.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yaitu, dengan bantuan peran, kami melepaskan ikatan satu sama lain dari bagian berbeda dari gugus yang dapat ditingkatkan secara independen satu sama lain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami membuat catatan asinkron dari aliran data transaksional dan antrian perbaikan dengan antarmuka administrator. </font><font style="vertical-align: inherit;">Perekaman tidak sinkron dari sudut pandang bisnis: jika kami dijamin untuk merekam data kepada diri kami sendiri, di mana pun, maka kami akan mengonfirmasi hal ini. </font><font style="vertical-align: inherit;">Jika tidak dikonfirmasi, maka ada yang tidak beres, data perlu dikirim. </font><font style="vertical-align: inherit;">Ini adalah rekaman asinkron.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengujian</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sejak awal proyek diputuskan bahwa kami akan mencoba menanamkan pengembangan yang digerakkan oleh pengujian. Kami menulis tes unit dalam Lua menggunakan kerangka tarantool / tap, tes integrasi dengan Python menggunakan kerangka pytest. Pada saat yang sama, baik pengembang dan analis terlibat dalam penulisan tes integrasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana kita menerapkan pengembangan yang digerakkan oleh tes? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kita menginginkan beberapa fitur baru, pertama-tama kita mencoba menulis tes untuk itu. Setelah menemukan bug, pertama-tama kita harus menulis tes, dan baru kemudian memperbaikinya. Pada awalnya, sulit untuk bekerja seperti itu, ada kesalahpahaman di pihak karyawan, bahkan sabotase: "Mari kita perbaiki dengan cepat, lakukan sesuatu yang baru, dan kemudian tutup dengan tes." Hanya ini "nanti" hampir tidak pernah terjadi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena itu, pertama-tama Anda harus memaksakan diri untuk menulis tes, meminta orang lain untuk melakukannya. Percayalah, pengembangan yang digerakkan oleh tes bermanfaat bahkan dalam jangka pendek. Anda akan merasa bahwa hidup Anda menjadi lebih mudah. Menurut perasaan kami, 99% kode dilindungi oleh tes sekarang. Sepertinya banyak, tapi kami tidak punya masalah: tes dijalankan pada setiap komit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, yang paling penting dari kami adalah stress testing, kami menganggapnya yang paling penting dan secara teratur melakukannya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menceritakan kepada Anda sebuah cerita pendek tentang bagaimana kami melakukan pengujian beban tahap pertama dari salah satu versi pertama. Kami menempatkan sistem pada laptop pengembang, menyalakan beban dan menerima 4 ribu transaksi per detik. Hasil yang bagus untuk laptop. Kami memakai virtual load stand empat server, lebih lemah dari pada produksi. Digunakan seminimal mungkin. Kami memulainya, dan kami mendapatkan hasil yang lebih buruk daripada di laptop dalam satu utas. Konten kejutan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami sangat sedih. Kami melihat beban server, dan ternyata tidak digunakan.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0b/eba/0fa/a0beba0fad0ba7e8f0cf333ef8366948.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami memanggil pengembang, dan mereka menjelaskan kepada kami, orang-orang yang datang dari dunia Java, bahwa Tarantool adalah single-threaded. </font><font style="vertical-align: inherit;">Itu dapat secara efektif digunakan oleh hanya satu inti prosesor yang sedang di-load. </font><font style="vertical-align: inherit;">Kemudian kami menggunakan jumlah maksimum yang mungkin dari instance Tarantool di setiap server, menyalakan beban dan menerima sudah 14,5 ribu transaksi per detik.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67f/8ca/e14/67f8cae14bea588f5018d4406f99c23c.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya akan menjelaskannya lagi. </font><font style="vertical-align: inherit;">Karena pembagian ke peran yang menggunakan sumber daya berbeda, peran kami yang bertanggung jawab untuk memproses koneksi dan transformasi data hanya memuat prosesor, dan itu benar-benar sebanding dengan beban.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d1/822/cb3/9d1822cb3dcacd91f3f9fd7dbb7c9f7c.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/566/1b4/1f05661b4e5b7806867849b060dc23b7.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, memori hanya digunakan untuk memproses koneksi masuk dan objek sementara.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16e/e79/f9f/16ee79f9fbfd6157c7df6edd66b90535.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebaliknya, pada server penyimpanan, beban prosesor tumbuh, tetapi jauh lebih lambat daripada pada server yang menangani koneksi. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18b/0ad/d2d/18b0add2da6deda36388ca9b0f07594b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan konsumsi memori tumbuh dalam proporsi langsung ke jumlah data yang dimuat. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e21/697/e05/e21697e0521f54530aa7c50227297af1.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jasa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengembangkan produk baru kami secara khusus sebagai platform aplikasi, kami membuat komponen untuk menyebarkan layanan dan perpustakaan di atasnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Layanan bukan hanya potongan kecil kode yang beroperasi di beberapa bidang. </font><font style="vertical-align: inherit;">Mereka dapat berupa desain yang cukup besar dan kompleks yang merupakan bagian dari cluster, periksa data referensi, memutar logika bisnis dan memberikan jawaban. </font><font style="vertical-align: inherit;">Kami juga mengekspor skema layanan ke GraphQL, dan konsumen menerima titik akses data universal, dengan introspeksi seluruh model. </font><font style="vertical-align: inherit;">Sangat nyaman.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena layanan mengandung lebih banyak fungsi, kami memutuskan bahwa harus ada perpustakaan tempat kami akan mengeluarkan kode yang sering digunakan. </font><font style="vertical-align: inherit;">Kami menambahkannya ke lingkungan yang aman, setelah memeriksa bahwa ini tidak merusak apa pun bagi kami. </font><font style="vertical-align: inherit;">Dan sekarang kita dapat mengatur fungsi untuk lingkungan tambahan dalam bentuk perpustakaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami ingin kami memiliki platform tidak hanya untuk penyimpanan, tetapi juga untuk komputasi. </font><font style="vertical-align: inherit;">Dan karena kami sudah memiliki banyak replika dan pecahan, kami menerapkan kemiripan komputasi terdistribusi dan menyebutnya sebagai pengurangan peta, karena ternyata itu seperti pengurangan peta asli.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistem lama</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak semua sistem lama kami dapat menghubungi kami melalui HTTP dan menggunakan GraphQL, meskipun mereka mendukung protokol ini. </font><font style="vertical-align: inherit;">Oleh karena itu, kami membuat mekanisme untuk mereplikasi data ke sistem ini.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/6e5/e33/f5d6e5e33b10e605cf7c6c5befd4aa07.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika ada perubahan bagi kami, pemicu khusus berfungsi dalam peran Penyimpanan dan pesan dengan perubahan masuk ke antrean pemrosesan. </font><font style="vertical-align: inherit;">Ini dikirim ke sistem eksternal menggunakan peran replikator yang terpisah. </font><font style="vertical-align: inherit;">Peran ini tidak menyimpan status.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perbaikan baru</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seingat Anda, dari perspektif bisnis, kami membuat rekaman tidak sinkron. </font><font style="vertical-align: inherit;">Tetapi kemudian mereka menyadari bahwa itu tidak akan cukup, karena ada kelas sistem yang perlu segera menerima jawaban tentang status operasi. </font><font style="vertical-align: inherit;">Oleh karena itu, kami telah memperluas GraphQL kami dan menambahkan mutasi. </font><font style="vertical-align: inherit;">Mereka secara organik cocok dengan paradigma yang ada bekerja dengan data. </font><font style="vertical-align: inherit;">Kami memiliki satu titik baik membaca dan menulis untuk kelas sistem lain.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/395/562/ef7/395562ef7191842f4dc9526dae8c0661.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami juga menyadari bahwa layanan saja tidak akan cukup bagi kami, karena ada laporan yang cukup berat yang perlu dibangun sekali sehari, seminggu, sebulan. Ini bisa memakan waktu lama, dan laporan bahkan dapat memblokir loop acara Tarantool. Karenanya, kami membuat peran terpisah: scheduler dan runner. Pelari tidak menyimpan status. Mereka meluncurkan tugas-tugas sulit, yang tidak bisa kita andalkan dengan cepat. Dan peran penjadwal memonitor jadwal untuk meluncurkan tugas-tugas ini, yang dijelaskan dalam konfigurasi. Tugas itu sendiri disimpan di tempat yang sama dengan data bisnis. Ketika waktu yang tepat tiba, scheduler mengambil tugas, memberikannya kepada beberapa pelari, ia mempertimbangkannya dan menyimpan hasilnya.</font></font><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb1/bbf/123/fb1bbf12343d40bab27a87b5f1021f0d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak semua tugas harus dijalankan sesuai jadwal. </font><font style="vertical-align: inherit;">Beberapa laporan harus dibaca sesuai permintaan. </font><font style="vertical-align: inherit;">Begitu persyaratan ini tiba, tugas dibentuk di kotak pasir dan dikirim ke pelari untuk dieksekusi. </font><font style="vertical-align: inherit;">Setelah beberapa saat, pengguna menerima jawaban secara tidak sinkron bahwa semuanya telah dihitung, laporannya siap.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13f/27e/db0/13f27edb0711b735602d77c7c54c4d38.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awalnya, kami berpegang pada paradigma menyimpan semua data, membuat versi dan tidak menghapusnya. </font><font style="vertical-align: inherit;">Namun dalam kehidupan, dari waktu ke waktu, Anda masih harus menghapus sesuatu, terutama beberapa informasi mentah atau perantara. </font><font style="vertical-align: inherit;">Berdasarkan kedaluwarsa, kami membuat mekanisme untuk membersihkan penyimpanan data yang sudah usang.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/1aa/e8d/4d91aae8daf9c27437ca9ed57574e349.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami juga memahami bahwa cepat atau lambat suatu situasi akan datang ketika tidak akan ada cukup ruang untuk menyimpan data dalam memori, namun demikian data tersebut harus disimpan. </font><font style="vertical-align: inherit;">Untuk keperluan ini, kami akan segera membuat penyimpanan disk.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/10e/7da/13a10e7da6c77907d88504ee20fbb62c.jpg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami mulai dengan tugas memuat data ke dalam model tunggal, menghabiskan waktu tiga bulan untuk pengembangannya. Kami memiliki enam sistem penyedia data. Seluruh kode transformasi menjadi model tunggal adalah sekitar 30 ribu baris dalam Lua. Dan sebagian besar pekerjaan belum datang. Kadang-kadang ada kurangnya motivasi untuk tim tetangga, banyak yang menyulitkan pekerjaan keadaan. Jika Anda pernah menghadapi masalah yang sama, maka waktu yang Anda anggap normal untuk implementasinya, kalikan tiga, atau bahkan empat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juga ingat bahwa masalah yang ada dalam proses bisnis tidak dapat diselesaikan dengan bantuan DBMS baru, bahkan jika itu sangat produktif. Apa yang saya maksud? Pada awal proyek kami, kami menciptakan kesan di antara pelanggan bahwa sekarang kami akan membawa database cepat baru dan hidup! Proses akan berjalan lebih cepat, semuanya akan baik-baik saja. Padahal, teknologi tidak menyelesaikan masalah yang ada dalam proses bisnis, karena proses bisnis adalah manusia. Dan Anda perlu bekerja dengan orang, bukan teknologi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengembangan melalui pengujian pada tahap awal dapat menyakitkan dan memakan waktu. Tetapi efek positifnya akan terlihat bahkan dalam jangka pendek, ketika Anda tidak perlu melakukan apa pun untuk melakukan pengujian regresi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sangat penting untuk melakukan pengujian beban di semua tahap pengembangan. Semakin cepat Anda melihat beberapa jenis cacat dalam arsitektur, semakin mudah untuk memperbaikinya, ini akan menghemat banyak waktu di masa depan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak ada yang salah dengan Lua. Siapa pun dapat belajar menulis di atasnya: pengembang Java, pengembang JavaScript, pengembang Python, front-end atau back-end. Kami bahkan memiliki analis yang menuliskannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika kita berbicara tentang fakta bahwa kita tidak memiliki SQL, ini menakutkan orang. "Bagaimana Anda mendapatkan data tanpa SQL?" Apakah itu mungkin? " Tentu saja. Pada sistem kelas OLTP, SQL tidak diperlukan. Ada alternatif dalam bentuk bahasa yang segera mengembalikan Anda tampilan berorientasi dokumen. Misalnya, GraphQL. Dan ada alternatif dalam bentuk komputasi terdistribusi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda memahami bahwa Anda perlu melakukan penskalaan, maka rancang solusi Anda di Tarantool, segera sehingga dapat bekerja secara paralel pada puluhan instance Tarantool. </font><font style="vertical-align: inherit;">Jika tidak, maka akan sulit dan menyakitkan, karena Tarantool dapat secara efisien menggunakan hanya satu inti prosesor.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495310/index.html">Walk-through elektronik: biometrik dan multi-format</a></li>
<li><a href="../id495312/index.html">Keamanan perimeter - masa depan sekarang</a></li>
<li><a href="../id495314/index.html">Bagaimana cara memfilter informasi yang salah jika itu berasal dari sumber resmi?</a></li>
<li><a href="../id495316/index.html">Aturan hidup tim Karir Karantina Habr</a></li>
<li><a href="../id495324/index.html">Menulis generator stok acak Mosbirzhe dalam JavaScript</a></li>
<li><a href="../id495328/index.html">Cara merapikan riwayat komitmen Anda di Git</a></li>
<li><a href="../id495330/index.html">Popularitas yang layak dalam jumlah</a></li>
<li><a href="../id495332/index.html">Kuartet 9: Allegro | TypeScript</a></li>
<li><a href="../id495336/index.html">Perselisihan sebagai messenger perusahaan dan bukan hanya</a></li>
<li><a href="../id495338/index.html">Praktik dan pedoman terbaik untuk meluncurkan kontainer dan Kubernet di lingkungan produksi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>