<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš» ğŸ‘¨ ğŸ‘ Aviasales APIä¸Amazon Kinesisçš„é›†æˆä»¥åŠæ— æœåŠ¡å™¨çš„ç®€å•æ€§ ğŸ³ ğŸ¥˜ ğŸ™ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼
 
 ä½ å–œæ¬¢åé£æœºå—ï¼Ÿæˆ‘å–œæ¬¢å®ƒï¼Œä½†å‡ºäºè‡ªæˆ‘éš”ç¦»ï¼Œæˆ‘ä¹Ÿå–œæ¬¢åˆ†æä¸€ç§è‘—åèµ„æºAviasalesçš„æœºç¥¨æ•°æ®ã€‚
 
 ä»Šå¤©ï¼Œæˆ‘ä»¬å°†åˆ†æAmazon Kinesisçš„å·¥ä½œï¼Œæ„å»ºå…·æœ‰å®æ—¶åˆ†æçš„æµç³»ç»Ÿï¼Œå°†Amazon DynamoDB NoSQLæ•°æ®åº“ä½œä¸ºä¸»è¦æ•°æ®ä»“åº“ï¼Œå¹¶ä¸ºæœ‰è¶£çš„é—¨ç¥¨è®¾ç½®SMSè­¦æŠ¥ã€‚
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Aviasales APIä¸Amazon Kinesisçš„é›†æˆä»¥åŠæ— æœåŠ¡å™¨çš„ç®€å•æ€§</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/500382/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å“ˆHaï¼</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½ å–œæ¬¢åé£æœºå—ï¼Ÿ</font><font style="vertical-align: inherit;">æˆ‘å–œæ¬¢å®ƒï¼Œä½†å‡ºäºè‡ªæˆ‘éš”ç¦»ï¼Œæˆ‘ä¹Ÿå–œæ¬¢åˆ†æä¸€ç§è‘—åèµ„æºAviasalesçš„æœºç¥¨æ•°æ®ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Šå¤©ï¼Œæˆ‘ä»¬å°†åˆ†æAmazon Kinesisçš„å·¥ä½œï¼Œæ„å»ºå…·æœ‰å®æ—¶åˆ†æçš„æµç³»ç»Ÿï¼Œå°†Amazon DynamoDB NoSQLæ•°æ®åº“ä½œä¸ºä¸»è¦æ•°æ®ä»“åº“ï¼Œå¹¶ä¸ºæœ‰è¶£çš„é—¨ç¥¨è®¾ç½®SMSè­¦æŠ¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰ç»†èŠ‚éƒ½ç ä¸‹ï¼</font><font style="vertical-align: inherit;">èµ°ï¼</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/-n/qn/yn/-nqnynmwzv61pmiq2ocatoxseme.jpeg"></div><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»‹ç»</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦è®¿é—®</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviasales API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å…è´¹æä¾›å¯¹å®ƒçš„è®¿é—®ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œæ‚¨åªéœ€è¦åœ¨â€œå¼€å‘äººå‘˜â€éƒ¨åˆ†è¿›è¡Œæ³¨å†Œå³å¯è·å–ç”¨äºè®¿é—®æ•°æ®çš„APIä»¤ç‰Œã€‚</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯æä¾›å¯¹AWSä¸­æµä¿¡æ¯çš„ä½¿ç”¨çš„ä¸€èˆ¬ç†è§£ï¼Œæˆ‘ä»¬æ‘†è„±äº†æ‰€ç”¨APIè¿”å›çš„æ•°æ®å¹¶éä¸¥æ ¼ç›¸å…³ï¼Œè€Œæ˜¯ä»ç¼“å­˜ä¸­ä¼ è¾“çš„é—®é¢˜ï¼Œç¼“å­˜æ˜¯æ ¹æ®Aviasales.ruå’ŒJetradar.comç½‘ç«™ç”¨æˆ·çš„æœç´¢ç”Ÿæˆçš„æŒç»­48å°æ—¶ã€‚ </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡ç”Ÿäº§è€…è®¡ç®—æœºä¸Šå®‰è£…çš„APIæ¥æ”¶åˆ°çš„Kinesis-agentæœºç¥¨æ•°æ®å°†è¢«è‡ªåŠ¨è§£æï¼Œå¹¶é€šè¿‡Kinesis Data Analyticsä¼ è¾“åˆ°æ‰€éœ€çš„æµä¸­ã€‚</font><font style="vertical-align: inherit;">è¯¥æµçš„æœªå¤„ç†ç‰ˆæœ¬å°†ç›´æ¥å†™å…¥å­˜å‚¨åº“ã€‚</font><font style="vertical-align: inherit;">éƒ¨ç½²åœ¨DynamoDBä¸­çš„åŸå§‹æ•°æ®å­˜å‚¨å°†å…è®¸é€šè¿‡BIå·¥å…·ï¼ˆä¾‹å¦‚AWS Quick Sightï¼‰å¯¹ç¥¨è¯è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬å°†è€ƒè™‘ä¸¤ç§æ–¹æ³•æ¥éƒ¨ç½²æ•´ä¸ªåŸºç¡€ç»“æ„ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰‹å†Œ-é€šè¿‡AWSç®¡ç†æ§åˆ¶å°;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraformä»£ç çš„åŸºç¡€ç»“æ„-é€‚ç”¨äºæ‡’æƒ°çš„è‡ªåŠ¨åŒ–å·¥ç¨‹å¸ˆï¼›</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£åœ¨å¼€å‘çš„ç³»ç»Ÿæ¶æ„</font></font></h2><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/vt/ss/mx/vtssmx0accvfcphkjvmzwdf4udg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½¿ç”¨çš„ç»„ä»¶ï¼š</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviasales API-</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤APIè¿”å›çš„æ•°æ®å°†ç”¨äºæ‰€æœ‰åç»­å·¥ä½œï¼›</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EC2ç”Ÿäº§è€…å®ä¾‹</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -äº‘ä¸­çš„å¸¸è§„è™šæ‹Ÿæœºï¼Œå°†åœ¨å…¶ä¸Šç”Ÿæˆè¾“å…¥æ•°æ®æµï¼š</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kinesis Agent</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯æœ¬åœ°å®‰è£…çš„Javaåº”ç”¨ç¨‹åºï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥æ”¶é›†æ•°æ®å¹¶å°†å…¶å‘é€åˆ°Kinesisï¼ˆKinesisæ•°æ®æµæˆ–Kinesis Firehoseï¼‰ã€‚</font><font style="vertical-align: inherit;">ä»£ç†ä¼šä¸æ–­ç›‘è§†æŒ‡å®šç›®å½•ä¸­çš„ä¸€ç»„æ–‡ä»¶ï¼Œå¹¶å°†æ–°æ•°æ®å‘é€åˆ°Kinesisã€‚</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è°ƒç”¨è€…APIè„šæœ¬</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -ä¸€ä¸ªPythonè„šæœ¬ï¼Œå®ƒå‘å‡ºAPIè¯·æ±‚å¹¶å°†å“åº”æ”¾å…¥Kinesis Agentç›‘è§†çš„æ–‡ä»¶å¤¹ä¸­ï¼›</font></font></li>
</ul></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b>Kinesis Data Streams</b></a> â€”            ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b>Kinesis Analytics</b></a> â€”  ,        . Amazon Kinesis Data Analytics              ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b>AWS Lambda</b></a> â€” ,        .        ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b>Amazon DynamoDB</b></a> â€”    Â«â€‘Â»  ,     10      .   DynamoDB    - ,       . DynamoDB   ,        .       ;</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><b>Amazon SNS</b></a> â€”        Â« â€” Â» (Pub/Sub),      ,     . SNS           push-, SMS-   .</li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆæ­¥è®­ç»ƒ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ¨¡æ‹Ÿæ•°æ®æµï¼Œæˆ‘å†³å®šä½¿ç”¨Aviasales APIè¿”å›çš„æœºç¥¨ä¿¡æ¯ã€‚</font><font style="vertical-align: inherit;">è¯¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡æ¡£æä¾›äº†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸å½“å¹¿æ³›çš„å„ç§æ–¹æ³•åˆ—è¡¨ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯â€œæœ¬æœˆçš„ä»·æ ¼æ—¥å†â€ï¼Œå®ƒè¿”å›æ¯æœˆçš„æ¯ä¸€å¤©çš„ä»·æ ¼ï¼Œå¹¶æŒ‰è½¬è´¦æ¬¡æ•°åˆ†ç»„ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨æœªåœ¨è¯·æ±‚ä¸­ä¼ é€æœç´¢æœˆä»½ï¼Œåˆ™å°†è¿”å›å½“å‰æœˆä»½ä¹‹åçš„æœˆä»½çš„ä¿¡æ¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œæ³¨å†Œå¹¶è·å–ä»¤ç‰Œã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ä¸‹ç¤ºä¾‹è¯·æ±‚ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">http://api.travelpayouts.com/v2/prices/month-matrix?currency=rub&amp;origin=LED&amp;destination=HKT&amp;show_to_affiliates=<span class="hljs-literal">true</span>&amp;token=TOKEN_API</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸Šé¢çš„é€šè¿‡è¯·æ±‚ä¸­çš„ä»¤ç‰Œä»APIæ¥æ”¶æ•°æ®çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘æ›´å–œæ¬¢é€šè¿‡æ ‡å¤´ä¼ é€’è®¿é—®ä»¤ç‰Œï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨api_caller.pyè„šæœ¬ä¸­ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç­”æ¡ˆç¤ºä¾‹ï¼š</font></font><br>
<br>
<pre><code class="json hljs">{{
   <span class="hljs-attr">"success"</span>:<span class="hljs-literal">true</span>,
   <span class="hljs-attr">"data"</span>:[{
      <span class="hljs-attr">"show_to_affiliates"</span>:<span class="hljs-literal">true</span>,
      <span class="hljs-attr">"trip_class"</span>:<span class="hljs-number">0</span>,
      <span class="hljs-attr">"origin"</span>:<span class="hljs-string">"LED"</span>,
      <span class="hljs-attr">"destination"</span>:<span class="hljs-string">"HKT"</span>,
      <span class="hljs-attr">"depart_date"</span>:<span class="hljs-string">"2015-10-01"</span>,
      <span class="hljs-attr">"return_date"</span>:<span class="hljs-string">""</span>,
      <span class="hljs-attr">"number_of_changes"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-attr">"value"</span>:<span class="hljs-number">29127</span>,
      <span class="hljs-attr">"found_at"</span>:<span class="hljs-string">"2015-09-24T00:06:12+04:00"</span>,
      <span class="hljs-attr">"distance"</span>:<span class="hljs-number">8015</span>,
      <span class="hljs-attr">"actual"</span>:<span class="hljs-literal">true</span><font></font>
   }]<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸Šé¢çš„APIå“åº”ç¤ºä¾‹æ˜¾ç¤ºäº†ä»åœ£å½¼å¾—å ¡åˆ°Phukçš„æœºç¥¨...å“¦ï¼Œæ¢¦toä»¥æ±‚... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”±äºæˆ‘æ¥è‡ªå–€å±±ï¼Œè€Œæ™®å‰å²›ç°åœ¨â€œåªæ˜¯åœ¨åšæ¢¦â€ï¼Œæˆ‘ä»¬å°†æŸ¥æ‰¾ä»åœ£å½¼å¾—å ¡åˆ°å–€å±±çš„æœºç¥¨ã€‚</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡è®¾æ‚¨å·²ç»æ‹¥æœ‰ä¸€ä¸ªAWSè´¦æˆ·ã€‚</font><font style="vertical-align: inherit;">æˆ‘è¦ç«‹å³ç‰¹åˆ«æ³¨æ„ï¼ŒKinesiså’Œé€šè¿‡SMSå‘é€é€šçŸ¥ä¸åŒ…å«åœ¨å¹´åº¦</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è´¹å¥—é¤ï¼ˆå…è´¹ä½¿ç”¨ï¼‰ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å°½ç®¡å¦‚æ­¤ï¼Œåªè¦è®°ä½å‡ ç¾å…ƒï¼Œå°±å¯ä»¥æ„å»ºå»ºè®®çš„ç³»ç»Ÿå¹¶ä½¿ç”¨å®ƒã€‚</font><font style="vertical-align: inherit;">å¹¶ä¸”ï¼Œå½“ç„¶ï¼Œä¸è¦åœ¨ä¸å¿…è¦çš„æ‰€æœ‰èµ„æºååˆ é™¤å®ƒä»¬ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¸è¿çš„æ˜¯ï¼Œå¦‚æœæ‚¨ä¿æŒæ¯æœˆå…è´¹ä½¿ç”¨é™åˆ¶ï¼ŒDynamoDbå’Œlambdaå‡½æ•°å°†æˆä¸ºæˆ‘ä»¬çš„å…±äº«è½¯ä»¶ã€‚</font><font style="vertical-align: inherit;">ä¾‹å¦‚ï¼Œå¯¹äºDynamoDBï¼š25 GBçš„å­˜å‚¨ï¼Œ25 WCU / RCUå’Œ1äº¿ä¸ªè¯·æ±‚ã€‚</font><font style="vertical-align: inherit;">æ¯æœˆæœ‰100ä¸‡ä¸ªè°ƒç”¨lambdaå‡½æ•°ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰‹åŠ¨éƒ¨ç½²ç³»ç»Ÿ</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®Kinesisæ•°æ®æµ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è½¬åˆ°Kinesis Data StreamsæœåŠ¡å¹¶åˆ›å»ºä¸¤ä¸ªæ–°çš„æµï¼Œæ¯ä¸ªæµä¸€ä¸ªåˆ†ç‰‡ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»€ä¹ˆæ˜¯ç¢ç‰‡ï¼Ÿ</font></font></b>
                        <div class="spoiler_text"> â€”       Amazon Kinesis.         1 /       2 /.     1000  PUT  .         . ,       .          2 /       4 /    2000  PUT  .<br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æµä¸­çš„ç¢ç‰‡è¶Šå¤šï¼Œå…¶ååé‡å°±è¶Šå¤§ã€‚</font><font style="vertical-align: inherit;">åŸåˆ™ä¸Šï¼Œé€šè¿‡æ·»åŠ åˆ†ç‰‡ä»¥è¿™ç§æ–¹å¼ç¼©æ”¾æµã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ç¢ç‰‡è¶Šå¤šï¼Œä»·æ ¼å°±è¶Šé«˜ã€‚</font><font style="vertical-align: inherit;">æ¯ä¸ªåˆ†ç‰‡æ¯å°æ—¶çš„è´¹ç”¨ä¸º1.5ç¾åˆ†ï¼Œæ¯ç™¾ä¸‡ä¸ªPUTæœ‰æ•ˆè´Ÿè½½å•ä½ä¸º1.4ç¾åˆ†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºä¸€ä¸ªåç§°ä¸º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">airline_tickets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æ–°çº¿ç¨‹</font><font style="vertical-align: inherit;">ï¼Œä¸€ä¸ªç¢ç‰‡å°±è¶³å¤Ÿäº†ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/5p/jg/f85pjg59pxlsbjio2_yzpz1wng4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨åˆ›å»ºå¦ä¸€ä¸ªåä¸º</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">special_streamçš„</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æµ</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4l/_t/eo/4l_teoxvvwv5pablkpfnv-tlnac.jpeg"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”Ÿäº§è€…è®¾å®š</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½œä¸ºç”¨äºè§£æä»»åŠ¡çš„æ•°æ®ç”Ÿäº§è€…ï¼Œä½¿ç”¨å¸¸è§„çš„EC2å®ä¾‹å°±è¶³å¤Ÿäº†ã€‚</font><font style="vertical-align: inherit;">å®ƒä¸å¿…æ˜¯åŠŸèƒ½å¼ºå¤§ä¸”æ˜‚è´µçš„è™šæ‹Ÿæœºï¼›ç°è´§t2.microéå¸¸é€‚åˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é‡è¦è¯´æ˜ï¼šä¾‹å¦‚ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨æ˜ åƒ-Amazon Linux AMI 2018.03.0ï¼Œä½¿ç”¨è¯¥æ˜ åƒå¯ä»¥å¿«é€Ÿå¯åŠ¨Kinesis Agentçš„è®¾ç½®è¾ƒå°‘ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è½¬åˆ°EC2æœåŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœºï¼Œç„¶åé€‰æ‹©t2.microç±»å‹çš„æ‰€éœ€AMIï¼Œè¯¥ç±»å‹åŒ…å«åœ¨Free Tierä¸­ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3q/rg/gt/3qrggtrxqistnkvgzn0bwkfdvbk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†ä½¿æ–°åˆ›å»ºçš„è™šæ‹Ÿæœºèƒ½å¤Ÿä¸KinesisæœåŠ¡äº¤äº’ï¼Œæ‚¨å¿…é¡»æˆäºˆå®ƒè¿™æ ·åšçš„æƒåˆ©ã€‚</font><font style="vertical-align: inherit;">æœ€å¥½çš„æ–¹æ³•æ˜¯åˆ†é…ä¸€ä¸ªIAMè§’è‰²ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨â€œæ­¥éª¤3ï¼šé…ç½®å®ä¾‹è¯¦ç»†ä¿¡æ¯â€å±å¹•ä¸Šï¼Œé€‰æ‹©â€œ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºæ–°çš„IAMè§’è‰²â€</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºEC2åˆ›å»ºIAMè§’è‰²</font></font></b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/_p/rm/xv/_prmxvgp0iv148grjwdpunwaela.jpeg"></div><br>
  , ,      EC2     Permissions:<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zv/as/nn/zvasnnl8ootjsr6rojjfhmjtfiw.jpeg"></div><br>
             ,     : AmazonKinesisFullAccess  CloudWatchFullAccess.<br>
<br>
 -     , : EC2-KinesisStreams-FullAccess.  ,     ,     :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jh/rj/38/jhrj38s8czngu9ri77mu26lh_o0.jpeg"></div><br>
    ,         :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yn/he/23/ynhe23lg4gfpfbjvlphntvfypyw.jpeg"></div><br>
           . <br>
</div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¿ç•™ç¡¬ç›˜çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä¿ç•™æ ‡ç­¾ï¼ˆå°½ç®¡ä½¿ç”¨æ ‡ç­¾æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ï¼Œä½†è‡³å°‘è¦æä¾›å®ä¾‹åç§°å¹¶æŒ‡å®šç¯å¢ƒï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨â€œç¬¬6æ­¥ï¼šé…ç½®å®‰å…¨ç»„â€é€‰é¡¹å¡ä¸Šï¼Œæ‚¨éœ€è¦åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å®‰å…¨ç»„æˆ–æŒ‡å®šç°æœ‰çš„å®‰å…¨ç»„ï¼Œè¯¥ç»„å…è®¸æ‚¨é€šè¿‡sshï¼ˆç«¯å£22ï¼‰è¿æ¥åˆ°å®ä¾‹ã€‚</font><font style="vertical-align: inherit;">é€‰æ‹©â€œæºâ€-&gt;â€œæˆ‘çš„IPâ€ï¼Œç„¶åå¯ä»¥è¿è¡Œå®ä¾‹ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y7/cd/z9/y7cdz9fllra7haynrf6gyu0jkdq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿›å…¥è¿è¡ŒçŠ¶æ€åï¼Œæ‚¨å¯ä»¥å°è¯•é€šè¿‡sshè¿æ¥åˆ°å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æˆåŠŸä½¿ç”¨Kinesis Agentï¼Œåœ¨æˆåŠŸè¿æ¥åˆ°è®¡ç®—æœºä¹‹åï¼Œå¿…é¡»åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo yum -y update<font></font>
sudo yum install -y python36 python36-pip<font></font>
sudo /usr/bin/pip-3.6 install --upgrade pip<font></font>
sudo yum install -y aws-kinesis-agent<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºç”¨äºä¿å­˜APIå“åº”çš„æ–‡ä»¶å¤¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo mkdir /var/<span class="hljs-built_in">log</span>/airline_tickets</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¯åŠ¨ä»£ç†ä¹‹å‰ï¼Œæ‚¨éœ€è¦é…ç½®å…¶é…ç½®ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo vim /etc/aws-kinesis/agent.json</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
agent.jsonæ–‡ä»¶çš„å†…å®¹åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"cloudwatch.emitMetrics"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"kinesis.endpoint"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-attr">"firehose.endpoint"</span>: <span class="hljs-string">""</span>,<font></font>
<font></font>
  <span class="hljs-attr">"flows"</span>: [<font></font>
    {<font></font>
      <span class="hljs-attr">"filePattern"</span>: <span class="hljs-string">"/var/log/airline_tickets/*log"</span>,
      <span class="hljs-attr">"kinesisStream"</span>: <span class="hljs-string">"airline_tickets"</span>,
      <span class="hljs-attr">"partitionKeyOption"</span>: <span class="hljs-string">"RANDOM"</span>,
      <span class="hljs-attr">"dataProcessingOptions"</span>: [<font></font>
         {<font></font>
            <span class="hljs-attr">"optionName"</span>: <span class="hljs-string">"CSVTOJSON"</span>,
            <span class="hljs-attr">"customFieldNames"</span>: [<span class="hljs-string">"cost"</span>,<span class="hljs-string">"trip_class"</span>,<span class="hljs-string">"show_to_affiliates"</span>,
                <span class="hljs-string">"return_date"</span>,<span class="hljs-string">"origin"</span>,<span class="hljs-string">"number_of_changes"</span>,<span class="hljs-string">"gate"</span>,<span class="hljs-string">"found_at"</span>,
                <span class="hljs-string">"duration"</span>,<span class="hljs-string">"distance"</span>,<span class="hljs-string">"destination"</span>,<span class="hljs-string">"depart_date"</span>,<span class="hljs-string">"actual"</span>,<span class="hljs-string">"record_id"</span>]<font></font>
         }<font></font>
      ]<font></font>
    }<font></font>
  ]<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»é…ç½®æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä»£ç†å°†ç›‘è§†/ var / log / airline_tickets /ç›®å½•ä¸­å…·æœ‰.logæ‰©å±•åçš„æ–‡ä»¶ï¼Œè§£æå®ƒä»¬å¹¶å°†å…¶ä¼ è¾“åˆ°airline_ticketsæµã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬é‡æ–°å¯åŠ¨è¯¥æœåŠ¡ï¼Œå¹¶ç¡®ä¿å®ƒå¯ä»¥å¯åŠ¨å¹¶è¿è¡Œï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo service aws-kinesis-agent restart</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ä¸‹è½½Pythonè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†ä»APIè¯·æ±‚æ•°æ®ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">REPO_PATH=https://raw.githubusercontent.com/igorgorbenko/aviasales_kinesis/master/producer<font></font>
<font></font>
wget <span class="hljs-variable">$REPO_PATH</span>/api_caller.py -P /home/ec2-user/<font></font>
wget <span class="hljs-variable">$REPO_PATH</span>/requirements.txt -P /home/ec2-user/<font></font>
sudo chmod a+x /home/ec2-user/api_caller.py<font></font>
sudo /usr/<span class="hljs-built_in">local</span>/bin/pip3 install -r /home/ec2-user/requirements.txt
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
api_caller.pyè„šæœ¬ä»Aviasalesè¯·æ±‚æ•°æ®ï¼Œå¹¶å°†æ”¶åˆ°çš„å“åº”ä¿å­˜åœ¨Kinesisä»£ç†æ‰«æçš„ç›®å½•ä¸­ã€‚</font><font style="vertical-align: inherit;">è¿™ä¸ªè„šæœ¬çš„å®ç°æ˜¯ç›¸å½“æ ‡å‡†çš„ï¼Œæœ‰ä¸€ä¸ªTicketsApiç±»ï¼Œå®ƒå…è®¸æ‚¨å¼‚æ­¥æå–APIã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤ç±»ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’å¸¦æœ‰ä»¤ç‰Œå’Œè¯·æ±‚å‚æ•°çš„æ ‡å¤´ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TicketsApi</span>:</span>
    <span class="hljs-string">"""Api caller class."""</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, headers</span>):</span>
        <span class="hljs-string">"""Init method."""</span><font></font>
        self.base_url = BASE_URL<font></font>
        self.headers = headers<font></font>
<font></font>
    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_data</span>(<span class="hljs-params">self, data</span>):</span>
        <span class="hljs-string">"""Get the data from API query."""</span><font></font>
        response_json = {}<font></font>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> ClientSession(headers=self.headers) <span class="hljs-keyword">as</span> session:
            <span class="hljs-keyword">try</span>:<font></font>
                response = <span class="hljs-keyword">await</span> session.get(self.base_url, data=data)<font></font>
                response.raise_for_status()<font></font>
                LOGGER.info(<span class="hljs-string">'Response status %s: %s'</span>,<font></font>
                            self.base_url, response.status)<font></font>
                response_json = <span class="hljs-keyword">await</span> response.json()
            <span class="hljs-keyword">except</span> HTTPError <span class="hljs-keyword">as</span> http_err:<font></font>
                LOGGER.error(<span class="hljs-string">'Oops! HTTP error occurred: %s'</span>, str(http_err))
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<font></font>
                LOGGER.error(<span class="hljs-string">'Oops! An error ocurred: %s'</span>, str(err))
            <span class="hljs-keyword">return</span> response_json<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_request</span>(<span class="hljs-params">api_token</span>):</span>
    <span class="hljs-string">"""Return the headers and query fot the API request."""</span>
    headers = {<span class="hljs-string">'X-Access-Token'</span>: api_token,
               <span class="hljs-string">'Accept-Encoding'</span>: <span class="hljs-string">'gzip'</span>}<font></font>
<font></font>
    data = FormData()<font></font>
    data.add_field(<span class="hljs-string">'currency'</span>, CURRENCY)<font></font>
    data.add_field(<span class="hljs-string">'origin'</span>, ORIGIN)<font></font>
    data.add_field(<span class="hljs-string">'destination'</span>, DESTINATION)<font></font>
    data.add_field(<span class="hljs-string">'show_to_affiliates'</span>, SHOW_TO_AFFILIATES)<font></font>
    data.add_field(<span class="hljs-string">'trip_duration'</span>, TRIP_DURATION)
    <span class="hljs-keyword">return</span> headers, data<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-string">"""Get run the code."""</span>
    <span class="hljs-keyword">if</span> len(sys.argv) != <span class="hljs-number">2</span>:<font></font>
        print(<span class="hljs-string">'Usage: api_caller.py &lt;your_api_token&gt;'</span>)<font></font>
        sys.exit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">return</span>
    api_token = sys.argv[<span class="hljs-number">1</span>]<font></font>
    headers, data = prepare_request(api_token)<font></font>
<font></font>
    api = TicketsApi(headers)<font></font>
    response = <span class="hljs-keyword">await</span> api.get_data(data)
    <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'success'</span>, <span class="hljs-literal">None</span>):<font></font>
        LOGGER.info(<span class="hljs-string">'API has returned %s items'</span>, len(response[<span class="hljs-string">'data'</span>]))
        <span class="hljs-keyword">try</span>:<font></font>
            count_rows = log_maker(response)<font></font>
            LOGGER.info(<span class="hljs-string">'%s rows have been saved into %s'</span>,<font></font>
                        count_rows,<font></font>
                        TARGET_FILE)<font></font>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<font></font>
            LOGGER.error(<span class="hljs-string">'Oops! Request result was not saved to file. %s'</span>,<font></font>
                         str(e))<font></font>
    <span class="hljs-keyword">else</span>:<font></font>
        LOGGER.error(<span class="hljs-string">'Oops! API request was unsuccessful %s!'</span>, response)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æµ‹è¯•ä»£ç†çš„æ­£ç¡®è®¾ç½®å’Œå¯æ“ä½œæ€§ï¼Œæˆ‘ä»¬å°†å¯¹api_caller.pyè„šæœ¬è¿›è¡Œæµ‹è¯•è¿è¡Œï¼š</font></font><br>
<br>
<pre><code class="bash hljs">sudo ./api_caller.py TOKEN</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u8/17/rr/u817rrbmcgutepqlpx-aa7k2mo4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä¼šåœ¨åº§å¸­çš„æ—¥å¿—ä¸­ä»¥åŠairline_ticketsæ•°æ®æµä¸­çš„â€œç›‘è§†â€é€‰é¡¹å¡ä¸ŠæŸ¥çœ‹å·¥ä½œç»“æœï¼š</font></font><br>
<br>
<pre><code class="bash hljs">tail -f /var/<span class="hljs-built_in">log</span>/aws-kinesis-agent/aws-kinesis-agent.log</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ep/5r/oy/ep5royv-vndczuzfhaufx2duuau.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/g3/pi/ya/g3piyaltiksnogpxwm0temjdpz4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æ‚¨æ‰€è§ï¼Œä¸€åˆ‡æ­£å¸¸ï¼ŒKinesis AgentæˆåŠŸå°†æ•°æ®å‘é€åˆ°æµã€‚</font><font style="vertical-align: inherit;">ç°åœ¨é…ç½®ä½¿ç”¨è€…ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è®¾ç½®Kinesis Data Analytics</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬ç»§ç»­æ•´ä¸ªç³»ç»Ÿçš„ä¸­å¿ƒç»„ä»¶-åœ¨Kinesis Data Analyticsä¸­åˆ›å»ºä¸€ä¸ªåä¸ºkinesis_analytics_airlines_appçš„æ–°åº”ç”¨ç¨‹åºï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dp/0s/4a/dp0s4aesniewnc3j7envuvi2lqa.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kinesis Data Analyticsæ”¯æŒä½¿ç”¨SQLå¯¹Kinesis Streamsä¸­çš„æ•°æ®è¿›è¡Œå®æ—¶åˆ†æã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å¯è‡ªåŠ¨ç¼©æ”¾çš„æœåŠ¡ï¼ˆä¸Kinesis Streamsä¸åŒï¼‰ï¼Œè¯¥æœåŠ¡ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è®¸æ‚¨åŸºäºå¯¹æºæ•°æ®çš„æŸ¥è¯¢æ¥åˆ›å»ºæ–°æµï¼ˆè¾“å‡ºæµï¼‰ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æä¾›å…·æœ‰åœ¨åº”ç”¨ç¨‹åºæ“ä½œæœŸé—´å‘ç”Ÿçš„é”™è¯¯çš„æµï¼ˆé”™è¯¯æµï¼‰ï¼›</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ƒå¯ä»¥è‡ªåŠ¨ç¡®å®šè¾“å…¥æ•°æ®æ–¹æ¡ˆï¼ˆå¿…è¦æ—¶å¯ä»¥æ‰‹åŠ¨é‡æ–°å®šä¹‰ï¼‰ã€‚</font></font></li>
</ol><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€é¡¹æ˜‚è´µçš„æœåŠ¡-æ¯å°æ—¶0.11 USDï¼Œå› æ­¤æ‚¨åº”è°¨æ…ä½¿ç”¨å®ƒï¼Œå¹¶åœ¨å®Œæˆå·¥ä½œåå°†å…¶åˆ é™¤ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†åº”ç”¨ç¨‹åºè¿æ¥åˆ°æ•°æ®æºï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/2x/sc/g6/2xscg6tquygvrr4dxhjofyxjx-m.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€‰æ‹©æ‚¨è¦è¿æ¥çš„æµï¼ˆairline_ticketsï¼‰ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/y1/c7/ma/y1c7ma8a_9n3wwwokqleszry-qa.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦é™„åŠ æ–°çš„IAMè§’è‰²ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥ä»æµä¸­è¯»å–å¹¶å†™å…¥æµä¸­ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œåªè¦ä¸æ›´æ”¹è®¿é—®æƒé™å—ä¸­çš„ä»»ä½•å†…å®¹å³å¯ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/dg/96/wq/dg96wq1hgmmd0ouhxpxs8r0tjss.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæˆ‘ä»¬è¯·æ±‚åœ¨æµä¸­å‘ç°æ•°æ®æ–¹æ¡ˆï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å•å‡»â€œå‘ç°æ¨¡å¼â€æŒ‰é’®ã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œå°†æ›´æ–°IAMè§’è‰²ï¼ˆå°†åˆ›å»ºä¸€ä¸ªæ–°è§’è‰²ï¼‰ï¼Œå¹¶å°†å¯åŠ¨ä»æµä¸­å·²ç»åˆ°è¾¾çš„æ•°æ®ä¸­å‘ç°æ–¹æ¡ˆçš„è¿‡ç¨‹ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5e/co/6r/5eco6ro21kgrevovywr-2ulfysw.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ï¼Œæ‚¨éœ€è¦è½¬åˆ°SQLç¼–è¾‘å™¨ã€‚</font><font style="vertical-align: inherit;">å½“æ‚¨å•å‡»æ­¤æŒ‰é’®æ—¶ï¼Œå°†å‡ºç°ä¸€ä¸ªæœ‰å…³å¯åŠ¨åº”ç”¨ç¨‹åºçš„é—®é¢˜çš„çª—å£-é€‰æ‹©æˆ‘ä»¬è¦è¿è¡Œçš„å†…å®¹ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kt/oc/ta/ktoctaokxjgsxbosk5eu8-yw_e0.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨â€œ SQLç¼–è¾‘å™¨â€çª—å£ä¸­ï¼Œæ’å…¥ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼Œç„¶åå•å‡»â€œä¿å­˜å¹¶è¿è¡ŒSQLâ€ï¼š</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">REPLACE</span> STREAM <span class="hljs-string">"DESTINATION_SQL_STREAM"</span> (<span class="hljs-string">"cost"</span> <span class="hljs-keyword">DOUBLE</span>, <span class="hljs-string">"gate"</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">16</span>));<font></font>
<font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">REPLACE</span> PUMP <span class="hljs-string">"STREAM_PUMP"</span> <span class="hljs-keyword">AS</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-string">"DESTINATION_SQL_STREAM"</span>
<span class="hljs-keyword">SELECT</span> STREAM <span class="hljs-string">"cost"</span>, <span class="hljs-string">"gate"</span>
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"SOURCE_SQL_STREAM_001"</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-string">"cost"</span> &lt; <span class="hljs-number">5000</span>
    <span class="hljs-keyword">and</span> <span class="hljs-string">"gate"</span> = <span class="hljs-string">'Aeroflot'</span>;
</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œå¯ä»¥ä½¿ç”¨INSERTè¯­å¥æ¥æ·»åŠ è®°å½•å¹¶ä½¿ç”¨SELECTè¯­å¥æ¥æŸ¥è¯¢æ•°æ®çš„è¡¨ã€‚</font><font style="vertical-align: inherit;">åœ¨Amazon Kinesis Data Analyticsä¸­ï¼Œæ‚¨ä½¿ç”¨æµï¼ˆSTREAMï¼‰å’Œâ€œæ³µâ€ï¼ˆPUMPï¼‰-è¿ç»­æ’å…¥è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å°†æ•°æ®ä»åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªæµæ’å…¥åˆ°å¦ä¸€ä¸ªæµä¸­ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ä¸Šé¢çš„SQLæŸ¥è¯¢ä¸­ï¼Œä»¥ä½äºäº”åƒå¢å¸ƒçš„ä»·æ ¼æœç´¢Aeroflotæœºç¥¨ã€‚</font><font style="vertical-align: inherit;">å±äºè¿™äº›æ¡ä»¶çš„æ‰€æœ‰è®°å½•éƒ½å°†æ”¾ç½®åœ¨DESTINATION_SQL_STREAMæµä¸­ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/l7/zk/8l/l7zk8ltrlivhjnmj3u1xcvazwai.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç›®æ ‡å—ä¸­ï¼Œé€‰æ‹©special_streamæµï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºå†…æµåç§°DESTINATION_SQL_STREAMä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5r/5s/7r/5r5s7rpwfezpiyjokrby1jkmcly.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»è¿‡æ‰€æœ‰æ“ä½œï¼Œç»“æœåº”ç±»ä¼¼äºä¸‹å›¾ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/4c/o3/_b/4co3_blpb57-arskyc7jwsc2d_i.jpeg"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºå’Œè®¢é˜…SNSä¸»é¢˜</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è½¬åˆ°ç®€å•é€šçŸ¥æœåŠ¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåä¸ºâ€œèˆªç©ºå…¬å¸â€çš„æ–°ä¸»é¢˜ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/su/ur/zr/suurzrkeqmmm7jk3-j5iuqaiar8.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬è®¢é˜…äº†è¯¥ä¸»é¢˜ï¼Œåœ¨å…¶ä¸­æŒ‡æ˜äº†SMSé€šçŸ¥å°†åˆ°è¾¾çš„æ‰‹æœºå·ç ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ep/gc/sz/epgcszgapjrsl4-jhx7vktgi7fi.jpeg"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨DynamoDBä¸­åˆ›å»ºè¡¨</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¦å­˜å‚¨å…¶airline_ticketsæµçš„åŸå§‹æ•°æ®ï¼Œè¯·åœ¨DynamoDBä¸­åˆ›å»ºä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°çš„è¡¨ã€‚</font><font style="vertical-align: inherit;">ä½œä¸ºä¸»é”®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨record_idï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/t7/td/4e/t7td4eq2asrdur1arxzbmsuthdk.jpeg"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºLambdaæ”¶é›†å™¨å‡½æ•°</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç§°ä¸ºæ”¶é›†å™¨çš„lambdaå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä»»åŠ¡æ˜¯è½®è¯¢airline_ticketsæµï¼Œå¦‚æœé‚£é‡Œæœ‰æ–°è®°å½•ï¼Œåˆ™å°†è¿™äº›è®°å½•æ’å…¥DynamoDBè¡¨ä¸­ã€‚</font><font style="vertical-align: inherit;">æ˜¾ç„¶ï¼Œé™¤äº†é»˜è®¤æƒé™å¤–ï¼Œæ­¤lambdaè¿˜å¿…é¡»æœ‰æƒè¯»å–Kinesisæ•°æ®æµå¹¶å†™å…¥DynamoDBã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºLambdaæ”¶é›†å™¨åŠŸèƒ½åˆ›å»ºIAMè§’è‰²</font></font></b>
                        <div class="spoiler_text">    IAM      Lambda-TicketsProcessingRole:<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/s9/sv/_f/s9sv_fh7p4flqdklnzh5rohd9ws.jpeg"></div><br>
       AmazonKinesisReadOnlyAccess  AmazonDynamoDBFullAccess,     :<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/f_/v0/zy/f_v0zyuhd3h9y5e9tiuurfbpqnq.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/78/db/ge/78dbgeqrxjuuh6rzlqd-k1qdgee.jpeg"></div></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æ–°æ¡ç›®å‡»ä¸­airline_streamæµæ—¶ï¼Œè¯¥lambdaåº”è¯¥ç”±Kinesisè§¦å‘å™¨è§¦å‘ï¼Œå› æ­¤æ‚¨éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°è§¦å‘å™¨ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/h0/gg/qth0ggplzpl1afpad4shlgl_tbu.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/we/2c/ip/we2cipjv713dvyo10ry4wmyrdi0.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»ç„¶éœ€è¦æ’å…¥ä»£ç å¹¶ä¿å­˜lambdaã€‚</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-string">"""Parsing the stream and inserting into the DynamoDB table."""</span>
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> boto3
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal<font></font>
<font></font>
DYNAMO_DB = boto3.resource(<span class="hljs-string">'dynamodb'</span>)<font></font>
TABLE_NAME = <span class="hljs-string">'airline_tickets'</span><font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TicketsParser</span>:</span>
    <span class="hljs-string">"""Parsing info from the Stream."""</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, table_name, records</span>):</span>
        <span class="hljs-string">"""Init method."""</span><font></font>
        self.table = DYNAMO_DB.Table(table_name)<font></font>
        self.json_data = TicketsParser.get_json_data(records)<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_json_data</span>(<span class="hljs-params">records</span>):</span>
        <span class="hljs-string">"""Return deserialized data from the stream."""</span>
        decoded_record_data = ([base64.b64decode(record[<span class="hljs-string">'kinesis'</span>][<span class="hljs-string">'data'</span>])
                                <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> records])<font></font>
        json_data = ([json.loads(decoded_record)<font></font>
                      <span class="hljs-keyword">for</span> decoded_record <span class="hljs-keyword">in</span> decoded_record_data])
        <span class="hljs-keyword">return</span> json_data<font></font>
<font></font>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_item_from_json</span>(<span class="hljs-params">json_item</span>):</span>
        <span class="hljs-string">"""Pre-process the json data."""</span><font></font>
        new_item = {<font></font>
            <span class="hljs-string">'record_id'</span>: json_item.get(<span class="hljs-string">'record_id'</span>),
            <span class="hljs-string">'cost'</span>: Decimal(json_item.get(<span class="hljs-string">'cost'</span>)),
            <span class="hljs-string">'trip_class'</span>: json_item.get(<span class="hljs-string">'trip_class'</span>),
            <span class="hljs-string">'show_to_affiliates'</span>: json_item.get(<span class="hljs-string">'show_to_affiliates'</span>),
            <span class="hljs-string">'origin'</span>: json_item.get(<span class="hljs-string">'origin'</span>),
            <span class="hljs-string">'number_of_changes'</span>: int(json_item.get(<span class="hljs-string">'number_of_changes'</span>)),
            <span class="hljs-string">'gate'</span>: json_item.get(<span class="hljs-string">'gate'</span>),
            <span class="hljs-string">'found_at'</span>: json_item.get(<span class="hljs-string">'found_at'</span>),
            <span class="hljs-string">'duration'</span>: int(json_item.get(<span class="hljs-string">'duration'</span>)),
            <span class="hljs-string">'distance'</span>: int(json_item.get(<span class="hljs-string">'distance'</span>)),
            <span class="hljs-string">'destination'</span>: json_item.get(<span class="hljs-string">'destination'</span>),
            <span class="hljs-string">'depart_date'</span>: json_item.get(<span class="hljs-string">'depart_date'</span>),
            <span class="hljs-string">'actual'</span>: json_item.get(<span class="hljs-string">'actual'</span>)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> new_item<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-string">"""Batch insert into the table."""</span>
        <span class="hljs-keyword">with</span> self.table.batch_writer() <span class="hljs-keyword">as</span> batch_writer:
            <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.json_data:<font></font>
                dynamodb_item = TicketsParser.get_item_from_json(item)<font></font>
                batch_writer.put_item(dynamodb_item)<font></font>
<font></font>
        print(<span class="hljs-string">'Has been added '</span>, len(self.json_data), <span class="hljs-string">'items'</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lambda_handler</span>(<span class="hljs-params">event, context</span>):</span>
    <span class="hljs-string">"""Parse the stream and insert into the DynamoDB table."""</span>
    print(<span class="hljs-string">'Got event:'</span>, event)<font></font>
    parser = TicketsParser(TABLE_NAME, event[<span class="hljs-string">'Records'</span>])<font></font>
    parser.run()<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºLambdaå‡½æ•°é€šçŸ¥ç¨‹åº</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥ç›¸åŒçš„æ–¹å¼åˆ›å»ºç¬¬äºŒä¸ªlambdaå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ç›‘è§†ç¬¬äºŒä¸ªæµï¼ˆspecial_streamï¼‰å¹¶å‘SNSå‘é€é€šçŸ¥ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæ­¤lambdaå¿…é¡»å…·æœ‰æ¥è‡ªKinesisçš„è¯»å–è®¿é—®æƒé™ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„SNSä¸»é¢˜ï¼Œç„¶åç”±SNSæœåŠ¡å°†å…¶å‘é€ç»™è¯¥ä¸»é¢˜çš„æ‰€æœ‰è®¢æˆ·ï¼ˆç”µå­é‚®ä»¶ï¼ŒSMSç­‰ï¼‰ã€‚</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ›å»ºIAMè§’è‰²</font></font></b>
                        <div class="spoiler_text">  IAM  Lambda-KinesisAlarm   ,         alarm_notifier:<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zm/fn/ru/zmfnru75p-tp0y1fqzxaoea2xos.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/yp/vp/u0/ypvpu0jl74aak54hl-d4wf7r1kc.jpeg"></div></div>
                    </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥lambdaåº”è¯¥æ ¹æ®è§¦å‘æ–°æ¡ç›®è¿›å…¥special_streamçš„è§¦å‘å™¨æ¥å·¥ä½œï¼Œå› æ­¤æ‚¨éœ€è¦ä»¥ä¸æ”¶é›†å™¨lambdaç›¸åŒçš„æ–¹å¼é…ç½®è§¦å‘å™¨ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸ºäº†æ–¹ä¾¿é…ç½®æ­¤lambdaï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡TOPIC_ARNï¼Œåœ¨å…¶ä¸­æ”¾ç½®äº†Airlinesçš„ANRï¼ˆäºšé©¬é€Šèµ„æºåç§°ï¼‰ä¸»é¢˜ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/43/nn/qf/43nnqfmsnahbfu30k5mqadhbuhi.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶æ’å…¥lambdaä»£ç ï¼Œè¿™éå¸¸ç®€å•ï¼š</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> boto3
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> os<font></font>
<font></font>
SNS_CLIENT = boto3.client(<span class="hljs-string">'sns'</span>)<font></font>
TOPIC_ARN = os.environ[<span class="hljs-string">'TOPIC_ARN'</span>]<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lambda_handler</span>(<span class="hljs-params">event, context</span>):</span>
    <span class="hljs-keyword">try</span>:<font></font>
        SNS_CLIENT.publish(TopicArn=TOPIC_ARN,<font></font>
                           Message=<span class="hljs-string">'Hi! I have found an interesting stuff!'</span>,<font></font>
                           Subject=<span class="hljs-string">'Airline tickets alarm'</span>)<font></font>
        print(<span class="hljs-string">'Alarm message has been successfully delivered'</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<font></font>
        print(<span class="hljs-string">'Delivery failure'</span>, str(err))
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çœ‹æ¥è¿™å®Œæˆäº†æ‰‹åŠ¨ç³»ç»Ÿé…ç½®ã€‚</font><font style="vertical-align: inherit;">ä»…ç”¨äºæµ‹è¯•å¹¶ç¡®ä¿æˆ‘ä»¬æ­£ç¡®é…ç½®äº†æ‰€æœ‰å†…å®¹ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»Terraformä»£ç è¿›è¡Œéƒ¨ç½²</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¿…è¦çš„å‡†å¤‡</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å¼€æºå·¥å…·ï¼Œç”¨äºé€šè¿‡ä»£ç éƒ¨ç½²åŸºç¡€æ¶æ„ã€‚</font><font style="vertical-align: inherit;">å®ƒå…·æœ‰è‡ªå·±çš„è¯­æ³•ï¼Œæ˜“äºå­¦ä¹ ï¼Œå¹¶æä¾›äº†è®¸å¤šæœ‰å…³å¦‚ä½•éƒ¨ç½²ä»¥åŠéƒ¨ç½²ä»€ä¹ˆçš„ç¤ºä¾‹ã€‚</font><font style="vertical-align: inherit;">Atomæˆ–Visual Studioä»£ç ç¼–è¾‘å™¨ä¸­æœ‰è®¸å¤šæ–¹ä¾¿çš„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶ä½¿ä½¿ç”¨Terraformæ›´åŠ å®¹æ˜“ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‚¨å¯ä»¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»æ­¤å¤„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‹è½½åˆ†å‘å·¥å…·åŒ…</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¯¹Terraformçš„æ‰€æœ‰åŠŸèƒ½çš„è¯¦ç»†åˆ†æä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ä¹‹å†…ï¼Œå› æ­¤æˆ‘ä»¬å°†é™åˆ¶è‡ªå·±çš„é‡ç‚¹ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä½•å¼€å§‹</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®Œæ•´çš„é¡¹ç›®ä»£ç </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æˆ‘çš„å­˜å‚¨åº“ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸ºè‡ªå·±å…‹éš†ä¸€ä¸ªå­˜å‚¨åº“ã€‚</font><font style="vertical-align: inherit;">åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‚¨éœ€è¦ç¡®ä¿å·²å®‰è£…å¹¶é…ç½®äº†AWS CLIï¼Œå¦‚ä¸‹æ‰€ç¤º </font><font style="vertical-align: inherit;">Terraformå°†åœ¨ã€œ/ .aws /å‡­è¯æ–‡ä»¶ä¸­æŸ¥æ‰¾å‡­è¯ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å¯åŠ¨planå‘½ä»¤ä¹‹å‰å…ˆéƒ¨ç½²æ•´ä¸ªåŸºç¡€æ¶æ„æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œä»¥æŸ¥çœ‹Terraformç°åœ¨æ­£åœ¨äº‘ä¸­ä¸ºæˆ‘ä»¬åˆ›å»ºçš„å†…å®¹ï¼š</font></font><br>
<br>
<pre><code class="bash hljs">terraform.exe plan</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç³»ç»Ÿå°†æç¤ºæ‚¨è¾“å…¥ç”µè¯å·ç ä»¥å‘å…¶å‘é€é€šçŸ¥ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤é˜¶æ®µï¼Œå®ƒæ˜¯å¯é€‰çš„ã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/e3/-i/ps/e3-ipsgvy03inzbw_26haktayk4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨åˆ†æäº†ç¨‹åºçš„å·¥ä½œè®¡åˆ’ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹åˆ›å»ºèµ„æºï¼š</font></font><br>
<br>
<pre><code class="bash hljs">terraform.exe apply</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å‘é€æ­¤å‘½ä»¤åï¼Œå°†å†æ¬¡è¦æ±‚æ‚¨è¾“å…¥ç”µè¯å·ç ï¼Œå¹¶åœ¨æ˜¾ç¤ºæœ‰å…³å®é™…æ‰§è¡Œæ“ä½œçš„é—®é¢˜æ—¶é”®å…¥â€œæ˜¯â€ã€‚</font><font style="vertical-align: inherit;">è¿™å°†ä½¿æ‚¨èƒ½å¤Ÿæå‡æ•´ä¸ªåŸºç¡€æ¶æ„ï¼Œæ‰§è¡ŒEC2çš„æ‰€æœ‰å¿…è¦è®¾ç½®ï¼Œéƒ¨ç½²lambdaå‡½æ•°ç­‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡Terraformä»£ç æˆåŠŸåˆ›å»ºæ‰€æœ‰èµ„æºåï¼Œæ‚¨éœ€è¦è¿›å…¥Kinesis Analyticsåº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ï¼ˆä¸å¹¸çš„æ˜¯ï¼Œæˆ‘æ²¡æœ‰ç›´æ¥ä»ä»£ç ä¸­æ‰¾åˆ°å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯åŠ¨åº”ç”¨ç¨‹åºï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/ns/qc/qxnsqcjpbkiaradzqomahtxzhnu.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¹‹åï¼Œæ‚¨å¿…é¡»é€šè¿‡ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­è¿›è¡Œé€‰æ‹©æ¥æ˜¾å¼è®¾ç½®åº”ç”¨ç¨‹åºå†…æµåç§°ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/m5/pl/kim5plwariaz8bp-qo-qonli4yu.jpeg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/hg/69/kf/hg69kfwwtwhwkzxlpnb7g3k2ctm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç°åœ¨ä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”ç”¨æµ‹è¯•</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ— è®ºæ‚¨æ˜¯å¦‚ä½•æ‰‹åŠ¨éƒ¨ç½²ç³»ç»Ÿè¿˜æ˜¯é€šè¿‡Terraformä»£ç éƒ¨ç½²ç³»ç»Ÿï¼Œå…¶å·¥ä½œæ–¹å¼éƒ½ä¸€æ ·ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬é€šè¿‡SSHè¿›å…¥å®‰è£…äº†Kinesis Agentçš„EC2è™šæ‹Ÿæœºï¼Œå¹¶è¿è¡Œapi_caller.pyè„šæœ¬</font></font><br>
<br>
<pre><code class="bash hljs">sudo ./api_caller.py TOKEN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç­‰å¾…çŸ­ä¿¡åˆ°æ‚¨çš„ç”µè¯å·ç ä»ç„¶æ˜¯ï¼š </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/98/ui/mc/98uimcirxv_n6pglm2qz5jtkvf4.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
çŸ­ä¿¡-çŸ­ä¿¡å°†åœ¨1åˆ†é’Ÿå†…åˆ°è¾¾ç”µè¯ï¼š </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/u7/dj/kgu7djc9xgex84h349dlpfukivg.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è®°å½•æ˜¯å¦ä¿å­˜åœ¨DynamoDBæ•°æ®åº“ä¸­ä»¥è¿›è¡Œåç»­æ›´è¯¦ç»†çš„åˆ†æè¿˜æœ‰å¾…è§‚å¯Ÿã€‚</font><font style="vertical-align: inherit;">airline_ticketsè¡¨åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/dj/vc/gqdjvcmx0q45o_sgqc_l5po_l-c.jpeg"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»“è®º</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨å®Œæˆå·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæ„å»ºäº†åŸºäºAmazon Kinesisçš„åœ¨çº¿æ•°æ®å¤„ç†ç³»ç»Ÿã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬æ£€æŸ¥äº†å°†Kinesis Agentä¸Kinesis Data Streamsç»“åˆä½¿ç”¨ä»¥åŠä½¿ç”¨SQLå‘½ä»¤å¯¹Kinesis Analyticsè¿›è¡Œå®æ—¶åˆ†æçš„é€‰é¡¹ï¼Œä»¥åŠAmazon Kinesisä¸å…¶ä»–AWSæœåŠ¡çš„äº¤äº’ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ä»¥ä¸¤ç§æ–¹å¼éƒ¨ç½²ä¸Šè¿°ç³»ç»Ÿï¼šè¶³å¤Ÿé•¿çš„æ‰‹åŠ¨æ—¶é—´å’Œä»Terraformä»£ç å¿«é€Ÿè·å–çš„æ—¶é—´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¯¥é¡¹ç›®çš„æ•´ä¸ªæºä»£ç éƒ½å¯ä»¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æˆ‘åœ¨GitHubä¸Šçš„å­˜å‚¨åº“ä¸­æ‰¾åˆ°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå»ºè®®æ‚¨ç†Ÿæ‚‰ä¸€ä¸‹å®ƒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘å‡†å¤‡æ„‰å¿«åœ°è®¨è®ºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘åœ¨ç­‰å¾…æ‚¨çš„è¯„è®ºã€‚</font><font style="vertical-align: inherit;">æˆ‘å¸Œæœ›è¿›è¡Œå»ºè®¾æ€§çš„æ‰¹è¯„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç¥ä½ æˆåŠŸï¼</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN500364/index.html">åœ¨Moodleå’ŒBigBlueButtonä¸Šæ‰©å±•å­¦æ ¡å­¦ä¹ é—¨æˆ·</a></li>
<li><a href="../zh-CN500368/index.html">ç”Ÿæˆå¯é¢„æµ‹çš„éšæœºåºåˆ—ï¼šä¸€ç§ä¸åŒçš„ç½®æ¢æ–¹æ³•</a></li>
<li><a href="../zh-CN500370/index.html">é¢å‘2020å¹´å€¼å¾—è®¢é˜…çš„10ä¸ªæœ‰ç”¨çš„è‹±è¯­æ’­å®¢</a></li>
<li><a href="../zh-CN500378/index.html">å·¥ä½œä¸­æœ‰æ•ˆçš„ä¿¡æ¯æœç´¢</a></li>
<li><a href="../zh-CN500380/index.html">è¿œç¨‹å¤„ç†ä¸ªäººæ•°æ®ï¼šé£é™©å’Œå¯èƒ½çš„åæœ</a></li>
<li><a href="../zh-CN500384/index.html">çš®å…‹æ–¯å·¥ä½œå®¤å…ˆé”‹è·å¾—å›¾çµå¥–å’Œä¸€ç™¾ä¸‡ç¾å…ƒ</a></li>
<li><a href="../zh-CN500386/index.html">ä½¿æ‚¨ç°æœ‰çš„ä¸šåŠ¡è§£å†³æ–¹æ¡ˆé€‚åº”SwiftUIã€‚ç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN500390/index.html">ITå’Œæ•°å­—é€šä¿¡é¢†åŸŸä¸­è¯­è¨€æœ¬åœ°åŒ–çš„å®é™…æ¨¡å‹ã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN500396/index.html">è‡ªä¸»è®¿é—®æ§åˆ¶ç³»ç»Ÿçš„é—®é¢˜-ä»–ä»¬æ²¡æœ‰æƒ³åˆ°çš„åœ°æ–¹</a></li>
<li><a href="../zh-CN500398/index.html">è¿œç¨‹é©¬æ‹‰æ¾å‘¨3ï¼šæ— æ•ˆçš„è¿‡ç¨‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>