<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÄ üèí üîõ Almacenamiento en cach√©. Parte 2: 60 d√≠as antes del lanzamiento üéá ‚ò†Ô∏è ‚òéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Hola! Ya te escrib√≠ sobre c√≥mo promover iniciativas en una corporaci√≥n. M√°s precisamente, c√≥mo (a veces) esto tiene √©xito y qu√© dificultades pueden s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Almacenamiento en cach√©. Parte 2: 60 d√≠as antes del lanzamiento</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/504400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Hola! </font><font style="vertical-align: inherit;">Ya te escrib√≠ sobre c√≥mo promover iniciativas en una corporaci√≥n. </font><font style="vertical-align: inherit;">M√°s precisamente, c√≥mo (a veces) esto tiene √©xito y qu√© dificultades pueden surgir: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una retrospectiva de rastrillo. </font><font style="vertical-align: inherit;">C√≥mo una soluci√≥n hecha por uno mismo result√≥ ser m√°s fr√≠a que una paga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo elegimos un sistema de almacenamiento en cach√©. </font><font style="vertical-align: inherit;">Parte 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy quiero continuar y hablar sobre el momento psicol√≥gicamente m√°s estresante de ese proyecto, sobre el cual aparecen los primeros dos art√≠culos, cuando el resultado del proyecto fue determinado no tanto por las habilidades t√©cnicas del equipo como por la confianza en sus c√°lculos y la voluntad de llegar al final. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tengo que decir, creo que para llevar el proyecto a un momento tan intenso, es un error muy usado </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobre</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lshaya que cualquier hero√≠smo al sacar el proyecto de este problema ...</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no oculto esta experiencia y la comparto voluntariamente, porque considero:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">precisamente las √°reas problem√°ticas son puntos de crecimiento</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los mayores problemas "llegan" precisamente de donde no se espera</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La combinaci√≥n de estos puntos, simplemente te obliga a compartir la maravillosa experiencia de "c√≥mo ganar una cuneta de la nada". </font><font style="vertical-align: inherit;">Pero, debe notarse, una situaci√≥n similar es excepcional en la compa√±√≠a Sportmaster. </font><font style="vertical-align: inherit;">Es decir, es posible que esta situaci√≥n vuelva a ocurrir, planificaci√≥n y definici√≥n de responsabilidad ahora, en un nivel completamente diferente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, parece que la introducci√≥n es suficiente, si est√°s listo, bienvenido a cat.</font></font><br>
 <br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/sa/3o/8k/sa3o8kskmgz_ptdsflpadmiycra.png"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Junio ‚Äã‚Äã2017 </font><font style="vertical-align: inherit;">Estamos modificando el panel de administraci√≥n. </font><font style="vertical-align: inherit;">El panel de administraci√≥n no es solo un conjunto de formularios y tablas en la interfaz web: los valores ingresados ‚Äã‚Äãdeben estar pegados con docenas de otros datos que obtenemos de sistemas de terceros. </font><font style="vertical-align: inherit;">Adem√°s, de alguna manera, transf√≥rmelo y, en √∫ltima instancia, env√≠elo a los consumidores (el principal es el sitio ElasticSearch de Sportmaster). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La principal dificultad es simplemente convertir y enviar. </font><font style="vertical-align: inherit;">A saber:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debe proporcionar datos en forma de json, que pesa 100 Kb cada uno, y algunos aparecen por 10 MB (busque la disponibilidad y los criterios de entrega de productos a las tiendas)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hay json con una estructura que tiene archivos adjuntos recursivos de cualquier nivel de anidamiento (por ejemplo, un men√∫ dentro de un elemento de men√∫, en el que hay elementos de men√∫ nuevamente, etc.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la declaraci√≥n final no se aprueba y cambia constantemente (por ejemplo, el trabajo con productos por Modelos se reemplaza por un enfoque cuando trabajamos por Modelos en color). </font><font style="vertical-align: inherit;">Constantemente: esto es varias veces a la semana, con una tasa m√°xima de 2 veces al d√≠a durante una semana.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si los primeros 2 puntos son puramente t√©cnicos y est√°n dictados por la tarea misma, entonces, con el tercer punto, por supuesto, debe tratarlo organizativamente. </font><font style="vertical-align: inherit;">Pero, el mundo real est√° lejos de ser ideal, por lo que trabajamos con lo que tenemos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, descubrieron c√≥mo remachar r√°pidamente los formularios web y sus objetos en el lado del servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se design√≥ a una persona del equipo para que desempe√±ara el papel de "bofetada de formularios" profesional y, utilizando componentes web preparados, lanz√≥ una demostraci√≥n para la interfaz de usuario m√°s r√°pido de lo que los analistas corrigieron los dibujos de esta interfaz de usuario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero para cambiar el esquema de transformaciones, aqu√≠ surgi√≥ la complejidad.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, seguimos el camino habitual: llevar a cabo la transformaci√≥n en la consulta SQL a Oracle. Hab√≠a un especialista en DB en el equipo. Dur√≥ hasta el momento en que la solicitud fue de 2 p√°ginas de texto sql continuo. Podr√≠a seguir y seguir, pero cuando los cambios vinieron de los analistas, objetivamente, lo m√°s dif√≠cil fue encontrar el lugar donde hacer los cambios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los analistas expresaron regla en los esquemas, los cuales, a pesar de que se pintaron en algo separado del c√≥digo (una especie de Visio / draw.io / Gliffy), pero no eran </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similar a los cuadrados y flechas en los sistemas ETL (por ejemplo, Pentaho Kettle, que en ese momento se usaba para suministrar datos al sitio web de Sportmaster). Ahora, si no tuvi√©ramos una consulta SQL, ¬°sino un esquema ETL! ¬°Entonces la declaraci√≥n y la soluci√≥n se expresar√≠an de manera id√©ntica topol√≥gicamente, lo que significa que editar el c√≥digo podr√≠a tomar tanto tiempo como editar la declaraci√≥n!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero con los sistemas ETL hay otra dificultad. El mismo Pentaho Kettle: es excelente cuando necesita crear un nuevo √≠ndice en ElasticSearch, en el que escribir todos los datos pegados de varias fuentes (observaci√≥n: de hecho, es Pentaho Kettle el que no funciona muy bien, porque no usa JavaScript en las transformaciones asociado con las clases de Java a trav√©s de las cuales el consumidor accede a los datos; debido a esto, puede escribir algo que no puede convertir en los objetos pojo necesarios m√°s adelante, pero este es un tema separado, alejado del curso principal del art√≠culo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¬øqu√© hacer cuando en el panel de administraci√≥n el usuario corrigi√≥ un campo en un documento? Para enviar este cambio al sitio ElasticSearch de Sportmaster, ¬°no cree un nuevo √≠ndice en el que completar todos los documentos de este tipo, incluido uno actualizado!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quer√≠a que cuando un objeto en los datos de entrada cambiara, luego enviar una actualizaci√≥n </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ElasticSearch del sitio </font><i><font style="vertical-align: inherit;">solo</font></i><font style="vertical-align: inherit;"> para el documento de salida correspondiente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De acuerdo, el documento de entrada en s√≠, pero despu√©s de todo, de acuerdo con el esquema de transformaci√≥n, ¬°podr√≠a adjuntarse a documentos de un tipo diferente a trav√©s de unirse! Por lo tanto, debe analizar el esquema de transformaci√≥n y calcular qu√© documentos de salida se ver√°n afectados por el cambio en los datos en las fuentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La b√∫squeda de productos en caja para resolver este problema no condujo a nada. Extraviado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y cuando se desesperaron por encontrarlo, lo descubrieron, pero ¬øc√≥mo deber√≠a funcionar dentro y c√≥mo se puede hacer esto? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea surgi√≥ de inmediato.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si el ETL final se puede dividir en sus partes constituyentes, cada una de las cuales tiene un cierto tipo de un conjunto finito (por ejemplo, filtro, uni√≥n, etc.), entonces, tal vez, ser√° suficiente para crear el mismo conjunto final de nodos especiales que corresponden a los originales, pero con la diferencia de que trabajan no con los datos en s√≠, sino con su cambio? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En gran detalle, con ejemplos y puntos clave en la implementaci√≥n, nuestra soluci√≥n: quiero cubrirla en un art√≠culo separado. Para lidiar con posiciones de apoyo, esto requerir√° una inmersi√≥n seria, la capacidad de pensar de manera abstracta y confiar en lo que a√∫n no se ha manifestado. De hecho, ser√° interesante precisamente desde un punto de vista matem√°tico y es interesante solo para aquellos habrovitas que est√©n interesados ‚Äã‚Äãen </font><font style="vertical-align: inherit;">detalles </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√©cnicos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ solo puedo decir que creamos un modelo matem√°tico en el que describimos 7 tipos de nodos y mostramos que este sistema est√° completo, es decir, usando estos 7 tipos de nodos y las conexiones entre ellos, se puede expresar cualquier esquema de transformaci√≥n de datos. </font><font style="vertical-align: inherit;">La implementaci√≥n se basa en el uso activo de obtener y registrar datos por clave (es decir, por clave, sin condiciones adicionales). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, nuestra soluci√≥n ten√≠a un punto fuerte con respecto a todas las dificultades introductorias:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los datos deben proporcionarse en forma de json -&gt; trabajamos con objetos pojo (simple objeto java antiguo, si alguien no encontr√≥ los tiempos en que se usaba dicha designaci√≥n), que son f√°ciles de superar en json</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hay json con una estructura que tiene incrustaciones recursivas de cualquier nivel de anidaci√≥n -&gt; nuevamente, pojo (lo principal es que no hay bucles, pero cu√°ntos niveles de anidaci√≥n no es importante, porque podemos procesarlo f√°cilmente en java a trav√©s de la recursi√≥n)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la declaraci√≥n final cambia constantemente -&gt; excelente, ya que estamos cambiando el esquema de transformaci√≥n m√°s r√°pido de lo que los analistas elaboran (en los diagramas) deseos de experimentos</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De los momentos de riesgo, solo uno: escribimos la soluci√≥n desde cero, por nuestra cuenta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, las trampas no tardaron en llegar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momento especial N1. </font><font style="vertical-align: inherit;">Trampa. </font><font style="vertical-align: inherit;">‚ÄúBien extrapolado‚Äù</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Otra sorpresa de naturaleza organizativa fue que, al mismo tiempo que nuestro desarrollo, el repositorio principal principal se estaba moviendo a una nueva versi√≥n, y el formato en el que este repositorio proporciona datos cambi√≥. Y ser√≠a bueno si nuestro sistema funcionara inmediatamente con el nuevo almacenamiento, y no con el anterior. Pero el nuevo almacenamiento a√∫n no est√° listo. Pero entonces, las estructuras de datos son conocidas y pueden darnos una base de demostraci√≥n en la que se vertir√° una peque√±a cantidad de datos relacionados. ¬øVa? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠, en el enfoque del producto, cuando se trabaja con el flujo de suministro de valor, todos los optimistas reciben una advertencia inequ√≠vocamente: hay un bloqueador -&gt; la tarea no funciona, punto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero entonces, tal dependencia ni siquiera despert√≥ sospechas. De hecho, est√°bamos euf√≥ricos por el √©xito con el prototipo de procesador Delta: un sistema para procesar datos en deltas (implementaci√≥n de un modelo matem√°tico cuando los cambios en los datos de salida se calculan utilizando el esquema de transformaci√≥n como respuesta a un cambio en los datos de entrada). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre todos los esquemas de transformaci√≥n, uno fue el m√°s importante. Adem√°s del hecho de que el circuito en s√≠ mismo era el m√°s grande y complejo, tambi√©n exist√≠a un requisito estricto para que la transformaci√≥n se realizara de acuerdo con este circuito: un l√≠mite de tiempo para la ejecuci√≥n de la cantidad total de datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, la transformaci√≥n debe llevarse a cabo 15 minutos y no un segundo m√°s. La entrada principal es una tabla con 5.5 millones de registros. En la etapa de desarrollo, la tabla a√∫n no est√° poblada. M√°s precisamente, se llena con un peque√±o conjunto de datos de prueba en la cantidad de 10 mil filas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, empecemos. En la primera implementaci√≥n, el procesador Delta trabaj√≥ en el HashMap como el almacenamiento de valor clave (perm√≠tame recordarle que necesitamos leer y escribir mucho los objetos por clave). Por supuesto, que en los vol√∫menes de producci√≥n, todos los objetos intermedios no caben en la memoria, por lo tanto, en lugar de HashMap, cambiamos a Hazelcast. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øPor qu√© exactamente Hazelcast? Entonces, debido a que este producto era familiar, se utiliz√≥ en el backend del sitio del Sportmaster. Adem√°s, este es un sistema distribuido y, como nos pareci√≥, si un amigo hace algo mal con el rendimiento, agregamos m√°s instancias a un par de m√°quinas y el problema se resuelve. En casos extremos: una docena de autos. Escalado horizontal y todas las cosas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y as√≠, estamos lanzando nuestro procesador Delta para una transformaci√≥n dirigida. Funciona casi al instante. Esto es comprensible: los datos son solo 10 mil en lugar de 5.5 millones. Por lo tanto, multiplicamos el tiempo medido por 550 y obtenemos el resultado: algo as√≠ como 2 minutos. ¬°Multa! De hecho, ¬°una victoria! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto fue al comienzo del trabajo del proyecto: justo cuando necesita decidir sobre la arquitectura, confirmar las hip√≥tesis (realizar pruebas que las confirmen), integrar la soluci√≥n piloto verticalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como las pruebas mostraron un excelente resultado, es decir, confirmamos todas las hip√≥tesis, r√°pidamente cambiamos el piloto, armamos un "esqueleto" integrado verticalmente para una peque√±a pieza de funcionalidad. Y comenzaron la codificaci√≥n principal: llenar el "esqueleto con carne".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo que con √©xito y vigorosamente comprometido. Hasta ese hermoso d√≠a, cuando se carg√≥ un </font><font style="vertical-align: inherit;">conjunto </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">completo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de datos </font><font style="vertical-align: inherit;">en la tienda maestra </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute la prueba en este conjunto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de 2 minutos no funcion√≥. Tampoco trabaj√© despu√©s de 5, 10, 15 minutos. Es decir, no encajaban en el marco necesario. Pero, con qui√©n no sucede, ser√° necesario ajustar algo en detalle y en forma. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero la prueba no funcion√≥ una hora despu√©s. E incluso despu√©s de 2 horas hab√≠a esperanzas de que trabajara, y buscaremos qu√© ajustar. Restos de esperanza fueron incluso despu√©s de 5 horas. Pero, despu√©s de 10 horas, cuando se fueron a casa, pero la prueba a√∫n no funcion√≥, ya no hab√≠a esperanza. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema fue que al d√≠a siguiente, cuando llegaron a la oficina, la prueba segu√≠a trabajando diligentemente. Como resultado, se desplaz√≥ durante 30 horas, no esper√≥, se apag√≥.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Cat√°strofe! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema se localiz√≥ lo suficientemente r√°pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hazelcast, cuando se trabaja en una peque√±a cantidad de datos, en realidad desplaza todo en la memoria. </font><font style="vertical-align: inherit;">Pero cuando fue necesario volcar datos en un disco, el rendimiento baj√≥ miles de veces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La programaci√≥n ser√≠a una ocupaci√≥n aburrida e ins√≠pida, de no ser por las autoridades y la obligaci√≥n de entregar el producto terminado. </font><font style="vertical-align: inherit;">Entonces, literalmente, un d√≠a despu√©s, despu√©s de recibir un conjunto completo de datos, tenemos que ir a las autoridades con un informe sobre c√≥mo pas√≥ la prueba de los vol√∫menes de producci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una elecci√≥n muy seria y dif√≠cil:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diga "como est√°" = abandone el proyecto</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diga "como me gustar√≠a" = arriesgarse, tal vez, no se sabe si podemos solucionar el problema</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para comprender qu√© sentimientos surgen en este caso, solo es posible invertir completamente en la idea, realizar el plan durante medio a√±o, crear un producto que ayude a los colegas a resolver una gran capa de problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y as√≠, renunciar a su amada creaci√≥n es muy dif√≠cil. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es caracter√≠stico de todas las personas: amamos aquello en lo que hemos puesto mucho esfuerzo. Por lo tanto, es dif√≠cil escuchar cr√≠ticas: debe hacer esfuerzos conscientes para percibir adecuadamente los comentarios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, decidimos que todav√≠a hay muchos, muchos sistemas diferentes que se pueden usar como almacenamiento de valor clave, y si Hazelcast no encaja, entonces algo definitivamente funcionar√°. </font><font style="vertical-align: inherit;">Es decir, decidieron arriesgarse. </font><font style="vertical-align: inherit;">Para nuestra justificaci√≥n, podemos decir que todav√≠a no era un "plazo sangriento", en general, todav√≠a hab√≠a un margen de tiempo para "pasar" a una soluci√≥n de respaldo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En esa reuni√≥n con los jefes, nuestro gerente indic√≥ que "la prueba mostr√≥ que el sistema funciona de manera estable en los vol√∫menes de producci√≥n, no se bloquea". </font><font style="vertical-align: inherit;">De hecho, el sistema funcion√≥ de manera estable. </font><u><font style="vertical-align: inherit;">60</font></u><font style="vertical-align: inherit;"> d√≠as </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
para liberar </font><font style="vertical-align: inherit;">.</font></font><u><font style="vertical-align: inherit;"></font></u><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momento especial N2. </font><font style="vertical-align: inherit;">No es una trampa, pero no un descubrimiento. </font><font style="vertical-align: inherit;">"Menos es m√°s"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para encontrar un reemplazo para Hazelcast con el rol de almac√©n de datos Key-Value, compilamos una lista de todos los candidatos: obtuvimos una lista de 31 productos. Esto es todo lo que logr√© buscar en Google y descubrir por mis amigos. Adem√°s, Google ofreci√≥ algunas opciones absolutamente obscenas, como el trabajo de un estudiante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para evaluar a los candidatos m√°s r√°pido, preparamos una peque√±a prueba que, en unos minutos de lanzamiento, mostr√≥ el rendimiento en los vol√∫menes correctos. Y paralelaron el trabajo: todos tomaron el siguiente sistema de la lista, configuraron, ejecutaron la prueba, tomaron el siguiente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabajaron r√°pidamente, rompieron varios sistemas al d√≠a.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el sistema 18, qued√≥ claro que esto no ten√≠a sentido. Bajo nuestro perfil de carga, ninguno de estos sistemas est√° afilado. Tienen muchos volantes y reverencias para que sea conveniente usarlos, muchos enfoques hermosos para el escalado horizontal, pero esto no nos da ning√∫n beneficio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Necesitamos un sistema que _fast_ guarde la clave en un objeto en el disco y lea r√°pidamente la clave. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si es as√≠, describimos el algoritmo de c√≥mo se puede implementar esto. En general, parece bastante factible, si al mismo tiempo: a) sacrifica la cantidad de datos que ocupar√° el disco, b) tiene aproximadamente estimaciones de la cantidad y el tama√±o caracter√≠stico de los datos en cada tabla. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algo con estilo, asignar memoria (en disco) para objetos con un margen, piezas de un volumen m√°ximo fijo. Luego, usando las tablas de √≠ndice ... y as√≠ sucesivamente ...</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fue una suerte que no llegara a esto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La salvaci√≥n lleg√≥ en forma de RocksDB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este es un producto de Facebook que est√° dise√±ado para una lectura r√°pida y guardar una matriz de bytes en el disco. Al mismo tiempo, el acceso a los archivos se proporciona a trav√©s de una interfaz que es similar al almacenamiento Key-Value. De hecho, la clave es una matriz de bytes, el valor es una matriz de bytes. Optimizado para hacer este trabajo de forma r√°pida y confiable. Todas. Si necesita algo m√°s hermoso y de alto nivel, atorn√≠llelo usted mismo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬°Exactamente lo que necesitamos!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RocksDB, atornillado en el rol de almacenamiento de valor clave, llev√≥ el indicador de prueba objetivo al nivel de 5 horas. </font><font style="vertical-align: inherit;">Estaba lejos de los 15 minutos, pero lo principal estaba hecho. </font><font style="vertical-align: inherit;">Lo principal era comprender lo que estaba sucediendo, comprender que escribir en el disco era lo m√°s r√°pido posible, m√°s r√°pido que imposible. </font><font style="vertical-align: inherit;">En SSD, en pruebas refinadas, RocksDB exprimi√≥ 400Mb / s, y eso fue suficiente para nuestra tarea. </font><font style="vertical-align: inherit;">Retrasos: en alg√∫n lugar del nuestro, en un c√≥digo vinculante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuestro</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> c√≥digo, lo que significa que podemos manejarlo. </font><font style="vertical-align: inherit;">Vamos a desarmarlo, pero podemos manejarlo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momento especial N3. </font><font style="vertical-align: inherit;">Apoyo. </font><font style="vertical-align: inherit;">"C√°lculo te√≥rico"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenemos un algoritmo y entrada. Tomamos el rango de datos de entrada, calculamos cu√°ntas acciones debe realizar el sistema, c√≥mo se expresan estas acciones en los costos de tiempo de ejecuci√≥n de JVM (asigne un valor a una variable, ingrese un m√©todo, cree un objeto, copie una matriz de bytes, etc.), adem√°s de cu√°ntas llamadas a RocksDB debe celebrarse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seg√∫n los c√°lculos, resulta que deber√≠an cumplir 2 minutos (aproximadamente, como mostr√≥ la prueba para HashMap al principio, pero esto es solo una coincidencia: el algoritmo ha cambiado desde entonces). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, sin embargo, la prueba dura 5 horas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y ahora, antes del lanzamiento de </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√≠as. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una fecha especial, ahora ser√° imposible colapsar, no tendremos tiempo para cambiar a la opci√≥n de copia de seguridad.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, en este d√≠a el gerente del proyecto es convocado a las autoridades. La pregunta es la misma: ten tiempo, ¬øest√° todo bien? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ip/ci/ps/ipcipst6tfldoo7vmigaxcmsmta.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√° la mejor manera de describir esta situaci√≥n: una imagen de portada ampliada para este art√≠culo. Es decir, a los jefes se les muestra esa parte de la imagen que se muestra en el t√≠tulo. Pero en realidad, as√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque, en realidad, por supuesto, no fuimos para nada graciosos. Y decir que "¬°Todo est√° bien!" - esto es posible solo para una persona con una habilidad muy fuerte en el dominio propio. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gran respeto por el gerente, por creer y confiar en los desarrolladores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo realmente disponible: muestra 5 horas. Un c√°lculo te√≥rico: muestra 2 minutos. ¬øC√≥mo se puede creer esto?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero es posible si: el modelo est√° formulado claramente, c√≥mo contar es comprensible y qu√© valores sustituir tambi√©n son comprensibles. Es decir, el hecho de que en realidad la ejecuci√≥n lleva m√°s tiempo significa que en realidad no se est√° ejecutando exactamente el c√≥digo que esperamos ejecutar all√≠. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarea central es encontrar "lastre" en el c√≥digo. Es decir, se realizan algunas acciones adem√°s de la secuencia principal de creaci√≥n de los datos finales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apresuramos. Pruebas unitarias, composiciones funcionales, fragmentaci√≥n de funciones y localizaci√≥n de lugares con una cantidad desproporcionada de tiempo dedicado a la ejecuci√≥n. Se han hecho muchas cosas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el camino, formulamos esos lugares en los que puede ajustarse seriamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, serializaci√≥n. </font><font style="vertical-align: inherit;">Primero us√© el est√°ndar java.io. </font><font style="vertical-align: inherit;">Pero si sujetamos Cryo, en nuestro caso obtendremos un aumento de 2.5 veces en la velocidad de serializaci√≥n y una reducci√≥n de 3 veces en el volumen de datos serializados (lo que significa que IO es 3 veces m√°s peque√±o, lo que solo consume los recursos principales). </font><font style="vertical-align: inherit;">Pero, con m√°s detalle, este es un tema para un art√≠culo t√©cnico separado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero el punto clave, o "d√≥nde se escondi√≥ el elefante", tratar√© de describirlo en un p√°rrafo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Punto especial 4. Recepci√≥n para encontrar una soluci√≥n. </font><font style="vertical-align: inherit;">"Problema = Soluci√≥n"</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando obtenemos / establecemos por clave, en los c√°lculos se realiz√≥ como 1 operaci√≥n, afecta a IO en el volumen igual a clave + valor de objeto (en forma serializada, por supuesto). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero, ¬øqu√© pasa si el objeto en s√≠ mismo en el que llamamos get / set es un Mapa, que tambi√©n obtenemos mediante get / set desde el disco. ¬øCu√°nto se har√° el IO en este caso? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestros c√°lculos, esta caracter√≠stica no se tuvo en cuenta. Es decir, se consider√≥ como 1 IO para clave + valor-objeto. ¬øPero, de hecho?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, en el almacenamiento Key-Value, por key-1 hay un objeto obj-1 con el tipo Map, en el que cierto objeto obj-2 debe almacenarse bajo la clave key-2. Aqu√≠ pensamos que la operaci√≥n requerir√≠a un IO para key-2 + obj-2. Pero en realidad, debe considerar obj-1, manipularlo y enviarlo a IO: key-1 + obj-1. Y si se trata de un mapa en el que hay 1000 objetos, el consumo de E / S ser√° aproximadamente 1000 veces m√°s. Y si 10,000 objetos, entonces ... As√≠ es como obtuvieron el "lastre". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se identifica un problema, la soluci√≥n suele ser obvia.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro caso, esto se ha convertido en una estructura especial para las manipulaciones dentro del Mapa anidado. </font><font style="vertical-align: inherit;">Es decir, dicho valor-clave, que para obtener / establecer acepta dos claves a la vez, que deben aplicarse secuencialmente: clave-1, clave-2, es decir, para el primer nivel y para el anidado. </font><font style="vertical-align: inherit;">C√≥mo implementar una estructura de este tipo: te lo contar√© detalladamente con gusto, pero nuevamente, en un art√≠culo t√©cnico separado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠, de este episodio, enfatizo y promuevo tal caracter√≠stica: un problema extremadamente detallado es una buena soluci√≥n.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terminaci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo, trat√© de mostrar los puntos organizativos y las trampas que pueden surgir. </font><font style="vertical-align: inherit;">Estas trampas son claramente visibles "desde el costado" o con el tiempo, pero es muy f√°cil entrar en ellas cuando te encuentras por primera vez junto a ellas. </font><font style="vertical-align: inherit;">Espero que alguien recuerde tal descripci√≥n, y en el momento adecuado el recordatorio funcionar√° "He escuchado algo as√≠ antes". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, lo m√°s importante, ahora que todo se cuenta sobre el proceso, los momentos psicol√≥gicos, los de organizaci√≥n. </font><font style="vertical-align: inherit;">Ahora que tenemos una idea de qu√© tareas y bajo qu√© condiciones se cre√≥ el sistema. </font><font style="vertical-align: inherit;">Ahora, puede y debe contar sobre el sistema desde un punto de vista t√©cnico: qu√© tipo de modelo matem√°tico es, qu√© trucos en el c√≥digo utilizamos y qu√© soluciones innovadoras pensamos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobre esto en el pr√≥ximo art√≠culo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mientras tanto, Happy New Code!</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es504374/index.html">Recorrido de gr√°fico simple: b√∫squeda de profundidad y amplitud utilizando JavaScript como ejemplo</a></li>
<li><a href="../es504382/index.html">C√≥mo (PhD Neurobiology) me convert√≠ en Data Scientist en 6 meses</a></li>
<li><a href="../es504384/index.html">Introduzca gradualmente TypeScript en su proyecto React</a></li>
<li><a href="../es504386/index.html">Variables virtuales de Vassbotn H. Class</a></li>
<li><a href="../es504392/index.html">¬øCu√°ntos programadores y palabras necesitas para reconocer un pasaporte escrito a mano?</a></li>
<li><a href="../es504402/index.html">29 de mayo Java Digest</a></li>
<li><a href="../es504408/index.html">Plantilla de marco de prueba simple y conveniente en seleniuro para autotests de IU</a></li>
<li><a href="../es504412/index.html">Programaci√≥n en l√≠nea del campeonato "Open Finals of Moscow Training"</a></li>
<li><a href="../es504414/index.html">C√≥mo Microsoft mat√≥ a AppGet</a></li>
<li><a href="../es504420/index.html">Escribir una arena PvP por turnos con movimientos simult√°neos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>