<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚵🏾 🧘🏽 🍥 Routing di chatbots kompleks dengan kerangka kerja Hobot 👩🏽‍✈️ 🎪 ⚽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah mulai mengembangkan bot untuk Telegram beberapa tahun yang lalu, saya menemukan kinerja, kesederhanaan dan fleksibilitas bekerja dengan mereka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Routing di chatbots kompleks dengan kerangka kerja Hobot</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/actualizebot/blog/489008/"><img src="https://habrastorage.org/webt/op/j7/ip/opj7ipookzxpfhtdfi1x_8cln2w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah mulai mengembangkan bot untuk Telegram beberapa tahun yang lalu, saya menemukan kinerja, kesederhanaan dan fleksibilitas bekerja dengan mereka sebagai kasus khusus dari antarmuka baris perintah. </font><font style="vertical-align: inherit;">Karakteristik ini, tersedia bagi banyak orang saat ini, sebagian besar disebabkan oleh kerangka telegraf.js yang populer dan sejenisnya, yang menyediakan metode yang disederhanakan untuk bekerja dengan API Telegram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada saat yang sama, arsitektur proyek terletak sepenuhnya di pundak pengembang, dan dilihat dari jumlah bot kompleks dan multifungsi yang sederhana, kami masih memiliki ruang untuk tumbuh dalam hal ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini saya ingin berbicara tentang kerangka routing chatbot kecil, yang tanpanya pengembangan proyek kami tidak mungkin dilakukan.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa informasi dasar</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam chatbots dan CLI, eksekusi satu tindakan logis sering terdiri dari beberapa langkah penyempurnaan atau langkah percabangan. Ini mengharuskan program untuk menyimpan koordinat tertentu untuk mengingat di mana pengguna berada dalam aliran dan menjalankan perintahnya sesuai dengan koordinat ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ilustrasi paling sederhana adalah eksekusi perintah </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npm init</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , di mana program meminta Anda untuk menentukan satu atau beberapa data lain untuk package.json secara bergantian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada langkah pertama, ia memberi tahu pengguna bahwa ia sedang menunggu input teks dari nama paket - dan apa yang dikirimkan oleh pengguna dengan perintah berikutnya akan disimpan sebagai nama paket berkat variabel tempat penantian ini ditulis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menyebut jalur variabel ini - jalur tempat kode ini atau itu dilampirkan secara logis. </font><font style="vertical-align: inherit;">Selalu diperlukan jika bot memiliki navigasi atau perintah yang dikeluarkan dalam beberapa langkah.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Praktek hari ini dalam arsitektur bot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pendekatan yang pertama kali saya lihat oleh pengembang lain tampak seperti ini: untuk setiap pembaruan yang datang dari pengguna, daftar cek untuk nilai tertentu dari variabel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">path</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ditulis </font><font style="vertical-align: inherit;">dan logika bisnis dan navigasi lebih lanjut ditempatkan di dalam cek ini dalam bentuk paling dasar:</font></font><br>
<br>
<pre><code class="javascript hljs">onUserInput(ctx, input) {
    <span class="hljs-keyword">switch</span>(ctx.session.path) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'firstPath'</span>:
	    <span class="hljs-keyword">if</span> (input === <span class="hljs-string">'!'</span>) {
               <span class="hljs-comment">// -  </span>
	        ctx.reply(<span class="hljs-string">'!'</span>);<font></font>
	        ctx.session.path = <span class="hljs-string">'secondPath'</span>;<font></font>
	    } <span class="hljs-keyword">else</span> {<font></font>
	        ctx.reply(<span class="hljs-string">' "!"'</span>);<font></font>
	    }<font></font>
	    <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'...'</span>:
       	    <span class="hljs-comment">//   </span><font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda hanya memiliki beberapa tim dan beberapa langkah untuk setiap tim, solusi ini optimal. </font><font style="vertical-align: inherit;">Mencapai tim ketiga dan ketujuh jika Anda mulai berpikir ada sesuatu yang salah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam salah satu bot yang kami punya kesempatan untuk bekerja dengan pada tahap akhir, inti dari fungsional adalah selembar 4000 baris dan ~ 70 kondisi hanya tingkat atas yang tumbuh dari dua seandainya, dengan memeriksa apa yang pergi ke hati - kadang-kadang jalan, kadang-kadang perintah, terkadang jalur dan perintah. </font><font style="vertical-align: inherit;">Semua kondisi ini diperiksa untuk setiap aksi pengguna dan mengakses fungsi tambahan dari objek lembar tetangga, yang juga tumbuh dari beberapa baris. </font><font style="vertical-align: inherit;">Tak perlu dikatakan, seberapa lambat dan menyedihkan proyek ini berjalan?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerangka kerja hobot</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memulai </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ActualizeBot,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami sudah membayangkan seberapa besar itu, dan tugas pertama kami adalah untuk mempertahankan ekstensibilitas dan kecepatan pengembangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melakukan ini, kami memecah logika klien menjadi pengontrol yang ditugaskan ke lintasan dan menulis abstraksi kecil untuk menavigasi antara pengontrol ini dan memproses pesan yang diterima dari pengguna di dalamnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semua ini, berdasarkan proyek-proyek besar, ditulis dalam TypeScript dan menerima nama elegan Hobot, yang mengisyaratkan, tentu saja, pada jalur pipa navigasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kontroler adalah objek sederhana dari tiga properti:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">path</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - string identifier dari path yang digunakan untuk menginisialisasi dan menavigasi path yang diinisialisasi</font></font></li>
<li><b>get</b> — ,  ,           <i>hobot.gotoPath(ctx, path, data?)</i>.             —   <i>data</i>   ,            </li>
<li><b>post</b> —  .   ,      ,    .     updateType —    ,    : <i>text</i>, <i>callback_query</i>   . updateType     <i>ctx</i>     </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Contoh pengontrol:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> anotherController = {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'firstPath'</span>,
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">async</span> (ctx, data) =&gt; 
        <span class="hljs-keyword">await</span> ctx.reply(<span class="hljs-string">'Welcome to this path! Say "Hi"'</span>),
    <span class="hljs-attr">post</span>: <span class="hljs-keyword">async</span> (ctx, updateType) =&gt; {
        <span class="hljs-comment">//     : text / callback_query / etc...</span>
        <span class="hljs-keyword">if</span> (updateType === updateTypes.text &amp;&amp; ctx.update.message.text === <span class="hljs-string">'Hi'</span>) {
            <span class="hljs-keyword">await</span> ctx.reply(<span class="hljs-string">"Thank you!"</span>);
            <span class="hljs-comment">// hobot       this:</span>
            <span class="hljs-keyword">this</span>.hobot.gotoPath(ctx, <span class="hljs-string">'secondPath'</span>, { <span class="hljs-attr">userJustSaid</span>: <span class="hljs-string">"Hi"</span> });<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//     ,       </span>
            <span class="hljs-keyword">await</span> ctx.reply(<span class="hljs-string">'We expect "Hi" text message here'</span>);<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini terlihat sedikit lebih rumit daripada di awal, tetapi kesulitannya akan tetap sama ketika Anda memiliki 100 atau 200 jalur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logika internal sepele </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan mengejutkan bahwa belum ada yang melakukan ini</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengontrol ini ditambahkan ke objek yang kunci-nya adalah nilai-nilai properti </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">path</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan dipanggil darinya oleh kunci-kunci ini selama tindakan pengguna atau saat bernavigasi menggunakan </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hobot.gotoPath (ctx, path, data? )</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Navigasi dialokasikan dalam metode terpisah agar tidak menyentuh jalur variabel dan logika navigasi, tetapi hanya memikirkan logika bisnis, meskipun Anda selalu dapat mengubah ctx.session.path dengan tangan Anda, yang tentu saja tidak disarankan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yang perlu Anda lakukan untuk membuat bot baru Anda dengan pekerjaan struktur yang tidak dapat dihancurkan adalah meluncurkan bot telegraf biasa dan meneruskannya dan objek konfigurasi ke konstruktor Hobot. </font><font style="vertical-align: inherit;">Objek config terdiri dari pengontrol yang ingin Anda inisialisasi, jalur default, dan pasangan perintah / pengontrol.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-comment">//   telegraf-</span>
<span class="hljs-keyword">const</span> bot = <span class="hljs-keyword">new</span> Telegraf(<span class="hljs-string">'_'</span>);<font></font>
<font></font>
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> hobot = <span class="hljs-keyword">new</span> Hobot(bot, {
    <span class="hljs-attr">defaultPath</span>: <span class="hljs-string">'firstPath'</span>,
    <span class="hljs-attr">commands</span>: [
        <span class="hljs-comment">//  ,     </span>
        <span class="hljs-comment">// get    :</span>
        { <span class="hljs-attr">command</span>: <span class="hljs-string">'start'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'firstPath'</span> }<font></font>
    ],<font></font>
    <span class="hljs-attr">controllers</span>: [
        <span class="hljs-comment">// -,    </span><font></font>
        startController,<font></font>
        nextController<font></font>
    ]<font></font>
});<font></font>
<font></font>
<span class="hljs-comment">// C telegraf-,       </span><font></font>
bot.launch();<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulannya</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keuntungan implisit membagi lembar menjadi pengontrol:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk menempatkan fungsi, metode, dan antarmuka yang terisolasi yang dikunci dengan logika pengontrol ini dalam file terpisah di sebelah pengontrol</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secara signifikan mengurangi risiko tidak sengaja melanggar segalanya</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modularitas: menyalakan / mematikan / memberikan segmen tertentu dari penonton logika ini atau itu dapat dilakukan hanya dengan menambah dan menghapus controller dari array, termasuk dengan memperbarui konfigurasi tanpa pemrograman - untuk ini, tentu saja, kita perlu menulis beberapa huruf, karena kita belum menulis tercapai</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kemampuan untuk dengan jelas memberi tahu pengguna apa yang sebenarnya diharapkan darinya ketika ia (yang sering terjadi) melakukan sesuatu yang salah - dan melakukannya di tempat ini - di akhir pemrosesan metode posting</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paket kami</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Artikel ini menjelaskan skrip dasar untuk bekerja dengan Hobot pengiriman pesan teks. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika topiknya ternyata relevan, kami akan membagikan seluk beluk teknis lainnya dari kerangka kerja dan pengamatan kami dari praktik mengembangkan dan menggunakan bot telegram di artikel mendatang. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tautan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Memasang bot terlihat seperti ini: </font></font><code>npm i -s hobot</code><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repositori</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan langkah-langkah di README.MD dan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">bot Ready </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kotak pasir yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bekerja dalam produksi berdasarkan pada Hobot. </font><font style="vertical-align: inherit;">
Terima kasih atas perhatian Anda, saya akan senang mendengar pertanyaan Anda, saran atau ide untuk bot baru!</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488994/index.html">DDR5? Ya, kami jarang bertemu DDR4</a></li>
<li><a href="../id488998/index.html">Mengapa persyaratan AI hanya dapat memperburuk masalah</a></li>
<li><a href="../id489000/index.html">Cara merakit mitap keren: 16 tips dari tiga "mitapers serial". Acara pemimpin-TI # 1</a></li>
<li><a href="../id489002/index.html">Registri wheelset terdistribusi: pengalaman dengan Hyperledger Fabric</a></li>
<li><a href="../id489004/index.html">Ponsel dengan Disc Dialer</a></li>
<li><a href="../id489010/index.html">Kami berbagi lapisan data Rusia terbesar di pelatihan online dengan proyek-proyek dalam linguistik, personalisasi, peddesign, ML</a></li>
<li><a href="../id489012/index.html">Google Cloud Spanner: baik, buruk, jahat</a></li>
<li><a href="../id489014/index.html">Buku “Algoritma Sempurna. Algoritma Greedy dan Pemrograman Dinamis "</a></li>
<li><a href="../id489016/index.html">German Gref: “Kami mencoba mengorganisir diskusi tentang AGI, dan tidak ada satu pun ilmuwan yang menghargai diri sendiri yang datang ke sana”</a></li>
<li><a href="../id489020/index.html">Studi tentang satu berbahaya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>