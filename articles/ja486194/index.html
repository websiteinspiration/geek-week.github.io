<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⭐️ 🏻 🧑🏾‍🤝‍🧑🏾 Proxmox VEのバックアップについて 🤙🏾 🤷🏻 👊🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="記事では、「仮想化のマジック：入門コースのProxmoxではVE」、我々は成功し、それにストレージを接続し、サーバー上のハイパーバイザーをインストールし、基本的なセキュリティの世話をしたとしても、最初の仮想マシンを作成しました。ここでは、障害が発生した場合にサービスを常に復元できるようにするために実...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Proxmox VEのバックアップについて</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/486194/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wt/vx/xu/wtvxxuyee73gugficymc7t4x0zm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事では</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、「仮想化のマジック：入門コースのProxmoxではVE」、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我々は成功し、それにストレージを接続し、サーバー上のハイパーバイザーをインストールし、基本的なセキュリティの世話をしたとしても、最初の仮想マシンを作成しました。ここでは、障害が発生した場合にサービスを常に復元できるようにするために実行する必要がある最も基本的なタスクを実装する方法について説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
確立されたProxmoxツールを使用すると、データをバックアップするだけでなく、オペレーティングシステムの事前構成されたイメージのセットを作成して、迅速に展開できます。これは、必要に応じて数秒でサービス用の新しいサーバーを作成するのに役立つだけでなく、ダウンタイムを最小限に抑えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは明白であり、長い間公理であったため、バックアップを作成する必要については触れません。</font><font style="vertical-align: inherit;">いくつかの自明でないものと機能について詳しく説明します。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、バックアップ手順中にデータがどのように保存されるかを検討します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップアルゴリズム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、Proxmoxには、仮想マシンのバックアップを作成するための優れた人員配置ツールキットがあります。</font><font style="vertical-align: inherit;">これにより、仮想マシンのすべてのデータを簡単に保存でき、2つの圧縮メカニズムと、これらのコピーを作成するための3つの方法をサポートします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、圧縮メカニズムを調べてみましょう。</font></font><br>
<br>
<ol>
<li><b> LZO</b>.     ,     90- .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> </a> (  Proxmox  lzop).        . ,   ,     ,        .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GZIPの圧縮</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このアルゴリズムを使用して、バックアップは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phil Katz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって作成された強力なDeflateアルゴリズムを使用するGNU Zipユーティリティを使用して、その場で圧縮され</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">主な重点は、最大のデータ圧縮であり、バックアップによって占有されるディスク領域を削減します。</font><font style="vertical-align: inherit;">LZOとの主な違いは、圧縮/解凍手順にかなり長い時間がかかることです。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アーカイブモード</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxmoxは、システム管理者が選択できる3つのバックアップ方法を提供します。</font><font style="vertical-align: inherit;">それらを使用して、ダウンタイムの必要性とバックアップの信頼性の間の優先順位を決定することにより、必要な問題を解決できます。</font></font><br>
<br>
<ol>
<li><b> Snapshot ()</b>.       Live backup,          .       VM,       —    -         .  ,   ,      .     ,     ,    .</li>
<li><b> Suspend ()</b>.    «»  ,     .     ,        ,     . ,        ,    /  ,      . ,       .              .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストップモード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最も信頼性の高いバックアップ方法ですが、仮想マシンの完全なシャットダウンが必要です。</font><font style="vertical-align: inherit;">コマンドを送信して正常にシャットダウンし、停止後にバックアップを実行してから、仮想マシンをオンにするコマンドを発行します。</font><font style="vertical-align: inherit;">このアプローチによるエラーの数は最小限であり、ほとんどの場合ゼロに減少します。</font><font style="vertical-align: inherit;">この方法で作成されたバックアップは、ほとんど常に正しく展開されます。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップ手順を実行</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップするには：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要な仮想マシンに渡します。</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予約</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">項目を選択します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">今すぐ予約</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンをクリックします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ウィンドウが開き、今後のバックアップのオプションを選択できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/et/gn/fu/etgnfuz7yjw9dohf4ktcvphtxry.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ストレージとしては</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、前のパートで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">した</font></a><font style="vertical-align: inherit;">ものを示します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータを選択したら、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタン</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">クリックして</font><font style="vertical-align: inherit;">、バックアップが作成されるまで待ち</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TASK OK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という碑文で示され</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u-/8i/pc/u-8ipc1amu1z51u4ibgh9tjxs-o.png"></div><br>
</li>
</ol><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これで、仮想マシンのバックアップで作成されたアーカイブをサーバーからダウンロードできるようになります。</font><font style="vertical-align: inherit;">コピーの最も簡単で最も一般的な方法はSFTPです。</font><font style="vertical-align: inherit;">これを行うには、SFTPプロトコルを使用して機能する、人気のあるクロスプラットフォームFTPクライアントFileZillaを使用します。</font></font><br>
<br>
<ol>
<li>  <b></b>  IP-   ,   <b> </b>  root,   <b></b> — ,     ,    <b></b>  «22» (   ,     SSH-).</li>
<li>  <b> </b> ,      ,        ,   .</li>
<li>   <b>/mnt/storage</b>.         «dump».    :<ul>
<li><b>vzdump-qemu-_--.vma.gz</b>     GZIP;</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vzdump-qemu-machine_number-date-time.vma.lzo（</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LZOメソッドが選択されている場合）。</font></font></li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップをサーバーからすぐにダウンロードして、クラウドストレージなどの安全な場所に保存することをお勧めします。</font><font style="vertical-align: inherit;">Proxmoxにバンドルされている同名のユーティリティである解像度vmaでファイルを解凍すると、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fwの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張子が付いたファイルがに含まれ</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これらのファイルには以下が含まれます。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクイメージ。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -VM構成。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fw-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイアウォール設定。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップから復元</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンが誤って削除され、バックアップからの緊急復旧が必要な状況を考えます。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップがあるストレージを開きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンテンツ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]タブに移動します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的のコピーを選択し、[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">復元]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンをクリックします</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bg/ou/ts/bgoutsyb4clkt_qx4xy88avgtqq.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターゲットストレージと、プロセスの完了後にマシンに割り当てられるIDを指定します。</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">復元</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンをクリックします</font><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リカバリが完了すると、VMが使用可能なリストに表示されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想マシンの複製</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、企業が重要なサービスに変更を加える必要があるとします。</font><font style="vertical-align: inherit;">このような変更は、構成ファイルに多くの変更を加えることによって実装されます。</font><font style="vertical-align: inherit;">結果は予測できません。エラーが発生すると、サービスが失敗する可能性があります。</font><font style="vertical-align: inherit;">このような実験が実行中のサーバーに影響を与えないようにするには、仮想マシンのクローンを作成することをお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クローン作成メカニズムは、仮想サーバーの正確なコピーを作成し、メインサービスの操作に影響を与えずに変更を加えることができます。次に、変更が正常に適用されると、新しいVMが起動し、古いVMがシャットダウンします。このプロセスには、常に覚えておくべき機能があります。複製されたマシンでは、IPアドレスはソースVMとまったく同じになります。つまり、起動すると、アドレスの競合が発生します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような状況を回避する方法をお知らせします。クローン作成を実行する直前に、ネットワーク構成を変更する必要があります。これを行うには、IPアドレスを一時的に変更する必要がありますが、ネットワークサービスを再起動しないでください。メインマシンでクローンを作成したら、設定を元に戻し、クローンマシンで他のIPアドレスを指定する必要があります。したがって、異なるアドレスにある同じサーバーの2つのコピーを取得します。これにより、新しいサービスがすぐに導入されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このサービスがWebサーバーの場合は、DNSプロバイダーのAレコードを変更するだけで済みます。その後、このドメイン名に対するクライアント要求は、複製された仮想マシンのアドレスにすでに送信されます。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ところで、Selectelはすべての顧客に、NSサーバーに任意の数のドメインを無料で配置するサービスを提供しています。</font><font style="vertical-align: inherit;">レコード管理は、コントロールパネルと特別なAPIの両方を使用して実行されます。</font><font style="vertical-align: inherit;">詳細について</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ナレッジベース</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をご覧</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxmoxでのVMのクローン作成は非常に簡単なタスクです。</font><font style="vertical-align: inherit;">これを実行するには、次の手順を実行する必要があります。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要な車に行きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メニューから</font><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ] [ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クローン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]をクリックします</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開いたウィンドウで、Nameパラメーターを入力します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3n/on/wn/3nonwng-06gxpllialr7u_9ck2m.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クローンボタンを押して</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クローンし</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このツールを使用すると、ローカルサーバーだけでなく仮想マシンのコピーを作成できます。</font><font style="vertical-align: inherit;">複数の仮想化サーバーがクラスターに結合されている場合、このツールを使用すると、作成したコピーを目的の物理サーバーにすぐに移動できます。</font><font style="vertical-align: inherit;">便利な機能は、ディスクストレージの選択（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target Storage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パラメータ</font><font style="vertical-align: inherit;">）です。これは、仮想マシンをある物理メディアから別の物理メディアに移動するときに非常に便利です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想ドライブのフォーマット</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxmoxで使用されるドライブ形式について詳しく説明します。</font></font><br>
<br>
<ol>
<li><b>RAW</b>.     .       «  »    .    ,       mount   linux-.      «» ,        .<br>
<br>
     ,        ,             RAW (        ).</li>
<li><b>QEMU image format (qcow2)</b>. ,       .    ,             . ,    40  ,      2 ,         VM.        .<br>
<br>
       :        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=">  nbd</a>,     <b>qemu-nbd</b>,            .       ,   ,       .<br>
<br>
 ,    -      ,           .        ,     RAW.</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMwareイメージ形式（vmdk）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このフォーマットはVMware vSphereハイパーバイザーにネイティブであり、互換性のためにProxmoxに含まれています。</font><font style="vertical-align: inherit;">VMware仮想マシンをProxmoxインフラストラクチャに移行できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vmdkを継続的に使用することはお勧めしません。このフォーマットはProxmoxで最も遅いため、移行のみに適しています。</font><font style="vertical-align: inherit;">おそらく近い将来、この欠点は解消されるでしょう。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ディスクイメージを操作する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Proxmoxには、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qemu-img</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と呼ばれる非常に便利なユーティリティが含まれています</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その機能の1つは、仮想ディスクのイメージを変換することです。</font><font style="vertical-align: inherit;">使用するには、ハイパーバイザーコンソールを開き、次の形式でコマンドを実行します。</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img convert -f vmdk test.vmdk -O qcow2 test.qcow2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記の例では、と呼ばれるVMwareの仮想ドライブのVMDK画像</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テストを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変換される</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QCOW2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォーマット</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、最初のフォーマット選択の誤りを訂正する必要がある場合に非常に便利なコマンドです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じコマンドのおかげで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数を使用して目的のイメージを強制</font><b><font style="vertical-align: inherit;">でき</font></b><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img create -f raw test.raw 40G</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このようなコマンドを実行すると、</font><font style="vertical-align: inherit;">サイズが40 GBの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式</font><font style="vertical-align: inherit;">で</font><font style="vertical-align: inherit;">テストイメージが作成</font><font style="vertical-align: inherit;">されます。</font><font style="vertical-align: inherit;">現在は、どの仮想マシンへの接続にも適しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仮想ディスクのサイズを変更する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論として、何らかの理由でディスクイメージのスペースが十分ではなくなった場合に、ディスクイメージのサイズを増やす方法を示します。</font><font style="vertical-align: inherit;">これを行うには、resize引数を使用します。</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img resize -f raw test.raw 80G</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、イメージは80 GBのサイズになりました。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引数を使用して、画像に関する詳細情報を表示できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img info test.raw</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
イメージ拡張自体がパーティションのサイズを自動的に増加させないことを忘れないでください-それは単に利用可能な空き領域を追加するだけです。</font><font style="vertical-align: inherit;">セクションを拡大するには、次のコマンドを使用します。</font></font><br>
<br>
<pre><code class="plaintext hljs">resize2fs /dev/sda1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / sda1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は目的のパーティションです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バックアップを自動化</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
手動でバックアップを作成する方法は、非常に時間がかかり、多くの時間がかかります。</font><font style="vertical-align: inherit;">したがって、Proxmox VEには、スケジュールされた自動バックアップ用のツールが含まれています。</font><font style="vertical-align: inherit;">これを行う方法を検討してください：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハイパーバイザーのWebインターフェースを使用して、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アイテムを開きます</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">予約</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">項目を選択します</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">追加</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボタンをクリックします</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スケジューラーのパラメーターを設定します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5d/a0/tu/5da0tunglle5mwsvudggbwjyuhc.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有効にする]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チェックボックスをオンにします</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]ボタンを使用して変更を保存します</font><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、スケジューラは、指定されたスケジュールに基づいて、指定された正確な時刻にバックアッププログラムを自動的に開始します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンのバックアップとリカバリの定期的な方法を検討しました。それらを使用すると、問題なくすべてのデータを保存し、緊急時にそれらを緊急に復元できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、これが重要なデータを保存する唯一の方法ではありません。</font><font style="vertical-align: inherit;">Linuxをベースにした仮想サーバーのコンテンツの完全コピーおよび増分コピーを作成できる</font><font style="vertical-align: inherit;">ツールには、たとえば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duplicity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">など多くのツールがあり</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップ手順を実行するときは、ディスクサブシステムをアクティブにロードしていることを常に考慮する必要があります。</font><font style="vertical-align: inherit;">これに関して、マシン内でI / O操作を実行する際の遅延を回避するために、最小負荷時にこれらの手順を実行することをお勧めします。</font><font style="vertical-align: inherit;">ハイパーバイザーのWebインターフェイス（IO遅延パラメーター）から直接ディスク操作遅延のステータスを監視できます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486184/index.html">検索を効果的に使用する方法</a></li>
<li><a href="../ja486186/index.html">壊滅的なクラウド：仕組み</a></li>
<li><a href="../ja486188/index.html">PostgreSQL wal-gバックアップシステムの紹介</a></li>
<li><a href="../ja486190/index.html">Yandex.Cloud用にKubernetesでCSIドライバーを開発した経験</a></li>
<li><a href="../ja486192/index.html">サイバー詐欺師が携帯電話会社をハッキングして、加入者の電話番号にアクセスする</a></li>
<li><a href="../ja486198/index.html">話すのは難しいです。非プログラマーとのコミュニケーションに関するエッセイ</a></li>
<li><a href="../ja486200/index.html">Dockerのヒント：ジャンクからマシンをクリーンアップする</a></li>
<li><a href="../ja486202/index.html">AlpineはDockerビルドをPythonで50倍遅く収集し、イメージを2倍重い</a></li>
<li><a href="../ja486204/index.html">職業：システム管理者</a></li>
<li><a href="../ja486206/index.html">フリーランスやアウトソーシングでどんな種類の詐欺に遭遇したか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>