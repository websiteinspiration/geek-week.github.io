<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♓️ 👩🏼‍⚕️ 🧓🏿 So reduzieren Sie den Overhead beim Behandeln von Ausnahmen in C ++ 👩🏾‍🔬 💂 🥟</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Verarbeitung von Laufzeitfehlern ist in vielen Situationen sehr wichtig, die bei der Entwicklung von Software auftreten - von falschen Benutzerein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>So reduzieren Sie den Overhead beim Behandeln von Ausnahmen in C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/488244/"><img src="https://habrastorage.org/webt/ml/92/sj/ml92sjlj3hq1paudqwokbods74m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Verarbeitung von Laufzeitfehlern ist in vielen Situationen sehr wichtig, die bei der Entwicklung von Software auftreten - von falschen Benutzereingaben bis hin zu beschädigten Netzwerkpaketen. Die Anwendung sollte nicht abstürzen, wenn der Benutzer plötzlich PNG anstelle von PDF heruntergeladen oder das Netzwerkkabel beim Aktualisieren der Software abgezogen hat. Der Benutzer erwartet, dass das Programm unabhängig von den Ereignissen funktioniert und entweder Notfallsituationen im Hintergrund behandelt oder ihm anbietet, eine Option zur Lösung des Problems mithilfe einer Nachricht auszuwählen, die über eine benutzerfreundliche Oberfläche gesendet wird.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Behandlung von Ausnahmen kann eine verwirrende, komplexe Aufgabe sein und, die für viele C ++ - Entwickler von grundlegender Bedeutung ist, die Anwendung erheblich verlangsamen. Wie in vielen anderen Fällen gibt es jedoch verschiedene Möglichkeiten, dieses Problem zu lösen. Als Nächstes werden wir uns mit dem Ausnahmebehandlungsprozess in C ++ befassen, die Fallstricke behandeln und herausfinden, wie sich dies auf die Geschwindigkeit Ihrer Anwendung auswirken kann. Darüber hinaus werden Alternativen untersucht, mit denen der Overhead reduziert werden kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werde ich Sie nicht dringend bitten, die Ausnahmen nicht mehr vollständig zu verwenden. </font><font style="vertical-align: inherit;">Sie sollten angewendet werden, aber genau dann, wenn es unmöglich ist, sie zu vermeiden: Wie kann beispielsweise ein Fehler gemeldet werden, der im Konstruktor aufgetreten ist? </font><font style="vertical-align: inherit;">Wir werden hauptsächlich Ausnahmen in Betracht ziehen, um Laufzeitfehler zu behandeln. </font><font style="vertical-align: inherit;">Wenn Sie die Alternativen verwenden, über die wir sprechen werden, können Sie zuverlässigere und einfach zu wartende Anwendungen entwickeln.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schneller Leistungstest</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie viel langsamer sind Ausnahmen in C ++ im Vergleich zu den üblichen Mechanismen zur Steuerung des Programmfortschritts? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ausnahmen sind offensichtlich langsamer als einfache Unterbrechungs- oder Rückgabevorgänge. </font><font style="vertical-align: inherit;">Aber lassen Sie uns herausfinden, wie viel langsamer! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im folgenden Beispiel haben wir eine einfache Funktion geschrieben, die zufällig Zahlen generiert und auf der Grundlage der Überprüfung einer generierten Zahl eine Fehlermeldung ausgibt / nicht ausgibt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben verschiedene Implementierungsoptionen für die Fehlerbehandlung getestet:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wirf eine Ausnahme mit einem ganzzahligen Argument aus. </font><font style="vertical-align: inherit;">Obwohl dies in der Praxis nicht besonders angewendet wird, ist es der einfachste Weg, Ausnahmen in C ++ zu verwenden. </font><font style="vertical-align: inherit;">So werden wir übermäßige Komplexität bei der Implementierung unseres Tests los.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wirf std :: runtime_error aus, das eine Textnachricht senden kann. </font><font style="vertical-align: inherit;">Diese Option wird im Gegensatz zur vorherigen Option in realen Projekten viel häufiger verwendet. </font><font style="vertical-align: inherit;">Mal sehen, ob die zweite Option die Gemeinkosten im Vergleich zur ersten spürbar erhöht.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leere Rückgabe.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückgabe des C-Style-Int-Fehlercodes</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Tests durchzuführen, haben wir die einfache </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google-Benchmark-Bibliothek verwendet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sie führte jeden Test wiederholt in einem Zyklus durch. </font><font style="vertical-align: inherit;">Als nächstes werde ich beschreiben, wie alles passiert ist. </font><font style="vertical-align: inherit;">Ungeduldige Leser können sofort zu den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnissen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> springen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testcode </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unser superkomplexer Zufallszahlengenerator:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> randomRange = <span class="hljs-number">2</span>;  <span class="hljs-comment">//     0  2.</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> errorInt = <span class="hljs-number">0</span>; 	<span class="hljs-comment">//    ,    0.</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRandom</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> random() % randomRange;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testfunktionen:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 1.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithBasicException</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">throw</span> <span class="hljs-number">-2</span>;<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 2.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithMessageException</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"Halt! Who goes there?"</span>);<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 3.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithReturn</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span>;<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 4.</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exitWithErrorCode</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt können wir die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google-Benchmark-Bibliothek verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 1.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithBasicException</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">try</span> {<font></font>
        	exitWithBasicException();<font></font>
    	} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">int</span> ex) {
        	<span class="hljs-comment">//  ,    .</span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 2.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithMessageException</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">try</span> {<font></font>
        	exitWithMessageException();<font></font>
    	} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::runtime_error &amp;ex) {
        	<span class="hljs-comment">//  ,    </span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 3.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithReturn</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {<font></font>
    	exitWithReturn();<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 4.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithErrorCode</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">auto</span> err = exitWithErrorCode();
    	<span class="hljs-keyword">if</span> (err &lt; <span class="hljs-number">0</span>) {
        	<span class="hljs-comment">// `handle_error()` …  - </span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span><font></font>
BENCHMARK(BM_exitWithBasicException);<font></font>
BENCHMARK(BM_exitWithMessageException);<font></font>
BENCHMARK(BM_exitWithReturn);<font></font>
BENCHMARK(BM_exitWithErrorCode);<font></font>
<font></font>
<span class="hljs-comment">//  !</span><font></font>
BENCHMARK_MAIN();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für diejenigen, die das Schöne berühren möchten, haben wir den vollständigen Code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier veröffentlicht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ergebnisse</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Konsole werden je nach Kompilierungsoptionen unterschiedliche Testergebnisse </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">angezeigt: Debug -O0:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithBasicException     1407 ns         1407 ns       491232<font></font>
BM_exitWithMessageException   1605 ns         1605 ns       431393<font></font>
BM_exitWithReturn              142 ns          142 ns      5172121<font></font>
BM_exitWithErrorCode           144 ns          143 ns      5069378<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Release -O2:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithBasicException     1092 ns         1092 ns       630165<font></font>
BM_exitWithMessageException   1261 ns         1261 ns       547761<font></font>
BM_exitWithReturn             10.7 ns         10.7 ns     64519697<font></font>
BM_exitWithErrorCode          11.5 ns         11.5 ns     62180216<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Auf dem MacBook Pro 2.5GHz i7 2015 gestartet) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Ergebnisse sind erstaunlich! </font><font style="vertical-align: inherit;">Schauen Sie sich die große Lücke zwischen der Codegeschwindigkeit mit und ohne Ausnahmen an (leere Rückgabe und Fehlercode). </font><font style="vertical-align: inherit;">Und mit der Compiler-Optimierung ist diese Lücke noch größer! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zweifellos ist dies ein großartiger Test. </font><font style="vertical-align: inherit;">Der Compiler führt möglicherweise einige Codeoptimierungen für die Tests 3 und 4 durch, aber die Lücke ist trotzdem groß. </font><font style="vertical-align: inherit;">Auf diese Weise können wir den Overhead bei Verwendung von Ausnahmen abschätzen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank des Null-Kosten-Modells entsteht bei den meisten Implementierungen von Try-Blöcken in C ++ kein zusätzlicher Overhead. </font><font style="vertical-align: inherit;">Der Catch-Block arbeitet jedoch viel langsamer. </font><font style="vertical-align: inherit;">Anhand unseres einfachen Beispiels können wir sehen, wie langsam das Auslösen und Abfangen von Ausnahmen funktionieren kann. </font><font style="vertical-align: inherit;">Selbst auf einem so kleinen Call Stack! </font><font style="vertical-align: inherit;">Und mit zunehmender Stapeltiefe steigt der Overhead linear an. </font><font style="vertical-align: inherit;">Deshalb ist es so wichtig zu versuchen, die Ausnahme so nah wie möglich an dem Code zu fangen, der sie ausgelöst hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, wir haben herausgefunden, dass Ausnahmen langsam funktionieren. </font><font style="vertical-align: inherit;">Dann vielleicht aufhören? </font><font style="vertical-align: inherit;">Aber nicht alles ist so einfach.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum verwenden alle weiterhin Ausnahmen?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Vorteile von Ausnahmen sind im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technischen Bericht zur C ++ - Leistung (Kapitel 5.4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gut dokumentiert </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<blockquote>        ,      ,     errorCode- [  ],       .  ,                .          ,              .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Noch einmal: Die Hauptidee ist die Unfähigkeit, die Ausnahme zu ignorieren und zu vergessen. Dies macht Ausnahmen zu einem sehr leistungsfähigen integrierten C ++ - Tool, das die schwierige Verarbeitung durch Fehlercode ersetzen kann, den wir von der C-Sprache geerbt haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus sind Ausnahmen in Situationen sehr nützlich, die nicht direkt mit dem Programm zusammenhängen, z. B. „Die Festplatte ist voll "Oder" Netzwerkkabel ist beschädigt. " In solchen Situationen sind Ausnahmen ideal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber wie geht man am besten mit der Fehlerbehandlung um, die direkt mit dem Programm zusammenhängt? </font><font style="vertical-align: inherit;">In jedem Fall benötigen wir einen Mechanismus, der dem Entwickler eindeutig anzeigt, dass er den Fehler überprüfen, ihm ausreichende Informationen darüber (falls er aufgetreten ist) zur Verfügung stellen und ihn in Form einer Nachricht oder in einem anderen Format übertragen soll. </font><font style="vertical-align: inherit;">Es scheint, dass wir wieder zu den eingebauten Ausnahmen zurückkehren, aber gerade jetzt werden wir über eine alternative Lösung sprechen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erwartet</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ausnahmen haben neben dem Overhead einen weiteren Nachteil: Sie arbeiten nacheinander: Eine Ausnahme muss abgefangen und verarbeitet werden, sobald sie ausgelöst wird. Es ist unmöglich, sie auf später zu verschieben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Was können wir dagegen tun? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellt sich heraus, dass es einen Weg gibt. Professor Andrei Alexandrescu hat für uns eine spezielle Klasse namens Expected entwickelt. Sie können damit ein Objekt der Klasse T (wenn alles in Ordnung ist) oder ein Objekt der Klasse Exception (wenn ein Fehler auftritt) erstellen. Das heißt, entweder dies oder das. Oder oder. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Wesentlichen ist dies ein Wrapper über die Datenstruktur, die in C ++ als Union bezeichnet wird. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deshalb haben wir seine Idee wie folgt illustriert:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>&gt;
<span class="hljs-title">class</span> <span class="hljs-title">Expected</span> {</span>
<span class="hljs-keyword">private</span>:
	<span class="hljs-comment">//  union:  ,   .     </span>
	<span class="hljs-keyword">union</span> {<font></font>
    	T value;<font></font>
    	Exception exception;<font></font>
	};<font></font>
<font></font>
<span class="hljs-keyword">public</span>:
	<span class="hljs-comment">//    `Expected`   T,   .</span>
	Expected(<span class="hljs-keyword">const</span> T&amp; value) ...<font></font>
<font></font>
	<span class="hljs-comment">//    `Expected`   Exception,  -   </span>
	Expected(<span class="hljs-keyword">const</span> Exception&amp; ex) ...<font></font>
<font></font>
	<span class="hljs-comment">//    :    </span>
	<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hasError</span><span class="hljs-params">()</span> ...

	<span class="hljs-comment">//   T</span>
	T <span class="hljs-title">value</span><span class="hljs-params">()</span> ...

	<span class="hljs-comment">//        (  Exception)</span>
	Exception <span class="hljs-title">error</span><span class="hljs-params">()</span> ...
}</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine vollständige Umsetzung wird sicherlich schwieriger. </font><font style="vertical-align: inherit;">Die Hauptidee von Expected ist jedoch, dass wir im selben Objekt (Expected &amp; e) Daten für den regulären Betrieb des Programms (mit dem uns bekannten Typ und Format: T &amp; value) und Fehlerdaten (empfangen können) empfangen können. Ausnahme &amp; ex). </font><font style="vertical-align: inherit;">Daher ist es sehr einfach zu überprüfen, was noch einmal zu uns gekommen ist (z. B. mit der hasError-Methode). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt wird uns jedoch niemand mehr zwingen, die Ausnahme in dieser Sekunde richtig zu behandeln. </font><font style="vertical-align: inherit;">Wir werden keinen throw () -Aufruf oder Catch-Block haben. </font><font style="vertical-align: inherit;">Stattdessen können wir nach Belieben auf unser Exception-Objekt verweisen.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leistungstest für erwartet</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden ähnliche Leistungstests für unsere neue Klasse schreiben:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 5. Expected! Testcase 5 </span><font></font>
<font></font>
<span class="hljs-function">Expected&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">exitWithExpected</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"Halt! If you want..."</span>);  <span class="hljs-comment">//  : return,   throw!</span><font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Benchmark.</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithExpected</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">auto</span> expected = exitWithExpected();<font></font>
<font></font>
    	<span class="hljs-keyword">if</span> (expected.hasError()){
        	<span class="hljs-comment">// Handle in our own time.</span><font></font>
    	}<font></font>
    	<span class="hljs-comment">// Or we can use the value...</span>
    	<span class="hljs-comment">// else {</span>
    	<span class="hljs-comment">// 	doSomethingInteresting(expected.value());</span>
    	<span class="hljs-comment">// }</span><font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span><font></font>
BENCHMARK(BM_exitWithExpected);<font></font>
<font></font>
<span class="hljs-comment">// </span><font></font>
BENCHMARK_MAIN();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trommelwirbel!!! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -O0:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithExpected            147 ns          147 ns      4685942<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Release -O2:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithExpected           57.5 ns         57.5 ns     11873261<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nicht schlecht! </font><font style="vertical-align: inherit;">Für unseren std :: runtime_error ohne Optimierung konnten wir die Betriebszeit von 1605 auf 147 Nanosekunden reduzieren. </font><font style="vertical-align: inherit;">Mit der Optimierung sieht alles noch besser aus: ein Rückgang von 1261 auf 57,5 ​​Nanosekunden. </font><font style="vertical-align: inherit;">Dies ist mehr als 10-mal schneller als mit -O0 und mehr als 20-mal schneller als mit -O2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Vergleich zu den integrierten Ausnahmen arbeitet Expected um ein Vielfaches schneller und bietet uns außerdem einen flexibleren Fehlerbehandlungsmechanismus. </font><font style="vertical-align: inherit;">Darüber hinaus weist es eine semantische Reinheit auf und macht Fehlermeldungen überflüssig und beraubt Benutzer des Qualitätsfeedbacks.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ausnahmen sind nicht absolut böse. </font><font style="vertical-align: inherit;">Und manchmal ist es überhaupt gut, da sie für ihren beabsichtigten Zweck äußerst effektiv arbeiten: unter außergewöhnlichen Umständen. </font><font style="vertical-align: inherit;">Wir stoßen erst dann auf Probleme, wenn wir sie dort einsetzen, wo viel effektivere Lösungen verfügbar sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unsere Tests haben trotz der Tatsache, dass sie recht einfach sind, gezeigt: Sie können den Overhead erheblich reduzieren, wenn Sie keine Ausnahmen abfangen (langsamer Fangblock), wenn es ausreicht, einfach Daten zu senden (mit return).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel haben wir auch kurz die Expected-Klasse vorgestellt und wie wir sie verwenden können, um den Fehlerbehandlungsprozess zu beschleunigen. </font><font style="vertical-align: inherit;">Expected macht es einfach, den Fortschritt des Programms zu verfolgen, und ermöglicht es uns, flexibler zu sein und Nachrichten an Benutzer und Entwickler zu senden.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de488230/index.html">Einführung in SSD. Teil 3. Formfaktor</a></li>
<li><a href="../de488232/index.html">ca. Tech: QATOK # 2</a></li>
<li><a href="../de488234/index.html">Verwenden von QubesOS für Windows 7</a></li>
<li><a href="../de488240/index.html">Ein endloser Kreislauf, der nicht war: die Geschichte des Heiligen Grals</a></li>
<li><a href="../de488242/index.html">VueJS + TS Projektintegration mit SonarQube</a></li>
<li><a href="../de488246/index.html">VoiceOver unter iOS: Jedes Steuerelement verhält sich anders</a></li>
<li><a href="../de488250/index.html">Zur Frage von Linux (L)</a></li>
<li><a href="../de488252/index.html">So senken Sie die Kosten für die Entwicklung neuer Produkte mit SLS</a></li>
<li><a href="../de488254/index.html">Verteilungsmodell für die Verantwortung für die Cloud-Sicherheit</a></li>
<li><a href="../de488256/index.html">Самодельный рекуператор для загородного дома с КПД 80%</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>