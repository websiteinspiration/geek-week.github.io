<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎎 🤯 👩🏽‍🤝‍👨🏻 トップレベルシステムでのLinuxデバイスハードウェアドングル認証 🧑🏿‍🤝‍🧑🏾 🚋 🍬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="産業用IoTは、産業施設、建物、ビジネス施設のエンジニアリングシステムの監視、スケジューリング、自動化です。さまざまなパラメーターのセンサー、メーター、およびコントローラーは、これらのオブジェクトからデータを収集します。たとえば、サーバールームの温度と湿度、アパートの建物の水道メーター、部屋の二酸化...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>トップレベルシステムでのLinuxデバイスハードウェアドングル認証</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/476304/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">産業用IoTは、産業施設、建物、ビジネス施設のエンジニアリングシステムの監視、スケジューリング、自動化です。さまざまなパラメーターのセンサー、メーター、およびコントローラーは、これらのオブジェクトからデータを収集します。たとえば、サーバールームの温度と湿度、アパートの建物の水道メーター、部屋の二酸化炭素レベルなどです。コントローラはこの情報を処理し、すべてを「クラウド」に送信します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wiren Boardは、産業用IoT用のLinuxコントローラーを製造しています。デバイスは油田や銀行の支店からデータを収集し、サーバーやスーパーマーケットの微気候を監視します。コントローラは、会社のパートナーのトップレベルシステムと統合されます。システムはデバイスを認証します-彼らは彼らが彼らのセンサーと話しているのであって、他の誰かと話しているのではないことを理解し、そして彼らは承認します。この段階で問題が発生します-数千のコントローラー、数百の顧客がいますが、単一の統合システムはありません。ログイン/パスワードのペアなどの単純な従来の方法は、攻撃に対して脆弱であり、展開が不便です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/xm/mt/skxmmtcf6uhcrlm0xkcqilqwjuo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、同社はハードウェアキーを使用するトップレベルシステムでの認証を開発しました。これは、キーを格納するためのハードウェア保護要素を使用する標準の非対称暗号に基づいています。</font><font style="vertical-align: inherit;">今では、統合された統合システムは必要ありません。認証と承認は保護されており、そのまま使用できます。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Evgeny Boger</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、これを行う方法を教えてくれます。</font><font style="vertical-align: inherit;">「暗号化チップ」をどのように選択したか、どのようにハードウェアとLinuxにねじ込んだか、一般的なライブラリとソフトウェアをどのようにして作り上げたか。</font><font style="vertical-align: inherit;">展開に特に重点を置いています。本番環境でのデバイスの初期化の導入、他の誰かの、クローズされたものを含む、さまざまなトップレベルソフトウェアのサポートの導入。</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">スピーカーについて：</font></font></b> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユージーンボーガー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">evgeny_boger</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）-Wiren BoardのCTOおよび共同創設者。</font><font style="vertical-align: inherit;">彼は組み込みシステム、特に組み込みLinuxに従事しています。</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/tbXmNAs5IrM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、私たちが何をしているか、そしてこの問題はどこから来たのでしょうか。</font><font style="vertical-align: inherit;">Wiren Boardでは、ロシアの機器を設計および製造しています。</font><font style="vertical-align: inherit;">以前はM2Mと呼ばれていましたが、現在は産業用IoTです。</font><font style="vertical-align: inherit;">これはエンジニアリングシステムの構築、監視、スケジューリングの自動化です。</font><font style="vertical-align: inherit;">簡単に言うと、すべての作業は次のようになります。さまざまなパラメーターのセンサー、アクチュエーター、カウンター、コントローラー（エッジコンピューティングまたはIoTゲートウェイ）は、オブジェクトからさまざまなデータを収集し、それらを処理してローカルロジックを実行してから、1つの大きなディスパッチ、監視、または制御システムに収集します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ns/fh/xa/nsfhxa9qezcmcuuc9y8kijenyhw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一部の競合他社とは異なり、私たちはエコシステム全体を持っていません。</font><font style="vertical-align: inherit;">私たちは、パートナーのいくつかのトップレベルのシステムと統合する機器を製造しています。</font><font style="vertical-align: inherit;">多くのパートナー企業があり、彼らは責任を共有します。</font><font style="vertical-align: inherit;">優れた技術的手段がなければ、統合は機能しません。交渉することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの問題を解決するには、2つの簡単な解決策があります。</font><font style="vertical-align: inherit;">1つは</font><font style="vertical-align: inherit;">、すべて</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">のユーザー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><b><font style="vertical-align: inherit;">行うように、クライアントにユーザー名/パスワードを提供することです</font></b><font style="vertical-align: inherit;">。2つ目は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、職場で「秘密」</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">生成して縫合すること</font></b><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">どちらのオプションも適していませんでした。その理由を説明します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シンプルなソリューション</font></font></h2><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初の解決策は、ユーザー名とパスワードをクライアントに発行することです</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。私たち全員が最近までそうしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムにデータを送信するデバイスを認証するために、秘密鍵を作成することができます-条件付きログイン/パスワード（「秘密」）。これは、コントローラーおよび複数のコントローラーからデータを収集するトップレベルのシステムで一般的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いくつかのユーザー名/パスワード（一般的な「秘密」）をクライアント（会社または人）に何らかの形で与える必要があります。誰かが秘密のペアを生成し、電子メールで送信し、アカウント番号でクライアントを認証する必要があります。これは標準的な手順です-低技術。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。そのようなシステムがたくさんあるということです。私たちのクライアントと彼は私たちのパートナーのシステムにデータを送ることができます。これは、すべての関係者間の複雑な相互作用です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くのシステムの問題に加えて、他にもあります。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悪い配達および顧客への配達</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログインとパスワードはサーバーに保存されます</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ハッシュも保存すると、リークから少し保護されます。</font><font style="vertical-align: inherit;">しかし、それでも、すべてのクライアントコントローラーの秘密キーがサーバーに格納されていると、不快感が生じます。</font><font style="vertical-align: inherit;">それらのいくつかは重要なタスクを扱うことができます：屋外の照明、石油掘削装置の監視。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス間の同期</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">損失の回復</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">クライアントがコントローラのメモリを消去したときに失われた場合の対処方法は明確ではありません。どのメモリに書き込む必要がありますか？</font><font style="vertical-align: inherit;">あなたはそれをもう一度繰り返す必要があります。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳細のコピーに対する保護</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">顧客にサービスを提供し、サブスクリプション料金を請求する有料監視システムがあります。</font><font style="vertical-align: inherit;">エンドクライアントが何らかの形でシステムをバイパスできるようにしたくない-一度支払うだけで、2つ使用する。</font></font><br>
</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2番目の解決策は、本番環境で「秘密」を生成して縫合すること</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは、以前のソリューションの改善です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スキームは次のとおりです。私たちは、コントローラのメーカーとして、すべての人のために事前に生成されたユーザー名とパスワードをシステムに縫い付け、機器に入力します。</font><font style="vertical-align: inherit;">機器からのログインとパスワードは読み取りも変更もできません。</font><font style="vertical-align: inherit;">これは、人とのやり取りを必要としないため、前のオプションよりも優れています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最初の問題を除いてすべての問題は残っていますが、主な問題は</font><b><font style="vertical-align: inherit;">サービスとイントラネット間</font></b><font style="vertical-align: inherit;">の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同期です</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">多くのサービスがあり、それらを同期する方法は明確ではありません-このため、2番目のソリューションを実装できませんでした。</font><font style="vertical-align: inherit;">閉じたネットワークで機器を使用するクライアントがいます。</font><font style="vertical-align: inherit;">新しいコントローラをリリースし、クライアントに販売しました。そのシステムは閉鎖されています。</font><font style="vertical-align: inherit;">設定され、1度だけ機能し、「秘密」をさらに伝えることは困難です。</font><font style="vertical-align: inherit;">バッチでレポートしますか？</font><font style="vertical-align: inherit;">技術的には単純ですが、組織ではすべてが複雑です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらのソリューションも私たちに適していませんでした。</font><font style="vertical-align: inherit;">したがって、別の方法を選択することにしました。</font><font style="vertical-align: inherit;">しかしその前に、彼らは一般的なタスクと目標を概説することに決めました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タスクと目標</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の一般的なタスク。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、ディスパッチシステムに正確に接続しているトップレベルシステムに誰が話しているのかを理解する方法です。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証は、アクセス権の付与や制限ではなく、誰が私たちと話しているのかを理解する方法です。</font></font></blockquote><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データを送信するタスク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちのコントローラーは、特別なタスク用に設計されたLinuxコンピューターです。</font><font style="vertical-align: inherit;">トップレベルのシステムにデータを送信し、VPN経由で接続するために必要です。</font><font style="vertical-align: inherit;">同時に、ディスパッチがそのまま使用できるようにしたい-顧客やシステムのエンドユーザーと私たちおよび顧客との設定ややり取りなし。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他のタスク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは信頼できる接続、データチャネルの暗号化ですが、別の問題は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">承認</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">承認タスクは外部サービスに関連付けられており、3つの部分に分かれています。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料のメーカーサービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">デバイスのシリアル番号によるアクセスを提供します。</font></font><br>
</li>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パートナーのサービス</font><b><font style="vertical-align: inherit;">のシリアル番号のホワイトリスト</font></b><font style="vertical-align: inherit;"> -購入とクライアントのアカウントへのアクセスをリンクします。</font></font><br>
</li>
<li><b></b>.     &nbsp; ,   &nbsp;.<br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目標は、問題を解決するときに達成したいことです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客への発行と配達</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。人の参加なしで-情報は生産中のロボットによって縫い付けられます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">損失の回復</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。秘密の詳細が失われないようにしてください。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生産からサービスへの配送</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。私たちはそれなしでやりたいので、あなたはサービスに何も提供する必要はありません。新しい機器を発売するとき、これらのデバイスを認証する必要があるすべてのサービスのデータベースを更新する必要はありません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー上のストレージ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。何も保管しないことをお勧めします。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスとイントラネット間の同期</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。また、何も保存しないため、何も同期しないことをお勧めします。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詳細のコピーに対する保護</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">私たちはお金がかかる秘密を求めています。無料でコピーして受け取ることは不可能でした。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デジタル署名が救急に駆けつける</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">電子デジタル署名（EDS）は、すべてが機能するテクノロジです。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは通常の署名のようなもので、デジタルのみです。</font><font style="vertical-align: inherit;">EDSは簡単に確認できますが、偽造するのは困難です。</font><font style="vertical-align: inherit;">暗号化のよく知られている真実は数十年前のものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
電子署名は、秘密の秘密鍵（秘密鍵）を知っている場合にメッセージでカウントできるものです。</font><font style="vertical-align: inherit;">公開鍵を知っていれば、メッセージの電子署名が正しいことを簡単に確認できます。</font><font style="vertical-align: inherit;">名前は明らかです。一般にすべての人に伝えることが習慣であり、秘密は署名する人にのみです。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべての署名と鍵は単なる数字です。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの場合、それは32バイトのデータであり、数学的な「魔法」で機能します。</font><font style="vertical-align: inherit;">数学では、署名の検証は簡単ですが、偽造は困難です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
署名ECDSA-256 + SHA-256を使用します。</font></font><br>
<br>
<ul>
<li><code>e = HASH(m)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-暗号化ハッシュ関数はメッセージmを不可逆的に数値eに変換します。</font></font><br>
</li>
<li><code>private key (dA)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-乱数;</font></font><br>
</li>
<li><code>public key (QA)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-秘密鍵から生成されますが、その逆は生成されません。</font></font><br>
</li>
<li><code>signature (r,s) = sign(private key, e)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-署名;</font></font><br>
</li>
<li><code>verify(public key, signature, e)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-署名の検証。</font></font><br>
</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDS認証。</font><font style="vertical-align: inherit;">初挑戦</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトリッキーなメカニズムを使用して、私たちのタスクに何ができるでしょうか？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客への発行と配達</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">本番環境のデバイスごとにランダムな秘密鍵を生成します。</font><font style="vertical-align: inherit;">私たちは彼のことすら知らないので、誰にも言いません。デバイスに書き込みます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生産からサービスへの配送</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、サービスの認証にこのデバイスの公開鍵のみを使用します。</font><font style="vertical-align: inherit;">サービスでは、パスワードの代わりに公開鍵のリストのみを保存します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準ヘルスチェックアルゴリズム：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービスはランダムなメッセージをコントローラーに送信します&nbsp; </font></font><code>m</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラー</font></font><code>sign(private key, m)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラは署名をサービスに送信します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サービス：</font></font><code>verify(public key, signature, m)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法で決定した唯一のことは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、サービスの一般的な「秘密」を</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オープンな形式またはキャッシュされた形式で</font><b><font style="vertical-align: inherit;">保存しなくなった</font></b><font style="vertical-align: inherit;">こと</font><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">これは私たちが望むものではありません。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDS認証。</font><font style="vertical-align: inherit;">2回目の試み</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービスに何かを保存したくない。これを実現するために、デバイスに公開鍵をサービスに送信させることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最終段階で、2つの問題を解決しました。 1つ目</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、サービスのキーが提供されていること</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><b><font style="vertical-align: inherit;">確認しました</font></b><font style="vertical-align: inherit;">。公開鍵があります。つまり、秘密鍵も作成しました。 2つ目- </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスが</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> USBフラッシュドライブのどこかにある</font><b><font style="vertical-align: inherit;">秘密キーを所有</font></b><font style="vertical-align: inherit;">していることを確認しました</font><font style="vertical-align: inherit;">。デバイスが何かに署名できる場合、そのデバイスには秘密鍵があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、デバイスは公開鍵もサービスに送信します。誰も彼を傍受していないこと、彼を偽造していないこと、すべてが機能していることを確認する方法</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開鍵の検証</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">自分用にもう1つの公開鍵を作成します。</font><font style="vertical-align: inherit;">彼はメーカーとして私たちの鍵となります。</font><font style="vertical-align: inherit;">これは、ルートキー「ルートプライベートキー+パブリックキー」です。</font><font style="vertical-align: inherit;">このルート秘密鍵を本番環境で使用して、デバイスの公開鍵に署名し、この署名をデバイスに保存します。</font><font style="vertical-align: inherit;">デバイスは、公開鍵とその公開鍵の署名をサービスに送信する必要があります。</font><font style="vertical-align: inherit;">これで、サービスはデバイスの公開鍵を確認できます。</font><font style="vertical-align: inherit;">ルートキー（ルート秘密キー）で署名されている場合は、このキーを発行しました。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メーカーのみ-署名を作成してデバイスに保存できますが、すべてをチェックします。 </font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開鍵は、「お問い合わせ」セクションのサイトで公開しています。</font><font style="vertical-align: inherit;">誰でもそれを取得して、デバイスをサービスに送信したデバイスの公開鍵を確認できます。</font><font style="vertical-align: inherit;">次に、デバイス自体に独自の秘密鍵があることを確認できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的なアルゴリズムは次のようになります。</font></font><br>
<br>
<ul>
<li><code>(once) random root private key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><br>
</li>
<li><code>factory: random device private key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><br>
</li>
<li><code>factory: sign(root private key, device public key) = signature_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><br>
</li>
<li><code>device-&gt;service:  device public key + signature_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font><br>
</li>
<li><code>service: verify(root public key, signature_1, device public key)?</code><br>
</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2回目の試行結果</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアントへの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配信</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関する</font><font style="vertical-align: inherit;">
問題を解決しまし&nbsp; </font><font style="vertical-align: inherit;">た。情報は本番サイトで縫製されており、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">復元する必要は</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり&nbsp; </font><b><font style="vertical-align: inherit;">ません</font></b><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">サービス</font></b><font style="vertical-align: inherit;">に保存する必要があるのはメーカーの公開鍵だけなので、</font><b><font style="vertical-align: inherit;">トップレベルのサービス</font></b><font style="vertical-align: inherit;">に</font><b><font style="vertical-align: inherit;">「シークレット」を提供する</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
という問題を解決することが重要です&nbsp; </font><font style="vertical-align: inherit;">。キー全体は33バイトです。彼らの助けと数学的魔法を使えば、引き続きハンドシェイク接続を確立し、デバイスに対応する秘密鍵があることを確認できます。</font><b><font style="vertical-align: inherit;">サーバーに</font></b><font style="vertical-align: inherit;">は、製造元キー（ルート公開キー）のみを保存</font><b><font style="vertical-align: inherit;">します</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">すでに説明したように、</font><b><font style="vertical-align: inherit;">サービスとイントラネットの間の同期</font></b><font style="vertical-align: inherit;">はありません。また、</font><b><font style="vertical-align: inherit;">詳細のコピーに対する保護</font></b><font style="vertical-align: inherit;">もありません</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちが忘れていたのは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">だけです&nbsp; </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">デバイスが秘密キーを送信し、私たちがそれを実行して発行したことを確認し、デバイスがそれを所有していることを確認しました。</font><font style="vertical-align: inherit;">しかし、私たちはこのデバイスが何であるかを知りません、そして私たちは何千ものそれらを生産します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、「証明書」と呼ばれるトリックを適用しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">認証と証明書</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このステップでは、署名とそのチェックを含むすべての数学の魔法の中で、追加の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、つまり</font><b><font style="vertical-align: inherit;">証明書</font></b><font style="vertical-align: inherit;">を追加</font><b><font style="vertical-align: inherit;">します</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これを行うには、公開鍵（デバイスの公開鍵）だけでなく、追加情報を含む鍵を工場で署名します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの場合の追加情報。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">製造日とメーカー。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モデルとハードウェア構成。 </font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスを認証できるシリアル番号。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">オプション：ハードウェアとソフトウェア。</font><font style="vertical-align: inherit;">異なる構成は互いに物理的に異なることはありませんが、証明書にはクライアントが支払った金額に関する情報が含まれています。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顧客名と口座番号。 </font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべての情報に、プロデューサーキー（ルートパブリックキー）を使用して公開キーと共に署名します。</font><font style="vertical-align: inherit;">その後、情報はサービスに送信され、サービスが正しいことを確認できるようになります。</font><font style="vertical-align: inherit;">これらは私たちとパートナーのサービスであるため、私たちを信頼しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目標ステータス</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
情報も工場でステッチされ、&nbsp; </font><font style="vertical-align: inherit;">サービスへの</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配信</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は必要ありません。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はメーカーのキーのみ</font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">保存します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">損失の回復</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。証明書のすべての情報をデバイスのフラッシュメモリに縫い付けます。理論的には、誤ってまたは意図的に削除される可能性がありますが、証明書のこの情報には秘密はありません。署名自体も秘密ではありません。公開鍵と私たちの鍵による署名があります。証明書の唯一の秘密は、さまざまなオプションを持つデバイスの販売量です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書は工場で保管され、紛失した場合はクライアントに送信できます。</font><font style="vertical-align: inherit;">クライアントがメモリのサービスエリアを明確に消去することはめったにありません。</font><font style="vertical-align: inherit;">通常、これはデバイスの回復手順の間に行われます。デバイスはクライアントから到着し、初期化を完全に通過し、すべてが消去され、再度ダウンロードされ、証明書がファクトリデータベースからコピーされます。</font><font style="vertical-align: inherit;">紛失した場合</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">復旧</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font><b><font style="vertical-align: inherit;">サービス間の</font></b><font style="vertical-align: inherit;">コピーや</font><b><font style="vertical-align: inherit;">同期</font></b><font style="vertical-align: inherit;">に対する&nbsp; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保護</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はありません</font><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">認証段階で</font></b><font style="vertical-align: inherit;">、証明書を受け取って検証します。</font><font style="vertical-align: inherit;">私たちはそれがどのようなデバイスであるかを理解しています-私たちは、メーカー、モデル、シリアル番号、彼ができることとできないことを知っています。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ログインする</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
証明書を使用すると、認証用の情報を保存できます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無料のメーカーサービス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。デバイスのシリアル番号がわかれば、全員にアクセス権を与えることができます。当社のサービスでは、すべての基本顧客にアクセス権を付与しています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シリアル番号のホワイトリスト</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。パートナーのサービスについては、シリアル番号のホワイトリストを使用してテーブルを作成できます。「クライアントは、彼のアカウントに関連付けられているそのようなシリアル番号を持つ2つのコントローラーを私たちから簡単に購入できます」</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ライセンス</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。事前に何かを販売</font><font style="vertical-align: inherit;">し、証明書で指定さ</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れたオプション（</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムXのライセンスを持つコントローラー）に</font><b><font style="vertical-align: inherit;">基づいて</font></b><font style="vertical-align: inherit;">アクセス</font><b><font style="vertical-align: inherit;">を</font></b><font style="vertical-align: inherit;">許可または拒否できます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サービス、メーカー、またはシステムのメーカーの間に共通の基盤はありません。</font><font style="vertical-align: inherit;">すべてが、システムで認証されたときに、メーカーとして署名されたコントローラーからの情報に排他的に作用します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中間証明書</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
道路で解決したもう1つの技術的な問題。</font><font style="vertical-align: inherit;">先ほど説明したスキームには、製造元のルート証明書-ルート秘密鍵があります。</font><font style="vertical-align: inherit;">デバイスを作成するたびに物理的に必要です。</font><font style="vertical-align: inherit;">しかし、多くのデバイスがある場合、このキーは限られた人々しかアクセスできないようにする必要があります。</font><font style="vertical-align: inherit;">これを失うと、すべてのサービスの公開鍵を更新する必要があり、攻撃者に届かないためです。</font><font style="vertical-align: inherit;">これらは組織上の大きな問題です。</font><font style="vertical-align: inherit;">しかし、解決策があります。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紛失するのがそれほど怖くないデバイスのバッチに中間キーを導入します。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じことをしましたが、チェーンだけが長くなっています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x-/mb/s3/x-mbs3xfmihxr-qjdmpm7f5buey.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
製造業者の証明書を使用して、中間キーに署名します。</font><font style="vertical-align: inherit;">物理的には、これは「フラッシュドライブ」であり、工場の監督に1日間与えられます。</font><font style="vertical-align: inherit;">ハードウェアは、キーが署名できるデバイスの数を制限します。</font><font style="vertical-align: inherit;">図の中央に中間証明書を追加しましたが、それ以外は何も変更されていません。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全なキーストア</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべて</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">において、デバイスの秘密鍵に対する</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">十分な</font><b><font style="vertical-align: inherit;">保護</font></b><font style="vertical-align: inherit;">はありません。</font><font style="vertical-align: inherit;">&nbsp;それは、USBフラッシュドライブにあるファイルです。</font><font style="vertical-align: inherit;">攻撃者はそれをコピーできますが、ほとんどの場合、それを失うか、誤ってアクセスを開きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理想的な場合は、デバイスの秘密鍵がコピーされないように保護することをお勧めします-ブラックボックスに入れてください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ブラックボックスは4つの操作を実行します。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求に応じて内部的にキーを生成しますが、与えません。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開鍵を与える;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メッセージに署名する</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">署名を検証します。</font></font><br>
</li>
</ul><br>
<img src="https://habrastorage.org/webt/by/ck/zf/byckzfred-odhrigx-ayq2gkytk.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">署名を検証するには、公開鍵だけが必要なので、3つの操作で十分です。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の理解では、これはハードウェアソリューションであり、できればプロセッサとは別のものである必要があります。</font><font style="vertical-align: inherit;">いくつかのオプションがありますが、最善の方法は</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、SoC内また</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は個別のチップとしての</font><b><font style="vertical-align: inherit;">特別な暗号化プロセッサです</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検討した最初のブラックボックスオプションは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">するNXP i.mx 6、7、8プロセッサ</font><font style="vertical-align: inherit;">の</font><b><font style="vertical-align: inherit;">CAAMモジュールです</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">問題は、プロセッサのブートROMにプログラムで実装されていることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バグが含まれている可能性があり、他のプロセッサ機能を通じて発見されたり悪用されたりする可能性もあります。</font><font style="vertical-align: inherit;">数年前、このモジュールに穴が見つかり、ファームウェアをダウンロードするときに署名検証をバイパスすることが可能になりました。</font><font style="vertical-align: inherit;">これは必要な機能ではありませんが、堆積物は残ります。</font><font style="vertical-align: inherit;">別の問題は、このモジュールを搭載したプロセッサーをロシアに輸入するのが難しいことです;彼らは書類に記入する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、別のチップを使用しました。</font><font style="vertical-align: inherit;">私は正直に認めます、私たちがロシアにそれをもたらすことができないならば、我々は何かを思い付くでしょう-チップは小さいです、それは1ドルの費用がかかるという事実を頼りにしました。</font><font style="vertical-align: inherit;">しかし、すべてがうまくいった-彼らは</font><font style="vertical-align: inherit;">すでにすべての論文を持って</font><font style="vertical-align: inherit;">いる</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microchip ATECC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チップを見つけた</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロチップATECC608A</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、1ペニーの費用がかかる別個の小さなチップです。</font><font style="vertical-align: inherit;">チップはI2Cを介して接続されます。これは、プロセッサの2つの「レッグ」であり、他の周辺機器と共有することもできます。</font><font style="vertical-align: inherit;">チップには標準のピン配列があります。</font><font style="vertical-align: inherit;">チップは最初のバージョンの装置で使用し、標準であるため、同じプロトコルとピン配置で別のチップの上にはんだ付けしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チップは、そのようなチップから必要なことを行うことができます：署名の読み取り、キーの格納など。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_h/sb/jb/_hsbjbw9dyvjo2ta5emvp_wuqk4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
特徴：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16のキースロット。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECSDSA署名、ハッシュ、MACを読み取り、AESを暗号化し、DHを実行できます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乱数ジェネレーターと暗号化カウンターがあります。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エンクロージャー：SOIC-8、DFN6;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコル：I2C、単線;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~0.7$@1000個。</font></font><br>
</li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マイクロ回路での作業方法</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
適切な</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">がありますが</font><font style="vertical-align: inherit;">、NDAの下にあります。すぐにgamma.spb.ruに書き込んだ場合、2週間以内に提供されます。別の会社の場合-3か月後。私たちは2つの会社に手紙を書きました、そして、すべてを終えたとき、別のマイクロチップディーラーが私たちに答えました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appnotesはほとんどなく</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、平均よりも悪いです。</font><font style="vertical-align: inherit;">&nbsp;HALを備えたライブラリである</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">GitHubに</font></a></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソフトウェア</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。おかしいです-ドキュメントはNDAの下にあり、それに書かれているソフトウェアはGitHubにあります。ソフトウェアはLinuxをサポートしていませんが、Raspberry PiとAtmel MKをサポートしています-これは少し異なります。開発者は、すべての機器にI2Cバスが1つしかないと信じています。たとえば、Raspberry Piのようにレッグが呼び出されます。</font><font style="vertical-align: inherit;">
あり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">統合</font></a><font style="vertical-align: inherit;">と&nbsp; </font><b><font style="vertical-align: inherit;">OpenSSLは</font></b><font style="vertical-align: inherit;"> &nbsp;それがうまく動作しませんが、それはありません- 。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linuxでの例はなく</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーソナライゼーション</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に関する作業もありません&nbsp; </font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チップのカスタマイズ</font></font></h3><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チップの最大の悩みはパーソナライゼーションです。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題は、チップが多くのことを実行できることです。それは16のキーが格納されている16のスロットを持っています：ユーザーデータ、または公開キー、または他のスロットの一時的なストレージ-多くのオプションがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どういうわけか、スロットへのアクセスを制限する必要があり、多くの構成オプションもあります。パスワード、別のスロットでの認証、工場へのアクセス時間によって制限します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-a/du/mm/-adumml8w8ijipo3nbep8jz5nry.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表では、キーのタイプ、読み取りおよび書き込みアクセス、スロット間の関係-SlotConfig、KeyConfig。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
私たちが使用する各キーのビットマスク（16ビット）には、どこにでも異なる数字があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も悲しいことは、構成ゾーンが1回限りであり、スロットの機能を設定することです。すべてを正しく行う前に、50個のチップをめちゃくちゃにしました。チップは</font><b><font style="vertical-align: inherit;">、構成をロックした後に</font></b><font style="vertical-align: inherit;">のみ機能</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これとは別に、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個々のスロット</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">には</font><b><font style="vertical-align: inherit;">ロック</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
があり、例にもソフトウェアにもドキュメントはありません。</font><font style="vertical-align: inherit;">個々のビットのドキュメントがありますが、すべてが複雑です。</font><font style="vertical-align: inherit;">Microchipのすべての例では、「そのようなブロックをダウンロードすると、Amazonにデータを送信する例のように、何とかして機能します。」</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かなり時間がかかりましたが、その過程で彼らは素晴らしいユーティリティを作りました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atecc-utilユーティリティ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、チップのほとんどの機能を実行できるコンソールユーティリティで、作業が少し簡単になります。</font><font style="vertical-align: inherit;">それは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubの上で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MITライセンスの下で。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーティリティはCryptoAuthLibを使用します。</font><font style="vertical-align: inherit;">彼女は、構成ゾーンをより使いやすくする方法、SHA、MAC、ECDSA、DHを使用する方法を知っています。</font><font style="vertical-align: inherit;">最初にスクリプトで使用するためのユーティリティを作成したため、インターフェイスはバッチフレンドリーです。</font><font style="vertical-align: inherit;">人がそれを引き起こすことができるという事実は副次的な特徴です。</font><font style="vertical-align: inherit;">ユーティリティはリストを作成できます-コマンドの計画：「まず、このゾーンをパーソナライズしてから、そのようなキーを書き留めます」。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーティリティ呼び出しの例は、人間が理解できるものです。</font></font><br>
<br>
<pre><code class="plaintext hljs">atecc   - b 10   - c   'serial'   - c   'read-config /tmp/config.dump'</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このユーティリティは、Linux、AMD64の下で構築されています-Debianパッケージに含まれています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lc/yr/bs/lcyrbsjcuggnfwuzetwwjy3auxg.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">その他の個人用設定ツール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットを読み取るためのExcelプレートがあります。</font><font style="vertical-align: inherit;">マイクロチップでNDAスキャンを見せていただければ、それをお渡しします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gs/j5/r9/gsj5r9tr6ngrcascp8tqxdq6dla.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてをテストでカバーしました。1ビットを忘れることができ、いくつかのサービスコマンドがあなたの秘密鍵を読み取る場合、多くのオプションがあるためです。</font><font style="vertical-align: inherit;">テストでは、実際のデバイスをテストします。</font><font style="vertical-align: inherit;">彼らはマイクロサーキットに向かい、デバイスの正しい構成を確認します。このスロットを読み取ることができますか、そのような署名を作成できますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットと並行して、このデバイスが満たすべき保証のリストを作成し、すべてがどのように機能するかを確認しました。</font><font style="vertical-align: inherit;">私たちは</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コウモリのフレームワーク</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用しています</font><font style="vertical-align: inherit;">&nbsp;-非常に興味深いことです。</font><font style="vertical-align: inherit;">こんな感じです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wr/kd/op/wrkdopidmf6zn2ko70ue36p7fxc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例のテストのリスト。</font><font style="vertical-align: inherit;">上位のものは渡されますが、下位のものは渡されません。</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスの設定</font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私たち自身では</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、私が話しているタスクに</font><b><font style="vertical-align: inherit;">2つのスロットのみを使用</font></b><font style="vertical-align: inherit;">しています。どちらにも、デバイスの秘密鍵を保存します。違いは、前者は</font><font style="vertical-align: inherit;">1970年に200年間発行され</font><font style="vertical-align: inherit;">た</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">永久証明書に</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関連付けられていること</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、IoTでは時刻が常に同期しているとは限らないためです。証明書インフラストラクチャには、証明書の有効期間の検証が含まれます。デバイスの同期が壊れていると、VPNなどの重要なサービスが失敗する可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つのスロットは無限-永続的</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。これは1回生成され、デバイスの寿命を通じて変化しません。閉じたネットワークの場合、このキーに対して200年間の証明書が生成されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のスロットが更新されています。</font><font style="vertical-align: inherit;">証明書の最長有効期間は1年です。</font><font style="vertical-align: inherit;">これは、何かが侵害された場合に備えて行われます。</font><font style="vertical-align: inherit;">デバイス証明書の有効期間が終了すると、更新可能な秘密デバイスキーが生成されます。</font><font style="vertical-align: inherit;">オープンネットワークでの認証に使用され、証明書と一緒に1か月に1回以下更新されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーザー向けに、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秘密のECDSAキー用のいくつかのスロットを含め、</font><b><font style="vertical-align: inherit;">さまざまな組み合わせを生成しました</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ユーザーは、私たちの秘密キーを信頼していない場合、別のスロットでキーを生成できます。</font><font style="vertical-align: inherit;">このためには、マイクロチップのみを信頼する必要があります。</font><font style="vertical-align: inherit;">ユーザーは署名を読み取り、暗号化を行うことができます-チップにできることはすべて提供しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これまでのところ、残念ながら誰も使用していませんが、使用することを期待しています。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インフラストラクチャ：中間キー</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
失われるべきではないルート証明書で輝かないように、ある時点で中間証明書を実装したことをすでに述べました。</font><font style="vertical-align: inherit;">彼は決して工場に現れません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/m0/dl/uhm0dl6mdkegvzwl2avlsqpe7kc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
物理的に中間の証明書はATECC508Aチップです。</font><font style="vertical-align: inherit;">608とは少し異なりますが、508にはキーに便利な機能がありましたが、608にはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
チップはUSB-I2Cアダプターを介して接続されます。</font><font style="vertical-align: inherit;">これは、tiny-usb-i2cファームウェア-USB-I2Cブリッジにアップグレードできるプログラマーを備えたUSBISPです。</font><font style="vertical-align: inherit;">中間証明書は、秘密鍵でデバイス証明書に署名します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マイクロ回路の2つの機能が私たちにとって有用であることがわかりました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ハードウェアパスワード保護スロット</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">チップは、次の2つの条件が満たされた場合にのみ署名を読み取るようにプログラムできます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスがコンピュータに詰まっているとき。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入力されたパスワード</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生産現場の監督に、特定の数のコントローラーの中間キーとパスワードを提供します。</font><font style="vertical-align: inherit;">したがって、アクセスするには、キーとパスワードの両方を盗む必要があります。</font><font style="vertical-align: inherit;">この機会を無料で手に入れましたが、システムのセキュリティが向上しました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用回数のハードウェア制限</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">内部の暗号化カウンターは増加することができるだけです。</font><font style="vertical-align: inherit;">それが所定の制限に一度達すると、マイクロ回路は他に何も署名しません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tm/qv/4-/tmqv4-eakpcudfupub3oy6nt9bw.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント上のOpenSSL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてがクライアントでどのように機能するかを考えてみましょう。</font><font style="vertical-align: inherit;">コントローラにOpenSSLがあります。</font><font style="vertical-align: inherit;">私たちは何も発明していません-これは通常のTLS、通常のPKIです。</font><font style="vertical-align: inherit;">さらにクライアントライブラリが必要でした。</font><font style="vertical-align: inherit;">Linuxソフトウェアの大部分は、安全な接続のために使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは、</font><font style="vertical-align: inherit;">新しいOpenSSL </font><font style="vertical-align: inherit;">
1.1 </font><font style="vertical-align: inherit;">でサポートされた、</font><font style="vertical-align: inherit;">少し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">書き終えた</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Microchipからコードを取得しました</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">その結果、彼はハードウェアキーの操作方法を知っています。ハードウェアは秘密キーのパスワードをサポートしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
こんな感じです。</font></font><br>
<br>
<pre><code class="plaintext hljs">openssl req -new -engine ateccx08 -keyform engine -key ATECCx08:00:04:C0:00 -subj <font></font>
"/CN=wirenboard-AP6V5MDG" -out device AP6V5MDG.csr</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは通常のOpenSSLの呼び出しであり、適切なエンジンモジュールを使用するための指示です。</font><font style="vertical-align: inherit;">キーはここで設定されます：アドレス、モデル、および最後の2バイトは、使用されるスロットの番号です。</font><font style="vertical-align: inherit;">すべてがキーファイルであるかのように送信されますが、ファイルではありません。デバイスにアクセスする必要があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバー上のSSL</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenSSLを含むすべてのSSLがサーバーで機能します。サーバー側での変更やカスタムビルドは必要ありません。サーバーで必要なのは、</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">証明書バンドル</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（デバイス証明書+中間証明書）&nbsp; </font><b><font style="vertical-align: inherit;">のチェーンを確認</font></b><font style="vertical-align: inherit;">し、サイトで公開した</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公開キー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Wiren Board ROOT CA）を保存できることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
標準のTLSは、両方の当事者が相互に認証する必要があると述べています。理論的には、クライアント（コントローラー）がサーバーを認証します。それは無料です-その同じ握手で。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このため、サーバーには秘密鍵と公開鍵の鍵ペアも必要です。</font><font style="vertical-align: inherit;">自己署名を作成し、公開鍵をすべてのクライアントに配布できます。</font><font style="vertical-align: inherit;">ブラウザのドメインが緑色になるように、サイトのようにSSLでletsencryptまたは証明書を使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは3つのサービスで行いました。最初のサービスはMQTTです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT：クライアント上の蚊</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、IBMからのデータ転送用の標準的で一般的なバスです。私たちでは、コントローラーをクラウドや一部のパートナーシステムと接続するために使用されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mosquittoは、Linuxを含む、ブローカーおよびクライアントライブラリの一般的な実装です。 OpenSSLエンジン（1つのオプションを渡す）を使用して「keyfile」オプションを解析し、そこにハードウェアキーを示すために、パッチを適用する必要がありました。</font><font style="vertical-align: inherit;">クライアントの</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッチ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は小さく、それぞれ20行です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、クライアントは怖いバンドルを渡します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ea/ju/ge/eajugei4pidm4h7ramzyhh-vpkq.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、ハードウェア秘密鍵が使用され、サーバー証明書が逆方向にチェックされます。</font></font><br>
<br>
<pre><code class="plaintext hljs">mosquitto_sub -h mqtt.wirenboard.com -p 8884 -cert /etc/ssl/device/device_bundle.crt.pem --key 'engine:ateccx08:ATECCx08:00:04:C0:00' --capath /etc/ssl/certs/ -t /# -v</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初にコンソールユーティリティが表示されます。</font><font style="vertical-align: inherit;">次にデバイス証明書がリストされます-で始まり</font></font><code>-cert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">証明書はbundle-file-meta-informationです。</font><font style="vertical-align: inherit;">秘密鍵は証明書の後にあります</font></font><code>--key</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">キーについては、ハードウェアストレージに移動する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
で始まる最後の部分</font></font><code>--capath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、サーバーのチェックです。</font><font style="vertical-align: inherit;">letsencryptがあるため、SSLキーのグローバルリストと照合します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、ブリッジのセットアップの</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">様子</font><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<pre><code class="plaintext hljs">root@wirenboard-AXXVJI62:~# cat /etc/mosquitto/conf.d/bridge-hw.conf<font></font>
<font></font>
connection wb_devices_cloud.wirenboard-AXXVJI62 <font></font>
address contactless.ru:8884<font></font>
<font></font>
bridge_capath /etc/ssl/certs/<font></font>
bridge_certfile /etc/ssl/device/device_bundle.crt.pem <font></font>
bridge_keyfile engine:ateccx08:ATECCx08:00:04:C0:00<font></font>
<font></font>
notifications true<font></font>
notification_topic /client/wirenboard-AXXVJI62/bridge_status <font></font>
<font></font>
topic/# both 1 ""/dient/wirenboard-AXXVJI62</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モスキートブリッジも設定され、データが送信されます。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーには標準のMosquittoがあり、</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;パッチを適用する必要はありません。</font></font><br>
<br>
<pre><code class="plaintext hljs">per _listener_settings true<font></font>
<font></font>
listener 8884 0.0.0.0<font></font>
cafile/etc/mosquitto/certs/WirenBoard_Root_CA.crt <font></font>
certfile /etc/letsencrypt/live/contactless.ru/fullchain.pem keyfile/etc/letsencrypt/live/contactless.ru/privkey.pem <font></font>
require.certificate true <font></font>
use_identity_as_username true<font></font>
<font></font>
password_file /etc/mosquitto/passwd.conf <font></font>
allow_anonymous false<font></font>
acl_file /etc/mosquitto/ad.conf<font></font>
<font></font>
:~$ cat /etc/mosquitto/acl.conf<font></font>
pattern write /client/%u/#<font></font>
pattern read /client/%u/#</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
全体のセットアップは数ステップです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ルートCAを縫合し、ドメインからの暗号化証明書-設定に登録します。</font><font style="vertical-align: inherit;">次に、証明書を確認するコマンドを指定します。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次はMosquittoのクールなオプションです。</font><font style="vertical-align: inherit;">これにより、証明書のメタ情報を</font></font><code>username</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変更</font><font style="vertical-align: inherit;">せず</font><font style="vertical-align: inherit;">にMQTTの追加アクセスリストの</font><font style="vertical-align: inherit;">品質として使用できます</font><font style="vertical-align: inherit;">。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">たとえば、シリアル（CN）ワイヤーボード-AXXVJI62でクライアントが証明書を送信した後、クライアントへのアクセスを許可するサブトピックを記述しました。</font></font><br>
</li>
<li><code>per_listener_settings:</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ログイン/パスワード（&gt; 1.5.5）による認証を妨げないように、別のポートに。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、Wiren Board IoT Cloud PlatformのMQTTブローカーのセットアップ全体です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openvpn </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コントローラーのクライアントがすべてを壊したときに、OpenVPNがクライアントにアクセスする必要があります。</font><font style="vertical-align: inherit;">これを行うには、設定インターフェースからワンクリックで上に移動し、クライアントデバイスへのアクセスを許可する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OpenVPNの場合</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、クライアントに</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">も</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッチ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">必要です</font><font style="vertical-align: inherit;">が、それは簡単です。</font><font style="vertical-align: inherit;">さらに、起動オプションに上記と同じものが追加されます：バンドル、サーバーチェック、エンジン。</font></font><br>
<br>
<pre><code class="plaintext hljs">openvpn  --capath /etc/ssl/certs/ --cert /etc/ssl/device/device_bundle.crt.pem --key engine:ateccx08:ATECCx08:00:04:C0:00</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーで</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font><b><font style="vertical-align: inherit;">、</font></b><font style="vertical-align: inherit;"> letsencryptも使用します。</font></font><br>
<br>
<pre><code class="plaintext hljs">ca /etc/openvpn/WirenBoard_Root_CA.crt cert<font></font>
/etc/letsencrypt/live/vpn1.wirenboard.com/fullchain.pem key<font></font>
/etc/letsencrypt/live/vpn1.wirenboard.com/privkey.pem</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別のサーバーの導入は簡単です。ファイルをコントローラーに転送する必要はありません。</font><font style="vertical-align: inherit;">これはすべて、標準の公開鍵エコシステムによって署名されています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nginx</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後の機能。 Nginxは、複雑なサービスを提供しているパートナー向けに作成されています。クライアント証明書の検証に失敗したくない場合は、SSLを使用してください。多くの場合、リバースプロキシのように、ウェブサーバー上の複雑なサービスの前にnginxがすでにあります。そうでない場合は、nginx設定に1行追加します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nginxはクライアント証明書をチェックし、HTTPリクエストを送信してから、そのバックエンドまたは複雑なサービスに送信します。すべて問題なければ、以下のリクエストを送信する前にヘッダーを設定します：一般名、クライアントがこのサービスの使用を許可されているかどうか、コントローラーの購入時に料金を支払ったかどうか。 OKでない場合、エラー400。</font></font><br>
<br>
<pre><code class="plaintext hljs">ssl_client_certificate WirenBoard_Root_CA.crt; <font></font>
ssl_verify_client       on;</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント上のnginx</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">エージェントがあります-HTTP経由でデータを送信するアプリケーションです。</font><font style="vertical-align: inherit;">Linuxコントローラーでは、クライアントでnginxを使用しているため、エージェントもSSLについて何も知らないため、ハードウェアキーはOpenSSLで動作します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、キーなしの通常のwget、bash、または好みの言語を使用して、HTTPリクエストをハードウェアキーでTLSにラップできます。</font><font style="vertical-align: inherit;">すべてが10行で構成されています。</font></font><br>
<br>
<pre><code class="plaintext hljs">server {<font></font>
    listen 8080;<font></font>
    location / {<font></font>
        proxy_pass https://example.com;<font></font>
        proxy_ssl_name example.com;<font></font>
        proxy_ssl_server_name on;<font></font>
        proxy_ssl_certificate/etc/ssl/device/device_bundle.crt.pem;<font></font>
        proxy_ssl_certificate_key<font></font>
engine:ateccx08;ATECCx08:00:04:C0:00;<font></font>
    }<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">どこを見れば</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
暗号化モジュールはすべての</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wiren Board 6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントローラー</font><font style="vertical-align: inherit;">に含まれており、1年半にわたって製造されています。インフラストラクチャはすでに変更されていますが、最近になってすべてが展開および構成されました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、コントローラーのOpenVPNのcloud.wirenboard.comにあるコントローラーのWebインターフェースへのリモートアクセスで機能します。また、すべてがMQTTで機能するInfluxDBを使用してGrafana環境を引き上げました。 saymon.infoシステムで確認できます。これは、パートナーの監視システム（MQTT）です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トップレベルシステムの製造業者である場合、自分で何かを行う場合、またはリモートアクセスを増やしたい場合は、Grafana（MQTTブローカーなど）が私たちのようなものを作成してから呼び出します。手順を共有します-お手伝いします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が話したすべての仕事は二人で行われました：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oleg Serikov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;-クライアントとサーバーでのOpenSSLのセットアップ、および&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nikita Maslov-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &nbsp;その他すべて。</font><font style="vertical-align: inherit;">彼らに感謝！</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InoThings Conf 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カンファレンスの最高のレポートの1つに基づく記事でした</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">2019カンファレンスのその他の優れたレポートを</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTubeチャンネルに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登録して</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">また、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャンネルに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参加して&nbsp; </font><font style="vertical-align: inherit;">、テレグラム</font><font style="vertical-align: inherit;">で&nbsp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャット</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">チャットでは、参加者が質問し、ベストプラクティスを共有し、IoTに関する最新資料を体験して話し合います。</font></font></blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja476292/index.html">SVGまたはキャンバス？</a></li>
<li><a href="../ja476294/index.html">GFNの代替としての分散型ゲームネットワーク：ロシア連邦ですでに機能している、その方法と理由</a></li>
<li><a href="../ja476296/index.html">11月21日、製品エンジニアリングMeetUp：製品エンジニアとは誰ですか？</a></li>
<li><a href="../ja476298/index.html">とげを自転車に投げつける、パート1：プラグインを使用してVisual Studioデバッガーをカスタマイズする基本を学ぶ</a></li>
<li><a href="../ja476300/index.html">トラム雑誌は、ロシアの子供たちの前衛の明るく点滅し、すぐに色あせた星です</a></li>
<li><a href="../ja476306/index.html">ボットの基本的な機能を作成するためのTelegramBotの手順。（パート1）</a></li>
<li><a href="../ja476310/index.html">人間の顔のCRM</a></li>
<li><a href="../ja476312/index.html">ReactまたはAngularまたはVue.js-何を選択しますか？</a></li>
<li><a href="../ja476316/index.html">Vue Storefront：ESにデータを入力する</a></li>
<li><a href="../ja476318/index.html">私たちはジョーカー2019を完全に攻撃します：ロシアで最大のJavaカンファレンスはどのように行われましたか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>