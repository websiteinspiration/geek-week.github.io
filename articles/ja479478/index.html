<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👛 🔻 🤜🏻 痛みのないJavaプラグイン 👈🏾 ♾ ✌🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="この記事では、プラグインの動的ロードをサポートするJavaアプリケーションフレームワークをすばやく簡単に作成する方法について説明します。読者はおそらくすぐにそのようなタスクがすでに長い間解決されているとすぐに思い、既製のフレームワークを使用するか、クラスローダーを記述するだけですが、私が提案するソリ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>痛みのないJavaプラグイン</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479478/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事では、プラグインの動的ロードをサポートするJavaアプリケーションフレームワークをすばやく簡単に作成する方法について説明します。</font><font style="vertical-align: inherit;">読者はおそらくすぐにそのようなタスクがすでに長い間解決されているとすぐに思い、既製のフレームワークを使用するか、クラスローダーを記述するだけですが、私が提案するソリューションではこれは必要ありません。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特別なライブラリやフレームワーク（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSGi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、Guiceなど）</font><font style="vertical-align: inherit;">は必要ありません</font><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASMや類似のライブラリではバイトコード解析を使用しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスローダーは記述しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リフレクションと注釈は使用しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグインを見つけるためのクラスパスに煩わされません。</font><font style="vertical-align: inherit;">クラスパスには一切触れません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">また、拡張ポイント（プラグインの拡張ポイント）を記述するために、XML、YAMLまたはその他の宣言型言語は使用しません。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、要件はまだ1つあります。このようなソリューションはJava 9以降でのみ機能します。</font><font style="vertical-align: inherit;">それは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュールとサービスに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基づいて</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">いるから</font></a><font style="vertical-align: inherit;">です。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは始めましょう。</font><font style="vertical-align: inherit;">問題をより具体的に定式化します。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小限のアプリケーションフレームワークを実装する必要があります</font></font><code>plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これにより、起動時にユーザープラグインがフォルダーから読み込まれます</font><font style="vertical-align: inherit;">。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、アセンブルされたアプリケーションは次のようになります。</font></font><br>
<br>
<pre><code class="bash hljs">plugin-app/<font></font>
    plugins/<font></font>
        plugin1.jar<font></font>
        plugin2.jar<font></font>
        ...<font></font>
    core.jar<font></font>
    …</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールから始めましょう</font></font><code>core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">このモジュールはアプリケーションのコアです。つまり、実際には、私たちのフレームワークです。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">時間を大切にする人のために、完成したプロジェクトはGitHubで入手できます。</font><font style="vertical-align: inherit;">組立説明。</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="></a><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/orionll/plugin-app
<span class="hljs-built_in">cd</span> plugin-app<font></font>
mvn verify<font></font>
<span class="hljs-built_in">cd</span> core/target<font></font>
java --module-path core-1.0-SNAPSHOT.jar --module core</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュールに次の4つのJavaファイルを作成します。</font></font><br>
<br>
<pre><code class="bash hljs">core/<font></font>
    src/main/java/<font></font>
        org/example/pluginapp/core/<font></font>
            IService.java<font></font>
            BasicService.java<font></font>
            Main.java<font></font>
        module-info.java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のファイル</font></font><code>IService.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、拡張ポイントを説明するファイルです。その後、他のプラグインがこの拡張ポイントに貢献できます（「貢献」）。これは、プラグインアプリケーションを構築するための標準的な原則で</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あり、依存関係の逆転</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">原則</font></a><font style="vertical-align: inherit;">（Dependency Inversion）</font><font style="vertical-align: inherit;">と呼ばれます</font><font style="vertical-align: inherit;">。この原則は、カーネルが特定のクラスではなくインターフェースに依存するという事実に基づいています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
拡張ポイントに抽象的な名前を付けたの</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、今は概念のみを示しているためです。実際には、特定の拡張ポイントにすることができます。たとえば、グラフィックエディタを作成している場合は、画像処理効果にすることができます</font></font><code>IEffectProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>IEffectContribution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">または、拡張ポイントの名前の付け方に応じて、他の何か。同時に、アプリケーション自体にいくつかの基本的なエフェクトセットが含まれ、サードパーティの開発者はさらに高度なエフェクトを作成してプラグインの形式で配信できます。ユーザーは、これらの効果をフォルダに入れ</font></font><code>plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">てアプリケーションを再起動するだけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイルは</font></font><code>IService.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のとおりです。</font></font><br>
<br>
<pre><code class="java hljs">…<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IService</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doJob</span><span class="hljs-params">()</span></span>;<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword">static</span> List&lt;IService&gt; <span class="hljs-title">getServices</span><span class="hljs-params">(ModuleLayer layer)</span> </span>{
       <span class="hljs-keyword">return</span> ServiceLoader<font></font>
               .load(layer, IService.class)<font></font>
               .stream()<font></font>
               .map(Provider::get)<font></font>
               .collect(Collectors.toList());<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは抽象的な作業を行う単なるインターフェースです</font></font><code>doJob()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（繰り返しますが、詳細は重要ではありませんが、実際には具体的なものになります）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の方法にも注意してください</font></font><code>getServices()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。このメソッドは</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、このモジュールのレイヤーとその親で見つかっ</font><font style="vertical-align: inherit;">たインターフェースのすべての実装を返します</font><font style="vertical-align: inherit;">。これについては、後で詳しく説明します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のファイル</font></font><code>BasicService.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、インターフェースの基本実装です</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。アプリケーションにプラグインがない場合でも、常に存在します。言い換えれば、</font></font><code>core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これはカーネルだけでなく、同時にロードされるプラグイン自体でもあります。ファイルは</font></font><code>BasicService.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のとおりです。</font></font><br>
<br>
<pre><code class="java hljs">…<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BasicService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IService</span> </span>{
   <span class="hljs-meta">@Override</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doJob</span><span class="hljs-params">()</span> </span>{<font></font>
       System.out.println(<span class="hljs-string">"Basic service"</span>);<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
簡単にするために、</font></font><code>doJob()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">単に行</font></font><code>"Basic service"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">出力するだけ</font><font style="vertical-align: inherit;">です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、現時点では次の図</font><font style="vertical-align: inherit;">があり</font></font><br>
<br>
<img src="https://habrastorage.org/webt/du/0f/fd/du0ffdkzy6bqmyc6rvqj6p-jw7w.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます。3番目のファイル</font></font><code>Main.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、メソッドが実装される場所</font></font><code>main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">モジュールレイヤーとは何かを知るために必要なものを理解するために、少し魔法があります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール層について</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Javaがアプリケーションを起動すると、引数にリストされているすべてのプラットフォームモジュール+モジュール</font></font><code>--module-path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（および</font></font><code>classpath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、存在する場合は）がいわゆるレイヤーに分類され</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。我々はcore.jarモジュールをコンパイルして、コマンドラインから実行した場合、当社の場合、</font></font><code>java --module-path core.jar --module core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、そこ</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少なくともモジュールとなり</font><font style="vertical-align: inherit;">層中</font></font><code>java.base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><code>core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z5/ar/n-/z5arn-jtfurxwqjja-fxrbdfjbu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
層がある</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、常にすべてのJavaアプリケーションに存在し、これが最も可能な構成です。ほとんどのアプリケーションは、モジュールの単一のレイヤーに存在します。ただし、ここでは、フォルダからプラグインを動的にロードする必要があります</font></font><code>plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ユーザーにアプリケーションの起動ラインを修正するように強制するだけで、彼自身が次のように追加できます。</font></font><code>--module-path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要なプラグインですが、これは最善の解決策ではありません。特に、プログラマーではなく、なぜどこかに登り、そのような単純なことのために何かを修正する必要があるのか​​理解していない人々。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸い、解決策があります。Javaを使用すると、実行時に独自のモジュールレイヤーを作成でき、必要な場所からモジュールをロードできます。私たちの目的のために、プラグインの1つの新しいレイヤーで十分です。これは、レイヤーを親として</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持つことになります（どのレイヤーにも</font><font style="vertical-align: inherit;">親が</font><font style="vertical-align: inherit;">必要です）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1-/yd/5i/1-yd5ikax42qfadybbu1uqbnkgo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラグインレイヤーがレイヤーを親として持つという事実は、プラグイン</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レイヤーのモジュールがレイヤー</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ただし、その逆はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、モジュールレイヤーが何であるかがわかったので、最後にファイルの内容を確認できます</font></font><code>Main.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="java hljs">…<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>{
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{<font></font>
       Path pluginsDir = Paths.get(<span class="hljs-string">"plugins"</span>);<font></font>
<font></font>
       <span class="hljs-comment">//      plugins</span><font></font>
       ModuleFinder pluginsFinder = ModuleFinder.of(pluginsDir);<font></font>
<font></font>
       <span class="hljs-comment">//  ModuleFinder      plugins      </span><font></font>
       List&lt;String&gt; plugins = pluginsFinder<font></font>
               .findAll()<font></font>
               .stream()<font></font>
               .map(ModuleReference::descriptor)<font></font>
               .map(ModuleDescriptor::name)<font></font>
               .collect(Collectors.toList());<font></font>
<font></font>
       <span class="hljs-comment">//  ,      (   )</span><font></font>
       Configuration pluginsConfiguration = ModuleLayer<font></font>
               .boot()<font></font>
               .configuration()<font></font>
               .resolve(pluginsFinder, ModuleFinder.of(), plugins);<font></font>
<font></font>
       <span class="hljs-comment">//     </span><font></font>
       ModuleLayer layer = ModuleLayer<font></font>
               .boot()<font></font>
               .defineModulesWithOneLoader(pluginsConfiguration, ClassLoader.getSystemClassLoader());<font></font>
<font></font>
       <span class="hljs-comment">//     IService       Boot</span><font></font>
       List&lt;IService&gt; services = IService.getServices(layer);<font></font>
       <span class="hljs-keyword">for</span> (IService service : services) {<font></font>
           service.doJob();<font></font>
       }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これがこのコードを初めて見る場合、それは非常に複雑に見えるかもしれませんが、これは、多数の新しい未知のクラスによる誤った感覚です。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModuleFinder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuration、</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ModuleLayerクラス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">の意味について少し理解すれば</font><font style="vertical-align: inherit;">、すべてが</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">適切</font></a><font style="vertical-align: inherit;">になります。</font><font style="vertical-align: inherit;">しかも、数十行しかありません！</font><font style="vertical-align: inherit;">これが一度書かれたすべてのロジックです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モジュール記述子</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は考慮していない別の（4番目の）ファイルにとどまりました</font></font><code>module-info.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、モジュールの宣言とサービスの説明（拡張ポイント）を含む最短のファイルです。</font></font><br>
<br>
<pre><code class="java hljs">…<font></font>
<font></font>
<span class="hljs-keyword">module</span> core {
   <span class="hljs-keyword">exports</span> org.example.pluginapp.core;<font></font>
<font></font>
   uses IService;<font></font>
   provides IService with BasicService;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このファイルの行の意味は明白です：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">まず、モジュールはパッケージをエクスポートし</font></font><code>org.example.pluginapp.core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">て、プラグインをインターフェースから継承できるようにします</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（そう</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しないと、モジュールの外部からはアクセスできません</font></font><code>core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次に、サービスを使用していることを発表します</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三に、</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クラスを通じて</font><font style="vertical-align: inherit;">サービスの実装を提供すると彼は言います</font></font><code>BasicService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
モジュール宣言はJavaで記述されているため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラチェックと静的保証</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">という非常に重要な利点が</font><i><font style="vertical-align: inherit;">あります</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">たとえば、型の名前を間違えたり、存在しないパッケージを示したりした場合は、すぐに問題を回避できたでしょう。</font><font style="vertical-align: inherit;">一部のOSGiの場合、拡張ポイントの宣言はXMLで記述されるため、コンパイル中にチェックは行われません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これでフレームの準備が整いました。</font><font style="vertical-align: inherit;">それを実行してみましょう：</font></font><br>
<br>
<pre><code class="bash hljs">&gt; java --module-path core.jar --module core<font></font>
Basic service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうした</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Javaはフォルダー内のモジュールを見つけようとしましたが、</font></font><code>plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つかりませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空のレイヤーが作成されました。</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServiceLoader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はすべての実装の検索を開始しました</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空のレイヤーでは、モジュールがないため、サービスの実装は見つかりませんでした。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この層の後、彼は親層（つまり、層</font></font><code>Boot</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）の</font><font style="vertical-align: inherit;">検索を続け</font></font><code>BasicService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、モジュールに</font><font style="vertical-align: inherit;">1つの実装を見つけました</font></font><code>core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つかったすべての実装には、というメソッドがありました</font></font><code>doJob()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">実装が1つしか見つからなかったため、のみが印刷されました</font></font><code>"Basic service"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラグインを書く</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーションのコアを作成したので、今がそのためのプラグインを作成するときです。</font><font style="vertical-align: inherit;">2つのプラグイン</font></font><code>plugin1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">作成して</font></font><code>plugin2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、最初の印刷</font></font><code>"Service 1"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、2番目の</font><font style="vertical-align: inherit;">印刷</font><font style="vertical-align: inherit;">を行い</font></font><code>"Service 2"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">これを行うには</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>plugin1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とに</font></font><code>plugin2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それぞれ</font><font style="vertical-align: inherit;">2つの実装</font><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">追加する必要があります。2 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-o/3n/4v/-o3n4vlwhx-vwqxn7jpkunlamjq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つのファイルで最初のプラグインを作成します。</font></font><br>
<br>
<pre><code class="bash hljs">plugin1/<font></font>
    src/main/java/<font></font>
        org/example/pluginapp/plugin1/<font></font>
            Service1.java<font></font>
        module-info.java</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font></font><code>Service1.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="java hljs">…<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Service1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IService</span> </span>{
   <span class="hljs-meta">@Override</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doJob</span><span class="hljs-params">()</span> </span>{<font></font>
       System.out.println(<span class="hljs-string">"Service 1"</span>);<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ファイル</font></font><code>module-info.java</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="java hljs">…<font></font>
<font></font>
<span class="hljs-keyword">module</span> plugin1 {
   <span class="hljs-keyword">requires</span> core;<font></font>
<font></font>
   provides IService with Service1;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><code>plugin1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって異なります</font><font style="vertical-align: inherit;">
のでご了承ください</font></font><code>core</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">これは、先に述べた依存関係の逆転の原則です。カーネルはプラグインに依存せず、その逆も同様です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つ目のプラグインは1つ目のプラグインと完全に似ているため、ここでは説明しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、プラグインを収集してフォルダーに入れ</font></font><code>plugins</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、アプリケーションを実行します。</font></font><br>
<br>
<pre><code class="bash hljs">&gt; java --module-path core.jar --module core<font></font>
Service 1<font></font>
Service 2<font></font>
Basic service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
やった、プラグインが拾われました！</font><font style="vertical-align: inherit;">どうしてそうなった：</font></font><br>
<br>
<ol>
<li>Java      <code>plugins</code>.</li>
<li>     <code>plugins1</code>  <code>plugins2</code>.</li>
<li>ServiceLoader     <code>IService</code>.</li>
<li>        <code>IService</code>.</li>
<li>        (..  <code>Boot</code>)     <code>BasicService</code>   <code>core</code>.</li>
<li>       <code>doJob()</code>.</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ちょうど検索サービスプロバイダは子会社層から始まるので、その後、親に進み、最初に印刷されたことを注意</font></font><code>"Service 1"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">して</font></font><code>"Service 2"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、その後</font></font><code>"Basic Service"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">基本的なサービスが最初に表示され、次にプラグインが表示されるようにサービスを並べ替える場合は、</font></font><code>IService.getServices()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">並べ替えを追加してメソッド</font></font><code>int getOrdering()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">修正できます</font><font style="vertical-align: inherit;">（このメソッド</font><font style="vertical-align: inherit;">をインターフェイス</font><font style="vertical-align: inherit;">に追加する必要がある場合があり</font><font style="vertical-align: inherit;">ます</font></font><code>IService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概要</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこで、以下のプロパティを持つプラグインJavaアプリケーションを迅速かつ効率的に整理する方法を示しました。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シンプルさ：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拡張ポイントとそのバインディングについては、基本的なJava機能（インターフェース、クラス、および</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServiceLoader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）のみが使用され、フレームワーク、リフレクション、アノテーション、およびクラスローダーは使用されません。</font></font></li>
<li><b>:</b>      .    <code>module-info.java</code>  ,            .</li>
<li><b> :</b>         .    ,    IntelliJ IDEA,     (,    <code>uses</code>     <code>ServiceLoader.load()</code>)</li>
<li><b>:</b>   Java    ,     ,       .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
繰り返しますが、アイデアだけを示しました。</font><font style="vertical-align: inherit;">実際のプラグインアプリケーションでは、数十から数百のモジュールと数百から数千の拡張ポイントが存在します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
過去7年間、Eclipse RCPを使用してモジュラーアプリケーションを作成してきました。悪名高いOSGiがプラグインシステムとして使用され、プラグイン記述子がXMLで記述されているためです。</font><font style="vertical-align: inherit;">100を超えるプラグインがあり、現在もJava 8を使用しています。ただし、Javaの新しいバージョンにアップグレードしても、OSGiに強く関連付けられているため、Javaモジュールを使用することはほとんどありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、プラグインアプリケーションを最初から作成する場合、Javaモジュールはその実装の可能なオプションの1つです。</font><font style="vertical-align: inherit;">モジュールは単なるツールであり、目標ではないことに注意してください。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私について少し</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は10年以上プログラミングしており（そのうち8つはJavaで）、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StackOverflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に回答し、Java </font><font style="vertical-align: inherit;">専用の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegramで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">チャネル</font></a><font style="vertical-align: inherit;">を実行してい</font><font style="vertical-align: inherit;">ます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja479462/index.html">C ++でのシリアル化</a></li>
<li><a href="../ja479464/index.html">パイプとフィルター。Springを使用したアプリケーションと実装の例</a></li>
<li><a href="../ja479466/index.html">Habraiting 2019：2019年の最高の記事の統計とランキング</a></li>
<li><a href="../ja479468/index.html">正直さとジョン・ドウの縁</a></li>
<li><a href="../ja479474/index.html">なぜスクラムではチームの自己組織化が非常に重要であり、その中にマネージャーが存在できないのか</a></li>
<li><a href="../ja479482/index.html">SARIF SDKとそのエラー</a></li>
<li><a href="../ja479486/index.html">異種混合プログラミングと1つのAPIツールキット。インテルの専門家による即興講義があなたの質問に答えます</a></li>
<li><a href="../ja479488/index.html">ラップトップから-Mikrotikルーターへの冗長電源を備えたホームサーバー</a></li>
<li><a href="../ja479492/index.html">OpenWhiskに基づくサーバーレスコンピューティング、パート3</a></li>
<li><a href="../ja479496/index.html">JavaScriptでのWTFタスクの解析</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>