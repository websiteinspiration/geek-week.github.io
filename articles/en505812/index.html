<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÜ ü•Å ‚Ñ¢Ô∏è 4 engineers, 7000 servers and one global pandemic üëó üò´ üõÄüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! I present to you the translation of the article ‚Äú4 Engineers, 7000 Servers, And One Global Pandemic‚Äù by Adib Daw. 
 
 If this heading did...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>4 engineers, 7000 servers and one global pandemic</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/505812/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello, Habr! </font><font style="vertical-align: inherit;">I present to you the translation of the article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú4 Engineers, 7000 Servers, And One Global Pandemic‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> by Adib Daw. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If this heading did not cause a slight tremor in the spine, you should go to the next paragraph or go to our </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">career</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> page </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">for the company</font></a><font style="vertical-align: inherit;"> - we would like to talk.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Who are we</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We are a team of 4 penguins who love to write code and work with equipment. </font><font style="vertical-align: inherit;">In our free time, we are responsible for deploying, maintaining and operating a fleet of more than 7,000 physical Linux-based servers distributed across 3 different data centers throughout the United States. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also had the opportunity to do this at a distance of 10,000 km from the facilities, without leaving our own office, which is located a short drive from the beach on the Mediterranean Sea.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scale problems</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although it makes sense for a startup to start by hosting its infrastructure in the cloud due to the relatively small initial investment, we at Outbrain decided to use our own servers. We did this for the reason that the cost of cloud infrastructure far exceeds the cost of operating our own equipment located in data centers after development to a certain level. In addition, its server provides the highest degree of control and troubleshooting capabilities.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As we progress, problems are always nearby. </font><font style="vertical-align: inherit;">And they usually come in groups. </font><font style="vertical-align: inherit;">Server life cycle management requires constant self-improvement in order to be able to work normally in the conditions of a rapid increase in the number of servers. </font><font style="vertical-align: inherit;">Software methods for managing server groups in data centers quickly become cumbersome. </font><font style="vertical-align: inherit;">Detecting, troubleshooting, and fixing failures while enforcing the standards laid down in the service quality agreement turns into the manipulation of extremely diverse hardware arrays, various loads, update times, and other pleasant things that no one wants to take care of.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Master your Domains</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To solve many of these problems, we broke the server life cycle in Outbrain into its main components and named them domains. For example, one domain covers the need for equipment, another - logistics related to the inventory life cycle, and the third - on-site communications with personnel. There is another one regarding hardware observability, but we will not paint all-all moments. Our goal was to study and define domains so that they could be abstracted using code. Once a working abstraction is developed, it translates into a manual process that is deployed, tested, and finalized. Finally, the domain is configured to integrate with other domains through the API, creating a holistic, dynamic and constantly evolving equipment life cycle system that can be deployed, tested and monitored.Like all our other production systems.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The adoption of this approach has allowed us to correctly solve many problems - by creating tools and automation tools.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Needs domain</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Although email and spreadsheets were an acceptable way to meet demand in the early days, this could not be called a good solution, especially when the number of servers and the volume of incoming requests reached a certain level. </font><font style="vertical-align: inherit;">To better organize and prioritize incoming requests in the context of rapid expansion, we had to use a ticket system that could offer:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ability to customize the presentation of only relevant fields (simple)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open APIs (extensible)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Famous to our team (understandable)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integration with our existing workflows (unified)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Since we use Jira to manage our sprints and internal tasks, we decided to create another project that would help our clients send applications and track their results. Using Jira for incoming requests and for managing internal tasks allowed us to create a single Kanban board, which allowed us to look at all the processes as a whole. Our internal ‚Äúcustomers‚Äù saw only requests for equipment, without delving into the less significant details of additional tasks (such as improving tools, fixing errors). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/f8/nf/t6/f8nft6jpgrc5s4g1njqeekuxdna.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kanban board in Jira</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a bonus, the fact that the queues and priorities were now visible to everyone made it possible to understand "where in the queue" a specific request is located and what preceded it. </font><font style="vertical-align: inherit;">This allowed owners to change priorities in their own requests without having to contact us. </font><font style="vertical-align: inherit;">Dragged - and all business. </font><font style="vertical-align: inherit;">It also allowed us to monitor and evaluate our SLAs according to the types of requests based on indicators generated in the Jira.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipment Life Cycle Domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Try to imagine the complexity of managing the equipment used in each server rack. </font><font style="vertical-align: inherit;">Even worse, many pieces of iron (RAM, ROM) can be moved from the warehouse to the server and vice versa. </font><font style="vertical-align: inherit;">And also they fail or are written off and replaced, returned to the supplier for replacement / repair. </font><font style="vertical-align: inherit;">All this must be reported to the colocation service staff involved in the physical maintenance of the equipment. </font><font style="vertical-align: inherit;">To solve these problems, we created an internal tool called Floppy. </font><font style="vertical-align: inherit;">His task is:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Field HR management; aggregation of all information;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Updating the data of the ‚Äúwarehouse‚Äù after each completed and verified work on the maintenance of equipment.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The warehouse, in turn, is visualized using Grafana, which we use to plot all of our indicators. </font><font style="vertical-align: inherit;">Thus, we use the same tool for visualizing the warehouse and for other production needs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k1/vb/oo/k1vboomvwvxxibrx78iyfffrbj8.png"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana Warehouse Management Panel</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
For server devices that are under warranty, we use a different tool, which we called Dispatcher. </font><font style="vertical-align: inherit;">Is he:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collects system logs;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Generates reports in the format required by the vendor;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starts an application with the vendor through the API;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gets and stores the application identifier for further tracking of its progress.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After our claim is accepted (as a rule, this happens during the working day), the spare part is sent to the corresponding data center and accepted by the staff. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/gc/rm/ao/gcrmaoavgybge4e95dcikjuxamy.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jenkins console output</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Communication domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In order to keep pace with the rapid growth of a business that requires ever-increasing capacity, we had to adapt the methods of working with technical specialists from local data centers. </font><font style="vertical-align: inherit;">If at first an increase in scale meant the purchase of new servers, then after the consolidation project (based on the transition to Kubernetes) this became something completely different. </font><font style="vertical-align: inherit;">Our development has evolved from ‚Äúadding racks‚Äù to ‚Äúserver reprofiling‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The use of a new approach also required new tools that allow interacting with data center personnel with great comfort. </font><font style="vertical-align: inherit;">These tools were required:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simplicity;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autonomy;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Efficiency;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reliability.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We had to exclude ourselves from the chain and build the work so that technicians could work directly with server equipment. </font><font style="vertical-align: inherit;">Without our intervention and without regularly raising all these issues regarding workload, working hours, availability of equipment, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To achieve this, we installed an iPad in each data center. </font><font style="vertical-align: inherit;">After connecting to the server, the following will happen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The device confirms that this server really requires some work;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Applications running on the server are closed (if necessary);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A set of work instructions is published on the Slack channel explaining the necessary steps;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Upon completion of the work, the device checks the correctness of the final state of the server;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restarts applications if necessary.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In addition, we also prepared the Slack bot, which would help the technical specialist. </font><font style="vertical-align: inherit;">Due to the wide range of features (we constantly expanded the functionality), the bot made their work easier, and it made life easier for us. </font><font style="vertical-align: inherit;">So we optimized most of the process of re-profiling and servicing servers, excluding ourselves from the workflow. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/1e/4s/uw/1e4suwnlcau79zmjngs2am1ykxc.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iPad in one of our data centers</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware domain</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reliable scaling of our data center infrastructure requires good visibility of each component, for example:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iron failure detection</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server states (active, hosted, zombies, etc.)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Power consumption</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware version</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analytics throughout this farm</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our decisions allow us to make decisions about how, where and when to purchase equipment, sometimes even before the need really arises. </font><font style="vertical-align: inherit;">Also, by determining the level of loads on various equipment, we were able to achieve improved resource allocation. </font><font style="vertical-align: inherit;">In particular, energy consumption. </font><font style="vertical-align: inherit;">Now we can make informed decisions regarding the location of the server before it is installed in a rack and connected to a power source, as well as throughout the entire operation cycle and up to its possible decommissioning. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bs/jw/be/bsjwber4c6lrbovxkztwjdvt6c0.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Energy Panel at Grafana</font></font></i><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And then COVID-19 appeared ...</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Our team creates technologies that expand the capabilities of media companies and publishers on the network, help visitors find relevant content, products and services that may be of interest to them. </font><font style="vertical-align: inherit;">Our infrastructure is designed to serve the traffic generated when some rush news comes out. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Active media coverage of events related to COVID-19, combined with traffic growth meant that we needed to urgently learn to cope with such loads. </font><font style="vertical-align: inherit;">In addition, all this had to be done in the context of the global crisis, when supply chains were broken and most of the staff was at home. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But, as we have already said, our model already assumes that:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The equipment in our data centers is, for the most part, physically inaccessible to us;</font></font></li>
<li>&nbsp;      ;</li>
<li>  ,     ;</li>
<li>      ¬´  ¬ª    ;</li>
<li>   ,    - ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, the global restrictions that prevented many companies from gaining physical access to their data centers had little impact on us. As for spare parts and servers, yes, we tried to ensure stable operation of the equipment. </font><font style="vertical-align: inherit;">But it was done in order to prevent possible incidents, when it suddenly turns out that some kind of "piece of iron" is not available. </font><font style="vertical-align: inherit;">We ensured the filling of our reserves, without the goal of satisfying current demand. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, I would like to say that our approach to working in the field of data centers proves that the principles of good code design can be applied to the physical control processes of the data center. </font><font style="vertical-align: inherit;">And you might find this interesting. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Original: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tyts</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en505786/index.html">5 classic art techniques to create a good presentation</a></li>
<li><a href="../en505788/index.html">Ozon Go Demo Day</a></li>
<li><a href="../en505796/index.html">CO2, Sp02 and COVID-19: why you need to ventilate more often (few measurements)</a></li>
<li><a href="../en505798/index.html">PHP 25 years: a brief history of the language and a 50% discount on PhpStorm</a></li>
<li><a href="../en505802/index.html">Hosting and dedicated servers: answer questions. Part 4</a></li>
<li><a href="../en505814/index.html">Radarr, Jackett and the bot in the cart. Download torrents in a new way</a></li>
<li><a href="../en505824/index.html">Guide: Your Own L2TP VPN</a></li>
<li><a href="../en505826/index.html">How to get 100% vision and even more</a></li>
<li><a href="../en505834/index.html">Median Samples. Confidence Intervals and Comparison</a></li>
<li><a href="../en505838/index.html">FPGA technology for thousands of applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>