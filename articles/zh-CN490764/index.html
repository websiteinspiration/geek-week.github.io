<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👷🏻 🔇 🥒 Grafana，InfluxDB，两个标签和一个量。或如何计算子组的总和？ 💪🏽 👨🏾‍🚒 🤚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！
 
 从事性能测试。我真的很想在Grafana中设置监控并享受指标。在负载工具中存储指标的标准是InfluxDB。在InfluxDB中，您可以通过以下常用工具保存指标：
 
 

- 阿帕奇
- 加特林
- 负载运行企业
- Yandex.Tank
 通过使用性能测试工具及其指标，我为Gr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Grafana，InfluxDB，两个标签和一个量。或如何计算子组的总和？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/490764/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ol/b6/9a/olb69a8cdqhqtmjf-ic8x8qjevi.png"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大家好！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从事性能测试。</font><font style="vertical-align: inherit;">我真的很想在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置监控并享受指标</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在负载工具中存储指标的标准是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB中，</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过以下常用工具保存指标：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="  Apache.JMeter
Real-time results

In this document we will present the configuration setup to graph and historize the data in different backends:

 • InfluxDB setup for InfluxDBBackendListenerClient
 • InfluxDB setup for GraphiteBackendListenerClient
 • Grafana
 • Graphite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阿帕奇</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="  Gatling
Realtime monitoring

The sections below describe how to configure Gatling with InfluxDB and Graphite, and use Grafana as a graphing library"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加特林</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="  LoadRunner Enterprise
Manage analysis servers

This section describes how to configure external analysis database servers to be used with LoadRunner Enterprise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载运行企业</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="  Yandex.Tank
Modules / Artifact uploaders / InfluxDB

      Yandex.Tank  InfluxDB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.Tank</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过使用性能测试工具及其指标，我为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的捆绑包积累了一些编程秘诀</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我建议考虑一个有趣的问题，该问题存在于具有两个或多个标签的度量标准中。</font><font style="vertical-align: inherit;">我认为这并不少见。</font><font style="vertical-align: inherit;">在一般情况下，任务听起来像是：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算一个组的总指标，该组又分为子组</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有三个选项： </font></font></h3><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是按类型标签分组的金额</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格拉法纳路。</font><font style="vertical-align: inherit;">我们使用一堆价值观</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询的最高总和</font></font></a></li>
</ol> <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一切如何开始</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jolokia</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegraf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置的JVM MBean监视</font><font style="vertical-align: inherit;">。他还可视化了内存池上的指标-HEAP及更高版本中的每个内存池分配了多少内存。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从前一天的13:00到当天的晚上的01:00（12小时）的JVM内存池和垃圾收集器活动的图表。在这里，您可以看到内存池分为两组：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。大约在17:00进行了垃圾回收，之后内存池的大小减小了：</font><font style="vertical-align: inherit;">
为了收集内存池的指标，我在</font><b><font style="vertical-align: inherit;">telegraf</font></b><font style="vertical-align: inherit;">配置文件中指定了</font><font style="vertical-align: inherit;">以下设置：</font><b><font style="vertical-align: inherit;">telegraf.conf</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ow/ow/os/owowosl0e-neglcsbew-0u7bjjq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><br>
<pre><code class="apache hljs">[<span class="hljs-attribute">outputs</span>.influxdb]
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://influxdb_server:8086"]</span>
  <span class="hljs-attribute">database</span> = <span class="hljs-string">"telegraf"</span>
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-InfluxDb"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">retention_policy</span> = <span class="hljs-string">"month"</span>
  <span class="hljs-attribute">influx_uint_support</span> = false<font></font>
<font></font>
[<span class="hljs-attribute">agent</span>]
  <span class="hljs-attribute">collection_jitter</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">interval</span> = <span class="hljs-string">"2s"</span>
  <span class="hljs-attribute">precision</span> = <span class="hljs-string">"s"</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent]]
  <span class="hljs-attribute">username</span> = <span class="hljs-string">"login-Jolokia"</span>
  <span class="hljs-attribute">password</span> = <span class="hljs-string">"*****"</span>
  <span class="hljs-attribute">urls</span> =<span class="hljs-meta"> ["http://127.0.0.1:7777/jvm-service"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">inputs</span>.jolokia<span class="hljs-number">2</span>_agent.metric]]
  <span class="hljs-attribute">paths</span> =<span class="hljs-meta"> ["Usage","PeakUsage","CollectionUsage","Type"]</span>
  <span class="hljs-attribute">name</span> = <span class="hljs-string">"java_memory_pool"</span>
  <span class="hljs-attribute">mbean</span> = <span class="hljs-string">"java.lang:name=*,type=MemoryPool"</span>
  <span class="hljs-attribute">tag_keys</span> =<span class="hljs-meta"> ["name"]</span><font></font>
<font></font>
[[<span class="hljs-attribute">processors</span>.converter]]<font></font>
  [<span class="hljs-attribute">processors</span>.converter.fields]
    <span class="hljs-attribute">integer</span> =<span class="hljs-meta"> ["CollectionUsage.*", "PeakUsage.*", "Usage.*"]</span>
    <span class="hljs-attribute">tag</span> =<span class="hljs-meta"> ["Type"]</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana中，我</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发出了一个请求，要求</font><font style="vertical-align: inherit;">在</font></font><b><code>Usage.Committed</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤中以一个步长</font></font><b><code>$granularity</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1m）</font><font style="vertical-align: inherit;">在图表中显示最大度量值</font><font style="vertical-align: inherit;">，并按两个标签</font></font><b><code>Type</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（HEAP或NON_HEAP）和</font></font><b><code>name</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（元空间，G1 Old Gen等）</font><font style="vertical-align: inherit;">分组</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
相同的请求在文本形式中，考虑到所有</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">（注意使用来转义变量值</font><font style="vertical-align: inherit;">-这对于查询正确工作很重要）：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/qx/2z/-2/qx2z-2mblgxyi-u6g4mrbyvybf8.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><code>:regex</code></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量的特定值，以文本形式进行的相同查询</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^serverName$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^<span class="hljs-keyword">http</span>:\/\/<span class="hljs-number">127</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.0</span>\<span class="hljs-number">.1</span>:<span class="hljs-number">7777</span>\/jvm-service$/ <span class="hljs-keyword">AND</span>
    <span class="hljs-built_in">time</span> &gt;= <span class="hljs-number">1583834400000</span>ms <span class="hljs-keyword">and</span> <span class="hljs-built_in">time</span> &lt;= <span class="hljs-number">1583877600000</span>ms
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-built_in">time</span>(<span class="hljs-number">1</span>m)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按时间分组</font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><code>GROUP BY time(1m)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于减少图表上的点数。</font><font style="vertical-align: inherit;">对于12小时的时间段和1分钟的分组步骤，我们得到：12 x 60 = 720次或721点（最后一个点的值为null）。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，</font><font style="vertical-align: inherit;">在时间间隔（12小时）和分组步骤（1分钟）中</font><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">721</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">在当前设置下</font><font style="vertical-align: inherit;">响应</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB的</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求的预期点数</font><font style="vertical-align: inherit;">。</font></font></blockquote> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
内存</font><b><font style="vertical-align: inherit;">池：</font></b><font style="vertical-align: inherit;">在20 </font><b><font style="vertical-align: inherit;">：00，Metaspace</font></b><font style="vertical-align: inherit;">（蓝色）在内存消耗方面处于领先地位。</font><font style="vertical-align: inherit;">根据</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP：G1老一代</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（黄色），当地时间17:03出现小幅激增。</font><font style="vertical-align: inherit;">并且在20:00时，所有</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">池</font><font style="vertical-align: inherit;">总计</font><font style="vertical-align: inherit;">剩下</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（113.2 + 45.9 + 13.4），而</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">池则</font><font style="vertical-align: inherit;">剩下</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（67 + 57 + 4）。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ku/mo/wf/kumowfdo6gkw3wx_b8mugtsp8l4.png"></a><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住20:00的值：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">池</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.5 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">池</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">128 MiB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">未来我们将专注于这些价值观。</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的上下文中</font><font style="vertical-align: inherit;">，我们轻松获得了指标值。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在仅</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签的上下文中</font><font style="vertical-align: inherit;">，度量值也很容易获得，因为所有内存池的名称都是唯一的，并且仅按</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留结果分组就足够了</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题仍然存在：如何获得为所有HEAP池和所有NON_HEAP池分配的总大小？</font></font></blockquote><br>
<a name="1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.仅按类型标签分组的金额</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1。</font><font style="vertical-align: inherit;">按标签分组的总和</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能想到的第一个解决方案是通过</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签对值进行分组</font><font style="vertical-align: inherit;">并计算</font><font style="vertical-align: inherit;">每组中值</font><font style="vertical-align: inherit;">的总和。</font><font style="vertical-align: inherit;">这样的查询将如下所示：</font><font style="vertical-align: inherit;">
以</font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;">标记</font><font style="vertical-align: inherit;">和所有</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">分组的总和计算请求的文本表示形式</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/xz/w_/4a/xzw_4aonrgekrw4onxv9fwcctlg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"Usage.committed"</span>)
<span class="hljs-keyword">FROM</span> <span class="hljs-string">"telegraf"</span>.<span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span>
<span class="hljs-keyword">WHERE</span>
    host =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span>
    jolokia_agent_url =~ /^${jolokia:regex}$/ <span class="hljs-keyword">AND</span><font></font>
    $timeFilter<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是一个有效的查询，但它只会返回两点：和将仅通过</font><font style="vertical-align: inherit;">具有两个值（HEAP和NON_HEAP）</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">分组计算</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们什至看不到时间表。</font><font style="vertical-align: inherit;">将有两个独立的点，它们的值之和很大（超过3 TiB）：</font><font style="vertical-align: inherit;">
这样的和不合适，需要细分为时间间隔。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/sz/lx/bo/szlxboh0o4r3-jsq7jg9d49wnic.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2。</font><font style="vertical-align: inherit;">每分钟按标签分组的数量</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在原始查询中，我们通过自定义</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$粒度</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">间隔对指标进行分组</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在让我们按自定义间隔进行分组。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该查询将被补充</font></font><b><code>GROUP BY time($granularity)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
我们得到的是虚高的值，而不是</font><b><font style="vertical-align: inherit;">NON_HEAP</font></b><font style="vertical-align: inherit;">的172.5 MiB，</font><font style="vertical-align: inherit;">我们看到的是4.88 GiB：</font><font style="vertical-align: inherit;">
由于指标每2秒发送一次到InfluxDB（请参阅</font><font style="vertical-align: inherit;">上面的</font><b><font style="vertical-align: inherit;">telegraf.conf</font></b><font style="vertical-align: inherit;">），所以一分钟内的读数总和不会给出该数量此刻，以及三十个这样的金额之和。</font><font style="vertical-align: inherit;">我们也不能将</font><font style="vertical-align: inherit;">
结果除以常数</font><b><font style="vertical-align: inherit;">30</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于</font><b><font style="vertical-align: inherit;">$粒度</font></b><font style="vertical-align: inherit;">是一个参数，因此可以将其设置为1分钟和10分钟。</font><font style="vertical-align: inherit;">并且金额的值将改变。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/yb/xp/tw/ybxptwbmibq2xlujuuwbkwb83nq.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/9l/lo/hn/9llohn9ncpoztbtcsrfqzfzoqya.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3。</font><font style="vertical-align: inherit;">标签每秒分组</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了正确获取当前度量标准收集强度（2秒）的度量标准值，您需要计算不超过度量标准收集强度的固定间隔的量。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们尝试以秒为单位显示统计信息。添加到</font></font><b><code>GROUP BY</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组中</font></font><b><code>time(1s)</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
如此小的粒度，我们在12小时的时间间隔（12小时* 60分钟* 60秒= 43,200个间隔，每行43,201点，最后一行为空）中获得了</font><font style="vertical-align: inherit;">
大量的点</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">43,201点在图表的每一行中。有很多</font><b><font style="vertical-align: inherit;">点</font></b><font style="vertical-align: inherit;">，</font><b><font style="vertical-align: inherit;">InfluxDB</font></b><font style="vertical-align: inherit;">将长时间形成响应，</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">将花费更长的响应时间，然后浏览器将在很长一段时间内绘制大量的点。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/vn/sl/q_/vnslq_lq48mzzh9hgmjwiuvcy2i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/_2/mw/4k/_2mw4ki9rcnf140m2doyqsn-zxy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且不是每秒钟都有点：指标每2秒收集一次，并按每秒分组，这意味着每秒钟的点将为空。要查看平滑线，请配置非空值的连接。否则，我们将看不到这些图形：</font><font style="vertical-align: inherit;">
以前，</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">使得浏览器在绘制大量点时挂起。现在，</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">版本</font><font style="vertical-align: inherit;">可以绘制数万个点：浏览器仅跳过其中的一些点，使用稀疏的数据绘制图形。但是该图被平滑了。高点显示为平均高点。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/xx/ya/hf/xxyahfkl3xzk6ezsakvgsbi8lp4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，有一个图形，它被正确显示，正确计算了20:00时的度量，正确计算了图表图例中的度量。</font><font style="vertical-align: inherit;">但是图形是平滑的：1秒的精度在其上看不到爆发。</font><font style="vertical-align: inherit;">尤其是</font><font style="vertical-align: inherit;">从图表中消失</font><font style="vertical-align: inherit;">了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17:03</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">的</font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;">激增</font><font style="vertical-align: inherit;">，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图表</font><font style="vertical-align: inherit;">非常平滑：</font><font style="vertical-align: inherit;">
性能</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">负数将在更长的时间间隔内清楚地体现出来。</font><font style="vertical-align: inherit;">如果您尝试在一个月（720小时）内而不是在12小时内构建图形，那么所有内容都将以这么小的粒度（1秒）冻结，这将导致太多点。</font><font style="vertical-align: inherit;">在没有峰值的情况下存在一个负数，这是一个悖论- </font><b><font style="vertical-align: inherit;">由于获取指标的准确性很高，因此显示的准确性也很差</font></b><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/1g/vs/m8/1gvsm8owfg-ifjjcqwf-w1q2lbk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.格拉法纳路。</font><font style="vertical-align: inherit;">我们使用一堆价值观</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><b><font style="vertical-align: inherit;">设计器</font></b><font style="vertical-align: inherit;">无法</font><b><font style="vertical-align: inherit;">创建</font></b><font style="vertical-align: inherit;">简单而高效的解决方案</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将仅尝试使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具</font><b><font style="vertical-align: inherit;">来</font></b><font style="vertical-align: inherit;">汇总原始图表中</font><b><font style="vertical-align: inherit;">显示</font></b><font style="vertical-align: inherit;">的指标。</font><font style="vertical-align: inherit;">是的，这是可能的！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1。</font><font style="vertical-align: inherit;">仅使悬停工具提示/累积值：累积</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将保持选择指标的要求不变，与“如何开始”部分中的要求相同：</font><font style="vertical-align: inherit;">
指标将按</font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;">和</font><b><font style="vertical-align: inherit;">name</font></b><font style="vertical-align: inherit;">分组</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是我们只会在图形的名称中显示</font><b><font style="vertical-align: inherit;">Type</font></b><font style="vertical-align: inherit;">标签</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
并且在可视化设置中，我们将按</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">堆栈对指标进行</font><b><font style="vertical-align: inherit;">分组</font></b><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
首先，将两个标签的分隔添加到两个不同的堆栈A和B中，以使它们的值不相交：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/s5/an/3e/s5an3errkt29lgc8byme6tnowz4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ls/vg/to/lsvgtohynssezzeiy04px0qwq3c.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/no/py/5g/nopy5ggb9ittxbz2phdei1egphg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加系列覆盖</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：A</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加系列覆盖</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / NON_HEAP / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：B</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后配置指标的可视化以在带有图形的工具提示中显示总价值：</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆叠与空值</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆叠</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：开</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悬停工具提示</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">累计值</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：累计</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悬停工具提示</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：单</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的不同功能</font><b><font style="vertical-align: inherit;">，</font></b><font style="vertical-align: inherit;">您需要按该顺序执行操作。</font><font style="vertical-align: inherit;">如果您更改操作顺序或将某些字段保留为默认设置，则某些操作将无效：</font></font><br>
<br>
<ul>
<li>    Stack <b>A</b>  <b>B</b>    <b>Stacking &amp; Null value</b> / <b>Stack</b>: On,    ;</li>
<li>  <b>Hover tooltip / Mode</b>    ,    <b>Single</b>,  <b>Hover tooltip</b>    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，我们看到了很多线条，例如我们自己。</font><font style="vertical-align: inherit;">但！</font><font style="vertical-align: inherit;">如果将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鼠标悬停</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在最上面的</font><b><font style="vertical-align: inherit;">NON_HEAP上</font></b><font style="vertical-align: inherit;">，工具提示将显示所有</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值之</font><b><font style="vertical-align: inherit;">和</font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该金额被认为是正确的，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经表示</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
并且，如果将鼠标悬停在名称为</font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;">的最上方图表上</font><font style="vertical-align: inherit;">，我们将通过</font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;">查看该金额</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">图形显示正确。</font><font style="vertical-align: inherit;">甚至</font><font style="vertical-align: inherit;">可以看到17:03 </font><font style="vertical-align: inherit;">的</font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;">激增</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
正式地，任务已完成。</font><font style="vertical-align: inherit;">
但是有缺点-显示了很多额外的图表。</font><font style="vertical-align: inherit;">您需要将光标移到它们的最上方。</font><font style="vertical-align: inherit;">并且在图例中，不是累积的，而是显示单个值，因此图例变得无用。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/p9/tx/tw/p9txtwio9i4uozvliutk5_dg13o.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/g5/78/bo/g578boco1u0sncwf0jmh8ejsyow.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2。</font><font style="vertical-align: inherit;">累加值：累积且隐藏中间行</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们修复先前解决方案的第一个缺点：确保不显示多余的图表。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了这：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将具有不同名称和值0的新指标添加到结果中。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将新的指标添加到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font><b><font style="vertical-align: inherit;">堆栈</font></b><font style="vertical-align: inherit;">顶部。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从显示隐藏-的原线</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们在主要请求之后添加两个新</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">：请求</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收值为0和名称为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的序列，</font><font style="vertical-align: inherit;">请求</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收值为0和名称为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的序列</font><font style="vertical-align: inherit;">。要获得0，我们取每个时间组中</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ Usage.committed”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段的第一个值，</font><font style="vertical-align: inherit;">然后减去它：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first（“ Usage.committed”）-first（“ Usage.committed”）</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -我们得到一个稳定的0。图形的名称在不丢失含义的情况下进行了更改由于方括号：</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[NON_HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[HEAP]</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;">和</font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;">合并到</font><b><font style="vertical-align: inherit;">堆栈A中</font></b><font style="vertical-align: inherit;">，并且还隐藏了所有</font><b><font style="vertical-align: inherit;">HEAP</font></b><font style="vertical-align: inherit;">。</font><b><font style="vertical-align: inherit;">[NON_HEAP]</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/no/kh/0f/nokh0fb2fp1t_ictdthli2etylg.png"></a><br>
<br>
<b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">在</font><b><font style="vertical-align: inherit;">堆栈B中</font></b><font style="vertical-align: inherit;">合并</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><b><font style="vertical-align: inherit;">隐藏NON_HEAP</font></b><font style="vertical-align: inherit;">：</font><b><font style="vertical-align: inherit;">将</font></b><b><font style="vertical-align: inherit;">鼠标</font></b><font style="vertical-align: inherit;">悬停在图表上时，通过工具提示中的</font><b><font style="vertical-align: inherit;">[NON_HEAP] </font></b><b><font style="vertical-align: inherit;">获取</font></b><font style="vertical-align: inherit;"> 
正确的金额</font><font style="vertical-align: inherit;">：</font><b><font style="vertical-align: inherit;">将</font></b><b><font style="vertical-align: inherit;">鼠标</font></b><font style="vertical-align: inherit;">悬停在图表上时，通过工具提示中</font><font style="vertical-align: inherit;">
的</font><b><font style="vertical-align: inherit;">[HEAP]</font></b><font style="vertical-align: inherit;">获取正确的金额</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">甚至所有的突发事件都是可见的：</font><font style="vertical-align: inherit;">
而且时间表很快就形成了。</font><font style="vertical-align: inherit;">但是图例始终显示为0，图例已变得无用。</font><font style="vertical-align: inherit;">
一切顺利！</font><font style="vertical-align: inherit;">真正的绕过是通过</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">堆栈</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，该文章被添加到“ </font><b><font style="vertical-align: inherit;">异常编程”</font></b><font style="vertical-align: inherit;">类别中</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/uf/zw/7s/ufzw7sw-oxjflnzkglbilrdgmw4.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/ga/mh/nz/gamhnzyw1thhnbi5mflkwrlvr_i.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/p_/tp/ev/p_tpevfzm7rwkc1534vyhe92ozg.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<a name="3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.子查询的最高和</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于我们已经使用了一系列</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">走上了异常编程的道路</font><font style="vertical-align: inherit;">，让我们继续。</font><font style="vertical-align: inherit;">让我们让</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回少量点并显示图例。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1最大值的累积和的增量之和</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们深入研究</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的可能性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以前，我经常通过提取累计金额的导数来提供帮助，因此，我们现在尝试应用此方法。</font><font style="vertical-align: inherit;">让我们切换到手动编辑请求的模式：</font><font style="vertical-align: inherit;">
让我们发出这样的请求：</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/om/-b/yt/om-bytkvhp5zisny6gw5io_g2ba.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"U"</span>) <span class="hljs-keyword">FROM</span> (
        <span class="hljs-keyword">SELECT</span> non_negative_difference(cumulative_sum(<span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>))) <span class="hljs-keyword">AS</span> <span class="hljs-string">"U"</span> 
        <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
        <span class="hljs-keyword">WHERE</span> <font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter <font></font>
        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-string">"Type"</span>, <span class="hljs-built_in">time</span>($granularity)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这里以时间为单位获取指标中的最大值，并从引用开始的那一刻起将这些值的总和按</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签分组</font><font style="vertical-align: inherit;">。结果，在每时每刻都会有所有类型的所有指示的总和（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NON_HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并以池名称分隔，但与版本1.2的情况不同，不会相加30个值，但最大只能是一个。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
而且，如果</font><font style="vertical-align: inherit;">在最后一步中</font><font style="vertical-align: inherit;">采用</font><font style="vertical-align: inherit;">这种累加总和</font><font style="vertical-align: inherit;">的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non_negative_difference</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增量</font><font style="vertical-align: inherit;">，则将</font><font style="vertical-align: inherit;">在时间间隔开始时获得</font><font style="vertical-align: inherit;">按</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签分组的所有数据池的总和值</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，仅按标签获取金额</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（不按</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组）</font><font style="vertical-align: inherit;">，您需要使用类似的分组参数进行顶级请求，但不按</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行分组</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于进行了如此复杂的查询，我们得到了所有类型的总和。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完美的时间表。</font><font style="vertical-align: inherit;">最大值的总和是正确计算的。</font><font style="vertical-align: inherit;">存在具有正确值（非零）的图例。</font><font style="vertical-align: inherit;">在工具提示中，您可以显示所有指标，而不仅仅是“单一”。</font><font style="vertical-align: inherit;">甚至显示了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEAP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">突发</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">
一件事-事实证明请求很困难：最大值的累积总和的增量随分组级别的变化而增加。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2分组级别发生变化的最高和</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您能做些比3.1版更简单的事情吗？潘多拉盒子已经打开，我们切换到手动查询编辑模式。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有人怀疑从累积量中获得增量会导致零影响-一种消灭另一种。摆脱</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">non_negative_difference（cumulative_sum（...））</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
简化请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们只剩下最大值的总和，而分组级别降低了：</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">sum</span>(<span class="hljs-string">"A"</span>)
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">max</span>(<span class="hljs-string">"Usage.committed"</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">"A"</span>
    <span class="hljs-keyword">FROM</span> <span class="hljs-string">"month"</span>.<span class="hljs-string">"java_memory_pool"</span> 
    <span class="hljs-keyword">WHERE</span><font></font>
            (<font></font>
                <span class="hljs-string">"host"</span> =~ /^${host:regex}$/ <span class="hljs-keyword">AND</span> 
                <span class="hljs-string">"jolokia_agent_url"</span> =~ /^${jolokia:regex}$/<font></font>
            ) <span class="hljs-keyword">AND</span> <font></font>
            $timeFilter<font></font>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>, <span class="hljs-string">"name"</span><font></font>
)<font></font>
<span class="hljs-keyword">WHERE</span> $timeFilter
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">time</span>($granularity), <span class="hljs-string">"Type"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是一个快速简单的查询，按分钟分组时，在12小时内每个系列仅返回721点：12（小时）* 60（分钟）= 720个间隔，721个点（最后一个空白）。请注意，时间过滤器已重复。它在子查询和分组请求中：</font><font style="vertical-align: inherit;">
如果没有</font><b><font style="vertical-align: inherit;">$ timeFilter，则</font></b><font style="vertical-align: inherit;">在外部分组请求中，返回的点数在12小时内不会是721，而是更多。由于子查询分组是</font><b><font style="vertical-align: inherit;">从</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">到</font></b><font style="vertical-align: inherit;">时间间隔执行的</font><font style="vertical-align: inherit;">，而没有过滤器的外部请求的分组将是</font><b><font style="vertical-align: inherit;">从</font></b><font style="vertical-align: inherit;"> ... </font><b><font style="vertical-align: inherit;">现在</font></b><font style="vertical-align: inherit;">的时间间隔</font><font style="vertical-align: inherit;">。并且如果在</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">不被选择的时间间隔过去的X小时（不使得</font><b><font style="vertical-align: inherit;">给</font></b><font style="vertical-align: inherit;"> = </font><b><font style="vertical-align: inherit;">现在</font></b></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/8s/ab/tg/8sabtg9rebcu-tonmirjck2jdmk.png"></a><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），但在从过去（</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的间隔内，</font><font style="vertical-align: inherit;">将出现选择末尾具有空值的空点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果图简单，快速，正确。</font><font style="vertical-align: inherit;">具有显示摘要指标的图例。</font><font style="vertical-align: inherit;">带有工具提示，可同时显示多行。</font><font style="vertical-align: inherit;">并且还显示所有突发值：</font><font style="vertical-align: inherit;">
结果达到了！</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/an/yv/1t/anyv1t7m69cwrl6cnwgl-dwd7xy.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考（代替参考）</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文中使用的工具的分布：</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格拉法纳</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（6.5.0）</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">influxdb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1.7.9）</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegraf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1.13.3）</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jolokia-jvm-1.6.2-agent.jar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1.6.2）</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有关本文中使用的工具功能的文档：</font></font><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留策略</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB数据保留</font></font></a></td>
<td>Retention policy <b>montn</b>   30  ,     JVM    .       <b>auto</b>,     .   «  »   <b>telegraf.conf</b>      <b>InfluxDB</b>  ,      <b>Grafana</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">InfluxDB v1.x Output Plugin</a></td>
<td>    <b>Telegraf</b>  <b>InfluxDB</b>.     <b>telegraf.conf</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">agent / interval</a></td>
<td>   ,     2 .   «  »   <b>telegraf.conf</b>.   «1.2.       »  «1.3.       »</td>
</tr>
<tr>
<td>Java 8 / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Interface MemoryPoolMXBean</a></td>
<td>  MemoryPool,  ,     bool,  long.     <b>telegraf.conf</b>    int</td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jolokia2 Input Plugins</a></td>
<td>  <b>telegraf.conf</b>   MBean-,     <b>InfluxDB</b></td>
</tr>
<tr>
<td>Telegraf / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Converter Processor</a></td>
<td>  <b>telegraf.conf</b>,      <b>float</b>   <b>int</b>    <b>InfluxDB</b>.      <b>Type</b>   <b>Type</b>,        </td>
</tr>
<tr>
<td>Grafana / Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Advanced Formatting Options / Regex</a></td>
<td> Grafana,    Multiselect    ,    ,     ,    <b><code>~ /^<u>${}</u>$/</code></b> — ,  <b><code>~ /^${<u>:regex</u>}$/</code></b></td>
</tr>
<tr>
<td>Grafana / Variables / Global Built-in Variables / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">The $timeFilter or $__timeFilter Variable</a></td>
<td> Grafana- <b>$timeFilter</b>,     </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MAX()</a></td>
<td>  <b>MAX()</b>  <b>InfluxDB</b> 1.7,       </td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SUM()</a></td>
<td>    <b>SUM()</b>  <b>InfluxDB</b> 1.7</td>
</tr>
<tr>
<td>InfluxDB / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Subqueries</a></td>
<td>    <b>InfluxDB</b> 1.7,     3 </td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUMULATIVE_SUM()</a></td>
<td>  <b>CUMULATIVE_SUM()</b>,        <b>InfluxDB</b>,    <b>NON_NEGATIVE_DERIVATIVE()</b></td>
</tr>
<tr>
<td>InfluxDB / Transformation / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NON_NEGATIVE_DERIVATIVE()</a></td>
<td>  <b>NON_NEGATIVE_DERIVATIVE()</b>,     3 .     <b>CUMULATIVE_SUM()</b> —          3</td>
</tr>
<tr>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Using Grafana’s Query Inspector to troubleshoot issues</a></td>
<td> <b>Query Inspector</b>,         ,        Grafana-</td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Draw Options</a></td>
<td>  Stack, Tooltip,…              «2. Grafana-way.   » </td>
</tr>
<tr>
<td>Grafana / Graph / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Series overrides</a></td>
<td>       (     )  <b>Grafana</b></td>
</tr>
</tbody></table></div><br>
<h2></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能测试工程师需要众所周知</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
的</font><b><font style="vertical-align: inherit;">结合</font></b><font style="vertical-align: inherit;">。在此捆绑软件中，许多简单的任务非常有趣，它们不能总是通过常规编程方法来解决。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有时，可能需要具有</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafana</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能</font><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font><b><font style="vertical-align: inherit;">语言的</font></b><font style="vertical-align: inherit;">精妙之处的</font><font style="vertical-align: inherit;">异常编程技能</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，考虑了对按一个标签分组但有多个标签的度量进行汇总的实现的四个步骤。任务很有趣。并且有许多这样的任务。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备一份有关</font><b><font style="vertical-align: inherit;">Grafana</font></b><font style="vertical-align: inherit;">和</font><b><font style="vertical-align: inherit;">InfluxDB</font></b><font style="vertical-align: inherit;">编程</font><b><font style="vertical-align: inherit;">技巧</font></b><font style="vertical-align: inherit;">的报告</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我将定期发布有关此主题的材料。</font><font style="vertical-align: inherit;">同时，对于您对当前文章的疑问，我将感到满意。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490754/index.html">Visual Studio代码代码编辑器。为初学者设置和安装插件的最详细指南</a></li>
<li><a href="../zh-CN490756/index.html">将Jenkins部署为代码</a></li>
<li><a href="../zh-CN490758/index.html">数学家证明了湍流的普遍定律</a></li>
<li><a href="../zh-CN490760/index.html">射线投射视觉搜索（RCVS）。查找几何形状相似的3D模型的简单快速算法</a></li>
<li><a href="../zh-CN490762/index.html">如何预测机票价格？</a></li>
<li><a href="../zh-CN490766/index.html">如何理解初学者，为期望的职业选择哪种语言？</a></li>
<li><a href="../zh-CN490768/index.html">当您从事计算机游戏时：云游戏的内部设备</a></li>
<li><a href="../zh-CN490770/index.html">负有技术债务！在2020年TechLead大会上，我们将向您展示</a></li>
<li><a href="../zh-CN490772/index.html">如何在电报开放网络（TON）中编写和发布智能合约</a></li>
<li><a href="../zh-CN490774/index.html">反应灵敏</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>