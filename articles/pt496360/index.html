<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï† üßúüèº ‚≠êÔ∏è BFCache ou L√° e volta. Relat√≥rio Yandex üë©üèª‚Äçü§ù‚Äçüë®üèø üîü üí¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As pessoas usam o bot√£o de retorno para a p√°gina anterior no navegador com muita frequ√™ncia - talvez com mais frequ√™ncia do que voc√™ imagina. Se sim, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>BFCache ou L√° e volta. Relat√≥rio Yandex</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/496360/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As pessoas usam o bot√£o de retorno para a p√°gina anterior no navegador com muita frequ√™ncia - talvez com mais frequ√™ncia do que voc√™ imagina. </font><font style="vertical-align: inherit;">Se sim, por que jogar a p√°gina imediatamente fora da mem√≥ria do navegador e depois de um segundo gastar tempo e tr√°fego reabrindo-a? </font><font style="vertical-align: inherit;">Para que o usu√°rio possa voltar rapidamente, a tecnologia BFCache foi inventada, o que √© importante lembrar ao desenvolver interfaces. </font><font style="vertical-align: inherit;">Victor Khomyakov</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">victor-homyakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> descobriu o "cache de ida e volta" e compilou uma tabela de compatibilidade do BFCache com diferentes APIs.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vz2IsHcSaKE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ol√°, meu nome √© Victor. </font><font style="vertical-align: inherit;">Eu trabalho como parte de uma equipe bastante grande que lida com a p√°gina de pesquisa.</font></font><br>
<a name="habracut"></a><br>
<img src="https://habrastorage.org/webt/ai/mc/ut/aimcutfjg_xnumc1xre2li547vw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No m√≠nimo, voc√™ j√° viu a mesma p√°gina ou similar no Google. E, em particular, trato do problema da velocidade de download desta p√°gina - para que ela seja renderizada no servidor o mais r√°pido poss√≠vel e baixada e exibida para os clientes o mais r√°pido poss√≠vel. Por que isso √© importante? Quanto menos cliente aguardar o carregamento da sua p√°gina, menor a probabilidade de ele n√£o esperar e deixar voc√™. E quanto mais prov√°vel √© que o cliente se converta com √™xito em outra coisa, maior ser√° a pontua√ß√£o l√≠quida da promo√ß√£o. Ou seja, o cliente dir√° com satisfa√ß√£o a todos que eles sabem que essa √© uma p√°gina interessante - ela carrega muito rapidamente, √© muito conveniente de usar. E, finalmente, quanto mais dinheiro voc√™ pode ganhar. Ou sua empresa, ent√£o ele lhe dar√° um pr√™mio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou dar uma s√©rie de exemplos de empresas conhecidas. O Google conduziu um experimento. Eles intencionalmente incorporaram um atraso na p√°gina de pesquisa e mediram como isso afeta o desempenho. Descobriu-se que, em m√©dia, havia meio por cento menos pesquisas por usu√°rio. Quanto √© meio por cento? Calcular: meio por cento de centenas de milh√µes de usu√°rios do Google √© um n√∫mero bastante grande. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bing fez o mesmo experimento. Eles n√£o acreditavam no Google, eles decidiram verificar. Eles obtiveram resultados semelhantes: notavelmente menos receita por usu√°rio quando a p√°gina fica mais lenta. Por que desacelerar? Como √© mais f√°cil diminuir a velocidade da p√°gina pelo n√∫mero exato de milissegundos, para que ela possa ser facilmente reproduzida na produ√ß√£o do que para aceler√°-la na mesma quantidade.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo do AliExpress. Eles aceleraram o site em 36% e receberam significativamente mais pedidos dos usu√°rios. Os pedidos s√£o diretos. Em geral, j√° est√° claro para todos que a velocidade √© bastante importante, pois afeta, atrav√©s de um certo n√∫mero de m√©tricas, o dinheiro ganho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E mais um fator. Hoje j√° </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre otimiza√ß√£o de imagens. Ao otimizar seu tr√°fego, reduzindo o n√∫mero de downloads, voc√™ paga menos dinheiro aos seus hosters pelo tr√°fego de sa√≠da. Este tamb√©m √© o dinheiro que permanecer√° no seu bolso. E se de repente lhe oferecer um desconto de 10% no tr√°fego de qualquer host, sem restri√ß√µes e condi√ß√µes? E se eu proponho garantir que o compartilhamento de suas p√°ginas - por exemplo, 10% - seja carregado pelo usu√°rio quase instantaneamente? Ningu√©m vai recusar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tecnologia sobre a qual tentarei falar hoje em dia √© uma das solu√ß√µes poss√≠veis que imp√µe poucas restri√ß√µes sobre a pilha com a qual voc√™ trabalha, quais tecnologias, mas ao mesmo tempo promete oferecer ganhos bastante significativos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, o Google coleta estat√≠sticas sobre como esses navegadores s√£o usados ‚Äã‚Äãem seus navegadores. E eles publicaram esse n√∫mero: acontece, em m√©dia, de todas as aberturas de p√°ginas, de toda a navega√ß√£o no Chrome para dispositivos m√≥veis, cerca de 19% √© um movimento para a frente e para tr√°s na hist√≥ria. Pense no que isso significa? Se voc√™ arredondar, 20% da navega√ß√£o est√° se movendo para a p√°gina em que o usu√°rio acabou de estar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para n√≥s, assim como para os autores das p√°ginas, isso significa: mesmo que o usu√°rio saia, h√° uma chance consider√°vel de que ele esteja prestes a retornar. Por um lado, esse pode ser o problema dos telefones celulares: tudo √© pequeno, √© f√°cil perder um dedo, clicar no link e sair da p√°gina e dizer: ‚ÄúOh, droga! Eu quero retornar". Mas nos computadores de mesa, a situa√ß√£o √© a mesma: l√° o n√∫mero √© menor, mas ainda h√° uma porcentagem significativa de retornos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que estamos fazendo neste momento? Gastamos ineficazmente no tempo e no tr√°fego do usu√°rio. Ou seja, come√ßamos a recarregar a mesma p√°gina, analis√°-la, recriar o DOM, redesenhar tudo na tela, carregar, executar JavaScript.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O navegador √© uma coisa bastante poderosa. Ele est√° tentando usar caches sempre que poss√≠vel. E a maioria dos recursos pode estar em seu cache. Ele n√£o esperar√° por eles da rede, mas o buscar√° diretamente no cache. Por exemplo, no mecanismo V8, o resultado da an√°lise do JavaScript tamb√©m √© armazenado em cache. Ou seja, o navegador n√£o recarregar√° e analisar√° o JS e, na maioria dos casos, ser√° necess√°rio para execut√°-lo imediatamente. Mas ainda assim, reconstruir o DOM, recarregar recursos n√£o armazenados em cache e executar JS leva um tempo consider√°vel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A solu√ß√£o se sugere. O que estamos fazendo? Quando o usu√°rio sai da p√°gina, n√£o a limpamos imediatamente. Simplesmente salvamos seu estado e o escondemos visualmente do usu√°rio para que, sob o cap√¥, ele fique √† disposi√ß√£o do navegador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que faremos se o usu√°rio decidir retornar? </font><font style="vertical-align: inherit;">Apenas mostre a ele a mesma p√°gina salva. </font><font style="vertical-align: inherit;">Pode ser mostrado quase instantaneamente. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ax/xm/7d/axxm7doualef_atc2j8_ufybr2i.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa tecnologia √© chamada de cache de retorno / encaminhamento, a partir das palavras "para frente e para tr√°s". </font><font style="vertical-align: inherit;">Abrevia√ß√£o de bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° um exemplo de como o mesmo navegador, o mesmo assembly se comporta quando o bfcache est√° desativado e ativado. </font><font style="vertical-align: inherit;">A abertura da primeira p√°gina √© igualmente lenta l√° e ali. </font><font style="vertical-align: inherit;">Al√©m disso, quando come√ßamos a avan√ßar e retroceder na hist√≥ria, uma pausa √© notada √† esquerda e n√£o est√° √† direita. </font><font style="vertical-align: inherit;">√Ä esquerda, o movimento usual pela hist√≥ria leva um tempo percept√≠vel. </font><font style="vertical-align: inherit;">√Ä direita, tudo acontece muito, muito r√°pido.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/lf/0n/h1/lf0nh1gnji5qf1w9kj_irqcagrm.gif" width="350"><img src="https://habrastorage.org/webt/og/ca/_n/ogca_ny6xmytv-_iqvdl4xslpcq.gif" width="350"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um exemplo semelhante da nossa pesquisa. √Ä esquerda est√° o Safari usual no macOS com o bfcache desativado, √† direita est√° o mesmo Safari com as configura√ß√µes padr√£o e o bfcache ativado. Este √© um caso bastante comum: uma pessoa entra em busca, pode n√£o saber exatamente o que est√° procurando, pode solicitar v√°rias op√ß√µes de consulta. Eu pedi o primeiro pedido - algo n√£o est√° certo. O segundo pedido parece ser melhor. Terceiro - n√£o, pior, volte ao pedido anterior. E nesse momento seria muito bom n√£o faz√™-lo esperar. Ele acabou de ver esse pedido anterior, mostr√°-lo imediatamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou a segunda op√ß√£o, se voc√™ tiver pagina√ß√£o e v√°rias p√°ginas sobre o assunto. Homem folheando a quest√£o. Eu fui para a segunda, terceira, quarta p√°gina, olhei - n√£o, h√° algo errado, eu volto. E n√≥s, novamente, podemos mostrar a ele as p√°ginas anteriores quase que instantaneamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma quest√£o importante √© a seguran√ßa. Embora a p√°gina em que o usu√°rio n√£o estava oculto, ele possa acessar v√°rias APIs que permitem ler o status do hardware do seu telefone ou computador. Aqui est√° uma pequena lista do que veio √† mente imediatamente: geolocaliza√ß√£o, altera√ß√£o da posi√ß√£o do seu dispositivo no espa√ßo, acesso √† c√¢mera e som do microfone.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, quando a p√°gina aparecer, √© importante que ela n√£o obtenha acesso a todos os eventos que ocorreram durante o tempo em que foi ocultada. </font><font style="vertical-align: inherit;">Caso contr√°rio, um canal adicional ser√° aberto para espionar os usu√°rios. </font><font style="vertical-align: inherit;">√â importante que ela n√£o tenha um hist√≥rico dos seus movimentos durante todo esse tempo e das grava√ß√µes do microfone e da c√¢mera. </font><font style="vertical-align: inherit;">Os desenvolvedores de navegadores tamb√©m n√£o devem esquecer isso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suporte a API e navegador</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais perto do t√≥pico. Suponha que eu j√° o tenha convencido, voc√™ √©: "Sim, um bom t√≥pico, devemos trabalhar com isso". Com quais APIs temos √† nossa disposi√ß√£o, com o que podemos trabalhar se concordamos em levar o bfcache em considera√ß√£o e como isso √© suportado pelos navegadores? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Onde o bfcache j√° existe, onde posso v√™-lo? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- H√° muito que √© implementado nos navegadores Firefox, Safari (e macOS e iOS), bem como no Internet Explorer 11 (!). Normalmente, censuramos os desenvolvedores da Microsoft, mas aqui eles apenas tentaram. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- √â implementado no navegador UC Browser 11/12, vers√£o para Android. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- De repente ele n√£o est√° no Chrome. E no Chromium esse recurso est√° em desenvolvimento.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_v/dh/yq/_vdhyq6ph84lnnb05f2ffw75ud4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, quando eles fazem isso no Chromium, quase todos esses navegadores (e essa n√£o √© uma lista completa), mais cedo ou mais tarde, obter√£o essa funcionalidade - de gra√ßa, sem SMS e registro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe algum tipo de API? Eu quero gerenciar o bfcache, quero ativ√°-lo e desativ√°-lo diretamente do JavaScript, para descobrir se h√° alguma p√°gina no bfcache ou n√£o. Que tal uma API? N√£o existe essa API. E isso foi feito conscientemente: a p√°gina n√£o deve querer ativar ou desativar o bfcache para todos e para si. Ou descubra se h√° algu√©m neste bfcache ou n√£o. Tudo isso √© devido √† seguran√ßa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4m/5i/ra/4m5iragmxqrikl_7i8dqp-0ijcy.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas o que n√≥s temos? Tipos de navega√ß√£o. Existe um tipo de link - pr√©-renderizador de link, quando queremos renderizar uma p√°gina com anteced√™ncia. Existe um tipo especial de navega√ß√£o para ele: esta p√°gina ser√° aberta com o NavigationType "prerender". Se apenas abrirmos a p√°gina em um navegador, haver√° "navegar". Se clicarmos no bot√£o "Atualizar", ele ser√° "recarregado". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos interessados ‚Äã‚Äãno tipo de navega√ß√£o "back_forward" aqui, isso indica claramente que o usu√°rio avan√ßou e retrocedeu na hist√≥ria. Esse √© exatamente o tipo de navega√ß√£o com o qual o bfcache pode trabalhar.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ud/8o/o_/ud8oo_rhzpnyzjfdymvr11pfg4i.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra API s√£o os eventos de exibi√ß√£o de p√°gina de exibi√ß√£o de p√°gina. Eles j√° existiam nos navegadores. Consequentemente, a exibi√ß√£o de p√°gina √© acionada quando sua p√°gina √© exibida no navegador para o usu√°rio, o ocultar da p√°gina √© acionado quando a p√°gina est√° oculta por qualquer motivo. E eles foram complementados pelo campo persistente. Se a p√°gina estiver oculta e ao mesmo tempo for colocada no bfcache, o campo persistido ser√° verdadeiro. Se a p√°gina for exibida ao levant√°-la do bfcache, o campo persistido ser√° verdadeiro novamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, se o navegador n√£o estiver armazenando em cache a p√°gina, o ocultar da p√°gina persistir√° como falso. E se o navegador exibir a p√°gina durante o carregamento normal ou n√£o usar o bfcache, a pageshow tamb√©m persistir√° como false. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/7v/kh/kh/7vkhkhw8tjkz6y10o97urigdhea.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O suporte a eventos est√° dispon√≠vel em quase todos os navegadores, mesmo naqueles que ainda n√£o suportam o bfcache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/om/6w/7h/om6w7hjxxswbq5uvpaiu-afe5to.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
O mesmo vale para o campo persistente. Ele j√° existe no Chrome, e o Chrome ainda n√£o suporta bfcache. Ou seja, esse campo estar√° sempre nele, mas por enquanto ser√° falso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando me deparei com esse fen√¥meno, bfcache, tive que estud√°-lo, tocar por todos os lados, ver como ele funciona. Eu imediatamente quis ver na minha p√°gina quando abro qual √© o valor do campo persistente em meus manipuladores.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/dx/k6/qe/dxk6qegw2k1ohv-osipeghzjccw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que tudo √© bastante simples. Eu escrevi um manipulador e produzi para console.log () o que vem a mim. Mas, ao abrir o DevTools em alguns navegadores, o bfcache pode ser desligado repentinamente. Ou seja, abri o DevTools, voltei e voltei pelas p√°ginas e meu persistente √© sempre falso, a p√°gina n√£o entra no bfcache. Ok, eu tenho outra ferramenta poderosa - alerta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas n√£o. Navegadores modernos ao descarregar uma p√°gina no oculto da p√°gina, antes que os manipuladores de descarregar e descarregar simplesmente ignorem o alerta, ele simplesmente n√£o funciona l√°. E, novamente, n√£o vejo o que quero. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/by/1b/ij/by1bijibkuzglk6vvkhbcvrmmgo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, eu tenho um produto ainda mais matador. Estou em um bloco na minha pr√≥pria p√°gina, que estou explorando, apenas adicionando o texto do conte√∫do do meu evento e, assim, registrando tudo. Este m√©todo funcionou.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jw/xt/o1/jwxto1ndmuldxtn4hpoa_3z6-bk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo, por favor, pode ser usado. Eu depurei meu c√≥digo, ele funciona para mim, posso continuar com ele. Obviamente, n√£o esque√ßo que, afinal, um script est√°tico externo √© mais adequado para n√£o carregar o mesmo c√≥digo embutido na p√°gina, mas para usar o cache de arquivos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu coloquei esse c√≥digo depurado em um script externo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/x1/5m/s0/x15ms0a9q4solt69-vucvdyoqgu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas n√£o, os manipuladores de p√°ginas paginadas ca√≠ram no Safari! Por alguma raz√£o, eles n√£o funcionam a partir de um script externo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ok, eu j√° tenho uma vers√£o funcional. Eu tive que deixar assim.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/td/kq/aw/tdkqawklgz4m_mdw7d_elw7a27m.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou listar brevemente o que consegui seguir em apenas um dia. Primeiro, o DevTools pode desativar o cache. Voc√™ provavelmente se lembra que no DevTools, na guia Rede do Chrome, h√° uma caixa de sele√ß√£o "Desativar cache". Ele desativa o cache da rede, pode n√£o afetar o bfcache ou pode. A analogia √© clara: abrimos o DevTools, o que significa que estamos desenvolvendo e talvez n√£o precisemos de cache. Talvez isso nos incomode. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4d/up/mb/4dupmbrpcewpmpngg49_fddhuf4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O segundo recurso √© alerta. O Firefox e o Safari ignoram silenciosamente e continuam a executar manipuladores ainda mais, como se n√£o houvesse alerta. E apenas um Chrome antigo no console gravar√° um erro em vermelho - voc√™ tem um alerta, eu o bloqueei, saiba! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais uma vez, lembro que os manipuladores de um script externo no Safari podem n√£o ser chamados, isso √© muito estranho.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E mais uma not√≠cia importante. </font><font style="vertical-align: inherit;">Se sua p√°gina estiver armazenada em cache, ou seja, voc√™ recebeu um evento de oculta√ß√£o de p√°gina, que diz "persistence true", e o navegador diz: "Sim, eu coloquei no cache", isso n√£o garante que a p√°gina ser√° mais tarde desse cache √© gerado e mostrado de volta ao usu√°rio. </font><font style="vertical-align: inherit;">Porque o navegador pode decidir limpar esse cache se ficar sem mem√≥ria. </font><font style="vertical-align: inherit;">Porque o usu√°rio pode fechar o navegador e n√£o navegar em qualquer lugar. </font><font style="vertical-align: inherit;">Lembre-se disso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recursos de implementa√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comecei a aprofundar a documenta√ß√£o, a pesquisar como posso viver com esse conhecimento. Surpreendentemente, a documenta√ß√£o foi. Ou seja, voc√™ pode desenterrar na Internet uma descri√ß√£o de como o bfcache funciona nos navegadores. Mas, quanto mais eu leio, mais diferen√ßas se acumulam entre diferentes navegadores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em um, funciona assim, no outro, funciona. Em um, um interfere, o outro n√£o interfere. Os desenvolvedores n√£o sabem como processar corretamente v√°rias APIs ao colocar uma p√°gina no bfcache. Eles dizem: ok, se a p√°gina usa essa API, eu simplesmente a ignoro, nunca a coloque no cache sob nenhuma circunst√¢ncia. E essa lista √© diferente em navegadores diferentes, cada um faz o que √© adequado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E ent√£o comecei a combinar o que aprendi em uma tabela. Eu tenho algo como o seguinte:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/9v/qm/iy/9vqmiyq_zcjwc5ln8nciv8golra.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu li a documenta√ß√£o para navegadores - para Firefox, Safari, a fam√≠lia Chromium. Havia documenta√ß√£o dispon√≠vel no IE, embora desatualizada. N√≥s programadores n√£o gostamos de atualizar a documenta√ß√£o ap√≥s altera√ß√µes no navegador? Quando percebi que as informa√ß√µes estavam desatualizadas, comecei a testar minhas pequenas p√°ginas nos navegadores e verificar qual API funciona ou n√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso tamb√©m n√£o foi suficiente: n√£o sei para quais APIs analisar, em princ√≠pio, mas n√£o para classificar tudo? E tive que examinar o c√≥digo fonte dos pr√≥prios mecanismos do navegador, ou seja, o c√≥digo acabou sendo a fonte de conhecimento mais precisa e confi√°vel. No momento, essa placa (√† sua frente √© uma parte dela, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui est√° um link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para a vers√£o completa) √© a cole√ß√£o mais abrangente de conhecimento sobre quais APIs permitem ou pro√≠bem o bfcache de trabalhar em navegadores.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
APIs que n√£o interferem com uma marca de sele√ß√£o e cor verde, aquelas que definitivamente impedir√£o a p√°gina de entrar no bfcache est√£o marcadas em vermelho. </font><font style="vertical-align: inherit;">Campos em branco s√£o espa√ßos que n√£o s√£o descritos em lugar algum.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raposa de fogo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o alguns detalhes interessantes de navegadores espec√≠ficos. Vou come√ßar com o Firefox, ele foi o primeiro a fazer tudo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fh/bt/fh/fhbtfhn8db-lqcxhqe8n8vm8z6u.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A coisa mais importante que aprendi com as fontes do Firefox √© que, ao trabalhar com o bfcache, ele pode gravar no disco de log de texto todas as raz√µes pelas quais n√£o pode colocar a p√°gina no cache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/xp/jr/ddxpjraedcefaftwi0u9cdys2tg.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E eu at√© consegui descobrir como faz√™-lo. Existem duas vari√°veis ‚Äã‚Äãde ambiente secretas: em uma indicamos o que registrar, na segunda - em qual arquivo gravar um log. Depois disso, lan√ßamos o bin√°rio e pronto! Veremos aproximadamente que no slide anterior, as linhas do formul√°rio "esse html n√£o podem ser armazenadas em cache por esse motivo, por outro motivo". Podemos l√™-lo imediatamente, muito conveniente.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ci/_u/3m/ci_u3mrg5k5um_zah0gtm7splmy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ quiser experimentar uma vez, poder√° abrir a p√°gina sobre: ‚Äã‚Äãrede no Firefox. L√° voc√™ pode inserir os mesmos campos na se√ß√£o "Di√°rio". Podemos indicar em dois campos o que e onde registrar, e com os bot√µes iniciar e parar o registro. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/w3/8s/zb/w38szbgmjgikrkqg-2f7tt6px0a.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quando o Firefox se recusa a armazenar em cache a p√°gina? Se voc√™ tiver solicita√ß√µes incompletas, incluindo solicita√ß√µes AJAX ou solicita√ß√µes de recursos como imagens, ele se recusar√° a colocar a p√°gina no bfcache. Ele acredita que n√£o est√° conclu√≠do, n√£o terminou o download, h√° algum tipo de atividade suspeita. Mas tudo isso n√£o se aplica ao favicon. Se voc√™ esqueceu o favicon, se ele n√£o carregar, ele pensa - tudo bem, ele far√° isso, √© normal para o seu site.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ tiver um script de longa execu√ß√£o, o navegador perguntar√°: como leva tempo, bloqueia a interface do usu√°rio, talvez supere? E se voc√™ concordou, essa p√°gina √© considerada um pouco errada e n√£o a armazenamos em cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ usa o IndexedDB ... Esta √© uma hist√≥ria instrutiva. Anteriormente, na primeira implementa√ß√£o, eles olhavam: se voc√™ tem o IndexedDB e h√° uma transa√ß√£o incompleta, essa p√°gina n√£o √© armazenada em cache, porque n√£o est√° claro como trabalhar com ela (estamos tentando ocult√°-la bem no meio da transa√ß√£o). Mas eles simplesmente perderam esse peda√ßo de c√≥digo durante a refatora√ß√£o. E como voc√™ pode imaginar, eles n√£o tinham testes para isso. Eles ainda t√™m um bug no bugtracker. Ele j√° tem dois anos com alguma coisa. As pessoas escreveram: "Meu bfcache com o IndexedDB n√£o funciona corretamente, o que devo fazer?" Os desenvolvedores do Firefox responderam - ele realmente falha, perdemos esse peda√ßo de texto durante a refatora√ß√£o, ok, deixe-o continuar. Moral: escreva testes, mesmo se voc√™ escreve o Firefox, caso contr√°rio tudo pode acabar tristemente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E mais um fator interessante de indisponibilidade no bfcache - se o conte√∫do misto for explicitamente permitido. O que √© isso? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fm/2s/le/fm2sleys4nir1cuff_lw8q87cqi.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Suponha que sua p√°gina seja aberta via HTTPS, mas voc√™ ainda carregar√° alguns recursos via HTTP, especialmente scripts. Ou seja, voc√™ possui um script que n√£o √© de seguran√ßa, que pode ser modificado por qualquer pessoa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/k8/kj/tsk8kj6weynueewx9goi38sm81o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Por padr√£o, o Firefox, como outros navegadores, n√£o executa um script que n√£o seja de seguran√ßa agora. Mas se for muito importante para voc√™, voc√™ acessou as configura√ß√µes e permitiu que ela fosse executada; portanto, ela n√£o armazenar√° essa p√°gina em cache. Ele dir√° - bem, voc√™ me disse para n√£o executar o c√≥digo, mas depois n√£o, n√£o!</font></font><br>
<br>
<img src="https://habrastorage.org/webt/pm/fg/_f/pmfg_fqywdhl7tihvcy09agmaxy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro ajuste √© o tamanho do pr√≥prio bfcache. Aqui, o padr√£o √© menos um. Isso significa quanta mem√≥ria o Firefox tem, tantas p√°ginas que ele tenta armazenar em cache. Mas podemos desativar √† for√ßa o cache colocando um zero ou definindo explicitamente um n√∫mero - por exemplo, lembre-se de n√£o mais que cinco p√°ginas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aviso: o pr√≥ximo slide cont√©m c√≥digo de exemplo na linguagem assustadora C ++, isso pode ser perigoso em uma confer√™ncia de front-end. N√£o tente copi√°-lo, execute-o no console do navegador. Seu disco pode estar formatado, a tela pode explodir ou os bitcoins podem ser extra√≠dos. Eu te avisei. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/31/l-/uo/31l-uokshfiuo6dyxcivmfzsm5o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, o c√≥digo Gecko. </font><font style="vertical-align: inherit;">Pode ser aberto, lido, visualizado gratuitamente na Internet. </font><font style="vertical-align: inherit;">E eu vasculhei. </font><font style="vertical-align: inherit;">Existe o m√©todo mais importante - CanSavePresentation (), que responde √† pergunta: √© poss√≠vel armazenar em cache este documento? </font><font style="vertical-align: inherit;">Ou seja, essa √© a melhor fonte de verdade sobre o que agora est√° implementado no Firefox. </font><font style="vertical-align: inherit;">E, no entanto - foi a partir da√≠ que aprendi que voc√™ pode ler o log. </font><font style="vertical-align: inherit;">Existe essa vari√°vel - gPageCacheLog. </font><font style="vertical-align: inherit;">Este √© o log no qual tudo est√° escrito. </font><font style="vertical-align: inherit;">Aqui est√° uma hist√≥ria t√£o interessante sobre uma excurs√£o em C ++. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, voc√™ abre o link, analisa o c√≥digo, pesquisa (existe uma pesquisa conveniente e, al√©m disso, r√°pida) e pode descobrir os detalhes reais da implementa√ß√£o na vers√£o mais recente do navegador - aqueles que simplesmente est√£o ausentes na documenta√ß√£o.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saf√°ri</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A coisa mais cruel que o Safari faz quando uma p√°gina atinge o bfcache: se voc√™ tiver solicita√ß√µes AJAX pendentes, o Safari as mata. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vp/bh/8p/vpbh8ppqy9qpfbpljjsu2huhtda.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo se voc√™ os tiver sobreposto com manipuladores de erro e tentar verificar tudo, corrija-o - parece que a solicita√ß√£o n√£o existia. Depois de se recuperar do bfcache, voc√™ n√£o ter√° nenhum erro, nenhum ‚ÄúOK‚Äù, nada. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/jx/yk/icjxykful4yo0d7hbjopj_woljo.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os manipuladores do pageshow pagehide, como eu disse, no Safari s√£o chamados apenas se forem escritos em um script embutido na p√°gina. De um script externo, eles podem ou n√£o funcionar - que sorte. Mas eu te avisei.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0i/o7/ns/0io7nsvts4isj0qbirjisggubeg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outra diferen√ßa interessante: antes dos manipuladores de descarregar e descarregar, n√£o interferem na entrada da p√°gina no bfcache. Nesse caso, o beforeunload √© sempre chamado, e quando entra no cache e quando n√£o √© atingido. Mas descarregar quando a p√°gina atinge o cache n√£o √© chamado. E aqui est√° outro rake localizado: a p√°gina pode ir para o cache e nunca aparecer a partir dele, e se voc√™ escreveu algum c√≥digo importante no descarregamento, ele nunca pode ser chamado, embora nenhum erro tenha ocorrido na p√°gina. Ou seja, ele foi corretamente para o cache, e dele para lugar nenhum, e sua descarga nunca ser√° chamada.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/6e/m2/xy/6em2xyin9409en33_y-xk3ewxtg.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro ponto interessante. Como voc√™ sabe, voc√™ pode abrir v√°rias janelas atrav√©s de window.open (). E, ao mesmo tempo, essas janelas t√™m links entre si. Ou seja, eles podem subir simultaneamente na janela um do outro, ler / escrever diferentes propriedades. Essa abertura das janelas filho n√£o interfere no bfcache. E aqui, muito provavelmente, o Safari √© t√£o cruel quanto √© com as solicita√ß√µes AJAX, ou seja, tudo est√° rasgando muito e at√© logo. Os desenvolvedores da Apple adoram mais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novamente um minuto em C ++! As fontes do WebKit tamb√©m n√£o s√£o secretas, elas tamb√©m podem ser abertas, lidas e estudadas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/a4/p5/cs/a4p5cs2yfjtvgxb_3iud8b-xog4.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Eles est√£o no GitHub, destacando duas fun√ß√µes importantes: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- canCacheFrame () - verifique se esse quadro pode ser armazenado em cache.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Em diferentes objetos da p√°gina, como um elemento ou fonte HTML, existem m√©todos canSuspendForDocumentSuspension (). Esse objeto √© respons√°vel por saber se pode armazenar em cache, congelar ou n√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E mais um aspecto importante: o WebKit tem testes muito convenientes. L√°, na pasta LayoutTests / fast / history, na forma de html pequeno, compacto e conciso, h√° testes para o trabalho de diferentes APIs implementadas no Safari com bfcache. Este √© um exemplo vivo de como voc√™ pode escrever c√≥digo no Safari com essas APIs e como elas afetam ou n√£o, permitindo ou n√£o permitir hits do bfcache. Muito interessante ver.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/r-/un/hxr-un8ehvr-zc5dqa_kgr4ieki.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A partir da√≠, aprendi que o Safari tamb√©m grava todo o seu conhecimento sobre o bfcache, todos os recursos, em um log de texto. </font><font style="vertical-align: inherit;">Infelizmente, nunca descobri como habilitar esse log ou, se estiver habilitado, onde encontrar esse arquivo em disco. </font><font style="vertical-align: inherit;">Se algu√©m souber, me diga, ficarei muito agradecido.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√≥mio.</font></font></h3><br>
<img src="https://habrastorage.org/webt/8z/yv/b5/8zyvb5feibkmt6njztlfuxgipas.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu j√° disse, ainda h√° trabalhos em andamento, tudo est√° fechado sob a bandeira. Voc√™ pode fazer o download do Chrome Canary fresco, acessar as bandeiras. A configura√ß√£o est√° oculta l√° - voc√™ pode tentar brincar com ela. Voc√™ pode ver alguma coisa. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/nu/fr/lw/nufrlwudx02dcxcxuwq0n-fk57e.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pelo interessante - eu j√° falei sobre abrir uma p√°gina atrav√©s de window.open (). No Chromium, essas p√°ginas n√£o s√£o armazenadas em cache at√© o momento. Eles n√£o descobriram como resolver tudo isso corretamente, e descaradamente o cortaram, como no Safari, a consci√™ncia deles n√£o os permite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se o DOMContentLoaded n√£o ocorrer, a p√°gina tamb√©m n√£o ser√° armazenada em cache.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem muitas APIs novas que come√ßam com "Web" - tamb√©m √© dif√≠cil e incompreens√≠vel para elas, e at√© agora todas elas desativam o bfcache por padr√£o. Ou seja, se algo novo e moderno for usado na p√°gina, como WebGL, WebVR, WebUSB, WebBluetooth etc., essa p√°gina n√£o entrar√° no bfcache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trabalhador de servi√ßo. Al√©m disso, ainda n√£o armazenamos essa p√°gina em cache, mas planejamos process√°-la corretamente, ocult√°-la dos olhos vigilantes do profissional de servi√ßo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a geolocaliza√ß√£o estiver ativada, ainda n√£o a armazenamos em cache. T√£o mais simples por enquanto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se durante o tempo em que a p√°gina estava no cache, os cookies foram podres, acreditamos que algum tipo de autoriza√ß√£o expirou. Talvez fosse banc√°rio on-line ou algo mais. Isso significa que a p√°gina n√£o √© mais v√°lida - n√≥s a limpamos do cache. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ae/et/dj/aeetdjeogvqqqmflxx5rtdbtz1o.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os caras do Google foram ainda mais longe. </font><font style="vertical-align: inherit;">Eles sugeriram que unific√°ssemos tudo o que formalizamos, unificamos em todos os navegadores, propusemos uma especifica√ß√£o do ciclo de vida da p√°gina para todos os estados, sugerimos a adi√ß√£o de novos eventos √†s transi√ß√µes entre diferentes estados. </font><font style="vertical-align: inherit;">Voc√™ pode olhar para o link que eles pensaram l√° em cima. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bl/nn/tw/blnntwl767kxalazcyls6lhx98c.jpeg"><br>
<b><sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link do slide</font></font></a></sub></sup></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fontes. </font><font style="vertical-align: inherit;">Como voc√™ sabe, as fontes de cromo tamb√©m est√£o dispon√≠veis. </font><font style="vertical-align: inherit;">Tudo isso est√° em uma classe chamada BackForwardCacheImpl - nomea√ß√£o muito boa, quase n√£o precisava ser visualizada. </font><font style="vertical-align: inherit;">O principal m√©todo que verifica se um documento pode ser salvo √© chamado CanStoreDocument (). </font><font style="vertical-align: inherit;">H√° tamb√©m um m√©todo GetDisallowedFeatures (), que simplesmente lista todos os novos recursos e APIs que n√£o s√£o suportados no bfcache. </font><font style="vertical-align: inherit;">Muito conveniente: concentrado em um s√≥ lugar, leu e percebeu o que √© atualmente poss√≠vel e o que n√£o pode ser usado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer 11</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma excurs√£o √† hist√≥ria para quem ainda tem o IE 11. Para quem tem tudo de ruim. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hw/st/sy/hwstsylp95mjeehn-yapop5nwqy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existe o bfcache l√°, e esse √© o principal problema, porque voc√™ precisa lidar com isso. </font><font style="vertical-align: inherit;">A documenta√ß√£o diz que o bfcache supostamente funciona apenas em HTTP. </font><font style="vertical-align: inherit;">De fato, na produ√ß√£o, ele tamb√©m funciona em HTTPS por algum motivo. </font><font style="vertical-align: inherit;">Moral: se voc√™ √© um desenvolvedor, preste aten√ß√£o √† sua documenta√ß√£o. </font><font style="vertical-align: inherit;">Ent√£o voc√™ tem que sofrer por causa dela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se houver um manipulador de beforeunload, ele impedir√° que ele entre no cache. </font><font style="vertical-align: inherit;">Eles n√£o disseram nada sobre a descarga na documenta√ß√£o - talvez n√£o soubessem ou se esquecessem disso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se a p√°gina n√£o tiver terminado o carregamento, ela tamb√©m n√£o ser√° armazenada em cache. </font><font style="vertical-align: inherit;">Se algu√©m usa componentes ActiveX, tamb√©m n√£o fazemos cache. </font><font style="vertical-align: inherit;">E se o DevTools tamb√©m estiver aberto l√°. </font><font style="vertical-align: inherit;">esse √© um ponto importante.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8o/lh/n5/8olhn5ii0fctbxehrs7ab4blwro.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como sem bugs? Adicionado campo persistente, mas √†s vezes n√£o funciona. Ou seja, a p√°gina realmente entra no cache, retorna dele e persiste n√£o est√° definida como true. O que fazer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
T√≠nhamos um c√≥digo bonito que determina se retornamos do cache ou recarregamos do servidor. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/op/h1/xb/oph1xbddsxbkhzjlygiyoavtmam.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora tinha que ser complementado com uma muleta para o IE. Determinamos que temos o IE e, em algumas solu√ß√µes alternativas, entendemos que a p√°gina ainda foi extra√≠da do cache e, ao mesmo tempo, tivemos uma navega√ß√£o no hist√≥rico (back_forward). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ct/xe/af/ctxeafrbbmwt1h_9j16jw4fviji.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, como voc√™ sabe se uma p√°gina √© armazenada em cache? N√≥s levamos o tempo de carregamento dela. Se ele carregou do servidor em 50 milissegundos ou mais r√°pido, ent√£o isso basicamente n√£o pode estar no IE - significa que √© do cache! :)</font></font><br>
<br>
<img src="https://habrastorage.org/webt/j-/ib/ch/j-ibchnxog-rdmeez6gmjnbmwr4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu j√° mencionei a navega√ß√£o atrav√©s da hist√≥ria. </font><font style="vertical-align: inherit;">Se tivermos o tipo de navega√ß√£o back_forward, analisamos o hist√≥rico e, se a p√°gina for do cache, significa bfcache, n√£o h√° outras op√ß√µes no IE.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qual √© o pr√≥ximo?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O que fazer em seguida com esse conhecimento? </font><font style="vertical-align: inherit;">Eu n√£o gostaria que voc√™ sa√≠sse e esquecesse tudo isso como um pesadelo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Em primeiro lugar, aqui est√° a coisa mais valiosa que eu me deparei e o que eu quero levar voc√™: use navegadores de c√≥digo aberto! </font><font style="vertical-align: inherit;">No acesso aberto √† Internet, no momento, est√£o o c√≥digo fonte de todos os principais navegadores que nossos clientes usam. </font><font style="vertical-align: inherit;">E esta √© a documenta√ß√£o mais relevante sobre como e como √© suportada, onde e como funciona. </font><font style="vertical-align: inherit;">Incluindo existem testes escritos diretamente em HTML e JS. </font><font style="vertical-align: inherit;">Use, olhe!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Em segundo lugar, considere nos aplicativos existentes que eles podem executar o bfcache. </font><font style="vertical-align: inherit;">Informe seus testadores sobre isso para que, quando verifiquem a navega√ß√£o, eles saibam que, ao navegar pelo hist√≥rico, a p√°gina possa ser aberta no servidor e no bfcache. </font><font style="vertical-align: inherit;">Aqui est√° um v√≠deo do bug real que corrigimos quando o bfcache trabalhava para n√≥s:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abrir GIF</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vx/1j/dv/vx1jdv4ubukownlagrvftn30g6k.gif" width="400"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O usu√°rio digita quatro solicita√ß√µes, v√™ quatro problemas. </font><font style="vertical-align: inherit;">Depois disso, ele volta, v√™ o problema 3 e a consulta 4. Outro problema anterior √© 2 e a consulta 3. Ou seja, ele possui um estado incompat√≠vel da p√°gina - o conte√∫do das cadeias de pesquisa e pesquisa se contradizem. </font><font style="vertical-align: inherit;">Lembre-se disso em seus aplicativos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- E terceiro, se voc√™ estiver escrevendo um novo c√≥digo, pense se precisa do bfcache. </font><font style="vertical-align: inherit;">Nesse caso, use a tabela de compatibilidade da API. </font><font style="vertical-align: inherit;">Caso contr√°rio, n√£o use, mas se voc√™ acidentalmente entrar no bfcache, considere os recursos do Safari e de outros navegadores que mencionei. </font><font style="vertical-align: inherit;">Algumas coisas podem rasgar insolentemente e voc√™ n√£o ser√° capaz de entender por que isso acontece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como prometido, um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para os materiais.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt496348/index.html">Estudos de caso da API de armazenamento na Web</a></li>
<li><a href="../pt496350/index.html">Voc√™ n√£o passar√°! - Impressoras 3D respondem ao coronav√≠rus</a></li>
<li><a href="../pt496354/index.html">Programa√ß√£o tern√°ria: brinque com o emulador</a></li>
<li><a href="../pt496356/index.html">Criando um Navegador Utilizando Tecnologias de Realidade Aumentada e M√©todos de Aprendizado de M√°quina</a></li>
<li><a href="../pt496358/index.html">Preparando-se para celebrar o Dia da Cosmon√°utica on-line (a lista est√° sendo atualizada)</a></li>
<li><a href="../pt496362/index.html">Reset de m√°scaras</a></li>
<li><a href="../pt496366/index.html">Miniss√©rie: computador tern√°rio fa√ßa voc√™ mesmo</a></li>
<li><a href="../pt496368/index.html">Startup australiana desenvolve PC h√≠brido a partir de componentes eletr√¥nicos e biol√≥gicos</a></li>
<li><a href="../pt496370/index.html">Alegrias e tristezas das vit√≥rias sobre C: fazemos doces a partir do prot√≥tipo wc em Haskell</a></li>
<li><a href="../pt496372/index.html">Como criar uma exibi√ß√£o personalizada para alert (), confirm () e prompt () para uso em JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>