<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèΩ üôç üë®üèº‚Äçüé® Encarts Android: g√©rer les peurs et se pr√©parer pour Android Q ‚óÄÔ∏è ü¶î üî±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Android Q est la dixi√®me version d'Android avec le niveau d'API 29. L'une des principales id√©es de la nouvelle version est le concept de bord √† bord, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Encarts Android: g√©rer les peurs et se pr√©parer pour Android Q</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/488196/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Q est la dixi√®me version d'Android avec le niveau d'API 29. </font><font style="vertical-align: inherit;">L'une des principales id√©es de la nouvelle version est le concept de bord √† bord, lorsque les applications occupent tout l'√©cran, de bas en haut. </font><font style="vertical-align: inherit;">Cela signifie que la barre d'√©tat et la barre de navigation doivent √™tre transparentes. </font><font style="vertical-align: inherit;">Mais, s'ils sont transparents, il n'y a pas d'interface utilisateur syst√®me - elle chevauche les composants interactifs de l'application. </font><font style="vertical-align: inherit;">Ce probl√®me est r√©solu avec des encarts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les d√©veloppeurs mobiles √©vitent les encarts, ils leur font peur. </font><font style="vertical-align: inherit;">Mais dans Android Q, il ne sera pas possible de contourner les encarts - vous devrez les √©tudier et les appliquer. </font><font style="vertical-align: inherit;">En fait, les encarts n'ont rien de compliqu√©: ils montrent quels √©l√©ments d'√©cran se croisent avec l'interface syst√®me et sugg√®rent comment d√©placer l'√©l√©ment afin qu'il n'entre pas en conflit avec l'interface utilisateur du syst√®me. </font><strong><font style="vertical-align: inherit;">Konstantin Tskhovrebov</font></strong><font style="vertical-align: inherit;"> expliquera le fonctionnement des encarts et leur utilit√©</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6Djql74drwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konstantin Tskhovrebov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terrakok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) travaille √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redmadrobot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A √©t√© impliqu√© dans Android pendant 10 ans et a accumul√© beaucoup d'exp√©rience dans divers projets dans lesquels il n'y avait pas de place pour les encarts, ils ont toujours r√©ussi √† se d√©placer d'une mani√®re ou d'une autre. </font><font style="vertical-align: inherit;">Konstantin racontera une longue histoire d'√©vitement du probl√®me des encarts, d'√©tudier et de combattre Android. </font><font style="vertical-align: inherit;">Il examinera les t√¢ches typiques de son exp√©rience dans lesquelles des encarts pourraient √™tre appliqu√©s et montrera comment arr√™ter d'avoir peur du clavier, reconna√Ætre sa taille et r√©pondre √† l'apparence. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque. </font><font style="vertical-align: inherit;">L'article a √©t√© √©crit sur la base d'un rapport de Konstantin √† </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saint AppsConf 2019</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Le rapport utilise des documents de plusieurs articles sur des encarts. </font><font style="vertical-align: inherit;">Lien vers ces documents √† la fin.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√¢ches typiques</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barre d'√©tat des couleurs. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans de nombreux projets, le concepteur dessine une barre d'√©tat couleur. </font><font style="vertical-align: inherit;">Il est devenu √† la mode lorsque Android 5 est venu avec le nouveau Material Design. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/9l/ii/76/9lii76jdfrbb5i0vq8-ecv2ikby.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment peindre la barre d'√©tat? </font><font style="vertical-align: inherit;">√âl√©mentaire - ajoutez </font></font><code>colorPrimaryDark</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la couleur est substitu√©e.</font></font><br>
<br>
<pre><code class="kotlin hljs"> &lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;<font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"colorPrimaryDark"</span>&gt;<span class="hljs-meta">@color</span>/colorAccent&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour Android au-dessus de la cinqui√®me version (API √† partir de 21 et plus), vous pouvez d√©finir des param√®tres sp√©ciaux dans la rubrique:</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;<font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"android:statusBarColor"</span>&gt;<span class="hljs-meta">@color</span>/colorAccent&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barre d'√©tat multicolore</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Parfois, les concepteurs sur diff√©rents √©crans dessinent la barre d'√©tat de diff√©rentes couleurs. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uo/ev/nl/uoevnldknz2rtfq5lcqpn1mpj4g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'est pas grave, la fa√ßon la plus simple de travailler est avec </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diff√©rents sujets dans diff√©rentes activit√©s</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mani√®re la plus int√©ressante est de changer les couleurs </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">directement lors de l'ex√©cution</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(...)</span></span>: View {<font></font>
    requireActivity().window.statusBarColor = requireContext().getColor(R.color.colorPrimary)<font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le param√®tre est modifi√© via un drapeau sp√©cial. </font><font style="vertical-align: inherit;">Mais l'essentiel est de ne pas oublier de changer la couleur en arri√®re lorsque l'utilisateur quitte l'√©cran en arri√®re. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barre d'√©tat transparente. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est plus difficile. </font><font style="vertical-align: inherit;">Le plus souvent, la transparence est associ√©e aux cartes, car c'est sur les cartes que la transparence est la plus visible. </font><font style="vertical-align: inherit;">Dans ce cas, comme pr√©c√©demment, nous d√©finissons un param√®tre sp√©cial:</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;    <font></font>
    ...<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentStatus"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
    ...<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, bien s√ªr, il existe une astuce bien connue - mettre en retrait plus haut, sinon la barre d'√©tat sera superpos√©e √† l'ic√¥ne et elle sera moche.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/49/8f/c8/498fc8wuip6i-o4eutfnviumuio.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais sur d'autres √©crans, tout se brise. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/if/-0/0q/if-00qq6b7zidoz-_nfyehlev7s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment r√©soudre le probl√®me? La premi√®re m√©thode qui me vient √† l'esprit est diff√©rentes activit√©s: nous avons diff√©rents sujets, diff√©rents param√®tres, ils fonctionnent diff√©remment. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Travaillez avec le clavier.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous √©vitons les encarts non seulement avec la barre d'√©tat, mais aussi lorsque vous travaillez avec le clavier. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/s-/jk/mz/s-jkmzxzi-5xqr1ei0ku6pfubpy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Personne n'aime l'option de gauche, mais pour la transformer en option de droite, il existe une solution simple.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;activity<font></font>
    ...<font></font>
    android:windowSoftInputMode=<span class="hljs-string">"adjustResize"</span>&gt;<font></font>
    ...<font></font>
&lt;/activity&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'activit√© peut maintenant √™tre redimensionn√©e lorsque le clavier appara√Æt. Cela fonctionne simplement et s√©v√®rement. Mais n'oubliez pas une autre astuce - enveloppez tout </font></font><code>ScrollView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Du coup le clavier occupera tout l'√©cran et il y aura une petite bande dessus? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est parfois plus difficile de changer la disposition lorsque le clavier appara√Æt. Par exemple, sinon organisez les boutons ou masquez le logo. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/q3/ia/zl/q3iazltlnajt-cpvdzc0u2i8zcs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons entra√Æn√© tant de b√©quilles avec un clavier et une barre d'√©tat transparente, maintenant il est difficile de nous arr√™ter. Acc√©dez √† StackOverflow et copiez le beau code.</font></font><br>
<br>
<pre><code class="kotlin hljs">boolean isOpened = <span class="hljs-literal">false</span>;<font></font>
<font></font>
<span class="hljs-keyword">public</span> void setListenerToRootView() {
    <span class="hljs-keyword">final</span> View activityRootView = getWindow().getDecorView().findViewById(android.R.id.content);<font></font>
    activityRootView.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener() {<font></font>
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> void onGlobalLayout() {<font></font>
    <font></font>
            int heightDiff = activityRootView.getRootView().getHeight() - activityRootView.getHeight();      <font></font>
            <span class="hljs-keyword">if</span> (heightDiff &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// 99% of the time the height diff will be due to a keyboard.       </span>
                Toast.makeText(getApplicationContext(), <span class="hljs-string">"Gotcha!!! softKeyboardup"</span>, <span class="hljs-number">0</span>).show();<font></font>
<font></font>
                <span class="hljs-keyword">if</span> (isOpened == <span class="hljs-literal">false</span>) {
                   <span class="hljs-comment">//Do two things, make the view top visible and the editText smaller</span><font></font>
                }<font></font>
                isOpened = <span class="hljs-literal">true</span>;<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isOpened == <span class="hljs-literal">true</span>) {<font></font>
                Toast.makeText(getApplicationContext(), <span class="hljs-string">"softkeyborad Down!!!"</span>, <span class="hljs-number">0</span>).show();<font></font>
                isOpened = <span class="hljs-literal">false</span>;<font></font>
            }    <font></font>
        }<font></font>
    });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, m√™me la probabilit√© d'apparition du clavier est calcul√©e. </font><font style="vertical-align: inherit;">Le code fonctionne, dans l'un des projets que nous avons m√™me utilis√©, mais pendant longtemps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nombreuses b√©quilles dans les exemples sont associ√©es √† l'utilisation de diff√©rentes activit√©s. </font><font style="vertical-align: inherit;">Mais ils sont mauvais non seulement parce que ce sont des b√©quilles, mais aussi pour d'autres raisons: le probl√®me du ¬´d√©marrage √† froid¬ª, l'asynchronie. </font><font style="vertical-align: inherit;">J'ai d√©crit les probl√®mes plus en d√©tail dans l'article ¬´ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permis de conduire une voiture, ou pourquoi les applications devraient √™tre √† activit√© unique</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬ª. </font><font style="vertical-align: inherit;">En outre, la documentation de Google indique que l'approche recommand√©e est une application √† activit√© unique.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'avons-nous fait avant Android 10</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous (chez Redmadrobot) d√©veloppons des applications d'assez haute qualit√©, mais nous avons longtemps √©vit√© les encarts. Comment avons-nous r√©ussi √† les √©viter sans grosses b√©quilles et en une seule activit√©? </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque. Captures d'√©cran et code tir√©s de mon projet pour animaux de compagnie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Imaginez l'√©cran de l'application. Lorsque nous avons d√©velopp√© nos applications, nous n'avons jamais pens√© qu'il pourrait y avoir une barre de navigation transparente ci-dessous. Y a-t-il une barre noire en dessous? Alors quoi, les utilisateurs y sont habitu√©s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ce/ab/6v/ceab6v6m5dqnbl9zpotdi1vqmre.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En haut, nous avons initialement d√©fini le param√®tre selon lequel la barre d'√©tat est noire avec transparence. √Ä quoi cela ressemble-t-il en termes de mise en page et de code?</font></font><br>
<br>
<img src="https://habrastorage.org/webt/0g/tu/of/0gtuoffisoeudtgxlnmqd-jicnk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'abstraction sur la figure: le bloc rouge est l'activit√© de l'application, le bleu est le fragment avec le bot de navigation (avec Tabs), et √† l'int√©rieur les fragments verts avec le contenu sont commut√©s. On peut voir que la barre d'outils n'est pas sous la barre d'√©tat. Comment y sommes-nous parvenus? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Android a un drapeau d√©licat </font></font><code>fitSystemWindow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si vous le d√©finissez sur true, le conteneur s'ajoutera un remplissage pour que rien √† l'int√©rieur ne tombe sous la barre d'√©tat. Je pense que ce drapeau est la b√©quille officielle de Google pour ceux qui ont peur des encarts. Tout utiliser fonctionnera relativement bien sans encarts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'indicateur </font></font><code>FitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ajoute un remplissage au conteneur que vous avez sp√©cifi√©. Mais la hi√©rarchie est importante: si l'un des parents d√©finit ce drapeau sur "true", sa distribution ne sera pas prise en compte, car le conteneur a d√©j√† appliqu√© l'indentation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le drapeau fonctionne, mais un autre probl√®me appara√Æt. </font><font style="vertical-align: inherit;">Imaginez un √©cran avec deux onglets. </font><font style="vertical-align: inherit;">Lors du basculement, une transaction est lanc√©e, ce qui provoque un </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fragment l'un sur l'autre, et tout se casse. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lv/02/_u/lv02_ui9sepxlvi7djz_xpem2sy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me fragment a √©galement un indicateur </font></font><code>FitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et cela ne devrait pas se produire. </font><font style="vertical-align: inherit;">Mais que s'est-il pass√©, pourquoi? </font><font style="vertical-align: inherit;">La r√©ponse est que c'est une b√©quille, et parfois cela ne fonctionne pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous avons trouv√© une solution sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack Overflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : utilisez root pour pas des fragments </font></font><code>FrameLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais </font></font><code>CoordinatorLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il a √©t√© cr√©√© √† d'autres fins, mais cela fonctionne ici.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi √ßa marche?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons √† la source ce qui se passe </font></font><code>CoordinatorLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> void onAttachedToWindow() {   
    <span class="hljs-keyword">super</span>.onAttachedToWindow();<font></font>
    ...    <font></font>
    <span class="hljs-keyword">if</span> (mLastInsets == <span class="hljs-literal">null</span> &amp;&amp; ViewCompat.getFitsSystemWindows(<span class="hljs-keyword">this</span>)) {         
        <span class="hljs-comment">// We're set to fitSystemWindows but we haven't had any insets yet...</span>
        <span class="hljs-comment">// We should request a new dispatch of window insets</span>
        ViewCompat.requestApplyInsets(<span class="hljs-keyword">this</span>);<font></font>
    }     <font></font>
    ...<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons un beau commentaire selon lequel des encarts sont n√©cessaires ici, mais ils ne le sont pas. </font><font style="vertical-align: inherit;">Nous devons leur demander √† nouveau lorsque nous demandons une fen√™tre. </font><font style="vertical-align: inherit;">Nous avons compris que les encarts fonctionnent d'une mani√®re ou d'une autre √† l'int√©rieur, mais nous ne voulons pas travailler avec eux et partir </font></font><code>Coordinator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au printemps 2019, nous avons d√©velopp√© l'application, date √† laquelle Google I / O vient de passer. </font><font style="vertical-align: inherit;">Nous n'avons pas encore tout compris, nous avons donc continu√© √† nous accrocher aux pr√©jug√©s. </font><font style="vertical-align: inherit;">Mais nous avons remarqu√© que la commutation des onglets en bas est en quelque sorte lente, car nous avons une disposition complexe, charg√©e avec l'interface utilisateur. </font><font style="vertical-align: inherit;">Nous trouvons un moyen simple de r√©soudre ce probl√®me - changez </font></font><code>replace</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour </font></font><code>show/hide</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que chaque fois que vous ne recr√©ez pas la mise en page.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hx/7l/vz/hx7lvzsl8-kfv3qqac2pbvllt8q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous changeons, et encore une fois rien ne fonctionne - tout est cass√©! </font><font style="vertical-align: inherit;">Apparemment, il n'est tout simplement pas possible de disperser les b√©quilles, vous devez comprendre pourquoi elles ont fonctionn√©. </font><font style="vertical-align: inherit;">Nous √©tudions le code et il s'av√®re que tout ViewGroup est √©galement capable de travailler avec des encarts.</font></font><br>
<br>
<pre><code class="kotlin hljs">
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> WindowInsets dispatchApplyWindowInsets(WindowInsets insets) {    <font></font>
    insets = <span class="hljs-keyword">super</span>.dispatchApplyWindowInsets(insets);     
    <span class="hljs-keyword">if</span> (!insets.isConsumed()) {         
        <span class="hljs-keyword">final</span> int count = getChildCount();        
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; count; i++) {<font></font>
            insets = getChildAt(i).dispatchApplyWindowInsets(insets);             <font></font>
            <span class="hljs-keyword">if</span> (insets.isConsumed()) {          
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> insets;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a une telle logique √† l'int√©rieur: si au moins quelqu'un a d√©j√† trait√© des encarts, alors toutes les vues suivantes √† l'int√©rieur du ViewGroup ne les recevront pas. </font><font style="vertical-align: inherit;">Qu'est-ce que cela signifie pour nous? </font><font style="vertical-align: inherit;">Permettez-moi de vous montrer un exemple de notre FrameLayout, qui change d'onglet. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/fo/nn/h1fonnc4qrqpmj_x-fc8m47ptci.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä l'int√©rieur, il y a le premier fragment dont le drapeau est r√©gl√© </font></font><code>fitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela signifie que le premier fragment traite les encarts. </font><font style="vertical-align: inherit;">Apr√®s cela, nous appelons le </font></font><code>HIDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premier fragment et le </font></font><code>SHOW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second. </font><font style="vertical-align: inherit;">Mais le premier reste dans la mise en page - sa vue est laiss√©e, juste cach√©e. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le conteneur passe par sa Vue: il prend le premier fragment, lui donne des encarts, et de lui </font></font><code>fitSystemWindow=‚Äùtrue‚Äù</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il les a pris et les a trait√©s. </font><font style="vertical-align: inherit;">Parfaitement, FrameLayout a regard√© que les encarts √©taient trait√©s et ne les a pas donn√©s au deuxi√®me fragment. </font><font style="vertical-align: inherit;">Tout fonctionne comme il se doit. </font><font style="vertical-align: inherit;">Mais cela ne nous convient pas, que devons-nous faire?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous √©crivons notre propre ViewGroup</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous venions de Java, et l√† OOP dans toute sa splendeur, nous avons donc d√©cid√© d'h√©riter. </font><font style="vertical-align: inherit;">Nous avons √©crit notre propre ViewGroup, √† partir duquel nous avons red√©fini la m√©thode </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il fonctionne comme nous en avons besoin: il rend toujours aux enfants les encarts qui sont venus, que nous les ayons trait√©s ou non.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowInsetFrameLayout</span> <span class="hljs-meta">@JvmOverloads</span> <span class="hljs-keyword">constructor</span></span>(<font></font>
    context: Context,      <font></font>
    attrs: AttributeSet? = <span class="hljs-literal">null</span>,     <font></font>
    defStyleRes: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span><font></font>
) : FrameLayout(context, attrs, defStyleRes) {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dispatchApplyWindowInsets</span><span class="hljs-params">(insets: <span class="hljs-type">WindowInsets</span>)</span></span>: WindowInsets { 
        <span class="hljs-keyword">for</span> (child <span class="hljs-keyword">in</span> (<span class="hljs-number">0</span> until childCount)) {<font></font>
            getChildAt(child).dispatchApplyWindowInsets(insets)<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> insets.consumeSystemWindowInsets()<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ViewGroup personnalis√© fonctionne, le projet est aussi tout ce dont nous avons besoin. </font><font style="vertical-align: inherit;">Mais il ne parvient toujours pas √† une solution g√©n√©rale. </font><font style="vertical-align: inherit;">Lorsque nous avons compris ce qu'ils nous ont dit sur Google IO, nous avons r√©alis√© que nous ne serions plus en mesure d'agir comme √ßa.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android 10</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Android 10 nous a montr√© deux concepts d'interface utilisateur importants auxquels il est strictement recommand√© d'adh√©rer: bord √† bord et navigation gestuelle. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√¥te √† c√¥te.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ce </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concept</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sugg√®re que le contenu de l'application devrait occuper </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tout l'espace possible</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur l'√©cran. Pour nous, en tant que d√©veloppeurs, cela signifie que les applications doivent √™tre plac√©es </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sous les panneaux syst√®me de la barre d'√©tat et de la barre de navigation.</font></font></strong><br>
<br>
<img src="https://habrastorage.org/webt/cr/gl/nh/crglnh9iw__fu4lct0gavaibqey.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Auparavant, nous pouvions en quelque sorte ignorer cela ou √™tre plac√©s uniquement sous la barre d'√©tat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quant aux listes, elles doivent d√©filer non seulement jusqu'au dernier √©l√©ment, mais aussi plus loin </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour ne pas rester sous la barre de navigation.</font></font></strong><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/tl/pl/it/tlplit1o65rn55edkixuuojxtha.png" width="350"></div><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navigation gestuelle. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce deuxi√®me concept important est la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navigation gestuelle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il vous permet de contr√¥ler l'application avec vos doigts depuis le bord de l'√©cran. </font><font style="vertical-align: inherit;">Le mode gestuel n'est pas standard, tout semble diff√©rent, mais maintenant vous ne pouvez pas basculer entre deux barres de navigation diff√©rentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ce moment, nous avons r√©alis√© que tout n'est pas si simple. </font><font style="vertical-align: inherit;">Il ne sera pas possible d'√©viter davantage les encarts si nous voulons d√©velopper des applications de qualit√©. </font><font style="vertical-align: inherit;">Il est temps d'√©tudier la documentation et de comprendre ce que sont les encarts.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encarts </font><font style="vertical-align: inherit;">Que devez-vous savoir √† leur sujet?</font></font></h2><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des encarts ont √©t√© cr√©√©s pour effrayer les d√©veloppeurs.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ils le font parfaitement depuis le moment o√π il est apparu dans Android 5. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien s√ªr, tout n'est pas si effrayant. Le concept des encarts est simple - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ils signalent une superposition d'interface utilisateur syst√®me sur l'√©cran de l'application.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il peut s'agir d'une barre de navigation, d'une barre d'√©tat ou d'un clavier. Le clavier est √©galement une interface utilisateur syst√®me standard, qui se superpose √† l'application. Il n'est pas n√©cessaire d'essayer de le traiter avec des b√©quilles, seulement des encarts. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le but des encarts est de r√©soudre les conflits</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Par exemple, s'il y a un autre √©l√©ment au-dessus de notre bouton, nous pouvons d√©placer le bouton afin que l'utilisateur puisse continuer √† utiliser l'application. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour g√©rer l'encart,</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilisez </font></font><code>Windowlnsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour Android 10 et </font></font><code>WindowInsetsCompat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les autres versions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe </font><strong><font style="vertical-align: inherit;">5 types diff√©rents d'encarts</font></strong><font style="vertical-align: inherit;"> dans Android 10</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et un "bonus", qui n'est pas appel√© encart, mais sinon. </font><font style="vertical-align: inherit;">Nous traiterons tous les types, car la plupart ne connaissent qu'une seule chose: les insertions de fen√™tres syst√®me.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encarts de fen√™tre syst√®me</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introduit dans Android 5.0 (API 21). </font><font style="vertical-align: inherit;">Obtenu par la m√©thode </font></font><code>getSystemWindowInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit du principal type d'encarts avec lequel vous devez apprendre √† travailler, car les autres fonctionnent de la m√™me mani√®re. </font><font style="vertical-align: inherit;">Ils sont n√©cessaires pour traiter la barre d'√©tat, tout d'abord, puis la barre de navigation et le clavier. </font><font style="vertical-align: inherit;">Par exemple, ils r√©solvent un probl√®me lorsque la barre de navigation se trouve au-dessus de l'application. </font><font style="vertical-align: inherit;">Comme dans l'image: le bouton est rest√© sous la barre de navigation, l'utilisateur ne peut pas cliquer dessus et est tr√®s m√©content.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nx/yj/tt/nxyjttdppbkrnrnqkspovzp4hko.png" width="350"></div><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserts d'√©l√©ments taraudables</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparu uniquement dans Android 10. Obtenu par la m√©thode </font></font><code>getTappableElementInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces encarts </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont utiles que </font><strong><font style="vertical-align: inherit;">pour g√©rer divers modes de barre de navigation</font></strong><font style="vertical-align: inherit;"> . Comme le dit </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chris Bane</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lui-m√™me </font><font style="vertical-align: inherit;">, vous pouvez oublier ce type d'encarts et contourner uniquement les encarts de fen√™tre syst√®me. Mais si vous voulez que l'application soit 100% cool, pas 99,9% cool, vous devez l'utiliser. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regarde l'image. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/yd/fk/rlydfkwy39pfrc7jfhizhqdkg0q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En haut, la couleur pourpre indique les encarts de la fen√™tre syst√®me, qui se pr√©senteront dans diff√©rents modes de la barre de navigation. On peut voir qu'√† droite et √† gauche ils sont √©gaux √† la barre de navigation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rappelez-vous comment fonctionne la navigation gestuelle: dans le bon mode, nous ne cliquons jamais sur un nouveau panneau, mais faisons toujours glisser nos doigts de bas en haut. </font><font style="vertical-align: inherit;">Cela signifie que les boutons ne peuvent pas √™tre supprim√©s. </font><font style="vertical-align: inherit;">Nous pouvons continuer √† appuyer sur notre bouton FAB (Floating Action Button), personne n'interf√©rera. </font><font style="vertical-align: inherit;">Par cons√©quent, il </font></font><code>TappableElementInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera vide car FAB n'est pas n√©cessaire de se d√©placer. </font><font style="vertical-align: inherit;">Mais si nous montons un peu plus haut, √ßa va. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diff√©rence n'appara√Æt qu'avec la navigation gestuelle et la barre de navigation transparente</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (adaptation des couleurs). </font><font style="vertical-align: inherit;">Ce n'est pas une situation tr√®s agr√©able. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/zv/ei/qz/zveiqz33n9dc290ib9yhrrjl09u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout fonctionnera, mais √ßa a l'air d√©sagr√©able. </font><font style="vertical-align: inherit;">L'utilisateur peut √™tre d√©rout√© par la proximit√© des √©l√©ments. </font><font style="vertical-align: inherit;">On peut expliquer que l'un est pour les gestes et l'autre pour le pressage, mais toujours pas beau. </font><font style="vertical-align: inherit;">Par cons√©quent, √©levez le FAB plus haut ou laissez-le √† droite.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encarts gestuels du syst√®me</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparu uniquement dans Android 10. Obtenu par la m√©thode </font></font><code>getSystemGestureInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces encarts sont li√©s √† la navigation gestuelle. Initialement, il a √©t√© suppos√© que l'interface utilisateur du syst√®me est dessin√©e au-dessus de l'application, mais les insertions de gestes syst√®me indiquent que ce n'est pas l'interface utilisateur qui est dessin√©e, mais le syst√®me lui-m√™me g√®re les gestes. Ils d√©crivent o√π le syst√®me g√©rera les gestes par d√©faut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les zones de ces encarts sont approximativement celles marqu√©es en jaune sur le sch√©ma. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/vv/8d/jl/vv8djlgxe4cnjchozbllrysagd0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais je veux vous avertir - ils ne seront pas toujours comme √ßa. Nous ne saurons jamais quels nouveaux √©crans Samsung et d'autres fabricants proposeront. Il existe d√©j√† des appareils dans lesquels l'√©cran est de tous les c√¥t√©s. Peut-√™tre que les encarts ne seront pas du tout l√† o√π nous nous attendons. Par cons√©quent, vous devez travailler avec eux comme avec certaines abstractions: il existe de tels encarts dans les encarts de mouvement du syst√®me dans lesquels le syst√®me lui-m√™me traite les gestes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces encarts peuvent √™tre remplac√©s. </font><font style="vertical-align: inherit;">Par exemple, vous d√©veloppez un √©diteur de photos. </font><font style="vertical-align: inherit;">Dans certains endroits, vous voulez g√©rer vous-m√™me les gestes, m√™me s'ils sont pr√®s du bord de l'√©cran. </font><font style="vertical-align: inherit;">Indiquez au syst√®me que vous traiterez vous-m√™me le point √† l'√©cran dans le coin de la photo. </font><font style="vertical-align: inherit;">Il peut √™tre red√©fini en disant au syst√®me: "Je traiterai toujours le carr√© autour du point moi-m√™me."</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encarts gestuels syst√®me obligatoires</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apparu uniquement dans Android 10. Il s'agit d'un sous-type d'inserts de gestes syst√®me, mais ils ne peuvent pas √™tre remplac√©s par l'application. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous utilisons la m√©thode </font></font><code>getMandatorySystemGestureInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour d√©terminer la zone o√π ils ne fonctionneront pas. </font><font style="vertical-align: inherit;">Cela a √©t√© fait intentionnellement de sorte qu'il √©tait impossible de d√©velopper une application ¬´d√©sesp√©r√©e¬ª: red√©finissez le geste de navigation de bas en haut, ce qui vous permet de quitter l'application vers l'√©cran principal. </font><font style="vertical-align: inherit;">Ici, le </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syst√®me traite toujours les gestes lui-m√™me</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/89/gl/df/89gldfknoq8z9dje_naytwp0pti.png" width="450"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce ne sera pas n√©cessairement sur le dessous de l'appareil et pas n√©cessairement de cette taille. </font><font style="vertical-align: inherit;">Travaillez avec lui comme une abstraction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agissait de types d'encarts relativement nouveaux. </font><font style="vertical-align: inherit;">Mais il y a ceux qui sont apparus avant m√™me Android 5 et ont √©t√© appel√©s diff√©remment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserts stables</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Introduit avec Android 5.0 (API 21). Obtenu par la m√©thode </font></font><code>getStableInsets()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me les d√©veloppeurs exp√©riment√©s ne peuvent pas toujours dire pourquoi ils sont n√©cessaires. Je vais vous dire un secret: ces encarts ne sont utiles que pour les applications plein √©cran: lecteurs vid√©o, jeux. Par exemple, en mode lecture, toute interface utilisateur syst√®me est masqu√©e, y compris la barre d'√©tat, qui se d√©place au-del√† du bord de l'√©cran. Mais cela vaut la peine de toucher l'√©cran, car la barre d'√©tat appara√Ætra en haut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous placez un bouton RETOUR en haut de l'√©cran, alors qu'il traite correctement les insertions de la fen√™tre syst√®me, puis avec chaque onglet, une interface utilisateur appara√Æt sur l'√©cran d'en haut, et le bouton saute vers le bas. Si vous ne touchez pas l'√©cran pendant un certain temps, la barre d'√©tat dispara√Æt, le bouton rebondit car les encarts de la fen√™tre syst√®me ont disparu.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour de tels cas, les inserts stables sont parfaits. </font><font style="vertical-align: inherit;">Ils disent que maintenant aucun √©l√©ment n'est dessin√© sur votre application, mais qu'ils peuvent le faire. </font><font style="vertical-align: inherit;">Avec ces encarts, vous pouvez conna√Ætre √† l'avance la valeur de la barre d'√©tat dans ce mode, par exemple, et positionner le bouton o√π vous le souhaitez. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque. </font><font style="vertical-align: inherit;">La m√©thode </font></font></em><code><em>getStableInsets()</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'apparaissait qu'avec l'API 21. Auparavant, il y avait plusieurs m√©thodes pour chaque c√¥t√© de l'√©cran.&nbsp;</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons examin√© 5 types d'encarts, mais il y en a un autre qui ne s'applique pas directement aux encarts. </font><font style="vertical-align: inherit;">Il aide √† g√©rer les franges et les d√©coupes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frange et d√©collet√©</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les √©crans ne sont plus carr√©s. </font><font style="vertical-align: inherit;">Ils sont oblongs, avec une ou plusieurs d√©coupes pour la cam√©ra et une frange de tous les c√¥t√©s. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ls/kv/sc/lskvscp_j-hy2gesyynicb346cq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'√† 28 API, nous n'avons pas pu les traiter. </font><font style="vertical-align: inherit;">J'ai d√ª deviner √† travers des encarts ce qui se passait l√†-bas. </font><font style="vertical-align: inherit;">Mais avec l'API 28 et au-del√† (de l'ancien Android), la classe est officiellement apparue </font></font><code>DisplayCutout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">C'est dans les m√™mes encarts √† partir desquels vous pouvez obtenir tous les autres types. </font><font style="vertical-align: inherit;">La classe vous permet de conna√Ætre l'emplacement et la taille des artefacts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En plus des informations de localisation, un ensemble d'indicateurs y est fourni pour le d√©veloppeur </font></font><code>WindowManager.LayoutParams</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ils vous permettent d'inclure diff√©rents comportements autour des d√©coupes. </font><font style="vertical-align: inherit;">Votre contenu peut √™tre affich√© autour d'eux, ou peut ne pas √™tre affich√©: en mode paysage et portrait de diff√©rentes mani√®res. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drapeaux</font></font><code>window.attributes.layoutInDisplayCutoutMode =</code><br>
<br>
<ul>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_DEFAULT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En portrait - il y a, et en paysage - une barre noire par d√©faut.</font></font></li>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Pas du tout - une bande noire.</font></font></li>
<li><code>LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - est toujours.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'affichage peut √™tre contr√¥l√©, mais nous travaillons avec eux de la m√™me mani√®re qu'avec les autres encarts.</font></font><br>
<br>
<pre><code class="kotlin hljs">insets.displayCutout<font></font>
    .boundingRects<font></font>
    .forEach { rect -&gt; ... }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le rappel avec des encarts avec un tableau nous vient </font></font><code>displayCutout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ensuite, nous pouvons le parcourir, traiter toutes les d√©coupes et les franges qui se trouvent dans l'application. </font><font style="vertical-align: inherit;">Vous pouvez en savoir plus sur la fa√ßon de travailler avec eux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans l'article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compris avec 6 types d'encarts. </font><font style="vertical-align: inherit;">Voyons maintenant comment cela fonctionne.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment √ßa fonctionne</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des encarts sont n√©cessaires, tout d'abord, lorsque quelque chose est dessin√© au-dessus de l'application, par exemple, la barre de navigation. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ft/ct/_w/ftct_wh_dc64t9rw6ir_7zpqg8m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sans encarts, l'application n'aura pas de barre de navigation et de barre d'√©tat transparentes. </font><font style="vertical-align: inherit;">Ne soyez pas surpris que vous ne veniez pas </font></font><code>SystemWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cela arrive.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserts r√©partis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'ensemble de la hi√©rarchie de l'interface utilisateur ressemble √† un arbre avec une vue √† ses extr√©mit√©s. </font><font style="vertical-align: inherit;">Les n≈ìuds sont g√©n√©ralement un ViewGroup. </font><font style="vertical-align: inherit;">Ils h√©ritent √©galement de View, de sorte que les encarts leur parviennent d'une mani√®re sp√©ciale </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√Ä partir de la vue racine, le syst√®me envoie des encarts √† travers l'arborescence. </font><font style="vertical-align: inherit;">Voyons comment fonctionne View dans ce cas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/jy/rw/hk/jyrwhkavrimytpqs4je0ltfn7-w.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me fait appel √† la m√©thode </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans laquelle s'ins√®rent les encarts. </font><font style="vertical-align: inherit;">Cette vue devrait renvoyer quelque chose. </font><font style="vertical-align: inherit;">Que faire pour g√©rer ce comportement? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par souci de simplicit√©, nous consid√©rons uniquement les WindowInsets.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserts de manutention</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, la red√©finition de la m√©thode </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et de l'impl√©mentation √† l'int√©rieur de sa propre logique </font><font style="vertical-align: inherit;">semble logique </font><font style="vertical-align: inherit;">: des encarts sont venus, nous avons tout impl√©ment√© √† l'int√©rieur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous ouvrez la classe View et regardez le Javadoc √©crit au-dessus de cette m√©thode, vous pouvez voir: "Ne remplacez pas cette m√©thode!"</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous traitons les encarts par d√©l√©gation ou h√©ritage.</font></font></blockquote><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utilisez la d√©l√©gation</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Google a donn√© la possibilit√© d'exposer son propre d√©l√©gu√©, qui est responsable de la gestion des encarts. </font><font style="vertical-align: inherit;">Vous pouvez l'installer via la m√©thode </font></font><code>setOnApplyWindowInsetsListener(listener)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous avons d√©fini un rappel qui g√®re ces encarts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si, pour une raison quelconque, cela ne nous convient pas, vous pouvez </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√©riter de View et remplacer une autre m√©thode</font></font></strong> <code>onApplyWindowInsets(WindowInsets insets)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nous y substituons nos propres encarts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google n'a pas choisi entre la d√©l√©gation et l'h√©ritage, mais a permis de tout faire ensemble. </font><font style="vertical-align: inherit;">C'est formidable car nous n'avons pas √† red√©finir toutes les barres d'outils ou ListView pour g√©rer les encarts. </font><font style="vertical-align: inherit;">Nous pouvons prendre n'importe quelle vue pr√™te √† l'emploi, m√™me une biblioth√®que, et y d√©finir le d√©l√©gu√©, qui g√©rera les encarts sans red√©finition. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que retournerons-nous?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi retourner quelque chose?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, vous devez comprendre le fonctionnement de la distribution des encarts, c'est-√†-dire ViewGroup. </font><font style="vertical-align: inherit;">Que fait-elle en elle. </font><font style="vertical-align: inherit;">Examinons de plus pr√®s le comportement par d√©faut en utilisant l'exemple que j'ai montr√© plus t√¥t. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les encarts syst√®me sont venus en haut et en bas, par exemple, 100 pixels chacun. </font><font style="vertical-align: inherit;">Le ViewGroup les envoie √† la premi√®re vue dont il dispose. </font><font style="vertical-align: inherit;">Cette vue les a trait√©s d'une mani√®re ou d'une autre et renvoie des encarts: en haut, elle diminue √† 0, mais en bas, elle part. </font><font style="vertical-align: inherit;">En haut, elle a ajout√© un rembourrage ou une marge, mais en bas, elle n'a pas touch√© et a signal√© cela. </font><font style="vertical-align: inherit;">Ensuite, le ViewGroup transmet des encarts √† la deuxi√®me vue. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tj/-a/rw/tj-arwxjkus-n6xnvl099lqbqqg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vue suivante traite et affiche les encarts. </font><font style="vertical-align: inherit;">Le ViewGroup voit maintenant que les encarts sont trait√©s √† la fois au-dessus et en dessous - il ne reste plus rien, tous les param√®tres sont nuls. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La troisi√®me vue ne sait m√™me pas qu'il y avait des encarts et quelque chose se passait</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ViewGroup renverra les encarts √† celui qui les a expos√©s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque nous avons commenc√© √† traiter ce sujet, nous avons not√© l'id√©e par nous-m√™mes - renvoyons toujours les m√™mes encarts qui sont venus. </font><font style="vertical-align: inherit;">Nous voulions √©viter une telle situation lorsque certains View ne reconnaissaient m√™me pas qu'il y avait des encarts. </font><font style="vertical-align: inherit;">L'id√©e semblait logique. </font><font style="vertical-align: inherit;">Mais il s'est av√©r√© que non. </font><font style="vertical-align: inherit;">Google n'a en vain pas ajout√© de comportement aux encarts, comme dans l'exemple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est n√©cessaire pour que les encarts atteignent toujours toute la hi√©rarchie de la vue et que vous puissiez toujours travailler avec eux. </font><font style="vertical-align: inherit;">Dans ce cas, il n'y aura pas de situation lorsque nous basculons deux fragments, l'un a trait√© et le second n'a pas encore √©t√© re√ßu. </font><font style="vertical-align: inherit;">Dans la partie pratique, nous reviendrons sur ce point.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entraine toi</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La th√©orie est termin√©e. </font><font style="vertical-align: inherit;">Voyons √† quoi cela ressemble dans le code, car en th√©orie tout est toujours fluide. </font><font style="vertical-align: inherit;">Nous utiliserons AndroidX. </font></font><br>
<br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque. </font><font style="vertical-align: inherit;">Dans </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox,</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tout est d√©j√† impl√©ment√© dans le code, prise en charge compl√®te de tous les goodies du nouvel Android. </font><font style="vertical-align: inherit;">Afin de ne pas v√©rifier les versions d'Android et de ne pas rechercher le type requis d'Insets, utilisez toujours la </font></font></em><code><em>view.setOnApplyWindowInsetsListener { v, insets -&gt; ... }</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version d'AndroidX - √† la </font></font></em><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">place </font></em></font><code><em>ViewCompat.setOnApplyWindowInsetsListener(view) { v, insets -&gt; ... }</em></code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un √©cran avec une barre de navigation sombre. </font><font style="vertical-align: inherit;">Il ne chevauche aucun √©l√©ment sur le dessus. </font><font style="vertical-align: inherit;">Tout est comme d'habitude.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3r/wq/sp/3rwqspgcdlgie2m00lmedkwzgi8.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il s'av√®re que nous devons maintenant le rendre transparent. </font><font style="vertical-align: inherit;">Comment?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activez la transparence</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus simple est d'indiquer au sujet que la barre d'√©tat et la barre de navigation sont transparentes.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.MaterialComponents.Light"</span>&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentStatus"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:windowTranslucentNavigation"</span>&gt;<span class="hljs-literal">true</span>&lt;/item&gt;<font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä ce moment, tout commence √† se chevaucher √† la fois d'en haut et d'en bas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est int√©ressant de noter qu'il existe deux indicateurs, et il y a toujours trois options. Si vous sp√©cifiez la transparence pour la barre de navigation, la barre d'√©tat deviendra transparente par elle-m√™me - une telle limitation. </font><font style="vertical-align: inherit;">Vous ne pouvez pas √©crire la premi√®re ligne, mais j'aime toujours la clart√©, alors j'√©cris 2 lignes pour que les abonn√©s puissent comprendre ce qui se passe, et ne pas creuser √† l'int√©rieur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous choisissez cette m√©thode, la barre de navigation et la barre d'√©tat deviennent noires avec transparence. </font><font style="vertical-align: inherit;">Si l'application est blanche, vous ne pouvez ajouter des couleurs qu'√† partir du code. </font><font style="vertical-align: inherit;">Comment faire?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Activez la transparence avec la couleur</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est bon que nous ayons une application d'activit√© unique, nous avons donc mis deux drapeaux dans une activit√©.</font></font><br>
<br>
<pre><code class="kotlin hljs">rootView.systemUiVisibility = View.SYSTEM_UI_FLAG_LAYOUT_STABLE or  <font></font>
    View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION<font></font>
<font></font>
&lt;style name=<span class="hljs-string">"AppTheme"</span> parent=<span class="hljs-string">"Theme.MaterialComponents.Light"</span>&gt;<font></font>
    &lt;!-- Set the navigation bar to <span class="hljs-number">50</span>% translucent white --&gt;<font></font>
    &lt;item name=<span class="hljs-string">"android:navigationBarColor"</span>&gt;#<span class="hljs-number">80F</span>FFFFF&lt;/item&gt; <font></font>
&lt;/style&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a beaucoup de drapeaux l√†-bas, mais ce sont ces deux-l√† qui aideront √† rendre la transparence dans la barre de navigation et la barre d'√©tat. </font><font style="vertical-align: inherit;">La couleur peut √™tre sp√©cifi√©e via le th√®me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est le comportement √©trange d'Android: quelque chose √† travers le th√®me et quelque chose √† travers les drapeaux. </font><font style="vertical-align: inherit;">Mais nous pouvons sp√©cifier des param√®tres √† la fois dans le code et dans le sujet. </font><font style="vertical-align: inherit;">Ce n'est pas si mauvais pour Android, juste sur les anciennes versions d'Android, le drapeau sp√©cifi√© dans le sujet sera ignor√©. </font></font><code>navigationBarColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela mettra en √©vidence que sur Android 5, ce n'est pas le cas, mais tout ira de pair. </font><font style="vertical-align: inherit;">Dans GitFox, c'est √† partir du code que j'ai d√©fini la couleur de la barre de navigation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons commis des fraudes - indiqu√© que la barre de navigation est blanche et transparente. </font><font style="vertical-align: inherit;">Maintenant, l'application ressemble √† ceci.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/eo/vs/mz/eovsmz1tczlc9vl_kg2yihxs0u0.png" width="350"></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quoi de plus simple que de manipuler des encarts?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effet, √©l√©mentaire.</font></font><br>
<br>
<pre><code class="kotlin hljs">ViewCompat<font></font>
    .setOnApplyWindowInsetsListener(bottomNav) { view, insets -&gt;  <font></font>
        view.updatePadding(bottom = insets.systemWindowInsetBottom) <font></font>
        insets<font></font>
    }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons la m√©thode </font></font><code>setOnApplyWindowInsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la transmettons </font></font><code>bottomNav</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous disons que lorsque les encarts viennent, installez le rembourrage inf√©rieur qui est entr√© </font></font><code>systemWindowInsetBottom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous le voulons en dessous, mais tous nos √©l√©ments cliquables sont au-dessus. </font><font style="vertical-align: inherit;">Nous renvoyons enti√®rement les encarts afin que toutes les autres vues de notre hi√©rarchie les re√ßoivent √©galement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout a l'air g√©nial.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/zl/8e/ku/zl8ekuc_pvpc2wrmeop-khxmomg.png" width="350"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il ya un hic. </font><font style="vertical-align: inherit;">Si dans la mise en page, nous avons indiqu√© une sorte de rembourrage dans la barre de navigation ci-dessous, alors ici, il a √©t√© supprim√© - d√©finissez des </font></font><code>updatePadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encarts √©gaux. </font><font style="vertical-align: inherit;">Notre mise en page ne ressemble pas √† ce que nous souhaiterions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour enregistrer les valeurs de la mise en page, vous devez d'abord enregistrer ce qui se trouve dans le rembourrage inf√©rieur. </font><font style="vertical-align: inherit;">Plus tard, lorsque les encarts arrivent, ajoutez et d√©finissez les valeurs r√©sultantes.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> bottomNavBottomPadding = bottomNav.paddingBottom<font></font>
ViewCompat<font></font>
    .setOnApplyWindowInsetsListener(bottomNav) { view, insets -&gt;                 <font></font>
        view.updatePadding(<font></font>
        bottom = bottomNavBottomPadding + insets.systemWindowInsetBottom<font></font>
    )<font></font>
    Insets<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'est pas pratique d'√©crire de cette fa√ßon: partout dans le code o√π vous utilisez des encarts, vous devez enregistrer la valeur de la mise en page, puis les ajouter √† l'interface utilisateur. </font><font style="vertical-align: inherit;">Mais il y a Kotlin, et c'est merveilleux - vous pouvez √©crire votre propre extension, qui fera tout cela pour nous.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez Kotlin!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous en souvenons </font></font><code>initialPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le donnons au gestionnaire lorsque de nouveaux encarts arrivent (avec eux). </font><font style="vertical-align: inherit;">Cela les aidera √† s'additionner ou √† construire une sorte de logique par le haut.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">doOnApplyWindowInsets</span><span class="hljs-params">(block: (<span class="hljs-type">View</span>, <span class="hljs-type">WindowInsetsCompat</span>, <span class="hljs-type">Rect</span>) -&gt; <span class="hljs-type">WindowInsetsCompat</span>)</span></span> {    <font></font>
<font></font>
    <span class="hljs-keyword">val</span> initialPadding = recordInitialPaddingForView(<span class="hljs-keyword">this</span>)<font></font>
<font></font>
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;        <font></font>
        block(v, insets, initialPadding)<font></font>
    }<font></font>
    <font></font>
    requestApplyInsetsWhenAttached()<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordInitialPaddingForView</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> =<font></font>
   Rect(view.paddingLeft, view.paddingTop, view.paddingRight, view.paddingBottom)<font></font>
<font></font>
  .<font></font>
<font></font>
bottomNav.doOnApplyWindowInsets { view, insets, padding -&gt;   <font></font>
    view.updatePadding(<font></font>
        bottom = padding.bottom + insets.systemWindowInsetBottom<font></font>
    ) <font></font>
    insets<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons red√©finir la lambda. </font><font style="vertical-align: inherit;">Il a non seulement des inserts, mais aussi des rembourrages. </font><font style="vertical-align: inherit;">Nous pouvons les ajouter non seulement d'en bas, mais aussi d'en haut, si c'est une barre d'outils qui traite la barre d'√©tat.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelque chose oubli√©!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un appel √† une m√©thode incompr√©hensible.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">doOnApplyWindowInsets</span><span class="hljs-params">(block: (<span class="hljs-type">View</span>, <span class="hljs-type">WindowInsetsCompat</span>, <span class="hljs-type">Rect</span>) -&gt; <span class="hljs-type">WindowInsetsCompat</span>)</span></span> {<font></font>
<font></font>
    <span class="hljs-keyword">val</span> initialPadding = recordInitialPaddingForView(<span class="hljs-keyword">this</span>)<font></font>
     <font></font>
    ViewCompat.setOnApplyWindowInsetsListener(<span class="hljs-keyword">this</span>) { v, insets -&gt;        <font></font>
        block(v, insets, initialPadding)<font></font>
    }<font></font>
      <font></font>
    requestApplyInsetsWhenAttached() <font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordInitialPaddingForView</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> =<font></font>
      Rect(view.paddingLeft, view.paddingTop, view.paddingRight, view.paddingBottom)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela est d√ª au fait que vous ne pouvez pas simplement esp√©rer que le syst√®me vous enverra des encarts. </font><font style="vertical-align: inherit;">Si nous cr√©ons une vue √† partir du code ou l'installons un </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peu plus tard, le syst√®me lui-m√™me peut ne pas transmettre la derni√®re valeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous devons v√©rifier que lorsque la vue est √† l'√©cran, nous avons dit au syst√®me: "Des encarts sont arriv√©s, nous voulons les traiter." </font><font style="vertical-align: inherit;">Nous d√©finissons l'√©couteur et devons faire une demande </font></font><code>requestsApplyInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. "</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">requestApplyInsetsWhenAttached</span><span class="hljs-params">()</span></span> {    
    <span class="hljs-keyword">if</span> (isAttachedToWindow) {        <font></font>
        requestApplyInsets()<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        addOnAttachStateChangeListener(<span class="hljs-keyword">object</span> : View.OnAttachStateChangeListener {            
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewAttachedToWindow</span><span class="hljs-params">(v: <span class="hljs-type">View</span>)</span></span> {<font></font>
                v.removeOnAttachStateChangeListener(<span class="hljs-keyword">this</span>)<font></font>
                v.requestApplyInsets()           <font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewDetachedFromWindow</span><span class="hljs-params">(v: <span class="hljs-type">View</span>)</span></span> = <span class="hljs-built_in">Unit</span><font></font>
        })<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si nous avons cr√©√© un code View et ne l'avons pas encore attach√© √† notre mise en page, nous devons alors nous abonner √† l'heure √† laquelle nous le faisons. </font><font style="vertical-align: inherit;">C'est seulement alors que nous demandons des encarts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais l√† encore, il y a Kotlin: ils ont √©crit une simple extension et nous n'avons plus √† y penser.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Refining RecyclerView</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlons maintenant de la finalisation de RecyclerView. Le dernier √©l√©ment tombe sous la barre de navigation et reste en dessous - laid. Il est √©galement g√™nant de cliquer dessus. Si ce n'est pas un nouveau panneau, mais l'ancien, un grand, alors en g√©n√©ral l'√©l√©ment entier peut dispara√Ætre en dessous. Que faire? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/qa/f7/jcqaf7okahkrhrrnols54exqhdu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re id√©e consiste √† ajouter un √©l√©ment ci-dessous et √† d√©finir la hauteur pour s'adapter aux encarts. Mais si nous avons une application avec des centaines de listes, nous devrons en quelque sorte souscrire chaque liste √† des encarts, y ajouter un nouvel √©l√©ment et d√©finir la hauteur. De plus, RecyclerView est asynchrone, on ne sait pas quand cela fonctionnera. Il y a beaucoup de probl√®mes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a un autre hack officiel. √âtonnamment, cela fonctionne efficacement.</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;androidx.recyclerview.widget.RecyclerView <font></font>
        android:id=<span class="hljs-string">"@+id/recyclerView"</span>        
    android:layout_width=<span class="hljs-string">"match_parent"</span>    
    android:layout_height=<span class="hljs-string">"match_parent"</span>             
    android:clipToPadding=<span class="hljs-string">"false"</span> /&gt;<font></font>
<font></font>
recyclerView.doOnApplyWindowInsets { view, insets, padding -&gt;    <font></font>
    view.updatePadding(<font></font>
        bottom = padding.bottom + insets.systemWindowInsetBottom<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un tel drapeau dans la mise en page </font></font><code>clipToPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Par d√©faut, c'est toujours vrai. Cela sugg√®re que vous n'avez pas besoin de dessiner des √©l√©ments qui apparaissent l√† o√π le rembourrage est expos√©. Mais s'il est d√©fini </font></font><code>clipToPadding="false"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez dessiner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, si vous d√©finissez le remplissage en bas, dans RecyclerView cela fonctionnera comme ceci: en bas, le remplissage est d√©fini et l'√©l√©ment est dessin√© dessus jusqu'√† ce que nous fassions d√©filer. Une fois arriv√© √† la fin, RecyclerView fera d√©filer les √©l√©ments jusqu'√† la position dont nous avons besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En d√©finissant un tel indicateur, nous pouvons travailler avec RecyclerView comme avec une vue normale. Ne pensez pas qu'il y a des √©l√©ments qui d√©filent - d√©finissez simplement le remplissage ci-dessous, comme, par exemple, dans la barre de navigation inf√©rieure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, nous avons toujours renvoy√© les encarts comme s'ils n'avaient pas √©t√© trait√©s. </font><font style="vertical-align: inherit;">Les encarts entiers nous sont parvenus, nous avons fait quelque chose avec eux, r√©gl√© les rembourrages et renvoy√© tous les encarts entiers. </font><font style="vertical-align: inherit;">Cela est n√©cessaire pour que tout ViewGroup transmette toujours ces encarts √† tous les View. </font><font style="vertical-align: inherit;">√áa marche.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bogue d'application</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans de nombreuses applications sur Google Play qui ont d√©j√† trait√© des encarts, j'ai remarqu√© un petit bug. Maintenant, je vais parler de lui. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un √©cran avec navigation au sous-sol. √Ä droite se trouve le m√™me √©cran qui montre la hi√©rarchie. Le fragment vert affiche le contenu √† l'√©cran, √† l'int√©rieur il a un RecyclerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/e6/jo/hle6jod0ws19fydq734lqnuaixu.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Qui a manipul√© les encarts ici? Barre d'outils: il a appliqu√© un remplissage sur le dessus pour que son contenu se d√©place sous la barre d'√©tat. Par cons√©quent, la barre de navigation inf√©rieure appliquait des encarts par le bas et montait au-dessus de la barre de navigation. Mais RecyclerView ne g√®re en aucun cas les encarts, il ne rel√®ve pas d'eux, il n'a pas besoin de traiter les encarts - tout est fait correctement.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r3/xc/qi/r3xcqipovgqu-zbbxruxsy-wqvk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ici, il s'av√®re que nous voulons utiliser le fragment vert RecyclerView dans un autre endroit o√π la barre de navigation inf√©rieure n'est plus l√†. √Ä ce stade, RecyclerView commence d√©j√† √† g√©rer les encarts par le bas. Nous devons lui appliquer un remplissage pour faire d√©filer correctement sous la barre de navigation. Par cons√©quent, dans RecyclerView, nous ajoutons √©galement le traitement des encarts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/ws/m-/vewsm-_o80cw7mbn9tyk0bu_mfs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous revenons √† notre √©cran, o√π tout le monde traite les encarts. Rappelez-vous, personne ne signale qu'il les a trait√©s? </font></font><br>
<br>
<img src="https://habrastorage.org/webt/um/vd/x8/umvdx8faxxk48r-inx-cxhkjqdm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons cette situation: RecyclerView a trait√© les encarts par le bas, bien qu'il n'atteigne pas la barre de navigation - un espace est apparu en bas. J'ai remarqu√© cela dans les applications, et assez grand et populaire.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/i9/3_/ar/i93_arxauyvbitayfpyonkxnudy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si tel est le cas, nous nous souvenons que nous renvoyons toutes les encarts √† traiter. Donc (il s'av√®re!) Il faut signaler que les encarts sont trait√©s: la barre de navigation doit signaler que les encarts sont trait√©s. Ils ne devraient pas acc√©der √† RecyclerView. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jf/r2/vi/jfr2vi8jpsas_ptxjjqh_qhg1vk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour ce faire, installez la barre de navigation inf√©rieure </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Soustrayez √† l'int√©rieur </font></font><code>bottom + insets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'ils ne sont pas trait√©s, retournez 0.</font></font><br>
<br>
<pre><code class="kotlin hljs">doOnApplyWindowInsets { view, insets, initialPadding -&gt;    <font></font>
    view.updatePadding(<font></font>
        bottom = initialPadding.bottom + insets.systemWindowInsetBottom<font></font>
    )<font></font>
    insets.replaceSystemWindowInsets(<font></font>
        Rect(<font></font>
            insets.systemWindowInsetLeft,            <font></font>
            insets.systemWindowInsetTop,            <font></font>
            insets.systemWindowInsetRight,<font></font>
            <span class="hljs-number">0</span><font></font>
        )<font></font>
    )<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous retournons de nouveaux encarts, dans lesquels tous les anciens param√®tres sont √©gaux, mais </font></font><code>bottom + insets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©gaux √† 0. Il semble que tout va bien. </font><font style="vertical-align: inherit;">Nous commen√ßons et encore un non-sens - RecyclerView g√®re toujours les encarts pour une raison quelconque. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/yw/ut/lpywut3fvlk5w-nwbd3-wnrceaw.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas imm√©diatement compris que le probl√®me est que le conteneur pour ces trois vues est LinearLayout. </font><font style="vertical-align: inherit;">√Ä l'int√©rieur d'eux se trouve une barre d'outils, un extrait avec un RecyclerView et au bas de la barre de navigation inf√©rieure. </font><font style="vertical-align: inherit;">LinearLayout prend ses enfants en ordre et leur applique des encarts. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'av√®re que la barre de navigation inf√©rieure sera la derni√®re. </font><font style="vertical-align: inherit;">Il a dit √† quelqu'un qu'il avait trait√© tous les encarts, mais il √©tait trop tard. </font><font style="vertical-align: inherit;">Tous les encarts ont √©t√© trait√©s de haut en bas, RecyclerView les a d√©j√† re√ßus et cela ne nous sauve pas. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uj/mm/jd/ujmmjdgumv0bl6e0ewydx7ueq5g.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que faire? </font><font style="vertical-align: inherit;">LinearLayout ne fonctionne pas comme je le souhaite, il les transf√®re de haut en bas et je dois d'abord obtenir celui du bas.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red√©finir tout</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le d√©veloppeur Java a jou√© en moi - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tout</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit √™tre </font><strong><font style="vertical-align: inherit;">red√©fini</font></strong><font style="vertical-align: inherit;"> ! </font><font style="vertical-align: inherit;">Eh bien, </font></font><code>dispatchApplyWindowInsets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">red√©finissez </font><font style="vertical-align: inherit;">maintenant </font><font style="vertical-align: inherit;">, d√©finissez </font></font><code>yLinearLayout</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui ira toujours de bas en haut. </font><font style="vertical-align: inherit;">Il enverra d'abord des encarts √† la barre de navigation inf√©rieure, puis √† tout le monde.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> WindowInsets dispatchApplyWindowInsets(WindowInsets insets) {     <font></font>
    insets = <span class="hljs-keyword">super</span>.dispatchApplyWindowInsets(insets);     
    <span class="hljs-keyword">if</span> (!insets.isConsumed()) {        
        <span class="hljs-keyword">final</span> int count = getChildCount();
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; count; i++) {<font></font>
            insets = getChildAt(i).dispatchApplyWindowInsets(insets);<font></font>
            <span class="hljs-keyword">if</span> (insets.isConsumed()) {
                <span class="hljs-keyword">break</span>;<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
    <span class="hljs-keyword">return</span> insets;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais je me suis arr√™t√© √† temps, me souvenant du commentaire qu'il n'√©tait pas n√©cessaire de red√©finir cette m√©thode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, un peu plus haut est le salut: ViewGroup recherche un d√©l√©gu√© qui traite les encarts, puis appelle la super m√©thode sur View et active son propre traitement. </font><font style="vertical-align: inherit;">Dans ce code, nous obtenons des encarts, et s'ils n'ont pas encore √©t√© trait√©s, nous commen√ßons la logique standard pour nos enfants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai √©crit une simple extension. </font><font style="vertical-align: inherit;">Il permet, en s'appliquant </font></font><code>InsetsListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† une seule vue, de dire √† qui ces encarts passent.</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword">fun</span> View.<span class="hljs-title">addSystemBottomPadding</span><span class="hljs-params">(    
    targetView: <span class="hljs-type">View</span> = this
)</span></span> {<font></font>
    doOnApplyWindowInsets { _, insets, initialPadding -&gt;           <font></font>
        targetView.updatePadding(<font></font>
            bottom = initialPadding.bottom + insets.systemWindowInsetBottom<font></font>
        )<font></font>
        insets.replaceSystemWindowInsets(<font></font>
            Rect(<font></font>
                insets.systemWindowInsetLeft,<font></font>
                insets.systemWindowInsetTop,     <font></font>
                insets.systemWindowInsetRight,<font></font>
                <span class="hljs-number">0</span><font></font>
            )<font></font>
        )<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, il </font></font><code>targetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est √©gal par d√©faut √† la m√™me vue au-dessus de laquelle nous appliquons </font></font><code>addSystemBottomPadding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous pouvons le red√©finir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur mon LinearLayout, j'ai suspendu un tel gestionnaire, en passant </font></font><code>targetView</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est ma barre de navigation inf√©rieure.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D'abord, il donnera des encarts √† la barre de navigation inf√©rieure.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela traitera les encarts, retournera le fond z√©ro.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, par d√©faut, ils iront de haut en bas: Barre d'outils, fragment avec RecyclerView.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puis, peut-√™tre, il enverra √† nouveau des encarts √† la barre de navigation inf√©rieure. </font><font style="vertical-align: inherit;">Mais ce n'est plus important, tout fonctionnera si bien.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai r√©alis√© exactement ce que je voulais: tous les encarts sont trait√©s dans l'ordre dans lequel ils sont n√©cessaires.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/s3/b0/nc/s3b0nc07bayude3nvrvevkxnwyc.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques points importants √† garder √† l'esprit. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le clavier est l'interface utilisateur du syst√®me au-dessus de votre application.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pas besoin de la traiter d'une mani√®re sp√©ciale. Si vous regardez le clavier Google, ce n'est pas seulement une mise en page avec des boutons sur laquelle vous pouvez cliquer. Il existe des centaines de modes pour ce clavier: recherche de gifs et de m√®mes, entr√©e vocale, redimensionnement de 10 pixels en hauteur aux tailles d'√©cran. Ne pensez pas au clavier, mais abonnez-vous aux encarts. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le tiroir de navigation ne prend toujours pas en charge la navigation gestuelle</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√Ä Google IO, ils ont promis que tout fonctionnerait hors de la bo√Æte. </font><font style="vertical-align: inherit;">Mais dans Android 10, Navigation Drawer ne prend toujours pas en charge cela. </font><font style="vertical-align: inherit;">Si vous passez √† Android 10 et activez la navigation par gestes, le tiroir de navigation tombera. </font><font style="vertical-align: inherit;">Maintenant, vous devez cliquer sur le menu hamburger pour le faire appara√Ætre, ou une combinaison de circonstances al√©atoires vous permet de l'√©tirer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la version pr√©-alpha d'Android, Navigation Drawer fonctionne, mais je n'ai pas os√© mettre √† jour - c'est pr√©-alpha. </font><font style="vertical-align: inherit;">Par cons√©quent, m√™me si vous installez la derni√®re version de GitFox √† partir du r√©f√©rentiel, il y a un tiroir de navigation, mais il ne peut pas √™tre extrait. </font><font style="vertical-align: inherit;">D√®s que le support officiel sera disponible, je mettrai √† jour et tout fonctionnera bien.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste de contr√¥le de pr√©paration pour Android 10</font></font></h2><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©finissez la transparence de la barre de navigation et de la barre d'√©tat depuis le d√©but du projet</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Google recommande fortement de maintenir une barre de navigation transparente. Pour nous, c'est une partie pratique importante. Si le projet fonctionne, mais que vous ne l'avez pas activ√©, prenez le temps de prendre en charge Android 10. Activez-les d'abord dans le sujet, comme translucide, et corrigez la mise en page o√π il s'est cass√©. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez des extensions √† Kotlin</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - c'est plus facile avec elles. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajoutez √† toute la barre d'outils au-dessus du rembourrage.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les barres d'outils sont toujours en haut, et c'est ce que vous devez faire. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour tous les RecyclerViews, ajoutez un rembourrage par le bas</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et la possibilit√© de faire d√©filer </font></font><code>clipToPadding="false"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pensez √† tous les boutons sur les bords de l'√©cran </font></font></strong><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(FAB)</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les FAB ne seront probablement pas l√† o√π vous vous attendez.</font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ne remplacez pas ou ne faites pas vos propres impl√©mentations pour tous les LinearLayout</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et autres cas similaires. Faites l'astuce, comme dans GitFox, ou prenez mon extension pr√™te √† l'emploi pour vous aider. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rifiez les gestes sur les bords de l'√©cran pour une vue personnalis√©e</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le tiroir de navigation ne le prend pas en charge. Mais ce n'est pas si difficile de le supporter avec vos mains, de red√©finir les encarts pour les gestes √† l'√©cran avec le tiroir de navigation. Vous avez peut-√™tre des √©diteurs d'images o√π les gestes fonctionnent. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le d√©filement dans ViewPager ne fonctionne pas du bord, mais uniquement du centre vers la droite et la gauche</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Google dit que c'est normal. Si vous tirez le ViewPager depuis le bord, il est per√ßu comme appuyant sur le bouton "Retour". </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans un nouveau projet, int√©grez imm√©diatement toute la transparence</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous pouvez dire aux concepteurs que vous n'avez pas de barre de navigation ni de barre d'√©tat. </font><font style="vertical-align: inherit;">Le carr√© entier est le contenu de votre application. </font><font style="vertical-align: inherit;">Et les d√©veloppeurs sauront d√©j√† o√π et quoi soulever. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liens utiles:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@rmr_spb dans un t√©l√©gramme - enregistrements de mitaps internes de Redmadrobot SPb.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout le code source dans cet article et encore plus dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitFox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il y a une branche Android 10 distincte, o√π vous pouvez voir en validant comment je suis arriv√© √† tout cela et comment j'ai pris en charge le nouvel Android.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Biblioth√®que Insetter de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chris Bane. </font><font style="vertical-align: inherit;">Il contient 5-6 extensions que j'ai montr√©es. </font><font style="vertical-align: inherit;">Pour l'utiliser dans votre projet, contactez la biblioth√®que, il est probable qu'elle passe √† Android Jetpack. </font><font style="vertical-align: inherit;">Je les ai d√©velopp√©s dans mon projet et, il me semble, ils se sont am√©lior√©s.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Article de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chris Bane.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>   FunCorn,    ,      .</li>
<li> ¬´<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Why would I want to fitsSystemWindows?</a>¬ª  .</li>
</ul><br>
<blockquote>    AppConf,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">youtube-</a>      .            ,     - .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AppsConf</a>     ,            .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>, stay tuned!</blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr488160/index.html">Windows Server 2019 contre Instantan√©s VMware avec mise au repos: une solution √©l√©gante au probl√®me</a></li>
<li><a href="../fr488162/index.html">Plus la note est √©lev√©e, plus il y a d'argent et vice versa</a></li>
<li><a href="../fr488164/index.html">Bataille de la SEC contre Telegram</a></li>
<li><a href="../fr488190/index.html">Encore une fois sur l'√©puisement √©motionnel</a></li>
<li><a href="../fr488194/index.html">Pourquoi √©crivons-nous des programmes de si mauvaise qualit√©?</a></li>
<li><a href="../fr488198/index.html">De quoi les Timlids ont-ils peur et pourquoi devraient-ils arr√™ter de faire cela</a></li>
<li><a href="../fr488200/index.html">Le d√©bat sur le premier langage de programmation: la d√©cision finale</a></li>
<li><a href="../fr488202/index.html">PVS-Studio est maintenant dans Chocolatey: v√©rification de Chocolatey √† partir d'Azure DevOps</a></li>
<li><a href="../fr488208/index.html">Anniversaire DUMP2020 - 4 jours que vous n'oublierez pas</a></li>
<li><a href="../fr488210/index.html">Reconna√Ætre des objets sur Android √† l'aide de TensorFlow: de la pr√©paration des donn√©es au lancement sur l'appareil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>