<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïö üë©üèº‚Äçüè´ üèâ COVID-19 Telegram-bot // Respondemos preguntas frecuentes autom√°ticamente ‚è≥ üíÜüèº üëºüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el contexto del bombo universal sobre el coronavirus, decid√≠ hacer al menos algo √∫til (pero no menos bombo). En este art√≠culo, hablar√© sobre c√≥mo c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>COVID-19 Telegram-bot // Respondemos preguntas frecuentes autom√°ticamente</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494118/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el contexto del bombo universal sobre el coronavirus, decid√≠ hacer al menos algo √∫til (pero no menos bombo). </font><font style="vertical-align: inherit;">En este art√≠culo, hablar√© sobre c√≥mo crear e implementar el Telegram Bot usando m√©todos de PNL basados ‚Äã‚Äãen reglas en 2.5 horas (eso es lo que me llev√≥) para responder preguntas frecuentes usando el caso COVID-19 como ejemplo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el curso del trabajo, usaremos el viejo Python, la API de Telegram, un par de bibliotecas NLP est√°ndar, as√≠ como Docker.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/68/e4/tw/68e4twfyppio_uy1o1dojajfeca.jpeg"><br>
<a name="habracut"></a><br>
<blockquote><img src="https://habrastorage.org/webt/fi/0x/4z/fi0x4z2nhcc3-3bdzugakb4csji.png" align="left"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minuto de atenci√≥n ovni</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La pandemia COVID-19, una infecci√≥n respiratoria aguda potencialmente grave causada por el coronavirus SARS-CoV-2 (2019-nCoV), se ha anunciado oficialmente en el mundo. </font><font style="vertical-align: inherit;">Hay mucha informaci√≥n sobre Habr√© sobre este tema; recuerde siempre que puede ser confiable / √∫til, y viceversa.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le instamos a que sea cr√≠tico con cualquier informaci√≥n publicada.</font></font></h4><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuentes oficiales</font></font></b><div class="spoiler_text"><ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sitio web del Ministerio de Salud de la Federaci√≥n de Rusia</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sitio web de Rospotrebnadzor</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">  ()</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> </a></li>
<li>       </li>
</ul><br>
     ,      .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√°vese las manos, cuide a sus seres queridos, qu√©dese en casa siempre que sea posible y trabaje de forma remota. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Leer publicaciones sobre: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coronavirus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> | </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabajo remoto</font></font></a></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breve Prefacio</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo describe el proceso de creaci√≥n de un Bot de Telegram simple que responde preguntas frecuentes sobre COVID-19. </font><font style="vertical-align: inherit;">La tecnolog√≠a de desarrollo es extremadamente simple y vers√°til, y se puede utilizar para cualquier otro caso. </font><font style="vertical-align: inherit;">Una vez m√°s, enfatizo que no pretendo ser el Estado del Arte, sino que solo ofrezco una soluci√≥n simple y efectiva que pueda ser reutilizada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como creo que el lector de este art√≠culo ya tiene cierta experiencia con Python, asumiremos que ya tiene instalado Python 3.X y las herramientas de desarrollo necesarias (PyCharm, VS Code), puede crear un Bot en Telegram a trav√©s de BotFather, y por lo tanto, me saltear√© estas cosas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Configurar API</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que debe instalar es la biblioteca de contenedor para la API de Telegram " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python-telegram-bot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">El comando est√°ndar para esto es:</font></font><br>
<br>
<pre><code class="python hljs">pip install python-telegram-bot --upgrade</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, crearemos el marco de nuestro peque√±o programa definiendo "controladores" para los siguientes eventos de Bot:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start: comando de lanzamiento de Bot;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ayuda - comando de ayuda (ayuda);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mensaje - procesamiento de mensajes de texto;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">error: un error.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La firma de los manejadores se ver√° as√≠:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#   </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment">#  </span>
    <span class="hljs-keyword">pass</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-comment"># </span>
    <span class="hljs-keyword">pass</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, por analog√≠a con el ejemplo de la documentaci√≥n de la biblioteca, definimos la funci√≥n principal en la que asignamos todos estos controladores e iniciamos el bot:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_answer</span>():</span>
    <span class="hljs-string">"""Start the bot."""</span>
    <span class="hljs-comment"># Create the Updater and pass it your bot's token.</span>
    <span class="hljs-comment"># Make sure to set use_context=True to use the new context based callbacks</span>
    <span class="hljs-comment"># Post version 12 this will no longer be necessary</span>
    updater = Updater(<span class="hljs-string">"Token"</span>, use_context=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-comment"># Get the dispatcher to register handlers</span><font></font>
    dp = updater.dispatcher<font></font>
<font></font>
    <span class="hljs-comment"># on different commands - answer in Telegram</span>
    dp.add_handler(CommandHandler(<span class="hljs-string">"start"</span>, start))<font></font>
    dp.add_handler(CommandHandler(<span class="hljs-string">"help"</span>, help))<font></font>
<font></font>
    <span class="hljs-comment"># on noncommand i.e message - echo the message on Telegram</span><font></font>
    dp.add_handler(MessageHandler(Filters.text, message))<font></font>
<font></font>
    <span class="hljs-comment"># log all errors</span><font></font>
    dp.add_error_handler(error)<font></font>
<font></font>
    <span class="hljs-comment"># Start the Bot</span><font></font>
    updater.start_polling()<font></font>
<font></font>
    <span class="hljs-comment"># Run the bot until you press Ctrl-C or the process receives SIGINT,</span>
    <span class="hljs-comment"># SIGTERM or SIGABRT. This should be used most of the time, since</span>
    <span class="hljs-comment"># start_polling() is non-blocking and will stop the bot gracefully.</span><font></font>
    updater.idle()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<font></font>
    get_answer()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le llamo la atenci√≥n sobre el hecho de que hay 2 mecanismos para lanzar un bot:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sondeo est√°ndar: sondeo peri√≥dico de Bot utilizando herramientas API est√°ndar de Telegram para nuevos eventos ( </font></font><code>updater.start_polling()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webhook: iniciamos nuestro servidor con un punto final, al que llegan los eventos del bot, requiere HTTPS.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya not√≥, para simplificar, usamos el sondeo est√°ndar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Completamos los manejadores est√°ndar con l√≥gica</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comencemos con una simple, complete el inicio y los controladores de ayuda con respuestas est√°ndar, obtenemos algo como esto:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /start is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
!
        COVID-19.
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">help</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Send a message when the command /help is issued."""</span>
    update.message.reply_text(<span class="hljs-string">"""
     (  COVID-19).
:
- *  ?*
- *  ?*
- *   ?*
 ..
 !
    """</span>, parse_mode=telegram.ParseMode.MARKDOWN)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, cuando el usuario env√≠a los comandos / start o / help, recibir√° la respuesta prescrita por nosotros. </font><font style="vertical-align: inherit;">Le llamo la atenci√≥n sobre el hecho de que el texto est√° formateado en Markdown</font></font><br>
<br>
<pre><code class="python hljs">parse_mode=telegram.ParseMode.MARKDOWN</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, agregue el registro de errores al controlador de errores:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Log Errors caused by Updates."""</span>
    logger.warning(<span class="hljs-string">'Update "%s" caused error "%s"'</span>, update, context.error)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, verifiquemos si nuestro Bot funciona. </font><font style="vertical-align: inherit;">Copiar todo el c√≥digo escrito en un solo archivo, por ejemplo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">app.py</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A√±adir las </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importaciones</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necesarias </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute el archivo y vaya a Telegram ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no olvide insertar su Token en el c√≥digo</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Escribimos los comandos / start y / help y nos regocijamos:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hn/jf/bo/hnjfbobptb1e1no0h-nl5cdegt4.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Procesamos el mensaje y generamos una respuesta.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que necesitamos para responder la pregunta es la Base de conocimiento. </font><font style="vertical-align: inherit;">Lo m√°s simple que puede hacer es crear un archivo json simple en forma de valores Key-Value, donde Key es el texto de la pregunta propuesta y Value es la respuesta a la pregunta. </font><font style="vertical-align: inherit;">Ejemplo de base de conocimiento:</font></font><br>
<br>
<pre><code class="json hljs">{
  <span class="hljs-attr">"      ?"</span>: <span class="hljs-string">"  ‚Äî  .     -     ,     ,     ,        .    ,      ,   .        ,     ."</span>,
  <span class="hljs-attr">"   ?"</span>: <span class="hljs-string">"  :\n     \n    \n    \n     \n\n         ,    ."</span>,
  <span class="hljs-attr">"  ?"</span>: <span class="hljs-string">" :\n- (    , , )\n- (  )"</span>,<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El algoritmo para responder la pregunta ser√° el siguiente:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recibimos el texto de la pregunta del usuario;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lematizar todas las palabras en el texto del usuario;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No comparamos claramente el texto resultante con todas las preguntas lematizadas de la base de conocimiento ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">distancia de Levenshtein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seleccionamos la pregunta m√°s "similar" de la base de conocimiento;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enviamos la respuesta a la pregunta seleccionada al usuario.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar nuestros planes, necesitamos bibliotecas: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fuzzywuzzy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (para comparaciones difusas) y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pymorphy2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (para lematizaci√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree un nuevo archivo e implemente el algoritmo sonado:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> fuzzywuzzy <span class="hljs-keyword">import</span> fuzz
<span class="hljs-keyword">import</span> pymorphy2<font></font>
<font></font>
<span class="hljs-comment">#   </span><font></font>
morph = pymorphy2.MorphAnalyzer()<font></font>
<span class="hljs-comment">#  </span>
<span class="hljs-keyword">with</span> open(<span class="hljs-string">"faq.json"</span>) <span class="hljs-keyword">as</span> json_file:<font></font>
    faq = json.load(json_file)<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classify_question</span>(<span class="hljs-params">text</span>):</span>
    <span class="hljs-comment">#  </span>
    text = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> text.split())<font></font>
    questions = list(faq.keys())<font></font>
    scores = list()<font></font>
    <span class="hljs-comment">#      </span>
    <span class="hljs-keyword">for</span> question <span class="hljs-keyword">in</span> questions:
        <span class="hljs-comment">#    </span>
        norm_question = <span class="hljs-string">' '</span>.join(morph.parse(word)[<span class="hljs-number">0</span>].normal_form <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> question.split())
        <span class="hljs-comment">#       </span><font></font>
        scores.append(fuzz.token_sort_ratio(norm_question.lower(), text.lower()))<font></font>
    <span class="hljs-comment"># </span><font></font>
    answer = faq[questions[scores.index(max(scores))]]<font></font>
<font></font>
    <span class="hljs-keyword">return</span> answer</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de escribir un controlador de mensajes, escribiremos una funci√≥n que guarde el historial de correspondencia en un archivo tsv:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump_data</span>(<span class="hljs-params">user, question, answer</span>):</span><font></font>
    username = user.username<font></font>
    full_name = user.full_name<font></font>
    id = user.id<font></font>
<font></font>
    str = <span class="hljs-string">"""{username}\t{full_name}\t{id}\t{question}\t{answer}\n"""</span>.format(username=username,<font></font>
                                                                 full_name=full_name,<font></font>
                                                                 id=id,<font></font>
                                                                 question=question,<font></font>
                                                                 answer=answer)<font></font>
<font></font>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">"/data/dump.tsv"</span>, <span class="hljs-string">"a"</span>) <span class="hljs-keyword">as</span> myfile:<font></font>
        myfile.write(str)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, utilizamos el m√©todo que escribimos en el mensaje del mensaje de texto del controlador de mensajes:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span>(<span class="hljs-params">update, context</span>):</span>
    <span class="hljs-string">"""Answer the user message."""</span>
    <span class="hljs-comment"># </span><font></font>
    answer = classify_question(update.message.text)<font></font>
    <span class="hljs-comment">#  </span><font></font>
    dump_data(update.message.from_user, update.message.text, answer)<font></font>
    <span class="hljs-comment"># </span>
    update.message.reply_text(answer)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voila, ahora ve a Telegram y disfruta de la escritura:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/id/fj/2h/idfj2hjue-vkxmusxsd6hibl-zu.jpeg" width="300"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Configure Docker e implemente la aplicaci√≥n.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dec√≠a el cl√°sico: "Si ejecutas, entonces es hermoso ejecutarlo". Para que tengamos todo como personas, configuraremos la contenedorizaci√≥n con Docker Compose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para esto necesitamos:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear archivo Docker: define la imagen del contenedor y el punto de entrada;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crear docker-compose.yml: inicia muchos contenedores con un solo Dockerfile (en nuestro caso no es necesario, pero en caso de que tenga muchos servicios, ser√° √∫til).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cree boot.sh (el script es responsable directamente del lanzamiento).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, el contenido del Dockerfile:</font></font><br>
<br>
<pre><code class="plaintext hljs">#<font></font>
FROM python:3.6.6-slim<font></font>
<font></font>
#  <font></font>
WORKDIR /home/alex/covid-bot<font></font>
<font></font>
#  requirements.txt<font></font>
COPY requirements.txt ./<font></font>
<font></font>
# Install required libs<font></font>
RUN pip install --upgrade pip -r requirements.txt; exit 0<font></font>
<font></font>
#      <font></font>
COPY data data<font></font>
<font></font>
#   <font></font>
COPY app.py faq.json reply_generator.py boot.sh  ./<font></font>
<font></font>
#   <font></font>
RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<font></font>
<font></font>
# <font></font>
RUN chmod +x boot.sh<font></font>
<font></font>
#  <font></font>
ENTRYPOINT ["./boot.sh"]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contenido de docker-compose.yml:</font></font><br>
<br>
<pre><code class="plaintext hljs"># docker-compose<font></font>
version: '2'<font></font>
#  <font></font>
services:<font></font>
  bot:<font></font>
    restart: unless-stopped<font></font>
    image: covid19_rus_bot:latest<font></font>
    container_name: covid19_rus_bot<font></font>
    #    boot.sh<font></font>
    environment:<font></font>
      - SERVICE_TYPE=covid19_rus_bot<font></font>
    # volume      <font></font>
    volumes: <font></font>
        - ./data:/data<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contenido de boot.sh:</font></font><br>
<br>
<pre><code class="plaintext hljs">#!/bin/bash<font></font>
if [ -n $SERVICE_TYPE ]<font></font>
then<font></font>
  if [ $SERVICE_TYPE == "covid19_rus_bot" ]<font></font>
  then<font></font>
    exec python app.py<font></font>
    exit<font></font>
  fi<font></font>
else<font></font>
  echo -e "SERVICE_TYPE not set\n"<font></font>
fi</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, estamos listos, para comenzar todo esto necesita ejecutar los siguientes comandos en la carpeta del proyecto:</font></font><br>
<br>
<pre><code class="bash hljs">sudo docker build -t covid19_rus_bot:latest .<font></font>
sudo docker-compose up</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo, nuestro bot est√° listo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En lugar de una conclusi√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se esperaba, todo el c√≥digo est√° disponible en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">repositorio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este enfoque, mostrado por m√≠, se puede aplicar en cualquier caso para responder preguntas frecuentes, ¬°solo personalice la base de conocimiento! Con respecto a la base de conocimientos, tambi√©n se puede mejorar cambiando la estructura de Clave y Valor a matrices, por lo que cada par ser√° una serie de preguntas potenciales sobre un tema y una serie de respuestas potenciales (para una variedad de respuestas, puede elegir al azar). Naturalmente, el enfoque basado en reglas no es demasiado flexible para escalar, pero estoy seguro de que este enfoque resistir√° una base de conocimiento con aproximadamente 500 preguntas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los que han le√≠do hasta el final los invito a probar mi Bot </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494094/index.html">3D h√°galo usted mismo. Parte 1: p√≠xeles y l√≠neas</a></li>
<li><a href="../es494096/index.html">Despliegue intranet. Experiencia, errores, recomendaciones.</a></li>
<li><a href="../es494098/index.html">Enfoque imperativo para datos reactivos en el ejemplo de Jetbrains KTor y R2DBC</a></li>
<li><a href="../es494100/index.html">Lo que necesita para crear el modelo ideal de un centro educativo para capacitar especialistas en TI</a></li>
<li><a href="../es494114/index.html">C√≥mo reducir el n√∫mero y aumentar la legibilidad del c√≥digo en react-redux, redux-saga</a></li>
<li><a href="../es494124/index.html">Ensamblar una computadora de 8 bits: c√≥mo reducir el n√∫mero de chips a seis</a></li>
<li><a href="../es494126/index.html">CIENCIA SUPERIOR Febrero Media Diez: feministas cangrejo zombi, salamandras prehist√≥ricas y alcoh√≥licos exagerados</a></li>
<li><a href="../es494128/index.html">Hackspace Neuron: un lugar de encuentro para hackers en Mosc√∫</a></li>
<li><a href="../es494130/index.html">Qu√© sucede con los eventos en l√≠nea: algunas de nuestras estad√≠sticas</a></li>
<li><a href="../es494132/index.html">Compilador Befunge en Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>