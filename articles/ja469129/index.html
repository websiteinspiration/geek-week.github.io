<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔗 💆🏽 🚕 暗いテーマのため、Thunderbirdはコードアナライザーを実行する必要がありました 👸 🅾️ 👦🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mozilla Thunderbird電子メールクライアントの「冒険」は、バージョン68.0への自動アップグレードから始まりました。このバージョンの注目すべき機能は次のとおりです。デフォルトで、ポップアップ通知と暗いテーマにテキストが追加されます。静的解析を使用して検出しようとしたエラーがありました...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>暗いテーマのため、Thunderbirdはコードアナライザーを実行する必要がありました</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/469129/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d19/1b4/7c9/d191b47c96eca6289545e03035589513.png" alt="写真3"></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mozilla Thunderbird電子メールクライアントの「冒険」は、バージョン68.0への自動アップグレードから始まりました。</font><font style="vertical-align: inherit;">このバージョンの注目すべき機能は次のとおりです。デフォルトで、ポップアップ通知と暗いテーマにテキストが追加されます。</font><font style="vertical-align: inherit;">静的解析を使用して検出しようとしたエラーがありました。</font><font style="vertical-align: inherit;">これは、PVS-Studioを使用してプロジェクトのソースコードをもう一度確認する機会でした。</font><font style="vertical-align: inherit;">分析の時点で、エラーはすでに修正されていることがわかりました。</font><font style="vertical-align: inherit;">しかし、このプロジェクトに注意を向けたので、このプロジェクトで見つかった他の欠陥について書くことができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thunderbirdの新バージョンの暗いテーマはかなりきれいに見えます。</font><font style="vertical-align: inherit;">私は暗いテーマが大好きです。</font><font style="vertical-align: inherit;">すでにインスタントメッセンジャー、Windows、macOSでそれらに切り替えました。</font><font style="vertical-align: inherit;">まもなく、iPhoneはiOS 13にアップグレードされ、暗いテーマが表示されます。</font><font style="vertical-align: inherit;">そのため、iPhone 5Sを新しいモデルに変更する必要さえありました。</font><font style="vertical-align: inherit;">実際には、暗いテーマでは、インターフェイスの色を選択するために開発者がより多くの努力を必要とすることがわかりました。</font><font style="vertical-align: inherit;">誰もがこれに初めて対処するわけではありません。</font></font><a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのため、Thunderbirdの標準タグは次のようになりました。</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83c/bb0/4a9/83cbb04a9a598452726509f326cffb1a.png" alt="写真1"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6つのタグ（標準5つ+カスタム1つ）を使用してメールにマークを付けています。</font><font style="vertical-align: inherit;">アップデート後は半分が見れなくなったので、設定を明るくすることにしました。</font><font style="vertical-align: inherit;">しかし、私はバグに遭遇しました：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ea/b5e/91e/0eab5e91e9f6da7b1b1ac7d66c414947.png" alt="写真2"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
タグの色は変更できません!!!より正確には、それは可能ですが、エディターは既存の名前（WTF ???）を参照してそれを保存することを許可しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この名前は保存できないため、名前を変更しようとすると、バグのもう1つの兆候として[OK]ボタンが無効になります。名前も変更できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、暗いテーマが設定に影響を与えていないことに気付くかもしれませんが、これもあまり美しくありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windowsのビルドシステムとの長い闘争の後、ソースからThunderbirdをアセンブルすることはまだ可能でした。メールクライアントの最新バージョンは、最新リリースよりもはるかに優れていることがわかりました。その中で、暗いテーマが設定に到達し、タグエディターのこのバグも消えました。しかし、プロジェクトを構築するための努力が無駄にならないように、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静的コードアナライザーが起動されました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Thunderbirdのソースコードは、Firefoxのコードベースと何らかの形で重複しています。</font><font style="vertical-align: inherit;">したがって、分析にはさまざまなコンポーネントからのエラーが含まれています。これは、さまざまなチームの開発者をよく見る価値があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">記事が書かれている間に、Thunderbird 68.1アップデートがこのバグの修正を伴って出ました：</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a5/20f/0eb/4a520f0eb68eb4061bcedfdc74c94e5f.png" alt="写真5"></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通信</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
comm-centralは、Thunderbird、SeaMonkey、およびLightning拡張コードのMercurialリポジトリです。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '||'の左側と右側に同じサブ式 '（！Strcmp（header、 "Reply-To"））'があります </font><font style="vertical-align: inherit;">オペレーター。</font><font style="vertical-align: inherit;">nsEmitterUtils.cpp 28</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">EmitThisHeaderForPrefSetting</span><span class="hljs-params">(<span class="hljs-keyword">int32_t</span> dispType,
                                             <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *header)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (nsMimeHeaderDisplayTypes::NormalHeaders == dispType) {
    <span class="hljs-keyword">if</span> ((!<span class="hljs-built_in">strcmp</span>(header, HEADER_DATE)) || (!<span class="hljs-built_in">strcmp</span>(header, HEADER_TO)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_SUBJECT)) || (!<span class="hljs-built_in">strcmp</span>(header, HEADER_SENDER)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_RESENT_TO)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_RESENT_SENDER)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_RESENT_FROM)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_RESENT_CC)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_REPLY_TO)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_REFERENCES)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_NEWSGROUPS)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_MESSAGE_ID)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_FROM)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_FOLLOWUP_TO)) || (!<span class="hljs-built_in">strcmp</span>(header, HEADER_CC)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_ORGANIZATION)) ||<font></font>
        (!<span class="hljs-built_in">strcmp</span>(header, HEADER_REPLY_TO)) || (!<span class="hljs-built_in">strcmp</span>(header, HEADER_BCC)))
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
行は</font><font style="vertical-align: inherit;">定数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEADER_REPLY_TOと</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2回</font><font style="vertical-align: inherit;">比較されました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">おそらく、その代わりに別の定数があったはずです。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「&amp;&amp;」演算子の左側と右側に同一のサブ式「obj-&gt; options-&gt; headers！= MimeHeadersCitation」があります。</font><font style="vertical-align: inherit;">mimemsig.cpp 536</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">MimeMultipartSigned_emit_child</span><span class="hljs-params">(MimeObject *obj)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;headers != MimeHeadersCitation &amp;&amp;<font></font>
      obj-&gt;options-&gt;write_html_p &amp;&amp; obj-&gt;options-&gt;output_fn &amp;&amp;<font></font>
      obj-&gt;options-&gt;headers != MimeHeadersCitation &amp;&amp; sig-&gt;crypto_closure) {<font></font>
    ....<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の名前を持つ変数のもう1つの奇妙な比較は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘッダー</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font><font style="vertical-align: inherit;">いつものように、2つの考えられる説明があります。追加のチェックまたはタイプミスです。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V517</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'if（A）{...} else if（A）{...}'パターンの使用が検出されました。</font><font style="vertical-align: inherit;">論理エラーが存在する可能性があります。</font><font style="vertical-align: inherit;">チェック行：1306、1308。MapiApi.cpp 1306</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">CMapiApi::ReportLongProp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pTag, LPSPropValue pVal)</span> </span>{
  <span class="hljs-keyword">if</span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_LONG)) {<font></font>
    nsCString num;<font></font>
    nsCString num2;<font></font>
<font></font>
    num.AppendInt((<span class="hljs-keyword">int32_t</span>)pVal-&gt;Value.l);<font></font>
    num2.AppendInt((<span class="hljs-keyword">int32_t</span>)pVal-&gt;Value.l, <span class="hljs-number">16</span>);<font></font>
    MAPI_TRACE3(<span class="hljs-string">"%s %s, 0x%s\n"</span>, pTag, num, num2);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_NULL)) {<font></font>
    MAPI_TRACE1(<span class="hljs-string">"%s {NULL}\n"</span>, pTag);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_ERROR)) {  <span class="hljs-comment">// &lt;=</span>
    MAPI_TRACE1(<span class="hljs-string">"%s {Error retrieving property}\n"</span>, pTag);<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_ERROR)) {  <span class="hljs-comment">// &lt;=</span>
    MAPI_TRACE1(<span class="hljs-string">"%s {Error retrieving property}\n"</span>, pTag);<font></font>
  } <span class="hljs-keyword">else</span> {<font></font>
    MAPI_TRACE1(<span class="hljs-string">"%s invalid value, expecting long\n"</span>, pTag);<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (pVal) MAPIFreeBuffer(pVal);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ctrl + CおよびCtrl + Vを押すことで、条件式のカスケードが明らかに加速されました。</font><font style="vertical-align: inherit;">その結果、ブランチの1つが実行されることはありません。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V517</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'if（A）{...} else if（A）{...}'パターンの使用が検出されました。</font><font style="vertical-align: inherit;">論理エラーが存在する可能性があります。</font><font style="vertical-align: inherit;">チェック行：777、816。nsRDFContentSink.cpp 777</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">nsresult
<span class="hljs-title">RDFContentSinkImpl::GetIdAboutAttribute</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char16_t</span>** aAttributes,
                                        nsIRDFResource** aResource,
                                        <span class="hljs-keyword">bool</span>* aIsAnonymous)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (localName == nsGkAtoms::about) {<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (localName == nsGkAtoms::ID) {<font></font>
    ....<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (localName == nsGkAtoms::nodeID) {<font></font>
      nodeID.Assign(aAttributes[<span class="hljs-number">1</span>]);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (localName == nsGkAtoms::about) {
    <span class="hljs-comment">// XXX we don't deal with aboutEach...</span>
    <span class="hljs-comment">//MOZ_LOG(gLog, LogLevel::Warning,</span>
    <span class="hljs-comment">//       ("rdfxml: ignoring aboutEach at line %d",</span>
    <span class="hljs-comment">//        aNode.GetSourceLineNumber()));</span><font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初と最後の条件は同じです。</font><font style="vertical-align: inherit;">コードは、コードが作成中であることを示しています。</font><font style="vertical-align: inherit;">コードが完成した後、高い確率でエラーが発生することは間違いありません。</font><font style="vertical-align: inherit;">プログラマはコメント付きのコードを変更できますが、制御することはできません。</font><font style="vertical-align: inherit;">このコードには注意してください。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V522</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヌルポインター '行'の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">逆</font></a><font style="vertical-align: inherit;">参照が行われる可能性があります。</font><font style="vertical-align: inherit;">morkRowCellCursor.cpp 175</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">NS_IMETHODIMP
<span class="hljs-title">morkRowCellCursor::MakeCell</span><span class="hljs-params">(  <span class="hljs-comment">// get cell at current pos in the row</span>
    nsIMdbEnv* mev,           <span class="hljs-comment">// context</span>
    mdb_column* outColumn,    <span class="hljs-comment">// column for this particular cell</span>
    mdb_pos* outPos,          <span class="hljs-comment">// position of cell in row sequence</span>
    nsIMdbCell** acqCell)</span> </span>{<font></font>
  nsresult outErr = NS_OK;<font></font>
  nsIMdbCell* outCell = <span class="hljs-number">0</span>;<font></font>
  mdb_pos pos = <span class="hljs-number">0</span>;<font></font>
  mdb_column col = <span class="hljs-number">0</span>;<font></font>
  morkRow* row = <span class="hljs-number">0</span>;<font></font>
  morkEnv* ev = morkEnv::FromMdbEnv(mev);<font></font>
  <span class="hljs-keyword">if</span> (ev) {<font></font>
    pos = mCursor_Pos;<font></font>
    morkCell* cell = row-&gt;CellAt(ev, pos);<font></font>
    <span class="hljs-keyword">if</span> (cell) {<font></font>
      col = cell-&gt;GetColumn();<font></font>
      outCell = row-&gt;AcquireCellHandle(ev, cell, col, pos);<font></font>
    }<font></font>
    outErr = ev-&gt;AsErr();<font></font>
  }<font></font>
  <span class="hljs-keyword">if</span> (acqCell) *acqCell = outCell;
  <span class="hljs-keyword">if</span> (outPos) *outPos = pos;
  <span class="hljs-keyword">if</span> (outColumn) *outColumn = col;<font></font>
<font></font>
  <span class="hljs-keyword">return</span> outErr;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行で行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nullポインターの逆参照が</font><font style="vertical-align: inherit;">可能です。</font></font><br>
<br>
<pre><code class="cpp hljs">morkCell* cell = row-&gt;CellAt(ev, pos);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
おそらく、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetRow</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">など</font><font style="vertical-align: inherit;">を使用して、この行の前にポインタの初期化がスキップされました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V543</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HRESULT型の変数「m_lastError」に値「-1」が割り当てられているのは奇妙です。</font><font style="vertical-align: inherit;">MapiApi.cpp 1050</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CMapiApi</span> {</span><font></font>
 ....<font></font>
 <span class="hljs-keyword">private</span>:
  <span class="hljs-keyword">static</span> HRESULT m_lastError;<font></font>
  ....<font></font>
};<font></font>
<font></font>
<span class="hljs-function">CMsgStore *<span class="hljs-title">CMapiApi::FindMessageStore</span><span class="hljs-params">(ULONG cbEid, LPENTRYID lpEid)</span> </span>{
  <span class="hljs-keyword">if</span> (!m_lpSession) {<font></font>
    MAPI_TRACE0(<span class="hljs-string">"FindMessageStore called before session is open\n"</span>);<font></font>
        m_lastError = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HRESULT</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
型</font><font style="vertical-align: inherit;">は複雑なデータ型です。</font><font style="vertical-align: inherit;">このタイプの変数の異なるビットは、異なるエラー説明フィールドを表します。</font><font style="vertical-align: inherit;">エラーコードは、システムヘッダーファイルの特別な定数を使用して設定する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの場所のさらにいくつか：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V543 HRESULT型の変数「m_lastError」に値「-1」が割り当てられているのは奇妙です。</font><font style="vertical-align: inherit;">MapiApi.cpp 817</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V543 HRESULT型の変数「m_lastError」に値「-1」が割り当てられているのは奇妙です。</font><font style="vertical-align: inherit;">MapiApi.cpp 1749</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memset関数は、ポインターとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">3番目の引数を調べます。</font><font style="vertical-align: inherit;">icalmime.c 195</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">icalcomponent* <span class="hljs-title">icalmime_parse</span><span class="hljs-params">(....)</span>
</span>{
  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sspm_part</span> *<span class="hljs-title">parts</span>;</span>
  <span class="hljs-keyword">int</span> i, last_level=<span class="hljs-number">0</span>;<font></font>
  icalcomponent *root=<span class="hljs-number">0</span>, *parent=<span class="hljs-number">0</span>, *comp=<span class="hljs-number">0</span>, *last = <span class="hljs-number">0</span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> ( (parts = (struct sspm_part *)
          <span class="hljs-built_in">malloc</span>(NUM_PARTS*<span class="hljs-keyword">sizeof</span>(struct sspm_part)))==<span class="hljs-number">0</span>)<font></font>
  {<font></font>
    icalerror_set_errno(ICAL_NEWFAILED_ERROR);<font></font>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-built_in">memset</span>(parts,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(parts));<font></font>
<font></font>
  sspm_parse_mime(parts,<font></font>
      NUM_PARTS, <span class="hljs-comment">/* Max parts */</span>
      icalmime_local_action_map, <span class="hljs-comment">/* Actions */</span><font></font>
      get_string,<font></font>
      data, <span class="hljs-comment">/* data for get_string*/</span>
      <span class="hljs-number">0</span> <span class="hljs-comment">/* First header */</span>);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パーツ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
変数</font><font style="vertical-align: inherit;">は、構造体の配列へのポインターです。</font><font style="vertical-align: inherit;">構造体の値をリセットするために、彼らは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を使用しました</font><font style="vertical-align: inherit;">が、ポインタのサイズをメモリのサイズとして転送しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その他の疑わしい場所：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579 memset関数は、ポインターとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">3番目の引数を調べます。</font><font style="vertical-align: inherit;">icalmime.c 385</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579 memset関数は、ポインターとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">3番目の引数を調べます。</font><font style="vertical-align: inherit;">icalparameter.c 114</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579 snprintf関数は、ポインタとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">2番目の引数を調べます。</font><font style="vertical-align: inherit;">icaltimezone.c 1908</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579 snprintf関数は、ポインタとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">2番目の引数を調べます。</font><font style="vertical-align: inherit;">icaltimezone.c 1910</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579 strncmp関数は、ポインタとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">3番目の引数を調べます。</font><font style="vertical-align: inherit;">sspm.c 707</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V579 strncmp関数は、ポインタとそのサイズを引数として受け取ります。</font><font style="vertical-align: inherit;">間違いかもしれません。</font><font style="vertical-align: inherit;">3番目の引数を調べます。</font><font style="vertical-align: inherit;">sspm.c 813</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nullptrに対して検証される前に、「aValues」ポインターが使用されました。</font><font style="vertical-align: inherit;">チェック行：553、555。nsLDAPMessage.cpp 553</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">NS_IMETHODIMP
<span class="hljs-title">nsLDAPMessage::GetBinaryValues</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *aAttr, <span class="hljs-keyword">uint32_t</span> *aCount,
                               nsILDAPBERValue ***aValues)</span> </span>{<font></font>
  ....<font></font>
  *aValues = <span class="hljs-keyword">static_cast</span>&lt;nsILDAPBERValue **&gt;(<font></font>
      moz_xmalloc(numVals * <span class="hljs-keyword">sizeof</span>(nsILDAPBERValue)));
  <span class="hljs-keyword">if</span> (!aValues) {<font></font>
    ldap_value_free_len(values);<font></font>
    <span class="hljs-keyword">return</span> NS_ERROR_OUT_OF_MEMORY;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagnostics </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は通常、典型的なnullポインター逆参照エラーを検出します。</font><font style="vertical-align: inherit;">しかし、特に注目に値する非常に興味深い事例が見つかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
技術的には、アナライザーは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aValues</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインター</font><i><font style="vertical-align: inherit;">が</font></i><font style="vertical-align: inherit;">最初に逆参照され、次にチェックされる</font><font style="vertical-align: inherit;">ことは正しいです</font><font style="vertical-align: inherit;">が、エラーは異なります。</font><font style="vertical-align: inherit;">これは二重ポインタなので、正しいコードは次のようになります。</font></font><br>
<br>
<pre><code class="cpp hljs">*aValues = <span class="hljs-keyword">static_cast</span>&lt;nsILDAPBERValue **&gt;(<font></font>
    moz_xmalloc(numVals * <span class="hljs-keyword">sizeof</span>(nsILDAPBERValue)));
<span class="hljs-keyword">if</span> (!*aValues) {<font></font>
  ldap_value_free_len(values);<font></font>
  <span class="hljs-keyword">return</span> NS_ERROR_OUT_OF_MEMORY;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の非常に類似した場所：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V595 nullptrに対して検証される前に、「_ retval」ポインタが使用されました。</font><font style="vertical-align: inherit;">チェック行：357、358。nsLDAPSyncQuery.cpp 357</font></font></li>
</ul><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1044</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループの中断条件は反復回数に依存しません。</font><font style="vertical-align: inherit;">mimemoz2.cpp 1795</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ResetChannelCharset</span><span class="hljs-params">(MimeObject *obj)</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (cSet) {
    <span class="hljs-keyword">char</span> *ptr2 = cSet;
    <span class="hljs-keyword">while</span> ((*cSet) &amp;&amp; (*cSet != <span class="hljs-string">' '</span>) &amp;&amp; (*cSet != <span class="hljs-string">';'</span>) &amp;&amp;<font></font>
           (*cSet != <span class="hljs-string">'\r'</span>) &amp;&amp; (*cSet != <span class="hljs-string">'\n'</span>) &amp;&amp; (*cSet != <span class="hljs-string">'"'</span>))<font></font>
      ptr2++;<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (*cSet) {<font></font>
      PR_FREEIF(obj-&gt;options-&gt;default_charset);<font></font>
      obj-&gt;options-&gt;default_charset = strdup(cSet);<font></font>
      obj-&gt;options-&gt;override_charset = <span class="hljs-literal">true</span>;<font></font>
    }<font></font>
<font></font>
    PR_FREEIF(cSet);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このエラーは、アナライザーの次のリリースで使用可能になる新しい診断を使用して検出されました。</font><font style="vertical-align: inherit;">関数の本体で</font><i><font style="vertical-align: inherit;">ptr2</font></i><font style="vertical-align: inherit;">変数</font><font style="vertical-align: inherit;">と</font><i><font style="vertical-align: inherit;">cSet</font></i><font style="vertical-align: inherit;">変数が混同されているため、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whileループ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を停止する条件で使用されるすべての変数</font><font style="vertical-align: inherit;">は変更されません</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netwerk</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
netwerkには、ネットワークへの低レベルアクセス（ソケットとファイルおよびメモリキャッシュを使用）、および高レベルアクセス（http、ftp、gopher、castanetなどのさまざまなプロトコルを使用）のCインターフェイスとコードが含まれています。</font><font style="vertical-align: inherit;">このコードは、「netlib」および「Necko」という名前でも知られています。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「&amp;&amp;」演算子の左側と右側に同一のサブ式「connectStarted」があります。</font><font style="vertical-align: inherit;">nsSocketTransport2.cpp 1693</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">nsresult <span class="hljs-title">nsSocketTransport::InitiateSocket</span><span class="hljs-params">()</span> </span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (gSocketTransportService-&gt;IsTelemetryEnabledAndNotSleepPhase() &amp;&amp;<font></font>
      connectStarted &amp;&amp; connectCalled) {                   <span class="hljs-comment">// &lt;= good, line 1630</span><font></font>
    SendPRBlockingTelemetry(<font></font>
        connectStarted, Telemetry::PRCONNECT_BLOCKING_TIME_NORMAL,<font></font>
        Telemetry::PRCONNECT_BLOCKING_TIME_SHUTDOWN,<font></font>
        Telemetry::PRCONNECT_BLOCKING_TIME_CONNECTIVITY_CHANGE,<font></font>
        Telemetry::PRCONNECT_BLOCKING_TIME_LINK_CHANGE,<font></font>
        Telemetry::PRCONNECT_BLOCKING_TIME_OFFLINE);<font></font>
  }<font></font>
  ....<font></font>
  <span class="hljs-keyword">if</span> (gSocketTransportService-&gt;IsTelemetryEnabledAndNotSleepPhase() &amp;&amp;<font></font>
      connectStarted &amp;&amp; connectStarted) {                  <span class="hljs-comment">// &lt;= fail, line 1694</span><font></font>
    SendPRBlockingTelemetry(<font></font>
        connectStarted, Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_NORMAL,<font></font>
        Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_SHUTDOWN,<font></font>
        Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_CONNECTIVITY_CHANGE,<font></font>
        Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_LINK_CHANGE,<font></font>
        Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_OFFLINE);<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connectStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を複製すること</font><font style="vertical-align: inherit;">は、十分に長い関数全体を調べて同様のフラグメントを見つけるまでは、余計なコード</font><font style="vertical-align: inherit;">であると思ってい</font><font style="vertical-align: inherit;">ました。ほとんどの場合、代わりに単一の変数の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connectStarted</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここにも変数でなければなりません</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connectCalled</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V611</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリは 'new T []'演算子を使用して割り当てられましたが、 'delete'演算子を使用して解放されました。このコードを調べることを検討してください。 'delete [] mData;'を使用することをお勧めします。チェック行：233、222。DataChannel.cpp 233</font></font><br>
<br>
<pre><code class="cpp hljs">BufferedOutgoingMsg::BufferedOutgoingMsg(OutgoingMsg&amp; msg) {
  <span class="hljs-keyword">size_t</span> length = msg.GetLeft();
  <span class="hljs-keyword">auto</span>* tmp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">uint8_t</span>[length];  <span class="hljs-comment">// infallible malloc!</span>
  <span class="hljs-built_in">memcpy</span>(tmp, msg.GetData(), length);<font></font>
  mLength = length;<font></font>
  mData = tmp;<font></font>
  mInfo = <span class="hljs-keyword">new</span> sctp_sendv_spa;<font></font>
  *mInfo = msg.GetInfo();<font></font>
  mPos = <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
BufferedOutgoingMsg::~BufferedOutgoingMsg() {<font></font>
  <span class="hljs-keyword">delete</span> mInfo;
  <span class="hljs-keyword">delete</span> mData;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mData</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ポインター</font><font style="vertical-align: inherit;">は、単一のオブジェクトではなく配列を指します。</font><font style="vertical-align: inherit;">彼らは、クラスのデストラクタで誤りを犯し、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">削除</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演算子に角括弧を追加するのを忘れていました</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V1044</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ループの中断条件は反復回数に依存しません。</font><font style="vertical-align: inherit;">ParseFTPList.cpp 691</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ParseFTPList</span><span class="hljs-params">(....)</span> </span>{<font></font>
  ....<font></font>
  pos = toklen[<span class="hljs-number">2</span>];
  <span class="hljs-keyword">while</span> (pos &gt; (<span class="hljs-keyword">sizeof</span>(result-&gt;fe_size) - <span class="hljs-number">1</span>))<font></font>
    pos = (<span class="hljs-keyword">sizeof</span>(result-&gt;fe_size) - <span class="hljs-number">1</span>);
  <span class="hljs-built_in">memcpy</span>(result-&gt;fe_size, tokens[<span class="hljs-number">2</span>], pos);<font></font>
  result-&gt;fe_size[pos] = <span class="hljs-string">'\0'</span>;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
の値は</font><font style="vertical-align: inherit;">、ループ内で同じ量だけ上書きされます。</font><font style="vertical-align: inherit;">新しい診断で別の間違いが見つかったようです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gfx</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gfxには、プラットフォームに依存しない描画とイメージングのためのCインターフェイスとコードが含まれています。</font><font style="vertical-align: inherit;">長方形、線、画像などを描画するために使用できます。</font><font style="vertical-align: inherit;">基本的に、これはプラットフォームに依存しないデバイス（描画）コンテキスト用の一連のインターフェースです。</font><font style="vertical-align: inherit;">ウィジェットや特定の描画ルーチンは処理しません。</font><font style="vertical-align: inherit;">描画のための基本的な操作を提供するだけです。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V501</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '||'の左側と右側に同じサブ式があります </font><font style="vertical-align: inherit;">オペレーター：mVRSystem || </font><font style="vertical-align: inherit;">mVRCompositor || </font><font style="vertical-align: inherit;">mVRSystem OpenVRSession.cpp 876</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OpenVRSession::Shutdown</span><span class="hljs-params">()</span> </span>{<font></font>
  StopHapticTimer();<font></font>
  StopHapticThread();<font></font>
  <span class="hljs-keyword">if</span> (mVRSystem || mVRCompositor || mVRSystem) {<font></font>
    ::vr::VR_Shutdown();<font></font>
    mVRCompositor = <span class="hljs-literal">nullptr</span>;<font></font>
    mVRChaperone = <span class="hljs-literal">nullptr</span>;<font></font>
    mVRSystem = <span class="hljs-literal">nullptr</span>;<font></font>
  }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この状態では、変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mVRSystemが</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2回存在し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">明らかに、それらの1つは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mVRChaperone</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で置き換える必要があります</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
domには、JavaScriptでDOM（Document Object Model）オブジェクトを実装および追跡するためのCインターフェースとコードが含まれています。</font><font style="vertical-align: inherit;">これは、JavaScriptスクリプトに従って組み込みオブジェクトおよびユーザー定義オブジェクトを作成、破棄、操作するCサブ構造を形成します。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V570</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「clonedDoc-&gt; mPreloadReferrerInfo」変数はそれ自体に割り当てられます。</font><font style="vertical-align: inherit;">Document.cpp 12049</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">already_AddRefed&lt;Document&gt; <span class="hljs-title">Document::CreateStaticClone</span><span class="hljs-params">(
    nsIDocShell* aCloneContainer)</span> </span>{<font></font>
  ....<font></font>
  clonedDoc-&gt;mReferrerInfo =<font></font>
      <span class="hljs-keyword">static_cast</span>&lt;dom::ReferrerInfo*&gt;(mReferrerInfo.get())-&gt;Clone();<font></font>
  clonedDoc-&gt;mPreloadReferrerInfo = clonedDoc-&gt;mPreloadReferrerInfo;<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザーはそれ自体への変数の割り当てを検出しました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XPCOM</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
xpcomには、低レベルのCインターフェイス、Cコード、Cコード、ビットコードのアセンブリコード、およびXPCOMコンポーネント（「クロスプラットフォームコンポーネントオブジェクトモデル」の略）の基本的な機構を実装するためのコマンドラインツールが含まれています。 XPCOMは、Mozillaがインターフェースをエクスポートして、JavaScriptスクリプト、Microsoft COM、および通常のMozilla Cコードでそれらを自動的に利用できるようにするメカニズムです。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V611</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メモリは 'malloc / realloc'関数を使用して割り当てられましたが、 'delete'演算子を使用して解放されました。 「キー」変数の背後にある操作ロジックを調べることを検討してください。チェック行：143、140。nsINIParser.h 143</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">INIValue</span> {</span>
  INIValue(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* aKey, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* aValue)<font></font>
      : key(strdup(aKey)), value(strdup(aValue)) {}<font></font>
<font></font>
  ~INIValue() {<font></font>
    <span class="hljs-keyword">delete</span> key;
    <span class="hljs-keyword">delete</span> value;<font></font>
  }<font></font>
<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SetValue</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* aValue)</span> </span>{
    <span class="hljs-keyword">delete</span> value;<font></font>
    value = strdup(aValue);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* key;
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* value;<font></font>
  mozilla::UniquePtr&lt;INIValue&gt; next;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strdup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数を呼び出した後</font><font style="vertical-align: inherit;">、</font><i><font style="vertical-align: inherit;">delete</font></i><font style="vertical-align: inherit;">演算子ではなく</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">free</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">関数を使用してメモリを解放</font><i><font style="vertical-align: inherit;">する</font></i><font style="vertical-align: inherit;">必要があり</font><i><font style="vertical-align: inherit;">ます</font></i><font style="vertical-align: inherit;">。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">V716</font></a><font style="vertical-align: inherit;">初期化で不審な型変換： 'HRESULT var = BOOL'。</font><font style="vertical-align: inherit;">SpecialSystemDirectory.cpp 73</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">BOOL <span class="hljs-title">SHGetSpecialFolderPathW</span><span class="hljs-params">(
  HWND   hwnd,
  LPWSTR pszPath,
  <span class="hljs-keyword">int</span>    csidl,
  BOOL   fCreate
)</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> nsresult <span class="hljs-title">GetWindowsFolder</span><span class="hljs-params">(<span class="hljs-keyword">int</span> aFolder, nsIFile** aFile)</span> </span>{<font></font>
  WCHAR path_orig[MAX_PATH + <span class="hljs-number">3</span>];<font></font>
  WCHAR* path = path_orig + <span class="hljs-number">1</span>;<font></font>
  HRESULT result = SHGetSpecialFolderPathW(<span class="hljs-literal">nullptr</span>, path, aFolder, <span class="hljs-literal">true</span>);<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!SUCCEEDED(result)) {
    <span class="hljs-keyword">return</span> NS_ERROR_FAILURE;<font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinGIのSHGetSpecialFolderPathW</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
関数</font><font style="vertical-align: inherit;">は、</font><i><font style="vertical-align: inherit;">HRESULT</font></i><font style="vertical-align: inherit;">ではなく</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOOL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">型の値を返します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">関数の結果の確認は、正しいものに書き直す必要があります。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nsprpub</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nsprpubには、クロスプラットフォーム「C」ランタイムライブラリのCコードが含まれています。</font><font style="vertical-align: inherit;">「C」ランタイムライブラリには、メモリの割り当てと割り当て解除、日時の取得、ファイルの読み取りと書き込み、スレッドの処理、すべてのプラットフォームでの文字列の処理と比較を行うための基本的な非ビジュアルC関数が含まれています</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V647</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「int」型の値が割り当てられています「short」型のポインタへ。</font><font style="vertical-align: inherit;">割り当てを調べることを検討してください： 'out_flags = 0x2'。</font><font style="vertical-align: inherit;">prsocket.c 1220</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PR_POLL_WRITE   0x2</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">static</span> PRInt16 PR_CALLBACK <span class="hljs-title">SocketPoll</span><span class="hljs-params">(
    PRFileDesc *fd, PRInt16 in_flags, PRInt16 *out_flags)</span>
</span>{<font></font>
    *out_flags = <span class="hljs-number">0</span>;<font></font>
<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(_WIN64)</span>
    <span class="hljs-keyword">if</span> (in_flags &amp; PR_POLL_WRITE) {
        <span class="hljs-keyword">if</span> (fd-&gt;secret-&gt;alreadyConnected) {<font></font>
            out_flags = PR_POLL_WRITE;<font></font>
            <span class="hljs-keyword">return</span> PR_POLL_WRITE;<font></font>
        }<font></font>
    }<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    <span class="hljs-keyword">return</span> in_flags;<font></font>
}  <span class="hljs-comment">/* SocketPoll */</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アナライザは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">out_flags</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポインタへの数値定数の割り当てを検出しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ほとんどの場合、彼らは単に彼を逆参照するのを忘れていました：</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">if</span> (fd-&gt;secret-&gt;alreadyConnected) {<font></font>
  *out_flags = PR_POLL_WRITE;<font></font>
  <span class="hljs-keyword">return</span> PR_POLL_WRITE;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは終わりではありません。新しいコードレビューになります。 ThunderbirdとFirefoxのコードには、ネットワークセキュリティサービス（NSS）とWebRTC（Web Real Time Communications）の2つの主要なライブラリが含まれています。非常に興味深いエラーがいくつかありました。このレビューでは、1つずつ表示します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSS </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V597</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コンパイラーは、「newdeskey」バッファーをフラッシュするために使用される「memset」関数呼び出しを削除できます。 RtlSecureZeroMemory（）関数を使用して、プライベートデータを消去する必要があります。 pkcs11c.c 1033</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">static</span> CK_RV
<span class="hljs-title">sftk_CryptInit</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> newdeskey[<span class="hljs-number">24</span>];<font></font>
  ....<font></font>
  context-&gt;cipherInfo = DES_CreateContext(<font></font>
      useNewKey ? newdeskey : (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *)att-&gt;attrib.pValue,<font></font>
      (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> *)pMechanism-&gt;pParameter, t, isEncrypt);
  <span class="hljs-keyword">if</span> (useNewKey)
      <span class="hljs-built_in">memset</span>(newdeskey, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> newdeskey);<font></font>
  sftk_FreeAttribute(att);<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NSSは安全なクライアントおよびサーバーアプリケーションを開発するためのライブラリであり、ここではDESキーはクリーンアップされていません。コンパイラーは</font><font style="vertical-align: inherit;">、コードから</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出しを削除</font><font style="vertical-align: inherit;">します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newdeskey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、この場所以外のコードでは使用されなくなりました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebRTC </font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「state [state_length-x_length + i]」変数には、2回続けて値が割り当てられます。おそらくこれは間違いです。チェック行：83、84。filter_ar.c 84</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">WebRtcSpl_FilterAR</span><span class="hljs-params">(....)</span>
</span>{<font></font>
  ....<font></font>
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; state_length - x_length; i++)<font></font>
  {<font></font>
      state[i] = state[i + x_length];<font></font>
      state_low[i] = state_low[i + x_length];<font></font>
  }<font></font>
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; x_length; i++)<font></font>
  {<font></font>
      state[state_length - x_length + i] = filtered[i];<font></font>
      state[state_length - x_length + i] = filtered_low[i]; <span class="hljs-comment">// &lt;=</span><font></font>
  }<font></font>
  ....<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のサイクルでは、作成者がコードをコピーし、配列の名前を</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">から</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state_low</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に変更するのを忘れたため、データが誤った配列に書き込まれ</font><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのプロジェクトには、話してみ​​る価値のあるより興味深いバグがおそらくあります。</font><font style="vertical-align: inherit;">そして、近いうちにそれを行う予定です。</font><font style="vertical-align: inherit;">それまでの間、</font><font style="vertical-align: inherit;">プロジェクトで</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">試し</font><font style="vertical-align: inherit;">てください。</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a></p><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事を英語を話す視聴者と共有したい場合は、翻訳へのリンクを使用してください：Svyatoslav Razmyslov。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードアナライザーを実行する理由としてのサンダーバードの暗いテーマ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja469111/index.html">Objectをvarに置き換えます。何が問題になるのでしょうか。</a></li>
<li><a href="../ja469115/index.html">Discovery.jsガイド：クイックスタート</a></li>
<li><a href="../ja469117/index.html">2019年のBC 0010でのプログラミング</a></li>
<li><a href="../ja469119/index.html">RIPEのIPv4アドレスは終わりました。完全に...</a></li>
<li><a href="../ja469127/index.html">最適化、または自分を足で撃たない方法</a></li>
<li><a href="../ja469131/index.html">精霊</a></li>
<li><a href="../ja469133/index.html">Amazonがハードウェアイベント2019で導入したガジェット</a></li>
<li><a href="../ja469135/index.html">典型的なOOPの誤解</a></li>
<li><a href="../ja469137/index.html">脳はプライバシーの最後のフロンティアです</a></li>
<li><a href="../ja469139/index.html">自分でSEOを学ぶ：豊富な資料</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>