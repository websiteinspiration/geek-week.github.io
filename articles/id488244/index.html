<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐗 🛤️ 💿 Cara mengurangi overhead saat menangani pengecualian di C ++ 🏝️ 🖖🏻 👵</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Penanganan kesalahan runtime sangat penting dalam banyak situasi yang kami temui ketika mengembangkan perangkat lunak - dari input pengguna yang salah...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Cara mengurangi overhead saat menangani pengecualian di C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/488244/"><img src="https://habrastorage.org/webt/ml/92/sj/ml92sjlj3hq1paudqwokbods74m.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penanganan kesalahan runtime sangat penting dalam banyak situasi yang kami temui ketika mengembangkan perangkat lunak - dari input pengguna yang salah ke paket jaringan yang rusak. Aplikasi tidak boleh macet jika pengguna tiba-tiba mengunduh PNG dan bukan PDF, atau memutus kabel jaringan saat memperbarui perangkat lunak. Pengguna berharap bahwa program akan bekerja apa pun yang terjadi dan baik menangani situasi darurat di latar belakang atau menawarkannya untuk memilih opsi untuk menyelesaikan masalah melalui pesan yang dikirim melalui antarmuka yang ramah.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penanganan pengecualian dapat menjadi tugas yang membingungkan dan rumit, dan, yang secara fundamental penting bagi banyak pengembang C ++, dapat sangat memperlambat aplikasi. Tetapi, seperti dalam banyak kasus lain, ada beberapa cara untuk menyelesaikan masalah ini. Selanjutnya, kami akan mempelajari proses penanganan pengecualian di C ++, menangani perangkapnya dan melihat bagaimana hal ini dapat memengaruhi kecepatan aplikasi Anda. Selain itu, kami akan melihat alternatif yang dapat digunakan untuk mengurangi biaya overhead.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini, saya tidak akan mendesak Anda untuk berhenti menggunakan pengecualian sepenuhnya. </font><font style="vertical-align: inherit;">Mereka harus diterapkan, tetapi diterapkan tepat ketika tidak mungkin untuk menghindarinya: misalnya, bagaimana melaporkan kesalahan yang terjadi di dalam konstruktor? </font><font style="vertical-align: inherit;">Kami terutama akan mempertimbangkan untuk menggunakan pengecualian untuk menangani kesalahan runtime. </font><font style="vertical-align: inherit;">Menggunakan alternatif yang akan kita bicarakan akan memungkinkan Anda untuk mengembangkan aplikasi yang lebih andal dan mudah dirawat.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tes kinerja cepat</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berapa banyak pengecualian yang lebih lambat dalam C ++ dibandingkan dengan mekanisme biasa untuk mengendalikan kemajuan suatu program? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengecualian jelas lebih lambat daripada operasi break atau return yang sederhana. </font><font style="vertical-align: inherit;">Tapi mari kita cari tahu seberapa lambat! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam contoh di bawah ini, kami telah menulis fungsi sederhana yang secara acak menghasilkan angka dan, berdasarkan pemeriksaan satu nomor yang dihasilkan, memberi / tidak memberikan pesan kesalahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menguji beberapa opsi implementasi untuk penanganan kesalahan:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lempar pengecualian dengan argumen integer. </font><font style="vertical-align: inherit;">Meskipun ini tidak diterapkan secara khusus dalam praktiknya, ini adalah cara termudah untuk menggunakan pengecualian dalam C ++. </font><font style="vertical-align: inherit;">Jadi kami menyingkirkan kerumitan yang berlebihan dalam pelaksanaan pengujian kami.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buang std :: runtime_error, yang dapat mengirim pesan teks. </font><font style="vertical-align: inherit;">Opsi ini, tidak seperti yang sebelumnya, jauh lebih sering digunakan dalam proyek nyata. </font><font style="vertical-align: inherit;">Mari kita lihat apakah opsi kedua akan memberikan kenaikan nyata dalam biaya overhead dibandingkan dengan yang pertama.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengembalian kosong.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kembalikan kode kesalahan int style C</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk menjalankan tes, kami menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pustaka patokan Google</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sederhana </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dia berulang kali menjalankan setiap tes dalam satu siklus. </font><font style="vertical-align: inherit;">Selanjutnya, saya akan menjelaskan bagaimana semuanya terjadi. </font><font style="vertical-align: inherit;">Pembaca yang tidak sabar dapat langsung melompat ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode uji </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generator nomor acak super rumit kami:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> randomRange = <span class="hljs-number">2</span>;  <span class="hljs-comment">//     0  2.</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> errorInt = <span class="hljs-number">0</span>; 	<span class="hljs-comment">//    ,    0.</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRandom</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">return</span> random() % randomRange;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi tes:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 1.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithBasicException</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">throw</span> <span class="hljs-number">-2</span>;<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 2.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithMessageException</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"Halt! Who goes there?"</span>);<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 3.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exitWithReturn</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span>;<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 4.</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">exitWithErrorCode</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu dia, sekarang kita bisa menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perpustakaan benchmark Google</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 1.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithBasicException</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">try</span> {<font></font>
        	exitWithBasicException();<font></font>
    	} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">int</span> ex) {
        	<span class="hljs-comment">//  ,    .</span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 2.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithMessageException</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">try</span> {<font></font>
        	exitWithMessageException();<font></font>
    	} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::runtime_error &amp;ex) {
        	<span class="hljs-comment">//  ,    </span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 3.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithReturn</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {<font></font>
    	exitWithReturn();<font></font>
	}<font></font>
}<font></font>
<span class="hljs-comment">// 4.</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithErrorCode</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">auto</span> err = exitWithErrorCode();
    	<span class="hljs-keyword">if</span> (err &lt; <span class="hljs-number">0</span>) {
        	<span class="hljs-comment">// `handle_error()` …  - </span><font></font>
    	}<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span><font></font>
BENCHMARK(BM_exitWithBasicException);<font></font>
BENCHMARK(BM_exitWithMessageException);<font></font>
BENCHMARK(BM_exitWithReturn);<font></font>
BENCHMARK(BM_exitWithErrorCode);<font></font>
<font></font>
<span class="hljs-comment">//  !</span><font></font>
BENCHMARK_MAIN();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi mereka yang ingin menyentuh yang indah, kami telah memposting kode lengkap di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasil</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di konsol, kami melihat hasil tes yang berbeda, tergantung pada opsi kompilasi: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -O0:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithBasicException     1407 ns         1407 ns       491232<font></font>
BM_exitWithMessageException   1605 ns         1605 ns       431393<font></font>
BM_exitWithReturn              142 ns          142 ns      5172121<font></font>
BM_exitWithErrorCode           144 ns          143 ns      5069378<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rilis -O2:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithBasicException     1092 ns         1092 ns       630165<font></font>
BM_exitWithMessageException   1261 ns         1261 ns       547761<font></font>
BM_exitWithReturn             10.7 ns         10.7 ns     64519697<font></font>
BM_exitWithErrorCode          11.5 ns         11.5 ns     62180216<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(Diluncurkan pada 2015 MacBook Pro 2.5GHz i7) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hasilnya luar biasa! </font><font style="vertical-align: inherit;">Lihatlah celah besar antara kecepatan kode dengan dan tanpa pengecualian (return kosong dan errorCode). </font><font style="vertical-align: inherit;">Dan dengan optimisasi kompiler, celah ini bahkan lebih besar! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak diragukan lagi, ini adalah ujian yang bagus. </font><font style="vertical-align: inherit;">Kompiler mungkin melakukan sedikit optimasi kode untuk pengujian 3 dan 4, tetapi celahnya tetap besar. </font><font style="vertical-align: inherit;">Dengan demikian, ini memungkinkan kami untuk memperkirakan biaya overhead saat menggunakan pengecualian.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berkat model nol biaya, di sebagian besar implementasi blok percobaan di C ++, tidak ada overhead tambahan. </font><font style="vertical-align: inherit;">Tapi blok-catch bekerja jauh lebih lambat. </font><font style="vertical-align: inherit;">Dengan menggunakan contoh sederhana kami, kami dapat melihat seberapa lambat melempar dan menangkap pengecualian dapat bekerja. </font><font style="vertical-align: inherit;">Bahkan pada tumpukan panggilan kecil! </font><font style="vertical-align: inherit;">Dan dengan meningkatnya kedalaman tumpukan, overhead akan meningkat secara linear. </font><font style="vertical-align: inherit;">Itulah mengapa sangat penting untuk mencoba menangkap pengecualian sedekat mungkin dengan kode yang melemparkannya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menemukan bahwa pengecualian berfungsi lambat. </font><font style="vertical-align: inherit;">Maka mungkin menghentikannya? </font><font style="vertical-align: inherit;">Tapi tidak semuanya begitu sederhana.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa semua orang terus menggunakan pengecualian?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Manfaat pengecualian didokumentasikan dengan baik dalam </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laporan Teknis Kinerja C ++ (bab 5.4)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote>        ,      ,     errorCode- [  ],       .  ,                .          ,              .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekali lagi: ide utamanya adalah ketidakmampuan untuk mengabaikan dan melupakan pengecualian. Ini membuat pengecualian sebagai alat C ++ bawaan yang sangat kuat, yang mampu menggantikan pemrosesan yang sulit melalui kode kesalahan, yang kami warisi dari bahasa C. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain itu, pengecualian sangat berguna dalam situasi yang tidak terkait langsung dengan program, misalnya, "hard disk penuh "Atau" kabel jaringan rusak. " Dalam situasi seperti itu, pengecualian adalah ideal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi apa cara terbaik untuk menangani penanganan kesalahan yang terkait langsung dengan program? </font><font style="vertical-align: inherit;">Dalam kasus apa pun, kita memerlukan mekanisme yang secara jelas menunjukkan kepada pengembang bahwa dia harus memeriksa kesalahan, memberinya informasi yang cukup tentang hal itu (jika muncul), mentransmisikannya dalam bentuk pesan atau dalam format lain. </font><font style="vertical-align: inherit;">Tampaknya kita kembali ke pengecualian bawaan, tetapi barusan kita akan berbicara tentang solusi alternatif.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diharapkan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selain overhead, pengecualian memiliki kelemahan lain: mereka bekerja secara berurutan: pengecualian perlu ditangkap dan diproses segera setelah dilempar, tidak mungkin untuk menunda untuk nanti. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa boleh buat? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata ada jalan. Profesor Andrei Alexandrescu datang dengan kelas khusus untuk kami yang disebut Diharapkan. Ini memungkinkan Anda untuk membuat objek kelas T (jika semuanya berjalan baik) atau objek pengecualian kelas (jika terjadi kesalahan). Yaitu, ini atau itu. Atau atau. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intinya, ini adalah pembungkus atas struktur data, yang dalam C ++ disebut union. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena itu, kami menggambarkan idenya sebagai berikut:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>&gt;
<span class="hljs-title">class</span> <span class="hljs-title">Expected</span> {</span>
<span class="hljs-keyword">private</span>:
	<span class="hljs-comment">//  union:  ,   .     </span>
	<span class="hljs-keyword">union</span> {<font></font>
    	T value;<font></font>
    	Exception exception;<font></font>
	};<font></font>
<font></font>
<span class="hljs-keyword">public</span>:
	<span class="hljs-comment">//    `Expected`   T,   .</span>
	Expected(<span class="hljs-keyword">const</span> T&amp; value) ...<font></font>
<font></font>
	<span class="hljs-comment">//    `Expected`   Exception,  -   </span>
	Expected(<span class="hljs-keyword">const</span> Exception&amp; ex) ...<font></font>
<font></font>
	<span class="hljs-comment">//    :    </span>
	<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hasError</span><span class="hljs-params">()</span> ...

	<span class="hljs-comment">//   T</span>
	T <span class="hljs-title">value</span><span class="hljs-params">()</span> ...

	<span class="hljs-comment">//        (  Exception)</span>
	Exception <span class="hljs-title">error</span><span class="hljs-params">()</span> ...
}</span>;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Implementasi penuh tentu akan lebih sulit. </font><font style="vertical-align: inherit;">Tetapi ide utama Diharapkan adalah bahwa dalam objek yang sama (Diharapkan &amp; e) kita dapat menerima data untuk operasi reguler program (yang akan memiliki jenis dan format yang diketahui oleh kita: T &amp; nilai) dan data kesalahan ( Pengecualian &amp; ex). </font><font style="vertical-align: inherit;">Oleh karena itu, sangat mudah untuk memeriksa apa yang datang kepada kami sekali lagi (misalnya, menggunakan metode hasError). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun, sekarang tidak ada yang akan memaksa kita untuk menangani pengecualian saat ini juga. </font><font style="vertical-align: inherit;">Kami tidak akan memiliki lemparan () panggilan atau blok tangkapan. </font><font style="vertical-align: inherit;">Sebaliknya, kita dapat merujuk ke objek Pengecualian kami dengan nyaman.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tes Kinerja untuk yang Diharapkan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami akan menulis tes kinerja serupa untuk kelas baru kami:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// 5. Expected! Testcase 5 </span><font></font>
<font></font>
<span class="hljs-function">Expected&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">exitWithExpected</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (getRandom() == errorInt) {
    	<span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"Halt! If you want..."</span>);  <span class="hljs-comment">//  : return,   throw!</span><font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">// Benchmark.</span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BM_exitWithExpected</span><span class="hljs-params">(benchmark::State&amp; state)</span> </span>{
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> _ : state) {
    	<span class="hljs-keyword">auto</span> expected = exitWithExpected();<font></font>
<font></font>
    	<span class="hljs-keyword">if</span> (expected.hasError()){
        	<span class="hljs-comment">// Handle in our own time.</span><font></font>
    	}<font></font>
    	<span class="hljs-comment">// Or we can use the value...</span>
    	<span class="hljs-comment">// else {</span>
    	<span class="hljs-comment">// 	doSomethingInteresting(expected.value());</span>
    	<span class="hljs-comment">// }</span><font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-comment">//  </span><font></font>
BENCHMARK(BM_exitWithExpected);<font></font>
<font></font>
<span class="hljs-comment">// </span><font></font>
BENCHMARK_MAIN();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Drumroll !!! </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -O0:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithExpected            147 ns          147 ns      4685942<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rilis -O2:</font></font></b><br>
<br>
<pre><code class="bash hljs">------------------------------------------------------------------<font></font>
Benchmark                        Time             CPU   Iterations<font></font>
------------------------------------------------------------------<font></font>
BM_exitWithExpected           57.5 ns         57.5 ns     11873261<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak buruk! </font><font style="vertical-align: inherit;">Untuk std :: runtime_error kami tanpa optimisasi, kami dapat mengurangi waktu pengoperasian dari 1605 menjadi 147 nanodetik. </font><font style="vertical-align: inherit;">Dengan optimasi, semuanya terlihat lebih baik: penurunan dari 1261 menjadi 57,5 ​​nanodetik. </font><font style="vertical-align: inherit;">Ini lebih dari 10 kali lebih cepat daripada dengan -O0 dan lebih dari 20 kali lebih cepat daripada dengan -O2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi dibandingkan dengan pengecualian bawaan, Diharapkan bekerja jauh lebih cepat, dan juga memberi kita mekanisme penanganan kesalahan yang lebih fleksibel. </font><font style="vertical-align: inherit;">Selain itu, memiliki kemurnian semantik dan menghilangkan kebutuhan untuk mengorbankan pesan kesalahan dan menghilangkan umpan balik kualitas pengguna.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengecualian bukanlah kejahatan absolut. </font><font style="vertical-align: inherit;">Dan kadang-kadang itu bagus sama sekali, karena mereka bekerja sangat efektif untuk tujuan yang dimaksudkan: dalam keadaan luar biasa. </font><font style="vertical-align: inherit;">Kami hanya mulai menghadapi masalah ketika kami menggunakannya di mana solusi yang lebih efektif tersedia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengujian kami, meskipun faktanya cukup sederhana, menunjukkan: Anda dapat sangat mengurangi overhead jika Anda tidak menangkap pengecualian (blok tangkapan lambat) jika cukup mengirim data (menggunakan pengembalian).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam artikel ini, kami juga secara singkat memperkenalkan kelas yang diharapkan dan bagaimana kami dapat menggunakannya untuk mempercepat proses penanganan kesalahan. </font><font style="vertical-align: inherit;">Diharapkan memudahkan untuk melacak kemajuan program, dan juga memungkinkan kita untuk lebih fleksibel dan mengirim pesan kepada pengguna dan pengembang.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id488230/index.html">Pengantar SSD. Bagian 3. Form factor</a></li>
<li><a href="../id488232/index.html">sekitar teknologi: QATOK # 2</a></li>
<li><a href="../id488234/index.html">Menggunakan QubesOS untuk Windows 7</a></li>
<li><a href="../id488240/index.html">Sebuah siklus tanpa akhir yang bukan: kisah serangga Cawan Suci</a></li>
<li><a href="../id488242/index.html">VueJS + TS Integrasi Proyek dengan SonarQube</a></li>
<li><a href="../id488246/index.html">VoiceOver di iOS: setiap kontrol berperilaku berbeda</a></li>
<li><a href="../id488250/index.html">Untuk pertanyaan tentang Linux (L)</a></li>
<li><a href="../id488252/index.html">Cara mengurangi biaya pengembangan produk baru menggunakan SLS</a></li>
<li><a href="../id488254/index.html">Model Distribusi Tanggung Jawab Keamanan Cloud</a></li>
<li><a href="../id488256/index.html">Recuperator buatan sendiri untuk rumah pedesaan dengan efisiensi 80%</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>