<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🏭 🖨️ 👨‍👨‍👧 Die Wahrheit zuallererst oder warum das System basierend auf dem Datenbankgerät entworfen werden muss 🧗🏾 🍈 💈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 
 
 Wir beschäftigen uns weiterhin mit Java und Spring , auch auf Datenbankebene. Heute empfehlen wir zu lesen, warum beim Entwerfen große...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Die Wahrheit zuallererst oder warum das System basierend auf dem Datenbankgerät entworfen werden muss</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/498816/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir beschäftigen uns weiterhin mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , auch auf Datenbankebene. Heute empfehlen wir zu lesen, warum beim Entwerfen großer Anwendungen die Datenbankstruktur und nicht der Java-Code eine entscheidende Bedeutung dafür haben sollte, wie dies geschieht und welche Ausnahmen von dieser Regel bestehen.</font></font><br>
<a name="habracut"></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem eher verspäteten Artikel werde ich erklären, warum ich der Meinung bin, dass das Datenmodell in der Anwendung in fast allen Fällen "basierend auf der Datenbank" und nicht "basierend auf den Fähigkeiten von Java" (oder einer anderen Client-Sprache, mit der Sie arbeiten) entworfen werden sollte. </font><font style="vertical-align: inherit;">Wenn Sie sich für den zweiten Ansatz entscheiden, begeben Sie sich auf eine lange Reise voller Schmerzen und Leiden, sobald Ihr Projekt zu wachsen beginnt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Artikel basiert auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einer Frage</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Stapelüberlauf. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interessante Diskussionen zu reddit in den Abschnitten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ r / Programmierung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codegenerierung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie überrascht ich bin, dass es eine so kleine Anzahl von Benutzern gibt, die sich mit jOOQ vertraut gemacht haben und empört darüber sind, dass jOOQ bei der Arbeit ernsthaft auf die Generierung von Quellcode angewiesen ist. Niemand stört Sie daran, jOOQ nach Belieben zu verwenden, und zwingt Sie nicht zur Codegenerierung. Standardmäßig (wie im Handbuch beschrieben) geschieht die Arbeit mit jOOQ folgendermaßen: Sie beginnen mit dem (geerbten) Datenbankschema, entwickeln es mit dem jOOQ-Codegenerator zurück, sodass Sie eine Reihe von Klassen erhalten, die Ihre Tabellen darstellen, und dann Schreiben Sie typsichere Abfragen in diese Tabellen:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-keyword">for</span> (Record2&lt;String, String&gt; record : DSL.using(configuration)
<span class="hljs-comment">//   ^^^^^^^^^^^^^^^^^^^^^^^      </span>
<span class="hljs-comment">//     ,    </span>
<span class="hljs-comment">//   SELECT </span><font></font>
 <font></font>
       .select(ACTOR.FIRST_NAME, ACTOR.LAST_NAME)<font></font>
<span class="hljs-comment">//           vvvvv ^^^^^^^^^^^^  ^^^^^^^^^^^^^^^  </span><font></font>
       .from(ACTOR)<font></font>
       .orderBy(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) {
    <span class="hljs-comment">// ...</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code wird entweder manuell außerhalb der Baugruppe oder manuell mit jeder Baugruppe generiert. </font><font style="vertical-align: inherit;">Eine solche Regeneration kann beispielsweise unmittelbar nach der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration der Flyway-Datenbank erfolgen, was auch manuell oder automatisch erfolgen kann</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellcode-Generierung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit solchen Ansätzen zur manuellen und automatischen Codegenerierung sind verschiedene Philosophien, Vor- und Nachteile verbunden, auf die ich in diesem Artikel nicht näher eingehen werde. Im Allgemeinen besteht der springende Punkt des generierten Codes darin, dass wir in Java die „Wahrheit“ reproduzieren können, die wir für selbstverständlich halten, entweder innerhalb oder außerhalb unseres Systems. In gewisser Weise tun Compiler, die Bytecode, Maschinencode oder eine andere Art von Quellcode generieren, dasselbe - wir erhalten eine Darstellung unserer „Wahrheit“ in einer anderen Sprache, unabhängig von bestimmten Gründen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele solcher Codegeneratoren. Beispielsweise kann </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XJC Java-Code basierend auf XSD- oder WSDL-Dateien generieren</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Prinzip ist immer dasselbe:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt eine Wahrheit (intern oder extern) - zum Beispiel Spezifikation, Datenmodell usw.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir brauchen eine lokale Darstellung dieser Wahrheit in unserer Programmiersprache.</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus ist es fast immer ratsam, eine solche Darstellung zu erstellen, um Redundanz zu vermeiden.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Typanbieter und Anmerkungsverarbeitung</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hinweis: Ein anderer, modernerer und spezifischerer Ansatz zur Codegenerierung für jOOQ ist mit der Verwendung von Typanbietern </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Form verbunden, in der sie in F # implementiert sind</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">In diesem Fall wird der Code vom Compiler tatsächlich in der Kompilierungsphase generiert. </font><font style="vertical-align: inherit;">In Form von Quellen existiert ein solcher Code grundsätzlich nicht. </font><font style="vertical-align: inherit;">In Java gibt es ähnliche, wenn auch weniger elegante Tools - dies sind Anmerkungsprozessoren wie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lombok</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In gewissem Sinne passieren hier die gleichen Dinge wie im ersten Fall, mit Ausnahme von:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sehen den generierten Code nicht (vielleicht scheint diese Situation jemandem nicht so abstoßend zu sein?)</font></font></li>
<li>  ,    ,  , «»    .     Lombok,   “”.      ,        .</li>
</ul><br>
<h4>     ?</h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neben der kniffligen Frage, wie es besser ist, die Codegenerierung manuell oder automatisch zu starten, muss erwähnt werden, dass es Menschen gibt, die glauben, dass die Codegenerierung überhaupt nicht erforderlich ist. Der Grund für diesen Standpunkt, auf den ich am häufigsten gestoßen bin, ist, dass es dann schwierig ist, die Assembly-Pipeline zu konfigurieren. Ja, wirklich schwer. Es fallen zusätzliche Infrastrukturkosten an. Wenn Sie gerade erst mit einem bestimmten Produkt arbeiten (z. B. jOOQ, JAXB, Hibernate usw.), dauert es einige Zeit, bis Sie die Arbeitsumgebung eingerichtet haben, die Sie für das Erlernen der API selbst verwenden möchten, und dann den Wert daraus extrahieren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn die mit dem Verständnis des Generatorgeräts verbundenen Kosten zu hoch sind, hat die API tatsächlich ein wenig an der Benutzerfreundlichkeit des Codegenerators gearbeitet (und in Zukunft stellt sich heraus, dass die Benutzerkonfiguration darin kompliziert ist). Benutzerfreundlichkeit sollte für eine solche API die höchste Priorität haben. Dies ist jedoch nur ein Argument gegen die Codegenerierung. Im Übrigen ist es vollständig manuell, eine lokale Darstellung der internen oder externen Wahrheit zu schreiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Viele werden sagen, dass sie keine Zeit haben, dies alles zu tun. Sie haben Fristen für ihr Superprodukt. Einige Zeit später kämmen wir die Montageförderer, es wird rechtzeitig sein. Ich werde sie beantworten: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sd/ah/5v/sdah5v4nuslp0dylmjlrvcu0qfu.png"><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alan O'Rourke, Audience Stack </font></font></a> <br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber in Hibernate / JPA ist es so einfach, Code „für Java“ zu schreiben.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ja wirklich. </font><font style="vertical-align: inherit;">Für Hibernate und seine Benutzer ist dies sowohl ein Segen als auch ein Fluch. </font><font style="vertical-align: inherit;">In Hibernate können Sie einfach einige Entitäten wie folgt schreiben:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und fast alles ist fertig. </font><font style="vertical-align: inherit;">Das Ziel von Hibernate besteht nun darin, komplexe „Details“ zu generieren, wie genau diese Entität in der DDL Ihres SQL- „Dialekts“ definiert wird:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> book (
  <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span> PRIMARY <span class="hljs-keyword">KEY</span> <span class="hljs-keyword">GENERATED</span> <span class="hljs-keyword">ALWAYS</span> <span class="hljs-keyword">AS</span> <span class="hljs-keyword">IDENTITY</span>,<font></font>
  title <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),<font></font>
 <font></font>
  <span class="hljs-keyword">CONSTRAINT</span> pk_book PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">id</span>)<font></font>
);<font></font>
 <font></font>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> i_book_title <span class="hljs-keyword">ON</span> book (title);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... und wir starten die Anwendung. </font><font style="vertical-align: inherit;">Eine wirklich coole Gelegenheit, schnell loszulegen und verschiedene Dinge auszuprobieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erlauben Sie jedoch. </font><font style="vertical-align: inherit;">Ich habe getäuscht.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wendet der Ruhezustand wirklich die Definition dieses benannten Primärschlüssels an?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wird Hibernate einen Index in TITLE erstellen? </font><font style="vertical-align: inherit;">"Ich weiß sicher, dass wir ihn brauchen werden."</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Macht Hibernate diesen Schlüssel in der Identitätsspezifikation genau identifizierbar?</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wahrscheinlich nicht. </font><font style="vertical-align: inherit;">Wenn Sie Ihr Projekt von Grund auf neu entwickeln, ist es immer praktisch, einfach die alte Datenbank zu löschen und eine neue zu generieren, sobald Sie die erforderlichen Anmerkungen hinzufügen. </font><font style="vertical-align: inherit;">Die Buchentität wird also irgendwann die Form annehmen:</font></font><br>
<br>
<pre><code class="java hljs">	<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
  @Index(name = "i_book_title", columnList = "title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
  String title;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cool. </font><font style="vertical-align: inherit;">Regenerieren. </font><font style="vertical-align: inherit;">Auch in diesem Fall wird es zu Beginn sehr einfach sein.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber dann muss man dafür bezahlen</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Früher oder später muss man in Produktion gehen. In diesem Moment funktioniert ein solches Modell nicht mehr. Denn: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Produktion ist es bei Bedarf nicht mehr möglich, die alte Datenbank zu verwerfen und von vorne zu beginnen. Ihre Datenbank wird zu einer Legacy-Datenbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von nun an müssen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDL-Migrationsskripte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> schreiben </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">, beispielsweise mit Flyway</font></a><font style="vertical-align: inherit;"> . Und was passiert dann mit Ihren Entitäten? Sie können sie entweder manuell anpassen (und damit Ihre Arbeitslast verdoppeln) oder Hibernate anweisen, sie für Sie neu zu generieren (wie groß sind die Chancen, dass die auf diese Weise generierte Ihre Erwartungen erfüllt?). Sie verlieren trotzdem.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobald Sie in Produktion gehen, benötigen Sie daher Hot Patches. </font><font style="vertical-align: inherit;">Und sie müssen sehr schnell in Produktion gehen. </font><font style="vertical-align: inherit;">Da Sie keinen reibungslosen Ablauf Ihrer Migrationen für die Produktion vorbereitet und organisiert haben, patchen Sie alles wild. </font><font style="vertical-align: inherit;">Und dann haben Sie keine Zeit, alles richtig zu machen. </font><font style="vertical-align: inherit;">Und schimpfen Sie mit Hibernate, denn immer ist jemand schuld, aber nicht Sie ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stattdessen könnte von Anfang an alles auf eine ganz andere Art und Weise geschehen. </font><font style="vertical-align: inherit;">Stellen Sie beispielsweise runde Räder auf ein Fahrrad.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenbank zuerst</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wahre "Wahrheit" im Schema Ihrer Datenbank und die "Souveränität" darüber liegt in der Datenbank. </font><font style="vertical-align: inherit;">Das Schema wird nur in der Datenbank selbst und nirgendwo anders definiert, und jeder der Clients verfügt über eine Kopie dieses Schemas. Es ist daher ratsam, die Einhaltung des Schemas und seiner Integrität direkt in der Datenbank festzulegen - wo die Informationen gespeichert sind. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist sogar alte, abgenutzte Weisheit. </font><font style="vertical-align: inherit;">Primär- und eindeutige Schlüssel sind gut. </font><font style="vertical-align: inherit;">Fremdschlüssel sind gut. </font><font style="vertical-align: inherit;">Die Überprüfung auf Einschränkungen ist gut. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aussagen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind gut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Darüber hinaus ist dies nicht alles. </font><font style="vertical-align: inherit;">Wenn Sie beispielsweise Oracle verwenden, möchten Sie wahrscheinlich Folgendes angeben:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In welchem ​​Tablespace befindet sich Ihre Tabelle? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist der PCTFREE-Wert? </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie groß ist der Cache in Ihrer Sequenz (hinter dem Bezeichner)?</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht ist all dies in kleinen Systemen nicht wichtig, aber es ist nicht notwendig, auf den Übergang zum Bereich "Big Data" zu warten - es ist möglich und viel früher, von der Optimierung der Datenspeicherung durch den Lieferanten zu profitieren, wie oben erwähnt. </font><font style="vertical-align: inherit;">Keine der ORMs, die ich gesehen habe (einschließlich jOOQ), bietet Zugriff auf alle DDL-Optionen, die Sie möglicherweise in Ihrer Datenbank verwenden möchten. </font><font style="vertical-align: inherit;">ORMs bieten einige Tools, die beim Schreiben von DDL helfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ende wird eine gut gestaltete Schaltung manuell in DDL geschrieben. </font><font style="vertical-align: inherit;">Jede generierte DDL ist nur eine Annäherung daran.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist mit dem Kundenmodell?</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie oben erwähnt, benötigen Sie auf dem Client eine Kopie Ihres Datenbankschemas, die Client-Ansicht. Diese Client-Ansicht muss natürlich mit dem realen Modell synchronisiert werden. Was ist der beste Weg, um dies zu erreichen? Verwenden eines Codegenerators. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Datenbanken stellen ihre Metainformationen über SQL bereit. So rufen Sie alle Tabellen in verschiedenen SQL-Dialekten aus Ihrer Datenbank ab:</font></font><br>
<br>
<pre><code class="sql hljs">	<span class="hljs-comment">-- H2, HSQLDB, MySQL, PostgreSQL, SQL Server</span>
<span class="hljs-keyword">SELECT</span> table_schema, table_name
<span class="hljs-keyword">FROM</span> information_schema.tables<font></font>
 <font></font>
<span class="hljs-comment">-- DB2</span>
<span class="hljs-keyword">SELECT</span> tabschema, tabname
<span class="hljs-keyword">FROM</span> syscat.tables<font></font>
 <font></font>
<span class="hljs-comment">-- Oracle</span>
<span class="hljs-keyword">SELECT</span> owner, table_name
<span class="hljs-keyword">FROM</span> all_tables<font></font>
 <font></font>
<span class="hljs-comment">-- SQLite</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>
<span class="hljs-keyword">FROM</span> sqlite_master<font></font>
 <font></font>
<span class="hljs-comment">-- Teradata</span>
<span class="hljs-keyword">SELECT</span> databasename, tablename
<span class="hljs-keyword">FROM</span> dbc.tables
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diese Abfragen (oder ähnliche, je nachdem, ob Sie auch Darstellungen, materialisierte Darstellungen, Funktionen mit einem Tabellenwert berücksichtigen müssen) werden auch mithilfe eines Aufrufs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>DatabaseMetaData.getTables()</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von JDBC oder mithilfe des jOOQ-Metamoduls ausgeführt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus den Ergebnissen solcher Abfragen ist es relativ einfach, eine Client-Ansicht Ihres Datenbankmodells zu generieren, unabhängig davon, welche Technologie auf Ihrem Client verwendet wird.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie JDBC oder Spring verwenden, können Sie eine Reihe von Zeichenfolgenkonstanten erstellen </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie JPA verwenden, können Sie Entitäten selbst generieren </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie jOOQ verwenden, können Sie das jOOQ-Metamodell generieren</font></font></li>
</ul> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abhängig davon, wie viele Funktionen Ihre Client-API bietet (z. B. jOOQ oder JPA), kann das generierte Metamodell wirklich umfangreich und vollständig sein. </font><font style="vertical-align: inherit;">Nehmen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zum Beispiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Möglichkeit impliziter </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Verknüpfungen</font></a><font style="vertical-align: inherit;"> , die </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">in jOOQ 3.11 erschienen sind</font></a><font style="vertical-align: inherit;"> und auf den generierten Metainformationen über die Beziehungen von Fremdschlüsseln zwischen Ihren Tabellen beruhen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt führt jedes Inkrementieren der Datenbank automatisch zur Aktualisierung des Client-Codes. </font><font style="vertical-align: inherit;">Stellen Sie sich zum Beispiel vor:</font></font><br>
<br>
<pre><code class="sql hljs"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> book <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">COLUMN</span> title <span class="hljs-keyword">TO</span> book_title;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Möchten Sie diesen Job wirklich zweimal machen? </font><font style="vertical-align: inherit;">Auf keinen Fall. </font><font style="vertical-align: inherit;">Korrigieren Sie einfach die DDL, führen Sie sie durch Ihre Assembly-Pipeline und erhalten Sie die aktualisierte Entität:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "book", indexes = {
 
  //    ?
  @Index(name = "i_book_title", columnList = "book_title")
})</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>{
  <span class="hljs-meta">@Id</span>
  <span class="hljs-meta">@GeneratedValue(strategy = IDENTITY)</span>
  <span class="hljs-keyword">int</span> id;<font></font>
 <font></font>
  <span class="hljs-meta">@Column("book_title")</span><font></font>
  String bookTitle;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oder eine aktualisierte jOOQ-Klasse. </font><font style="vertical-align: inherit;">Die meisten DDL-Änderungen wirken sich auch auf die Semantik aus, nicht nur auf die Syntax. </font><font style="vertical-align: inherit;">Daher kann es praktisch sein, im kompilierten Code zu sehen, welcher Code vom Inkrement Ihrer Datenbank betroffen ist (oder sein kann).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die einzige Wahrheit</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unabhängig davon, welche Technologie Sie verwenden, gibt es immer ein Modell, das für ein Subsystem die einzige Wahrheitsquelle darstellt - oder zumindest sollten wir uns darum bemühen und solche Unternehmensverwirrungen vermeiden, bei denen die „Wahrheit“ überall und nirgendwo ist. </font><font style="vertical-align: inherit;">Alles kann viel einfacher sein. </font><font style="vertical-align: inherit;">Wenn Sie nur XML-Dateien mit einem anderen System austauschen, verwenden Sie einfach XSD. </font><font style="vertical-align: inherit;">Sehen Sie sich das Metamodell INFORMATION_SCHEMA von jOOQ in XML-Form an: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.jooq.org/xsd/jooq-meta-3.10.0.xsd</font></font></a><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSD ist gut verstanden</font></font></li>
<li>XSD     XML         </li>
<li>XSD        </li>
<li>XSD     Java   XJC</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der letzte Punkt ist wichtig. </font><font style="vertical-align: inherit;">Bei der Kommunikation mit einem externen System über XML-Nachrichten möchten wir die Gültigkeit unserer Nachrichten sicherstellen. </font><font style="vertical-align: inherit;">Dies ist mit JAXB, XJC und XSD sehr einfach zu erreichen. </font><font style="vertical-align: inherit;">Es wäre völlig verrückt zu erwarten, dass unsere Nachrichten, wenn wir uns dem Design von „Java first“ nähern, bei dem wir unsere Nachrichten in Form von Java-Objekten erstellen, irgendwie klar in XML angezeigt und zum Verbrauch an ein anderes System gesendet werden könnten. </font><font style="vertical-align: inherit;">Das auf diese Weise erzeugte XML wäre von sehr schlechter Qualität, nicht dokumentiert und schwer zu entwickeln. </font><font style="vertical-align: inherit;">Wenn es eine Vereinbarung über das Niveau der Servicequalität (SLA) für eine solche Schnittstelle gäbe, würden wir sie sofort ruinieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ehrlich gesagt, genau das passiert die ganze Zeit von der API bis zu JSON, aber das ist eine andere Geschichte, ich werde das nächste Mal schwören ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenbanken: es ist das gleiche</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie mit Datenbanken arbeiten, verstehen Sie, dass diese im Prinzip ähnlich sind. Die Basis besitzt ihre Daten und muss das Schema verwalten. Alle an der Schaltung vorgenommenen Änderungen müssen direkt in DDL implementiert werden, um eine einzelne Wahrheitsquelle zu aktualisieren. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn eine Quellaktualisierung stattgefunden hat, müssen alle Clients auch ihre Kopien des Modells aktualisieren. Einige Clients können mit jOOQ und Hibernate oder JDBC (oder alle gleichzeitig) in Java geschrieben werden. Andere Kunden können in Perl geschrieben werden (es bleibt ihnen viel Glück zu wünschen) und andere in C #. Das ist nicht wichtig. Das Hauptmodell befindet sich in der Datenbank. Mit ORMs generierte Modelle, die normalerweise von schlechter Qualität sind, sind schlecht dokumentiert und schwer zu entwickeln.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Machen Sie deshalb keine Fehler. </font><font style="vertical-align: inherit;">Machen Sie von Anfang an keine Fehler. </font><font style="vertical-align: inherit;">Arbeiten Sie aus einer Datenbank. </font><font style="vertical-align: inherit;">Erstellen Sie eine Bereitstellungspipeline, die automatisiert werden kann. </font><font style="vertical-align: inherit;">Aktivieren Sie Codegeneratoren, damit Sie Ihr Datenbankmodell bequem kopieren und auf Clients sichern können. </font><font style="vertical-align: inherit;">Und hör auf, dir Sorgen um Codegeneratoren zu machen. </font><font style="vertical-align: inherit;">Sie sind gut. </font><font style="vertical-align: inherit;">Mit ihnen werden Sie produktiver. </font><font style="vertical-align: inherit;">Sie müssen von Anfang an nur ein wenig Zeit aufwenden, um sie zu konfigurieren - und dann haben Sie jahrelange Produktivitätssteigerungen, die den Verlauf Ihres Projekts bestimmen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bis dahin danke.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erläuterung</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zur Verdeutlichung: Dieser Artikel befürwortet in keiner Weise, dass Sie unter dem Modell Ihrer Datenbank das gesamte System (d. H. Themenbereich, Geschäftslogik usw. usw.) biegen müssen. </font><font style="vertical-align: inherit;">In diesem Artikel sage ich, dass Client-Code, der mit der Datenbank interagiert, auf der Grundlage des Datenbankmodells handeln muss, damit das Datenbankmodell nicht im Status "First Class" reproduziert wird. </font><font style="vertical-align: inherit;">Diese Logik befindet sich normalerweise auf der Datenzugriffsebene Ihres Clients. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In zweistufigen Architekturen, die an einigen Stellen noch erhalten sind, kann ein solches Systemmodell das einzig mögliche sein. </font><font style="vertical-align: inherit;">In den meisten Systemen scheint mir die Ebene des Datenzugriffs jedoch ein "Subsystem" zu sein, das ein Datenbankmodell kapselt.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausnahmen</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt Ausnahmen zu jeder Regel, und ich habe bereits gesagt, dass ein Ansatz mit Datenbankprimat und Quellcodegenerierung manchmal unangemessen sein kann. </font><font style="vertical-align: inherit;">Hier sind einige Ausnahmen (es gibt wahrscheinlich andere):</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Stromkreis unbekannt ist und geöffnet werden muss. </font><font style="vertical-align: inherit;">Sie sind beispielsweise Anbieter eines Tools, mit dem Benutzer in jedem Schema navigieren können. </font><font style="vertical-align: inherit;">Puh </font><font style="vertical-align: inherit;">Es erfolgt keine Codegenerierung. </font><font style="vertical-align: inherit;">Aber trotzdem - die Datenbank ist vor allem.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn eine Schaltung im laufenden Betrieb generiert werden soll, um ein bestimmtes Problem zu lösen. </font><font style="vertical-align: inherit;">Dieses Beispiel scheint eine etwas phantasievolle Version des Wertmusters für </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entitätsattribute zu sein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , d. H. Sie haben wirklich kein genau definiertes Schema. </font><font style="vertical-align: inherit;">In diesem Fall ist es oft unmöglich, überhaupt sicher zu sein, dass ein RDBMS für Sie geeignet ist.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ausnahmen sind von Natur aus außergewöhnlich. </font><font style="vertical-align: inherit;">In den meisten Fällen, in denen ein RDBMS verwendet wird, ist das Schema im Voraus bekannt, es befindet sich innerhalb des RDBMS und ist die einzige Quelle für „Wahrheit“, und alle Kunden müssen Kopien erwerben, die von diesem abgeleitet sind. </font><font style="vertical-align: inherit;">Idealerweise müssen Sie einen Codegenerator verwenden.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de498796/index.html">Inhaltssicherheitsrichtlinie in Magento 2</a></li>
<li><a href="../de498798/index.html">Lernen Sie weiter und lernen Sie mit JetBrains</a></li>
<li><a href="../de498800/index.html">Wie ich meinem Computer beigebracht habe, Dobble mit OpenCV und Deep Learning zu spielen</a></li>
<li><a href="../de498808/index.html">Vim mit YAML-Unterstützung für Kubernetes</a></li>
<li><a href="../de498814/index.html">Sie haben eine theoretische Frage zur sozialen Sicherheit nicht beantwortet, und sie haben Ihnen ein Ende gesetzt. Es ist in Ordnung? // Wir sind zum Scheitern verurteilt # 3</a></li>
<li><a href="../de498820/index.html">Einige weitere knifflige Fragen zu .NET und C #</a></li>
<li><a href="../de498826/index.html">SIL und Salesforce</a></li>
<li><a href="../de498828/index.html">Wie Speisesalz und Proteine ​​das Überleben von Implantaten erhöhen</a></li>
<li><a href="../de498830/index.html">Hash + Cache: Optimierung der Stream-Verarbeitung</a></li>
<li><a href="../de498832/index.html">Überblick über die Möglichkeiten von Qt Creator 4.12 und QBS 1.16 zur Programmierung von Mikrocontrollern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>