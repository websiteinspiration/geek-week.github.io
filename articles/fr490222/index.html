<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👦🏽 🧙 👂🏼 Bibliothèque standard du jour de la mort 🕵🏿 👩🏻‍🏫 🐇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'autre jour à Prague, le comité de normalisation C ++ a mené une série d'enquêtes sur la question de la modification de l'ABI, et finalement il a été...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bibliothèque standard du jour de la mort</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490222/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'autre jour à Prague, le comité de normalisation C ++ a mené une série d'enquêtes sur la question de la modification de l'ABI, et finalement il a été décidé de ne rien y changer. </font><font style="vertical-align: inherit;">Il n'y eut pas d'applaudissements dans la salle. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense que nous n'avons pas pleinement réalisé les conséquences que cette décision entraînerait, et je ne pense pas qu'en principe, elle puisse affecter positivement le développement de la langue.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7a/j5/al/7aj5al5kxo5gjlw1lbrr0ftlemq.png"><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qu'est-ce que l'ABI?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ABI - un ensemble de conventions qui définissent comment votre programme est représenté sous forme binaire, comment les noms y sont déclarés, le balisage de classe est défini et les conventions d'appel de fonction sont définies. </font><font style="vertical-align: inherit;">En fait, c'est une sorte de protocole binaire, mais il n'est pas versionné. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin de ne pas vous confondre dans la terminologie, regardons des exemples de ce que le changement ABI implique et sa répartition dans le programme: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous ne pouvez pas utiliser le symbole exporté dans la nouvelle version de votre bibliothèque compilée si vous avez fait l'une des </font><font style="vertical-align: inherit;">choses </font><font style="vertical-align: inherit;">suivantes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout d'un nouveau champ à une classe existante</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modification des paramètres de modèle de la classe / fonction, transformation de la fonction de modèle en un non-modèle, ou vice versa, ajout d'un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modèle variadic</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appliquer le spécificateur en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ligne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> à quelque chose</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout de paramètres par défaut dans la déclaration de fonction</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Annonce d'une nouvelle méthode virtuelle</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et bien plus encore, mais les exemples ci-dessus sont les principaux mentionnés par le comité, et ceux-là mêmes, grâce auxquels la plupart des propositions de la norme sont détruites sur place. </font><font style="vertical-align: inherit;">J'ai omis les options de violation de l'ABI, pendant lesquelles le code source du programme se casse également (par exemple, suppression ou modification de fonctions). </font><font style="vertical-align: inherit;">Cependant, ce n'est pas toujours vrai. </font><font style="vertical-align: inherit;">Par exemple, la suppression d'une fonction n'implique pas toujours la rupture du code source. </font></font><code>std::string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il a un opérateur de conversion </font></font><code>std::string_view</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dont je me débarrasserais volontiers, et bien que le supprimer cassera l'ABI, cela ne conduira pas à des problèmes importants dans le code source.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi devrions-nous briser ABI</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, il y a plusieurs changements utiles dans l'implémentation de la bibliothèque standard que vous pouvez implémenter si vous cassez l'ABI actuel:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rendre les conteneurs associatifs (beaucoup) plus rapides</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accélérez votre travail </font></font><code>std::regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pour le moment, il est plus rapide d'exécuter PHP et de le rechercher avec une expression régulière que d'utiliser celle standard </font></font><code>std::regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques changements dans </font></font><code>std::string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>std::vector</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ainsi que dans la disposition des autres conteneurs</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unité de l'interface de classe: pour le moment, certaines de leurs implémentations ne correspondent pas intentionnellement à une seule interface pour des raisons de stabilité ABI</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plus important encore, il y a des changements dans la conception de la bibliothèque qui ne peuvent pas être effectués sans rencontrer le problème de sécurité ABI. </font><font style="vertical-align: inherit;">Voici une liste incomplète de tout ce qui n'est pas possible actuellement pour la raison mentionnée ci-dessus:</font></font><br>
<br>
<ul>
<li><code>std::scoped_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a été ajouté afin de ne pas casser le changement abi </font></font><code>lock_guard</code></li>
<li><code>int128_t</code>    ,    <code>intmax_t</code>. ,    ,    ,  <code>intmax_t</code>   <i>deprecated</i></li>
<li><code>std::unique_ptr</code>           ,     <i>zero-overhead</i>     </li>
<li>   <code>error_code</code>     - ,       ABI</li>
<li><code>status_code</code>     ABI</li>
<li>    <code>recursive_directory_iterator</code>  ,     ABI</li>
<li>      <code>&lt;cstring&gt;</code> <code>constexpr</code> ( <code>strlen</code>)     ,   ABI</li>
<li>  UTF-8  <code>std::regex</code> —  ABI</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'ajout de la prise en charge </font></font><code>realloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le retour de la taille de la mémoire allouée sont une ventilation ABI pour les allocateurs polymorphes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Création de destructeurs virtuels implicites pour les types polymorphes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le type de retour y </font></font><code>push_back</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut être modifié si l'ABI actuel est cassé</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En général, avons-nous vraiment besoin de et </font></font><code>push_back</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><code>emplace_back</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?</font></font></li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><code> std::shared_ptr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provoque également une panne ABI</font></font></li>
<li><code>[[no_unique_address]]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pourrait être sorti par le compilateur si nous ne nous soucions pas de sauvegarder l'ABI actuel</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et la liste ne s'arrête pas là. </font><font style="vertical-align: inherit;">Je pense que le WG21 devrait essayer de tenir à jour la liste de ces choses. </font><font style="vertical-align: inherit;">Mais je prendrai note de tous ceux qui disent «ça va casser l'ABI», étant avec moi dans la même pièce.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que voulons-nous changer d'autre?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne sais pas. </font><font style="vertical-align: inherit;">Et je ne sais pas ce que je ne sais pas. </font><font style="vertical-align: inherit;">Mais si on me demandait de deviner, je dirais ce qui suit:</font></font><br>
<br>
<ul>
<li>     C++23      ABI,    -        ,    ABI.          </li>
<li>   ,  ,          ,    ,          ABI</li>
<li>        ABI,       </li>
<li>    ,     ABI</li>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Tombstone</a>      ABI</li>
</ul><br>
<h2> ABI  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de la dernière discussion ABI, un certain nombre d'enquêtes ont été menées à Prague, qui, cependant, ne nous disent rien. </font><font style="vertical-align: inherit;">Selon que vous êtes pessimiste ou optimiste, les résultats actuels peuvent être interprétés différemment par vous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faits marquants:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21 ne veut pas casser ABI en 23</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21 estime nécessaire de casser l'ABI dans les futures versions de C ++ (C ++ 26 ou ultérieur)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le WG21 prendra du temps pour examiner les propositions qui violent l'ABI</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WG21 ne promet pas une stabilité éternelle</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le WG21 considère qu'il est important de maintenir la priorité sur les performances, même au détriment de la stabilité de la langue</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces déclarations contiennent de nombreux points importants, mais il n'y a pas de consensus. </font><font style="vertical-align: inherit;">Curieusement, le comité s'est divisé en deux.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyance</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans quelle version de C ++ attendre les changements</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'inconvénient évident de tous ces sondages est que nous n'avons pas décidé </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quand exactement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous voulons briser l'ABI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en c ++ 23? Non, certainement pas déjà. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
en C ++ 26? Certaines personnes ont l'intention de voter pour, mais une autre partie est susceptible de voter pour C ++ 41 ou pour le moment où ils prendront leur retraite et ils n'ont pas à soutenir leur projet actuel. L'une des questions vient de mentionner C ++ - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">certains</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; très confortablement!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il n'y a aucune raison de croire que si l'ABI ne peut pas être violé maintenant, il peut l'être plus tard. Les personnes qui ont besoin de stabilité ont plusieurs années de retard sur la norme. Donc, si nous ne le cassons pas maintenant, les gens continueront de compter sur l'ABI jamais promis, peut-être encore dix ou même vingt ans. Le simple fait que nous ayons mené cette enquête a finalement voté pour ne pas violer l'ABI, montre que l'ensemble de l'écosystème devient progressivement caillouteux et stagnant - chaque jour, le problème ne fait qu'empirer et potentiellement plus cher. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne pense pas que quelque chose va changer dans l'enquête menée dans trois ans. C’est comme le réchauffement climatique: tout le monde est d’accord qu’un jour nous devons nous attaquer à ce problème. Et puis interdisons le diesel en 2070?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout ce qui n'est pas prévu d'être fait au cours des cinq prochaines années ne se produira probablement jamais.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À propos des offres qui violent ABI</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le WG21 a voté pour consacrer plus de temps aux propositions qui violent l'ABI actuel. </font><font style="vertical-align: inherit;">Cela signifie plusieurs choses:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous allons perdre plus de temps dans l'une des salles les plus bruyantes du comité pour discuter de cette question et en laisser moins sur les propositions qui ont plus de chances d'être adoptées, et finalement nous les rejetterons tout de même</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous chercherons des alternatives qui ne cassent pas l'ABI (cela sera discuté ci-dessous)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des modifications partielles de l'ABI peuvent être introduites (voir également ci-dessous)</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les performances sont plus importantes que la stabilité ABI</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est comme demander si un enfant de cinq ans veut un bonbon. </font><font style="vertical-align: inherit;">Bien sûr, nous voterons sur l'importance de la performance. </font><font style="vertical-align: inherit;">Cependant, je crains que certaines personnes continuent de voter contre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il me semble que le comité veut en même temps s'asseoir sur deux chaises à la fois. </font><font style="vertical-align: inherit;">Et c'est impossible:</font></font><br>
<blockquote><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bryce Adelstein Lelbach</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> @blebach</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Performance</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Stabilité ABI</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Possibilité de changer quelque chose</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Choisissez deux options parmi celles proposées.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
la stabilité du langage et ABI, bien sûr, entrent en collision, nous obligeant à poser une question aussi fondamentale - Qu'est-ce que C ++ et quelle est sa bibliothèque standard? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Habituellement, dans ce cas, les termes «performance», « </font><font style="vertical-align: inherit;">abstraction à </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coût nul</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> », « </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne payez pas pour ce que vous n'utilisez pas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> » sont </font><font style="vertical-align: inherit;">mémorisés </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Et la stabilité d'ABI se situe à travers tout cela.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des conséquences d'une portée considérable</font></font></h2><br>
<img src="https://habrastorage.org/getpro/habr/post_images/5d7/90b/d50/5d790bd50abd97b45921c4f61a8ef757.webp" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je suis profondément convaincu que la décision de ne pas casser l'ABI au cours de la 23e année est la plus grosse erreur que le comité ait jamais commise. </font><font style="vertical-align: inherit;">Et je sais que certaines personnes croient le contraire. </font><font style="vertical-align: inherit;">Mais voici ce qui risque de se produire bientôt:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cauchemar d'apprentissage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soyons honnêtes. Tous les programmes qui reposent sur ABI sont susceptibles de violer les principes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ODR</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quelque part </font><font style="vertical-align: inherit;">ou d'utiliser des indicateurs incompatibles, qui, heureusement, fonctionnent toujours. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les nouveaux programmes doivent être compilés à partir du code source, nous avons besoin d'outils construits sur l'assemblage à partir des sources, et non d'une collection de bibliothèques que nous avons obtenues quelque part et insérées d'une manière ou d'une autre dans le projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, la construction à partir des sources est quelque chose qui n'est pas si facile à réaliser. Mais nous devons encourager cette approche du produit, mettre à jour régulièrement les compilateurs afin que les utilisateurs bénéficient des fonctionnalités nouvellement introduites un mois après la sortie, et pas dix ans plus tard. Des solutions appropriées, fiables, évolutives et reproductibles, des bibliothèques open source et un système de dépendance doivent être encouragés.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Refusant de violer ABI, le comité déclare ouvertement qu'il soutiendra des programmes mal écrits tout au long de leur existence. </font><font style="vertical-align: inherit;">Même si vous ne liez pas aux bibliothèques obtenues via apt-install (qui sont en fait destinées au système), il y aura d'autres personnes, car le comité leur a donné leur bénédiction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est un énorme pas en arrière. </font><font style="vertical-align: inherit;">Comment pouvons-nous enseigner aux autres de bonnes pratiques linguistiques si nous ne sommes pas incités à le faire?</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perte d'intérêt pour la bibliothèque standard</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La perte estimée des performances de la bibliothèque due à notre réticence à violer ABI est estimée à 5-10%. </font><font style="vertical-align: inherit;">Ce nombre ne fera qu'augmenter avec le temps. </font><font style="vertical-align: inherit;">Regardons des exemples:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous êtes une grande entreprise, vous pouvez vous acheter un nouveau centre de données ou payer une équipe de programmeurs qui prendraient en charge leur propre bibliothèque</font></font></li>
<li>    ,   5%              ,     </li>
<li>   ,   5-10%  ,               VR-</li>
<li>   ,        —     </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je pense qu'ici, bon gré mal gré, la question se pose entre: «Je devrais certainement utiliser C ++ et sa bibliothèque standard!» et "Peut-être que je ne devrais pas utiliser la bibliothèque standard? Ou peut-être que je ne devrais pas utiliser C ++ en principe? Peut-être que .NET, julia ou Rust seraient une meilleure solution? " Bien sûr, de nombreux facteurs influencent la réponse, mais nous voyons ce qui se passe récemment. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De nombreux développeurs de jeux sont extrêmement sceptiques quant à la bibliothèque standard. Ils préfèrent développer leur propre alternative, comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EASTL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">plutôt</font></a><font style="vertical-align: inherit;"> que de profiter de STL. Facebook a de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">folie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , Google a du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rappel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ainsi de suite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est comme une boule de neige. </font><font style="vertical-align: inherit;">Si les gens n'utilisent pas la bibliothèque standard, ils n'ont aucun intérêt à l'améliorer. </font><font style="vertical-align: inherit;">La performance est le facteur clé qui maintient la bibliothèque à flot. </font><font style="vertical-align: inherit;">Sans garantie de performance, beaucoup moins d'efforts seront consacrés à son développement.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://twitter.com/foonathan" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jonathan Müller</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> @foonathan </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quel est l'intérêt d'utiliser des conteneurs de la bibliothèque standard s'ils n'offrent pas de meilleures performances? </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Titus Winters</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> @TitusWinters </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peut-être parce qu'ils sont communs et facilement accessibles? </font><font style="vertical-align: inherit;">(ces deux faits ne signifient pas la même chose). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voter pour préserver ABI revient à dire que la bibliothèque standard devrait s'efforcer d'être McDonald's - elle est également partout, elle est stable et résout techniquement les tâches.</font></font><br>
</blockquote> <h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment un comité peut-il considérer les propositions de rupture d'un ABI?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Plusieurs options sont proposées pour soulager la douleur causée par l'incapacité d'accepter les offres si elles violent l'ABI:</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajout de nouveaux noms</font></font></h3><br>
<img src="https://habrastorage.org/getpro/habr/post_images/9db/f42/6f8/9dbf426f89a37d487fb3b446edebc89d.webp" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est la première et évidente solution. Si nous ne pouvons pas changer </font></font><code>std::unordered_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pouvons-nous simplement ajouter </font></font><code>std::fast_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Il y a plusieurs raisons pour lesquelles c'est mauvais. L'ajout de types à la bibliothèque standard coûte cher, à la fois en termes de coûts de support et en termes d'éducation. Après l'introduction de la nouvelle classe, des milliers d'articles apparaîtront inévitablement, expliquant quel conteneur doit être utilisé. Par exemple, dois-je utiliser </font></font><code>std::scoped_lock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>std::lock_guard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Je n'ai aucune idée! J'ai besoin de google à chaque fois. Il y a aussi le problème que les bons noms finissent tôt ou tard. Nous obtenons également une surcharge lors de l'exécution du programme, car tous les conteneurs doivent être constamment convertis les uns aux autres, il devient difficile de contrôler un grand nombre de surcharges de conversion dans la classe, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ironique, mais les personnes qui soutiennent la solution ci-dessus peuvent également affirmer que C ++ est un langage trop complexe. </font><font style="vertical-align: inherit;">L'ajout de doublons à la bibliothèque ne facilitera certainement pas la tâche.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais nous pourrions accepter cette offre comme standard!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certains développeurs de bibliothèques affirment que leurs offres ont été rejetées en raison d'une violation d'ABI, bien qu'elles n'aient en fait rien violé, ou qu'elles pourraient être modifiées afin de contourner l'échec d'ABI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que personne cynique, c'est un peu difficile pour moi de croire. </font><font style="vertical-align: inherit;">Le fait est qu'avant il n'y avait pas de telles propositions, et les scénarios dans lesquels elles peuvent être appliquées sont très limités. </font><font style="vertical-align: inherit;">ABI Review Group (ARG) pourrait vous aider dans cette affaire, mais ils recommanderont probablement un autre nom pour la classe / fonction.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Violation partielle d'Abi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'idée principale n'est pas de casser l'intégralité de l'ABI, mais de le changer uniquement pour une classe ou une fonction spécifique. </font><font style="vertical-align: inherit;">Le problème avec cette approche est qu'au lieu d'une erreur au stade de la liaison, nous verrons le problème déjà lors du lancement du programme, et il sera désagréable de nous surprendre. </font><font style="vertical-align: inherit;">Le comité avait déjà essayé cette approche en C ++ 11 lorsqu'il a modifié le balisage </font></font><code>std::string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Rien de bon n'en est sorti. </font><font style="vertical-align: inherit;">Tout était si mauvais que ce fait est toujours utilisé comme argument en faveur du maintien de l'ABI actuel.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre niveau d'indexation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La solution à certains des problèmes avec ABI serait la possibilité d'accéder aux données de la classe via un pointeur, puis le balisage de la classe ne serait que ce pointeur. L'idée est très proche de l'idiome </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIMPL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui est activement utilisé dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qt en</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> raison de son ABI. Oui, cela résoudrait le problème avec les membres de la classe, mais que faire des méthodes virtuelles? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérant le problème d'un point de vue plus critique, nous parlons d'ajouter un niveau d'indirection supplémentaire (index de pointeur) et une allocation supplémentaire de mémoire dans le tas pour tout ce qui est inclus dans le cadre d'ABI. En STL, en fait, tout est enfermé dans ce cadre car il s'agit d'une collection de classes généralisées. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, le prix de cette approche sera énorme.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour résoudre ce problème, la norme contient déjà plusieurs propositions. </font><font style="vertical-align: inherit;">Certains d'entre eux veulent faire de PIMPL l'une des fonctionnalités du langage, vous pouvez donc choisir entre stabilité ABI et hautes performances. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ironiquement, cependant, mais pour transformer les types de bibliothèques en types PIPML, nous devons ... casser l'ABI.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réassemblez tout le code tous les trois ans</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juste mes pensées à voix haute.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les offres actuelles de la norme doivent être détruites</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paradoxalement, le C ++ n'a jamais été aussi vivant qu'aujourd'hui. </font><font style="vertical-align: inherit;">À Prague, 250 personnes ont travaillé sur beaucoup de choses pour lui, notamment:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Numérique</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algèbre linéaire</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'audio</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unicode</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E / S asynchrones</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphiques 2D et 3D</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De nombreuses autres fonctionnalités</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes ces propositions sont unies par un fait commun - elles sont beaucoup plus facultatives par rapport à ce que nous avons actuellement dans la norme. Les gens essaient simplement de standardiser les choses de leur domaine de recherche et de travail, ou de ce qui évolue et change constamment. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En particulier, les algorithmes Unicode sont extrêmement instables et changent rapidement au fil du temps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis, une horreur telle que le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">réseautage se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> profile à l'horizon </font><font style="vertical-align: inherit;">. Il est très, très irresponsable d'essayer de standardiser tout ce qui pourrait entraîner des problèmes de sécurité, et en même temps de ne pas pouvoir le changer plus tard (rappelez-vous d'ABI).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puisque C ++ a décidé de le rendre stable, toutes ces suggestions doivent être détruites et brûlées. Je ne voudrais pas être détruit, mais cela doit être fait. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ils ne le feront toujours pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le meilleur des cas, nous ne commettrons pas d'erreurs et ne normaliserons pas l'état actuel des choses dans l'une des nouvelles versions de C ++, puis nous laisserons tout se décomposer lentement, car il ne sera pas possible de le réparer (dans le cas de Networking TS, nous semblons ne pouvoir rien changer du tout, donc nous devrons standardiser ce qui existait il y a dix ans, alors bien sûr la bibliothèque peut encore être considérablement améliorée, mais laissons cette histoire pour une autre fois). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais bien sûr, nous ferons beaucoup, beaucoup d’erreurs.</font></font><br>
<br>
<blockquote>&gt;&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b>Ólafur Waage</b></a> @olafurw<br>
(      ,    )<br>
<br>
 ,  !<br>
<br>
         .       ,      ( : , , )?<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><b>Hyrum Wright</b></a> @hyrumwright<br>
    ,    ,  .       —    ,      .<br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines erreurs sont commises intentionnellement, car ce sont des compromis, tandis que d'autres passent inaperçues pendant de nombreuses années. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le temps passe, mais la bibliothèque standard reste immobile. Les compromis précédemment effectués commencent progressivement à nous déranger et deviennent plus tard de véritables «goulots d'étranglement» dans le code existant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certaines choses sont vraiment impossibles à changer, car elles sont intégrées dans l'API. Nous avons tous une idée de la difficulté de changer une API existante. Mais une partie du code peut toujours être corrigée et améliorée si nous pouvions casser l'ABI. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le C ++ sera toujours à flot au cours des 40 prochaines années. Si nous ne pouvons pas réaliser le besoin de le changer de manière imprévisible à tout moment, alors le seul bon choix sera de ne pas jouer à ce jeu en principe.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout le monde sait qu'un conteneur associatif standard est pertinent pour une utilisation depuis moins de dix ans. </font><font style="vertical-align: inherit;">Mais pourquoi pensons-nous alors que les propositions plus importantes de la norme seront plus efficaces? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Votre offre au standard </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> détruite, la mienne sera détruite de la même manière.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un comité peut-il en principe casser un ABI?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup sont sûrs que le comité ne peut pas, en principe, prendre une telle décision, car alors les développeurs de bibliothèque l'ignoreront simplement. </font><font style="vertical-align: inherit;">Tout cela ressemble douloureusement à la lutte à bras, dans laquelle le comité a décidé de ne pas jouer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le fait est que les développeurs de tout produit ont leurs propres utilisateurs. </font><font style="vertical-align: inherit;">Les utilisateurs sont ceux qui doivent avant tout comprendre les compromis qui leur sont imposés. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beaucoup de gens comptent sur ABI par accident, sans faire de choix éclairé. </font><font style="vertical-align: inherit;">Beaucoup de gens comptent également sur la stabilité, car, bien sûr, tout le monde veut y compter. </font><font style="vertical-align: inherit;">Mais comme toute autre chose, la stabilité a un prix, et maintenant tout l'écosystème C ++ en paie.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr490198/index.html">Faites confiance mais vérifiez! Zone de démonstration avec projecteurs Epson pour home cinéma dans la salle de démonstration Pult.ru</a></li>
<li><a href="../fr490202/index.html">Comptage de requêtes: test de base des performances Django</a></li>
<li><a href="../fr490204/index.html">Le condensé des événements pour les recruteurs RH et IT en mars 2020</a></li>
<li><a href="../fr490208/index.html">Section backend sur DUMP2020: badinage, ventilateur, échec</a></li>
<li><a href="../fr490210/index.html">Accélérer le frontend. Quand beaucoup de demandes de serveur sont bonnes</a></li>
<li><a href="../fr490224/index.html">Furtivité à la mode</a></li>
<li><a href="../fr490226/index.html">Blending et Unity Terrain: comment se débarrasser des intersections et arrêter de se faire mal aux yeux</a></li>
<li><a href="../fr490242/index.html">Service de localisation GSM des modules SIM800x et son travail avec l'API Yandex.Locator</a></li>
<li><a href="../fr490244/index.html">Optimisation de code Python avec ctypes</a></li>
<li><a href="../fr490246/index.html">Kremlin Towers in Hydra's Embrace: Conférence sur l'informatique parallèle et distribuée Hydra 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>