<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåµ üî∑ ‚è¨ Profundidad de la madriguera del conejo o entrevista de C ++ en PVS-Studio ü§∞üèº üëéüèæ ‚ö±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Autores: Andrey Karpov, khandeliantsPhilip Handelyants. 
 
 Me gustar√≠a compartir una situaci√≥n interesante cuando la pregunta que utilizamos en la en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Profundidad de la madriguera del conejo o entrevista de C ++ en PVS-Studio</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/495570/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c8/090/606/9c80906065d1212a18f358f97ebbd11f.png" alt="Entrevista en C ++ en PVS-Studio"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autores: Andrey Karpov, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">khandeliants</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Philip Handelyants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me gustar√≠a compartir una situaci√≥n interesante cuando la pregunta que utilizamos en la entrevista result√≥ ser m√°s complicada de lo que pretend√≠a su autor. </font><font style="vertical-align: inherit;">Con el lenguaje y los compiladores de C ++, siempre debe estar atento. </font><font style="vertical-align: inherit;">No te aburras.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como en cualquier otra compa√±√≠a de programaci√≥n, tenemos una serie de preguntas para entrevistar para vacantes de desarrolladores en C ++, C # y Java. Tenemos muchas preguntas con doble o triple fondo. Para preguntas sobre C # y Java, no podemos decir con certeza, ya que tienen otros autores. Pero muchas de las preguntas compiladas por Andrei Karpov para entrevistas en C ++ fueron concebidas de inmediato para investigar la profundidad del conocimiento de las caracter√≠sticas del lenguaje. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estas preguntas pueden recibir una respuesta simple y correcta. Puedes ir m√°s y m√°s profundo. Dependiendo de esto, durante la entrevista, determinamos cu√°nto est√° familiarizada una persona con los matices del lenguaje. Esto es importante para nosotros, ya que estamos desarrollando un analizador de c√≥digo y deber√≠amos entender muy bien las sutilezas y los "chistes" del lenguaje.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy contaremos una breve historia sobre c√≥mo una de las primeras preguntas formuladas en la entrevista result√≥ ser a√∫n m√°s profunda de lo que planeamos. Entonces, mostramos este c√≥digo:</font></font><br>
<br>
<pre><code class="cpp">void F1()<font></font>
{<font></font>
  int i = 1;<font></font>
  printf("%d, %d\n", i++, i++);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
y pregunte: "¬øQu√© se imprimir√°?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Buena pregunta. Inmediatamente puedo decir mucho sobre el conocimiento. No se considerar√°n los casos en que una persona no pueda responderle. Estos se eliminan mediante pruebas preliminares en el sitio web de HeadHunter (hh.ru). Aunque, no, son una mierda. En nuestra memoria, hab√≠a un par de personalidades √∫nicas que respondieron algo en el esp√≠ritu: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este c√≥digo imprimir√° al principio un porcentaje, luego d, luego otro porcentaje, d, luego una varita m√°gica, ny luego dos unidades.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Claramente, en tales casos, la entrevista termina r√°pidamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ahora de vuelta a la entrevista normal :). A menudo responden as√≠: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se imprimir√°n 1 y 2.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Esta es la respuesta del nivel interno. S√≠, tales valores pueden, por supuesto, imprimirse, pero estamos esperando </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aproximadamente la</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siguiente respuesta:</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto no quiere decir qu√© </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">imprimir√° </font></i></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exactamente</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> este c√≥digo. Este es un comportamiento no especificado (o indefinido). El orden en que se calculan los argumentos no est√° definido. Todos los argumentos deben evaluarse antes de ejecutar el cuerpo de la funci√≥n llamada, pero el orden en que esto suceder√° queda a discreci√≥n del compilador. Por lo tanto, el c√≥digo puede muy bien imprimir "1, 2" y viceversa "2, 1". En general, escribir dicho c√≥digo es </font></font></i><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">altamente</font></font></i></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indeseable, si va a ser construido por al menos dos compiladores, es posible "disparar en el pie". Y muchos compiladores dar√°n una advertencia aqu√≠.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De hecho, si usa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede obtener "1, 2". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y si usa </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GCC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puede obtener "2, 1".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ârase una vez que probamos el compilador MSVC, y tambi√©n produjo "2, 1". No hay signos de problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, para un prop√≥sito general de terceros, nuevamente fue necesario compilar este c√≥digo usando Visual C ++ moderno y ejecutarlo. Montado en la configuraci√≥n de lanzamiento con </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ O2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> optimizaci√≥n habilitada </font><font style="vertical-align: inherit;">. Y, como dicen, encontraron la aventura en su propia cabeza :). ¬øQu√© crees que pas√≥? ¬°Decir ah! Esto es lo que: "1, 1". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ que piensa lo que quieras. Resulta que la pregunta es a√∫n m√°s profunda y m√°s confusa. Nosotros mismos no esper√°bamos que esto sucediera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como el est√°ndar C ++ no regula el c√°lculo de argumentos de ninguna manera, el compilador interpreta este tipo de comportamiento no especificado de una manera muy peculiar. </font><font style="vertical-align: inherit;">Echemos un vistazo al c√≥digo de ensamblador generado por el compilador MSVC 19.25 (Microsoft Visual Studio Community 2019, Versi√≥n 16.5.1), la versi√≥n distintiva del est√°ndar de idioma es '/ std: c ++ 14':</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e42/26e/b7c/e4226eb7c1a4ab93f734807976c269bc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formalmente, el optimizador convirti√≥ el c√≥digo anterior en lo siguiente:</font></font><br>
<br>
<pre><code class="cpp">void F1()<font></font>
{<font></font>
  int i = 1;<font></font>
  int tmp = i;<font></font>
  i += 2;<font></font>
  printf("%d, %d\n", tmp, tmp);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el punto de vista del compilador, dicha optimizaci√≥n no cambia el comportamiento observado del programa. </font><font style="vertical-align: inherit;">Mirando esto, comienzas a entender que, por una buena raz√≥n, el est√°ndar C ++ 11, adem√°s de los punteros inteligentes, tambi√©n agreg√≥ la funci√≥n "m√°gica" </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make_shared</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (y C ++ 14 tambi√©n agreg√≥ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make_unique</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Un ejemplo tan inofensivo, y tambi√©n puede "romper le√±a":</font></font><br>
<br>
<pre><code class="cpp">void foo(std::unique_ptr&lt;int&gt;, std::unique_ptr&lt;double&gt;);<font></font>
<font></font>
int main()<font></font>
{<font></font>
  foo(std::unique_ptr&lt;int&gt; { new int { 0 } },<font></font>
      std::unique_ptr&lt;double&gt; { new double { 0.0 } });<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un compilador astuto puede convertir esto en el siguiente orden de c√°lculos (el mismo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSVC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , por ejemplo):</font></font><br>
<br>
<pre><code class="cpp">new int { .... };<font></font>
new double { .... };<font></font>
std::unique_ptr&lt;int&gt;::unique_ptr<font></font>
std::unique_ptr&lt;double&gt;::unique_ptr<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si la segunda llamada al </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuevo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operador </font><font style="vertical-align: inherit;">arroja una excepci√≥n, entonces tenemos una p√©rdida de memoria. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero volviendo al tema original. </font><font style="vertical-align: inherit;">A pesar de que todo estaba bien desde el punto de vista del compilador, todav√≠a est√°bamos seguros de que el resultado "1, 1" se consideraba incorrectamente el comportamiento esperado por el desarrollador. </font><font style="vertical-align: inherit;">Y luego intentamos compilar el c√≥digo fuente con el compilador MSVC con el indicador de versi√≥n est√°ndar '/ std: c ++ 17'. </font><font style="vertical-align: inherit;">Y todo comienza a funcionar como se esperaba, y se imprime "2, 1". </font><font style="vertical-align: inherit;">Echa un vistazo al c√≥digo del ensamblador:</font></font><br>
<br>
<p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f44/a37/a88/f44a37a8836d786f6dda5b11b165b944.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo es justo, el compilador pas√≥ los valores 2 y 1. Como argumentos, pero ¬øpor qu√© ha cambiado todo tan dram√°ticamente? Resulta que lo siguiente se agreg√≥ al est√°ndar C ++ 17: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la expresi√≥n postfix se secuencia antes de cada expresi√≥n en la lista de expresiones y cualquier argumento predeterminado. La inicializaci√≥n de un par√°metro, que incluye cada c√°lculo de valor asociado y efecto secundario, se secuencia indeterminadamente con respecto a cualquier otro par√°metro.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
El compilador todav√≠a tiene derecho a calcular argumentos en un orden arbitrario, pero ahora, a partir del est√°ndar C ++ 17, tiene derecho a comenzar a calcular el siguiente argumento y sus efectos secundarios solo desde el momento en que se completan todos los c√°lculos y efectos secundarios del argumento anterior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, si se compila el mismo ejemplo con punteros inteligentes con el 'std / C ++ 17' bandera, entonces todo se vuelve </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buena</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> all√≠ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tambi√©n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - usando </font><i><font style="vertical-align: inherit;">std :: make_unique es</font></i><font style="vertical-align: inherit;"> ahora opcional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay otra medida de profundidad en la pregunta que result√≥. Hay una teor√≠a, pero hay pr√°ctica en la forma de un compilador espec√≠fico o una interpretaci√≥n diferente del est√°ndar :). El mundo de C ++ siempre es m√°s complejo e inesperado de lo que parece. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si alguien puede explicar con mayor precisi√≥n lo que est√° sucediendo, d√≠ganos en los comentarios. ¬°Finalmente debemos entender la pregunta para al menos conocer la respuesta en la entrevista! :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay una historia tan informativa. </font><font style="vertical-align: inherit;">Esperamos que haya sido interesante, y usted comparte su opini√≥n sobre este tema. </font><font style="vertical-align: inherit;">Y recomendamos utilizar el est√°ndar de lenguaje m√°s moderno tanto como sea posible, para no sorprenderse de que los compiladores de optimizaci√≥n actuales puedan hacerlo. </font><font style="vertical-align: inherit;">Mejor a√∫n, no escriba este c√≥digo en absoluto :). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PD: Podemos decir que "encendimos la pregunta", y ahora habr√° que eliminarla del cuestionario. </font><font style="vertical-align: inherit;">No vemos el punto en esto. </font><font style="vertical-align: inherit;">Si una persona no es demasiado perezosa para estudiar nuestras publicaciones antes de una entrevista, lee este material y luego lo usa, entonces est√° bien hecho y con m√©rito recibir√° un signo m√°s :).</font></font><br>
<br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a></p><div style="text-align:center;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png"></a></div><p></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: Andrey Karpov, Phillip Khandeliants. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cu√°n profundo es la madriguera del conejo, o entrevistas de trabajo en C ++ en PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es495552/index.html">Mi intento de retrasar COVID-19 (aparato de respiraci√≥n aut√≥nomo)</a></li>
<li><a href="../es495554/index.html">Programa para buscar VKontakte con ideas afines [C√≥digo abierto]</a></li>
<li><a href="../es495556/index.html">Fortinet: una selecci√≥n de materiales √∫tiles</a></li>
<li><a href="../es495558/index.html">Ma√±ana est√° nublado: las nubes tendr√°n inteligencia, complicar√°n la contrataci√≥n de especialistas en TI, pero ayudar√°n a vender software</a></li>
<li><a href="../es495560/index.html">Tendencias de Internet de las cosas: AI responde llamadas, nubes y 5G Tame Big Data, vivienda y servicios p√∫blicos - L√≠der en innovaci√≥n</a></li>
<li><a href="../es495572/index.html">Hardware Ecosystem Community lanza podcast para todos en la industria electr√≥nica</a></li>
<li><a href="../es495574/index.html">Detecci√≥n y conteo de visitantes: Cloud vs. contador de c√°mara</a></li>
<li><a href="../es495576/index.html">Plataforma autopropulsada en el esp8266 MK con micropython</a></li>
<li><a href="../es495580/index.html">Pepino JVM - No solo BDD</a></li>
<li><a href="../es495588/index.html">Creando roguelike en Unity desde cero: generador de mazmorras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>