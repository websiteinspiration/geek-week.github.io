<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë™ üòÑ ‚õπüèΩ O que √© o Windows PowerShell e o que ele come? Parte 5: Acesso a objetos externos üë®üèø‚Äçü§ù‚Äçüë®üèª üßïüèæ üê∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os sistemas operacionais Windows suportam uma variedade de infra-estruturas de objetos. Voc√™ pode usar interfaces de programa√ß√£o de aplicativos (APIs)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>O que √© o Windows PowerShell e o que ele come? Parte 5: Acesso a objetos externos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498478/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/-b/i_/73/-bi_73lwdxmnzvtveeghrwvtqay.png"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os sistemas operacionais Windows suportam uma variedade de infra-estruturas de objetos. </font><font style="vertical-align: inherit;">Voc√™ pode usar interfaces de programa√ß√£o de aplicativos (APIs) para acess√°-las, mas o desenvolvimento de aplicativos completos nem sempre √© justificado. </font><font style="vertical-align: inherit;">O PowerShell possui cmdlets especiais que permitem acessar objetos .NET, COM, WMI (CIM) e ADSI interativamente. </font><font style="vertical-align: inherit;">Na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quarta parte da s√©rie,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aprendemos o b√°sico com foco nas classes .NET Core e agora queremos aprofundar o t√≥pico e entender os recursos da intera√ß√£o do PowerShell com objetos externos.</font></font><a name="habracut"></a><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√çndice:</font></font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com JSON, XML e CSV </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com WMI e CIM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com objetos COM </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com servi√ßo de diret√≥rio ADSI </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatar sa√≠da</font></font></a><br>
<br>
<a name="section1"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com JSON, XML e CSV</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos scripts do PowerShell, voc√™ geralmente precisa analisar dados JSON, XML e CSV. Geralmente, essa necessidade surge quando se trabalha com servi√ßos da Internet ou com arquivos de configura√ß√£o. Alguns administradores tentam analisar dados usando express√µes regulares, mas n√£o √© necess√°rio fazer esses sacrif√≠cios: o PowerShell possui cmdlets especiais para convers√£o, al√©m disso, nas duas dire√ß√µes.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ep/q6/tr/epq6trkxgw_sfw21p1wmfixyrfk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O formato JSON permite descrever uma variedade de objetos e, em ess√™ncia, √© uma hashtable que pode ser aninhada. </font><font style="vertical-align: inherit;">√â f√°cil converter um objeto JSON em um objeto .NET de acordo com o PowerShell. </font><font style="vertical-align: inherit;">Como os servi√ßos de Internet geralmente fornecem uma linha muito longa em vez de um arquivo formatado de maneira bonita, essa convers√£o tamb√©m pode ser √∫til para trabalhar no modo interativo. </font><font style="vertical-align: inherit;">No exemplo abaixo, usamos uma vari√°vel de texto com v√°rias linhas para descrever o objeto JSON:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-string">@"
{
   "firstName": "Ivan",
   "lastName": "Danko",
   "address": {
       "streetAddress": "Kremlin",
       "city": "Moscow"
   },
   "phoneNumbers": [
       "+7 495 1234567",
       "+7 499 1234567"
   ]
}
"@</span> | <span class="hljs-built_in">ConvertFrom-Json</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/vu/2j/x6/vu2jx6vrks90qvsuoehs6ky43ke.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O problema inverso √© resolvido de maneira semelhante:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$file</span> = <span class="hljs-built_in">Get-ChildItem</span> C:\Windows\System32\notepad.exe
<span class="hljs-variable">$file</span>.VersionInfo | <span class="hljs-built_in">ConvertTo-Json</span></code></pre><br>
<img src="https://habrastorage.org/webt/rd/tb/dq/rdtbdqlfwsepqmnggw_2uk7omkw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sequ√™ncia de formato JSON resultante √© f√°cil de enviar para outro aplicativo pela rede. </font><font style="vertical-align: inherit;">Pode ser, por exemplo, algum servi√ßo RESTful. </font><font style="vertical-align: inherit;">O trabalho com os cmdlets ConvertFrom-Csv, ConvertTo-Csv e ConvertTo-Xml √© constru√≠do aproximadamente da mesma maneira, sugerimos que os leitores o estudem independentemente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabalhar com XML e CSV, precisaremos de outros cmdlets: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jz/hy/m7/jzhym7nqvb5id7fvdys9ao59meq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando essas ferramentas, voc√™ precisa entender que a convers√£o de um objeto bin√°rio em um formato de texto economiza apenas o valor de suas propriedades, mas n√£o os m√©todos. </font><font style="vertical-align: inherit;">A convers√£o de dados JSON, XML ou CSV em um objeto .NET usando o PowerShell s√≥ √© poss√≠vel se for v√°lida.</font></font><br>
<br>
<a name="section2"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com WMI e CIM</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Windows Management Instrumentation (WMI) √© uma implementa√ß√£o desenvolvida pela Microsoft e adaptada para Windows do padr√£o WBEM (Gerenciamento Corporativo Baseado na Web). √â baseado na id√©ia de criar uma solu√ß√£o universal para monitorar o ambiente de informa√ß√µes distribu√≠das de uma empresa e gerenciar seus componentes. A estrutura de dados do WBEM, por sua vez, √© baseada no Common Information Model (CIM), que implementa uma abordagem orientada a objetos para a representa√ß√£o de sistemas de computadores. O desenvolvimento e o suporte adicionais do WMI no Windows foram descontinuados; a Microsoft recomenda o uso de um mecanismo semelhante para gerenciar a infraestrutura - objetos CIM. Para trabalhar com eles, os cmdlets especiais apareceram no PowerShell 3.0, que consideraremos em paralelo com os equivalentes do WMI. Se o c√≥digo contiver chamadas de cmdlet para trabalhar com o WMI, ele dever√° ser reescrito, se poss√≠vel.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/h6/io/mw/h6iomwnjjrssdkl_tw7gi0mwjhm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dentro da estrutura do modelo CIM (tamb√©m √© usado no WMI), os dados do sistema operacional s√£o apresentados na forma de classes com propriedades e m√©todos. As classes s√£o agrupadas em hierarquicamente ordenadas e logicamente relacionadas por tecnologia de namespace ou √°rea de gerenciamento. H√° um espa√ßo para nome raiz raiz que possui subespa√ßos: CIMv2, Padr√£o, Seguran√ßa e WMI. Para identifica√ß√£o inequ√≠voca de uma inst√¢ncia de uma classe (objeto) e descri√ß√£o do estado do recurso correspondente, s√£o usadas propriedades de classe, que geralmente s√£o somente leitura. M√©todos s√£o usados ‚Äã‚Äãpara gerenciar o recurso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A inst√¢ncia da classe pode ser acessada pelo caminho completo, que possui o seguinte formato:</font></font><br>
<br>
<pre><code class="powershell hljs">[\\<span class="hljs-type">ComputerName</span>\<span class="hljs-type">NameSpace</span>][:<span class="hljs-type">ClassName</span>][<span class="hljs-type">.KeyProperty1</span>=<span class="hljs-type">Value1</span>][,<span class="hljs-type">KeyProperty2</span>=<span class="hljs-type">Value2</span>]‚Ä¶]</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
onde </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ComputerName √© o nome do computador; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NameSpace - espa√ßo para nome; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ClassName - o nome da classe; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KeyProperty1 = Valor1, KeyProperty2 = Valor2 - as propriedades do objeto e os valores pelos quais ele √© identificado.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes do PowerShell, n√£o existia uma ferramenta WMI simples. </font><font style="vertical-align: inherit;">Para acessar os objetos, era necess√°rio escrever programas bastante complexos em linguagens de alto n√≠vel (C ++, Visual Basic, Java Script) ou estudar o shell WMIC (linha de comando WMI, que tamb√©m √© descontinuada) com seu pr√≥prio idioma. </font><font style="vertical-align: inherit;">Por meio do PowerShell, os objetos WMI s√£o acess√≠veis ao usu√°rio m√©dio na linha de comando ou nos scripts. </font><font style="vertical-align: inherit;">Primeiro, conecte-se ao subsistema WMI e obtenha uma lista de classes dispon√≠veis usando o cmdlet Get-WmiObject (tamb√©m conhecido como gwmi). </font><font style="vertical-align: inherit;">Para obter uma lista de classes CIM, use o cmdlet Get-CimClass.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-List</span></code></pre><br>
<img src="https://habrastorage.org/webt/g7/1z/wz/g71zwzueejpnyrgwqkoqpxlwn7a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listamos as classes no computador local, mas voc√™ pode se conectar ao controle remoto:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> IP- 
<span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-ComputerName</span> _</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> IP- <span class="hljs-literal">-List</span>
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-ComputerName</span> _ <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padr√£o, os cmdlets Get-CimClass e Get-WmiObject se conectam ao espa√ßo para nome Root \ CIMV2, que armazena um grande n√∫mero de classes para gerenciar o sistema. </font><font style="vertical-align: inherit;">Para alterar o espa√ßo para nome, use o par√¢metro -Namespace:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimClass</span> <span class="hljs-literal">-Namespace</span> Root
<span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Namespace</span> Root <span class="hljs-literal">-List</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conhecendo o nome da classe, n√£o √© dif√≠cil obter inst√¢ncias dela. </font><font style="vertical-align: inherit;">O comando a seguir retorna todas as inst√¢ncias do Win32_Service, ou seja, </font><font style="vertical-align: inherit;">servi√ßos registrados na m√°quina local:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como com outros tipos de objetos, uma lista de propriedades e m√©todos √© exibida usando Get-Member. </font><font style="vertical-align: inherit;">Os m√©todos de objeto WMI podem ser acessados ‚Äã‚Äãdiretamente ou usando o cmdlet Invoke-WmiMethod. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode usar cmdlets para objetos WMI para classificar, filtrar, agrupar etc.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> Win32_Service | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/pq/rn/nk/pqrnnkbv1abfqzn5hlnsgunzamu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para obter objetos CIM (inst√¢ncias de classes), use o cmdlet Get-CimInstance. </font><font style="vertical-align: inherit;">Ao contr√°rio do WMI, os objetos CIM resultantes (objeto resultante ou inst√¢ncias de classe) n√£o cont√™m m√©todos de classe. </font><font style="vertical-align: inherit;">Como voc√™ n√£o pode extrair diretamente um m√©todo, voc√™ deve invocar o cmdlet Invoke-CimMethod. </font><font style="vertical-align: inherit;">Considere a classe Win32_Service - servi√ßos em execu√ß√£o no sistema) e sua inst√¢ncia para o servi√ßo de spooler na m√°quina local:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> </code></pre><br>
<img src="https://habrastorage.org/webt/qm/jf/cz/qmjfcz-_u-le6js9tibb3qc5y2i.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos a estrutura do objeto resultante:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-CimInstance</span> Win32_service <span class="hljs-literal">-filter</span> <span class="hljs-string">"Name='spooler'"</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/t4/uo/ub/t4uoublc7mxrlb6khyrycfozod4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Neste ponto, os benef√≠cios dos cmdlets para trabalhar com objetos CIM n√£o s√£o √≥bvios. </font><font style="vertical-align: inherit;">Eles se referem principalmente ao trabalho remoto em um ambiente distribu√≠do e ser√£o discutidos em detalhes no √∫ltimo artigo da s√©rie dedicada √† solu√ß√£o de problemas pr√°ticos de administra√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m um kit de ferramentas espec√≠fico para WMI: o WQL Query Language (WQL), uma linguagem de consulta semelhante ao SQL. </font><font style="vertical-align: inherit;">Uma consulta WQL para procurar todas as start-ups ao iniciar um sistema de servi√ßo se parece com isso:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">select</span> * from win32_service <span class="hljs-built_in">where</span> startmode=<span class="hljs-string">"Auto"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No PowerShell, eles s√£o executados da seguinte maneira:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-Query</span> <span class="hljs-string">'select * from win32_service where startmode="Auto"'</span></code></pre><br>
<img src="https://habrastorage.org/webt/wc/y7/wf/wcy7wfk7619yx_9es0cjz9bi4vw.png"><br>
<br>
<a name="section3"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com objetos COM</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para garantir a intera√ß√£o entre aplicativos no Windows, foi desenvolvida uma tecnologia para vincular e incorporar objetos (Object Linking and Embedding ou OLE). Mais tarde, apareceu a tecnologia OLE Automation, com a ajuda de quais aplicativos clientes de automa√ß√£o poderiam chamar fun√ß√µes de outros aplicativos - servidores de automa√ß√£o. OLE e OLE Automation foram baseados na tecnologia principal do Component Object Model (COM), que oferece um √∫nico padr√£o bin√°rio para componentes de software. Objetos criados usando-o e registrados no sistema operacional podem ser usados ‚Äã‚Äãem outros aplicativos usando arquivos execut√°veis ‚Äã‚Äãou bibliotecas din√¢micas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por volta de meados dos anos 90, em vez de OLE, outro termo come√ßou a ser usado - ActiveX. </font><font style="vertical-align: inherit;">Antes do advento da plataforma .NET, a tecnologia ActiveX era considerada essencial e os objetos COM ainda s√£o usados ‚Äã‚Äãativamente para integrar aplicativos ao Windows - muitos produtos da Microsoft e de terceiros s√£o servidores de automa√ß√£o e fornecem acesso a seus servi√ßos por meio deles. </font><font style="vertical-align: inherit;">Para acessar objetos, o ProgID √© usado - um identificador simb√≥lico que √© atribu√≠do a eles ao se registrar no registro do Windows. </font><font style="vertical-align: inherit;">Tem a seguinte forma:</font></font><br>
<br>
<pre><code class="powershell hljs">_..</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A vers√£o geralmente n√£o √© indicada:</font></font><br>
<br>
<pre><code class="powershell hljs">_.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns exemplos de ProgIDs dispon√≠veis s√£o: InternetExplorer.Application (aplicativo Internet Explorer), Word.Application (aplicativo Microsoft Word), WScript.Shell (classe Shell do host de scripts do Windows ou modelo de objeto do servidor de scripts do WSH). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode criar uma inst√¢ncia do objeto usando o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmdlet New-Object</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> discutido no artigo anterior </font><font style="vertical-align: inherit;">e ver sua estrutura usando Get-Member:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> WScript.Shell
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/bk/s5/fh/bks5fhq3q-yhle1fwb4-vjkqpk0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabalhar com objetos, propriedades e m√©todos s√£o usados. </font><font style="vertical-align: inherit;">Digamos, para criar um atalho na √°rea de trabalho do usu√°rio, voc√™ precisa chamar o m√©todo CreateShortcut ():</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> = <span class="hljs-variable">$myshell</span>.CreateShortcut(<span class="hljs-string">"<span class="hljs-variable">$Home</span>\Desktop\Home.lnk"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que o atalho tamb√©m √© um objeto COM:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/05/d8/4_/05d84_-mbzmfuffczrmr76khfyg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Resta preencher suas propriedades e economizar:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$link</span>.TargetPath = <span class="hljs-variable">$Home</span>
<span class="hljs-variable">$link</span>.Save()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dessa maneira, criamos um atalho na √°rea de trabalho do usu√°rio ativo e agora analisamos o trabalho com servi√ßos de automa√ß√£o externos usando o exemplo do objeto COM Shell.Application. </font><font style="vertical-align: inherit;">Com ele, voc√™ pode automatizar algumas a√ß√µes no Windows Explorer:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Shell.Application</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ou para abreviar:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-com</span> Shell.Application
<span class="hljs-variable">$myshell</span> | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/__/iu/qy/__iuqyjf29nliwugz-jybihkfj0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O objeto Shell.Application possui alguns m√©todos diferentes de gerenciamento de janelas. </font><font style="vertical-align: inherit;">Por exemplo, para exibir o conte√∫do de um determinado diret√≥rio, Explore () √© usado:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Explore(<span class="hljs-string">"c:\"</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O sistema de ajuda √© chamado usando o m√©todo Help ():</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Help()</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° tamb√©m tr√™s m√©todos para chamar as caixas de di√°logo de pesquisa: FindFiles (), FindComputer () e FindPrinter ().</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.FindFiles()
<span class="hljs-variable">$myshell</span>.FindComputer()
<span class="hljs-variable">$myshell</span>.FindPrinter()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode abrir a caixa de di√°logo de inicializa√ß√£o do programa usando o m√©todo FileRun () e, para chamar a janela de configura√ß√£o de data / hora, voc√™ precisa do m√©todo SetTime (). </font><font style="vertical-align: inherit;">Existem, por exemplo, m√©todos para acessar a janela de configura√ß√µes da barra de tarefas, elementos do painel de controle indicando um dos arquivos cpl dispon√≠veis, para gerenciar janelas abertas:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.MinimizeAll()
<span class="hljs-variable">$myshell</span>.UndoMinimizeAll()
<span class="hljs-variable">$myshell</span>.TileHorizontally()
<span class="hljs-variable">$myshell</span>.TileVertically()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O m√©todo Windows () permite acessar a cole√ß√£o de janelas abertas no Explorer ou no Internet Explorer. </font><font style="vertical-align: inherit;">Vamos ver as propriedades e m√©todos dispon√≠veis para esta cole√ß√£o:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$myshell</span>.Windows() | <span class="hljs-built_in">Get-Member</span></code></pre><br>
<img src="https://habrastorage.org/webt/dq/ls/yo/dqlsyokgkrtk6rc-okuskmpwsvo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem outros objetos COM √∫teis, cujo n√∫mero depende do software instalado no sistema. </font><font style="vertical-align: inherit;">Era uma vez, a principal ferramenta de automa√ß√£o no Windows era o servidor de scripts WSH, cujo modelo de objeto tamb√©m inclui objetos COM: projetado para funcionar com as fun√ß√µes de rede do WScript.Network e do WScript.Shell que j√° mencionamos. </font><font style="vertical-align: inherit;">Este √∫ltimo n√£o apenas cria atalhos na √°rea de trabalho, com sua ajuda, voc√™ pode, por exemplo, exibir janelas de informa√ß√µes com mensagens e bot√µes, alternar entre aplicativos, iniciar programas ou simular pressionamentos de tecla.</font></font><br>
<br>
<a name="section4"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhando com o servi√ßo de diret√≥rio ADSI</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, um cat√°logo refere-se a uma fonte de informa√ß√µes na qual os dados sobre alguns objetos s√£o armazenados. Por servi√ßo de diret√≥rio, entendemos parte de um sistema de computador distribu√≠do que permite acessar e manipular objetos armazenados. Um servi√ßo de diret√≥rio pode combinar dados sobre objetos de rede e os servi√ßos que os manipulam - representa um √∫nico ponto de entrada para interagir com os recursos da rede. Pode haver muitos desses servi√ßos em uma rede heterog√™nea de computadores: um SAM local (Security Account Manager) para computadores que n√£o s√£o de dom√≠nio, Active Directory, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A intera√ß√£o com diferentes servi√ßos de diret√≥rio requer ferramentas diferentes, o que cria certos inconvenientes. A partir do Windows 2000, a Microsoft introduziu a tecnologia ADSI (Active Directory Service Interface) unificada para sistemas operacionais que n√£o dependem de um protocolo de acesso √† rede espec√≠fico. Para localizar objetos, um espa√ßo para nome √© definido para o diret√≥rio. Como servi√ßos de diret√≥rio diferentes usam m√©todos de nomea√ß√£o diferentes, o ADSI define uma conven√ß√£o que identifica exclusivamente qualquer objeto. O conceito de cadeias de liga√ß√£o de duas partes ou ADsPath √© introduzido. A primeira parte do nome define o servi√ßo de diret√≥rio (provedor ADSI) e a segunda - a localiza√ß√£o do objeto no diret√≥rio. Aqui est√£o exemplos de designa√ß√£o de diferentes provedores ADSI: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP: //</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado para servi√ßos de diret√≥rio baseados em LDAP, incluindo </font><font style="vertical-align: inherit;">para o Active Directory; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinNT: //</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usado para computadores locais. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o h√° cmdlets especiais para trabalhar com o ADSI no PowerShell. </font><font style="vertical-align: inherit;">Em vez disso, o operador de convers√£o [ADSI] √© usado seguido por uma seq√º√™ncia de caracteres de liga√ß√£o. </font><font style="vertical-align: inherit;">Por exemplo, para conectar-se ao usu√°rio Ivanov a partir do dom√≠nio test.ru, √© necess√°ria a seguinte constru√ß√£o:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"LDAP://CN=Ivanov,DC=TEST,DC=RU"</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para trabalhar com contas locais, voc√™ precisar√° conectar-se ao computador com o nome correspondente (para conectar-se ao computador local, basta usar o ponto em vez do nome):</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$computer</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://."</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, crie um novo usu√°rio, Ivanov, na m√°quina local:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user</span> = <span class="hljs-variable">$computer</span>.Create(<span class="hljs-string">"user"</span>,<span class="hljs-string">"Ivanov"</span>)
<span class="hljs-variable">$user</span>.Put(<span class="hljs-string">"Description"</span>,<span class="hljs-string">"  PowerShell"</span>)
<span class="hljs-variable">$user</span>.SetInfo()</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora conecte-se a ele:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$user1</span> = [<span class="hljs-type">ADSI</span>]<span class="hljs-string">"WinNT://./Ivanov,user"</span>
<span class="hljs-variable">$user1</span>.Description</code></pre><br>
<img src="https://habrastorage.org/webt/pb/9l/5m/pb9l5mpw09oocoetnw3x4iawzmm.png"><br>
<br>
<a name="section5"></a><h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formata√ß√£o de sa√≠da</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O trabalho interativo geralmente exige a exibi√ß√£o de dados. Em outros shells, os pr√≥prios comandos e utilit√°rios est√£o envolvidos na formata√ß√£o da sa√≠da, mas objetos bin√°rios retornados por fun√ß√µes e cmdlets geralmente n√£o sabem como fazer isso. No PowerShell, a sa√≠da √© formatada por quatro cmdlets especiais que alimentam objetos atrav√©s do pipeline. Informa√ß√µes mais detalhadas podem ser obtidas usando o Get-Help: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Table</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formata a sa√≠da na forma de uma tabela cujas colunas cont√™m os valores das propriedades do objeto ou os valores calculados. A capacidade de agrupar dados √© suportada; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-List</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> exibe o objeto como uma lista de propriedades, cada uma das quais √© exibida em uma nova linha. A capacidade de agrupar dados √© suportada; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato personalizado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formata a sa√≠da usando uma visualiza√ß√£o personalizada; </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Format-Wide</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> formata objetos na forma de uma tabela ampla na qual apenas uma propriedade de cada objeto √© exibida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se nenhum dos cmdlets listados for chamado, o m√≥dulo de formata√ß√£o apropriado ao tipo de dados exibido ser√° usado. As regras de exibi√ß√£o s√£o armazenadas nos arquivos de configura√ß√£o no formato XML com a extens√£o .ps1xml, localizada no diret√≥rio $ PSHome. Uma lista deles pode ser obtida usando o seguinte comando:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">dir</span> <span class="hljs-variable">$pshome</span>\*format*.ps1xm</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A edi√ß√£o manual de arquivos de configura√ß√£o n√£o √© recomendada; √© melhor criar seus pr√≥prios e inclu√≠-los na lista de arquivos baixados usando o cmdlet Update-FormatData. Se o formatador padr√£o para o tipo que voc√™ deseja n√£o estiver definido, o PowerShell exibir√° as propriedades do objeto na tela em uma lista. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso conclui a descri√ß√£o do trabalho com objetos no PowerShell e o artigo final da s√©rie ser√° dedicado √† resolu√ß√£o de problemas pr√°ticos de gerenciamento de um ambiente de informa√ß√µes distribu√≠das de uma empresa. Nele, todas as ferramentas descritas s√£o √∫teis para n√≥s. O foco principal ser√° nos objetos CIM e sua compara√ß√£o com o WMI. Partes anteriores podem ser encontradas nos links abaixo.</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 1:   Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 2:     Windows PowerShell</a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 3:      ,  </a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> 4:   ,  </a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt498458/index.html">Videochamadas com fundo virtual e ferramentas de c√≥digo aberto</a></li>
<li><a href="../pt498462/index.html">Rolagem infinita com banners ou Como fazer com tr√™s visualiza√ß√µes</a></li>
<li><a href="../pt498466/index.html">Como lasers e sensores ajudam a manter os ju√≠zes nervosos</a></li>
<li><a href="../pt498472/index.html">Imagem do Docker de aplicativo de p√°gina √∫nica</a></li>
<li><a href="../pt498476/index.html">Acessibilidade Como tornar o aplicativo acess√≠vel a usu√°rios com defici√™ncia</a></li>
<li><a href="../pt498482/index.html">Situa√ß√£o: os fornecedores dos EUA s√£o solicitados a remover limites para o download de dados - que, no final,</a></li>
<li><a href="../pt498484/index.html">Wi-Fi 6 e Huawei P40: onde est√° a conex√£o?</a></li>
<li><a href="../pt498486/index.html">Como expandir a sem√¢ntica em ingl√™s para publicidade em pesquisas em um nicho estreito</a></li>
<li><a href="../pt498490/index.html">Um sistema de certifica√ß√£o eficaz que permitir√° que voc√™ se torne um l√≠der melhor</a></li>
<li><a href="../pt498492/index.html">Querida, matamos a burocracia: como a digitaliza√ß√£o est√° mudando o di√°logo entre fornecedores e X5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>