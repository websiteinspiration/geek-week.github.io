<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€ğŸš’ ğŸš¹ ğŸ–¤ .Net Core Apiï¼šåœ¨æ¥è‡ªä¸åŒæ¥æºçš„è¯·æ±‚ä¸­è·å–æ•°æ® ğŸ” ğŸ§œğŸ¿ ğŸ´â€â˜ ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=".Net Coreå…·æœ‰å†…ç½®çš„æ¨¡å‹ç»‘å®šæœºåˆ¶ï¼Œè¯¥æœºåˆ¶ä¸ä»…å…è®¸æ¥å—æ§åˆ¶å™¨ä¸­çš„è¾“å…¥å‚æ•°ï¼Œè€Œä¸”è¿˜å¯ä»¥ç«‹å³æ¥æ”¶å…·æœ‰å¡«å……å­—æ®µçš„å¯¹è±¡ã€‚è¿™ä½¿æ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å‹éªŒè¯å°†æ‰€æœ‰å¿…è¦çš„æ£€æŸ¥åµŒå…¥åˆ°è¿™æ ·çš„å¯¹è±¡ä¸­ã€‚
 
 è¿™äº›åªæ˜¯APIè¿ä½œæ‰€éœ€çš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯ä»Queryæˆ–Bodyè·å¾—çš„ã€‚éœ€è¦ä»Headersæ¥æ”¶ä¸€äº›æ•°æ®ï¼ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>.Net Core Apiï¼šåœ¨æ¥è‡ªä¸åŒæ¥æºçš„è¯·æ±‚ä¸­è·å–æ•°æ®</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492820/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.Net Coreå…·æœ‰å†…ç½®çš„æ¨¡å‹ç»‘å®šæœºåˆ¶ï¼Œè¯¥æœºåˆ¶ä¸ä»…å…è®¸æ¥å—æ§åˆ¶å™¨ä¸­çš„è¾“å…¥å‚æ•°ï¼Œè€Œä¸”è¿˜å¯ä»¥ç«‹å³æ¥æ”¶å…·æœ‰å¡«å……å­—æ®µçš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">è¿™ä½¿æ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å‹éªŒè¯å°†æ‰€æœ‰å¿…è¦çš„æ£€æŸ¥åµŒå…¥åˆ°è¿™æ ·çš„å¯¹è±¡ä¸­ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™äº›åªæ˜¯APIè¿ä½œæ‰€éœ€çš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯ä»Queryæˆ–Bodyè·å¾—çš„ã€‚</font><font style="vertical-align: inherit;">éœ€è¦ä»Headersæ¥æ”¶ä¸€äº›æ•°æ®ï¼ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œbase64ä¸­å­˜åœ¨jsonï¼‰ï¼Œå¦‚æœæ‚¨ä½¿ç”¨RESTï¼Œåˆ™æŸäº›æ•°æ®åº”è¯¥æ¥è‡ªå¤–éƒ¨æœåŠ¡æˆ–ActionRouteã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥ä½¿ç”¨ç»‘å®šä»é‚£é‡Œè·å–æ•°æ®ã€‚</font><font style="vertical-align: inherit;">æ²¡é”™ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæ‚¨å†³å®šä¸ç ´åå°è£…å¹¶é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–æ¨¡å‹ï¼Œé‚£ä¹ˆæ‚¨å°†ä¸å¾—ä¸è¿›è¡Œè¨æ»¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¯¹äºæˆ‘è‡ªå·±å’Œå­å­™åä»£ï¼Œæˆ‘å†³å®šå†™ä¸€äº›ç±»ä¼¼çš„è¯´æ˜ï¼Œä»¥ç»“åˆä½¿ç”¨Bindingå’Œè¨æ»¡æ•™ã€‚</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å…¸å‹çš„æ§åˆ¶å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">HttpGet</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">GetSomeData</span>(<span class="hljs-params">[FromQuery[IncomeData someData</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(<span class="hljs-string">"X-Property"</span>);
    <span class="hljs-keyword">if</span> (moreData.Id == <span class="hljs-number">0</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> StatusCode(<span class="hljs-number">400</span>, <span class="hljs-string">"Nginx doesnt know your id"</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">var</span> externalData = GetFromExternalService(<span class="hljs-string">"http://myservice.com/MoreData"</span>);
    <span class="hljs-keyword">if</span> (externalData == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> StatusCode(<span class="hljs-number">500</span>, <span class="hljs-string">"Cant connect to external service"</span>);<font></font>
    }<font></font>
    <span class="hljs-keyword">var</span> finalData = <span class="hljs-keyword">new</span> FinalData(someData, moreData, externalData);
    <span class="hljs-keyword">return</span> _myService.Handle(finalData);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»“æœï¼Œæˆ‘ä»¬é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éªŒè¯é€»è¾‘ç”±è¯·æ±‚å¯¹è±¡ï¼Œæ ‡å¤´ä¸­çš„è¯·æ±‚æ–¹æ³•ï¼ŒæœåŠ¡ä¸­çš„è¯·æ±‚æ–¹æ³•å’Œæ§åˆ¶å™¨æ–¹æ³•æ¶‚æŠ¹ã€‚</font><font style="vertical-align: inherit;">ä¸ºç¡®ä¿ç»å¯¹å¿…è¦çš„æ£€æŸ¥ï¼Œæ‚¨éœ€è¦è¿›è¡Œæ•´ä¸ªè°ƒæŸ¥ï¼</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›¸é‚»çš„æ§åˆ¶å™¨æ–¹æ³•å°†å…·æœ‰å®Œå…¨ç›¸åŒçš„ä»£ç ã€‚</font><font style="vertical-align: inherit;">æ”»å‡»ä¸­çš„å¤åˆ¶ç²˜è´´ç¼–ç¨‹ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ï¼Œæ¯”ç¤ºä¾‹ä¸­çš„æ£€æŸ¥è¦å¤šå¾—å¤šï¼Œå› æ­¤ï¼Œå”¯ä¸€é‡è¦çš„ä¸€è¡Œï¼ˆå¯¹ä¸šåŠ¡é€»è¾‘å¤„ç†æ–¹æ³•çš„è°ƒç”¨ï¼‰éšè—åœ¨ä»£ç å †ä¸­ã€‚</font><font style="vertical-align: inherit;">è¦è§åˆ°ä»–å¹¶äº†è§£è¿™é‡Œå‘ç”Ÿçš„æƒ…å†µï¼Œé€šå¸¸éœ€è¦ä»˜å‡ºä¸€äº›åŠªåŠ›ã€‚</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªå®šä¹‰ç»‘å®šï¼ˆç®€æ˜“æ¨¡å¼ï¼‰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡åœ¨è¯·æ±‚å¤„ç†ç®¡é“ä¸­å®ç°æ‚¨çš„å¤„ç†ç¨‹åºï¼Œå¯ä»¥è§£å†³éƒ¨åˆ†é—®é¢˜ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œé¦–å…ˆé€šè¿‡å°†æœ€ç»ˆå¯¹è±¡ç«‹å³ä¼ é€’ç»™æ–¹æ³•æ¥æ›´æ­£æˆ‘ä»¬çš„æ§åˆ¶å™¨ã€‚</font><font style="vertical-align: inherit;">çœ‹èµ·æ¥å¥½å¤šäº†å§ï¼Ÿ</font></font><br>
<br>
<pre><code class="cs hljs">[<span class="hljs-meta">HttpGet</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;IActionResult&gt; <span class="hljs-title">GetSomeData</span>(<span class="hljs-params">[FromQuery]FinalData finalData</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">return</span> _myService.Handle(finalData);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œä¸ºç±»å‹MoreDataåˆ›å»ºæ´»é¡µå¤¹ã€‚</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoreDataBinder</span> : <span class="hljs-title">IModelBinder</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">BindModelAsync</span>(<span class="hljs-params">ModelBindingContext bindingContext</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(bindingContext.HttpContext.Request.Headers);
        <span class="hljs-keyword">if</span> (moreData != <span class="hljs-literal">null</span>)<font></font>
        {<font></font>
            bindingContext.Result = ModelBindingResult.Success(moreData);<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> MoreData <span class="hljs-title">GetFromHeaderAndDecode</span>(<span class="hljs-params">IHeaderDictionary headers</span>)</span> { ... }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œæˆ‘ä»¬é€šè¿‡å°†æ´»é¡µå¤¹ç»‘å®šæ·»åŠ åˆ°è¯¥å±æ€§æ¥ä¿®å¤FinalDataæ¨¡å‹ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FinalData</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SomeDataNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> SomeDataText { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
<font></font>
    [<span class="hljs-meta">ModelBinder(BinderType = typeof(MoreDataBinder))</span>]
    <span class="hljs-keyword">public</span> MoreData MoreData { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®ƒå·²ç»å¥½äº†ï¼Œä½†æ˜¯ç—”ç–®å¢åŠ äº†ï¼šç°åœ¨æ‚¨éœ€è¦çŸ¥é“æˆ‘ä»¬æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å¤„ç†å™¨ï¼Œå¹¶åœ¨æ‰€æœ‰å‹å·ä¸­è¿›è¡Œæ³¨æ˜ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™æ˜¯å¯ä»¥è§£å†³çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ›å»ºæ‚¨çš„BinderProviderï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoreDataBinderProvider</span> : <span class="hljs-title">IModelBinderProvider</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IModelBinder <span class="hljs-title">GetBinder</span>(<span class="hljs-params">ModelBinderProviderContext context</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> modelType = context.Metadata.UnderlyingOrModelType;
        <span class="hljs-keyword">if</span> (modelType == <span class="hljs-keyword">typeof</span>(MoreData))<font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BinderTypeModelBinder(<span class="hljs-keyword">typeof</span>(MoreDataBinder));<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¹¶åœ¨å¯åŠ¨ä¸­æ³¨å†Œï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><font></font>
{<font></font>
    services.AddControllers();<font></font>
    services.AddMvc(options =&gt;<font></font>
    {<font></font>
        options.ModelBinderProviders.Insert(<span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> MoreDataBinderProvider());<font></font>
     });<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°†æŒ‰é˜Ÿåˆ—é¡ºåºä¸ºæ¯ä¸ªæ¨¡å‹å¯¹è±¡è°ƒç”¨æä¾›ç¨‹åºã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬çš„æä¾›è€…ç¬¦åˆæ‰€éœ€çš„ç±»å‹ï¼Œå®ƒå°†è¿”å›æ‰€éœ€çš„æ´»é¡µå¤¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤æ´»é¡µå¤¹å°†èµ·ä½œç”¨ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œç°åœ¨æ— è®ºä½•æ—¶æŒ‡å®šMoreDataçš„ç±»å‹ï¼Œéƒ½å°†ä»Headerä¸­è·å–å¹¶è§£ç å®ƒï¼Œå¹¶ä¸”æ— éœ€åœ¨æ¨¡å‹ä¸­æŒ‡å®šç‰¹æ®Šå±æ€§ã€‚</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªå®šä¹‰ç»‘å®šï¼ˆç¡¬æ¨¡å¼ï¼‰</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ‰€æœ‰è¿™ä¸€åˆ‡éƒ½å¾ˆæ£’ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä»¶äº‹ï¼šä¸ºäº†ä½¿é­”æœ¯å‘æŒ¥ä½œç”¨ï¼Œæˆ‘ä»¬çš„æ¨¡å‹å¿…é¡»å…·æœ‰è®¾ç½®çš„å…¬å…±å±æ€§ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯å°è£…å‘¢ï¼Ÿ</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘æƒ³å°†è¯·æ±‚æ•°æ®ä¼ è¾“åˆ°äº‘ä¸­çš„å„ä¸ªåœ°æ–¹å¹¶ä¸”çŸ¥é“åœ¨é‚£é‡Œå°†ä¸ä¼šæ›´æ”¹è¯¥æ€ä¹ˆåŠï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é—®é¢˜æ˜¯é»˜è®¤ç»‘å®šç¨‹åºä¸é€‚ç”¨äºæ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°çš„æ¨¡å‹ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æ˜¯ä»€ä¹ˆé˜»æ­¢æˆ‘ä»¬ç¼–å†™è‡ªå·±çš„å‘¢ï¼Ÿ</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä¸ºå…¶ç¼–å†™æ­¤ä»£ç çš„æœåŠ¡ä¸ä½¿ç”¨RESTï¼Œä»…é€šè¿‡Queryå’ŒBodyä¼ è¾“å‚æ•°ï¼Œå¹¶ä¸”ä»…ä½¿ç”¨ä¸¤ç§ç±»å‹çš„è¯·æ±‚-Get </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 å’ŒPostã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œåœ¨REST APIçš„æƒ…å†µä¸‹ï¼Œå¤„ç†é€»è¾‘å°†ç•¥æœ‰ä¸åŒã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šå¸¸ï¼Œä»£ç å°†ä¿æŒä¸å˜ï¼Œåªæœ‰æˆ‘ä»¬çš„æ´»é¡µå¤¹éœ€è¦æ”¹è¿›ï¼Œä»¥ä¾¿å®ƒåˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å¡«å……å…¶ç§æœ‰å­—æ®µã€‚</font><font style="vertical-align: inherit;">æ­¤å¤–ï¼Œæˆ‘å°†ç»™å‡ºä¸€äº›å¸¦æœ‰æ³¨é‡Šçš„ä»£ç ï¼Œè¿™äº›ä»£ç ä¸æ„Ÿå…´è¶£-åœ¨æ–‡ç« çš„æœ€åï¼Œè¯¥ç±»çš„æ•´ä¸ªæ¸…å•ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç¡®å®šMoreDataæ˜¯å¦æ˜¯è¯¥ç±»çš„å”¯ä¸€å±æ€§ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦è‡ªå·±åˆ›å»ºå¯¹è±¡ï¼ˆhelloï¼ŒActivatorï¼‰ï¼Œå¦åˆ™ï¼ŒJsonConvertå¯ä»¥å®Œç¾åœ°å®Œæˆå·¥ä½œï¼Œè€Œæˆ‘ä»¬åªéœ€å°†å¿…è¦çš„æ•°æ®æ”¾å…¥å±æ€§ä¸­å³å¯ã€‚</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">NeedActivator</span>(<span class="hljs-params">IReflect modelType</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> propFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance;
    <span class="hljs-keyword">var</span> properties = modelType.GetProperties(propFlags);<font></font>
<font></font>
    <span class="hljs-keyword">return</span> properties.Select(p =&gt; p.Name).Distinct().Count() == <span class="hljs-number">1</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šè¿‡JsonConvertåˆ›å»ºå¯¹è±¡å¾ˆç®€å•ï¼Œå¯¹äºä½¿ç”¨Bodyè¿›è¡ŒæŸ¥è¯¢ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromBody(ModelBindingContext bindingContext, Type modelType)<font></font>
{<font></font>
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> StreamReader(bindingContext.HttpContext.Request.Body);
    <span class="hljs-keyword">var</span> jsonString = reader.ReadToEnd();
    <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonString, modelType);
    <span class="hljs-keyword">return</span> data;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ä½¿ç”¨æŸ¥è¯¢æˆ‘ä¸å¾—ä¸æ”¾ä¸‹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæœ‰äººå¯ä»¥æå‡ºæ›´ç¾ä¸½çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘å°†æ„Ÿåˆ°éå¸¸é«˜å…´ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¼ é€’æ•°ç»„æ—¶ï¼Œå°†è·å¾—å¤šä¸ªå…·æœ‰ç›¸åŒåç§°çš„å‚æ•°ã€‚</font><font style="vertical-align: inherit;">å¼ºåˆ¶è½¬æ¢ä¸ºå¹³é¢ç±»å‹ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†æ˜¯åºåˆ—åŒ–ä¼šåœ¨æ•°ç»„[]ä¸ŠåŠ ä¸Šå¤šä½™çš„å¼•å·ï¼Œå¿…é¡»æ‰‹åŠ¨å°†å…¶åˆ é™¤ã€‚</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromQuery(ModelBindingContext bindingContext, Type modelType)<font></font>
{<font></font>
    <span class="hljs-keyword">var</span> valuesDictionary = QueryHelpers.ParseQuery(bindingContext.HttpContext.Request.QueryString.Value);
    <span class="hljs-keyword">var</span> jsonDictionary = valuesDictionary.ToDictionary(pair =&gt; pair.Key, pair =&gt; pair.Value.Count &lt; <span class="hljs-number">2</span> ? pair.Value.ToString() : <span class="hljs-string">$"[<span class="hljs-subst">{pair.Value}</span>]"</span>);<font></font>
<font></font>
    <span class="hljs-keyword">var</span> jsonStr = JsonConvert.SerializeObject(jsonDictionary).Replace(<span class="hljs-string">"\"["</span>, <span class="hljs-string">"["</span>).Replace(<span class="hljs-string">"]\""</span>, <span class="hljs-string">"]"</span>);
    <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonStr, modelType);
    <span class="hljs-keyword">return</span> data;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æœ€åï¼Œåˆ›å»ºå¯¹è±¡æ—¶ï¼Œæœ‰å¿…è¦å°†æˆ‘ä»¬çš„æ•°æ®å†™å…¥å…¶ç§æœ‰å±æ€§ã€‚</font><font style="vertical-align: inherit;">æˆ‘åœ¨æœ¬æ–‡å¼€å¤´è°ˆåˆ°çš„æ­£æ˜¯è¿™ç§è¨æ»¡æ•™ã€‚</font><font style="vertical-align: inherit;">æˆ‘åœ¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™é‡Œ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰¾åˆ°äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆ</font><font style="vertical-align: inherit;">ï¼Œå¯¹æ­¤éå¸¸æ„Ÿè°¢ä½œè€…ã€‚</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForceSetValue</span>(<span class="hljs-params">PropertyInfo propertyInfo, <span class="hljs-keyword">object</span> obj, <span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> propName = <span class="hljs-string">$"&lt;<span class="hljs-subst">{propertyInfo.Name}</span>&gt;k__BackingField"</span>;
    <span class="hljs-keyword">var</span> propFlags = BindingFlags.Instance | BindingFlags.NonPublic;<font></font>
            <font></font>
    obj.GetType().GetField(propName, propFlags)?.SetValue(obj, <span class="hljs-keyword">value</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¥½å§ï¼Œæˆ‘ä»¬å°†è¿™äº›æ–¹æ³•åˆå¹¶åœ¨ä¸€ä¸ªè°ƒç”¨ä¸­ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">BindModelAsync</span>(<span class="hljs-params">ModelBindingContext bindingContext</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(bindingContext.HttpContext.Request.Headers);
    <span class="hljs-keyword">if</span> (moreData == <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> modelType = bindingContext.ModelMetadata.UnderlyingOrModelType;
    <span class="hljs-keyword">if</span> (NeedActivator(modelType))<font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> data = Activator.CreateInstance(modelType, moreData);<font></font>
        bindingContext.Result = ModelBindingResult.Success(data);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> model = bindingContext.HttpContext.Request.Method == <span class="hljs-string">"GET"</span><font></font>
                            ? GetModelFromQuery(bindingContext, modelType)<font></font>
                            : GetModelFromBody(bindingContext, modelType);<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (model <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"  "</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ignoreCase = StringComparison.InvariantCultureIgnoreCase;
    <span class="hljs-keyword">var</span> dataProperty = modelType.GetProperties()<font></font>
                            .FirstOrDefault(p =&gt; p.Name.Equals(<span class="hljs-keyword">typeof</span>(T).Name, ignoreCase));<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (dataProperty != <span class="hljs-literal">null</span>)<font></font>
    {<font></font>
        ForceSetValue(dataProperty, model, moreData);<font></font>
    }<font></font>
<font></font>
    bindingContext.Result = ModelBindingResult.Success(model);<font></font>
    <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»ç„¶éœ€è¦ä¿®å¤BinderProviderï¼Œä»¥ä¾¿å®ƒä»¥æ‰€éœ€çš„å±æ€§å“åº”ä»»ä½•ç±»ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoreDataBinderProvider</span> : <span class="hljs-title">IModelBinderProvider</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IModelBinder <span class="hljs-title">GetBinder</span>(<span class="hljs-params">ModelBinderProviderContext context</span>)</span><font></font>
    {<font></font>
       <span class="hljs-keyword">var</span> modelType = context.Metadata.UnderlyingOrModelType;
       <span class="hljs-keyword">if</span> (HasDataProperty(modelType))<font></font>
       {<font></font>
           <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BinderTypeModelBinder(<span class="hljs-keyword">typeof</span>(PrivateDataBinder&lt;MoreData&gt;));<font></font>
       }<font></font>
       <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<font></font>
    }<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">HasDataProperty</span>(<span class="hljs-params">IReflect modelType</span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> propFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance;
        <span class="hljs-keyword">var</span> properties = modelType.GetProperties(propFlags);<font></font>
<font></font>
        <span class="hljs-keyword">return</span> properties.Select(p =&gt; p.Name) .Contains(<span class="hljs-keyword">nameof</span>(MoreData));<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°±è¿™æ ·ã€‚</font><font style="vertical-align: inherit;">äº‹å®è¯æ˜ï¼Œæ´»é¡µå¤¹æ¯”ç®€å•æ¨¡å¼ä¸‹è¦å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰æ§åˆ¶å™¨çš„æ‰€æœ‰æ–¹æ³•ä¸­ç»‘å®šâ€œå¤–éƒ¨â€å±æ€§ï¼Œè€Œæ— éœ€ä»˜å‡ºé¢å¤–çš„åŠªåŠ›ã€‚</font><font style="vertical-align: inherit;">ç¼ºç‚¹ï¼š</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…·æœ‰ç§æœ‰å­—æ®µçš„å¯¹è±¡çš„æ„é€ å‡½æ•°å¿…é¡»æŒ‡å®š[JsonConstrustor]å±æ€§ã€‚</font><font style="vertical-align: inherit;">ä½†è¿™å®Œå…¨ç¬¦åˆæ¨¡å‹çš„é€»è¾‘ï¼Œå¹¶ä¸”ä¸ä¼šå¹²æ‰°æ¨¡å‹çš„æ„ŸçŸ¥ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æŸä¸ªåœ°æ–¹ï¼Œæ‚¨å¯èƒ½éœ€è¦ä»å¤´æ–‡ä»¶ä¸­è·å–MoreDataã€‚</font><font style="vertical-align: inherit;">ä½†è¿™é€šè¿‡åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å¤„ç†ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å›¢é˜Ÿçš„å…¶ä»–æˆå‘˜å¿…é¡»æ„è¯†åˆ°é­”æœ¯çš„å­˜åœ¨ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯æ–‡æ¡£å°†æŒ½æ•‘äººæ€§ã€‚</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç”Ÿæˆçš„æ´»é¡µå¤¹çš„å®Œæ•´åˆ—è¡¨åœ¨è¿™é‡Œï¼š</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrivateMoreDataBinder.cs</font></font></b><div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PrivateDataBinder</span>&lt;T&gt; : <span class="hljs-title">IModelBinder</span><font></font>
    {<font></font>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span><span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="bindingContext"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">BindModelAsync</span>(<span class="hljs-params">ModelBindingContext bindingContext</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> moreData = GetFromHeaderAndDecode(bindingContext.HttpContext.Request.Headers);
            <span class="hljs-keyword">if</span> (moreData == <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">var</span> modelType = bindingContext.ModelMetadata.UnderlyingOrModelType;
            <span class="hljs-keyword">if</span> (NeedActivator(modelType))<font></font>
            {<font></font>
                <span class="hljs-keyword">var</span> data = Activator.CreateInstance(modelType, moreData);<font></font>
                bindingContext.Result = ModelBindingResult.Success(data);<font></font>
<font></font>
                <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">var</span> model = bindingContext.HttpContext.Request.Method == <span class="hljs-string">"GET"</span><font></font>
                            ? GetModelFromQuery(bindingContext, modelType)<font></font>
                            : GetModelFromBody(bindingContext, modelType);<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (model <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"  "</span>);<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">var</span> ignoreCase = StringComparison.InvariantCultureIgnoreCase;
            <span class="hljs-keyword">var</span> dataProperty = modelType.GetProperties()<font></font>
                                        .FirstOrDefault(p =&gt; p.Name.Equals(<span class="hljs-keyword">typeof</span>(T).Name, ignoreCase));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (dataProperty != <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                ForceSetValue(dataProperty, model, moreData);<font></font>
            }<font></font>
<font></font>
            bindingContext.Result = ModelBindingResult.Success(model);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> Task.CompletedTask;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromQuery(ModelBindingContext bindingContext,<font></font>
                                                 Type modelType)<font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> valuesDictionary = QueryHelpers.ParseQuery(bindingContext.HttpContext.Request.QueryString.Value);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> jsonDictionary = valuesDictionary.ToDictionary(pair =&gt; pair.Key, pair =&gt; pair.Value.Count &lt; <span class="hljs-number">2</span> ? pair.Value.ToString() : <span class="hljs-string">$"[<span class="hljs-subst">{pair.Value}</span>]"</span>);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> jsonStr = JsonConvert.SerializeObject(jsonDictionary)<font></font>
                                     .Replace(<span class="hljs-string">"\"["</span>, <span class="hljs-string">"["</span>)<font></font>
                                     .Replace(<span class="hljs-string">"]\""</span>, <span class="hljs-string">"]"</span>);<font></font>
<font></font>
            <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonStr, modelType);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> data;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span>? GetModelFromBody(ModelBindingContext bindingContext,<font></font>
                                                Type modelType)<font></font>
        {<font></font>
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> StreamReader(bindingContext.HttpContext.Request.Body);
            <span class="hljs-keyword">var</span> jsonString = reader.ReadToEnd();
            <span class="hljs-keyword">var</span> data = JsonConvert.DeserializeObject(jsonString, modelType);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> data;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">NeedActivator</span>(<span class="hljs-params">IReflect modelType</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> propFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance;
            <span class="hljs-keyword">var</span> properties = modelType.GetProperties(propFlags);<font></font>
<font></font>
            <span class="hljs-keyword">return</span> properties.Select(p =&gt; p.Name).Distinct().Count() == <span class="hljs-number">1</span>;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ForceSetValue</span>(<span class="hljs-params">PropertyInfo propertyInfo, <span class="hljs-keyword">object</span> obj, <span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> propName = <span class="hljs-string">$"&lt;<span class="hljs-subst">{propertyInfo.Name}</span>&gt;k__BackingField"</span>;
            <span class="hljs-keyword">var</span> propFlags = BindingFlags.Instance | BindingFlags.NonPublic;<font></font>
            <font></font>
            obj.GetType().GetField(propName, propFlags)?.SetValue(obj, <span class="hljs-keyword">value</span>);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> T <span class="hljs-title">GetFromHeaderAndDecode</span>(<span class="hljs-params">IHeaderDictionary headers</span>)</span> { <span class="hljs-keyword">return</span> (T)Activator.CreateInstance(<span class="hljs-keyword">typeof</span>(T), <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { <span class="hljs-string">"ok"</span> }); }<font></font>
    }<font></font>
</code></pre><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN492806/index.html">å¦‚ä½•å°†å‚ä¸åº¦ä¸æ‰‹æœºæ¸¸æˆå’Œåº”ç”¨ä¸­çš„è·åˆ©è”ç³»èµ·æ¥</a></li>
<li><a href="../zh-CN492808/index.html">åº”æ€¥ç¯å¼€å…³ä½ç½®ä¼ æ„Ÿå™¨</a></li>
<li><a href="../zh-CN492810/index.html">[COVID-19]æ‚¨çš„ä»»åŠ¡æ˜¯å¹³æ»‘å³°</a></li>
<li><a href="../zh-CN492812/index.html">å°è¯•åœ¨OpenVINOä¸­è¿è¡ŒGANç½‘ç»œ</a></li>
<li><a href="../zh-CN492816/index.html">IntelliJ IDEAæŠ€å·§å’Œçªé—¨ï¼š4.åŒæ­¥å’Œå…±äº«è®¾ç½®</a></li>
<li><a href="../zh-CN492822/index.html">CSSå¼€å‘äººå‘˜-ä¸ºä»€ä¹ˆä¸–ç•Œéœ€è¦å®ƒä»¬ï¼Ÿ</a></li>
<li><a href="../zh-CN492828/index.html">å¦‚ä½•åœ¨ä¸€ä¸ªå°é—­çš„ä¸–ç•Œä¸­ç”Ÿå­˜</a></li>
<li><a href="../zh-CN492830/index.html">é»˜è®¤æƒ…å†µä¸‹ï¼ŒSameSite = Lax-å·²åœ¨Chrome 80ç¨³å®šç‰ˆä¸­è¿è¡Œï¼ˆå°½ç®¡å¹¶éæ‰€æœ‰äººï¼‰</a></li>
<li><a href="../zh-CN492832/index.html">ç”¨äºåŸºäºi.MX6å’ŒLinuxçš„å·¥ä¸šåè®®çš„IoTç½‘å…³</a></li>
<li><a href="../zh-CN492834/index.html">LVMå’Œä¿„ç½—æ–¯å¥—å¨ƒæœ‰ä»€ä¹ˆå…±åŒç‚¹ï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>