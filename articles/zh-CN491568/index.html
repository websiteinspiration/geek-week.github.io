<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👹 🏉 👩‍❤️‍💋‍👨 使用Debian 10在笔记本电脑上的SOCKS中构建路由器 🤽 🅰️ 🌋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="整整一两年，主要是我推迟了这篇文章的发布-我已经发表了两篇文章，其中描述了使用Debian在普通笔记本电脑上的SOCKS中创建路由器的过程。
 
 但是，从那时起，稳定版的Debian已更新为Buster，足够多的人向我发送了个人请求以帮助进行配置，这意味着我以前的文章并不详尽。好吧，我自己猜想其中...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>使用Debian 10在笔记本电脑上的SOCKS中构建路由器</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491568/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整整一两年，主要是我推迟了这篇文章的发布-我已经发表了两篇文章，其中描述了使用Debian在普通笔记本电脑上的SOCKS中创建路由器的过程。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，从那时起，稳定版的Debian已更新为Buster，足够多的人向我发送了个人请求以帮助进行配置，这意味着我以前的文章并不详尽。好吧，我自己猜想其中提出的方法并没有完全揭示出配置Linux以在SOSKS中进行路由的所有复杂性。另外，它们是为Debian Stretch编写的，在升级到Buster之后，在systemd初始化系统中，我注意到服务交互的微小变化。是的，在文章本身中，我没有使用systemd-networked，尽管它最适合复杂的网络配置。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除了上述更改之外，我的配置中还添加了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd之类</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的服务-一种用于接入点虚拟化的服务，</font><font style="vertical-align: inherit;">用于同步本地网络客户端时间的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务，</font><font style="vertical-align: inherit;">用于加密DNS连接并禁用本地网络客户端上的广告的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及我提到的以前，</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networked</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于配置网络接口。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是这种路由器内部结构的最简单框图。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gy/eq/_f/gyeq_fcjwxnobupmbqn9b-hwqqk.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我提醒您，这些文章的周期目标是：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将所有OS连接以及与笔记本电脑位于同一网络上的所有设备的连接都路由到SOCKS。 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就我而言，笔记本电脑应保持完全移动。</font><font style="vertical-align: inherit;">就是说，有机会使用桌面环境，而不是绑定到物理位置。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一点涉及仅通过内置无线接口进行连接和路由。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好吧，当然，我们将尽我所能，创建详尽的指南，并分析适当的技术。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本文将考虑以下内容：</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混帐</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -下载tun2socks项目</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需的路由TCP流量袜子，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -一个脚本来自动使用虚拟接入点的配置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostapd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建并在系统上安装</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置无线和虚拟接口，静态路由表和数据包转发。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在系统上安装systemd服务，配置并启动虚拟访问点。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可选步骤：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntp-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置服务器以在虚拟访问点的客户端上同步时间。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加密DNS查询，将其路由到SOCKS并禁用本地网络的广告域。</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么要这样？</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是保护本地网络上的TCP连接的一种方法。主要优点是，如果未为原始连接建立通过原始网关的静态路由，则所有连接都将进入SOCKS。这意味着无需为本地网络上的单个程序或客户端指定SOCKS服务器的设置-默认情况下，它们都进入SOCKS，因为在我们指定相反的位置之前，它是默认网关。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实际上，我们将第二个加密路由器作为便携式计算机添加到原始路由器的前面，并使用原始路由器的Internet连接来处理便携式计算机已加密的SOCKS请求，进而路由和加密本地网络客户端的请求。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从提供商的角度来看，我们一直以加密的流量连接到同一台服务器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，所有设备都连接到笔记本电脑的虚拟访问点。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在你开始之前</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仓库中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
几乎所有配置都可用</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将tun2socks安装到系统中</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
只要您的计算机上有互联网，请下载所有必需的工具。</font></font><br>
<br>
<pre><code class="bash hljs">apt update</code></pre><br>
<pre><code class="bash hljs">apt install git make cmake</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下载badvpn软件包</font></font><br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/ambrop72/badvpn
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件夹将出现在您的系统上</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">创建一个单独的构建文件夹</font></font><br>
<br>
<pre><code class="bash hljs">mkdir badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
去找她</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> badvpn-build
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
建造</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><br>
<br>
<pre><code class="bash hljs">cmake ../badvpn -DBUILD_NOTHING_BY_DEFAULT=1 -DBUILD_TUN2SOCKS=1
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装到系统</font></font><br>
<br>
<pre><code class="bash hljs">make install
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-DBUILD_NOTHING_BY_DEFAULT =</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 </font><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">禁用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badvpn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库的所有组件的</font><i><font style="vertical-align: inherit;">汇编</font></i><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBUILD_TUN2SOCKS = 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在程序</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font><i><font style="vertical-align: inherit;">tun2socks</font></i><font style="vertical-align: inherit;">组件</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make </font></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">/ usr / local / bin / badvpn-tun2socks</font></i><font style="vertical-align: inherit;">上的系统上</font><font style="vertical-align: inherit;">安装</font><i><font style="vertical-align: inherit;">tun2socks</font></i><font style="vertical-align: inherit;">二进制文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在systemd中安装tun2socks服务</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下内容</font><font style="vertical-align: inherit;">
创建文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/system/tun2socks.service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">[Unit]<font></font>
Description=SOCKS TCP Relay<font></font>
<font></font>
[Service]<font></font>
ExecStart=/usr/<span class="hljs-built_in">local</span>/bin/badvpn-tun2socks --tundev tun2socks --netif-ipaddr 172.16.1.1 --netif-netmask 255.255.255.0 --socks-server-addr 127.0.0.1:9050<font></font>
<font></font>
[Install]<font></font>
WantedBy=multi-user.target<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--tundev-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受我们使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd- </font></font></i><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">networkd</font></b><font style="vertical-align: inherit;">初始化的虚拟接口的名称</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--netif- </font></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipaddr-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟接口连接到</font><font style="vertical-align: inherit;">的“路由器” </font><i><font style="vertical-align: inherit;">tun2sock的</font></i><font style="vertical-align: inherit;">网络地址</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最好制作一个单独的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留子网</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--socks-server-addr-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受一个套接字（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址：</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SOCKS服务器</font><i><font style="vertical-align: inherit;">端口</font></i><font style="vertical-align: inherit;">）。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您的SOCKS服务器需要身份验证，则可以指定</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--username</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--password参数</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，注册服务</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后打开</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> tun2socks</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在启动服务之前，我们将为其提供虚拟网络接口。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到系统联网</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
打开</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
禁用当前的网络服务。</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">disable</span> networking NetworkManager NetworkManager-wait-online</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkManager-wait-online</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一项服务，它会等待可用的网络连接，然后</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd会</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据网络的可用性继续启动其他服务。</font><font style="vertical-align: inherit;">当我们切换到模拟</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd时</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将其禁用</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们马上打开它：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> systemd-networkd-wait-online</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置无线网络接口</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为无线网络接口</font><font style="vertical-align: inherit;">
创建一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件</font></font><code>/etc/systemd/network/25-wlp6s0.network</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=wlp6s0<font></font>
<font></font>
[Network]<font></font>
Address=192.168.1.2/24<font></font>
IPMasquerade=yes<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是您的无线接口的名称。</font><font style="vertical-align: inherit;">用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令识别它</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPMasquerade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个指令，其中包括</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伪装</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和网络接口上的数据包转发。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负责为无线接口分配IP地址。</font><font style="vertical-align: inherit;">我们之所以静态地指定它，是因为使用等效指令</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP = yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在系统中创建一个默认网关。</font><font style="vertical-align: inherit;">这样，所有流量都将通过原始网关，而不是将来通过出色子网中的虚拟接口。</font><font style="vertical-align: inherit;">您可以使用以下命令检查当前的默认网关</font></font><pre><code class="bash hljs">ip r</code></pre></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为远程SOCKS服务器创建静态路由</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您的SOCKS服务器不是本地服务器，而是远程服务器，则需要为其创建静态路由。</font><font style="vertical-align: inherit;">为此，</font><font style="vertical-align: inherit;">请在创建的无线配置文件的末尾</font><font style="vertical-align: inherit;">添加“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">，其中包含以下内容：</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=0.0.0.0<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是原始访问点的默认网关或地址。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -SOCKS服务器地址。</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为systemd-networkd配置wpa_supplicant</font></font></h3><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到安全访问点。</font><font style="vertical-align: inherit;">当您尝试“提升”无线接口时，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动服务</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是无线接口的名称。</font><font style="vertical-align: inherit;">如果您</font><font style="vertical-align: inherit;">在此之前</font><font style="vertical-align: inherit;">尚未使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networked</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则可以肯定该服务在您的系统上不可用。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，使用以下命令创建它：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> wpa_supplicant@wlp6s0</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用作无线接口的名称。</font><font style="vertical-align: inherit;">您的名字可能不同。</font><font style="vertical-align: inherit;">你可以找到他的团队</font></font><pre><code class="bash hljs">ip l</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，创建的服务</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_supplicant @ wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在“解除”无线接口时启动，但是，它将依次在文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / wpa_supplicant / wpa_supplicant-wlp6s0中查找</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问点的SSID和密码设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，必须使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpa_passphrase</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序创建它</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，请运行以下命令：</font></font><br>
<br>
<pre><code class="bash hljs">wpa_passphrase SSID password&gt;/etc/wpa_supplicant/wpa_supplicant-wlp6s0.conf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其中，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是访问点的名称，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是密码，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wlp6s0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是无线接口的名称。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化tun2socks的虚拟接口</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建一个文件来初始化系统</font><i><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.netdev中</font></i><font style="vertical-align: inherit;">的新虚拟接口</font></font><i><font style="vertical-align: inherit;"></font></i><br>
<br>
<pre><code class="bash hljs">[NetDev]<font></font>
Name=tun2socks<font></font>
Kind=tun<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始化时将分配给将来的虚拟接口</font><font style="vertical-align: inherit;">的名称</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实物</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种虚拟接口。</font><font style="vertical-align: inherit;">根据</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务的名称</font><font style="vertical-align: inherit;">，您可以猜测它使用了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的接口</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd- </font></font></i><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">networkd</font></b><font style="vertical-align: inherit;">用于初始化虚拟网络接口</font><font style="vertical-align: inherit;">的文件扩展名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些接口的地址和其他网络设置在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">中指定</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建一个</font><font style="vertical-align: inherit;">包含以下内容</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-tun2socks.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=tun2socks<font></font>
<font></font>
[Network]<font></font>
Address=172.16.1.2/24<font></font>
Gateway=172.16.1.1<font></font>
</code></pre><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -您在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netdev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">指定的虚拟接口的名称</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -分配给虚拟接口的IP地址。</font><font style="vertical-align: inherit;">必须与您在</font><i><font style="vertical-align: inherit;">tun2socks中</font></i><font style="vertical-align: inherit;">指定的地址位于同一网络上</font></font><i><font style="vertical-align: inherit;"></font></i></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><font style="vertical-align: inherit;">创建</font><i><font style="vertical-align: inherit;">systemd</font></i><font style="vertical-align: inherit;">服务时指定</font><font style="vertical-align: inherit;">的“路由器” </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2sock</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的IP地址</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的地址为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font><font style="vertical-align: inherit;">的地址</font><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即它是虚拟接口中所有连接的网关。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置虚拟访问点</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
安装依赖项：</font></font><br>
<br>
<pre><code class="bash hljs">apt install util-linux procps hostapd iw haveged</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库下载</font><font style="vertical-align: inherit;">到您的计算机上：</font></font><br>
<br>
<pre><code class="bash hljs">git <span class="hljs-built_in">clone</span> https://github.com/oblique/create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
转到计算机上的存储库文件夹：</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> create_ap</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在系统中安装：</font></font><br>
<br>
<pre><code class="bash hljs">make install</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
config </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/create_ap.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将出现在您的系统上</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下是主要的编辑选项：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关= 10.0.0.1-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最好创建一个单独的保留子网。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNS = 1-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭，因为此参数将由虚拟systemd网络接口控制。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NO_DNSMASQ = 1-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于相同的原因关闭。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WIFI_IFACE = wlp6s0-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记本电脑的无线接口。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTERNET_IFACE = tun2socks&gt;</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的虚拟接口</font><font style="vertical-align: inherit;">。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSID = hostapd-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟访问点的名称。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PASSPHRASE = 12345678-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
记住要启用该服务：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl <span class="hljs-built_in">enable</span> create_ap</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在systemd-networkd中启用DHCP服务器</font></font></h3><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">create_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
服务</font><font style="vertical-align: inherit;">将初始化</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的</font><i><font style="vertical-align: inherit;">ap0</font></i><font style="vertical-align: inherit;">虚拟接口</font><font style="vertical-align: inherit;">。从理论上讲，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnsmasq</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挂在此接口上</font><font style="vertical-align: inherit;">，但是如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含内置DHCP服务器</font><font style="vertical-align: inherit;">，为什么还要安装额外的服务</font><font style="vertical-align: inherit;">？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要启用它，请定义虚拟点的网络设置。为此，请创建</font><font style="vertical-align: inherit;">具有以下内容</font><font style="vertical-align: inherit;">的文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-ap0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">[Match]<font></font>
Name=ap0<font></font>
<font></font>
[Network]<font></font>
Address=10.0.0.1/24<font></font>
DHCPServer=yes<font></font>
<font></font>
[DHCPServer]<font></font>
EmitDNS=yes<font></font>
DNS=10.0.0.1<font></font>
EmitNTP=yes<font></font>
NTP=10.0.0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
服务</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sreate_ap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化虚拟接口</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap0后</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-NetworkD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动分配IP地址并启用DHCP服务器。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
线</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitDNS = YES</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过DNS服务器设置到连接到接入点的设备。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您不打算使用本地DNS服务器-在我的情况下为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 10.0.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是原始网关的地址。然后，您的主机和本地网络的DNS查询将不会通过提供商的服务器进行加密。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmitNTP =是</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTP = 192.168.1.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发射的NTP设置。</font><b><font style="vertical-align: inherit;">NTP = 10.0.0.1</font></b></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
行也是如此</font><font style="vertical-align: inherit;">。</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置NTP服务器</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在系统中安装：</font></font><br>
<br>
<pre><code class="bash hljs">apt install ntp
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编辑配置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/ntp.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">注释掉标准池的地址：</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#pool 0.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 1.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 2.debian.pool.ntp.org iburst</span>
<span class="hljs-comment">#pool 3.debian.pool.ntp.org iburst</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
添加公用服务器的地址，例如Google Public NTP：</font></font><br>
<br>
<pre><code class="bash hljs">server time1.google.com ibrust<font></font>
server time2.google.com ibrust<font></font>
server time3.google.com ibrust<font></font>
server time4.google.com ibrust<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
向您的网络中的客户端授予对服务器的访问权限：</font></font><br>
<br>
<pre><code class="bash hljs">restrict 10.0.0.0 mask 255.255.255.0
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将广播变成您的网络：</font></font><br>
<br>
<pre><code class="bash hljs">broadcast 10.0.0.255
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，将这些服务器的地址添加到静态路由表中。</font><font style="vertical-align: inherit;">为此，请打开无线配置文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/systemd/network/25-wlp6s0.network</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并在末尾添加</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="bash hljs">[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.0<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.4<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.8<font></font>
<font></font>
[Route]<font></font>
Gateway=192.168.1.1<font></font>
Destination=216.239.35.12</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序找到NTP服务器的地址，</font><font style="vertical-align: inherit;">如下所示：</font></font><br>
<br>
<pre><code class="bash hljs">host time1.google.com</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，删除广告并向提供商隐藏DNS流量</font></font></h2><br>
<pre><code class="bash hljs">apt install dnscrypt-proxy</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要为主机和本地网络的DNS查询提供服务，请编辑套接字</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/lib/systemd/system/dnscrypt-proxy.socket</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">更改以下行：</font></font><br>
<br>
<pre><code class="bash hljs">ListenStream=0.0.0.0:53<font></font>
ListenDatagram=0.0.0.0:53</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重新启动</font></font><code>systemd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl daemon-reload</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编辑配置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/dnscrypt-proxy/dnscrypt-proxy.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">server_names = [<span class="hljs-string">'adguard-dns'</span>]
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由dnscrypt-proxy连接</font><font style="vertical-align: inherit;">，请添加以下内容：</font></font><br>
<br>
<pre><code class="bash hljs">force_tcp = <span class="hljs-literal">true</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编辑</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/resolv.conf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该配置</font><font style="vertical-align: inherit;">将DNS服务器告知主机。</font></font><br>
<br>
<pre><code class="bash hljs">nameserver 127.0.0.1<font></font>
nameserver 192.168.1.1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一行包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的使用</font><font style="vertical-align: inherit;">，第二行-使用原始网关，以防</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font><font style="vertical-align: inherit;">不可用。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">做完了！</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重新启动或停止现有的网络服务：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl stop networking NetworkManager NetworkManager-wait-online</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并重新启动所有必要的命令：</font></font><br>
<br>
<pre><code class="bash hljs">systemctl restart systemd-networkd tun2socks create_ap dnscrypt-proxy ntp</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
重新启动或重新启动后，您将拥有另一个将主机和LAN设备路由到SOCKS的访问点。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这就是输出的样子。</font></font><pre><code class="bash hljs">ip a</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 普通笔记本电脑：</font></font><br>
<br>
<pre><code class="bash hljs">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<font></font>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<font></font>
    inet 127.0.0.1/8 scope host lo<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 ::1/128 scope host <font></font>
       valid_lft forever preferred_lft forever<font></font>
2: tun2socks: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 500<font></font>
    link/none <font></font>
    inet 172.16.1.2/24 brd 172.16.1.255 scope global tun2socks<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::122b:260:6590:1b0e/64 scope link stable-privacy <font></font>
       valid_lft forever preferred_lft forever<font></font>
3: enp4s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000<font></font>
    link/ether e8:11:32:0e:01:50 brd ff:ff:ff:ff:ff:ff<font></font>
4: wlp6s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:85 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 192.168.1.2/24 brd 192.168.1.255 scope global wlp6s0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf85/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
5: ap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<font></font>
    link/ether 4c:ed:de:cb:cf:86 brd ff:ff:ff:ff:ff:ff<font></font>
    inet 10.0.0.1/24 brd 10.0.0.255 scope global ap0<font></font>
       valid_lft forever preferred_lft forever<font></font>
    inet6 fe80::4eed:deff:fecb:cf86/64 scope link <font></font>
       valid_lft forever preferred_lft forever<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终</font></font></h2><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供程序仅看到与您的SOCKS服务器的加密连接，这意味着它看不到任何内容。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是他仍然看到您的NTP请求，为防止这种情况，请删除NTP服务器的静态路由。</font><font style="vertical-align: inherit;">但是，SOCKS服务器允许NTP并不是事实。</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debain 10上看到的拐杖</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果尝试从控制台重新启动网络服务，它将失败并显示错误。</font><font style="vertical-align: inherit;">这是由于以下事实：虚拟接口形式的一部分与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务相关联</font><font style="vertical-align: inherit;">，这意味着已使用它。</font><font style="vertical-align: inherit;">要重新启动网络服务，必须首先停止</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tun2socks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，我认为，如果您读到最后，对您来说绝对不是问题！</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h4><br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux上的静态路由-IBM</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd-networkd.service-Freedesktop.org</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tun2socks Ambrop72 / Badvpn维基github</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">斜/ create_ap：此脚本创建NATed或桥接的WiFi接入点。</font></font></a><br>
 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt-proxy 2-灵活的DNS代理，支持加密的DNS协议。</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN491558/index.html">查找更多的复活节彩蛋：从神秘的讯息到打电话洗手和做家庭作业的信息</a></li>
<li><a href="../zh-CN491560/index.html">如何使航站楼成为您的助手，而不是敌人？</a></li>
<li><a href="../zh-CN491562/index.html">FOSS新闻6-2020年3月2日至8日免费和开源新闻的回顾</a></li>
<li><a href="../zh-CN491564/index.html">Java 14：记录，更简洁的instanceof，jpackage包装器，开关lambda和文本块</a></li>
<li><a href="../zh-CN491566/index.html">使用mlr3软件包的R语言机器学习</a></li>
<li><a href="../zh-CN491570/index.html">为什么ICQ在购买Mail.Ru之后失去了一个古老的用户</a></li>
<li><a href="../zh-CN491572/index.html">上周第405期（2020年3月2日至8日）来自前端世界的新鲜材料摘要</a></li>
<li><a href="../zh-CN491574/index.html">管理拖延的简单技巧</a></li>
<li><a href="../zh-CN491576/index.html">作为图神经网络的变压器</a></li>
<li><a href="../zh-CN491584/index.html">＃336移动开发人员的有趣材料摘要（3月2日至9日）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>