<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕙 🕐 🐉 Sportmasterでのキャッシングシステムの選択方法。パート1 🌦️ 🧒🏻 👨🏼‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！私の名前はアレクセイ・ピャンコフです。私はスポーツマスターの開発者です。この投稿では、2012年にSportmasterのWebサイトでの作業がどのように始まったのか、どのようなイニシアチブを押し通すことができたのか、またその逆に、収集したレーキについて話しました。
 
 今日、私は別の...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sportmasterでのキャッシングシステムの選択方法。パート1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/490912/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！私の名前はアレクセイ・ピャンコフです。私はスポーツマスターの開発者です。この</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">投稿で</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、2012年にSportmasterのWebサイトでの作業がどのように始まったのか、どのようなイニシアチブを押し通すことができたのか、またその逆に、収集したレーキについて話しました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日、私は別の話に続く考えを共有したいと思います-サイトの管理パネルでJavaバックエンド用のキャッシュシステムを選択します。この筋書きは私にとって特に重要です-物語は2か月しか行われませんでしたが、この60日間は休みなく12〜16時間働きました。私はあなたがそんなに働くことができるとは考えも想像もしていませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、完全にダウンロードしないように、テキストを2つの部分に分割します。それどころか、最初の部分は非常に簡単です-準備、紹介、キャッシングとは何かについての考慮事項。あなたがすでに経験豊富な開発者であるか、キャッシュを使用したことがある場合-技術的な面から見ると、この記事に新しいものはほとんどありません。しかし、ジュニアにとっては、そのような小さな岐路のレビューは、彼がそのような岐路にいることに気付いた場合に、どのように見るかを伝えることができます。</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><img src="https://habrastorage.org/webt/c-/8-/z5/c-8-z5hphf6b0qo46ruj5mdf1vc.png"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sportmaster Webサイトの新しいバージョンが運用開始されたとき、データは、適度にではなく、あまり便利ではない方法で提供されました。基本は、ETLで強化する必要があったサイトの以前のバージョン（Bitrix）用に準備されたテーブルであり、新しい外観をもたらし、数十のシステムからのさまざまな小さなことで強化されました。新しい画像または製品の説明がサイトに表示されるようにするには、翌日まで待つ必要がありました-更新は夜間のみで、1日1回です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初は、プロダクションに入ってから最初の数週間で非常に多くの心配があり、コンテンツ管理者にとってそのような不便はささいなことでした。しかし、すべてが落ち着くとすぐに、プロジェクトの開発は続きました-数か月後の2015年の初めに、私たちは積極的に管理パネルの開発を始めました。 2015年と2016年はすべて順調に進んでいます。定期的にリリースし、管理領域がデータ準備の大部分をカバーし、まもなく私たちのチームが最も重要で複雑なもの-商品回路（すべての商品のデータの完全な準備とメンテナンス）を任されるという事実に備えています。しかし、2017年の夏、製品ラインの発売直前に、プロジェクトは非常に困難な状況になります-まさにキャッシュの問題のためです。このエピソードについては、この2部構成の出版物の第2部でお話ししたいと思います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、この投稿では、いくつかの考えのように、遠くから始めます。大きなプロジェクトの前にスクロールするキャッシュについてのアイデアは、良いステップになるでしょう。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キャッシュタスクが発生したとき</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュタスクは表示されません。私たちは開発者であり、ソフトウェア製品を作成し、それを需要に応えたいと考えています。製品が需要があり成功している場合、ユーザーは到着します。そして、もっと来て、もっと。そのため、多くのユーザーがいて、製品の負荷が高くなります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の段階では、最適化とコードのパフォーマンスについては考えていません。主な機能は機能であり、パイロットをすばやく展開して仮説をテストします。そして、負荷が大きくなると、鉄を汲み上げます。 2倍、3倍、5倍に増やし、10倍にします。ここのどこかで-財政はもはや許さないでしょう。そして、ユーザーの数は何倍になるのでしょうか？それは2-5-10だけでなく、成功した場合、100-1000から100,000回までになります。つまり、遅かれ早かれ最適化を行う必要があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードの一部（この部分を関数と呼びましょう）が長期間にわたって機能し、実行時間を短縮したいとします。機能-データベースへのアクセスであり、複雑なロジックの実行である可能性があります-主なことは、時間がかかることです。リードタイムをどれだけ削減できますか？限界では-ゼロに減らすことができ、それ以上はできません。そして、どのようにしてランタイムをゼロに減らすことができますか？回答：通常、実行を除外します。代わりに、すぐに結果を返します。そして、どのように結果を知っていますか？回答：計算するか、どこかを見てください。計算は長い時間です。そして、のぞき見とは、たとえば、同じパラメーターで呼び出されたときに関数が前回生成した結果を思い出すことです。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、関数の実装は重要ではありません。</font><font style="vertical-align: inherit;">結果がどのパラメーターに依存するかを知ることで十分です。</font><font style="vertical-align: inherit;">次に、パラメーター値が何らかのストレージでキーとして使用できるオブジェクトの形式で提示されている場合、計算結果を保存して、次回それを読み取ることができます。</font><font style="vertical-align: inherit;">これらの読み書きの結果が関数の実行よりも速い場合は、速度に利益があります。</font><font style="vertical-align: inherit;">利益値は100、1000、および10万倍に達する可能性があります（10 ^ 5は例外である可能性が高いですが、かなり遅れているベースの場合、それはかなり可能です）。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要なキャッシュ要件</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシングシステムの要件となる可能性のある最初のことは、読み取り速度が速いことと、多少程度は低いが書き込み速度です。これはそうですが、システムを運用環境に展開するまでの間だけです。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そんなケースで遊びましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の負荷に鉄を提供し、今は徐々にキャッシングを導入するとします。ユーザーは少しずつ増え、負荷も増えています-キャッシュを少し追加し、あちこちで固定しています。これはしばらく前から続いており、現在は重い関数が呼び出されることはありません。主な負担はすべてキャッシュにあります。この間のユーザー数はN倍に増加しています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、鉄の初期供給量が2〜5倍になる可能性がある場合、キャッシュの助けを借りて、生産性を10ごとに、場合によっては100ごとに、場合によっては1000にまで強化することができます。つまり、同じ鉄の上で100倍のリクエスト。すばらしい、ジンジャーブレッドに値する！</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、今、ある時点で、誤ってシステムがクラッシュし、キャッシュがクラッシュしました。特別なことは何もありません-結局のところ、キャッシュはオンデマンドで選択されました。「高速な読み取りと書き込み、残りは問題ではありません」。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
始動時の負荷については、鉄の埋蔵量は2〜5倍で、この間の負荷は10〜100倍に増加しました。キャッシュを利用して、重い関数の呼び出しを排除し、すべてが飛んでしまいました。そして今、キャッシュなしで-私たちのシステムは何回サグしますか？私たちに何が起こりますか？システムが落ちます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシュがクラッシュしなかったとしても、しばらくしかクリアされなかったとしても、ウォームアップする必要があり、これにはしばらく時間がかかります。</font><font style="vertical-align: inherit;">そして現時点では-主な負担は機能にかかります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結論：本番環境の高負荷プロジェクトでは、キャッシングシステムに高速の読み取りと書き込みだけでなく、データの安全性と障害に対する耐性も必要です。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">選択の小麦粉</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
管理パネルを使用したプロジェクトでは、選択は次のように行われました。最初にHazelcastを配置しました。</font><font style="vertical-align: inherit;">メインサイトの経験からこの製品に既に慣れていました。</font><font style="vertical-align: inherit;">しかし、ここではこの選択は失敗しました-負荷プロファイルでは、Hazelcastの動作は遅いだけでなく、ひどくゆっくりです。</font><font style="vertical-align: inherit;">そのとき、私たちはすでに製品への撤退の条件にサインアップしました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネタバレ：そのようなプロップを逃し、深刻で緊迫した状況が発生した状況はどのように正確に発生しました-私は2番目のパートで説明します-そして私たちはどのように判明し、どのようにして脱出したかを説明します。</font><font style="vertical-align: inherit;">しかし、今、私はそれが多くのストレスであったとだけ言い、そして「考えて-どういうわけか私は考えていない、ボトルを振る」。</font><font style="vertical-align: inherit;">「ボトルを振る」もネタバレになるので、これについてもう少し。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちは何をしましたか：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">googleとStackOverflowによって促されたすべてのシステムのリストを作成します。</font><font style="vertical-align: inherit;">30強</font></font></li>
<li>   ,   .    ,      - —       ,   .      </li>
<li> ,      , ,  .   ,    – ,     .</li>
<li> 17-   ,   .  « »,   .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これは、事前に準備されたテストで「高速でクロール」するシステムを選択する必要がある場合のオプションです。そして、そのようなテストがまだなく、より速く選択したい場合はどうなりますか？</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはそのようなオプションをシミュレートします（中間+開発者が孤立していると想像することは困難であり、選択の時点で彼は最初にどの製品を試すかをまだ決定していませんでした。したがって、さらなる議論はおそらく理論家/哲学/後輩についてです）。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要件を決定したら、ボックスからソリューションを選択し始めます。なぜ車輪を再発明するのか：既製のキャッシュシステムを使用します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたが始めたばかりでグーグルするなら、順序をプラスまたはマイナスしますが、一般的にはガイドラインはそのようになります。</font><font style="vertical-align: inherit;">まず第一に、あなたはRedisにつまずく、それはどこでも聞かれる。</font><font style="vertical-align: inherit;">次に、最も古く、最も実績のあるシステムとしてEhCacheがあることがわかります。</font><font style="vertical-align: inherit;">次に、ソリューションの独自の側面がある国内開発であるTarantoolについて書かれます。</font><font style="vertical-align: inherit;">また、Igniteも人気を博し、SberTechのサポートを享受しています。</font><font style="vertical-align: inherit;">結局のところ、企業の世界では大企業の真っ只中で点滅することが多いため、Hazelcastがあります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このリストはこれで終わりではなく、何十ものシステムがあります。</font><font style="vertical-align: inherit;">そして私達は1つだけねじ込みます。</font><font style="vertical-align: inherit;">選ばれた5つのシステムを「美容コンテスト」に採択し、選考を行います。</font><font style="vertical-align: inherit;">誰が勝者になりますか？</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼らが書いたものを公式ウェブサイトで読みます。</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はオープンソースプロジェクトです。</font><font style="vertical-align: inherit;">インメモリデータストレージ、ディスク上の自動保存機能、パーティションへの自動パーティション機能、高可用性、ネットワーク障害からの回復を提供します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはすべてうまくいくようです、あなたはそれを取り、それをねじ込むことができます-彼が必要とするすべては彼がすることです。</font><font style="vertical-align: inherit;">しかし、他の候補者の興味を引くためだけに見てみましょう。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イーキャッシュ</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EhCache-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「Javaで最も広く使用されているキャッシュ」（公式サイトからのスローガンの翻訳）。</font><font style="vertical-align: inherit;">また、オープンソース。</font><font style="vertical-align: inherit;">ここでは、RedisはJavaの下ではなく、一般的なものであることを理解しています。これを操作するには、ラッパーが必要です。</font><font style="vertical-align: inherit;">そしてEhCacheはより便利になります。</font><font style="vertical-align: inherit;">システムは他に何を約束しますか？</font><font style="vertical-align: inherit;">信頼性、実績、フル機能。</font><font style="vertical-align: inherit;">まあ、そして彼女は最も一般的です。</font><font style="vertical-align: inherit;">テラバイトのデータをキャッシュします。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redisは忘れられました。EhCacheを選択する準備ができました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、愛国心が私をタランツールの良いところに追い込みます。</font></font><br>
 <br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タランツール</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tarantool-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「リアルタイムデータ統合プラットフォーム」の指定を満たしています。それは非常に難しいように聞こえるので、ページを詳細に読んだところ、「データをRAMに100％キャッシュする」という大きな声が出ました。これは疑問を投げかけます-結局のところ、メモリよりもはるかに多くのデータがある可能性があります。復号化とは、ここでは、Tarantoolがメモリからディスクにデータを書き込むためのシリアル化を実行しないことを意味します。代わりに、メモリが単純に非常に優れたI / Oパフォーマンスのファイルシステムにマップする場合、低レベルのシステム機能を使用します。一般的に、彼らはそれをどうにかして素晴らしくてクールにしました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装を見てみましょう：Mail.ru企業高速道路、Avito、Beeline、Megafon、Alfa-Bank、Gazprom ...</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolについてまだ疑問がある場合は、Mastercardの実装の導入で私は死にます。</font><font style="vertical-align: inherit;">タランツールを服用します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
とにかく…</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点火する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... </font><font style="vertical-align: inherit;">「インメモリコンピューティングプラットフォーム...ペタバイトのデータでのメモリ内速度」として宣言された</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ここには多くの利点があります。分散インメモリキャッシュ、最速のキー値ストレージとキャッシュ、水平スケーリング、高可用性、厳密な整合性。</font><font style="vertical-align: inherit;">一般に、最も速いのはIgniteです。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実装：Sberbank、アメリカン航空、Yahoo！</font><font style="vertical-align: inherit;">日本 </font><font style="vertical-align: inherit;">そして、IgniteがSberbankに実装されているだけでなく、SberTechチームがその従業員をIgnite自体のチームに送り、製品を完成させていることがわかります。</font><font style="vertical-align: inherit;">これは完全に魅惑的で、Igniteを使用する準備ができています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
なぜか完全に理解できないので、5点目を見てみます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘーゼルキャスト</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ヘーゼルキャストの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ウェブサイトに行き</font><font style="vertical-align: inherit;">、それを読んでください。</font><font style="vertical-align: inherit;">そして、分散キャッシングの最速のソリューションはHazelcastであることがわかりました。</font><font style="vertical-align: inherit;">彼は他のすべてのソリューションよりも桁違いに速く、一般に彼はインメモリデータグリッドの分野のリーダーです。</font><font style="vertical-align: inherit;">この背景に対して、何か他のものを取る-自分を尊重しないでください。</font><font style="vertical-align: inherit;">また、冗長データストレージを使用して、データを失うことなくクラスターを継続的に運用します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべて、私はヘーゼルキャストを取る準備ができています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比較</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、見てみると、5人の候補者全員が非常に塗られているため、それぞれが最高です。選ぶ方法は？最も人気のあるものを確認し、比較を探すと、頭痛がなくなります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">レビュー</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を見つけ</font><font style="vertical-align: inherit;">、5つのシステムを選択します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/r8/ix/gi/r8ixgicyh9dc4wgwv7sl_prtxsi.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではそれらが並べ替えられています。Redisの一番上でHazelcastが2位で、TarantoolとIgniteが人気を博しています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、計算方法を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見てみましょう</font><font style="vertical-align: inherit;">：ウェブサイトへのリンク、システムへの一般的な関心、求人-素晴らしい！つまり、私のシステムが落ちたとき、私はこう言います。ここに多くの求人があります...」このような単純な比較は機能しません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのシステムはすべて、キャッシングシステムだけではありません。</font><font style="vertical-align: inherit;">データがクライアントに転送されて処理されない場合など、多くの機能がまだあります。データで実行する必要のあるコードがサーバーに移動し、そこで実行されて結果が返されます。</font><font style="vertical-align: inherit;">そして、キャッシングの独立したシステムとして、それらはあまり考慮されません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あきらめないでください。システムを直接比較しています。</font><font style="vertical-align: inherit;">上位2つのオプション-RedisとHazelcastを選択してください。</font><font style="vertical-align: inherit;">速度に興味があるので、このパラメータで比較できます。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hz対Redis</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比較が</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">見つかりました</font><font style="vertical-align: inherit;">。</font></font><br>
<img src="https://habrastorage.org/webt/vq/ue/l0/vquel0ijbidfqlj_iailrnfhzgg.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
青はRedis、赤はHazelcastです。</font><font style="vertical-align: inherit;">Hazelcastはどこでも勝ち、その根拠が与えられています。それはマルチスレッド化され、高度に最適化されており、各スレッドは独自のパーティションで動作するため、ロックはありません。</font><font style="vertical-align: inherit;">また、Redisはシングルスレッドであり、最新のマルチコアCPUから利益を得ることはありません。</font><font style="vertical-align: inherit;">Hazelcastには非同期I / Oがあり、Redis-Jedisにはブロッキングソケットがあります。</font><font style="vertical-align: inherit;">最終的に、Hazelcastはバイナリプロトコルを使用しますが、Redisはテキスト指向であるため、非効率的です。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
念のため、別の比較元を見てみましょう。</font><font style="vertical-align: inherit;">彼は私たちに何を見せますか？</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redis vs Hz</font></font></h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比較</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<img src="https://habrastorage.org/webt/70/ez/yp/70ezypii1cgalhogxc9jo7kmshk.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、逆に、赤はRedisです。</font><font style="vertical-align: inherit;">つまり、RedisはHazelcastよりもパフォーマンスが優れています。</font><font style="vertical-align: inherit;">最初の比較では、Hazelcastが勝ち、2番目の比較ではRedisです。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、前回の比較でHazelcastが勝った理由を非常に正確に説明しました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の結果は実際には不正であったことがわかります。Redisはベースボックスに入れられ、Hazelcastはテストケースのために投獄されました。</font><font style="vertical-align: inherit;">その後、それが判明します。1つは、誰も信頼できないこと、もう1つは、それでもシステムを選択した場合でも、正しく構成する必要があることです。</font><font style="vertical-align: inherit;">これらの設定には、数十、ほぼ数百のパラメータが含まれます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボトルを振る</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、私たちが今行ったプロセス全体について、そのような比喩で「ボトルを振る」と説明できます。つまり、今はプログラミングできません。主なことは、stackoverflowを読み取ることができるようになることです。そして私のチームには、重要な瞬間にそのように働く人、プロがいます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
彼は何をしているの？彼は壊れたものを見て、スタックトレースを見て、自分の単語の一部（プログラムでの彼の専門知識です）を取り、Googleで検索し、答えの間でスタックオーバーフローを見つけます。読んだり、考えたりせずに、質問への回答の中から-「これを実行してください」という文に最も類似したものを選択します（そのような回答を選択するのは彼の才能です。 、ルックス：何かが変更された場合は問題ありません。変更されていない場合は、ロールバックします。そして、スタートチェックチェックを繰り返します。そして、そのような直感的な方法で、彼はしばらくしてコードが機能するようになりました。彼はなぜなのか、自分が何をしたのか分からず、説明できません。だが！この感染は機能します。そして「消火」。今、私たちは私たちが何をしたかを理解しています。プログラムが機能するときは、はるかに簡単です。時間を大幅に節約します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この方法は、そのような例によって非常によく説明されています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
かつてはボトルにヨットを集めるのが人気でした。同時に、ヨットは大きくて壊れやすく、ボトルの首は非常に細く、中に入れることはできません。組み立て方は？</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/c-/8-/z5/c-8-z5hphf6b0qo46ruj5mdf1vc.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような方法があり、非常に高速で非常に効果的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
船は、棒、ロープ、帆、接着剤などの小さなものの束で構成されています。これらすべてをボトルに入れました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボトルを両手で取り、振とうします。私たちは揺れています。そして、通常-もちろん、あなたは完全なゴミを手に入れます。でも時々。時には船を手に入れます！より正確には、船のようなもの。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを誰かに見せています：「Serge、see！？」。そして確かに、遠くから-まるで船のように。しかし、これを手放すことはできません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
別の方法があります。彼らはハッカーのようなより高度なものを使用しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような人に仕事を与えて、彼はすべてをして、去りました。そして、あなたは見て-それが行われたようです。そしてしばらくして、コードを改良する必要があるとき-それが原因でそこから始まります...彼がすでに遠くまで走ることができたのは良いことです。これらは、ボトルの例を使用してこれを実行する人です：あなたは、底がどこにあるのか-ガラスが曲がっています。そして、それが透明であるかどうかは完全には明らかではありません。次に、「ハッカー」がこの底を切り取り、そこに船を挿入して、再び底を貼り付けます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を設定するという観点からは、すべてが正しいようです。しかし、ここに船の例があります。なぜこの船は一般的に、なぜそれを必要とするのでしょうか。機能はありません。通常、そのような船は、ある種のシンボルとして、自分の上の棚にそれを標識として置いた非常に高位の人々への贈り物です。そして今、そのような人、大企業の頭、または幹部高官がいる場合、フラグは首が切り取られたそのようなゴミにどう立ち向かうのでしょうか。彼がそれを知らなかった方がいいでしょう。では、これらの船はどうやって最終的に作られ、大切な人に贈ることができるのでしょうか？</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本当に何もすることがない唯一の場所、鍵は建物です。そして船の船体はちょうど首を通過します。一方、船は瓶の外に出ています。しかし、それは単に船を組み立てるだけでなく、本物のジュエリークラフトです。コンポーネントに特別なレバーが追加され、後で持ち上げることができます。たとえば、帆は折りたたまれ、そっとドリフトし、ピンセットの助けを借りてそれは非常に宝石です。確かに、帆は引っ張られて持ち上げられます。結果は、明確な良心と誇りをもって提示できる芸術作品です。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、プロジェクトを成功させるには、チームに少なくとも1人の宝石商が必要です。</font><font style="vertical-align: inherit;">製品の品質を気にし、状況が重要な要素の損害を緊急に必要とするとき、ストレスのときでも単一のものを犠牲にすることなく、すべての側面を考慮に入れる人。</font><font style="vertical-align: inherit;">持続可能で、時の試練に耐えてきたすべての成功したプロジェクトは、この原則に基づいて構築されています。</font><font style="vertical-align: inherit;">彼らは非常に正確でユニークな何か、利用可能なすべての機能を使用するものを持っています。</font><font style="vertical-align: inherit;">ボトルに入った船の例では、船の船体が首を通過していることがわかります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キャッシングサーバーを選択するタスクに戻って、この方法をどのように適用できますか？</font><font style="vertical-align: inherit;">私はすべてのシステムからこのようなオプションを提案します-ボトルを振るのではなく、選択しないでください。しかし、システムを選択するときに、原則として何を探すべきかを確認します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボトルネックを探す場所</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ボトルを振るのではなく、順番にすべてを整理するのではなく、自分のタスクで突然、どのようなタスクが発生するかを見てみましょう。そのようなシステムを自分で設計します。</font><font style="vertical-align: inherit;">もちろん、自転車の組み立ては行いませんが、このスキームを使用して、製品の説明で注意すべき点を特定します。</font><font style="vertical-align: inherit;">そのようなスキームの概要を説明します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d3/pk/uf/d3pkufjwip_flieqquuhgk-8jlm.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
システムが分散している場合、複数のサーバー（6）があります。</font><font style="vertical-align: inherit;">4つとしましょう（写真に配置すると便利ですが、もちろんいくつでもかまいません）。</font><font style="vertical-align: inherit;">サーバーが異なるノード上にある場合は、一部のコードがそれらすべてで回転していることを意味します。これは、これらのノードがクラスターを形成し、中断が発生した場合に接続し、お互いを認識することを保証する責任があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでも、実際にはキャッシュに関するコードロジック（2）が必要です。クライアントは、いくつかのAPIを介してこのコードと対話します。クライアントコード（1）は、同じJVM内に存在し、ネットワーク経由でアクセスできます。内部に実装されているロジックは、キャッシュに残すオブジェクト、スローするオブジェクトの決定です。メモリ（3）を使用してキャッシュを保存しますが、必要に応じて、データの一部をディスク（4）に保存することもできます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
負荷が発生する部分を見てみましょう。実際には、各矢印と各ノードが読み込まれます。まず、クライアントコードとAPIの間で、ネットワークの相互作用である場合、沈下が非常に顕著になります。次に、API自体のフレームワーク内で-複雑なロジックでオーバーライドされているため、CPUに実行できます。そして、ロジックがもう一度メモリを駆動しなかったら、それは良いことです。そして、ファイルシステムとの相互作用が残っています-通常のバージョンでは、シリアル化/復元され、書き込み/読み取りされます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターとのさらなる相互作用。ほとんどの場合、同じシステム内にありますが、別々にすることもできます。ここでは、データ転送、データのシリアル化の速度、およびクラスター間の相互作用についても考慮する必要があります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、一方では、コードからのリクエストを処理するときに、キャッシュシステムで「どのギアが回転するか」を想像できます。また、一方で、コードがこのシステムに対して生成するリクエストの数と数を見積もることができます。これは多かれ少なかれ冷静な選択をするのに十分です-私たちのユースケースのためのシステムを選択するために。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hazelcast</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この分解がどのように私たちのリストに適用されるか見てみましょう。たとえば、Hazelcast。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hazelcastからデータを取得/取得するために、クライアントコードはAPIにアクセスします（1）。 Hzを使用すると、サーバーを組み込みとして起動できます。この場合、APIへのアクセスはJVM内のメソッド呼び出しであり、無料で読み取ることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（2）のロジックを計算するために、Hzはシリアル化されたキーのバイト配列からのハッシュに依存します。つまり、キーのシリアル化はどのような場合でも発生します。これは、Hzの避けられないオーバーヘッドです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立ち退き戦略はうまく実装されていますが、特別な場合のために-あなた自身のものを接続することができます。この部分については、心配する必要はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストレージ（4）を接続できます。いいよ埋め込み用のインタラクション（5）は、瞬間的なものと見なすことができます。クラスター内のノード間のデータ交換（6）-はい、そうです。これは、速度を犠牲にして回復力に貢献します。ニアキャッシュのHz機能により、価格を下げることができます。クラスターの他のノードから受信したデータはキャッシュされます。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このような状況で速度を上げるために何ができるでしょうか？</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば、（2）でのキーのシリアル化を回避するには、Hazelcastの上に、最もホットなデータ用に別のキャッシュをねじ込みます。 Sportmasterでは、この目的のためにカフェインが選ばれました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レベル（6）でツイストする場合、HzはIMapとReplicatedMapの2種類のストレージを提供します。</font></font><br>
<img src="https://habrastorage.org/webt/t_/_a/ie/t__aieqdprk1bzb_ac_qpuvn7ro.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HazelcastがどのようにSportmasterテクノロジースタックに参加したかは言うまでもありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2012年に未来のサイトの最初のパイロットに取り組んだとき、検索エンジンが発行した最初のリンクはHazelcastでした。知り合いは「初めて」始まった-たった2時間後、システムにHzをねじ込んだとき、それが機能したという事実に感銘を受けました。そしてそれはうまくいきました。一日の終わりまでにいくつかのテストを追加するまで、私たちは嬉しかったです。そして、この活力の供給は、Hzが時間とともに投げた驚きを克服するのに十分でした。今、スポーツマスターチームはヘーゼルキャストを拒否する理由はありません。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、「検索エンジンの最初のリンク」や「すばやく組み立てられたHelloWorld」などの議論は、もちろん例外であり、選択が行われた瞬間の特徴です。選択したシステムのこれらのテストは、製品版のリリースから始まります。この段階で、キャッシュを含むシステムを選択するときに注意を払う必要があります。実際、私たちの場合、偶然にHazelcastを選んだと言えますが、それから私たちは正しいものを選んだことがわかりました。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
本番環境では、個々のノードでの監視、障害の処理、データ複製、スケーリングのコストなど、はるかに重要です。</font><font style="vertical-align: inherit;">つまり、システムがサポートされているときに発生するタスクに注意する価値があります-負荷が計画よりも10倍高い場合、誤って何かを間違った方向に入力した場合、新しいバージョンのコードをロールアウトし、データを置き換えて気づかずに実行する必要がある場合クライアントのため。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべての要件に対して、Hazelcastは間違いなく適しています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">つづく</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ヘーゼルキャストは万能薬ではありません。</font><font style="vertical-align: inherit;">2017年、私たちは管理パネルのキャッシュにHazelcastを選択しました。単に過去の経験の良い印象に頼っています。</font><font style="vertical-align: inherit;">これは非常に邪悪なジョークで重要な役割を果たしました。そのため、私たちは困難な状況にあり、「英雄的に」60日間それから抜け出しました。</font><font style="vertical-align: inherit;">しかし、それについては次のパートで詳しく説明します。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それまでの間...幸せな新しいコード！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja490892/index.html">YandexとGoogleのキーと広告をYMLファイルから無料で生成する方法</a></li>
<li><a href="../ja490894/index.html">ウェブサイトのアーキテクチャに関する微妙な考え</a></li>
<li><a href="../ja490896/index.html">「プログラマー、パック、およびジョンスタインベック」への応答の形での子供の集中治療室の作業原則、または</a></li>
<li><a href="../ja490906/index.html">Yandexは独立したAura-aura.topのベータ版を公開しました。トップですか？</a></li>
<li><a href="../ja490908/index.html">ゾーンデータストレージ</a></li>
<li><a href="../ja490916/index.html">大規模プロジェクトでの外部チームとの相互作用の問題</a></li>
<li><a href="../ja490918/index.html">Andrei Zaretsky、Alexander Trukhanov（続き）：「私たちは名前を持っていませんでしたが、傲慢がありました」</a></li>
<li><a href="../ja490920/index.html">「I Have Peend Pwned」での検索を49マイクロ秒に加速（C ++）</a></li>
<li><a href="../ja490924/index.html">Windows PowerShellとは何で、何を食べますか？パート2：プログラミング言語の概要</a></li>
<li><a href="../ja490926/index.html">初心者向けのユニティボール軌道2d</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>