<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÑÔ∏è üëßüèº üßúüèø Layanan microser yang efisien dan andal üîì üé≥ üï∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="200 . JVM- - Cassandra, . , .
 

 - ? , ? ? .
 

, , , .
 
 

 c, . , 6 000 , 15 000 , , ‚Äî , . 
 

 . , .
 

, - . , . 
 


 

 ( , ). 
 

, . , 95% 5...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Layanan microser yang efisien dan andal</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/499316/"><p><img src="https://habrastorage.org/webt/d7/-f/p2/d7-fp2y6q3qoz7vap3xaaxjlsao.png"></p><br>
<p>      200    .       JVM- -      Cassandra,       .      ,           .</p><br>
<p>     -  ?    ,    ?      ?     .</p><a name="habracut"></a><br>
<p>,   ,   ,        .</p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/x9tvJjWCrr4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>   c,      .   ,     6 000 ,    15 000 ,     ,      ‚Äî     ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>. </p><br>
<p>       .           ,    .</p><br>
<p>,      - .        ,     . </p><br>
<p><img src="https://habrastorage.org/webt/s_/ak/kg/s_akkgtgd2hj7rlloohhmcuddqy.png"></p><br>
<p>       (   ,       ). </p><br>
<p>,         .   , 95%     5% .</p><br>
<p>,    ‚Äî  .  80%        13  .         ,         ‚Äî        13 . </p><br>
<p>    ,          :</p><br>
<p><img src="https://habrastorage.org/webt/hd/rk/sj/hdrksj0tdm_sygl2jiwo-tvrszo.png"></p><br>
<p>,       .  web-          ,         .</p><br>
<p>      ,        : </p><br>
<ul>
<li>600   </li>
<li>5   </li>
<li> 100      </li>
<li> 120      </li>
<li> 8      </li>
</ul><br>
<p>    ,     .     ,       .   ,       .    ,        ,  .</p><br>
<p>  ‚Äî    ,      :</p><br>
<p><img src="https://habrastorage.org/webt/1s/m0/hz/1sm0hzyof90eouhpnqgtyhkc7vg.jpeg"></p><br>
<p>     ‚Äî ID , ID    (      ), ,   (   , ,     ),    - ,     ,   .</p><br>
<p>          : </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Messages (<font></font>
    chatId, msgId<font></font>
<font></font>
    <span class="hljs-keyword">user</span>, <span class="hljs-keyword">type</span>, <span class="hljs-built_in">text</span>, attachments[], terminal, deletedBy[], replyTo‚Ä¶<font></font>
<font></font>
    PRIMARY <span class="hljs-keyword">KEY</span> ( chatId, msgId )<font></font>
)</code></pre><br>
<p>        :</p><br>
<ul>
<li><strong>getMessages(viewer, chat, from, to)</strong>,               .        (,   ). </li>
<li><strong>getLastMessages(viewer, chats)</strong>        .      ,      . </li>
<li>,         <strong>add(chat, message)</strong>,   <strong>search(viewer, text)</strong>       <strong>indexMessages()</strong>.</li>
</ul><br>
<p>        . </p><br>
<hr><br>
<h2 id="sovremennye-mikroservisy"> </h2><br>
<p>      ( ,   - )     ,    -,  -   . </p><br>
<p>       .   , .   Cassandra.</p><br>
<p>          DBA,  ,     ,     :</p><br>
<p><img src="https://habrastorage.org/webt/bm/5w/y1/bm5wy1tocp_c0xmfluf30l_lct8.jpeg"></p><br>
<p>,  .        getMessages().</p><br>
<p>           :</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">FROM</span> Messages
    <span class="hljs-keyword">WHERE</span> chatId = ? <span class="hljs-keyword">AND</span>
    msgId <span class="hljs-keyword">BETWEEN</span> :<span class="hljs-keyword">from</span> <span class="hljs-keyword">AND</span> :<span class="hljs-keyword">to</span></code></pre><br>
<p>   :        .   ,      . </p><br>
<p>  .  ‚Äî  ,     , ?    .  ,          : </p><br>
<p><img src="https://habrastorage.org/webt/vi/td/e-/vitde-nlrpc_dqwoqyktzkbqswu.jpeg"> </p><br>
<p> ?     ,   ,   5%    95% .  . </p><br>
<p>   DBA ,          . , ,  . </p><br>
<p>,      .  <strong>getLastMessages()</strong>  <strong>indexMessages()</strong>     ,     .    ,    ,      95% ,    -  ,      5%.              - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>, , , LRU.          .</p><br>
<p>      ,     ,        ,       ,    .</p><br>
<p>        -   , , Memcached, Redis  Tarantool,      .       memcache . </p><br>
<p>      ,        :    ,                :</p><br>
<p><img src="https://habrastorage.org/webt/2f/mq/ot/2fmqotaaww_b50yv7dr2iijtaqc.jpeg"></p><br>
<p>  ,    . </p><br>
<hr><br>
<h2 id="poteri-tipovyh-mikroservisov">  </h2><br>
<p><strong>  ‚Äî   CPU    </strong>. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> ‚Äî    ,    ,  ,     . ,      . </p><br>
<p> ,   memcache,     .     , ,    , ,  .  ,   ,      .</p><br>
<p>              : </p><br>
<p><img src="https://habrastorage.org/webt/px/dm/6s/pxdm6seji3s8y3flkva_gdypvdi.jpeg"></p><br>
<p>    ?  ,  . </p><br>
<p>   . Atul Adya, Robert Grandl, Daniel Myers<br>
 Google  Henry Qin   ,        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>,          85%. </p><br>
<p><img src="https://habrastorage.org/webt/ve/yk/ve/veykvesmiuwdz3baz9oqndx4tlw.jpeg"></p><br>
<p>    27%   ,    ,    low-latency .</p><br>
<p><strong>  ‚Äî    </strong>.  ,       memcache,   .</p><br>
<p>      13    memcache,       ,      13, ,    ,    ,    12  13,      .</p><br>
<p>   ,     10%  ,     46%   CPU   86%   ,    .</p><br>
<p><strong>  ‚Äî  </strong>.           memcache   ,          -,      . </p><br>
<p>  ,       ,              . </p><br>
<p><img src="https://habrastorage.org/webt/ly/ir/0v/lyir0vzphax_chgheuh-baxm34w.jpeg"></p><br>
<p>  N    ,      .            . </p><br>
<p>  ‚Äî .   ,    .</p><br>
<hr><br>
<h2 id="chtozhedelat"></h2><br>
<p>     memcache      ,             : memcache   . </p><br>
<p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>   memcache  99.99.</p><br>
<p><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Redis</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tarantool</a>           memcache,        ,   . </p><br>
<p>NetCache ‚Äî ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>      memcache     .</p><br>
<p>KV-Direct <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>           .</p><br>
<p>  ,      -      .   ,    ,      .       .</p><br>
<hr><br>
<h2 id="mikroservis-s-sostoyaniem">  </h2><br>
<p>               .   ,    ,    . </p><br>
<p><img src="https://habrastorage.org/webt/s7/2c/2l/s72c2lzvc83wqllfz_jnloqlsnq.jpeg"></p><br>
<p>     :</p><br>
<p>-,     ,    .      . </p><br>
<p>-,            /. </p><br>
<p>-,             ,        ,          .</p><br>
<p>             ,     ¬´¬ª  .         . </p><br>
<p>    DBA    .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>      .</p><br>
<p> ,                   ,      .       , ? ,   ,    ? </p><br>
<p> ,    .</p><br>
<hr><br>
<h2 id="otkazoustoychivost"></h2><br>
<p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>,       ,     ‚Äî   .    ,     .     ? </p><br>
<p><strong>1, 2</strong>     (  )  :  , ,  .<br>
<strong>3, 4</strong>:     .<br>
<strong>5</strong> .      .<br>
<strong>6</strong>   ‚Äî    ,      . ,     memcache.<br>
<strong>7</strong>  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.       .    -  ,   ,    retries,  - .</p><br>
<p>,  ,       ,     .     ,        memcache   . </p><br>
<p><img src="https://habrastorage.org/webt/qb/gd/gg/qbgdggwkctugayqqxjuncdt1ucq.jpeg"></p><br>
<p>     ?    memcache? , memcache   ,     .       (    ). </p><br>
<p> ?          ,     .        .<br>
 memcache      -,  ,   . ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>      .</p><br>
<p> ,   ¬´¬ª        .      ,      ,      -  . </p><br>
<p><img src="https://habrastorage.org/webt/u8/4p/9c/u84p9c-7vm5zdrtq1v52sp6w5os.jpeg"></p><br>
<p>  ,       ,   .</p><br>
<p>  ,     ,          .      ,            .</p><br>
<p> ,       ,     .     ,      .      .            K,              1/3 K,      . </p><br>
<p>,       ,          .            .</p><br>
<p><img src="https://habrastorage.org/webt/p4/7r/ak/p47rakv676smel7_km7cyzohahs.jpeg"></p><br>
<p> ,           .       ,     .  ,             .  ,         .</p><br>
<p>     .     .    ,     .</p><br>
<p> ,    ?         ?  .   memcache  ,   .                 K.</p><br>
<p>,        p,     P    : </p><br>
<p><strong>P(K) = 1 ‚Äì (1 ‚Äì p)<sup>3</sup></strong></p><br>
<p>                 ,     .         ,   :</p><br>
<p><strong>P(1/3 K) = 1 ‚Äì (1 ‚Äì p)<sup>3</sup></strong></p><br>
<p>       K,     .            : </p><br>
<p><strong>P(K) = p<sup>3</sup></strong></p><br>
<p>    ,  ,    .</p><br>
<p>,       p  0.1 (  10%),   ,        : </p><br>
<p>    <br>
<strong>P(K) = 1 ‚Äì (1 ‚Äì p)<sup>3</sup> = 1 ‚Äì (1 ‚Äì 0.1)<sup>3</sup> = 0.271</strong></p><br>
<p>    :<br>
<strong>P(K) = p<sup>3</sup> = 0.1<sup>3</sup> = 0.001</strong></p><br>
<p> ,        .</p><br>
<p>,        .  ,   , memcache            .   :     ,   ,       ‚Äî         p = 0.01  2 , p = 0.001  ,  ..           ,    1/3 K   (      p = 0.01),  (p = 0.001) . </p><br>
<p>,              .</p><br>
<hr><br>
<h2 id="vperyod-k-realizacii">,  !</h2><br>
<p>  ?  : </p><br>
<ul>
<li>    . ,       -     .</li>
<li>   ,          .       , ,       ,   . </li>
</ul><br>
<p>,    ,   ,      ,     -   .  ¬´¬ª, ¬´¬ª  ¬´¬ª ,     -   ,        .</p><br>
<p>          ‚Äî      .           .         Java, ,       Java.      :       ‚Äî  ,    .</p><br>
<p>: open source,  Java,   ‚Äî    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cassandra</a>. </p><br>
<p>      .     Cassandra,  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CassandraDaemon</a>.</p><br>
<p> , ,     ‚Äî     classpath   ( -cp cassandra/lib/*.jar )   -   :</p><br>
<pre><code class="java hljs">System.setProperty( <span class="hljs-string">"cassandra.config"</span>, <span class="hljs-string">"file://whatever/cassandra.yaml"</span> );<font></font>
CassandraDaemon.instance.activate();</code></pre><br>
<p>    ,  CassandraDaemon    (,   Cassandra, ,  cassandra.yaml ‚Äî    ).      activate(),       .</p><br>
<p> assandra.yaml  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ConfigurationLoader</a>,   ,    Cassandra    .</p><br>
<p>   ‚Äî        ‚Äî        .  ,      .</p><br>
<h2 id="marshrutizaciya-zaprosov"> </h2><br>
<p>,     .     ,        B.     - ,   ,      .       ,      ,           :</p><br>
<p><img src="https://habrastorage.org/webt/n_/rj/1t/n_rj1tmkglpnej6logbufrm-k_a.jpeg"></p><br>
<p>        .                   .</p><br>
<p>          -    ‚Äî    ,    A, B  C.   ,    ,  -   :          ,    .</p><br>
<p>         B,        .  ,         . </p><br>
<p><img src="https://habrastorage.org/webt/ef/zt/m1/efztm1afczxnzwoe_7cfjwegiz4.jpeg"></p><br>
<p> ,       ,       .        ,         B.    ,   ,        .</p><br>
<p>         .          ,          .</p><br>
<p>    .     Cassandra   .  ,    .</p><br>
<p> Cassandra    ,    :<br>
Partition Key (chatId) ‚Äî     .<br>
Clustering Key (msgId),        ,   ,       . </p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Messages (<font></font>
    chatId, msgId<font></font>
<font></font>
    <span class="hljs-keyword">user</span>, <span class="hljs-keyword">type</span>, <span class="hljs-built_in">text</span>, attachments[], terminal, deletedBy[], replyTo‚Ä¶<font></font>
<font></font>
    PRIMARY <span class="hljs-keyword">KEY</span> ( chatId, msgId )<font></font>
) </code></pre><br>
<p>   Partition Key           .  ,    Clustering Key,              ‚Äî      .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.</p><br>
<p>        ,       ‚Äî ,      Partition Key    ID ,  Clustering Key ‚Äî ID .</p><br>
<p><img src="https://habrastorage.org/webt/5k/vu/vl/5kvuvl99bx3vsqbczu8_2wzibbc.jpeg"></p><br>
<p>        Cassandra   :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Partitioner</a> ‚Äî    Partition Key  ,         . Partitioner            .    Partitioner   ,      hash- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">murmur3</a>   . </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TokenMetadata</a> ‚Äî  ,              ,      .</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Replication Strategy</a> ,           .    Replication Strategy   ,     keyspace.</li>
</ul><br>
<p>    ,                . </p><br>
<pre><code class="java hljs">SortedMap&lt;Token, List&lt;InetAddress&gt;&gt; endpointMap = ‚Ä¶<font></font>
<font></font>
AbstractReplicationStrategy replication = ‚Ä¶<font></font>
<font></font>
<span class="hljs-keyword">for</span> (Token token : tokenMetadata.sortedTokens() ) {<font></font>
    endpointMap.put( token, replication.getNaturalEndpoints( token ) );<font></font>
}</code></pre><br>
<p>   endpointMap               .   endpointMap ,     .    ,       ,    ,      .</p><br>
<p>, ,     30 .     ,  ,    ,   . ,    ,       .       :  ,  push-   .  ,     . </p><br>
<p>    ,  ,     . </p><br>
<h2 id="rabotaem-so-vstroennoy-bd">   </h2><br>
<p>     :</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Messages (<font></font>
    chatId, msgId<font></font>
<font></font>
    <span class="hljs-keyword">user</span>, <span class="hljs-keyword">type</span>, <span class="hljs-built_in">text</span>, attachments[], terminal, deletedBy[], replyTo‚Ä¶<font></font>
<font></font>
    PRIMARY <span class="hljs-keyword">KEY</span> ( chatId, msgId )<font></font>
) </code></pre><br>
<p>     ,      :</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">FROM</span> Messages
    <span class="hljs-keyword">WHERE</span> chatId = ? <span class="hljs-keyword">AND</span>
    msgId <span class="hljs-keyword">BETWEEN</span> :<span class="hljs-keyword">from</span> <span class="hljs-keyword">AND</span> :<span class="hljs-keyword">to</span></code></pre><br>
<p>,    . </p><br>
<p>        ?  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>.</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">import</span> com.datastax.oss.driver.api.core.CqlSession;
<span class="hljs-keyword">import</span> com.datastax.oss.driver.api.core.cql.*;<font></font>
<font></font>
<span class="hljs-keyword">try</span> (CqlSession session = CqlSession.builder().build()) { <span class="hljs-comment">// (1)</span>
    ResultSet rs = session.execute(<span class="hljs-string">"select release_version from system.local"</span>); <span class="hljs-comment">// (2)</span><font></font>
    Row row = rs.one();<font></font>
    System.out.println(row.getString(<span class="hljs-string">"release_version"</span>)); <span class="hljs-comment">// (3)</span>
}</code></pre><br>
<p>   ( ,   1-3):</p><br>
<ol>
<li>   ,    </li>
<li> ,  ResultSet</li>
<li> </li>
</ol><br>
<p>     ,    -       ,     .</p><br>
<p>        Cassandra      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">QueryProcessor,     execute </a>,      :</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> org.apache.cassandra.cql3;<font></font>
<font></font>
<span class="hljs-keyword">import</span> java.nio.ByteBuffer;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryProcessor</span>
</span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UntypedResultSet <span class="hljs-title">execute</span><span class="hljs-params">(String query,
        ConsistencyLevel cl, Object‚Ä¶ values)</span>
        <span class="hljs-keyword">throws</span> RequestExecutionException
}</span></code></pre><br>
<p> ,   ‚Äî . ?   ,          .        ,      .    ,    , ,      .</p><br>
<p>,  getMessages()       :</p><br>
<pre><code class="java hljs">UntypedResultSet rs = QueryProcessor.execute(
        <span class="hljs-string">"SELECT * FROM Messages "</span>
        + <span class="hljs-string">"WHERE chatId = ? AND msgId &lt; ? AND msgId &gt; ?"</span><font></font>
        ConsistencyLevel.QUORUM, chatId, from, to );<font></font>
<font></font>
rs.forEach ( row -&gt; {} );</code></pre><br>
<p>   add()          :</p><br>
<pre><code class="java hljs">QueryProcessor.execute( <span class="hljs-string">"INSERT INTO Messages VALUES (?,?,?,...)"</span>, cl, values );</code></pre><br>
<p> .    QueryProcessor,           .     ,      ,                .</p><br>
<hr><br>
<h2 id="kesh-soobscheniy"> </h2><br>
<p>   ,            .    ,     . ,   :</p><br>
<ul>
<li>600  </li>
<li>100  </li>
<li>5  </li>
<li>    5% </li>
<li>        13  </li>
</ul><br>
<p>   ,  ,            :</p><br>
<ul>
<li>3+  </li>
<li>250  </li>
<li>500  </li>
</ul><br>
<p>   .             replication factor.</p><br>
<p>      , ,    -     (getMessages(), getLastMessages(), add(), search(), indexMessages()).      ,    ,        .</p><br>
<p>   getMessages()      :</p><br>
<ul>
<li>   ok.ru     .  ,   -      getMessages(). </li>
<li>   ,        . </li>
<li>,  ,  QueryProcessor,    . </li>
<li>   .</li>
<li>,     .</li>
</ul><br>
<p>   :</p><br>
<p><img src="https://habrastorage.org/webt/cb/3g/xn/cb3gxnhr2ozu9nqextckx5uyisq.jpeg"></p><br>
<p>             . </p><br>
<p>    ,           ,  ,    :</p><br>
<p><img src="https://habrastorage.org/webt/s2/fp/fo/s2fpfod8xxjlyou-tuewrh7ruk4.jpeg"></p><br>
<p>   ,     ,     add().          ,   :</p><br>
<p><img src="https://habrastorage.org/webt/o2/xj/ew/o2xjewjnms1q78ar-m4vnm6zhre.jpeg"></p><br>
<p>        ,     - :</p><br>
<p><img src="https://habrastorage.org/webt/wv/l3/ss/wvl3ss3gs-orykbpctubexcmf04.jpeg"></p><br>
<p>,    ,  getMessages(),   .     ,   .   ,    :</p><br>
<p><img src="https://habrastorage.org/webt/kt/hd/bh/kthdbhkv2jtnev9v2kfqnkodl2w.jpeg"></p><br>
<h2 id="aktualnost-dannyh"> </h2><br>
<p>,   -   ,    . </p><br>
<p>      :   ,      ,          . ,  -  added(): </p><br>
<p><img src="https://habrastorage.org/webt/db/0i/ct/db0ictcyag0wkm1scunwy0pyu5s.jpeg"></p><br>
<p>         ,         .  ? </p><br>
<p>  ,         , , ,    :</p><br>
<p><img src="https://habrastorage.org/webt/tk/ur/dn/tkurdnzg7wy3srnvqrzbxh0o_u0.jpeg"></p><br>
<p>       ,       ,   .  ,  ?    ? , -    ? </p><br>
<p>     ,       add()   .  ,           ,        .         .</p><br>
<p> ,       Cassandra.   INSERT      ,   ,       ()       . </p><br>
<p><img src="https://habrastorage.org/webt/vc/in/ic/vcinicuremfgsakfmtmvdfquxas.jpeg"></p><br>
<p>       ‚Äî   ,                 .</p><br>
<p><img src="https://habrastorage.org/webt/dr/r7/34/drr734bk0t3o0zgepsiiyxuawgi.jpeg"></p><br>
<p>   Cassandra      . </p><br>
<p>      ,          .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hint</a>. </p><br>
<p><img src="https://habrastorage.org/webt/04/zx/zd/04zxzd39y2lgme-e1ll9pogosfo.jpeg"></p><br>
<p>       ,          - -     .</p><br>
<p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Read Repair</a> ‚Äî    .          .</p><br>
<p><img src="https://habrastorage.org/webt/tm/3b/z2/tm3bz2c6nrwdmohqtg1zmeo0enu.jpeg"></p><br>
<p>, , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Streaming Repair</a> ‚Äî          -    . </p><br>
<p>     ,     ,         .   Streaming. </p><br>
<p><img src="https://habrastorage.org/webt/cv/rr/1e/cvrr1euhqasnjwqkxjenhe70f3g.jpeg"></p><br>
<p>,         .        . </p><br>
<p>     ,  ,   .  , ,      (Hint, Read Repair  Streaming Repair)  ,          ,                 . </p><br>
<p><img src="https://habrastorage.org/webt/pb/c1/uw/pbc1uwci_vhqiwgdbcibuxnulv4.jpeg"></p><br>
<p>         listener'   Cassandra       :</p><br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApplyMutationListener</span>
</span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onApply</span><span class="hljs-params">(ByteBuffer key,
        DeletionTime deletion,
        Iterator&lt;Unfiltered&gt; atoms)</span></span>;<font></font>
}</code></pre><br>
<p>,        ,      Cassandra  . ,    . </p><br>
<p> ,   ,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a>. </p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> org.apache.cassandra.db<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Keyspace</span>
</span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">apply</span><span class="hljs-params">( Mutation mutation,
        <span class="hljs-keyword">boolean</span> writeCommitLog,
        <span class="hljs-keyword">boolean</span> updateIndexes.
        <span class="hljs-keyword">boolean</span> isDroppable )</span>

<span class="hljs-comment">// ...</span>
}</span></code></pre><br>
<p> Mutation         . ,          listener.</p><br>
<p> Streaming,   ,      (- Repair,       -    ),    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OnCompletionRunnable</a>:</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> org.apache.cassandra.streaming<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StreamReceiveTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StreamTask</span>
</span>{
    <span class="hljs-comment">// holds references to SSTables received</span>
    <span class="hljs-keyword">protected</span> Collection&lt;SSTableReader&gt; sstables;<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OnCompletionRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>{<font></font>
<font></font>
    <span class="hljs-comment">// ...</span><font></font>
    }<font></font>
}</code></pre><br>
<p>  ,            ApplyMutationListener. </p><br>
<h2 id="poterya-sostoyaniya-kesha">  </h2><br>
<p>       :   ,     ,   ,   -    ,  ,     .</p><br>
<p><img src="https://habrastorage.org/webt/j4/l_/u1/j4l_u1yykoiz4wmoshnvjf4wvjc.jpeg"></p><br>
<p> ,       .   Hints   ,       :</p><br>
<p><img src="https://habrastorage.org/webt/9a/ti/cw/9aticw-uw4flk_zdcjwrlvjqzzu.jpeg"></p><br>
<p>         getMessages()     .            ,   ,        .</p><br>
<p><img src="https://habrastorage.org/webt/_0/14/oo/_014oos3qujxnyj26eccpwj5xas.jpeg"></p><br>
<p>,         .  ,      ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">      WAL</a>.        ,            WAL.  Cassandra , ,  ,       .      keyspace,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LocalStrategy</a>:</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> KEYSPACE Caches
    <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">REPLICATION</span> = {
    <span class="hljs-string">'class'</span>: <span class="hljs-string">'LocalStrategy'</span>
    }</code></pre><br>
<p>LocalStrategy ,    keyspace   ,    . </p><br>
<p>   keyspace      :</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Caches.MessagesSnapshot (<font></font>
    rowkey <span class="hljs-built_in">blob</span>,
    <span class="hljs-keyword">value</span> <span class="hljs-built_in">blob</span>,<font></font>
    PRIMARY <span class="hljs-keyword">KEY</span> ( rowkey )<font></font>
)</code></pre><br>
<p>    put         ,        ,    eviction   ‚Äî    : </p><br>
<p><img src="https://habrastorage.org/webt/qr/ln/48/qrln48urbee4eip997lrbfshr_o.jpeg"></p><br>
<p>      ,    ,  ,      :</p><br>
<pre><code class="sql hljs"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> MessagesSnapshot</code></pre><br>
<p>       ,         ‚Äî ,     ,  .</p><br>
<p>        ‚Äî      ‚Äî         . </p><br>
<p>  ‚Äî  ,               (, -   ).       .</p><br>
<p>     ,         .         ‚Äî  mapped byte buffer    : /dev/shm/msgs-cache.mem.</p><br>
<p>     , ,     one-nio,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> GitHub</a>.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SharedMemoryMap</a>   ,        ,   SharedMemory.</p><br>
<p>   ,  /dev/shm  tmpfs,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hugetlbfs</a>,             , , ,   TLB misses     .</p><br>
<p>,         , SharedMemoryMap         ,    .</p><br>
<h2 id="ozhidanie-soglasovannosti"> </h2><br>
<p>,     :    ,       ,   . ‚Ä¶          .</p><br>
<p><img src="https://habrastorage.org/webt/ak/rj/sb/akrjsbhu-zd7udhizxmpodjchyq.jpeg"></p><br>
<p> ?       by design.    Cassandra                ,      . </p><br>
<p>    15      ,   ,          .</p><br>
<p>   :        , ,        ,         .          ,      .</p><br>
<p><img src="https://habrastorage.org/webt/lw/tb/wh/lwtbwhhgybojeqaxmkxfbck1pho.jpeg"></p><br>
<p> ,  ,    ‚Äî    .         ,     .</p><br>
<p>     ,       :        ,    , ¬´    ¬ª.       ,      ¬´¬ª.    . </p><br>
<p>      :     ,      ,        ,    ,     .</p><br>
<hr><br>
<h2 id="my-hotim-bolshego">  !</h2><br>
<p>  ,  . </p><br>
<p>        <strong>getLastMessages(chats[])</strong> ‚Äî        .</p><br>
<p>        ,        .  ,   ,   . </p><br>
<p>      ,  ,     .       ,   ,       . </p><br>
<p>  ,     ,  ,  .     ,  ,        Cassandra:  hints,  read repair,  streaming repair.</p><br>
<p>    ,          . ,  -      , .</p><br>
<p>         ?      ,       memcaches     ,       ,      :</p><br>
<p><img src="https://habrastorage.org/webt/sf/1z/nw/sf1znwudib-pox8fxm44gs9iul8.jpeg"></p><br>
<p>          ,         .          ‚Äî   ,    . </p><br>
<p> ¬´¬ª               (    ),     ,      ID . </p><br>
<p><img src="https://habrastorage.org/webt/nv/ue/ax/nvueaxt-tjlmciwnjp7m0fss_ra.jpeg"></p><br>
<p>      ‚Äî       (  ),  ,      ,  . </p><br>
<p>   ,        ,            .</p><br>
<h2 id="lokalnye-chteniya"> </h2><br>
<p>       . -   ,      ,       . ,     ,            ,     :</p><br>
<p><img src="https://habrastorage.org/webt/br/2q/hr/br2qhr7jvsy9uwmln6harlh8c30.jpeg"> </p><br>
<p> ,         ,  ,  .              ,         :</p><br>
<p><img src="https://habrastorage.org/webt/kj/rv/xe/kjrvxeenyvdsavn-3fzgnv4crmq.jpeg"></p><br>
<p>  API Cassandra    .  -     Cassandra      JVM,      API. </p><br>
<p>   -  :</p><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> Message <span class="hljs-title">getLastMessage</span><span class="hljs-params">(Long chatId)</span> </span>{<font></font>
<font></font>
    Prepared prepared = QueryProcessor.prepareInternal( <span class="hljs-string">"SELECT ‚Ä¶ WHERE chatId=?"</span> );<font></font>
    SelectStatement select = (SelectStatement) prepared.statement;<font></font>
<font></font>
    QueryOptions opt = QueryProcessor.makeInternalOptions( prepared, chatId );<font></font>
<font></font>
    ReadQuery query = select.getQuery( opt, FBUtilities.nowInSeconds() );<font></font>
<font></font>
    UnfilteredPartitionIterator partitions = query.executeLocally( query.executionController() );<font></font>
<font></font>
    UnfilteredRowIterator partition = partitions.next();<font></font>
    partition.forEachRemaining( atom -&gt; { <span class="hljs-comment">/* unmarshalling code */</span> } );<font></font>
}</code></pre><br>
<p>   - ,        :   statement,  ,      executeLocally().   ,     ,    ,   .</p><br>
<h2 id="polnotekstovyy-poisk"> </h2><br>
<p>     :  .    -          . </p><br>
<p><img src="https://habrastorage.org/webt/mk/ri/-e/mkri-eccux9ff7ozpflct91u3rs.jpeg"></p><br>
<p>    ,      ‚Äî  .             (, ,   -   ). </p><br>
<p>,       , , Apache Lucene. </p><br>
<p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a>.    ,          (          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> ).        ‚Äî     .</p><br>
<p>   (      )     ,           . </p><br>
<p>,      .   -.      add(),       , ,   -,  IndexWriter.addDocument(),  IndexWriter.commit():</p><br>
<p><img src="https://habrastorage.org/webt/8n/wk/qc/8nwkqc5fxws8quijt3z9jq5pzvu.jpeg"></p><br>
<p>    :     ,    . </p><br>
<p>      ,         .   ,   ,   .         .</p><br>
<p> . .  IndexWriter.addDocument(),   IndexWriter.commit()  .  ? ,          ,          .          ,       .</p><br>
<p>  ? ,       ,  -  ,               .    , ,      ,       .</p><br>
<p>   Cassandra  ,      .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Compaction</a>.      ,  Cassandra            . </p><br>
<p>           Clustering Key,    , ,    ,       . </p><br>
<p> Cassandra    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a>:</p><br>
<pre><code class="java hljs"><span class="hljs-keyword">package</span> org.apache.cassandra.db.compaction;<font></font>
<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CompactionManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CompactionManagerMBean</span> </span>{
<span class="hljs-comment">// ‚Ä¶</span>
}</code></pre><br>
<p>     ,         ,  ,         .</p><br>
<p>   ,    ,    Compaction,   ,       ‚Äî          .           .</p><br>
<hr><br>
<h2 id="ekspluataciya"></h2><br>
<p>   ,         . </p><br>
<p><strong>,    ‚Äî     </strong>. </p><br>
<p>  - ,      . ?</p><br>
<ul>
<li>         ,        .               write-ahead . </li>
<li> ,     ‚Äî        Caches.MessagesSnapshot.       ‚Äî  ,   .         CPU.</li>
<li>   ,  , ,       . </li>
<li>       . </li>
</ul><br>
<p>  ? </p><br>
<p>      ,         .</p><br>
<p>  :       ,    ,       -   .       -,   .</p><br>
<p><strong> :     .</strong></p><br>
<p>:      ,     ,          -. </p><br>
<p> DBA  :    . </p><br>
<p><img src="https://habrastorage.org/webt/bh/lj/bx/bhljbxrbkkxaldbvfmtw16kiiyw.jpeg"></p><br>
<p>  DBA  ,       .   ? </p><br>
<p>   ,   ,  .            ‚Äî   ,         .  ,     , ,      -.</p><br>
<p><strong>      ‚Äî       .</strong></p><br>
<p> ,        ,     JVM.         - ,  , ,  . ,         ,     ,       . </p><br>
<p> ?    ,     ,         :         -    ,   . </p><br>
<p>,     ‚Äî   -,        .      ,  -   . </p><br>
<p>  ‚Äî   -   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a>,        .</p><br>
<p><strong>    ,     ‚Äî        . </strong></p><br>
<p>        API,  .     DBA:         API,        !   ?</p><br>
<p>  ,      .   Cassandra,     API, ,    ,   . ,   ‚Äî     . </p><br>
<p>   ,     Cassandra,  rolling upgrades.    ,          .   .       c       ,            ,      -, ,  ,  ,  - . </p><br>
<p>       ‚Äî   ,           -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">    </a>.</p><br>
<hr><br>
<h2 id="itog"></h2><br>
<ul>
<li>     ,             . </li>
<li>    ÃÅ   .          ,   ,        .           .</li>
<li>    ,     Cassandra   one-nio.</li>
<li>     .       ,  ,  ,     : , , , , .</li>
</ul><br>
<p>         ,    ,        :</p><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a> ( )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a> ( )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> : , , </a> ( )</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id499300/index.html">Bagaimana TIDAK untuk Wawancara</a></li>
<li><a href="../id499304/index.html">NAS Backup dan tanpa sihir. Menyelam dalam-dalam oleh Veeam</a></li>
<li><a href="../id499308/index.html">Sepuluh laporan teratas dari DotNext 2019 Moskow</a></li>
<li><a href="../id499312/index.html">Powerhell untuk pemula</a></li>
<li><a href="../id499314/index.html">Komputer DIY di meja</a></li>
<li><a href="../id499320/index.html">Apa geometri alam semesta?</a></li>
<li><a href="../id499322/index.html">Distribusi Windows Server atau Linux? Memilih OS server</a></li>
<li><a href="../id499324/index.html">Instal dan konfigurasikan SDK untuk membangun ekstensi LibreOffice</a></li>
<li><a href="../id499326/index.html">Kepahitan manis dari produk: dalam metrik apa yang berfungsi?</a></li>
<li><a href="../id499328/index.html">Cylance vs Sality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>