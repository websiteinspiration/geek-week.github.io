<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòù üìù üë®üèΩ‚ÄçüöÄ Las trampas de la terraforma ‚õπüèª ü§≥üèø üë®üèΩ‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Destacaremos varias dificultades, incluidas las relacionadas con los bucles, las declaraciones if y las t√©cnicas de implementaci√≥n, as√≠ como problemas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Las trampas de la terraforma</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/496820/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/9d/ou/9e/9dou9eb8rwq6zzcphuthymczj4a.jpeg" alt="imagen"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Destacaremos varias dificultades, incluidas las relacionadas con los bucles, las declaraciones if y las t√©cnicas de implementaci√≥n, as√≠ como problemas m√°s generales que afectan a Terraform en su conjunto:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">los par√°metros count y for_each tienen limitaciones;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restricciones de implementaci√≥n de tiempo de inactividad cero</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incluso un buen plan puede fallar;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">refactorizar puede tener sus trucos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la consistencia diferida es consistente ... con el aplazamiento.</font></font></li>
</ul><a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los par√°metros Count y for_each tienen limitaciones</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los ejemplos de este cap√≠tulo, el par√°metro count y la expresi√≥n for_each se usan activamente en bucles y l√≥gica condicional. </font><font style="vertical-align: inherit;">Funcionan bien, pero tienen dos limitaciones importantes que debe conocer.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En count y for_each, no se puede hacer referencia a variables de salida de recursos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count y for_each no se pueden usar en la configuraci√≥n del m√≥dulo.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Count y for_each no pueden hacer referencia a ninguna variable de salida de un recurso</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine que necesita implementar varios servidores EC2 y, por alguna raz√≥n, no desea usar ASG. </font><font style="vertical-align: inherit;">Su c√≥digo podr√≠a ser as√≠:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_1"</span> {<font></font>
   count             = <span class="hljs-number">3</span>
   ami                = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type = <span class="hljs-string">"t2.micro"</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los consideraremos a su vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que al par√°metro de recuento se le asigna un valor est√°tico, este c√≥digo funcionar√° sin problemas: cuando ejecute el comando de aplicaci√≥n, crear√° tres servidores EC2. ¬øPero si desea implementar un servidor en cada zona de disponibilidad (Zona de disponibilidad o AZ) dentro de la regi√≥n actual de AWS? Puede hacer que su c√≥digo cargue la lista de zonas desde la fuente de datos aws_availability_zones y luego recorrer cada una de ellas y crear un servidor EC2 usando el par√°metro count y accediendo a la matriz por √≠ndice:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_2"</span> {<font></font>
   count                   = length(data.aws_availability_zones.all.names)<font></font>
   availability_zone   = data.aws_availability_zones.all.names[count.index]<font></font>
   ami                     = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type       = <span class="hljs-string">"t2.micro"</span><font></font>
}<font></font>
<font></font>
data <span class="hljs-string">"aws_availability_zones"</span> <span class="hljs-string">"all"</span> {}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo funcionar√° igual de bien, ya que el par√°metro count puede hacer referencia a las fuentes de datos sin ning√∫n problema. </font><font style="vertical-align: inherit;">Pero, ¬øqu√© sucede si la cantidad de servidores que necesita crear depende de la salida de alg√∫n recurso? </font><font style="vertical-align: inherit;">Para demostrar esto, la forma m√°s f√°cil es tomar el recurso random_integer, que, como se puede adivinar por el nombre, devuelve un entero aleatorio:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"random_integer"</span> <span class="hljs-string">"num_instances"</span> {<font></font>
  min = <span class="hljs-number">1</span>
  max = <span class="hljs-number">3</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo genera un n√∫mero aleatorio del 1 al 3. Veamos qu√© sucede si intentamos usar el resultado de este recurso en el par√°metro de conteo del recurso aws_instance:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_3"</span> {<font></font>
   count             = random_integer.num_instances.result<font></font>
   ami                = <span class="hljs-string">"ami-0c55b159cbfafe1f0"</span>
   instance_type = <span class="hljs-string">"t2.micro"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ejecuta el plan de terraform para este c√≥digo, obtendr√° el siguiente error:</font></font><br>
<br>
<pre><code class="java hljs">Error: Invalid count argument<font></font>
<font></font>
   on main.tf line <span class="hljs-number">30</span>, in resource <span class="hljs-string">"aws_instance"</span> <span class="hljs-string">"example_3"</span>:
   <span class="hljs-number">30</span>: count = random_integer.num_instances.result<font></font>
<font></font>
The <span class="hljs-string">"count"</span> value depends on resource attributes that cannot be determined until apply, so Terraform cannot predict how many instances will be created. To work around <span class="hljs-keyword">this</span>, use the -target argument to first apply only the resources that the count depends on.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terraform requiere que se cuente y para cada uno durante la fase de planificaci√≥n, antes de que se creen o modifiquen los recursos. </font><font style="vertical-align: inherit;">Esto significa que count y for_each pueden referirse a literales, variables, fuentes de datos e incluso listas de recursos (siempre que su longitud pueda determinarse durante la planificaci√≥n), pero no a variables de salida calculadas del recurso.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">count y for_each no se pueden usar en la configuraci√≥n del m√≥dulo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En alg√∫n momento puede verse tentado a agregar el par√°metro de conteo a la configuraci√≥n del m√≥dulo:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">module</span> <span class="hljs-string">"count_example"</span> {<font></font>
     source = <span class="hljs-string">"../../../../modules/services/webserver-cluster"</span><font></font>
<font></font>
     count = <span class="hljs-number">3</span><font></font>
<font></font>
     cluster_name = <span class="hljs-string">"terraform-up-and-running-example"</span>
     server_port = <span class="hljs-number">8080</span>
     instance_type = <span class="hljs-string">"t2.micro"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este c√≥digo intenta usar el recuento dentro del m√≥dulo para crear tres copias del recurso de servidor web-cl√∫ster. </font><font style="vertical-align: inherit;">O tal vez desee hacer que la conexi√≥n del m√≥dulo sea opcional dependiendo de alguna condici√≥n booleana, asignando su par√°metro de conteo a 0. Este c√≥digo se ver√° bastante razonable, pero como resultado de ejecutar el plan de terraformaci√≥n obtendr√° el siguiente error:</font></font><br>
<br>
<pre><code class="java hljs">Error: Reserved argument name in <span class="hljs-keyword">module</span> block<font></font>
<font></font>
   on main.tf line <span class="hljs-number">13</span>, in <span class="hljs-keyword">module</span> <span class="hljs-string">"count_example"</span>:
   <span class="hljs-number">13</span>: count = <span class="hljs-number">3</span><font></font>
<font></font>
The name <span class="hljs-string">"count"</span> is reserved <span class="hljs-keyword">for</span> use in a future version of Terraform.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, en el momento en que se lanz√≥ Terraform 0.12.6, el uso de count o for_each en el recurso del m√≥dulo no era compatible. </font><font style="vertical-align: inherit;">De acuerdo con las notas de lanzamiento de Terraform 0.12 (http://bit.ly/3257bv4), HashiCorp planea agregar esta funci√≥n en el futuro, por lo que dependiendo de cu√°ndo lea este libro, es posible que ya est√© disponible. </font><font style="vertical-align: inherit;">Para saber con certeza, consulte el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro de cambios de Terraform aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usar el bloque create_before_destroy en combinaci√≥n con ASG es una excelente soluci√≥n para organizar implementaciones con tiempo de inactividad cero, excepto por un matiz: las reglas de autoescalado no son compatibles. O, para ser m√°s precisos, esto restablece el tama√±o de ASG a min_size en cada implementaci√≥n, lo que puede ser un problema si usa reglas de autoescalado para aumentar el n√∫mero de servidores en ejecuci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, el m√≥dulo de servidor web-cl√∫ster contiene un par de recursos aws_autoscaling_schedule, que a las 9 a.m. aumentan el n√∫mero de servidores en el cl√∫ster de dos a diez. Si implementa, por ejemplo, a las 11 a.m., el nuevo ASG no arrancar√° con diez, sino con solo dos servidores, y permanecer√° en este estado hasta las 9 a.m. del d√≠a siguiente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta limitaci√≥n se puede eludir de varias maneras.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cambie el par√°metro de recurrencia en aws_autoscaling_schedule de 0 9 * * * ("ejecutar a las 9 am") a algo as√≠ como 0-59 9-17 * * * ("ejecutar cada minuto de 9 am a 5 pm"). </font><font style="vertical-align: inherit;">Si el ASG ya tiene diez servidores, volver a ejecutar esta regla de escalado autom√°tico no cambiar√° nada, que es lo que necesitamos. </font><font style="vertical-align: inherit;">Pero si el grupo ASG se ha implementado recientemente, esta regla garantiza que en un minuto el n√∫mero de sus servidores llegue a diez. </font><font style="vertical-align: inherit;">Este no es un enfoque completamente elegante, y grandes saltos de diez a dos servidores y viceversa tambi√©n pueden causar problemas a los usuarios.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cree una secuencia de comandos definida por el usuario que use la API de AWS para determinar la cantidad de servidores activos en el ASG, ll√°mela usando una fuente de datos externa (consulte la secci√≥n "Fuente de datos externa" en la p√°gina 249) y establezca el par√°metro deseado_capacidad del grupo ASG en el valor devuelto por esta secuencia de comandos. </font><font style="vertical-align: inherit;">Por lo tanto, cada nueva instancia de ASG siempre se ejecutar√° con la misma capacidad que el antiguo c√≥digo de Terraform y complica su mantenimiento.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, idealmente, Terraform deber√≠a tener soporte incorporado para implementaciones con tiempo de inactividad cero, pero a partir de mayo de 2019, el equipo de HashiCorp no planeaba agregar esta funcionalidad (los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">detalles est√°n aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El plan correcto puede implementarse sin √©xito.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A veces, cuando ejecuta el comando plan, obtiene un plan de implementaci√≥n completamente correcto, pero el comando apply devuelve un error. </font><font style="vertical-align: inherit;">Por ejemplo, intente agregar el recurso aws_iam_user con el mismo nombre que utiliz√≥ para el usuario de IAM que cre√≥ anteriormente en el cap√≠tulo 2:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {<font></font>
   #       IAM,<font></font>
   #      terraform <span class="hljs-keyword">import</span>
   name = <span class="hljs-string">"yevgeniy.brikman"</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora, si ejecuta el comando de plan, Terraform mostrar√° a primera vista un plan de implementaci√≥n muy razonable:</font></font><br>
<br>
<pre><code class="java hljs">Terraform will perform the following actions:<font></font>
<font></font>
   # aws_iam_user.existing_user will be created<font></font>
   + resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {<font></font>
         + arn                  = (known after apply)<font></font>
         + force_destroy   = <span class="hljs-keyword">false</span><font></font>
         + id                    = (known after apply)<font></font>
         + name               = <span class="hljs-string">"yevgeniy.brikman"</span>
         + path                 = <span class="hljs-string">"/"</span><font></font>
         + unique_id         = (known after apply)<font></font>
      }<font></font>
<font></font>
Plan: <span class="hljs-number">1</span> to add, <span class="hljs-number">0</span> to change, <span class="hljs-number">0</span> to destroy.</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ejecuta el comando de aplicaci√≥n, obtendr√° el siguiente error:</font></font><br>
<br>
<pre><code class="java hljs">Error: Error creating IAM User yevgeniy.brikman: EntityAlreadyExists:<font></font>
User with name yevgeniy.brikman already exists.<font></font>
<font></font>
   on main.tf line <span class="hljs-number">10</span>, in resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span>:
   <span class="hljs-number">10</span>: resource <span class="hljs-string">"aws_iam_user"</span> <span class="hljs-string">"existing_user"</span> {</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El problema, por supuesto, es que ya existe un usuario de IAM con ese nombre. Y esto puede suceder no solo con los usuarios de IAM, sino tambi√©n con casi cualquier recurso. Es posible que alguien haya creado este recurso manualmente o usando la l√≠nea de comando, pero sea como sea, la coincidencia de identificadores genera conflictos. Hay muchos sabores a este error que a menudo sorprenden a los principiantes de Terraform. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El punto clave es que el comando de plan de terraform solo considera los recursos que se especifican en el archivo de estado de Terraform. Si los recursos se crean de alguna otra manera (por ejemplo, manualmente, al hacer clic en la consola de AWS), no entrar√°n en el archivo de estado y, por lo tanto, Terraform no los tendr√° en cuenta al ejecutar el comando del plan. Como resultado, el plan que es correcto a primera vista no tendr√° √©xito.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se pueden aprender dos lecciones de esto.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ya ha comenzado a trabajar con Terraform, no use nada m√°s. </font><font style="vertical-align: inherit;">Si parte de su infraestructura se administra con Terraform, ya no podr√° modificarla manualmente. </font><font style="vertical-align: inherit;">De lo contrario, no solo corre el riesgo de obtener errores extra√±os de Terraform, sino que tambi√©n niega muchos de los beneficios de IaC, ya que el c√≥digo ya no ser√° una representaci√≥n precisa de su infraestructura.</font></font></li>
<li>     - ,   import.     Terraform    ,          terraform import.  Terraform  ,    .  import   .        .    ,      : _. ( aws_iam_user.existing_user).   ‚Äî   ,   . ,   ID  aws_iam_user    (, yevgeniy.brikman),  ID  aws_instance    EC2 ( i-190e22e5). ,   ,       .<br>
<br>
   import,    aws_iam_user,       Terraform    IAM   2 (,  yevgeniy.brikman    ):<br>
<br>
<pre><code class="plaintext hljs">$ terraform import aws_iam_user.existing_user yevgeniy.brikman</code></pre><br>
Terraform   API AWS,     IAM           aws_iam_user.existing_user    Terraform.       plan Terraform  ,   IAM  ,        .<br>
<br>
 , ,       ,      Terraform,              .       ,  Terraforming (http://terraforming.dtan4.net/),        AWS   .<br>
<br>
<h3>    </h3><br>
<i></i> ‚Äî    ,      ,     .  ,     ,     .  ‚Äî   ,    . ,     Terraform     IaC,      ,      ¬´ ¬ª  ,    .<br>
<br>
,    ‚Äî       .  IDE               .        ,     ,   Terraform      ,       .<br>
<br>
 ,   webserver-cluster    cluster_name:<br>
<br>
<pre><code class="java hljs">variable <span class="hljs-string">"cluster_name"</span> {<font></font>
   description = <span class="hljs-string">"The name to use for all the cluster resources"</span><font></font>
   type          = string<font></font>
}</code></pre><br>
,            foo.        bar.     ,    -      .<br>
<br>
  ,   webserver-cluster   cluster_name    ,   name     ALB:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                    = <span class="hljs-keyword">var</span>.cluster_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}</code></pre><br>
   name  - , Terraform          .      ALB,                    -.   ,    ,       ,      .<br>
<br>
   ,    ,    Terraform.      aws_security_group   webserver-cluster:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"instance"</span> {<font></font>
  # (...)<font></font>
}</code></pre><br>
    instance. ,            (  )  cluster_instance:<br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"cluster_instance"</span> {<font></font>
   # (...)<font></font>
}</code></pre><br>
   ? :   .<br>
<br>
Terraform  ID      . , iam_user     IAM  AWS,  aws_instance ‚Äî  ID  AWS EC2.     (,  instance  cluster_instance,     aws_security_group),  Terraform    ,        .    , Terraform       ,          .<br>
<br>
   ,       .<br>
<br>
<ul>
<li>   plan.      .         ,  Terraform   , ,  ,   .</li>
<li>,   .     ,  ,       .   ,     create_before_destroy.      ,   :          apply,           apply  .</li>
<li>    .     ,    (,  aws_security_group  instance  cluster_instance),          ,       Terraform.      ‚Äî     terraform state.       terraform state mv,    :<br>
<br>
<pre><code class="plaintext hljs">terraform state mv &lt;ORIGINAL_REFERENCE&gt; &lt;NEW_REFERENCE&gt;</code></pre><br>
ORIGINAL_REFERENCE ‚Äî  ,       ,  NEW_REFERENCE ‚Äî  ,     . ,    aws_security_group  instance  cluster_instance    :<br>
<br>
<pre><code class="java hljs">$ terraform state mv \<font></font>
   aws_security_group.instance \<font></font>
   aws_security_group.cluster_instance</code></pre><br>
   Terraform,  ,     aws_security_group.instance,      aws_security_group.cluster_instance.        terraform plan    , ,    .</li>
</ul><br>
<ul>
<li>   .    .    , Terraform        .      ,        ,      .    plan      create_before_destroy.</li>
</ul><br>
<h3>  ‚Ä¶  </h3><br>
API   ,   AWS,     .  ,       ,     .   ,          ;   ,         ,        API-.<br>
<br>
,  ,    API-  AWS     EC2. API  ¬´¬ª  (201 Created)  ,     .        ,     ,     AWS     ,  ,    .  ,      ,      ,    (404 Not Found).   ,      EC2      AWS,     ,    .<br>
<br>
    API         ,         .  , AWS SDK       ,   Terraform       6813 (https://github.com/hashicorp/terraform/issues/6813):<br>
<br>
<pre><code class="java hljs">$ terraform apply<font></font>
aws_subnet.<span class="hljs-keyword">private</span>-persistence<span class="hljs-number">.2</span>: InvalidSubnetID.NotFound:<font></font>
The subnet ID <span class="hljs-string">'subnet-xxxxxxx'</span> does not exist</code></pre><br>
 ,    (, )       -  ( ID    ),  Terraform    .     ( 6813)  ,        ,    Terraform     .  ,        .    terraform apply   ,         .<br>
<br>
       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´Terraform:    ¬ª</a>.</li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es496804/index.html">Instalaci√≥n y configuraci√≥n de Docker en Windows Subsystem Linux (WSL)</a></li>
<li><a href="../es496810/index.html">An√°lisis financiero general en Python (Parte 3)</a></li>
<li><a href="../es496812/index.html">Zoom: ¬ønegligencia banal o espionaje selectivo?</a></li>
<li><a href="../es496816/index.html">¬øPuedes sentir al candidato, est√° vivo?</a></li>
<li><a href="../es496818/index.html">Cientos de miles de rutas por segundo por n√∫cleo. Experiencia Yandex.Routing</a></li>
<li><a href="../es496822/index.html">C√≥mo mueren las startups en los Estados Unidos debido al coronavirus</a></li>
<li><a href="../es496824/index.html">Tu ambiente de trabajo n√≥rdico</a></li>
<li><a href="../es496826/index.html">Millones de sprites a m√°s de 120 fps</a></li>
<li><a href="../es496828/index.html">¬øD√≥nde encontrar freelance que ser√° divertido? (Spoiler: no Upwork)</a></li>
<li><a href="../es496830/index.html">¬øQu√© es la comunicaci√≥n emergente y por qu√© necesita saber?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>