<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï£ üë®‚Äçüé® üë®‚Äçüë¶‚Äçüë¶ Utilisation de la parall√©lisation lors du traitement des donn√©es en C # üë®üèø‚Äçüè´ üßùüèº üàöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonne journ√©e √† tous! Je suis un sp√©cialiste technique travaillant dans un syst√®me d'audit interne, mes responsabilit√©s incluent la cr√©ation d'outils ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Utilisation de la parall√©lisation lors du traitement des donn√©es en C #</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502868/"><img src="https://habrastorage.org/webt/mr/xs/_r/mrxs_ryliqoncau3bzm0xdxj4g4.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonne journ√©e √† tous! </font><font style="vertical-align: inherit;">Je suis un sp√©cialiste technique travaillant dans un syst√®me d'audit interne, mes responsabilit√©s incluent la cr√©ation d'outils ETL dans le langage de programmation C #.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
P√©riodiquement, les sources de donn√©es sont des fichiers √©troitement structur√©s au format xml, csv, json ou tout autre format. Parfois, leur nombre devient assez important et augmente constamment. Par exemple, dans l'une de mes t√¢ches, le nombre de fichiers a augment√© avec un taux de rafra√Æchissement moyen d'environ 150 000 fichiers par jour. Si le traitement simultan√© d'un seul fichier (lecture d'un tableau d'octets du disque dur en m√©moire, transformation des donn√©es t√©l√©charg√©es et √©criture dans la base de donn√©es) prend une seconde, alors il devient clair que le traitement de tous les fichiers prendra plus de 40 heures. Dans ce cas, nous ne pourrons pas traiter ces fichiers jusqu'au bout, car la vitesse d'augmentation du nombre de fichiers sera nettement sup√©rieure √† la vitesse de leur traitement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une solution √† ce probl√®me consiste √† d√©velopper une application dans laquelle cr√©er un pool de threads ind√©pendants les uns des autres. Les threads traiteront les fichiers s√©lectionn√©s dans la file d'attente g√©n√©rale. Cependant, dans ce cas, des difficult√©s surviennent avec la synchronisation des flux de travail et le partage des ressources, car des verrous mutuels sont tr√®s probables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour √©viter ces difficult√©s, Microsoft a ajout√© la biblioth√®que TPL au framework .Net (√† partir de la version 4.0). Je vais vous expliquer comment utiliser cette biblioth√®que pour r√©soudre ce probl√®me.</font></font><br>
<br>
<a name="habracut"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, initialement, l'algorithme d'op√©ration se pr√©sente comme suit: Un </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
r√©pertoire de stockage de fichiers est analys√© et une liste (par exemple, Liste) contenant des donn√©es sur tous les fichiers est renvoy√©e; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Un cycle d√©marre (pour ou pour chaque) dans lequel les donn√©es du fichier suivant sont lues en m√©moire, si n√©cessaire, transform√©es et √©crites dans la base de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De toute √©vidence, les op√©rations les plus chronophages sont la lecture des donn√©es du disque dur dans la m√©moire et l'√©criture des donn√©es de la m√©moire dans la base de donn√©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons d'optimiser notre algorithme √† l'aide de la biblioth√®que TPL: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtape 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifiez la liste renvoy√©e en scannant le r√©pertoire de stockage de fichiers de List √† ConcurrentQueue.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pourquoi fait-on √ßa? Le fait est que la classe ConcurrentQueue est thread-safe, c'est-√†-dire que si en m√™me temps deux threads essaient d'extraire des donn√©es de cette liste ou d'y √©crire des donn√©es, alors nous ne l√®verons pas d'exceptions (Exception). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le point 1 de notre algorithme ressemblera √† ceci: le r√©pertoire de stockage de fichiers est analys√© et la liste ConcurrentQueue est retourn√©e contenant des donn√©es sur tous les fichiers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Point 2: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Modifions la conception en formant un cycle de traitement des donn√©es √† partir d'un fichier. Remplacez par Parallel.For ou Parallel.ForEach. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelle est la diff√©rence entre la nouvelle construction et pour? Tout est simple et fondamentalement clair √† partir du nom de la construction du langage. Toutes les it√©rations de la boucle sont effectu√©es dans des threads parall√®les. √Ä titre d'exemple, je vais montrer l'organisation de la boucle avec la construction Parallel.ForEach:</font></font><br>
<br>
<pre><code class="plaintext hljs">Parallel.ForEach(listFiles, (currentFile) =&gt;<font></font>
       	  {<font></font>
              	var dataFile = getDataFile(currentFile.FullName);<font></font>
		TransformData(dataFile);<font></font>
		WriteToDB(dataFile);<font></font>
               });</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
o√π: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
listFiles est une collection de type ConcurrentQueue contenant une liste de fichiers dans le r√©pertoire; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 currentFile - un √©l√©ment de la collection listFiles, qui est retourn√© par la construction ForEach; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 dataFile - une structure de donn√©es conditionnelle en m√©moire, obtenue en lisant le contenu du fichier dans la m√©moire; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 getDataFile - une fonction conditionnelle qui renvoie le contenu d'un fichier sous la forme d'une structure de donn√©es; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 TransformData - proc√©dure conditionnelle de transformation des donn√©es re√ßues; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 WriteToDB est une proc√©dure conditionnelle pour √©crire des donn√©es dans la base de donn√©es.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet exemple, en utilisant la construction Parallel.ForEach, nous organiserons la boucle. Dans ce cycle, en flux parall√®les, les donn√©es sont lues √† partir du disque dur, leur transformation et leur √©criture dans la base de donn√©es. Dans le m√™me temps, l'organisation du travail des flux parall√®les ne pose aucun probl√®me. Le nombre de threads parall√®les d√©pend du nombre de c≈ìurs de processeur et de leur charge de travail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En utilisant l'algorithme propos√©, nous acc√©l√©rerons le traitement des fichiers d'au moins 2 fois. Bien que, bien s√ªr, ce chiffre varie en fonction du nombre de c≈ìurs et de la m√©moire de la machine sur laquelle le programme s'ex√©cutera. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, pour acc√©l√©rer le programme, vous devez placer l'enregistrement dans la base de donn√©es dans un flux distinct qui fonctionne quel que soit le principal. Cela peut √™tre fait √† l'aide de la collection ConcurrentQueue pour √©viter les conflits lors de l'ajout de donn√©es √† la file d'attente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous r√©√©crivons l'exemple ci-dessus, en tenant compte de l'optimisation de l'√©criture dans la base de donn√©es. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Supposons qu'un lecteur de fichiers nous renvoie des donn√©es dans un DataTable):</font></font><br>
<br>
<pre><code class="plaintext hljs">Parallel.ForEach(listFiles, (currentFile) =&gt;<font></font>
       	  {<font></font>
              	DataTable dataFile = getDataFile(currentFile.FullName);<font></font>
		TransformData(dataFile);<font></font>
		threadWriteToDB.ListData.Enqueue(dataFile);<font></font>
               });<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, au lieu d'une ligne avec un appel √† la proc√©dure d'√©criture dans la base de donn√©es, nous ajoutons simplement √† la collection ConcurrentQueue ListData d√©crite et initialis√©e dans un thread s√©par√©, une instance dont threadWriteToDB est utilis√© dans notre boucle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'√©criture dans la base de donn√©es est d√©j√† dans un flux distinct. </font><font style="vertical-align: inherit;">L'√©criture dans la base de donn√©es peut √™tre organis√©e de la m√™me mani√®re que l'utilisation de fichiers √† l'aide des constructions Parallel.For et / ou Paral-lel.Foreach. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ma t√¢che, o√π le traitement d'un nombre comparable de fichiers √©tait requis, maintenant, en moyenne, de 200 000 √† 400 000 fichiers peuvent √™tre trait√©s par jour, et la vitesse est limit√©e par le chargement de la base de donn√©es et la largeur du canal de donn√©es.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502846/index.html">Zuckerberg a lanc√© Shops. Instagram et Facebook deviennent progressivement des magasins.</a></li>
<li><a href="../fr502852/index.html">Pourquoi les gens r√©sistent-ils au changement et comment peuvent-ils les aider √† reconstruire</a></li>
<li><a href="../fr502854/index.html">Pourquoi les impl√©mentations ERP √©chouent-elles?</a></li>
<li><a href="../fr502860/index.html">Transports le 20 mai: une reprise rapide de l'aviation est visible</a></li>
<li><a href="../fr502862/index.html">LabVIEW NXG - Principes de base du panneau avant - Commandes et indicateurs</a></li>
<li><a href="../fr502870/index.html">Qu'advient-il de la popularit√© de MySQL et PostgreSQL? Discussion Mitap</a></li>
<li><a href="../fr502872/index.html">Comment renforcer l'immunit√© et se prot√©ger contre le SRAS et, probablement, le COVID-19. Preuve scientifique</a></li>
<li><a href="../fr502874/index.html">√Ä propos d'une matrice et d'une atmosph√®re fortes dans l'√©quipe de d√©veloppement</a></li>
<li><a href="../fr502876/index.html">Flux de travail sur Google Drive?</a></li>
<li><a href="../fr502880/index.html">Histoire d'AtariTel. T√©l√©phones et visiophones du service secret de l'entreprise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>