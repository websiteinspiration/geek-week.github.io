<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§”ğŸ¼ ğŸ’• ğŸ˜š Blazorã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ï¼šãƒ‘ãƒ¼ãƒˆ1-èªè¨¼OIDCï¼ˆOAuth2ï¼‰+ Identity Server4 ğŸ¤±ğŸ¿ ğŸ§ğŸ¾ ğŸˆ²</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ã“ã‚“ã«ã¡ã¯ã€ãƒãƒ–ãƒ«ï¼ã ã‹ã‚‰ã€ã¯ã„ã€å‰å›ã®è¨˜äº‹ã§ç§ã¯Blazor Wasmã§Todoãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€æº€è¶³ã—ã¾ã—ãŸã€‚ä»Šã€ç§ã¯ãã‚Œã‚’è©¦ã™ãŸã‚ã«ã€çœŸå‰£ã«ä½•ã‹ã‚’ã¨ã‚‹ã“ã¨ã«æ±ºã‚ã¾ã—ãŸã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ¶ç©ºã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ã®Blazorã§ã‚·ãƒ³ãƒ—ãƒ«ãªSPA UIã‚’ä½œæˆã—ã¾ã™ã€‚æˆ¦é—˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã§ãã‚‹é™ã‚Šè¿‘...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Blazorã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ï¼šãƒ‘ãƒ¼ãƒˆ1-èªè¨¼OIDCï¼ˆOAuth2ï¼‰+ Identity Server4</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484596/"><img src="https://habrastorage.org/webt/0d/by/eu/0dbyeudmd_chabkph5lsogj4gnm.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚“ã«ã¡ã¯ã€ãƒãƒ–ãƒ«ï¼</font><font style="vertical-align: inherit;">ã ã‹ã‚‰ã€ã¯ã„ã€å‰å›ã®è¨˜äº‹ã§ç§ã¯Blazor Wasmã§Todoãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€æº€è¶³ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ä»Šã€ç§ã¯ãã‚Œã‚’è©¦ã™ãŸã‚ã«ã€çœŸå‰£ã«ä½•ã‹ã‚’ã¨ã‚‹ã“ã¨ã«æ±ºã‚ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã‚·ãƒ³ãƒ—ãƒ«ãªæ¶ç©ºã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ã®Blazorã§ã‚·ãƒ³ãƒ—ãƒ«ãªSPA UIã‚’ä½œæˆã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">æˆ¦é—˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã§ãã‚‹é™ã‚Šè¿‘ã„ã€‚</font><font style="vertical-align: inherit;">ã¾ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰¿èªã¨ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ†é›¢ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ç®¡ç†è€…ã¨ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯å°‘ã—ç•°ãªã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã“ã‚Œã‚‚ã™ã¹ã¦Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«åé›†ã—ã¦ã€Dockerãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">è©³ã—ãã¯çŒ«ã¸ã‚ˆã†ã“ãã€‚</font></font><a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›´æ–°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å°ã•ãªã‚‚ã®ã¯ã€æ‰¿èªã¨PWAã‚µãƒãƒ¼ãƒˆã‚’å‚™ãˆãŸwasmç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ãã«ä½œæˆã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">æ‰¿èªç”¨ã®æ–°ã—ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">ã“ã®è¨˜äº‹ã§èª¬æ˜ã™ã‚‹ã“ã¨ã¯ã™ã¹ã¦ã€ã¯ã‚‹ã‹ã«ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚</font></font><br>
<img src="https://habrastorage.org/webt/wi/zf/bl/wizfblynb2fb0vhu3lwozg2ml1s.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blazor + MVVM = SilverlightãŒåæ’ƒã—ã€å¤ä»£ã®æ‚ªã¯ç„¡æ•µã§ã™</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blazorã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ï¼šãƒ‘ãƒ¼ãƒˆ1-èªè¨¼OIDCï¼ˆOAuth2ï¼‰+ Identity Server4</font></font></a><br>
</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blazorã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ãƒˆã‚¢ï¼šãƒ‘ãƒ¼ãƒˆ2-CI / CD</font></font></a></li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‚è€ƒæ–‡çŒ®</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Dockerãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®</font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚½ãƒ¼ã‚¹</font></a></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç™ºå£²</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
composeï¼ˆ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">tyk</font></a><font style="vertical-align: inherit;">ï¼‰ã§</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">docker</font></a><font style="vertical-align: inherit;">ãŒã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦</font><font style="vertical-align: inherit;">ãŠã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒæ©Ÿèƒ½ã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¨¼æ˜æ›¸ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.netã‚³ã‚¢</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—</font><font style="vertical-align: inherit;">ã€Windows PowerShellã§ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="bash hljs"> dotnet --info<font></font>
 dotnet dev-certs https --trust<font></font>
 dotnet dev-certs https -ep <span class="hljs-variable">$env</span>:APPDATA\ASP.NET\Https\blazor-eshop-api.pfx -p 1234Qwert<font></font>
 dotnet dev-certs https -ep <span class="hljs-variable">$env</span>:APPDATA\ASP.NET\Https\blazor-eshop-spa-angular.pfx -p 1234Qwert<font></font>
dotnet dev-certs https -ep <span class="hljs-variable">$env</span>:APPDATA\ASP.NET\Https\blazor-eshop-spa-blazor.pfx -p 1234Qwert<font></font>
dotnet dev-certs https -ep <span class="hljs-variable">$env</span>:APPDATA\ASP.NET\Https\blazor-eshop-sso.pfx -p 1234Qwert
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</font><font style="vertical-align: inherit;">ï¼ˆã¾ãŸã¯ãã®å†…å®¹ã‚’åŒã˜åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ”ãƒ¼ï¼‰ã—ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§docker-compose upã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã‚¢ãƒ‰ãƒ¬ã‚¹</font></font><br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">httpsï¼š// localhostï¼š8000 </font></font></a></b> <br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">httpsï¼š// localhostï¼š8001 </font></font></a></b> <br>
<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">httpsï¼š// localhostï¼š8002</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 and </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">httpsï¼š// localhostï¼š8003ã§</font></font></a></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒªãƒƒã‚¹ãƒ³ã—</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ã¾ã™</font></a></b><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ–ãƒ©ã‚¦ã‚¶ã§WASMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èªè¨¼ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª </font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.nuget.org/packages/Sotsera.Blazor.Oidc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚’</font><font style="vertical-align: inherit;">
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">äººç”Ÿ</font></a><font style="vertical-align: inherit;">ã‚’</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">æ¥½ã—ã‚“ã§ãã ã•ã„</font></a></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identity Server4ã‚’è¨­å®šã™ã‚‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€èˆ¬ã«ã€æ—¢è£½ã®ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ãã“ã«SPAã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">Identity Server4è‡ªä½“ã®è¨­å®šã¯Blazorã«é–¢ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ã€ã“ã®è¨˜äº‹ã®ç¯„å›²ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚</font><font style="vertical-align: inherit;">èˆˆå‘³ãŒã‚ã‚Œã°ã€ç§ã®æƒ…å ±æºã‚’èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™</font></font><br>
<br>
<pre><code class="cs hljs">              <span class="hljs-keyword">new</span> Client<font></font>
                {<font></font>
                    ClientId = <span class="hljs-string">"spaBlazorClient"</span>,<font></font>
                    ClientName = <span class="hljs-string">"SPA Blazor Client"</span>,<font></font>
<font></font>
                    RequireClientSecret = <span class="hljs-literal">false</span>,<font></font>
                    RequireConsent = <span class="hljs-literal">false</span>,<font></font>
<font></font>
                    RedirectUris = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;<font></font>
                    {<font></font>
                        <span class="hljs-string">$"<span class="hljs-subst">{clientsUrl[<span class="hljs-string">"SpaBlazor"</span>]}</span>/oidc/callbacks/authentication-redirect"</span>,
                        <span class="hljs-string">$"<span class="hljs-subst">{clientsUrl[<span class="hljs-string">"SpaBlazor"</span>]}</span>/_content/Sotsera.Blazor.Oidc/silent-renew.html"</span>,
                        <span class="hljs-string">$"<span class="hljs-subst">{clientsUrl[<span class="hljs-string">"SpaBlazor"</span>]}</span>"</span>,<font></font>
                    },<font></font>
                    PostLogoutRedirectUris = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;<font></font>
                    {<font></font>
                        <span class="hljs-string">$"<span class="hljs-subst">{clientsUrl[<span class="hljs-string">"SpaBlazor"</span>]}</span>/oidc/callbacks/logout-redirect"</span>,
                        <span class="hljs-string">$"<span class="hljs-subst">{clientsUrl[<span class="hljs-string">"SpaBlazor"</span>]}</span>"</span>,<font></font>
                    },<font></font>
                    AllowedCorsOrigins = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;<font></font>
                    {<font></font>
                        <span class="hljs-string">$"<span class="hljs-subst">{clientsUrl[<span class="hljs-string">"SpaBlazor"</span>]}</span>"</span>,<font></font>
                    },<font></font>
<font></font>
                    AllowedGrantTypes = GrantTypes.Code,<font></font>
                    AllowedScopes = { <span class="hljs-string">"openid"</span>, <span class="hljs-string">"profile"</span>, <span class="hljs-string">"email"</span>, <span class="hljs-string">"api"</span> },<font></font>
<font></font>
                    AllowOfflineAccess = <span class="hljs-literal">true</span>,<font></font>
                    RefreshTokenUsage = TokenUsage.ReUse<font></font>
                }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
JWTãƒˆãƒ¼ã‚¯ãƒ³ã§ã‚ˆã‚Šå¤šãã®ãƒ­ãƒ¼ãƒ«ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€IProfileServiceã‚’å®Ÿè£…ã—ã¾ã™ </font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">using</span> IdentityModel;
<span class="hljs-keyword">using</span> IdentityServer4.Models;
<span class="hljs-keyword">using</span> IdentityServer4.Services;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Identity;
<span class="hljs-keyword">using</span> Microsoft.eShopOnContainers.Services.Identity.API.Models;
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.IdentityModel.Tokens.Jwt;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> System.Security.Claims;
<span class="hljs-keyword">using</span> System.Threading.Tasks;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Microsoft.eShopOnContainers.Services.Identity.API.Services</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProfileService</span> : <span class="hljs-title">IProfileService</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> UserManager&lt;ApplicationUser&gt; _userManager;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ProfileService</span>(<span class="hljs-params">UserManager&lt;ApplicationUser&gt; userManager</span>)</span><font></font>
        {<font></font>
            _userManager = userManager;<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">public</span> Task <span class="hljs-title">GetProfileDataAsync</span>(<span class="hljs-params">ProfileDataRequestContext context</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> subject = context.Subject ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(context.Subject));<font></font>
<font></font>
            <span class="hljs-keyword">var</span> subjectId = subject.Claims.Where(x =&gt; x.Type == <span class="hljs-string">"sub"</span>).FirstOrDefault().Value;<font></font>
<font></font>
            <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">await</span> _userManager.FindByIdAsync(subjectId);
            <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"Invalid subject identifier"</span>);
            <span class="hljs-keyword">var</span> claims = GetClaimsFromUser(user);<font></font>
            context.IssuedClaims = claims.ToList();<font></font>
            <span class="hljs-keyword">var</span> roles = <span class="hljs-keyword">await</span> _userManager.GetRolesAsync(user);
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> role <span class="hljs-keyword">in</span> roles)<font></font>
            {<font></font>
                context.IssuedClaims.Add(<span class="hljs-keyword">new</span> Claim(JwtClaimTypes.Role, role));<font></font>
            }<font></font>
           <font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">public</span> Task <span class="hljs-title">IsActiveAsync</span>(<span class="hljs-params">IsActiveContext context</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> subject = context.Subject ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(context.Subject));<font></font>
<font></font>
            <span class="hljs-keyword">var</span> subjectId = subject.Claims.Where(x =&gt; x.Type == <span class="hljs-string">"sub"</span>).FirstOrDefault().Value;
            <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">await</span> _userManager.FindByIdAsync(subjectId);<font></font>
<font></font>
            context.IsActive = <span class="hljs-literal">false</span>;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>)<font></font>
            {<font></font>
                <span class="hljs-keyword">if</span> (_userManager.SupportsUserSecurityStamp)<font></font>
                {<font></font>
                    <span class="hljs-keyword">var</span> security_stamp = subject.Claims.Where(c =&gt; c.Type == <span class="hljs-string">"security_stamp"</span>).Select(c =&gt; c.Value).SingleOrDefault();
                    <span class="hljs-keyword">if</span> (security_stamp != <span class="hljs-literal">null</span>)<font></font>
                    {<font></font>
                        <span class="hljs-keyword">var</span> db_security_stamp = <span class="hljs-keyword">await</span> _userManager.GetSecurityStampAsync(user);
                        <span class="hljs-keyword">if</span> (db_security_stamp != security_stamp)
                            <span class="hljs-keyword">return</span>;<font></font>
                    }<font></font>
                }<font></font>
<font></font>
                context.IsActive =<font></font>
                    !user.LockoutEnabled ||<font></font>
                    !user.LockoutEnd.HasValue ||<font></font>
                    user.LockoutEnd &lt;= DateTime.Now;<font></font>
            }<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerable&lt;Claim&gt; <span class="hljs-title">GetClaimsFromUser</span>(<span class="hljs-params">ApplicationUser user</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> claims = <span class="hljs-keyword">new</span> List&lt;Claim&gt;<font></font>
            {<font></font>
                <span class="hljs-keyword">new</span> Claim(JwtClaimTypes.Subject, user.Id),
                <span class="hljs-keyword">new</span> Claim(JwtClaimTypes.PreferredUserName, user.UserName),
                <span class="hljs-keyword">new</span> Claim(JwtRegisteredClaimNames.UniqueName, user.UserName)<font></font>
            };<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.Name))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"name"</span>, user.Name));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.LastName))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"last_name"</span>, user.LastName));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.CardNumber))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"card_number"</span>, user.CardNumber));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.CardHolderName))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"card_holder"</span>, user.CardHolderName));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.SecurityNumber))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"card_security_number"</span>, user.SecurityNumber));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.Expiration))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"card_expiration"</span>, user.Expiration));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.City))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"address_city"</span>, user.City));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.Country))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"address_country"</span>, user.Country));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.State))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"address_state"</span>, user.State));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.Street))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"address_street"</span>, user.Street));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.ZipCode))<font></font>
                claims.Add(<span class="hljs-keyword">new</span> Claim(<span class="hljs-string">"address_zip_code"</span>, user.ZipCode));<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (_userManager.SupportsUserEmail)<font></font>
            {<font></font>
                claims.AddRange(<span class="hljs-keyword">new</span>[]<font></font>
                {<font></font>
                    <span class="hljs-keyword">new</span> Claim(JwtClaimTypes.Email, user.Email),
                    <span class="hljs-keyword">new</span> Claim(JwtClaimTypes.EmailVerified, user.EmailConfirmed ? <span class="hljs-string">"true"</span> : <span class="hljs-string">"false"</span>, ClaimValueTypes.Boolean)<font></font>
                });<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">if</span> (_userManager.SupportsUserPhoneNumber &amp;&amp; !<span class="hljs-keyword">string</span>.IsNullOrWhiteSpace(user.PhoneNumber))<font></font>
            {<font></font>
                claims.AddRange(<span class="hljs-keyword">new</span>[]<font></font>
                {<font></font>
                    <span class="hljs-keyword">new</span> Claim(JwtClaimTypes.PhoneNumber, user.PhoneNumber),
                    <span class="hljs-keyword">new</span> Claim(JwtClaimTypes.PhoneNumberVerified, user.PhoneNumberConfirmed ? <span class="hljs-string">"true"</span> : <span class="hljs-string">"false"</span>, ClaimValueTypes.Boolean)<font></font>
                });<font></font>
            }<font></font>
<font></font>
            <span class="hljs-keyword">return</span> claims;<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã§ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã®è¦ç‚¹ã¯ </font></font><br>
<br>
<pre><code class="cs hljs">
  <span class="hljs-keyword">var</span> roles = <span class="hljs-keyword">await</span> _userManager.GetRolesAsync(user);
  <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> role <span class="hljs-keyword">in</span> roles)<font></font>
  {<font></font>
     context.IssuedClaims.Add(<span class="hljs-keyword">new</span> Claim(JwtClaimTypes.Role, role));<font></font>
  }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãã—ã¦ãã‚Œã‚’asp.netã«è¿½åŠ ã—ã¾ã™ </font></font><br>
<br>
<pre><code class="cs hljs">services.AddIdentityServer().AddProfileService&lt;ProfileService&gt;()</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã“ã§ã¯ã€è¨­å®šã®è»¢é€ãŒéå¸¸ã«ç°¡å˜ã ã£ãŸã®ã§ã€ASP.NET Coreãƒ›ã‚¹ãƒˆã‚’é¸æŠã—ã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®çµ„ã¿ç«‹ã¦ãŒç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚</font><font style="vertical-align: inherit;">å¿…è¦ã«å¿œã˜ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¼å†…ã§nginxã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eh/ez/5e/ehez5ei_v0untezw-n132dvrhb4.png"><br>
<br>
<img src="https://habrastorage.org/webt/i1/0a/sc/i10ascbtjvdueaqdyzvsmhl5yfu.png"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ãŠã‚ˆã³ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã®è¨­å®šã®è»¢é€</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚µãƒ¼ãƒå´</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¨­å®šãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ ã™ã‚‹ </font></font><br>
<br>
<pre><code class="cs hljs">
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ConfigModel</span><font></font>
    {<font></font>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> SsoUri { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> ApiUri { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">string</span>.Empty;<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Startup.csã«ç™»éŒ²ã™ã‚‹</font></font><br>
<br>
<pre><code class="cs hljs">
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><font></font>
        {<font></font>
            services.AddMvc();<font></font>
            services.AddResponseCompression(opts =&gt;<font></font>
            {<font></font>
                opts.MimeTypes = ResponseCompressionDefaults.MimeTypes.Concat(<font></font>
                    <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"application/octet-stream"</span> });<font></font>
            });<font></font>
            services.Configure&lt;ConfigModel&gt;(Configuration);<font></font>
        }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
jsonã¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¸¡ã™ </font></font><br>
<br>
<pre><code class="cs hljs">
<span class="hljs-keyword">using</span> BlazorEShop.Shared.Presentation;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Mvc;
<span class="hljs-keyword">using</span> Microsoft.Extensions.Options;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">BlazorEShop.Spa.BlazorWasm.Server.Controllers</span><font></font>
{<font></font>
    [<span class="hljs-meta">Route(<span class="hljs-meta-string">"api/v1/config"</span>)</span>]<font></font>
    [<span class="hljs-meta">ApiController</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ConfigController</span> : <span class="hljs-title">ControllerBase</span><font></font>
    {<font></font>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IOptionsSnapshot&lt;ConfigModel&gt; _configuration;<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConfigController</span>(<span class="hljs-params">IOptionsSnapshot&lt;ConfigModel&gt; configuration</span>)</span><font></font>
        {<font></font>
            _configuration = configuration;<font></font>
        }<font></font>
        <span class="hljs-comment">// GET: api/&lt;controller&gt;</span>
        [<span class="hljs-meta">HttpGet</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> ConfigModel <span class="hljs-title">Get</span>(<span class="hljs-params"></span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">return</span> _configuration.Value;<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¨­å®šã‚’å–å¾—ã—ã€DIã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«è¿½åŠ ã—ã¾ã™</font></font><br>
<br>
<pre><code class="cs hljs">
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Net.Http;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> BlazorEShop.Shared.Presentation;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Blazor.Hosting;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Components;
<span class="hljs-keyword">using</span> Microsoft.Extensions.DependencyInjection;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">BlazorEShop.Spa.BlazorWasm.Client</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><font></font>
        {<font></font>
            Task.Run(<span class="hljs-keyword">async</span> () =&gt;<font></font>
            {<font></font>
                ConfigModel cfg = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> host = BlazorWebAssemblyHost.CreateDefaultBuilder().Build();
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> scope = host.Services.CreateScope())<font></font>
                {<font></font>
                    <span class="hljs-keyword">var</span> nm = scope.ServiceProvider.GetRequiredService&lt;NavigationManager&gt;();
                    <span class="hljs-keyword">var</span> uri = nm.BaseUri;<font></font>
                    Console.WriteLine(<span class="hljs-string">$"BASE URI: <span class="hljs-subst">{uri}</span>"</span>);<font></font>
                    cfg = <span class="hljs-keyword">await</span> GetConfig(<span class="hljs-string">$"<span class="hljs-subst">{(uri.EndsWith(<span class="hljs-string">'/'</span>) ? uri : uri + <span class="hljs-string">"/"</span>)}</span>api/v1/config"</span>);<font></font>
                }<font></font>
                <span class="hljs-keyword">await</span> BlazorWebAssemblyHost<font></font>
                    .CreateDefaultBuilder()<font></font>
                    .ConfigureServices(x =&gt; x.AddScoped&lt;ConfigModel&gt;(y =&gt; cfg))<font></font>
                    .UseBlazorStartup&lt;Startup&gt;()<font></font>
                    .Build()<font></font>
                    .StartAsync()<font></font>
                     .ContinueWith((a, b) =&gt; Console.WriteLine(a.Exception), <span class="hljs-literal">null</span>);<font></font>
            });<font></font>
            Console.WriteLine(<span class="hljs-string">"END MAIN"</span>);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;ConfigModel&gt; <span class="hljs-title">GetConfig</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> url</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> HttpClient();
            <span class="hljs-keyword">var</span> cfg = <span class="hljs-keyword">await</span> client<font></font>
                .GetJsonAsync&lt;ConfigModel&gt;(url);<font></font>
            <span class="hljs-keyword">return</span> cfg;<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Blazor Wasmã¯async void Mainã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚‰ãšã€ã‚¹ãƒ¬ãƒƒãƒ‰ãŒ1ã¤ã—ã‹ãªã„ãŸã‚ã€ã‚¿ã‚¹ã‚¯ã‹ã‚‰çµæœã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ã€ã™ã¹ã¦ã‚’Task.Runï¼ˆasyncï¼ˆï¼‰=&gt; {}ï¼‰;ã§ãƒ©ãƒƒãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§OIDCï¼ˆOAuth2ï¼‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ConfigModelå†…ã®ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã£ãŸè¨­å®šã§services.AddOidcã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cs hljs">
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Components.Builder;
<span class="hljs-keyword">using</span> Microsoft.Extensions.DependencyInjection;
<span class="hljs-keyword">using</span> Sotsera.Blazor.Oidc;
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Net.Http;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> BlazorEShop.Shared.Presentation;
<span class="hljs-keyword">using</span> Microsoft.AspNetCore.Components;<font></font>
<font></font>
<span class="hljs-keyword">namespace</span> <span class="hljs-title">BlazorEShop.Spa.BlazorWasm.Client</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Startup</span><font></font>
    {<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureServices</span>(<span class="hljs-params">IServiceCollection services</span>)</span><font></font>
        {<font></font>
            <span class="hljs-keyword">var</span> provider = services.BuildServiceProvider();
            <span class="hljs-keyword">var</span> cfg = provider.GetService&lt;ConfigModel&gt;();<font></font>
            services.AddOidc(<span class="hljs-keyword">new</span> Uri(cfg.SsoUri), (settings, siteUri) =&gt;<font></font>
            {<font></font>
                settings.UseDefaultCallbackUris(siteUri);<font></font>
                settings.ClientId = <span class="hljs-string">"spaBlazorClient"</span>;<font></font>
                settings.ResponseType = <span class="hljs-string">"code"</span>;<font></font>
                settings.Scope = <span class="hljs-string">"openid profile email api"</span>;<font></font>
                settings.UseRedirectToCallerAfterAuthenticationRedirect();<font></font>
                settings.UseRedirectToCallerAfterLogoutRedirect();<font></font>
                settings.MinimumLogeLevel = Microsoft.Extensions.Logging.LogLevel.Information;<font></font>
                settings.LoadUserInfo = <span class="hljs-literal">true</span>;<font></font>
                settings.FilterProtocolClaims = <span class="hljs-literal">true</span>;<font></font>
                settings.MonitorSession = <span class="hljs-literal">true</span>;<font></font>
                settings.StorageType = Sotsera.Blazor.Oidc.Configuration.Model.StorageType.LocalStorage;<font></font>
            });<font></font>
        }<font></font>
<font></font>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Configure</span>(<span class="hljs-params">IComponentsApplicationBuilder app</span>)</span><font></font>
        {<font></font>
            app.AddComponent&lt;App&gt;(<span class="hljs-string">"app"</span>);<font></font>
        }<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">App.razorã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ§‹æˆ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 App.blazor-è¨±å¯ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç•°ãªã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã€oidcã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‹ã‚‰ã®ãƒ«ãƒ¼ãƒˆãŒæ¥ç¶šã•ã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="cs hljs"><font></font>
@using BlazorEShop.Shared.Presentation<font></font>
@using Microsoft.AspNetCore.Components<font></font>
@using Microsoft.Extensions.DependencyInjection<font></font>
@using Sotsera.Blazor.Oidc<font></font>
@inject IUserManager UserManager<font></font>
<font></font>
&lt;Router AppAssembly=<span class="hljs-string">"@typeof(Program).Assembly"</span> AdditionalAssemblies=<span class="hljs-string">"new[] { typeof(IUserManager).Assembly }"</span>&gt;<font></font>
    &lt;Found Context=<span class="hljs-string">"routeData"</span>&gt;<font></font>
        &lt;AuthorizeRouteView RouteData=<span class="hljs-string">"@routeData"</span> DefaultLayout=<span class="hljs-string">"@typeof(MainLayout)"</span>&gt;<font></font>
            &lt;NotAuthorized&gt;<font></font>
                &lt;h3&gt;Sorry&lt;/h3&gt;<font></font>
                &lt;p&gt;You<span class="hljs-string">'re not authorized to reach this page.&lt;/p&gt;
                &lt;p&gt;You may need to log in as a different user.&lt;/p&gt;
            &lt;/NotAuthorized&gt;
            &lt;Authorizing&gt;
                &lt;h3&gt;Authentication in progress&lt;/h3&gt;
            &lt;/Authorizing&gt;
        &lt;/AuthorizeRouteView&gt;
    &lt;/Found&gt;
    &lt;NotFound&gt;
        &lt;CascadingAuthenticationState&gt;
            &lt;LayoutView Layout="@typeof(MainLayout)"&gt;
                &lt;h3&gt;Sorry&lt;/h3&gt;
                &lt;p&gt;Sorry, there'</span>s nothing at <span class="hljs-keyword">this</span> address.&lt;/p&gt;<font></font>
            &lt;/LayoutView&gt;<font></font>
        &lt;/CascadingAuthenticationState&gt;<font></font>
    &lt;/NotFound&gt;<font></font>
&lt;/Router&gt;<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¯ã€IUserManagerã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ä»‹ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</font><font style="vertical-align: inherit;">DIã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¾‹ãˆã°ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><font></font>
@inject IUserManager UserManager<font></font>
@using Sotsera.Blazor.Oidc<font></font>
@using Microsoft.Extensions.DependencyInjection<font></font>
&lt;AuthorizeView&gt;<font></font>
    &lt;Authorized&gt;<font></font>
        &lt;span <span class="hljs-keyword">class</span>=<span class="hljs-string">"login-display-name mr-3"</span>&gt;<font></font>
            Hello, @context.User.Identity.Name!<font></font>
        &lt;/span&gt;<font></font>
        &lt;button type=<span class="hljs-string">"button"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"btn btn-primary btn-sm"</span> @onclick=<span class="hljs-string">"LogoutRedirect"</span>&gt;<font></font>
            Log <span class="hljs-keyword">out</span><font></font>
        &lt;/button&gt;<font></font>
    &lt;/Authorized&gt;<font></font>
    &lt;NotAuthorized&gt;<font></font>
        &lt;button type=<span class="hljs-string">"button"</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">"btn btn-primary btn-sm"</span> @onclick=<span class="hljs-string">"LoginRedirect"</span>&gt;<font></font>
            Log <span class="hljs-keyword">in</span><font></font>
        &lt;/button&gt;<font></font>
    &lt;/NotAuthorized&gt;<font></font>
&lt;/AuthorizeView&gt;<font></font>
<font></font>
@code<font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LoginRedirect</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">await</span> UserManager.BeginAuthenticationAsync(p =&gt; p.WithRedirect());<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">LogoutRedirect</span>(<span class="hljs-params"></span>)</span> =&gt; <span class="hljs-keyword">await</span> UserManager.BeginLogoutAsync(p =&gt; p.WithRedirect());<font></font>
}<font></font>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¨±å¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨éè¨±å¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã®ã•ã¾ã–ã¾ãªæƒ…å ±ã®è¡¨ç¤º</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã§ã€AuthorizeViewã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»»æ„ã®éƒ¨åˆ†ã§ã€æ‰¿èªã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒè¡¨ç¤ºã™ã‚‹é ˜åŸŸã‚’æŒ‡å®šã§ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã§ãã‚‹ãƒ­ãƒ¼ãƒ«ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</font></font><br>
<br>
<pre><code class="xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">AuthorizeView</span> <span class="hljs-attr">Roles</span>=<span class="hljs-string">"admin, administrator"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Authorized</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>User Info<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>@context.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><font></font>
        @foreach (var c in context.User.Claims)<font></font>
        {<font></font>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>@c.Type : @c.Value : @string.Join(";", c.Properties.Select(x =&gt; $"{x.Key} : {x.Value}"))<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><font></font>
        }<font></font>
<font></font>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Authorized</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">NotAuthorized</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>       admin   administrator<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">NotAuthorized</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">AuthorizeView</span>&gt;</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰¿èªã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹å‰²ã«å¿œã˜ã¦ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã™ã¹ã¦ãŒæ¨™æº–å±æ€§Authorizeã«ãªã‚Šã¾ã™ã€‚</font><font style="vertical-align: inherit;">ã‚‚ã¡ã‚ã‚“ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã»ã†ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»»æ„ã®ãƒ­ãƒ¼ãƒ«ã‚’æŒã¤è¨±å¯ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒšãƒ¼ã‚¸</font></font><br>
<br>
<pre><code class="xml hljs">@page "/user"<font></font>
@attribute [Authorize]<font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>     <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç®¡ç†è€…ã¾ãŸã¯ãƒœã‚¹ã®å½¹å‰²ã‚’æŒã¤æ‰¿èªã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒšãƒ¼ã‚¸ </font></font><br>
<br>
<pre><code class="xml hljs">@page "/admin"<font></font>
@attribute [Authorize(Roles="admin, boss")]<font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>      admin  boss<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APIå‘¼ã³å‡ºã—</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€DIã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‹ã‚‰å–å¾—ã§ãã‚‹OidcHttpClientã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</font><font style="vertical-align: inherit;">ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«è‡ªå‹•çš„ã«ç½®ãã¾ã™ã€‚</font><font style="vertical-align: inherit;">ä¾‹ãˆã°ï¼š</font></font><br>
<br>
<pre><code class="cs hljs">
@page <span class="hljs-string">"/fetchdata"</span><font></font>
@inject Sotsera.Blazor.Oidc.OidcHttpClient Http<font></font>
@inject BlazorEShop.Shared.Presentation.ConfigModel Config<font></font>
<font></font>
@using BlazorEShop.Shared.Presentation<font></font>
&lt;h1&gt;Weather forecast&lt;/h1&gt;<font></font>
<font></font>
&lt;p&gt;This component demonstrates fetching data <span class="hljs-keyword">from</span> the server.&lt;/p&gt;<font></font>
<font></font>
@if (products == <span class="hljs-literal">null</span>)<font></font>
{<font></font>
    &lt;p&gt;&lt;em&gt;Loading...&lt;/em&gt;&lt;/p&gt;<font></font>
}<font></font>
<span class="hljs-keyword">else</span><font></font>
{<font></font>
    &lt;table <span class="hljs-keyword">class</span>=<span class="hljs-string">"table"</span>&gt;<font></font>
        &lt;thead&gt;<font></font>
            &lt;tr&gt;<font></font>
                &lt;th&gt;Id&lt;/th&gt;<font></font>
                &lt;th&gt;Version&lt;/th&gt;<font></font>
            &lt;/tr&gt;<font></font>
        &lt;/thead&gt;<font></font>
        &lt;tbody&gt;<font></font>
            @foreach (<span class="hljs-keyword">var</span> product <span class="hljs-keyword">in</span> products.Value)<font></font>
            {<font></font>
                &lt;tr&gt;<font></font>
                    &lt;td&gt;@product.Id&lt;/td&gt;<font></font>
                    &lt;td&gt;@product.Version&lt;/td&gt;<font></font>
                &lt;/tr&gt;<font></font>
            }<font></font>
        &lt;/tbody&gt;<font></font>
    &lt;/table&gt;<font></font>
}<font></font>
<font></font>
@code {<font></font>
    <span class="hljs-keyword">private</span> PageResultModel&lt;ProductModel&gt; products;<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">OnInitializedAsync</span>(<span class="hljs-params"></span>)</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> uri = Config.ApiUri;<font></font>
        products = <span class="hljs-keyword">await</span> Http.GetJsonAsync&lt;PageResultModel&lt;ProductModel&gt;&gt;(<span class="hljs-string">$"<span class="hljs-subst">{(uri.EndsWith(<span class="hljs-string">'/'</span>) ? uri : uri + <span class="hljs-string">"/"</span>)}</span>api/v1/products?take=100&amp;skip=0"</span>);<font></font>
    }<font></font>
}<font></font>
</code></pre></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja484584/index.html">ITãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒå¿…è¦ãªç†ç”±ã¨ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒã„ãªã„å ´åˆã«ä½•ãŒèµ·ã“ã‚‹ã‹</a></li>
<li><a href="../ja484586/index.html">PHPã§IPv6ã‚’ä½¿ç”¨ã™ã‚‹</a></li>
<li><a href="../ja484588/index.html">è‡ªå‹•ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç®¡ç†ãƒ¢ãƒ‡ãƒ«</a></li>
<li><a href="../ja484590/index.html">ç”·ã®å­ãŒè¦‹ã›ã‚‹ã“ã¨ã‚’æ¥ã˜ãªã„ã‚ˆã†ã«</a></li>
<li><a href="../ja484592/index.html">å…ˆé€±ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä¸–ç•Œã‹ã‚‰ã®æ–°é®®ãªé£Ÿæã®ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆNo. 398ï¼ˆ2020å¹´1æœˆ13æ—¥ã€œ19æ—¥ï¼‰</a></li>
<li><a href="../ja484600/index.html">Microsoft Ignite The Tour Prague Technical Conference</a></li>
<li><a href="../ja484602/index.html">æœ¬ã€ŒiOSãŠã‚ˆã³Androidå‘ã‘Cï¼ƒã§ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã€</a></li>
<li><a href="../ja484604/index.html">æ–°å¹´ã€æ–°ã—ã„ãƒ–ãƒ©ã‚¦ã‚¶ï¼šMicrosoft Edgeã®äºˆå‚™è©•ä¾¡ãŒçµ‚äº†ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ</a></li>
<li><a href="../ja484606/index.html">ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã¯2030å¹´ã¾ã§ã«ãƒã‚¤ãƒŠã‚¹ã®ç‚­ç´ æ’å‡ºé‡ã«å®Œå…¨ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™</a></li>
<li><a href="../ja484610/index.html">ã•ã‚ˆãªã‚‰ã‚¯ãƒªãƒ¼ãƒ³ã‚³ãƒ¼ãƒ‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>