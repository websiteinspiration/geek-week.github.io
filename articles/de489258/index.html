<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤹🏻 💸 🍡 Wie werden sehr lange Ganzzahltypen in Python implementiert? 💇🏽 👵🏽 🙎🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine Übersetzung des Artikels wurde speziell für Studenten des Python Developer- Kurses erstellt .
 
 
 
 
 Wenn Sie in einer einfachen Sprache wie C ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wie werden sehr lange Ganzzahltypen in Python implementiert?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489258/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Übersetzung des Artikels wurde speziell für Studenten des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python Developer-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kurses erstellt </font><font style="vertical-align: inherit;">.</font></font><br>
</i></b><br>
<br>
<img src="https://habrastorage.org/webt/83/4n/6h/834n6hzjg8axynzih1kpbfszk_4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie in einer einfachen Sprache wie C schreiben, müssen Sie den richtigen Datentyp und die richtigen Qualifikationsmerkmale für Ihre Ganzzahlen auswählen. Bei jedem Schritt analysieren Sie, ob es ausreicht, sie einfach zu verwenden, </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder ob Sie sie hinzufügen </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oder sogar </font><font style="vertical-align: inherit;">hinzufügen müssen </font></font><code>long double</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn Sie Code in Python schreiben, müssen Sie sich jedoch nicht um diese „kleinen“ Dinge kümmern, da Python mit Zahlen </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeder Größe arbeiten kann.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie in C versuchen, 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20000</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der integrierten Funktion </font><font style="vertical-align: inherit;">zu berechnen </font></font><code>powl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, erhalten Sie die Ausgabe </font></font><code>inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>
<span class="hljs-comment">#include &lt;math.h&gt;</span><font></font>
<font></font>
int main(void) {<font></font>
  printf(<span class="hljs-string">"%Lf\n"</span>, powl(<span class="hljs-number">2</span>, <span class="hljs-number">20000</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
$ ./a.out<font></font>
inf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Python ist es jedoch einfach, dies einfacher als je zuvor zu machen:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">2</span> ** <span class="hljs-number">20000</span>
<span class="hljs-number">39802768403379665923543072061912024537047727804924259387134</span> ...<font></font>
...<font></font>
<span class="hljs-meta">... </span><span class="hljs-number">6021</span> digits long ...<font></font>
...<font></font>
<span class="hljs-number">6309376</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es muss unter der Haube sein, dass Python etwas sehr Schönes tut, und heute werden wir herausfinden, was es tut, um mit ganzen Zahlen beliebiger Größe zu arbeiten!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Präsentation und Definition</font></font></h3> <br>
<code>Integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In Python ist dies eine C-Struktur, die wie folgt definiert ist:</font></font><br>
<br>
<pre><code class="python hljs">struct _longobject {<font></font>
    PyObject_VAR_HEAD<font></font>
    digit ob_digit[<span class="hljs-number">1</span>];<font></font>
};<font></font>
</code></pre><br>
<code>PyObject_VAR_HEAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist ein Makro, zu dem es erweitert </font></font><code>PyVarObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird und das folgende Struktur hat:</font></font><br>
<br>
<pre><code class="python hljs">typedef struct {<font></font>
    PyObject ob_base;<font></font>
    Py_ssize_t ob_size; /* Number of items <span class="hljs-keyword">in</span> variable part */<font></font>
} PyVarObject;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Andere Typen, die haben </font></font><code>PyObject_VAR_HEAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyBytesObject</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyTupleObject</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyListObject</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies bedeutet, dass eine Ganzzahl wie ein Tupel oder eine Liste eine variable Länge hat. Dies ist der erste Schritt, um zu verstehen, wie Python die Arbeit mit riesigen Zahlen unterstützen kann. </font><font style="vertical-align: inherit;">Nach der Erweiterung kann das Makro </font></font><code>_longobject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wie folgt betrachtet werden:</font></font><br>
<br>
<pre><code class="python hljs">struct _longobject {<font></font>
    PyObject ob_base;<font></font>
    Py_ssize_t ob_size; /* Number of items <span class="hljs-keyword">in</span> variable part */<font></font>
    digit ob_digit[<span class="hljs-number">1</span>];<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es </font></font><code>PyObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt einige Metafelder </font><font style="vertical-align: inherit;">in der Struktur </font><font style="vertical-align: inherit;">, die für die Referenzzählung (Garbage Collection) verwendet werden. Um darüber zu sprechen, benötigen wir jedoch einen separaten Artikel. </font><font style="vertical-align: inherit;">Das Feld , </font><font style="vertical-align: inherit;">auf das wir diese konzentrieren </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und in einem wenig </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entschlüsselung </font></font><code>ob_digit</code></h3> <br>
<code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist ein statisch zugewiesenes Array mit einer Einheitslänge vom Typ </font></font><code>digit (typedef  uint32_t)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Da es sich um ein Array handelt, handelt es </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sich in erster Linie um einen Zeiger auf eine Zahl. Daher kann es bei Bedarf mithilfe der Malloc-Funktion auf eine beliebige Länge erhöht werden. </font><font style="vertical-align: inherit;">Auf diese Weise kann Python sehr lange Zahlen darstellen und verarbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einfachen Sprachen wie C ist die Genauigkeit von Ganzzahlen normalerweise auf 64 Bit begrenzt. Python unterstützt jedoch Ganzzahlen mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beliebiger Genauigkeit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ab Python 3 werden alle Nummern in der Form dargestellt </font></font><code>bignum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und sind nur durch den verfügbaren Systemspeicher begrenzt.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entschlüsselung </font></font><code>ob_size</code></h3><br>
<code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">speichert die Anzahl der Artikel in </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Python überschreibt und verwendet den Wert </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, um die tatsächliche Anzahl der im Array enthaltenen Elemente zu bestimmen und die Effizienz beim Zuweisen von Speicher zum Array zu erhöhen </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lager</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der naivste Weg, Ganzzahlen zu speichern, besteht darin, eine Dezimalstelle in einem Element des Arrays zu speichern. Dann können Operationen wie Addition und Subtraktion gemäß den Regeln der Mathematik der Grundschule ausgeführt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei diesem Ansatz wird die Nummer 5238 folgendermaßen gespeichert: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z_/gt/qz/z_gtqzwee0xfpoaktyogzh1_cv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Ansatz ist ineffizient, da bis zu 32-Bit-Ziffern (uint32_t) zum Speichern einer Dezimalstelle verwendet werden, die tatsächlich zwischen 0 und 9 liegt und mit nur 4 Bit leicht dargestellt werden kann. Wenn Sie etwas so Vielseitiges wie Python schreiben, sollte der Kernel-Entwickler noch erfinderischer sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Können wir es also besser machen? </font><font style="vertical-align: inherit;">Natürlich hätte ich diesen Artikel sonst nicht gepostet. </font><font style="vertical-align: inherit;">Schauen wir uns genauer an, wie Python eine extra lange Ganzzahl speichert.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python-Pfad</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anstatt nur eine Dezimalstelle in jedem Element des Arrays zu speichern </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, konvertiert Python Zahlen aus dem Zahlensystem mit einer Basis von 10 in Zahlen in einem System mit einer Basis von 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ruft jedes Element als Ziffer auf, deren Wert zwischen 0 und 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30-1 liegt</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Hexadezimalzahlensystem </font><font style="vertical-align: inherit;">bedeutet </font><font style="vertical-align: inherit;">die Basis 16 ~ 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dass jede "Ziffer" der Hexadezimalzahl im Dezimalzahlensystem von 0 bis 15 reicht. In Python ebenfalls eine „Zahl“ mit einer Basis von 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , was bedeutet, dass die Zahl von 0 bis 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 = 1073741823 in Dezimalzahl variiert.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf diese Weise nutzt Python effizient fast den gesamten zugewiesenen Speicherplatz von 32 Bit pro Ziffer, spart Ressourcen und führt dennoch einfache Operationen aus, z. B. das Addieren und Subtrahieren auf der mathematischen Ebene der Grundschule. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je nach Plattform verwendet Python entweder vorzeichenlose 32-Bit-Ganzzahl-Arrays oder vorzeichenlose 16-Bit-Ganzzahl-Arrays mit 15-Bit-Ziffern. Um die Operationen auszuführen, die später erläutert werden, benötigen Sie nur wenige Bits. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel: 1152921504606846976</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wie bereits erwähnt, werden für Python Zahlen in einem Basis-2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30-System dargestellt</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn Sie also 1152921504606846976 in eine Basisnummer mit 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30-</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Basis konvertieren </font><font style="vertical-align: inherit;">, erhalten Sie 100. </font></font><br>
 <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1152921504606846976 = 1 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30)</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 0 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 0 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sup></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Da die </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niedrigstwertige Ziffer zuerst gespeichert wird, wird sie als 001 als drei Ziffern gespeichert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Struktur </font></font><code>_longobject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">für diesen Wert enthält:</font></font><br>
<br>
<ul>
<li><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie 3</font></font></li>
<li><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie [0, 0, 1]</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hb/fj/y4/hbfjy4kl64ogtyfjjx6hikzvray.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe eine Demo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REPL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die zeigen, wie Python eine ganze Zahl in sich speichert, und bezieht sich auch auf Strukturelemente , </font><font style="vertical-align: inherit;">wie beispielsweise </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ob_refcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usw.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ganzzahlige lange Operationen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir eine klare Vorstellung davon haben, wie Python Ganzzahlen mit beliebiger Genauigkeit implementiert, ist es an der Zeit zu verstehen, wie verschiedene mathematische Operationen mit ihnen ausgeführt werden.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusatz</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ganzzahlen werden "in Zahlen" gespeichert, was bedeutet, dass das Hinzufügen so einfach ist wie in der Grundschule, und der Python-Quellcode zeigt uns, dass das Hinzufügen auf diese Weise implementiert wird. </font><font style="vertical-align: inherit;">Eine Funktion mit einem Namen </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">x_add</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in einer Datei </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fügt zwei Zahlen hinzu.</font></font><br>
<br>
<pre><code class="python hljs">...
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; size_b; ++i) {<font></font>
        carry += a-&gt;ob_digit[i] + b-&gt;ob_digit[i];<font></font>
        z-&gt;ob_digit[i] = carry &amp; PyLong_MASK;<font></font>
        carry &gt;&gt;= PyLong_SHIFT;<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (; i &lt; size_a; ++i) {<font></font>
        carry += a-&gt;ob_digit[i];<font></font>
        z-&gt;ob_digit[i] = carry &amp; PyLong_MASK;<font></font>
        carry &gt;&gt;= PyLong_SHIFT;<font></font>
    }<font></font>
    z-&gt;ob_digit[i] = carry;<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das obige Code-Snippet stammt aus einer Funktion </font></font><code>x_add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wie Sie sehen können, durchläuft es eine Zahl nach Zahlen und fügt Zahlen hinzu, berechnet das Ergebnis und fügt einen Bindestrich hinzu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Interessanter wird es, wenn das Ergebnis der Addition eine negative Zahl ist. </font><font style="vertical-align: inherit;">Das Vorzeichen </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist ein ganzzahliges Vorzeichen. Wenn Sie also eine negative Zahl haben, ist es </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein Minus. </font><font style="vertical-align: inherit;">Der Wert </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modulo bestimmt die Anzahl der Stellen in </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subtraktion </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So wie die Addition stattfindet, findet auch die Subtraktion statt. </font><font style="vertical-align: inherit;">Eine Funktion mit einem Namen </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">x_sub</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Datei </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subtrahiert eine Zahl von einer anderen.</font></font><br>
<br>
<pre><code class="python hljs">...
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; size_b; ++i) {<font></font>
        borrow = a-&gt;ob_digit[i] - b-&gt;ob_digit[i] - borrow;<font></font>
        z-&gt;ob_digit[i] = borrow &amp; PyLong_MASK;<font></font>
        borrow &gt;&gt;= PyLong_SHIFT;<font></font>
        borrow &amp;= <span class="hljs-number">1</span>; /* Keep only one sign bit */<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (; i &lt; size_a; ++i) {<font></font>
        borrow = a-&gt;ob_digit[i] - borrow;<font></font>
        z-&gt;ob_digit[i] = borrow &amp; PyLong_MASK;<font></font>
        borrow &gt;&gt;= PyLong_SHIFT;<font></font>
        borrow &amp;= <span class="hljs-number">1</span>; /* Keep only one sign bit */<font></font>
    }<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das obige Code-Snippet stammt aus einer Funktion </font></font><code>x_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Darin sehen Sie, wie die Zahlen aufgezählt und die Subtraktion durchgeführt, das Ergebnis berechnet und die Übertragung verteilt wird. </font><font style="vertical-align: inherit;">In der Tat ist es der Addition sehr ähnlich.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiplikation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wieder wird die Multiplikation auf die gleiche naive Weise implementiert, die wir aus den Lektionen der Mathematik in der Grundschule gelernt haben, aber sie ist nicht sehr effizient. </font><font style="vertical-align: inherit;">Um die Effizienz aufrechtzuerhalten, implementiert Python </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Karatsuba-Algorithmus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , der zwei n-stellige Zahlen in </font><font style="vertical-align: inherit;">einfachen Schritten von </font><font style="vertical-align: inherit;">O (n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log </font></font></sup><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></sub><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">multipliziert </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Algorithmus ist nicht einfach und seine Implementierung geht über den Rahmen dieses Artikels hinaus. Sie finden seine Implementierung jedoch in Funktionen </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">k_mul</a> </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">k_lopsided_mul</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Datei </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abteilung und andere Operationen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle Operationen für Ganzzahlen sind in der Datei definiert </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sie sind sehr einfach zu finden und zu verfolgen. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achtung: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein detailliertes Verständnis der Arbeit jedes einzelnen von ihnen wird einige Zeit in Anspruch nehmen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python ordnet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kleine Anzahl von Ganzzahlen im Speicher zwischen -5 und 256 vor. Diese Zuordnung erfolgt während der Initialisierung. Da wir die Ganzzahlen nicht ändern können (Unveränderlichkeit), sind diese vorab zugewiesenen Zahlen Singleton und werden direkt referenziert, anstatt zugewiesen zu werden. Dies bedeutet, dass Python jedes Mal, wenn wir eine kleine Nummer verwenden / erstellen, anstelle eines Verkaufs einfach einen Verweis auf die zuvor zugewiesene Nummer zurückgibt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine solche Optimierung kann im Makro </font></font><code>IS_SMALL_INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font><font style="vertical-align: inherit;">in der </font><font style="vertical-align: inherit;">Funktion </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">get_small_int</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c verfolgt werden </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Python spart also viel Platz und Zeit bei der Berechnung häufig verwendeter Ganzzahlen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist der zweite Artikel in der Python Internals-Reihe. Der erste Artikel befasste sich damit, wie ich meine Version von Python geändert habe, um sie zu erstellen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mehrdeutig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es wird Ihnen helfen, die ersten Schritte zum Verständnis des Python-Quellcodes zu unternehmen und den Weg zum Python-Kernel-Entwickler fortzusetzen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie weitere ähnliche Artikel sehen möchten, abonnieren Sie meinen Newsletter und erhalten Sie diese direkt in Ihrem Posteingang. </font><font style="vertical-align: inherit;">Ich schreibe jeden Freitag über Engineering, Systems Engineering und ein wenig über Programmierung. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schicken Sie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mir eine </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">E-Mail</font></a><font style="vertical-align: inherit;"> an </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">@arpit_bhayani</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sie finden meine vorherigen Artikel auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ arpitbhayani.me / Blogs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das ist alles. </font><font style="vertical-align: inherit;">Wir sehen uns auf dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kurs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de489244/index.html">Plugin-Entwicklung für Zabbix Agent 2</a></li>
<li><a href="../de489246/index.html">Ich bin 14 und habe beschlossen, ein Spiel zu entwickeln</a></li>
<li><a href="../de489252/index.html">Die Geschichte des Telegramms: Von der Idee zur eigenen Kryptowährung</a></li>
<li><a href="../de489254/index.html">Hilft Yandex bei der Verbreitung von Malware?</a></li>
<li><a href="../de489256/index.html">Foundation Fieldbus Automation Systems</a></li>
<li><a href="../de489260/index.html">Entwerfen eines automatisierten Großsystems für ein großes Unternehmen in sieben Schritten</a></li>
<li><a href="../de489262/index.html">Warum es nicht einfach ist, Entwicklern Wahlfreiheit zu geben</a></li>
<li><a href="../de489268/index.html">Implementierung des Prozesses zum Hochladen einer Datei aus einem Container mit einem Browser in ein Testframework</a></li>
<li><a href="../de489270/index.html">WebAuthn im wirklichen Leben</a></li>
<li><a href="../de489272/index.html">Augen, Gehirn, Videoqualität: Reflexionen auf 120 fps, 8K, HDR, Zauberstäben, Zapfen und dem „Seifenoper-Effekt“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>