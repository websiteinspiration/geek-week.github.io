<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😉 👨‍🍳 🤹🏿 使用积分图像计算O（1）的质心 💪🏻 🤟🏼 🤞🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="集成图像是一种算法，可让您有效地计算包含在多维数组的矩形子集中的值的总和。他的想法可以追溯到多维概率分布函数的研究，直到现在，他已经在直接使用概率论作为主要工具包的那些领域中找到了成功的应用。例如，在模式识别中。
 
 今天，我们将考虑一个奇怪的案例，即如何在根本不同的领域中应用积分图像-计算物理学...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>使用积分图像计算O（1）的质心</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/493300/"><img src="https://habrastorage.org/webt/jz/zu/un/jzzuunk1lhxykcm7wzw8abqoaek.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集成图像是一种算法，可让您有效地计算包含在多维数组的矩形子集中的值的总和。</font><font style="vertical-align: inherit;">他的想法可以追溯到多维概率分布函数的研究，直到现在，他已经在直接使用概率论作为主要工具包的那些领域中找到了成功的应用。</font><font style="vertical-align: inherit;">例如，在模式识别中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今天，我们将考虑一个奇怪的案例，即如何在根本不同的领域中应用积分图像-计算物理学。</font><font style="vertical-align: inherit;">即，让我们看看如果我们用它们计算脉冲场的质心会发生什么，以及从这种共生中可以得到什么好处。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我将介绍：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是什么样的任务？</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解有关集成图像的更多信息；</font></font></li>
<li>         N       (-);</li>
<li>        ;</li>
<li>, ,          .</li>
</ul><a name="habracut"></a><br>
<h2>  N </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对N个物体系统的引力相互作用的严格解决方案是指具有二次复杂性的算法：系统中的所有其他物体对每个物体都具有引力作用</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，需要针对N </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2/2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对中的每对来计算重力相互作用的力</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了说明严格的解决方案非常耗时，您可以尝试将计算实际系统的复杂性与现代计算机的性能相关联。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要计算三维空间中两个物体之间的重力，必须使用浮点（FLOP）执行20次操作。在太阳系中，大约有100个大于200公里的天体（包括太阳，9个行星，矮行星和卫星）</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。近地轨道上的小行星大约为2万</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在小行星带中，</font><font style="vertical-align: inherit;">木星</font><font style="vertical-align: inherit;">的“特洛伊木” </font><sup><font style="vertical-align: inherit;">[5]</font></sup><font style="vertical-align: inherit;">和“希腊”组中</font><font style="vertical-align: inherit;">有1.1至190万个大于1公里的天体</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和大约一百万个类似的小行星</font><font style="vertical-align: inherit;">。在柯伊伯带，约有1亿个大于20公里的物体</font><sup><font style="vertical-align: inherit;">[6]，</font></sup><font style="vertical-align: inherit;">还有约2万亿个</font><font style="vertical-align: inherit;">物体</font><font style="vertical-align: inherit;">存在于奥尔特云</font><sup><font style="vertical-align: inherit;">[7]中</font></sup><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
严格解决最后一个重力问题所需的计算能力仅比在神经水平上模拟人脑工作所需的计算能力小一个数量级（2.5×10 </font><sup><font style="vertical-align: inherit;">26</font></sup><font style="vertical-align: inherit;">）</font><sup><font style="vertical-align: inherit;">[8]。</font></sup></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"></font><br>
<br>
<img src="https://habrastorage.org/webt/zp/yx/dq/zpyxdqsshts30cbhyethrg6l1nq.jpeg"><br>
<br><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，通常将其严格的解决方案替换为近似的解决方案。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
关于重力问题的近似解的最广泛使用的算法之一-树码-具有准线性时间复杂度O（N * logN）</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[9]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。树代码构建一个空间树，并为该树中的每个节点计算落入其中的所有物体的总质量和质量中心。此外，在计算作用在每个物体上的重力时，树码可以不考虑其他物体的直接影响，而可以考虑树节点的影响，并根据距离选择越来越大的节点，这些节点包含越来越多的物体子集的参数。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fy/mu/cp/fymucpzatvvwlghoadwjgdzku3y.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维基百科的插图。</font><font style="vertical-align: inherit;">中心的物体上有绿色矩形表示的节点质量。</font><font style="vertical-align: inherit;">仅直接考虑最近物体的质量。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动量场的重力问题</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
动量场是离散向量场</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mv（p）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它</font><font style="vertical-align: inherit;">使质量速度对与所</font><font style="vertical-align: inherit;">考虑的空间</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个点</font><font style="vertical-align: inherit;">相关联。</font><font style="vertical-align: inherit;">可以为任何尺寸的空间设置脉冲场。</font><font style="vertical-align: inherit;">一对速度是动量的特征，代表维数为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 1 </font><font style="vertical-align: inherit;">的向量</font><font style="vertical-align: inherit;">，其中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是为其提供脉冲场的空间的维数。</font><font style="vertical-align: inherit;">例如，对于R = 2，这可以是向量{ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></sub></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></sub></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> }。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
值得注意的是，该系统描述的数学传统形式是矢量速度场和标量质量场的组合。在这种情况下，由于我们不假装数学，因此我们可以自由地将速度和质量组合在一个向量中。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gl/sf/ku/glsfku0yn1u3tdyftw6noww3fhg.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脉冲矢量场的一小部分：质量用颜色表示，方向用箭头表示</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/xc/qh/uc/xcqhuc3vgvbr8-k4ybjmbeoh5na.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；脉冲矢量场的大小为729×729个元素。左边是群众。右边是冲动。此图中的脉冲以HSV格式进行颜色编码（色调是脉冲的方向，“值”线性显示其绝对值的顺序，以使最不明显（值= 0.05）的脉冲大约为10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-7</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，最明亮的脉冲（值= 1 ，0）的数量级为10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或更高。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
类似于网格的描述物理系统的方法在天体物理学中被广泛使用，以模拟气体云的演化，恒星和星系的形成。这些包括SAMR方法</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[10]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或流体力学的网格模型</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[11]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与N个物体的引力问题一样，离散场的演化必须考虑组成该场的所有质量对其每个离散元素的引力影响。有必要考虑到问题的复杂性间接取决于空间</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R的大小</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：例如，对于平面上由1000×1000个元素组成的场，总数N将为10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，并且在三维空间中大小相同的字段将已经包含10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9个</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
尽管如此，仍有许多技巧可以近似地解决动量场的重力问题。 Multigrid方法使用分层离散化，支持各种大小的几个网格</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[12]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。多极扩展将彼此靠近的一组源视为一个对象</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。 Multigrid具有拟线性计算复杂度和对数存储复杂度。多极扩展选项之一-FMM-演示了线性计算复杂性，以换取降低的计算精度</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[14]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下面我们考虑另一种方法，该方法可以解决准线性时间内脉冲的离散场的重力问题，并且在存储器中具有线性复杂度。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整合影像</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
积分图像允许在任意矩形区域</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[15]中</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算恒定时间的原始图像元素之和</font><font style="vertical-align: inherit;">。在计算机图形学中，最初提出集成图像作为mipmapping和各向异性过滤的替代方法</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[16]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此外，它们已成功用于数字图像处理和模式识别技术。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
集成映像是在计算复杂度和内存复杂度之间进行权衡的最明显示例之一。用于计算图像元素总和的“幼稚”算法的时间复杂度为O（M * N），存储复杂度为O（1）。集成映像使您可以在O（1）时间内执行相同的计算，并且具有O（M * N）的存储复杂度。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_f/dp/ap/_fdpapnp5qlfd1e7uwv1hkqd614.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用积分图像来计算给定区域中元素的总和</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
积分图像的算法非常简单，具有线性计算复杂性，并且在GPGPU下易于并行化</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[17]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。它的实现就像两次通过高斯滤波器</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[18]一样</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在第一遍中，考虑行的部分和，在第二遍中，这些部分和被累积在列中。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/c9/gt/d-c9gtnjp-6xcsuykgfd0ruwhn4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分两次计算积分图像。左边是原始图像。中间是线条的部分数量。右边是最终的集成图像。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/ak/si/rc/aksircbzhaq2lby19dpbiaxwhwo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左侧是包含大量元素的图像。右边是其整体形象。左右图像使用不同的对数比例。</font></font></i><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用积分图像的引力问题的近似解</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
有了整体质量的图像，不难适应树码和多极扩展的技术特点。</font><font style="vertical-align: inherit;">因此，对于离散字段的每个元素：</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们直接考虑到只有邻近的八个元素的质量的影响；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用积分图像计算它们的质量总和，我们考虑了由九个元素（3×3）组成的八个相邻区域的影响；</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在每个后续步骤中，我们将区域的大小增加3倍（9×9、27×27、81×81等），直到该区域超过整个矢量场的大小为止。</font></font></li>
</ol><br>
 <img src="https://habrastorage.org/webt/u8/fy/qb/u8fyqbvn6-8o53z-hxsptyogxzk.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用质量积分图像对作用于脉冲矢量场的元素的力的近似计算对于使用积分图像的脉冲场</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
的引力问题的近似解的复杂度近似线性增长，如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = 2的</font><font style="vertical-align: inherit;">O（N * 8 * log3（sqrt（N）））</font><font style="vertical-align: inherit;">与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于3的O（N * 26 * log3（cbrt（N）））相似</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ik/ou/zg/ikouzgiqpe4r0gs70ib-cxkxd9q.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是，这种形式的解决方案具有与Multigrid技术相同的缺点，即引力函数低频分量的可感知离散“刚度”。清楚地证明此问题的最简单方法。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/t-/1c/j8/t-1cj8ryo2xicugndkrgg6i_s3i.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此图中的力以HSV格式进行颜色编码（色相是力的方向，“值”以最小可分辨（值= 0.05）的力为10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-7</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方式线性显示其绝对值的顺序</font><font style="vertical-align: inherit;">，而最亮的力（值= 1， 0）的数量级为10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和更高。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
在上面的插图中，重力函数的低频分量的“刚度”效应是肉眼可察觉的。但是，如果在“ Multigrid”中此“刚性”是由于采样频率的降低而发生的，那么在集成图像中这是由于缺乏有关质量空间分布性质的信息而导致的。事实是，使用积分图像估算力的算法认为质心与区域中心重合。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yp/p-/bt/ypp-bt8mx3i_w3g22ryuyveix_y.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图的中心显示了在场的其余部分具有相对均匀质量分布的</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
质量</font><i><font style="vertical-align: inherit;">极值，该</font></i><font style="vertical-align: inherit;">质量</font><i><font style="vertical-align: inherit;">极值</font></i><font style="vertical-align: inherit;">落入四个矩形区域的每个区域中。显然，每个区域的质心位置应与白色表示的元素大致重合，白色表示的元素的质量比黄色表示的区域中大多数元素的质量大三个数量级。然而，在这些区域的重力函数的低频分量的计算中，据信它们的质心与圆圈所表示的区域的中心重合。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以通过将其他信息引入到积分图像中来解决此问题，这不仅可以计算给定区域中的质量总和，还可以计算质心的坐标。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，让我们尝试想象一个图像，其中每个元素都包含自己的坐标。相应的积分图像将包含坐标之和。因此，该积分图像的任意区域的总和除以该区域中元素的总数，将等于该区域中心的坐标。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/jc/ay/cp/jcaycpxtpzl1zn73lydkfbuwzig.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坐标</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
的</font><i><font style="vertical-align: inherit;">整体图像</font></i><font style="vertical-align: inherit;">例如，左下角的坐标为{3; 1}，在右上角的坐标为{7; 5}。该区域的坐标之和{168; 120}-{18; 45}-{28; 0} + {3; 0}是{125; 75}，元素总数为25，因此其中心坐标为{5; 75}。 3}。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
剩下要做的只是概括这种特殊情况，在这种情况下，我们认为图像的所有元素都具有等于1的相同权重系数。为了考虑不同的权重，我们将元素的坐标乘以它们。如果将加权坐标的总和除以加权因子的总和，我们将获得区域中心的加权坐标。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o-/b5/nb/o-b5nb0apzvgpvx_mzegt-gcjza.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加权坐标的集成图像。较大的字体表示重量</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑左下角的坐标为{2;的区域。 1}，并在右上方，坐标为{5; 4}。该区域的加权系数的总和为4.8-1.0-0.6 + 0.2为3.4，其加权坐标的总和为{11.1; 13.2}-{0.5; 2.0}-{1.5; 0,0} + {0,1; 0,0}等于{9,2; 11.2}。因此，该区域的中心的加权坐标为{2.7; 3.3}。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了确保该电路真正起作用，您可以在视觉上-通过使用距离变换</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[19]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将具有加权坐标的积分图像转换为距离场</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5-/id/lq/5-idlqqfst1l6fektpcfezhxp2s.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将具有加权坐标的积分图像转换为距离场。左边是群众的形象。下图是3×3元素区域到质心的距离。接下来是9×9和27×27元素大小的区域到质心的距离。在此插图中，距离值已标准化为用于采样的区域的大小。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/dv/yy/q7/dvyyq7f-7eyoq3-ppjmfsoddouo.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将具有加权坐标的积分图像转换为有向距离场。方向和距离以HSV格式进行颜色编码，其中色相是方向，值是标准化距离。在此插图中，距离值已标准化为用于采样的区域的大小。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
总结以上所有内容：</font></font><br>
<br>
<ol>
<li>   ,     ,    ( ,  <i>R</i> = 3)  ―   ,  ,   .</li>
<li>               .</li>
<li>        O(1).</li>
<li>           O(M*N).</li>
</ol><br>
 <img src="https://habrastorage.org/webt/zk/ts/ti/zktstidnvrzkvinkpx9tiekqofy.png"><br>
<i>    .  ―        .  ―        .</i><br>
<br>
<h2>      </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
需要注意集成图像的关键特征之一，这仍然限制了它们的应用范围，即资源消耗和数值稳定性。因此，根据原始图像包含的值的范围，其完整图像可能需要更长的数据类型。例如，在计算标准差时，除了原始图像（值范围0..255）之外，还使用包含相应值的平方（值范围0..65535）的图像。在这种情况下，准确性不足以计算32位的大规模集成图像</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[20]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在具有加权坐标的积分图像的情况下，观察到类似情况。本身，必须存储在积分图像中的坐标总和的值随图像尺寸N的增加而增大：对于一维情况，二次方为0 +1 + 2 + ... + N-1 =（N-1）* N / 2二维N *（N-1）* N / 2例如，要存储一个2048×2048大小的图像（等于4292870144）的一个整数坐标的总和，一个32位无符号整数（最大值为4294967295）几乎不够。计算较大的积分图像时，会发生溢出。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在集成图像中的使用32位浮点数的延迟溢出的由天文距离（问题10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），但同时，由于在求和过程中累积的截断误差，加权坐标计算的准确性会大大降低</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[21]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ab/dc/hd/abdchducjcslm8db-fhmwtqnk14.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算大小为4×4元素的区域的加权质心时的误差的绝对值。集成图像包含单精度数字（32位）。</font></font></i><br>
<br>
<img src="https://habrastorage.org/webt/wu/zt/qj/wuztqj-7c30j-yhdhnd7gwugrs4.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算大小为32×32元素的区域的加权质心时的误差的绝对值。集成图像包含单精度数字（32位）。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过计算小区域的加权质心，可以实现最大的绝对值。该区域的大小增加两个数量级会导致计算的绝对误差的大小减少四个数量级。在这种情况下，没有发现计算误差对加权系数的值范围的依赖（用于计算元素的加权坐标）。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nn/xg/at/nnxgat46ty-pm8x78yh9ph-d3cq.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权重范围的增加不会影响计算加权质心时误差的绝对值。该图显示了“最差”区域（在集成图像的右上角）的错误。集成图像的大小为256×256个元素。</font></font></i><br>
 <br>
<img src="https://habrastorage.org/webt/j3/im/68/j3im68bh4wkidntnuo9ihllayxs.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着区域的大小增加，在计算加权质心时误差的绝对值减小。该图显示了“最差”区域（在集成图像的右上角）的错误。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
基于上述分析，我们可以得出结论，使用单精度数来使用集成图像计算加权质心仅对大小约为512×512元素的图像有意义。随着尺寸的进一步增加，误差的大小变得可与图像元素的尺寸相媲美。并且尽管该误差随区域大小的增加而减小，但较小的区域对最终结果（重力的大小）影响最大，因此，仅应考虑相应的误差。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对于较大的图像，您可以使用双精度加权坐标或添加一个以上的离散化级别：将原始图像分为几个部分，并分别读取每个部分的积分图像。</font><font style="vertical-align: inherit;">从计算复杂度的角度来看，如果使用一个以上的积分图像来计算一个区域的元素之和，但是这个“多个”是一个常数，则总和计算算法的复杂性不会改变。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上面使用集成图像的示例可能适合于开发用于按重要性进行采样（重要性采样）的最佳算法O（1）。</font><font style="vertical-align: inherit;">从GPU的角度来看，现有的且极其耗费资源的算法具有线性复杂度O（N），并在现代全局照明方法中找到了应用</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[22，23]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我看来，总的来说，集成图像是最被低估的算法之一。</font><font style="vertical-align: inherit;">它们可以同时替代mipmapping和各向异性过滤，并且考虑到后者是如何在GPU上实现的</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[24，25]</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它们很有可能已经是一种更有效的措施。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考文献</font></font></h2><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看清单</font></font></b><div class="spoiler_text"><ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/N-body_problem</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/List_of_Solar_System_objects_by_size</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Near-Earth_object</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Asteroid</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Trojan_</a>(celestial_body)</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Kuiper_belt</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Oort_cloud</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Computer_performance_by_orders_of_magnitude</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Barnes%E2%80%93Hut_simulation</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">link.springer.com/chapter/10.1007/978-1-4612-1252-2_10</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.researchgate.net/publication/281362507_Grid-Based_Hydrodynamics_in_Astrophysical_Fluid_Flows</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Multigrid_method</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Multipole_expansion</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">math.nyu.edu/faculty/greengar/shortcourse_fmm.pdf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Summed-area_table</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.florian-oeser.de/wordpress/wp-content/2012/10/crow-1984.pdf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.nmr.mgh.harvard.edu/~berkin/Bilgic_2010_Integral_Image.pdf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Gaussian_blur</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Distance_transform</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">staffhome.ecm.uwa.edu.au/~00082689/papers/Shafait-efficient-binarization-SPIE08.pdf</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Truncation_error</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">t.co/Muf6I3yq71?amp=1</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-20-gpu-based-importance-sampling</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Mipmap</a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">en.wikipedia.org/wiki/Anisotropic_filtering</a></li>
</ol><br>
</div></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN493284/index.html">Kubernetes 1.18：关键创新概述</a></li>
<li><a href="../zh-CN493288/index.html">五个著名的解释性编程引号</a></li>
<li><a href="../zh-CN493292/index.html">响应还是响应？解析React组件结构</a></li>
<li><a href="../zh-CN493294/index.html">我们用TTL观察苏联集成电路内部</a></li>
<li><a href="../zh-CN493298/index.html">C ++，元编程和微控制器寄存器</a></li>
<li><a href="../zh-CN493302/index.html">已经要求使用什么技术来对抗冠状病毒？</a></li>
<li><a href="../zh-CN493304/index.html">从零开始开发六脚架（第8部分）-改进了数学运算</a></li>
<li><a href="../zh-CN493306/index.html">使用网关API作为Web应用程序和API的单一入口点</a></li>
<li><a href="../zh-CN493308/index.html">将几乎所有员工转移到远程站点的真实经验</a></li>
<li><a href="../zh-CN493310/index.html">上帝的游戏：人造生物</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>