<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💝 🎱 🕵️ Microsoftリモートデスクトップとの連携を強化する方法 💙 📣 🤛🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RDPを介したワークステーションへのリモート接続のセットアップに関するいくつかのヒントを共有したいと思います。古代のRPC-HTTPをUDPにアップグレードし、Windows 10とAVCを称賛し、叱る方法を説明します。いくつかの典型的な問題の解決策を見つけ出します。
 
 リモートデスクトップゲー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Microsoftリモートデスクトップとの連携を強化する方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/501132/"><img src="https://habrastorage.org/webt/dx/s8/wi/dxs8wiugrbhaov1gzied15gldk8.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDPを介したワークステーションへのリモート接続のセットアップに関するいくつかのヒントを共有したいと思います。古代のRPC-HTTPをUDPにアップグレードし、Windows 10とAVCを称賛し、叱る方法を説明します。いくつかの典型的な問題の解決策を見つけ出します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リモートデスクトップゲートウェイ（RDGW）が接続に使用され、ワー​​クステーションがサーバーとして機能すると考えています。ゲートウェイはすべてのクライアントの共通のエントリポイントになるため、RDGWを使用すると非常に便利です。これにより、アクセスをより適切に制御し、接続とその期間の記録を保持することができます。 VPNで直接稼働中のマシンに接続できる場合でも、これは最良のオプションではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RDGWはすばやく簡単に構成でき、Let's Encryptとwin-acmeを使用すると、信頼できる証明書で問題を簡単に解決できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントがサーバーに接続できるトランスポートプロトコルは3つあります</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。RPC-HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="red"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悪い</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="orange"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">良い</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP + UDP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><font color="green"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">優れた</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーとは、稼働中のマシン、クライアント-自宅を意味します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず最初に、「悪い」を「優れた」に変えることです。</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RPC-HTTPをHTTPにアップグレードする</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RPC-HTTPを使用したセッションへの接続は、接続ストリップの外観によって簡単に判断できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/7w/-0/aa/7w-0aativt247pvbumddqkf4epg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続品質のアイコンはありません（下図について）。つまり、TLSでラップされた古いRPCを使用しています。これは非常に低速です。</font><font style="vertical-align: inherit;">もちろん、要点はラッパーだけではありません。プロトコル自体は、OS、コーデック、イメージパッキングアルゴリズムのリリースごとに変化します。</font><font style="vertical-align: inherit;">プロトコルが新しいほど良いです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何をすべきか？</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XPまたはVista</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XPでは、プロトコルを5.1から7に上げることができます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。windowsxp-kb969084-x86.exe修正プログラム。Vista</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
では、6から7に修正されます。修正プログラムには同じ番号があり、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows6.0-kb969084-x64.msuまたはWindows6.0-KB969084-x86ファイル.msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ただし、RDP 7はHTTPおよびUDPを介して機能しません。クライアントとサーバーをWindows 7以降にアップグレードするだけで問題が解決します。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
まず、プロトコルをRDP 8.1にアップグレードしてから、有効にする必要があります。 ：サポートは、単一のダウンロードパッケージにグループ化されているアップデートで追加され</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.microsoft.com/en-US/download/details.aspx?id=40986</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Windows6.1-KB2574819-v2の-x64.msuの</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
windows6.1-kb2592687-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2830477-x64.msu </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows6.1-KB2857650-x64.msu </font></font><br>
<s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows6.1-KB2913751-x64.msu</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><s><font style="vertical-align: inherit;">kb2923545に</font></s><font style="vertical-align: inherit;">置き換えられました）</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows6.1-kb2923545-x64.msu</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
したがって、OSのサーバー側で、新鮮なmstsc.exeクライアントとRDP 8.1サポートの両方を利用できます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yx/37/pl/yx37plxdymw73eubymzh1v0zgzm.png"><br>
<br>
<img src="https://habrastorage.org/webt/r1/kh/ip/r1khiphuyrmxmmodab_ecjiktiq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それはなりました：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/rt/9v/dj/rt9vdjdnfmus27h9nyn7ctpyp7g.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、プロトコルはレジストリキーで有効にする必要があります（これにはWindows 7にバンドルされているadmテンプレートを使用できます）。</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span><font></font>
 <font></font>
[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SOFTWARE</span>\<span class="hljs-type">Wow6432Node</span>\<span class="hljs-type">Policies</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Windows</span> <span class="hljs-type">NT</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Services</span>]
<span class="hljs-string">"fServerEnableRDP8"</span>=dword:<span class="hljs-number">00000001</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループポリシーでUDPトランスポートサポートを有効にします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bg/_t/ds/bg_tdse5uudrekmylffvhh_gqzq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows 7でサーバーを再起動します。2回再起動する必要がある場合と同じケースです。RDPをオンにする前にレジストリの値を設定し、グループポリシーを後で適用する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが</font><font style="vertical-align: inherit;">
うまく</font><font style="vertical-align: inherit;">いった場合、サーバーに接続すると、接続品質アイコン（モバイルネットワーク用の電話など）がセッションバーに表示されます</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8b/_0/ok/8b_0okltugyxpizhhcydchtsve8.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Windows8以降</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プロトコルはそのまま使用できます。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPをHTTP + UDPにアップグレードする</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ネットワークでパケット損失が発生しにくい場合、UDPは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して再送信を削減し、TCP / IPシステムスタックからRDP-UDPプロトコルレベルにパケット配信確認を切り替えること</font><font style="vertical-align: inherit;">により、サーバーの応答性を大幅に（CADの場合-大幅に）向上させます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTP経由の1つのメインコントロールセッションが各クライアントから接続され（キーボード/マウスもこのチャネルで送信されます）、さらに1つ以上のUDPセッションが画像または他の仮想チャネルを送信します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
氷山の一角だけに触れます。 RDP-UDPプロトコルには3つの異なるバージョンがあります。さらに、UDP自体は、UDP-R（高信頼性）とUDP-L（非可逆）の2つのモードで動作できます。マイクロソフトだけでは何も起こりません。ただし、ここでは何も関係ないので、オペレーティングシステムが新しいほど、トピックはより最新のプロトコルを使用することに注意してください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wiresharkを開くとわかるように、外部では、RDP-UDPはデータグラムトランスポート層セキュリティ（DTLS）RFC4347にラップされています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
文書で詳細：</font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEMT]：リモートデスクトッププロトコル：マルチトランス拡張</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEUDP]：リモートデスクトッププロトコル：UDP交通拡張</font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[MS-RDPEUDP2]：リモートデスクトッププロトコル：UDP交通Extensionバージョン2</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
間違って、正しいですどういたしまして。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UDPを有効にするために何が必要ですか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RDP-UDPはRDP 8以降でサポート</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
されています。クライアントでudp / 3389ポートが開いている必要があります。ローカルファイアウォール、スイッチのACL、または外部ファイアウォールでポートを閉じた場合、ポートを開く必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リモートデスクトップゲートウェイサーバーをtcp / 443ポートに接続するには、udp / 3391を開きます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ポートは変更できます。ここでは</font></font><br>
<br>
<img src="https://habrastorage.org/webt/o6/n0/w3/o6n0w3fmookrhmxaqomyx8wretk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その</font><font style="vertical-align: inherit;">構成方法を示します</font><font style="vertical-align: inherit;">。Windows7の場合、NLA（ネットワークレベル認証）を有効にする必要があります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/nt/kz/ny/ntkznyeqsvsh3msad2u59_rxcck.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
グループポリシー</font></font><br>
<br>
<img src="https://habrastorage.org/webt/my/hj/sw/myhjswie2h7znzjoamnhf6clzq4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
またはレジストリ</font><font style="vertical-align: inherit;">で有効にすることができ</font><font style="vertical-align: inherit;">ます</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span>\<span class="hljs-type">WinStations</span>\<span class="hljs-type">RDP</span>-<span class="hljs-type">Tcp</span>]
<span class="hljs-string">"SecurityLayer"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続が何であるかは明確ではありません。ただし、7-keのNLAがないと機能しません。最新のNLAのリリースでは、UDPは必要ありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTPを介してセッションを確立した後、クライアントとサーバー</font><font style="vertical-align: inherit;">はUDP接続のネゴシエーションを</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">試み</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。パケット損失または遅延がある場合、UDPセッションは開始されません。正確なUDPネゴシエーション失敗アルゴリズムは完全には理解されていません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてが構成されている場合は、接続後にリンク品質ボタンをクリックします。ウィンドウには、UDPがネゴシエートされていることが示されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d7/y4/jx/d7y4jx5ubs4i9zop5myyzg21oyo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ゲートウェイでは、次のようになります</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oc/ld/7n/ocld7nbslu8dt_fjahnvd-zqvso.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。Windows 10</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーとクライアントの両方にWindows 10がある場合、これが最も速く、問題のないオプションです。マイクロソフトは積極的にRDPを完成させており、最新のリリース10ではかなりの速度を期待できます。同僚は、AutoCADの速度でCitrixとWindows 10 RDPの違いを検出できませんでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows 10 </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモートデスクトッププロトコル（RDP）10でのAVC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベースのRDPコーデックの進化に関する優れた記事があり</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ます。Windows10およびWindows Server 2016でのAVC / H.264の技術的な改善テクニカルプレビュー</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ハードウェアエンコーディングとAVCのマッチングは、イベントログで確認できます（詳細については、上記の記事を参照してください） ）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/kf/4_/_n/kf4__nmejj4amr9nctpufhwfb6a.png"><br>
<br>
<img src="https://habrastorage.org/webt/ld/rn/ld/ldrnldvgbclldmcr2f8pxoztfxo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、h.264 4：4：4.でも歪みの問題があることに注意してください。</font><font style="vertical-align: inherit;">PowerShell ISEで作業すると、すぐに目を引く-エラーテキストが不快な歪みで表示されます。</font><font style="vertical-align: inherit;">さらに、スクリーンショットと写真はすべて問題ありません。</font><font style="vertical-align: inherit;">マジック。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、AVCの作業の間接的な兆候は、隅に緑色の四角が表示される場合があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フレッシュビルドのAVCおよびハードウェアエンコーディングはそのまま使用できますが、グループポリシーが不必要になることはありません。AVC </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pn/hc/uo/pnhcuobl3frw-p4pfodd9xr_tsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
がビデオカードでハードウェアエンコードされていることを考えると、ビデオドライバーの更新は良い考えです。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">問題について</font></font></h1><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XPおよびVista</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
問題がWindows XPまたはVistaで発生する場合は、まずプロトコルをバージョン7に更新してみてください（記事の冒頭に記載）。 CredSSPサポートを必ず有効にしてください。マイクロソフトはサイト上の記事をすでに削除しました</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が、インターネットは記憶しています</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それが役に立たない場合は、「医師は死体安置所に話しかけ、次に死体安置所に話しかけます」。オペレーティングシステムが過去15年間に経験したことは、それについてさえ考えない方が良いです。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NLA</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
サーバーでNLAを無効にすると役立つ場合があります。それは原因を解決しませんでした、自家用車はすべて異なります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
一部のクライアントは、NTLMv1を使用してログインしようとします。理由は異なりますが、クライアントで次のように修正できます。</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_LOCAL_MACHINE</span>\<span class="hljs-type">SYSTEM</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Lsa</span>]
<span class="hljs-string">"LmCompatibilityLevel"</span>=dword:<span class="hljs-number">00000003</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
再起動が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがいる場合</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、若くて大胆にしている</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何を恐れて、その後、より根本的な解決がある- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チャネルバインディングを無効にする</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモートデスクトップゲートウェイに</font></font><br>
<br>
<pre><code class="powershell hljs">HKLM\Software\Microsoft\Windows NT\CurrentVersion\TerminalServerGateway\Config\Core
<span class="hljs-built_in">Type</span>: REG_DWORD<font></font>
Name: EnforceChannelBinding<font></font>
Value: <span class="hljs-number">0</span> (Decimal)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行う必要はありません。</font><font style="vertical-align: inherit;">しかし、私たちはしました。</font><font style="vertical-align: inherit;">:-)彼が必要とするワークステーション上のNTLMv1を主張した（間違いなく、主張した）クライアントの場合。</font><font style="vertical-align: inherit;">わからない、たぶんSPのないNT4上のサーバーがまだ稼働している。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10でのRDP 8+の無効化</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
他のすべてが失敗してアイデアがなくなった場合、文書化されていないキーを使用して、RDPプロトコルをバージョン7にダウングレードできます。</font></font><br>
<br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKEY_CURRENT_USER</span>\<span class="hljs-type">Software</span>\<span class="hljs-type">Microsoft</span>\<span class="hljs-type">Terminal</span> <span class="hljs-type">Server</span> <span class="hljs-type">Client</span>]
<span class="hljs-string">"RDGClientTransport"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はそれを自分でやったわけではありません。しかし、誰かに、彼らはそれが役立つと書いています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DrWeb</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dr.Web SpIDerGateコンポーネントが接続を禁止する場合があります。この場合、エラーが返されます</font></font><br>
<img src="https://habrastorage.org/webt/fs/76/zj/fs76zj-otc0v-v_qxkkwa0gviwo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Dr.Webの統計には次のエントリが</font></font><br>
<img src="https://habrastorage.org/webt/ik/fe/qy/ikfeqyljaepzhnieksw4qsomh6y.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あります。この記事のコメントでは、Dr.Webの従業員から連絡があり、ウイルス対策データベースの次の更新で問題が解決されました。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同じエラーが発生する場合は、サポートに連絡することをお勧めします。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一時的な解決策として、RDGWのURLを例外に追加できます。SpIDerGate </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">コンポーネントを完全</font></a></font><br>
<img src="https://habrastorage.org/webt/7c/do/k-/7cdok-2f6-4f2jj-bhlmjwqd2tq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
に</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効にしても役に立た</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なかった場合のみ</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムプロキシ</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ローカルのTMGがシステムプロキシとして登録されており、RDGWへの接続が機能していなかった、ある会社の使用停止のコンピューター</font><b><font style="vertical-align: inherit;">に</font></b><font style="vertical-align: inherit;">出会いました。これは次のように修正できます：</font></font><br>
<br>
<pre><code class="powershell hljs">netsh winhttp show proxy &amp;&amp; netsh winhttp reset proxy</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">キーボードレイアウトの切り替え</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
追加のレイアウトが表示される場合があります。</font><font style="vertical-align: inherit;">クライアントからのレイアウト転送を無効にすることができます</font></font><br>
<pre><code class="powershell hljs">[<span class="hljs-type">HKLM</span>\<span class="hljs-type">System</span>\<span class="hljs-type">CurrentControlSet</span>\<span class="hljs-type">Control</span>\<span class="hljs-type">Keyboard</span> <span class="hljs-type">Layout</span>]
<span class="hljs-string">"IgnoreRemoteKeyboardLayout"</span>=dword:<span class="hljs-number">00000001</span></code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DPIの問題</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
スケーリングはクライアントマシンから発生します。家庭のラップトップで125％のコストがかかる場合、稼働中のマシンでも同じです。</font><font style="vertical-align: inherit;">サーバーではこれをオフにすることができますが、ワークステーションでは方法を見つけることができませんでした。</font><font style="vertical-align: inherit;">しかし、Windows 10アプリストアには</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「モダンな」クライアントがあります</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはそれにDPIを設定できます：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ig/dz/sm/igdzsmxjjsxc7bsmrixgkbachpm.png"><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDGWでゲートウェイを監視する方法</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パフォーマンスカウンター「TSゲートウェイ\現在の接続」があります。これは、接続がない場合、またはサーバーが長時間再起動されていない場合、少しバグがあります。これは正確に接続数を示しますが、覚えているように、HTTP + UDPの場合は少なくとも2つ、場合によってはそれ以上です。したがって、これは従業員のつながりの数の完全に客観的な指標ではありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WMIクラスWin32_TSGatewayConnectionがあります。その内容は、リモートデスクトップゲートウェイの[監視]セクションに表示される内容に対応しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これにより、接続数をより正確に計算できます。</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Get-WmiObject</span> <span class="hljs-literal">-class</span> <span class="hljs-string">"Win32_TSGatewayConnection"</span> <span class="hljs-literal">-namespace</span> <span class="hljs-string">"root\cimv2\TerminalServices"</span> 
|?{<span class="hljs-variable">$_</span>.transportprotocol <span class="hljs-operator">-ne</span> <span class="hljs-number">2</span>}|<span class="hljs-built_in">select</span> username,connectedresource|<span class="hljs-built_in">sort</span> username|<span class="hljs-built_in">Get-Unique</span> <span class="hljs-literal">-AsString</span>| <span class="hljs-built_in">measure</span>|<span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> count
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
楽しみのために、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remote Display Analyzer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ユーティリティがあります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">無料版では何も役に立たなかったのですが、突然誰かの役に立つでしょう。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、微調整、数十のセッションパラメータの調整についてはどうでしょうか。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここではパレートの原則が適切です。努力の20％が結果の80％を生み出します。</font><font style="vertical-align: inherit;">結果の残りの20％に時間を費やす準備ができている場合-優れています。</font><font style="vertical-align: inherit;">Windows 7でのプロトコルのセットアップに関する記事を読んだとき、著者が7、8、または8.1について書いたプロトコルがわからないことに注意してください。</font><font style="vertical-align: inherit;">リリースを指定せずにWindows 10について読む場合、問題は同じです。</font><font style="vertical-align: inherit;">たとえば、Windows 10の新しいビルドでは、AVC / h.264コーデックがRDPGFX_CODECID_AVC444 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font><font style="vertical-align: inherit;">変更され</font><font style="vertical-align: inherit;">、Windows Server 2016ではRDPGFX_CODECID_AVC444が残っていると彼らは書いています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらすべてのヒントのうち、2つの設定のみを使用します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16ビットカラー、それについては</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">MS RDP Performance / Bandwidth Usageの</font></a><font style="vertical-align: inherit;">記事で読むことができます。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a></li>
<li><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フォントスムージングを</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">無効に</font><b><font style="vertical-align: inherit;">するフォントスムージング：i：</font></b><font style="vertical-align: inherit;">上記の記事の</font><b><font style="vertical-align: inherit;">0</font></b><font style="vertical-align: inherit;">または</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リモートデスクトップセッションホストのパフォーマンスチューニング</font></font></a></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それらが具体的な結果をもたらすとは思えません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の最後に到達しました。</font><font style="vertical-align: inherit;">もっと短くしたかったのですが、いつものようになりました。</font><font style="vertical-align: inherit;">これらのヒントが、誰かが時間を節約したり、インフラストラクチャの構成を改善したりするのに役立つことをうれしく思います。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja501118/index.html">Hooray（Oh no）-udalenka</a></li>
<li><a href="../ja501120/index.html">Google広告データハブとは</a></li>
<li><a href="../ja501126/index.html">問題＃38：ITトレーニング-主要企業の現在の問題と課題</a></li>
<li><a href="../ja501128/index.html">VR開発があなたに合わない理由</a></li>
<li><a href="../ja501130/index.html">Halt and Catch Fire-適応に値するチーム</a></li>
<li><a href="../ja501134/index.html">GitLab QAチームがGitLabパフォーマンスツールを使用する方法</a></li>
<li><a href="../ja501138/index.html">5月2日に参加できる10のオンラインイベント</a></li>
<li><a href="../ja501140/index.html">iOSでのサーバーデータパーサーのロイヤルティの向上</a></li>
<li><a href="../ja501142/index.html">テンキーを使用していますか？</a></li>
<li><a href="../ja501144/index.html">音で脳をハッキングすることは可能ですか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>