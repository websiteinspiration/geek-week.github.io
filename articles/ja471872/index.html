<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😻 🤾🏿 🍮 C＃8のインターフェース：デフォルトの実装における危険な仮定 🚓 💇🏿 📣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 
 C＃8のトピックを探索する一環として、インターフェイスを実装するための新しいルールに関する次の記事について説明することをお勧めします。
 
 
 
 C＃8でのインターフェースの構造を詳しく見ると、デフォルトでインターフェースを実装する場合、薪を壊すことができることを考慮...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>C＃8のインターフェース：デフォルトの実装における危険な仮定</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/471872/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C＃8のトピックを探索する一環として、インターフェイスを実装するための新しいルールに関する次の記事について説明することをお勧めします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vt/jp/uq/vtjpuqini0ddgc23gpr2kllk4aq.jpeg"><br>
<a name="habracut"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C＃8での</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インターフェースの構造</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">を詳しく見ると、</font></a><font style="vertical-align: inherit;">デフォルトでインターフェースを実装する場合、薪を壊すことができることを考慮する必要があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの実装に関連する仮定は、コードの破損、ランタイム例外、パフォーマンスの低下につながる可能性があります。</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
C＃8インターフェースの積極的に宣伝されている機能の1つは、既存の実装者を壊すことなくインターフェースにメンバーを追加できることです。しかし、この場合の不注意には大きな問題が伴います。間違った仮定がなされているコードを考えてください。これにより、そのような問題を回避することがどれほど重要であるかが明確になります。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この記事のすべてのコードはGitHubに投稿されています：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeremybytes / interfaces-in-csharp-8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、特に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">DangerousAssumptions</font></a><font style="vertical-align: inherit;">プロジェクト</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注：この記事では、現在.NET Core 3.0でのみ実装されているC＃8の機能について説明します。私が使用した例では、Visual Studio 16.3.0および.NET Core 3.0.100</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装の詳細に関する仮定</font></font></b> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この問題を明確に</font><b><font style="vertical-align: inherit;">説明</font></b><font style="vertical-align: inherit;">する主な理由は次のとおりです。インターネット上で、実装に関する非常に貧弱な仮定で著者がコードを提供している記事を見つけました（著者がコメントでまとめられたくないので、記事を示しません。連絡します。彼と個人的に）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事では、コードに既にインプリメンターが含まれている場合でもインターフェースを補足できるため、デフォルトの実装がいかに優れているかについて説明しています。ただし、このコードでは多くの悪い仮定が行われています（コードは</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">BadInterface</font></a><font style="vertical-align: inherit;">フォルダーにあります）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私のGitHubプロジェクト）での</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでのオリジナルインターフェースです：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/e0/w_/zs/e0w_zsxwq2pw7gvs28a6b2zsgb0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次は、記事ではMyFileのインターフェース（私はそれを持っているの実装を示し</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyFile.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">）：</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に記事ショーメソッドを追加する方法を</font></font><code>Rename</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの実装で、それは既存のクラスを中断されません</font></font><code>MyFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで（から更新されたインターフェースである</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFileHandler.csの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">：）</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wt/1o/qo/wt1oqop87pe-7xcknbif6-vxcbu.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MyFileのはまだ動作しますので、すべてが正常です。そう？あんまり。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悪い仮定</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Renameメソッド</font><b><font style="vertical-align: inherit;">の</font></b><font style="vertical-align: inherit;">主な問題は、それに関連する巨大な仮定です。実装は、ファイルシステムにある物理ファイルを使用します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RAMにあるファイルシステムで使用するために作成した実装を考えてみます。 （注意：これは私のコードです。私が批判するのは記事の記事ではありません。完全な実装はファイル</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MemoryStringFileHandler.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあります</font><font style="vertical-align: inherit;">。）</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/8b/-g/mf/8b-gmffz-p1tclhw8imq0vanofa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラスは、メインメモリに配置されたテキストファイルを含む辞書を使用して、正式なファイルシステムを実装します。物理ファイルシステムに影響を与えるものはここにはありません</font></font><code>System.IO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通常、への参照はありません</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不完全な実装者</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インターフェイスを更新した後、このクラスは破損しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クライアントコードがRenameメソッドを呼び出すと、ランタイムエラーが発生します（さらに悪いことに、ファイルシステムに格納されているファイルの名前を変更します）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの実装が物理ファイルで機能する場合でも、クラウドストレージにあるファイルにアクセスでき、そのようなファイルにはSystem.IO.Fileからアクセスできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
単体テストに関しては、潜在的な問題もあります。</font><font style="vertical-align: inherit;">シミュレートされたオブジェクトまたは偽のオブジェクトが更新されず、テストされたコードが更新された場合、単体テストの実行時にファイルシステムにアクセスしようとします。</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">誤った仮定はインターフェースに関するものであるため、そのインターフェースの実装者は破損しています。</font></font></blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不合理な恐れ？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
そのような恐れを根拠のないものと考えることは価値がありません。コードの乱用について話すと、「まあ、それは人がプログラムする方法を知らないというだけのことです」と答えます。私はこれに反対することはできません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常私はこれを行います：私は待って、それがどのように機能するかを調べます。たとえば、「静的使用」の可能性が悪用されるのではないかと恐れていました。これまでのところ、これは確信する必要はありませんでした。</font></font><br>
<br>
<i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのようなアイデアが空中にあることを心に留めておく必要があるので、他の人がより便利な道を進むのを助けるのは私たちの力です。</font></font></b><br>
</i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスの問題</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
インターフェースのインプリメンターについて誤った仮定をした場合、他にどんな問題が待ち受けているかについて考え始めました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例では、インターフェイス自体の外（この場合はSystem.IOの外）にあるコードが呼び出されています。あなたはおそらくそのような行動が危険な鐘であることに同意するでしょう。しかし、すでにインターフェイスの一部であるものを使用する場合、すべてが問題ないはずですよね？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
常にではない。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明確な例として、IReaderインターフェイスを作成しました。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソースインターフェイスとその実装</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以下は、元のIReaderインターフェイスです（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IReader.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルから</font><font style="vertical-align: inherit;">-このファイルには既に更新があります）：</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/fi/lt/z-/filtz-c6je1oksyxv_anoif7df4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、読み取り専用要素のコレクションを取得できるメソッドを持つ一般化されたインターフェイスです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このインターフェイスの実装の1つは、フィボナッチ数列のシーケンスを生成します（そうです、私はフィボナッチ数列の生成に不健全な関心を持っています）。ここにインターフェイスがあります</font></font><code>FibonacciReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FibonacciReader.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルから</font><font style="vertical-align: inherit;">-これもgithubで更新されます）：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/hl/3y/rp/hl3yrppzww6gsi1jk8r0th_tro8.png"> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス</font></font><code>FibonacciSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は実装です</font></font><code>IEnumerable &lt;int&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（FibonacciSequence.csファイルから）。データ型として32ビット整数を使用するため、オーバーフローが非常に速く発生します。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ne/jl/n2/nejln2hdhrbwjtejikx_a43ml_q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この実装に興味がある場合は</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、C＃</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">記事の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">フィボナッチシーケンスへの</font></a><font style="vertical-align: inherit;">私の</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">TDDを参照して</font></a><font style="vertical-align: inherit;">ください</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DangerousAssumptionsプロジェクトは、（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">FibonacciReaderの結果を表示するコンソールアプリケーション</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/no/th/06/noth06uvuy-aupnil7rirs_xm2u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。出力は次のとおりです。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/kb/5b/tp/kb5btppuomd69iw_mdxfpy_cu8k.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新されたインターフェイス</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
さて、これで作業コードができました。ただし、遅かれ早かれ、コレクション全体ではなく、IReaderから個別の要素を取得する必要がある場合があります。インターフェイスでジェネリック型を使用しているにもかかわらず、オブジェクトに「ナチュラルID」プロパティがないため、特定のインデックスにある要素を描画します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メソッドが追加されるインターフェイス</font></font><code>GetItemAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IReader.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの最終バージョンから</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">を次に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">示し</font></a><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/ok/tz/ex/oktzexqhidrdeejlrbkidjnpat4.png"><br>
<br>
<code>GetItemAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは、デフォルトの実装を想定しています。一見-それほど悪くない。既存のインターフェースメンバー（</font></font><code>GetItems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）を</font><font style="vertical-align: inherit;">使用する</font><font style="vertical-align: inherit;">ため、ここでは「外部」の想定は行われません。その結果、彼はLINQメソッドを使用します。私はLINQの大ファンであり、私の意見では、このコードは合理的に構築されています。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスの違い</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
デフォルトの実装が原因となって</font></font><code>GetItems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いるため、特定のアイテムを選択する前にコレクション全体を返す必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、</font></font><code> FibonacciReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これはすべての値が生成されることを意味します。更新されたフォームでは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイル</font><font style="vertical-align: inherit;">に次のコードが含まれ</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/nq/de/6o/nqde6otfxvpelqgevulvoa1syks.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ます</font></font><code>GetItemAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、を呼び出します</font><font style="vertical-align: inherit;">。結論は次のとおり</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/si/bp/xv/sibpxvefyrxeyrokzecxmamsf_c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
です。FibonacciSequence.csファイル内にブレークポイントを置くと、シーケンス全体が生成されていることがわかります。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プログラムを開始したら、このコントロールポイントに2回つまずきます。最初に呼び出し</font></font><code>GetItems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で、次に呼び出しで</font></font><code>GetItemAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パフォーマンスに有害な仮定</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッドの最も深刻な問題は、要素のコレクション全体を取得する必要があることです。これを</font></font><code>IReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データベースから取得する場合は、多くの要素をデータベースから引き出して、そのうちの1つだけを選択する必要があります。そのような最終的な選択がデータベースで処理された場合、それははるかに良いでしょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たち</font></font><code>FibonacciReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font><font style="vertical-align: inherit;">協力して</font><font style="vertical-align: inherit;">、新しい各要素を計算します。したがって、必要な要素を1つだけ取得するには、リスト全体を完全に計算する必要があります。フィボナッチ数列の計算は、プロセッサに負荷をかけすぎない操作ですが、たとえば、より複雑なものを扱う場合、素数を計算しますか？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「まあ、私たちは方法を持っています</font></font><code>GetItems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すべてが戻ります。彼が長く働きすぎるなら、おそらく彼はここにいるべきではありません。そしてこれは正直な発言です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、呼び出しコードはこれについて何も知りません。に電話をかけると</font></font><code>GetItems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、（おそらく）私の情報がネットワークを経由する必要があり、このプロセスは日付が集中することになります。単一のアイテムを要求した場合、なぜそのようなコストを期待する必要があるのですか？</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定のパフォーマンスの最適化</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
この場合、</font></font><code>FibonacciReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独自の実装を追加して、パフォーマンスを大幅に向上させることができます（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FibonacciReader.cs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ファイルの最終バージョン</font><font style="vertical-align: inherit;">）。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/b5/lm/nu/b5lmnudcmxo-_dw3l5r66wxkkne.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このメソッド</font></font><code>GetItemAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、インターフェースで提供されるデフォルトの実装をオーバーライドします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは同じ方法を使用します</font></font><code>ElementAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの実装と同様に、LINQから。ただし、このメソッドは、GetItemsが返す読み取り専用のコレクションではなく、FibonacciSequenceで使用します</font></font><code>IEnumerable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは以来</font></font><code>FibonacciSequence </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">で</font></font><code>IEnumerable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、コールはなり</font></font><code>ElementAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次第プログラムは、我々が選択した要素に到達すると終了します。したがって、コレクション全体を生成するのではなく、インデックス内の指定された位置までにある要素のみを生成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを試すには、上記で作成したコントロールポイントをアプリケーションに残して、アプリケーションを再度実行します。今回は、コントロールポイントに1回だけ遭遇します（呼び出されたとき</font></font><code>GetItems</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。呼び出されても、</font></font><code>GetItemAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは起こりません。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">少し工夫された例</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、データセットから要素をインデックスで選択する必要がないため、この例は少し先に進んでいます。ただし、ナチュラルIDプロパティを使用した場合に発生する可能性のある同様のことを想像できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックスではなくIDで要素をプルしている場合、デフォルトの実装で同じパフォーマンスの問題に直面する可能性があります。デフォルトの実装では、すべての要素を返す必要があります。その後、要素から1つだけが選択されます。データベースまたは他の「リーダー」に特定の要素をそのIDで引き出しさせると、そのような操作ははるかに効率的になります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたの仮定について考えてください</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前提条件は必須です。コードでライブラリの使用例を考慮に入れようとすると、タスクは完了しません。ただし、コード内の想定を慎重に検討する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、</font></font><code>GetElementAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デフォルトの</font><font style="vertical-align: inherit;">実装が</font><font style="vertical-align: inherit;">必ずしも悪い</font><font style="vertical-align: inherit;">ことを意味するものではありません</font><font style="vertical-align: inherit;">。はい、潜在的なパフォーマンスの問題があります。ただし、データセットが小さい場合、または計算された要素が「安価」な場合は、デフォルトの実装が妥当な妥協点となる可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それにもかかわらず、実装者がすでに存在する後のインターフェースの変更は歓迎しません。</font><font style="vertical-align: inherit;">しかし、私は代替オプションが好まれるようなシナリオもあることを理解しています。</font><font style="vertical-align: inherit;">プログラミングは問題の解決策であり、問​​題を解決する際には、使用する各ツールとアプローチに固有の長所と短所を比較検討する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトの実装は、インターフェースの実装者（およびおそらくこれらの実装を呼び出すコード）に害を及ぼす可能性があります。</font><font style="vertical-align: inherit;">したがって、デフォルトの実装に関連する仮定については特に注意する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
頑張ってね！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja471862/index.html">PEGパーサーの実装</a></li>
<li><a href="../ja471864/index.html">PEGパーサーの生成</a></li>
<li><a href="../ja471866/index.html">PEGパーサーの視覚化</a></li>
<li><a href="../ja471868/index.html">愛の遺伝学：一夫一婦の鳥のペアでの協力の基礎としての性間紛争</a></li>
<li><a href="../ja471870/index.html">libdispatchの効果的な使用</a></li>
<li><a href="../ja471874/index.html">レビューガイドラインを回避して電話でサーバーを起動した方法</a></li>
<li><a href="../ja471876/index.html">PDUおよびAll-All-All：ラック配電</a></li>
<li><a href="../ja471878/index.html">オントロジーネットワークでWebAssemblyのスマートコントラクトを作成する方法 パート1：錆</a></li>
<li><a href="../ja471880/index.html">オタクハロウィーンのアイデア、またはGeekMaskを選ぶ時間</a></li>
<li><a href="../ja471882/index.html">GitHubのPHPイベント、講演者、主催者の公開リスト</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>