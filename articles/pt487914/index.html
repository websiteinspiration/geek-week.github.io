<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤲🏿 🍵 ⏬ Oferta em Londres em um dia: como obtê-lo e o que fazer depois de se mudar 👇🏾 💃🏾 🤽🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá Habr! 
 
 Temos grandes planos para 2020. Pretendemos desenvolver ativamente o Badoo e o Bumble, por isso estamos expandindo seriamente a equipe t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Oferta em Londres em um dia: como obtê-lo e o que fazer depois de se mudar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/487914/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Olá Habr! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos grandes planos para 2020. Pretendemos desenvolver ativamente o Badoo e o Bumble, por isso estamos expandindo seriamente a equipe técnica. E hoje anunciamos a contratação massiva de desenvolvedores de PHP em nosso escritório em Londres.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2017, tentamos um novo formato de pesquisa - evento de contratação: trazemos desenvolvedores legais para Moscou, conduzimos entrevistas em um dia e fazemos imediatamente uma oferta a candidatos adequados. Todas as despesas de uma viagem à capital são incorridas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O formato funcionou bem, e temos muitas posições em aberto novamente, por isso estamos anunciando um novo evento de contratação de PHP.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As regras são as mesmas: mostram um alto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultado </font><font style="vertical-align: inherit;">antes de 1 de março de passar com êxito a entrevista em 21 de Março ou 22 em Moscou - e no mesmo dia receber uma oferta para o escritório Badoo Londres.&nbsp;</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: o teste está concluído, obrigado a todos os participantes! </font><font style="vertical-align: inherit;">Já notificamos os finalistas e advertimos que as datas da entrevista foram adiadas indefinidamente para o conforto e a segurança dos candidatos. </font></font></b><br>
<br>
<img src="https://habrastorage.org/webt/ms/iu/2b/msiu2bgffxdkk5nkvcxak2v77ns.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo do corte, eu vou lhe dizer:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mais sobre o teste;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em quais projetos estamos envolvidos: otimização de fotos, streaming de vídeo, aprendizado de máquina para cartas, transição para novas versões do PHP e muito mais.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você é um shnik PHP e quer se mudar para Londres, bem-vindo ao kat!</font></font><br>
<br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como passar no teste</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O teste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consiste em cinco tarefas. São precisos exatamente 90 minutos para a decisão: não funcionará para atrasar ou pausar o processo. Antes de começar, verifique se você tem tempo suficiente.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em três tarefas, você precisa escrever consultas de código / SQL e, nas duas restantes, esperamos ver respostas detalhadas para as perguntas. Teste publicado no HackerRank. Recomendamos praticar nas tarefas de teste da plataforma para se familiarizar com a interface.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As decisões são tomadas até 2020-03-01 23:59:59 UTC. Com base nos resultados dos testes, selecionaremos aproximadamente 60 candidatos que convidaremos para Moscou para uma entrevista.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A empresa cobre todas as despesas de uma viagem a Moscou, bem como as despesas associadas à mudança para Londres. </font><font style="vertical-align: inherit;">Ajudamos a obter vistos de trabalho para os membros da família de nosso novo colega, pagamos pelo voo, alugamos uma casa durante a pesquisa, pagamos um bônus em dinheiro pela mudança e ajudamos a melhorar o inglês. </font><font style="vertical-align: inherit;">Você já pode se familiarizar com a equipe na fase da entrevista: os próprios desenvolvedores conduzem entrevistas no evento de contratação.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que a equipe de desenvolvimento de servidores faz&nbsp;</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somos responsáveis ​​pelo back-end dos serviços de namoro Badoo e Bumble. </font><font style="vertical-align: inherit;">Além de deslizar para a esquerda e direita para encontrar um parceiro, os aplicativos têm transmissão de vídeo, bate-papo com mensagens de áudio, pesquisa de pessoas próximas, integração com serviços de pagamento e muito mais. </font><font style="vertical-align: inherit;">Uma interface relativamente simples esconde muita lógica no PHP e no Go (e fica cada vez mais).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nossa equipe tem mais de 40 pessoas. </font><font style="vertical-align: inherit;">O trabalho pode ser dividido em duas grandes partes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nova funcionalidade em aplicativos,</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projetos técnicos - aprimoramento de ferramentas, otimização, trabalho com dívida técnica.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vou falar sobre os projetos mais interessantes que implementamos nos últimos dois anos.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fichas frias no produto</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mercado de aplicativos de namoro é dinâmico e competitivo, portanto, nosso principal objetivo é o desenvolvimento do produto: ele deve permanecer interessante e seguro para os usuários.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprendeu a ocultar fotos muito "pessoais"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguns usuários enviam fotos de bate-papo de natureza erótica, mesmo que o interlocutor não tenha solicitado esses presentes.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tarefa que tivemos que resolver foi ensinar o aplicativo a distinguir fotos “privadas” (maiores de 18 anos) das fotos comuns e mostrá-las conversando no bate-papo, permitindo ao destinatário decidir por si mesmo se ele quer vê-las na íntegra.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juntamente com a equipe de P&amp;D, criamos um serviço on Go com uma rede neural capaz de reconhecer fotos "privadas". </font><font style="vertical-align: inherit;">Se a probabilidade de a foto ficar erótica for maior que o limite definido, uma sinalização especial é colocada na mensagem e o cliente lida com essa situação: mostra um esboço borrado perguntando se o destinatário deseja ver o que está dentro.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Executamos todas as tarefas por meio de testes A / B e também cobrimos cuidadosamente os pontos principais da nova funcionalidade com estatísticas. </font><font style="vertical-align: inherit;">Então descobrimos que cerca de 200.000 são enviadas por dia com fotos "particulares" e também - que muitas vezes essas fotos ainda são visualizadas e não reclamam do remetente.&nbsp;&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionadas mensagens de bate-papo por áudio e vídeo</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nos últimos dois anos, fomos atraídos por recursos para mensageiros avançados e demos aos usuários a oportunidade de trocar mensagens multimídia. </font><font style="vertical-align: inherit;">A implementação desta opção no lado do servidor foi bastante simples devido à arquitetura flexível da API móvel e sua própria CDN. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao projetar mensagens multimídia no bate-papo, transferimos o upload do arquivo da API principal do cliente-servidor para os serviços HTTP separados localizados na CDN. </font><font style="vertical-align: inherit;">Utilizamos um único repositório, portanto, do ponto de vista do suporte ao código, essa solução não causou problemas. </font><font style="vertical-align: inherit;">Mas tornou possível o uso de ferramentas otimizadas para a natureza da carga:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a API móvel (protocolo binário) é aprimorada pela troca de comandos curtos e, no pico, passa por si mesma mais de 100.000 solicitações por segundo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A CDN está ajustada para trabalhar com multimídia e é capaz de fornecer 200.000 fotos por segundo ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">falamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre otimizações da CDN em detalhes </font><font style="vertical-align: inherit;">na conferência do dia da atividade).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do ponto de vista da CDN, o tipo de arquivo baixado não importa muito e já tivemos conversão de vídeo. </font><font style="vertical-align: inherit;">Só conseguimos processar corretamente os novos tipos (áudio e vídeo) no protocolo da API para dispositivos móveis.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aprendeu a criar modelos ML sem pesquisa e desenvolvimento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em 2018, criamos nossa própria estrutura para automatizar o treinamento de modelos em nossos dados. Agora, qualquer desenvolvedor de back-end pode criar independentemente um modelo personalizado para seu aplicativo, sem envolver colegas de P&amp;D.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa estrutura é capaz de coletar centenas de métricas, universais (sexo, idade, atividade no aplicativo) e específicas, significativas para cada modelo específico. Os algoritmos para a construção de modelos de ML são configurados com flexibilidade e gráficos dos resultados estão disponíveis para análises "prontas para uso". Na saída, a estrutura fornece um modelo de trabalho que responde com rapidez suficiente (de 10 a 100 ms) para que possa ser chamado diretamente do PHP nas solicitações do usuário sem afetar o UX.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No ano passado, integramos a estrutura em várias partes de nosso aplicativo: sistemas anti-spam, classificação do aplicativo e outros. </font><font style="vertical-align: inherit;">O Mail ML é um dos aplicativos mais bem-sucedidos: o modelo prevê a probabilidade de um clique no link no email para um usuário específico. </font><font style="vertical-align: inherit;">O modelo aprende com os dados de outros usuários, semelhante ao destinatário do email com atributos "importantes", e a "importância" é calculada automaticamente pela estrutura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após avaliar os resultados, paramos de enviar e-mails com a menor chance de clicar em links. </font><font style="vertical-align: inherit;">Devido a isso, nós:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maior lealdade do usuário, o que resultou em métricas de atividade aprimoradas no serviço: as pessoas não gostam de cartas "sem esperança";</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aumento da taxa de caixa de entrada nos principais remetentes: serviços de email como remetentes com alta CTR.</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Streaming de vídeo lançado</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos sempre buscando novas oportunidades de desenvolvimento. Quando o streaming de vídeo começou a ganhar impulso, decidimos integrá-lo ao nosso aplicativo. Prever o sucesso do projeto não foi fácil; portanto, para reduzir custos, não nos precipitamos no desenvolvimento de nossa solução, mas encontramos uma empresa que forneceu à plataforma e ao SDK a funcionalidade necessária.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fomos obrigados a criar lógica de recursos, interação cliente-servidor, implementar opções para enviar e pagar presentes, fornecer moderação rápida de conteúdo (fluxo de vídeo e comentários) e cobrir tudo com métricas. </font><font style="vertical-align: inherit;">Reunimos uma equipe multifuncional de diferentes departamentos e divisões: desenvolvimento de clientes, desenvolvimento de servidores, cobrança, plataforma, back office, análise de BI, design e gerenciamento de produtos. </font><font style="vertical-align: inherit;">Tudo se estabeleceu em um espaço de escritório - e o trabalho começou a ferver. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Determinamos a funcionalidade da primeira versão (MVP) - e um mês depois lançamos um recurso em um país após o outro. </font><font style="vertical-align: inherit;">Por várias semanas, lançamos em diferentes países e hoje a transmissão de vídeo está disponível em todos os lugares.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmitir mensagens de usuário no Arbat</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi uma promoção muito incomum: em outubro, os usuários do Badoo enviaram mensagens para um enorme outdoor de vídeo localizado no Novy Arbat, em Moscou. Em um mês, 23.000 mensagens foram enviadas para nós, das quais 12.000 foram moderadas com sucesso e apareceram na tela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um outdoor é uma TV tão inteligente com um navegador e nosso cliente JavaScript dentro. Os comerciais de cinco minutos foram mostrados na tela, em cada um dos quais três minutos foram dados a nós.&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qu/3q/0g/qu3q0gzmqjtfrrb0y_dh73ddqpm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, todos os usuários queriam ver a mensagem enviada na tela com seus próprios olhos. Para tornar isso possível, tivemos que responder à pergunta quando cada uma das mensagens aparecer lá.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devemos informar o usuário sobre o horário da exibição após a moderação. Tecnicamente, a essa altura, a mensagem entrava em nossa programação interna com um horário de início claro para o programa e uma duração calculada dinamicamente: de 30 segundos a cinco minutos (dependendo do número de remetentes).&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A dificuldade era que o provedor, por sua vez, não fornecia a capacidade de controlar e acompanhar o horário do comercial, por isso era necessário sincronizar astuciosamente nossa programação com a programação do provedor, monitorar e ajustar constantemente, se necessário. Nos ajudou a perceber (o registro é o nosso tudo!). Algumas dezenas de segundos antes do próximo vídeo ser exibido, a TV inteligente recarrega a página. Era impossível concentrar-se neste momento, mas era possível notar mudanças no cronograma, que às vezes chegava a 15 a 30 segundos. Montamos o monitoramento de turnos do nosso lado e, nos momentos de operação, começamos a solicitar a hora do show mais próximo ao fornecedor.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No processo de configuração desse sistema, nosso engenheiro, que trabalhava em um café em frente ao quadro de avisos, comeu uma quantidade impressionante de croissants e bebeu muitas xícaras de café, mas graças a ele, a transmissão de mensagens do usuário ocorreu sem problemas e não houve incidentes graves.&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projetos técnicos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar do grande volume de trabalho de mercearia, dedicamos muito tempo a projetos técnicos. </font><font style="vertical-align: inherit;">A maioria deles está relacionada ao desempenho de nossos aplicativos, bem como ao desenvolvimento e aprimoramento de ferramentas internas.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projeto Open Source de Liveprof</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Há muito tempo tivemos a oportunidade de ativar o XHProf na produção para uma solicitação específica, mas isso nem sempre é suficiente. As solicitações são diferentes, mas, para o trabalho sistemático sobre desempenho, quero ver o panorama geral de todas as solicitações. Portanto, nasceu uma ideia: inicie o XHProf automaticamente em uma pequena parte das consultas e agregue os resultados. Foi assim que o projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liveprof apareceu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que colocamos em acesso aberto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No processo de processamento da solicitação, existe uma lógica que, com base nas probabilidades e no método API, decide se deve iniciar o XHProf. Os resultados da criação de perfil são gravados no disco e entregues em um servidor separado, onde são colocados no formato bruto no MySQL.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma vez por dia, é executado um script que agrega os resultados para cada marca, plataforma e método de API. </font><font style="vertical-align: inherit;">Assim, podemos ver os resultados da criação de perfil para solicitações específicas do Badoo iOS (na forma de uma árvore e na forma de um gráfico de chama), podemos ver qual a porcentagem do cluster necessária para chamar uma função individual (por exemplo, quanto custa para coletar um URL para uma foto), e recentemente adicionou a saída dessas informações diretamente ao PhpStorm.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migrando para o PHP 7.4</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Novas versões do PHP estão satisfeitas com a melhoria de desempenho. Nas duas últimas transições (de 7.0 para 7.2 e de 7.2 para 7.4), nosso departamento foi responsável. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A transição</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> começa muito antes do lançamento oficial. Primeiro, executamos os testes manualmente com a nova versão e ... enfrentamos um grande número de problemas. Alguns deles são facilmente resolvidos, enquanto outros requerem algum tempo.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a maioria dos problemas foi resolvida, passamos para a nova versão no ambiente do desenvolvedor, por algum tempo monitoramos os logs de erros e coletamos feedback dos desenvolvedores e engenheiros de controle de qualidade. No momento do lançamento oficial da versão estável, já estávamos prontos para testar a produção: primeiro, rodamos em uma máquina e gradualmente as colocamos nas outras.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas depois que a nova versão é distribuída em todos os servidores, a transição não termina: continuamos a verificar a sintaxe das duas versões do PHP (nova e anterior). </font><font style="vertical-align: inherit;">Portanto, estamos convencidos de que os desenvolvedores não começaram a usar a nova sintaxe e que podemos mudar para a versão antiga a qualquer momento, se surgirem problemas inesperados na nova. </font><font style="vertical-align: inherit;">Por exemplo, antes dos feriados de Ano Novo, encontramos um pequeno problema com um vazamento de memória no PHP 7.4, decidimos não arriscar e voltamos à versão anterior antes dos feriados. </font><font style="vertical-align: inherit;">Após as férias, tendo resolvido o problema, lançamos novamente a versão 7.4 e ainda a usamos.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir agregação de solicitações</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a atualização do PHP, nossa luta pelo desempenho não termina aí. Temos uma estrutura poderosa que faz muito trabalho no início: da inicialização às várias verificações necessárias para cada solicitação.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidimos realizar um experimento simples. Selecionamos uma parte dos comandos para os quais a resposta do servidor não é crítica (por exemplo, enviando estatísticas do cliente ou escolhendo a opção "Não" no jogo de furto) e escrevemos um serviço no Go que aceita tais solicitações, as salva e as envia ao servidor em um pacote ( para cada usuário). Assim, podemos economizar muito facilmente ao inicializar o aplicativo sem reescrever o código principal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O experimento acabou sendo bem-sucedido: de acordo com nossas estimativas, podemos economizar alguns por cento da CPU (que no nosso caso é mais de dez servidores) sem reescrever o código principal, mas com o custo de complicar a operação e a lógica do trabalho. </font><font style="vertical-align: inherit;">Para completar, decidimos aguardar os resultados das experiências com o PHP 7.4 preload e o RoadRunner para escolher a solução ideal de acordo com a proporção de ganhos e a complexidade da implementação.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimização de fotos</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A atividade do usuário depende diretamente de alguns projetos técnicos. Por exemplo, quanto mais rápido mostramos as fotos, mais ativamente as pessoas passam, mais correspondências acontecem, mais novos pares se formam e assim por diante.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em outubro de 2018, uma de nossas marcas, a Bumble, decidiu entrar no mercado indiano. Como não sabíamos nada sobre a velocidade da Internet local, decidimos realizar uma série de experimentos com a qualidade e o tamanho das fotografias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Iniciamos todas as experiências técnicas sob testes A / B. Isso permite ver não apenas a diferença no comportamento e na atividade de diferentes grupos, mas também estatísticas sobre a operação do aplicativo no cliente, divididas por opções. Estávamos interessados ​​na hora de baixar fotos e na hora de decodificar e exibir.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infraestrutura, além dos servidores de armazenamento, alocamos um cluster de caches de fotos - esses são os servidores que armazenam as fotos mais usadas. Como existe um grande número de smartphones com telas diferentes no mundo, armazenamos fotos em vários tamanhos básicos e as convertemos rapidamente para o tamanho e formato solicitados pelo cliente.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tarefa que queríamos resolver era escolher o formato ideal (JPEG, WebP, PJPEG), tamanho e qualidade de imagem. Em teoria, o formato WebP deve ser o melhor, mas é o mais caro em termos de conversão instantânea: em vez de economizar tráfego, você precisa comprar mais servidores de cache de fotos. Junto com isso, decidimos testar como as CDNs da região ajudarão a melhorar o UX.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vários de nossos engenheiros foram enviados para lá para lançar um projeto na Índia. Portanto, tínhamos não apenas números secos, mas também pessoas que podiam testar o aplicativo em diferentes operadores no local, comparar seu trabalho com o trabalho de outros aplicativos e assim por diante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os resultados dos experimentos nos permitiram escolher as melhores opções para a qualidade e o tamanho das fotografias. </font><font style="vertical-align: inherit;">Por exemplo, vimos que a lógica de pré-carregar fotos no cliente desempenha um papel importante na atividade do usuário. </font><font style="vertical-align: inherit;">E, apesar do fato de as fotos no WebP serem baixadas mais rapidamente, o efeito positivo foi perceptível apenas nos navegadores móveis. </font><font style="vertical-align: inherit;">A mesma história da CDN: testamos três serviços externos da CDN e, apesar da aceleração da entrega de conteúdo, não houve mudanças positivas na atividade. </font><font style="vertical-align: inherit;">Como resultado, ativamos o WebP para navegadores móveis e economizamos energia, deixando todos os outros clientes no formato JPEG.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transmissão de vídeo própria</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionei acima, a primeira versão do streaming de vídeo foi lançada usando um serviço externo. O experimento foi considerado bem-sucedido - e começamos a preparar software e infraestrutura para o lançamento em nossos data centers.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a ajuda do transcodificador pronto (para extrair o fluxo de vídeo do usuário) e dos servidores de borda (para distribuir o fluxo para o usuário), tivemos que construir um sistema semelhante a uma solução in a box externa. E, é claro, muito precisava ser finalizado com um "arquivo" em movimento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, inicialmente cada servidor de Borda se conectava a cada servidor de transcodificador, o que complicava a escala e aumentava o tráfego interno. Escrevemos o balanceamento de clientes de forma que os clientes de um fluxo acessem o menor número de servidores Edge, levando em consideração a popularidade de cada fluxo específico.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Outro exemplo, quando precisávamos ser perspicazes, é a lógica de alterar a qualidade de um fluxo no WebRTC: devido ao fato de usarmos duas opções de qualidade, o algoritmo padrão foi demolido e funcionou apenas para diminuir a taxa de bits. </font><font style="vertical-align: inherit;">Eu tive que ir mais fundo e editar o algoritmo usado dentro da biblioteca WebRTC. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além disso, a sinalização WebRTC, por padrão, transmitiu muitas informações sobre hosts na rede para o cliente. </font><font style="vertical-align: inherit;">A solução foi um servidor proxy on Go, que fornece ao cliente apenas o que ele precisa saber e, além disso, coleta muitas informações úteis sobre clientes conectados.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde o início da pesquisa até a implementação completa, o projeto levou mais de seis meses, mas, como resultado, conseguimos reduzir significativamente os custos abandonando os serviços externos.&nbsp;</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otimização de performance</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este não é um projeto único para nossa equipe - é uma área importante para a qual também prestamos muita atenção. Nosso cluster principal, que atende solicitações de aplicativos, consiste em centenas de servidores e, portanto, é rentável investir tempo na otimização do aplicativo: cada porcentagem conquistada nos custa vários servidores físicos.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Monitoramos constantemente a carga total em nosso cluster e a carga para cada chamada de API específica. Se um determinado limite for excedido, começamos a pesquisar e otimizar gargalos. Quanto maior o excesso, mais pessoas se envolvem. Essa abordagem é totalmente justificada: nos últimos dois anos, a taxa de crescimento do cluster foi metade da taxa de crescimento do público de nossos serviços.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compartilhamos ativamente o conhecimento adquirido durante o trabalho de otimização em conferências e reuniões. </font><font style="vertical-align: inherit;">Mais detalhes sobre nossos projetos e estudos podem ser encontrados em artigos e relatórios de Pasha Murzakov:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desempenho do PHP: planejamento, criação de perfil, otimização</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combatendo um modelo de nada compartilhado: pré-carregamento do PHP 7.4, RoadRunner e outros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como 200 linhas on Go nos ajudaram a liberar 15 servidores</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controle sobre código antigo e não utilizado</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Temos um desenvolvimento bastante intenso, e o ritmo de lançamento de tarefas e experimentos de produtos também está crescendo à medida que a empresa cresce. </font><font style="vertical-align: inherit;">Sob tais condições, a base de código se torna mais complexa e menos controlada. </font><font style="vertical-align: inherit;">A situação é exacerbada por várias plataformas e usuários com versões mais antigas de aplicativos e sistemas operacionais.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tentamos manter nossa base de códigos "limpa" para manter um ritmo alto de trabalho:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crie automaticamente tarefas para remover o código após a conclusão da experiência do produto;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rastreamento automatizado de versões antigas de aplicativos e sistemas operacionais e as ramificações de código usadas neles;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduzimos ferramentas para procurar automaticamente código não utilizado.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode aprender mais sobre nossos resultados no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Badoo PHP Meetup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que será realizado neste sábado, 15 de fevereiro.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, esses não são todos os projetos que eu quero falar. Nos últimos dois anos, lutamos com spammers e snappers, instalamos nosso plugin para o PhpStorm, testamos vários repositórios KV (e escolhemos o Aerospike), experimentamos muito, compartilhamos conhecimento em artigos, em conferências e não apenas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas se você decidir que estamos apenas trabalhando, não é assim. Cada equipe tem seu próprio orçamento para criação de equipes. Nossos colegas visitaram Amsterdã, Edimburgo, Praga e outras cidades. No ano passado, organizamos uma reunião geral do departamento na Croácia: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z0/th/tz/z0thtz68shyqbfbn_lgjojxdzru.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e também sabemos como fazer photoshop.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mudar para Londres e para o escritório no Soho</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como já dissemos, portanto, não vamos nos aprofundar nos detalhes deste artigo - apenas mostre algumas fotos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sb/ul/em/sbulemvjxw8ipp50njicr4epm6m.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foto grande</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/webt/vn/eh/yi/vnehyidqkpljpndkvqnsqkxtlhu.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/a3/vb/rk/a3vbrkj0avtmfek7j7p9kreezfo.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/7h/le/ya/7hleyaxbrafxfip4hyq9rpevowg.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/lt/h8/jw/lth8jww4mra-4adg9_tay4istm4.jpeg"><br>
<br>
<img src="https://habrastorage.org/webt/hy/ub/0n/hyub0ngeapscepq0jibotaexl6u.jpeg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O evento de contratação é a maneira mais fácil e rápida de se juntar à nossa equipe. </font><font style="vertical-align: inherit;">Aceitamos respostas para o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> até 1º de março, inclusive. </font><font style="vertical-align: inherit;">Depois, levaremos uma semana para analisar os resultados e ligar para aqueles que lidaram com as tarefas.&nbsp;</font></font><br>
&nbsp;<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você deseja trabalhar para nós em Londres, mas não deseja fazer o teste, há outra opção: basta responder às vagas em </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nosso site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , essa oportunidade está sempre disponível. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se você tiver alguma dúvida, sinta-se à vontade para perguntar nos comentários ou me enviar mensagens privadas.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Boa sorte</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt487902/index.html">Do fogo ao fogo: eletrólito de estado sólido refratário para baterias de íons de lítio</a></li>
<li><a href="../pt487906/index.html">O livro "Redes de computadores. Princípios, tecnologias, protocolos: edição de aniversário »</a></li>
<li><a href="../pt487908/index.html">O início da guerra dos processos tecnológicos: 5 nm e 3 nm</a></li>
<li><a href="../pt487910/index.html">Leis naturais e matemática elegante: problemas e soluções</a></li>
<li><a href="../pt487912/index.html">9 dicas para acelerar o processo de contratação em 2020</a></li>
<li><a href="../pt487916/index.html">A história do áudio compacto: como as bobinas em miniatura migraram para um formato de cassete</a></li>
<li><a href="../pt487920/index.html">Sobrecarga em C ++. Parte I. Sobrecarregando Funções e Modelos</a></li>
<li><a href="../pt487922/index.html">Aprendendo a implantar microsserviços. Parte 1. Spring Boot e Docker</a></li>
<li><a href="../pt487924/index.html">Kim Dotcom: Caught, a pessoa mais procurada online. Parte 3</a></li>
<li><a href="../pt487926/index.html">Em busca de educação física</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>