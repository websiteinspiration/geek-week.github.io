<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👯 👨🏽‍🎨 🚖 Docker Compose: Simplifique usando Makefile 👡 ⛹🏿 👸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A cada poucos anos, uma mudança de paradigma ocorre na indústria de desenvolvimento de software. Um desses fenômenos é o crescente interesse no concei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Docker Compose: Simplifique usando Makefile</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/486682/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A cada poucos anos, uma mudança de paradigma ocorre na indústria de desenvolvimento de software. </font><font style="vertical-align: inherit;">Um desses fenômenos é o crescente interesse no conceito de microsserviços. </font><font style="vertical-align: inherit;">Embora os microsserviços não sejam a tecnologia mais recente, apenas recentemente sua popularidade disparou literalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Atualmente, grandes serviços monolíticos são substituídos por microsserviços autônomos independentes. </font><font style="vertical-align: inherit;">Um microsserviço pode ser considerado como um aplicativo que serve a um propósito único e muito específico. </font><font style="vertical-align: inherit;">Por exemplo, pode ser um DBMS relacional, aplicativo Express, serviço Solr. </font><font style="vertical-align: inherit;">
Hoje em dia é difícil imaginar o desenvolvimento de um novo sistema de software sem o uso de microsserviços. </font><font style="vertical-align: inherit;">E essa situação, por sua vez, nos leva à plataforma Docker.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/xj/7x/qr/xj7xqrze4d6ijidic1zuonqbr1c.jpeg"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A plataforma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , no desenvolvimento e implantação de microsserviços, tornou-se quase um padrão do setor. </font><font style="vertical-align: inherit;">No site do projeto, você pode descobrir que o Docker é a única plataforma de contêiner independente que permite que as organizações criem sem esforço qualquer aplicativo, além de distribuí-lo e executá-lo em qualquer ambiente - de nuvens híbridas a sistemas de fronteira.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker compor</font></font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
tecnologia </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Docker Compose</font></a><font style="vertical-align: inherit;"> foi </font><font style="vertical-align: inherit;">projetada para configurar aplicativos com vários contêineres. </font><font style="vertical-align: inherit;">Um projeto do Docker Compose pode incluir quantos contêineres do Docker forem necessários para o criador deste projeto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao trabalhar com o Docker Compose, um arquivo YAML é usado para configurar serviços de aplicativos e organizar sua interação. </font><font style="vertical-align: inherit;">O Docker Compose é, portanto, uma ferramenta para descrever e executar aplicativos Docker com vários contêineres.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49c/b5a/9bf/49cb5a9bf3288a6cd933c6210f8a56bf.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois contêineres em execução no sistema host</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Make</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um programa </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é essencialmente uma ferramenta para automatizar a montagem de programas e bibliotecas a partir do código fonte. Em geral, podemos dizer que é </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicável a qualquer processo que inclua a execução de comandos arbitrários para converter determinados materiais de origem em uma determinada forma resultante, em um determinado objetivo. No nosso caso, as equipes </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serão convertidas em objetivos abstratos ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alvos falsos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para dizer ao programa </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o que queremos dele, precisamos de um arquivo </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os nossos </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conterão os comandos usuais </font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que são projetados para resolver muitos problemas. </font><font style="vertical-align: inherit;">Ou seja, estamos falando sobre a montagem do contêiner, sobre como iniciá-lo, parar, reiniciar, organizar o logon do usuário no contêiner, trabalhar com logs do contêiner e resolver outros problemas semelhantes.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usos típicos do Docker Compose</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine um aplicativo Web regular que possua os seguintes componentes:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Banco de dados TimescaleDB (Postgres).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplicativo Express.js.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ping (apenas um contêiner que não faz nada de especial).</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse aplicativo precisará de três contêineres do Docker e um arquivo </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contendo instruções para gerenciar esses contêineres. </font><font style="vertical-align: inherit;">Cada um dos contêineres terá diferentes pontos de interação. </font><font style="vertical-align: inherit;">Por exemplo, </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">você pode trabalhar </font><font style="vertical-align: inherit;">com um contêiner </font><font style="vertical-align: inherit;">da mesma maneira que trabalha com bancos de dados. </font><font style="vertical-align: inherit;">Ou seja, permite executar as seguintes ações:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entre no shell do Postgres.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Importar e exportar tabelas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie uma </font></font><code>pg_dump</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tabela ou banco de dados.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O contêiner de um aplicativo Express.js ,, </font></font><code>expressjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ter os seguintes recursos:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A saída de dados atualizados do log do sistema.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digite o shell para executar determinados comandos.</font></font></li>
</ul><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interação de contêiner</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de configurar a conexão entre os contêineres usando o Docker Compose, é hora de estabelecer interação com esses contêineres. </font><font style="vertical-align: inherit;">Como parte do sistema Docker Compose, há um comando </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que suporta uma opção </font></font><code>-f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite transferir um arquivo para o sistema </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usando os recursos desta opção, você pode limitar a interação com o sistema apenas para os contêineres mencionados no arquivo </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veja como são as interações do contêiner ao usar comandos </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se imaginarmos que precisamos entrar no shell </font></font><code>psql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, os comandos correspondentes podem ser assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker-compose -f docker-compose.yml exec timescale psql -Upostgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mesmo comando para o qual não </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas é usado </font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pode se parecer com isso:</font></font><br>
<br>
<pre><code class="plaintext hljs">docker exec -it&nbsp; edp_timescale_1 psql -Upostgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, nesses casos, é sempre preferível usar não um comando </font></font><code>docker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas um comando </font></font><code>docker-compose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pois isso elimina a necessidade de lembrar os nomes dos contêineres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ambos os comandos acima não são tão complicados. </font><font style="vertical-align: inherit;">Mas se usássemos um "wrapper" de uma forma </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nos desse uma interface na forma de comandos simples e chamasse comandos tão longos, então os mesmos resultados poderiam ser alcançados assim:</font></font><br>
<br>
<pre><code class="plaintext hljs">make db-shell</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É óbvio que o uso </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplifica bastante o trabalho com contêineres!</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de trabalho</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com base no diagrama do projeto acima, crie o seguinte arquivo </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">version: '3.3'<font></font>
services:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;api:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;build: .<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image: mywebimage:0.0.1<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ports:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 8080:8080<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volumes:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- /app/node_modules/<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depends_on:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- timescale<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command: npm run dev<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networks:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- webappnetwork<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;timescale:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image: timescale/timescaledb-postgis:latest-pg11<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- POSTGRES_USER=postgres<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- POSTGRES_PASSWORD=postgres<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command: ["postgres", "-c", "log_statement=all", "-c", "log_destination=stderr"]<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volumes:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ./create_schema.sql:/docker-entrypoint-initdb.d/create_schema.sql<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;networks:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- webappnetwork<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;ping:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image: willfarrell/ping<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environment:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSTNAME: "localhost"<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIMEOUT: 300<font></font>
networks:<font></font>
&nbsp;&nbsp;&nbsp;webappnetwork:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;driver: bridge</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para gerenciar a configuração do Docker Compose e interagir com os contêineres descritos, crie o seguinte arquivo </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="plaintext hljs">THIS_FILE := $(lastword $(MAKEFILE_LIST))<font></font>
.PHONY: help build up start down destroy stop restart logs logs-api ps login-timescale login-api db-shell<font></font>
help:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make -pRrq&nbsp; -f $(THIS_FILE) : 2&gt;/dev/null | awk -v RS= -F: '/^# File/,/^# Finished Make data base/ {if ($$1 !~ "^[#.]") {print $$1}}' | sort | egrep -v -e '^[^[:alnum:]]' -e '^$@$$'<font></font>
build:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml build $(c)<font></font>
up:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml up -d $(c)<font></font>
start:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml start $(c)<font></font>
down:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml down $(c)<font></font>
destroy:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml down -v $(c)<font></font>
stop:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml stop $(c)<font></font>
restart:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml stop $(c)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml up -d $(c)<font></font>
logs:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml logs --tail=100 -f $(c)<font></font>
logs-api:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml logs --tail=100 -f api<font></font>
ps:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml ps<font></font>
login-timescale:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml exec timescale /bin/bash<font></font>
login-api:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml exec api /bin/bash<font></font>
db-shell:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker-compose -f docker-compose.yml exec timescale psql -Upostgres</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A maioria dos comandos descritos aqui se aplica a todos os contêineres, mas o uso da opção </font></font><code>c=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permite limitar o escopo do comando a um contêiner. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pronto, você pode usá-lo assim:</font></font><br>
<br>
<ul>
<li><code>make help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- emitindo uma lista de todos os comandos disponíveis para </font></font><code>make</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c92/808/916/c92808916bcd3d861c25a47c22cc1694.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajuda de comandos disponíveis</font></font></font></i><br>
 <br>
<ul>
<li><code>make build</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- montagem da imagem de </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No nosso exemplo, usamos imagens </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>ping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mas </font></font><code>api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">queremos coletar a </font><font style="vertical-align: inherit;">imagem </font><font style="vertical-align: inherit;">localmente. </font><font style="vertical-align: inherit;">Isso é exatamente o que será feito após a execução deste comando.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/23f/8fc/8a523f8fca803a9b2c21411d7e3ad037.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Montagem de contêiner do Docker</font></font></font></i><br>
 <br>
<ul>
<li><code>make start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- lançamento de todos os contêineres. </font><font style="vertical-align: inherit;">Para iniciar apenas um contêiner, você pode usar o comando do formulário </font></font><code>make start c=timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/087/f72/559/087f725597d994d7929e50da56dd2d4d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar contêiner de escala de tempo</font></font></font></i><br>
 <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ee/a13/4e3/1eea134e39cf2c8d58dac881c143c135.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar o contêiner de ping</font></font></font></i><br>
<br>
<ul>
<li><code>make login-timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- entrada na sessão bash do contêiner </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b87/63a/66c/b8763a66cdb78760244cb41ea6c26c6e.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executando o bash no contêiner de escala de tempo</font></font></font></i><br>
<br>
<ul>
<li><code>make db-shell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Efetue login no </font></font><code>psql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contêiner </font></font><code>timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para executar consultas SQL no banco de dados.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac6/669/3e8/ac66693e81e9adefdbf14b2541ba176d.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executando psql no contêiner timescaledb</font></font></font></i><br>
<br>
<ul>
<li><code>make stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - parar recipientes.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf9/0f8/cb0/bf90f8cb006ba2ec136a4bdf6b956de3.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parando o contêiner da escala de tempo</font></font></font></i><br>
<br>
<ul>
<li><code>make down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- pare e remova os recipientes. </font><font style="vertical-align: inherit;">Para excluir um contêiner específico, você pode usar este comando com o contêiner especificado. </font><font style="vertical-align: inherit;">Por exemplo - </font></font><code>make down c=timescale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>make down c=api</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li>
</ul><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/779/ede/fd8/779edefd85df7dcedec4ead9b0bae09f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pare e exclua todos os contêineres</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumário</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apesar do sistema Docker Compose nos fornecer um conjunto extenso de comandos projetados para gerenciar contêineres, algumas vezes esses comandos se tornam longos e, como resultado, podem ser difíceis de lembrar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A metodologia de uso </font></font><code>Makefile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos ajudou a estabelecer uma interação rápida e fácil com os contêineres do arquivo </font></font><code>docker-compose.yml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ou seja, estamos falando sobre o seguinte:</font></font><br>
<br>
<ul>
<li>     ,   <code>docker-compose.yml</code>,      .</li>
<li>  ,    ,    <code>make help</code>      .</li>
<li>         ,         . ,   <code>docker-compose -f docker-compose.yml exec timescale psql -Upostgres</code>   <code>make db-shell</code>.</li>
<li> <code>Makefile</code> ,    ,    . ,                 .</li>
<li>         <code>Makefile</code>,        .</li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> No nosso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mercado,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> há uma imagem do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , instalada em um clique. </font><font style="vertical-align: inherit;">Você pode verificar a operação de contêineres no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Todos os novos clientes recebem 3 dias gratuitamente para testes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queridos leitores! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como você automatiza o trabalho com o Docker Compose?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt486682/">https://habr.com/ru/post/pt486682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486672/index.html">OpenVINO Hackathon: Reconhecendo a voz e a emoção no Raspberry Pi</a></li>
<li><a href="../pt486674/index.html">O resumo de materiais frescos do mundo do front-end da última semana nº 400 (27 de janeiro a 2 de fevereiro de 2020)</a></li>
<li><a href="../pt486676/index.html">Inevitabilidade da penetração do FPGA nos data centers</a></li>
<li><a href="../pt486678/index.html">Quartzo no núcleo do ASP.NET</a></li>
<li><a href="../pt486680/index.html">ML, VR e robôs (e um pouco de nuvem)</a></li>
<li><a href="../pt486684/index.html">Minha resposta para aqueles que acreditam que o valor do TDD é exagerado</a></li>
<li><a href="../pt486686/index.html">Sobre a implementação de uma biblioteca de aprendizado profundo em Python</a></li>
<li><a href="../pt486688/index.html">Node.js, Tor, Puppeteer e Cheerio: raspagem anônima da web</a></li>
<li><a href="../pt486690/index.html">5 dicas para escrever funções de seta com qualidade</a></li>
<li><a href="../pt486692/index.html">Recursos do console do Chrome que você talvez nunca tenha usado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>