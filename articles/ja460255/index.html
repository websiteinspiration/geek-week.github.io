<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🍳 🙆 🤘🏿 Node.jsのバックドア：理由、理由、方法 👩‍🍳 👩🏻‍💼 🤳🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、Yandexの同僚が興味深いトロイの木馬のサンプルを共有してくれました。このニュースで報告しました。そのようなマルウェアは頻繁に出くわすことはないため、詳細に分解することを決定すると同時に、そのようなサンプルがめったに発生しない理由について話し合いました。
 
 このトロイの木馬は、JavaS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Node.jsのバックドア：理由、理由、方法</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/drweb/blog/460255/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、Yandexの同僚が興味深いトロイの木馬のサンプルを共有してくれました</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ニュースで</font><font style="vertical-align: inherit;">報告しました</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">そのようなマルウェアは頻繁に出くわすことはないため、詳細に分解することを決定すると同時に、そのようなサンプルがめったに発生しない理由について話し合いました。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトロイの木馬は、JavaScriptで記述され、Node.jsを使用して実行するマルチコンポーネントバックドアです。その主な要素はワーカーとアップデーターであり、ブートローダーによってシステムにダウンロードおよびインストールされます。ペイロードは任意ですが、この場合、トロイの木馬はxmrigマイナーをインストールします。調査時、開発者は鉱山労働者を使用してTurtleCoin暗号通貨を採掘しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MonsterInstallは、人気のビデオゲームのチートサイトで配布されています。これらのリソースのほとんどはトロイの木馬の開発者のものですが、他の同様のサイトでさらに感染したファイルがいくつか見つかりました。そのうちの1人の所有者は、競合他社の更新を定期的に監視し、新鮮なコンテンツでリソースを補充します。これを行うには、彼はparser.phpスクリプトを使用します。このスクリプトは、プロキシを介してcheathappens.comで新しいチートを検索します。</font></font><br>
<br>
<pre><code class="plaintext hljs">Proxy parse done, total: 1<font></font>
Use sox 84.228.64.133:1080<font></font>
Error: CURL error(#52), attempts left: 10<font></font>
Use sox 84.228.64.133:1080<font></font>
Posts found: 30!<font></font>
[33mPage Satisfactory: ўЂµ№ЅµЂ +8 vCL#96731 {CheatHappens.com} already in base[0m<font></font>
[33mPage Borderlands: The Pre-Sequel - ўЂµ№ЅµЂ +28 v1.2019 {LinGon} already in base[0m<font></font>
[33mPage Borderlands - Game of the Year Enhanced: ўЂµ№ЅµЂ +19 v1.0.1 {LinGon} already in base[0m<font></font>
[33mPage Star Wars: Battlefront 2 (2017): ўЂµ№ЅµЂ +4 v01.04.2019 {MrAntiFun} already in base[0m<font></font>
[36mPage Far Cry 5: ўЂµ№ЅµЂ +23 v1.012 (+LOST ON MARS/DEAD LIVING ZOMBIES) {CheatHappens.com} added 2019-Apr-09[0m<font></font>
[36mPage Fate/Extella Link: ўЂµ№ЅµЂ +13 v04.09.2019 {CheatHappens.com} added 2019-Apr-09[0m<font></font>
[36mPage Superhot: ўЂµ№ЅµЂ +3 v2.1.01p { MrAntiFun} added 2019-Apr-09[0m<font></font>
[36mPage Dawn of Man: ўЂµ№ЅµЂ +7 v1.0.6 {CheatHappens.com} added 2019-Apr-08[0m<font></font>
[36mPage Borderlands 2: ўЂµ№ЅµЂ +14 v06.04.2019 {MrAntiFun} added 2019-Apr-08[0m<font></font>
[36mPage Borderlands: The Pre-Sequel - ўЂµ№ЅµЂ +17 v06.04.2019 {MrAntiFun} added 2019-Apr-08[0m<font></font>
[36mPage Tropico 6: ўЂµ№ЅµЂ +9 v1.01 {MrAntiFun} added 2019-Apr-08[0m<font></font>
[36mPage Operencia: The Stolen Sun - ўЂµ№ЅµЂ +20 v1.2.2 {CheatHappens.com} added 2019-Apr-08[0m<font></font>
[36mPage Enter the Gungeon: ўЂµ№ЅµЂ +6 v2.1.3 {MrAntiFun} added 2019-Apr-07[0m<font></font>
[36mPage The Guild 3: ўЂµ№ЅµЂ +2 v0.7.5 {MrAntiFun} added 2019-Apr-07[0m<font></font>
[36mPage Dead Effect 2: ўЂµ№ЅµЂ +8 v190401 {MrAntiFun} added 2019-Apr-07[0m<font></font>
[36mPage Assassin's Creed: Odyssey - ўЂµ№ЅµЂ +26 v1.2.0 {FLiNG} added 2019-Apr-07[0m<font></font>
[36mPage Assassin's Creed: Odyssey - ўЂµ№ЅµЂ +12 v1.2.0 {MrAntiFun} added 2019-Apr-06[0m<font></font>
[36mPage Super Dragon Ball Heroes: World Mission - ўЂµ№ЅµЂ +11 v1.0 {FLiNG} added 2019-Apr-05[0m<font></font>
[36mPage Tropico 6: ўЂµ№ЅµЂ +7 v1.02 97490 {CheatHappens.com} added 2019-Apr-05[0m<font></font>
[36mPage Risk of Rain 2: ўЂµ№ЅµЂ +10 Build 3703355 {CheatHappens.com} added 2019-Apr-05[0m<font></font>
[36mPage Sid Meier's Civilization 6 - Rise and Fall: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m<font></font>
[36mPage Sid Meier's Civilization 6 - Gathering Storm: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m<font></font>
[36mPage Sid Meier's Civilization 6: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m<font></font>
[36mPage Borderlands GOTY Enhanced: ўЂµ№ЅµЂ +16 v1.0 {CheatHappens.com} added 2019-Apr-05[0m<font></font>
[36mPage Borderlands Game of the Year Enhanced: ўЂµ№ЅµЂ +13 v1.00 {MrAntiFun} added 2019-Apr-04[0m<font></font>
[36mPage Assassin's Creed: Odyssey: ўЂµ№ЅµЂ +24 v1.2.0 (04.04.2019) {CheatHappens.com} added 2019-Apr-04[0m<font></font>
[36mPage Sekiro: Shadows Die Twice - ўЂµ№ЅµЂ +24 v1.02 {FLiNG} added 2019-Apr-04[0m<font></font>
[36mPage Hearts of Iron 4: ўЂµ№ЅµЂ +24 v1.6.2 {MrAntiFun} added 2019-Apr-04[0m<font></font>
[36mPage Wolcen: Lords of Mayhem - ўЂµ№ЅµЂ +5 v1.0.2.1 {MrAntiFun} added 2019-Apr-04[0m<font></font>
[36mPage Devil May Cry 5: ўЂµ№ЅµЂ +18 v1.0 (04.03.2019) {CheatHappens.com} added 2019-Apr-04[0m<font></font>
Parse done<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開発者のサイトには、さまざまなチートがありますが、すべてのリンクで同じアーカイブが返されます。</font><font style="vertical-align: inherit;">マルウェア開発者のサイトからファイルをダウンロードしようとすると、ユーザーはTrojan.MonsterInstallを受け取ります。</font><font style="vertical-align: inherit;">トロイの木馬のいくつかのパラメータは、ダウンロードリンクから推測できます。</font></font><br>
<br>
<pre><code class="plaintext hljs">https://&lt;malicious_site&gt;/fc/download.php?name=Borderlands%20GOTY%20Enhanced:%20%D0%A2%D1%80%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%20+16%20v1.0%20{CheatHappens.com}&amp;link=https://&lt;malicious_site&gt;//r.php?site=http://gtrainers.com/load/0-0-1-7081-20&amp;password=&lt;malicious_site&gt;/&amp;uid=101&amp;sid1=1&amp;sid2=1&amp;charset=utf-8
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name-アーカイブの名前とアーカイブ内のexe。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link-ユーザーがダウンロードしたいファイルへのリンク（data.jsonに接続されています）。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password-アーカイブのパスワード。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
目的のチートを選択し、トロイの木馬の開発者のサイトから「ExtrimHack.rar」という有望な名前のパスワードで保護された7zipアーカイブをダウンロードするとします。</font><font style="vertical-align: inherit;">その中には、実行可能ファイル、構成ファイル、7zipライブラリ、およびNode.jsを使用して起動されたネイティブC ++ライブラリとスクリプトを含むbinアーカイブがあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アーカイブコンテンツの例：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7z.dll;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.bin;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data.json;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COP GO.exeのESPチート。</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実行可能ファイルが起動されると、トロイの木馬はその操作に必要なすべてのコンポーネントをインストールし、パラメータを含むdata.jsonファイルからの情報を使用して、ユーザーに必要なチートもダウンロードします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
data.jsonの内容の例：</font></font><br>
<pre><code class="javascript hljs">{<span class="hljs-string">"source"</span>:[<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">43</span>],<span class="hljs-string">"dataVersion"</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">115</span>],<span class="hljs-string">"link"</span>:<span class="hljs-string">"http:\/\/clearcheats.ru\/images\/dl\/csgo\/ESP_csgo.dll"</span>}
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このプロセスのいくつかのコピーを機能から除外するために、このトロイの木馬は「cortelMoney-suncMutex」ミューテックスを作成し、それを「％WINDIR％\ WinKit \」ディレクトリにインストールします。</font><font style="vertical-align: inherit;">次に、レジストリにあるかどうかを確認します（[HKLM \\ソフトウェア\\ Microsoft \\ Windowsノード]）。</font><font style="vertical-align: inherit;">もしそうなら、それはそのパラメータを読み、そのバージョンをdata.jsonで指定されたものと比較します。</font><font style="vertical-align: inherit;">バージョンが最新の場合、それ以上何もせずに終了します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、このトロイの木馬はdata.binの内容を％WINDIR％\\ WinKit \\に解凍し、start.jsを開始するサービスをインストールします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
data.binの内容：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デーモン;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node_modules;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7z.dll;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msnode.exe;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.js;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startDll.dll;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update.js;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updateDll.dll。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、msnode.exeは有効なデジタル署名を持つ実行可能ファイルNode.jsであり、node_modulesディレクトリには「ffi」、「node-windows」、「ref」のライブラリが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
startDll.dllライブラリがstart.jsにロードされ、そのmymainエクスポートが呼び出され、レジストリからパラメーターが読み取られ、「％WINDIR％\\ WinKit \\ msnode％WINDIR％\\ WinKit \\ update.js」が開始され、サービスが停止します。 「Windowsノード」</font><font style="vertical-align: inherit;">次に、update.jsスクリプトがupdateDll.dllライブラリをロードし、mymainエクスポートを呼び出します。</font><font style="vertical-align: inherit;">複雑なことは何もありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
updateDll.dllで、このトロイの木馬はインターネット接続のチェックを開始します。</font><font style="vertical-align: inherit;">これを行うには、3つすべてが200コードを返すまで、10秒ごとにgoogle.com、yahoo.com、facebook.comにリクエストを送信します。</font><font style="vertical-align: inherit;">次に</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">s44571fu</font></a><font style="vertical-align: inherit;">サーバーに送信します</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[。] bget [。] ru / CortelMoney / enter.php POSTリクエストと構成データ：</font></font><br>
<br>
<pre><code class="javascript hljs">{<span class="hljs-string">"login"</span>:<span class="hljs-string">"NULL"</span>,<span class="hljs-string">"mainId"</span>:<span class="hljs-string">"PPrn1DXeGvUtzXC7jna2oqdO2m?WUMzHAoM8hHQF"</span>,<span class="hljs-string">"password"</span>:<span class="hljs-string">"NULL"</span>,<span class="hljs-string">"source"</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<span class="hljs-string">"updaterVersion"</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],<span class="hljs-string">"workerVersion"</span>:[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この場合、基本認証には「cortel：money」のペアが使用され、User-Agentは「USER AGENT」に設定されています。</font><font style="vertical-align: inherit;">後続のリクエストの基本的な認証には、ログイン：パスワードが使用され、サーバーから報告されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
サーバーは次のようなjsonで応答します。</font></font><br>
<br>
<pre><code class="javascript hljs">{
    <span class="hljs-string">"login"</span>: <span class="hljs-string">"240797"</span>,
    <span class="hljs-string">"password"</span>: <span class="hljs-string">"tdzjIF?JgEG5NOofJO6YrEPQcw2TJ7y4xPxqcz?X"</span>,
    <span class="hljs-string">"updaterVersion"</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">115</span>],
    <span class="hljs-string">"updaterLink"</span>: <span class="hljs-string">"http:\/\/s44571fu.bget.ru\/CortelMoney\/version\/0-0-0-115-upd.7z"</span>,
    <span class="hljs-string">"workerVersion"</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>],
    <span class="hljs-string">"workerLink"</span>: <span class="hljs-string">"http:\/\/s44571fu.bget.ru\/CortelMoney\/version\/0-0-3-0-work.7z"</span>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、サーバーの応答にはトロイの木馬の主要な要素のバージョンが含まれています。</font><font style="vertical-align: inherit;">ユーザーのデバイス上のアップデータの現在のバージョンがサーバーによって報告されたものより古い場合、トロイの木馬は指定されたリンクからファイルをダウンロードし、アーカイブをディレクトリ「％WINDIR％\\ WinKit \\\\」に解凍します。代わりに、サーバーの応答からのupdaterVersionパラメータの値が示されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトロイの木馬は、ワーカーファイルを％WINDIR％\\ WinKit \\ SystemNode \\ディレクトリに解凍し、「％WINDIR％\\ WinKit \\ SystemNode \\ sysnode％WINDIR％\\ WinKit \\ SystemNode \\ main.js」を起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワーカーのアーカイブの内容：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">node_modules;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7za.exe;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コーデックス;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.js;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysnode.exe。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にこのトロイの木馬は、Windowsノードガードサービスを削除してから再度作成し、実行可能ファイルをWindowsノードサービスファイルに置き換えます。</font><font style="vertical-align: inherit;">同様に、Windowsノードサービスを再作成し、実行可能ファイルをデーモン\\ service.exeに置き換えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、パラメーターを指定してservice.xmlを作成します。</font></font><br>
<pre><code class="javascript hljs">&lt;service&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>service.exe<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>C:\Windows\\WinKit\0.0.0.115\msnode.exe<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">arguments</span>&gt;</span>"C:\Windows\\WinKit\0.0.0.115\start.js"<span class="hljs-tag">&lt;/<span class="hljs-name">arguments</span>&gt;</span></span>&lt;/service&gt;
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アップデーターは「C：\ Windows \ Reserve Service」ディレクトリにインストールされ、サービスによって登録され、Node.js。バイナリによって起動されます。</font><font style="vertical-align: inherit;">また、いくつかのjsスクリプトとネイティブC ++ライブラリで構成されています。</font><font style="vertical-align: inherit;">メインモジュールはmain.jsです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アップデータ付きのアーカイブの内容：</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.js;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">start.js;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crypto.dll;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">network.dll; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service.exe。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トロイの木馬が最初に現在の日付を見つけたら、リクエストをgoogle.com、yandex.ruまたは</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.i.uaに送信し</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">彼は少し後で受け取った情報を使用します。</font><font style="vertical-align: inherit;">次に、crypto.dllライブラリを使用してbootList.jsonファイルの内容を復号化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
復号化アルゴリズム：</font></font><br>
<pre><code class="javascript hljs">key = <span class="hljs-string">'123'</span>
s = <span class="hljs-string">''</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(d)):<font></font>
    s += chr((ord(d[i]) - ord(key[i % len(key)])) &amp; <span class="hljs-number">0xff</span>)
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そこから管理サーバーのリストを取得します。</font></font><br>
<pre><code class="javascript hljs">[{<span class="hljs-string">"node"</span>:<span class="hljs-string">"http://cortel8x.beget.tech/reserve"</span>,<span class="hljs-string">"weight"</span>:<span class="hljs-number">10</span>},{<span class="hljs-string">"node"</span>:<span class="hljs-string">"http://reserve-system.ru/work"</span>,<span class="hljs-string">"weight"</span>:<span class="hljs-number">10</span>}]</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、このトロイの木馬はレジストリから情報を読み取ります。 </font></font><br>
<pre><code class="plaintext hljs">function getInfo()<font></font>
{<font></font>
var WindowsNodeInfo = new Object();<font></font>
WindowsNodeInfo.mainId = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "mainId");<font></font>
WindowsNodeInfo.login = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "log");<font></font>
WindowsNodeInfo.password = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "pass");<font></font>
WindowsNodeInfo.source = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "source");<font></font>
WindowsNodeInfo.updaterVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "updaterVersion");<font></font>
WindowsNodeInfo.workerVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "workerVersion");<font></font>
var ReserveSystemInfo = new Object();<font></font>
ReserveSystemInfo.workerVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Reserve System", "updaterVersion");<font></font>
var myInfo = new Object();<font></font>
myInfo.windowsNode = WindowsNodeInfo;<font></font>
myInfo.reserveSystem = ReserveSystemInfo;<font></font>
return JSON.stringify(myInfo);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、「cortel：money」のペアに対応する基本認証のHTTPヘッダーを追加し、POST要求と共にそれを以前に復号化された管理サーバーに送信します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
応答として、サーバーは以下を受け取ります。</font></font><br>
<br>
<pre><code class="javascript hljs"><font></font>
{<font></font>
    <span class="hljs-string">"data"</span>: {
        <span class="hljs-string">"updaterVersion"</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],
        <span class="hljs-string">"updaterLink"</span>: <span class="hljs-string">"/upd.7z"</span>,
        <span class="hljs-string">"updaterVerify"</span>: <span class="hljs-string">"£ñß(\u0012Ä\ti¾$ë5ž»\u001c²\u001c\fÙ=±÷ö‚´èUnŽÐÂBÔ\n\u001dW6?u½\u0005Œn\u000fp:üÍ\u0019\u0000\u000bSý«\u00137÷\u0013”’ì¥û§s7F\u0016ó\\\u000f%6ñê\"7î&lt;ýoäƒƒ0Æ%t ñÅv­‚S¡\r\u001e•ÅÆ¡¿N)v\\f8\u0004F\fUS¯‰³§ oIõŒiÆîGÝª\u0017êH/8Ö1-°™[P 5E7X‡Fø%S ŠXÕ6Oþ=Vô‰…ˆ:.3Œ‚i\u000eÁù9Ã&amp;¾ŒM\u001eÛªé$\u0006#IèÞÛ\u0018À\u001b^è,ÁòÑCTXb\u001d$ç\u0004„ð¶0UVÕ»e\u001f\b\u001e¡Ä¼è+Fjúÿoâz\r !çô3xØs—_\u000b\u0017\u001fY]\u0001¥j^û\\W"</span>,
        <span class="hljs-string">"dateTime"</span>: <span class="hljs-number">1534868028000</span>,
        <span class="hljs-string">"bootList"</span>: [{
            <span class="hljs-string">"node"</span>: <span class="hljs-string">"http://cortel8x.beget.tech/reserve/"</span>,
            <span class="hljs-string">"weight"</span>: <span class="hljs-number">10</span><font></font>
        }, {<font></font>
            <span class="hljs-string">"node"</span>: <span class="hljs-string">"http://reserve-system.ru/work/"</span>,
            <span class="hljs-string">"weight"</span>: <span class="hljs-number">10</span><font></font>
        }]<font></font>
    },<font></font>
    <span class="hljs-string">"dataInfo"</span>: <span class="hljs-string">"I`ù@ÀP‘ÈcÊÛ´#iè Ò~\u0007&lt;\u0001Ýìûl«ÔÆq\u0013àÛ\u0003\b\u0017ÑLÁ}ÿÚ˜DS']\u0003bf\u0003!¿Cð¸q¸ÖÜ’B¢CÄAMˆÀA¤d\u001c5¨d -\u0013‰\u0011Ñ¼F‘|SB[¬°(Ü¹ÈÒÜ £L\u00071¾:`\u001bŒìýKõ\"²Ÿ¸$´3™UºÅ¨J†¨cƒf¿}r;Öeì¶x‰ØKt¥‹„47a\u001e¸Ô‡ˆy\u0006•\u001b\u0004‚‹„„•ó\u001a\u0019\nu&gt;¨)bkæ…'\u00127@é‹7µæy3ÈNrS’Mð‡\u0018\u0019¾òÓ[Žå5H‡ƒ·¦k‘¿ÉŠ&amp;PÂÈîåÚ~M\u0010ðnáHæ“ªxÃv c×“\u0013…T…ïÑÝ\tœŽ\u0018†Æ\u00148$”Ôî"</span><font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これが先に受け取った現在の日付です。このトロイの木馬は、サーバーから渡されたdataTimeパラメータと照合します。日付の差が1ミリ秒（ミリ秒単位）を超える場合、トロイの木馬はコマンドを実行しません。 dataInfoパラメータにはデータ署名（データフィールド）も含まれ、main.jsに配線された公開鍵を使用してチェックされます。また、「bootList」パラメータには、トロイの木馬が暗号化して「bootList.json」に保存するサーバーのリストが含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、トロイの木馬はそのバージョンをupdaterVersionパラメータで指定されたバージョンと照合します。</font><font style="vertical-align: inherit;">インストールされているバージョンが最新のバージョンよりも低くない場合、このトロイの木馬はパラメータ「main.js」を渡して「upd \\ upd.exe」を起動します。</font><font style="vertical-align: inherit;">サーバーの応答のバージョンが新しい場合、トロイの木馬は「updaterLink」パラメータupd.7zからのリンクを使用してアップデートアーカイブをダウンロードし、その署名をチェックして解凍します。</font><font style="vertical-align: inherit;">次に、アップデートのバージョン[HKLM \\ SOFTWARE \\ Microsoft \\ Reserve System] 'updaterVersion'をレジストリに書き込みます。その後、「upd \\ upd.exe」を再度起動し、パラメーター「main.js」を渡して渡します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トロイの木馬のワーカーは、コンポーネントの1つがすでにインストールされていることを確認し、アプリケーションをインストールするかどうかを決定します。</font><font style="vertical-align: inherit;">まず、彼はMoonTitleWorkerミューテックスを作成し、次にcodeXファイルを文字列「xor」とのXORで復号化して実行します。</font><font style="vertical-align: inherit;">その後、情報を含むjsonを形成します。</font></font><br>
<pre><code class="javascript hljs">
{<span class="hljs-string">"userId"</span>: id, <span class="hljs-string">"starter"</span>: [], <span class="hljs-string">"worker"</span>: [], <span class="hljs-string">"source"</span>: [], <span class="hljs-string">"osInfo"</span>: {<span class="hljs-string">"isX64"</span>: True, <span class="hljs-string">"osString"</span>: <span class="hljs-string">"Windows 7 Enterprise"</span>}}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この情報は、httpにPOSTリクエストを送信します：// &lt;malicious_site&gt;エクシーズ[。]：1001 / getApps（良識のために、我々は、ドメイン名を指定していないが、それを見つけることができる</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。）サーバの応答が必要にインストールすることをアプリケーションに関する情報が含まれていてもよいです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
回答例：</font></font><br>
<pre><code class="javascript hljs"><font></font>
{<font></font>
    <span class="hljs-string">"body"</span>: {
        <span class="hljs-string">"apps"</span>: [{
            <span class="hljs-string">"hash"</span>: <span class="hljs-string">"452f8e156c5c3206b46ea0fe61a47b247251f24d60bdba31c41298cd5e8eba9a"</span>,
            <span class="hljs-string">"size"</span>: <span class="hljs-number">8137466</span>,
            <span class="hljs-string">"version"</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>],
            <span class="hljs-string">"link"</span>: <span class="hljs-string">"xmr-1-64.7z"</span>,
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"%pf%\\Microsoft JDX\\64"</span>,
            <span class="hljs-string">"runComand"</span>: <span class="hljs-string">"%path%\\moonlight.exe start.js"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"xmr64"</span><font></font>
        }]<font></font>
    },<font></font>
    <span class="hljs-string">"head"</span>: <span class="hljs-string">"O~¨^Óå+ßzIçsG¬üS„Ê¶$êL–LùÎ¸Z\f\u0019ÐÐ\u000e \u0004\u001cÀU¯\u0011š)áUÚ\u001flß²A\u001fôÝÔìˆ±y%\"DP» ^¯«FUâ\u001cÔû\u001dµ´Jï#¬ÌÈ¹ÎÚª?\r—]Yj·÷õ³—\u001e°ÖÒ\\é‰¤d’BT\u0019·¦FõVQ°Aç’)\u001cõªµ¦ýûHlbÍ¸þ}éŒ\u0000jvÔ%S;Ã×þA\u0011ß‘I[´\u0004ýÚ\u0007Z:ZÂ\n–ñz#ÈBö›²2\u0007ÎJw±èTVoŸå\bÖR3½ù;ƒó\u0011ÉÌ€ÅÖàð06ÓeÕþ­ˆ”7Ùš\u0011•»”˜¢5µgôÛc˜&amp;L\u000fê.?!Çæ}¨\u001eÕ—J#A¼_Ì\u0015càñb"</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デバイスにそのようなアプリケーションがない場合、トロイの木馬はPOSTリクエストをURL http：// &lt;malicious_site&gt; [。] Xyz：1001 /に送信することでそれをダウンロードします。サーバー応答からの対応するアプリケーションのリンクパラメータが代わりに示されます。そのようなアプリケーションがあっても古いバージョンの場合は、現在のアプリケーションに更新されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトロイの木馬は、ダウンロードされたファイルのサイズとハッシュを、サーバーがハッシュとサイズパラメータで指定した情報と照合します。データが収束すると、pathパラメーターからパスに沿ってファイルを移動し、runCommandフィールドで指定されたコマンドを起動します。ダウンロードしたアプリケーションに関する情報は、レジストリ[HKLM \\ SOFTWARE \\ Microsoft \\ MoonTitle \\ apps \\]に格納されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現時点では、xmrigマイナーはバックドアを使用してインストールされています。</font><font style="vertical-align: inherit;">システムの容量に応じて、トロイの木馬はxmr-1.7zまたはxmr-1-64.7zアーカイブをダウンロードします。</font><font style="vertical-align: inherit;">start.jsでは、xmrig.dllライブラリを読み込み、mymainエクスポートを呼び出します。ここで、環境変数をデプロイしてプロセスを強制終了します。</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％sys32_86％\\ xmr;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％sys32_86％\\ xmr64;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％pf_86％\\ Microsoft JDX \\ 32 \\ windows-update.exe;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％pf_86％\\ Microsoft JDX \\ 64 \\ windows-update.exe。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
xmrig.exeファイルが近くにある場合、トロイの木馬はそれを現在のプロセスのメモリにロードし、MZシグネチャを消去し、XORと0x39を使用して復号化し、そのダンプをダンプファイルに保存します。トロイの木馬は、同じディレクトリで「ダンプ」ファイルを見つけると、同じ方法で復号化し、windows-update.exeを起動して、復号化されたペイロードをファイルに埋め込みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このトロイの木馬は、POSTリクエストを収集して次のURLに送信します：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cherry-pot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [。] Top / RemoteApps / xmr / main.php次のシステム情報：{"action"： "enter"、 "architecture"： "INTEL"、 "cpuAES" ：true、「cpuCache」：8192、「cpuSpeed」：3392.0、「cpuThreads」：2、「cpuVendorString」：「Intel®Core（TM）i5-4690S CPU @ 3.20GHz \ u0000」、「hightPages」：false、「ログイン "：" null "、"パスワード "：" null "、" ramPhysicalSize "：3071、" xmrigVersion "：[2,10,0]}</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
応答として、サーバーはマイナー構成を送信します。</font></font><br>
<pre><code class="javascript hljs">{<span class="hljs-string">"maxCpuLoad"</span>:<span class="hljs-number">1000</span>,<span class="hljs-string">"minCpuLoad "</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"algo"</span>:<span class="hljs-string">"cryptonight-pico/trtl"</span>,<span class="hljs-string">"av"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"background"</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">"donate-level"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"max-cpu-usage"</span>:<span class="hljs-number">75</span>,<span class="hljs-string">"retries"</span>:<span class="hljs-number">5</span>,<span class="hljs-string">"retry-pause"</span>:<span class="hljs-number">5</span>,<span class="hljs-string">"cpu-priority"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"pools"</span>:[{<span class="hljs-string">"url"</span>:<span class="hljs-string">"185.224.133.91:5511"</span>,<span class="hljs-string">"keepalive"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"nicehash"</span>:<span class="hljs-literal">true</span>}]}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
トロイの木馬はconfig.jsonに設定を保存した後、自動的に開始してマイニングを開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MonsterInstallにはその他の変更があります。たとえば、ゲームのチートに加えて、Malvari開発者は、Chromeブラウザーインストーラーとファイルをチェックするプログラムを装ってそれを配布しました。トロイの木馬のそれ以降のバージョンでは、開発者はセキュリティを考慮し、文字列の暗号化を追加し、一部のファイルにはパスワードを入力する必要がありました。さらに、トロイの木馬のいずれかのバージョンのブートローダーには、トロイの木馬の開発者のドメインに掲載されている使用許諾契約へのリンクさえあります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（残念ながら、そのような契約の法的効力に関する質問は、この記事の範囲を超えていますが、このトピックに関する資料を読みたい場合は、コメントでお知らせください）。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">調査結果</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Node.jsは、ウイルス作成者にとって最も実用的なソリューションではありません。このようなトロイの木馬のサイズが小さい場合、Node.jsバインディング（実行可能ファイルとライブラリ）は標準のmalvariよりもはるかに「重い」でしょう。何がこの選択を決定しましたか？原則として、開発者は使い慣れたツールを選択します。したがって、ブリーダーの場合でも、テクノロジーの選択は個人の好みの問題です。それにもかかわらず、Node.jsにはその利点があり、そのうちの1つは有効な署名です。システムでは、このようなプロセスはNode.jsとして署名されるため、疑いの余地はほとんどありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要約すると、興味深いツールの選択にもかかわらず、これはバックドア開発者に大きな利点を与えなかったことに注意することができます。今後、Node.jsを使用するマルウェアが増えるとは考えられません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
いつものように、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥協の指標を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有し</font><font style="vertical-align: inherit;">ます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja460239/index.html">NextGen Firewallを自分で完全に無料で自宅に戻す方法</a></li>
<li><a href="../ja460247/index.html">ELFのレシピ</a></li>
<li><a href="../ja460249/index.html">pwnable.kr 07を使用したタスクのソリューション-入力。pwntoolsを理解する</a></li>
<li><a href="../ja460251/index.html">人工的な愚かさ：私を助けなかったボット</a></li>
<li><a href="../ja460253/index.html">音声アシスタントのスキルを高める10の理由</a></li>
<li><a href="../ja460257/index.html">"こんにちは世界" ターミナルに深く浸る</a></li>
<li><a href="../ja460259/index.html">UIおよびUXデザインとは何ですか？共通点と相違点は何ですか？</a></li>
<li><a href="../ja460261/index.html">アマゾン：25年間のeコマースの成功</a></li>
<li><a href="../ja460263/index.html">本当にスマートな検索を行う：ステップバイステップガイド</a></li>
<li><a href="../ja460265/index.html">Xcodeプロジェクトテンプレートを作成する</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>