<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•Ö üßû üåâ Advanced TypeScript üöÜ üëâüèº üôè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Freediving - scuba diving without scuba diving. The diver feels the law of Archimedes: he displaces a certain amount of water, which pushes him back. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Advanced TypeScript</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/499634/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Freediving - scuba diving without scuba diving. </font><font style="vertical-align: inherit;">The diver feels the law of Archimedes: he displaces a certain amount of water, which pushes him back. </font><font style="vertical-align: inherit;">Therefore, the first few meters are given the hardest, but then the pressure force of the water column above you begins to help move deeper. </font><font style="vertical-align: inherit;">This process is reminiscent of learning and diving into TypeScript type systems - it becomes a little easier as you dive. </font><font style="vertical-align: inherit;">But we must not forget to emerge in time. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sh/eb/y9/sheby96u0qt6o3usirdpsc78hpg.jpeg"><br>
<font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Photo from </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One Ocean One Breath</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font></i></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikhail Bashurov</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saitonakamura</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) - Senior Frontend Engineer at WiseBits, a TypeScript fan and amateur freediver. </font><font style="vertical-align: inherit;">The analogies of learning TypeScript and diving deep are not accidental. </font><font style="vertical-align: inherit;">Michael will tell you what discriminated unions are, how to use type inference, why you need nominal compatibility and branding. </font><font style="vertical-align: inherit;">Hold your breath and dive.</font></font><a name="habracut"></a><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/m0uRxCCno00" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><font color="gray"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Presentation and links to GitHub with sample code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type of work</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The types of sums sound algebraic - let's try to figure out what it is. </font><font style="vertical-align: inherit;">They are called variant in ReasonML, tagged union in Haskell, and discriminated union in F # and TypeScript. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wikipedia gives the following definition: "The type of amount is the sum of the types of works." </font></font><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Thank you captain! </font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The definition is utterly correct, but useless, so let's understand. </font><font style="vertical-align: inherit;">Let's go from the private and start with the type of work. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suppose we have a type </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It has two fields: </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and who created it.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This type of work is intersection or </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intersection</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This means that we can write the same code as each field individually.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">id</span>: number } &amp; { <span class="hljs-attr">whoCreated</span>: number }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the algebra of propositions, this is called logical multiplication: this is the operation ‚ÄúAND‚Äù or ‚ÄúAND‚Äù. </font><font style="vertical-align: inherit;">The type of product is the logical product of these two elements.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An object with a set of fields can be expressed through a logical product.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The type of work is not limited to fields. </font><font style="vertical-align: inherit;">Imagine that we love Prototype and decided that we are missing </font></font><code>leftPad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type RichString = string &amp; { <span class="hljs-attr">leftPad</span>: <span class="hljs-function">(<span class="hljs-params">toLength: number</span>) =&gt;</span> string }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add it to </font></font><code>String.prototype</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To express in types, we take string and a function that takes the necessary values. </font><font style="vertical-align: inherit;">The method and string are the intersection.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An association</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Union ‚Äî </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äî is useful, for example, to represent the type of a variable that sets the width of an element in CSS: a string of 10 pixels or an absolute value. </font><font style="vertical-align: inherit;">The CSS specification is actually much more complicated, but for simplicity, let's leave it that way.</font></font><br>
<br>
<pre><code class="javascript hljs">type Width = string | number</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An example is more complicated. </font><font style="vertical-align: inherit;">Suppose we have a task. </font><font style="vertical-align: inherit;">It can be in three states: just created, accepted into work and completed.</font></font><br>
<br>
<pre><code class="javascript hljs">type InitialTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }<font></font>
type InWorkTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number }<font></font>
type FinishTask = { <span class="hljs-attr">id</span>: number, <span class="hljs-attr">whoCreated</span>: number, <span class="hljs-attr">finishDate</span>: <span class="hljs-built_in">Date</span> }<font></font>
<font></font>
type Task = InitialTask | InWorkTask | FinishedTask</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the first and second states, the task has </font></font><code>id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and who created it, and in the third, the completion date appears. </font><font style="vertical-align: inherit;">Here the union appears - either this or that. </font></font><br>
<br>
<strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></em></strong><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Instead, </font></font></em><code>type</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you can use </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">But there are nuances. </font><font style="vertical-align: inherit;">The result of union and intersection is always a type. </font><font style="vertical-align: inherit;">You can express intersection through </font></font></em><code>extends</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but union through </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cannot. </font><font style="vertical-align: inherit;">It‚Äôs </font></font></em><code>type</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">just shorter. </font></font><br>
<br>
</em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">helps only to merge declarations. </font><font style="vertical-align: inherit;">Library types always need to be expressed through </font></font></em><code>interface</code><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, because this will allow other developers to expand it with their fields. </font><font style="vertical-align: inherit;">So typified, for example, jQuery-plugins.</font></font></em><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type compatibility</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But there is a problem - in TypeScript, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structural type compatibility</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This means that if the first and second types have the same set of fields, then these are two of the same type. For example, we have 10 types with different names, but with an identical structure (with the same fields). If we provide any of the 10 types to a function that accepts one of them, TypeScript will not mind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Java or C #, on the contrary, a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nominal compatibility system</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . We will write the same 10 classes with identical fields and a function that takes one of them. A function will not accept other classes if they are not direct descendants of the type that the function is intended for. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The structural compatibility issue is addressed by adding status to the field: </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or</font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. But sum types are a way to express code more semantically than how it is stored in the database. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For an example we will address to ReasonML. This is how this type looks there.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task =<font></font>
| Initial({ <span class="hljs-attr">id</span>: int, <span class="hljs-attr">whoCreated</span>: int })<font></font>
| InWork({ <span class="hljs-attr">id</span>: int, <span class="hljs-attr">whoCreated</span>: int })<font></font>
| Finished({<font></font>
        <span class="hljs-attr">id</span>: int,
        <span class="hljs-attr">whoCreated</span>: int,
        <span class="hljs-attr">finshDate</span>: <span class="hljs-built_in">Date</span>
    })</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The same fields, except that </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instead </font></font><code>number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. If you look closely, we note </font></font><code>Initial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>InWork</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Finished</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. They are not located on the left, in the type name, but on the right in the definition. This is not just a line in the title, but part of a separate type, so we can distinguish the first from the second. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Life hack</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . For generic types (like your domain entities) create a file </font></font><code>global.d.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and add all types to it. They will be automatically visible throughout the TypeScript codebase without the need for explicit import. This is convenient for migration because you don‚Äôt have to worry about where to place types. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's see how to do this, using the example of primitive Redux code.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state, action) = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">erro</span>: action.payload }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rewrite the code in TypeScript. Let's start by renaming the file - from </font></font><code>.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>.ts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Turn on all state options and the noImplicitAny option. This option finds functions in which the parameter type is not specified, and is useful at the stage of migration. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typable </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: add field </font></font><code>isFetching</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(which can not be) and </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type Task = { <span class="hljs-attr">title</span>: string }<font></font>
<font></font>
declare <span class="hljs-built_in">module</span> <span class="hljs-string">"*.jpg"</span> {
    <span class="hljs-keyword">const</span> url: string
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> url<font></font>
}<font></font>
<font></font>
declare <span class="hljs-built_in">module</span> <span class="hljs-string">"*.png"</span> {
    <span class="hljs-keyword">const</span> url: string
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> url<font></font>
}</code></pre><br>
<em><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lifehack peeped in Basarat Ali Syed's </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TypeScript Deep Dive</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . It's a bit dated, but still useful for those who want to dive into TypeScript. Read about the current state of TypeScript on the </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog of</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marius Schulz. He writes about new features and tricks. Also study </font></font></em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">change logs</font></font></em></a><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , there is not only information about updates, but also how to use them.</font></font></em><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Remained actions. We will type and declare each of them.</font></font><br>
<br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span><font></font>
}<font></font>
<font></font>
type SuccessAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>,
    <span class="hljs-attr">payload</span>: Task<font></font>
<font></font>
type FailAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>,
    <span class="hljs-attr">payload</span>: <span class="hljs-built_in">Error</span><font></font>
}<font></font>
<font></font>
type Actions = FetchAction | SuccessAction | FailAction</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The field </font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for all types is different, it is not just a string, but a specific string - a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string literal</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is the very </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discriminator</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the tag by which we distinguish all cases. </font><font style="vertical-align: inherit;">We got a discriminated union and, for example, we can understand what is in payload. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Update the original Redux code:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is danger here if we write </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font><br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: string<font></font>
}</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... then everything will break, because it is no longer a discriminator. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this action, type can be any string at all, and not a specific discriminator. </font><font style="vertical-align: inherit;">After that, TypeScript will not be able to distinguish one action from another and find errors. </font><font style="vertical-align: inherit;">Therefore, there should be exactly a string literal. </font><font style="vertical-align: inherit;">Moreover, we can add this design: </font></font><code>type ActionType = Actions["type"]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Three of our options will pop up in the prompts. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uf/gm/si/ufgmsit8lx5zzmmd9tvot5ibg5u.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you write ...</font></font><br>
<pre><code class="javascript hljs">type FetchAction = {
    <span class="hljs-attr">type</span>: string<font></font>
}</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... then the prompts will be simple </font></font><code>string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, because all the other lines are no longer important. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z1/g1/qe/z1g1qecermtbhjq62vju5ujmwv0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We have all typed and got the type of amount.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exhaustive checking</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imagine a hypothetical situation where error handling is not added to the code.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-comment">//case "TASK_FAIL":</span>
            <span class="hljs-comment">//return { isFetching: false, error: action.payload }</span><font></font>
    }<font></font>
    <font></font>
    <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Here </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exhaustive checking</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will help us </font><font style="vertical-align: inherit;">- another useful property such as sum </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is an opportunity to verify that we have processed all possible cases. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add a variable after the switch statement: </font></font><code>const exhaustiveCheck: never = action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
never is an interesting type:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if it is the result of a function return, then the function never ends correctly (for example, it always throws an error or is executed endlessly);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if it is a type, then this type cannot be created without any extra effort.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now the compiler will indicate the error ‚ÄúType 'FailAction' is not assignable to type 'never'‚Äù. </font><font style="vertical-align: inherit;">We have three possible types of actions, of which we have not processed </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- this is </font></font><code>FailAction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">But to never, it is not ‚Äúassignable‚Äù. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Let's add processing </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and there will be no more errors. </font><font style="vertical-align: inherit;">Processed </font></font><code>"TASK_FETCH"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- returned, processed </font></font><code>"TASK_SUCCESS"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- returned, processed </font></font><code>"TASK_FAIL"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">When we processed all three functions, what could be the action? </font><font style="vertical-align: inherit;">Nothing - </font></font><code>never</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you add another action, the compiler will tell you which ones are not processed. </font><font style="vertical-align: inherit;">This will help if you want to respond to all actions, and if only to selective, then no.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First tip</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try hard.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At first it will be hard to dive: read about the type of sum, then about products, algebraic data types, and so on in the chain. </font><font style="vertical-align: inherit;">Will have to make an effort. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we dive deeper, the pressure of the water column above us increases. </font><font style="vertical-align: inherit;">At a certain depth, the buoyancy force and water pressure above us are balanced. </font><font style="vertical-align: inherit;">This is a zone of "neutral buoyancy", in which we are in a state of weightlessness. </font><font style="vertical-align: inherit;">In this state, we can turn to other type systems or languages.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nominal Type System</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In ancient Rome, the inhabitants had three components of the name: surname, name and "nickname". </font><font style="vertical-align: inherit;">The name itself is "nomen." </font><font style="vertical-align: inherit;">From this comes the nominal type system - "nominal". </font><font style="vertical-align: inherit;">It is sometimes useful. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, we have such a function code.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> githubUrl = process.env.GITHUB_URL <span class="hljs-keyword">as</span> string
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> string<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchStarredRepos = (<font></font>
    nodeEnv: string,<font></font>
    <span class="hljs-attr">githubUrl</span>: string<font></font>
): <span class="hljs-built_in">Promise</span>&lt;GithubRepo[ ]&gt; =&gt; {
    <span class="hljs-keyword">if</span> (nodeEnv = <span class="hljs-string">"production"</span>) {
        <span class="hljs-comment">// log call</span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">// prettier-ignore</span>
    <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">'$githubUrl}/users/saitonakamura/starred'</span>)<font></font>
        .then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.json());<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The configuration comes on the API: </font></font><code>GITHUB_URL=https://api.github.com</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The </font></font><code>githubUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API </font><font style="vertical-align: inherit;">method </font><font style="vertical-align: inherit;">pulls out the repositories on which we put an asterisk. </font><font style="vertical-align: inherit;">And if </font></font><code>nodeEnv = "production"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, then it logs this call, for example, for metrics. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For the function we want to develop (UI).</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> React, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span><font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> StarredRepos = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> [starredRepos, setStarredRepos] = useState&lt;GithubRepo[ ] | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (!starredRepos) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading‚Ä¶<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><font></font>
<font></font>
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {starredRepos.map(repo =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.name}</span>&gt;</span>repo.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><font></font>
    )<font></font>
}<font></font>
<font></font>
type GithubRepo = {<font></font>
    <span class="hljs-attr">name</span>: string<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The function already knows how to display data, and if there is none, then a loader. </font><font style="vertical-align: inherit;">It remains to add an API call and populate the data.</font></font><br>
<br>
<pre><code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    fetchStarredRepos(githubUrl, nodeEnv).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setStarredRepos(data))<font></font>
}, [ ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But if we run this code, everything will fall. </font><font style="vertical-align: inherit;">In the developer panel, we find that it is </font></font><code>fetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accessing the address </font></font><code>'/users/saitonakamura/starred'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- githubUrl has disappeared somewhere. </font><font style="vertical-align: inherit;">It turns out that all because of the strange design - </font></font><code>nodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comes first. </font><font style="vertical-align: inherit;">Of course, it may be tempting to change everything, but the function can be used in other places in the code base. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But what if the compiler prompts this in advance? </font><font style="vertical-align: inherit;">Then you don‚Äôt have to go through the entire launch cycle, detecting an error, or searching for the reasons.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Branding</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript has a hack for this ‚Äî brand types. </font><font style="vertical-align: inherit;">Create </font></font><code>Brand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(string), </font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and two types. </font><font style="vertical-align: inherit;">We will create the same type for </font></font><code>NodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type Brand&lt;T, B extends string&gt; = T &amp; { readonly _brand: B }<font></font>
<font></font>
type GithubUrl = Brand&lt;string, <span class="hljs-string">"githubUrl"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> githubUrl = process.env.GITHUB_URL <span class="hljs-keyword">as</span> GithubUrl<font></font>
<font></font>
type NodeEnv = Brand&lt;string, <span class="hljs-string">"nodeEnv"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> NodeEnv</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But we get an error. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/qi/_e/j-/qi_ej-yne7xhcj4qmozvbw6r7qc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now </font></font><code>githubUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it‚Äôs </font></font><code>nodeEnv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impossible to assign each other, because these are nominal types. </font><font style="vertical-align: inherit;">Unobtrusive, but nominal. </font><font style="vertical-align: inherit;">Now we cannot swap them here - we change them in another part of the code.</font></font><br>
<br>
<pre><code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<font></font>
    fetchStarresRepos(nodeEnv, githubUrl).then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> setStarredRepos(data))<font></font>
}, [ ])</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now everything is fine - they got </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">branded primitives</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Branding is useful when several arguments (strings, numbers) are encountered. They have a certain semantics (x, y coordinates), and they should not be confused. It is convenient when the compiler tells you that they are confused. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But there are two problems. First, TypeScript does not have native nominal types. But there is hope that it will be resolved, a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">discussion of this issue is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ongoing in the language repository </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The second problem is ‚Äúas‚Äù, there are no guarantees that the </font></font><code>GITHUB_URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link is not broken. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As well as with </font></font><code>NODE_ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Most likely, we want not just some string, but </font></font><code>"production"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>"development"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="javascript hljs">type NodeEnv = Brand&lt;<span class="hljs-string">"production"</span> | <span class="hljs-string">"development"</span> | <span class="hljs-string">"nodeEnv"</span>&gt;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nodeEnv = process.env.NODE_ENV <span class="hljs-keyword">as</span> NodeEnv</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All this needs to be checked. </font><font style="vertical-align: inherit;">I am referring you to smart designers and Sergey Cherepanov's report, " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Designing a Domain with TypeScript in a Functional Style</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Second and third tips</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Be carefull.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sometimes stop and look around: at other languages, frameworks, type systems. </font><font style="vertical-align: inherit;">Learn new principles and learn lessons. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we pass the point of "neutral buoyancy", the water presses harder and pulls us down.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relax.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dive deeper and let TypeScript do its job.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What TypeScript can do</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript can </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print types</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span><font></font>
})<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSuccess = <span class="hljs-function">(<span class="hljs-params">task: Task</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>
    <span class="hljs-attr">payload</span>: Task<font></font>
})<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFail = <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>
    <span class="hljs-attr">payload</span>: error<font></font>
})<font></font>
<font></font>
type FetchAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>,<font></font>
<font></font>
type SuccessAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>,
    <span class="hljs-attr">payload</span>: Task<font></font>
<font></font>
type FailAction = {<font></font>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>,
    <span class="hljs-attr">payload</span>: <span class="hljs-built_in">Error</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There is TypeScript for this </font></font><code>ReturnType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- it gets the return value from the function:</font></font><pre><code class="javascript hljs">type FetchAction = ReturnType&lt;<span class="hljs-keyword">typeof</span> createFetch&gt;</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In it we pass the type of function. </font><font style="vertical-align: inherit;">We simply cannot write a function: to take a type from a function or variable, we need to write </font></font><code>typeof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We see in the tips </font></font><code>type: string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/6w/n0/tq/6wn0tq3zjhnnoqvjrk0saubafak.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is bad - the discriminator will break because there is an object literal.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When we create an object in JavaScript, it is mutable by default. </font><font style="vertical-align: inherit;">This means that in an object with a field and a string, we can later change the string to another. </font><font style="vertical-align: inherit;">Therefore, TypeScript extends a specific string to any string for mutable objects. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We need to help TypeScript somehow. </font><font style="vertical-align: inherit;">There is as const for this.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">( )</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Add - string will disappear immediately in the prompts. </font><font style="vertical-align: inherit;">We can write this not only across the line, but in general the entire literal.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">( )</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Then the type (and all fields) will become readonly.</font></font><br>
<br>
<pre><code class="javascript hljs">type FetchAction = {<font></font>
    readonly type: <span class="hljs-string">"TASK_FETCH"</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is useful because you are unlikely to change the mutability of your action. </font><font style="vertical-align: inherit;">Therefore, we add as const everywhere.</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFetch = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FETCH"</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSuccess = <span class="hljs-function">(<span class="hljs-params">task: Task</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_SUCCESS"</span>
    <span class="hljs-attr">payload</span>: Task<font></font>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createFail = <span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"TASK_FAIL"</span>
    <span class="hljs-attr">payload</span>: error<font></font>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>)<font></font>
<font></font>
type Actions =<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createFetch&gt;<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createSuccess&gt;<font></font>
    | ReturnType&lt;<span class="hljs-keyword">typeof</span> createFail&gt;<font></font>
<font></font>
type State =<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>; task: Task }<font></font>
    | { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>; error: <span class="hljs-built_in">Error</span> }<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = (state: State, <span class="hljs-attr">action</span>: Actions): State = &gt; {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
  <span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
  <span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All actions typing code has been reduced and added as const. </font><font style="vertical-align: inherit;">TypeScript understood everything else. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TypeScript can </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">output State</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It is represented by the union in the code above with three possible states of isFetching: true, false, or Task. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use type State = ReturnType. </font><font style="vertical-align: inherit;">TypeScript prompts indicate that there is a circular dependency. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ve/jk/vu/vejkvuzbnzraxku1y7yfm5qefhu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Shorten.</font></font><br>
<br>
<pre><code class="javascript hljs">type State = ReturnType&lt;<span class="hljs-keyword">typeof</span> taskReducer&gt;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = <span class="hljs-function">(<span class="hljs-params">state, action: Actions</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
<span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br>
<code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stopped cursing, but now he is </font></font><code>any</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, because we have a cyclical dependence. </font><font style="vertical-align: inherit;">We type the argument.</font></font><br>
<br>
<pre><code class="javascript hljs">type State = ReturnType&lt;<span class="hljs-keyword">typeof</span> taskReducer&gt;<font></font>
<font></font>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> taskReducer = <span class="hljs-function">(<span class="hljs-params">state: { isFetching: <span class="hljs-literal">true</span> }, action: Actions</span>) =&gt;</span> {
    <span class="hljs-keyword">switch</span> (action.type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FETCH"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">true</span> }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_SUCCESS"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">task</span>: action.payload }
        <span class="hljs-keyword">case</span> <span class="hljs-string">"TASK_FAIL"</span>:
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">isFetching</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: action.payload }<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">const</span> _exhaustiveCheck: never = action<font></font>
<font></font>
<span class="hljs-keyword">return</span> state<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The conclusion is ready. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/i-/7f/mt/i-7fmtcvakp9l6ldfo98cqxfbwy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The conclusion is similar to what we had originally: </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Task</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There are garbage fields here </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but with the type </font></font><code>undefined</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- the field seems to be there, but it seems not.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fourth tip</font></font></h2><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not overwork.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you relax and dive too deeply, there may not be enough oxygen to go back. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The training also: if you are too immersed in the technology and decide to apply it everywhere, then most likely you will encounter errors, the reasons for which you do not know. </font><font style="vertical-align: inherit;">This will cause rejection and will no longer want to use static types. </font><font style="vertical-align: inherit;">Try to evaluate your strength.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How TypeScript Slows Development</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It will take some time to support typing. </font><font style="vertical-align: inherit;">It does not have the best UX - sometimes it gives completely incomprehensible errors, like any other type system, like in Flow or Haskell.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The more expressive the system, the more difficult the error.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The value of the type system is that it provides quick feedback when errors occur. The system will display errors and take less time to find and correct them. If you spend less time correcting errors, then more architectural solutions will receive more attention. Types do not slow down development if you learn to work with them.</font></font><br>
<br>
<blockquote>              <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">++</a>.  -  ,   ,        (25  26 )  -      (27  ‚Äî 10 ). <br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">  </a>   (5900  ),  ++            IT-,    . <br>
<br>
    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">AvitoTech</a>  FrontendConf 2019    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">youtube-</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="></a>  telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">@FrontendConfChannel</a>,       . </blockquote></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499624/index.html">Ansible Tools Overview</a></li>
<li><a href="../en499626/index.html">SOA on Laravel and JSON-RPC 2.0</a></li>
<li><a href="../en499628/index.html">Development interviews: choose friends</a></li>
<li><a href="../en499630/index.html">Flutter. Spring Update 2020</a></li>
<li><a href="../en499632/index.html">Improving Google Duo Audio Quality with WaveNetEQ</a></li>
<li><a href="../en499636/index.html">React Native for the little ones. Mobile Development Experience</a></li>
<li><a href="../en499642/index.html">Pixockets: how we wrote our own network library for the game server</a></li>
<li><a href="../en499644/index.html">Robot Creation (RPA) with AutoTest Tools</a></li>
<li><a href="../en499646/index.html">5 rules for integrating UX in Agile and Scrum</a></li>
<li><a href="../en499648/index.html">‚ÄúA game designer is always a gamer‚Äù: what does a specialist do, what skills are important</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>