<!doctype html>
<html class="no-js" lang="hi">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТВЁЯП╝ ЁЯеС ЁЯдШЁЯП╛ LVM рдФрд░ matryoshka рдХреЗ рдмреАрдЪ рдХреНрдпрд╛ рдЖрдо рд╣реИ? ЁЯЫОя╕П ЁЯМЕ ЁЯСиЁЯП╝тАНЁЯЪТ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрдЪреНрдЫрд╛ рджрд┐рдиред 
 рдореИрдВ md RAID + LVM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ KVM рдХреЗ рд▓рд┐рдП рд╕рдВрдЧреНрд░рд╣рдг рдкреНрд░рдгрд╛рд▓реА рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЕрдиреБрднрд╡ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред 
 
 рдХрд╛рд░реНрдпрдХреНрд░рдо...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>LVM рдФрд░ matryoshka рдХреЗ рдмреАрдЪ рдХреНрдпрд╛ рдЖрдо рд╣реИ?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492834/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЪреНрдЫрд╛ рджрд┐рдиред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдореИрдВ md RAID + LVM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ KVM рдХреЗ рд▓рд┐рдП рд╕рдВрдЧреНрд░рд╣рдг рдкреНрд░рдгрд╛рд▓реА рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЕрдиреБрднрд╡ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реЛрдЧрд╛:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVMe SSD рд╕реЗ md RAID 1 рдмрдирд╛рдПрдБред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SATA SSD рдФрд░ рдирд┐рдпрдорд┐рдд рдбреНрд░рд╛рдЗрд╡ рд╕реЗ md RAID 6 рдмрдирд╛рдПрдБред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD RAID 1/6 рдкрд░ TRIM / DISCARD рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рд╕реНрдХ рдХреЗ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрдЯ рдкрд░ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп md RAID 1/6 рд╕рд░рдгреАред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ BIOS рдореЗрдВ рдХреЛрдИ NVMe рд╕рдорд░реНрдерди рдирд╣реАрдВ рд╣реИ, рддреЛ NVMe RAID 1 рдкрд░ рд╕рд┐рд╕реНрдЯрдо рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM рдХреИрд╢ рдФрд░ LVM рдкрддрд▓реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BTRFS рд╕реНрдиреИрдкрд╢реЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдФрд░ рдмреИрдХрдЕрдк рдХреЗ рд▓рд┐рдП рднреЗрдЬрдирд╛ / рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BTRFS рд╢реИрд▓реА рдмреИрдХрдЕрдк рдХреЗ рд▓рд┐рдП LVM рдкрддрд▓реЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдФрд░ thin_delta рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд░ рджрд┐рд▓рдЪрд╕реНрдкреА рд╣реИ, рддреЛ рдХреГрдкрдпрд╛, рдмрд┐рд▓реНрд▓реА рдХреЗ рдиреАрдЪреЗред</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдпрд╛рди</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдЦрдХ рдЗрд╕ рд▓реЗрдЦ рд╕реЗ рд╕рд╛рдордЧреНрд░реА / рдЙрджрд╛рд╣рд░рдг / рдХреЛрдб / рдЯрд┐рдкреНрд╕ / рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдпрд╛ рди рдХрд░рдиреЗ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░реА рдирд╣реАрдВ рдЙрдард╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдкрдврд╝рдиреЗ рдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ, рдЖрдк рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рднреА рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд▓реЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдВрднрд╛рд╡рд┐рдд рдкрд░рд┐рдгрд╛рдореЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд░рд┐рд╕реНрдкреА рдлреНрд░рд╛рдЗрдб NVMe SSDред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрди рдФрд░ рдПрд╕рдПрд╕рдбреА рдбреНрд░рд╛рдЗрд╡ рдХреА рд╡рд┐рдлрд▓рддрд╛ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреИрдХрдЕрдк рд╕рд╣рд┐рдд рд╕рднреА рдбреНрд░рд╛рдЗрд╡ рдкрд░ рд╕рднреА рдбреЗрдЯрд╛ рдХрд╛ рдкреВрд░реНрдг рдиреБрдХрд╕рд╛рдиред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛрд╖рдкреВрд░реНрдг рдХрдВрдкреНрдпреВрдЯрд░ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдордп, рдирд╕реЛрдВ рдФрд░ рдкреИрд╕реЗ рдЦрд░реНрдЪ рдХрд┐рдПред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдИ рдЕрдиреНрдп рдкреНрд░рднрд╛рд╡ рдКрдкрд░ рд╕реВрдЪреАрдмрджреНрдз рдирд╣реАрдВ рд╣реИред</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЛрд╣рд╛</font></font></h2><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреЙрдХ рдореЗрдВ рдерд╛:</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдорджрд░рдмреЛрд░реНрдб Z87 рдЪрд┐рдкрд╕реЗрдЯ рдкрд░ рдЗрдВрдЯреЗрд▓ рдХреЛрд░ i7 / рд╣реИрд╕рд╡реЗрд▓ рдХреЗ рд╕рд╛рде 2013 рдХреЗ рдЖрд╕рдкрд╛рд╕ рд╣реИред</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реАрдкреАрдпреВ 4 рдХреЛрд░, 8 рдзрд╛рдЧреЗ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DDR3 рд░реИрдо рдХреЗ 32 рдЧреАрдЧрд╛рдмрд╛рдЗрдЯ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 x 16 рдпрд╛ 2 x 8 PCIe 3.0</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 x 4 + 1 x 1 PCIe 2.0</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6 x 6 рдЬреАрдмреАрдкреАрдПрд╕ рдПрд╕рдПрдЯреАрдП 3 рдХрдиреЗрдХреНрдЯрд░ </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SAS рдПрдбрд╛рдкреНрдЯрд░ LSI SAS9211-8I IT / HBA рдореЛрдб рдореЗрдВ рдЪрд▓рд╛ рдЧрдпрд╛ред </font><font style="vertical-align: inherit;">RAID- рд╕рдХреНрд╖рдо рдлрд░реНрдорд╡реЗрдпрд░ рдХреЛ рдЬрд╛рдирдмреВрдЭрдХрд░ HBA рдлрд░реНрдорд╡реЗрдпрд░ рдХреЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рднреА рд╕рдордп рдЗрд╕ рдПрдбреЙрдкреНрдЯрд░ рдХреЛ рдлреЗрдВрдХрдирд╛ рд╕рдВрднрд╡ рдерд╛ рдФрд░ рдЗрд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдХреЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TRIM / рдбрд┐рд╕реНрдХрд░реНрдб рдиреЗ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдбрд┐рд╕реНрдХ рдкрд░ рдХрд╛рдо рдХрд┐рдпрд╛, рдЬреИрд╕рд╛ рдХрд┐ </font><font style="vertical-align: inherit;">RAID рдлрд░реНрдорд╡реЗрдпрд░ рдореЗрдВ, рдпреЗ рдХрдорд╛рдВрдб рдмрд┐рд▓реНрдХреБрд▓ рднреА рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИрдВ, рдФрд░ HBA, рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ, рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдмрд╕ рдореЗрдВ рдХреНрдпрд╛ рдХрдорд╛рдВрдб рднреЗрдЬрдиреА рд╣реИред</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ - рд▓реИрдкрдЯреЙрдк рдХреЗ рд▓рд┐рдП рдлреЙрд░реНрдо рдлреИрдХреНрдЯрд░ 2.5 рдореЗрдВ 1 рдЯреАрдмреА рдХреА рдорд╛рддреНрд░рд╛ рдХреЗ рд╕рд╛рде рдПрдЪрдЬреАрдПрд╕рдЯреА рдЯреНрд░реИрд╡рд▓рд╕реНрдЯрд╛рд░ 7 рдХреЗ 1000 рдХреЗ 8 рдЯреБрдХрдбрд╝реЗред </font><font style="vertical-align: inherit;">рдпреЗ рдбреНрд░рд╛рдЗрд╡ рдкрд╣рд▓реЗ рдПрдХ RAID 6 рд╕рд░рдгреА рдореЗрдВ рдереЗред </font><font style="vertical-align: inherit;">рдирдИ рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ, рд╡реЗ рднреА рдЖрд╡реЗрджрди рдкрд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╕реНрдерд╛рдиреАрдп рдмреИрдХрдЕрдк рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдпрд╣ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛:</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SATA SSD рдореЙрдбрд▓ рд╕реИрдорд╕рдВрдЧ 660 QVO 2TB рдХреЗ 6 рдЯреБрдХрдбрд╝реЗред </font><font style="vertical-align: inherit;">рдЗрди SSD рдХреЛ рдПрдХ рдмрдбрд╝реА рд░рд╛рд╢рд┐, рдПрдХ SLC рдХреИрд╢ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рд╡рд╛рдВрдЫрдиреАрдп рдФрд░ рдХрдо рдХреАрдордд рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдирд┐рд╡рд╛рд░реНрдп рдХреЛ рддреНрдпрд╛рдЧ / рд╢реВрдиреНрдп рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдерд╛ рдЬрд┐рд╕реЗ dmesg рдореЗрдВ рдПрдХ рд▓рд╛рдЗрди рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪрд╛ рдЧрдпрд╛ рд╣реИ: </font></font><br>
<br>
<code>kernel: ata1.00: Enabling discard_zeroes_data</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NVMe SSD рдореЙрдбрд▓ рд╕реИрдорд╕рдВрдЧ SSD 970 EVO 500GB рдХреЗ 2 рдЯреБрдХрдбрд╝реЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрди SSDs рдХреЗ рд▓рд┐рдП, рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдкрдврд╝рдиреЗ / рд▓рд┐рдЦрдиреЗ рдХреА рдЧрддрд┐ рдФрд░ рдЖрдкрдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрд╕рд╛рдзрди рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рд░реЗрдбрд┐рдПрдЯрд░ред </font><font style="vertical-align: inherit;">рдЕрдирд┐рд╡рд╛рд░реНрдпред </font><font style="vertical-align: inherit;">рдмрд┐рд▓рдХреБрд▓ рдЬрд░реВрд░реАред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЙрдиреНрд╣реЗрдВ рдкрд╣рд▓реЗ рд░рд╡рд╛ рддреБрд▓реНрдпрдХрд╛рд▓рди рдХреЗ рджреМрд░рд╛рди рдХреБрд░рдХреБрд░рд╛ рд╣реЛрдиреЗ рддрдХ рднреВрдиреЗрдВред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PCIT 3.0 8x рд╕реНрд▓реЙрдЯ рдХреЗ рд╕рд╛рде 2 x NVMe SSDs рдХреЗ рд▓рд┐рдП рд╕реНрдЯрд╛рд░рдЯреЗрдХ PEX8M2E2 рдПрдбреЙрдкреНрдЯрд░ред рдпрд╣, рдлрд┐рд░ рд╕реЗ, рд╕рд┐рд░реНрдл рдПрдЪрдмреАрдП рд╣реИ, рд▓реЗрдХрд┐рди рдПрдирд╡реАрдПрдордИ рдХреЗ рд▓рд┐рдПред рдпрд╣ рдПрдХ рдПрдХреАрдХреГрдд PCIe рд╕реНрд╡рд┐рдЪ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдХрд╛рд░рдг рдорджрд░рдмреЛрд░реНрдб рд╕реЗ PCIe рджреНрд╡рд┐рднрд╛рдЬрди рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдЕрднрд╛рд╡ рдореЗрдВ рд╕рд╕реНрддреЗ рдПрдбреЗрдкреНрдЯрд░ рд╕реЗ рдЕрд▓рдЧ рд╣реИред рдпрд╣ рд╕рдмрд╕реЗ рдкреБрд░рд╛рдиреА рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рднреА рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдЬрд╣рд╛рдВ PCIe рд╣реИ, рднрд▓реЗ рд╣реА рдпрд╣ X1 PCIe 1.0 рд╕реНрд▓реЙрдЯ рд╣реЛред рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдЙрдЪрд┐рдд рдЧрддрд┐ рдХреЗ рд╕рд╛рдеред рд╡рд╣рд╛рдБ рдХреЛрдИ RAID рд╣реИрдВред рдмреЛрд░реНрдб рдкрд░ рдХреЛрдИ рдПрдХреАрдХреГрдд BIOS рдирд╣реАрдВ рд╣реИред рддреЛ, рдЖрдкрдХрд╛ рд╕рд┐рд╕реНрдЯрдо NVMe рд╕реЗ рдмреВрдЯ рдХрд░рдирд╛ рдирд╣реАрдВ рд╕реАрдЦреЗрдЧрд╛, рдЗрд╕ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд▓рд┐рдП NVMe RAID рдзрдиреНрдпрд╡рд╛рдж рдмрд╣реБрдд рдХрдо рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рдШрдЯрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдореБрдлреНрдд 8x PCIe 3.0 рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рдерд╛, рдФрд░ 2 рдореБрдлреНрдд рд╕реНрд▓реЙрдЯ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рджреЛ рд╕рд╕реНрддреЗ PEX4M2E1 рдпрд╛ рдПрдирд╛рд▓реЙрдЧреНрд╕ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ 600 рд░реВрдмрд▓ рдХреА рдХреАрдордд рдкрд░ рдХрд╣реАрдВ рднреА рдЦрд░реАрджрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрд╕рдПрд╕рдбреА / рдПрдЪрдбреАрдбреА рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде, рдкреВрд░реЗ рдбреЗрдЯрд╛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрджрд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдпрд╛ рдПрдХреАрдХреГрдд RAID рдЪрд┐рдкрд╕реЗрдЯ / BIOS рдХреЗ рдЕрд╕реНрд╡реАрдХреГрддрд┐ рдХреЛ рдЬрд╛рдирдмреВрдЭрдХрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕рд╕реЗ рд╕рднреА рдбреЗрдЯрд╛ рдХреА рдмрдЪрдд рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирдП / рдЕрд▓рдЧ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдореЗрдВ рдЬрд╛рдиреЗ рдкрд░ рднреА рд╕реНрдерд╛рдкрд┐рдд рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд░рдЦрдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ SATA рдФрд░ PCIe рдкреЛрд░реНрдЯ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд▓рд╛рдЗрд╡ рд╕реАрдбреА рдпрд╛ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдлреНрд▓реИрд╢ рдбреНрд░рд╛рдЗрд╡ рдХреА рддрд░рд╣ рд╣реИ, рдХреЗрд╡рд▓ рдмрд╣реБрдд рддреЗрдЬрд╝ рдФрд░ рдереЛрдбрд╝рд╛ рдУрд╡рд░рд╕рд╛рдЗрдЬрд╝реНрдб рд╣реИред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд╕реНрдп</font></font></b><div class="spoiler_text"> ,   , тАФ          .     .            5.25  .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдареАрдХ рд╣реИ, рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рдПрд╕рдПрд╕рдбреА рдХреИрд╢рд┐рдВрдЧ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдЫрд╛рдкреЗ, рдпрд╣ рдЙрдмрд╛рдК рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд╛рд▓реВ рдХрд░реЛред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдФрд░ mdadm рдХреЗ рд╕рд╛рде рд╣рдореЗрд╢рд╛ рд╡рд┐рдХрд▓реНрдк рд╣реЛрддреЗ рд╣реИрдВред</font></font></blockquote><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрд▓рд╛рдпрдо</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ, рдбреЗрдмрд┐рдпрди 8 рдЬреЗрд╕реА рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рдИрдУрдПрд▓ рдХреЗ рдХрд░реАрдм рд╣реИред </font><font style="vertical-align: inherit;">рдКрдкрд░ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд HDD рд╕реЗ RAID 6 рдХреЛ LVM рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ kvm / libvirt рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдЪрд▓рд╛ рд░рд╣рд╛ рдерд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪреВрдВрдХрд┐ </font><font style="vertical-align: inherit;">рд▓реЗрдЦрдХ рдХреЛ рдкреЛрд░реНрдЯреЗрдмрд▓ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп SATA / NVMe рдлреНрд▓реИрд╢ рдбреНрд░рд╛рдЗрд╡ рдмрдирд╛рдиреЗ рдореЗрдВ рдЙрдкрдпреБрдХреНрдд рдЕрдиреБрднрд╡ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рд╛рдорд╛рдиреНрдп рдПрдк-рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рдлрд╛рдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдЙрдмрдВрдЯреВ 18.04 рдХреЛ рд▓рдХреНрд╖реНрдп рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд░реВрдк рдореЗрдВ рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛, рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рд╕реНрдерд┐рд░ рд╣реЛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рднрд╡рд┐рд╖реНрдп рдореЗрдВ 3 рд╕рд╛рд▓ рдХрд╛ рд╕рдорд░реНрдерди рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рд╕рднреА рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдбреНрд░рд╛рдЗрд╡рд░ рд╣реИрдВ рдЬрд┐рдирдХреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдХрд┐рд╕реА рднреА рддреГрддреАрдп-рдкрдХреНрд╖ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдФрд░ рдбреНрд░рд╛рдЗрд╡рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдерд╛рдкрдирд╛ рдХреА рддреИрдпрд╛рд░реА</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрдмрдВрдЯреВ рдбреЗрд╕реНрдХрдЯреЙрдк рдЗрдореЗрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд░реНрд╡рд░ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЬреЛрд░рджрд╛рд░ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рд╣реИрдВ рдЬреЛ рдЕрддреНрдпрдзрд┐рдХ, рдЧреИрд░-рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╕реНрд╡рддрдВрддреНрд░рддрд╛ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рддреЗ рд╣реИрдВ, рд╣рдореЗрд╢рд╛ рдпреВрдИрдПрдлрдЖрдИ рд╕рд┐рд╕реНрдЯрдо рд╡рд┐рднрд╛рдЬрди рдХреЛ рдзрдХреНрдХрд╛ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рд╕рднреА рд╕реМрдВрджрд░реНрдп рдХреЛ рдЦрд░рд╛рдм рдХрд░ рд░рд╣реЗ рдбрд┐рд╕реНрдХ рдореЗрдВ рд╕реЗ рдПрдХ рдкрд░ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддрджрдиреБрд╕рд╛рд░, рдпрд╣ рдХреЗрд╡рд▓ рдпреВрдИрдПрдлрдЖрдИ рдореЛрдб рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╣рдореЗрдВ рд╢реЛрднрд╛ рдирд╣реАрдВ рджреЗрддрд╛ред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВ?</font></font></b><div class="spoiler_text"> , UEFI        RAID, ..   UEFI ESP     .    ,    ESP     USB , ,   .      mdadm RAID 1    0.9    UEFI BIOS   , ,       BIOS       -  ESP     .<br>
<br>
 ,  UEFI   NVRAM,         , ..    .<br>
<br>
 ,      .     ,       Legacy/BIOS boot,    CSM  UEFI- .      , ,      .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрдмрдВрдЯреВ рдХреЗ рдбреЗрд╕реНрдХрдЯреЙрдк рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдпрд╣ рднреА рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рд▓рд┐рдЧреЗрд╕реА рдмреВрдЯрд▓реЛрдбрд░ рдХреЗ рд╕рд╛рде рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдХреИрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╡реЗ рдХрд╣рддреЗ рд╣реИрдВ, рдХрдо рд╕реЗ рдХрдо рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдФрд░ рдЗрд╕рд▓рд┐рдП, рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдВ рдФрд░ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдЙрдмрдВрдЯреВ рд▓рд╛рдЗрд╡ рдлреНрд▓реИрд╢ рдбреНрд░рд╛рдЗрд╡ рд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд▓реЛрдб рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдкреИрдХреЗрдЬ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛, рдЬрд┐рд╕рдиреЗ рдЖрдкрдХреЛ рдЕрд░реНрдЬрд┐рдд рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЕрдЧреНрд░рд┐рдо рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдкреИрдХреЗрдЬ рдХреЛ USB рдлреНрд▓реИрд╢ рдбреНрд░рд╛рдЗрд╡ рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдбреЗрд╕реНрдХрдЯреЙрдк рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЬрд╛рддреЗ рд╣реИрдВ, рдЯрд░реНрдорд┐рдирд▓ рдПрдореБрд▓реЗрдЯрд░ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рдФрд░ рдЪрд▓рддреЗ рд╣реИрдВ:</font></font><br>
<br>
<code>#sudo bash</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕ рддрд░рд╣...?</font></font></b><div class="spoiler_text">       sudo.  <b></b>    <b></b> .   ,       .     sudo   ,     . :<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/W-tPTmdnc7E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
</div></div><br>
<code>#apt-get install mdadm lvm2 thin-provisioning-tools btrfs-tools util-linux lsscsi nvme-cli mc</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZFS рдХреНрдпреЛрдВ рдирд╣реАрдВ ...?</font></font></b><div class="spoiler_text">       , тАФ  ,         . <br>
        , тАФ        ,   -  .<br>
<br>
    ZFS тАФ  ,  mdadm+lvm    .<br>
<br>
           .      .   .  .  .  .      ,       . <br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ BTRFS рдХреНрдпреЛрдВ ...?</font></font></b><div class="spoiler_text">            Legacy/BIOS GRUB  , ,  ,   -.      /boot .  ,       / ()   ,           LVM     . <br>
<br>
   ,          .<br>
                       send/recieve.<br>
<br>
 ,                        GPU  PCI-USB Host-  KVM  IOMMU.<br>
<br>
    тАФ  ,    .<br>
<br>
    ZFS, ,  ,     .<br>
<br>
  ,       / RAID      ZFS, BRTFS  LVM.<br>
<br>
   , BTRFS       ,         /    HDD.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рднреА рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рдкреБрдирдГ рд╕реНрдХреИрди рдХрд░реЗрдВ: рдЖрдЗрдП рдЪрд╛рд░реЛрдВ рдУрд░ рджреЗрдЦреЗрдВ </font></font><br>
<br>
<code>#udevadm control --reload-rules &amp;&amp; udevadm trigger</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
:</font></font><br>
<br>
<code>#lsscsi &amp;&amp; nvme list<br>
[0:0:0:0] disk ATA Samsung SSD 860 2B6Q /dev/sda <br>
[1:0:0:0] disk ATA Samsung SSD 860 2B6Q /dev/sdb <br>
[2:0:0:0] disk ATA Samsung SSD 860 2B6Q /dev/sdc <br>
[3:0:0:0] disk ATA Samsung SSD 860 2B6Q /dev/sdd <br>
[4:0:0:0] disk ATA Samsung SSD 860 2B6Q /dev/sde <br>
[5:0:0:0] disk ATA Samsung SSD 860 2B6Q /dev/sdf <br>
[6:0:0:0] disk ATA HGST HTS721010A9 A3J0 /dev/sdg <br>
[6:0:1:0] disk ATA HGST HTS721010A9 A3J0 /dev/sdh <br>
[6:0:2:0] disk ATA HGST HTS721010A9 A3J0 /dev/sdi <br>
[6:0:3:0] disk ATA HGST HTS721010A9 A3B0 /dev/sdj <br>
[6:0:4:0] disk ATA HGST HTS721010A9 A3B0 /dev/sdk <br>
[6:0:5:0] disk ATA HGST HTS721010A9 A3B0 /dev/sdl <br>
[6:0:6:0] disk ATA HGST HTS721010A9 A3J0 /dev/sdm <br>
[6:0:7:0] disk ATA HGST HTS721010A9 A3J0 /dev/sdn <br>
Node SN Model Namespace Usage Format FW Rev <br>
---------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------<br>
/dev/nvme0n1 S466NXXXXXXX15L Samsung SSD 970 EVO 500GB 1 0,00 GB / 500,11 GB 512 B + 0 B 2B2QEXE7<br>
/dev/nvme1n1 S5H7NXXXXXXX48N Samsung SSD 970 EVO 500GB 1 0,00 GB / 500,11 GB 512 B + 0 B 2B2QEXE7<br>
</code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рднрд╛рдЬрди "рдбреНрд░рд╛рдЗрд╡"</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдирд╡реАрдПрдордИ рдПрд╕рдПрд╕рдбреА</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЪрд┐рдиреНрд╣рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╕рднреА рд╕рдорд╛рди, рд╣рдорд╛рд░реЗ BIOS рдЗрди рдбреНрд░рд╛рдЗрд╡ рдХреЛ рдирд╣реАрдВ рджреЗрдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рддреЛ, рд╡реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ RAID рдореЗрдВ рдЬрд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо рд╡рд╣рд╛рдВ рд╡рд┐рднрд╛рдЬрди рднреА рдирд╣реАрдВ рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк "рдХреИрдирди" рдпрд╛ "рд╕рд┐рджреНрдзрд╛рдВрдд" рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЪрд╛рд╣рддреЗ рд╣реИрдВ - рдПрдХ рдмрдбрд╝рд╛ рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдПрдВ, рдЬреИрд╕реЗ рдХрд┐ рдПрдЪрдбреАрдбреАред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SATA HDD</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЦрд╛рд╕ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рд╣рд░ рдЪреАрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрдХреНрд╢рди рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо рдЕрдиреБрднрд╛рдЧ рдмрдирд╛рдПрдВрдЧреЗ рдХреНрдпреЛрдВрдХрд┐ BIOS рдЗрди рдбрд┐рд╕реНрдХ рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЙрдирд╕реЗ рдмреВрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рднреА рдХрд░ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрди рдбрд┐рд╕реНрдХ рдкрд░ рдмрд╛рдж рдореЗрдВ GRUB рднреА рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдЕрдЪрд╛рдирдХ рд╕рдлрд▓ рд╣реЛ рдЬрд╛рдПред</font></font><br>
<br>
<code>#cat &gt;hdd.part &lt;&lt; EOF<br>
label: dos<br>
label-id: 0x00000000<br>
device: /dev/sdg<br>
unit: sectors<br>
<br>
/dev/sdg1 : start= 2048, size= 1953523120, type=fd, bootable<br>
EOF<br>
#sfdisk /dev/sdg &lt; hdd.part<br>
#sfdisk /dev/sdh &lt; hdd.part<br>
#sfdisk /dev/sdi &lt; hdd.part<br>
#sfdisk /dev/sdj &lt; hdd.part<br>
#sfdisk /dev/sdk &lt; hdd.part<br>
#sfdisk /dev/sdl &lt; hdd.part<br>
#sfdisk /dev/sdm &lt; hdd.part<br>
#sfdisk /dev/sdn &lt; hdd.part<br>
</code><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SATA SSD</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 2 рдЯреАрдмреА рдбреНрд░рд╛рдЗрд╡ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдордмреАрдЖрд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдордд рд╕реАрдорд╛ рдХреЗ рднреАрддрд░ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╣рдо рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ GPT рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">GPT рдбрд┐рд╕реНрдХ рдореЗрдВ рдПрдХ рд╕рдВрдЧрддрддрд╛ рдкрд░рдд рд╣реЛрддреА рд╣реИ рдЬреЛ рдПрдордмреАрдЖрд░-рд╕рдВрдЧрдд рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдкрд╣рд▓реЗ 4 рд╡рд┐рднрд╛рдЬрдиреЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдпрджрд┐ рд╡реЗ рдкрд╣рд▓реЗ 2 рдЧреАрдЧрд╛рдмрд╛рдЗрдЯ рдХреЗ рднреАрддрд░ рд╕реНрдерд┐рдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдЗрди рдбрд┐рд╕реНрдХ рдкрд░ рдмреВрдЯ рд╡рд┐рднрд╛рдЬрди рдФрд░ bios_grub рд╡рд┐рднрд╛рдЬрди рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдкрдХреЛ GPT рд▓реАрдЧреЗрд╕реА / BIOS рдбреНрд░рд╛рдЗрд╡ рд╕реЗ рдмреВрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд▓реЗрдХрд┐рди, рдпрд╣ рд╣рдорд╛рд░рд╛ рдорд╛рдорд▓рд╛ рдирд╣реАрдВ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рд╣рдо рджреЛ рд╕реЗрдХреНрд╢рди рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ рдЖрдХрд╛рд░ 1 GB рд╣реЛрдЧрд╛ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ RAID 1 / рдмреВрдЯ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рджреВрд╕рд░реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ RAID 6 рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдбреНрд░рд╛рдЗрд╡ рдХреЗ рдЕрдВрдд рдореЗрдВ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЕрдирдЕрд▓реЛрдХреЗрдЯреЗрдб рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде рд╢реЗрд╖ рд╕рднреА рдЦрд╛рд▓реА рд╕реНрдерд╛рди рд▓реЗ рд▓реЗрдВрдЧреЗред</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕рд┐рдВрдЪрд┐рдд рдХреНрд╖реЗрддреНрд░ рдХреНрдпрд╛ рд╣реИ?</font></font></b><div class="spoiler_text">     SATA SSD      SLC    6  78 . 6    ┬л┬╗     ┬л┬╗  ┬л┬╗   .  72      . <br>
<br>
  ,     SLC,      4 bit MLC.     ,    4       1  SLC .<br>
<br>
 72   4   288 .           ,       SLC .<br>
<br>
 ,     312  SLC     .    2    RAID  .<br>
<br>
            ,      .        QLC , тАФ          .      , ,       ,    SSD     TBW  .<br>
</div></div><br>
<code>#cat &gt;ssd.part &lt;&lt; EOF<br>
label: dos<br>
label-id: 0x00000000<br>
device: /dev/sda<br>
unit: sectors<br>
<br>
/dev/sda1 : start= 2048, size= 2097152, type=fd, bootable<br>
/dev/sda2 : start= 2099200, size= 3300950016, type=fd<br>
EOF<br>
#sfdisk /dev/sda &lt; ssd.part<br>
#sfdisk /dev/sdb &lt; ssd.part<br>
#sfdisk /dev/sdc &lt; ssd.part<br>
#sfdisk /dev/sdd &lt; ssd.part<br>
#sfdisk /dev/sde &lt; ssd.part<br>
#sfdisk /dev/sdf &lt; ssd.part<br>
</code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд░реЗ рдмрдирд╛рдирд╛</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдХрд╛рд░ рдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣реЛрд╕реНрдЯ рдирд╛рдо mdadm рдХреЗ рдЕрдВрджрд░ рдХрд╣реАрдВ рд╕рд░рдгреА рдирд╛рдо рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдФрд░ рдХрд╣реАрдВ рдкрд░ рдХреБрдЫ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдмрд╛рдж рдореЗрдВ рдирд╛рдо рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди, рдпреЗ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХреНрд░рд┐рдпрд╛рдПрдВ рд╣реИрдВред</font></font><br>
<br>
<code>#mcedit /etc/hostname <br>
#mcedit /etc/hosts<br>
#hostname<br>
vdesk0<br>
</code><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдирд╡реАрдПрдордИ рдПрд╕рдПрд╕рдбреА</font></font></h4><br>
<code>#mdadm --create --verbose --assume-clean /dev/md0 --level=1 --raid-devices=2 /dev/nvme[0-1]n1</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВ - рд╕рд╛рдл-рд╕реБрдерд░рд╛ ...?</font></font></b><div class="spoiler_text">   .    RAID 1  6  .      ,    .  ,   SSD   тАФ     TBW.   TRIM/DISCARD      SSD   ┬л┬╗.<br>
<br>
  SSD RAID 1 DISCARD   .<br>
<br>
  SSD RAID 6 DISCARD      . <br>
<br>
      ,    SSD     4/5/6       discard_zeroes_data.    ,       , , -,  ,     .       , ,       .     DISCARD -   RAID 6.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдзреНрдпрд╛рди рджреЗрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб NVMe рдбреНрд░рд╛рдЗрд╡ рдХреЗ рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ "рд╢реВрдиреНрдп" рдХреЗ рд╕рд╛рде рд╕рд░рдгреА рдХреЛ "рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝" рдХрд░рдХреЗ рдирд╖реНрдЯ рдХрд░ рджреЗрдЧрд╛ред </font></font><br>
<br>
<code>#blkdiscard /dev/md0</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд░ рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖ рд╣реИ, рддреЛ рдПрдХ рдХрджрдо рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред</font></font><br>
<br>
<code>#blkdiscard --step 65536 /dev/md0</code><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SATA SSD</font></font></h4><br>
<code>#mdadm --create --verbose --assume-clean /dev/md1 --level=1 --raid-devices=6 /dev/sd[a-f]1</code><br>
<code>#blkdiscard /dev/md1</code><br>
<code>#mdadm --create --verbose --assume-clean /dev/md2 --chunk-size=512 --level=6 --raid-devices=6 /dev/sd[a-f]2</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрддрдирд╛ рдмрдбрд╝рд╛ рдХреНрдпреЛрдВ ...?</font></font></b><div class="spoiler_text"> chunk-size         chunk-size .   ,              . , IOPS    .   99% IO   512K.<br>
<br>
 RAID 6 IOPS   <b></b>    IOPS   .      IOPS          ,       . <br>
           RAID 6 by-design     ,   RAID 6   .<br>
   RAID 6      NVMe    thin-provisioning.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдордиреЗ RAID 6 рдХреЗ рд▓рд┐рдП рдЕрднреА рддрдХ DISCARD рдХреЛ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЕрднреА рдЗрд╕ рд╕рд░рдгреА рдХреЛ "рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝" рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдУрдПрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЗрд╕реЗ рдмрд╛рдж рдореЗрдВ рдХрд░реЗрдВрдЧреЗред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SATA HDD</font></font></h4><br>
<code>#mdadm --create --verbose --assume-clean /dev/md3 --chunk-size=512 --level=6 --raid-devices=8 /dev/sd[g-n]1</code><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVMe RAID рдкрд░ LVM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЧрддрд┐ рдХреЗ рд▓рд┐рдП, рд╣рдо рдореВрд▓ FS рдХреЛ NVMe RAID 1 рдкрд░ рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐ / dev / md0 рд╣реИред </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдлрд┐рд░ рднреА, рд╣рдореЗрдВ рдЕрдиреНрдп рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕ рддреЗрдЬрд╝ рд╕рд░рдгреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рд╕реНрд╡реИрдк, рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдФрд░ рдПрд▓рд╡реАрдПрдо-рдХреИрд╢ рдФрд░ рдПрд▓рд╡реАрдПрдо-рдкрддрд▓реА рдореЗрдЯрд╛рдбреЗрдЯрд╛, рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рд╕рд░рдгреА рдкрд░ рд╣рдо рдПрд▓рд╡реАрдПрдо рд╡реАрдЬреА рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">
рд░реВрдЯ FS рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдПрдБред </font><font style="vertical-align: inherit;">
RAM рдХрд╛ рдЖрдХрд╛рд░ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрднрд╛рдЧ рдмрдирд╛рдПрдБред</font></font><br>
<br>
<code>#pvcreate /dev/md0<br>
#vgcreate root /dev/md0</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -L 128G --name root root</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -L 32G --name swap root</code><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдУрдПрд╕ рд╕реНрдерд╛рдкрдирд╛</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреБрд▓ рдорд┐рд▓рд╛рдХрд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╕рдм рдХреБрдЫ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЙрдмрдВрдЯреВ рд▓рд╛рдЗрд╡ рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рд╡рд┐рдЬрд╝рд╛рд░реНрдб рд▓реЙрдиреНрдЪ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд╛рдкрдирд╛ред </font><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдбреНрд░рд╛рдЗрд╡ рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рдХреЗ рдЪрд░рдг рдореЗрдВ, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / md1, - рдЖрд░реЛрд╣ рдмрд┐рдВрджреБ / рдмреВрдЯ, FS - BTRFS </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ рджреЗрд╡ / рдЬрдбрд╝ / рдЬрдбрд╝ (рдЙрд░реНрдл / рджреЗрд╡ / рдореИрдкрд░ / рд░реВрдЯ-рд░реВрдЯ), - рдЖрд░реЛрд╣ рдмрд┐рдВрджреБ / (рдЬрдбрд╝), рдПрдлрдПрд╕ - рдЖрд░рдЯреАрдЖрд░рдПрдлрдПрд╕</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ рджреЗрд╡ / рдЬрдбрд╝ / рд╕реНрд╡реИрдк (рдЙрд░реНрдл / рджреЗрд╡ / рдореИрдкрд░ / рд░реВрдЯ-рд╕реНрд╡реИрдк), - рд╕реНрд╡реИрдк рд╡рд┐рднрд╛рдЬрди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреВрдЯрд▓реЛрдбрд░ / рджреЗрд╡ / рдПрд╕рдбреАрдП рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрдк BTRFS рдХреЛ рд░реВрдЯ FS рдХреЗ рд░реВрдк рдореЗрдВ рдЪреБрдирддреЗ рд╣реИрдВ, рддреЛ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ / (рдШрд░) рдХреЗ рд▓рд┐рдП "@" рдФрд░ "@home" рдирд╛рдо рдХреЗ рд╕рд╛рде рджреЛ BTRFS рд╡реЙрд▓реНрдпреВрдо рдмрдирд╛рдПрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо рдЗрдВрд╕реНрдЯрд╛рд▓реЗрд╢рди рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрдВрд╕реНрдЯрд╛рд▓реЗрд╢рди рдмреВрдЯ рд▓реЛрдбрд░ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдПрд░рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдореЛрдбрд▓ рдбрд╛рдпрд▓реЙрдЧ рдмреЙрдХреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕ рд╕рдВрд╡рд╛рдж рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛ рдФрд░ рд╕реНрдерд╛рдкрдирд╛ рдЬрд╛рд░реА рд░рдЦрдирд╛ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдмрд╛рд╣рд░ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рд╕реЗ рд╕рд╛рдл рдЙрдмрдВрдЯреВ рд▓рд╛рдЗрд╡ рдбреЗрд╕реНрдХрдЯреЙрдк рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ, рдФрд░ рдлрд┐рд░ рд╕реЗ: </font></font><br>
<br>
<code>#sudo bash</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪреЗрд░реЛрдЯ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдЪреЗрд░реЛрдЯ рдореЗрдВ </font><font style="vertical-align: inherit;">
рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рд╣реЛрд╕реНрдЯрдирд╛рдо </font><font style="vertical-align: inherit;">рд╕реЗрдЯ </font><font style="vertical-align: inherit;">рдХрд░реЗрдВ: </font><font style="vertical-align: inherit;">
рдЪреЗрд░реЛрдЯ рдкрд░реНрдпрд╛рд╡рд░рдг рдкрд░ рдЬрд╛рдПрдВ: </font><font style="vertical-align: inherit;">
рдкрд╣рд▓реЗ рд╣рдо рдкреИрдХреЗрдЬ рд╡рд┐рддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">
рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдзреВрд░реЗ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХреЗ рдХрд╛рд░рдг рдЯреЗрдврд╝реЗ-рдореЗрдврд╝реЗ рд╕рднреА рдкреИрдХреЗрдЬреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдареАрдХ рдХрд░реЗрдВ:</font></font><br>
<br>
<code>#mkdir /mnt/chroot<br>
#mount -o defaults,space_cache,noatime,nodiratime,discard,subvol=@ /dev/mapper/root-root /mnt/chroot<br>
#mount -o defaults,space_cache,noatime,nodiratime,discard,subvol=@home /dev/mapper/root-root /mnt/chroot/home<br>
#mount -o defaults,space_cache,noatime,nodiratime,discard /dev/md1 /mnt/chroot/boot<br>
#mount --bind /proc /mnt/chroot/proc <br>
#mount --bind /sys /mnt/chroot/sys<br>
#mount --bind /dev /mnt/chroot/dev<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#cat /etc/hostname &gt;/mnt/chroot/etc/hostname<br>
#cat /etc/hosts &gt;/mnt/chroot/etc/hosts<br>
#cat /etc/resolv.conf &gt;/mnt/chroot/etc/resolv.conf<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#chroot /mnt/chroot<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>apt-get install --reinstall mdadm lvm2 thin-provisioning-tools btrfs-tools util-linux lsscsi nvme-cli mc debsums hdparm</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#CORRUPTED_PACKAGES=$(debsums -s 2&gt;&amp;1 | awk '{print $6}' | uniq)<br>
#apt-get install --reinstall $CORRUPTED_PACKAGES<br>
</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдХреБрдЫ рдПрдХ рд╕рд╛рде рдирд╣реАрдВ рдмрдврд╝рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЙрд╕рд╕реЗ рдкрд╣рд▓реЗ /etc/apt/source.list </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдВрдкрд╛рджрд┐рдд </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП TRIM / DISCARD рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП RAID 6 рдореЙрдбреНрдпреВрд▓ рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдмрджрд▓реЗрдВ: </font><font style="vertical-align: inherit;">
рдЖрдЗрдП рдЕрдкрдиреЗ рд╕рд░рдгрд┐рдпреЛрдВ рдХреЛ рдереЛрдбрд╝рд╛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░реЗрдВ:</font></font><br>
<br>
<code>#cat &gt;/etc/modprobe.d/raid456.conf &lt;&lt; EOF<br>
options raid456 devices_handle_discard_safely=1<br>
EOF<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#cat &gt;/etc/udev/rules.d/60-md.rules &lt;&lt; EOF<br>
SUBSYSTEM=="block", KERNEL=="md*", ACTION=="change", TEST=="md/stripe_cache_size", ATTR{md/stripe_cache_size}="32768"<br>
SUBSYSTEM=="block", KERNEL=="md*", ACTION=="change", TEST=="md/sync_speed_min", ATTR{md/sync_speed_min}="48000"<br>
SUBSYSTEM=="block", KERNEL=="md*", ACTION=="change", TEST=="md/sync_speed_max", ATTR{md/sync_speed_max}="300000"<br>
EOF<br>
#cat &gt;/etc/udev/rules.d/62-hdparm.rules &lt;&lt; EOF<br>
SUBSYSTEM=="block", ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/rotational}=="1", RUN+="/sbin/hdparm -B 254 /dev/%k"<br>
EOF<br>
#cat &gt;/etc/udev/rules.d/63-blockdev.rules &lt;&lt; EOF<br>
SUBSYSTEM=="block", ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/rotational}=="1", RUN+="/sbin/blockdev --setra 1024 /dev/%k"<br>
SUBSYSTEM=="block", ACTION=="add|change", KERNEL=="sd[a-z]", ATTR{queue/rotational}=="0", RUN+="/sbin/blockdev --setra 0 /dev/%k"<br>
SUBSYSTEM=="block", ACTION=="add|change", KERNEL=="nvme[0-9]n1", RUN+="/sbin/blockdev --setra 0 /dev/%k"<br>
SUBSYSTEM=="block", ACTION=="add|change", KERNEL=="dm-*", ATTR{queue/rotational}=="0", RUN+="/sbin/blockdev --setra 0 /dev/%k"<br>
SUBSYSTEM=="block", ACTION=="add|change", KERNEL=="md*", RUN+="/sbin/blockdev --setra 0 /dev/%k"<br>
<br>
EOF<br>
</code><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреНрдпрд╛ рдерд╛..?</font></font></b><div class="spoiler_text">   udev     :<br>
<br>
<ul>
<li>    2020-      RAID 6.  -, ,      Linux,     .</li>
<li>    /   IO.  ,           .</li>
<li>    /   IO.  ,  / SSD RAID-       .    NVMe. (   ?    . )</li>
<li>   APM     (HDD)         7 .    APM      (-B 255).   -      .      ,   , ,  -.       .    -        .     , , - ┬л┬╗,    -,    RAID-   mini-MAID-.</li>
<li> readahead   ()  1  тАФ   /chunk RAID 6</li>
<li> readahead  SATA SSD</li>
<li> readahead  NVMe SSD</li>
<li> readahead   LVM    SSD.</li>
<li> readahead   RAID .</li>
</ul><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ / etc / fstab:</font></font><br>
<br>
<code>#cat &gt;/etc/fstab &lt;&lt; EOF<br>
# /etc/fstab: static file system information.<br>
#<br>
# Use 'blkid' to print the universally unique identifier for a<br>
# device; this may be used with UUID= as a more robust way to name devices<br>
# that works even if disks are added and removed. See fstab(5).<br>
# file-system mount-point type options dump pass<br>
/dev/mapper/root-root / btrfs defaults,space_cache,noatime,nodiratime,discard,subvol=@ 0 1<br>
UUID=$(blkid -o value -s UUID /dev/md1) /boot btrfs defaults,space_cache,noatime,nodiratime,discard 0 2<br>
/dev/mapper/root-root /home btrfs defaults,space_cache,noatime,nodiratime,discard,subvol=@home 0 2<br>
/dev/mapper/root-swap none swap sw 0 0<br>
EOF</code><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХреНрдпреЛрдВ рд╣реИ..?</font></font></b><div class="spoiler_text"> /boot     UUID ..     .<br>
<br>
      LVM    /dev/mapper/vg-lv, ..     . <br>
<br>
  UUID  LVM .. UUID  LVM      .</div></div><div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдмрд╛рд░ рд╣рдо рдорд╛рдЙрдВрдЯ / рджреЗрд╡ / рдореИрдкрд░ / рд░реВрдЯ-рд░реВрдЯ ..?</font></font></b><div class="spoiler_text">.  .  BTRFS.         subvol.<br>
<br>
  -      LVM   BTRFS .     .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо mdadm рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд </font><font style="vertical-align: inherit;">
рдХрд░рддреЗ рд╣реИрдВ: LVM рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдареАрдХ рдХрд░реЗрдВ:</font></font><br>
<br>
<code>#/usr/share/mdadm/mkconf | sed 's/#DEVICE/DEVICE/g' &gt;/etc/mdadm/mdadm.conf<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#cat &gt;&gt;/etc/lvm/lvmlocal.conf &lt;&lt; EOF<br>
<br>
activation {<br>
 thin_pool_autoextend_threshold=90<br>
 thin_pool_autoextend_percent=5<br>
}<br>
allocation {<br>
 cache_pool_max_chunks=2097152<br>
}<br>
devices {<br>
 global_filter=["r|^/dev/.*_corig$|","r|^/dev/.*_cdata$|","r|^/dev/.*_cmeta$|","r|^/dev/.*gpv$|","r|^/dev/images/.*$|","r|^/dev/mapper/images.*$|","r|^/dev/backup/.*$|","r|^/dev/mapper/backup.*$|"]<br>
 issue_discards=1<br>
}<br>
EOF<br>
</code><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреНрдпрд╛ рдерд╛..?</font></font></b><div class="spoiler_text">     LVM thin   90%    5%  .<br>
<br>
       LVM cache.<br>
<br>
  LVM  LVM  (PV) :<br>
<br>
<ul>
<li>   LVM cache (cdata)</li>
<li>     LVM cache    (&lt;lv_name&gt;_corig).            ( &lt;lv_name&gt;).</li>
<li>    LVM cache (cmeta)</li>
<li>    VG   images.        , ,     LVM       .</li>
<li>    VG   backup.         .</li>
<li>       ┬лgpv┬╗ ( guest physical volume )</li>
</ul><br>
   DISCARD      LVM VG.  .    LV  SSD  .     SSD RAID 6. ,  ,    thin provisioning,  ,     .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Initramfs рдЫрд╡рд┐ рдЕрдкрдбреЗрдЯ </font></font><br>
<br>
<code>#update-initramfs -u -k all</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд░реЗрдВ: рдЧреНрд░рдм рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ:</font></font><br>
<br>
<code>#apt-get install grub-pc<br>
#apt-get purge os-prober<br>
#dpkg-reconfigure grub-pc</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдбреНрд░рд╛рдЗрд╡?</font></font></b><div class="spoiler_text">  sd*.         SATA   SSD.<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВ рдУрд╕-prober ..?</font></font></b><div class="spoiler_text">     . <br>
<br>
       RAID-    .      ,         .<br>
<br>
   ,   , ,    .         .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рд╕рд╛рде, рд╣рдордиреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕реНрдерд╛рдкрдирд╛ рдкреВрд░реА рдХреАред </font><font style="vertical-align: inherit;">рдпрд╣ рдирдП рд╕реНрдерд╛рдкрд┐рдд рдУрдПрд╕ рдореЗрдВ рд░рд┐рдмреВрдЯ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред </font><font style="vertical-align: inherit;">рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд▓рд╛рдЗрд╡ рд╕реАрдбреА / рдпреВрдПрд╕рдмреА рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛рдж рд░рдЦреЗрдВред </font><font style="vertical-align: inherit;">
рдмреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдХрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, SATA SSD рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХрд╛ рдЪрдпрди рдХрд░реЗрдВред</font></font><br>
<br>
<code>#exit<br>
#reboot</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM SATA SSD рдХреЛ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирдП рдУрдПрд╕ рдореЗрдВ рдмреВрдЯ рдХрд┐рдпрд╛ рд╣реИ, рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рд╣реИ, рдЙрдкрдпреБрдХреНрдд, рдЯрд░реНрдорд┐рдирд▓ рдПрдореБрд▓реЗрдЯрд░ рдЦреЛрд▓рд╛ рд╣реИ, рдФрд░ рд╢реБрд░реВ рдХрд┐рдпрд╛: </font></font><br>
<br>
<code>#sudo bash</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЬрд╛рд░реА рд░рдЦреЗрдВред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SATA SSD рд╕реЗ рдПрдХ рд╕рд░рдгреА "рдЖрд░рдВрдн рдХрд░реЗрдВ": </font></font><br>
<br>
<code>#blkdiscard /dev/md2</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрджрд┐ рдпрд╣ рдирд╣реАрдВ рд╣реИ, рддреЛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ: </font></font><br>
<br>
<code>#blkdiscard --step 65536 /dev/md2</code><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SBS SSD рдкрд░ LVM VG рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<code>#pvcreate /dev/md2<br>
#vgcreate data /dev/md2</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВ рдПрдХ рдФрд░ рд╡реАрдЬреА ..?</font></font></b><div class="spoiler_text">  ,     VG   root.        VG?<br>
<br>
  VG   PV,     VG  PV   (online).   LVM RAID,     .<br>
<br>
  ,    (  )    RAID 6           .<br>
<br>
 ,           ┬л┬╗   VG.<br>
<br>
 -,   RAID     ┬л ┬╗.         ,    VG.<br>
<br>
 LVM  ┬л┬╗        RAID  -  . , тАФ  <b></b> bcache + LVM thin, bcache + BTRFS, LVM cache + LVM thin,   ZFS       ,      .<br>
<br>
 ┬л┬╗   ,  - ┬л┬╗ LVM-,   .    , ,     .<br>
<br>
,   ,     -   .<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM SATA HDD рдХреЛ</font></font></h3><br>
<code>#pvcreate /dev/md3<br>
#vgcreate backup /dev/md3</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ рд╕реЗ рдирдпрд╛ рд╡реАрдЬреА ..?</font></font></b><div class="spoiler_text">  ,     ,        ,      , -     . , -   VG, тАФ    VG.<br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM рдХреИрд╢ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдХреИрд╢рд┐рдВрдЧ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП NVMe RAID 1 рдкрд░ LV рдмрдирд╛рдПрдВред</font></font><br>
<br>
<code>#lvcreate -L 70871154688B --name cache root</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрддрдирд╛ рдХрдо рдХреНрдпреЛрдВ ...?</font></font></b><div class="spoiler_text">  ,    NVMe SSD   SLC . 4  ┬л┬╗  18         3-bit MLC. -   NVMe SSD       SATA SSD  . ,        LVM cache      SLC  NVMe .   NVMe      32-64  . <br>
<br>
      64  ,       .<br>
<br>
 ,      LVM         .  ,       lvchange       . ,      .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪрд▓реЛ рдПрдХ рдХреИрд╢реНрдб рдбрд┐рд╡рд╛рдЗрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SATA RAID 6 рдкрд░ LV рдмрдирд╛рдПрдВред</font></font><br>
<br>
<code>#lvcreate -L 3298543271936B --name cache data</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рддреАрди рдЯреЗрд░рд╛рдмрд╛рдЗрдЯреНрд╕ рд╣реА рдХреНрдпреЛрдВ ..?</font></font></b><div class="spoiler_text">,  ,    SATA SSD RAID 6  -  .      ,  ,    .         , ,   LVM-cache , , bcache,  ,      .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреИрд╢рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рд╡реАрдЬреА рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">
рдХреИрд╢реНрдб рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ LV рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">
рдпрд╣рд╛рдВ рд╣рдордиреЗ рддреБрд░рдВрдд / dev / data / cache рдкрд░ рд╕рднреА рдЦрд╛рд▓реА рд╕реНрдерд╛рди рд▓реЗ рд▓рд┐рдП рддрд╛рдХрд┐ рдЕрдиреНрдп рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рднрд╛рдЬрди рддреБрд░рдВрдд / dev / root / рдХреИрд╢ рдкрд░ рдмрдирд╛рдП рдЬрд╛ рд╕рдХреЗрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд╣рд╛рдБ рдХреБрдЫ рдирд╣реАрдВ рдмрдирд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ pvmove рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">
рдХреИрд╢ рдмрдирд╛рдПрдВ рдФрд░ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ:</font></font><br>
<br>
<code>#pvcreate /dev/root/cache<br>
#pvcreate /dev/data/cache<br>
#vgcreate cache /dev/root/cache /dev/data/cache</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -L 3298539077632B --name cachedata cache /dev/data/cache</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -y -L 64G -n cache cache /dev/root/cache<br>
#lvcreate -y -L 1G -n cachemeta cache /dev/root/cache<br>
#lvconvert -y --type cache-pool --cachemode writeback --chunksize 64k --poolmetadata cache/cachemeta cache/cache<br>
#lvconvert -y --type cache --cachepool cache/cache cache/cachedata<br>
</code><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВ рдЗрддрдирд╛ рд╣рд┐рд╕реНрд╕рд╛ ..?</font></font></b><div class="spoiler_text">     ,        LVM cache     LVM thin.  ,   ,        . <br>
<br>
64 тАФ       LVM thin.<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рд╡рдзрд╛рдиреА рд▓рд┐рдЦрд╛рд╡рдЯ ..!</font></font></b><div class="spoiler_text">.         .    , ,    ,      .   ,  ,  NVMe RAID 1  ,    . <br>
<br>
    ,     RAID 6   .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╣рдо рд╕рдлрд▓ рд╣реБрдП: </font><font style="vertical-align: inherit;">
рдХреЗрд╡рд▓ [cachedata_corig] / dev / data / cache рдкрд░ рд╕реНрдерд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЕрдЧрд░ рдХреБрдЫ рдЧрд▓рдд рд╣реИ, рддреЛ pvmove рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">
рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЖрдк рдХреИрд╢ рдХреЛ рдПрдХ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">
рдпрд╣ рдСрди-рд▓рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">LVM рдХреЗрд╡рд▓ рдХреИрд╢ рдХреЛ рдбрд┐рд╕реНрдХ рдореЗрдВ рд╕рд┐рдВрдХ рдХрд░рддрд╛ рд╣реИ, рдЙрд╕реЗ рд╣рдЯрд╛рддрд╛ рд╣реИ, рдФрд░ cachedata_corig рдХреЛ рд╡рд╛рдкрд╕ рдХреИрд╢реНрдбреЗрдЯ рдХрд░рддрд╛ рд╣реИред</font></font><br>
<br>
<code>#lvs -a -o lv_name,lv_size,devices --units B cache<br>
 LV LSize Devices <br>
 [cache] 68719476736B cache_cdata(0) <br>
 [cache_cdata] 68719476736B /dev/root/cache(0) <br>
 [cache_cmeta] 1073741824B /dev/root/cache(16384)<br>
 cachedata 3298539077632B cachedata_corig(0) <br>
 [cachedata_corig] 3298539077632B /dev/data/cache(0) <br>
 [lvol0_pmspare] 1073741824B /dev/root/cache(16640)<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvconvert -y --uncache cache/cachedata</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM рдкрддрд▓реА рд╕реЗрдЯрдЕрдк</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╣рдо </font><font style="vertical-align: inherit;">
рдореЛрдЯреЗ рддреМрд░ рдкрд░ </font><font style="vertical-align: inherit;">рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдореЗрдВ LVM рдкрддрд▓реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рддрдиреА рдЬрдЧрд╣ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА: </font><font style="vertical-align: inherit;">4 рдЧреАрдЧрд╛рдмрд╛рдЗрдЯ рддрдХ рдЧреЛрд▓ </font><font style="vertical-align: inherit;">
рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">: 4294967296B </font><font style="vertical-align: inherit;">рджреЛ рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВ рдФрд░ LVM рдореЗрдЯрд╛рдбреЗрдЯрд╛ PV рдХреЗ рд▓рд┐рдП 4194304B рдЬреЛрдбрд╝реЗрдВ: 85M128896B </font><font style="vertical-align: inherit;">
LVM рдкрддрд▓реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП NVMe RAID 1 рдкрд░ рдПрдХ рдЕрд▓рдЧ рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдПрдБ рдФрд░ рдЗрд╕рдХрд╛ рдмреИрдХ рдЕрдк рд▓реЗрдВред</font></font><br>
<br>
<code>#thin_metadata_size --block-size=64k --pool-size=6terabytes --max-thins=100000 -u bytes<br>
thin_metadata_size - 3385794560 bytes estimated metadata area size for "--block-size=64kibibytes --pool-size=6terabytes --max-thins=100000"</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -L 8594128896B --name images root</code><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕ рд▓рд┐рдП..?</font></font></b><div class="spoiler_text">   ,    LVM thin ,        NVMe    .<br>
<br>
     ,     .    ,  ,   .    - , ,   LVM thin  ,      .         .<br>
<br>
-    -,  , ,          .             ,      .           .<br>
<br>
 ,        , ,  ,       , ,      LVM thin,        . <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдирдпрд╛ рд╡реАрдЬреА рдмрдирд╛рдПрдВ рдЬреЛ рдкрддрд▓реЗ рдкреНрд░рд╛рд╡рдзрд╛рди рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрдЧрд╛: </font><font style="vertical-align: inherit;">
рдПрдХ рдкреВрд▓ рдмрдирд╛рдПрдВ:</font></font><br>
<br>
<code>#pvcreate /dev/root/images<br>
#pvcreate /dev/cache/cachedata<br>
#vgcreate images /dev/root/images /dev/cache/cachedata</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -L 274877906944B --poolmetadataspare y --poolmetadatasize 4294967296B --chunksize 64k -Z y -T images/thin-pool</code><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВ -рдЬреЗрдб рд╡рд╛рдИ</font></font></b><div class="spoiler_text"> ,       , тАФ               , тАФ zeroing          64k.    64k           64K    .          .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪрд▓реЛ </font><font style="vertical-align: inherit;">
LV рдХреЛ рд╕рдВрдмрдВрдзрд┐рдд PVs рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдБ: </font><font style="vertical-align: inherit;">рдЬрд╛рдБрдЪ рдХрд░реЗрдВ: </font><font style="vertical-align: inherit;">
рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрддрд▓реА рдорд╛рддреНрд░рд╛ рдмрдирд╛рдПрдБ: </font><font style="vertical-align: inherit;">
рдкрд░реАрдХреНрд╖рдгреЛрдВ рдФрд░ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреИрдХреЗрдЬ рд░рдЦреЗрдВ: </font><font style="vertical-align: inherit;">
рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рд╣рдорд╛рд░реЗ рд╕рдВрдЧреНрд░рд╣рдг рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">
рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рд╣рдорд╛рд░реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХреИрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br>
<br>
<code>#pvmove -n images/thin-pool_tdata /dev/root/images /dev/cache/cachedata<br>
#pvmove -n images/lvol0_pmspare /dev/cache/cachedata /dev/root/images<br>
#pvmove -n images/thin-pool_tmeta /dev/cache/cachedata /dev/root/images <br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvs -a -o lv_name,lv_size,devices --units B images<br>
 LV LSize Devices <br>
 [lvol0_pmspare] 4294967296B /dev/root/images(0) <br>
 thin-pool 274877906944B thin-pool_tdata(0) <br>
 [thin-pool_tdata] 274877906944B /dev/cache/cachedata(0) <br>
 [thin-pool_tmeta] 4294967296B /dev/root/images(1024)<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#lvcreate -V 64G --thin-pool thin-pool --name test images</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#apt-get install sysstat fio</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#watch 'lvs --rows --reportformat basic --quiet -ocache_dirty_blocks,cache_settings cache/cachedata &amp;&amp; (lvdisplay cache/cachedata | grep Cache) &amp;&amp; (sar -p -d 2 1 | grep -E "sd|nvme|DEV|md1|md2|md3|md0" | grep -v Average | sort)'</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#fio --loops=1 --size=64G --runtime=4 --filename=/dev/images/test --stonewall --ioengine=libaio --direct=1 \<br>
--name=4kQD32read --bs=4k --iodepth=32 --rw=randread \<br>
--name=8kQD32read --bs=8k --iodepth=32 --rw=randread \<br>
--name=16kQD32read --bs=16k --iodepth=32 --rw=randread \<br>
--name=32KQD32read --bs=32k --iodepth=32 --rw=randread \<br>
--name=64KQD32read --bs=64k --iodepth=32 --rw=randread \<br>
--name=128KQD32read --bs=128k --iodepth=32 --rw=randread \<br>
--name=256KQD32read --bs=256k --iodepth=32 --rw=randread \<br>
--name=512KQD32read --bs=512k --iodepth=32 --rw=randread \<br>
--name=4Kread --bs=4k --rw=read \<br>
--name=8Kread --bs=8k --rw=read \<br>
--name=16Kread --bs=16k --rw=read \<br>
--name=32Kread --bs=32k --rw=read \<br>
--name=64Kread --bs=64k --rw=read \<br>
--name=128Kread --bs=128k --rw=read \<br>
--name=256Kread --bs=256k --rw=read \<br>
--name=512Kread --bs=512k --rw=read \<br>
--name=Seqread --bs=1m --rw=read \<br>
--name=Longread --bs=8m --rw=read \<br>
--name=Longwrite --bs=8m --rw=write \<br>
--name=Seqwrite --bs=1m --rw=write \<br>
--name=512Kwrite --bs=512k --rw=write \<br>
--name=256Kwrite --bs=256k --rw=write \<br>
--name=128Kwrite --bs=128k --rw=write \<br>
--name=64Kwrite --bs=64k --rw=write \<br>
--name=32Kwrite --bs=32k --rw=write \<br>
--name=16Kwrite --bs=16k --rw=write \<br>
--name=8Kwrite --bs=8k --rw=write \<br>
--name=4Kwrite --bs=4k --rw=write \<br>
--name=512KQD32write --bs=512k --iodepth=32 --rw=randwrite \<br>
--name=256KQD32write --bs=256k --iodepth=32 --rw=randwrite \<br>
--name=128KQD32write --bs=128k --iodepth=32 --rw=randwrite \<br>
--name=64KQD32write --bs=64k --iodepth=32 --rw=randwrite \<br>
--name=32KQD32write --bs=32k --iodepth=32 --rw=randwrite \<br>
--name=16KQD32write --bs=16k --iodepth=32 --rw=randwrite \<br>
--name=8KQD32write --bs=8k --iodepth=32 --rw=randwrite \<br>
--name=4kQD32write --bs=4k --iodepth=32 --rw=randwrite \<br>
 | grep -E 'read|write|test' | grep -v ioengine<br>
</code><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рд╡рдзрд╛рди! </font><font style="vertical-align: inherit;">рд╕рдВрд╕рд╛рдзрди!</font></font></b><div class="spoiler_text">   36  ,       4 .     .  4   NVMe     .  3   .  ,           216   SSD.<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрдврд╝рдирд╛ рдФрд░ рд▓рд┐рдЦрдирд╛ рдлреЗрд░рдмрджрд▓?</font></font></b><div class="spoiler_text">.          .  ,   ,    ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд░рд┐рдгрд╛рдо рдкрд╣рд▓реА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдФрд░ рдмрд╛рдж рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛрдВрдЧреЗ рдХреНрдпреЛрдВрдХрд┐ рдХреИрд╢ рдФрд░ рдкрддрд▓реА рдорд╛рддреНрд░рд╛ рднрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рднреА, рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рд┐рд╕реНрдЯрдо рдЕрдВрддрд┐рдо рд╢реБрд░реБрдЖрдд рдореЗрдВ рднрд░реЗ рдЧрдП рдХреИрд╢ рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣рд╛ред</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдиреНрдп рдмрд╛рддреЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореИрдВ рдкрд╣рд▓реЗ рд╕реЗ рднрд░реЗ рдкрддрд▓реЗ рд╡реЙрд▓реНрдпреВрдо рдкрд░ рдЧрддрд┐ рдХреЛ рдорд╛рдкрдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ рдЬрд┐рд╕рд╕реЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдЕрднреА рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдЦрдХ рдХреЗ рдкрд╛рд╕ рдпрд╣ рджреЗрдЦрдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рдерд╛ рдХрд┐ рдкрд╣рд▓реЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдмрдирд╛рдиреЗ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рдХреИрд╕реЗ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рддреЗрдЬреА рд╕реЗ рдмрдврд╝рддреА рд╣реИ, рдЦрд╛рд╕рдХрд░ рдЬрдм рдХреИрд╢ рдЕрднреА рддрдХ рднрд░рд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд▓рд┐рдЦрдиреЗ рдХреЗ рдХреЙрдкреА-рдСрди-рд░рд╛рдЗрдЯ рд╕реЗрдореЗрдВрдЯрд┐рдХреНрд╕, рдХреИрд╢ рдмреНрд▓реЙрдХ рдФрд░ рдкрддрд▓реЗ рд╡реЙрд▓реНрдпреВрдо рдХреЗ рд╕рдВрд░реЗрдЦрдг рдХреЗ рдХрд╛рд░рдг рд╣реИ, рдФрд░ рдпрд╣ рддрдереНрдп рдХрд┐ рд░реИрдВрдб 6 рдкрд░ рд░реИрдВрдбрдо рд░рд╛рдЗрдЯ рд░рд╛рдЙрдб 6 рд╕реЗ рд░реИрдВрдбрдо рд░реАрдб рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдХреИрд╢реЗ рд╕реЗ рд▓рд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, рд░реИрдВрдб 6 рд╕реЗ 6 рдЧреБрдирд╛ рддрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдкрдврд╝рд╛ (рд╕рд░рдгреА рдореЗрдВ SATA SSDs рдХреА рд╕рдВрдЦреНрдпрд╛) рд▓рд┐рдЦрдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╕реАрдУрдбрдмреНрд▓реНрдпреВ рдмреНрд▓реЙрдХ рдХреЛ рдПрдХ рдкрддрд▓реА рдкреВрд▓ рд╕реЗ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдзрд┐рдХрд╛рдВрд╢ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рд░рд┐рдХреЙрд░реНрдб рднреА рдПрдХ рдХреНрд░рдорд┐рдХ рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрди рджреЛрдиреЛрдВ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреИрд╢ "рд╕реБрд╕рдВрдЧрдд" рд╕реНрдиреИрдкрд╢реЙрдЯ</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреИрд╢ рдХреА рдХреНрд╖рддрд┐ / рд╣рд╛рдирд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдбреЗрдЯрд╛ рд╣рд╛рдирд┐ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд▓реЗрдЦрдХ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЙрдирдХреА рдЕрдЦрдВрдбрддрд╛ рдХреА рдЧрд╛рд░рдВрдЯреА рдХреЗ рд▓рд┐рдП рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЛ рдШреБрдорд╛рдиреЗ рдХреА рдкреНрд░рдерд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдХрд┐ рдкрддрд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдХ рдЕрдирдЫреБрдП рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд╕реНрдерд┐рдд рд╣реИрдВ, рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕реБрд╕рдВрдЧрдд рд╣реЛрдЧрд╛ рдФрд░ рд╕рдВрднрд╡ рдиреБрдХрд╕рд╛рди рдбреЗрдЯрд╛ рдмреНрд▓реЙрдХ рдХреЗ рдЕрдВрджрд░ рдЕрд▓рдЧ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдиреИрдкрд╢реЙрдЯ рд░реЛрдЯреЗрд╢рди рдЪрдХреНрд░ рдХреИрд╢ рд╣рд╛рдирд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЗ рдЕрдВрджрд░ рдбреЗрдЯрд╛ рдЕрдЦрдВрдбрддрд╛ рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИ:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╛рдо рдХреЗ рд╕рд╛рде рдкреНрд░рддреНрдпреЗрдХ рдкрддрд▓реА рдорд╛рддреНрд░рд╛ рдХреЗ рд▓рд┐рдП &lt;name&gt;, &lt;name&gt; .cached рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдиреИрдкрд╢реЙрдЯ рдмрдирд╛рдПрдВ</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдЗрдЧреНрд░реЗрд╢рди рд╕реАрдорд╛ рдХреЛ рдЙрдЪрд┐рдд рдЙрдЪреНрдЪ рдорд╛рди рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ: </font></font><code>#lvchange --quiet --cachesettings "migration_threshold=16384" cache/cachedata</code> </li>
<li>       : <code>#lvs --rows --reportformat basic --quiet -ocache_dirty_blocks cache/cachedata | awk '{print $2}'</code>    .     ,        writethrough . ,      SATA  NVMe SSD,  ,   TBW,            ,           . -          100%    .  NVMe SSD  100%        <b>3-4 </b>. SATA SSD  -    . ,   ,       ,     , тАФ             .</li>
<li>   ( )  тАФ  &lt;&gt;.cached  &lt;&gt;.committed.  &lt;&gt;.committed   .</li>
<li>,     100%,    ,   .         .</li>
<li> migration threshold  : <code>#lvchange --quiet --cachesettings "migration_threshold=0" cache/cachedata</code>        . </li>
<li>,        <code>#lvs --rows --reportformat basic --quiet -ocache_dirty_blocks cache/cachedata | awk '{print $2}'</code>   .</li>
<li> . </li>
</ol><br>
<div class="spoiler"><b class="spoiler_title">   migration threshold...?</b><div class="spoiler_text">   ,     ┬л┬╗       .    -    4 ,   ,         -     (+- 32K) .<br>
<br>
 migration threshold        SATA SSD       64K  .      SATA SSD.<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  ..?</b><div class="spoiler_text"> ,         bash     100%    ┬лgoogle┬╗-driven development,  ,    ,      ,     .<br>
<br>
,               , ,  ,      systemd ,     .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЗ рд▓рд┐рдП рдЗрд╕ рддрд░рд╣ рдХреА рдПрдХ рд╕рд░рд▓ рд░реЛрдЯреЗрд╢рди рдпреЛрдЬрдирд╛ рд╣рдореЗрдВ рди рдХреЗрд╡рд▓ рд▓рдЧрд╛рддрд╛рд░ рдПрдХ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЛ SATA SSD рдкрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреА, рдмрд▓реНрдХрд┐ рдкрддрд▓реЗ_рдбреЗрд▓рдЯрд╛ рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХреА рдорджрдж рд╕реЗ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЗрд╕рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рдж рдХреМрди рд╕реЗ рдмреНрд▓реЙрдХ рдмрджрд▓реЗ рдЧрдП рдереЗ, рдФрд░ рдЗрд╕ рддрд░рд╣ рдореБрдЦреНрдп рд╡реЙрд▓реНрдпреВрдо рдкрд░ рдиреБрдХрд╕рд╛рди рдХрд╛ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг рдХрд┐рдпрд╛ рдЧрдпрд╛, рдЬрд┐рд╕рд╕реЗ рдЗрд╕реЗ рдмрд╣рд╛рд▓ рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛ рдЧрдпрд╛ред ред</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TRIM / DISCARD in libvirt / KVM</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЪреВрдВрдХрд┐ </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рдбреЗрдЯрд╛ рд╡реЗрдпрд░рд╣рд╛рдЙрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡реАрдПрдо рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ libvirt рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рд╡реАрдПрдо рдХреЛ рди рдХреЗрд╡рд▓ рдореБрдлреНрдд рд╕реНрдерд╛рди рд▓реЗрдирд╛ рд╕рд┐рдЦрд╛рдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛, рдмрд▓реНрдХрд┐ рдпрд╣ рднреА рдореБрдлрд╝реНрдд рд╣реЛрдЧрд╛ рдХрд┐ рдЕрдм рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдпрд╣ рд╡рд░реНрдЪреБрдЕрд▓ рдбрд┐рд╕реНрдХ рдкрд░ TRIM / DISCARD рд╕рдорд░реНрдерди рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдпрдВрддреНрд░рдХ рдкреНрд░рдХрд╛рд░ рдХреЛ рдЧреБрдг-рд╕реНрдХреИрд╕реА рдореЗрдВ рдмрджрд▓реЗрдВ рдФрд░ xml рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">
рдЕрддрд┐рдерд┐ OS рд╕реЗ рдЗрд╕реА рддрд░рд╣ рдХреЗ DISCARDs рдХреЛ LVM рджреНрд╡рд╛рд░рд╛ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдмреНрд▓реЙрдХ рдХреИрд╢ рдФрд░ рдкрддрд▓реЗ рдкреВрд▓ рдореЗрдВ рджреЛрдиреЛрдВ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ, рдЬрдм рдЖрдк рдЕрдЧрд▓реЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╕реНрдердЧрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br>
<br>
<code>#virsh edit vmname<br>
&lt;disk type='block' device='disk'&gt;<br>
 &lt;driver name='qemu' type='raw' cache='writethrough' io='threads' <b>discard='unmap'</b>/&gt;<br>
 &lt;source dev='/dev/images/vmname'/&gt;<br>
 &lt;backingStore/&gt;<br>
 &lt;target dev='sda' bus='scsi'/&gt;<br>
 &lt;alias name='scsi0-0-0-0'/&gt;<br>
 &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;<br>
&lt;/disk&gt;<br>
<br>
&lt;controller type='scsi' index='0' <b>model='virtio-scsi'</b>&gt;<br>
 &lt;alias name='scsi0'/&gt;<br>
 &lt;address type='pci' domain='0x0000' bus='0x04' slot='0x00' function='0x0'/&gt;<br>
&lt;/controller&gt;<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BTRFS рдмреИрдХрдЕрдк</font></font></h3><br><font style="vertical-align: inherit;"></font><u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддреНрдпрдзрд┐рдХ</font></font></b></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рд╡рдзрд╛рдиреА рдФрд░ </font></font><u><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛрдЦрд┐рдо рдФрд░ рдЬреЛрдЦрд┐рдо рдХреЗ</font></font></b></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
рд╕рд╛рде рддреИрдпрд╛рд░ рд▓рд┐рдкрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдЦрдХ рдиреЗ рдпрд╣ рдХреЛрдб рд╕реНрд╡рдпрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕реНрд╡рдпрдВ рдХреЗ рд▓рд┐рдП рд▓рд┐рдЦрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдпрдХреАрди рд╣реИ рдХрд┐ рдХрдИ рдЕрдиреБрднрд╡реА рд▓рд┐рдирдХреНрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ </font><font style="vertical-align: inherit;">рдЕрдиреБрднрд╡ рдХреЗ </font><font style="vertical-align: inherit;">рдРрд╕реЗ </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреИрд╕рд╛рдЦреА</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИрдВ, рдФрд░ рджреВрд╕рд░реЛрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмреИрдХрдЕрдк рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдПрдХ рд╡реЙрд▓реНрдпреВрдо рдмрдирд╛рдПрдБ: </font></font><br>
<br>
<code>#lvcreate -L 256G --name backup backup</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕реЗ BTRFS рдореЗрдВ рдлрд╝реЙрд░реНрдореЗрдЯ </font></font><br>
<br>
<code>#mkfs.btrfs /dev/backup/backup</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдорд╛рдЙрдВрдЯ рдкреЙрдЗрдВрдЯ рдмрдирд╛рдПрдБ рдФрд░ рд░реВрдЯ рд░реВрдЯ рдЙрдк FS рдХреА FS: </font><font style="vertical-align: inherit;">
рдмреИрдХрдЕрдк рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ </font><font style="vertical-align: inherit;">
рдмрдирд╛рдПрдБ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдмреИрдХрдЕрдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдБ: рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдБ </font><font style="vertical-align: inherit;">
:</font></font><br>
<br>
<code>#mkdir /backup<br>
#mkdir /backup/btrfs<br>
#mkdir /backup/btrfs/root<br>
#mkdir /backup/btrfs/back<br>
#ln -s /boot /backup/btrfs<br>
# cat &gt;&gt;/etc/fstab &lt;&lt; EOF<br>
<br>
/dev/mapper/root-root /backup/btrfs/root btrfs defaults,space_cache,noatime,nodiratime 0 2<br>
/dev/mapper/backup-backup /backup/btrfs/back btrfs defaults,space_cache,noatime,nodiratime 0 2<br>
EOF<br>
#mount -a<br>
#update-initramfs -u<br>
#update-grub<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#mkdir /backup/btrfs/back/remote<br>
#mkdir /backup/btrfs/back/remote/root<br>
#mkdir /backup/btrfs/back/remote/boot<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#mkdir /root/btrfs-backup</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдвреЗрд░ рд╕рд╛рд░рд╛ рдбрд░рд╛рд╡рдирд╛ рдХреЛрдбред </font><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рдЬреЛрдЦрд┐рдо рдкрд╛рд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдЦрдХ рдирд╛рд░рд╛рдЬ рдкрддреНрд░ рдирд╣реАрдВ рд▓рд┐рдЦрддрд╛ рд╣реИ ...</font></font></b><div class="spoiler_text"><code>#cat &gt;/root/btrfs-backup/btrfs-backup.sh &lt;&lt; EOF<br>
#!/bin/bash<br>
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"<br>
<br>
SCRIPT_FILE="$(realpath $0)"<br>
SCRIPT_DIR="$(dirname $SCRIPT_FILE)"<br>
SCRIPT_NAME="$(basename -s .sh $SCRIPT_FILE)"<br>
<br>
LOCK_FILE="/dev/shm/$SCRIPT_NAME.lock"<br>
DATE_PREFIX='%Y-%m-%d'<br>
DATE_FORMAT=$DATE_PREFIX'-%H-%M-%S'<br>
DATE_REGEX='[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]-[0-9][0-9]-[0-9][0-9]-[0-9][0-9]'<br>
BASE_SUFFIX=".@base"<br>
PEND_SUFFIX=".@pend"<br>
SNAP_SUFFIX=".@snap"<br>
MOUNTS="/backup/btrfs/"<br>
BACKUPS="/backup/btrfs/back/remote/"<br>
<br>
function terminate ()<br>
{<br>
 echo "$1" &gt;&amp;2<br>
 exit 1<br>
}<br>
<br>
function wait_lock()<br>
{<br>
 flock 98<br>
}<br>
<br>
function wait_lock_or_terminate()<br>
{<br>
 echo "Wating for lock..."<br>
 wait_lock || terminate "Failed to get lock. Exiting..."<br>
 echo "Got lock..."<br>
}<br>
<br>
function suffix()<br>
{<br>
 FORMATTED_DATE=$(date +"$DATE_FORMAT")<br>
 echo "$SNAP_SUFFIX.$FORMATTED_DATE"<br>
}<br>
<br>
function filter()<br>
{<br>
 FORMATTED_DATE=$(date --date="$1" +"$DATE_PREFIX")<br>
 echo "$SNAP_SUFFIX.$FORMATTED_DATE"<br>
}<br>
<br>
function backup()<br>
{<br>
SOURCE_PATH="$MOUNTS$1"<br>
TARGET_PATH="$BACKUPS$1"<br>
SOURCE_BASE_PATH="$MOUNTS$1$BASE_SUFFIX"<br>
TARGET_BASE_PATH="$BACKUPS$1$BASE_SUFFIX"<br>
TARGET_BASE_DIR="$(dirname $TARGET_BASE_PATH)"<br>
SOURCE_PEND_PATH="$MOUNTS$1$PEND_SUFFIX"<br>
TARGET_PEND_PATH="$BACKUPS$1$PEND_SUFFIX"<br>
 if [ -d "$SOURCE_BASE_PATH" ]<br>
 then<br>
 echo "$SOURCE_BASE_PATH found"<br>
 else<br>
 echo "$SOURCE_BASE_PATH File not found creating snapshot of $SOURCE_PATH to $SOURCE_BASE_PATH"<br>
 btrfs subvolume snapshot -r $SOURCE_PATH $SOURCE_BASE_PATH<br>
 sync<br>
 if [ -d "$TARGET_BASE_PATH" ]<br>
 then<br>
 echo "$TARGET_BASE_PATH found out of sync with source... removing..."<br>
 btrfs subvolume delete -c $TARGET_BASE_PATH<br>
 sync<br>
 fi<br>
 fi<br>
 if [ -d "$TARGET_BASE_PATH" ]<br>
 then<br>
 echo "$TARGET_BASE_PATH found"<br>
 else<br>
 echo "$TARGET_BASE_PATH not found. Synching to $TARGET_BASE_DIR"<br>
 btrfs send $SOURCE_BASE_PATH | btrfs receive $TARGET_BASE_DIR<br>
 sync<br>
 fi<br>
 if [ -d "$SOURCE_PEND_PATH" ]<br>
 then<br>
 echo "$SOURCE_PEND_PATH found removing..."<br>
 btrfs subvolume delete -c $SOURCE_PEND_PATH<br>
 sync<br>
 fi<br>
 btrfs subvolume snapshot -r $SOURCE_PATH $SOURCE_PEND_PATH<br>
 sync<br>
 if [ -d "$TARGET_PEND_PATH" ]<br>
 then<br>
 echo "$TARGET_PEND_PATH found removing..."<br>
 btrfs subvolume delete -c $TARGET_PEND_PATH<br>
 sync<br>
 fi<br>
 echo "Sending $SOURCE_PEND_PATH to $TARGET_PEND_PATH"<br>
 btrfs send -p $SOURCE_BASE_PATH $SOURCE_PEND_PATH | btrfs receive $TARGET_BASE_DIR<br>
 sync<br>
 TARGET_DATE_SUFFIX=$(suffix)<br>
 btrfs subvolume snapshot -r $TARGET_PEND_PATH "$TARGET_PATH$TARGET_DATE_SUFFIX"<br>
 sync<br>
 btrfs subvolume delete -c $SOURCE_BASE_PATH<br>
 sync<br>
 btrfs subvolume delete -c $TARGET_BASE_PATH<br>
 sync<br>
 mv $SOURCE_PEND_PATH $SOURCE_BASE_PATH<br>
 mv $TARGET_PEND_PATH $TARGET_BASE_PATH<br>
 sync<br>
}<br>
<br>
function list()<br>
{<br>
LIST_TARGET_BASE_PATH="$BACKUPS$1$BASE_SUFFIX"<br>
LIST_TARGET_BASE_DIR="$(dirname $LIST_TARGET_BASE_PATH)"<br>
LIST_TARGET_BASE_NAME="$(basename -s .$BASE_SUFFIX $LIST_TARGET_BASE_PATH)"<br>
find "$LIST_TARGET_BASE_DIR" -maxdepth 1 -mindepth 1 -type d -printf "%f\n" | grep "${LIST_TARGET_BASE_NAME/$BASE_SUFFIX/$SNAP_SUFFIX}.$DATE_REGEX"<br>
}<br>
<br>
function remove()<br>
{<br>
REMOVE_TARGET_BASE_PATH="$BACKUPS$1$BASE_SUFFIX"<br>
REMOVE_TARGET_BASE_DIR="$(dirname $REMOVE_TARGET_BASE_PATH)"<br>
btrfs subvolume delete -c $REMOVE_TARGET_BASE_DIR/$2<br>
sync<br>
}<br>
<br>
function removeall()<br>
{<br>
DATE_OFFSET="$2"<br>
FILTER="$(filter "$DATE_OFFSET")"<br>
while read -r SNAPSHOT ; do<br>
 remove "$1" "$SNAPSHOT"<br>
done &lt; &lt;(list "$1" | grep "$FILTER")<br>
<br>
}<br>
<br>
(<br>
 COMMAND="$1"<br>
 shift<br>
 <br>
 case "$COMMAND" in<br>
 "--help") <br>
 echo "Help"<br>
 ;;<br>
 "suffix") <br>
 suffix<br>
 ;;<br>
 "filter") <br>
 filter "$1"<br>
 ;;<br>
 "backup") <br>
 wait_lock_or_terminate<br>
 backup "$1"<br>
 ;;<br>
 "list") <br>
 list "$1"<br>
 ;;<br>
 "remove") <br>
 wait_lock_or_terminate<br>
 remove "$1" "$2"<br>
 ;;<br>
 "removeall") <br>
 wait_lock_or_terminate<br>
 removeall "$1" "$2"<br>
 ;;<br>
 *)<br>
 echo "None.."<br>
 ;;<br>
 esac<br>
) 98&gt;$LOCK_FILE <br>
<br>
EOF<br>
</code><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рднреА рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ ..?</font></font></b><div class="spoiler_text">       BTRFS        BTRFS send/recieve.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкрд╣рд▓рд╛ рд▓реЙрдиреНрдЪ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд▓рдВрдмрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ </font><font style="vertical-align: inherit;">рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╕рднреА рдбреЗрдЯрд╛ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдИ рдЬрд╛рдПрдЧреАред </font><font style="vertical-align: inherit;">рдЖрдЧреЗ рдХреА рд╢реБрд░реВрдЖрдд рдмрд╣реБрдд рддреЗрдЬ рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐ </font><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдИ рдЬрд╛рдПрдЧреАред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдХреНрд░реЛрди рдореЗрдВ рд░рдЯрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдЫ рдФрд░ рдмреИрд╢ рдХреЛрдб</font></font></b><div class="spoiler_text"><code>#cat &gt;/root/btrfs-backup/cron-daily.sh &lt;&lt; EOF<br>
#!/bin/bash<br>
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"<br>
<br>
SCRIPT_FILE="$(realpath $0)"<br>
SCRIPT_DIR="$(dirname $SCRIPT_FILE)"<br>
SCRIPT_NAME="$(basename -s .sh $SCRIPT_FILE)"<br>
<br>
BACKUP_SCRIPT="$SCRIPT_DIR/btrfs-backup.sh"<br>
RETENTION="-60 day"<br>
$BACKUP_SCRIPT backup root/@<br>
$BACKUP_SCRIPT removeall root/@ "$RETENTION"<br>
$BACKUP_SCRIPT backup root/@home<br>
$BACKUP_SCRIPT removeall root/@home "$RETENTION"<br>
$BACKUP_SCRIPT backup boot/<br>
$BACKUP_SCRIPT removeall boot/ "$RETENTION"<br>
EOF<br>
</code><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреНрдпрд╛ рдХрд░ рд░рд╣рд╛ рд╣реИрдВ ..?</font></font></b><div class="spoiler_text">     backup     BTRFS-.       60  .     /backup/btrfs/back/remote/     . <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: </font><font style="vertical-align: inherit;">
рдореБрдХреБрдЯ рдореЗрдВ рдЪреЗрдХ рдФрд░ рд░рдЯрдирд╛:</font></font><br>
<br>
<code>#chmod +x /root/btrfs-backup/cron-daily.sh<br>
#chmod +x /root/btrfs-backup/btrfs-backup.sh<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#/usr/bin/nice -n 19 /usr/bin/ionice -c 3 /root/btrfs-backup/cron-daily.sh 2&gt;&amp;1 | /usr/bin/logger -t btrfs-backup<br>
#cat /var/log/syslog | grep btrfs-backup<br>
#crontab -e<br>
0 2 * * * /usr/bin/nice -n 19 /usr/bin/ionice -c 3 /root/btrfs-backup/cron-daily.sh 2&gt;&amp;1 | /usr/bin/logger -t btrfs-backup<br>
</code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM рдкрддрд▓реА рдмреИрдХрдЕрдк</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдмреИрдХрдЕрдк рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдПрдХ рдкрддрд▓реА рдкреВрд▓ рдмрдирд╛рдПрдБ: </font></font><br>
<br>
<code>#lvcreate -L 274877906944B --poolmetadataspare y --poolmetadatasize 4294967296B --chunksize 64k -Z y -T backup/thin-pool</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ddrescue рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ, рдХреНрдпреЛрдВрдХрд┐ </font><font style="vertical-align: inherit;">рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрд╕ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ: </font></font><br>
<br>
<code>#apt-get install gddrescue</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдБ: рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА </font></font><br>
<br>
<code>#mkdir /root/lvm-thin-backup</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдБ:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрджрд░ рдмрд╣реБрдд рд╕рд╛рд░реА рдорд╛рд░ ...</font></font></b><div class="spoiler_text"><code>#cat &gt;/root/lvm-thin-backup/lvm-thin-backup.sh &lt;&lt; EOF<br>
#!/bin/bash<br>
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"<br>
<br>
SCRIPT_FILE="$(realpath $0)"<br>
SCRIPT_DIR="$(dirname $SCRIPT_FILE)"<br>
SCRIPT_NAME="$(basename -s .sh $SCRIPT_FILE)"<br>
<br>
LOCK_FILE="/dev/shm/$SCRIPT_NAME.lock"<br>
DATE_PREFIX='%Y-%m-%d'<br>
DATE_FORMAT=$DATE_PREFIX'-%H-%M-%S'<br>
DATE_REGEX='[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]-[0-9][0-9]-[0-9][0-9]-[0-9][0-9]'<br>
BASE_SUFFIX=".base"<br>
PEND_SUFFIX=".pend"<br>
SNAP_SUFFIX=".snap"<br>
BACKUPS="backup"<br>
BACKUPS_POOL="thin-pool"<br>
<br>
export LVM_SUPPRESS_FD_WARNINGS=1<br>
<br>
function terminate ()<br>
{<br>
 echo "$1" &gt;&amp;2<br>
 exit 1<br>
}<br>
<br>
function wait_lock()<br>
{<br>
 flock 98<br>
}<br>
<br>
function wait_lock_or_terminate()<br>
{<br>
 echo "Wating for lock..."<br>
 wait_lock || terminate "Failed to get lock. Exiting..."<br>
 echo "Got lock..."<br>
}<br>
<br>
function suffix()<br>
{<br>
 FORMATTED_DATE=$(date +"$DATE_FORMAT")<br>
 echo "$SNAP_SUFFIX.$FORMATTED_DATE"<br>
}<br>
<br>
function filter()<br>
{<br>
 FORMATTED_DATE=$(date --date="$1" +"$DATE_PREFIX")<br>
 echo "$SNAP_SUFFIX.$FORMATTED_DATE"<br>
}<br>
<br>
function read_thin_id {<br>
lvs --rows --reportformat basic --quiet -othin_id "$1/$2" | awk '{print $2}'<br>
}<br>
<br>
function read_pool_lv {<br>
lvs --rows --reportformat basic --quiet -opool_lv "$1/$2" | awk '{print $2}'<br>
}<br>
<br>
function read_lv_dm_path {<br>
lvs --rows --reportformat basic --quiet -olv_dm_path "$1/$2" | awk '{print $2}'<br>
}<br>
<br>
function read_lv_active {<br>
lvs --rows --reportformat basic --quiet -olv_active "$1/$2" | awk '{print $2}'<br>
}<br>
<br>
function read_lv_chunk_size {<br>
lvs --rows --reportformat basic --quiet --units b --nosuffix -ochunk_size "$1/$2" | awk '{print $2}'<br>
}<br>
<br>
function read_lv_size {<br>
lvs --rows --reportformat basic --quiet --units b --nosuffix -olv_size "$1/$2" | awk '{print $2}'<br>
}<br>
<br>
function activate_volume {<br>
lvchange -ay -Ky "$1/$2"<br>
}<br>
<br>
function deactivate_volume {<br>
lvchange -an "$1/$2"<br>
}<br>
<br>
function read_thin_metadata_snap {<br>
dmsetup status "$1" | awk '{print $7}'<br>
}<br>
<br>
function thindiff()<br>
{<br>
DIFF_VG="$1"<br>
DIFF_SOURCE="$2"<br>
DIFF_TARGET="$3"<br>
DIFF_SOURCE_POOL=$(read_pool_lv $DIFF_VG $DIFF_SOURCE)<br>
DIFF_TARGET_POOL=$(read_pool_lv $DIFF_VG $DIFF_TARGET)<br>
<br>
if [ "$DIFF_SOURCE_POOL" == "" ]<br>
then<br>
 (&gt;&amp;2 echo "Source LV is not thin.")<br>
 exit 1<br>
fi<br>
<br>
if [ "$DIFF_TARGET_POOL" == "" ]<br>
then<br>
 (&gt;&amp;2 echo "Target LV is not thin.")<br>
 exit 1<br>
fi<br>
<br>
if [ "$DIFF_SOURCE_POOL" != "$DIFF_TARGET_POOL" ]<br>
then<br>
 (&gt;&amp;2 echo "Source and target LVs belong to different thin pools.")<br>
 exit 1<br>
fi<br>
<br>
DIFF_POOL_PATH=$(read_lv_dm_path $DIFF_VG $DIFF_SOURCE_POOL)<br>
DIFF_SOURCE_ID=$(read_thin_id $DIFF_VG $DIFF_SOURCE)<br>
DIFF_TARGET_ID=$(read_thin_id $DIFF_VG $DIFF_TARGET)<br>
DIFF_POOL_PATH_TPOOL="$DIFF_POOL_PATH-tpool"<br>
DIFF_POOL_PATH_TMETA="$DIFF_POOL_PATH"_tmeta<br>
DIFF_POOL_METADATA_SNAP=$(read_thin_metadata_snap $DIFF_POOL_PATH_TPOOL)<br>
<br>
if [ "$DIFF_POOL_METADATA_SNAP" != "-" ]<br>
then<br>
 (&gt;&amp;2 echo "Thin pool metadata snapshot already exist. Assuming stale one. Will release metadata snapshot in 5 seconds.")<br>
 sleep 5<br>
 dmsetup message $DIFF_POOL_PATH_TPOOL 0 release_metadata_snap<br>
fi<br>
<br>
dmsetup message $DIFF_POOL_PATH_TPOOL 0 reserve_metadata_snap<br>
DIFF_POOL_METADATA_SNAP=$(read_thin_metadata_snap $DIFF_POOL_PATH_TPOOL)<br>
<br>
if [ "$DIFF_POOL_METADATA_SNAP" == "-" ]<br>
then<br>
 (&gt;&amp;2 echo "Failed to create thin pool metadata snapshot.")<br>
 exit 1<br>
fi<br>
<br>
#We keep output in variable because metadata snapshot need to be released early.<br>
DIFF_DATA=$(thin_delta -m$DIFF_POOL_METADATA_SNAP --snap1 $DIFF_SOURCE_ID --snap2 $DIFF_TARGET_ID $DIFF_POOL_PATH_TMETA)<br>
<br>
dmsetup message $DIFF_POOL_PATH_TPOOL 0 release_metadata_snap<br>
<br>
echo $"$DIFF_DATA" | grep -E 'different|left_only|right_only' | sed 's/&lt;/"/g' | sed 's/ /"/g' | awk -F'\"' '{print $6 "\t" $8 "\t" $11}' | sed 's/different/copy/g' | sed 's/left_only/copy/g' | sed 's/right_only/discard/g'<br>
<br>
}<br>
<br>
function thinsync()<br>
{<br>
SYNC_VG="$1"<br>
SYNC_PEND="$2"<br>
SYNC_BASE="$3"<br>
SYNC_TARGET="$4"<br>
SYNC_PEND_POOL=$(read_pool_lv $SYNC_VG $SYNC_PEND)<br>
SYNC_BLOCK_SIZE=$(read_lv_chunk_size $SYNC_VG $SYNC_PEND_POOL)<br>
SYNC_PEND_PATH=$(read_lv_dm_path $SYNC_VG $SYNC_PEND)<br>
<br>
activate_volume $SYNC_VG $SYNC_PEND<br>
<br>
while read -r SYNC_ACTION SYNC_OFFSET SYNC_LENGTH ; do<br>
 SYNC_OFFSET_BYTES=$((SYNC_OFFSET * SYNC_BLOCK_SIZE))<br>
 SYNC_LENGTH_BYTES=$((SYNC_LENGTH * SYNC_BLOCK_SIZE))<br>
 if [ "$SYNC_ACTION" == "copy" ]<br>
 then<br>
 ddrescue --quiet --force --input-position=$SYNC_OFFSET_BYTES --output-position=$SYNC_OFFSET_BYTES --size=$SYNC_LENGTH_BYTES "$SYNC_PEND_PATH" "$SYNC_TARGET"<br>
 fi<br>
<br>
if [ "$SYNC_ACTION" == "discard" ]<br>
 then<br>
 blkdiscard -o $SYNC_OFFSET_BYTES -l $SYNC_LENGTH_BYTES "$SYNC_TARGET"<br>
 fi<br>
done &lt; &lt;(thindiff "$SYNC_VG" "$SYNC_PEND" "$SYNC_BASE")<br>
}<br>
<br>
function discard_volume()<br>
{<br>
DISCARD_VG="$1"<br>
DISCARD_LV="$2"<br>
DISCARD_LV_PATH=$(read_lv_dm_path "$DISCARD_VG" "$DISCARD_LV")<br>
if [ "$DISCARD_LV_PATH" != "" ]<br>
then<br>
 echo "$DISCARD_LV_PATH found"<br>
else<br>
 echo "$DISCARD_LV not found in $DISCARD_VG"<br>
 exit 1<br>
fi<br>
DISCARD_LV_POOL=$(read_pool_lv $DISCARD_VG $DISCARD_LV)<br>
DISCARD_LV_SIZE=$(read_lv_size "$DISCARD_VG" "$DISCARD_LV")<br>
lvremove -y --quiet "$DISCARD_LV_PATH" || exit 1<br>
lvcreate --thin-pool "$DISCARD_LV_POOL" -V "$DISCARD_LV_SIZE"B --name "$DISCARD_LV" "$DISCARD_VG" || exit 1<br>
}<br>
<br>
function backup()<br>
{<br>
SOURCE_VG="$1"<br>
SOURCE_LV="$2"<br>
TARGET_VG="$BACKUPS"<br>
TARGET_LV="$SOURCE_VG-$SOURCE_LV"<br>
SOURCE_BASE_LV="$SOURCE_LV$BASE_SUFFIX"<br>
TARGET_BASE_LV="$TARGET_LV$BASE_SUFFIX"<br>
SOURCE_PEND_LV="$SOURCE_LV$PEND_SUFFIX"<br>
TARGET_PEND_LV="$TARGET_LV$PEND_SUFFIX"<br>
SOURCE_BASE_LV_PATH=$(read_lv_dm_path "$SOURCE_VG" "$SOURCE_BASE_LV")<br>
SOURCE_PEND_LV_PATH=$(read_lv_dm_path "$SOURCE_VG" "$SOURCE_PEND_LV")<br>
TARGET_BASE_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_BASE_LV")<br>
TARGET_PEND_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_PEND_LV")<br>
<br>
if [ "$SOURCE_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$SOURCE_BASE_LV_PATH found"<br>
 else<br>
 echo "Source base not found creating snapshot of $SOURCE_VG/$SOURCE_LV to $SOURCE_VG/$SOURCE_BASE_LV"<br>
 lvcreate --quiet --snapshot --name "$SOURCE_BASE_LV" "$SOURCE_VG/$SOURCE_LV" || exit 1<br>
 SOURCE_BASE_LV_PATH=$(read_lv_dm_path "$SOURCE_VG" "$SOURCE_BASE_LV")<br>
 activate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
 echo "Discarding $SOURCE_BASE_LV_PATH as we need to bootstrap."<br>
 SOURCE_BASE_POOL=$(read_pool_lv $SOURCE_VG $SOURCE_BASE_LV)<br>
 SOURCE_BASE_CHUNK_SIZE=$(read_lv_chunk_size $SOURCE_VG $SOURCE_BASE_POOL)<br>
 discard_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
 sync<br>
 if [ "$TARGET_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$TARGET_BASE_LV_PATH found out of sync with source... removing..."<br>
 lvremove -y --quiet $TARGET_BASE_LV_PATH || exit 1<br>
 TARGET_BASE_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_BASE_LV")<br>
 sync<br>
 fi<br>
 fi<br>
SOURCE_BASE_SIZE=$(read_lv_size "$SOURCE_VG" "$SOURCE_BASE_LV")<br>
 if [ "$TARGET_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$TARGET_BASE_LV_PATH found"<br>
 else<br>
 echo "$TARGET_VG/$TARGET_LV not found. Creating empty volume."<br>
 lvcreate --thin-pool "$BACKUPS_POOL" -V "$SOURCE_BASE_SIZE"B --name "$TARGET_BASE_LV" "$TARGET_VG" || exit 1<br>
 echo "Have to rebootstrap. Discarding source at $SOURCE_BASE_LV_PATH"<br>
 activate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
 SOURCE_BASE_POOL=$(read_pool_lv $SOURCE_VG $SOURCE_BASE_LV)<br>
 SOURCE_BASE_CHUNK_SIZE=$(read_lv_chunk_size $SOURCE_VG $SOURCE_BASE_POOL)<br>
 discard_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
 TARGET_BASE_POOL=$(read_pool_lv $TARGET_VG $TARGET_BASE_LV)<br>
 TARGET_BASE_CHUNK_SIZE=$(read_lv_chunk_size $TARGET_VG $TARGET_BASE_POOL)<br>
 TARGET_BASE_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_BASE_LV")<br>
 echo "Discarding target at $TARGET_BASE_LV_PATH"<br>
 discard_volume "$TARGET_VG" "$TARGET_BASE_LV"<br>
 sync<br>
 fi<br>
 if [ "$SOURCE_PEND_LV_PATH" != "" ]<br>
 then<br>
 echo "$SOURCE_PEND_LV_PATH found removing..."<br>
 lvremove -y --quiet "$SOURCE_PEND_LV_PATH" || exit 1<br>
 sync<br>
 fi<br>
 lvcreate --quiet --snapshot --name "$SOURCE_PEND_LV" "$SOURCE_VG/$SOURCE_LV" || exit 1<br>
SOURCE_PEND_LV_PATH=$(read_lv_dm_path "$SOURCE_VG" "$SOURCE_PEND_LV")<br>
 sync<br>
 if [ "$TARGET_PEND_LV_PATH" != "" ]<br>
 then<br>
 echo "$TARGET_PEND_LV_PATH found removing..."<br>
 lvremove -y --quiet $TARGET_PEND_LV_PATH<br>
 sync<br>
 fi<br>
 lvcreate --quiet --snapshot --name "$TARGET_PEND_LV" "$TARGET_VG/$TARGET_BASE_LV" || exit 1<br>
TARGET_PEND_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_PEND_LV")<br>
SOURCE_PEND_LV_SIZE=$(read_lv_size "$SOURCE_VG" "$SOURCE_PEND_LV")<br>
 lvresize -L "$SOURCE_PEND_LV_SIZE"B "$TARGET_PEND_LV_PATH"<br>
 activate_volume "$TARGET_VG" "$TARGET_PEND_LV"<br>
 echo "Synching $SOURCE_PEND_LV_PATH to $TARGET_PEND_LV_PATH"<br>
 thinsync "$SOURCE_VG" "$SOURCE_PEND_LV" "$SOURCE_BASE_LV" "$TARGET_PEND_LV_PATH" || exit 1<br>
 sync<br>
<br>
TARGET_DATE_SUFFIX=$(suffix)<br>
 lvcreate --quiet --snapshot --name "$TARGET_LV$TARGET_DATE_SUFFIX" "$TARGET_VG/$TARGET_PEND_LV" || exit 1<br>
 sync<br>
 lvremove --quiet -y "$SOURCE_BASE_LV_PATH" || exit 1<br>
 sync<br>
 lvremove --quiet -y "$TARGET_BASE_LV_PATH" || exit 1<br>
 sync<br>
 lvrename -y "$SOURCE_VG/$SOURCE_PEND_LV" "$SOURCE_BASE_LV" || exit 1<br>
 lvrename -y "$TARGET_VG/$TARGET_PEND_LV" "$TARGET_BASE_LV" || exit 1<br>
 sync<br>
 deactivate_volume "$TARGET_VG" "$TARGET_BASE_LV"<br>
 deactivate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
}<br>
<br>
function verify()<br>
{<br>
SOURCE_VG="$1"<br>
SOURCE_LV="$2"<br>
TARGET_VG="$BACKUPS"<br>
TARGET_LV="$SOURCE_VG-$SOURCE_LV"<br>
SOURCE_BASE_LV="$SOURCE_LV$BASE_SUFFIX"<br>
TARGET_BASE_LV="$TARGET_LV$BASE_SUFFIX"<br>
TARGET_BASE_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_BASE_LV")<br>
SOURCE_BASE_LV_PATH=$(read_lv_dm_path "$SOURCE_VG" "$SOURCE_BASE_LV")<br>
<br>
if [ "$SOURCE_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$SOURCE_BASE_LV_PATH found"<br>
 else<br>
 echo "$SOURCE_BASE_LV_PATH not found"<br>
 exit 1<br>
 fi<br>
 if [ "$TARGET_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$TARGET_BASE_LV_PATH found"<br>
 else<br>
 echo "$TARGET_BASE_LV_PATH not found"<br>
 exit 1<br>
 fi<br>
 activate_volume "$TARGET_VG" "$TARGET_BASE_LV"<br>
 activate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
 echo Comparing "$SOURCE_BASE_LV_PATH" with "$TARGET_BASE_LV_PATH"<br>
 cmp "$SOURCE_BASE_LV_PATH" "$TARGET_BASE_LV_PATH"<br>
 echo Done...<br>
 deactivate_volume "$TARGET_VG" "$TARGET_BASE_LV"<br>
 deactivate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
}<br>
<br>
function resync()<br>
{<br>
SOURCE_VG="$1"<br>
SOURCE_LV="$2"<br>
TARGET_VG="$BACKUPS"<br>
TARGET_LV="$SOURCE_VG-$SOURCE_LV"<br>
SOURCE_BASE_LV="$SOURCE_LV$BASE_SUFFIX"<br>
TARGET_BASE_LV="$TARGET_LV$BASE_SUFFIX"<br>
TARGET_BASE_LV_PATH=$(read_lv_dm_path "$TARGET_VG" "$TARGET_BASE_LV")<br>
SOURCE_BASE_LV_PATH=$(read_lv_dm_path "$SOURCE_VG" "$SOURCE_BASE_LV")<br>
<br>
if [ "$SOURCE_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$SOURCE_BASE_LV_PATH found"<br>
 else<br>
 echo "$SOURCE_BASE_LV_PATH not found"<br>
 exit 1<br>
 fi<br>
 if [ "$TARGET_BASE_LV_PATH" != "" ]<br>
 then<br>
 echo "$TARGET_BASE_LV_PATH found"<br>
 else<br>
 echo "$TARGET_BASE_LV_PATH not found"<br>
 exit 1<br>
 fi<br>
 activate_volume "$TARGET_VG" "$TARGET_BASE_LV"<br>
 activate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
 SOURCE_BASE_POOL=$(read_pool_lv $SOURCE_VG $SOURCE_BASE_LV)<br>
 SYNC_BLOCK_SIZE=$(read_lv_chunk_size $SOURCE_VG $SOURCE_BASE_POOL)<br>
<br>
echo Syncronizing "$SOURCE_BASE_LV_PATH" to "$TARGET_BASE_LV_PATH"<br>
<br>
CMP_OFFSET=0<br>
 while [[ "$CMP_OFFSET" != "" ]] ; do<br>
 CMP_MISMATCH=$(cmp -i "$CMP_OFFSET" "$SOURCE_BASE_LV_PATH" "$TARGET_BASE_LV_PATH" | grep differ | awk '{print $5}' | sed 's/,//g' )<br>
 if [[ "$CMP_MISMATCH" != "" ]] ; then<br>
 CMP_OFFSET=$(( CMP_MISMATCH + CMP_OFFSET ))<br>
 SYNC_OFFSET_BYTES=$(( ( CMP_OFFSET / SYNC_BLOCK_SIZE ) * SYNC_BLOCK_SIZE ))<br>
 SYNC_LENGTH_BYTES=$(( SYNC_BLOCK_SIZE ))<br>
 echo "Synching $SYNC_LENGTH_BYTES bytes at $SYNC_OFFSET_BYTES from $SOURCE_BASE_LV_PATH to $TARGET_BASE_LV_PATH"<br>
 ddrescue --quiet --force --input-position=$SYNC_OFFSET_BYTES --output-position=$SYNC_OFFSET_BYTES --size=$SYNC_LENGTH_BYTES "$SOURCE_BASE_LV_PATH" "$TARGET_BASE_LV_PATH"<br>
 else<br>
 CMP_OFFSET=""<br>
 fi<br>
 done<br>
 echo Done...<br>
 deactivate_volume "$TARGET_VG" "$TARGET_BASE_LV"<br>
 deactivate_volume "$SOURCE_VG" "$SOURCE_BASE_LV"<br>
}<br>
<br>
function list()<br>
{<br>
LIST_SOURCE_VG="$1"<br>
LIST_SOURCE_LV="$2"<br>
LIST_TARGET_VG="$BACKUPS"<br>
LIST_TARGET_LV="$LIST_SOURCE_VG-$LIST_SOURCE_LV"<br>
LIST_TARGET_BASE_LV="$LIST_TARGET_LV$SNAP_SUFFIX"<br>
lvs -olv_name | grep "$LIST_TARGET_BASE_LV.$DATE_REGEX"<br>
}<br>
<br>
function remove()<br>
{<br>
REMOVE_TARGET_VG="$BACKUPS"<br>
REMOVE_TARGET_LV="$1"<br>
lvremove -y "$REMOVE_TARGET_VG/$REMOVE_TARGET_LV"<br>
sync<br>
}<br>
<br>
function removeall()<br>
{<br>
DATE_OFFSET="$3"<br>
FILTER="$(filter "$DATE_OFFSET")"<br>
while read -r SNAPSHOT ; do<br>
 remove "$SNAPSHOT"<br>
done &lt; &lt;(list "$1" "$2" | grep "$FILTER")<br>
<br>
}<br>
<br>
(<br>
 COMMAND="$1"<br>
 shift<br>
 <br>
 case "$COMMAND" in<br>
 "--help") <br>
 echo "Help"<br>
 ;;<br>
 "suffix") <br>
 suffix<br>
 ;;<br>
 "filter") <br>
 filter "$1"<br>
 ;;<br>
 "backup") <br>
 wait_lock_or_terminate<br>
 backup "$1" "$2"<br>
 ;;<br>
 "list") <br>
 list "$1" "$2"<br>
 ;;<br>
 "thindiff") <br>
 thindiff "$1" "$2" "$3"<br>
 ;;<br>
 "thinsync") <br>
 thinsync "$1" "$2" "$3" "$4"<br>
 ;;<br>
 "verify") <br>
 wait_lock_or_terminate<br>
 verify "$1" "$2"<br>
 ;;<br>
 "resync") <br>
 wait_lock_or_terminate<br>
 resync "$1" "$2"<br>
 ;;<br>
 "remove") <br>
 wait_lock_or_terminate<br>
 remove "$1"<br>
 ;;<br>
 "removeall") <br>
 wait_lock_or_terminate<br>
 removeall "$1" "$2" "$3"<br>
 ;;<br>
 *)<br>
 echo "None.."<br>
 ;;<br>
 esac<br>
) 98&gt;$LOCK_FILE <br>
<br>
EOF<br>
</code><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреНрдпрд╛ рдХрд░ рд░рд╣рд╛ рд╣реИрдВ ...?</font></font></b><div class="spoiler_text">             ,   thin_delta,       ddrescue  blkdiscard.<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдПрдХ рдФрд░ рдкрдЯрдХрдерд╛ рдЬрд┐рд╕реЗ рд╣рдо рдореБрдХреБрдЯ рдореЗрдВ рдкрд┐рд░реЛрдПрдВрдЧреЗ:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдЫ рдФрд░ рдмреИрд╢</font></font></b><div class="spoiler_text"><code>#cat &gt;/root/lvm-thin-backup/cron-daily.sh &lt;&lt; EOF<br>
#!/bin/bash<br>
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"<br>
<br>
SCRIPT_FILE="$(realpath $0)"<br>
SCRIPT_DIR="$(dirname $SCRIPT_FILE)"<br>
SCRIPT_NAME="$(basename -s .sh $SCRIPT_FILE)"<br>
<br>
BACKUP_SCRIPT="$SCRIPT_DIR/lvm-thin-backup.sh"<br>
RETENTION="-60 days"<br>
<br>
$BACKUP_SCRIPT backup images linux-dev<br>
$BACKUP_SCRIPT backup images win8<br>
$BACKUP_SCRIPT backup images win8-data<br>
#etc<br>
<br>
$BACKUP_SCRIPT removeall images linux-dev "$RETENTION"<br>
$BACKUP_SCRIPT removeall images win8 "$RETENTION"<br>
$BACKUP_SCRIPT removeall images win8-data "$RETENTION"<br>
#etc<br>
<br>
EOF<br>
</code><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреНрдпрд╛ рдХрд░ рд░рд╣рд╛ рд╣реИрдВ ...?</font></font></b><div class="spoiler_text">  ,         .      ,        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдкрддрд▓реА рд╡реЙрд▓реНрдпреВрдо рдХреА рдПрдХ рд╕реВрдЪреА рдХрд╛ рд╕рдВрдХреЗрдд рдорд┐рд▓рддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдмреИрдХрдЕрдк рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рджрд┐рдП рдЧрдП рдирд╛рдо рдХреЗрд╡рд▓ рдЪрд┐рддреНрд░рдг рдкреНрд░рдпреЛрдЬрдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ, рддреЛ рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕рднреА рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░реЗрдЧрд╛ред </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЖрдЗрдП рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ: </font><font style="vertical-align: inherit;">
рдореБрдХреБрдЯ рдореЗрдВ рдЪреЗрдХ рдФрд░ рд░рдЯрдирд╛: </font><font style="vertical-align: inherit;">
рдкрд╣рд▓рд╛ рд▓реЙрдиреНрдЪ рд▓рдВрдмрд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ </font><font style="vertical-align: inherit;">рдкрддрд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕реНрдерд╛рди рдХреА рдирдХрд▓ рдХрд░рдХреЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">LVM рдкрддрд▓реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реЗ рдмреНрд▓реЙрдХ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдкрддрд▓реЗ рд╡реЙрд▓реНрдпреВрдо рдХреЗ рдХреЗрд╡рд▓ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдмреНрд▓реЙрдХ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдИ рдЬрд╛рдПрдЧреАред </font><font style="vertical-align: inherit;">
рдЗрд╕рдХреЗ рдмрд╛рдж рдХреЗ рдкреНрд░рдХреНрд╖реЗрдкрдг LVM рдкрддрд▓реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдХреЙрдкреА рдХрд░реЗрдВрдЧреЗред</font></font><br>
<br>
<code>#chmod +x /root/lvm-thin-backup/cron-daily.sh<br>
#chmod +x /root/lvm-thin-backup/lvm-thin-backup.sh</code><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<code>#/usr/bin/nice -n 19 /usr/bin/ionice -c 3 /root/lvm-thin-backup/cron-daily.sh 2&gt;&amp;1 | /usr/bin/logger -t lvm-thin-backup<br>
#cat /var/log/syslog | grep lvm-thin-backup<br>
#crontab -e<br>
0 3 * * * /usr/bin/nice -n 19 /usr/bin/ionice -c 3 /root/lvm-thin-backup/cron-daily.sh 2&gt;&amp;1 | /usr/bin/logger -t lvm-thin-backup<br>
</code><br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЗрдЦрддреЗ рд╣реИ рдХреНрдпрд╛ рд╣реБрдЖ:</font></font></h3><br>
<code>#time /root/btrfs-backup/cron-daily.sh<br>
real 0m2,967s<br>
user 0m0,225s<br>
sys 0m0,353s<br>
<br>
#time /root/lvm-thin-backup/cron-daily.sh<br>
real 1m2,710s<br>
user 0m12,721s<br>
sys 0m6,671s<br>
<br>
#ls -al /backup/btrfs/back/remote/*<br>
/backup/btrfs/back/remote/boot:<br>
total 0<br>
drwxr-xr-x 1 root root 1260  26 09:11 .<br>
drwxr-xr-x 1 root root 16  6 09:30 ..<br>
drwxr-xr-x 1 root root 322  26 02:00 .@base<br>
drwxr-xr-x 1 root root 516  6 09:39 .@snap.2020-03-06-09-39-37<br>
drwxr-xr-x 1 root root 516  6 09:39 .@snap.2020-03-06-09-39-57<br>
...<br>
/backup/btrfs/back/remote/root:<br>
total 0<br>
drwxr-xr-x 1 root root 2820  26 09:11 .<br>
drwxr-xr-x 1 root root 16  6 09:30 ..<br>
drwxr-xr-x 1 root root 240  26 09:11 @.@base<br>
drwxr-xr-x 1 root root 22  26 09:11 @home.@base<br>
drwxr-xr-x 1 root root 22  6 09:39 @home.@snap.2020-03-06-09-39-35<br>
drwxr-xr-x 1 root root 22  6 09:39 @home.@snap.2020-03-06-09-39-57<br>
...<br>
drwxr-xr-x 1 root root 240  6 09:39 @.@snap.2020-03-06-09-39-26<br>
drwxr-xr-x 1 root root 240  6 09:39 @.@snap.2020-03-06-09-39-56<br>
...<br>
<br>
#lvs -olv_name,lv_size images &amp;&amp; lvs -olv_name,lv_size backup<br>
 LV LSize <br>
 linux-dev 128,00g<br>
 linux-dev.base 128,00g<br>
 thin-pool 1,38t<br>
 win8 128,00g<br>
 win8-data 2,00t<br>
 win8-data.base 2,00t<br>
 win8.base 128,00g<br>
 LV LSize <br>
 backup 256,00g<br>
 images-linux-dev.base 128,00g<br>
 images-linux-dev.snap.2020-03-08-10-09-11 128,00g<br>
 images-linux-dev.snap.2020-03-08-10-09-25 128,00g<br>
...<br>
 images-win8-data.base 2,00t<br>
 images-win8-data.snap.2020-03-16-14-11-55 2,00t<br>
 images-win8-data.snap.2020-03-16-14-19-50 2,00t<br>
...<br>
 images-win8.base 128,00g<br>
 images-win8.snap.2020-03-17-04-51-46 128,00g<br>
 images-win8.snap.2020-03-18-03-02-49 128,00g<br>
...<br>
 thin-pool &lt;2,09t<br>
</code><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдШреЛрдВрд╕рд▓реЗ рдХреЗ рд╢рд┐рдХрд╛рд░ рдЧреБрдбрд╝рд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдПрд▓рд╡реАрдПрдо рдПрд▓рд╡реА рддрд╛рд░реНрдХрд┐рдХ рд╡реЙрд▓реНрдпреВрдо рдЕрдиреНрдп рд╡реАрдЬреА рдХреЗ рд▓рд┐рдП рднреМрддрд┐рдХ рдПрд▓рд╡реАрдПрдо рдкреАрд╡реА рд╡реЙрд▓реНрдпреВрдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">LVM рдкреБрдирд░рд╛рд╡рд░реНрддреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдШреЛрдВрд╕рд▓реЗ рдХреЗ рд╢рд┐рдХрд╛рд░ рдЧреБрдбрд╝рд┐рдпрд╛ рдХреА рддрд░рд╣ред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ LVM рдХреЛ рдЕрддреНрдпрдзрд┐рдХ рд▓рдЪреАрд▓рд╛рдкрди рдорд┐рд▓рддрд╛ рд╣реИред</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрдирд╢реНрдЪ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
рдЕрдЧрд▓реЗ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рд╣реЛрдо рдбреЗрд╕реНрдХрдЯреЙрдк, рд╣реЛрдо рдЗрдВрдЯрд░рдиреЗрдЯ рдФрд░ рдкреА 2 рдкреА рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдИ рдорд╣рд╛рджреНрд╡реАрдкреЛрдВ рдкрд░ рдЕрддрд┐рд░реЗрдХ рдХреЗ рд╕рд╛рде рднреВ-рд╡рд┐рддрд░рд┐рдд рднрдВрдбрд╛рд░рдг / рд╡реАрдПрдо рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдиреЗ рдХреЗ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрдИ рд╕рдорд╛рди рдореЛрдмрд╛рдЗрд▓ рд╕реНрдЯреЛрд░реЗрдЬ рд╕рд┐рд╕реНрдЯрдо / рдХреЗрд╡реАрдПрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗред</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi492820/index.html">.Net Core Api: рд╡рд┐рднрд┐рдиреНрди рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛</a></li>
<li><a href="../hi492822/index.html">рд╕реАрдПрд╕рдПрд╕ рдбреЗрд╡рд▓рдкрд░реНрд╕ - рджреБрдирд┐рдпрд╛ рдХреЛ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ?</a></li>
<li><a href="../hi492828/index.html">рдХреИрд╕реЗ рдПрдХ рдмрдВрдж рджреБрдирд┐рдпрд╛ рдореЗрдВ рдЬреАрд╡рд┐рдд рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi492830/index.html">рд╕рдорд╛рди рд░реВрдк рд╕реЗ = рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд▓рдХреНрд╖реНрдордг - рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреНрд░реЛрдо 80 рд╕реНрдерд┐рд░ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрднреА рддрдХ рд╕рднреА рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ)</a></li>
<li><a href="../hi492832/index.html">I.MX6 рдФрд░ рд▓рд┐рдирдХреНрд╕ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдФрджреНрдпреЛрдЧрд┐рдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд▓рд┐рдП IoT- рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░</a></li>
<li><a href="../hi492838/index.html">M5Stack рдХреЛ рдЯреАрд╡реА рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ</a></li>
<li><a href="../hi492844/index.html">рдХреИрд╕реЗ рдХрд▓реНрдкрдирд╛ рдФрд░ рдЪреЗрддрди (рднреВрднреМрддрд┐рдХреАрдп) рдореЙрдбрд▓ред 3 рдбреА рдПрдиреАрдореЗрд╢рди рдФрд░ 4 рдбреА рдбреЗрдЯрд╛ рдХрд╛ рджреГрд╢реНрдп</a></li>
<li><a href="../hi492850/index.html">рд╣рд░ рдХреЛрдИ рд░рд┐рдореЛрдЯ рдХрд╛рдо рдкрд░ рдирд╣реАрдВ рдЬрд╛рдирд╛ рдЪрд╛рд╣рддрд╛</a></li>
<li><a href="../hi492856/index.html">Covid19, рдЖрдкрдХрд╛ рд╕рдорд╛рдЬ рдФрд░ рдЖрдк рдбреЗрдЯрд╛ рд╕рд╛рдЗрдВрд╕ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рд╣реИрдВред рдЬреЗрд░реЗрдореА рд╣рд╛рд╡рд░реНрдб рдФрд░ рд░рд╛рд╣реЗрд▓ рдереЙрдорд╕ (fast.ai) рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд╡рд╛рджрд┐рдд рд▓реЗрдЦ</a></li>
<li><a href="../hi492862/index.html">рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП 15 рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдУрд░реЗрдХрд▓ рдЕрдкреЗрдХреНрд╕ рдкреНрд░рджрд░реНрд╢рди рдЯреНрдпреВрдирд┐рдВрдЧ рдЯрд┐рдкреНрд╕</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>