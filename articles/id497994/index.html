<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§’ğŸ¿ ğŸƒ â›ï¸ Analisis mekanika bahasa lolos ğŸ›¢ï¸ ğŸ¿ï¸ ğŸ—ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendahuluan
 Ini adalah artikel kedua dari empat artikel yang akan memberikan wawasan tentang mekanisme dan desain pointer, tumpukan, tumpukan, analis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Analisis mekanika bahasa lolos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497994/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pendahuluan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini adalah artikel kedua dari empat artikel yang akan memberikan wawasan tentang mekanisme dan desain pointer, tumpukan, tumpukan, analisis pelarian, dan semantik Go / Value. </font><font style="vertical-align: inherit;">Posting ini tentang tumpukan dan analisis melarikan diri. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daftar Isi:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mekanika Bahasa Di Stacks And Pointer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terjemahan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mekanika Bahasa Pada Analisis Escape</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mekanika Bahasa Tentang Memori</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desain Filosofi Pada Data Dan Semantik</font></font></a></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pengantar</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam posting pertama dalam seri ini, saya berbicara tentang dasar-dasar mekanika pointer menggunakan contoh di mana nilai didistribusikan di tumpukan antara goroutine. Saya tidak menunjukkan kepada Anda apa yang terjadi ketika Anda membagi nilai pada tumpukan. Untuk memahami ini, Anda perlu mencari tahu tentang area memori lain di mana nilainya mungkin: tentang "tumpukan". Dengan pengetahuan ini, Anda dapat mulai mempelajari "analisis pelarian".</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisis melarikan diri adalah proses yang digunakan kompiler untuk menentukan penempatan nilai yang dibuat oleh program Anda. </font><font style="vertical-align: inherit;">Khususnya, kompiler melakukan analisis kode statis untuk menentukan apakah nilai dapat ditempatkan pada bingkai tumpukan untuk fungsi yang membangunnya, atau jika nilai harus "lolos" ke tumpukan. </font><font style="vertical-align: inherit;">Tidak ada kata kunci atau fungsi tunggal di Go yang dapat Anda gunakan untuk memberi tahu kompiler keputusan yang harus diambil. </font><font style="vertical-align: inherit;">Hanya cara Anda menulis kode secara kondisional yang memungkinkan Anda untuk memengaruhi keputusan ini.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tumpukan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tumpukan adalah area memori kedua, selain tumpukan, yang digunakan untuk menyimpan nilai. Tumpukannya tidak membersihkan sendiri seperti tumpukan, jadi menggunakan memori ini lebih mahal. Pertama-tama, biaya terkait dengan pengumpul sampah, yang harus menjaga daerah ini bersih. Ketika GC dimulai, ia akan menggunakan 25% daya prosesor Anda yang tersedia. Selain itu, ini berpotensi dapat membuat mikrodetik dari penundaan "hentikan dunia". Keuntungan memiliki GC adalah Anda tidak perlu khawatir mengelola memori tumpukan yang secara historis rumit dan rawan kesalahan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nilai-nilai di tumpukan memprovokasi alokasi memori di Go. </font><font style="vertical-align: inherit;">Alokasi ini memberi tekanan pada GC karena setiap nilai di heap yang tidak lagi mengacu pada pointer harus dihapus. </font><font style="vertical-align: inherit;">Semakin banyak nilai yang perlu Anda periksa dan hapus, semakin banyak pekerjaan yang harus dilakukan GC pada setiap awal. </font><font style="vertical-align: inherit;">Oleh karena itu, algoritma stimulasi terus bekerja untuk menyeimbangkan ukuran tumpukan dan kecepatan eksekusi.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berbagi tumpukan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di Go, tidak ada goroutine yang diizinkan memiliki penunjuk yang menunjuk ke memori di tumpukan goroutine lain. </font><font style="vertical-align: inherit;">Hal ini disebabkan oleh fakta bahwa memori tumpukan untuk goroutine dapat diganti dengan blok memori baru, ketika tumpukan harus meningkat atau berkurang. </font><font style="vertical-align: inherit;">Jika pada saat run time Anda harus melacak pointer stack di goroutine lain, Anda harus mengelola terlalu banyak, dan penundaan "hentikan dunia" ketika memperbarui pointer ke tumpukan ini akan mengejutkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah contoh tumpukan yang diganti beberapa kali karena pertumbuhan. </font><font style="vertical-align: inherit;">Lihatlah output di baris 2 dan 6. Anda akan melihat dua kali perubahan alamat dari nilai string di dalam frame stack utama. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">play.golang.org/p/pxn5u4EBSI</font></font></a> <br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mekanik melarikan diri</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap kali nilai dibagi di luar wilayah bingkai tumpukan fungsi, itu ditempatkan (atau dialokasikan) di heap. Tugas algoritma melarikan diri analisis adalah untuk menemukan situasi seperti itu dan menjaga tingkat integritas dalam program. Integritas adalah untuk memastikan bahwa akses ke nilai apa pun selalu akurat, konsisten, dan efisien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lihatlah contoh ini untuk mempelajari mekanisme dasar analisis pelarian. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">play.golang.org/p/Y_VZxYteKO</font></font></a> <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Listing 1</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">01</span> <span class="hljs-keyword">package</span> main
<span class="hljs-number">02</span>
<span class="hljs-number">03</span> <span class="hljs-keyword">type</span> user <span class="hljs-keyword">struct</span> {
<span class="hljs-number">04</span>     name  <span class="hljs-keyword">string</span>
<span class="hljs-number">05</span>     email <span class="hljs-keyword">string</span>
<span class="hljs-number">06</span> }
<span class="hljs-number">07</span>
<span class="hljs-number">08</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
<span class="hljs-number">09</span>     u1 := createUserV1()
<span class="hljs-number">10</span>     u2 := createUserV2()
<span class="hljs-number">11</span>
<span class="hljs-number">12</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"u1"</span>, &amp;u1, <span class="hljs-string">"u2"</span>, &amp;u2)
<span class="hljs-number">13</span> }
<span class="hljs-number">14</span>
<span class="hljs-number">15</span> <span class="hljs-comment">//go:noinline</span>
<span class="hljs-number">16</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV1</span><span class="hljs-params">()</span> <span class="hljs-title">user</span></span> {
<span class="hljs-number">17</span>     u := user{
<span class="hljs-number">18</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">19</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">20</span>     }
<span class="hljs-number">21</span>
<span class="hljs-number">22</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V1"</span>, &amp;u)
<span class="hljs-number">23</span>     <span class="hljs-keyword">return</span> u
<span class="hljs-number">24</span> }
<span class="hljs-number">25</span>
<span class="hljs-number">26</span> <span class="hljs-comment">//go:noinline</span>
<span class="hljs-number">27</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV2</span><span class="hljs-params">()</span> *<span class="hljs-title">user</span></span> {
<span class="hljs-number">28</span>     u := user{
<span class="hljs-number">29</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">30</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">31</span>     }
<span class="hljs-number">32</span>
<span class="hljs-number">33</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V2"</span>, &amp;u)
<span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> &amp;u
<span class="hljs-number">35</span> }</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya menggunakan perintah go: noinline sehingga kompiler tidak menyematkan kode untuk fungsi-fungsi ini secara langsung di utama. Menanamkan akan menghapus panggilan fungsi dan memperumit contoh ini. Saya akan berbicara tentang efek samping dari penanaman di posting berikutnya.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Listing 1 menunjukkan program dengan dua fungsi berbeda yang menciptakan nilai tipe pengguna dan mengembalikannya ke pemanggil. Versi pertama dari fungsi ini menggunakan semantik nilai saat kembali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 2</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">16</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV1</span><span class="hljs-params">()</span> <span class="hljs-title">user</span></span> {
<span class="hljs-number">17</span>     u := user{
<span class="hljs-number">18</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">19</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">20</span>     }
<span class="hljs-number">21</span>
<span class="hljs-number">22</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V1"</span>, &amp;u)
<span class="hljs-number">23</span>     <span class="hljs-keyword">return</span> u
<span class="hljs-number">24</span> }</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya mengatakan bahwa fungsi menggunakan semantik nilai ketika kembali, karena nilai tipe pengguna yang dibuat oleh fungsi ini disalin dan diteruskan ke tumpukan panggilan. Ini berarti bahwa fungsi panggilan menerima salinan dari nilai itu sendiri.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anda dapat melihat pembuatan nilai tipe pengguna, dieksekusi pada baris 17 hingga 20. Kemudian, pada baris 23, salinan nilai diteruskan ke tumpukan panggilan dan dikembalikan ke pemanggil. Setelah mengembalikan fungsi, tumpukan terlihat sebagai berikut. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar 1 </font></font><br>
<br>
<img src="https://habrastorage.org/webt/hs/me/pj/hsmepjswe1d_ggonuc8jkwscyk8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada Gambar 1, Anda dapat melihat bahwa nilai tipe pengguna ada di kedua frame setelah memanggil createUserV1. Dalam versi kedua dari fungsi, semantik pointer digunakan untuk kembali. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 3</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">27</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV2</span><span class="hljs-params">()</span> *<span class="hljs-title">user</span></span> {
<span class="hljs-number">28</span>     u := user{
<span class="hljs-number">29</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">30</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">31</span>     }
<span class="hljs-number">32</span>
<span class="hljs-number">33</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V2"</span>, &amp;u)
<span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> &amp;u
<span class="hljs-number">35</span> }</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya mengatakan bahwa fungsi menggunakan pointer semantik ketika kembali, karena nilai tipe pengguna yang dibuat oleh fungsi ini dibagi oleh tumpukan panggilan. Ini berarti bahwa fungsi panggilan menerima salinan alamat tempat nilai-nilai itu berada.</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Anda dapat melihat struktur literal yang sama yang digunakan dalam baris 28 hingga 31 untuk membuat nilai tipe pengguna, tetapi pada baris 34 pengembalian dari fungsi berbeda. Alih-alih meneruskan salinan nilai kembali ke tumpukan panggilan, salinan alamat untuk nilai diteruskan. Berdasarkan ini, Anda mungkin berpikir bahwa setelah panggilan tumpukan terlihat seperti ini. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar 2</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mu/ld/nh/muldnhq-xncjaz97pv-647tybme.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika apa yang Anda lihat pada Gambar 2 benar-benar terjadi, Anda akan memiliki masalah integritas. </font><font style="vertical-align: inherit;">Pointer menunjuk ke tumpukan panggilan ke memori yang tidak lagi valid. </font><font style="vertical-align: inherit;">Lain kali fungsi dipanggil, memori yang ditunjukkan akan diformat ulang dan diinisialisasi ulang. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sinilah analisis pelarian mulai mempertahankan integritas. </font><font style="vertical-align: inherit;">Dalam kasus ini, kompiler akan menentukan bahwa tidak aman untuk membuat nilai tipe pengguna di dalam bingkai stack createUserV2, jadi alih-alih itu akan membuat nilai pada heap. </font><font style="vertical-align: inherit;">Ini akan terjadi segera selama konstruksi pada jalur 28.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keterbacaan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang Anda pelajari dari posting sebelumnya, suatu fungsi memiliki akses langsung ke memori di dalam frame-nya melalui pointer frame, tetapi akses ke memori di luar frame membutuhkan akses tidak langsung. Ini berarti bahwa akses ke nilai-nilai yang jatuh ke tumpukan juga harus dilakukan secara tidak langsung melalui pointer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingat seperti apa kode createUserV2 itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 4</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">27</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV2</span><span class="hljs-params">()</span> *<span class="hljs-title">user</span></span> {
<span class="hljs-number">28</span>     u := user{
<span class="hljs-number">29</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">30</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">31</span>     }
<span class="hljs-number">32</span>
<span class="hljs-number">33</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V2"</span>, &amp;u)
<span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> &amp;u
<span class="hljs-number">35</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sintaks menyembunyikan apa yang sebenarnya terjadi dalam kode ini. Variabel yang dideklarasikan pada baris 28 mewakili nilai tipe pengguna. Konstruksi di Go tidak memberi tahu Anda dengan tepat di mana nilai disimpan dalam memori, jadi sebelum pernyataan kembali pada baris 34 Anda tidak tahu bahwa nilai akan ditumpuk. Ini berarti bahwa meskipun Anda mewakili nilai dari pengguna tipe, akses ke nilai ini harus melalui sebuah pointer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat memvisualisasikan tumpukan yang terlihat seperti ini setelah panggilan fungsi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gambar 3</font></font><br>
<br>
<img src="https://habrastorage.org/webt/5u/ya/sv/5uyasv63ozdef8jclixqpv4anx4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Variabel u dalam bingkai tumpukan untuk createUserV2 mewakili nilai pada heap, bukan pada stack. </font><font style="vertical-align: inherit;">Ini berarti bahwa menggunakan u untuk mengakses suatu nilai memerlukan akses ke sebuah pointer, bukan akses langsung yang disarankan oleh sintaksis. </font><font style="vertical-align: inherit;">Anda mungkin berpikir, mengapa tidak segera membuat pointer, karena mengakses nilai yang diwakilinya masih memerlukan penggunaan pointer? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 5</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">27</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV2</span><span class="hljs-params">()</span> *<span class="hljs-title">user</span></span> {
<span class="hljs-number">28</span>     u := &amp;user{
<span class="hljs-number">29</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">30</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">31</span>     }
<span class="hljs-number">32</span>
<span class="hljs-number">33</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V2"</span>, u)
<span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> u
<span class="hljs-number">35</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda melakukannya, maka Anda akan kehilangan keterbacaan, yang tidak akan hilang dalam kode Anda. </font><font style="vertical-align: inherit;">Berpindahlah dari badan fungsi sesaat dan hanya fokus pada pengembalian. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 6</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> u
<span class="hljs-number">35</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang dibicarakan pengembalian ini? </font><font style="vertical-align: inherit;">Yang ia katakan hanyalah bahwa salinan Anda didorong ke tumpukan panggilan. </font><font style="vertical-align: inherit;">Sementara itu, apa yang dikembalikan memberitahu Anda ketika Anda menggunakan operator &amp;? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 7</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> &amp;u
<span class="hljs-number">35</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih kepada operator &amp; pengembalian, sekarang memberitahu Anda bahwa Anda berbagi tumpukan panggilan dan karenanya pergi ke tumpukan. Ingat bahwa pointer dimaksudkan untuk digunakan bersama-sama dan ketika membaca kode mereka mengganti operator &amp; dengan frasa "berbagi". Ini sangat kuat dalam hal keterbacaan. Ini adalah sesuatu yang saya tidak ingin kehilangan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berikut adalah contoh lain di mana membangun nilai menggunakan semantik pointer menurunkan keterbacaan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 8</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">01</span> <span class="hljs-keyword">var</span> u *user
<span class="hljs-number">02</span> err := json.Unmarshal([]<span class="hljs-keyword">byte</span>(r), &amp;u)
<span class="hljs-number">03</span> <span class="hljs-keyword">return</span> u, err</code></pre><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agar kode ini berfungsi, saat Anda memanggil json.Unmarshal pada baris 02, Anda harus meneruskan pointer ke variabel pointer. Panggilan json.Unmarshal akan membuat nilai tipe pengguna dan menetapkan alamatnya ke variabel penunjuk. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">play.golang.org/p/koI8EjpeIx</font></font></a> </i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apa yang dikatakan kode ini: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01: Buat pointer tipe pengguna dengan nilai nol. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
02: Bagikan variabel Anda dengan fungsi json.Unmarshal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
03: Kembalikan salinan variabel u ke pemanggil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tidak sepenuhnya jelas bahwa nilai tipe pengguna dibuat oleh fungsi json.Unmarshal diteruskan ke pemanggil. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagaimana perubahan keterbacaan saat menggunakan semantik nilai selama deklarasi variabel? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 9</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">01</span> <span class="hljs-keyword">var</span> u user
<span class="hljs-number">02</span> err := json.Unmarshal([]<span class="hljs-keyword">byte</span>(r), &amp;u)
<span class="hljs-number">03</span> <span class="hljs-keyword">return</span> &amp;u, err</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apa yang dikatakan kode ini: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01: Buat nilai tipe pengguna dengan nilai nol. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
02: Bagikan variabel Anda dengan fungsi json.Unmarshal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
03: Bagikan variabel u dengan penelepon. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya sangat jelas. </font><font style="vertical-align: inherit;">Jalur 02 membagi nilai tipe pengguna ke tumpukan panggilan di json.Unmarshal, dan jalur 03 membagi nilai tumpukan panggilan kembali ke pemanggil. </font><font style="vertical-align: inherit;">Bagian ini akan menyebabkan nilai berpindah ke heap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gunakan semantik nilai saat membuat nilai dan manfaatkan keterbacaan operator &amp; untuk memperjelas bagaimana nilai dipisahkan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelaporan kompiler</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk melihat keputusan yang dibuat oleh kompiler, Anda dapat meminta kompiler untuk memberikan laporan. </font><font style="vertical-align: inherit;">Yang harus Anda lakukan adalah menggunakan sakelar -gcflags dengan opsi -m saat memanggil go build. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebenarnya, Anda dapat menggunakan 4 level -m, tetapi setelah 2 level informasi itu menjadi terlalu banyak. </font><font style="vertical-align: inherit;">Saya akan menggunakan 2 level -m. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 10</font></font><br>
<br>
<pre><code class="bash hljs">$ go build -gcflags <span class="hljs-string">"-m -m"</span><font></font>
./main.go:16: cannot inline createUserV1: marked go:noinline<font></font>
./main.go:27: cannot inline createUserV2: marked go:noinline<font></font>
./main.go:8: cannot inline main: non-leaf <span class="hljs-keyword">function</span><font></font>
./main.go:22: createUserV1 &amp;u does not escape<font></font>
./main.go:34: &amp;u escapes to heap<font></font>
./main.go:34:     from ~r0 (<span class="hljs-built_in">return</span>) at ./main.go:34<font></font>
./main.go:31: moved to heap: u<font></font>
./main.go:33: createUserV2 &amp;u does not escape<font></font>
./main.go:12: main &amp;u1 does not escape<font></font>
./main.go:12: main &amp;u2 does not escape</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat melihat bahwa kompiler melaporkan keputusan untuk membuang nilai ke tumpukan. </font><font style="vertical-align: inherit;">Apa yang dikatakan kompiler? </font><font style="vertical-align: inherit;">Pertama, lihat kembali fungsi createUserV1 dan createUserV2 untuk menyegarkan mereka dalam memori. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 13</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">16</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV1</span><span class="hljs-params">()</span> <span class="hljs-title">user</span></span> {
<span class="hljs-number">17</span>     u := user{
<span class="hljs-number">18</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">19</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">20</span>     }
<span class="hljs-number">21</span>
<span class="hljs-number">22</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V1"</span>, &amp;u)
<span class="hljs-number">23</span>     <span class="hljs-keyword">return</span> u
<span class="hljs-number">24</span> }<font></font>
<font></font>
<span class="hljs-number">27</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV2</span><span class="hljs-params">()</span> *<span class="hljs-title">user</span></span> {
<span class="hljs-number">28</span>     u := user{
<span class="hljs-number">29</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">30</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">31</span>     }
<span class="hljs-number">32</span>
<span class="hljs-number">33</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V2"</span>, &amp;u)
<span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> &amp;u
<span class="hljs-number">35</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mari kita mulai dengan baris ini dalam laporan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 14</font></font><br>
<br>
<pre><code class="bash hljs">./main.go:22: createUserV1 &amp;u does not escape</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini menunjukkan bahwa panggilan ke fungsi println di dalam fungsi createUserV1 tidak menyebabkan tipe pengguna dibuang ke heap. Kasing ini harus diperiksa karena digunakan bersama dengan fungsi println. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, lihat garis-garis ini dalam laporan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 15</font></font><br>
<br>
<pre><code class="bash hljs">./main.go:34: &amp;u escapes to heap<font></font>
./main.go:34:     from ~r0 (<span class="hljs-built_in">return</span>) at ./main.go:34<font></font>
./main.go:31: moved to heap: u<font></font>
./main.go:33: createUserV2 &amp;u does not escape</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Baris-baris ini mengatakan bahwa nilai tipe pengguna yang terkait dengan variabel u, yang memiliki tipe pengguna bernama dan dibuat pada baris 31, dibuang ke heap karena return on line 34. Baris terakhir mengatakan hal yang sama seperti sebelumnya, println panggilan pada baris 33 tidak mengatur ulang tipe pengguna. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Membaca laporan-laporan ini dapat membingungkan dan dapat sedikit bervariasi tergantung pada apakah jenis variabel yang dimaksud didasarkan pada jenis yang dinamai atau harfiah. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubah variabel u menjadi pengguna tipe literal * alih-alih pengguna tipe bernama, seperti sebelumnya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 16</font></font><br>
<br>
<pre><code class="go hljs"><span class="hljs-number">27</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createUserV2</span><span class="hljs-params">()</span> *<span class="hljs-title">user</span></span> {
<span class="hljs-number">28</span>     u := &amp;user{
<span class="hljs-number">29</span>         name:  <span class="hljs-string">"Bill"</span>,
<span class="hljs-number">30</span>         email: <span class="hljs-string">"bill@ardanlabs.com"</span>,
<span class="hljs-number">31</span>     }
<span class="hljs-number">32</span>
<span class="hljs-number">33</span>     <span class="hljs-built_in">println</span>(<span class="hljs-string">"V2"</span>, u)
<span class="hljs-number">34</span>     <span class="hljs-keyword">return</span> u
<span class="hljs-number">35</span> }</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jalankan laporan lagi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Listing 17</font></font><br>
<br>
<pre><code class="bash hljs">./main.go:30: &amp;user literal escapes to heap<font></font>
./main.go:30:     from u (assigned) at ./main.go:28<font></font>
./main.go:30:     from ~r0 (<span class="hljs-built_in">return</span>) at ./main.go:34</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang laporan mengatakan bahwa nilai tipe pengguna yang dirujuk oleh variabel u, yang memiliki tipe pengguna * literal dan dibuat pada baris 28, dibuang ke tumpukan karena pengembalian pada baris 34.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menciptakan nilai tidak menentukan di mana ia berada. </font><font style="vertical-align: inherit;">Hanya bagaimana nilai dibagi akan menentukan apa yang akan dilakukan oleh kompiler dengan nilai ini. </font><font style="vertical-align: inherit;">Setiap kali Anda berbagi nilai dalam tumpukan panggilan, itu dibuang ke tumpukan. </font><font style="vertical-align: inherit;">Ada alasan lain mengapa suatu nilai mungkin lolos dari tumpukan. </font><font style="vertical-align: inherit;">Saya akan membicarakannya di posting selanjutnya.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tujuan dari posting ini adalah untuk memberikan panduan dalam memilih untuk menggunakan semantik nilai atau semantik pointer untuk semua tipe yang diberikan. </font><font style="vertical-align: inherit;">Setiap semantik dipasangkan dengan laba dan nilai. </font><font style="vertical-align: inherit;">Semantik nilai menyimpan nilai-nilai pada tumpukan, yang mengurangi beban pada GC. </font><font style="vertical-align: inherit;">Namun, ada beberapa salinan dengan nilai yang sama yang harus disimpan, dilacak, dan dipelihara. </font><font style="vertical-align: inherit;">Semantik Pointer menempatkan nilai dalam tumpukan, yang dapat memberi tekanan pada GC. </font><font style="vertical-align: inherit;">Namun, mereka efektif karena hanya ada satu nilai yang perlu disimpan, dilacak, dan dipelihara. </font><font style="vertical-align: inherit;">Poin kuncinya adalah penggunaan setiap semantik dengan benar, konsisten dan seimbang.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id497982/index.html">Pendekatan fungsional dan proses terhadap manajemen. Bagaimana dan apa yang harus dikelola?</a></li>
<li><a href="../id497984/index.html">Bermigrasi dari reCAPTCHA ke hCaptcha di Cloudflare</a></li>
<li><a href="../id497986/index.html">Memantau semua memori yang digunakan oleh halaman web: performance.measureMemory ()</a></li>
<li><a href="../id497988/index.html">Bereaksi Profil Kinerja Aplikasi</a></li>
<li><a href="../id497990/index.html">PostgreSQL: Pengembangan ekstensi (fungsi) dalam bahasa C.</a></li>
<li><a href="../id497996/index.html">Anda tidak ingin memperkuat kekebalan tubuh. Atau ekstrem dari tubuh manusia</a></li>
<li><a href="../id498000/index.html">Hal-hal yang ingin saya ketahui sebelum mengembangkan game saya sendiri</a></li>
<li><a href="../id498002/index.html">Panduan Saku ke Z3</a></li>
<li><a href="../id498004/index.html">Workstation dalam wadah buruh pelabuhan</a></li>
<li><a href="../id498006/index.html">Memilih Jaksa Paten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>