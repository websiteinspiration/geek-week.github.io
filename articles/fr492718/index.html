<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëç üíÜüèª ‚õ±Ô∏è S√©curit√© gr√¢ce √† la restriction des utilisateurs ou comment cr√©er une vuln√©rabilit√© üë®üèæ‚Äçüî¨ üê≥ üë©üèæ‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2019, la vuln√©rabilit√© CPDoS Cache Poisoned Denial of Service) a √©t√© d√©couverte sur le r√©seau CDN, ce qui permet d'empoisonner le cache HTTP du fou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>S√©curit√© gr√¢ce √† la restriction des utilisateurs ou comment cr√©er une vuln√©rabilit√©</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/492718/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En 2019, la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vuln√©rabilit√© CPDoS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cache Poisoned Denial of Service) a </font><font style="vertical-align: inherit;">√©t√© </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">d√©couverte</font></a><font style="vertical-align: inherit;"> sur le r√©seau CDN, ce qui permet d'empoisonner le cache HTTP du fournisseur CDN et de provoquer un d√©ni de service. </font><font style="vertical-align: inherit;">La vuln√©rabilit√© n'a pas encore recueilli beaucoup de battage m√©diatique, car elle n'a pas √©t√© vue dans de vraies attaques. </font><font style="vertical-align: inherit;">Mais je veux parler s√©par√©ment d'une des m√©thodes d'empoisonnement du cache. </font><font style="vertical-align: inherit;">Substitution de m√©thode HTTP.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rb/7j/wy/rb7jwy3an79ykaffwer39l297eu.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si d'autres variantes d'exploitation de la vuln√©rabilit√© d'une mani√®re ou d'une autre s'appuient sur des bogues ou des fonctionnalit√©s de modification de demande par un interm√©diaire, alors la variante de substitution de m√©thode est bas√©e sur la tactique du m√™me nom, qui ne fait pas partie de la norme HTTP, entra√Æne des probl√®mes suppl√©mentaires, et qui sont survenus et se sont propag√©s en raison d'une n√©gligence relation avec la s√©curit√©. </font><font style="vertical-align: inherit;">Ici, nous allons l'examiner.</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bref sur CPDoS si vous l'avez manqu√©</font></font></b><div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"> </a> ,         URI  method   .<br>
<br>
      ,       ,       ,         ,      -   .       ‚Äî            -  -   -,      ,    -     ,      .           ,         .<br>
<br>
            ,    . ,  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">   -</a>.      -   ,       ,      .<br>
<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitez le client, moins peut - moins se cassera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le besoin m√™me de remplacer la m√©thode dans la demande est d√ª au fait que certains pare-feu d'application Web et impl√©mentations client HTTP √©taient tr√®s limit√©s et ne permettaient pas l'ex√©cution de m√©thodes autres que GET et POST. Le probl√®me n'est pas qu'il s'agissait d'une restriction d'impl√©mentation, mais qu'il s'agissait d'une restriction intentionnelle des clients HTTP par une politique de s√©curit√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est clair que tout a √©t√© r√©alis√© avec la bonne intention de couper le trafic exigu, non standard pour les clients HTTP ordinaires. Mais dans un souci de s√©curit√©, toutes les m√©thodes sauf GET et POST ont √©t√© supprim√©es. Peut-√™tre parce que ce sont les seules m√©thodes qui </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sont </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">pas facultatives et requises</font></a><font style="vertical-align: inherit;"> pour les serveurs √† usage g√©n√©ral.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La raison pour laquelle il √©tait n√©cessaire d'introduire une restriction aussi stricte n'est pas claire. Oui, les attaques avec l'introduction de diff√©rents caract√®res afin de confondre l'analyseur ne sont que le passe-temps des protocoles de texte. Mais vous pouvez autoriser un peu plus de m√©thodes, par exemple, prendre au moins celles qui sont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©crites dans la norme elle-m√™me</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.iana.org/assignments/http-methods/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistr√©es aupr√®s de l'IANA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cela ne valait pas la peine de supprimer compl√®tement la v√©rification des m√©thodes, mais vous pouvez composer un certain nombre des m√©thodes les plus populaires et en exclure celles qui modifient le protocole d'interaction et interrompent le travail avec les connexions sur le serveur proxy (CONNECT). Mais non, il s'est av√©r√© une politique de s√©curit√© qui a introduit </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> restrictions et des interdictions </font><i><font style="vertical-align: inherit;">inutiles</font></i><font style="vertical-align: inherit;"> pour les clients.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et les clients √©taient limit√©s aux mauvais. </font><font style="vertical-align: inherit;">Ils voulaient limiter la variabilit√© des messages des clients HTTP et limitaient les clients prot√©g√©s par ces WAF, les serveurs d'applications finaux et leurs d√©veloppeurs. </font><font style="vertical-align: inherit;">D√©sormais, les d√©veloppeurs n'avaient plus que deux m√©thodes qui n'√©taient pas toujours suffisantes pour d√©crire la logique du client HTTP.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des contraintes sont cr√©√©es pour les surmonter.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il √©tait √† pr√©voir que cette restriction excessive commencerait t√¥t ou tard √† interf√©rer avec les d√©veloppeurs Web. L'ironie est qu'il est si facile de ne pas se d√©barrasser de ces WAF. Surtout quand ils sont avec des clients ou des fournisseurs. Remettre en question les politiques de s√©curit√© des autres est une affaire d√©sastreuse. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En raison de la flexibilit√© de HTTP, il n'est pas difficile de contourner cette limitation; ajoutez simplement quelque chose √† la demande o√π vous pouvez remplacer la m√©thode. Strict WAF v√©rifiera uniquement la m√©thode dans la ligne de demande (la premi√®re ligne de la demande) et sera heureux de voir un GET ou POST approuv√© l√†-bas. Et le backend pourra analyser l'√©l√©ment ajout√© et en extraire la vraie m√©thode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://fandry.blogspot.com/2012/03/x-" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">google un </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tas d' </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://docs.inpaas.com/docs/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">articles, </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vraiment un </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.infoworld.com/article/3249687/how-to-implement-a-delegatinghandler-for-x-" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur la fa√ßon dont les proxys d√©fectueux ont bris√© les applications REST, et comment les auteurs ont d√ª passer la vraie m√©thode dans un en-t√™te s√©par√©. </font><font style="vertical-align: inherit;">Dans chacun d'eux, ils sugg√®rent que vous saisissiez approximativement le m√™me en-t√™te (m√©thode X-HTTP, m√©thode X-HTTP-Override ou m√©thode X-Override - l'orthographe varie quelque peu) pour indiquer une m√©thode remplac√©e. </font><font style="vertical-align: inherit;">Tr√®s, tr√®s rarement, on peut trouver des r√©f√©rences qui peuvent √™tre utilis√©es pour le m√™me objet URI de composant de requ√™te. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce qui manque dans ces articles, c'est la section Consid√©rations sur la s√©curit√©. </font><font style="vertical-align: inherit;">Et ils le sont.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode est-elle s√ªre?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parfois, les d√©veloppeurs d'applications Web oublient qu'entre le client et le serveur, il peut y avoir des participants interm√©diaires qui interagissent via le protocole HTTP: mandataires, caches Web des fournisseurs, CDN et WAF. La prolif√©ration de TLS r√©duit consid√©rablement les chances d'un participant interm√©diaire entre le client et le serveur. Le seul proxy entre le client et le backend sera probablement son propre serveur avec Nginx. Et une telle configuration est assez facile √† tester sur des sc√©narios typiques avant sa sortie.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais nous entrons dans l'√®re du CDN, et de plus en plus d'applications se cacheront derri√®re les CDN qui lisent et manipulent le trafic des utilisateurs. </font><font style="vertical-align: inherit;">Les backends ne servent presque jamais directement les utilisateurs et se cachent derri√®re des proxys invers√©s pour augmenter la r√©activit√© et les performances. </font><font style="vertical-align: inherit;">Par cons√©quent, vous devrez vous rappeler comment le remplacement d'une m√©thode peut affecter le traitement d'une demande sur un serveur de m√©diation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les attaques dont je veux parler s'appliquent principalement √† HTTP / 1.1. </font><font style="vertical-align: inherit;">HTTP / 2 h√©rite en quelque sorte du comportement de l'ancienne norme, √† certains √©gards suit sa propre voie, donc l'applicabilit√© de chaque attaque √† la nouvelle norme sera consid√©r√©e s√©par√©ment.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attaques de cache</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus souvent, les serveurs interm√©diaires ne prennent pas en compte les remplacements de m√©thode, ne v√©rifient pas les en-t√™tes de la famille X-HTTP-Method-Override et travaillent avec la demande en utilisant sa m√©thode principale √† partir de la ligne de demande. Et puisque la m√©thode remplac√©e n'est pas incluse dans la cl√© pour rechercher une demande dans le cache (m√©thode + URI), ces serveurs ne peuvent pas distinguer POST de POST + X-HTTP-Method-Override: DELETE. Cela signifie que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous ne pouvez pas autoriser la mise en cache des</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> requ√™tes vers un certain URI si le backend peut surveiller et ex√©cuter des m√©thodes remplac√©es.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le document CPDoS a un bon exemple de ce qui se passe si vous mettez en cache une telle demande. Lorsqu'un attaquant d√©guise une demande POST en demande GET, le proxy ne reconna√Æt pas les substitutions et traite la demande comme une demande GET l√©gitime. Le backend, cependant, reconna√Æt la m√©thode substitu√©e et ex√©cute le verbe d√©crit dans l'en-t√™te X-HTTP-Method-Override - POST. √âtant donn√© que la m√©thode POST n'est pas d√©finie pour l'URI de destination, le serveur g√©n√®re une erreur. En outre, la r√©ponse de backend est stock√©e dans le cache en tant que r√©ponse √† la m√©thode d'origine - GET. Maintenant, toute prochaine requ√™te GET pour le m√™me URI retournera une erreur mise en cache.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/0r/bv/_q/0rbv_qeocdxi9b4ctw2rschthgw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, l'attaque est l√©g√®rement plus large que celle pr√©sent√©e dans le document. Les auteurs se sont concentr√©s sur le stockage de l'erreur dans le cache, qui n'est pas partout (d√©j√†) reproductible. Mais si la m√©thode demand√©e pour l'URI s√©lectionn√© est d√©finie et sera ex√©cut√©e avec succ√®s, le proxy recevra une r√©ponse avec un √©tat de 200 et la mettra en cache. Ensuite, les demandes suivantes du m√™me URI pour recevoir des r√©ponses √† la m√©thode compl√®tement erron√©e. Dans ce sc√©nario, il n'y a plus d'exigence avec une erreur de cache de r√©ponses 4XX, comme dans la description CPDoS d'origine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le probl√®me inverse peut se produire. Si un client HTTP respectable envoie une demande GET + X-HTTP-Method-Override: PATCH (c'est mauvais, mais plus √† ce sujet plus tard), et le cache a d√©j√† une r√©ponse GET, alors le client recevra cette r√©ponse en cache. Dans ce cas, le backend ne recevra jamais de demande PATCH, ce qui peut violer la logique d'application sur le client et le serveur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez r√©duire l'effet sur le cache en cr√©ant les strat√©gies de mise en cache correctes et en divisant les ressources en deux groupes: ceux pour lesquels l'op√©ration de substitution de m√©thode est inacceptable ou non requis, les r√©ponses √† ceux-ci peuvent √™tre mises en cache et celles pour lesquelles l'op√©ration de remplacement de m√©thode est n√©cessaire, toute mise en cache de ces r√©ponses est inacceptable . Mais moins les ressources sont mises en cache, moins le CDN est utile et plus le trafic atteint le backend, plus l'application est expos√©e au d√©luge HTTP. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par cons√©quent, il est pr√©f√©rable d'utiliser le cache HTTP autant que possible, pour cela, il est n√©cessaire que le serveur de cache puisse distinguer les demandes avec diff√©rentes m√©thodes remplac√©es. La premi√®re fa√ßon consiste √† transf√©rer le remplacement de m√©thode du composant de requ√™te vers l'URI:</font></font><br>
<br>
<pre><code class="plaintext hljs">POST /some-uri HTTP/1.1<font></font>
X-HTTP-Method-Override: DELETE<font></font>
   ‚Üì  ‚Üì   ‚Üì<font></font>
POST /some-uri?method=DELETE HTTP/1.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©sormais, les requ√™tes avec diff√©rentes m√©thodes sont diff√©rentes pour le cache, car elles obtiennent des cl√©s diff√©rentes. Certains mandataires pr√©f√®rent ne pas mettre en cache les r√©ponses aux demandes contenant le composant de requ√™te dans l'URI. Mais cela n'affectera que l'efficacit√© de la mise en cache. Cette m√©thode r√©sout toujours les probl√®mes de mise en cache incorrecte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une autre fa√ßon consiste √† laisser la m√©thode remplacer dans un en-t√™te s√©par√©, mais entrez une cl√© secondaire pour trouver la r√©ponse dans le cache. Cela est possible avec l'en-t√™te Vary. Lors du traitement de la demande, le serveur r√©p√©tera l'en-t√™te avec la m√©thode override et refl√©tera le nom de cet en-t√™te dans l'en-t√™te Vary. Ensuite, aux demandes suivantes, le serveur de cache utilisera la valeur de la m√©thode remplac√©e comme cl√© secondaire lors de la recherche d'une demande dans le cache.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/1n/rd/oh1nrdf3x18yktd6moekwlr01-w.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette m√©thode fonctionne si le serveur interm√©diaire peut fonctionner avec des cl√©s secondaires. </font><font style="vertical-align: inherit;">C'est g√©n√©ralement le cas, mais le niveau de confiance du proxy, qui coupe toutes les m√©thodes sauf GET et POST, est g√©n√©ralement plus bas et il est pr√©f√©rable de le v√©rifier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remplacer une m√©thode par le biais de n'importe quelle entit√© √† l'int√©rieur du corps de la demande pr√©sente exactement les m√™mes inconv√©nients que le remplacement par un en-t√™te suppl√©mentaire - cela est hors de la visibilit√© du cache.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attaques Message Queuing</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me si les attaques de cache sont ferm√©es, ce n'est pas tout. </font><font style="vertical-align: inherit;">Un attaquant en red√©finissant une m√©thode peut essayer de modifier le cadrage de la r√©ponse et ainsi violer la correspondance des paires requ√™te-r√©ponse pour les autres clients. </font><font style="vertical-align: inherit;">Ou forcez le c√¥t√© serveur de l'application √† traiter plusieurs fois la m√™me demande.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La chose la plus importante qui est requise pour cela est un serveur interm√©diaire fonctionnant en mode proxy inverse. Autrement dit, tout serveur de mise en cache ou CDN. Un tel proxy prend en charge un nombre relativement faible de connexions au backend et multiplie les demandes de nombreux clients dans chacun d'eux. Cela est n√©cessaire √† la fois pour prendre la charge de la prise en charge d'un grand nombre de connexions clientes des backends vers le serveur proxy et pour √©quilibrer la charge entre les backends. La terminaison des connexions TLS se produit √©galement sur le proxy, les connexions client ne sont jamais connect√©es directement au backend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âtant donn√© que maintenant les demandes de diff√©rents clients seront dans la m√™me connexion entre le backend et le proxy, il est n√©cessaire de maintenir une correspondance claire entre les paires requ√™te-r√©ponse. La plupart des procurations </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ne</font></a><font style="vertical-align: inherit;"> pr√©voient </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(pipelines) envoie des requ√™tes au backend et fonctionne avec lui en mode de r√©ponse aux requ√™tes. Le mode demande-r√©ponse est plus simple et soumis √† pratiquement une menace: le blocage de la connexion. Si vous √©tablissez la connexion sur une seule paire demande-r√©ponse, vous pouvez provoquer un retard, voire un refus, pour traiter les demandes suivantes (par exemple, si vous r√©ussissez √† d√©border les files d'attente de demandes de procurations).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des proxies plus productifs acheminent les requ√™tes vers le backend - cela vous permet d'envoyer imm√©diatement un paquet de requ√™tes au serveur et d'attendre leur ex√©cution. Les performances sont sup√©rieures, mais les menaces sont plus nombreuses. Premi√®rement, le probl√®me du blocage en t√™te de ligne ne dispara√Æt nulle part - m√™me si le backend peut ratisser le pipeline de requ√™tes et les ex√©cuter en parall√®le, elles ne peuvent pas √™tre envoy√©es si la premi√®re d'entre elles se bloque. Deuxi√®mement, si vous cassez le cadrage de la r√©ponse, vous pouvez confondre le proxy et rompre la correspondance des paires demande-r√©ponse, puis certains clients peuvent obtenir les r√©ponses d'autres personnes, ou au moins parvenir √† une fermeture de connexion instantan√©e avec le backend.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/td/wn/rj/tdwnrjiw4ekrsl7l1aqda-hhyzi.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La red√©finition la plus simple et la plus amusante d'une m√©thode consiste √† remplacer GET par le verbe HEAD. Si la r√©ponse √† la premi√®re a un corps, la seconde non. De plus, tous les autres en-t√™tes sont identiques, y compris ceux qui fournissent le cadrage de la demande. Lorsque le proxy redirige une telle HEAD remplac√©e vers le serveur, il attend du serveur non seulement les en-t√™tes de r√©ponse, mais aussi le corps de r√©ponse, que le backend ne va pas envoyer. Si le proxy et le serveur interagissent dans le mode de demande-r√©ponse, la connexion se "bloque" jusqu'√† ce qu'elle soit interrompue par le d√©lai d'expiration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le serveur envoie les r√©ponses suivantes (mode pipeline), elles peuvent √™tre analys√©es non pas comme des r√©ponses ind√©pendantes, mais dans le cadre de la r√©ponse incompl√®te pr√©c√©dente √† l'EEG. Le proxy les placera (ou une partie d'entre eux) dans le corps de la r√©ponse "GET" et l'enverra √† l'attaquant pour les lire. Vous pouvez cr√©er un tel pseudo-GET pour recevoir un fichier volumineux et vider du trafic entre le proxy et le backend. Le succ√®s d√©pend de la fa√ßon dont le backend place le Content-Length et le Transfer-Encoding: des en-t√™tes fragment√©s pour encadrer les messages. Le premier vous permettra presque toujours d'obtenir un vidage, le second g√©n√©rera souvent des erreurs d'analyse et provoquera une d√©connexion du backend. Si vous n'√™tes pas du tout chanceux, le pseudo-GET peut couvrir plusieurs r√©ponses dans son int√©gralit√© et se terminer juste avant la r√©ponse suivante.Le proxy ne pourra pas du tout reconna√Ætre ce probl√®me et pour d'autres r√©ponses √† cet √©gard, la correspondance demande-r√©ponse sera viol√©e.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/ds/h9/eedsh90uounshmxglkz5aconiim.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√™me si tout ce qui a √©t√© r√©alis√© en rempla√ßant la m√©thode a √©t√© de fermer la connexion entre le proxy et le backend, cela peut suffire pour une attaque. </font><font style="vertical-align: inherit;">Vous pouvez lancer des demandes de service avec de telles demandes - les connexions avec les backends seront constamment interrompues. </font><font style="vertical-align: inherit;">Il n'y en a pas tellement, et la red√©couverte prend du temps, par cons√©quent, vous pouvez r√©duire consid√©rablement les performances de communication du serveur proxy et ainsi r√©duire le d√©bit du service.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relecture automatique du spam</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai dit ci-dessus que les demandes de la forme GET + X-HTTP-Method-Override: PATCH de clients respectables sont mauvaises. Et c'est mauvais parce que les m√©thodes ont deux propri√©t√©s: la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©curit√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idempotence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . La s√©curit√© signifie que la m√©thode ne modifie pas l'√©tat du serveur (lecture seule) et ne nous int√©resse pas dans le cadre de cet article. L'idempotence de la m√©thode garantit que la demande r√©p√©t√©e a le m√™me effet qu'une demande unique. Vous pouvez faire une analogie: </font></font><code>(a = 5)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- requ√™te idempotente, et </font></font><code>(a += 2) </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- non idempotente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette propri√©t√© est ce qui nous int√©resse. Si la connexion entre le client et le serveur se brise soudainement, le client, sachant que la m√©thode est idempotente, peut renvoyer automatiquement la demande. Les mandataires se comportent de la m√™me mani√®re. Les requ√™tes non idempotentes ne sont pas r√©p√©t√©es automatiquement car on ne sait pas comment elles affectent le serveur et ce que le client recevra √† la fin. Je pense que tout le monde conna√Æt les fen√™tres contextuelles du navigateur: "Voulez-vous vraiment r√©p√©ter la demande?" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous masquez une m√©thode non idempotente comme idempotente, en cas d'erreurs, elle ne sera pas supprim√©e, mais sera √† nouveau redirig√©e vers le serveur. M√™me si le client consid√©rera la m√©thode de demande r√©elle avant de soumettre √† nouveau la demande, cela n'aidera pas beaucoup, car le serveur proxy ne conna√Æt pas la substitution de m√©thode et r√©p√©tera ces demandes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si un attaquant est en mesure de forcer les d√©connexions entre le backend et les clients, il pourra amener le serveur √† ex√©cuter √† plusieurs reprises des requ√™tes non idempotentes et √† r√©duire la fiabilit√© et la pr√©visibilit√© de l'application. </font><font style="vertical-align: inherit;">Dans la section pr√©c√©dente, nous venons de trouver un moyen de provoquer des ruptures de connexion avec la m√™me substitution de m√©thode. </font><font style="vertical-align: inherit;">Bien qu'il ne faut pas oublier qu'Internet est un r√©seau peu fiable, par d√©finition, et que l'application elle-m√™me est en danger. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour vous prot√©ger contre cette attaque, vous ne devez utiliser que des m√©thodes qui n'ajoutent pas de nouvelles propri√©t√©s √† la demande en tant que transport. </font><font style="vertical-align: inherit;">POST est un bon candidat, car par d√©faut il n'est ni s√ªr ni idempotent.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cet ancien HTTP / 1.1, comme avec HTTP / 2?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
HTTP / 2 a chang√© la fa√ßon dont les requ√™tes sont transport√©es entre les n≈ìuds, mais il n'a pas chang√© leur signification lexicale. Par cons√©quent, dans les attaques li√©es √† la valeur de la requ√™te, HTTP / 2 se comporte de la m√™me mani√®re. Mais les attaques de ¬´transport¬ª ne sont pas reproduites, car elles sont d√©j√† prises en compte dans la norme. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les attaques sur le cache sont</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reproduites de mani√®re similaire √† HTTP / 1, et la protection est similaire. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les attaques Message Queuing</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne s'appliquent pas √† HTTP / 2. Les messages HTTP qu'il contient sont divis√©s en trames distinctes, avec des en-t√™tes de trame distincts qui d√©terminent explicitement la longueur et la fin du message. Comme si l'attaquant ne changerait pas la m√©thode et ne modifierait pas les en-t√™tes HTTP, cela n'affecterait pas le cadre du message. Voler la r√©ponse √©chouera. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les attaques contre la r√©p√©tition de messages non idempotents sont</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> applicables m√™me en tenant compte du fait que dans HTTP / 2 il y a</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©canisme de notification de la derni√®re demande trait√©e</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans HTTP / 2, plusieurs requ√™tes sont multipli√©es dans le m√™me TCP et cr√©ent ainsi des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flux</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Chaque fil a son propre num√©ro. </font><font style="vertical-align: inherit;">Si le serveur HTTP / 2 se d√©connecte, il peut indiquer le num√©ro de la derni√®re demande trait√©e dans GOAWAY. </font><font style="vertical-align: inherit;">Les demandes avec un nombre plus √©lev√© peuvent toujours √™tre redirig√©es en toute s√©curit√©; les demandes avec un nombre inf√©rieur ne sont redirig√©es que si elles sont idempotentes. </font><font style="vertical-align: inherit;">Si une demande avec une m√©thode substitu√©e semble idempotente pour un serveur proxy, le proxy la transmettra au serveur.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment remplacer en toute s√©curit√© une m√©thode</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La r√©ponse courte n'est pas possible. Il vaut mieux ne pas utiliser du tout les substitutions de m√©thode. Et d√©sactivez compl√®tement la prise en charge dans le backend, le cas √©ch√©ant. Bloquer les m√©thodes de substitution des clients HTTP. Refuser le proxy / WAF, ce qui coupe les m√©thodes "suppl√©mentaires". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous devez en quelque sorte vivre avec la red√©finition de la m√©thode, alors pour emp√™cher suffisamment de modifications sur le backend. Tout d'abord, il est conseill√© de remplacer la m√©thode uniquement via le composant de requ√™te de l'URI.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deuxi√®mement, il devrait y avoir une liste blanche de la transformation des m√©thodes: qui sont acceptables en tant que ¬´transport¬ª et qui en r√©sultent. </font><font style="vertical-align: inherit;">Il ne devrait pas y avoir de fonctions de transformation g√©n√©ralis√©es lorsqu'une m√©thode peut √™tre remplac√©e par n'importe laquelle. </font><font style="vertical-align: inherit;">La m√©thode de ¬´transport¬ª ne devrait pas avoir les propri√©t√©s de s√©curit√© et d'idempotence si celle qui en r√©sulte n'en a pas. </font><font style="vertical-align: inherit;">Les transformations dangereuses doivent √™tre interdites, le m√™me remplacement GET -&gt; HEAD.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois-je corriger un proxy / WAF probl√©matique?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si le proxy n'impl√©mente que les m√©thodes GET et POST, et bloque les autres pour une raison ou une autre, certainement oui. </font><font style="vertical-align: inherit;">Vous pouvez l'optimiser principalement pour GET et POST, mais bloquer d'autres m√©thodes est une mauvaise id√©e. </font><font style="vertical-align: inherit;">Ce qui cr√©e encore un gouffre de m√©fiance √† l'√©gard du produit: si les choses de base sont bloqu√©es, √† quoi s'attendre de la mise en ≈ìuvre de probl√®mes plus complexes?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous vous inqui√©tez de la s√©curit√© des applications Web prot√©g√©es, il peut √™tre utile de s√©curiser les applications contre les strat√©gies de substitution de m√©thode non s√©curis√©es. </font><font style="vertical-align: inherit;">Bien s√ªr, dans le cas g√©n√©ral, sans conna√Ætre les d√©tails de la mise en ≈ìuvre de l'application Web, il est impossible de prot√©ger compl√®tement l'application contre les remplacements incorrects, mais vous pouvez couvrir partiellement les utilisateurs qui ne connaissent tout simplement pas le probl√®me. </font><font style="vertical-align: inherit;">Il est n√©cessaire non seulement de vous prot√©ger contre l'empoisonnement de votre propre cache, mais √©galement de permettre d'activer ou de d√©sactiver la substitution pour chaque application prot√©g√©e. </font><font style="vertical-align: inherit;">Pour ce faire, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gardez une trace des en- </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t√™tes couramment utilis√©s.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-HTTP-Method, X-HTTP-Method-Override et X-Method-Override. </font><font style="vertical-align: inherit;">Le suivi de la red√©finition dans le composant de requ√™te de l'URI n'a pas beaucoup de sens: le cache n'empoisonne pas une telle demande, et la requ√™te peut √™tre tr√®s longue et avoir un format compl√®tement arbitraire.</font></font><br>
<br>
<h2>      ?</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©veloppeurs de s√©curit√©, ne limitez pas les d√©veloppeurs d'applications aux politiques de s√©curit√©. </font><font style="vertical-align: inherit;">Ils trouveront toujours comment les contourner, et plus le protocole est flexible, plus il est facile de le faire. </font><font style="vertical-align: inherit;">Il est tr√®s probable qu'ils ne vous frapperont pas et n'attendront pas que vous rendiez les restrictions plus raisonnables, mais les contournent simplement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous avez compris comment impl√©menter quelque chose dans le protocole, mais qu'il remplace ou va √† l'encontre de l'un des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concepts cl√©s de la</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> norme, des probl√®mes de compatibilit√© et de s√©curit√© se poseront s√ªrement. </font><font style="vertical-align: inherit;">Et ils doivent √™tre couverts en m√™me temps que la d√©cision. </font><font style="vertical-align: inherit;">√Ä chaque fois. </font><font style="vertical-align: inherit;">Si vous avez rencontr√© de tels conseils et n'avez pas vu d'avertissements de s√©curit√©, ne dupliquez pas les conseils sur Internet. </font><font style="vertical-align: inherit;">Soyez toujours critique envers la d√©cision et d√©terminez ce qui pourrait </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mal tourner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu d'une postface</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quels probl√®mes de serveur proxy avez-vous rencontr√©s? </font><font style="vertical-align: inherit;">Que fallait-il contourner et comment?</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492706/index.html">Archives de la m√©moire: comment le cerveau code et reproduit les souvenirs</a></li>
<li><a href="../fr492708/index.html">Internet satellite mondial - y a-t-il des nouvelles des champs?</a></li>
<li><a href="../fr492710/index.html">Chemin √©pineux du candidat √† travers divers syst√®mes de GRH</a></li>
<li><a href="../fr492712/index.html">Ma√Ætriser le d√©veloppement gr√¢ce aux tests sur Android √† l'aide de tests d'interface</a></li>
<li><a href="../fr492714/index.html">Travail efficace √† domicile: g√©n√©ral et personnel</a></li>
<li><a href="../fr492720/index.html">discussion: service de fichiers de projet</a></li>
<li><a href="../fr492724/index.html">Bj√∂rn Straustrup r√©pond aux 5 meilleures questions C ++ avec d√©bordement de pile</a></li>
<li><a href="../fr492726/index.html">OS Sivelkiriya: processus de d√©veloppement logiciel</a></li>
<li><a href="../fr492728/index.html">Ast√©risque et envoi manqu√©s dans Telegram / Slack / E-mail</a></li>
<li><a href="../fr492730/index.html">D√©partement am√©ricain de la D√©fense: √©thique pour l'IA et les v√©hicules sans pilote</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>