<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦐 🥀 🎸 Embox RTOS sur Raspberry Pi 👨🏼‍🌾 🈁 👩🏽‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="salut! 
 
 On nous demande souvent si Embox prend en charge Raspberry Pi. Oui il y a. Description de comment exécuter maintenant ici . Dans cet articl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Embox RTOS sur Raspberry Pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/494286/"><img src="https://habrastorage.org/files/c92/874/069/c92874069b4e49d4ae65eb48e6d6af19.png" alt="image" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salut! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On nous demande souvent si </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prend en charge Raspberry Pi. </font><font style="vertical-align: inherit;">Oui il y a. </font><font style="vertical-align: inherit;">Description de comment exécuter maintenant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans cet article, je veux en parler un peu plus.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avions acheté la carte Raspberry Pi Model B rev 2.0 depuis longtemps (c'est le premier Rpi 1) et avons même fait les premiers pas dans le portage: l'UART, le contrôleur d'interruption, le minuteur et même le framebuffer ont été implémentés sous une forme ou une autre. Mais les données sur la façon de le démarrer ont été perdues, j'ai donc dû me souvenir / comprendre à nouveau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, ils ont lancé l'émulateur QEMU. QEMU standard prend en charge la machine raspi2, mais pas de raspi. Mais quand il y avait un processus de portage, seule la prise en charge de raspi était ajoutée. Nous avons toujours la version dans notre référentiel, même si nous avons dû rédiger des commits pour la compiler dans l'environnement moderne, mais à la fin nous avons obtenu une version de l'émulateur QEMU qui prend en charge rpi1 - la machine «-M raspi» (vous pouvez voir comment l'exécuter sur notre </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">En conséquence, Embox a été lancé là-bas et a dessiné un dégradé dans la mémoire vidéo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y avait une question à propos de commencer avec du fer. </font><font style="vertical-align: inherit;">Comment démarrer n'était pas clair au début, nous avons donc décidé d'essayer le Raspbian standard. </font><font style="vertical-align: inherit;">2020-02-13-raspbian-buster-lite.img est téléchargé </font><font style="vertical-align: inherit;">sur le site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">officiel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tous les téléchargements se produisent à partir d'une carte microSD, nous la préparons donc - copiez l'image résultante</font></font><pre><code class="bash hljs">dd bs=4M <span class="hljs-keyword">if</span>=2020-02-13-raspbian-buster-lite.img of=/dev/sdb conv=fsync</code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">où «/ dev / sdb» est la carte SD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous regardez lsblk maintenant, il y aura quelque chose comme ceci:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
sdb      8:16   1  14,6G  0 disk <font></font>
├─sdb1   8:17   1   256M  0 part <font></font>
└─sdb2   8:18   1  14,3G  0 part<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Montons sdb1 et voyons ce qui s'y trouve:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
$ sudo mount /dev/sdb1 /mnt<font></font>
$ ls /mnt/<font></font>
bcm2708-rpi-b.dtb       bcm2710-rpi-3-b.dtb       COPYING.linux  fixup_db.dat      start_db.elf<font></font>
bcm2708-rpi-b-plus.dtb  bcm2710-rpi-3-b-plus.dtb  fixup4cd.dat   fixup_x.dat       start.elf<font></font>
bcm2708-rpi-cm.dtb      bcm2710-rpi-cm3.dtb       fixup4.dat     issue.txt         start_x.elf<font></font>
bcm2708-rpi-zero.dtb    bcm2711-rpi-4-b.dtb       fixup4db.dat   kernel.img<font></font>
bcm2708-rpi-zero-w.dtb  bootcode.bin              fixup4x.dat    LICENCE.broadcom<font></font>
bcm2709-rpi-2-b.dtb     cmdline.txt               fixup_cd.dat   overlays<font></font>
bcm2710-rpi-2-b.dtb     config.txt                fixup.dat      start_cd.elf<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, il existe tout un ensemble de * .dtb pour toutes les occasions - pour différentes versions de Raspberry. </font><font style="vertical-align: inherit;">Nous voyons également le chargeur de démarrage - bootcode.bin, et kernel.img est Linux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons connecté le moniteur via HDMI à la carte, démarré, vu Raspbian, tout va bien. </font><font style="vertical-align: inherit;">Ensuite, nous devons copier notre binaire avec Embox dans kernel.img afin que le chargeur de démarrage le charge. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Construire Embox:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
make confload-arm/rpi1-model-b<font></font>
make<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copiez le binaire résultant:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
cp build/base/bin/embox.bin /mnt/kernel.img<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous réinsérons la carte SD dans Rpi et allumons le moniteur - le carré qui aurait dû être tracé par l'Embox n'apparaissait pas. </font><font style="vertical-align: inherit;">Eh bien, essayons de nous connecter via le port série et de déboguer notre binaire. </font><font style="vertical-align: inherit;">Pour ce faire, utilisez l'adaptateur RDC1-USB-UART. </font><font style="vertical-align: inherit;">Nous le connectons à la carte comme suit:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
RDC1      Rapi<font></font>
<font></font>
GND &lt;---&gt; GND<font></font>
5V  &lt;---&gt; 5V<font></font>
RX  &lt;---&gt; TXD0/GPIO14<font></font>
TX  &lt;---&gt; RXD0/GPIO15<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous pouvez voir le brochage sur l'image afin qu'il soit pardonné. Il s'avère maintenant que l'alimentation de l'adaptateur USB provient du concentrateur USB du PC et que l'alimentation du Rpi, à son tour, est fournie par l'adaptateur USB. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/un/ro/_l/unro_lw0ym064oh8harvubx6fhy.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Allumer. Connectez-vous via minicom:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
sudo minicom -d /dev/ttyUSB0<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aucune conclusion n'est visible. Il doit y avoir une sorte de problème avec le pilote du port série. Nous essayons de désactiver l'initialisation du registre et utilisons ce qui a été configuré par le chargeur de démarrage, remplissons une nouvelle image sur la carte SD - la sortie est apparue. Tout est clair, cela signifie qu'il était correctement connecté, mais le pilote du port série n'est pas programmable correctement. Je ne parlerai pas de la façon dont nous avons réparé le pilote du port série PL011, mais je noterai quelques points qui peuvent être utiles lors du développement de cette plate-forme. Premièrement, les adresses de base sur Rpi sont calculées de manière confuse, elles ne peuvent pas être trouvées immédiatement dans la documentation, donc un bon moyen de vérifier l'adresse de base des registres est de les regarder sous Linux:</font></font><br>
<br>
<pre><code class="bash hljs"><font></font>
pi@raspberrypi:~$ ls /sys/bus/amba/devices/20201000.serial<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous voyons que l'adresse est 0x20201000. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième point est qu'il y a Linux modifié pour Rpi, qui peut être assemblé et copié dans kernel.img - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.raspberrypi.org/documentation/linux/kernel/building.md</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dans le cas du port série, cela a vraiment aidé à comprendre la fréquence d'entrée UARTCLK, nécessaire pour programmer la vitesse de transmission - insérez simplement printk () au bon endroit dans les pilotes / tty / serial / amba-pl011.c. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, sans aucun changement significatif, nous avons réussi à lancer la même image que pour QEMU sur le fer.</font></font><img src="https://habrastorage.org/webt/gm/wm/k8/gmwmk81lk6v4yuxsqvwyfidytj0.jpeg" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est probablement tout, car cela n'a aucun sens de démonter les sources du pilote, car vous pouvez simplement les étudier dans notre référentiel. En général, il semble que sous Raspberry, il existe très peu de ports d'autres systèmes d'exploitation non Linux. Par exemple, je n'ai trouvé ni FreeRTOS (il s'est avéré qu'une sorte de référentiel se trouve sur GitHub, mais pas dans les versions officielles), ni pour NuttX, ni rien de ce genre. Oui, et les discussions sur les forums suggèrent que RTOS n'est censé pas être nécessaire là-bas et qu'il vaut mieux jouer à Arduino - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.raspberrypi.org/forums/viewtopic.php?t=201540 L' </font></font></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemple </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Osdev </font></a><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">s'est</font></a><font style="vertical-align: inherit;"> avéré être inopérant, donc si quelqu'un veut quelque chose - faites-le sur du métal nu, puis voyez de meilleurs exemples de notre part :)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le support complet du nouveau Rpi 2/3/4 est toujours dans nos plans. </font><font style="vertical-align: inherit;">Mais un certain soutien sera très probablement fourni dans le cadre du GSoC 2020, l'une des idées les plus populaires parmi les étudiants. </font><font style="vertical-align: inherit;">En fait, pour GSoC, nous avons restauré le support Rpi1 dans Embox. </font><font style="vertical-align: inherit;">Si quelqu'un réfléchit à la raison pour laquelle il a besoin de Rpi RTOS, écrivez dans les commentaires, nous serons heureux :) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, si vous étudiez les sources de RaPi ou tout simplement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embox,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous serons heureux de répondre aux questions: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Newsletter: embox-ru@googlegroups.com </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chat télégramme: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.me/embox_chat</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr494266/index.html">À propos d'Udalenka, du RDP non protégé et de l'augmentation du nombre de serveurs disponibles sur Internet</a></li>
<li><a href="../fr494270/index.html">Antiquités: travail à distance sur des appareils de 1998</a></li>
<li><a href="../fr494272/index.html">Création d'un plan d'affaires de démarrage informatique: structure détaillée étape par étape</a></li>
<li><a href="../fr494274/index.html">Système d'autotest e-commerce</a></li>
<li><a href="../fr494278/index.html">EF Core + Oracle: comment rendre les migrations idempotentes</a></li>
<li><a href="../fr494290/index.html">#YAMYWork. Une décision qui peut être juste</a></li>
<li><a href="../fr494292/index.html">Wrike: 5 ans avec OKR</a></li>
<li><a href="../fr494294/index.html">Impression 3D certifiée pour les industries pétrolière et gazière et marine</a></li>
<li><a href="../fr494296/index.html">Xiaomi Gateway (version européenne - Lumi.gateway.mieu01) piraté</a></li>
<li><a href="../fr494298/index.html">Envoyé pour les petits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>