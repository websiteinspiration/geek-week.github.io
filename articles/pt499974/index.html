<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñï üèñÔ∏è üéâ Jogos em 3D no Instagram Javascript ou rota de salsicha ‚≠êÔ∏è üßîüèΩ üë©üèΩ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ap√≥s o primeiro artigo sobre programa√ß√£o de jogos em m√°scaras no Instagram, um cliente me pediu para criar um jogo no Instagram para sua pizzaria. Est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Jogos em 3D no Instagram Javascript ou rota de salsicha</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/499974/"><img src="https://habrastorage.org/webt/gl/zq/2a/glzq2aogs8xde9o1cauyy8qc838.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s o primeiro artigo sobre programa√ß√£o de jogos em m√°scaras no Instagram, um cliente me pediu para criar um jogo no Instagram para sua pizzaria. Este jogo foi planejado para ser usado para fins de promo√ß√£o de neg√≥cios. Claro, eu entendo que, a julgar pelo n√∫mero de visualiza√ß√µes do primeiro artigo, o tema do Instagram n√£o √© particularmente interessante para a comunidade Habr. Aparentemente, esse servi√ßo ainda √© considerado algum tipo de entretenimento fr√≠volo para as loiras, e um artigo sobre ele √© adequado apenas como leitura de sexta-feira para um coquetel √† noite. No entanto, hoje, apenas sexta-feira. Pegue um coquetel. E n√£o se esque√ßa de convidar loiras. No entanto, √© prov√°vel que no futuro a tecnologia atinja tais alturas que come√ßaremos a jogar no Instagram no GTA-5. Ou 10.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo discutir√° dois jogos ao mesmo tempo. </font><font style="vertical-align: inherit;">Fiz um para pedir e depois o segundo para mim. </font><font style="vertical-align: inherit;">A cada novo jogo, eu me deparava com novas tarefas, a busca de solu√ß√µes para as quais me familiarizei com as novas nuances do desenvolvimento. </font><font style="vertical-align: inherit;">Talvez essa hist√≥ria seja √∫til para outros desenvolvedores de elementos de realidade aumentada. </font><font style="vertical-align: inherit;">Os jogos s√£o escritos em Javascript puro, sem o uso de bibliotecas adicionais. </font><font style="vertical-align: inherit;">Para exibir gr√°ficos 3D, as ferramentas internas do Instagram s√£o usadas.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jogo 1. Pizza</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, qual √© a ess√™ncia do primeiro jogo. Pizza girando. Os componentes voam de sua superf√≠cie - peda√ßos de lingui√ßa, tomate e assim por diante. Dois jogadores devem pegar sua boca. O vencedor √© aquele que, como voc√™ pode imaginar, vai pegar mais. Com o tempo, a velocidade de rota√ß√£o aumenta. O mais engra√ßado neste jogo para mim foi programar as rotas de v√¥o desses elementos comest√≠veis. Imagine programar um v√¥o de salsicha. N√£o, definitivamente, nunca me diverti tanto com programa√ß√£o. Eu ri agora mesmo, escrevendo este artigo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando o cliente viu o prot√≥tipo em funcionamento, ele me enviou o seguinte: ‚Äú:))‚Äù. Houve um problema ao testar o resultado final. Consistia no fato de que os sujeitos n√£o podiam jogar: estavam simplesmente rindo - foi muito divertido.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembr√°-lo, o desenvolvimento de m√°scaras e jogos √© feito no Spark AR Studio. A partir da√≠, voc√™ pode enviar seu trabalho no Instagram para que todos possam ver. Vale ressaltar que as tecnologias da web obscurecem os limites entre sistemas operacionais para um desenvolvedor. Voc√™ escreve um c√≥digo, que funciona no aplicativo Instagram para iOS e Android, sem modifica√ß√µes ou altera√ß√µes. Obviamente, o pagamento por isso se torna uma velocidade de script fundamentalmente baixa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O cronograma do jogo foi fornecido pelo cliente. Houve algumas dificuldades com os modelos 3D. Em particular, ao usar o mecanismo de anima√ß√£o interno Spark AR Studio, descobriu-se que, se o objeto em movimento √© dimensionado, suas coordenadas s√£o determinadas incorretamente no jogo. Mas esse efeito irritante n√£o √© observado se voc√™ n√£o dimensionar completamente o objeto inteiro, mas cada uma de suas malhas separadamente. Eu tive que deixar a escala da pizza 1: 1 e prescrever um certo coeficiente para cada elemento que a produz. Tamb√©m houve problemas com o formato FBX para o qual voc√™ precisa exportar modelos para um jogo do Instagram. O designer gr√°fico enviou modelos com texturas embutidas, que, al√©m disso, foram colocadas ao longo de um caminho relativo. O editor 3D os viu, mas o Spark AR n√£o. Eu tive que reembalar os modelos para que os arquivos de textura estivessem separados dos modelos e ao longo de um caminho com eles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E outro pequeno problema que encontrei foi que o objeto api Saprk AR respons√°vel por exibir o texto na tela se recusou a aceitar o valor como um valor - uma pontua√ß√£o do jogo, por exemplo. </font><font style="vertical-align: inherit;">Durante muito tempo, n√£o entendi por que nada √© exibido. </font><font style="vertical-align: inherit;">O que estou fazendo errado? </font><font style="vertical-align: inherit;">Aconteceu que voc√™ primeiro precisa converter os n√∫meros em strings (.toString ()). </font><font style="vertical-align: inherit;">Isso √© desnecess√°rio para outras l√≠nguas, mas at√≠pico para javascript, que sempre fez isso por si s√≥.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anima√ß√£o simples</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma das novidades para mim neste jogo foi programar a anima√ß√£o de objetos 3D. (No meu jogo anterior do Instagram ‚ÄúTic-Tac-Toe‚Äù, n√£o havia anima√ß√£o). O mecanismo de anima√ß√£o no Spark AR Studio √© muito espec√≠fico. S√£o necess√°rios alguns par√¢metros de entrada e, em seguida, conecta reativamente a vari√°vel ao objeto no qual voc√™ deseja alterar alguma coisa. Por exemplo, isso alterar√° a coordenada y (startValue, endValue - seus valores iniciais e finais) de algum objeto 3D ao longo do tempo t:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">var</span> driverParameters = {
    <span class="hljs-attr">durationMilliseconds</span>: t,
    <span class="hljs-attr">loopCount</span>: <span class="hljs-literal">Infinity</span>,
    <span class="hljs-attr">mirror</span>: <span class="hljs-literal">false</span><font></font>
};<font></font>
<span class="hljs-keyword">var</span> driver = Animation.timeDriver(driverParameters);
<span class="hljs-keyword">var</span> sampler = Animation.samplers.linear(startValue, endValue);<font></font>
sceneObject.transform.y = Animation.animate(driver, sampler);<font></font>
driver.start();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mover os ingredientes da pizza no espa√ßo, decidi simplesmente executar tr√™s dessas anima√ß√µes em paralelo para cada coordenada. Foi o suficiente para indicar a coordenada inicial (startValue) e a coordenada final calculada pelo √¢ngulo de rota√ß√£o da pizza (endValue), de modo que ela estivesse em algum lugar distante, caso o jogador n√£o pegasse essa ‚Äúconcha‚Äù com a boca. Se travado - ent√£o o movimento para. O evento de abertura da boca que eu j√° descrevi em um artigo anterior. Somente aqui est√° um jogo para dois e, portanto, j√° haver√° duas faces e duas bocas:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});<font></font>
<font></font>
FaceTracking.face(<span class="hljs-number">1</span>).mouth.openness.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.newValue &gt; <span class="hljs-number">0.2</span>) {<font></font>
        ...<font></font>
    };<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O ponto principal deste jogo √© pegar ingredientes voadores com a boca, ou seja, encontrar um objeto voador em uma determinada √°rea pequena ao redor do centro da boca de uma pessoa. </font><font style="vertical-align: inherit;">No in√≠cio, esse c√°lculo n√£o queria ser feito corretamente para mim, mas uma solu√ß√£o para o problema foi encontrada ap√≥s a introdu√ß√£o de um objeto oculto vinculado √†s coordenadas da boca e funcionou. </font><font style="vertical-align: inherit;">Por alguma raz√£o, as coordenadas diretas da boca n√£o retornaram. </font><font style="vertical-align: inherit;">Aqui cameraTransform.applyTo √© a redu√ß√£o das coordenadas dos pontos de face √†s coordenadas no mundo 3D (o m√©todo √© retirado da documenta√ß√£o).</font></font><br>
<br>
<pre><code class="javascript hljs">move: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//   (   )</span><font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> object = Scene.root.find(<span class="hljs-string">'pizzafly'</span>);
    <span class="hljs-keyword">var</span> olast = {
        <span class="hljs-attr">x</span>: object.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: object.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: object.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   ,       </span>
    <span class="hljs-keyword">var</span> objectHidden = Scene.root.find(<span class="hljs-string">'nullObject'</span>);<font></font>
    objectHidden.transform.x = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).x;<font></font>
    objectHidden.transform.y = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).y;<font></font>
    objectHidden.transform.z = FaceTracking.face(face).cameraTransform.applyTo(FaceTracking.face(face).mouth.center).z;<font></font>
<font></font>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> mouth = {
        <span class="hljs-attr">x</span>: objectHidden.transform.x.pinLastValue(),
        <span class="hljs-attr">y</span>: objectHidden.transform.y.pinLastValue(),
        <span class="hljs-attr">z</span>: objectHidden.transform.z.pinLastValue()<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//    </span>
    <span class="hljs-keyword">var</span> d = {
        <span class="hljs-attr">x</span>: <span class="hljs-built_in">Math</span>.abs(olast.x - mouth.x),
        <span class="hljs-attr">y</span>: <span class="hljs-built_in">Math</span>.abs(olast.y - mouth.y),
        <span class="hljs-attr">z</span>: <span class="hljs-built_in">Math</span>.abs(olast.z - mouth.z)<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> ((d.x &gt; <span class="hljs-number">0.03</span>) || (d.y &gt; <span class="hljs-number">0.03</span>) || (d.z &gt; <span class="hljs-number">0.03</span>)) {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// </span><font></font>
        ...<font></font>
    };<font></font>
<font></font>
},<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Posteriormente, percebi que voc√™ deveria remover a verifica√ß√£o de profundidade (coordenada z), pois nesse jogo em particular √© visualmente dif√≠cil estimar a profundidade. </font><font style="vertical-align: inherit;">Ou seja, agora tornou-se poss√≠vel pegar o ingrediente abrindo a boca a qualquer momento durante o voo. </font><font style="vertical-align: inherit;">O principal √© a combina√ß√£o de x e y.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nw/v9/dw/nwv9dwt-p5wip4yhnnhtirudgoe.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, o √∫ltimo problema que encontrei ao escrever este jogo foi limitar o tamanho da vers√£o final para 4 MB. Al√©m disso, de acordo com a recomenda√ß√£o do Facebook, para que o jogo seja exibido no maior n√∫mero poss√≠vel de dispositivos m√≥veis, √© aconselh√°vel caber at√© 2 MB. E os modeladores em 3D s√£o pessoas criativas e querem criar modelos pesados ‚Äã‚Äãcom uma grade densa e texturas enormes, completamente sem se importar conosco, programadores, ou melhor, com o desempenho final dos jogos. Tamb√©m reduzi de alguma forma as texturas em tamanho e as comprimi em jpg (em vez de png), mas o pr√≥prio modelo de pizza teve que ser enviado para revis√£o (retopologia). Como resultado, no entanto, foi poss√≠vel caber no volume de 2 MB com todos os modelos, texturas e um script. E o jogo continuou com modera√ß√£o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E depois de algum tempo, ela voltou com a reda√ß√£o de que "o efeito cont√©m muito texto est√°tico". </font><font style="vertical-align: inherit;">Eu tive que remover os n√∫meros da contagem regressiva e, em vez deles, definir a anima√ß√£o para a seta no cron√¥metro, que agora come√ßou a contar o tempo em vez deles. </font><font style="vertical-align: inherit;">Depois disso, o jogo foi aprovado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jogo 2. Sobre a borboleta (ButterFlap)</font></font></h3><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wd/dt/63/wddt63fejsxelpizwyffhzw5zig.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vou falar sobre a cria√ß√£o de um segundo jogo. N√£o posso deixar de fazer jogos, esse √© o meu hobby. Alguns dias antes de 8 de mar√ßo, decidi criar um jogo no Instagram para este feriado. Algo sobre flores, borboletas e doces. Mas n√£o conseguia pensar em qual poderia ser a ess√™ncia do jogo. O pensamento girou em minha cabe√ßa. Talvez a borboleta colete doces e os coloque em uma cesta? Ou talvez as borboletas apanhem doces no ar e os joguem, e o jogador precisar√° peg√°-los com a boca? Em geral, eu golpeei por alguns dias e, n√£o encontrando uma solu√ß√£o, percebi que, em 8 de mar√ßo, meu jogo ainda n√£o teria tempo para passar pela modera√ß√£o, j√° que o √∫ltimo leva 3-4 dias. Eu j√° queria sair desse empreendimento, quando de repente a ideia surgiu por si s√≥, de repente. Eu n√£o amarrei mais o jogo no Dia da Mulher, agora era apenas um jogo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Scroller. </font><font style="vertical-align: inherit;">Da esquerda para a direita, a paisagem e v√°rios obst√°culos se movem. </font><font style="vertical-align: inherit;">O jogador deve controlar uma borboleta que possa se mover livremente na tela e coletar diamantes pendurados no ar. </font><font style="vertical-align: inherit;">Da direita para a esquerda, um pouco mais r√°pido que o resto da imagem, as nuvens est√£o se movendo, das quais a chuva est√° caindo. </font><font style="vertical-align: inherit;">Voc√™ precisa se esconder da chuva sob as flores. </font><font style="vertical-align: inherit;">Se uma borboleta cai na √°gua, suas asas se molham e ela cai, este √© o fim do jogo. </font><font style="vertical-align: inherit;">Eu chamei o jogo simplesmente: ButterFlap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim, tudo isso parece bom. </font><font style="vertical-align: inherit;">Eu, diretamente, queria me jogar. </font><font style="vertical-align: inherit;">Mas lembrei que n√£o era um artista. </font><font style="vertical-align: inherit;">No entanto, sou capaz de criar modelos 3D, e isso √© mais f√°cil do que desenhar. </font><font style="vertical-align: inherit;">Ent√£o, foi decidido, que houvesse um scroller 3D.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artes gr√°ficas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontrei modelos on-line isentos de royalties que precisava refinar. Ele puxou as texturas para aquelas que n√£o tinham texturas, tendo previamente colocado o √∫ltimo em um atlas de textura: artefatos na forma de ‚Äúescadas‚Äù s√£o vis√≠veis em modelos sem textura e a suaviza√ß√£o pode ser definida para texturas no jogo, o que torna a apar√™ncia dos objetos mais apresent√°veis ‚Äã‚Äãe n√£o t√£o planos. Esses modelos que continham texturas tamb√©m tinham suas falhas que precisavam ser corrigidas. Em primeiro lugar, o tamanho das texturas n√£o era m√∫ltiplo de dois no poder. Ou seja, por exemplo, poderia ser igual a 1200x1200. Eu tive que comprimir para 1024x1024. Os processadores de v√≠deo podem dimensionar ou preencher texturas inadequadas com espa√ßo vazio, ou seja, aquelas que n√£o s√£o 1024x1024, 512x512, 256x256 etc. De qualquer forma, essas a√ß√µes s√£o uma carga extra durante o trabalho do jogo e um consumo de mem√≥ria sem sentido,portanto, √© melhor preparar as imagens corretas primeiro manualmente. A situa√ß√£o tamb√©m foi salva pelo fato de eu distribuir todas as texturas por atlas de textura; portanto, se, por exemplo, a textura original tinha tamanho de 400x200 pixels, eu poderia coloc√°-la no atlas 1024x1024, como √©, ao lado de outras similares. Depois disso, √© naturalmente necess√°rio escalar tamb√©m a varredura UV, mas isso √© feito em alguns segundos. Ainda deparamos com variantes de modelos onde, por algum motivo, as texturas foram amarradas ao longo de um caminho absoluto, como "C: \ Work \ Vasya \ Map.jpg". Bem, n√£o existe essa pasta no meu computador! Eu tive que especificar os caminhos para as texturas manualmente ... Mas por que voc√™ teve a id√©ia de que eu deveria manter todos os meus projetos no drive ‚ÄúC:‚Äù!? Ah, esses modeladores, artistas livres ... A prop√≥sito, pelos nomes das pastas nos caminhos deixados aleatoriamente, voc√™ pode inadvertidamente aprender mais sobre a identidade do modelador,por exemplo, o nome dele. Prazer em conhec√™-lo!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mais dif√≠cil foi encontrar um modelo de borboleta adequado com anima√ß√£o. O Spark AR usa anima√ß√£o que pode ser exportada de qualquer editor 3D para o formato FBX. As asas de um par de modelos de borboleta que eu baixei eram de algum modo estranhamente espelhadas - uma asa foi modelada e a segunda foi refletida de alguma maneira que eu n√£o entendi e, portanto, duas delas apareceram. Com essa abordagem de modelagem, como resultado, no jogo, uma das asas (copiada) n√£o queria receber luz da fonte e sempre permaneceu fraca. N√£o corri o risco de mudar drasticamente o modelo, porque a anima√ß√£o teria voado. E na anima√ß√£o eu sou um noob ainda maior do que na modelagem 3D. Talvez o problema fosse outra coisa: tentei, por exemplo, expandir os normais, mas isso n√£o ajudou. Em suma, os modelos 3D gratuitos s√£o uma dor. Como resultado, depois de ter lavado a noite toda,por tentativa e erro, encontrei um modelo adequado que, depois de algum ajuste fino em um arquivo, come√ßou a parecer satisfat√≥rio. Algo que eu n√£o gostei, mas foram pequenas coisas: refiz a textura, mudei a geometria em alguns lugares e ajustei os par√¢metros do material. Finalmente, a borboleta decolou. Viva. Mas agora estou exausta. Ent√£o eu decidi ir para a cama e continuar no dia seguinte. Sim, passei 7-8 dias na cria√ß√£o do jogo. Mas era um trabalho t√£o tranq√ºilo √† noite, lendo documenta√ß√£o, artigos e encontrando respostas para perguntas.Ent√£o eu decidi ir para a cama e continuar no dia seguinte. Sim, passei 7-8 dias na cria√ß√£o do jogo. Mas era um trabalho t√£o tranq√ºilo √† noite, lendo documenta√ß√£o, artigos e encontrando respostas para perguntas.Ent√£o eu decidi ir para a cama e continuar no dia seguinte. Sim, passei 7-8 dias na cria√ß√£o do jogo. Mas era um trabalho t√£o tranq√ºilo √† noite, lendo documenta√ß√£o, artigos e encontrando respostas para perguntas.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/zb/iy/rrzbiyezloccrjo_egas613ltry.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante toda a noite, no dia seguinte, trabalhei em gr√°ficos. A especificidade das m√°scaras de jogo para o Instagram, como j√° mencionei, √© que √© aconselh√°vel n√£o exceder o volume de 2 MB para o jogo inteiro (m√°ximo de 4 MB). Eu n√£o estava preocupado com o script: √© improv√°vel que seu tamanho exceda 50 Kb. Mas em modelos 3D de plantas teve que ser bastante conjurado. Por exemplo, a parte do girassol onde as sementes est√£o localizadas foi feita por geometria. Centenas de pol√≠gonos ... Substitua-o por um fragmento de uma esfera de algumas d√∫zias de tri√¢ngulos e estique a textura baixada, de fato, desta parte. O n√∫mero de folhas tamb√©m pode ser reduzido. Fazemos grama no fundo da cena com um plano de dois tri√¢ngulos com uma textura sobreposta com um canal alfa. Alcan√ßamos o volume com sombras e copiando fragmentos da imagem dentro da pr√≥pria textura.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, √© desej√°vel minimizar o n√∫mero de texturas, bem como o tamanho em bytes. </font><font style="vertical-align: inherit;">S√£o as texturas que criam a maior parte do jogo. </font><font style="vertical-align: inherit;">Estou acostumado a texturas onde a transpar√™ncia √© necess√°ria, colocada em um atlas de textura - em png de 32 bits, e texturas que n√£o usam o canal alfa, empacotadas em outro atlas, salvando-as em jpg. </font><font style="vertical-align: inherit;">Jpg pode ser encolhido mais forte que png. </font><font style="vertical-align: inherit;">Os elementos Grass e UI que precisam de transpar√™ncia foram para o atlas png e tudo o mais para jpg.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O volume total. </font><font style="vertical-align: inherit;">No total, eu tenho 4 tipos de plantas, uma pedra, uma borboleta, que o jogador controlar√° e uma nuvem. </font><font style="vertical-align: inherit;">As texturas de todos esses modelos na forma compactada levaram 2 atlas 1024x1024 jpg e png com um volume total de 500 Kb. </font><font style="vertical-align: inherit;">Os pr√≥prios modelos levaram cerca de 200 Kb. </font><font style="vertical-align: inherit;">Al√©m de um script. </font><font style="vertical-align: inherit;">Sons - 31 Kb. </font><font style="vertical-align: inherit;">Total: cerca de 1 Mb. </font><font style="vertical-align: inherit;">Em verde, o tamanho da compila√ß√£o √© apenas exibido (√© o que deve caber em 2 MB).</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/7r/c1/ak7rc1e09ycyaee13ypwnokgeqm.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De repente, encontrei um problema completamente inesperado. </font><font style="vertical-align: inherit;">Exclu√≠ v√°rios modelos n√£o utilizados, mas n√£o atrav√©s do Spark AR Studio, mas do sistema de arquivos. </font><font style="vertical-align: inherit;">Posteriormente, ao montar a constru√ß√£o, descobri que eles desapareceram da cena do Spark AR Studio, mas ainda entraram na montagem. </font><font style="vertical-align: inherit;">E limpar o projeto de recursos n√£o utilizados √© imposs√≠vel. </font><font style="vertical-align: inherit;">Os links para eles do "Resumo do ativo" n√£o levam a lugar algum. </font><font style="vertical-align: inherit;">Aparentemente, esse √© um defeito no Spark AR Studio. </font><font style="vertical-align: inherit;">Eu tive que recriar o projeto novamente, adicionando todos os recursos necess√°rios desde o in√≠cio.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cena</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estou pensando h√° muito tempo em como implementar a rolagem de todos os objetos na tela. </font><font style="vertical-align: inherit;">Das ferramentas para isso, existe apenas javascript e o mecanismo de anima√ß√£o interno mais simples do Spark AR Studio, que pode simplesmente alterar as coordenadas do objeto do valor inicial para a final em um determinado momento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim, o dilema ainda surgiu antes: criar um n√≠vel inteiro do jogo, uma cena em um editor 3D, duplicando as plantas repetidas o n√∫mero necess√°rio de vezes e colocando-as nas posi√ß√µes corretas, para rolar a cena inteira no jogo ou carregar apenas uma c√≥pia de cada 3D objeto e substitua-os na dire√ß√£o do jogador fora da tela. A resposta foi √≥bvia. Nossa escolha √© a segunda op√ß√£o. Caso contr√°rio, √© imposs√≠vel caber em 2 MB: provavelmente, a cena de acordo com a primeira op√ß√£o ser√° pesada. Mas ent√£o voc√™ precisa de um layout de objetos. E eu, sem hesita√ß√£o, decidi usar o editor 3D como um editor de n√≠veis. Sim, acontece que eu fiz as duas coisas. Plantas para o jogo, eu salvei cada uma em uma c√≥pia. E do editor eu precisava apenas das coordenadas. Depois de concluir o trabalho,Escrevi as coordenadas de todos os objetos e fiz uma matriz com os dados do jogo.</font></font><br>
<br>
<pre><code class="javascript hljs">lv:[<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">8.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-6.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'cloud'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">0.1</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'rain'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">10.0</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">6.6</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'flower1'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">14</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">-2.5</span>},<font></font>
    {<span class="hljs-attr">n</span>:<span class="hljs-string">'diamond_red'</span>, <span class="hljs-attr">x</span>:<span class="hljs-number">20</span>, <span class="hljs-attr">y</span>:<span class="hljs-number">2.0</span>},<font></font>
	...<font></font>
],</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E ainda - uma matriz associativa separada, de acordo com os tipos de objetos em que os tamanhos dos coletores e seus deslocamentos em rela√ß√£o aos centros dos objetos 3D s√£o armazenados, bem como uma bandeira (col) que determina se o objeto √© um obst√°culo (caso contr√°rio, o jogador passa por ele). </font><font style="vertical-align: inherit;">Para alguns tipos de objetos, o sinalizador (destruir) √© definido, que determina se o objeto deve ser oculto ap√≥s a intera√ß√£o, bem como o par√¢metro (v), que determina algum grau de intera√ß√£o, por exemplo, o n√∫mero de pontos que um jogador ganha ou perde.</font></font><br>
<br>
<pre><code class="javascript hljs">colld:{
    <span class="hljs-string">'flower1'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">5</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">2.3</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1.4</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_green'</span>: {<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">destroy</span>:<span class="hljs-literal">true</span>},
    <span class="hljs-string">'diamond_red'</span>:{<span class="hljs-attr">dx</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">dy</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">w</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">h</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">col</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">v</span>:<span class="hljs-number">-2</span>},<font></font>
<font></font>
    ...<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um pouco de nuance. </font><font style="vertical-align: inherit;">A grama na parte inferior da cena deve rolar continuamente. </font><font style="vertical-align: inherit;">Portanto, voc√™ deve usar duas c√≥pias desse objeto e substitu√≠-las uma ap√≥s a outra √† medida que se move. </font><font style="vertical-align: inherit;">As flores aparecer√£o em uma tela, no m√°ximo em uma c√≥pia cada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tendo em mente o problema de escala que encontrei ao desenvolver o primeiro jogo, redefini a escala de todos os modelos no editor 3D. Assim, nos modelos Saprk AR carregados imediatamente em tamanhos normais. √â verdade que, de qualquer maneira, no script, n√£o poderia existir sem o "n√∫mero m√°gico", o coeficiente global, o c√≥digo universal, que cont√©m a ess√™ncia do universo. Um universo virtual, √© claro. E estou pronto para revelar esse n√∫mero para voc√™. Use, pessoal! Eu n√£o me importo! Este n√∫mero √© 0,023423. Em resumo, apesar da redefini√ß√£o de todas as escalas, um metro no editor 3D acabou sendo igual a esse n√∫mero no Spark AR Studio. Muito provavelmente, eu n√£o entendo completamente todos os meandros do trabalho com gr√°ficos 3D, da√≠ o coeficiente. As coordenadas (mas n√£o o tamanho) de todos os objetos que foram exportados do editor s√£o multiplicadas por ele, voc√™ adivinhou.Onde ajustar a escala da cena no Spark AR, n√£o encontrei.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥ximo problema que encontrei foi a perda da ordem de classifica√ß√£o dos objetos ao exportar de um editor 3D. </font><font style="vertical-align: inherit;">Objetos complexos que consistem em v√°rias malhas podem aparecer imprevisivelmente na cena do jogo de tal maneira que, por exemplo, uma malha que estava atr√°s de outra pulou repentinamente para a frente. </font><font style="vertical-align: inherit;">E, se voc√™ observar a ordem dos objetos ap√≥s exportar para o Spark AR Studio, realmente mostra que essa malha √©, por algum motivo, mais alta na lista, embora tenha sido mais baixa no editor. </font><font style="vertical-align: inherit;">Resolvi esse problema dividindo a cena em camadas e salvando-as em arquivos diferentes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anima√ß√£o complexa</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por mais tr√™s noites, eu brinquei com programa√ß√£o. Se eu usasse o mecanismo Spark AR Studio padr√£o para animar as asas de uma borboleta, a tarefa de mover o fundo n√£o era t√£o simples. Ainda n√£o entendi como anexar n√£o apenas um par√¢metro vari√°vel √†s itera√ß√µes do ciclo de movimento, mas uma fun√ß√£o de retorno de chamada completa. De qualquer forma, n√£o consegui, os par√¢metros de anima√ß√£o atuais n√£o quiseram ser transferidos para l√°. E essa fun√ß√£o √© simplesmente necess√°ria, porque, no primeiro jogo (com pizza), eu verifiquei a colis√£o no caso de abrir a boca assinando-a, ent√£o n√£o havia esse evento aqui. E era apenas necess√°rio verificar colis√µes com objetos ambientais √† medida que o personagem se move, de acordo com suas coordenadas atuais. E para isso, as coordenadas devem ser comparadas a cada itera√ß√£o. E ent√£o eu pensei. Afinal, eu j√° escrevi jogos em javascript.E por que n√£o usar seu mecanismo de anima√ß√£o que escrevi anteriormente para esses jogos? Seu princ√≠pio de opera√ß√£o √© aproximadamente o mesmo: em um determinado momento, o par√¢metro (ou par√¢metros) muda entre os valores iniciais e finais. E o valor atual √© passado como par√¢metro - voc√™ n√£o acredita - na fun√ß√£o de retorno de chamada fornecida, na qual, por exemplo, voc√™ pode definir um objeto 3D na cena com coordenadas iguais a esses valores atuais ou verificar colis√µes. Obrigado, cap. Eu tive que adaptar um pouco meu mecanismo ao ‚Äúecossistema‚Äù local: remover refer√™ncias ao objeto de janela de l√°, j√° que ele n√£o est√° aqui, e outras pequenas coisas.E o valor atual √© passado como par√¢metro - voc√™ n√£o acredita - na fun√ß√£o de retorno de chamada fornecida, na qual, por exemplo, voc√™ pode definir um objeto 3D na cena com coordenadas iguais a esses valores atuais ou verificar colis√µes. Obrigado, cap. Eu tive que adaptar um pouco meu mecanismo ao ‚Äúecossistema‚Äù local: remover refer√™ncias ao objeto de janela de l√°, j√° que ele n√£o est√° aqui, e outras pequenas coisas.E o valor atual √© passado como par√¢metro - voc√™ n√£o acredita - na fun√ß√£o de retorno de chamada fornecida, na qual, por exemplo, voc√™ pode definir um objeto 3D na cena com coordenadas iguais a esses valores atuais ou verificar colis√µes. Obrigado, cap. Eu tive que adaptar um pouco meu mecanismo ao ‚Äúecossistema‚Äù local: remover refer√™ncias ao objeto de janela de l√°, j√° que ele n√£o est√° aqui, e outras pequenas coisas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sim, ainda - sobre rolar a paisagem e os objetos do ambiente. Decidi colocar o mundo inteiro em um NullObject, ou seja, em um objeto 3D vazio, em um cont√™iner e mov√™-lo usando apenas um par√¢metro para anima√ß√£o - sua coordenada x. Dentro do cont√™iner, todos os modelos t√™m as mesmas coordenadas como se estivessem do lado de fora, s√≥ que agora o sistema de refer√™ncia est√° vinculado a esse objeto vazio. Rochas e flores ser√£o repetidas (al√©m disso, em diferentes alturas do solo, de acordo com o diagrama de n√≠veis), para que voc√™ possa reutilizar esses objetos enquanto se move, definindo-os na posi√ß√£o horizontal e vertical desejada dentro do "cont√™iner". Eu escrevi um sistema de busca de objetos que caem no quadro (no deslocamento atual do cont√™iner), que define o objeto que deixa o quadro em uma nova posi√ß√£o ainda mais, se ele aparecer l√°. Voc√™ pode ver,como funciona no exemplo de tr√™s objetos. (Haver√° mais deles no jogo, ent√£o voc√™ n√£o ver√° mais esse efeito de "reorganiza√ß√£o" dos objetos do ambiente.)</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f3i72svxLHM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A fun√ß√£o para atualizar as coordenadas dos objetos √© assim:</font></font><br>
<br>
<pre><code class="javascript hljs">oCoordSet: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-comment">//  :    </span>
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">var</span> camx = -ap.oWorld.transform.x.pinLastValue();
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> x1 = camx - ap.game.scro.w2;
    <span class="hljs-keyword">var</span> x2 = camx + ap.game.scro.w2;
    <span class="hljs-comment">//   </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">if</span> ((ap.d.lv[i].x &gt;= x1) &amp; (ap.d.lv[i].x &lt;= x2)) {
            <span class="hljs-comment">//   </span><font></font>
            ap.d.lv[i].o = Scene.root.find(ap.d.lv[i].n);<font></font>
            <span class="hljs-comment">//  -  </span><font></font>
            ap.d.lv[i].o.transform.y = ap.d.lv[i].y;<font></font>
            <span class="hljs-keyword">if</span> ((ap.d.lv[i].n == <span class="hljs-string">'cloud'</span>) || (ap.d.lv[i].n == <span class="hljs-string">'rain'</span>)) {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//  </span>
                <span class="hljs-comment">//   2.3,</span>
                <span class="hljs-comment">//     </span>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x - (x2 - ap.d.lv[i].x) * <span class="hljs-number">2.3</span> + <span class="hljs-number">0.2</span>;<font></font>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//    ,</span>
                <span class="hljs-comment">//      </span><font></font>
                ap.d.lv[i].o.transform.x = ap.d.lv[i].x;<font></font>
            };<font></font>
        };<font></font>
    };<font></font>
    <span class="hljs-comment">//        </span>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">if</span> (camx &gt; ap.game.grassPosLast) {<font></font>
        ap.game.grassPosLast += ap.game.grassd;<font></font>
        ap.game.grassi = <span class="hljs-number">1</span> - ap.game.grassi;<font></font>
        ap[ap.game.grassNm[ap.game.grassi]].transform.x = ap.game.grassPosLast;<font></font>
    };<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O personagem principal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O personagem principal do jogo √© uma borboleta inafund√°vel, que corajosamente voa para frente, superando obst√°culos. </font><font style="vertical-align: inherit;">Decidi fazer o gerenciamento definindo um marcador ou cursor (ponto de luz), virando e inclinando a cabe√ßa. </font><font style="vertical-align: inherit;">E na dire√ß√£o deste ponto, uma borboleta voar√° lentamente (na verdade, n√£o √© um lutador, nem pode se teletransportar). </font><font style="vertical-align: inherit;">Por exemplo, se voc√™ se inscrever no evento de inclina√ß√£o da cabe√ßa, poder√° implementar o controle vertical como este:</font></font><br>
<br>
<pre><code class="javascript hljs">FaceTracking.face(<span class="hljs-number">0</span>).cameraTransform.rotationX.monitor().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">var</span> v = event.newValue;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> scrH2 = ap.game.scr.h2;
    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">var</span> p = -v * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">if</span> (p &lt; -scrH2) {<font></font>
        p = -scrH2;<font></font>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p &gt; scrH2) {<font></font>
        p = scrH2;<font></font>
    };<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">0.006</span>;
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">var</span> cur = ap.oPers.transform.y.pinLastValue();
    <span class="hljs-keyword">if</span> (p &lt; cur) {<font></font>
        cur -= d;<font></font>
        <span class="hljs-keyword">if</span> (cur &lt; p) {cur = p;};<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        cur += d;<font></font>
        <span class="hljs-keyword">if</span> (cur &gt; p) {cur = p;};<font></font>
    };<font></font>
    <span class="hljs-comment">//    ()</span><font></font>
    ap.oPointer1.transform.y = p;<font></font>
    <span class="hljs-comment">//   ,</span>
    <span class="hljs-comment">// ,    </span><font></font>
    ap.game.pers.dy + = cur - ap.game.pers.y;<font></font>
});</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da mesma forma para a horizontal. </font><font style="vertical-align: inherit;">Somente l√° √© necess√°rio assinar o evento n√£o de inclina√ß√£o, mas de rota√ß√£o da cabe√ßa (rota√ß√£oY) e, em vez da altura da tela, considere sua largura.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colisores</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo isso √© maravilhoso, o mundo est√° se movendo e o personagem do jogo pode se mover livremente pela tela. Mas agora voc√™ precisa de um manipulador de colis√£o, caso contr√°rio, nenhum jogo funcionar√°. Existem tr√™s eventos no jogo, segundo os quais a posi√ß√£o do personagem pode mudar. √â a rota√ß√£o e inclina√ß√£o da cabe√ßa, bem como o movimento do mundo, no qual a coordenada horizontal do jogador (x) aumenta automaticamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como n√£o sei como as itera√ß√µes do manipulador de faces funcionam no Spark AR - sejam elas chamadas com uma certa frequ√™ncia ou definidas com a freq√º√™ncia de clock m√°xima poss√≠vel, e no meu mecanismo de anima√ß√£o eu posso controlar esse par√¢metro, decidi que definiria colis√µes em minha fun√ß√£o o movimento do mundo, chamado em uma frequ√™ncia definida por mim (60 quadros por segundo). Nos eventos de processamento de face, apenas "acumularemos" movimento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O princ√≠pio ser√° assim. Nos eventos de inclina√ß√£o e rota√ß√£o da cabe√ßa, um deslocamento ao longo dos eixos x e y √© acumulado. Al√©m disso, na fun√ß√£o de rolar o mundo, um deslocamento horizontal tamb√©m √© adicionado ao "cofrinho". E ent√£o √© verificado, se o deslocamento acumulado for adicionado √†s coordenadas originais, haver√° uma colis√£o com qualquer um dos objetos no mundo. Caso contr√°rio, as coordenadas originais do jogador mais o deslocamento s√£o feitas pelas coordenadas atuais. E ent√£o atualizamos os de origem para os atuais (redefinir) e redefinir as compensa√ß√µes. Nesse caso, reverta as coordenadas para o original. Al√©m disso, precisamos determinar em qual eixo a colis√£o seria, pois as duas coordenadas n√£o podem ser revertidas. Caso contr√°rio, o jogador simplesmente "gruda" em um ponto no espa√ßo e n√£o pode mais se mover para lugar nenhum. √â necess√°rio dar-lhe liberdade de movimento ao longo do eixo ao longo do qual a colis√£o n√£o ocorre.Ent√£o voc√™ pode dar a ele a chance de voar em torno de um obst√°culo.</font></font><br>
<br>
<pre><code class="javascript hljs">setPersPos: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">camx, camdx</span>) </span>{
    <span class="hljs-comment">//   </span>
    <span class="hljs-comment">//       (camx,camdx)</span><font></font>
<font></font>
    <span class="hljs-comment">//     </span>
    <span class="hljs-keyword">var</span> persx = ap.game.pers.x;
    <span class="hljs-keyword">var</span> persy = ap.game.pers.y;
    <span class="hljs-keyword">var</span> dx = ap.game.pers.dx;
    <span class="hljs-keyword">var</span> dy = ap.game.pers.dy;<font></font>
<font></font>
    <span class="hljs-comment">// ,     </span>
    <span class="hljs-keyword">var</span> col = ap.collisionDetect(<font></font>
        {<span class="hljs-attr">x</span>: persx, <span class="hljs-attr">y</span>: persy, <span class="hljs-attr">dx</span>: dx, <span class="hljs-attr">dy</span>: dy},<font></font>
        {<span class="hljs-attr">x</span>: camx, <span class="hljs-attr">dx</span>: camdx, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>}<font></font>
    );<font></font>
<font></font>
    <span class="hljs-keyword">if</span> (col.f == <span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// </span><font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.colx == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span>
            <span class="hljs-comment">//(    ,    )</span><font></font>
            ap.game.pers.x = col.x;<font></font>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//    ,</span>
            <span class="hljs-comment">//   </span><font></font>
            ap.game.pers.x = persx + dx;<font></font>
        };<font></font>
<font></font>
        <span class="hljs-keyword">if</span> (col.coly == <span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// -  </span><font></font>
            ap.game.pers.y = col.y;<font></font>
        } <span class="hljs-keyword">else</span> {<font></font>
            ap.game.pers.y = persy + dy;<font></font>
        };<font></font>
<font></font>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//  ,   </span><font></font>
        ap.game.pers.x = persx + dx;<font></font>
        ap.game.pers.y = persy + dy;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// </span>
    ap.game.pers.dx = <span class="hljs-number">0</span>;<font></font>
    ap.game.pers.dy = <span class="hljs-number">0</span>;<font></font>
<font></font>
    <span class="hljs-comment">//     </span><font></font>
    ap.oPers.transform.x = ap.game.pers.x;<font></font>
    ap.oPers.transform.y = ap.game.pers.y;<font></font>
},</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A pr√≥pria fun√ß√£o de detec√ß√£o de colis√£o:</font></font><br>
<br>
<pre><code class="javascript hljs">collisionDetect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opers, ow</span>) </span>{
    <span class="hljs-comment">// , opers -   , ow -  </span><font></font>
<font></font>
    <span class="hljs-keyword">var</span> res = {<span class="hljs-attr">f</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">colx</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">coly</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>};<font></font>
<font></font>
    <span class="hljs-keyword">var</span> ocoll, x, y, w, h, persx, persy, persx0, persy0, od, colx1, coly1, colx2, coly2;
    <span class="hljs-keyword">var</span> collw = <span class="hljs-literal">false</span>, collh = <span class="hljs-literal">false</span>;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-comment">//(  ,  "" )</span><font></font>
    persx0 = opers.x + ow.x - ow.dx;<font></font>
    persy0 = opers.y + ow.y;<font></font>
<font></font>
    <span class="hljs-comment">//       </span><font></font>
    persx = persx0 + opers.dx;<font></font>
    persy = persy0 + opers.dy;<font></font>
<font></font>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ap.d.lv.length; i++) {<font></font>
        od = ap.d.lv[i]; <span class="hljs-comment">//obj data</span><font></font>
<font></font>
        <span class="hljs-comment">//    (   ),</span>
        <span class="hljs-comment">//     </span>
        <span class="hljs-comment">//        </span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ap.d.colld[od.n] !== <span class="hljs-string">"undefined"</span>) {<font></font>
<font></font>
            <span class="hljs-comment">//       </span><font></font>
            ocoll = ap.d.colld[od.n];<font></font>
            colx1 = od.x + ocoll.x1;<font></font>
            colx2 = od.x + ocoll.x2;<font></font>
            coly1 = od.y + ocoll.y1;<font></font>
            coly2 = od.y + ocoll.y2;<font></font>
<font></font>
            <span class="hljs-keyword">if</span> ((persx &lt; colx1) || (persx &gt; colx2) || (persy &lt; coly1) || (persy &gt; coly2)) {} <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//   </span>
                res.f = <span class="hljs-literal">true</span>;<font></font>
<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persx0 &lt; colx1) || (persx0 &gt; colx2)) {<font></font>
                    collw = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
                <span class="hljs-comment">//        ,</span>
                <span class="hljs-comment">//,    </span>
                <span class="hljs-keyword">if</span> ((persy0 &lt; coly1) || (persy0 &gt; coly2)) {<font></font>
                    collh = <span class="hljs-literal">true</span>;<font></font>
                };<font></font>
<font></font>
            };<font></font>
        };<font></font>
<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">//   </span><font></font>
<font></font>
    <span class="hljs-comment">//  ,     ,</span>
    <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">if</span> (collw == <span class="hljs-literal">true</span>) {<font></font>
        res.colx = <span class="hljs-literal">true</span>;<font></font>
        res.x = persx0 - ow.x;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.x = opers.x;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-comment">// -  </span>
    <span class="hljs-keyword">if</span> (collh == <span class="hljs-literal">true</span>) {<font></font>
        res.coly = <span class="hljs-literal">true</span>;<font></font>
        res.y = persy0 + ow.y;<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
        res.y = opers.y;<font></font>
    };<font></font>
<font></font>
    <span class="hljs-keyword">return</span> res;<font></font>
},</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chuva</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usei o mecanismo de part√≠culas padr√£o Spark AR Studio para animar a chuva. </font><font style="vertical-align: inherit;">N√£o h√° nada de especial aqui. </font><font style="vertical-align: inherit;">N√≥s adicionamos um objeto Emtter √† cena, n√£o esquecendo de perguntar a ele Emissor -&gt; Espa√ßo -&gt; Local (em vez de Mundo). </font><font style="vertical-align: inherit;">Isso √© para garantir que as gotas n√£o fiquem dinamicamente atr√°s das nuvens durante o movimento, mas sempre caiam diretamente. </font><font style="vertical-align: inherit;">Este m√©todo √© mais conveniente para facilitar a determina√ß√£o do momento em que a borboleta cai na chuva - n√£o √© necess√°rio fazer uma corre√ß√£o de altura. </font><font style="vertical-align: inherit;">Para as pr√≥prias gotas, preparei a textura apropriada. </font><font style="vertical-align: inherit;">Bem, √© claro, o objeto chuva se mover√° junto com o objeto nuvem. </font><font style="vertical-align: inherit;">Em seguida, adicionei uma condi√ß√£o de ocorr√™ncia de nuvem ao c√≥digo de manipula√ß√£o de colis√µes. </font><font style="vertical-align: inherit;">E, se n√£o houver obst√°culo acima do jogador neste momento, a borboleta cai e o jogo termina.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modera√ß√£o</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para modera√ß√£o bem-sucedida, o v√≠deo obrigat√≥rio do jogo n√£o deve conter texto est√°tico que n√£o esteja vinculado a objetos. </font><font style="vertical-align: inherit;">Caso contr√°rio, o rob√¥ interrompe instantaneamente a modera√ß√£o. </font><font style="vertical-align: inherit;">No entanto, depois disso, uma pessoa verifica o jogo por v√°rios dias. </font><font style="vertical-align: inherit;">E ele n√£o gostou da abund√¢ncia de texto antes do jogo, assim como no final. </font><font style="vertical-align: inherit;">Eu tive que reduzir a quantidade de texto. </font><font style="vertical-align: inherit;">Depois disso, o jogo foi aprovado.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o que meu jogo tenha sido particularmente emocionante. </font><font style="vertical-align: inherit;">Ela provavelmente n√£o tem din√¢mica e mec√¢nica adicional. </font><font style="vertical-align: inherit;">Vou lan√ßar uma atualiza√ß√£o. </font><font style="vertical-align: inherit;">Mas percebi que fazer jogos no Instagram √© interessante. </font><font style="vertical-align: inherit;">Este √© um tipo de desafio. </font><font style="vertical-align: inherit;">Eu realmente gostei do processo de programa√ß√£o e resolu√ß√£o de todos os tipos de tarefas sob minimalismo em termos de ferramentas e quantidade de mem√≥ria alocada. </font><font style="vertical-align: inherit;">Lembro que algu√©m disse que 640 Kb √© suficiente para todos. </font><font style="vertical-align: inherit;">Agora tente montar um jogo 3D de 2 MB. </font><font style="vertical-align: inherit;">Eu, talvez, n√£o vou argumentar que eles s√£o suficientes para todos ... Mas tente!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/7f/g7/kr/7fg7kra8uhidburs19pognju5vc.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para concluir, gostaria de reunir em uma lista todos os momentos n√£o √≥bvios que encontrei. </font><font style="vertical-align: inherit;">Talvez isso seja √∫til para algu√©m como um truque ao criar jogos para o Instagram.</font></font><br>
<br>
<i><ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escala. </font><font style="vertical-align: inherit;">Ajuste a escala de todos os modelos 3D no editor 3D para que ele fique imediatamente 1: 1 no palco do jogo.</font></font></li>
<li>       .              .   ,            .</li>
<li>.          FBX,     .        -.           ,    .</li>
<li>  .  JPG   ,     ,   ,       -,    JPG,    PNG.</li>
<li>   . , ,        .   Spark AR  ,         . , , ,   3D-.</li>
<li>   3D ,    :     ,    .       .             .</li>
<li>,    ,      .   javascript   .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No contexto do Spark AR, n√£o h√° objeto de janela e todos os tipos de objetos espec√≠ficos do navegador, como webkitRequestAnimationFrame, mozRequestAnimationFrame e assim por diante. </font><font style="vertical-align: inherit;">Este √© um destino ao programar em anima√ß√£o javascript.</font></font></li>
</ul></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt499962/index.html">Alguns fatos sobre classificadores em cascata, que raramente s√£o considerados seriamente em artigos cient√≠ficos.</a></li>
<li><a href="../pt499964/index.html">A NASA selecionou tr√™s empresas que participar√£o do programa para criar um navio para pousar na lua</a></li>
<li><a href="../pt499968/index.html">Lista das mitaps online mais persistentes que ocorrem at√© maio</a></li>
<li><a href="../pt499970/index.html">Estudamos o mecanismo VoIP do Mediastreamer2. Parte 12</a></li>
<li><a href="../pt499972/index.html">Os eventos on-line podem ser digeridos</a></li>
<li><a href="../pt499978/index.html">Tradu√ß√£o do livro de Andrew Un, Passion for Machine Learning, Cap√≠tulos 36 e 37</a></li>
<li><a href="../pt499982/index.html">Plano do testador iniciante: de "Insira TI" a "Eu sou um engenheiro!"</a></li>
<li><a href="../pt499986/index.html">E, novamente, sobre incorporado: procurando bugs no projeto Embox</a></li>
<li><a href="../pt499988/index.html">A√ß√∫car e COVID-19</a></li>
<li><a href="../pt499990/index.html">Geocodifica√ß√£o Como vincular 250 mil endere√ßos a coordenadas em 10 minutos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>