<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📧 😄 🧑🏿 プリンターとしてのテトリス 🦕 🛄 👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="テトリスプリンターアルゴリズムは、所定の形状のシーケンスを回転、再配置、および下げ、テトリスのメカニズムを使用して任意のビットマップを生成します。
 
 アルゴリズムの説明
 アルゴリズムは、ソース画像のピクセルを下から上に移動しながら、テトリスフィールドの正方形に1行ずつ変換します。アルゴリズムは...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>プリンターとしてのテトリス</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474848/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/sa/az/2c/saaz2chpnuatbjn-rdg3zcryjwo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テトリスプリンターアルゴリズムは、所定の形状のシーケンスを回転、再配置、および下げ、テトリスのメカニズムを使用して任意のビットマップを生成します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アルゴリズムの説明</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アルゴリズムは、ソース画像のピクセルを</font><font style="vertical-align: inherit;">下から上に移動しながら</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、テトリス</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フィールドの正方形に1行</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ずつ</font></a><font style="vertical-align: inherit;">変換し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">アルゴリズムは、1つの正方形を生成するために、その下の1つの正方形によって完全にサポートされる長方形の領域で構成される構造を組み立てます。</font><font style="vertical-align: inherit;">長方形の領域の組み立てが完了すると、線がクリアされ、その下に1つの正方形が残ります。</font><font style="vertical-align: inherit;">この動作の3つの例を次に示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/895/c80/be8/895c80be864793bcd951c4edb6943f19.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c6/cdf/615/3c6cdf6159a7bbb9dd2dc95e87374055.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/104/674/951/104674951b666a97f36c4d069006df5d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に示すように、アルゴリズムは1つの構造で複数の正方形を生成することもできます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/caa/aef/04b/caaaef04b763c02d872079282d3b57d5.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行を構築する過程で、この方法で作成されたすべての正方形は何かに基づいている必要があります。上記の画像では、生成された正方形は競技場の床にあります。ただし、任意の線に穴がある場合、その上に線を作成するために必要なサポートを提供できません。アルゴリズムは、穴の線の上に平らなプラットフォームを作成することによってこの問題を解決します。下のアニメーションでは、線の上に構築されたプラットフォームは1つの赤い正方形で構成されています。プラットフォームは一時的な構造であり、最後の形状を挿入すると削除されます。</font></font><br>
<a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/acf/f14/c6d/acff14c6d078f15cc01523e4c24389cb.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に示す5つの赤い正方形の列は、3つの赤い正方形の列の上にあります。</font><font style="vertical-align: inherit;">これは、収益の一番上に平らなプラットフォームを構築することによって実現されます。</font><font style="vertical-align: inherit;">プラットフォームは、5つの赤い正方形を生成するために必要なサポートを提供します。</font><font style="vertical-align: inherit;">最後に、最後の形状を挿入することによってプラットフォームが削除され、新しい線が配置されます。</font><font style="vertical-align: inherit;">アルゴリズムが逆の順序でラインを生成する必要がある場合（5つの赤い正方形のラインの上に3つの赤い正方形のライン）、プラットフォームは必要ありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/851/0ad/35c/8510ad35cdbf5639b06b5f17957eec79.gif"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つの正方形のパターン</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
参考までに、7つのテトラミノ（ゲームの駒）の名前を示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cef/817/4aa/cef8174aa74b378cb17af2fe0c6f1c7b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この記事で紹介するTetrisプリンターアルゴリズムのバージョンは、古いビデオゲームからのスプライトをレンダリングするために特別に設計されています。これらのゲームは、8×8タイルにグラフィックスをパックし、2バイトが各ピクセルに割り当てられました。したがって、スプライトには通常3色と透明領域しか含まれず、ほとんどの場合、サイズは16×16または16×32ピクセルでした。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のアニメーションは、個々の正方形を作成するために使用されるすべてのパターンを示しています。各パターンは交換可能なテトラミノJ、T、およびLを使用して、下部に単一の正方形を作成します。アルゴリズムは、このテトラミノをスプライトに存在する3つの色の1つに割り当てます。テトラミノの残りの部分には任意の色が割り当てられています。ゲームプレイ全体を通して、すべての色が一定のままです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfa/b1f/efc/dfab1fefc65efed365513213cdf5ad12.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つのテトラミノの形状により、最初の2列と最後の2列の3色すべてから正方形を作成することはできません。</font><font style="vertical-align: inherit;">したがって、幅が16ピクセルのスプライトをレンダリングする場合のプレイフィールドの最小幅は、2 + 16 + 2 = 20スクエアです。</font><font style="vertical-align: inherit;">ただし、20は少なすぎることがわかりました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下に示すように、単一の下部の正方形の上の領域は、1つの線だけで構成することはできません。これは、それに収まる図形（テトラミノI）だけがサポートされていないためです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87f/1e5/645/87f1e56455f90295b076e72296cc58c1.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2本の線がある場合、サポートを得るために競技場全体を伸ばす唯一の方法は、テトラミノSとZを使用することです。ただし、この場合、一番上の線に穴が残ります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/58c/ea6/8ef/58cea68ef0e7d83c102402e9ed0255fb.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下部の正方形の上に必要な線の最小数は3で、上に数回示されているように、そのようなパターンが存在します。 20の正方形は、幅が16ピクセルのスプライトを配置するために必要な最小幅です。しかし、20×3 + 1 = 61であり、この数は4で割り切れません。つまり、テトラミノから構築することはできません。ただし、幅が21の場合は21×3 + 1 = 64となり、16個のテトラミノから構築できます。実際、この幅により、アルゴリズムは最大17ピクセル幅のスプライトをレンダリングできます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
元の「テトリス」の競技場のサイズは10×20の正方形（1：2の比率）です。このバージョンのアルゴリズムでは、この比率は維持されます-競技場のサイズは21×42スクエアです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テトラミノのJ、T、Lは1つの正方形を作成するときに交換可能であり、これらのテトラミノの3つの正方形がその上の線の作成に関与するため、1つの正方形を作成するには21-3 = 18のパターンがあります。</font><font style="vertical-align: inherit;">ただし、ミラーの対称性のため、実際には9つしかありません。これらの9のほとんどには3行のクレンジングがあります。</font><font style="vertical-align: inherit;">21×7 + 1 = 148であるため、次の可能なオプションは7行です。これには37個のテトラミノが必要です。</font><font style="vertical-align: inherit;">下の画像に示すように、そのようなパターンが存在します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ee/0b4/889/9ee0b488962c79ad6c84255efd033b5d.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a2/643/2ca/7a26432ca3f6e11d43f134057f3bfa73.gif"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複数の正方形パターン</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数の正方形を作成するためのパターンは、単一の正方形のパターンによって作成された同じ3色に制限されています。結果の正方形は、テトラミノJ、T、およびLから作成され、それぞれが作成線の上にある線で3つの正方形を占めます。単一のパターンで作成できる正方形の最大数は21/3 = 7です。ただし、幅が16ピクセルのスプライトの場合、右端のテトラミノは正方形を作成できません。幅が17ピクセルのスプライトの場合でも、1色のみの正方形を作成できます。したがって、7つの正方形から作成するパターンはほとんど使用されません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e01/9cc/957/e019cc9577348937886f2f160fd8ad1b.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
任意の数の正方形を作成するためのパターンの数は、列挙の組み合わせを使用して決定できます。</font><font style="vertical-align: inherit;">3つの正方形の行の上にある行を表す以下のパターンを考えます。</font><font style="vertical-align: inherit;">3つの隣接する白い四角形の各ブロックは、テトラミノの一部を表します。</font><font style="vertical-align: inherit;">作成された正方形は表示されません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cef/b6d/fe5/cefb6dfe5d0c9c3b644189dc13901e63.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つのテトラミノは4つのボイドを作成します。</font><font style="vertical-align: inherit;">これらのボイドに任意に挿入して特定のパターンを形成できる21-3×3 = 12の暗い正方形があります。</font><font style="vertical-align: inherit;">これらの暗い正方形を分散させる方法の数は、単一の白い正方形が仕切りとして扱われる線上にそれらを配置することによって計算できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/373/160/0fb/3731600fb90642ff32fa58ee059cf4c3.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、タスクは多項式係数の値を計算するために削減されました。これらの白い四角を見ると、これは15から3を選択する方法の数の問題であることがわかります。</font></font><img src="https://habrastorage.org/getpro/habr/post_images/5d4/344/bdb/5d4344bdb66112361fa655447baff0a3.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=455 </font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
一般的な場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はと</font><font style="vertical-align: inherit;">等しくなり</font></font><img src="https://habrastorage.org/getpro/habr/post_images/f0d/252/47d/f0d25247d7defed1af6417ed76660ba6.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。しかし、ミラーの対称性により、実際にはそれらは半分になります。数量が奇数の場合は、2で除算して、最も近い整数に丸めて、このセットに存在するはずの理想的な対称パターンを含めます。たとえば、455の場合について以下に示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e6/093/98d/5e609398dfe585680459774fc3b96cdc.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この式を7つのテトラミノに適用すると、7つの正方形を作成するためのパターンは1つしか存在しないことがわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6つの正方形を作成するパターンは、2つの方法で構築できます。2つの塗りつぶされた線（2×21 + 6 = 48）と6つの塗りつぶされた線（6×21 + 6 = 132）で、12と33のテトラミノが必要です。上記の式は、6つの正方形を作成するための84のパターンがあることを示していますが、2つの実線から作成できるパターンは35のみです。 49パターンには6行必要です。以下に示す対称パターンのため、数値は奇数です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c07/fe9/a24/c07fe9a243e3cdfe37103d4f16d01024.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a9/8c5/91b/8a98c591b95b4fc8a533e67adead58ad.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テトラミノSとZを必要とする1つの正方形を作成するパターンとは対照的に、これらのパターンでは6つの数字が使用されるため、ここでは2つの線が可能であることも注目に値します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の表は、パターンの種類ごとに作成される正方形の数、完全な線の数、使用されるテトラミノの数、およびパターンの数を示しています。</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成された正方形</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">フルライン</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">テトラミノ</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パターン</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7と3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37と16</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19（4および15）</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">136</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">３</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27日</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">455</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">715</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">３</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">462</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2と6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12と33</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">84（35および49）</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パターンの例。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/569/9dc/055/5699dc0558af1a833b43b57defdefbf7.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d1/b83/682/1d1b83682d599094bcb138958706b8bf.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efd/510/bbb/efd510bbb099696e35b7e0b9156f35d4.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/079/bd5/d7a/079bd5d7a149568bda463270a5b3baaf.gif"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プラットフォーム</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
線を作成する前に、アルゴリズムはその下の線を調べます。下の列がその上のすべての正方形をサポートできない場合は、一時的なプラットフォームが必要です。プラットフォームが取り外されると、新しいラインがダウンし、元のテトリスでは重力がどのように実装されているかにより、一部の正方形が空中にぶら下がっています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下の図は、10個のプラットフォームパターンを示しています。プラットフォームの構築は、最後に生成されたラインの四角形の1つでテトラミノTを下げることから始まります。残りのテトラミノはこの最初のTに依存します。つまり、前の生成されたラインに少なくとも1つの正方形（下の画像の赤い正方形など）が含まれている場合、その上にフラットプラットフォームを作成して次のラインを生成できます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b0/299/e1d/5b0299e1d7f2916a802a49ea11c4eb16.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
プラットフォームの構築の途中で、一番下の行が完成して削除され、その上に3行残っています。</font><font style="vertical-align: inherit;">これらの線を削除する最後のJまたはLテトラミノは、作成パターンがプラットフォームの上に次のスプライト線を生成するまで挿入されません。</font><font style="vertical-align: inherit;">この最後の図は、最初と最後の2行に正方形が作成されないようにします。</font><font style="vertical-align: inherit;">ただし、前述のように、このプロセスで使用されるテトラミノJ、T、およびLのジオメトリにより、正方形を作成するためのパターンは17の内部列に制限されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、Tetramino Tの上にプラットフォームを構築する19の可能な方法のうち、上に示したのは10のみです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パックされた行列</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のように、6つの正方形の作成パターンの1つのサブセットには、2つの線のみをクリアすることが含まれます。</font><font style="vertical-align: inherit;">他のすべてのパターンには6行が必要です。</font><font style="vertical-align: inherit;">これが事実である理由を理解するには、以下のパターンを検討してください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/370/9bf/3aa/3709bf3aa8fd860b3dbcc04014dfef8b.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのテトラミノはテトラミノJおよびLと互換性があり、それぞれが3つの隣接する正方形を共通の行に追加します。</font><font style="vertical-align: inherit;">完了する行は、次のマトリックスで表されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ed/532/67a/3ed53267a1b216691289f68439470301.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今こそ、テトラミノを使って空のスペースを詰めることです。</font><font style="vertical-align: inherit;">左側から始めて、唯一のオプションはテトラミノIシーケンスを使用することです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/779/b54/9f5/779b549f51bef09e54217790f2110eb5.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのスペースを埋める唯一の方法は、JとOまたはIとLを使用することです。両方のオプションを以下に示します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de8/08e/33a/de808e33aa8f69d807c60b798e8ed0c1.gif"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aec/a24/be8/aeca24be817f0cc88dc0ef3175ada63c.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、テトラミノOおよびLは上記のマトリックスではサポートされていません。</font><font style="vertical-align: inherit;">この6つの正方形のパターンには、より大きなマトリックスが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つの正方形を作成する2つのパターンで同様の問題が発生します。</font><font style="vertical-align: inherit;">以下のマトリックスを考えてみましょう：</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fba/ec4/6ad/fbaec46ad778d94b5844c22d35ebc4ed.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
右側の一番下の行を埋める唯一の方法は、シーケンスZをチェーンすることです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e8/3e1/5b2/5e83e15b210424010966f17b2ee1b72c.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、左下の3つの空の正方形を取得する唯一の方法は、テトラミノSです。</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/297/9ae/b51/2979aeb51a67c1c0a51c7e5105890744.gif"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
真ん中の線のSとZの間には空の四角があり、それを埋める唯一の方法は、下の図に示すように、テトラミノJ、T、またはLを使用することです。</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a0/364/433/2a036443351a7c1ec90fe0d534c38049.gif"></div> <br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f3/f88/7e8/8f3f887e84bcdbd7176b530af8757666.gif"></div> <br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3c/dc1/a0a/e3cdc1a0a243388524f4e5ffb8ac13d8.gif"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの形状のいずれかを挿入すると、空白スペースが分割されます。</font><font style="vertical-align: inherit;">左側の空の領域には、それぞれ5、6、7個のボイドがあります。</font><font style="vertical-align: inherit;">これらの値はいずれも4で割り切れないため、続行することは不可能です。</font><font style="vertical-align: inherit;">この単一の正方形パターンには、より大きなマトリックスが必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下のマトリックスに示すように、1つの正方形を作成する別のパターンにも同じことが当てはまります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd3/c11/c6c/fd3c11c6ce8d7e4b60a257486caef4e2.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テトラミノSとZを使用して一番下の行の大部分を埋めた後、真ん中の行でそれらの間に空きスペースがあります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a6/e39/49c/3a6e3949c8f9f0849921a11ccf54596a.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
下の画像に示すように、穴の挿入により空のスペースが分割され、左側の空のエリアにはそれぞれ9、10、または11の正方形が含まれます。</font><font style="vertical-align: inherit;">4で割り切れる数はありません。</font></font><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15d/d8b/9b2/15dd8b9b24d8054598665cbff061344e.gif"></div><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d6/928/f4d/6d6928f4d884b746af74059ec210b96d.gif"></div><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c5/269/800/0c5269800d3ebdcb62e1131c03e32db0.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、行列のパッキングは、正方形パターンを生成する唯一の方法ではありません。</font><font style="vertical-align: inherit;">たとえば、以下の4つの正方形の作成者を見てください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fc/22b/653/4fc22b6538117dca3baff88c595337e4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下は、パッケージ化されたテトラミノのセットとしてパターンをレンダリングする試みです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f5/53f/bfc/3f553fbfc96ecfbbef8f7304c80a80fe.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のLは、そのスペースが3行目の完了および削除後にのみ形成されるため、スキップされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、徹底的な検索の結果、この手法では前述の1正方形のパターンで3行しか処理できないことが判明しました。</font><font style="vertical-align: inherit;">さらに、新しい6乗パターンを2行で実装することはできません。</font><font style="vertical-align: inherit;">パックされた行列の外側にある残りのパターンを探す必要はありません。それらは、可能な限り最小量のテトラミノを既に使用しているためです。</font><font style="vertical-align: inherit;">そして、パックドマトリックスに限定すると、必要なすべてのパターンがはるかに速く見つかります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パターン検索</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データ出力を簡素化するために、テトリスプリンターアルゴリズムは、競技場の上部中央にテトラミノを作成し、それを回転させ、水平方向に移動し、下げることに限定されています。</font><font style="vertical-align: inherit;">ある程度距離を置いた後、人物を水平に動かす必要はありません。</font><font style="vertical-align: inherit;">この制限により、マトリックスに追加された数値の下にギャップを形成できないため、検索スペースが大幅に削減されます。</font><font style="vertical-align: inherit;">たとえば、次の3つの正方行列を見てみましょう。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/466/4d1/250/4664d1250708c9d9daeb800eb2ac7f47.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上記のようにJをマトリックスの中央に投げると、2つの空の四角形のギャップができます。これは、後続の図で埋めることができません。</font><font style="vertical-align: inherit;">したがって、検索はこのパスをたどりません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/562/934/866/56293486665cf1557d513f63fa700622.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
カバーされたギャップは許可されないため、マトリックスの各列は塗りつぶされた正方形のスタックと見なすことができ、これらのスタックの高さはマトリックス全体の内容を完全に記述します。行数に関係なく、21要素の1次元整数配列で2次元行列を記述できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
図が行列に該当する場合、対応する列のスタックの高さが増加します。このプロセスを加速するために、すべてのテトラミンが事前に分析されます。テトラミノターンは19あり、検索ではそれらのそれぞれが一意の数字であると見なされます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40e/d13/9e0/40ed139e0a5612cac1f5d074a0093d96.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
画像の左上隅のTetramino Jは3列を占めています。高さのマトリックスに下げると、3つの隣接するスタックがそれぞれ1、1、2の正方形に増加します。ただし、図を下げる前に、図の下側のプロファイルがそれぞれのスタックの上側のプロファイルに対応している必要があります。このJが競技場の床に横たわっていた場合、これらの各列の下には、1、1、および0の空の正方形のギャップがあったはずです。ギャップは禁止されているため、3つのパイルの相対的な高さはパターンと完全に一致する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ギャップがないことのもう1つの結果は、数値がマトリックスに入ると、行が下から上に塗りつぶされることです。マトリックスの真ん中の行を埋める前に、または同時にその下のすべての行を完了しないことはできません。マトリックスの塗りつぶしの過程で、その下の境界が実際に上に移動します。したがって、マトリックスの列スタックは、その高さから完成した行の数を引いた数が0より大きい場合にのみサポートを提供できます。形状がマトリックスに追加されるとき、対応する列の少なくとも1つがサポートを提供する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索は、各行の塗りつぶされた正方形の数を含む2番目の1次元配列を格納します。上記のJは、対応する行3および1に正方形を含みます。マトリックスに挿入すると、これらの値は配列の対応する要素に追加されます。完成した線の数は、値が21の要素の数です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のセクションで説明したように、追加された形状がマトリックスを分割する場合、結果の領域のサイズは4で除算される必要があります。たとえば、下の画像では、2つの領域が作成され、それぞれに46の空の領域が含まれます正方形。 46は4で割り切れないため、マトリックスの残りの部分を埋める方法はありません。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0d/c1e/91a/c0dc1e91a707d5b2fea279dd5c370ec4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スタックの高さがマトリックスの高さと等しい場合、分離が表示されます。それぞれのスタックの高さをインクリメントして図形を挿入した後、高さの配列をスキャンして各スタックに残っているスペースを合計することにより、空スペースのすべての分割領域の寸法を決定できます。この数はチェックされ、分割が検出されるとリセットされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのパターンを生成するために使用される検索では、ランダム化されたインクリメンタルコンストラクションを使用します。これは、ランダムな順序ですべての組み合わせを体系的にチェックするバックトラッキングアルゴリズムです。ランダムに形状を挿入することによるソリューションの漸進的構築は、それを結晶のように成長させます。ランダム性は、その後に追加される形状の基礎として機能する、壊れた面を含む不規則性を提供します。マトリックスのほとんどはランダムに非常に速くパッケージ化されており、空のスペースが少なくなると、バックトラックが機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
検索を実行する前に、371個の方法で行列に図を追加するランダムな順列が実行されます。検索機能の疑似コードを以下に示します。</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">private</span> Result <span class="hljs-title">search</span><span class="hljs-params">(Matrix matrix, <span class="hljs-keyword">int</span> remaining)</span> </span>{<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (remaining == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> SOLUTION<font></font>
  }<font></font>
<font></font>
  attempts := attempts + <span class="hljs-number">1</span>
  <span class="hljs-keyword">if</span> (attempts &gt;= MAX_ATTEMPTS) {      
    <span class="hljs-keyword">return</span> TIMEOUT<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (     S  Z) {<font></font>
           S  Z<font></font>
    <span class="hljs-keyword">if</span> (  ) {<font></font>
      Result result := search(matrix, remaining - <span class="hljs-number">1</span>)
      <span class="hljs-keyword">if</span> (result == SOLUTION) {
        <span class="hljs-keyword">return</span> SOLUTION<font></font>
      } <font></font>
           <font></font>
      <span class="hljs-keyword">if</span> (result == TIMEOUT) {
        <span class="hljs-keyword">return</span> TIMEOUT<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  <font></font>
          <font></font>
  <span class="hljs-keyword">for</span>(   ,    ) {<font></font>
        <font></font>
    <span class="hljs-keyword">if</span> (   ) {        <font></font>
      Result result := search(matrix, remaining - <span class="hljs-number">1</span>)
      <span class="hljs-keyword">if</span> (result == SOLUTION) {
        <span class="hljs-keyword">return</span> SOLUTION<font></font>
      } <font></font>
           <font></font>
      <span class="hljs-keyword">if</span> (result == TIMEOUT) {
        <span class="hljs-keyword">return</span> TIMEOUT<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">return</span> NO_SOLUTION<font></font>
}</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3つの隣接する正方形のブロックを含む一番下の行を除いて、検索関数に渡される元の行列は空です。追加する必要のある残りの数値とともに送信されます。</font></font><code>remaining</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0の</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、行列には​​解が含まれ、関数が返されます。各再帰呼び出しは、試行のグローバル数を増やします</font></font><code>attempts</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>MAX_ATTEMPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値が1000 </font><font style="vertical-align: inherit;">を超えると、</font><font style="vertical-align: inherit;">検索が再開されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目の演算子</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、スペースが許す場合、マトリックスの下部にテトラミノSまたはZを追加しようとします。これの意味は、アルゴリズムがマトリックスの一部を埋めるのに時間を費やし、サポートの不足により残りを埋めることができない場合に、以下に示すような状況を回避することです。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36d/3f9/b81/36d3f9b81275718dccb5d40e70d7843b.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
オペレーターのおかげで、</font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼はすぐに構築するプラットフォームを形成しました。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d0/aa1/ed7/1d0aa1ed7c08ed07b3f31e22ab92ea42.gif"></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
図を行列に追加するには、上記のチェックが必要です。</font><font style="vertical-align: inherit;">アルゴリズムは、完成したラインを前提として、Figureがサポートされるかどうかをチェックします。</font><font style="vertical-align: inherit;">また、形状の挿入によって作成された個々の空のスペースのサイズを4で割るかどうかも確認します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画像変換</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tetrisプリンターアルゴリズムは、ビットマップの各行を一連のパスに変換します。</font><font style="vertical-align: inherit;">左から右に移動すると、「貪欲な」方法で各パッセージがテトラミノJ、T、Lを挿入されます。</font><font style="vertical-align: inherit;">たとえば、次の画像はビットマップの16ピクセルの行を示しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c1/4c5/b69/9c14c5b69ae9a4599ee0856a250256a8.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下の画像は、これらの16ピクセルをカバーするために必要な5つのパスを示しています。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/989/f7d/760/989f7d76010dd0d7e523361148e0e323.gif"></div><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c4/920/25a/4c492025a6033a3eda85fd240118b657.gif"></div><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f1/44f/373/0f144f3734988b25dd231a1a445c52fd.gif"></div><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c1/e37/392/6c1e373927f4842ad379ff2b6c42b123.gif"></div><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/64b/222/a9a64b222baaf24ed13674bdac9b8d01.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アルゴリズムが挿入しようとしている形状のシーケンスは、ピクセルの色によって決まります。</font><font style="vertical-align: inherit;">形状が重複しないように、ブール値の1次元配列が使用されます。</font><font style="vertical-align: inherit;">図を挿入するには、3つのゼロ要素が配列に存在している必要があります。</font><font style="vertical-align: inherit;">図3の挿入が成功すると、対応する配列要素の値は1になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
複数のパス間で完了したピクセルを追跡するために、ブール値の2番目の1次元配列が使用されます。</font><font style="vertical-align: inherit;">各項目が1の場合、ラインは完成です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各パスの最後に、イメージコンバーターはテーブルを検索してすべてのパターンを探し、1つ以上の正方形を作成します。</font><font style="vertical-align: inherit;">出力には、下部にテトラミノJ、T、Lが挿入された対応するパターンが渡されます。たとえば、上記の最初のパスは、5つの正方形を作成する次のパターンとして表示されます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c67/b1b/377/c67b1b3778a37bf7008438052679942e.gif"></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リアルタイム検索</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前のセクションで説明した画像コンバーターは、正方形を作成するためのすべてのパターンを含む定数テーブルを使用し、リアルタイムでそれらを検索しないため、非常に高速です。</font><font style="vertical-align: inherit;">ただし、リアルタイム検索ではテーブルにないパターンを使用できるため、画像の生成に必要なテトラミノの量を大幅に削減できます。</font><font style="vertical-align: inherit;">彼は以前のパッセージで作成された正方形を使用し、それらを追加のサポートとして使用します。</font><font style="vertical-align: inherit;">たとえば、前述のように、1つの正方形を作成する次のパターンでは、7本の実線が必要です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ee/0b4/889/9ee0b488962c79ad6c84255efd033b5d.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、下の画像の左下隅にある前のパッセージで作成された1つの赤い正方形は、追加のサポートを提供し、塗りつぶされた線の数を3に減らします。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfa/d3e/271/dfad3e271c5623daedc462821b82b8af.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さらに、リアルタイム検索では、テトラミノJ、T、またはLを反転させることで、同じ色の隣接する3つのピクセルをカバーできます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a31/e09/776/a31e097766437cb13ebde1e35ee66453.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際には、反転と反転のテトラミノを組み合わせて、1つのパスで多数のピクセルをカバーできます。</font><font style="vertical-align: inherit;">たとえば、16ピクセルをカバーするために必要な上記の5つのパスは、以下に示す1つのパスに減らすことができます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/653/c31/64c653c31d38daeef85189e3b2eacaa8.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このパターンを取得するために、画像コンバーターは上向きのテトラミノJ、T、およびLを熱心にパックすることから始まります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7a/e98/67e/e7ae9867e1419492f6f19f6816d18f04.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それから彼は熱心に未返却バージョンを追加しようとし、この場合彼は別のJを追加することに成功します。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba2/4f3/1d4/ba24f31d49baa855fc449c3cf98f09ca.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
原則として、事前に計算されたルックアップテーブルもこのプロセスで使用できますが、そのようなテーブルのサイズが大きいため、実際には適用できません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、作成する行の上にある8つの正方形が空のマトリックスの一番下の行に追加されます。</font><font style="vertical-align: inherit;">21スクエア幅の競技場の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">個の正方形の</font><font style="vertical-align: inherit;">場合</font><font style="vertical-align: inherit;">、マトリックス</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高さは、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21h-n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が4で割り切れる</font><font style="vertical-align: inherit;">ような最小の正の整数</font><font style="vertical-align: inherit;">です。この場合、高さ4のマトリックスが必要です。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2a/c2e/d2b/b2ac2ed2bc3a422d0d94fff2b10bf9e0.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リアルタイム検索は、上記の検索アルゴリズムとまったく同じように機能しますが、若干の改善があります。以前と同様に、行列の列スタックは、列の高さから完了した行の数を引いた値がゼロより大きい場合にのみサポートを提供します。差がゼロの場合、列スタックはサポートを提供するべきではありません。ただし、このバージョンでは、ゼロに等しい場合、以前のパスで生成された作成済みラインの正方形をチェックします。つまり、マトリックスの一番下の行の下の行にある四角は、空の列をサポートします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
また、検索はリアルタイムで行われるため、網羅的に行うことは現実的ではありません。</font><font style="vertical-align: inherit;">所定の回数試行しても解決策が見つからなかった場合は、マトリックスの最上部にさらに4行追加して、再試行します。</font><font style="vertical-align: inherit;">その後、一定回数試行しても解決策が見つからない場合は、現在の文章で、記事の前のセクションで説明した事前計算済みの検索テーブルと画像変換を使用して方法に戻ります。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">印刷する</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
印刷するには、テトリスの競技場で画像コンバーターが表示する指示に従う必要があります。</font><font style="vertical-align: inherit;">プリンターは、標準の向きで競技場の上部中央に特定のテトラミノを作成します。</font><font style="vertical-align: inherit;">次に、プリンターはそれを回転させ、水平方向にシフトし、下げます。</font><font style="vertical-align: inherit;">このプロセスはビデオに示されています：</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/PJkHwulsac4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ソース</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Java 7プロジェクトのソースコードは、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こちらから</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入手でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
事前に準備されたテーブルとリアルタイムの検索アルゴリズムはパッケージ</font></font><code>search.precomputed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とにあり</font></font><code>search.realtime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。それらはパッケージにあるいくつかの共通クラスを使用します</font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。事前計算された検索の結果は、</font></font><code>patterns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一連のテキストファイルとして</font><font style="vertical-align: inherit;">バッチに保存され</font><font style="vertical-align: inherit;">ます。テキストファイルは、パックされた行列をで始まるASCII文字として格納し</font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。たとえば、</font></font><code>emitters1.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（1つの正方形を作成するための多くのパターン</font><font style="vertical-align: inherit;">）の最初の3つの行列は次の</font><font style="vertical-align: inherit;">ようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/lv/yo/mo/lvyomov6ld5rle3bqj1jnjegic4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事3で繰り返し述べられているように、</font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上記のマトリックスの</font><font style="vertical-align: inherit;">隣接するシンボル</font><font style="vertical-align: inherit;">は、テトラミノJ、T、またはLに置き換えることができます。シンボル</font><font style="vertical-align: inherit;">、、など</font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は</font></font><code>C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><code>D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作成されるテトラミノシーケンスです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このクラス</font></font><code>imageconverter.ImageConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に</font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、1つのコマンドライン引数（スプライトイメージファイルの名前）を受け取る</font><font style="vertical-align: inherit;">メソッド</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">含まれてい</font><font style="vertical-align: inherit;">ます。画像は17×32ピクセルを超えることはできず、3つを超える不透明色を含めることはできません。他のすべてのピクセルは透明でなければなりません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
興味深いことに、古いビデオゲームでは、開発者は背景を使用して色を追加しました。</font><font style="vertical-align: inherit;">たとえば、Bubble bobbleの生徒とBubbleの口、Donkey KongのDonkey Kongの生徒、Ms。</font><font style="vertical-align: inherit;">パックマンは実際には透明です。</font><font style="vertical-align: inherit;">黒は無地の背景から得られます。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fe/67d/330/3fe67d330fce92bff0b4595902e5f5bb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
テトリスの競技場の背景も同様に使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
出力</font></font><code>ImageConverter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は次のスニペットのようになります。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/rs/vt/ms/rsvtmsq6olz9bm1huiqbqgbouj4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1行目の3つの16進数値は、スプライトイメージファイルから抽出された3つの不透明色です。それらは、テトラミノJ、T、およびLの色に対応します。他のテトラミノの色は、イメージに影響を与えません。残りのブロックは、競技場で実行されるパッケージパターンです（</font></font><code>Z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前後の</font><font style="vertical-align: inherit;">文字</font></font><code>a</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">について</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ASCII文字の表を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参照してください</font><font style="vertical-align: inherit;">）。黄色で強調表示されたブロックがプラットフォームを構成しています。最初のブロックはプラットフォームを追加し、2番目のブロックはそれを削除します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラス</font></font><code>printer.Printer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、この形式のテキストファイルを受け取り、テトリスを再生して画像ファイルを生成します。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">テトリスのNESバージョンに</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
似たビデオを生成するために使用されるプリンターアルゴリズム</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、テキストファイルの各ブロック内の各タイプのテトラミノを定義します。次に、開始点と初期方向から、ファイルに示されている図形の下降の座標と回転角度に逆の順序で移動します。注：落下速度が非常に速いため、テトリスの実際のNESバージョンではレベル30を超えることはできません。プリンタは、すべてのコマンドを十分な速さで競技場に送信すると想定されています。これを補うために。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パターンファイルを再生成するには、を使用します</font></font><code>search.precomputed.PatternSearcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。ソースコードファイルの先頭にある定数を変更することでカスタマイズできます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MATRIX_WIDTH = <span class="hljs-number">21</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MATRIX_HEIGHT = <span class="hljs-number">4</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> EMITTED_SQUARES = <span class="hljs-number">4</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> RANDOM_SETS = <span class="hljs-number">100000</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_ATTEMPTS = <span class="hljs-number">1000</span>;</code></pre><br>
<code>RANDOM_SETS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">図を行列に追加する方法のランダム順列371の数です。値を設定すると</font></font><code>100000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、起動時の順列の初期化に数秒かかります。また、ストレージには1ギガバイトを超えるメモリが必要です。</font></font><br>
<br>
<code>MAX_ATTEMPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">検索の実行時間を制御します。比較的小さな値を</font></font><code>1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用すると、うまく表示できないランダムな始まりをすばやく検索で破棄できます。ただし、特定の行列サイズと作成された正方形の数に対して解決策がないことを証明するために、探索空間全体を完全に探索する必要があります。このに</font></font><code>MAX_ATTEMPTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値</font><font style="vertical-align: inherit;">を割り当てることができ</font><font style="vertical-align: inherit;">ます</font></font><code>Integer.MAX_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の定数が</font></font><code>search.realtime.RealtimeSearcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">にあり、画像コンバーターで使用されています。上記のように、非常に重要</font></font><code>RANDOM_SETS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大メモリを増やす必要があり、起動時間が長くなります。</font></font><code>MAX_RETRIES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">試行回数を制御します。その後、リアルタイム検索は放棄され、事前に計算されたテーブルを使用して検索に戻ります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どちらの検索アルゴリズムもCPUを100％使用し、使用可能なプロセッサの数と同じサイズの並列スレッドを多数作成することに注意してください。</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2d/8b9/bd5/c2d8b9bd50fd64a3a7e739d51201c880.png"></div></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja474838/index.html">SIBURチャレンジ2019-産業データ分析コンテスト</a></li>
<li><a href="../ja474840/index.html">外国の大学でデータサイエンスの専門分野を学んでいること</a></li>
<li><a href="../ja474842/index.html">ケース：車のサービス。広告キャンペーンの開発とBitrix24の実装</a></li>
<li><a href="../ja474844/index.html">Dell XPS 13 7390：オフィスの外で作業することが多い人のための非常にコンパクトなラップトップ</a></li>
<li><a href="../ja474846/index.html">ゴミから世界の河川をきれいにするプログラム</a></li>
<li><a href="../ja474850/index.html">GoogleのAIに対する賭け-すべての人類にとっての意味</a></li>
<li><a href="../ja474852/index.html">EcmaScriptのLexicalEnvironmentとClosures</a></li>
<li><a href="../ja474854/index.html">メールのトリガー-視聴者を引き付ける方法</a></li>
<li><a href="../ja474856/index.html">コンテンツローカリゼーション戦略</a></li>
<li><a href="../ja474858/index.html">Red Hat OpenShift Service Meshについて知っておくべきこと</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>