<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöæ üè† üò° How are very long integer types implemented in Python? ü§© üîí üë©üèª‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A translation of the article was prepared specifically for students of the Python Developer course .
 
 
 
 
 When you write in a low-level language s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>How are very long integer types implemented in Python?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/489258/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A translation of the article was prepared specifically for students of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Python Developer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> course </font><font style="vertical-align: inherit;">.</font></font><br>
</i></b><br>
<br>
<img src="https://habrastorage.org/webt/83/4n/6h/834n6hzjg8axynzih1kpbfszk_4.png"><br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When you write in a low-level language such as C, you are worried about choosing the right data type and qualifiers for your integers, at each step you analyze whether it will be enough to use it simply </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or whether you need to add </font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or even </font></font><code>long double</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">However, when writing code in Python, you don‚Äôt have to worry about these ‚Äúminor‚Äù things, because Python can work with numbers of </font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">any size </font><font style="vertical-align: inherit;">type </font><font style="vertical-align: inherit;">.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In C, if you try to calculate 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20000</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using the built-in function </font></font><code>powl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, you will get the output </font></font><code>inf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>
<span class="hljs-comment">#include &lt;math.h&gt;</span><font></font>
<font></font>
int main(void) {<font></font>
  printf(<span class="hljs-string">"%Lf\n"</span>, powl(<span class="hljs-number">2</span>, <span class="hljs-number">20000</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}<font></font>
<font></font>
$ ./a.out<font></font>
inf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But in Python, making this easier than ever is easy:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">2</span> ** <span class="hljs-number">20000</span>
<span class="hljs-number">39802768403379665923543072061912024537047727804924259387134</span> ...<font></font>
...<font></font>
<span class="hljs-meta">... </span><span class="hljs-number">6021</span> digits long ...<font></font>
...<font></font>
<span class="hljs-number">6309376</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It must be under the hood that Python is doing something very beautiful, and today we will find out what it does to work with integers of arbitrary size!</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Presentation and Definition</font></font></h3> <br>
<code>Integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Python, this is a C structure defined as follows:</font></font><br>
<br>
<pre><code class="python hljs">struct _longobject {<font></font>
    PyObject_VAR_HEAD<font></font>
    digit ob_digit[<span class="hljs-number">1</span>];<font></font>
};<font></font>
</code></pre><br>
<code>PyObject_VAR_HEAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a macro, it expands to </font></font><code>PyVarObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which has the following structure:</font></font><br>
<br>
<pre><code class="python hljs">typedef struct {<font></font>
    PyObject ob_base;<font></font>
    Py_ssize_t ob_size; /* Number of items <span class="hljs-keyword">in</span> variable part */<font></font>
} PyVarObject;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Other types that have </font></font><code>PyObject_VAR_HEAD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyBytesObject</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyTupleObject</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyListObject</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This means that an integer, like a tuple or a list, has a variable length, and this is the first step to understanding how Python can support work with giant numbers. </font><font style="vertical-align: inherit;">Once expanded, the macro </font></font><code>_longobject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">can be considered as:</font></font><br>
<br>
<pre><code class="python hljs">struct _longobject {<font></font>
    PyObject ob_base;<font></font>
    Py_ssize_t ob_size; /* Number of items <span class="hljs-keyword">in</span> variable part */<font></font>
    digit ob_digit[<span class="hljs-number">1</span>];<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There </font></font><code>PyObject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">are some meta fields </font><font style="vertical-align: inherit;">in the structure </font><font style="vertical-align: inherit;">that are used for reference counting (garbage collection), but in order to talk about this, we need a separate article. </font><font style="vertical-align: inherit;">The field on which we will focus this </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and in a bit </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decryption </font></font><code>ob_digit</code></h3> <br>
<code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a statically allocated array of unit length of type </font></font><code>digit (typedef  uint32_t)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Since this is an array, it </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is primarily a pointer to a number, and therefore, if necessary, it can be increased using the malloc function to any length. </font><font style="vertical-align: inherit;">This way python can represent and process very long numbers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Typically, in low-level languages ‚Äã‚Äãsuch as C, the precision of integers is limited to 64 bits, however Python supports integers of </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arbitrary precision</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Starting with Python 3, all numbers are presented in the form </font></font><code>bignum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and are limited only by the available system memory.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decryption </font></font><code>ob_size</code></h3><br>
<code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stores the number of items in </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Python overrides and then uses the value </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to determine the actual number of elements contained in the array to increase the efficiency of allocating memory to the array </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Storage</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The most naive way to store integer numbers is to store one decimal digit in one element of the array, then operations such as addition and subtraction can be performed according to the rules of mathematics from elementary school. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
With this approach, the number 5238 will be saved like this: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z_/gt/qz/z_gtqzwee0xfpoaktyogzh1_cv8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This approach is inefficient, since we will use up to 32-bit digits (uint32_t) to store a decimal digit, which, in fact, ranges from 0 to 9 and can be easily represented with only 4 bits, for when writing something as versatile as python, the kernel developer should be even more inventive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So, can we do better? </font><font style="vertical-align: inherit;">Of course, otherwise I would not have posted this article. </font><font style="vertical-align: inherit;">Let's take a closer look at how Python stores an extra-long integer.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python path</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instead of storing only one decimal digit in each element of the array </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, Python converts numbers from the number system with a base of 10 to numbers in a system with a base of 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and calls each element as a digit whose value ranges from 0 to 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In the hexadecimal number system, the base 16 ~ 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> means that each "digit" of the hexadecimal number ranges from 0 to 15 in the decimal number system. In Python, similarly, a ‚Äúnumber‚Äù with a base of 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which means that the number will vary from 0 to 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 = 1073741823 in decimal.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thus, Python effectively uses almost all of the allocated space of 32 bits per digit, saves resources, and still performs simple operations such as addition and subtraction at the math level of elementary school. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depending on the platform, Python uses either 32-bit unsigned integer arrays or 16-bit unsigned integer arrays with 15-bit digits. To perform the operations that will be discussed later, you need only a few bits. </font></font><br>
<br>
<b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example: 1152921504606846976</font></font></i></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
As mentioned, for Python, numbers are represented in a base 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 system</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , that is, if you convert 1152921504606846976 into a base number with 2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> base </font><font style="vertical-align: inherit;">, you get 100. </font></font><br>
 <br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1152921504606846976 = 1 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 0 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + 0 * (2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sup></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Since the </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">least significant digit is stored first, it is saved as 001 as three digits. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The structure </font></font><code>_longobject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for this value will contain:</font></font><br>
<br>
<ul>
<li><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> like 3</font></font></li>
<li><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> like [0, 0, 1]</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/hb/fj/y4/hbfjy4kl64ogtyfjjx6hikzvray.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I created a demo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REPL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that will show how Python stores an integer inside itself, and also refers to structure members such as </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ob_refcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">etc.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Integer Long Operations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Now that we have a clear idea of ‚Äã‚Äãhow Python implements integers of arbitrary precision, it is time to understand how various mathematical operations are performed with them.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Addition</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Integers are stored "in numbers", which means that addition is as simple as in elementary school, and the Python source code shows us that this is how addition is implemented. </font><font style="vertical-align: inherit;">A function with a name </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">x_add</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in a file </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adds two numbers.</font></font><br>
<br>
<pre><code class="python hljs">...
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; size_b; ++i) {<font></font>
        carry += a-&gt;ob_digit[i] + b-&gt;ob_digit[i];<font></font>
        z-&gt;ob_digit[i] = carry &amp; PyLong_MASK;<font></font>
        carry &gt;&gt;= PyLong_SHIFT;<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (; i &lt; size_a; ++i) {<font></font>
        carry += a-&gt;ob_digit[i];<font></font>
        z-&gt;ob_digit[i] = carry &amp; PyLong_MASK;<font></font>
        carry &gt;&gt;= PyLong_SHIFT;<font></font>
    }<font></font>
    z-&gt;ob_digit[i] = carry;<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code snippet above is taken from a function </font></font><code>x_add</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As you can see, it iterates over a number by numbers and performs the addition of numbers, calculates the result and adds hyphenation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It becomes more interesting when the result of addition is a negative number. </font><font style="vertical-align: inherit;">The sign </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is an integer sign, that is, if you have a negative number, then it </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be a minus. </font><font style="vertical-align: inherit;">The value </font></font><code>ob_size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modulo will determine the number of digits in </font></font><code>ob_digit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subtraction </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Just as addition takes place, subtraction also takes place. </font><font style="vertical-align: inherit;">A function with a name </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">x_sub</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the file </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subtracts one number from another.</font></font><br>
<br>
<pre><code class="python hljs">...
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; size_b; ++i) {<font></font>
        borrow = a-&gt;ob_digit[i] - b-&gt;ob_digit[i] - borrow;<font></font>
        z-&gt;ob_digit[i] = borrow &amp; PyLong_MASK;<font></font>
        borrow &gt;&gt;= PyLong_SHIFT;<font></font>
        borrow &amp;= <span class="hljs-number">1</span>; /* Keep only one sign bit */<font></font>
    }<font></font>
    <span class="hljs-keyword">for</span> (; i &lt; size_a; ++i) {<font></font>
        borrow = a-&gt;ob_digit[i] - borrow;<font></font>
        z-&gt;ob_digit[i] = borrow &amp; PyLong_MASK;<font></font>
        borrow &gt;&gt;= PyLong_SHIFT;<font></font>
        borrow &amp;= <span class="hljs-number">1</span>; /* Keep only one sign bit */<font></font>
    }<font></font>
...</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The code snippet above is taken from a function </font></font><code>x_sub</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In it, you see how the enumeration of numbers occurs and subtraction is performed, the result is calculated and the transfer is distributed. </font><font style="vertical-align: inherit;">Indeed, it is very similar to addition.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiplication</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
And again, the multiplication will be implemented in the same naive way that we learned from the lessons of mathematics in elementary school, but it is not very efficient. </font><font style="vertical-align: inherit;">To maintain efficiency, Python implements </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Karatsuba algorithm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which multiplies two n-digit numbers in O (n </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log </font></font></sup><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></sub><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) simple steps. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The algorithm is not simple and its implementation is beyond the scope of this article, but you can find its implementation in functions </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">k_mul</a> </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">k_lopsided_mul</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the file </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Division and other operations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
All operations on integers are defined in the file </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, they are very simple to find and trace the work of each. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attention: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A detailed understanding of the work of each of them will take time, so pre-stock up with popcorn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br>
<h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Python preallocates </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> small number of integers in memory ranging from -5 to 256. This allocation occurs during initialization, and since we cannot change the integers (immutability), these pre-allocated numbers are singleton and are directly referenced instead of being allocated. This means that every time we use / create a small number, Python instead of selling it simply returns a reference to the previously allocated number. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Such optimization can be traced in the macro </font></font><code>IS_SMALL_INT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and function </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">get_small_int</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=">longobject.c</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. So Python saves a lot of space and time in calculating commonly used integer numbers. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This is the second article in the Python Internals series. The first article was about how I changed my version of Python to make it</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambiguous</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It will help you take the first steps in understanding the Python source code and continue the path to becoming a Python kernel developer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If you want to see more similar articles, subscribe to my newsletter and receive them directly in your inbox. </font><font style="vertical-align: inherit;">I write about engineering, systems engineering and a little about programming every Friday. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Email</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> me at </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">@arpit_bhayani</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You can find my previous articles on </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ arpitbhayani.me / blogs</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
That's all. </font><font style="vertical-align: inherit;">See you on the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">course</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en489244/index.html">Plugin development for Zabbix Agent 2</a></li>
<li><a href="../en489246/index.html">I am 14 and I decided to develop a game</a></li>
<li><a href="../en489252/index.html">The history of Telegram: from an idea to its own cryptocurrency</a></li>
<li><a href="../en489254/index.html">Does Yandex help spread malware?</a></li>
<li><a href="../en489256/index.html">Foundation Fieldbus Automation Systems</a></li>
<li><a href="../en489260/index.html">How to design a large-scale automated system for a large enterprise in seven steps</a></li>
<li><a href="../en489262/index.html">Why it's not easy to give developers freedom of choice</a></li>
<li><a href="../en489268/index.html">Implementation of the process of uploading a file from a container with a browser to a test framework</a></li>
<li><a href="../en489270/index.html">WebAuthn in real life</a></li>
<li><a href="../en489272/index.html">Eyes, brain, video quality: reflections on 120fps, 8K, HDR, wands, cones and the ‚Äúsoap opera effect‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>