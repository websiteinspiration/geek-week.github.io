<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✒️ 🎠 ☣️ Android用のヘビをKivy、Pythonで作成する 🌯 🧝🏾 🚣🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは！
 
 多くの人がAn​​droidでプログラミングを始めたいと思っていますが、Android StudioとJavaはそれらを怖がらせます。どうして？スズメの大砲からの意味です。「私はただ蛇を作りたい、それだけです！」
 
 
 
 始めましょう！（最後のボーナス）
 
 なぜKivy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Android用のヘビをKivy、Pythonで作成する</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466249/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
多くの人がAn​​droidでプログラミングを始めたいと思っていますが、Android StudioとJavaはそれらを怖がらせます。</font><font style="vertical-align: inherit;">どうして？</font><font style="vertical-align: inherit;">スズメの大砲からの意味です。</font><font style="vertical-align: inherit;">「私はただ蛇を作りたい、それだけです！」</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gb/yu/vz/gbyuvzpeftcwxbxi9gwa2xz5axe.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
始めましょう！</font><font style="vertical-align: inherit;">（最後のボーナス）</font></font><br>
<a name="habracut"></a><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">なぜKivyで別のヘビのチュートリアルを作成するのですか？</font><font style="vertical-align: inherit;">（オプションで読むことができます）</font></font></b><div class="spoiler_text">  — ,        ,      «  »   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> (Eng)</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="> ()</a>.     .  ,       :<br>
<br>
<h5> </h5><br>
 :<br>
<br>
<ol>
<li> «»  «»  .    ,      —   .          ,     .</li>
<li>Clock.schedule  self.update  … self.update.</li>
<li>   (     ) Playground   ,     SnakeApp    .</li>
<li>   («up», «down», ...)   ( (0, 1), (1, 0)… ).</li>
</ol><br>
<br>
 :<br>
<ol>
<li>  ( , )    kv,             </li>
<li>     --.</li>
<li>350  —   .</li>
</ol><br>
<h5>   </h5><br>
   .  ,   ,        .  ,   :<br>
<br>
<ol>
<li>  </li>
<li>  ()</li>
<li>    </li>
</ol><br>
<h5>  </h5><br>
<img src="https://habrastorage.org/webt/n6/q-/li/n6q-lieen74-rcs-tzwrr1yguwa.png"><br>
   ,  ,  .<br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知り合い</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のアプリケーション</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kivyが既にインストールされていることを確認し（インストールされていない場合は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手順</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">に従って</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ください</font></a><font style="vertical-align: inherit;">）</font></font><br>
<code>buildozer init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、プロジェクトフォルダーで</font><font style="vertical-align: inherit;">実行して</font><font style="vertical-align: inherit;">ください。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のプログラムを実行します：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.py</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.widget <span class="hljs-keyword">import</span> Widget<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> Widget()<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    WormApp().run()<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/ms/he/ud/msheudwu1tc3wcvjj8z2x9oswgi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ウィジェットを作成しました。</font><font style="vertical-align: inherit;">同様に、ボタンまたはグラフィカルインターフェイスの他の要素を作成できます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.widget <span class="hljs-keyword">import</span> Widget
<span class="hljs-keyword">from</span> kivy.uix.button <span class="hljs-keyword">import</span> Button<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.but = Button()<font></font>
        self.but.pos = (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)<font></font>
        self.but.size = (<span class="hljs-number">200</span>, <span class="hljs-number">200</span>)<font></font>
        self.but.text = <span class="hljs-string">"Hello, cruel world"</span><font></font>
<font></font>
        self.form = Widget()<font></font>
        self.form.add_widget(self.but)<font></font>
        <span class="hljs-keyword">return</span> self.form<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    WormApp().run()<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/gp/k1/cn/gpk1cngh7ns5z9wdtjuua5d1ogg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
やったー！</font><font style="vertical-align: inherit;">おめでとう！</font><font style="vertical-align: inherit;">ボタンを作成しました！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.Kvファイル</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、そのような要素を作成する別の方法があります。</font><font style="vertical-align: inherit;">まず、フォームを宣言します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.widget <span class="hljs-keyword">import</span> Widget
<span class="hljs-keyword">from</span> kivy.uix.button <span class="hljs-keyword">import</span> Button<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.but1 = Button()<font></font>
        self.but1.pos = (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)<font></font>
        self.add_widget(self.but1)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.form = Form()<font></font>
        <span class="hljs-keyword">return</span> self.form<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    WormApp().run()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、「worm.kv」ファイルを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
worm.kv</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Form&gt;:<font></font>
    but2: but_id<font></font>
<font></font>
    Button:<font></font>
        id: but_id<font></font>
        pos: (200, 200)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうした </font><font style="vertical-align: inherit;">別のボタンを作成し、ID but_idを割り当てました。</font><font style="vertical-align: inherit;">現在、but_idはbut2フォームに関連付けられています。</font><font style="vertical-align: inherit;">つまり、but2を使用してボタンにアクセスできます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.but1 = Button()<font></font>
        self.but1.pos = (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)<font></font>
        self.add_widget(self.but1)   <span class="hljs-comment">#</span>
        self.but2.text = <span class="hljs-string">"OH MY"</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/ug/a6/88/uga688dhltpl2klklqbigyodu40.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">グラフィックアート</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、グラフィック要素を作成します。</font><font style="vertical-align: inherit;">まず、それをworm.kvで宣言します。</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Form&gt;:<font></font>
<font></font>
&lt;Cell&gt;:<font></font>
    canvas:<font></font>
        Rectangle:<font></font>
            size: self.size<font></font>
            pos: self.pos<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
長方形の位置をself.posにリンクし、そのサイズをself.sizeにリンクしました。</font><font style="vertical-align: inherit;">したがって、これらのプロパティはCellから利用できるようになりました。たとえば、セルを作成するとすぐに、そのサイズと位置を変更できます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y, size</span>):</span><font></font>
        super().__init__()<font></font>
        self.size = (size, size)   <span class="hljs-comment">#   ,    self.size    "size" </span><font></font>
        self.pos = (x, y)<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.cell = Cell(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">30</span>)<font></font>
        self.add_widget(self.cell)<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/we/j4/dn/wej4dnu0jojperjlmnlflu5dxi8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ケージを作成しました。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必要な方法</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
蛇を動かしてみましょう。</font><font style="vertical-align: inherit;">これを行うには、Form.update関数を追加し、Clock.scheduleを使用してスケジュールにバインドします。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.widget <span class="hljs-keyword">import</span> Widget
<span class="hljs-keyword">from</span> kivy.clock <span class="hljs-keyword">import</span> Clock<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y, size</span>):</span><font></font>
        super().__init__()<font></font>
        self.size = (size, size)<font></font>
        self.pos = (x, y)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.cell = Cell(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">30</span>)<font></font>
        self.add_widget(self.cell)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span>
        Clock.schedule_interval(self.update, <span class="hljs-number">0.01</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span>
        self.cell.pos = (self.cell.pos[<span class="hljs-number">0</span>] + <span class="hljs-number">2</span>, self.cell.pos[<span class="hljs-number">1</span>] + <span class="hljs-number">3</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.form = Form()<font></font>
        self.form.start()<font></font>
        <span class="hljs-keyword">return</span> self.form<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    WormApp().run()<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
セルの形が変わります。</font><font style="vertical-align: inherit;">ご覧のとおり、Clockを使用して任意の機能のタイマーを設定できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、タッチイベントを作成します。</font><font style="vertical-align: inherit;">書き換えフォーム：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.cells = []<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span>
        Clock.schedule_interval(self.update, <span class="hljs-number">0.01</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span>
        <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.cells:<font></font>
            cell.pos = (cell.pos[<span class="hljs-number">0</span>] + <span class="hljs-number">2</span>, cell.pos[<span class="hljs-number">1</span>] + <span class="hljs-number">3</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_touch_down</span>(<span class="hljs-params">self, touch</span>):</span>
        cell = Cell(touch.x, touch.y, <span class="hljs-number">30</span>)<font></font>
        self.add_widget(cell)<font></font>
        self.cells.append(cell)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各touch_downは、座標=（touch.x、touch.y）およびサイズ= 30のセルを作成します。次に、それをANDフォームウィジェットとして独自の配列に追加します（後でアクセスするため）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、フォームをクリックするたびにセルが生成されます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/sf/rt/of/sfrtofg5ylwk8pxm3mowelxw1by.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">素敵な設定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
美しいヘビを作りたいので、グラフィックと実際の位置を論理的に分離する必要があります。 </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何のために？</font></font></b><div class="spoiler_text">   .          ,    —   . ,     ,    (100, 100)   — (102, 102).<br>
<br>
P. S.           on_draw.        .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
worm.kvファイルを変更してみましょう。</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Form&gt;:<font></font>
<font></font>
&lt;Cell&gt;:<font></font>
    canvas:<font></font>
        Rectangle:<font></font>
            size: self.graphical_size<font></font>
            pos: self.graphical_pos<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そしてmain.py：</font></font><br>
<br>
<pre><code class="python hljs">...
<span class="hljs-keyword">from</span> kivy.properties <span class="hljs-keyword">import</span> *<font></font>
...<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>(<span class="hljs-params">Widget</span>):</span>
    graphical_size = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
    graphical_pos = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y, size, margin=<span class="hljs-number">4</span></span>):</span><font></font>
        super().__init__()<font></font>
        self.actual_size = (size, size)<font></font>
        self.graphical_size = (size - margin, size - margin)<font></font>
        self.margin = margin<font></font>
        self.actual_pos = (x, y)<font></font>
        self.graphical_pos_attach()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">graphical_pos_attach</span>(<span class="hljs-params">self</span>):</span>
        self.graphical_pos = (self.actual_pos[<span class="hljs-number">0</span>] - self.graphical_size[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>, self.actual_pos[<span class="hljs-number">1</span>] - self.graphical_size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>)<font></font>
...<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.cell1 = Cell(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">30</span>)<font></font>
        self.cell2 = Cell(<span class="hljs-number">130</span>, <span class="hljs-number">100</span>, <span class="hljs-number">30</span>)<font></font>
        self.add_widget(self.cell1)<font></font>
        self.add_widget(self.cell2)<font></font>
...<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/sa/0m/yi/sa0myibds8nzaymucynrard6ixk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデントが表示されているので、132ではなくX = 130の2番目のセルを作成したにもかかわらず、見栄えがよくなります。後で、actual_posとgraphic_posの間の距離に基づいてソフトな動きを行います。</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ワームプログラミング</font></font></h1><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">発表</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
main.pyで設定を初期化する</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>:</span>
    DEFAULT_LENGTH = <span class="hljs-number">20</span>
    CELL_SIZE = <span class="hljs-number">25</span>
    APPLE_SIZE = <span class="hljs-number">35</span>
    MARGIN = <span class="hljs-number">4</span>
    INTERVAL = <span class="hljs-number">0.2</span>
    DEAD_CELL = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
    APPLE_COLOR = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（私を信じてください、あなたは</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それを気に入るはず</font><font style="vertical-align: inherit;">です！）</font><font style="vertical-align: inherit;">そして、アプリケーションに設定を割り当てます：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super().__init__()<font></font>
        self.config = Config()<font></font>
        self.form = Form(self.config)<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.form.start()<font></font>
        <span class="hljs-keyword">return</span> self.form
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
initを書き換えて開始します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.config = config<font></font>
        self.worm = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.worm = Worm(self.config)<font></font>
        self.add_widget(self.worm)<font></font>
        Clock.schedule_interval(self.update, self.config.INTERVAL)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、Cell：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>(<span class="hljs-params">Widget</span>):</span>
    graphical_size = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
    graphical_pos = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y, size, margin=<span class="hljs-number">4</span></span>):</span><font></font>
        super().__init__()<font></font>
        self.actual_size = (size, size)<font></font>
        self.graphical_size = (size - margin, size - margin)<font></font>
        self.margin = margin<font></font>
        self.actual_pos = (x, y)<font></font>
        self.graphical_pos_attach()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">graphical_pos_attach</span>(<span class="hljs-params">self</span>):</span>
        self.graphical_pos = (self.actual_pos[<span class="hljs-number">0</span>] - self.graphical_size[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>, self.actual_pos[<span class="hljs-number">1</span>] - self.graphical_size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, x, y</span>):</span><font></font>
        self.actual_pos = (x, y)<font></font>
        self.graphical_pos_attach()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_by</span>(<span class="hljs-params">self, x, y, **kwargs</span>):</span>
        self.move_to(self.actual_pos[<span class="hljs-number">0</span>] + x, self.actual_pos[<span class="hljs-number">1</span>] + y, **kwargs)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_pos</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> self.actual_pos<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">step_by</span>(<span class="hljs-params">self, direction, **kwargs</span>):</span>
        self.move_by(self.actual_size[<span class="hljs-number">0</span>] * direction[<span class="hljs-number">0</span>], self.actual_size[<span class="hljs-number">1</span>] * direction[<span class="hljs-number">1</span>], **kwargs)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが多かれ少なかれ明確だったことを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして最後にワーム：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worm</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.cells = []<font></font>
        self.config = config<font></font>
        self.cell_size = config.CELL_SIZE<font></font>
        self.head_init((<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(config.DEFAULT_LENGTH):<font></font>
            self.lengthen()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">destroy</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(self.cells)):<font></font>
            self.remove_widget(self.cells[i])<font></font>
        self.cells = []<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lengthen</span>(<span class="hljs-params">self, pos=None, direction=(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">1</span></span>)</span>):</span>
        <span class="hljs-comment">#   ,    ,  -     </span>
        <span class="hljs-keyword">if</span> pos <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            px = self.cells[<span class="hljs-number">-1</span>].get_pos()[<span class="hljs-number">0</span>] + direction[<span class="hljs-number">0</span>] * self.cell_size<font></font>
            py = self.cells[<span class="hljs-number">-1</span>].get_pos()[<span class="hljs-number">1</span>] + direction[<span class="hljs-number">1</span>] * self.cell_size<font></font>
            pos = (px, py)<font></font>
        self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN))<font></font>
        self.add_widget(self.cells[<span class="hljs-number">-1</span>])<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head_init</span>(<span class="hljs-params">self, pos</span>):</span><font></font>
        self.lengthen(pos=pos)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワームを作成しましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/x8/89/ve/x889vemqslo2x8rxvp54jgbwgpi.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">トラフィック</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今、ITを移動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それは簡単です：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worm</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span>(<span class="hljs-params">self, direction</span>):</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(self.cells) - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>):<font></font>
            self.cells[i].move_to(*self.cells[i - <span class="hljs-number">1</span>].get_pos())<font></font>
        self.cells[<span class="hljs-number">0</span>].step_by(direction)
</code></pre><br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.config = config<font></font>
        self.worm = <span class="hljs-literal">None</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.worm = Worm(self.config)<font></font>
        self.add_widget(self.worm)<font></font>
        self.cur_dir = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<font></font>
        Clock.schedule_interval(self.update, self.config.INTERVAL)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
        self.worm.move(self.cur_dir)<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/jx/8v/jw/jx8vjwv5zpnnhfprs7peo1o_gfm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生きてる！</font><font style="vertical-align: inherit;">生きてる！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コントロール</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初の写真から判断できるように、ヘビの制御は次のようになります。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/va/u0/ad/vau0adepnd4fsjgcjxe0lp6jkqk.png"><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_touch_down</span>(<span class="hljs-params">self, touch</span>):</span>
        ws = touch.x / self.size[<span class="hljs-number">0</span>]<font></font>
        hs = touch.y / self.size[<span class="hljs-number">1</span>]<font></font>
        aws = <span class="hljs-number">1</span> - ws
        <span class="hljs-keyword">if</span> ws &gt; hs <span class="hljs-keyword">and</span> aws &gt; hs:<font></font>
            cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)         <span class="hljs-comment"># </span>
        <span class="hljs-keyword">elif</span> ws &gt; hs &gt;= aws:<font></font>
            cur_dir = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)          <span class="hljs-comment"># </span>
        <span class="hljs-keyword">elif</span> ws &lt;= hs &lt; aws:<font></font>
            cur_dir = (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)         <span class="hljs-comment"># </span>
        <span class="hljs-keyword">else</span>:<font></font>
            cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)           <span class="hljs-comment"># </span><font></font>
        self.cur_dir = cur_dir<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/ff/8k/c2/ff8kc2ur1rct6cjmkt-ozc9xch4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワオ。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">果物を作る</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初に宣言します。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.config = config<font></font>
        self.worm = <span class="hljs-literal">None</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
        self.fruit = <span class="hljs-literal">None</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_cell_location</span>(<span class="hljs-params">self, offset</span>):</span>
        x_row = self.size[<span class="hljs-number">0</span>] // self.config.CELL_SIZE<font></font>
        x_col = self.size[<span class="hljs-number">1</span>] // self.config.CELL_SIZE
        <span class="hljs-keyword">return</span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_location</span>(<span class="hljs-params">self, offset</span>):</span><font></font>
        x_row, x_col = self.random_cell_location(offset)<font></font>
        <span class="hljs-keyword">return</span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit_dislocate</span>(<span class="hljs-params">self</span>):</span>
        x, y = self.random_location(<span class="hljs-number">2</span>)<font></font>
        self.fruit.move_to(x, y)<font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span>
        self.fruit = Cell(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, self.config.APPLE_SIZE, self.config.MARGIN)<font></font>
        self.worm = Worm(self.config)<font></font>
        self.fruit_dislocate()<font></font>
        self.add_widget(self.worm)<font></font>
        self.add_widget(self.fruit)<font></font>
        self.cur_dir = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<font></font>
        Clock.schedule_interval(self.update, self.config.INTERVAL)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在の結果：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bb/t0/wh/bbt0whhowgmfdhnyjawtmnbv0ny.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、いくつかのワームメソッドを宣言する必要があります。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worm</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-comment">#     </span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gather_positions</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> [cell.get_pos() <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.cells]
    <span class="hljs-comment">#       </span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head_intersect</span>(<span class="hljs-params">self, cell</span>):</span>
        <span class="hljs-keyword">return</span> self.cells[<span class="hljs-number">0</span>].get_pos() == cell.get_pos()
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gather_Positions関数の他のボーナス</font></font></b><div class="spoiler_text">,  ,    gather_positions,    fruit_dislocate:<br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit_dislocate</span>(<span class="hljs-params">self</span>):</span>
        x, y = self.random_location(<span class="hljs-number">2</span>)
        <span class="hljs-keyword">while</span> (x, y) <span class="hljs-keyword">in</span> self.worm.gather_positions():<font></font>
            x, y = self.random_location(<span class="hljs-number">2</span>)<font></font>
        self.fruit.move_to(x, y)<font></font>
</code></pre><br>
          <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...そして更新にチェックを追加します（）</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
        self.worm.move(self.cur_dir)<font></font>
        <span class="hljs-keyword">if</span> self.worm.head_intersect(self.fruit):<font></font>
            directions = [(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)]<font></font>
            self.worm.lengthen(direction=random.choice(directions))<font></font>
            self.fruit_dislocate()<font></font>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">頭と尾の交差の決定</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ヘッドの位置がテールセルと同じかどうかを調べたいと思います。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.config = config<font></font>
        self.worm = <span class="hljs-literal">None</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
        self.fruit = <span class="hljs-literal">None</span>
        self.game_on = <span class="hljs-literal">True</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_on:
            <span class="hljs-keyword">return</span><font></font>
        self.worm.move(self.cur_dir)<font></font>
        <span class="hljs-keyword">if</span> self.worm.head_intersect(self.fruit):<font></font>
            directions = [(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)]<font></font>
            self.worm.lengthen(direction=random.choice(directions))<font></font>
            self.fruit_dislocate()<font></font>
       <span class="hljs-keyword">if</span> self.worm_bite_self():<font></font>
            self.game_on = <span class="hljs-literal">False</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worm_bite_self</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.worm.cells[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> self.worm.head_intersect(cell):
                <span class="hljs-keyword">return</span> cell
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre><br>
<img src="https://habrastorage.org/webt/fu/yt/m4/fuytm4is8yrdbrlym0c5yj8bta8.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">着色、装飾、コードのリファクタリング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
リファクタリングから始めましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
書き換えて追加</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.worm = Worm(self.config)<font></font>
        self.add_widget(self.worm)<font></font>
        <span class="hljs-keyword">if</span> self.fruit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.remove_widget(self.fruit)<font></font>
        self.fruit = Cell(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, self.config.APPLE_SIZE)<font></font>
        self.fruit_dislocate()<font></font>
        self.add_widget(self.fruit)<font></font>
        Clock.schedule_interval(self.update, self.config.INTERVAL)<font></font>
        self.game_on = <span class="hljs-literal">True</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self</span>):</span>
        self.game_on = <span class="hljs-literal">False</span><font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">game_over</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.stop()<font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_touch_down</span>(<span class="hljs-params">self, touch</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_on:<font></font>
            self.worm.destroy()<font></font>
            self.start()<font></font>
            <span class="hljs-keyword">return</span><font></font>
        ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ワームが死んだ（フリーズした）場合、画面をクリックすると、ゲームが再開されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、装飾と着色に移りましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
worm.kv</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Form&gt;:<font></font>
    popup_label: popup_label<font></font>
    score_label: score_label<font></font>
<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: (.5, .5, .5, 1.0)<font></font>
<font></font>
        Line:<font></font>
            width: 1.5<font></font>
            points: (0, 0), self.size<font></font>
<font></font>
        Line:<font></font>
            width: 1.5<font></font>
            points: (self.size[0], 0), (0, self.size[1])<font></font>
<font></font>
<font></font>
    Label:<font></font>
        id: score_label<font></font>
        text: "Score: " + str(self.parent.worm_len)<font></font>
        width: self.width<font></font>
<font></font>
    Label:<font></font>
        id: popup_label<font></font>
        width: self.width<font></font>
<font></font>
<font></font>
&lt;Worm&gt;:<font></font>
<font></font>
<font></font>
&lt;Cell&gt;:<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: self.color<font></font>
        Rectangle:<font></font>
            size: self.graphical_size<font></font>
            pos: self.graphical_pos<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WormAppを書き換えます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.config = Config()<font></font>
        self.form = Form(self.config)<font></font>
        <span class="hljs-keyword">return</span> self.form<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.form.start()<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/fk/cq/6v/fkcq6vobxfathjjvs3pg3aak7oo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
色付け。</font><font style="vertical-align: inherit;">.kvのセルを書き換え：</font></font><br>
<br>
<pre><code class="plaintext hljs">&lt;Cell&gt;:<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: self.color<font></font>
<font></font>
        Rectangle:<font></font>
            size: self.graphical_size<font></font>
            pos: self.graphical_pos<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをCell .__ init__に追加します。</font></font><br>
<pre><code class="python hljs">self.color = (<span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)    <span class="hljs-comment"># </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはForm.startです</font></font><br>
<br>
<pre><code class="python hljs">self.fruit.color = (<span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すばらしい、ヘビを楽しんでください。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1e/nh/6f/1enh6fainu28aqcei-9fg0of8iq.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、「ゲームオーバー」という碑文を作成します</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
    ...<font></font>
        self.popup_label.text = <span class="hljs-string">""</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self, text=<span class="hljs-string">""</span></span>):</span>
        self.game_on = <span class="hljs-literal">False</span><font></font>
        self.popup_label.text = text<font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">game_over</span>(<span class="hljs-params">self</span>):</span>
        self.stop(<span class="hljs-string">"GAME OVER"</span> + <span class="hljs-string">" "</span> * <span class="hljs-number">5</span> + <span class="hljs-string">"\ntap to reset"</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして赤に「傷ついた」セルを設定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代わりに、</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
    ...<font></font>
        <span class="hljs-keyword">if</span> self.worm_bite_self():<font></font>
            self.game_over()<font></font>
    ...<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
書く</font></font><br>
<br>
<pre><code class="python hljs">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
        cell = self.worm_bite_self()<font></font>
        <span class="hljs-keyword">if</span> cell:<font></font>
            cell.color = (<span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)<font></font>
            self.game_over()<font></font>
</code></pre><br>
<img src="https://habrastorage.org/webt/lw/mr/na/lwmrnagdbvjt79qacs0kt9jg_2k.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたはまだここにいるの？</font><font style="vertical-align: inherit;">最も興味深い部分は先です！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボーナス-スムーズな動き</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ワームのステップはcell_sizeに等しいため、あまり滑らかに見えません。</font><font style="vertical-align: inherit;">ただし、ゲームのロジックを完全に書き換えることなく、できるだけ頻繁にステップを実行したいと考えています。</font><font style="vertical-align: inherit;">したがって、グラフィック位置（graphical_pos）を移動するが、実際の位置（actual_pos）には影響を与えないメカニズムが必要です。</font><font style="vertical-align: inherit;">私は次のコードを書きました：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
smooth.py</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.clock <span class="hljs-keyword">import</span> Clock
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Timing</span>:</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">linear</span>(<span class="hljs-params">x</span>):</span>
        <span class="hljs-keyword">return</span> x<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Smooth</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, interval=<span class="hljs-number">1.0</span>/<span class="hljs-number">60.0</span></span>):</span><font></font>
        self.objs = []<font></font>
        self.running = <span class="hljs-literal">False</span><font></font>
        self.interval = interval<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.running:
            <span class="hljs-keyword">return</span>
        self.running = <span class="hljs-literal">True</span><font></font>
        Clock.schedule_interval(self.update, self.interval)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.running:
            <span class="hljs-keyword">return</span>
        self.running = <span class="hljs-literal">False</span><font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setattr</span>(<span class="hljs-params">self, obj, attr, value</span>):</span>
        exec(<span class="hljs-string">"obj."</span> + attr + <span class="hljs-string">" = "</span> + str(value))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getattr</span>(<span class="hljs-params">self, obj, attr</span>):</span>
        <span class="hljs-keyword">return</span> float(eval(<span class="hljs-string">"obj."</span> + attr))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
        cur_time = time.time()<font></font>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.objs:<font></font>
            obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line<font></font>
            time_gone = cur_time - start_time<font></font>
            <span class="hljs-keyword">if</span> time_gone &gt;= period:<font></font>
                self.setattr(obj, prop_name_x, to_x)<font></font>
                self.setattr(obj, prop_name_y, to_y)<font></font>
                self.objs.remove(line)<font></font>
            <span class="hljs-keyword">else</span>:<font></font>
                share = time_gone / period<font></font>
                acs = timing(share)<font></font>
                self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number">1</span> - acs) + to_x * acs)<font></font>
                self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number">1</span> - acs) + to_y * acs)
        <span class="hljs-keyword">if</span> len(self.objs) == <span class="hljs-number">0</span>:<font></font>
            self.stop()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear</span>):</span><font></font>
        self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x,<font></font>
                          to_y, time.time(), t, timing))<font></font>
        self.run()<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XSmooth</span>(<span class="hljs-params">Smooth</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, props, timing=Timing.linear, *args, **kwargs</span>):</span><font></font>
        super().__init__(*args, **kwargs)<font></font>
        self.props = props<font></font>
        self.timing = timing<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, obj, to_x, to_y, t</span>):</span><font></font>
        super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)<font></font>
<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">このコードが気に入らなかった人</font></font></b><div class="spoiler_text">     .     .    hello-world .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、smooth.pyを作成し、コードをファイルにコピーするだけです。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、ITを稼働させます。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
    ...<font></font>
        self.smooth = smooth.XSmooth([<span class="hljs-string">"graphical_pos[0]"</span>, <span class="hljs-string">"graphical_pos[1]"</span>])
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
self.worm.move（）を</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
    ...<font></font>
        self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL))<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、これはCellメソッドがどのように見えるべきかです</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>(<span class="hljs-params">Widget</span>):</span><font></font>
...<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">graphical_pos_attach</span>(<span class="hljs-params">self, smooth_motion=None</span>):</span>
        to_x, to_y = self.actual_pos[<span class="hljs-number">0</span>] - self.graphical_size[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>, self.actual_pos[<span class="hljs-number">1</span>] - self.graphical_size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>
        <span class="hljs-keyword">if</span> smooth_motion <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            self.graphical_pos = to_x, to_y<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            smoother, t = smooth_motion<font></font>
            smoother.move_to(self, to_x, to_y, t)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, x, y, **kwargs</span>):</span><font></font>
        self.actual_pos = (x, y)<font></font>
        self.graphical_pos_attach(**kwargs)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_by</span>(<span class="hljs-params">self, x, y, **kwargs</span>):</span>
        self.move_to(self.actual_pos[<span class="hljs-number">0</span>] + x, self.actual_pos[<span class="hljs-number">1</span>] + y, **kwargs)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、それだけです、あなたの注意をありがとう！</font><font style="vertical-align: inherit;">コードは以下のとおりです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
結果がどのように機能するかのデモビデオ：</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/0clOAucqRDE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最終コード</font></font></b><div class="spoiler_text"><div class="spoiler"><b class="spoiler_title">main.py</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.widget <span class="hljs-keyword">import</span> Widget
<span class="hljs-keyword">from</span> kivy.clock <span class="hljs-keyword">import</span> Clock
<span class="hljs-keyword">from</span> kivy.properties <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> smooth<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>(<span class="hljs-params">Widget</span>):</span>
    graphical_size = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
    graphical_pos = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
    color = ListProperty([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y, size, margin=<span class="hljs-number">4</span></span>):</span><font></font>
        super().__init__()<font></font>
        self.actual_size = (size, size)<font></font>
        self.graphical_size = (size - margin, size - margin)<font></font>
        self.margin = margin<font></font>
        self.actual_pos = (x, y)<font></font>
        self.graphical_pos_attach()<font></font>
        self.color = (<span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">graphical_pos_attach</span>(<span class="hljs-params">self, smooth_motion=None</span>):</span>
        to_x, to_y = self.actual_pos[<span class="hljs-number">0</span>] - self.graphical_size[<span class="hljs-number">0</span>] / <span class="hljs-number">2</span>, self.actual_pos[<span class="hljs-number">1</span>] - self.graphical_size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>
        <span class="hljs-keyword">if</span> smooth_motion <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            self.graphical_pos = to_x, to_y<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            smoother, t = smooth_motion<font></font>
            smoother.move_to(self, to_x, to_y, t)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, x, y, **kwargs</span>):</span><font></font>
        self.actual_pos = (x, y)<font></font>
        self.graphical_pos_attach(**kwargs)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_by</span>(<span class="hljs-params">self, x, y, **kwargs</span>):</span>
        self.move_to(self.actual_pos[<span class="hljs-number">0</span>] + x, self.actual_pos[<span class="hljs-number">1</span>] + y, **kwargs)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_pos</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> self.actual_pos<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">step_by</span>(<span class="hljs-params">self, direction, **kwargs</span>):</span>
        self.move_by(self.actual_size[<span class="hljs-number">0</span>] * direction[<span class="hljs-number">0</span>], self.actual_size[<span class="hljs-number">1</span>] * direction[<span class="hljs-number">1</span>], **kwargs)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worm</span>(<span class="hljs-params">Widget</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.cells = []<font></font>
        self.config = config<font></font>
        self.cell_size = config.CELL_SIZE<font></font>
        self.head_init((<span class="hljs-number">100</span>, <span class="hljs-number">100</span>))
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(config.DEFAULT_LENGTH):<font></font>
            self.lengthen()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">destroy</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(self.cells)):<font></font>
            self.remove_widget(self.cells[i])<font></font>
        self.cells = []<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lengthen</span>(<span class="hljs-params">self, pos=None, direction=(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">1</span></span>)</span>):</span>
        <span class="hljs-keyword">if</span> pos <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            px = self.cells[<span class="hljs-number">-1</span>].get_pos()[<span class="hljs-number">0</span>] + direction[<span class="hljs-number">0</span>] * self.cell_size<font></font>
            py = self.cells[<span class="hljs-number">-1</span>].get_pos()[<span class="hljs-number">1</span>] + direction[<span class="hljs-number">1</span>] * self.cell_size<font></font>
            pos = (px, py)<font></font>
        self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN))<font></font>
        self.add_widget(self.cells[<span class="hljs-number">-1</span>])<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head_init</span>(<span class="hljs-params">self, pos</span>):</span><font></font>
        self.lengthen(pos=pos)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span>(<span class="hljs-params">self, direction, **kwargs</span>):</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(self.cells) - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>):<font></font>
            self.cells[i].move_to(*self.cells[i - <span class="hljs-number">1</span>].get_pos(), **kwargs)<font></font>
        self.cells[<span class="hljs-number">0</span>].step_by(direction, **kwargs)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gather_positions</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> [cell.get_pos() <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.cells]<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head_intersect</span>(<span class="hljs-params">self, cell</span>):</span>
        <span class="hljs-keyword">return</span> self.cells[<span class="hljs-number">0</span>].get_pos() == cell.get_pos()<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    worm_len = NumericProperty(<span class="hljs-number">0</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config</span>):</span><font></font>
        super().__init__()<font></font>
        self.config = config<font></font>
        self.worm = <span class="hljs-literal">None</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
        self.fruit = <span class="hljs-literal">None</span>
        self.game_on = <span class="hljs-literal">True</span>
        self.smooth = smooth.XSmooth([<span class="hljs-string">"graphical_pos[0]"</span>, <span class="hljs-string">"graphical_pos[1]"</span>])<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_cell_location</span>(<span class="hljs-params">self, offset</span>):</span>
        x_row = self.size[<span class="hljs-number">0</span>] // self.config.CELL_SIZE<font></font>
        x_col = self.size[<span class="hljs-number">1</span>] // self.config.CELL_SIZE
        <span class="hljs-keyword">return</span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_location</span>(<span class="hljs-params">self, offset</span>):</span><font></font>
        x_row, x_col = self.random_cell_location(offset)<font></font>
        <span class="hljs-keyword">return</span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit_dislocate</span>(<span class="hljs-params">self</span>):</span>
        x, y = self.random_location(<span class="hljs-number">2</span>)
        <span class="hljs-keyword">while</span> (x, y) <span class="hljs-keyword">in</span> self.worm.gather_positions():<font></font>
            x, y = self.random_location(<span class="hljs-number">2</span>)<font></font>
        self.fruit.move_to(x, y)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.worm = Worm(self.config)<font></font>
        self.add_widget(self.worm)<font></font>
        <span class="hljs-keyword">if</span> self.fruit <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.remove_widget(self.fruit)<font></font>
        self.fruit = Cell(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, self.config.APPLE_SIZE)<font></font>
        self.fruit.color = (<span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)<font></font>
        self.fruit_dislocate()<font></font>
        self.add_widget(self.fruit)<font></font>
        self.game_on = <span class="hljs-literal">True</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)<font></font>
        Clock.schedule_interval(self.update, self.config.INTERVAL)<font></font>
        self.popup_label.text = <span class="hljs-string">""</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self, text=<span class="hljs-string">""</span></span>):</span>
        self.game_on = <span class="hljs-literal">False</span><font></font>
        self.popup_label.text = text<font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">game_over</span>(<span class="hljs-params">self</span>):</span>
        self.stop(<span class="hljs-string">"GAME OVER"</span> + <span class="hljs-string">" "</span> * <span class="hljs-number">5</span> + <span class="hljs-string">"\ntap to reset"</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">align_labels</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">try</span>:<font></font>
            self.popup_label.pos = ((self.size[<span class="hljs-number">0</span>] - self.popup_label.width) / <span class="hljs-number">2</span>, self.size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>)<font></font>
            self.score_label.pos = ((self.size[<span class="hljs-number">0</span>] - self.score_label.width) / <span class="hljs-number">2</span>, self.size[<span class="hljs-number">1</span>] - <span class="hljs-number">80</span>)
        <span class="hljs-keyword">except</span>:<font></font>
            print(self.__dict__)<font></font>
            <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_on:
            <span class="hljs-keyword">return</span><font></font>
        self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL))<font></font>
        <span class="hljs-keyword">if</span> self.worm.head_intersect(self.fruit):<font></font>
            directions = [(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)]<font></font>
            self.worm.lengthen(direction=random.choice(directions))<font></font>
            self.fruit_dislocate()<font></font>
        cell = self.worm_bite_self()<font></font>
        <span class="hljs-keyword">if</span> cell:<font></font>
            cell.color = (<span class="hljs-number">1.0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1.0</span>)<font></font>
            self.game_over()<font></font>
        self.worm_len = len(self.worm.cells)<font></font>
        self.align_labels()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_touch_down</span>(<span class="hljs-params">self, touch</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_on:<font></font>
            self.worm.destroy()<font></font>
            self.start()<font></font>
            <span class="hljs-keyword">return</span>
        ws = touch.x / self.size[<span class="hljs-number">0</span>]<font></font>
        hs = touch.y / self.size[<span class="hljs-number">1</span>]<font></font>
        aws = <span class="hljs-number">1</span> - ws
        <span class="hljs-keyword">if</span> ws &gt; hs <span class="hljs-keyword">and</span> aws &gt; hs:<font></font>
            cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)
        <span class="hljs-keyword">elif</span> ws &gt; hs &gt;= aws:<font></font>
            cur_dir = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">elif</span> ws &lt;= hs &lt; aws:<font></font>
            cur_dir = (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
        self.cur_dir = cur_dir<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worm_bite_self</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.worm.cells[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> self.worm.head_intersect(cell):
                <span class="hljs-keyword">return</span> cell
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>:</span>
    DEFAULT_LENGTH = <span class="hljs-number">20</span>
    CELL_SIZE = <span class="hljs-number">25</span>
    APPLE_SIZE = <span class="hljs-number">35</span>
    MARGIN = <span class="hljs-number">4</span>
    INTERVAL = <span class="hljs-number">0.3</span>
    DEAD_CELL = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
    APPLE_COLOR = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.config = Config()<font></font>
        self.form = Form(self.config)<font></font>
        <span class="hljs-keyword">return</span> self.form<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.form.start()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    WormApp().run()<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br>
<div class="spoiler"><b class="spoiler_title">smooth.py</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.clock <span class="hljs-keyword">import</span> Clock
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Timing</span>:</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">linear</span>(<span class="hljs-params">x</span>):</span>
        <span class="hljs-keyword">return</span> x<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Smooth</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, interval=<span class="hljs-number">1.0</span>/<span class="hljs-number">60.0</span></span>):</span><font></font>
        self.objs = []<font></font>
        self.running = <span class="hljs-literal">False</span><font></font>
        self.interval = interval<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.running:
            <span class="hljs-keyword">return</span>
        self.running = <span class="hljs-literal">True</span><font></font>
        Clock.schedule_interval(self.update, self.interval)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.running:
            <span class="hljs-keyword">return</span>
        self.running = <span class="hljs-literal">False</span><font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setattr</span>(<span class="hljs-params">self, obj, attr, value</span>):</span>
        exec(<span class="hljs-string">"obj."</span> + attr + <span class="hljs-string">" = "</span> + str(value))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getattr</span>(<span class="hljs-params">self, obj, attr</span>):</span>
        <span class="hljs-keyword">return</span> float(eval(<span class="hljs-string">"obj."</span> + attr))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
        cur_time = time.time()<font></font>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.objs:<font></font>
            obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line<font></font>
            time_gone = cur_time - start_time<font></font>
            <span class="hljs-keyword">if</span> time_gone &gt;= period:<font></font>
                self.setattr(obj, prop_name_x, to_x)<font></font>
                self.setattr(obj, prop_name_y, to_y)<font></font>
                self.objs.remove(line)<font></font>
            <span class="hljs-keyword">else</span>:<font></font>
                share = time_gone / period<font></font>
                acs = timing(share)<font></font>
                self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number">1</span> - acs) + to_x * acs)<font></font>
                self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number">1</span> - acs) + to_y * acs)
        <span class="hljs-keyword">if</span> len(self.objs) == <span class="hljs-number">0</span>:<font></font>
            self.stop()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear</span>):</span><font></font>
        self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x,<font></font>
                          to_y, time.time(), t, timing))<font></font>
        self.run()<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XSmooth</span>(<span class="hljs-params">Smooth</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, props, timing=Timing.linear, *args, **kwargs</span>):</span><font></font>
        super().__init__(*args, **kwargs)<font></font>
        self.props = props<font></font>
        self.timing = timing<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, obj, to_x, to_y, t</span>):</span><font></font>
        super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br>
<div class="spoiler"><b class="spoiler_title">worm.kv</b><div class="spoiler_text"><pre><code class="plaintext hljs">&lt;Form&gt;:<font></font>
    popup_label: popup_label<font></font>
    score_label: score_label<font></font>
<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: (.5, .5, .5, 1.0)<font></font>
<font></font>
        Line:<font></font>
            width: 1.5<font></font>
            points: (0, 0), self.size<font></font>
<font></font>
        Line:<font></font>
            width: 1.5<font></font>
            points: (self.size[0], 0), (0, self.size[1])<font></font>
    Label:<font></font>
        id: score_label<font></font>
        text: "Score: " + str(self.parent.worm_len)<font></font>
        width: self.width<font></font>
<font></font>
    Label:<font></font>
        id: popup_label<font></font>
        width: self.width<font></font>
<font></font>
&lt;Worm&gt;:<font></font>
<font></font>
<font></font>
&lt;Cell&gt;:<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: self.color<font></font>
<font></font>
        Rectangle:<font></font>
            size: self.graphical_size<font></font>
            pos: self.graphical_pos<font></font>
</code></pre><br>
</div></div><br>
</div></div><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@tshirtmanによって若干変更されたコード</font></font></b><div class="spoiler_text">    tshirtman,    Kivy,      Point      .            ,        UI  gamedev.  ,  :<br>
<div class="spoiler"><b class="spoiler_title">main.py</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.app <span class="hljs-keyword">import</span> App
<span class="hljs-keyword">from</span> kivy.uix.widget <span class="hljs-keyword">import</span> Widget
<span class="hljs-keyword">from</span> kivy.clock <span class="hljs-keyword">import</span> Clock
<span class="hljs-keyword">from</span> kivy.properties <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> smooth<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cell</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y</span>):</span><font></font>
        self.actual_pos = (x, y)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, x, y</span>):</span><font></font>
        self.actual_pos = (x, y)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_by</span>(<span class="hljs-params">self, x, y</span>):</span>
        self.move_to(self.actual_pos[<span class="hljs-number">0</span>] + x, self.actual_pos[<span class="hljs-number">1</span>] + y)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_pos</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> self.actual_pos<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fruit</span>(<span class="hljs-params">Cell</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x, y</span>):</span><font></font>
        super().__init__(x, y)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worm</span>(<span class="hljs-params">Widget</span>):</span>
    margin = NumericProperty(<span class="hljs-number">4</span>)<font></font>
    graphical_poses = ListProperty()<font></font>
    inj_pos = ListProperty([<span class="hljs-number">-1000</span>, <span class="hljs-number">-1000</span>])<font></font>
    graphical_size = NumericProperty(<span class="hljs-number">0</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config, **kwargs</span>):</span><font></font>
        super().__init__(**kwargs)<font></font>
        self.cells = []<font></font>
        self.config = config<font></font>
        self.cell_size = config.CELL_SIZE<font></font>
        self.head_init((self.config.CELL_SIZE * random.randint(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>), self.config.CELL_SIZE * random.randint(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)))<font></font>
        self.margin = config.MARGIN<font></font>
        self.graphical_size = self.cell_size - self.margin<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(config.DEFAULT_LENGTH):<font></font>
            self.lengthen()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">destroy</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.cells = []<font></font>
        self.graphical_poses = []<font></font>
        self.inj_pos = [<span class="hljs-number">-1000</span>, <span class="hljs-number">-1000</span>]<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cell_append</span>(<span class="hljs-params">self, pos</span>):</span><font></font>
        self.cells.append(Cell(*pos))<font></font>
        self.graphical_poses.extend([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])<font></font>
        self.cell_move_to(len(self.cells) - <span class="hljs-number">1</span>, pos)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lengthen</span>(<span class="hljs-params">self, pos=None, direction=(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">1</span></span>)</span>):</span>
        <span class="hljs-keyword">if</span> pos <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            px = self.cells[<span class="hljs-number">-1</span>].get_pos()[<span class="hljs-number">0</span>] + direction[<span class="hljs-number">0</span>] * self.cell_size<font></font>
            py = self.cells[<span class="hljs-number">-1</span>].get_pos()[<span class="hljs-number">1</span>] + direction[<span class="hljs-number">1</span>] * self.cell_size<font></font>
            pos = (px, py)<font></font>
        self.cell_append(pos)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head_init</span>(<span class="hljs-params">self, pos</span>):</span><font></font>
        self.lengthen(pos=pos)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cell_move_to</span>(<span class="hljs-params">self, i, pos, smooth_motion=None</span>):</span><font></font>
        self.cells[i].move_to(*pos)<font></font>
        to_x, to_y = pos[<span class="hljs-number">0</span>], pos[<span class="hljs-number">1</span>]
        <span class="hljs-keyword">if</span> smooth_motion <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<font></font>
            self.graphical_poses[i * <span class="hljs-number">2</span>], self.graphical_poses[i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>] = to_x, to_y
        <span class="hljs-keyword">else</span>:<font></font>
            smoother, t = smooth_motion<font></font>
            smoother.move_to(self, <span class="hljs-string">"graphical_poses["</span> + str(i * <span class="hljs-number">2</span>) + <span class="hljs-string">"]"</span>, <span class="hljs-string">"graphical_poses["</span> + str(i * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>) + <span class="hljs-string">"]"</span>,<font></font>
                             to_x, to_y, t)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move</span>(<span class="hljs-params">self, direction, **kwargs</span>):</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(self.cells) - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>):<font></font>
            self.cell_move_to(i, self.cells[i - <span class="hljs-number">1</span>].get_pos(), **kwargs)<font></font>
        self.cell_move_to(<span class="hljs-number">0</span>, (self.cells[<span class="hljs-number">0</span>].get_pos()[<span class="hljs-number">0</span>] + self.cell_size * direction[<span class="hljs-number">0</span>], self.cells[<span class="hljs-number">0</span>].get_pos()[<span class="hljs-number">1</span>] +<font></font>
                              self.cell_size * direction[<span class="hljs-number">1</span>]), **kwargs)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gather_positions</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> [cell.get_pos() <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.cells]<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head_intersect</span>(<span class="hljs-params">self, cell</span>):</span>
        <span class="hljs-keyword">return</span> self.cells[<span class="hljs-number">0</span>].get_pos() == cell.get_pos()<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span>(<span class="hljs-params">Widget</span>):</span>
    worm_len = NumericProperty(<span class="hljs-number">0</span>)<font></font>
    fruit_pos = ListProperty([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])<font></font>
    fruit_size = NumericProperty(<span class="hljs-number">0</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, config, **kwargs</span>):</span><font></font>
        super().__init__(**kwargs)<font></font>
        self.config = config<font></font>
        self.worm = <span class="hljs-literal">None</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
        self.fruit = <span class="hljs-literal">None</span>
        self.game_on = <span class="hljs-literal">True</span><font></font>
        self.smooth = smooth.Smooth()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_cell_location</span>(<span class="hljs-params">self, offset</span>):</span>
        x_row = self.size[<span class="hljs-number">0</span>] // self.config.CELL_SIZE<font></font>
        x_col = self.size[<span class="hljs-number">1</span>] // self.config.CELL_SIZE
        <span class="hljs-keyword">return</span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_location</span>(<span class="hljs-params">self, offset</span>):</span><font></font>
        x_row, x_col = self.random_cell_location(offset)<font></font>
        <span class="hljs-keyword">return</span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit_dislocate</span>(<span class="hljs-params">self, xy=None</span>):</span>
        <span class="hljs-keyword">if</span> xy <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            x, y = xy<font></font>
        <span class="hljs-keyword">else</span>:<font></font>
            x, y = self.random_location(<span class="hljs-number">2</span>)
            <span class="hljs-keyword">while</span> (x, y) <span class="hljs-keyword">in</span> self.worm.gather_positions():<font></font>
                x, y = self.random_location(<span class="hljs-number">2</span>)<font></font>
        self.fruit.move_to(x, y)<font></font>
        self.fruit_pos = (x, y)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.worm = Worm(self.config)<font></font>
        self.add_widget(self.worm)<font></font>
        self.fruit = Fruit(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<font></font>
        self.fruit_size = self.config.APPLE_SIZE<font></font>
        self.fruit_dislocate()<font></font>
        self.game_on = <span class="hljs-literal">True</span>
        self.cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)<font></font>
        Clock.schedule_interval(self.update, self.config.INTERVAL)<font></font>
        self.popup_label.text = <span class="hljs-string">""</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self, text=<span class="hljs-string">""</span></span>):</span>
        self.game_on = <span class="hljs-literal">False</span><font></font>
        self.popup_label.text = text<font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">game_over</span>(<span class="hljs-params">self</span>):</span>
        self.stop(<span class="hljs-string">"GAME OVER"</span> + <span class="hljs-string">" "</span> * <span class="hljs-number">5</span> + <span class="hljs-string">"\ntap to reset"</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">align_labels</span>(<span class="hljs-params">self</span>):</span>
        self.popup_label.pos = ((self.size[<span class="hljs-number">0</span>] - self.popup_label.width) / <span class="hljs-number">2</span>, self.size[<span class="hljs-number">1</span>] / <span class="hljs-number">2</span>)<font></font>
        self.score_label.pos = ((self.size[<span class="hljs-number">0</span>] - self.score_label.width) / <span class="hljs-number">2</span>, self.size[<span class="hljs-number">1</span>] - <span class="hljs-number">80</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_on:
            <span class="hljs-keyword">return</span><font></font>
        self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL))<font></font>
        <span class="hljs-keyword">if</span> self.worm.head_intersect(self.fruit):<font></font>
            directions = [(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)]<font></font>
            self.worm.lengthen(direction=random.choice(directions))<font></font>
            self.fruit_dislocate()<font></font>
        cell = self.worm_bite_self()<font></font>
        <span class="hljs-keyword">if</span> cell <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            self.worm.inj_pos = cell.get_pos()<font></font>
            self.game_over()<font></font>
        self.worm_len = len(self.worm.cells)<font></font>
        self.align_labels()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_touch_down</span>(<span class="hljs-params">self, touch</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.game_on:<font></font>
            self.worm.destroy()<font></font>
            self.start()<font></font>
            <span class="hljs-keyword">return</span>
        ws = touch.x / self.size[<span class="hljs-number">0</span>]<font></font>
        hs = touch.y / self.size[<span class="hljs-number">1</span>]<font></font>
        aws = <span class="hljs-number">1</span> - ws
        <span class="hljs-keyword">if</span> ws &gt; hs <span class="hljs-keyword">and</span> aws &gt; hs:<font></font>
            cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>)
        <span class="hljs-keyword">elif</span> ws &gt; hs &gt;= aws:<font></font>
            cur_dir = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">elif</span> ws &lt;= hs &lt; aws:<font></font>
            cur_dir = (<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">else</span>:<font></font>
            cur_dir = (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
        self.cur_dir = cur_dir<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">worm_bite_self</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> self.worm.cells[<span class="hljs-number">1</span>:]:
            <span class="hljs-keyword">if</span> self.worm.head_intersect(cell):
                <span class="hljs-keyword">return</span> cell
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>:</span>
    DEFAULT_LENGTH = <span class="hljs-number">20</span>
    CELL_SIZE = <span class="hljs-number">26</span>  <span class="hljs-comment">#  ,  CELL_SIZE - MARGIN    4</span>
    APPLE_SIZE = <span class="hljs-number">36</span>
    MARGIN = <span class="hljs-number">2</span>
    INTERVAL = <span class="hljs-number">0.3</span>
    DEAD_CELL = (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
    APPLE_COLOR = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WormApp</span>(<span class="hljs-params">App</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, **kwargs</span>):</span><font></font>
        super().__init__(**kwargs)<font></font>
        self.form = <span class="hljs-literal">None</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self, **kwargs</span>):</span><font></font>
        self.config = Config()<font></font>
        self.form = Form(self.config, **kwargs)<font></font>
        <span class="hljs-keyword">return</span> self.form<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">on_start</span>(<span class="hljs-params">self</span>):</span><font></font>
        self.form.start()<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<font></font>
    WormApp().run()<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">smooth.py</b><div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword">from</span> kivy.clock <span class="hljs-keyword">import</span> Clock
<span class="hljs-keyword">import</span> time<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Timing</span>:</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">linear</span>(<span class="hljs-params">x</span>):</span>
        <span class="hljs-keyword">return</span> x<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Smooth</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, interval=<span class="hljs-number">1.0</span>/<span class="hljs-number">60.0</span></span>):</span><font></font>
        self.objs = []<font></font>
        self.running = <span class="hljs-literal">False</span><font></font>
        self.interval = interval<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> self.running:
            <span class="hljs-keyword">return</span>
        self.running = <span class="hljs-literal">True</span><font></font>
        Clock.schedule_interval(self.update, self.interval)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.running:
            <span class="hljs-keyword">return</span>
        self.running = <span class="hljs-literal">False</span><font></font>
        Clock.unschedule(self.update)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_attr</span>(<span class="hljs-params">self, obj, attr, value</span>):</span>
        exec(<span class="hljs-string">"obj."</span> + attr + <span class="hljs-string">" = "</span> + str(value))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_attr</span>(<span class="hljs-params">self, obj, attr</span>):</span>
        <span class="hljs-keyword">return</span> float(eval(<span class="hljs-string">"obj."</span> + attr))<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, _</span>):</span><font></font>
        cur_time = time.time()<font></font>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.objs:<font></font>
            obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line<font></font>
            time_gone = cur_time - start_time<font></font>
            <span class="hljs-keyword">if</span> time_gone &gt;= period:<font></font>
                self.set_attr(obj, prop_name_x, to_x)<font></font>
                self.set_attr(obj, prop_name_y, to_y)<font></font>
                self.objs.remove(line)<font></font>
            <span class="hljs-keyword">else</span>:<font></font>
                share = time_gone / period<font></font>
                acs = timing(share)<font></font>
                self.set_attr(obj, prop_name_x, from_x * (<span class="hljs-number">1</span> - acs) + to_x * acs)<font></font>
                self.set_attr(obj, prop_name_y, from_y * (<span class="hljs-number">1</span> - acs) + to_y * acs)
        <span class="hljs-keyword">if</span> len(self.objs) == <span class="hljs-number">0</span>:<font></font>
            self.stop()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear</span>):</span><font></font>
        self.objs.append((obj, prop_name_x, prop_name_y, self.get_attr(obj, prop_name_x), self.get_attr(obj, prop_name_y), to_x,<font></font>
                          to_y, time.time(), t, timing))<font></font>
        self.run()<font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XSmooth</span>(<span class="hljs-params">Smooth</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, props, timing=Timing.linear, *args, **kwargs</span>):</span><font></font>
        super().__init__(*args, **kwargs)<font></font>
        self.props = props<font></font>
        self.timing = timing<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_to</span>(<span class="hljs-params">self, obj, to_x, to_y, t</span>):</span><font></font>
        super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)<font></font>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">worm.kv</b><div class="spoiler_text"><pre><code class="plaintext hljs">&lt;Form&gt;:<font></font>
    popup_label: popup_label<font></font>
    score_label: score_label<font></font>
<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: (.5, .5, .5, 1.0)<font></font>
<font></font>
        Line:<font></font>
            width: 1.5<font></font>
            points: (0, 0), self.size<font></font>
<font></font>
        Line:<font></font>
            width: 1.5<font></font>
            points: (self.size[0], 0), (0, self.size[1])<font></font>
<font></font>
        Color:<font></font>
            rgba: (1.0, 0.2, 0.2, 1.0)<font></font>
<font></font>
        Point:<font></font>
            points: self.fruit_pos<font></font>
            pointsize: self.fruit_size / 2<font></font>
<font></font>
    Label:<font></font>
        id: score_label<font></font>
        text: "Score: " + str(self.parent.worm_len)<font></font>
        width: self.width<font></font>
<font></font>
    Label:<font></font>
        id: popup_label<font></font>
        width: self.width<font></font>
<font></font>
&lt;Worm&gt;:<font></font>
    canvas:<font></font>
        Color:<font></font>
            rgba: (0.2, 1.0, 0.2, 1.0)<font></font>
        Point:<font></font>
            points: self.graphical_poses<font></font>
            pointsize: self.graphical_size / 2<font></font>
        Color:<font></font>
            rgba: (1.0, 0.2, 0.2, 1.0)<font></font>
        Point:<font></font>
            points: self.inj_pos<font></font>
            pointsize: self.graphical_size / 2<font></font>
</code></pre><br>
</div></div></div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
質問してください。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja466229/index.html">綿ウール10箱を購入して間違いをしない方法</a></li>
<li><a href="../ja466231/index.html">ShIoTinyとその周辺：センサーとバイナリ入力の接続、バウンスなどの問題</a></li>
<li><a href="../ja466235/index.html">等距離スキャンでムンクと赤の広場を破壊したマイヤーホールド-VRアートのデニスセメノフ</a></li>
<li><a href="../ja466237/index.html">緑のジュニアがホットリローダーをどのように書いたか</a></li>
<li><a href="../ja466247/index.html">内向的なインタビュー</a></li>
<li><a href="../ja466251/index.html">プロジェクトをSoft Launchから月額100万ドルの収益に引き上げる</a></li>
<li><a href="../ja466253/index.html">ALS Luna-9とLuna-13の着陸地点をどのように再構築したか</a></li>
<li><a href="../ja466257/index.html">海を征服する：フローティングデータウェアハウス</a></li>
<li><a href="../ja466263/index.html">ベンチマークRPCシステム（および反転Json）</a></li>
<li><a href="../ja466267/index.html">多くの人がゲームを過小評価しているのはなぜですか</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>