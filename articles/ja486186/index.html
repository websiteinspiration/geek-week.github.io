<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐺 ☹️ 🤸 壊滅的なクラウド：仕組み 👩🏽‍🎓 👍🏿 🍝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="こんにちは、ハブル！
 
 年末年始を機に、2つの拠点をベースに災害に強いクラウドを再開しました。今日は、それがどのように機能するかを説明し、個々のクラスター要素に障害が発生し、サイト全体が故障した場合（スポイラー-すべてが問題ありません）、クライアント仮想マシンに何が起こるかを示します。
 
 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>壊滅的なクラウド：仕組み</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/486186/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">こんにちは、ハブル！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
年末年始を機に、2つの拠点をベースに災害に強いクラウドを再開しました。</font><font style="vertical-align: inherit;">今日は、それがどのように機能するかを説明し、個々のクラスター要素に障害が発生し、サイト全体が故障した場合（スポイラー-すべてが問題ありません）、クライアント仮想マシンに何が起こるかを示します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/no/xs/p9/noxsp98upzfesoanpuhefetyilq.jpeg"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSTサイトの防災クラウドストレージ。</font></font></i><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中身は</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスターの内部には、VMware ESXiハイパーバイザーを備えたCisco UCSサーバー、2つのINFINIDAT InfiniBox F2240ストレージシステム、Cisco Nexusネットワーク機器、およびBrocade SANスイッチがあります。</font><font style="vertical-align: inherit;">クラスターは、OSTとNORDの2つのサイトに配置されます。つまり、各データセンターで同じ機器のセットです。</font><font style="vertical-align: inherit;">実際、これは破滅的です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1つのプラットフォーム内で、主要な要素（ホスト、SANスイッチ、ネットワークカード）も複製されます。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのサイトは専用の光ファイバーパスで接続されており、これも予約されています。</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ストレージについて一言。</font><font style="vertical-align: inherit;">NetApp上に構築した最初の耐災害性クラウド。</font><font style="vertical-align: inherit;">INFINIDATがここで選択されました。その理由は次のとおりです。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アクティブ-アクティブ複製オプション。</font><font style="vertical-align: inherit;">これにより、ストレージシステムの1つに完全に障害が発生した場合でも、仮想マシンは動作し続けることができます。</font><font style="vertical-align: inherit;">レプリケーションについては後で詳しく説明します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">システムの復元力を高めるための3つのディスクコントローラー。</font><font style="vertical-align: inherit;">通常は2つあります。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">すぐに使えるソリューション。</font><font style="vertical-align: inherit;">すでに組み立てられたラックが届きました。ネットワークに接続して構成するだけで済みます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丁寧な技術サポート。</font><font style="vertical-align: inherit;">INFINIDATエンジニアは、ストレージシステムのログとイベントを常に分析し、ファームウェアに新しいバージョンをインストールし、構成を支援します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
開梱の写真は次のとおりです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ro/r1/9i/ror19i6ohplap3nzivyq9dxqaog.png"><br>
<br>
<img src="https://habrastorage.org/webt/rg/zm/of/rgzmofi67yaghzz7fziewaka3fw.jpeg"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">それはどのように機能しますか</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラウドは、それ自体ですでに回復力があります。単一のハードウェアおよびソフトウェアの障害からクライアントを保護します。破滅的とは、同じサイト内の大規模な障害からの保護に役立ちます。たとえば、ストレージシステム（またはSDSクラスター、頻繁に発生する:)の障害、ストレージネットワークの大規模なエラーなどです。最も重要なのは、火災、停電、襲撃者の捕獲、</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">エイリアンの着陸の</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ためにサイト全体にアクセスできなくなった場合に、このような雲が救われること</font><s><font style="vertical-align: inherit;">です。</font></s></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これらすべてのケースで、クライアント仮想マシンは引き続き実行されます。その理由は次のとおりです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
クラスタスキームは、クライアント仮想マシンを備えたESXiホストが2つのストレージシステムのいずれかにアクセスできるように設計されています。 OSTサイトのストレージに障害が発生した場合、仮想マシンは引き続き機能します。仮想マシンが機能するホストは、NORD上のストレージにアクセスしてデータを取得します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vu/pq/0u/vupq0uycl3yelwrujymst8jqpke.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これは、クラスター内の接続図がどのように見えるかです。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これは、2つのサイトのSANファクトリ間にスイッチ間リンクが構成されているために可能です。ファブリックA OST SANスイッチは、ファブリックB SANスイッチと同様に、ファブリックA NORD SANスイッチに接続されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まあ、これらの複雑なSANファクトリすべてが理にかなっているように、2つのストレージシステム間でアクティブ/アクティブレプリケーションが構成されています。情報はローカルとリモートのストレージシステムにほぼ同時に書き込まれ、RPO = 0です。一方のSHDには元のデータが保存され、もう一方のSHDにはレプリカが保存されていることがわかります。データはストレージボリュームレベルで複製され、VMデータ（ディスク、構成ファイル、スワップファイルなど）はすでにそれらに格納されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiホストは、プライマリボリュームとそのレプリカを単一のストレージデバイスとして認識します。 ESXiホストから各ディスクデバイスへのパスは24あります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12のパスはそれをローカルストレージ（最適パス）に関連付け、残りの12はリモート（最適パスではない）に関連付けます。通常の状況では、ESXiは「最適な」パスを使用してローカルストレージ上のデータにアクセスします。このストレージシステムに障害が発生すると、ESXiは最適なパスを失い、「最適でない」パスに切り替わります。これが図でどのように見えるかです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/zu/rp/tlzurpwt1mspwdpbjeb53ydas4i.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">災害に強いクラスターのスキーム。</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
すべてのクライアントネットワークは、共通のネットワークファクトリを介して両方のサイトで確立されます。プロバイダーエッジ（PE）は、クライアントネットワークが終端している各サイトで実行されます。 PEは単一のクラスターに結合されます。 1つのサイトでPEに障害が発生すると、すべてのトラフィックが2番目のサイトにリダイレクトされます。これのおかげで、PEのないサイトの仮想マシンは、ネットワーク経由でクライアントに引き続き使用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、さまざまな障害が発生した場合にクライアント仮想マシンがどうなるかを見てみましょう。</font><font style="vertical-align: inherit;">最も軽いオプションから始めて、最も深刻な-サイト全体の失敗で終わりましょう。</font><font style="vertical-align: inherit;">例では、メインサイトはOSTであり、データレプリカを含むバックアップはNORDになります。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">クライアント仮想マシンはどうなりますか... </font></font></h3><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">複製リンクが失敗します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2つのサイトのストレージシステム間のレプリケーションが停止します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESXiは、（最適パスに沿った）ローカルディスクデバイスでのみ機能します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンは引き続き機能します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xd/1u/rs/xd1urscyrw5ldefaecvzg2sxsbg.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ギャップISL（スイッチ間リンク）があります。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ケースはほとんどありません。いくつかの狂った掘削機が一度にいくつかの光学ルートを掘り起こさない限り、それらは独立したルートを通過し、異なる入力を通してサイトに運ばれます。とにかく。この場合、ESXiホストはパスの半分を失い、ローカルストレージにのみアクセスできます。レプリカは収集されますが、ホストはそれらにアクセスできなくなります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンは正常に動作します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/eh/pg/p2/ehpgp21qksqs333elaz_px8hohs.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれかのサイトのSANスイッチを拒否します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESXiホストはストレージパスの一部を失います。この場合、スイッチに障害が発生したサイト上のホストは、独自のHBAを介してのみ機能します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同時に、仮想マシンは引き続き正常に動作します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/_1/0w/vz_10wdyjuu3yp9flx0-kyiog9w.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">いずれかのサイトのすべてのSANスイッチに障害が発生しました。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">そのような災害がOSTサイトで起こったとしましょう。この場合、このサイトのESXiホストは、ディスクデバイスへのすべてのパスを失います。標準のVMware vSphere HAメカニズムが機能します。最大140秒後に、NORD内のすべてのOSTプラットフォーム仮想マシンが再起動します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
NORDサイトのホストで実行されている仮想マシンは正常に動作します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yg/le/w8/yglew89bonr-aubz9dw85jxbnb0.gif"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1つのサイトのESXiホストを拒否します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ここでは、vSphere HAメカニズムが再び機能します。障害が発生したホストの仮想マシンは、同じサイトまたはリモートサイトの他のホストで再起動されます。仮想マシンの再起動時間は最大1分です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OSTプラットフォームのすべてのESXiホストに障害が発生した場合、オプションはありません。VMは別のVMで再起動します。再起動時間は同じです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ij/ri/no/ijrino56s-akqtzivujr3en3ejy.gif"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同じサイトでの保管を拒否します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OSTサイトでストレージシステムが拒否したとしましょう。次に、OSTプラットフォームのESXiホストがNORDのストレージレプリカで動作するように切り替わります。障害が発生したストレージシステムがシステムに戻った後、強制的なレプリケーションが発生し、OST ESXiホストは再びローカルストレージシステムへの接続を開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
仮想マシンはずっと稼働しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ng/gk/vy/nggkvy-lk3dbjs-zfop2racir3u.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サイトの1つに失敗します。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">この場合、vSphere HAメカニズムを介して、すべての仮想マシンがバックアップサイトで再起動します。 VM再起動時間-140秒。この場合、仮想マシンのすべてのネットワーク設定が保存され、ネットワーク経由でクライアントが使用できるようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
バックアップサイトのマシンを問題なく再起動するには、各サイトが半分しか使用されていません。後半は、すべての仮想マシンが負傷した2番目のサイトから移動された場合の予備です。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/oa/hg/hr/oahghrsypij8je-zwym7trlj0-g.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのデータセンターに基づく耐災害クラウドは、このような障害から保護します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
メインのリソースに加えて、2番目のサイトに予約が必要なため、この喜びは安くはありません。</font><font style="vertical-align: inherit;">そのため、ビジネスクリティカルなサービスをこのようなクラウドに配置します。そのようなクラウドの長いダウンタイムは、多大な財政的および評判の損失を招くか、企業の規制当局または社内規制からの情報システムに災害許容要件が課されている場合です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出典：</font></font></b><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.infinidat.com/sites/default/files/resource-pdfs/DS-INFBOX-190331-US_0.pdf</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">support.infinidat.com/hc/en-us/articles/207057109-InfiniBox-best-practices-guides</font></font></a></li>
</ol></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja486174/index.html">離職率はゼロ</a></li>
<li><a href="../ja486176/index.html">コーポレートメール連絡メモ</a></li>
<li><a href="../ja486178/index.html">FOSSニュースNo. 1-2020年1月27日〜2020年2月2日の無料およびオープンソースニュースのレビュー</a></li>
<li><a href="../ja486180/index.html">サーバーレスアプリケーションを作成するためのヒントとソース</a></li>
<li><a href="../ja486184/index.html">検索を効果的に使用する方法</a></li>
<li><a href="../ja486188/index.html">PostgreSQL wal-gバックアップシステムの紹介</a></li>
<li><a href="../ja486190/index.html">Yandex.Cloud用にKubernetesでCSIドライバーを開発した経験</a></li>
<li><a href="../ja486192/index.html">サイバー詐欺師が携帯電話会社をハッキングして、加入者の電話番号にアクセスする</a></li>
<li><a href="../ja486194/index.html">Proxmox VEのバックアップについて</a></li>
<li><a href="../ja486198/index.html">話すのは難しいです。非プログラマーとのコミュニケーションに関するエッセイ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>