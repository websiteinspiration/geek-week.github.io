<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌴 🌱 👐🏿 Go Bitmap Indexes：Wild Search 🤞 👨🏼‍🍳 📃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="前書き
 このレポートは、モスクワでのGopherCon Russia 2019会議で英語で、ニジニノヴゴロドでの会議でロシア語で作成しました。これはビットマップインデックスに関するものです。Bツリーほど一般的ではありませんが、興味深いものです。私は会議でのスピーチの録音を英語で、テキストの筆記録を...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Go Bitmap Indexes：Wild Search</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/451938/"><img src="https://habrastorage.org/webt/hg/g_/eq/hgg_eq6037im5xzqx0ibzmdyoku.jpeg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このレポートは、モスクワでのGopherCon Russia 2019会議で英語で、ニジニノヴゴロドでの会議でロシア語で作成しました。</font><font style="vertical-align: inherit;">これはビットマップインデックスに関するものです。Bツリーほど一般的ではありませんが、興味深いものです。</font><font style="vertical-align: inherit;">私</font><font style="vertical-align: inherit;">は会議でのスピーチ</font><font style="vertical-align: inherit;">の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">録音を</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">英語で、テキストの筆記録をロシア語で</font><font style="vertical-align: inherit;">共有して</font><font style="vertical-align: inherit;">います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップインデックスがどのように機能するか、それが優れている場合、他のインデックスよりも悪い場合、およびそれよりもはるかに高速であるかを調べます。</font><font style="vertical-align: inherit;">どの人気のあるDBMSに既にビットマップインデックスがあるかを確認します。</font><font style="vertical-align: inherit;">Goで独自に作成してみてください。</font><font style="vertical-align: inherit;">デザートについては、既製のライブラリを使用して、独自の超高速の専門データベースを作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私の仕事があなたにとって有用で興味深いものになることを心から願っています。</font><font style="vertical-align: inherit;">行こう！</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前書き</font></font></h2><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/WvlUH6MjUuI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://bit.ly/bitmapindexes </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/mkevac/gopherconrussia2019</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
みなさん、こんにちは！</font><font style="vertical-align: inherit;">夕方6時、みんな疲れてる。</font><font style="vertical-align: inherit;">データベースインデックスの退屈な理論について話すのに最適な時間ですよね？</font><font style="vertical-align: inherit;">心配しないでください。ソースコードが数行あります。</font><font style="vertical-align: inherit;">:-) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ジョークがない場合、レポートには情報が豊富で、時間はあまりありません。</font><font style="vertical-align: inherit;">それでは始めましょう。</font></font><br>
<img src="https://habrastorage.org/webt/ui/p9/0n/uip90nv7gann0i9cq_xqctdilh0.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は以下について話します：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">インデックスとは;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマップインデックスとは</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用される場所と使用されない場所、およびその理由。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Goでの簡単な実装とコンパイラとの少しの闘い。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ややシンプルではありませんが、Goアセンブラーでの生産性ははるかに高くなります。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマップインデックスの「問題」。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既存の実装。</font></font><br>
</li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、インデックスとは何でしょうか？</font></font></h2><br>
<img src="https://habrastorage.org/webt/ig/uh/ii/iguhiixwichncqrv6gdszecwgzg.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
インデックスは、メインデータに加えて保持および更新する個別のデータ構造です。検索を高速化するために使用されます。インデックスがない場合、検索にはデータ全体のフルパスが必要であり（フルスキャンと呼ばれるプロセス）、このプロセスには線形アルゴリズムの複雑さがあります。しかし、データベースには通常大量のデータが含まれており、線形の複雑さは遅すぎます。理想的には、対数または定数を取得します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは非常に複雑なトピックであり、微妙な点や妥協点に圧倒されますが、数十年にわたるさまざまなデータベースの開発と研究を検討した後、データベースインデックスを作成するために広く使用されているアプローチはわずかしかないことを主張する準備ができています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/aa/yv/wn/aayvwnmn7tbaucc39k3x7ejolsa.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のアプローチは、階層的に検索領域を減らし、検索領域をより小さな部分に分割することです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常、これはあらゆる種類の木を使用して行われます。例としては、クローゼットにマテリアルが入った大きな箱があり、さまざまなトピックで分けられたマテリアルが入った小さな箱があります。材料が必要な場合は、「クッキー」と書かれているのではなく、「材料」という言葉の入った箱でそれらを探すでしょう。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/zk/oq/_3/zkoq_3s8yr3izbnqvgd9nxmtvyi.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の方法は、目的の要素または要素のグループをすぐに選択することです。これは、ハッシュマップまたは逆インデックスで行います。ハッシュマップの使用は前の例と非常に似ていますが、クローゼット内にボックスのあるボックスの代わりに、最終的なアイテムを含む小さなボックスがたくさんあります。</font></font><br>
 <br>
<img src="https://habrastorage.org/webt/kv/zh/0q/kvzh0qp0teoe7h1_ixbeum9jdne.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3番目のアプローチは、検索の必要性を取り除くことです。</font><font style="vertical-align: inherit;">ブルームフィルターまたはカッコウフィルターを使用してこれを行います。</font><font style="vertical-align: inherit;">前者は即座に回答を提供するため、検索する必要がありません。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/b2/4f/icb24fzrjaf4ntui8cymh3orj3c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後のアプローチは、現代の鉄が私たちに与えるすべての能力を十分に活用することです。</font><font style="vertical-align: inherit;">これはまさにビットマップインデックスで行うことです。</font><font style="vertical-align: inherit;">はい、それらを使用する場合、インデックス全体を調べる必要がある場合がありますが、非常に効率的に行います。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
先ほど述べたように、データベースインデックスのトピックは広大で、妥協点に圧倒されます。</font><font style="vertical-align: inherit;">つまり、複数のアプローチを同時に使用できる場合があります。検索をさらに高速化する必要がある場合や、可能なすべての種類の検索をカバーする必要がある場合です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
今日は、ビットマップインデックスについて、これらのうち最もよく知られていないアプローチについてお話します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">これについて私は誰と話すべきですか？</font></font></h2><br>
<img src="https://habrastorage.org/webt/dh/i9/-r/dhi9-rzto3wlple4rympbmrdhx4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はBadooのチームリーダーとして働いています（おそらく、他の製品であるBumbleについての知識が豊富です）。</font><font style="vertical-align: inherit;">私たちはすでに世界中で4億人を超えるユーザーを抱えており、それらに最適なペアの選択に従事する多くの機能を備えています。</font><font style="vertical-align: inherit;">これは、ビットマップインデックスも使用するカスタムサービスを使用して行います。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">では、ビットマップインデックスとは何でしょうか。</font></font></h2><br>
<img src="https://habrastorage.org/webt/iz/ty/tu/iztytuxzo4kzx7vyc7vwrwwslze.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名前が示すように、ビットマップインデックスはビットマップまたはビットセットを使用して検索インデックスを実装します。鳥瞰図では、このインデックスは、エンティティ（人物など）とそのプロパティまたはパラメーター（年齢、目の色など）を表す1つまたは複数のビットマップと、ビット演算を使用するアルゴリズム（AND、または、NOT）検索クエリに応答します。</font></font><br>
<img src="https://habrastorage.org/webt/24/20/ey/2420eyiyck6eqjz7t6xf9zs-gvq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップインデックスは、カーディナリティがほとんどない多くの列にまたがるクエリを組み合わせる検索に最適であり、非常に生産的であると言われています（「目の色」や「婚姻状況」と「市内中心部からの距離」のようなものを想像してください）。 ）しかし、後で、カーディナリティの高い列の場合に完全に機能することを示します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップインデックスの最も単純な例を考えます。</font></font><br>
<img src="https://habrastorage.org/webt/yc/rf/1d/ycrf1dwjkvooel8tctktagyxi0a.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようなバイナリプロパティを持つモスクワレストランのリストがあるとします。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">メトロの近く（メトロの近く）;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">専用駐車場があります（専用駐車場があります）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ベランダがあります（テラスあり）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">あなたはテーブルを予約することができます（予約を受け入れます）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">菜食主義者に適しています（ビーガンフレンドリー）。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高価（高価）です。</font></font><br>
</li>
</ul><br>
<img src="https://habrastorage.org/webt/sg/oq/db/sgoqdbv90ujmnpkajxcc-8eg0eg.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各レストランに0から始まるシリアル番号を割り当て、6つのビットマップ（各特性に1つ）にメモリを割り当てます。</font><font style="vertical-align: inherit;">次に、レストランにこのプロパティがあるかどうかに応じて、これらのビットマップに入力します。</font><font style="vertical-align: inherit;">レストラン4にベランダがある場合、ビットマップの「ベランダあり」のビット4は1に設定されます（ベランダがない場合は0に設定されます）。</font></font><br>
<img src="https://habrastorage.org/webt/jl/ap/ge/jlapgeh1fk9cvapi-9gyxtlgnty.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、最も簡単なビットマップインデックスができました。これを使用して、次のようなクエリに答えることができます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「ベジタリアンに適したレストランを見せて」;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「テーブルを予約できるベランダがある安価なレストランを見せて」</font></font><br>
</li>
</ul><br>
<br>
<img src="https://habrastorage.org/webt/2p/wq/t7/2pwqt76nijteahvflvizdufiumy.jpeg"><br>
<img src="https://habrastorage.org/webt/_d/fg/wq/_dfgwq--uyewk4k_fryjd533tug.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
どうやって？</font><font style="vertical-align: inherit;">見てみましょう。</font><font style="vertical-align: inherit;">最初のリクエストは非常に簡単です。</font><font style="vertical-align: inherit;">私たちがする必要があるのは、「菜食主義者に適した」ビットマップを取り、それをビットが表示されているレストランのリストに変えることです。</font></font><br>
<img src="https://habrastorage.org/webt/oe/0-/hd/oe0-hd5hqr6b6unvqtdoadn3jtu.jpeg"><br>
<img src="https://habrastorage.org/webt/en/3r/co/en3rcomfemoy-arkj9qx3fqmveu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のクエリは少し複雑です。</font><font style="vertical-align: inherit;">「高価な」ビットマップでNOTビット操作を使用して安価なレストランのリストを取得し、それをビットマップ「テーブルを予約できます」で設定し、結果をビットマップ「ベランダあり」で設定する必要があります。</font><font style="vertical-align: inherit;">結果のビットマップには、すべての基準を満たす施設のリストが含まれます。</font><font style="vertical-align: inherit;">この例では、これはYunostレストランのみです。</font></font><br>
<img src="https://habrastorage.org/webt/wm/jr/f5/wmjrf5nhch2k9zriz_sfuxzqfec.jpeg"><br>
<img src="https://habrastorage.org/webt/si/sf/c2/sisfc2h6lro8nu4yctf96absj_u.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
理論はたくさんありますが、心配しないでください。すぐにコードが表示されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマップインデックスはどこで使用されますか？</font></font></h2><br>
<img src="https://habrastorage.org/webt/zu/sd/up/zusdupegzydvhacdl-wzmwytrbq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップインデックスを「グーグル」した場合、回答の90％はどういうわけかOracle DBに関連しています。しかし、DBMSの残りの部分もおそらくこのようなすばらしいものをサポートしますよね？あんまり。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
主な容疑者のリストを見てみましょう。</font></font><br>
<img src="https://habrastorage.org/webt/-k/xy/zn/-kxyznvnwct15_2jzp3rulwotic.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQLはまだビットマップインデックスをサポートしていませんが、このオプションを追加する提案がある提案があります（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://dev.mysql.com/worklog/task/?id=1524</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PostgreSQLはビットマップインデックスをサポートしていませんが、単純なビットマップとビット操作を使用して、他のいくつかのインデックスにわたる検索結果を結合しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tarantoolにはビットセットインデックスがあり、簡単な検索をサポートしています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Redisには単純なビットフィールド</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（https://redis.io/commands/bitfield</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）があり、それらを検索する機能はありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MongoDBはまだビットマップインデックスをサポートしていませんが、このオプションを追加する提案がある提案もあります</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。https：</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
//jira.mongodb.org/browse/SERVER-1723 Elasticsearchはビットマップを内部で使用し</font><font style="vertical-align: inherit;">ます</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（https://www.elastic.co/blog/frame） -of-reference-and-roaring-bitmaps</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<br>
<img src="https://habrastorage.org/webt/kv/rd/zo/kvrdzoime8mqrf1vtl_iqwgjaea.jpeg"><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">しかし、新しい隣人、ピロサが家に現れました。</font><font style="vertical-align: inherit;">これは、Goで記述された新しい非リレーショナルデータベースです。</font><font style="vertical-align: inherit;">ビットマップインデックスのみが含まれ、すべてに基づいています。</font><font style="vertical-align: inherit;">私たちは彼女について少し後で話します。</font></font><br>
</li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">実装を開始</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、ビットマップインデックスがほとんど使用されないのはなぜですか？この質問に答える前に、Goでの非常に単純なビットマップインデックスの実装について説明します。</font></font><br>
<img src="https://habrastorage.org/webt/db/ua/jt/dbuajtkgolu346p22gzcufwsll4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップは基本的に単なるデータの断片です。 Goでは、バイトスライスを使用してみましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
レストランの特性ごとに1つのビットマップがあり、ビットマップの各ビットは、特定のレストランにこのプロパティがあるかどうかを示します。</font></font><br>
<img src="https://habrastorage.org/webt/j2/az/1i/j2az1inrzzj0rcdg9dajst7afhc.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つの補助関数が必要になります。 1つは、ランダムデータでビットマップを埋めるために使用されます。ランダムですが、レストランにはすべてのプロパティがあるという一定の確率があります。例えば、モスクワにはテーブルを予約できないレストランはほとんどないと思いますが、約20％のレストランが菜食主義者に適しているようです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目の関数は、ビットマップをレストランのリストに変換します。</font></font><br>
<img src="https://habrastorage.org/webt/aj/d7/vg/ajd7vgvjt7_2ssgiw7hh2jue9vu.jpeg"><br>
<img src="https://habrastorage.org/webt/gl/nv/wv/glnvwvokatnkyd08nxslinseoyc.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
「ベランダがあり、テーブルを予約できる安価なレストランを見せてください」という要求に答えるには、NOTとANDの2つのビット演算が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
より複雑なAND NOT演算を使用することで、コードを少し簡略化できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの操作ごとに機能があります。それらの両方がスライスを通過し、それぞれから対応する要素を取り出し、それらをビット演算と組み合わせ、結果を結果のスライスに入れます。</font></font><br>
<img src="https://habrastorage.org/webt/_f/-m/wa/_f-mwakzpgavqkr_a6m3lzzo_gy.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、ビットマップと関数を使用して検索クエリに応答できるようになりました。</font></font><br>
<img src="https://habrastorage.org/webt/rp/tn/uq/rptnuqmitwu5f-ag2w4tquglhca.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
関数は非常に単純であり、関数が呼び出されるたびに新しい結果のスライスを返さなかったため、パフォーマンスはそれほど高くありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pprofで少しプロファイルを作成したところ、Goコンパイラーが非常に単純であるが非常に重要な最適化である関数のインライン化を見落としていることに気付きました。</font></font><br>
<img src="https://habrastorage.org/webt/4s/6j/vs/4s6jvsys1nnmrpxnzpyfed8myq8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際のところ、Goコンパイラーはスライスに沿ったループをひどく恐れており、ループを含むインライン関数を断固として拒否しています。</font></font><br>
<img src="https://habrastorage.org/webt/ok/e_/th/oke_thx54xevzrxjqc6fmqx8w5y.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、私は恐れていません。古き良き時代のように、ループの代わりにgotoを使用することでコンパイラーをだますことができます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/bx/xo/ea/bxxoeatd8s3mby2jyemkac3jyfg.jpeg"><br>
<img src="https://habrastorage.org/webt/5k/fm/2l/5kfm2let9qh2ynkerqdkkd1thao.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そして、ご覧のとおり、コンパイラーは喜んで関数をインライン化します！その結果、約2マイクロ秒を節約できました。悪くない！</font></font><br>
<br>
<img src="https://habrastorage.org/webt/or/tx/lw/ortxlwhbagw4oafvij-sngkxbsm.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2番目のボトルネックは、アセンブラーの出力を注意深く見ると簡単にわかります。</font><font style="vertical-align: inherit;">コンパイラーは、最もホットなループのすぐ内側にスライスの境界のチェックを追加しました。</font><font style="vertical-align: inherit;">実際のところ、Goは安全な言語であり、コンパイラーは私の3つの引数（3つのスライス）のサイズが異なることを恐れています。</font><font style="vertical-align: inherit;">結局のところ、いわゆるバッファオーバーフローが発生する理論的な可能性があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてのスライスが同じサイズであることを彼に示すことにより、コンパイラーを安心させましょう。</font><font style="vertical-align: inherit;">これを行うには、関数の先頭に簡単なチェックを追加します。</font></font><br>
<img src="https://habrastorage.org/webt/rq/v7/en/rqv7enj1mgqnsrgwnlkwscks0ri.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを見て、コンパイラはテストをうまくスキップし、最終的にさらに500ナノ秒節約されます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大きなバッチ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、単純な実装からある程度のパフォーマンスを引き出すことに成功しましたが、実際には、この結果は現在のハードウェアで可能なものよりもはるかに悪いものです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちがしているのは、基本的なビット単位の演算であり、プロセッサーはそれらを非常に効率的に実行します。</font><font style="vertical-align: inherit;">しかし、残念ながら、私たちはプロセッサーに非常に小さな作業を「供給」します。</font><font style="vertical-align: inherit;">私たちの関数は、バイト単位の操作を実行します。</font><font style="vertical-align: inherit;">UInt64スライスを使用して8バイトのチャンクで動作するようにコードを非常に簡単に調整できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-w/vl/rd/-wvlrdx24mrcvy_vovvjeouaxjs.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、この小さな変更により、バッチが8倍に増加したため、プログラムが8倍高速化されました。</font><font style="vertical-align: inherit;">ゲインは線形であると言えます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/tf/ej/nk/tfejnkdoftg8gs7vfpgrmbxfejq.jpeg"><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アセンブラの実装</font></font></h2><br>
<img src="https://habrastorage.org/webt/ii/3d/du/ii3ddup__yc_-dhzsuivs6fcpeu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、これで終わりではありません。私たちのプロセッサは、16、32、さらには64バイトの断片で動作できます。このような「ワイド」操作は単一命令複数データ（SIMD、1つの命令、大量のデータ）と呼ばれ、そのような操作を使用するようにコードを変換するプロセスはベクトル化と呼ばれます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、Goコンパイラーはベクトル化の優れた学生とはかけ離れています。現在、Goでコードをベクトル化する唯一の方法は、Goアセンブラを使用して手動でこれらの操作を実行および配置することです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qv/dr/ap/qvdrapgfhvfhrei2ies1w2vtcds.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブラGoは奇妙な獣です。アセンブラーは、作成しているコンピューターのアーキテクチャーに強く結びついているものであることはおそらくご存じでしょうが、Goではそうではありません。 Goアセンブラーは、IRL（中間表現言語）または中間言語に似ています。実質的にプラットフォームに依存しません。 Rob Pikeは、</font><font style="vertical-align: inherit;">数年前にデンバーのGopherConでこのテーマについて</font><font style="vertical-align: inherit;">優れた</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プレゼンテーションを行い</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これに加えて、Goは一般的に認められているAT＆TおよびIntelフォーマットとは異なる、珍しいPlan 9フォーマットを使用しています。</font></font><br>
<img src="https://habrastorage.org/webt/kp/8r/px/kp8rpxg_xmp3faph2ysefnjavxk.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goアセンブラを手動で作成することは、最も楽しいアクティビティではないと言っても安全です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、幸いにも、Goアセンブラーを作成するのに役立つ2つの高水準ツール、PeachPyとavoがすでにあります。どちらのユーティリティも、PythonとGoでそれぞれ記述された上位レベルのコードからGoアセンブラを生成します。</font></font><br>
<img src="https://habrastorage.org/webt/mf/qz/zb/mfqzzbyuqtrdk06iiiw4ufe5eou.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのユーティリティは、レジスタの割り当て、書き込みサイクルなどを簡素化し、一般的にGoでアセンブラプログラミングの世界に入るプロセスを簡素化します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちはavoを使用するので、プログラムはほとんど通常のGoプログラムになります。</font></font><br>
<img src="https://habrastorage.org/webt/qd/ij/l2/qdijl2s77ub_c1om5budqbudjx4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これはavoプログラムの最も単純な例です。</font><font style="vertical-align: inherit;">内部にAdd（）関数を定義するmain（）関数があり、その意味は2つの数値を加算することです。</font><font style="vertical-align: inherit;">名前でパラメーターを取得し、フリーで適切なプロセッサーレジスターの1つを取得するための補助関数があります。</font><font style="vertical-align: inherit;">ADDQに示されているように、各プロセッサー操作にはavoに対応する関数があります。</font><font style="vertical-align: inherit;">最後に、結果の値を格納するヘルパー関数が表示されます。</font></font><br>
<img src="https://habrastorage.org/webt/8q/ze/6_/8qze6_requgfy9fimtn5tiirtn8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
go generateを呼び出すと、プログラムがavoで実行され、最終的に2つのファイルが生成されます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結果のGoアセンブラーコードを含むadd.s;</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2つの世界を接続するための関数ヘッダーを備えたstub.go：Goとアセンブラー。</font></font><br>
</li>
</ul><br>
<img src="https://habrastorage.org/webt/mz/bk/pi/mzbkpixqbe5kygtl9vphoeak39w.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
avoが何をどのように実行するかを見てきましたので、関数を見てみましょう。関数のスカラーバージョンとベクトル（SIMD）バージョンの両方を実装しました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、スカラーバージョンを確認します。</font></font><br>
<img src="https://habrastorage.org/webt/9v/1a/gj/9v1agjswpb-wnfoyqbb1x0rb6vo.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
前の例と同様に、自由で正しい汎用レジスタを提供するように求められます。引数のオフセットとサイズを計算する必要はありません。このすべてのavoは私たちのために行います。</font></font><br>
<img src="https://habrastorage.org/webt/rt/yj/ju/rtyjjuzuc4ycx2au4tqohzaxsby.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以前は、ラベルとgoto（またはジャンプ）を使用してパフォーマンスを改善し、Goコンパイラーを騙していましたが、現在は最初からそれを行っています。実際、ループはより上位の概念です。アセンブラでは、ラベルとジャンプのみがあります。</font></font><br>
<img src="https://habrastorage.org/webt/c4/gk/ww/c4gkwwdt0to9yorwoya2jurfrj8.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残りのコードはすでによく理解されているはずです。ラベルとジャンプでループをエミュレートし、2つのスライスからデータの一部を取り、それらをビット演算（この場合はANDではない）と組み合わせて、結果を結果のスライスに入れます。すべて。</font></font><br>
<img src="https://habrastorage.org/webt/vw/gj/fg/vwgjfg2tkeaxec2n7qkvgneqpve.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これが、最終的なアセンブラーコードです。オフセットとサイズを計算したり（緑色で強調表示）、使用するレジスターを追跡する必要はありません（赤色で強調表示）。</font></font><br>
<img src="https://habrastorage.org/webt/of/sc/4v/ofsc4vbjkv2imcihypew4_japuo.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アセンブラーでの実装のパフォーマンスをGoでの最良の実装のパフォーマンスと比較すると、同じであることがわかります。そして、これは予想されることです。結局のところ、特別なことは何もしませんでした。Goコンパイラーが行うことを再現しただけです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、アセンブラーで作成された関数をコンパイラーにインライン化させることはできません。現在、Goコンパイラーにはこの機能はありませんが、追加する要求はかなり前からありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのため、アセンブラの小さな関数から利益を得ることが不可能です。大きな関数を書くか、新しいmath / bitsパッケージを使うか、アセンブラ側をバイパスする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、関数のベクトルバージョンを見てみましょう。</font></font><br>
<img src="https://habrastorage.org/webt/ac/qe/bs/acqebsweofbwzmvcwt-vro9yx4m.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例では、AVX2を使用することを決定したため、32バイトのチャンクで機能する操作を使用します。コード構造はスカラーオプションと非常によく似ています。パラメーターの読み込み、無料の汎用レジスターなどを提供してください。</font></font><br>
<img src="https://habrastorage.org/webt/ef/5g/wa/ef5gwafb0stn7wunw8ryjcjyt_k.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
革新の1つは、より広いベクトル演算が特別なワイドレジスタを使用することです。 32バイトのチャンクの場合、これらは接頭辞Yを持つレジスターです。そのため、コードにYMM（）関数が表示されます。 64ビットの部分でAVX-512を使用した場合、プレフィックスはZになります</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。2番目の革新は、ループ展開と呼ばれる最適化を使用することを決定したことです。サイクルの始めにジャンプします。この最適化により、コード内のブランチ（ブランチ）の数が減り、使用可能な空きレジスターの数によって制限されます。</font></font><br>
<img src="https://habrastorage.org/webt/vj/1c/nd/vj1cndpc9uqyrzgfqrld4vfda5o.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
さて、パフォーマンスはどうですか？彼女は美しい！ Goの最良のソリューションと比較して、約7倍の加速を得ました。印象的でしょ？</font></font><br>
<img src="https://habrastorage.org/webt/d_/9b/ag/d_9bag_w0set74ryc4j5oqm5slm.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、この実装でさえ、クエリプランナーのAVX-512、プリフェッチ、またはJIT（ジャストインタイムコンパイラー）を使用して、潜在的に加速される可能性があります。</font><font style="vertical-align: inherit;">しかし、これは確かに別のレポートのトピックです。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ビットマップインデックスの問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goビットマップインデックスの単純な実装とはるかに生産性の高いアセンブラーを見てきたので、ビットマップインデックスがほとんど使用されない理由について最後に説明します。</font></font><br>
<img src="https://habrastorage.org/webt/qs/yf/as/qsyfasqoxbr_heaolyqpd9ms7hk.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
古い科学論文ではビットマップインデックスの3つの問題が言及されていますが、新しい科学論文とそれらはもはや関連性がないと主張します。</font><font style="vertical-align: inherit;">これらの問題のそれぞれを深く掘り下げることはしませんが、表面的にはそれらを考慮します。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カーディナリティの問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、ビットマップインデックスはカーディナリティが低いフィールド、つまり値が少ないフィールド（たとえば、性別や目の色）にのみ適していると言われています。その理由は、そのようなフィールドの通常の表現（値ごとに1ビット）であるためです。カーディナリティが高い場合、必要なスペースが大きくなり、さらに、これらのビットマップインデックスが弱く（まれに）埋められます。</font></font><br>
<img src="https://habrastorage.org/webt/zf/na/lt/zfnaltbokwrnweeiwtighgvq5cm.jpeg"><br>
<img src="https://habrastorage.org/webt/sa/p4/mw/sap4mwjq8sslx6_zgdanmn8fcwu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
数値を表すために使用する標準的な表現など、別の表現を使用できる場合もあります。しかし、すべてを変えたのは圧縮アルゴリズムの出現でした。過去数十年にわたり、科学者と研究者はビットマップ用の多数の圧縮アルゴリズムを考え出しました。主な利点は、ビット操作のためにビットマップを拡張する必要がないことです。圧縮されたビットマップに対して直接ビット操作を実行できます。</font></font><br>
<img src="https://habrastorage.org/webt/mv/56/bt/mv56btwi703wsb0nya7ofor5lew.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最近、うなり声のビットマップなどのハイブリッドアプローチが登場し始めています。それらは同時に、ビットマップの3つの異なる表現（実際にはビットマップ、配列、いわゆるビットラン）を使用し、それらのバランスをとってパフォーマンスを最大化し、メモリ消費を最小限に抑えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も人気のあるアプリケーションで、うなり声のビットマップに会うことができます。 Goには4つ以上の実装を含め、さまざまなプログラミング言語の実装がすでに多数あります。</font></font><br>
<img src="https://habrastorage.org/webt/af/xy/wy/afxywyhipsvsfla4tuot6ir0tei.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
大きなカーディナリティに対処するのに役立つ別のアプローチは、ビニングと呼ばれます。</font><font style="vertical-align: inherit;">人の成長を表すフィールドがあるとします。</font><font style="vertical-align: inherit;">成長は浮動小数点数ですが、私たち人間はそのように考えていません。</font><font style="vertical-align: inherit;">私たちにとって、185.2 cmと185.3 cmの成長に違いはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様の値を1 cm以内のグループにグループ化できることが</font><font style="vertical-align: inherit;">わかります。</font><font style="vertical-align: inherit;">また</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、50 cm未満で250 cmを超える人がほとんどいないこともわかっている場合ならば、実際には、カーディナリティーが無限のフィールドをカーディナリティーが約200のフィールドに変えることができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もちろん、必要に応じて、後で追加のフィルタリングを行うことができます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高スループットの問題</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップインデックスの次の問題は、ビットマップインデックスの更新に非常にコストがかかる可能性があることです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データベースは、潜在的に数百の他のクエリがこのデータを検索するときに、データを更新できるようにする必要があります。データへの同時アクセスの問題やその他の共有の問題を回避するためにロックが必要です。そして、1つの大きなロックがある場合、問題があります。このロックがボトルネックになると、ロックの競合です。</font></font><br>
<img src="https://habrastorage.org/webt/xg/ju/xl/xgjuxll8jn3btfxhniispsepbmw.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この問題は、シャーディングするか、バージョン付きインデックスを使用することで解決または回避できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
シャーディングはシンプルでよく知られているものです。他のデータをシャーディングするのと同じように、ビットマップインデックスをシャーディングできます。 1つの大きなロックの代わりに、一連の小さなロックを取得して、ロックの競合を解消します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
問題を解決する2番目の方法は、バージョン対応インデックスを使用することです。</font><font style="vertical-align: inherit;">検索または読み取りに使用するインデックスのコピーを1つ、書き込みまたは更新に1つ使用できます。</font><font style="vertical-align: inherit;">そして、特定の期間に1回（たとえば、100ミリ秒または500ミリ秒ごとに）、それらを複製して入れ替えます。</font><font style="vertical-align: inherit;">もちろん、このアプローチは、アプリケーションが少し遅れた検索インデックスで動作できる場合にのみ適用できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらの2つのアプローチは同時に使用できます。シャーディングされたバージョン付きインデックスを使用できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">より複雑なクエリ</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ビットマップインデックスに関する最後の問題は、言われているように、「中間」クエリなど、より複雑なタイプのクエリにはあまり適していないことです。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
実際、考えてみると、ANDやORなどのビット単位の演算は、「1泊200ドルから300ドルの宿泊料金のホテルを見せて」といったリクエストにはあまり適していません。</font></font><br>
<img src="https://habrastorage.org/webt/fq/qy/en/fqqyeneeggnmx0iccptaz8eygmm.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
素朴で非常に不合理な解決策は、各ドルの値の結果を取得し、ビットごとのOR演算と組み合わせることです。</font></font><br>
<img src="https://habrastorage.org/webt/jr/du/ey/jrdueypemf_a69m1wikbjpialze.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
もう少し正しい解決策は、グループ化を使用することです。たとえば、50ドルのグループ。これにより、プロセスが50倍高速化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
しかし、このタイプのクエリ用に特別に作成されたビューを使用すると、問題も簡単に解決されます。科学論文では、範囲エンコードされたビットマップと呼ばれています。</font></font><br>
<img src="https://habrastorage.org/webt/vq/hx/a5/vqhxa5jyy4w9_e5lurbjhntabie.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この表現では、任意の値（たとえば、200）に1ビットを設定するだけでなく、この値とそれ以上のすべての値を設定します。 200以上。 300の場合も同様です。300以上。等。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このビューを使用すると、インデックスを2回だけ通過することで、この種の検索クエリに応答できます。まず、部屋の費用が300ドル以下のホテルのリストを取得し、次に、部屋の費用が199ドル以下のホテルを除外します。できました。</font></font><br>
<img src="https://habrastorage.org/webt/wh/bc/hs/whbchsdcr0qrupa6jhu9fcpufke.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
驚かれることでしょうが、ビットマップインデックスを使用してgeoクエリでさえ可能です。</font><font style="vertical-align: inherit;">トリックは、幾何学的形状で座標を囲む地理ビューを使用することです。</font><font style="vertical-align: inherit;">たとえば、GoogleのS2です。</font><font style="vertical-align: inherit;">図は、番号を付けることができる3つ以上の交差する線の形で表すことができる必要があります。</font><font style="vertical-align: inherit;">このようにして、geoリクエストを（これらの番号付き行に沿って）いくつかの「中間」リクエストに変換できます。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既製のソリューション</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私はあなたに少し興味があって、あなたの武器に別の便利なツールがあることを願っています。</font><font style="vertical-align: inherit;">このようなことをする必要がある場合は、どの方法を見ればよいかわかります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ただし、ビットマップインデックスを最初から作成する時間、忍耐力、リソースがあるとは限りません。</font><font style="vertical-align: inherit;">たとえば、SIMDを使用して特に高度な。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
幸いなことに、いくつかの既製のソリューションが役立ちます。</font></font><br>
<img src="https://habrastorage.org/webt/em/cg/km/emcgkmutgbpdj_arrdnfoub6lt0.jpeg"><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">とどろくビットマップ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第一に、私がすでに話した同じ活発なビットマップライブラリがあります。</font><font style="vertical-align: inherit;">これには、完全なビットマップインデックスを作成するために必要なすべてのコンテナーとビット操作が含まれています。</font></font><br>
<img src="https://habrastorage.org/webt/k3/mv/yh/k3mvyhvcdb8sh7g-aejhgqeob6c.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
残念ながら、現時点では、Go実装のいずれもSIMDを使用していません。つまり、たとえば、Go実装はC実装よりも生産性が低くなっています。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ピローザ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
役立つもう1つの製品はPilosa DBMSで、実際にはビットマップインデックスしかありません。これは比較的新しいソリューションですが、素晴らしいスピードでハートを獲得しています。</font></font><br>
<img src="https://habrastorage.org/webt/uw/gs/56/uwgs563qvexzg27dd5x15zbzlto.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pilosaはそれ自体の中でうなり声のビットマップを使用し、それらを使用する機会を提供し、グループ化、範囲エンコードされたビットマップ、フィールドの概念など、上で述べたすべてのものを簡略化して説明します</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。Pilosaを使用して答える例を簡単に見てみましょうすでにおなじみの質問です。</font></font><br>
<img src="https://habrastorage.org/webt/8d/jm/kn/8djmknf2jltazwrepy_ia4j7k_4.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この例は、前に見たものとよく似ています。 Pilosaサーバーのクライアントを作成し、インデックスと必須フィールドを作成してから、フィールドに確率のランダムデータを入力し、最後に、使い慣れたリクエストを実行します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その後、「高価」フィールドでNOTを使用してから、結果（またはAND）を「テラス」フィールドおよび「予約」フィールドと交差させます。</font><font style="vertical-align: inherit;">そして最後に、最終的な結果が得られます。</font></font><br>
<img src="https://habrastorage.org/webt/bg/bu/oi/bgbuoi1v8n8vus4einuldy4u8zu.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MySQLやPostgreSQLのようなDBMSの近い将来、この新しいタイプのインデックス（ビットマップインデックス）も登場することを願っています。</font></font><br>
<img src="https://habrastorage.org/webt/ez/h4/g1/ezh4g1de2gpbozwi8-yubjvhpp4.jpeg"><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h2><br>
<img src="https://habrastorage.org/webt/tp/0f/3v/tp0f3vktlhcltdxbu7fatn7qqhq.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
あなたがまだ眠りに落ちていないなら、ありがとう。</font><font style="vertical-align: inherit;">時間が限られているため、多くのトピックに触れざるを得ませんでしたが、レポートが有用で、おそらくはやる気を起こさせてくれることを願っています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
現在必要がない場合でも、ビットマップインデックスについて知っておくと便利です。</font><font style="vertical-align: inherit;">それらを引き出しの別のツールにします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Goのさまざまなパフォーマンストリックと、Goコンパイラーがうまく機能しないものについて説明しました。</font><font style="vertical-align: inherit;">しかし、これはすべてのGoプログラマーが知るのに絶対に役立ちます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が伝えたかったのはそれだけです。</font><font style="vertical-align: inherit;">感謝！</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja451928/index.html">AMPページでウェブ解析を設定する方法</a></li>
<li><a href="../ja451930/index.html">階段の照明の自動化</a></li>
<li><a href="../ja451932/index.html">PHDays 9：安全開発セクションへようこそ</a></li>
<li><a href="../ja451934/index.html">アレクサンダーラムデン：「鉄のどの部分にも特徴がある」</a></li>
<li><a href="../ja451936/index.html">UCブラウザーの脆弱性を探す</a></li>
<li><a href="../ja451942/index.html">アフリカの無毛症が何千人もの命を救う方法</a></li>
<li><a href="../ja451944/index.html">2019：DEXの年（分散型取引所）</a></li>
<li><a href="../ja451948/index.html">3つのカートリッジのストーリー</a></li>
<li><a href="../ja451950/index.html">仮想発電所。「グリーン」エネルギー源を管理することは可能ですか？</a></li>
<li><a href="../ja451954/index.html">より多くの秘密電報</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>