<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛎ 👎 👌🏽 夜のレッスン：構文の強調表示を書く 🐟 ▪️ 🧒🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近、コードの強調表示を内側からどのように配置するかに興味を持ちました。最初は、構文ツリー、再帰など、すべてが非常に複雑であるように見えました。しかし、よく調べてみると、ここには難しいことは何もないことがわかりました。すべての作業は1回のサイクルで行うことができます。さらに、結果のスクリプトでは正規...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>夜のレッスン：構文の強調表示を書く</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482884/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近、コードの強調表示を内側からどのように配置するかに興味を持ちました。</font><font style="vertical-align: inherit;">最初は、構文ツリー、再帰など、すべてが非常に複雑であるように見えました。</font><font style="vertical-align: inherit;">しかし、よく調べてみると、ここには難しいことは何もないことがわかりました。</font><font style="vertical-align: inherit;">すべての作業は1回のサイクルで行うことができます。さらに、結果のスクリプトでは正規表現がほとんど使用されません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デモページ：</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScriptコードハイライター</font></font></a><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本旨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コードのどの部分にいるかに関する情報を格納</font><font style="vertical-align: inherit;">
する</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">変数を宣言</font><font style="vertical-align: inherit;">します。</font><font style="vertical-align: inherit;">たとえば、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が1の場合、これは単一引用符で囲まれた文字列の中にいることを意味します。</font><font style="vertical-align: inherit;">スクリプトは終了の引用を待ち、それ以外はすべて無視します。</font><font style="vertical-align: inherit;">コメント、正規表現、その他の要素を強調表示する場合も同様で、それぞれに独自の</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">値があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">したがって、異なる開始文字と終了文字は競合しません。</font><font style="vertical-align: inherit;">つまり、次のようなコードです。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">let</span> a = <span class="hljs-string">'"\'"'</span>;</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
つまり、そのような場合が最も困難を引き起こしました。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仕事の始まり</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
状態変数の可能な値、およびコードのこの部分またはその部分が色付けされる色、およびJavaScriptキーワードのリスト（これも強調表示されます）を決定します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const状態= {...</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">const</span> states = {
	<span class="hljs-attr">NONE</span>           : <span class="hljs-number">0</span>,
	<span class="hljs-attr">SINGLE_QUOTE</span>   : <span class="hljs-number">1</span>, <span class="hljs-comment">// 'string'</span>
	<span class="hljs-attr">DOUBLE_QUOTE</span>   : <span class="hljs-number">2</span>, <span class="hljs-comment">// "string"</span>
	<span class="hljs-attr">ML_QUOTE</span>       : <span class="hljs-number">3</span>, <span class="hljs-comment">// `string`</span>
	<span class="hljs-attr">REGEX_LITERAL</span>  : <span class="hljs-number">4</span>, <span class="hljs-comment">// /regex/</span>
	<span class="hljs-attr">SL_COMMENT</span>     : <span class="hljs-number">5</span>, <span class="hljs-comment">// // single line comment</span>
	<span class="hljs-attr">ML_COMMENT</span>     : <span class="hljs-number">6</span>, <span class="hljs-comment">// /* multiline comment */</span>
	<span class="hljs-attr">NUMBER_LITERAL</span> : <span class="hljs-number">7</span>, <span class="hljs-comment">// 123</span>
	<span class="hljs-attr">KEYWORD</span>        : <span class="hljs-number">8</span> <span class="hljs-comment">// function, var etc.</span><font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> colors = {
	<span class="hljs-attr">NONE</span>           : <span class="hljs-string">'#000'</span>,
	<span class="hljs-attr">SINGLE_QUOTE</span>   : <span class="hljs-string">'#aaa'</span>, <span class="hljs-comment">// 'string'</span>
	<span class="hljs-attr">DOUBLE_QUOTE</span>   : <span class="hljs-string">'#aaa'</span>, <span class="hljs-comment">// "string"</span>
	<span class="hljs-attr">ML_QUOTE</span>       : <span class="hljs-string">'#aaa'</span>, <span class="hljs-comment">// `string`</span>
	<span class="hljs-attr">REGEX_LITERAL</span>  : <span class="hljs-string">'#707'</span>, <span class="hljs-comment">// /regex/</span>
	<span class="hljs-attr">SL_COMMENT</span>     : <span class="hljs-string">'#0a0'</span>, <span class="hljs-comment">// // single line comment</span>
	<span class="hljs-attr">ML_COMMENT</span>     : <span class="hljs-string">'#0a0'</span>, <span class="hljs-comment">// /* multiline comment */</span>
	<span class="hljs-attr">NUMBER_LITERAL</span> : <span class="hljs-string">'#a00'</span>, <span class="hljs-comment">// 123</span>
	<span class="hljs-attr">KEYWORD</span>        : <span class="hljs-string">'#00a'</span>, <span class="hljs-comment">// function, var etc.</span>
	<span class="hljs-attr">OPERATOR</span>       : <span class="hljs-string">'#07f'</span> <span class="hljs-comment">// null, true etc.</span><font></font>
};<font></font>
<font></font>
<span class="hljs-keyword">const</span> keywords = <span class="hljs-string">'async|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|of|package|private|protected|public|return|set|static|super|switch|throw|try|typeof|var|void|while|with|yield|catch|finally'</span>.split(<span class="hljs-string">'|'</span>);
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、コードを含む行を受け取り、強調表示されたコードを含む完成したHTMLを返す関数を作成します。</font><font style="vertical-align: inherit;">強調表示のために、文字は、変数colorで指定された</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">色</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">でSPANにラップされます</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この関数には1つのサイクルのみがあり、各文字を分析し、必要に応じて開始/終了SPANを追加します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlight</span>(<span class="hljs-params">code</span>) </span>{
	<span class="hljs-keyword">let</span> output = <span class="hljs-string">''</span>;
	<span class="hljs-keyword">let</span> state = states.NONE;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; code.length; i++) {
		<span class="hljs-keyword">let</span> char = code[i], prev = code[i<span class="hljs-number">-1</span>], next = code[i+<span class="hljs-number">1</span>];
		<span class="hljs-comment">//    </span><font></font>
	}<font></font>
	<span class="hljs-keyword">return</span> output;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、コメントを強調表示します。単一行と複数行です。</font><font style="vertical-align: inherit;">現在および次の文字がスラッシュであり、それらが行の内側にない場合（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">state</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は0、つまり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">states.NONE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）、これはコメントの始まりです。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">変更</font><font style="vertical-align: inherit;">し、目的の色でSPANを開きます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'/'</span> &amp;&amp; next == <span class="hljs-string">'/'</span>) {<font></font>
	state = states.SL_COMMENT;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.SL_COMMENT + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br>
<i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">次のチェックが機能せず、競合が発生しないように、</font><i><font style="vertical-align: inherit;">continueが</font></i><font style="vertical-align: inherit;">必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、行の終わりを待ちます。現在の文字が改行であり、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態が</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1行のコメントの場合、SPANを閉じて</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をゼロに</font><font style="vertical-align: inherit;">変更</font><font style="vertical-align: inherit;">します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.SL_COMMENT &amp;&amp; char == <span class="hljs-string">'\n'</span>) {<font></font>
	state = states.NONE;<font></font>
	output += char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
同様に、複数行のコメントを探しています。アルゴリズムはまったく同じですが、探している文字だけが異なります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'/'</span> &amp;&amp; next == <span class="hljs-string">'*'</span>) {<font></font>
	state = states.ML_COMMENT;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.ML_COMMENT + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (state == states.ML_COMMENT &amp;&amp; char == <span class="hljs-string">'/'</span> &amp;&amp; prev == <span class="hljs-string">'*'</span>) {<font></font>
	state = states.NONE;<font></font>
	output += char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
行の強調表示は同様の方法で行われますが、終了引用符がバックスラッシュでエスケープできること、つまり終了引用符がすでに終了スラッシュでなくなっていることを考慮する必要があります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'\''</span>) {<font></font>
	state = states.SINGLE_QUOTE;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.SINGLE_QUOTE + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (state == states.SINGLE_QUOTE &amp;&amp; char == <span class="hljs-string">'\''</span> &amp;&amp; prev != <span class="hljs-string">'\\'</span>) {<font></font>
	state = states.NONE;<font></font>
	output += char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コードはすでに上に示したものと似ていますが、引用符の前にバックスラッシュがあった場合は、行の終わりを登録しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
二重引用符で囲まれた文字列の定義はまったく同じ方法で行われ、詳細に解析しても意味がありません。</font><font style="vertical-align: inherit;">写真を完成させるために、スポイラーの下に配置します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if（state == states.NONE &amp;&amp; char == '' ''）{...</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'"'</span>) {<font></font>
	state = states.DOUBLE_QUOTE;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.DOUBLE_QUOTE + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (state == states.DOUBLE_QUOTE &amp;&amp; char == <span class="hljs-string">'"'</span> &amp;&amp; prev != <span class="hljs-string">'\\'</span>) {<font></font>
	state = states.NONE;<font></font>
	output += char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'`'</span>) {<font></font>
	state = states.ML_QUOTE;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.ML_QUOTE + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (state == states.ML_QUOTE &amp;&amp; char == <span class="hljs-string">'`'</span>  &amp;&amp; prev != <span class="hljs-string">'\\'</span>) {<font></font>
	state = states.NONE;<font></font>
	output += char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除算記号と混同されやすい正規表現リテラルは、個別に検討する価値があります。</font><font style="vertical-align: inherit;">記事の最後でこの問題に戻りますが、今のところ、文字列と同じように正規表現を使用しています。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'/'</span>) {<font></font>
	state = states.REGEX_LITERAL;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.REGEX_LITERAL + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (state == states.REGEX_LITERAL &amp;&amp; char == <span class="hljs-string">'/'</span> &amp;&amp; prev != <span class="hljs-string">'\\'</span>) {<font></font>
	state = states.NONE;<font></font>
	output += char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、リテラルの最初と最後が1〜2文字で決定できる単純なケースを終了します。</font><font style="vertical-align: inherit;">数字の強調表示を始めましょう。ご存知のように、数字は常に数字で始まりますが、構成には文字を</font><i><font style="vertical-align: inherit;">含める</font></i><font style="vertical-align: inherit;">ことができます（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xFF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">123n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; <span class="hljs-regexp">/[0-9]/</span>.test(char) &amp;&amp; !<span class="hljs-regexp">/[0-9a-z$_]/i</span>.test(prev)) {<font></font>
	state = states.NUMBER_LITERAL;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.NUMBER_LITERAL + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}<font></font>
<span class="hljs-keyword">if</span> (state == states.NUMBER_LITERAL &amp;&amp; !<span class="hljs-regexp">/[0-9a-fnx]/i</span>.test(char)) {<font></font>
	state = states.NONE;<font></font>
	output += <span class="hljs-string">'&lt;/span&gt;'</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、数字の始まりを探しています。前の文字は数字や文字であってはなりません。そうでない場合、変数名の数字が強調表示されます。</font><font style="vertical-align: inherit;">現在の文字が数字のリテラルに含めることができる数字または文字ではない場合は、すぐにSPANを閉じて</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状態を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ゼロに</font><font style="vertical-align: inherit;">設定</font><i><font style="vertical-align: inherit;">し</font></i><font style="vertical-align: inherit;">ます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可能なすべてのタイプのリテラルが強調表示され、キーワードの検索は残ります。</font><font style="vertical-align: inherit;">これには、先​​読みして現在の文字がキーワードの開始かどうかを判断するネストされたループが必要です。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; !<span class="hljs-regexp">/[a-z0-9$_]/i</span>.test(prev)) {
	<span class="hljs-keyword">let</span> word = <span class="hljs-string">''</span>, j = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (code[i + j] &amp;&amp; <span class="hljs-regexp">/[a-z]/i</span>.test(code[i + j])) {<font></font>
		word += code[i + j];<font></font>
		j++;<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> (keywords.includes(word)) {<font></font>
			state = states.KEYWORD;<font></font>
			output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.KEYWORD + <span class="hljs-string">'"&gt;'</span>;<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここでは、前の文字を変数名に含めることはできません。それ以外の場合</font><i><font style="vertical-align: inherit;">は</font></i><font style="vertical-align: inherit;">、キーワード</font><font style="vertical-align: inherit;">が</font><font style="vertical-align: inherit;">ワード</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アウトレットで</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">強調表示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">さ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">れるため、その</font><font style="vertical-align: inherit;">ままにします</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">次に、ネストされたループは、アルファベット以外の文字に遭遇するまで、可能な限り長い単語を収集します。</font><font style="vertical-align: inherit;">受信した単語が</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keywords</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配列</font><font style="vertical-align: inherit;">にある場合は、SPANを開き、単語を強調表示します。</font><font style="vertical-align: inherit;">アルファベット以外の文字が検出されるとすぐに、これは単語の終わりを意味します。したがって、SPANを閉じます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.KEYWORD &amp;&amp; !<span class="hljs-regexp">/[a-z]/i</span>.test(char)) {<font></font>
	state = states.NONE;<font></font>
	output += <span class="hljs-string">'&lt;/span&gt;'</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最も単純なことは残ります。演算子の強調表示です。ここでは、演算子で発生する可能性のある文字のセットと簡単に比較できます。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; <span class="hljs-string">'+-/*=&amp;|%!&lt;&gt;?:'</span>.indexOf(char) != <span class="hljs-number">-1</span>) {<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.OPERATOR + <span class="hljs-string">'"&gt;'</span> + char + <span class="hljs-string">'&lt;/span&gt;'</span>;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ループの最後で、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">継続</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する条件がどれもトリガーされない場合は</font><font style="vertical-align: inherit;">、結果の変数に現在の文字を追加するだけです。</font><font style="vertical-align: inherit;">リテラルまたはキーワードの開始または終了が発生すると、SPANを色で開閉します。</font><font style="vertical-align: inherit;">他のすべての場合-たとえば、ラインがすでに開いている場合、一度に1文字だけスローします。</font><font style="vertical-align: inherit;">また、開始山かっこをシールドする価値があります。そうしないと、レイアウトが壊れる可能性があります。</font></font><br>
<br>
<pre><code class="javascript hljs">output += char.replace(<span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&amp;'</span> + <span class="hljs-string">'lt;'</span>); <span class="hljs-comment">//  +      &lt;</span></code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バグ修正</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
すべてがどういうわけか単純すぎるように見え、無駄ではありませんでした。より徹底的なテストを行うと、バックライトが正しく機能しない場合がありました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
除算は正規表現として認識されます。区別するためには、正規表現の決定方法を変更する必要があります。</font><font style="vertical-align: inherit;">変数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isRegex = true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を宣言した</font><font style="vertical-align: inherit;">後、これが正規表現ではなく除算記号であることを「証明」しようとします。</font><font style="vertical-align: inherit;">除算演算の前は、キーワードと左角括弧はありません。そのため、ネストされたループを作成し、スラッシュが何を向いているかを確認します。</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前と同じように</font></font></b><div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'/'</span>) {<font></font>
	state = states.REGEX_LITERAL;<font></font>
	output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.REGEX_LITERAL + <span class="hljs-string">'"&gt;'</span> + char;
	<span class="hljs-keyword">continue</span>;<font></font>
}</code></pre><br>
</div></div><br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.NONE &amp;&amp; char == <span class="hljs-string">'/'</span>) {
	<span class="hljs-keyword">let</span> word = <span class="hljs-string">''</span>, j = <span class="hljs-number">0</span>, isRegex = <span class="hljs-literal">true</span>;
	<span class="hljs-keyword">while</span> (i + j &gt;= <span class="hljs-number">0</span>) {<font></font>
		j--;<font></font>
		<span class="hljs-comment">//       </span>
		<span class="hljs-keyword">if</span> (<span class="hljs-string">'+/-*=|&amp;&lt;&gt;%,({[?:;'</span>.indexOf(code[i+j]) != <span class="hljs-number">-1</span>) <span class="hljs-keyword">break</span>;
		<span class="hljs-comment">//   ;   -  </span>
		<span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/[0-9a-z$_]/i</span>.test(code[i+j]) &amp;&amp; word.length &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
		<span class="hljs-comment">//  ,    </span>
		<span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[0-9a-z$_]/i</span>.test(code[i+j])) word = code[i+j] + word;
		<span class="hljs-comment">//   - ,    </span>
		<span class="hljs-keyword">if</span> (<span class="hljs-string">')]}'</span>.indexOf(code[i+j]) != <span class="hljs-number">-1</span>) {<font></font>
			isRegex = <span class="hljs-literal">false</span>;
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
	}<font></font>
	<span class="hljs-comment">//      -   </span>
	<span class="hljs-comment">//  : return /test/g - , plainWord /test/g - </span>
	<span class="hljs-keyword">if</span> (word.length &gt; <span class="hljs-number">0</span> &amp;&amp; !keywords.includes(word)) isRegex = <span class="hljs-literal">false</span>;
	<span class="hljs-keyword">if</span> (isRegex) {<font></font>
		state = states.REGEX_LITERAL;<font></font>
		output += <span class="hljs-string">'&lt;span style="color: '</span> + colors.REGEX_LITERAL + <span class="hljs-string">'"&gt;'</span> + char;
		<span class="hljs-keyword">continue</span>;<font></font>
	}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このアプローチは問題を解決しますが、それでも欠陥がないわけではありません。 ：あなたは、このアルゴリズムはまた、例えば、誤っ浮き彫りになるように調整することができます</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">場合は（）/正規表現/</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">またはそう：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 / /正規表現/ / 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。なぜ数値を正規表現に分割する人がコードの強調表示を必要とするのですか-これは別の質問です。構文は正しいですが、実際には発生しません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
たとえば</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prism.jsの</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ように、多くの作品で正規表現のカラーリングに問題があります</font><font style="vertical-align: inherit;">。どうやら、正規表現を正しく強調表示するには、ブラウザと同じように構文を完全に理解する必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私が対処しなければならない2番目のバグは、バックスラッシュに関連していました。</font><i><font style="vertical-align: inherit;">'test \\'の</font></i><font style="vertical-align: inherit;">ような行</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前にバックスラッシュがあるため、終了の引用は認識されませんでした。</font><font style="vertical-align: inherit;">行の終わりをキャッチする状態に戻ります。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">if</span> (state == states.SINGLE_QUOTE &amp;&amp; char == <span class="hljs-string">'\''</span> &amp;&amp; prev != <span class="hljs-string">'\\'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
条件の最後の部分を変更する必要があります。円記号がエスケープされている場合（つまり、その前に別の円記号がある場合）、行の終わりを登録します。</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> closingCharNotEscaped = prev != <span class="hljs-string">'\\'</span> || prev == <span class="hljs-string">'\\'</span> &amp;&amp; code[i<span class="hljs-number">-2</span>] == <span class="hljs-string">'\\'</span>;
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">if</span> (state == states.SINGLE_QUOTE &amp;&amp; char == <span class="hljs-string">'\''</span> &amp;&amp; closingCharNotEscaped)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
二重引用符と逆引用符を含む文字列の検索、および正規表現の検索でも同じ置換を行う必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
記事の冒頭にあるリンクでハイライトをテストできます。</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja482872/index.html">ポリゴン別世界</a></li>
<li><a href="../ja482874/index.html">おすすめのリストでのKoshcheiの死（YouTubeを快適で安全なものにできますか？）</a></li>
<li><a href="../ja482876/index.html">ヨーロッパの中心にある世帯の自分のニーズに合わせた太陽光発電のコストの計算</a></li>
<li><a href="../ja482878/index.html">「製品」の定義を検索した方法</a></li>
<li><a href="../ja482882/index.html">電磁ブレーキとしてのモーター</a></li>
<li><a href="../ja482886/index.html">ハブラ分析：出版の長さは重要ですか？</a></li>
<li><a href="../ja482888/index.html">プロバイダーNATの背後でのVPNサーバーの開始</a></li>
<li><a href="../ja482892/index.html">Let vs const-何を使うべきですか？</a></li>
<li><a href="../ja482894/index.html">WaveFunctionCollapseアルゴリズムと事前確率分布を使用した適応型手続き型生成</a></li>
<li><a href="../ja482896/index.html">OSCP-私の経験</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>