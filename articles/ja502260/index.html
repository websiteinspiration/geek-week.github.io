<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💪🏾 👨🏾‍✈️ 🔸 ESP-NOWは、ESP8266およびESP32の代替通信プロトコルです。基本概念 🌟 🚁 🧔🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ESP-NOWは、ペアになっているデバイスのペア間で短いパケットを送信するための簡略化されたWiFiプロトコルであり、ESP8266およびESP32マイクロコントローラー向けに2016.07にEspressifによって開発およびリリースされました。同時に、WiFiプロトコルサポートに関連する追加の手...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ESP-NOWは、ESP8266およびESP32の代替通信プロトコルです。基本概念</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502260/"><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWは、ペアになっているデバイスのペア間で短いパケットを送信するための簡略化されたWiFiプロトコル</font><font style="vertical-align: inherit;">であり、ESP8266およびESP32マイクロコントローラー向けに2016.07に</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">によって開発およびリリースされ</font><font style="vertical-align: inherit;">ました。</font><font style="vertical-align: inherit;">同時に、WiFiプロトコルサポートに関連する追加の手順は使用されないため、パケット交換プロセスが高速化されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWをモノのインターネットで使用して、インテリジェントな光源、リレー、ソケット、その他のリモートコントロールデバイスを制御したり、センサーやその他のアプリケーションから情報を受信したりできます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOWは次の機能をサポートしています</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペアリングされたデバイス間の暗号化および非暗号化通信。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペアリングされたデバイス間の暗号化された通信と暗号化されていない通信の混合。 </font></font><br>
 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大250バイトの有用な情報を転送します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特に、送信の成功または失敗についてアプリケーション層に通知するコールバック関数を設定します。</font></font></li>
</ul><br>
<a name="habracut"></a><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOWには、次の機能と制限もあります。</font></font></h4><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伝送速度-2.4 GHzの周波数で1 Mbps以下、つまり </font><font style="vertical-align: inherit;">ESP-NOWは、WiFiルーターと同じ周波数とチャネルで動作します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiFiプロトコルは使用されていません</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4 GHzワイヤレスマウスで使用される低電力プロトコルに似ています。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初のペアリングのみが必要です。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペアリング後、接続は切断されません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ブロードキャストはサポートされていません-ペアリングされたデバイスペアへの複数の配信のみ。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暗号化されたペアを含む最大20ペアが、暗号化されたペアを含め、1つのデバイスでサポートされます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ステーションモードでは、最大10の暗号化されたペアがサポートされます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SoftAPまたはSoftAP + Stationモードでは最大6。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">マルチキャスト暗号化はサポートされていません。</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全性</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWは、EspressifおよびCCMP暗号化テクノロジーによって開発されたIE機能を備えたIEEE802.11アクションベンダーフレームテクノロジーを使用し、安全で接続不要の通信ソリューションを提供します。</font><font style="vertical-align: inherit;">Wi-Fiデバイスは、プライマリマスターキー（PMK）と複数のローカルマスターキー（LMK）をサポートします</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMKは</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、AES-128アルゴリズムを使用してLMKを暗号化するために使用されます。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペアデバイスは、CCMPを使用してユーザー情報を暗号化するために使用されます。</font><font style="vertical-align: inherit;">異なるLMKの最大数は6です。ペアリングされたデバイスにLMKが設定されていない場合、ユーザーデータは暗号化されません。</font></font></li>
</ul><br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本レベル</font></font></h2></u><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP_NOWプロトコルの下位レベルでは、ローカルデバイスとペアになっているデバイスに関する情報（MACアドレスとキーを含む）を含むリンクリストが維持されます。</font><font style="vertical-align: inherit;">ESP-NOWは、リンクリストの再処理のオーバーヘッドを回避するために、アプリケーションレイヤーで頻繁に使用されるデータも保存します。</font><font style="vertical-align: inherit;">デバイスに関する情報はデータの送受信に使用され</font><u><font style="vertical-align: inherit;">、ローカルデバイスに関する情報が</font></u><font style="vertical-align: inherit;">含まれ</font></font><br>
<br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ます。</font></font></u> <br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：16バイト-接続されたデバイス（APIのKOK）でキーを暗号化するために使用されるメインマスターキーESP_NOWはデフォルトでPMKをサポートしているため、構成は必要ありません。</font><font style="vertical-align: inherit;">必要に応じて、PMK値がローカルデバイスと一致することを確認できます。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">モード</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1バイト-送信WiFiインターフェース（SoftAPまたはSTA）ESP-NOWを定義するローカルデバイスモード。</font><font style="vertical-align: inherit;">ペアリングされたデバイスモードは、機能には影響しませんが、アプリケーション層のモード情報を保存するだけです。</font><font style="vertical-align: inherit;">STA WiFiモードでは、ステーションのみが適用され、SoftAP WiFiはSoftAPのみです。</font></font><div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ローカルデバイス操作モードESP_NOW</font></font></b>
                        <div class="spoiler_text"><blockquote><div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th></th>
<th> WiFi</th>
</tr>
<tr>
<td><b>IDLE</b></td>
<td> </td>
<td>   </td>
</tr>
<tr>
<td><b>CONTROLLER</b></td>
<td></td>
<td>STA</td>
</tr>
<tr>
<td><b>SLAVE</b></td>
<td></td>
<td>SoftAP </td>
</tr>
<tr>
<td><b>COMBO</b></td>
<td>&amp;</td>
<td>SoftAP</td>
</tr>
</tbody></table></div></blockquote><br>
</div>
                    </div></li>
</ul><br>
<u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペアリングされたデバイス</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情報（頻繁に使用される情報およびその他のユーザー情報を含む）：</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LMK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：16バイト-このペアでの通信中に有用な情報のキーを暗号化するために使用されるローカルマスターキー。</font></font></li>
<li><b>MAC-</b>: 6  —   ,    . ,     Station, MAC-     Station.</li>
<li><b></b>: 1  —       (SoftAP  STA) ESP-NOW.</li>
<li><b></b>: 1  — ,     ,   .   0..255.       ,         .    . , 0 ,    ; 1 ~ 14   ;       ,    .</li>
</ul><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、パケットの送信/送信時にコールバック関数で長い操作を使用することを推奨していません。これは、おそらく割り込みメカニズムを使用したアルゴリズムの実装に関連しています。</font><font style="vertical-align: inherit;">この仮定は、コールバック関数での動的メモリ割り当てに関連する問題によってもサポートされています。これは、静的変数の推奨される使用法、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">およびMicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例外</font><i><font style="vertical-align: inherit;">メカニズムの</font></i><font style="vertical-align: inherit;">使用のあいまいさによって解決され</font><font style="vertical-align: inherit;">ます。</font><i><font style="vertical-align: inherit;">Espressif</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
パケットの開始/終了プロセス、ペアリング、受信/送信の非同期の実装は</font><font style="vertical-align: inherit;">説明されていません</font><font style="vertical-align: inherit;">。これ</font><font style="vertical-align: inherit;">は、</font><i><b><font style="vertical-align: inherit;">asyncio</font></b></i><i><font style="vertical-align: inherit;"> MicroPython</font></i><font style="vertical-align: inherit;">イデオロギーの適用を容易にしません</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOWパッケージ形式</font></font></h4><br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MACヘッダー</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：24バイト。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カテゴリ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：パッケージ作成者のカテゴリを示す1バイト。</font><font style="vertical-align: inherit;">値が設定されます（127）。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組織ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：3バイト。一意の識別子が含まれます。これは、Espressifが使用するMACアドレスの最初の3バイトです。</font><font style="vertical-align: inherit;">設定値（0x18fe34）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ランダム値</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：4バイト。データの保護に使用されます。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">パッケージ作成者データ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：7〜255バイト</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パッケージ作成者データには、次のフィールドが含まれています。</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1バイト、（221）に設定。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">長さ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1バイト、組織ID、タイプ、バージョン、およびユーザーデータの全長。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">組織ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：3バイト。一意の識別子が含まれます。これは、Espressifが使用するMACアドレスの最初の3バイトです。</font><font style="vertical-align: inherit;">設定値（0x18fe34）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タイプ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1バイト、ESP-NOWプロトコル。</font><font style="vertical-align: inherit;">設定値（4）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">バージョン</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：1バイト、ESP-NOWの現在のバージョン。</font><font style="vertical-align: inherit;">インストール済み（1）</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：0〜250バイトのユーザーデータ。</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FCS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：4バイト、チェックサム</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWはWiFiを使用しないため、MACヘッダーは標準のパケットヘッダーとは少し異なります。</font><font style="vertical-align: inherit;">FrameControlフィールドのFromDSビットとToDSビットは0です。宛先アドレスは最初のアドレスフィールドで指定されます。</font><font style="vertical-align: inherit;">2番目のアドレスフィールドには、送信元アドレスが表示されます。</font><font style="vertical-align: inherit;">3番目のアドレスフィールドは、ブロードキャストアドレスとして設定されます（0xff：0xff：0xff：0xff：0xff：0xff）。</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的なアプリケーションアルゴリズム</font></font></h2></u><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開始と終了</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWを使用する前に、Wi-Fiインターフェイスを目的のモードに設定することをお勧めします。</font><font style="vertical-align: inherit;">通常、ステーションインターフェースは</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONTROLLER</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SLAVE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COMBOの</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SoftAPインターフェースに</font><font style="vertical-align: inherit;">設定され</font><font style="vertical-align: inherit;">ます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">ESP-NOWを使用した後は、Wi-Fiを停止することもお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWを開始するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_init（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">および</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を</font><font style="vertical-align: inherit;">呼び出し</font><font style="vertical-align: inherit;">て完了します。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_deinit（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">が呼び出されると</font><font style="vertical-align: inherit;">、ペアリングされたデバイスに関するすべての情報が削除されます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバック関数のバインド</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケット送信時の呼処理関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用して、ペアの送信側のアプリケーションレベルに、たとえばMACサブレイヤーの情報が正常に送信された場合に、送信の成功または失敗を通知できます。</font><i><font style="vertical-align: inherit;">esp_now_register_send_cb（）</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を使用する場合</font><font style="vertical-align: inherit;">は、次の点を考慮してください</font><font style="vertical-align: inherit;">
。リンクペアで：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーションレイヤーがパケットを受信しなかったが、コールバック関数が「成功」を返した場合、その理由は次のとおりです</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 。-不正なデバイスからの攻撃</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -暗号化された鍵のインストールエラー</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 -Espressifアプリケーションレベルでのパケット損失</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アプリケーション層がパケットを受信したが、コールバック関数がエラーを返した場合、原因は次のとおり</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 です。-チャネルがビジーで、ACKが受信されていません。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ローカルデバイスのすべてのペアとの複数の通信：</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバックが「成功」を返す場合、それはパケットが正常に送信されたことを意味します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">コールバック関数がエラーを返す場合は、パケットが正常に送信されなかったことを意味します。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
パケットを受信すると、呼処理関数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_receive_cb（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">は、ペアの送信デバイスのMACアドレスと有用な情報を含む情報を返します。</font><font style="vertical-align: inherit;">また、パケットが正常に受信されたことを、レシーバーとペアになっている送信側デバイスのアプリケーション層に通知するためにも使用できます。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ペアリングされたデバイスのペアを追加する</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データを送信する前に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_add_peer（）を</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼び出して、ペアリングされたデバイスのペアのリストにデバイスを追加する必要があります</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">確立されたペアのグループにデータを送信する前に、マルチキャストMACアドレスを持つデバイスを追加する必要があります。</font><font style="vertical-align: inherit;">ペアリングされたデバイスのチャネル範囲は0〜14です。チャネルが0に設定されている場合、データは現在のチャネルで送信されます。</font><font style="vertical-align: inherit;">それ以外の場合、チャネルはローカルデバイスが配置されているチャネルとして設定する必要があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全性</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
キーを暗号化する必要がある場合は、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_set_pmk（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を呼び出して、</font><font style="vertical-align: inherit;">PMKを設定</font><font style="vertical-align: inherit;">するように設定できます</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">PMKがインストールされていない場合、デフォルトでPMKが使用され、すべてのデバイスに同じキーを選択します。</font><font style="vertical-align: inherit;">選択したペアのLMKも設定します。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOWパッケージを使用したデータの送信</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ESP-NOWデータを送信するには、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_send（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を使用します</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">同時に、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp_now_register_send_cb（）で</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前に設定された</font><font style="vertical-align: inherit;">関数は、データがMACレベルで正常に受信された場合、コールバック関数を送信するときに</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_SUCCESS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">を返し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">それ以外の場合、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP_NOW_SEND_FAIL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">はを返し</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ESP-NOWがデータを送信できない原因はいくつか考えられます。</font><font style="vertical-align: inherit;">特に、</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ターゲットデバイスが存在しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">デバイスチャネルが一致しません。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信中にデータが失われます。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アプリケーション層が必ずしもデータを受け入れるとは限りません。必要に応じて、ESP-NOWデータを受信したときに確認を送信できます。確認タイムアウトが発生した場合、ESP-NOWデータ送信を繰り返す必要があります。 ESP-NOWデータにシーケンス番号を割り当てて、重複データを削除することもできます。</font><i><font style="vertical-align: inherit;">esp_now_send（）</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
を介してESP-NOWデータを送信する場合</font><font style="vertical-align: inherit;">、一度に送信できる情報は250バイトを超えないことに注意してください。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意！ 2つのESP-NOWパケットを送信する間隔が短すぎると、コールバック関数の実行でエラーが発生する可能性があるため、コールバック関数が前回の送信の処理を正常に完了した後で、次のデータパケットESP-NOWを送信することをお勧めします。コールバック関数は、優先度の高いWi-Fiタスクから送信されます。したがって、コールバック関数で長い操作を実行することはお勧めしません。代わりに、必要なデータを静的キューに入れて、優先度の低いプロセスから処理することができます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
送信関数がMACアドレスを返す場合、そのMACアドレスを持つデバイスに送信されます。</font><font style="vertical-align: inherit;">送信関数がNULLを返す場合、パケットは送信側のデバイスに接続されているすべてのデバイスに送信されます。これにより、ネットワークの輻輳が原因で、送信の失敗や遅延が発生する可能性があります。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP-NOW受信データ</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
コールバック関数もWi-Fiタスクから開始します。</font><font style="vertical-align: inherit;">したがって、コールバック関数で長い操作を実行することはお勧めしません。</font><font style="vertical-align: inherit;">代わりに、必要なデータを静的キューに入れて、優先度の低いプロセスで処理できます。</font></font><br>
<br>
<u><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論として、前述の</font></font></h2></u><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espressif IDE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">と</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MicroPython</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">をESP-NOW </font><font style="vertical-align: inherit;">
で構築した経験。</font><font style="vertical-align: inherit;">アセンブリ中に発生したエラーについて説明し、安定した結果が得られたら修正する予定です。次に、エラーが検出されたMicroPythonのESP-NOWライブラリと、それらを解決する方法について説明します。残念ながら、ESP-NOWのソースコードはクローズされてバイナリ形式でのみ配布されるという事実により、ESP-NOWプロトコルのアルゴリズムの理解は経験的であり、論理的にそれらを克服するためのオプションが常にあるわけではないが、一般にESP -NOWは、GitHubで公開されている300を超えるアプリケーションに基づいて、CユーザーとPythonistの両方のコミュニティにうまく適用されています。</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><i><font style="vertical-align: inherit;">Espressifに</font></i></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">よるESP-NOW Cライブラリの説明</font></font><i><font style="vertical-align: inherit;"></font></i></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">MicroPython</font></i><font style="vertical-align: inherit;"> ESP-NOWの説明とオープンソース</font></font><i><font style="vertical-align: inherit;"></font></i></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja502250/index.html">今日の民間航空：トレーニングにおける重要な側面と課題</a></li>
<li><a href="../ja502252/index.html">リモコンとドローン</a></li>
<li><a href="../ja502254/index.html">PostgreSQL：人間の言語でのサーバー側プログラミング（PL / Perl、PL / Python、PL / v8）</a></li>
<li><a href="../ja502256/index.html">Neo4jを使用してSpring統合グラフを視覚化する方法は？</a></li>
<li><a href="../ja502258/index.html">ヘルプ/ドキュメント用のVue.jsコンポーネント</a></li>
<li><a href="../ja502262/index.html">銀行のAIOpsと包括的モニタリングの理由、または顧客関係の構築について</a></li>
<li><a href="../ja502264/index.html">公開鍵インフラストラクチャ。自己分離の状態での証明書の発行</a></li>
<li><a href="../ja502266/index.html">IntelプラットフォームのAurora。エグザフロップス時代の夜明け</a></li>
<li><a href="../ja502268/index.html">HackTheBox。特許を渡す。DOCX経由のXXE、LFIからRCE、GIT、およびROPチェーンファイル</a></li>
<li><a href="../ja502272/index.html">「私は自分自身を感じます」など、愚痴に駆り立てられるその他の英語の規則を言わないでください</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>