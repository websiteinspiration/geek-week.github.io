<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüåæ üë©üèΩ‚Äçüç≥ üçò Buffer de profundidad jer√°rquica ü§òüèΩ ü§≤üèΩ üïï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Breve rese√±a
 Un b√∫fer de profundidad jer√°rquico es un b√∫fer de profundidad multinivel (Z-buffer) utilizado como estructura de aceleraci√≥n para consul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Buffer de profundidad jer√°rquica</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/494376/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/fr/kx/e8/frkxe8hnnru9xzoo2g9k8qec2sq.png"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breve rese√±a</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un b√∫fer de profundidad jer√°rquico es un b√∫fer de profundidad multinivel (Z-buffer) utilizado como estructura de aceleraci√≥n para consultas de profundidad. Como en el caso de las cadenas de mip de textura, los tama√±os de cada nivel son generalmente el resultado de dividir por el grado de dos los tama√±os del b√∫fer de resoluci√≥n completa. En este art√≠culo, hablar√© sobre dos formas de generar un b√∫fer de profundidad jer√°rquica a partir de un b√∫fer de resoluci√≥n completa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, le mostrar√© c√≥mo generar una cadena de mip completa para un b√∫fer de profundidad, que conserva la precisi√≥n de las consultas de profundidad en el espacio de coordenadas de textura (o NDC) incluso para tama√±os de b√∫fer de profundidad que no son iguales a las potencias de dos. (En Internet, he encontrado ejemplos de c√≥digo que no garantizan esta precisi√≥n, lo que complica la ejecuci√≥n de consultas precisas a niveles altos de mip).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, para los casos en que solo se requiere un nivel de disminuci√≥n de resoluci√≥n, demostrar√© c√≥mo generar este nivel con una sola llamada a un sombreador de c√≥mputo que utiliza operaciones at√≥micas en la memoria compartida del grupo de trabajo. </font><font style="vertical-align: inherit;">Para mi aplicaci√≥n, donde solo se requiere una resoluci√≥n de 1/16 x 1/16 (nivel 4 de mip), el m√©todo con un sombreador computacional es </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2-3 veces m√°s r√°pido</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que el enfoque habitual con la disminuci√≥n de la cadena de mip en varias pasadas.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introducci√≥n</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las profundidades jer√°rquicas (tambi√©n llamadas Hi-Z) es una t√©cnica que se usa a menudo en gr√°ficos 3D. Se utiliza para acelerar el recorte de la geometr√≠a invisible (eliminaci√≥n de oclusi√≥n) (en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as√≠ como</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), el c√°lculo de los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reflejos en el espacio de la pantalla</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niebla volum√©trica</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y mucho m√°s. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">las</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GPU </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Hi-Z a menudo se implementan</font></a><font style="vertical-align: inherit;"> como parte de una canalizaci√≥n de rasterizaci√≥n. Las operaciones de b√∫squeda r√°pida Hi-Z en los cach√©s del chip le permiten omitir por completo los mosaicos de fragmentos si est√°n completamente cubiertos por primitivas renderizadas previamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea b√°sica de Hi-Z es acelerar las operaciones de consulta en profundidad leyendo desde memorias intermedias de menor resoluci√≥n. </font><font style="vertical-align: inherit;">Esto es m√°s r√°pido que leer profundidades de resoluci√≥n completa desde el b√∫fer, por dos razones:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un texel (o solo unos pocos texels) de un buffer de baja resoluci√≥n puede usarse como un valor aproximado de una pluralidad de texels de un buffer de alta resoluci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un b√∫fer de menor resoluci√≥n puede ser lo suficientemente peque√±o y almacenado en cach√©, lo que acelera enormemente la ejecuci√≥n de las operaciones de b√∫squeda (especialmente con acceso aleatorio).</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El contenido de los niveles de b√∫fer Hi-Z muestreados hacia abajo depende de c√≥mo se usen (si el b√∫fer de profundidad se </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"invertir√°"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qu√© tipos de solicitudes se deben usar). En general, un texel en el nivel de b√∫fer Hi-Z almacena </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todos los texel correspondientes en el nivel anterior. A veces los valores </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font><font style="vertical-align: inherit;">se almacenan al mismo tiempo </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Los valores promediados simples (que a menudo se usan en los niveles mip de las texturas regulares) se usan con poca frecuencia porque rara vez son √∫tiles para este tipo de consultas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los buffers Hi-Z se solicitan con mayor frecuencia casi inmediatamente a la salida para evitar un mayor procesamiento y operaciones de b√∫squeda m√°s precisas en el buffer de resoluci√≥n completa. Por ejemplo, si almacenamos valores</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para un b√∫fer de profundidad no invertido (en el que cuanto mayor es el valor de profundidad, m√°s lejos est√° el objeto), podemos determinar r√°pidamente exactamente si una posici√≥n particular en el espacio de la pantalla est√° cubierta por un b√∫fer de profundidad (si su coordenada Z&gt; es el valor (m√°ximo) almacenado en algunos nivel m√°s alto (es decir, resoluci√≥n m√°s baja) del b√∫fer Hi-Z). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que us√© la frase "exactamente": si la coordenada Z &lt;= el valor recibido (m√°x.), Entonces no se sabe si su b√∫fer se superpone. </font><font style="vertical-align: inherit;">En algunas aplicaciones, en casos de incertidumbre, puede ser necesario buscar en el b√∫fer profundidades de resoluci√≥n completa; </font><font style="vertical-align: inherit;">en otros casos, esto no es obligatorio (por ejemplo, si solo est√°n en juego c√°lculos innecesarios y no la representaci√≥n correcta).</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mi aplicaci√≥n: renderizar part√≠culas en un sombreador computacional</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me enfrent√© a la necesidad de usar Hi-Z al implementar el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renderizado de part√≠culas en un sombreador computacional</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el motor de mi aplicaci√≥n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PARTICULATE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VR </font><font style="vertical-align: inherit;">. Dado que esta t√©cnica de renderizado no usa rasterizaci√≥n con funciones fijas, necesita usar su propia verificaci√≥n de profundidad para cada part√≠cula con un tama√±o de un p√≠xel. Y dado que las part√≠culas no est√°n clasificadas de ninguna manera, el acceso al b√∫fer de profundidad es (en el peor de los casos) casi aleatorio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las operaciones de b√∫squeda en una textura de acceso aleatorio a pantalla completa son el camino hacia un bajo rendimiento. Para reducir la carga, primero busco profundidades en el b√∫fer de profundidad reducida con una resoluci√≥n de 1/16 x 1/16 del original. Este b√∫fer contiene valores de profundidad.</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que permite que el sombreador de renderizado computacional para la gran mayor√≠a de las part√≠culas visibles omita la prueba de profundidad de resoluci√≥n completa. (Si la profundidad de la part√≠cula es &lt;la profundidad m√≠nima almacenada en el b√∫fer de resoluci√≥n m√°s baja, entonces sabemos que es absolutamente visible. Si es&gt; = min, entonces debemos verificar el b√∫fer de profundidad de resoluci√≥n completa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gracias a esto, la prueba de profundidad para part√≠culas visibles en el caso general se convierte en una operaci√≥n de bajo costo. (Para las part√≠culas superpuestas por la geometr√≠a, es m√°s costoso, pero nos conviene porque no causa costos de procesamiento, por lo tanto, las part√≠culas a√∫n requieren poco c√°lculo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a que la b√∫squeda se realiza primero en el b√∫fer de profundidades de menor resoluci√≥n (como se mencion√≥ anteriormente) , el </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiempo de reproducci√≥n de part√≠culas se reduce en un m√°ximo del 35%</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en comparaci√≥n con el caso cuando la b√∫squeda se realiza solo en el b√∫fer de resoluci√≥n completa. </font><font style="vertical-align: inherit;">Por lo tanto, para mi aplicaci√≥n, Hi-Z es muy beneficioso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veremos dos t√©cnicas para generar un b√∫fer de profundidad jer√°rquico.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©cnica 1: generar una cadena Mip completa</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En muchas aplicaciones Hi-Z, se requiere la creaci√≥n de una cadena de mip de memoria intermedia de profundidad completa. Por ejemplo, cuando se realiza la eliminaci√≥n de oclusiones usando Hi-Z, el volumen delimitador se proyecta en el espacio de la pantalla y el tama√±o proyectado se usa para seleccionar el nivel de mip apropiado (de modo que se involucra un n√∫mero fijo de texels en cada prueba de superposici√≥n). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generar una cadena mip a partir del b√∫fer de profundidad de resoluci√≥n completa suele ser una tarea simple: para cada texel en el nivel N tomamos </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o ambos) los 4 texels correspondientes en el nivel N-1 generado anteriormente. Realizamos pases secuenciales (cada vez reduciendo el tama√±o a la mitad) hasta que obtengamos el √∫ltimo nivel de mip 1x1 en tama√±o.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, en el caso de los amortiguadores de profundidad, cuyos tama√±os no corresponden a las potencias de dos, todo es m√°s complicado. Dado que Hi-Z para buffers de profundidad a menudo se construye a partir de resoluciones de pantalla est√°ndar (que rara vez son potencias de dos), necesitamos encontrar una soluci√≥n confiable para este problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero decidamos qu√© significar√° el valor de cada b√∫fer de profundidad de nivel mip de texel. En este art√≠culo, asumiremos que la cadena mip almacena valores </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Las operaciones de b√∫squeda de profundidad deber√≠an utilizar el filtrado de los vecinos m√°s cercanos, porque la interpolaci√≥n de valores es </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in√∫til para nosotros y da√±ar√° la naturaleza jer√°rquica de la cadena de profundidades creada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ¬øqu√© significa exactamente el valor del texel individual en el nivel mip N obtenido por nosotros? Este deber√≠a ser el valor m√≠nimo (</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) de todos los texels del b√∫fer de profundidad de pantalla completa que ocupa el mismo espacio en el espacio de coordenadas de textura (normalizado). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En otras palabras, si una coordenada separada de la textura (en el intervalo</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) se asigna (filtrando los vecinos m√°s cercanos) a un texel individual del b√∫fer de resoluci√≥n completa, luego este texel de resoluci√≥n completa debe considerarse como un candidato para el valor</font><font style="vertical-align: inherit;">calculado para el texel en cada nivel de mip superior posterior con el que se asigna la misma coordenada texturas</font><font style="vertical-align: inherit;">
Si se garantiza esta correspondencia, nos aseguraremos de que la operaci√≥n de b√∫squeda en niveles altos de mip nunca devolver√° el valor de profundidad&gt; valor de texel en la misma coordenada de textura correspondiente al b√∫fer de resoluci√≥n completa (nivel 0). En el caso de una N separada, esta garant√≠a se mantiene para todos los niveles por debajo de ella (&lt;N).</font></font><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.707ex" height="2.884ex" viewBox="0 -916.9 2457.1 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-30" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1224" y="0"></use><g transform="translate(1724,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">[0, 1]^2</script><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para las dimensiones pares (y en el caso de las memorias intermedias de resoluci√≥n completa, que son potencias de dos, las dimensiones pares en cada nivel hasta el √∫ltimo, donde las dimensiones se vuelven iguales a 1) ser√°n f√°ciles de hacer. </font><font style="vertical-align: inherit;">En el caso unidimensional, para texel con un √≠ndice</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="2.009ex" viewBox="0 -755.5 345.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">i</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el nivel N necesitamos tomar texels en el nivel N-1 con √≠ndices</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.162ex" height="2.009ex" viewBox="0 -755.5 500.5 865.1" role="img" focusable="false" style="vertical-align: -0.255ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-3">2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.968ex" height="2.134ex" viewBox="0 -755.5 2569.4 918.9" role="img" focusable="false" style="vertical-align: -0.38ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2B" x="1068" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="2068" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">2i + 1</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y encuentra su valor</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Es decir</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.481ex" height="2.634ex" viewBox="0 -809.3 16137.7 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-29" x="15748" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Podemos comparar directamente los texels en la relaci√≥n "2 a 1" (y, por lo tanto, el tama√±o de las coordenadas de textura), porque el tama√±o de cada nivel es exactamente dos veces menor que el anterior.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/11f/ca7/b43/11fca7b43dd706d72f35590f69422e2c.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo de tama√±os de nivel pares: 6 texels en este nivel se reducen a 3 en un nivel superior. </font><font style="vertical-align: inherit;">Los tama√±os de coordenadas de textura de cada uno de los tres texels de alto nivel se superponen con precisi√≥n en cada dos texels de nivel inferior. </font><font style="vertical-align: inherit;">(Los puntos son los centros de los texels, y los cuadrados son las dimensiones de la coordenada de textura cuando se filtran los vecinos m√°s cercanos).</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
En el caso de tama√±os de nivel impares (y los buffers de resoluci√≥n completa que no son una potencia de dos tendr√°n al menos un nivel con un tama√±o impar) todo cada vez m√°s dif√≠cil </font><font style="vertical-align: inherit;">Para el nivel N-1 de tama√±o impar</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tama√±o del siguiente nivel (N) ser√° igual</font></font><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.595ex" height="2.384ex" viewBox="0 -755.5 3270.2 1026.6" role="img" focusable="false" style="vertical-align: -0.63ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1637,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">\mathit{dim}_{N-1}</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, es decir</font></font><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo>=</mo><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230A;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence=&quot;false&quot; stretchy=&quot;false&quot;>&amp;#x230B;</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.865ex" height="3.759ex" viewBox="0 -1132.2 7261.2 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-69" x="511" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-6D" x="819" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="2315" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-3D" x="2643" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-230A" x="3699" y="0"></use><g transform="translate(4144,0)"><g transform="translate(120,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="1469" y="-542"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-230B" x="6816" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo>=</mo><mo fence="false" stretchy="false">‚åä</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac><mo fence="false" stretchy="false">‚åã</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">\mathit{dim}_{N} = \lfloor \frac{\mathit{dim}_{N-1}}{2} \rfloor</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Esto significa que ahora no tenemos un mapeo claro 2 a 1 de los texels del nivel N-1 a los texels del nivel N.Ahora el tama√±o de la coordenada de textura de cada texel en el nivel N se superpone al tama√±o de</font><em><font style="vertical-align: inherit;">3</font></em><font style="vertical-align: inherit;">texels en el nivel N-1.</font></font><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>&amp;#x2260;</mo><mfrac><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>d</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>i</mi><mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;>m</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.66ex" height="3.759ex" viewBox="0 -1132.2 3728.6 1618.6" role="img" focusable="false" style="vertical-align: -1.13ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2260" x="0" y="0"></use><g transform="translate(778,0)"><g transform="translate(397,0)"><rect stroke="none" width="2432" height="60" x="0" y="220"></rect><g transform="translate(60,558)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-69" x="511" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAINI-6D" x="819" y="0"></use><g transform="translate(1157,-107)"><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="1469" y="-542"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>‚â†</mo><mfrac><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mn>2</mn></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-8">\neq \frac{\mathit{dim}_{N-1}}{2}</script><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48d/9d6/6e1/48d9d66e16424a3781e695a3340d2cb4.svg"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo de un tama√±o de nivel impar: 7 texels de este nivel se reducen a 3 texels en el siguiente nivel. </font><font style="vertical-align: inherit;">Las dimensiones de las coordenadas de textura de los tres texels de alto nivel se superponen a los tama√±os de los tres texels del nivel inferior. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>=</mo><mtext>min</mtext><mo stretchy=&quot;false&quot;>(</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><msub><mi>D</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="51.493ex" height="2.634ex" viewBox="0 -809.3 22170.5 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="1171" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="1835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="2180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-3D" x="2737" y="0"></use><g transform="translate(3793,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-6D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-69" x="833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-6E" x="1112" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-28" x="5461" y="0"></use><g transform="translate(5851,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="8312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="8590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="9091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="9436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2C" x="9715" y="0"></use><g transform="translate(10160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="12621" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="12900" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="13400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2B" x="13968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="14969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="15469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2C" x="15748" y="0"></use><g transform="translate(16193,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-44" x="0" y="0"></use><g transform="translate(828,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-4E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="888" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="18654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="18933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-69" x="19433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2B" x="20001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="21002" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="21502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-29" x="21781" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>=</mo><mtext>min</mtext><mo stretchy="false">(</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">]</mo><mo>,</mo><msub><mi>D</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="false">[</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>2</mn><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">D_{N}[i] = \text{min}(D_{N-1}[2i], D_{N-1}[2i + 1], D_{N-1}[2i + 2])</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Esto significa que un texel al nivel de N-1 a veces afecta el valor</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculado para</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texel al nivel de N. Esto es necesario para mantener la comparaci√≥n descrita anteriormente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La descripci√≥n anterior se ha presentado en una sola dimensi√≥n por simplicidad. </font><font style="vertical-align: inherit;">En dos dimensiones, si ambas dimensiones del nivel N-1 son pares, entonces la regi√≥n 2x2 texel en el nivel N-1 se asigna a un texel en el nivel N. Si una de las dimensiones es impar, la regi√≥n 2x3 o 3x2 en el nivel N-1 se asigna a uno texel en el nivel N. Si </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambas</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dimensiones son </font><font style="vertical-align: inherit;">impares </font><font style="vertical-align: inherit;">, entonces el texel "angular" tambi√©n debe tenerse en cuenta, es decir, la regi√≥n 3x3 en el nivel N-1 se compara con un texel en el nivel N.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de c√≥digo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El c√≥digo de sombreador GLSL que se muestra a continuaci√≥n implementa el algoritmo que describimos. </font><font style="vertical-align: inherit;">Debe ejecutarse para cada mip posterior, comenzando desde el nivel 1 (el nivel 0 es el nivel de resoluci√≥n completa).</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_depthBuffer;<font></font>
uniform <span class="hljs-keyword">int</span> u_previousLevel;<font></font>
uniform ivec2 u_previousLevelDimensions;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{<font></font>
	ivec2 thisLevelTexelCoord = ivec2(gl_FragCoord);<font></font>
	ivec2 previousLevelBaseTexelCoord = <span class="hljs-number">2</span> * thisLevelTexelCoord;<font></font>
<font></font>
	vec4 depthTexelValues;<font></font>
	depthTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord,<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.z = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
	depthTexelValues.w = texelFetch(u_depthBuffer,<font></font>
                                    previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>),<font></font>
                                    u_previousLevel).r;<font></font>
<font></font>
	<span class="hljs-keyword">float</span> minDepth = min(min(depthTexelValues.x, depthTexelValues.y),<font></font>
                         min(depthTexelValues.z, depthTexelValues.w));<font></font>
<font></font>
    <span class="hljs-comment">// Incorporate additional texels if the previous level's width or height (or both) </span>
    <span class="hljs-comment">// are odd. </span>
	<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel = ((u_previousLevelDimensions.x &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel = ((u_previousLevelDimensions.y &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>);
	<span class="hljs-keyword">if</span> (shouldIncludeExtraColumnFromPreviousLevel) {<font></font>
		vec2 extraColumnTexelValues;<font></font>
		extraColumnTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>),<font></font>
                                              u_previousLevel).r;<font></font>
		extraColumnTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                              previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>),<font></font>
                                              u_previousLevel).r;<font></font>
<font></font>
		<span class="hljs-comment">// In the case where the width and height are both odd, need to include the </span>
        <span class="hljs-comment">// 'corner' value as well. </span>
		<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {
			<span class="hljs-keyword">float</span> cornerTexelValue = texelFetch(u_depthBuffer,<font></font>
                                                previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),<font></font>
                                                u_previousLevel).r;<font></font>
			minDepth = min(minDepth, cornerTexelValue);<font></font>
		}<font></font>
		minDepth = min(minDepth, min(extraColumnTexelValues.x, extraColumnTexelValues.y));<font></font>
	}<font></font>
	<span class="hljs-keyword">if</span> (shouldIncludeExtraRowFromPreviousLevel) {<font></font>
		vec2 extraRowTexelValues;<font></font>
		extraRowTexelValues.x = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		extraRowTexelValues.y = texelFetch(u_depthBuffer,<font></font>
                                           previousLevelBaseTexelCoord + ivec2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),<font></font>
                                           u_previousLevel).r;<font></font>
		minDepth = min(minDepth, min(extraRowTexelValues.x, extraRowTexelValues.y));<font></font>
	}<font></font>
<font></font>
	gl_FragDepth = minDepth;<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defectos en este c√≥digo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, en el caso de memorias intermedias de profundidad de resoluci√≥n completa para las cuales una dimensi√≥n es m√°s de dos veces el tama√±o de otra dimensi√≥n, los √≠ndices de llamadas </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pueden ir m√°s all√° </font></font><code>u_depthBuffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. (En tales casos, la dimensi√≥n m√°s peque√±a se convierte en 1 antes que la otra). Quer√≠a usar en este ejemplo </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(usando coordenadas enteras), de modo que lo que estaba sucediendo fuera lo m√°s claro posible, y no encontr√© personalmente tales amortiguadores particularmente anchos / profundos. Si encuentra tales problemas, puede limitar ( </font></font><code>clamp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) las </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenadas </font><font style="vertical-align: inherit;">transmitidas </font><font style="vertical-align: inherit;">o usar las </font></font><code>texture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordenadas normalizadas de la textura (en la muestra, establezca un l√≠mite en el borde). Al calcular </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siempre debe considerar un mensaje de texto varias veces por la presencia de casos l√≠mite.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En segundo lugar, a pesar de que las primeras cuatro llamadas </font></font><code>texelFetch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se pueden reemplazar por una </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, esto complica las cosas (ya que </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no se puede indicar </font><font style="vertical-align: inherit;">el </font><font style="vertical-align: inherit;">nivel de mip); </font><font style="vertical-align: inherit;">Adem√°s, no not√© un aumento en la velocidad al usarlo </font></font><code>textureGather</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actuaci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilic√© el sombreador de fragmentos anterior para generar dos cadenas mip completas para dos amortiguadores de profundidad (uno para cada ojo) en mi motor VR. </font><font style="vertical-align: inherit;">En la prueba, la resoluci√≥n para cada ojo fue de 1648x1776, lo que condujo a la creaci√≥n de 10 niveles de mip reducidos adicionales (lo que significa 10 pases). </font><font style="vertical-align: inherit;">Tom√≥ 0.25 ms en el NVIDIA GTX 980 y 0.30 ms en el AMD R9 290 para generar una cadena completa para ambos ojos.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/805/461/815/8054618153533c29d1de1000fcee2878.jpg"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8f/2b6/950/a8f2b6950b278655f3deff3ca456874c.png"></div><br>
<i>Mip- 4, 5  6,    ,     . ( ,     ,  ,     .) Mip- 4 ‚Äî ,    (103x111)     2.</i><br>
<br>
<h2>   mip-</h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La tarea del algoritmo descrito anteriormente es mantener la precisi√≥n de las consultas de profundidad en el espacio de coordenadas de textura (o NDC). Para completar (y porque rechac√© esta garant√≠a en la t√©cnica a continuaci√≥n 2), me gustar√≠a demostrar un m√©todo m√°s que encontr√© (por ejemplo, en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que, como el anterior, este m√©todo alternativo est√° dise√±ado para funcionar con memorias intermedias de resoluci√≥n completa cuyos tama√±os no son potencias de dos (pero, por supuesto, funcionan con tama√±os iguales a potencias de dos).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este m√©todo alternativo, cuando se muestrea un nivel con un ancho (o alto) impar en lugar de agregar una columna (o fila) adicional de elementos de textura desde el nivel anterior (inferior) para cada elemento de salida, realizamos esta operaci√≥n solo para elementos de salida con √≠ndices m√°ximos (elementos "extremos" ) Lo √∫nico que cambia en el sombreador de fragmentos presentado anteriormente es establecer valores </font></font><code>shouldIncludeExtraColumnFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>shouldIncludeExtraRowFromPreviousLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">// If the previous level's width is odd and this is the highest-indexed "edge" texel for </span>
<span class="hljs-comment">// this level, incorporate the rightmost edge texels from the previous level. The same goes </span>
<span class="hljs-comment">// for the height. </span>
<span class="hljs-keyword">bool</span> shouldIncludeExtraColumnFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.x == u_previousLevelDimensions.x - <span class="hljs-number">3</span>);
<span class="hljs-keyword">bool</span> shouldIncludeExtraRowFromPreviousLevel =<font></font>
    (previousMipLevelBaseTexelCoords.y == u_previousLevelDimensions.y - <span class="hljs-number">3</span>);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debido a esto, los texels extremos con el √≠ndice m√°s alto se vuelven muy "gruesos", ya que cada divisi√≥n por 2 dimensiones impares lleva al hecho de que ocupan un intervalo proporcionalmente mayor del espacio de coordenadas de textura normalizado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La desventaja de este enfoque es que se vuelve m√°s dif√≠cil realizar consultas de profundidad de niveles altos de mip. En lugar de simplemente usar las coordenadas de textura normalizadas, primero debemos determinar el texel de resoluci√≥n completa correspondiente a estas coordenadas, y luego transferir las coordenadas de este texel a las coordenadas del nivel de mip correspondiente, cuya solicitud se est√° ejecutando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El fragmento de c√≥digo a continuaci√≥n se est√° migrando desde el espacio NDC</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.884ex" viewBox="0 -916.9 3235.6 1241.8" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>‚àí</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-10">[-1, 1]^2</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a las coordenadas texel en el nivel mip</font></font><code>higherMipLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="cpp hljs">vec2 windowCoords = (<span class="hljs-number">0.5</span> * ndc.xy + vec2(<span class="hljs-number">0.5</span>)) * textureSize(u_depthBuffer, <span class="hljs-number">0</span>);
<span class="hljs-comment">// Account for texel centers being halfway between integers. </span>
ivec2 texelCoords = ivec2(round(windowCoords.xy - vec2(<span class="hljs-number">0.5</span>)));<font></font>
ivec2 higherMipLevelTexelCoords =<font></font>
    min(texelCoords / (<span class="hljs-number">1</span> &lt;&lt; higherMipLevel),<font></font>
        textureSize(u_depthBuffer, higherMipLevel).xy - ivec2(<span class="hljs-number">1</span>));</code></pre><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©cnica 2: generar un √∫nico nivel Hi-Z usando un sombreador de computaci√≥n</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Generar una cadena de mip completa es bastante r√°pido, pero me molest√≥ un poco que mi aplicaci√≥n genere todos estos niveles y use solo uno de ellos (nivel 4). </font><font style="vertical-align: inherit;">Adem√°s de eliminar esta leve ineficiencia, tambi√©n quer√≠a ver cu√°nto se pod√≠a acelerar todo si usaba solo una llamada de sombreador de c√≥mputo para generar el nivel que necesitaba. </font><font style="vertical-align: inherit;">(Vale la pena se√±alar que mi aplicaci√≥n puede detenerse en el nivel 4 cuando uso una soluci√≥n con un sombreador de fragmentos de m√∫ltiples pasadas, por lo que al final de esta secci√≥n la utilic√© como base para comparar tiempos de ejecuci√≥n).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la mayor√≠a de las aplicaciones Hi-Z, solo se requiere un nivel de profundidad, por lo que creo que esta situaci√≥n es com√∫n. Escrib√≠ un sombreador computacional para mis propios requisitos espec√≠ficos (generando el nivel 4, que tiene una resoluci√≥n de 1/16 x 1/16 del original). Se puede usar un c√≥digo similar para generar diferentes niveles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El sombreador computacional es muy adecuado para esta tarea, ya que puede usar memoria compartida de grupo de trabajo para intercambiar datos entre subprocesos. Cada grupo de trabajo es responsable de un texel de salida (reducido por disminuci√≥n de muestreo del b√∫fer), y los hilos del grupo de trabajo comparten el trabajo de calcular los </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">texels correspondientes de resoluci√≥n completa, compartiendo los resultados a trav√©s de la memoria compartida.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prob√© dos soluciones principales basadas en sombreadores computacionales. En el primero, cada hilo requer√≠a </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una variable de memoria compartida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que dado que los programadores no pueden (sin extensiones para el hardware de un fabricante en particular) realizar operaciones at√≥micas en valores no enteros (y mis profundidades se almacenan como </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), aqu√≠ se necesita alg√∫n truco. Dado que los valores de coma flotante no negativos de la norma IEEE 754 mantienen su orden cuando sus bits se procesan como valores enteros sin signo, podemos utilizar </font></font><code>floatBitsToUint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para llevar (usando fundido reinterpretar) los valores de profundidad </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y luego llamar </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(a continuaci√≥n, ejecutar </font></font><code>uintBitsToFloat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para el valor m√≠nimo acabado </font></font><code>uint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La soluci√≥n m√°s obvia </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√≠a crear grupos de subprocesos de 16x16 en los que cada subproceso reciba un texel y luego lo ejecute </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con un valor en la memoria compartida. Compar√© este enfoque utilizando bloques de flujo m√°s peque√±os (8x8, 4x8, 4x4, 2x4, 2x2), en los que cada flujo recibe una regi√≥n de texel y calcula su propio m√≠nimo local, y luego llama </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La m√°s r√°pida de todas estas soluciones probadas con</font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIDIA y AMD resultaron tener una soluci√≥n con bloques de flujo 4x4 (en el que cada flujo recibe un √°rea de texel 4x4). </font><font style="vertical-align: inherit;">No entiendo bien por qu√© esta opci√≥n result√≥ ser la m√°s r√°pida, pero tal vez refleja un compromiso entre la competencia de las operaciones at√≥micas y los c√°lculos en flujos independientes. </font><font style="vertical-align: inherit;">Tambi√©n vale la pena se√±alar que el tama√±o del grupo de trabajo 4x4 usa solo 16 hilos por urdimbre / onda (y es posible usar tambi√©n 32 o 64), lo cual es interesante. </font><font style="vertical-align: inherit;">El siguiente ejemplo implementa este enfoque. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como alternativa al uso, </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">intent√© realizar una reducci√≥n paralela utilizando las t√©cnicas utilizadas en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta presentaci√≥n de NVIDIA citada activamente</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">(La idea b√°sica es utilizar una matriz de memoria compartida del mismo tama√±o que el n√∫mero de subprocesos en el grupo de trabajo, as√≠ como</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pasa para el c√°lculo conjunto secuencial de los</font><font style="vertical-align: inherit;">m√≠nimos de cada subproceso hasta que se obtiene el m√≠nimo final de todo el grupo de trabajo.)</font><font style="vertical-align: inherit;">
Prob√© esta soluci√≥n con los mismos tama√±os de grupo de trabajo que en la soluci√≥n c</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Incluso con todas las optimizaciones descritas en la presentaci√≥n de NVIDIA, la soluci√≥n de reducci√≥n paralela es ligeramente m√°s lenta (dentro de diez GPU en ambas GPU) que la soluci√≥n a la</font><font style="vertical-align: inherit;">que llegu√©. </font><font style="vertical-align: inherit;">Adem√°s, la soluci√≥n con es</font><font style="vertical-align: inherit;">mucho m√°s simple en t√©rminos de c√≥digo.</font></font><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>log</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn></mrow></msub><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.23ex" height="2.634ex" viewBox="0 -809.3 3112.9 1134.2" role="img" focusable="false" style="vertical-align: -0.755ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-6C"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-6F" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-67" x="779" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-32" x="1809" y="-343"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-28" x="1733" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMATHI-6E" x="2122" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/494376/&amp;usg=ALkJrhhglPQSsXz8qBZpM9zFzV3ENQQhPw#MJMAIN-29" x="2723" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>log</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn></mrow></msub><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-11">\log_{2} (n)</script><font style="vertical-align: inherit;"></font><code>min</code><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><code>atomicMin</code><font style="vertical-align: inherit;"></font><code>atomicMin</code><font style="vertical-align: inherit;"></font><code>atomicMin</code><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de c√≥digo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con este m√©todo, la forma m√°s f√°cil es no tratar de mantener la correspondencia en el espacio normalizado de coordenadas de textura entre texels de amortiguadores reducidos y resoluci√≥n completa. </font><font style="vertical-align: inherit;">Simplemente puede realizar conversiones desde coordenadas texel de resoluci√≥n completa a coordenadas texel de resoluci√≥n reducida:</font></font><br>
<br>
<pre><code class="cpp hljs">ivec2 reducedResTexelCoords = texelCoords / ivec2(downscalingFactor);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En mi caso (generar el equivalente de mip-level 4) </font></font><code>downscalingFactor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es 16. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencion√≥ anteriormente, este sombreador computacional GLSL implementa una soluci√≥n con </font></font><code>atomicMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tama√±os de grupo de trabajo 4x4, donde cada hilo recibe un √°rea de texel 4x4 del b√∫fer de resoluci√≥n completa. </font><font style="vertical-align: inherit;">El b√∫fer de profundidad de valor reducido resultante </font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es 1/16 x 1/16 del tama√±o del b√∫fer de resoluci√≥n completa (redondeado cuando los tama√±os de resoluci√≥n completa no son divisibles por 16 por completo).</font></font><br>
<br>
<pre><code class="cpp hljs">uniform sampler2D u_inputDepthBuffer;<font></font>
uniform <span class="hljs-keyword">restrict</span> writeonly image2DArray u_outputDownsampledMinDepthBufferImage;
<span class="hljs-comment">// The dimension in normalized texture coordinate space of a single texel in </span>
<span class="hljs-comment">// u_inputDepthBuffer. </span><font></font>
uniform vec2 u_texelDimensions;<font></font>
<font></font>
<span class="hljs-comment">// Resulting image is 1/16th x 1/16th resolution, but we fetch 4x4 texels per thread, hence </span>
<span class="hljs-comment">// the divisions by 4 here. </span>
layout(local_size_x = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_y = <span class="hljs-number">16</span>/<span class="hljs-number">4</span>, local_size_z = <span class="hljs-number">1</span>) in;<font></font>
<font></font>
<span class="hljs-comment">// This is stored as uint because atomicMin only works on integer types. Luckily </span>
<span class="hljs-comment">// (non-negative) floats maintain their order when their bits are interpreted as uint (using </span>
<span class="hljs-comment">// floatBitsToUint). </span><font></font>
shared uint s_workgroupMinDepthEncodedAsUint;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// Initialize to 1.0 (max depth) before performing atomicMin's. </span>
		s_workgroupMinDepthEncodedAsUint = floatBitsToUint(<span class="hljs-number">1.0</span>);<font></font>
	}<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
	<span class="hljs-comment">// Fetch a 4x4 texel region per thread with 4 calls to textureGather. 'gatherCoords' </span>
    <span class="hljs-comment">// are set up to be equidistant from the centers of the 4 texels being gathered (which </span>
    <span class="hljs-comment">// puts them on integer values). In my tests textureGather was not faster than </span>
    <span class="hljs-comment">// individually fetching each texel - I use it here only for conciseness. </span>
    <span class="hljs-comment">// </span>
    <span class="hljs-comment">// Note that in the case of the full-res depth buffer's dimensions not being evenly </span>
    <span class="hljs-comment">// divisible by the downscaling factor (16), these textureGather's may try to fetch </span>
    <span class="hljs-comment">// out-of-bounds coordinates - that's fine as long as the texture sampler is set to </span>
    <span class="hljs-comment">// clamp-to-edge, as redundant values don't affect the resulting min. </span><font></font>
<font></font>
	uvec2 baseTexelCoords = <span class="hljs-number">4</span> * gl_GlobalInvocationID.xy;<font></font>
	vec2 gatherCoords1 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords2 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords3 = (baseTexelCoords + uvec2(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
	vec2 gatherCoords4 = (baseTexelCoords + uvec2(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)) * u_texelDimensions;<font></font>
<font></font>
	vec4 gatheredTexelValues1 = textureGather(u_inputDepthBuffer, gatherCoords1);<font></font>
	vec4 gatheredTexelValues2 = textureGather(u_inputDepthBuffer, gatherCoords2);<font></font>
	vec4 gatheredTexelValues3 = textureGather(u_inputDepthBuffer, gatherCoords3);<font></font>
	vec4 gatheredTexelValues4 = textureGather(u_inputDepthBuffer, gatherCoords4);<font></font>
<font></font>
	<span class="hljs-comment">// Now find the min across the 4x4 region fetched, and apply that to the workgroup min </span>
    <span class="hljs-comment">// using atomicMin. </span><font></font>
	vec4 gatheredTexelMins = min(min(gatheredTexelValues1, gatheredTexelValues2),<font></font>
                                 min(gatheredTexelValues3, gatheredTexelValues4));<font></font>
	<span class="hljs-keyword">float</span> finalMin = min(min(gatheredTexelMins.x, gatheredTexelMins.y),<font></font>
                         min(gatheredTexelMins.z, gatheredTexelMins.w));<font></font>
	atomicMin(s_workgroupMinDepthEncodedAsUint, floatBitsToUint(finalMin));<font></font>
<font></font>
	memoryBarrierShared();<font></font>
	barrier();<font></font>
<font></font>
    <span class="hljs-comment">// Thread 0 writes workgroup-wide min to image. </span>
	<span class="hljs-keyword">if</span> (gl_LocalInvocationIndex == <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">float</span> workgroupMinDepth = uintBitsToFloat(s_workgroupMinDepthEncodedAsUint);<font></font>
<font></font>
		imageStore(u_outputDownsampledMinDepthBufferImage,<font></font>
		           ivec2(gl_WorkGroupID.xy),<font></font>
                   <span class="hljs-comment">// imageStore can only be passed vec4, but only a float is stored. </span><font></font>
				   vec4(workgroupMinDepth));<font></font>
	}<font></font>
}</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actuaci√≥n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Utilic√© el sombreador computacional anterior para procesar el b√∫fer de profundidad de resoluci√≥n completa con las mismas dimensiones que se usaron para generar la cadena de mip completa (b√∫feres de 1648x1776 para cada ojo). </font><font style="vertical-align: inherit;">Se ejecuta en 0.12 ms en el NVIDIA GTX 980 y 0.08 ms en el AMD R9 290. Si lo comparamos con el tiempo de generaci√≥n de solo niveles mip 1-4 (0.22 ms en NVIDIA, 0.25 ms AMD), entonces La soluci√≥n con un sombreador computacional result√≥ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser 87% m√°s r√°pida con las GPU NVIDIA</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">197% m√°s r√°pida que las GPU AMD</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En t√©rminos absolutos, la aceleraci√≥n no es tan grande, pero cada 0.1 ms es importante, especialmente en VR :)</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es494364/index.html">GDPR: consentimiento para el procesamiento de datos personales</a></li>
<li><a href="../es494366/index.html">Mitaps en l√≠nea para toda la semana, a partir del 27 de marzo (en la parte posterior, m√≥vil, QA, PM y todo)</a></li>
<li><a href="../es494370/index.html">Arquitectura limpia a trav√©s de los ojos de un desarrollador de Python</a></li>
<li><a href="../es494372/index.html">Software de verificaci√≥n totalmente ruso: una vista interior</a></li>
<li><a href="../es494374/index.html">Autobuses el√©ctricos y sus bater√≠as: ¬øqu√© es el titanato de litio? (Parte 1)</a></li>
<li><a href="../es494380/index.html">Introducci√≥n a la gesti√≥n estrat√©gica de productos</a></li>
<li><a href="../es494384/index.html">Encuesta funcional</a></li>
<li><a href="../es494390/index.html">La impresi√≥n 3D reduce los costos de autoajuste a la mitad</a></li>
<li><a href="../es494394/index.html">Xia Peysu: madre de la inform√°tica china</a></li>
<li><a href="../es494396/index.html">Bienvenido Mat - ahora tambi√©n en ruso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>