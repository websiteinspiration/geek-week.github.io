<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙏🏼 🧑🏾‍🤝‍🧑🏻 📣 ¿Cómo ayudar a los pandas a procesar grandes cantidades de datos? 👨‍🚒 💆🏾 🍠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La biblioteca de pandas es una de las mejores herramientas para el análisis exploratorio de datos . Pero esto no significa que los pandas sean una her...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>¿Cómo ayudar a los pandas a procesar grandes cantidades de datos?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/500428/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La biblioteca de pandas es una de las mejores herramientas para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el análisis exploratorio de datos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pero esto no significa que los pandas sean una herramienta universal adecuada para resolver cualquier problema. En particular, estamos hablando de procesar grandes cantidades de datos. Pasé un tiempo muy, muy largo, esperando que los pandas leyeran muchos archivos o los procesaran, calculando sobre la base de la información contenida en ellos algunos indicadores que me interesan. El hecho es que los pandas no admiten mecanismos paralelos de procesamiento de datos. Como resultado, este paquete no aprovecha al máximo las capacidades de los modernos procesadores multi-core. Grandes conjuntos de datos en pandas se procesan lentamente.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/jp/tu/xh/jptuxhdfys8yd3jjgajrmfg7rl4.jpeg"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Recientemente, me propuse encontrar algo que me ayudara en el procesamiento de big data. </font><font style="vertical-align: inherit;">Logré encontrar lo que estaba buscando, incruste la herramienta encontrada en mi canal de procesamiento de datos. </font><font style="vertical-align: inherit;">Lo uso para trabajar con grandes cantidades de datos. </font><font style="vertical-align: inherit;">Por ejemplo, para leer archivos que contienen 10 gigabytes de datos, para filtrarlos y agregarlos. </font><font style="vertical-align: inherit;">Cuando logro resolver tales problemas, guardo lo que obtuve en un archivo CSV más pequeño que es adecuado para pandas, y luego empiezo a trabajar con los datos obtenidos usando pandas. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aquí hay</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> un cuaderno Jupyter que contiene ejemplos de este material con los que puede experimentar.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La herramienta que uso para procesar grandes cantidades de datos es la biblioteca </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dask</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es compatible con el procesamiento de datos en paralelo, lo que le permite acelerar el trabajo de las herramientas existentes. </font><font style="vertical-align: inherit;">Esto incluye numpy, pandas y sklearn. </font><font style="vertical-align: inherit;">Dask es un proyecto de código abierto gratuito. </font><font style="vertical-align: inherit;">Utiliza API de Python y estructuras de datos, lo que facilita la integración de Dask en proyectos existentes. </font><font style="vertical-align: inherit;">Si describimos brevemente Dask, entonces podemos decir que esta biblioteca simplifica la solución de problemas ordinarios y hace posible resolver problemas de enorme complejidad.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparando pandas y dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puedo describir las posibilidades de Dask aquí, ya que esta biblioteca tiene muchas cosas interesantes, pero en cambio, solo considero un ejemplo práctico. </font><font style="vertical-align: inherit;">En el curso del trabajo, generalmente encuentro conjuntos de archivos grandes, cuyos datos deben ser analizados. </font><font style="vertical-align: inherit;">Juguemos una de mis tareas típicas y creemos 10 archivos, cada uno de los cuales contiene 100,000 registros. </font><font style="vertical-align: inherit;">Cada archivo tiene un tamaño de 196 MB.</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> make_classification
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">'Generating trainset %d'</span> % i)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;x, y = make_classification(n_samples=<span class="hljs-number">100</span>_000, n_features=<span class="hljs-number">100</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df = pd.DataFrame(data=x)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df[<span class="hljs-string">'y'</span>] = y<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df.to_csv(<span class="hljs-string">'trainset_%d.csv'</span> % i, index=<span class="hljs-literal">False</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora lea estos archivos con pandas y mida el tiempo requerido para leerlos. </font><font style="vertical-align: inherit;">No hay soporte integrado en pandas </font></font><code>glob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por lo que tenemos que leer los archivos en un bucle:</font></font><br>
<br>
<pre><code class="python hljs">%%time
<span class="hljs-keyword">import</span> glob<font></font>
df_list = []<font></font>
<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">'trainset_*.csv'</span>):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df_ = pd.read_csv(filename)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;df_list.append(df_)<font></font>
df = pd.concat(df_list)<font></font>
df.shape<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los pandas tardaron 16 segundos en leer estos archivos:</font></font><br>
<br>
<pre><code class="python hljs">CPU times: user <span class="hljs-number">14.6</span> s, sys: <span class="hljs-number">1.29</span> s, total: <span class="hljs-number">15.9</span> s<font></font>
Wall time: <span class="hljs-number">16</span> s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si hablamos de Dask, se puede notar que esta biblioteca le permite procesar archivos que no caben en la memoria. </font><font style="vertical-align: inherit;">Esto se hace dividiéndolos en bloques y compilando cadenas de tareas. </font><font style="vertical-align: inherit;">Midamos el tiempo que Dask necesita para leer estos archivos:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> dask.dataframe <span class="hljs-keyword">as</span> dd<font></font>
%%time<font></font>
df = dd.read_csv(<span class="hljs-string">'trainset_*.csv'</span>)<font></font>
CPU times: user <span class="hljs-number">154</span> ms, sys: <span class="hljs-number">58.6</span> ms, total: <span class="hljs-number">212</span> ms<font></font>
Wall time: <span class="hljs-number">212</span> ms
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¡Dask tardó 154 ms! </font><font style="vertical-align: inherit;">Como es esto posible? </font><font style="vertical-align: inherit;">De hecho, esto no es posible. </font><font style="vertical-align: inherit;">Dask implementa un paradigma de tarea retrasada. </font><font style="vertical-align: inherit;">Los cálculos se realizan solo cuando se necesitan sus resultados. </font><font style="vertical-align: inherit;">Describimos el gráfico de ejecución, que le da a Dask la capacidad de optimizar la ejecución de tareas. </font><font style="vertical-align: inherit;">Repite el experimento. </font><font style="vertical-align: inherit;">Tenga en cuenta que la función </font></font><code>read_csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de Dask tiene soporte incorporado para trabajar con </font></font><code>glob</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs">%%time<font></font>
df = dd.read_csv(<span class="hljs-string">'trainset_*.csv'</span>).compute()<font></font>
CPU times: user <span class="hljs-number">39.5</span> s, sys: <span class="hljs-number">5.3</span> s, total: <span class="hljs-number">44.8</span> s<font></font>
Wall time: <span class="hljs-number">8.21</span> s
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El uso de la función </font></font><code>compute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obliga a Dask a devolver el resultado, para lo cual debe leer realmente los archivos. </font><font style="vertical-align: inherit;">El resultado es que Dask lee archivos dos veces más rápido que los pandas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se puede decir que Dask le permite equipar proyectos de Python con herramientas de escala.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparación del uso de CPU en Pandas y Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Dask utiliza todos los núcleos de procesador en el sistema? </font><font style="vertical-align: inherit;">Compare el uso de los recursos del procesador en pandas y en Dask al leer archivos. </font><font style="vertical-align: inherit;">El mismo código que revisamos anteriormente se aplica aquí.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc4/365/628/bc4365628d41d261946f440ee9929726.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de recursos del procesador al leer archivos con pandas</font></font></font></i><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/464/ded/88d/464ded88d73b2fc52c06b8ad31fb6533.gif"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso de recursos del procesador al leer archivos con Dask</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Un par de las imágenes animadas anteriores le permiten ver claramente cómo los pandas y Dask usan los recursos del procesador al leer archivos.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Qué pasa en las entrañas de Dask?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un marco de datos de Dask consta de varios marcos de datos de pandas, que están separados por índices. </font><font style="vertical-align: inherit;">Cuando ejecutamos una función </font></font><code>read_csv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desde Dask, lee el mismo archivo mediante varios procesos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluso podemos visualizar un gráfico de esta tarea.</font></font><br>
<br>
<pre><code class="python hljs">exec_graph = dd.read_csv(<span class="hljs-string">'trainset_*.csv'</span>)<font></font>
exec_graph.visualize()<font></font>
</code></pre><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/123/e8b/383/123e8b383276d05a51f8b1cc34cdd74f.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gráfico de tiempo de ejecución de Dask al leer varios archivos</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desventajas de Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quizás ahora tenga el siguiente pensamiento: "Si la biblioteca Dask es tan buena, ¿por qué no usarla en lugar de pandas?" </font><font style="vertical-align: inherit;">Pero no tan simple. </font><font style="vertical-align: inherit;">Solo algunas funciones de pandas se portan a Dask. </font><font style="vertical-align: inherit;">El hecho es que ciertas tareas son difíciles de paralelizar. </font><font style="vertical-align: inherit;">Por ejemplo, ordenar datos y asignar índices a columnas sin clasificar. </font><font style="vertical-align: inherit;">Dask no es una herramienta que resuelva absolutamente todas las tareas de análisis y procesamiento de datos. </font><font style="vertical-align: inherit;">Se recomienda usar esta biblioteca solo para trabajar con conjuntos de datos que no caben en la memoria por completo. </font><font style="vertical-align: inherit;">Dado que la biblioteca Dask se basa en pandas, todo lo que funciona lentamente en pandas permanecerá lento en Dask. </font><font style="vertical-align: inherit;">Como dije antes, Dask es una herramienta útil que puede incrustar en una tubería de procesamiento de datos, pero esta herramienta no reemplaza a otras bibliotecas.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instalar Dask</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para instalar Dask, puede usar el siguiente comando:</font></font><br>
<br>
<pre><code class="python hljs">python -m pip install <span class="hljs-string">"dask[complete]"</span>
</code></pre><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este artículo, solo toqué superficialmente las capacidades de Dask. </font><font style="vertical-align: inherit;">Si está interesado en esta biblioteca, eche un vistazo a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> excelentes tutoriales sobre Dask y la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentación</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de datafreymam Dask. </font><font style="vertical-align: inherit;">Y si desea saber qué funciones son compatibles con los marcos de datos de Dask, lea la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descripción de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la </font><font style="vertical-align: inherit;">API </font></font><code>DataFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Usarías la biblioteca Dask?</font></font></b><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le recordamos que continuamos con </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el concurso de predicción</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el que puede ganar un nuevo iPhone. </font><font style="vertical-align: inherit;">Todavía hay tiempo para entrar y hacer el pronóstico más preciso sobre los valores tópicos.</font></font></blockquote><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/a_/bs/aa/a_bsaactpbr8fltzymtkhqbw1d4.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es500418/index.html">Nuevos cálculos de terremotos predicen su probable destructividad</a></li>
<li><a href="../es500420/index.html">sMock - Marco de burla rápida para pruebas unitarias (gracias gMock por ideas)</a></li>
<li><a href="../es500422/index.html">Depurador visual para Jupyter</a></li>
<li><a href="../es500424/index.html">Uso diferido de la funcionalidad directiva en Angular</a></li>
<li><a href="../es500426/index.html">Python, pandas y resolviendo tres problemas del mundo de Excel</a></li>
<li><a href="../es500430/index.html">Cómo busqué trabajo en cuarentena</a></li>
<li><a href="../es500436/index.html">Procedente de redes neuronales binarias basadas en neuronas aleatorias y funciones lógicas.</a></li>
<li><a href="../es500438/index.html">SFTP y FTPS</a></li>
<li><a href="../es500444/index.html">9 habilidades de programación en Python que distinguen a un principiante de un experimentado</a></li>
<li><a href="../es500446/index.html">Algunas palabras sobre R2DBC y PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>