<!doctype html>
<html class="no-js" lang="id">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💹 👨🏼‍💼 🙏🏻 Bekerja dengan kartu SD melalui antarmuka SPI. Implementasi VHDL 😐 💟 🕋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai Habr! Setelah di kantor, saya mendapat tugas menilai kemungkinan menerapkan penyimpanan data pada kartu SD saat menghubungkannya ke FPGA. Pengguna...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Bekerja dengan kartu SD melalui antarmuka SPI. Implementasi VHDL</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495400/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hai Habr! </font><font style="vertical-align: inherit;">Setelah di kantor, saya mendapat tugas menilai kemungkinan menerapkan penyimpanan data pada kartu SD saat menghubungkannya ke FPGA. </font><font style="vertical-align: inherit;">Penggunaan SPI dianggap sebagai antarmuka interaksi, karena lebih mudah diimplementasikan. </font><font style="vertical-align: inherit;">Saya ingin berbagi pengalaman yang didapat.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ga/qw/p6/gaqwp6tekmw-myhnjrsmwo5cam8.png"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena ruang pada papan sirkuit tercetak selalu terbatas, pertimbangan kartu SD akan dilakukan pada contoh kartu dalam faktor bentuk microSD.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kandungan</font></font></h2><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Membaca spesifikasi </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 Informasi umum </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Inisialisasi </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Menghapus informasi </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 Membaca informasi </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.1 Membaca satu blok data </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.2 Membaca banyak blok data </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 Menulis informasi </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.1 Menulis satu blok data </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.2 Menulis banyak blok data </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Menerapkan algoritma dalam perangkat keras </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 Komponen dari lapisan fisik </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 Komponen tingkat perintah </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 Komponen komunikasi dengan dunia luar </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Verifikasi dalam perangkat keras </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Hasil</font></font></a><br>
<br>
<a name="SpecRead"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Spesifikasi membaca</font></font></h2><br>
<a name="GeneralInformation"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 Umum</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pembacaan cepat spesifikasi memberitahu kita opsi kartu SD berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transfer data ke kartu SD dilakukan pada satu baris; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">membaca data dari kartu SD dilakukan pada satu baris; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam mode SPI, daya hanya +3,3V; </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frekuensi clock dalam mode inisialisasi dalam kisaran 100-400 kHz;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frekuensi clock setelah inisialisasi - 25 MHz.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini langsung menyiratkan titik pada bandwidth puncak teoretis: 25 MHz * 1 bit = 25 Mb / s, yang </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agak</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kecil. </font><font style="vertical-align: inherit;">Yang kedua minus penggunaan SD-card, power + 3.3V. </font><font style="vertical-align: inherit;">Pada papan sirkuit tercetak yang rencananya akan dipasang kartu SD, tidak ada tegangan seperti itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kartu faktor bentuk MicroSD dapat dibagi menjadi 3 kategori berdasarkan kapasitas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDSC </font><font style="vertical-align: inherit;">Kapasitas kartu hingga 2 GB inklusif. </font><font style="vertical-align: inherit;">Alamat di dalam kartu adalah byte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDHC. </font><font style="vertical-align: inherit;">Kapasitas kartu lebih dari 2 GB dan inklusif hingga 32 GB. </font><font style="vertical-align: inherit;">Alamat di dalam kartu menunjukkan blok 512 byte.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDXC. </font><font style="vertical-align: inherit;">Kapasitas kartu lebih dari 32 GB dan hingga 128 TB inklusif. </font><font style="vertical-align: inherit;">Alamat di dalam kartu menunjukkan blok 512 byte.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tampilan umum peta ditunjukkan pada gambar di bawah ini. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/wp/qo/4d/wpqo4dulzwlonas-3evcspttvra.png"><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomor kontak</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nama</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebuah tipe</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskripsi</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSV</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak digunakan</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CS</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memasukkan</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemilihan chip</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DI</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memasukkan</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalur data dari perangkat Master (MOSI)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vdd</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrisi</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tegangan suplai</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SCLK</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memasukkan</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinyal jam</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vss</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrisi</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tanah</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MELAKUKAN</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keluaran</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalur Data ke Perangkat Utama (MISO)</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RSV</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak digunakan</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Koneksi dilakukan sesuai dengan diagram di bawah ini: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ey/jl/xj/eyjlxjhgg_iucbvd0ms-gzmjinu.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resistor harus diberi peringkat 50 kOhm</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Setelah menghidupkan daya, kartu SD dalam mode SDIO. </font><font style="vertical-align: inherit;">Untuk beralih ke mode SPI, Anda harus melakukan inisialisasi. </font><font style="vertical-align: inherit;">Protokol untuk bekerja dengan kartu melibatkan penggunaan skema kontrol untuk transfer data dan perintah yang benar dalam bentuk algoritma CRC. </font><font style="vertical-align: inherit;">Saat beroperasi dalam mode SPI, verifikasi CRC dinonaktifkan secara default. </font><font style="vertical-align: inherit;">Dengan demikian, perintah pertama yang dikirim ke kartu untuk mengalihkan kartu ke mode SPI harus berisi nilai CRC yang benar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perintah yang dikirimkan melalui antarmuka SPI berukuran 48 bit. </font><font style="vertical-align: inherit;">Format perintah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit 47 (paling kiri) selalu berisi nilai 0. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit 46 selalu berisi nilai 1.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bits 45..40 berisi indeks perintah.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bits 39..8 berisi argumen dari perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bits 7..1 berisi CRC dari bit sebelumnya. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bit 0 selalu mengandung nilai 1.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bits 47 dan 46 memberikan kartu kemampuan untuk secara jelas melacak awal transaksi, karena bus MOSI saat istirahat sama dengan satu. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/dd/ap/8n/ddap8nsdyqcbqezjudom42bzfx8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perintah yang digunakan saat bekerja dengan kartu SD akan menerima jawaban seperti R1, R3, R7. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/bt/xq/ce/btxqcevcwggh9qgt6pxznanb0pc.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jawaban dari tipe R1, ukuran 8 bit. </font></font></sub><font style="vertical-align: inherit;"><sub><font style="vertical-align: inherit;">Jenis jawaban R3, ukuran 40 bit. </font></sub><sub><font style="vertical-align: inherit;">Jenis jawaban R7, ukuran 40 bit. </font></sub><font style="vertical-align: inherit;">
Semua perintah dan jawaban mereka dirinci dalam </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Spesifikasi Fisik Sederhana Lapisan.</font></a></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/mu/dg/yb/mudgybpndrbrqpsz5icwgkb1prk.png"></a><br>
<sub><font style="vertical-align: inherit;"></font></sub><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/s-/vq/a8/s-vqa83la-g6k3bwgvvmmfoawms.png"></a><br>
<sub><font style="vertical-align: inherit;"></font></sub><br>
<br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><br>
<br>
<a name="Init"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Inisialisasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma Inisialisasi:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah menyalakan daya, tunggu setidaknya 1 ms.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasilkan minimum 74 jam switching untuk kartu. </font><font style="vertical-align: inherit;">Baris CS dan MOSI harus dalam keadaan unit logis.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasilkan perintah CMD0. </font><font style="vertical-align: inherit;">Perintah CMD0 me-reset kartu SD.</font></font></li>
<li>    CMD0.     R1.  ,   R1    16   ,    3.   R1   ,     0x01 (     ),    3,     5. </li>
<li>  CMD8.            . </li>
<li>    CMD8.     R7.  ,     ,    ,    7, ,           ,    17,    13. </li>
<li>  CMD55.  CMD55  ,     . </li>
<li>    CMD55.     R1.     0x01 (    ),    7,    9. </li>
<li>  ACMD41.  ACMD41  ,    SDSC ( 0x00000000)    . </li>
<li>    ACMD41.     R1.      ,    ,    11. ,    0x00 ( )    14,       7.</li>
<li>  CMD1.  CMD1   ACMD41.</li>
<li>    CMD1.     R1.       ,    ,    13, ,    0x00 ( ),    14,       11.</li>
<li> .   ,   .      . </li>
<li>  CMD16.          ,  512 . </li>
<li>    CMD16.     R1.  ,    0x00 (  )    16,    13. </li>
<li>   .       .   . </li>
<li>  CMD55.  CMD55  ,     . </li>
<li>    CMD55.     R1.     0x01 (    ),    17,    19. </li>
<li>  ACMD41.   ACMD41.  ACMD41  ,    SDHC ( 0x40000000)    .</li>
<li>    ACMD41.     R1.      ,    ,    13. ,    0x00 ( )    21,       17. </li>
<li>  CMD58.    . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu respons terhadap perintah CMD58. </font><font style="vertical-align: inherit;">Jawabannya adalah respons tipe R3. </font><font style="vertical-align: inherit;">Jika sedikit diatur dalam respons bahwa kartu bekerja dengan alamat blok 512 byte, lanjutkan ke langkah 16, jika tidak ke langkah 14.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah inisialisasi selesai, kartu dapat dioperasikan dalam blok 512 byte dengan frekuensi clock 25 MHz. </font><font style="vertical-align: inherit;">Ini adalah versi lengkap dari algoritma inisialisasi, yang mencakup semua jenis kartu. </font><font style="vertical-align: inherit;">Dalam kasus saya, ketika menggunakan kartu 16 GB, algoritma inisialisasi terdiri dari langkah 1-6, 17-22, 16.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritma Grafis</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/vp/di/pw/vpdipwdy4umv4iahsea1g2snruu.png"></a></div>
                    </div><br>
<a name="Erase"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Menghapus Informasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kartu faktor bentuk SD mikro mendukung perintah penghapusan. </font><font style="vertical-align: inherit;">Setelah perintah hapus, nilai dari alamat penghapusan yang ditentukan akan diisi dengan nilai 0xFF atau 0x00, tergantung pada kartu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma Penghapusan Informasi</font></font><br>
<br>
<ol>
<li>  CMD32.        .</li>
<li>    CMD32.     R1.       0x00 ( -    ),    3,    4.</li>
<li> .   ,     . </li>
<li>  CMD33.        .        ,        CMD32. </li>
<li>    CMD33.     R1.       0x00 ( -    ),    3,    6 </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim perintah CMD38. </font><font style="vertical-align: inherit;">Perintah untuk menghapus informasi dari blok yang dipilih. </font><font style="vertical-align: inherit;">Setiap 4 byte harus dikirim sebagai argumen, kecuali untuk nilai 0x00000001, 0x00000002.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu respons terhadap perintah CMD38. </font><font style="vertical-align: inherit;">Jawabannya adalah respons tipe R1b. </font><font style="vertical-align: inherit;">Ini adalah versi jawaban yang diperpanjang ketika kartu menghasilkan respons R1, dan kemudian menarik garis MISO ke nol, menunjukkan chip sedang sibuk. </font><font style="vertical-align: inherit;">Penting untuk menunggu sampai nilai unit muncul pada baris MISO. </font><font style="vertical-align: inherit;">Jika jawabannya tidak 0x00 (ada beberapa kesalahan saat menjalankan perintah), lanjutkan ke langkah 3, jika tidak ke langkah 8</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyelesaian algoritma penghapusan. </font></font></li>
</ol><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritma Grafis</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/hm/qs/cq/hmqscqj62emd9yp30prqqasyjjm.png"></a></div>
                    </div><br>
<a name="Read"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4 Membaca informasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Membaca informasi dari kartu SD melalui SPI dimungkinkan dengan dua cara.</font></font><br>
<br>
<a name="ReadOne"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.1 Membaca blok data tunggal</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat membaca satu blok data, perangkat Master menghasilkan perintah untuk kartu SD untuk membaca satu blok data, menunggu respons bahwa perintah telah diproses dan sedang menunggu paket dengan data dari kartu. </font><font style="vertical-align: inherit;">Setelah menerima paket dengan data dari kartu, transaksi baca berakhir. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/g_/oe/q_/g_oeq_mpttrajxmeltmmb5hpl28.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilan umum dari transaksi yang membaca satu blok data. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Awalnya, opsi seperti itu diterapkan, tetapi kecepatan yang dihasilkan sangat marah (perbandingan kecepatan akan lebih rendah).</font></font><br>
<br>
<a name="ReadMore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4.2 Membaca beberapa blok data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat membaca beberapa blok data, perangkat Master menghasilkan perintah untuk kartu SD untuk membaca beberapa blok data, menunggu respons bahwa perintah telah diproses, dan mengharapkan paket data dari kartu. </font><font style="vertical-align: inherit;">Setelah mengirim paket data, kartu mengirimkan paket data berikutnya. </font><font style="vertical-align: inherit;">Ini akan berlanjut sampai perintah diterima dari perangkat Master untuk menyelesaikan pembacaan. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ai/ed/tz/aiedtzc1nfh__byzfhuozjnstjc.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilan umum dari transaksi yang membaca banyak blok data. </font></font></sub><br>
<br>
<img src="https://habrastorage.org/webt/i8/ko/9l/i8ko9lasfzqwjehte6q6yg8bs1w.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Struktur Paket Data</font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Di mana:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token Data </font><font style="vertical-align: inherit;">Perintah baca menggunakan nilai 0xFE.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blok Data. </font><font style="vertical-align: inherit;">Berisi data yang dibaca dari kartu.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRC </font><font style="vertical-align: inherit;">Berisi checksum dari bidang sebelumnya.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika kesalahan terjadi saat membaca, kartu bukannya Data Token mengembalikan Token Kesalahan. </font><font style="vertical-align: inherit;">Ukuran Token Galat adalah 1 byte. </font><font style="vertical-align: inherit;">Bits 7..5 berisi nilai nol, bit 4..0 mengkodekan jenis kesalahan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma untuk membaca beberapa blok data:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim perintah CMD18. </font><font style="vertical-align: inherit;">Perintah memberi tahu kartu bahwa banyak blok akan dibaca.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu respons terhadap perintah CMD18. </font><font style="vertical-align: inherit;">Jawabannya adalah respons tipe R1. </font><font style="vertical-align: inherit;">Jika jawabannya tidak 0x00 (ada beberapa kesalahan saat menjalankan perintah), lanjutkan ke langkah 3, jika tidak ke langkah 4.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status kesalahan. </font><font style="vertical-align: inherit;">Gagal membaca, keluar dari algoritma membaca.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu tanda dari kartu. </font><font style="vertical-align: inherit;">Jika Token Kesalahan diterima dari kartu, lanjutkan ke langkah 3, jika tidak, lanjutkan ke langkah 5.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terima dari kartu blok data berukuran 512 byte. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terima dari ukuran kartu CRC bidang 2 byte. </font></font></li>
<li>    .     ,    8,    4. </li>
<li>  CMD12.       .  ,       Data Packet,   . </li>
<li>     CMD12.     R1b.     R1,         MISO  ,   .      MISO  ,      .       0x00 ( -    ),    3,    10.</li>
<li>  . </li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada sedikit nuansa dalam algoritma membaca. </font><font style="vertical-align: inherit;">Sinyal pilih chip (CS) harus diatur ke logika nol sebelum membuat perintah CMD18 dan diatur ke logika satu setelah menerima respons terhadap perintah CMD12.</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritma Grafis</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/ht/8f/uf/ht8fufwcf9qq-bdrif-4chjd5cg.png"></a></div>
                    </div><br>
<a name="Write"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 Merekam Informasi</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Menulis informasi ke kartu SD melalui antarmuka SPI dimungkinkan dalam dua versi.</font></font><br>
<br>
<a name="WriteOne"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.1 Menulis satu blok data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat merekam satu blok data, perangkat Master menghasilkan perintah untuk kartu SD untuk menulis satu blok data, menunggu respons dari kartu bahwa perintah telah diproses, mentransmisikan paket dengan data untuk merekam ke kartu, mengharapkan respons dari kartu bahwa data ditulis, menyelesaikan transaksi. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/u1/j5/7f/u1j57f-xmwqesdk1yzw_fenwvmi.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilan umum dari transaksi tulis dari satu blok data. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti halnya membaca, catatan satu blok data awalnya diimplementasikan. </font><font style="vertical-align: inherit;">Hasil kecepatannya tidak memuaskan.</font></font><br>
<br>
<a name="WriteMore"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5.2 Menulis banyak blok data</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat merekam beberapa blok data, perangkat Master menghasilkan perintah untuk merekam beberapa blok data, menunggu respons dari kartu bahwa perintah telah diproses, mentransmisikan paket dengan data untuk merekam ke kartu, mengharapkan respons dari kartu bahwa data dicatat. </font><font style="vertical-align: inherit;">Setelah menerima respons Master, perangkat mentransmisikan paket dengan data berikut untuk direkam ke kartu. </font><font style="vertical-align: inherit;">Ini akan berlanjut sampai perangkat Master mengirim Token Data Stop. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/-p/l7/fz/-pl7fz2rfyuv5akb7ksrcwdipsy.png"><br>
<sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilan umum dari transaksi tulis untuk beberapa blok data. </font></font></sub><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Struktur Paket Data mirip dengan struktur Paket Data saat membaca data. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Format:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token Data </font><font style="vertical-align: inherit;">Untuk perintah tulis, nilai 0xFC digunakan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blok Data. </font><font style="vertical-align: inherit;">Berisi data yang ditulis ke kartu.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRC </font><font style="vertical-align: inherit;">Berisi checksum dari bidang sebelumnya.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stop Tran Token yang digunakan untuk menyelesaikan perintah tulis berukuran 1 byte dan sama dengan 0xFD. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah bit terakhir dari Paket Data dimasukkan ke dalam kartu, kartu merespons jam berikutnya dengan status catatan data - Respons Data. </font><font style="vertical-align: inherit;">Respons Data memiliki ukuran 1 byte, bit 7..5 dapat berupa apa saja, bit 4 selalu nol, bit 0 selalu sama dengan satu, bit 3..1 mengkodekan status catatan data. </font><font style="vertical-align: inherit;">Setelah kartu mengembalikan Paket Data, kartu menarik garis MISO ke nol, menunjukkan kartu sibuk. </font><font style="vertical-align: inherit;">Setelah level unit logis pada garis MISO, Anda dapat mentransfer paket data berikutnya ke kartu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma untuk merekam beberapa blok data:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengirim perintah CMD25. </font><font style="vertical-align: inherit;">Perintah memberi tahu kartu bahwa beberapa blok akan ditulis.</font></font></li>
<li>    CMD25.     R1.       0x00 ( -    ),    3,    4.</li>
<li> .   ,   . </li>
<li>   . </li>
<li>   512   . </li>
<li>    CRC  2 . </li>
<li> Data Response  .       ,    3,    8. </li>
<li>   .     ,    9,    4. </li>
<li> Stop Tran Token.   ,     . </li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu respons dari kartu. </font><font style="vertical-align: inherit;">Kartu pada Stop Tran Token menarik garis MISO ke nol, menunjukkan kartu sibuk. </font><font style="vertical-align: inherit;">Kita perlu menunggu di baris MISO untuk nilai unit, yang akan menunjukkan akhir dari perintah</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penyelesaian algoritma perekaman. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ada juga nuansa kecil dalam algoritma perekaman. </font><font style="vertical-align: inherit;">Sinyal pilih chip (CS) harus diatur ke logika nol sebelum membuat perintah CMD25 dan diatur ke logika satu setelah menerima respons untuk Stop Tran Token</font></font><br>
<br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritma Grafis</font></font></b>
                        <div class="spoiler_text"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/_9/kt/ts/_9kttsrffln_gmvgw-l4ch0ekva.png"></a></div>
                    </div><br>
<a name="Hardware"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Implementasi algoritma dalam perangkat keras</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai hasil dari membaca spesifikasi, kami mendapatkan beberapa karakteristik dari algoritma yang perlu diimplementasikan dalam perangkat keras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mode operasi yang memungkinkan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembentukan frekuensi awal. </font><font style="vertical-align: inherit;">Baris CS dan MOSI harus dalam keadaan unit logis.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Transfer data ke kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terima data dari kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu selesainya tim. </font><font style="vertical-align: inherit;">Ini digunakan ketika, setelah menghasilkan respons, kartu SD menarik garis MISO ke nol untuk menunggu munculnya unit.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baca respons saat menulis data. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menunggu tanda saat membaca data. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mode jam yang memungkinkan:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinyal jam untuk diinisialisasi. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sinyal jam untuk bekerja. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dari sudut pandang saya, algoritma diimplementasikan secara optimal menggunakan tiga komponen:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponen lapisan fisik, yang terhubung langsung ke kartu SD, menghasilkan sinyal SCLK, CS, DI, dibaca dengan DO. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponen tingkat perintah yang menyiapkan semua data untuk komponen di lapisan fisik. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Komponen komunikasi dengan dunia luar yang menyembunyikan seluruh perangkat internal dan menyediakan antarmuka untuk perintah (membaca, menulis, menghapus) dan data.</font></font></li>
</ul><br>
<a name="HwPhy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1 Komponen lapisan fisik</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SDPhy <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Control bus</span>
			iPhyTxData	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">9</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iPhyMode	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">4</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iPhyTxWrite	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oPhyTxReady	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>; 
			<span class="hljs-comment">-- Out Data</span>
			oPhyRxData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">7</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>); <font></font>
			oPhyRxWrite	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oPhyCmdEnd	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> ); 
<span class="hljs-keyword">end</span> SDPhy;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimana:</font></font><br>
<br>
<ul>
<li> iPhyTxData    ,  iPhyMode  ,    . </li>
<li>iPhyTxWrite ,    iPhyTxData  iPhyMode . </li>
<li>oPhyTxReady ,      .     FULL FIFO,    .</li>
<li>oPhyRxData   ,   SD-.</li>
<li>oPhyRxWrite ,     oPhyRxData . </li>
<li>oPhyCmdEnd ,     .</li>
<li>oSdCS    (CS)  SD-. </li>
<li>oSdClk    SD-.</li>
<li>oSdMosi     SD-.</li>
<li>oSdMosiT        SD-.</li>
<li>iSdMiso     SD-. </li>
<li>sclk      SD- (50 ).</li>
<li>pclk  ,     .</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sinyal reset pertama, level aktif satu.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam FPGA, ada unit khusus untuk bekerja dengan sinyal clock (PLL, MMCM), namun, menerima sinyal clock kurang dari 5 MHz dari outputnya bermasalah. </font><font style="vertical-align: inherit;">Akibatnya, lapisan fisik beroperasi pada frekuensi 50 MHz. </font><font style="vertical-align: inherit;">Bersama dengan setiap data dalam sinyal iPhyMode, sedikit diterima yang menunjukkan pada frekuensi berapa data ini harus ditransfer ke kartu SD (atau diterima dari itu). </font><font style="vertical-align: inherit;">Tergantung pada bit kecepatan, Jam mengaktifkan sinyal yang dihasilkan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dua automata diimplementasikan dalam komponen lapisan fisik, untuk mentransfer data ke kartu SD dan untuk menerima data dari itu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode mesin untuk transfer data: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status SDummy menyediakan pembentukan frekuensi awal, 128 switching. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status STxBits menyediakan transfer data ke kartu SD. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kode mesin untuk menerima data: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status sRxBits menyediakan penerimaan data dari kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status sBusy memastikan bahwa kartu SD siap (kartu melepaskan garis MISO ke tingkat unit). </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status sResp mengimplementasikan membaca respons saat menulis data. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status sToken menerapkan token wait saat membaca data. </font></font></li>
</ul><br>
<a name="HwCmd"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2 Komponen tingkat perintah</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SdCommand <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Command from host</span>
			oSdInitComp	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdInitFail	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdAddress	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdStartErase	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdStartRead	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdStartWrite	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdCmdFinish	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">1</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdhcPresent	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Data</span>
			oSdReadData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdDataR	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdWriteData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdDataW	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">32</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimana:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdInitComp menandatangani penyelesaian inisialisasi kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tanda oSdInitFail tentang kegagalan inisialisasi. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alamat iSdAddress di kartu SD untuk menjalankan perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartErase mulai menghapus eksekusi perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartRead mulai membaca eksekusi perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStartWrite mulai menulis eksekusi perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status penyelesaian tim oSdCmdFinish. </font><font style="vertical-align: inherit;">Bit nol sama dengan satu, perintah selesai dengan sukses. </font><font style="vertical-align: inherit;">Bit pertama adalah satu, perintah selesai dengan kesalahan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdhcSajikan bendera deteksi kartu SDHC / SDXC. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdReadData Membaca data untuk menulis ke kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data iSdDataR untuk menulis ke kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bendera oSdWriteData untuk menulis data yang dibaca dari kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data oSdDataW membaca dari kartu SD.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinyal yang tersisa bertepatan dengan sinyal dari lapisan fisik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Komponen ini memiliki 5 mesin otomatis.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdInit ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - inisialisasi kartu SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdErase ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - hapus data dari kartu SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdRead ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - baca data dari kartu SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdWrite ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - menulis data ke kartu SD.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smSdCommand ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - berdasarkan fitur yang dihasilkan menyiapkan data untuk lapisan fisik dari semua mesin sebelumnya.</font></font></li>
</ul><br>
<a name="HwHost"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3 Komponen komunikasi dengan dunia luar</font></font></h3><br>
<pre><code class="vhdl hljs"><span class="hljs-keyword">entity</span> SdHost <span class="hljs-keyword">is</span>
	<span class="hljs-keyword">generic</span>	(	gTCQ		: <span class="hljs-built_in">time</span> := <span class="hljs-number">2</span> ns );
	<span class="hljs-keyword">port</span>	(	<span class="hljs-comment">-- Sd Host command</span>
			iSdCommand	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">2</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdAddress	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdStart	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdStatus	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>( <span class="hljs-number">1</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdInitFail	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Write data to card</span>
			iSdTxData	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			iSdTxValid	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdTxLast	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdTxReady	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Read data from card</span>
			oSdRxData	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic_vector</span>(<span class="hljs-number">31</span> <span class="hljs-keyword">downto</span> <span class="hljs-number">0</span>);<font></font>
			oSdRxValid	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdRxLast	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdRxReady	: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- Spi</span>
			oSdCS		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdClk		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosi		: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			oSdMosiT	: <span class="hljs-keyword">out</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			iSdMiso		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;
			<span class="hljs-comment">-- system</span>
			pclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			sclk		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span>;<font></font>
			rst		: <span class="hljs-keyword">in</span>	<span class="hljs-built_in">std_logic</span> );
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dimana:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kode perintah iSdCommand untuk dieksekusi. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdAddress adalah alamat untuk menjalankan perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdStart memulai eksekusi perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status penyelesaian tim oSdStatus. </font><font style="vertical-align: inherit;">Bit nol sama dengan satu - perintah selesai. </font><font style="vertical-align: inherit;">Bit pertama adalah satu - perintah dilengkapi dengan kesalahan.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tanda oSdInitFail tentang kegagalan inisialisasi. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxData. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk menulis data ke kartu SD. </font><font style="vertical-align: inherit;">Port dengan data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxValid. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk menulis data ke kartu SD. </font><font style="vertical-align: inherit;">Port dengan sinyal tulis.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdTxLast. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk menulis data ke kartu SD. </font><font style="vertical-align: inherit;">Port dengan tanda dw terakhir dalam data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdTxReady. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk menulis data ke kartu SD. </font><font style="vertical-align: inherit;">Port dengan tanda kesiapan untuk menerima data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxData. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk membaca data dari kartu SD. </font><font style="vertical-align: inherit;">Port dengan data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxValid. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk membaca data dari kartu SD. </font><font style="vertical-align: inherit;">Port dengan sinyal tulis.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oSdRxLast. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk membaca data dari kartu SD. </font><font style="vertical-align: inherit;">Port dengan tanda dw terakhir dalam data.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iSdRxReady. </font><font style="vertical-align: inherit;">Antarmuka Axi-Stream untuk membaca data dari kartu SD. </font><font style="vertical-align: inherit;">Port dengan tanda kesiapan untuk menerima data.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sinyal yang tersisa bertepatan dengan sinyal dari lapisan fisik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Komponen mengimplementasikan satu mesin smSdControl ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keadaan lemah. </font><font style="vertical-align: inherit;">Menunggu inisialisasi dan perintah selesai.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keadaan sWaitCmd. </font><font style="vertical-align: inherit;">Memeriksa jenis perintah.</font></font></li>
<li>sReadCmd.    FIFO,   ,     SD-      . </li>
<li>sWriteCmd. ,   FIFO      SD-,      . </li>
<li>sEraseCmd.     . </li>
<li>sWaitEnd.       . </li>
<li>sFinish.   ,  . </li>
</ul><br>
<a name="RealTest"></a><h2>3.   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritma ditulis, diverifikasi dalam simulator. </font><font style="vertical-align: inherit;">Perlu untuk memeriksa sekarang di setrika. </font><font style="vertical-align: inherit;">Dari apa yang tersedia, papan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zybo dari Digilent muncul,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
memiliki terminal FPGA gratis di bank dengan tegangan + 3.3V, yang Anda dapat dengan mudah menghubungkan perangkat eksternal. </font><font style="vertical-align: inherit;">Ya, dan jenis FPGA yang digunakan adalah Zynq-7000, yang berarti ada inti prosesor. </font><font style="vertical-align: inherit;">Anda dapat menulis tes dalam C, yang akan menyederhanakan tugas pengujian. </font><font style="vertical-align: inherit;">
Jadi, kami menghubungkan algoritma yang diimplementasikan ke inti prosesor melalui port GP (operasi 4-byte dimungkinkan, mirip dengan </font><abbr title="Programmed input/output"><font style="vertical-align: inherit;">PIO</font></abbr><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Kami tidak akan repot dengan gangguan, kami menerapkan jajak pendapat waktu. </font><font style="vertical-align: inherit;">
Saat bekerja pada modul prosesor, algoritma perekaman data adalah sebagai berikut:</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/oe/oy/nj/oeoynjbbxwco9wrihj-f3unb3cs.png"></a><br>
<br><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><abbr title="Input / output terprogram"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan alamat dalam kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setel kode perintah 2. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tulis data ke buffer yang terletak di logika yang dapat diprogram. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalankan perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tunggu sampai perintah selesai. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setel ulang status penyelesaian tim.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes yang Diimplementasikan:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress ++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data write to %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">2</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Write data to PL */</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1024</span>; i++)<font></font>
	{<font></font>
		Xil_Out32(<span class="hljs-number">0x43c00014</span>, cntrData);<font></font>
		cntrData++;<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in write \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Duration operation */</span><font></font>
	durationWrite += cntrDuration;<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cntrDuration &gt; MaxWrite )<font></font>
	{<font></font>
		MaxWrite = cntrDuration;<font></font>
	}<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk pertanyaan mengapa batas luar 1024 digunakan dalam loop. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritma menetapkan jumlah blok sama dengan 8.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ukuran satu blok adalah 512 byte. </font><font style="vertical-align: inherit;">Ukuran total 8 blok data adalah 8 * 512 byte = 4096 byte. </font><font style="vertical-align: inherit;">Bus antara modul prosesor dan logika yang dapat diprogram berukuran 4 byte. </font><font style="vertical-align: inherit;">Ternyata untuk mengirim 4.096 byte dari 4 byte dari modul prosesor ke logika yang dapat diprogram, perlu untuk melakukan 4096/4 = 1024 operasi tulis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat mengerjakan modul prosesor, algoritme pembacaan data adalah sebagai berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan alamat dalam kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan kode perintah 1. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalankan perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tunggu sampai perintah selesai. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setel ulang status penyelesaian tim.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baca data dari buffer dalam logika yang dapat diprogram. </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes yang Diimplementasikan:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data read from %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			 <span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in read \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	 <span class="hljs-comment">/** Duration operation */</span><font></font>
	 durationRead += cntrDuration;<font></font>
<font></font>
	 <span class="hljs-keyword">if</span> (cntrDuration &gt; MaxRead )<font></font>
	 {<font></font>
		 MaxRead = cntrDuration;<font></font>
	 }<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Read data from PL */</span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1024</span>; i++)<font></font>
	{<font></font>
		DataR = Xil_In32(<span class="hljs-number">0x43c0001c</span>);
		<span class="hljs-keyword">if</span> (DataR != cntrData)<font></font>
		{<font></font>
			xil_printf(<span class="hljs-string">"Data corrupt! \n\r"</span>);<font></font>
		}<font></font>
		DataR = Xil_In32(<span class="hljs-number">0x43c00020</span>);<font></font>
		cntrData++;<font></font>
	}<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saat bekerja pada modul prosesor, algoritma penghapusan data adalah sebagai berikut:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan alamat dalam kartu SD. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetapkan kode perintah 4. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalankan perintah. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tunggu sampai perintah selesai. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setel ulang status penyelesaian tim.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tes yang Diimplementasikan:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">for</span> (SectorAddress = <span class="hljs-number">0</span>; SectorAddress &lt; <span class="hljs-number">1048576</span>; SectorAddress++)<font></font>
{<font></font>
	<span class="hljs-keyword">if</span> ((SectorAddress % <span class="hljs-number">1024</span>) == <span class="hljs-number">0</span>)<font></font>
	{<font></font>
		xil_printf(<span class="hljs-string">"Data erase from %d sector \n\r"</span>, SectorAddress);<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Set address */</span>
	Xil_Out32(<span class="hljs-number">0x43c00008</span>, SectorAddress);<font></font>
<font></font>
	<span class="hljs-comment">/** Set command */</span>
	Xil_Out32(<span class="hljs-number">0x43c00004</span>, <span class="hljs-number">4</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">1</span>);<font></font>
<font></font>
	<span class="hljs-comment">/** Wait end of operation */</span>
	<span class="hljs-keyword">for</span> (;;)<font></font>
	{<font></font>
		status = Xil_In32(<span class="hljs-number">0x43c0000c</span>);
		<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x01</span> || status == <span class="hljs-number">0x03</span>)<font></font>
		{<font></font>
			<span class="hljs-keyword">if</span> (status == <span class="hljs-number">0x03</span>)<font></font>
			{<font></font>
				xil_printf(<span class="hljs-string">"Error in write! \n\r"</span>);<font></font>
			}<font></font>
			<span class="hljs-keyword">break</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">else</span><font></font>
		{<font></font>
			cntrDuration++;<font></font>
			usleep(<span class="hljs-number">100</span>);<font></font>
		}<font></font>
	}<font></font>
<font></font>
	<span class="hljs-comment">/** Duration operation */</span><font></font>
	durationErase += cntrDuration;<font></font>
<font></font>
	<span class="hljs-keyword">if</span> (cntrDuration &gt; MaxErase )<font></font>
	{<font></font>
		MaxErase = cntrDuration;<font></font>
	}<font></font>
<font></font>
	cntrDuration = <span class="hljs-number">0x00</span>;<font></font>
<font></font>
	<span class="hljs-comment">/** Clear start */</span>
	Xil_Out32(<span class="hljs-number">0x43c00000</span>, <span class="hljs-number">0</span>);<font></font>
<font></font>
	SectorAddress += <span class="hljs-number">7</span>;<font></font>
}<font></font>
</code></pre><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uji sepenuhnya pada github.</font></font></a><br>
<br>
<a name="Results"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Hasil</font></font></h2><br>
<div class="scrollable-table"><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jumlah data</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bacaan </font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merekam</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menghapus </font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 blok (512 byte)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,7 Mbps</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,36 Mbps</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,58 Mbps</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 blok (4096 byte)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15,4 Mbps</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,38 Mbps</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,66 Mbps</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16 blok (8192 byte)</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18,82 Mbps</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11,26 Mbps</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9,79 Mbps</font></font></td>
</tr>
</tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kartu 16 GB digunakan. </font><font style="vertical-align: inherit;">Selama pengujian, 2 GB data direkam, 2 GB data dibaca, dan 2 GB data dihapus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesimpulannya mengecewakan. </font><font style="vertical-align: inherit;">Saat menggunakan FPGA, tidak masuk akal untuk menggunakan kartu SD dalam mode SPI, kecuali untuk kasus ketika sangat diperlukan untuk menyimpan sejumlah besar data tanpa menunjukkan persyaratan kecepatan.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id495388/index.html">Acara televisi 1970-an yang menjadi nenek moyang eSports</a></li>
<li><a href="../id495390/index.html">STM32CubeMonitor patut dicoba</a></li>
<li><a href="../id495392/index.html">Cara mencari bug di ujung depan: 4 tahap utama</a></li>
<li><a href="../id495396/index.html">Kesan pertama konsep</a></li>
<li><a href="../id495398/index.html">Ro.Ri.Re</a></li>
<li><a href="../id495402/index.html">Tahun lalu, kami akhirnya memotret lubang hitam. Sekarang apa?</a></li>
<li><a href="../id495404/index.html">Apakah saham melorot menjanjikan? Mari kita analisa dengan python</a></li>
<li><a href="../id495408/index.html"># 02 - Dan seluruh byte tidak cukup ... | Salib perubahan</a></li>
<li><a href="../id495412/index.html">Norbert Wiener. Orang yang menarik. Kolega, musuh, perjuangan untuk kemerdekaan</a></li>
<li><a href="../id495414/index.html">Konsekuensi dari rasa takut</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>