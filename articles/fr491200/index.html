<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òéÔ∏è üï∫üèº üèâ Minuterie de fonction pour contr√¥leur industriel Simatic S7-1200 üòß üè° üÜô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="M√™me pour les s√©ries S7-300 et S7-400, √† l'√©tape 7, les versions classiques des temporisateurs propos√©s au d√©veloppeur √©taient suffisantes - ce sont d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Minuterie de fonction pour contr√¥leur industriel Simatic S7-1200</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/491200/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√™me pour les s√©ries S7-300 et S7-400, √† l'√©tape 7, les versions classiques des temporisateurs propos√©s au d√©veloppeur √©taient suffisantes - ce sont des temporisateurs CEI standard, mis en ≈ìuvre en tant que blocs fonctionnels, et des temporisateurs S5 (qui, soit dit en passant, existent toujours pour la s√©rie S7- 1500). Cependant, dans certains cas, le d√©veloppeur n'a pas utilis√© d'outils standard et a impl√©ment√© ses propres temporisateurs, le plus souvent sous forme de fonctions. De telles fonctions de temporisation √©taient n√©cessaires avec une approche ¬´informatique¬ª de la programmation, dans laquelle elles fonctionnaient non pas avec des instances distinctes des blocs fonctionnels de l'√©quipement technologique, avec la liaison correspondante des entr√©es et des sorties, mais avec des tableaux de structures. Par exemple, un tableau d'une structure de type d'entr√©e discr√®te. Ou un tableau d'une structure agr√©g√©e. Cette approche de la programmation a le droit d'exister, car elle vous permet d'√©conomiser s√©rieusement la m√©moire de travail du CPU, mais,d'autre part, rend le code du programme difficile √† lire. Un programmeur tiers et avec un simple regard sur un programme CONT peut difficilement le comprendre tout de suite, mais des tas d'indices, de tableaux et de fonctions pour les traiter sont hors de question; ici, sans documentation pour le logiciel (et sans un demi-litre, bien s√ªr), nulle part.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ces tableaux de structures √©taient g√©n√©ralement trait√©s dans des fonctions. En principe, rien n'emp√™chait le traitement des blocs fonctionnels, mais il y avait toujours une question importante - comment travailler avec des temporisateurs dans ces cas? Les temporisateurs standard supposent soit un nombre (S5) soit une instance d'un bloc fonctionnel (CEI). Je vous rappelle qu'il s'agit de traiter des tableaux de structures pour les automates Simatic classiques et de ¬´tordre¬ª les nombres de temporisations dans ces structures, et plus encore, les instances sont soit difficiles, soit tout simplement impossibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour cette raison, nous avons cr√©√© notre propre fonction de minuterie en tant que fonction. En principe, pour le fonctionnement de n'importe quel minuteur, vous devez conna√Ætre seulement quelques √©l√©ments - l'√©tat de l'entr√©e, le r√©glage de l'heure et le temps √©coul√© depuis l'activation.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les s√©ries 300 et 400, il y avait deux fa√ßons de d√©terminer cette heure. </font><font style="vertical-align: inherit;">La premi√®re consiste √† examiner le temps d'ex√©cution de l'OB1 principal (il existe une variable correspondante dans l'OB1 lui-m√™me) ou des OB cycliques et d'augmenter l'accumulateur de temps interne √† chaque appel de temporisateur, √† condition que la ¬´v√©rit√©¬ª soit entr√©e. </font><font style="vertical-align: inherit;">Pas une bonne option, car ce temps est diff√©rent pour l'OB1 et les OB cycliques. </font><font style="vertical-align: inherit;">La deuxi√®me m√©thode est la fonction syst√®me TIME_TCK, qui, √† chaque appel, renvoyait une valeur unique - le compteur interne en millisecondes du processeur central. </font></font><br>
<br>
<img src="https://sun9-40.userapi.com/c855036/v855036198/1f8065/UwCQvxh507k.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, pour un temporisateur de type TON (on delay), l'algorithme de fonctionnement √©tait le suivant:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le front montant de la demande de r√©ponse, r√©initialisez la sortie et m√©morisez la valeur actuelle du temporisateur syst√®me TIME_TCK</font></font></li>
<li>       ¬´¬ª          ,        (   ,  TIME_TCK    0  (2 ^ 31 ‚Äî 1),          ).   ,        .    ,    ¬´¬ª,    ‚Äî ¬´¬ª</li>
<li>      ¬´¬ª,   </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec l'av√®nement de la "milli√®me" s√©rie, la situation a un peu chang√©. Le fait est que la ligne S7-1500 a h√©rit√© de la prise en charge de l'appel syst√®me TIME_TCK et des amateurs de l'approche ¬´debout et dans un hamac¬ª (comment pouvez-vous appeler un programme qui traite uniquement des tableaux de structures tout en fonctionnant avec des index effrayants?) calmement continuer √† utiliser leurs meilleures pratiques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La s√©rie de contr√¥leurs de base S7-1200 est bas√©e sur une architecture diff√©rente et pr√©sente un certain nombre de diff√©rences par rapport au S7-1500. Y compris l'absence d'un appel syst√®me TIME_TCK. Dans les rangs des d√©veloppeurs qui n'ont pas une flexibilit√© de pens√©e suffisante, l'insatisfaction a disparu - il est impossible d'ex√©cuter des copies / p√¢tes d'anciens programmes. Cependant, la t√¢che de d√©terminer combien de temps s'est √©coul√© depuis l'appel pr√©c√©dent peut √™tre effectu√©e √† l'aide de la fonction d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ex√©cution</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cette fonction renvoie le temps √©coul√© depuis son appel pr√©c√©dent, en secondes, sous la forme d'un nombre r√©el double pr√©cision LREAL. Les d√©tails sont d√©crits dans l'aide. √Ä des fins internes, une variable MEM suppl√©mentaire (√©galement de type LREAL) est requise. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je donnerai les sources de la premi√®re approximation de la fonction, et je donnerai quelques notes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©claration de fonction:</font></font><br>
<br>
<pre><code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword">FUNCTION</span> "<span class="hljs-title">PerversionTON</span>" :</span> Void
<span class="hljs-comment">{ S7_Optimized_Access := 'TRUE' }</span>
VERSION : <span class="hljs-number">0.1</span><font></font>
   VAR_INPUT <font></font>
      <span class="hljs-keyword">IN</span> : Bool;   <span class="hljs-comment">//  </span>
      PT : Real;   <span class="hljs-comment">//    </span><font></font>
   END_VAR<font></font>
<font></font>
   VAR_OUTPUT <font></font>
      Q : Bool;   <span class="hljs-comment">//  </span><font></font>
   END_VAR<font></font>
<font></font>
   VAR_IN_OUT <font></font>
      INPrv : Bool;<font></font>
      MEM : LReal;<font></font>
      TimeACC : UDInt;<font></font>
   END_VAR<font></font>
<font></font>
   VAR_TEMP <font></font>
      udiCycle : UDInt;<font></font>
      udiPT : UDInt;<font></font>
   END_VAR<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec les entr√©es / sorties, tout est clair: IN, Q et PT. J'ai mis le r√©glage de l'heure sous la forme d'un vrai, c'est des secondes. Je voulais juste (mais en vain, mais plus sur cela ci-dessous). Plus d'informations sur les variables de la zone InOut. √âtant donn√© que nous avons une fonction, nous n'avons pas de zone STAT, aucune variable ne conserve sa valeur lors du prochain appel de fonction, et de telles variables sont n√©cessaires: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INPrv - pour d√©terminer le bord positif de la demande </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MEM - variable auxiliaire pour l'appel syst√®me au travail runtime </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TimeACC - accumulateur de temps , qui stockera le nombre de microsecondes du retard en cours d'ex√©cution.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les variables TimeACC, udiCycle et udiPT sont sp√©cifi√©es au format UDINT, un entier non sign√©, 4 octets. </font><font style="vertical-align: inherit;">Malgr√© le fait que j'ai sp√©cifi√© l'heure comme r√©elle et que la fonction d'ex√©cution renvoie autant que la double pr√©cision, je pr√©f√®re effectuer des op√©rations simples de sommation et de comparaison avec des op√©randes entiers pour gagner du temps sur le processeur. </font><font style="vertical-align: inherit;">Le temps dans mon cas est pris en compte √† la microseconde pr√®s. </font><font style="vertical-align: inherit;">La raison est simple - si vous grossissez le temps en millisecondes, puis avec un OB1 presque vide (par exemple, si un seul temporisateur est appel√© dans tout le programme du contr√¥leur et rien de plus), des ¬´sauts¬ª de cycles sont possibles, le programme s'ex√©cute parfois pendant 250 Œºs. </font><font style="vertical-align: inherit;">Mais dans ce cas, la valeur maximale autoris√©e de l'accumulateur de temps sera de 4 294 secondes, soit pr√®s de 4 295 (2 ^ 32 - 1 = 4 294 967 295). </font><font style="vertical-align: inherit;">Il n'y a rien √† faire, une telle ¬´optimisation¬ª n√©cessite des sacrifices.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Texte de fonction.</font></font><br>
<br>
<pre><code class="delphi hljs">#udiCycle := LREAL_TO_UDINT(RUNTIME(#MEM) * <span class="hljs-number">1000000</span>); <span class="hljs-comment">//     </span>
#udiPT := REAL_TO_UDINT(#PT * <span class="hljs-number">1000000</span>); <span class="hljs-comment">//   </span><font></font>
<font></font>
<span class="hljs-keyword">IF</span> (#<span class="hljs-keyword">IN</span> <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">NOT</span> #INPrv)) <span class="hljs-keyword">THEN</span> <span class="hljs-comment">//         </span>
    #TimeACC := <span class="hljs-number">0</span>;<font></font>
    #Q := FALSE;<font></font>
ELSIF (#<span class="hljs-keyword">IN</span> <span class="hljs-keyword">AND</span> #INPrv) <span class="hljs-keyword">THEN</span> <span class="hljs-comment">//     ""</span>
    #TimeACC += #udiCycle; <span class="hljs-comment">//     "    "</span>
    <span class="hljs-keyword">IF</span> #TimeACC &gt;=  #udiPT <span class="hljs-keyword">THEN</span> <span class="hljs-comment">//      </span>
        #Q := TRUE; <span class="hljs-comment">//  ""</span>
        #TimeACC := #udiPT; <span class="hljs-comment">//  </span>
    <span class="hljs-keyword">ELSE</span> <span class="hljs-comment">//      </span>
        #Q := FALSE; <span class="hljs-comment">// </span><font></font>
    END_IF;<font></font>
<span class="hljs-keyword">ELSE</span> <span class="hljs-comment">//    -      </span><font></font>
    #Q := FALSE;<font></font>
    #TimeACC := <span class="hljs-number">0</span>;<font></font>
END_IF;<font></font>
<font></font>
#INPrv := #<span class="hljs-keyword">IN</span>; <span class="hljs-comment">//  </span><font></font>
<font></font>
ENO := #Q; <span class="hljs-comment">// ENO         LAD  FBD</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux premi√®res lignes sont le recalcul du r√©glage de la minuterie du nombre de secondes sp√©cifi√© dans le format REAL au nombre de microsecondes. </font><font style="vertical-align: inherit;">Le temps en microsecondes √©coul√© depuis l'appel de bloc de programme pr√©c√©dent est √©galement d√©termin√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, l'algorithme est le suivant, et je l'ai d√©j√† donn√©:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le front montant de l'entr√©e IN, r√©initialiser la sortie Q et r√©initialiser l'accumulateur de temps</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si la ¬´v√©rit√©¬ª continue d'√™tre saisie, nous augmentons l'accumulateur de temps de la valeur udiCycle d√©j√† connue et le comparons avec le r√©glage de l'heure. </font><font style="vertical-align: inherit;">Si le r√©glage de l'heure est d√©pass√©, la minuterie a fonctionn√©, donnez la sortie ¬´vrai¬ª, sinon, donnez la sortie ¬´faux¬ª</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en cas d'application d'une fausse entr√©e √† l'entr√©e IN, r√©initialiser la sortie Q et r√©initialiser l'accumulateur de temps.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la fin de la fonction, afin de d√©terminer le bord de l'entr√©e IN, rappelez-vous sa valeur pr√©c√©dente. </font><font style="vertical-align: inherit;">Donnez √©galement √† la sortie ENO (lors de l'utilisation d'une fonction dans des langages graphiques, comme LAD) la valeur de la sortie Q. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous nous assurons que la fonction fonctionne, apr√®s quoi il devient int√©ressant d'√©valuer sa vitesse et, si n√©cessaire, de l'am√©liorer (il appara√Æt d√©j√† √† premi√®re vue qu'un certain nombre de calculs sont effectu√©s inactif et perdre du temps CPU en vain). </font><font style="vertical-align: inherit;">Pour √©valuer les performances, je d√©clare un tableau de 1000 structures de donn√©es de temporisation. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
D√©claration de la structure. </font><font style="vertical-align: inherit;">Ses champs dupliquent les variables d'entr√©e et de sortie de la fonction timer.</font></font><br>
<br>
<pre><code class="delphi hljs"><span class="hljs-keyword">TYPE</span> "typePervTONdata"<font></font>
VERSION : <span class="hljs-number">0.1</span><font></font>
   STRUCT<font></font>
      <span class="hljs-keyword">IN</span> : Bool;   <span class="hljs-comment">//  </span>
      PT : Real;   <span class="hljs-comment">//   </span>
      Q : Bool;   <span class="hljs-comment">//  </span>
      INPrv : Bool;   <span class="hljs-comment">//    </span>
      MEM : LReal;   <span class="hljs-comment">//    </span>
      TimeACC : UDInt;   <span class="hljs-comment">//  </span><font></font>
   END_STRUCT;<font></font>
<font></font>
END_TYPE</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un tableau de structures est d√©clar√© dans le bloc de donn√©es global TortureTON:</font></font><br>
<br>
<pre><code class="delphi hljs">TONs : <span class="hljs-keyword">Array</span>[<span class="hljs-number">0</span>..<span class="hljs-number">999</span>] <span class="hljs-keyword">of</span> "typePervTONdata";
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code suivant est ex√©cut√© dans le bloc d'organisation OB1:</font></font><br>
<br>
<pre><code class="delphi hljs"><span class="hljs-keyword">FOR</span> #i := <span class="hljs-number">0</span> <span class="hljs-keyword">TO</span> <span class="hljs-number">999</span> <span class="hljs-keyword">DO</span>
    "TortureTON".TONs[#i].<span class="hljs-keyword">IN</span> := "startton";<font></font>
    "PerversionTON"(<span class="hljs-keyword">IN</span> := "TortureTON".TONs[#i].<span class="hljs-keyword">IN</span>,<font></font>
                    PT := "TortureTON".TONs[#i].PT,<font></font>
                    Q := "TortureTON".TONs[#i].Q,<font></font>
                    INPrv := "TortureTON".TONs[#i].INPrv,<font></font>
                    MEM := "TortureTON".TONs[#i].MEM,<font></font>
                    TimeACC := "TortureTON".TONs[#i].TimeACC);<font></font>
END_FOR;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Annonce de 1 000 ¬´instances¬ª de minuteries, chacune fixant un temps de 10 secondes. Tous les 1000 temporisateurs commencent √† compter le temps par la valeur de la variable de marqueur de startton. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je lance les fonctions de diagnostic du contr√¥leur (S7-1214C DC / DC / DC, version FW 4.4, version Step7 - V16) et je regarde le temps de cycle de balayage du contr√¥leur. √Ä ¬´inactif¬ª (lorsque ¬´faux¬ª arrive √† l'entr√©e des temporisateurs), le millier entier est trait√© en moyenne pendant 36 √† 42 millisecondes. Pendant le d√©compte de dix secondes, cette lecture augmente d'environ 6 √† 8 millisecondes et se prolonge parfois pendant 50 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous regardons ce qui peut √™tre am√©lior√© dans le code de fonction. Tout d'abord, les lignes au tout d√©but du bloc de programme:</font></font><br>
<br>
<pre><code class="delphi hljs">#udiCycle := LREAL_TO_UDINT(RUNTIME(#MEM) * <span class="hljs-number">1000000</span>); <span class="hljs-comment">//     </span>
#udiPT := REAL_TO_UDINT(#PT * <span class="hljs-number">1000000</span>); <span class="hljs-comment">//   </span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils sont toujours appel√©s, que le chronom√®tre compte le temps, ne compte pas ou ait d√©j√† compt√©. Un gros gaspillage d'argent est de charger le processeur peu puissant de la s√©rie 1200 avec des calculs impliquant des mat√©riaux √† double pr√©cision. Il est raisonnable de transf√©rer les deux lignes dans la partie du code qui traite le compte √† rebours (si la ¬´v√©rit√©¬ª continue de se manifester). Il est √©galement n√©cessaire de dupliquer le calcul udiCycle en un code qui traite un front positif √† l'entr√©e du temporisateur. Cela devrait soulager le ¬´fonctionnement √† vide¬ª du temporisateur lorsque la valeur d'entr√©e est fausse. En pratique, les temporisateurs des contr√¥leurs logiques programmables fonctionnent le plus souvent ¬´au ralenti¬ª. Par exemple, le temps de filtrage du rebond de contact est de dizaines de millisecondes. L'impulsion de commande d'une sortie discr√®te est de quelques centaines de millisecondes, g√©n√©ralement de 0,5 √† 1,0 seconde.Le temps de surveillance de l'ex√©cution de la commande de l'unit√© (par exemple, l'heure √† laquelle la vanne s'ouvre compl√®tement) est de quelques dizaines √† plusieurs minutes. Le PLC en production fonctionne 24 heures sur 24 et 365 jours (et parfois plus!) Par an. Autrement dit, le plus souvent, l'entr√©e du minuteur est soit ¬´z√©ro¬ª, et le minuteur ne compte rien, soit une ¬´unit√©¬ª arrive depuis longtemps, et le minuteur a d√©j√† tout compt√©. Pour d√©charger le processeur du deuxi√®me √©tage inactif (le minuteur a d√©j√† compt√©), il est n√©cessaire de v√©rifier au stade "l'entr√©e continue de recevoir la v√©rit√©" - si le minuteur a d√©j√† tout le temps compt√© et de r√©gler la sortie sur vrai. Dans ce cas, aucun calcul ne doit √™tre effectu√©.le plus souvent, l'entr√©e du minuteur est soit ¬´z√©ro¬ª, et le minuteur ne compte rien, soit une ¬´unit√©¬ª arrive depuis longtemps, et le minuteur a d√©j√† tout compt√©. Pour d√©charger le processeur du deuxi√®me √©tage inactif (le minuteur a d√©j√† compt√©), il est n√©cessaire de v√©rifier au stade "l'entr√©e continue de recevoir la v√©rit√©" - si le minuteur a d√©j√† tout le temps compt√© et de r√©gler la sortie sur vrai. Dans ce cas, aucun calcul ne doit √™tre effectu√©.le plus souvent, l'entr√©e du minuteur est soit ¬´z√©ro¬ª, et le minuteur ne compte rien, soit une ¬´unit√©¬ª arrive depuis longtemps, et le minuteur a d√©j√† tout compt√©. Pour d√©charger le processeur du deuxi√®me √©tage inactif (le minuteur a d√©j√† compt√©), il est n√©cessaire de v√©rifier au stade "l'entr√©e continue de recevoir la v√©rit√©" - si le minuteur a d√©j√† tout le temps compt√© et de r√©gler la sortie sur vrai. Dans ce cas, aucun calcul ne doit √™tre effectu√©.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour effectuer ces modifications, il est n√©cessaire de transf√©rer la sortie du temporisateur Q de la zone OUTPUT vers la zone IN_OUT, et la valeur de sortie sera stock√©e dans des variables externes (dans cet exemple, dans un tableau de structures). Apr√®s raffinement, le code de fonction entier, y compris la d√©claration, est le suivant:</font></font><br>
<br>
<pre><code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword">FUNCTION</span> "<span class="hljs-title">PerversionTON</span>" :</span> Void
<span class="hljs-comment">{ S7_Optimized_Access := 'TRUE' }</span>
VERSION : <span class="hljs-number">0.1</span><font></font>
   VAR_INPUT <font></font>
      <span class="hljs-keyword">IN</span> : Bool;   <span class="hljs-comment">//  </span>
      PT : Real;   <span class="hljs-comment">//    </span><font></font>
   END_VAR<font></font>
<font></font>
   VAR_IN_OUT <font></font>
      Q : Bool;   <span class="hljs-comment">//  </span><font></font>
      INPrv : Bool;<font></font>
      MEM : LReal;<font></font>
      TimeACC : UDInt;<font></font>
   END_VAR<font></font>
<font></font>
   VAR_TEMP <font></font>
      udiCycle : UDInt;<font></font>
      udiPT : UDInt;<font></font>
   END_VAR<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">BEGIN</span>
	<span class="hljs-keyword">IF</span> (#<span class="hljs-keyword">IN</span> <span class="hljs-keyword">AND</span> (<span class="hljs-keyword">NOT</span> #INPrv)) <span class="hljs-keyword">THEN</span> <span class="hljs-comment">//         </span>
	    #TimeACC := <span class="hljs-number">0</span>;<font></font>
	    #Q := FALSE;<font></font>
	    #udiCycle := LREAL_TO_UDINT(RUNTIME(#MEM) * <span class="hljs-number">1000000</span>); <span class="hljs-comment">// " "  </span>
	ELSIF (#<span class="hljs-keyword">IN</span> <span class="hljs-keyword">AND</span> #INPrv) <span class="hljs-keyword">THEN</span> <span class="hljs-comment">//     ""</span>
	    <span class="hljs-keyword">IF</span> (<span class="hljs-keyword">NOT</span> #Q) <span class="hljs-keyword">THEN</span>
	        #udiCycle := LREAL_TO_UDINT(RUNTIME(#MEM) * <span class="hljs-number">1000000</span>); <span class="hljs-comment">//     </span>
	        #udiPT := REAL_TO_UDINT(#PT * <span class="hljs-number">1000000</span>); <span class="hljs-comment">//   </span>
	        #TimeACC += #udiCycle; <span class="hljs-comment">//     "    "</span>
	        <span class="hljs-keyword">IF</span> #TimeACC &gt;= #udiPT <span class="hljs-keyword">THEN</span> <span class="hljs-comment">//      </span>
	            #Q := TRUE; <span class="hljs-comment">//  ""</span>
	            #TimeACC := #udiPT; <span class="hljs-comment">//  </span><font></font>
	        END_IF;<font></font>
	    END_IF;<font></font>
	<span class="hljs-keyword">ELSE</span> <span class="hljs-comment">//    -      </span><font></font>
	    #Q := FALSE;<font></font>
	    #TimeACC := <span class="hljs-number">0</span>;<font></font>
	END_IF;<font></font>
	<font></font>
	#INPrv := #<span class="hljs-keyword">IN</span>; <span class="hljs-comment">//  </span><font></font>
	<font></font>
	ENO := #Q; <span class="hljs-comment">// ENO         LAD  FBD</span><font></font>
END_FUNCTION<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s cela, le temps d'ex√©cution s'am√©liore: le traitement du temps d'inactivit√© des temporisateurs est de 23 ms, avec un temps de filtrage de travail de 37 √† 40 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce code de fonction ne v√©rifie pas une valeur non valide du r√©glage de la minuterie - une valeur n√©gative (si le mat√©riau est converti en un entier non sign√©, le r√©glage sera d√©form√©) ou une valeur sup√©rieure √† 4294,9 secondes (le r√©glage de l'heure d√©bordera et se d√©formera). Vous devez soit contr√¥ler la valeur de la valeur PT dans le code, soit confier la t√¢che de v√©rification de la plage de r√©glage de l'heure (de 0 √† 4294,9 secondes) au syst√®me op√©rateur de niveau sup√©rieur. La v√©rification de la plage au moyen du programme PLC augmente le temps de traitement √† environ 45-46 ms (et, en g√©n√©ral, la mani√®re la plus correcte est de r√©gler le temps de la minuterie non pas au format REAL, mais au format UDINT en millisecondes et pour faire des b√™tises).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet d'application avec une minuterie pour l'environnement TIA Portal Step 7 version 16 est disponible </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ici</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr491188/index.html">Ce que le testeur de backend devrait savoir</a></li>
<li><a href="../fr491190/index.html">Cr√©ation d'une boutique en ligne sur Nuxt.js 2 Proc√©dure pas √† pas, partie 3</a></li>
<li><a href="../fr491192/index.html">Figmiro. Faire un plugin pour Figma (et un peu pour Miro)</a></li>
<li><a href="../fr491194/index.html">G√©n√©tique d'origine. Composition de la population</a></li>
<li><a href="../fr491198/index.html">Six conseils pour cr√©er le bon didacticiel de jeu</a></li>
<li><a href="../fr491202/index.html">Ing√©nieurs contre concepteurs</a></li>
<li><a href="../fr491208/index.html">7 habitudes qui feront de tout introverti un ma√Ætre de la communication</a></li>
<li><a href="../fr491210/index.html">Mini-s√©rie de vid√©os avec animation de personnages sur le jeu d'intimidation Monster Hustle</a></li>
<li><a href="../fr491212/index.html">Huile et vodka: comment se d√©barrasser des autocollants des ordinateurs portables</a></li>
<li><a href="../fr491214/index.html">9 strat√©gies pour commercialiser des jeux mobiles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>