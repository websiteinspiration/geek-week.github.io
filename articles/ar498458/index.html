<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ ๐ดโโ๏ธ ๐ง ููุงููุงุช ููุฏูู ุจุฎูููุฉ ุงูุชุฑุงุถูุฉ ูุฃุฏูุงุช ููุชูุญุฉ ุงููุตุฏุฑ ๐ ๐ ๐ฐ๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุขู ุจุนุฏ ุฃู ุชู ุนุฒู ุงููุซูุฑ ููุง ุจุณุจุจ COVID-19 ุ ุฃุตุจุญุช ููุงููุงุช ุงูููุฏูู ุฃูุซุฑ ุดููุนูุง ูู ุฐู ูุจู. ุนูู ูุฌู ุงูุฎุตูุต ุ ุฃุตุจุญุช ุฎุฏูุฉ ZOOM  ูุฌุฃุฉ ุชุญุธู ุจุดุนุจูุฉ ูุจูุฑุฉ. ุฑ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>ููุงููุงุช ููุฏูู ุจุฎูููุฉ ุงูุชุฑุงุถูุฉ ูุฃุฏูุงุช ููุชูุญุฉ ุงููุตุฏุฑ</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/498458/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุจุนุฏ ุฃู ุชู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนุฒู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุซูุฑ ููุง </font><font style="vertical-align: inherit;">ุจุณุจุจ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COVID-19</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ุฃุตุจุญุช ููุงููุงุช ุงูููุฏูู ุฃูุซุฑ ุดููุนูุง ูู ุฐู ูุจู. ุนูู ูุฌู ุงูุฎุตูุต ุ </font><font style="vertical-align: inherit;">ุฃุตุจุญุช </font><font style="vertical-align: inherit;">ุฎุฏูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZOOM </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุฃุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุญุธู ุจุดุนุจูุฉ ูุจูุฑุฉ. ุฑุจูุง ุชููู ููุฒุฉ ุงูุชูุจูุฑ / ุงูุชุตุบูุฑ ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ุฏุนู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฎูููุฉ ุงูุงูุชุฑุงุถูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ูุณูุญ ูููุณุชุฎุฏููู ุจุงุณุชุจุฏุงู ุงูุฎูููุฉ ุฎูููู ุจุดูู ุชูุงุนูู ุจุฃู ุตูุฑุฉ ุฃู ููุฏูู.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/webt/wf/46/1p/wf461pvjwrwmpzvkvnhyvzcf8xy.jpeg"></div></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุฏ ููุช ุฃุณุชุฎุฏู Zoom ูู ุงูุนูู ููุชุฑุฉ ุทูููุฉ ุ ูู ุงุฌุชูุงุนุงุช ููุชูุญุฉ ุงููุตุฏุฑ ุนูู Kubernetes ุ ูุนุงุฏุฉ ูุง ุฃููู ุจุฐูู ูู ููุจููุชุฑ ูุญููู ููุดุฑูุงุช. ุงูุขู ุ ุนูุฏูุง ุฃุนูู ูู ุงูููุฒู ุ ุฃููู ุฅูู ุงุณุชุฎุฏุงู ููุจููุชุฑ ุณุทุญ ููุชุจ ุดุฎุตู ุฃูุซุฑ ููุฉ ูููุงุกูุฉ ูุญู ุจุนุถ ุงูููุงู ุงูููุชูุญุฉ ุงููุตุฏุฑ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุณูุก ุงูุญุธ ุ ูุฏุนู Zoom ููุท ุทุฑููุฉ ุฅุฒุงูุฉ ุงูุฎูููุฉ ุงููุนุฑููุฉ ุจุงุณู " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุงุญ chroma</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " ุฃู " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดุงุดุฉ ุงูุฎุถุฑุงุก</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". ูุงุณุชุฎุฏุงู ูุฐู ุงูุทุฑููุฉ ุ ูู ุงูุถุฑูุฑู ุฃู ูุชู ุชูุซูู ุงูุฎูููุฉ ุจุจุนุถ ุงูุฃููุงู ุงูุตูุจุฉ ุ ูุงูุฃุฎุถุฑ ุจุดูู ูุซุงูู ุ ูุฃู ุชููู ูุถุงุกุฉ ุจุดูู ููุญุฏ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุนุฏู ูุฌูุฏ ุดุงุดุฉ ุฎุถุฑุงุก ุ ููุฏ ูุฑุฑุช ุจุจุณุงุทุฉ ุชูููุฐ ูุธุงู ุฅุฒุงูุฉ ุงูุฎูููุฉ ุงูุฎุงุต ุจู. ููุฐุง ุ ุจุงูุทุจุน ุ ุฃูุถู ุจูุซูุฑ ูู ุชุฑุชูุจ ุงูุฃุดูุงุก ูู ุงูุดูุฉ ุ ุฃู ุงูุงุณุชุฎุฏุงู ุงููุณุชูุฑ ูุฌูุงุฒ ููุจููุชุฑ ูุญููู ููุนูู.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุงุชุถุญ ุ ุจุงุณุชุฎุฏุงู ููููุงุช ููุชูุญุฉ ุงููุตุฏุฑ ุฌุงูุฒุฉ ููุชุงุจุฉ ุจุถุนุฉ ุฃุณุทุฑ ููุท ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจู ุ ููููู ุงูุญุตูู ุนูู ูุชุงุฆุฌ ูุงุฆูุฉ ููุบุงูุฉ.</font></font><br>
<a name="habracut"></a><br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุงุกุฉ ุจูุงูุงุช ุงููุงููุฑุง</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุจุฏุฃ ูู ุงูุจุฏุงูุฉ ููุฌูุจ ุนูู ุงูุณุคุงู ุงูุชุงูู: "ููู ุชุญุตู ุนูู ููุฏูู ูู ูุงููุฑุง ููุจ ุณูุนุงูุฌูุ" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃููู ุฃุณุชุฎุฏู Linux ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ูู ุงูููุฒู (ุนูุฏูุง ูุง ุฃูุนุจ ุงูุฃูุนุงุจ) ุ ููุฏ ูุฑุฑุช ุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุงุจุท </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open CV </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">Python</font></a><font style="vertical-align: inherit;"> ุ ุงูุชู ุฃุนุฑููุง ุจุงููุนู. </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑูุงุจุท</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V4L2 ููุฑุงุกุฉ ุงูุจูุงูุงุช ูู ูุงููุฑุง ุงูููุจ ุ ูุฅููุง ุชุชุถูู ูุธุงุฆู ูุนุงูุฌุฉ ุงูููุฏูู ุงูุฃุณุงุณูุฉ ุงููููุฏุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฑุงุกุฉ ุฅุทุงุฑ ูู ูุงููุฑุง ููุจ ูู python-opencv ุฃูุฑ ุจุณูุท ููุบุงูุฉ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> cv2<font></font>
cap = cv2.VideoCapture(<span class="hljs-string">'/dev/video0'</span>)<font></font>
success, frame = cap.read()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุญุณูู ุงููุชุงุฆุฌ ุนูุฏ ุงูุนูู ูุน ุงููุงููุฑุง ุ ููุช ุจุชุทุจูู ุงูุฅุนุฏุงุฏุงุช ุงูุชุงููุฉ ูุจู ุงูุชูุงุท ุงูููุฏูู ูููุง:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    720p @ 60 FPS</span>
height, width = <span class="hljs-number">720</span>, <span class="hljs-number">1280</span><font></font>
cap.set(cv2.CAP_PROP_FRAME_WIDTH ,width)<font></font>
cap.set(cv2.CAP_PROP_FRAME_HEIGHT,height)<font></font>
cap.set(cv2.CAP_PROP_FPS, <span class="hljs-number">60</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุงู ุดุนูุฑ ุจุฃู ูุนุธู ุจุฑุงูุฌ ูุคุชูุฑุงุช ุงูููุฏูู ุชูุตุฑ ุงูููุฏูู ุนูู 720p @ 30 FPS ุฃู ุฃูู. </font><font style="vertical-align: inherit;">ููููุง ุ ุนูู ุฃู ุญุงู ุ ูุฏ ูุง ููุฑุฃ ูู ุฅุทุงุฑ. </font><font style="vertical-align: inherit;">ุชุญุฏุฏ ูุฐู ุงูุฅุนุฏุงุฏุงุช ุงูุญุฏ ุงูุฃุนูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุถุน ุขููุฉ ุงูุชูุงุท ุงูุฅุทุงุฑ ูู ุญููุฉ. </font><font style="vertical-align: inherit;">ุงูุขู ูุฏููุง ุงููุตูู ุฅูู ุฏูู ุงูููุฏูู ูู ุงููุงููุฑุง!</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;success, frame = cap.read()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููู ุญูุธ ุงูุฅุทุงุฑ ูุฃุบุฑุงุถ ุงูุงุฎุชุจุงุฑ ุนูู ุงููุญู ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="python hljs">cv2.imwrite(<span class="hljs-string">"test.jpg"</span>, frame)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฐูู ุ ูููููุง ุงูุชุฃูุฏ ูู ุฃู ุงููุงููุฑุง ุชุนูู. </font><font style="vertical-align: inherit;">ุนุธูู!</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96c/1ea/155/96c1ea155c714c5f1c8ab70f737444f8.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุขูู ุฃูู ูุณุช ุถุฏ ูุญูุชู</font></font></font></i><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุดู ุงูุฎูููุฉ</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ูุฏููุง ุฅููุงููุฉ ุงููุตูู ุฅูู ุฏูู ุงูููุฏูู ุ ุณูููุฑ ูู ููููุฉ ุงูุชุดุงู ุงูุฎูููุฉ ูู ุฎูุงู ุชูููููุง ูู ุงุณุชุจุฏุงููุง ูู ุฎูุงู ุงูุนุซูุฑ ุนูููุง. ููู ูุฐู ูููุฉ ุตุนุจุฉ ุจุงููุนู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ุงูุฑุบู ูู ูุฌูุฏ ุดุนูุฑ ุจุฃู ูุจุฏุนู Zoom ูุง ูุชุญุฏุซูู ุฃุจุฏูุง ุนู ููููุฉ ุฅุฒุงูุฉ ุงูุจุฑูุงูุฌ ููุฎูููุฉ ุจุงูุถุจุท ุ ูุฅู ุงูุทุฑููุฉ ุงูุชู ูุชุตุฑู ุจูุง ุงููุธุงู ุชุฌุนููู ุฃููุฑ ูู ูุง ูุงู ูููู ุฃู ููุนูู ุจุฏูู ุงูุดุจูุงุช ุงูุนุตุจูุฉ. ูู ุงูุตุนุจ ุดุฑุญ ุฐูู ุ ููู ุงููุชุงุฆุฌ ุชุจุฏู ููุฐุง ุชูุงููุง. ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฌุฏุช ููุงููุง ุญูู ููููุฉ </font><font style="vertical-align: inherit;">ุชูููุฐ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Teams </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทูุณ ุงูุฎูููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุจูุฉ ุนุตุจูุฉ ุชูุงููููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุญูุซ ุงููุจุฏุฃ ุ ูุฅู ุฅูุดุงุก ุงูุดุจูุฉ ุงูุนุตุจูุฉ ุงูุฎุงุตุฉ ุจู ููุณ ุจุงูุฃูุฑ ุงูุตุนุจ. ููุงู ุงูุนุฏูุฏ ูู ุงูููุงูุงุช ูุงูุฃูุฑุงู ุงูุนูููุฉ ุญูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฌุฒุฆุฉ ุงูุตูุฑุฉ.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ููุงู ุงููุซูุฑ ูู ุงูููุชุจุงุช ูุงูุฃุฏูุงุช ููุชูุญุฉ ุงููุตุฏุฑ. ููููุง ูุญุชุงุฌ ุฅูู ูุฌููุนุฉ ุจูุงูุงุช ูุชุฎุตุตุฉ ุฌุฏูุง ููุญุตูู ุนูู ูุชุงุฆุฌ ุฌูุฏุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนูู ูุฌู ุงูุฎุตูุต ุ ูุญุชุงุฌ ุฅูู ุงููุซูุฑ ูู ุงูุตูุฑ ุงูุชู ุชุดุจู ุชูู ุงูุชู ุชู ุงูุญุตูู ุนูููุง ูู ูุงููุฑุง ููุจ ุ ูุน ุตูุฑุฉ ูุซุงููุฉ ูุดุฎุต ูู ุงูููุฏูุฉ. ูุฌุจ ุชูููุฒ ูู ุจูุณู ูู ูุฐู ุงูุตูุฑุฉ ุนูู ุฃูู ูุฎุชูู ุนู ุงูุฎูููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฏ ูุง ูุชุทูุจ ุจูุงุก ูุฌููุนุฉ ุงูุจูุงูุงุช ูุฐู ุงุณุชุนุฏุงุฏูุง ูุชุฏุฑูุจ ุดุจูุฉ ุนุตุจูุฉ ุงููุซูุฑ ูู ุงูุฌูุฏ. ููุฑุฌุน ุฐูู ุฅูู ุญูููุฉ ุฃู ูุฑูู ุงูุจุงุญุซูู ูู Google ูุฏ ูุงู ุจูู ูุง ูู ุฃุตุนุจ ุจุงููุนู ููุถุน ุดุจูุฉ ุนุตุจูุฉ ูุฏุฑุจุฉ ูุณุจููุง ูุชุตููู ุงูุฃุดุฎุงุต ุฅูู ุงููุตุฏุฑ ุงูููุชูุญ. ุชุณูู ูุฐู ุงูุดุจูุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BodyPix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุฃูู ูุนูู ุจุดูู ุฌูุฏ ุฌุฏุง! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชููุฑ BodyPix ุงูุขู ููุท ูู ุดูู ููุงุณุจ ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TensorFlow.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ููุชูุฌุฉ ูุฐูู ุ ูู ุงูุฃุณูู ุชูุฏูู ุงูุทูุจ ุจุงุณุชุฎุฏุงู ููุชุจุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">body-pix-node</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุณุฑูุน </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฎุฑุงุฌ ุงูุดุจูุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ุงูุชููุนุงุช) ูู ุงููุชุตูุญ ุ ููุถู ุงุณุชุฎุฏุงู </font><font style="vertical-align: inherit;">ุงููุงุฌูุฉ ุงูุฎูููุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebGL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูููู ูู ุจูุฆุฉ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Node.js</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููููู ุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฌูุฉ ุงูุฎูููุฉ Tensorflow GPU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ูุงุญุธ ุฃู ูุฐุง ุณูุชุทูุจ ุจุทุงูุฉ ููุฏูู ูู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIDIA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุฏู). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุฃุฌู ุชุจุณูุท ุฅุนุฏุงุฏ ุงููุดุฑูุน ุ ุณูุณุชุฎุฏู ุจูุฆุฉ ุญุงููุฉ ุตุบูุฑุฉ ุชููุฑ ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณูููุงุช TensorFlow ู Node.js. ุจุงุณุชุฎุฏุงู ูู ุดูุก ูุน </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nvidia-docker</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ุฃุณูู ุจูุซูุฑ ูู ุฌูุน ุงูุชุจุนูุงุช ุงููุงุฒูุฉ ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู ุจููุณู. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูุง ุนููู ุณูู Docker ูุฃุญุฏุซ ุจุฑุงูุฌ ุชุดุบูู ุงูุฑุณููุงุช ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงูุฎุงุต ุจู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ูุญุชููุงุช ุงูููู </font></font><code>bodypix/package.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="json hljs">{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"name"</span>: <span class="hljs-string">"bodypix"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.1"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"dependencies"</span>: {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"@tensorflow-models/body-pix"</span>: <span class="hljs-string">"^2.0.5"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">"@tensorflow/tfjs-node-gpu"</span>: <span class="hljs-string">"^1.7.1"</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ุงูููู </font></font><code>bodypix/Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  ,   TensorFlow GPU</span>
FROM nvcr.io/nvidia/cuda:<span class="hljs-number">10.0</span>-cudnn7-runtime-ubuntu18<span class="hljs-number">.04</span>
<span class="hljs-comment">#  node</span><font></font>
RUN apt update &amp;&amp; apt install -y curl make build-essential \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; curl -sL https://deb.nodesource.com/setup_12.x | bash - \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; apt-get -y install nodejs \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; mkdir /.npm \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; chmod <span class="hljs-number">777</span> /.npm
<span class="hljs-comment"># ,    &nbsp;</span>
<span class="hljs-comment">#   tfjs-node-gpu      GPU :(</span><font></font>
ENV TF_FORCE_GPU_ALLOW_GROWTH=true<font></font>
<span class="hljs-comment">#  node-</span><font></font>
WORKDIR /src<font></font>
COPY package.json /src/<font></font>
RUN npm install<font></font>
<span class="hljs-comment">#      </span><font></font>
COPY app.js /src/<font></font>
ENTRYPOINT node /src/app.js<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุฏุนููุง ูุชุญุฏุซ ุนู ุงูุญุตูู ุนูู ูุชุงุฆุฌ. </font><font style="vertical-align: inherit;">ูููู ุฃุญุฐุฑู ุนูู ุงูููุฑ: ุฃูุง ูุณุช ุฎุจูุฑูุง ูู Node.js! </font><font style="vertical-align: inherit;">ูุฐู ูุฌุฑุฏ ูุชูุฌุฉ ูุชุฌุงุฑุจู ุงููุณุงุฆูุฉ ุ ูุฐุง ูู ูุชุณุงููุงู ูุนู :-). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงููุต ุงูุจุฑูุฌู ุงูุจุณูุท ุงูุชุงูู ูุดุบูู ูู ูุนุงูุฌุฉ ุตูุฑุฉ ููุงุน ุซูุงุฆู ุชู ุฅุฑุณุงููุง ุฅูู ุงูุฎุงุฏู ุจุงุณุชุฎุฏุงู ุทูุจ HTTP POST. </font><font style="vertical-align: inherit;">ุงูููุงุน ุนุจุงุฑุฉ ุนู ุตููู ุซูุงุฆู ุงูุฃุจุนุงุฏ ูู ูุญุฏุงุช ุงูุจูุณู. </font><font style="vertical-align: inherit;">ุงูุจูุณูุงุช ุงูุชู ุชูุซููุง ุงูุฃุตูุงุฑ ูู ุงูุฎูููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅููู ุฑูุฒ ุงูููู </font></font><code>app.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">const</span> tf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@tensorflow/tfjs-node-gpu'</span>);
<span class="hljs-keyword">const</span> bodyPix = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@tensorflow-models/body-pix'</span>);
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> net = <span class="hljs-keyword">await</span> bodyPix.load({
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">architecture</span>: <span class="hljs-string">'MobileNetV1'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">outputStride</span>: <span class="hljs-number">16</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">multiplier</span>: <span class="hljs-number">0.75</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">quantBytes</span>: <span class="hljs-number">2</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> server = http.createServer();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;server.on(<span class="hljs-string">'request'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">var</span> chunks = [];<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.on(<span class="hljs-string">'data'</span>, (chunk) =&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chunks.push(chunk);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.on(<span class="hljs-string">'end'</span>, <span class="hljs-keyword">async</span> () =&gt; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> image = tf.node.decodeImage(Buffer.concat(chunks));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;segmentation = <span class="hljs-keyword">await</span> net.segmentPerson(image, {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">flipHorizontal</span>: <span class="hljs-literal">false</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">internalResolution</span>: <span class="hljs-string">'medium'</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-attr">segmentationThreshold</span>: <span class="hljs-number">0.7</span>,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.writeHead(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span> });<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.write(Buffer.from(segmentation.data));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res.end();<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tf.dispose(image);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;server.listen(<span class="hljs-number">9000</span>);<font></font>
})();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุญููู ุงูุฅุทุงุฑ ุฅูู ููุงุนุ ูุฅููุงุ ูู ุจุฑูุงูุฌ ูุตู ุจูุซููุ ููููู ุงุณุชุฎุฏุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุงู</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทูุจุงุช</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุญุฒู </font><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_mask</span>(<span class="hljs-params">frame, bodypix_url=<span class="hljs-string">'http://localhost:9000'</span></span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;_, data = cv2.imencode(<span class="hljs-string">".jpg"</span>, frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url=bodypix_url,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=data.tobytes(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers={<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span>})
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     numpy-</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     uint8[width * height]   0  1</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = np.frombuffer(r.content, dtype=np.uint8)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = mask.reshape((frame.shape[<span class="hljs-number">0</span>], frame.shape[<span class="hljs-number">1</span>]))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงููุชูุฌุฉ ูู ูุง ููู ุชูุฑูุจูุง.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e51/7db/e3c/e517dbe3ce6eee99d646a8e4257a627f.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงุน</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุจูููุง ููุช ุฃููู ุจูู ูุฐุง ุ ุตุงุฏูุช</font><font style="vertical-align: inherit;">ุงูุชุบุฑูุฏุฉ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุชุงููุฉ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a5/c4b/4dd/5a5c4b4dda480f0fa58807ec5b89b457.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐู ุจุงูุชุฃููุฏ ุฃูุถู ุฎูููุฉ ูููุงููุงุช ุงูููุฏูู ุ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ูุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ูุฏููุง ููุงุน ููุตู ุงูููุฏูุฉ ุนู ุงูุฎูููุฉ ุ ูุฅู ุงุณุชุจุฏุงู ุงูุฎูููุฉ ุจุดูุก ุขุฎุฑ ุณูููู ุจุณูุทูุง ุฌุฏูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชูุทุช ุตูุฑุฉ ุงูุฎูููุฉ ูู ูุฑุน ุงูุชุบุฑูุฏุงุช ูููุช ุจูุตูุง ุญุชู ุฃุญุตู ุนูู ุตูุฑุฉ 16x9.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/311/537/900311537df81d74a682ddfd447a85a5.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุฑุฉ ุงูุฎูููุฉ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุจุนุฏ ุฐูู ููุช ุจูุง ููู:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    (     16:9)</span>
replacement_bg_raw = cv2.imread(<span class="hljs-string">"background.jpg"</span>)<font></font>
<font></font>
<span class="hljs-comment">#    ,       (width &amp; height   )</span>
width, height = <span class="hljs-number">720</span>, <span class="hljs-number">1280</span><font></font>
replacement_bg = cv2.resize(replacement_bg_raw, (width, height))<font></font>
<font></font>
<span class="hljs-comment">#     ,   </span>
inv_mask = <span class="hljs-number">1</span>-mask
<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> range(frame.shape[<span class="hljs-number">2</span>]):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame[:,:,c] = frame[:,:,c]*mask + replacement_bg[:,:,c]*inv_mask<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฐุง ูุง ุญุตูุช ุนููู ุจุนุฏ ุฐูู.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/500/fbf/e3b/500fbfe3ba3753878562533ced87ed69.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฌุฉ ุงุณุชุจุฏุงู ุงูุฎูููุฉ ูู</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุงููุงุถุญ ุฃู ูุฐุง ุงูููุงุน ุบูุฑ ุฏููู ุจูุง ููู ุงูููุงูุฉ ุ ูุงูุณุจุจ ูู ุฐูู ูู ููุงูุถุงุช ุงูุฃุฏุงุก ุงูุชู ูููุง ุจูุง ุนูุฏ ุฅุนุฏุงุฏ BodyPix. </font><font style="vertical-align: inherit;">ุจุดูู ุนุงู ุ ุจูููุง ูุจุฏู ูู ุดูุก ุฃูุซุฑ ุฃู ุฃูู ุชุณุงูุญูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุ ุนูุฏูุง ูุธุฑุช ุฅูู ูุฐู ุงูุฎูููุฉ ุ ุฌุงุกุช ูู ููุฑุฉ ูุงุญุฏุฉ.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฌุงุฑุจ ูุซูุฑุฉ ููุงูุชูุงู</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุจุนุฏ ุฃู ุงูุชุดููุง ููููุฉ ุงูุฅุฎูุงุก ุ ุณูุณุฃู ุนู ููููุฉ ุชุญุณูู ุงููุชูุฌุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุฎุทูุฉ ุงูุฃููู ุงููุงุถุญุฉ ูู ุชูุนูู ุญูุงู ุงูููุงุน. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุงูููุงู ุจุฐูู ุนูู ุงููุญู ุงูุชุงูู:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_process_mask</span>(<span class="hljs-params">mask</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.dilate(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.erode(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุณูุคุฏู ุฐูู ุฅูู ุชุญุณูู ุงููุถุน ููููุงู ุ ูููู ููุณ ููุงู ุชูุฏู ูุจูุฑ. </font><font style="vertical-align: inherit;">ูุจุฏูู ุจุณูุท ููู ููุบุงูุฉ. </font><font style="vertical-align: inherit;">ูููู ุ ุจูุง ุฃููุง ูุตููุง ุฅูู ูู ูุฐุง ุจุฃููุณูุง ุ ููุฐุง ูุนูู ุฃูู ูููููุง ูุนู ุฃู ุดูุก ุจุงูุตูุฑุฉ ุ ูููุณ ููุท ุฅุฒุงูุฉ ุงูุฎูููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุธุฑูุง ูุฃููุง ูุณุชุฎุฏู ุฎูููุฉ ุงูุชุฑุงุถูุฉ ูู Star Wars ุ ููุฏ ูุฑุฑุช ุฅูุดุงุก ุชุฃุซูุฑ ุงูููููุบุฑุงู ูุฌุนู ุงูุตูุฑุฉ ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู. </font><font style="vertical-align: inherit;">ูุฐุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุณูุญ ูู ุจุชุฎููู ุถุจุงุจูุฉ ุงูููุงุน. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ุญุฏููุซ ุฑูุฒ ูุง ุจุนุฏ ุงููุนุงูุฌุฉ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_process_mask</span>(<span class="hljs-params">mask</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.dilate(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.blur(mask.astype(float), (<span class="hljs-number">30</span>,<span class="hljs-number">30</span>))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุญูุงู ุงูุขู ุถุจุงุจูุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ุฃูุฑ ุฌูุฏ ุ ููููุง ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ุชุฃุซูุฑ ุงูููููุบุฑุงู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุนุงุฏุฉู ูุง ุชุญุชูู ุงูุตูุฑ ุงููุฌุณูุฉ ูููููููุฏ ุนูู ุงูุฎุตุงุฆุต ุงูุชุงููุฉ:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุฑุฉ ุจุงูุชุฉ ุฃู ุฃุญุงุฏูุฉ ุงูููู - ููุง ูู ุชู ุฑุณููุง ุจูุงุณุทุฉ ููุฒุฑ ุณุงุทุน.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฃุซูุฑ ูุฐูุฑูุง ุจุฎุทูุท ุงููุณุญ ุฃู ุดูุก ูุดุจู ุงูุดุจูุฉ - ููุง ูู ูุงูุช ุงูุตูุฑุฉ ูุนุฑูุถุฉ ุจุนุฏุฉ ุฃุดุนุฉ.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"ุชุฃุซูุฑ ุงูุฃุดุจุงุญ" - ููุง ูู ุฃู ุงูุฅุณูุงุท ูุชู ูู ุทุจูุงุช ุฃู ููุง ูู ุฃู ุงููุณุงูุฉ ุงูุตุญูุญุฉ ุงูุชู ูุฌุจ ุนุฑุถูุง ุนูุฏูุง ูู ูุชู ุงูุญูุงุธ ุนูููุง ุฃุซูุงุก ุฅูุดุงุก ุงูุฅุณูุงุท.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูููู ุชูููุฐ ูู ูุฐู ุงูุขุซุงุฑ ุฎุทูุฉ ุจุฎุทูุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ูุชูููู ุงูุตูุฑุฉ ุจุธู ุฃุฒุฑู ุ ูููููุง ุงุณุชุฎุฏุงู ุงูุทุฑููุฉ </font></font><code>applyColorMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#     -  </span><font></font>
holo = cv2.applyColorMap(frame, cv2.COLORMAP_WINTER)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุชุงูู - ุฃุถู ุฎุท ูุณุญ ูุน ุชุฃุซูุฑ ูุฐูุฑูุง ุจุงููุบุงุฏุฑุฉ ูู ูุตู ุงูุฃููุงู:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#    bandLength    10-30%,</span>
<span class="hljs-comment">#    bandGap.</span>
bandLength, bandGap = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>
<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(holo.shape[<span class="hljs-number">0</span>]):
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> y % (bandLength+bandGap) &lt; bandLength:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;holo[y,:,:] = holo[y,:,:] * np.random.uniform(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุนุฏ ุฐูู ุ ูููู ุจุชุทุจูู "ุชุฃุซูุฑ ุงูุดุจุญ" ุจุฅุถุงูุฉ ูุณุฎ ูุฑุฌุญุฉ ูู ุงูุชุฃุซูุฑ ุงูุญุงูู ููุตูุฑุฉ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># shift_img : https://stackoverflow.com/a/53140617</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_img</span>(<span class="hljs-params">img, dx, dy</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dy, axis=<span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dx, axis=<span class="hljs-number">1</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dy&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:dy, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dy&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[dy:, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dx&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, :dx] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dx&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, dx:] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> img<font></font>
<font></font>
<span class="hljs-comment">#    : holo * 0.2 + shifted_holo * 0.8 + 0</span>
holo2 = cv2.addWeighted(holo, <span class="hljs-number">0.2</span>, shift_img(holo1.copy(), <span class="hljs-number">5</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0.8</span>, <span class="hljs-number">0</span>)<font></font>
holo2 = cv2.addWeighted(holo2, <span class="hljs-number">0.4</span>, shift_img(holo1.copy(), <span class="hljs-number">-5</span>, <span class="hljs-number">-5</span>), <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฃุฎูุฑูุง ุ ูุฑูุฏ ุงูุงุญุชูุงุธ ุจุจุนุถ ุงูุฃููุงู ุงูุฃุตููุฉ ุ ูุฐูู ูุฌูุน ุจูู ุงูุชุฃุซูุฑ ุงููุฌุณู ูุงูุฅุทุงุฑ ุงูุฃุตูู ุ ูููุนู ุดูุฆูุง ูุดุงุจููุง ูุฅุถุงูุฉ "ุชุฃุซูุฑ ุงูุดุจุญ":</font></font><br>
<br>
<pre><code class="python hljs">holo_done = cv2.addWeighted(img, <span class="hljs-number">0.5</span>, holo2, <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅููู ูุง ูุจุฏู ุนููู ุงูุฅุทุงุฑ ุฐู ุชุฃุซูุฑ ุงูููููุบุฑุงู:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ba/bda/21c/8babda21c3f11e9fa3867faf65e14c24.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุทุงุฑ ูู ุชุฃุซูุฑ ุงูููููุบุฑุงู</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ูุจุฏู ูุฐุง ุงูุฅุทุงุฑ ููุณู ุฌูุฏูุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุฏุนูุง ูุญุงูู ุฏูุฌู ูุน ุงูุฎูููุฉ.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/297/7b7/ce4/2977b7ce4f9efdedd6632ffb0a3ad621.jpg"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุตูุฑุฉ ูุถุงููู ุนูู ุงูุฎูููุฉ.</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุงูููุงู ุจู! </font><font style="vertical-align: inherit;">(ุฃุนุฏู - ุณูุจุฏู ูุฐุง ุงูููุน ูู ุงูููุฏูู ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู).</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฎุฑุงุฌ ุงูููุฏูู</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุงูุขู ูุฌุจ ุฃู ุฃููู ุฃููุง ูุงุชูุง ุดูุก ููุง. </font><font style="vertical-align: inherit;">ุงูุญูููุฉ ูู ุฃููุง ูุง ุฒููุง ูุง ูุณุชุทูุน ุงุณุชุฎุฏุงู ูู ูุฐู ูุฅุฌุฑุงุก ููุงููุงุช ุงูููุฏูู. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุฅุตูุงุญ ุฐูู ุ ุณูุณุชุฎุฏู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfakewebcam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v4l2loopback</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅูุดุงุก ูุงููุฑุง ููุจ ููููุฉ. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฎุทุท ูุชูุตูู ูุฐู ุงููุงููุฑุง ุฅูู Docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฃููุงู ุ ุฃูุดุฆ ููู </font></font><code>fakecam/requirements.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุตู ุงูุชุจุนูุฉ:</font></font><br>
<br>
<pre><code class="python hljs">numpy==<span class="hljs-number">1.18</span><span class="hljs-number">.2</span>
opencv-python==<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><span class="hljs-number">.32</span>
requests==<span class="hljs-number">2.23</span><span class="hljs-number">.0</span>
pyfakewebcam==<span class="hljs-number">0.1</span><span class="hljs-number">.0</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ูู ุจุฅูุดุงุก ููู </font></font><code>fakecam/Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุทุจูู ุงูุฐู ูุทุจู ูุฏุฑุงุช ูุงููุฑุง ููููุฉ:</font></font><br>
<br>
<pre><code class="python hljs">FROM python:<span class="hljs-number">3</span>-buster
<span class="hljs-comment">#   pip</span><font></font>
RUN pip install --upgrade pip<font></font>
<span class="hljs-comment">#   opencv</span><font></font>
RUN apt-get update &amp;&amp; \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;apt-get install -y \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<span class="hljs-comment"># opencv requirements` \</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libsm6 libxext6 libxrender-dev \<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<span class="hljs-comment"># opencv video opening requirements` \</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libv4l-dev<font></font>
<span class="hljs-comment">#    requirements.txt</span><font></font>
WORKDIR /src<font></font>
COPY requirements.txt /src/<font></font>
RUN pip install --no-cache-dir -r /src/requirements.txt<font></font>
<span class="hljs-comment">#   </span><font></font>
COPY background.jpg /data/<font></font>
<span class="hljs-comment">#     (     )</span><font></font>
COPY fake.py /src/<font></font>
ENTRYPOINT python -u fake.py<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุ ูู ุณุทุฑ ุงูุฃูุงูุฑ ุ ูู ุจุชุซุจูุช v4l2loopback:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt install v4l2loopback-dkms
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุฅุนุฏุงุฏ ูุงููุฑุง ููููุฉ:</font></font><br>
<br>
<pre><code class="python hljs">sudo modprobe -r v4l2loopback<font></font>
sudo modprobe v4l2loopback devices=<span class="hljs-number">1</span> video_nr=<span class="hljs-number">20</span> card_label=<span class="hljs-string">"v4l2loopback"</span> exclusive_caps=<span class="hljs-number">1</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุถูุงู ุนูู ุจุนุถ ุงูุชุทุจููุงุช (Chrome ุ Zoom) ุ ูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ </font></font><code>exclusive_caps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>card_label</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชู ุชุนููู </font><font style="vertical-align: inherit;">ุงูุนูุงูุฉ </font><font style="vertical-align: inherit;">ููุท ูุถูุงู ุฑุงุญุฉ ุงุฎุชูุงุฑ ุงููุงููุฑุง ูู ุงูุชุทุจููุงุช. </font></font><code>video_nr=20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุคุฏู ุชุญุฏูุฏ </font><font style="vertical-align: inherit;">ุงูุฑูู </font><font style="vertical-align: inherit;">ุฅูู ุฅูุดุงุก ุงูุฌูุงุฒ </font></font><code>/dev/video20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุฐุง ูุงู ุงูุฑูู ุงูููุงุจู ุบูุฑ ูุดุบูู ุ ููู ุบูุฑ ุงููุญุชูู ุฃู ูููู ูุดุบูููุง. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุณูููู ุจุฅุฌุฑุงุก ุชุบููุฑุงุช ุนูู ุงูุจุฑูุงูุฌ ุงููุตู ูุฅูุดุงุก ูุงููุฑุง ููููุฉ:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment"># ,  ,   ,   ,  width  height</span>
fake = pyfakewebcam.FakeWebcam(<span class="hljs-string">'/dev/video20'</span>, width, height)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู pyfakewebcam ุชุชููุน ุตูุฑูุง ุจูููุงุช RGB (ุฃุญูุฑ ุ ุฃุฎุถุฑ ุ ุฃุฒุฑู - ุฃุญูุฑ ุ ุฃุฎุถุฑ ุ ุฃุฒุฑู) ุ ูุชุนูู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงูููุชูุญุฉ ุจุชุฑุชูุจ ูููุงุช BGR (ุฃุฒุฑู ุ ุฃุฎุถุฑ ุ ุฃุญูุฑ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููููู ุฅุตูุงุญ ูุฐุง ูุจู ุฅุฎุฑุงุฌ ุงูุฅุทุงุฑ ุ ุซู ุฅุฑุณุงู ุงูุฅุทุงุฑ ูุซู ูุฐุง:</font></font><br>
<br>
<pre><code class="python hljs">frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)<font></font>
fake.schedule_frame(frame)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุฅููู ุฑูุฒ ุงููุต ุงููุงูู </font></font><code>fakecam/fake.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> pyfakewebcam<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_mask</span>(<span class="hljs-params">frame, bodypix_url=<span class="hljs-string">'http://localhost:9000'</span></span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;_, data = cv2.imencode(<span class="hljs-string">".jpg"</span>, frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;r = requests.post(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url=bodypix_url,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=data.tobytes(),<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers={<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/octet-stream'</span>})<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = np.frombuffer(r.content, dtype=np.uint8)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = mask.reshape((frame.shape[<span class="hljs-number">0</span>], frame.shape[<span class="hljs-number">1</span>]))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post_process_mask</span>(<span class="hljs-params">mask</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.dilate(mask, np.ones((<span class="hljs-number">10</span>,<span class="hljs-number">10</span>), np.uint8) , iterations=<span class="hljs-number">1</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = cv2.blur(mask.astype(float), (<span class="hljs-number">30</span>,<span class="hljs-number">30</span>))
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> mask<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_image</span>(<span class="hljs-params">img, dx, dy</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dy, axis=<span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;img = np.roll(img, dx, axis=<span class="hljs-number">1</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dy&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:dy, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dy&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[dy:, :] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> dx&gt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, :dx] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span> dx&lt;<span class="hljs-number">0</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;img[:, dx:] = <span class="hljs-number">0</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> img<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hologram_effect</span>(<span class="hljs-params">img</span>):</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#    </span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;holo = cv2.applyColorMap(img, cv2.COLORMAP_WINTER)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#   </span>
&nbsp;&nbsp;&nbsp;&nbsp;bandLength, bandGap = <span class="hljs-number">2</span>, <span class="hljs-number">3</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> range(holo.shape[<span class="hljs-number">0</span>]):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> y % (bandLength+bandGap) &lt; bandLength:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;holo[y,:,:] = holo[y,:,:] * np.random.uniform(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#  </span>
&nbsp;&nbsp;&nbsp;&nbsp;holo_blur = cv2.addWeighted(holo, <span class="hljs-number">0.2</span>, shift_image(holo.copy(), <span class="hljs-number">5</span>, <span class="hljs-number">5</span>), <span class="hljs-number">0.8</span>, <span class="hljs-number">0</span>)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;holo_blur = cv2.addWeighted(holo_blur, <span class="hljs-number">0.4</span>, shift_image(holo.copy(), <span class="hljs-number">-5</span>, <span class="hljs-number">-5</span>), <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     </span>
&nbsp;&nbsp;&nbsp;&nbsp;out = cv2.addWeighted(img, <span class="hljs-number">0.5</span>, holo_blur, <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> out<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_frame</span>(<span class="hljs-params">cap, background_scaled</span>):</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;_, frame = cap.read()<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#      (  ,   )</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#       </span>
&nbsp;&nbsp;&nbsp;&nbsp;mask = <span class="hljs-literal">None</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">while</span> mask <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask = get_mask(frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">except</span> requests.RequestException:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(<span class="hljs-string">"mask request failed, retrying"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment"># -   </span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;mask = post_process_mask(mask)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame = hologram_effect(frame)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#     </span>
&nbsp;&nbsp;&nbsp;&nbsp;inv_mask = <span class="hljs-number">1</span>-mask
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> range(frame.shape[<span class="hljs-number">2</span>]):<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame[:,:,c] = frame[:,:,c]*mask + background_scaled[:,:,c]*inv_mask<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> frame<font></font>
<font></font>
<span class="hljs-comment">#     </span>
cap = cv2.VideoCapture(<span class="hljs-string">'/dev/video0'</span>)<font></font>
height, width = <span class="hljs-number">720</span>, <span class="hljs-number">1280</span><font></font>
cap.set(cv2.CAP_PROP_FRAME_WIDTH, width)<font></font>
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, height)<font></font>
cap.set(cv2.CAP_PROP_FPS, <span class="hljs-number">60</span>)<font></font>
<font></font>
<span class="hljs-comment">#   </span>
fake = pyfakewebcam.FakeWebcam(<span class="hljs-string">'/dev/video20'</span>, width, height)<font></font>
<font></font>
<span class="hljs-comment">#    </span>
background = cv2.imread(<span class="hljs-string">"/data/background.jpg"</span>)<font></font>
background_scaled = cv2.resize(background, (width, height))<font></font>
<font></font>
<span class="hljs-comment">#    </span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame = get_frame(cap, background_scaled)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">#    RGB-</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;fake.schedule_frame(frame)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ุงูุขู ุฌูุน ุงูุตูุฑ:</font></font><br>
<br>
<pre><code class="python hljs">docker build -t bodypix ./bodypix<font></font>
docker build -t fakecam ./fakecam<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูู ุจุชุดุบูููุง:</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-comment">#  </span><font></font>
docker network create --driver bridge fakecam<font></font>
<span class="hljs-comment">#   bodypix</span><font></font>
docker run -d \<font></font>
&nbsp;&nbsp;--name=bodypix \<font></font>
&nbsp;&nbsp;--network=fakecam \<font></font>
&nbsp;&nbsp;--gpus=all --shm-size=<span class="hljs-number">1</span>g --ulimit memlock=<span class="hljs-number">-1</span> --ulimit stack=<span class="hljs-number">67108864</span> \<font></font>
&nbsp;&nbsp;bodypix<font></font>
<span class="hljs-comment">#  ,  ,      ,  ,</span>
<span class="hljs-comment">#           </span>
<span class="hljs-comment"># ,     `sudo groupadd $USER video`</span><font></font>
docker run -d \<font></font>
&nbsp;&nbsp;--name=fakecam \<font></font>
&nbsp;&nbsp;--network=fakecam \<font></font>
&nbsp;&nbsp;-p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> \<font></font>
&nbsp;&nbsp;-u <span class="hljs-string">"$$(id -u):$$(getent group video | cut -d: -f3)"</span> \<font></font>
&nbsp;&nbsp;$$(find /dev -name <span class="hljs-string">'video*'</span> -printf <span class="hljs-string">"--device %p "</span>) \<font></font>
&nbsp;&nbsp;fakecam<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุจูู ููุท ุฃู ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุฃู ูุฐุง ูุฌุจ ุฃู ูุจุฏุฃ ูุจู ูุชุญ ุงููุงููุฑุง ุนูุฏ ุงูุนูู ูุน ุฃู ุชุทุจููุงุช. </font><font style="vertical-align: inherit;">ููู ุชูุจูุฑ ุฃู ูู ููุงู ุขุฎุฑ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูุงููุฑุง </font></font><code>v4l2loopback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>/dev/video20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฎุต</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ููุง ููุทุน ููุถุญ ูุชุงุฆุฌ ุนููู.</font></font><br>
<br>
<div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุตูุญู ูุง ูุฏุนู ููุฏูู HTML5.</font></font><source src="https://elder.dev/posts/open-source-virtual-background/holo-demo.webm" type="video/webm"></video></div></div></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชูุฌุฉ ุชุบููุฑ ุงูุฎูููุฉ</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
ุงูุธุฑ! </font><font style="vertical-align: inherit;">ุฃุชุตู ูู Millennium Falcon ุจุงุณุชุฎุฏุงู ููุฏุณ ุงูุชูููููุฌูุง ููุชูุญ ุงููุตุฏุฑ ููุนูู ูุน ุงููุงููุฑุง! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ูุง ูุนูุชู ุ ููุฏ ุฃุญุจุจุช ุญููุง. </font><font style="vertical-align: inherit;">ูุณุฃุณุชููุฏ ุจุงูุชุฃููุฏ ูู ูู ูุฐุง ูู ูุคุชูุฑ ุงูููุฏูู ุงูุชุงูู. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฑุงุก ุงูุฃุนุฒุงุก! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุฎุทุท ูุชุบููุฑ ูุง ูู ูุฑุฆู ุฃุซูุงุก ููุงููุงุช ุงูููุฏูู ุฎููู ูุดูุก ุขุฎุฑุ</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/iq/fi/b4/iqfib45pgphfrxv--zfemt0qnmw.jpeg"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar498446/index.html">ุฃุณุฆูุฉ ุงููุธููุฉ: ุงูุงุณุชูุฑุงุฑ ุงูุฎูุงูู ูุงูุชูุงูู ุงููุงุฐุจ ูุชุญุฏูุฏ ุงูููุงูุน</a></li>
<li><a href="../ar498450/index.html">ุชูุฑุงุฑ MultiSim - ูุง ูู ูููู ูุนูู</a></li>
<li><a href="../ar498452/index.html">Django: ุฏููู ุณุฑูุน ููุชุฏููู</a></li>
<li><a href="../ar498454/index.html">ุญูุงูุงุช ูุทูุฑู ุฃูุนุงุจู ุงูููุถูุฉ ุญูู ูุง ููุชุฎุฑูู ุจู</a></li>
<li><a href="../ar498456/index.html">ููุงุฑุณุฉ CSS ุงูุชูุฑูุฑ ุงูุชูุฑูุฑ</a></li>
<li><a href="../ar498462/index.html">ุงูุชูุฑูุฑ ุงููุงููุงุฆู ูุน ูุงูุชุงุช ุ ุฃู ููููุฉ ุงูููุงู ุจุซูุงุซ ุทุฑู ุนุฑุถ</a></li>
<li><a href="../ar498466/index.html">ููู ุชุณุงุนุฏ ุฃุฌูุฒุฉ ุงูููุฒุฑ ูุฃุฌูุฒุฉ ุงูุงุณุชุดุนุงุฑ ูู ุฅุจูุงุก ุงููุถุงุฉ ูุชูุชุฑูู</a></li>
<li><a href="../ar498472/index.html">ุตูุฑุฉ ูุฑุณู ุชุทุจูู ุตูุญุฉ ูุงุญุฏุฉ</a></li>
<li><a href="../ar498476/index.html">ุฅููุงููุฉ ุงููุตูู ููููุฉ ุฌุนู ุงูุชุทุจูู ูู ูุชูุงูู ุงููุณุชุฎุฏููู ุฐูู ุงูุฅุนุงูุฉ</a></li>
<li><a href="../ar498478/index.html">ูุง ูู Windows PowerShell ููุงุฐุง ูุฃููุ ุงูุฌุฒุก 5: ุงููุตูู ุฅูู ูุงุฆูุงุช ุฎุงุฑุฌูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>