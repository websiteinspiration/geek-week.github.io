<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😯 🕕 👨🏿‍🔬 Erreur avec la directive #line dans le compilateur Visual C ++ 🤶 🕴🏿 👨🏼‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La directive #line est ajoutée par le préprocesseur et peut ensuite être utilisée pour comprendre à quel fichier et à quelle ligne un morceau de code ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Erreur avec la directive #line dans le compilateur Visual C ++</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/502918/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c23/e6f/6ec/c23e6f6ecd4b643e19f80e58db05104a.png" alt="image1.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La directive #line est ajoutée par le préprocesseur et peut ensuite être utilisée pour comprendre à quel fichier et à quelle ligne un morceau de code particulier dans le fichier prétraité appartient. </font><font style="vertical-align: inherit;">La directive #line indique aux outils de code de changer le numéro de ligne stocké interne et le nom du fichier du compilateur par le numéro de ligne spécifié. </font><font style="vertical-align: inherit;">Les lignes suivantes compteront déjà par rapport à la position donnée. </font><font style="vertical-align: inherit;">Le prétraitement explicite est principalement utilisé pour le débogage ou par divers générateurs. </font><font style="vertical-align: inherit;">Dans tous les cas, une erreur dans une telle fonctionnalité peut entraîner diverses conséquences négatives. </font><font style="vertical-align: inherit;">Un de ces problèmes s'est produit pour l'utilisateur de PVS-Studio dans Visual Studio 2019.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Historique et description des erreurs</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La directive #line est une partie importante des fichiers prétraités qui sont utilisés par l'analyseur PVS-Studio pour émettre des avertissements sur les lignes de code utilisateur nécessaires. C'est là que commence l'histoire de la recherche d'erreur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un de nos utilisateurs disposant d'une grande base de code a commencé la traduction de l'intégralité du projet de Platform Toolset version v141 à v142 dans Visual Studio 2019. Après cela, dans les résultats de l'analyse, une vague d'avertissements V002 est apparue et plusieurs dizaines d'autres avertissements ont été émis vers les mauvaises lignes de code (erreur d'une ligne )</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagnostics V002 ne détecte que de telles situations (numérotation des lignes incorrecte). </font><font style="vertical-align: inherit;">Cela se produit généralement en raison de macros multi-lignes ou d'autres directives de préprocesseur (par exemple #pragma). </font><font style="vertical-align: inherit;">Le problème ne se produit pas très souvent, mais principalement sur un compilateur de Microsoft. </font><font style="vertical-align: inherit;">Une telle vague de problèmes sur un projet était inattendue, car </font><font style="vertical-align: inherit;">notre système de test n'a pas montré la présence d'un problème aussi grave, et nous avons commencé à déboguer l'analyseur sur le fichier utilisateur prétraité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après quelques heures de débogage, nous avons constaté que l'analyseur fonctionnait déjà avec des données incorrectes sur les lignes de code et avons pu faire un exemple de test:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MACRO(a, b)              <span class="hljs-comment">// line1</span></span>
                                 <span class="hljs-comment">// line2</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span> <span class="hljs-comment">// line3</span>
</span>{                                <span class="hljs-comment">// line4</span>
    MACRO(<span class="hljs-string">"Some string"</span>,         <span class="hljs-comment">// line5</span>
        <span class="hljs-number">42</span>);                     <span class="hljs-comment">// line6</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;                    <span class="hljs-comment">// line7 &lt;=</span>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fichier prétraité est le suivant:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">line</span> 1 <span class="hljs-meta-string">"D:\\_Tests\\TestApp\\Project2\\rnd_bs.cpp"</span></span><font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span>
</span>{<font></font>
  ;<font></font>
<span class="hljs-meta">#<span class="hljs-meta-keyword">line</span> 8 <span class="hljs-meta-string">"D:\\_Tests\\TestApp\\Project2\\rnd_bs.cpp"</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instruction de retour se</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> trouve sur la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ligne du fichier source et le préprocesseur pointe vers la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ligne. </font><font style="vertical-align: inherit;">Cette erreur s'est produite dans le préprocesseur, probablement en raison d'une macro multiligne.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sortie de la version publiée</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au moment de la rédaction, le problème était pertinent pour les dernières versions de Visual Studio, jusqu'à la version 16.4.3 (datée du 14 janvier 2020). Nous avons ouvert le rapport de bogue " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Directive #line non valide après le prétraitement (VS2019, v142)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " et après 4 jours </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">, nous avons</font></a><font style="vertical-align: inherit;"> reçu une réponse intéressante: </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce problème a été identifié comme un doublon d'un retour d'informations précédemment signalé lié ici: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">developercommunity.visualstudio.com/content/problem /738407/preprocessor-generates-incorrect-line-information.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si vous avez signalé ou voté ici, votre vote a été appliqué au problème d'origine. Tout le monde peut ajouter son vote directement aux commentaires liés ci-dessus. Le vote permet d'augmenter la priorité du problème en consolidant l'impact client sous un seul feedback. Je vous remercie!</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'avère que ce problème a déjà été signalé, et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le 18 septembre 2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - il y a presque six mois: "Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">préprocesseur génère des informations de ligne incorrectes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". L'utilisateur a fourni des exemples de code similaires pour reproduire l'erreur. Selon l'auteur, l'erreur existe au moins avec Visual Studio 2019 16.2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On ne sait pas si c'est une coïncidence ou non, mais après quelques jours de notre activité, l'erreur a reçu le statut </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fixe - En attente de libération</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le 19 mai 2020, une version révisée de Visual Studio 2019 16.6.0 a été publiée. Nous recommandons que tous les utilisateurs de PVS-Studio y basculent.</font></font></b><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Svyatoslav Razmyslov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un bogue provoqué par la directive #line dans le compilateur Visual C ++</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr502904/index.html">Exemples de dettes techniques dans la mise en œuvre de systèmes BI</a></li>
<li><a href="../fr502908/index.html">VKontakte, MIPT et GSOM SPbSU ont créé un cours d'apprentissage automatique pour les professeurs d'informatique</a></li>
<li><a href="../fr502910/index.html">Histoire d'Internet: l'ère de la fragmentation; partie 2: semis en friche</a></li>
<li><a href="../fr502914/index.html">Logique mathématique qui peut aider à vérifier plus de personnes pour le coronavirus</a></li>
<li><a href="../fr502916/index.html">Tests unitaires pour le code RxSwift</a></li>
<li><a href="../fr502920/index.html">Comme nous avons testé les performances de nouveaux processeurs dans le cloud pour 1C selon le test de Gilyov</a></li>
<li><a href="../fr502922/index.html">Le marketing de foule comme outil pour améliorer la vitalité des entreprises</a></li>
<li><a href="../fr502924/index.html">Courte critique du téléphone IP Snom D735</a></li>
<li><a href="../fr502926/index.html">Paul Graham: concision = force</a></li>
<li><a href="../fr502928/index.html">Mini-conférence "Travailler en toute sécurité avec les services cloud"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>