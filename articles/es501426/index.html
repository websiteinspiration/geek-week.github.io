<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👼 👏🏼 🥢 Unison: configuración y automatización de la sincronización bidireccional de directorios en dos servidores 🥧 👰🏼 🍕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Getty Images / iStockphoto El
 
 problema de sincronizar directorios en dos servidores con la familia de sistemas operativos Linux a bordo puede resol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Unison: configuración y automatización de la sincronización bidireccional de directorios en dos servidores</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/501426/"><img src="https://habrastorage.org/webt/px/ch/pt/pxchptdqlhxiictuiik4ldo02ka.jpeg"><br>
<sup><font color="9999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Getty Images / iStockphoto El</font></font></font></sup><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
problema de sincronizar directorios en dos servidores con la familia de sistemas operativos Linux a bordo puede resolverse más fácilmente si utiliza herramientas especializadas. Veamos cómo se puede hacer esto con</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unison</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quizás tenga varios servidores y se enfrente a la tarea de sincronizar ciertos directorios en estos servidores. Por ejemplo, debe sincronizar el directorio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en cada uno de estos servidores para que alguna aplicación tenga acceso a información relevante. O tal vez solo necesite hacer una copia de seguridad periódica de los datos de un servidor a otro de forma sincronizada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unison es similar a la utilidad de sincronización </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rsync</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero a diferencia de ella, admite sincronización bidireccional. Es decir, le permite sincronizar dos copias de archivos, actualizando cada copia en función de los cambios realizados.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se usa Unison en servidores, es deseable tener paquetes instalados como openssh-server y ssh, porque por razones de seguridad, la sincronización se realiza mejor usando el protocolo SSH. </font><font style="vertical-align: inherit;">Sin embargo, si confía en la seguridad de su red (por ejemplo, el servidor puede usar la autenticación SSH sin contraseña), no puede molestarse.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Qué más se necesita para usar Unison?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mostraré todo el proceso usando dos servidores Ubuntu como ejemplo (ambos 18.04). </font><font style="vertical-align: inherit;">Puede instalar y usar Unison con otras distribuciones, pero luego deberá cambiar el comando de instalación; de lo contrario, Unison puede instalarse desde repositorios estándar (por supuesto, su usuario debe tener privilegios de sudo). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usaré estos servidores:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1 - 192.168.1.6</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor2 - 192.168.1.19</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo instalar Unison</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo primero que debe tener cuidado es instalar Unison. </font><font style="vertical-align: inherit;">Esto debe hacerse en ambos servidores. </font><font style="vertical-align: inherit;">Vaya a ambos servidores e ingrese el comando:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install unison unison-all -y</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Espere a que la instalación de Unison se complete y continúe.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo generar y copiar una clave SSH</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, generamos la clave SSH solo para el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para hacer esto, use el comando:</font></font><br>
<br>
<pre><code class="bash hljs">ssh-keygen -t rsa</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se le solicite ingresar una contraseña, simplemente presione la tecla ENTER. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se genera la clave, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cópiela</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el </font><b><font style="vertical-align: inherit;">servidor2</font></b><font style="vertical-align: inherit;"> con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">ssh-copy-id 192.168.1.19</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Una vez que se copia la clave, puede proceder directamente a los negocios.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo usar Unison</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creemos un directorio de prueba para cada servidor con fines de prueba. </font><font style="vertical-align: inherit;">Comando para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">sudo mkdir -p /data1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">sudo mkdir -p /data2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, en ambos servidores, debe cambiar el nombre del propietario del directorio creado, de lo contrario, Unison no podrá escribir nada allí. </font><font style="vertical-align: inherit;">Como propietario, especifique el usuario que ejecutará el comando Unison:</font></font><br>
<br>
<pre><code class="bash hljs">sudo chown -R <span class="hljs-variable">$USER</span>.<span class="hljs-variable">$USER</span> /data2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Haga lo mismo para el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">sudo chown -R <span class="hljs-variable">$USER</span>.<span class="hljs-variable">$USER</span> /data1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ponga algunos archivos de prueba en </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ data1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="bash hljs">touch /data1/{test1,test2,test3}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sincronizamos nuestros directorios con el siguiente comando (ejecutándolo en el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<pre><code class="bash hljs">unison /data1 ssh://192.168.1.19//data2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como está intentando sincronizar estos directorios raíz por primera vez, recibirá una advertencia de que la sincronización puede demorar un poco (pero en nuestro caso esto no sucederá, ya que agregamos solo tres archivos de prueba del volumen mínimo al directorio). </font><font style="vertical-align: inherit;">Si se tratara de una copia de seguridad en producción, el primer lanzamiento realmente podría llevar algún tiempo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Así que bebe té la próxima vez. </font><font style="vertical-align: inherit;">Mientras tanto, presione Entrar para iniciar el proceso. </font><font style="vertical-align: inherit;">Después de hacer esto, se le pedirá que confirme la sincronización de cada archivo. </font><font style="vertical-align: inherit;">Cuando termine, ingrese 'y' para continuar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que solo sincronizamos tres archivos de prueba, esto sucederá muy rápidamente y lo devolverá al shell bash. </font><font style="vertical-align: inherit;">Para asegurarse de que los archivos estén sincronizados, vaya al </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e ingrese el comando:</font></font><br>
<br>
<pre><code class="bash hljs">ls /data2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Además, el sistema informará que </font><font style="vertical-align: inherit;">nuestros archivos test1, test2 y test3 están </font><font style="vertical-align: inherit;">en el directorio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ data2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pu/xv/bi/puxvbivby-poqpuch07emsz7kui.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Logramos: Unison sincronizó ambos directorios.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo iniciar Unison sin la necesidad de interacción del usuario</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que no desea confirmar constantemente la sincronización de cada archivo de directorio cada vez que inicie Unison. </font><font style="vertical-align: inherit;">Esto es especialmente molesto cuando sincroniza directorios con una gran cantidad de archivos. </font><font style="vertical-align: inherit;">Por lo tanto, se necesita automatización. </font><font style="vertical-align: inherit;">Vaya al </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e ingrese el comando:</font></font><br>
<br>
<pre><code class="bash hljs">nano ~/.unison/default.prf</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el archivo de configuración se abre para editar, agregue dos líneas:</font></font><br>
<br>
<pre><code class="bash hljs">auto=<span class="hljs-literal">true</span>
batch=<span class="hljs-literal">true</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego guarde y cierre el archivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora Unison no te molestará con pequeñeces. </font><font style="vertical-align: inherit;">Pero eso no es todo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cómo crear una tarea para Cron Scheduler</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creo que difícilmente querría comenzar la sincronización manualmente, porque puede cometer un error en algún lugar o, por ejemplo, no tener en cuenta el cambio en la estructura de directorios en los servidores. </font><font style="vertical-align: inherit;">Para configurar la automatización, debe crear un trabajo cron para el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">servidor1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creemos un script para iniciar la sincronización:</font></font><br>
<br>
<pre><code class="bash hljs">sudo nano /usr/<span class="hljs-built_in">local</span>/bin/unisonsync</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lo siguiente debe agregarse a este archivo: </font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-comment">#!/bin/bash/</span>
unison /data1 ssh://192.168.1.19//data2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuación, debe otorgarle al script el derecho de ejecución:</font></font><br>
<br>
<pre><code class="bash hljs">sudo chmod ugo+x /usr/<span class="hljs-built_in">local</span>/bin/unisonsync</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cree un trabajo para Cron con el comando:</font></font><br>
<br>
<pre><code class="bash hljs">crontab -e</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Después de ese tipo:</font></font><br>
<br>
<pre><code class="bash hljs">*/5 * * * * /usr/<span class="hljs-built_in">local</span>/bin/unisonsync &amp;&gt; /dev/null</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora la sincronización comenzará automáticamente cada 5 minutos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
He demostrado que Unison facilita la sincronización de directorios en dos servidores Linux. </font><font style="vertical-align: inherit;">Puede verificar esto usted mismo agregando archivos a los directorios de prueba </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ data1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ data2 correspondientes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en ambos servidores. </font><font style="vertical-align: inherit;">Después de asegurarte de que la sincronización funciona, puedes usarla en modo combate en servidores de producción.</font></font><br>
<br>
<hr><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como un anuncio</font></font></h4><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VDSina</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> siempre se complace en ofrecer servidores confiables para cualquier tarea. </font><font style="vertical-align: inherit;">Tiene acceso a una gran selección de sistemas operativos para la instalación automática, es posible instalar cualquier sistema operativo desde su propia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , así como utilizar una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">red local de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alta velocidad </font><font style="vertical-align: inherit;">entre servidores dentro de la misma ubicación.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/9fa/cf4/a34/9facf4a348ef01048b4eb5e16ae66daa.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es501414/index.html">Configuración de Debian, Nginx y Gunicorn para un proyecto Django</a></li>
<li><a href="../es501416/index.html">Un poco sobre WebRTC: qué usar y el caso de la práctica</a></li>
<li><a href="../es501418/index.html">Semana 4 Maratón: Motivación</a></li>
<li><a href="../es501420/index.html">Shows en línea de Mitapas y YouTube: JUG Ru Group Stream Week</a></li>
<li><a href="../es501424/index.html">De la vida con Kubernetes: cómo eliminamos DBMS (y no solo) de entornos de revisión a estáticos</a></li>
<li><a href="../es501430/index.html">Gran guía para el diseño y la planificación del contenido del sitio web</a></li>
<li><a href="../es501432/index.html">Dos alternativas a JDBC</a></li>
<li><a href="../es501434/index.html">Semana de la seguridad 20: piratear una computadora a través de Thunderbolt</a></li>
<li><a href="../es501436/index.html">Algoritmo de reconocimiento de números en la imagen con baja probabilidad del segundo tipo de error</a></li>
<li><a href="../es501438/index.html">Cómo funciona la renderización de juegos en 3D: luces y sombras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>