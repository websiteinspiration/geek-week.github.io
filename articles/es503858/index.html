<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👦 ✉️ 🧖🏿 El libro "Terraform: infraestructura a nivel de código" ⚽️ ☔️ 👑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola habrozhiteli! El libro está destinado a todos los responsables del código ya escrito. Esto se aplica a los administradores de sistemas, especiali...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>El libro "Terraform: infraestructura a nivel de código"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/503858/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/el/eg/lp/eleglpt_bkgjd7cftgp1yrmg_gk.jpeg" align="left" alt="imagen"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hola habrozhiteli! El libro está destinado a todos los responsables del código ya escrito. Esto se aplica a los administradores de sistemas, especialistas de operaciones, ingenieros de SR, DevOps, desarrolladores de infraestructura, desarrolladores de ciclo completo, líderes de equipos de ingeniería y directores técnicos. Cualquiera sea su posición, si está involucrado en infraestructura, despliegue código, configure servidores, escale clústeres, haga copias de seguridad de datos, monitoree aplicaciones y responda llamadas a las tres de la mañana, este libro es para usted.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conjunto, estas responsabilidades se denominan comúnmente actividades operativas (o administración del sistema). </font><font style="vertical-align: inherit;">Anteriormente, los desarrolladores que sabían cómo escribir código pero no entendían la administración del sistema a menudo se encontraban; </font><font style="vertical-align: inherit;">Los administradores de sistemas a menudo se encontraron sin la capacidad de escribir código. </font><font style="vertical-align: inherit;">Una vez que esta separación fue aceptable, pero en el mundo moderno, que ya no se puede imaginar sin la computación en la nube y el movimiento DevOps, casi cualquier desarrollador necesita habilidades administrativas, y cualquier administrador del sistema debe poder programar.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No solo aprenderá cómo administrar la infraestructura en forma de código utilizando Terraform, sino que también aprenderá cómo encaja en el concepto general de DevOps. </font><font style="vertical-align: inherit;">Aquí hay algunas preguntas que puede responder leyendo este libro.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¿Por qué usar IaC?</font></font></li>
<li>    , ,     ?</li>
<li>   Terraform, Chef, Ansible, Puppet, Salt, CloudFormation, Docker, Packer  Kubernetes?</li>
<li>   Terraform       ?</li>
<li>   Terraform,    ?</li>
<li>    Terraform,       ?</li>
<li>     Terraform?</li>
<li>  Terraform     ?</li>
<li>    Terraform   ?</li>
</ul><br>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">    </b>
                        <div class="spoiler_text">    2017 .   2019-         ,      !                 .  ,        .<br>
<br>
        ,  ,     ,    Terraform,    .<br>
<br>
<ul>
<li>   Terraform.    ,   Terraform  0.8.     Terraform   0.12.       ,     .  ,   !</li>
<li>   .           Terraform.    , ,    ,  ,    ,  ,  ,    .</li>
<li>  .      Terraform   .  , ,               — ,      .</li>
<li>   .  8      ,      Terraform    . ,  ,      ,          : ,      .</li>
<li>HCL2.  Terraform 0.12   HCL   HCL2.        (       ${…}!),   ,     ,   null, for_each  for,    .          HCL2,         5  6.</li>
<li>   .  Terraform 0.9    .        Terraform    .  Terraform 0.9     ,       ;     0.10      .       3.</li>
<li>    Terraform.  Terraform 0.10         (    AWS, GCP, Azure  . .).         ,         .          terraform init  ,       .       2  7.</li>
<li>   .  2016   Terraform        (AWS, GCP  Azure).      100,  ,  ,   1.               (,     Alicloud, Oracle Cloud Infrastructure, VMware vSphere  .),       ,     (GitHub, GitLab  BitBucket),   (MySQL, PostreSQL  InfluxDB),     ( DataDog, New Relic  Grafana),   Kubernetes, Helm, Heroku, Rundeck  Rightscale   .  ,       : ,   AWS     ,        ,   CloudFormation!</li>
<li>  Terraform.  2017   HashiCorp    Terraform (registry.terraform.io) —  ,         Terraform,  .  2018          .  Terraform 0.11        .       « »  . 153.</li>
<li>  .  Terraform 0.9    :         ,    ,   errored.tfstate.  Terraform 0.12    .    ,            ,     .</li>
<li>   .      ,     (.  «  »  . 144),  « »         (,  «  Terraform»  . 242),  plan    apply (.  «  »  . 64),     create_before_destroy,    count,           (.  «»  . 160),    ,   provider   .</li>
</ul></div>
                    </div><br>
<h3>.    Terraform</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
(se presta mucha más atención a los problemas de las pruebas automáticas en el libro más adelante) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El mundo DevOps está lleno de temores diferentes: todos tienen miedo de permitir que las cosas funcionen, pierdan datos o sean pirateados. Al realizar cualquier cambio, siempre se pregunta qué consecuencias tendrá. ¿Se comportará igual en todos los entornos? ¿Causará otra interrupción? Y, si eso sucede, ¿cuánto tendrá que permanecer en el trabajo esta vez para arreglarlo? A medida que la empresa crece, hay más en juego, lo que empeora el proceso de implementación y aumenta el riesgo de errores. Muchas compañías intentan minimizar este riesgo a través de implementaciones menos frecuentes, pero como resultado, cada implementación individual se vuelve más grande y más propensa a errores.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si administra su infraestructura en forma de código, tiene una mejor manera de minimizar los riesgos: las pruebas. </font><font style="vertical-align: inherit;">Su objetivo es darle suficiente confianza para hacer cambios. </font><font style="vertical-align: inherit;">La palabra clave aquí es confianza: ninguna prueba puede garantizar que no haya errores, por lo que es más probable que lidie con la probabilidad. </font><font style="vertical-align: inherit;">Si puede capturar toda su infraestructura y procesos de implementación como código, puede probar este código en un entorno de prueba. </font><font style="vertical-align: inherit;">Si tiene éxito, existe una gran posibilidad de que el mismo código funcione en un entorno industrial. </font><font style="vertical-align: inherit;">En un mundo de miedo e incertidumbre, la alta probabilidad y la confianza son caras. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este capítulo, veremos el proceso de probar el código de infraestructura, tanto manual como automático, con énfasis en este último. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pruebas manuales:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conceptos básicos de pruebas manuales;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">limpieza de recursos después de las pruebas.</font></font></li>
</ul><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pruebas automatizadas:</font></font></b><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pruebas unitarias;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pruebas de integración;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pruebas de extremo a extremo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otros enfoques de prueba.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pruebas manuales</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al pensar en cómo probar el código de Terraform, es útil establecer algunos paralelos con el código de prueba escrito en lenguajes de programación de uso general como Ruby. </font><font style="vertical-align: inherit;">Imagina que estás escribiendo un simple servidor web Ruby en el archivo web-server.rb:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este código devolverá una respuesta 200 OK con el cuerpo Hello, World para la URL /; </font><font style="vertical-align: inherit;">para cualquier otra dirección, la respuesta será 404. ¿Cómo probaría este código manualmente? </font><font style="vertical-align: inherit;">Por lo general, se agrega más código para ejecutar el servidor web localmente:</font></font><br>
<br>
<pre><code class="java hljs">#   ,      <font></font>
#  ,       <font></font>
<span class="hljs-keyword">if</span> __FILE__ == $<span class="hljs-number">0</span>
  #      <span class="hljs-number">8000</span>
  server = WEBrick::HTTPServer.new :Port =&gt; <span class="hljs-number">8000</span>
  server.mount <span class="hljs-string">'/'</span>, WebServer<font></font>
<font></font>
  #    Ctrl+C<font></font>
  trap <span class="hljs-string">'INT'</span> <span class="hljs-keyword">do</span> server.shutdown end<font></font>
<font></font>
  #  <font></font>
  server.start<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ejecuta este archivo en la terminal, cargará el servidor web en el puerto 8000:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar el funcionamiento de este servidor, puede usar el navegador o curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/<font></font>
Hello, World<font></font>
<font></font>
$ curl localhost:<span class="hljs-number">8000</span>/invalid-path<font></font>
Not Found</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora imagine que cambiamos este código agregando un punto de entrada / api que devuelve 201 Created y un cuerpo en formato JSON:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebServer</span> &lt; <span class="hljs-title">WEBrick</span>::<span class="hljs-title">HTTPServlet</span>::<span class="hljs-title">AbstractServlet</span>
  <span class="hljs-title">def</span> <span class="hljs-title">do_GET</span>(<span class="hljs-title">request</span>, <span class="hljs-title">response</span>)
     <span class="hljs-title">case</span> <span class="hljs-title">request</span>.<span class="hljs-title">path</span>
     <span class="hljs-title">when</span> "/"
         <span class="hljs-title">response</span>.<span class="hljs-title">status</span> </span>= <span class="hljs-number">200</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Hello, World'</span>
     when <span class="hljs-string">"/api"</span>
         response.status = <span class="hljs-number">201</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>
         response.body = <span class="hljs-string">'{"foo":"bar"}'</span>
     <span class="hljs-keyword">else</span>
         response.status = <span class="hljs-number">404</span>
         response[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'text/plain'</span>
         response.body = <span class="hljs-string">'Not Found'</span><font></font>
     end<font></font>
  end<font></font>
end</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para probar manualmente este código actualizado, presione Ctrl + C y reinicie el servidor web ejecutando el script nuevamente:</font></font><br>
<br>
<pre><code class="java hljs">$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span><font></font>
^C<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO going to shutdown ...<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">15</span>:<span class="hljs-number">54</span>] INFO WEBrick::HTTPServer#start done.<font></font>
<font></font>
$ ruby web-server.rb<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick <span class="hljs-number">1.3</span><span class="hljs-number">.1</span>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO ruby <span class="hljs-number">2.3</span><span class="hljs-number">.7</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">03</span>-<span class="hljs-number">28</span>) [universal.x86_64-darwin17]<font></font>
[<span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">25</span> <span class="hljs-number">14</span>:<span class="hljs-number">11</span>:<span class="hljs-number">52</span>] INFO WEBrick::HTTPServer#start: pid=<span class="hljs-number">19767</span> port=<span class="hljs-number">8000</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar la nueva versión, puede usar nuevamente el comando curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl localhost:<span class="hljs-number">8000</span>/api<font></font>
{<span class="hljs-string">"foo"</span>:<span class="hljs-string">"bar"</span>}</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fundamentos de pruebas manuales</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¿Cómo será este tipo de prueba manual en Terraform? </font><font style="vertical-align: inherit;">Por ejemplo, de los capítulos anteriores, todavía tiene el código para implementar ALB. </font><font style="vertical-align: inherit;">Aquí hay un fragmento del archivo modules / networking / alb / main.tf:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb"</span> <span class="hljs-string">"example"</span> {<font></font>
   name                     = <span class="hljs-keyword">var</span>.alb_name<font></font>
   load_balancer_type = <span class="hljs-string">"application"</span>
   subnets                  = <span class="hljs-keyword">var</span>.subnet_ids<font></font>
   security_groups      = [aws_security_group.alb.id]<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
        content_type = <span class="hljs-string">"text/plain"</span>
        message_body = <span class="hljs-string">"404: page not found"</span>
        status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
    }<font></font>
}<font></font>
<font></font>
resource <span class="hljs-string">"aws_security_group"</span> <span class="hljs-string">"alb"</span> {<font></font>
   name = <span class="hljs-keyword">var</span>.alb_name<font></font>
}<font></font>
<font></font>
# (...)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si compara esta lista con el código Ruby, puede ver una diferencia bastante obvia: AWS ALB, grupos objetivo, escuchas, grupos de seguridad y cualquier otro recurso no se pueden implementar en su propia computadora. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conclusión clave sobre la prueba No. 1 se deduce de esto: la prueba de código Terraform no puede llevarse a cabo localmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto se aplica no solo a Terraform, sino también a la mayoría de las herramientas de IaC. La única forma práctica de hacer pruebas manuales en Terraform es implementar el código en un entorno real (es decir, en AWS). En otras palabras, iniciar independientemente los comandos terraform apply y terraform destroy en los que trabajó mientras leía el libro es una prueba manual en Terraform.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una de las razones por las que es tan importante tener ejemplos fáciles de implementar en la carpeta de ejemplos de cada módulo (consulte el capítulo 6). </font><font style="vertical-align: inherit;">Para probar el módulo alb, la forma más fácil es usar el código de demostración que creó en examples / alb:</font></font><br>
<br>
<pre><code class="java hljs">provider <span class="hljs-string">"aws"</span> {<font></font>
   region = <span class="hljs-string">"us-east-2"</span><font></font>
<font></font>
   #     AWS  <span class="hljs-number">2</span>.x<font></font>
   version = <span class="hljs-string">"~&gt; 2.0"</span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">module</span> <span class="hljs-string">"alb"</span> {<font></font>
    source = <span class="hljs-string">"../../modules/networking/alb"</span><font></font>
<font></font>
    alb_name = <span class="hljs-string">"terraform-up-and-running"</span>
    subnet_ids = data.aws_subnet_ids.<span class="hljs-keyword">default</span>.ids<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para implementar este ejemplo, debe ejecutar el comando terraform apply, como lo ha hecho repetidamente:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al final de la implementación, puede usar una herramienta como curl para, por ejemplo, asegurarse de que ALB devuelva 404 de forma predeterminada:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com<font></font>
<font></font>
<span class="hljs-number">404</span></code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificación de infraestructura</font></font><br>
<br>
      ,   HTTP, ,     ,   curl  HTTP-.        . ,        MySQL,       MySQL.      VPN-,      VPN.      ,      ,       SSH    - .    .   ,    ,      .       ,    .</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permítame recordarle: ALB devuelve 404 debido a la ausencia de otras reglas de escucha en la configuración, y la acción predeterminada en el módulo alb tiene una respuesta de 404:</font></font><br>
<br>
<pre><code class="java hljs">resource <span class="hljs-string">"aws_lb_listener"</span> <span class="hljs-string">"http"</span> {<font></font>
   load_balancer_arn = aws_lb.example.arn<font></font>
   port                      = local.http_port<font></font>
   protocol                = <span class="hljs-string">"HTTP"</span><font></font>
<font></font>
   #      <span class="hljs-number">404</span><font></font>
   default_action {<font></font>
      type = <span class="hljs-string">"fixed-response"</span><font></font>
<font></font>
      fixed_response {<font></font>
       content_type = <span class="hljs-string">"text/plain"</span>
       message_body = <span class="hljs-string">"404: page not found"</span>
       status_code = <span class="hljs-number">404</span><font></font>
      }<font></font>
   }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ya sabes cómo ejecutar y probar tu código. </font><font style="vertical-align: inherit;">Ahora puedes comenzar a hacer cambios. </font><font style="vertical-align: inherit;">Cada vez que cambia algo (de modo que, por ejemplo, la acción predeterminada devuelve 401), debe usar el comando terraform apply para implementar el nuevo código:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">apply</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

Outputs:

alb_dns_name </span>= hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar la nueva versión, puede reiniciar curl:</font></font><br>
<br>
<pre><code class="java hljs">$ curl \<font></font>
   -s \<font></font>
   -o /dev/<span class="hljs-keyword">null</span> \<font></font>
   -w <span class="hljs-string">"%{http_code}"</span> \<font></font>
   hello-world-stage-<span class="hljs-number">477699288</span>.us-east-<span class="hljs-number">2</span>.elb.amazonaws.com
<span class="hljs-number">401</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando termine, ejecute el comando terraform destroy para eliminar los recursos:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">$ terraform <span class="hljs-title">destroy</span>

<span class="hljs-params">(...)</span>

Apply complete! Resources: 0 added, 0 changed, 5 destroyed.</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En otras palabras, cuando se trabaja con Terraform, cada desarrollador necesita buenos ejemplos de código para las pruebas y un entorno de desarrollo real (como una cuenta de AWS), que sirve como el equivalente de una computadora local y se utiliza para ejecutar pruebas. En el proceso de prueba manual, lo más probable es que tenga que crear y eliminar una gran cantidad de componentes de infraestructura, y esto puede provocar muchos errores. A este respecto, el entorno debe estar completamente aislado de los entornos más estables destinados a las pruebas finales y, en particular, para aplicaciones industriales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado lo anterior, recomiendo encarecidamente que cada equipo de desarrollo prepare un entorno aislado en el que pueda crear y eliminar cualquier infraestructura sin consecuencias. </font><font style="vertical-align: inherit;">Para minimizar la probabilidad de conflictos entre diferentes desarrolladores (imagine que dos desarrolladores están tratando de crear un equilibrador de carga con el mismo nombre), la solución ideal sería proporcionar a cada miembro del equipo un entorno separado y completamente aislado. </font><font style="vertical-align: inherit;">Por ejemplo, si usa Terraform junto con AWS, cada desarrollador idealmente debería tener su propia cuenta donde pueda probar todo lo que quiera.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limpieza de recursos después de las pruebas.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La presencia de muchos entornos aislados es necesaria para la alta productividad de los desarrolladores, pero si no tiene precaución, puede acumular muchos recursos adicionales que saturarán todos sus entornos y le costarán una suma redonda. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mantener los costos bajo control, limpie regularmente sus medios aislados. Esta es la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conclusión clave sobre la prueba número 2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mínimo, debe crear tal cultura en el equipo cuando, después de las pruebas, los desarrolladores eliminen todo lo que implementaron usando el comando terraform destroy. Es posible encontrar herramientas para limpiar recursos excedentes o antiguos que se pueden ejecutar de forma regular (por ejemplo, usando cron). Aquí hay algunos ejemplos para diferentes entornos de implementación.</font></font><br>
<br>
<ul>
<li>cloud-nuke (http://bit.ly/2OIgM9r).      ,         .        AWS ( Amazon EC2 Instances, ASG, ELB  . .).      (Google Cloud, Azure)   .    —    ,    . , cloud-nuke      cron,           .   ,   ,      ,      :<br>
<br>
<pre><code class="java hljs">$ cloud-nuke aws --older-than <span class="hljs-number">48</span>h</code></pre></li>
<li>Janitor Monkey (http://bit.ly/2M4GoLB).      ,   AWS  ,    (  —   ).    ,  ,    ,            .    Netflix Simian Army,      Chaos Monkey    .   ,    Simian Army    ,       : ,   Janitor Monkey   Swabbie (http://bit.ly/2OLrOLb).</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aws-nuke (http://bit.ly/2ZB8lOe). </font><font style="vertical-align: inherit;">Esta es una herramienta de código abierto para eliminar todo el contenido de una cuenta de AWS. </font><font style="vertical-align: inherit;">Las cuentas y los recursos que se eliminarán se especifican en el archivo de configuración en el formato YAML:</font></font><br>
<br>
<pre><code class="java hljs">#   <font></font>
regions:<font></font>
- us-east-<span class="hljs-number">2</span><font></font>
<font></font>
#    <font></font>
accounts:<font></font>
   <span class="hljs-string">"111111111111"</span>: {}<font></font>
<font></font>
#    <font></font>
resource-types:<font></font>
   targets:<font></font>
   - S3Object<font></font>
   - S3Bucket<font></font>
   - IAMRole</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aws-nuke comienza de la siguiente manera:</font></font><br>
<br>
<pre><code class="java hljs">$ aws-nuke -<span class="hljs-number">5</span>c config.yml</code></pre></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pruebas automatizadas</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El concepto de prueba automática es que las pruebas se escriben para probar el comportamiento del código real. </font><font style="vertical-align: inherit;">En el Capítulo 8, aprenderá que con el servidor CI, estas pruebas se pueden ejecutar después de cada confirmación individual. </font><font style="vertical-align: inherit;">Si no se completan, la fijación se puede deshacer o corregir de inmediato. </font><font style="vertical-align: inherit;">Por lo tanto, su código siempre estará operativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay tres tipos de pruebas automatizadas.</font></font><br>
<br>
<ul>
<li> .       — .    ,             .   (,  , -    )   mock-.       (, mock-     ,  )    ,        .</li>
<li> .      .          ,          .      mock-: ,     ,     ,      ,   , ,  ,  mock-.</li>
<li> .      (, ,  ,  )       .          : , Selenium        .         - mock-,          (        ,  ).</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada tipo de prueba tiene su propio propósito y, con su ayuda, puede identificar todo tipo de errores, por lo que deben usarse juntos. Las pruebas unitarias son rápidas y le permiten tener una idea inmediata de los cambios realizados y verificar una variedad de combinaciones. Esto le da la confianza de que los componentes elementales de su código (módulos individuales) se comportan como esperaba. Sin embargo, el hecho de que los módulos funcionen correctamente por separado no significa en absoluto que puedan trabajar juntos, por lo tanto, para asegurarse de que sus componentes elementales sean compatibles, se necesitan pruebas de integración. Por otro lado, el comportamiento correcto de las diferentes partes del sistema no garantiza que este sistema funcione como debería después de la implementación en un entorno industrial, por lo que se necesitan pruebas para probar su código en condiciones cercanas a las reales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
»Se puede encontrar más información sobre el libro en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el sitio web del editor</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
» </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extracto de</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Khabrozhiteley 25% de cupón de descuento - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terraform</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Al pagar la versión </font><font style="vertical-align: inherit;">impresa </font><font style="vertical-align: inherit;">del libro, se envía un libro electrónico por correo electrónico.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es503842/index.html">Prótesis cerebral: sincronización de redes neuronales artificiales y biológicas.</a></li>
<li><a href="../es503844/index.html">Acelere el renderizado de MatTable en pocos pasos</a></li>
<li><a href="../es503846/index.html">Flash: "Se desconoce si morirá de nuevo, pero las flores desaparecen ..."</a></li>
<li><a href="../es503848/index.html">Lo invitamos a seminarios web gratuitos sobre impresión SLS en Sinterit 26.05 y escáneres 3D Shining 28.05</a></li>
<li><a href="../es503854/index.html">Usa SIL al máximo</a></li>
<li><a href="../es503860/index.html">Configuración del entorno de red neuronal Máscara R-CNN</a></li>
<li><a href="../fr486176/index.html">Mémo de correspondance par e-mail d'entreprise</a></li>
<li><a href="../fr486178/index.html">FOSS News No. 1 - revue des nouvelles gratuites et open source du 27 janvier au 2 février 2020</a></li>
<li><a href="../fr486180/index.html">Conseils et sources pour créer des applications sans serveur</a></li>
<li><a href="../fr486184/index.html">Comment utiliser efficacement la recherche</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>