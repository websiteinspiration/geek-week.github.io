<!doctype html>
<html class="no-js" lang="pt">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐞 🎅🏽 🛄 Sobre backups no Proxmox VE 🐗 💄 🏭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No artigo “A mágica da virtualização: um curso introdutório no Proxmox VE”, instalamos com êxito um hipervisor no servidor, conectamos o armazenamento...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sobre backups no Proxmox VE</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/486194/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wt/vx/xu/wtvxxuyee73gugficymc7t4x0zm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No artigo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“A mágica da virtualização: um curso introdutório no Proxmox VE”,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instalamos com êxito um hipervisor no servidor, conectamos o armazenamento a ele, cuidamos da segurança básica e até criamos a primeira máquina virtual. Agora, veremos como implementar as tarefas mais básicas que você deve executar para poder sempre restaurar os serviços em caso de falha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As ferramentas Proxmox estabelecidas permitem não apenas fazer backup de dados, mas também criar conjuntos de imagens pré-configuradas de sistemas operacionais para implantação rápida. Isso não apenas ajuda, se necessário, a criar um novo servidor para qualquer serviço em alguns segundos, mas também reduz o tempo de inatividade a um mínimo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não falaremos sobre a necessidade de criar backups, pois isso é óbvio e tem sido um axioma há muito tempo. </font><font style="vertical-align: inherit;">Vamos nos debruçar sobre algumas coisas e características não óbvias.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro, considere como os dados são salvos durante o procedimento de backup.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmos de backup</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar, o Proxmox possui um bom kit de ferramentas de equipe para criar backups de máquinas virtuais. </font><font style="vertical-align: inherit;">Ele permite salvar facilmente todos os dados da máquina virtual e suporta dois mecanismos de compactação, além de três métodos para criar essas cópias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos primeiro examinar os mecanismos de compactação:</font></font><br>
<br>
<ol>
<li><b> LZO</b>.     ,     90- .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> (  Proxmox  lzop).        . ,   ,     ,        .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compactando o GZIP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Usando esse algoritmo, o backup será compactado em tempo real com o utilitário GNU Zip, que usa o poderoso algoritmo Deflate criado por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Phil Katz</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A ênfase principal está na compressão máxima de dados, o que reduz o espaço em disco ocupado pelos backups. </font><font style="vertical-align: inherit;">A principal diferença do LZO é que os procedimentos de compactação / descompactação levam um tempo bastante grande.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modos de arquivamento</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Proxmox oferece três métodos de backup para o administrador do sistema escolher. </font><font style="vertical-align: inherit;">Usando-os, você pode resolver o problema necessário, determinando a prioridade entre a necessidade de tempo de inatividade e a confiabilidade do backup:</font></font><br>
<br>
<ol>
<li><b> Snapshot ()</b>.       Live backup,          .       VM,       —    -         .  ,   ,      .     ,     ,    .</li>
<li><b> Suspend ()</b>.    «»  ,     .     ,        ,     . ,        ,    /  ,      . ,       .              .</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modo de parada</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O método de backup mais confiável, mas exigindo um desligamento completo da máquina virtual. </font><font style="vertical-align: inherit;">Um comando é enviado para o desligamento normalmente, após a parada, um backup é executado e, em seguida, um comando é emitido para ativar a máquina virtual. </font><font style="vertical-align: inherit;">O número de erros com essa abordagem é mínimo e, na maioria das vezes, reduzido a zero. </font><font style="vertical-align: inherit;">Os backups criados dessa maneira quase sempre são implantados corretamente.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Executar procedimento de backup</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para fazer backup:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passamos para a máquina virtual necessária.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecione o item </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reserva</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clique no botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reservar agora</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Uma janela será aberta na qual você poderá selecionar as opções para o futuro backup.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/et/gn/fu/etgnfuz7yjw9dohf4ktcvphtxry.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como armazenamento, indicamos o que conectamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na parte anterior</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Após selecionar os parâmetros, clique no botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Backup</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e aguarde até que o backup seja criado. </font><font style="vertical-align: inherit;">Isso será indicado pela inscrição </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TASK OK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/u-/8i/pc/u-8ipc1amu1z51u4ibgh9tjxs-o.png"></div><br>
</li>
</ol><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, os arquivos criados com backups de máquinas virtuais estarão disponíveis para download no servidor. </font><font style="vertical-align: inherit;">A maneira mais simples e comum de copiar é o SFTP. </font><font style="vertical-align: inherit;">Para fazer isso, use o popular cliente FTP de plataforma cruzada FileZilla, que pode funcionar usando o protocolo SFTP.</font></font><br>
<br>
<ol>
<li>  <b></b>  IP-   ,   <b> </b>  root,   <b></b> — ,     ,    <b></b>  «22» (   ,     SSH-).</li>
<li>  <b> </b> ,      ,        ,   .</li>
<li>   <b>/mnt/storage</b>.         «dump».    :<ul>
<li><b>vzdump-qemu-_--.vma.gz</b>     GZIP;</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vzdump-qemu-machine_number-date-time.vma.lzo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se o método LZO estiver selecionado.</font></font></li>
</ul></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
É recomendável baixar os backups imediatamente do servidor e salvá-los em um local seguro, por exemplo, em nosso armazenamento na nuvem. </font><font style="vertical-align: inherit;">Se você descompactar um arquivo com resolução vma, o utilitário com o mesmo nome que acompanha o Proxmox, os arquivos com as extensões </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estarão dentro </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esses arquivos contêm o seguinte:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagem de disco </font><b><font style="vertical-align: inherit;">bruto</font></b><font style="vertical-align: inherit;"> ;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conf</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - configuração de VM;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fw</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - configurações de firewall.</font></font></li>
</ul><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restaurar do backup</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considere a situação em que a máquina virtual foi excluída acidentalmente e sua recuperação de emergência a partir do backup é necessária:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o armazenamento no qual está o backup.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vá para a guia </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conteúdo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecione a cópia desejada e clique no botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restaurar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/bg/ou/ts/bgoutsyb4clkt_qx4xy88avgtqq.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especificamos o armazenamento de destino e o ID que será atribuído à máquina após a conclusão do processo.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clique no botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restaurar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando a recuperação estiver concluída, a VM aparecerá na lista de disponíveis.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clonagem de máquina virtual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, suponha que uma empresa precise fazer alterações em um serviço crítico. </font><font style="vertical-align: inherit;">Essa mudança é implementada fazendo muitas alterações nos arquivos de configuração. </font><font style="vertical-align: inherit;">O resultado é imprevisível e qualquer erro pode causar uma falha no serviço. </font><font style="vertical-align: inherit;">Para impedir que essa experiência afete um servidor em execução, é recomendável clonar a máquina virtual.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O mecanismo de clonagem criará uma cópia exata do servidor virtual com o qual é permitido fazer alterações sem afetar a operação do serviço principal. Em seguida, se as alterações forem aplicadas com êxito, a nova VM será iniciada e a antiga será encerrada. Há um recurso nesse processo que sempre deve ser lembrado. Na máquina clonada, o endereço IP será exatamente o mesmo que a VM de origem, ou seja, quando for iniciada, haverá um conflito de endereço.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nós lhe diremos como evitar tal situação. Imediatamente antes de executar a clonagem, você deve fazer alterações na configuração da rede. Para fazer isso, você precisa alterar temporariamente o endereço IP, mas não reinicie o serviço de rede. Após a clonagem na máquina principal, você deve retornar as configurações e, na máquina clonada, especificar qualquer outro endereço IP. Assim, obtemos duas cópias do mesmo servidor em endereços diferentes. Isso introduzirá rapidamente um novo serviço. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se esse serviço for um servidor da Web, basta alterar o registro A do seu provedor de DNS, após o qual as solicitações do cliente para esse nome de domínio já serão enviadas para o endereço da máquina virtual clonada.</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A propósito, a Selectel fornece a todos os seus clientes o serviço de colocar qualquer número de domínios nos servidores NS gratuitamente. </font><font style="vertical-align: inherit;">O gerenciamento de registros é realizado usando nosso painel de controle e usando uma API especial. </font><font style="vertical-align: inherit;">Leia mais sobre isso </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em nossa base de conhecimento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A clonagem de uma VM no Proxmox é uma tarefa muito simples. </font><font style="vertical-align: inherit;">Para executá-lo, você deve executar as seguintes etapas:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vá para o carro que precisamos.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escolha no menu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> clique </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no Clone</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na janela que se abre, preencha o parâmetro Name.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/3n/on/wn/3nonwng-06gxpllialr7u_9ck2m.png"></div></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clone pressionando o botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clone</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa ferramenta permite fazer uma cópia de uma máquina virtual, não apenas no servidor local. </font><font style="vertical-align: inherit;">Se vários servidores de virtualização forem combinados em um cluster, usando esta ferramenta, você poderá mover imediatamente a cópia criada para o servidor físico desejado. </font><font style="vertical-align: inherit;">Uma função útil é a escolha do armazenamento em disco (parâmetro </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Target Storage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), que é muito conveniente ao mover uma máquina virtual de um meio físico para outro.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formatos de unidade virtual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falaremos mais sobre os formatos de unidade usados ​​no Proxmox:</font></font><br>
<br>
<ol>
<li><b>RAW</b>.     .       «  »    .    ,       mount   linux-.      «» ,        .<br>
<br>
     ,        ,             RAW (        ).</li>
<li><b>QEMU image format (qcow2)</b>. ,       .    ,             . ,    40  ,      2 ,         VM.        .<br>
<br>
       :        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  nbd</a>,     <b>qemu-nbd</b>,            .       ,   ,       .<br>
<br>
 ,    -      ,           .        ,     RAW.</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formato de imagem VMware (vmdk)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esse formato é nativo do hypervisor VMware vSphere e foi incluído no Proxmox para compatibilidade. </font><font style="vertical-align: inherit;">Ele permite migrar uma máquina virtual VMware para a infraestrutura Proxmox. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O uso do vmdk continuamente não é recomendado; esse formato é o mais lento no Proxmox; portanto, é adequado apenas para migração, não mais. </font><font style="vertical-align: inherit;">Provavelmente, no futuro próximo, essa lacuna será eliminada.</font></font></li>
</ol><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabalhar com imagens de disco</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incluído no Proxmox, há um utilitário muito conveniente chamado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qemu-img</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Uma de suas funções é converter imagens de discos virtuais. </font><font style="vertical-align: inherit;">Para usá-lo, basta abrir o console do hypervisor e execute o comando no formato:</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img convert -f vmdk test.vmdk -O qcow2 test.qcow2</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No exemplo acima, a imagem vmdk da unidade virtual VMware chamada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teste</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> será convertida para o formato </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qcow2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este é um comando muito útil quando você precisa corrigir um erro na seleção inicial do formato. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Graças ao mesmo comando, você pode forçar a imagem desejada usando o argumento de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">criação</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img create -f raw test.raw 40G</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse comando criará uma imagem de teste no formato </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAW</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , com 40 GB de tamanho. </font><font style="vertical-align: inherit;">Agora é adequado para conectar-se a qualquer uma das máquinas virtuais.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redimensionar um disco virtual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em conclusão, mostraremos como aumentar o tamanho de uma imagem de disco se, por algum motivo, o espaço nela não for mais suficiente. </font><font style="vertical-align: inherit;">Para fazer isso, use o argumento resize:</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img resize -f raw test.raw 80G</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora nossa imagem se tornou do tamanho de 80 GB. </font><font style="vertical-align: inherit;">Você pode visualizar informações detalhadas sobre a imagem usando o argumento </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="plaintext hljs">qemu-img info test.raw</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não esqueça que a extensão da imagem em si não aumentará o tamanho da partição automaticamente - simplesmente adicionará o espaço livre disponível. </font><font style="vertical-align: inherit;">Para ampliar a seção, use o comando:</font></font><br>
<br>
<pre><code class="plaintext hljs">resize2fs /dev/sda1</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
onde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ dev / sda1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é a partição desejada.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Automatize backups</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Usar o método manual de criação de backups é uma tarefa muito demorada e demorada. </font><font style="vertical-align: inherit;">Portanto, o Proxmox VE inclui uma ferramenta para backups agendados automáticos. </font><font style="vertical-align: inherit;">Considere como fazer isso:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando a interface da web do hypervisor, abra o item </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datacenter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecione o item </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reserva</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clique no botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definimos os parâmetros para o planejador.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/5d/a0/tu/5da0tunglle5mwsvudggbwjyuhc.png"></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marque a caixa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ativar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salve as alterações usando o botão </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, o planejador iniciará automaticamente o programa de backup no horário exato especificado, com base no planejamento especificado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusão</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consideramos métodos regulares de backup e recuperação de máquinas virtuais. Seu uso permite salvar todos os dados sem problemas e restaurá-los com urgência em caso de emergência. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, essa não é a única maneira possível de salvar dados importantes. Existem muitas ferramentas, por exemplo, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Duplicity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , com as quais você pode criar cópias completas e incrementais do conteúdo de servidores virtuais baseados no Linux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao executar procedimentos de backup, você sempre deve considerar que eles estão carregando ativamente o subsistema de disco. </font><font style="vertical-align: inherit;">Nesse sentido, é recomendável executar esses procedimentos em momentos de carga mínima, a fim de evitar atrasos na execução de operações de E / S dentro das máquinas. </font><font style="vertical-align: inherit;">Você pode monitorar o status dos atrasos na operação do disco diretamente da interface da web do hypervisor (parâmetro de atraso de E / S).</font></font></div>
      
    </div><p class="reference-to-source js-reference-to-source">Source: https://habr.com/ru/post/undefined/</p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486184/index.html">Como usar a pesquisa efetivamente</a></li>
<li><a href="../pt486186/index.html">Nuvem catastrófica: como funciona</a></li>
<li><a href="../pt486188/index.html">Apresentando o sistema de backup PostgreSQL wal-g</a></li>
<li><a href="../pt486190/index.html">Nossa experiência no desenvolvimento de um driver CSI em Kubernetes para Yandex.Cloud</a></li>
<li><a href="../pt486192/index.html">Ciber fraudadores hackear operadoras de telefonia móvel para obter números de telefone de assinantes</a></li>
<li><a href="../pt486198/index.html">Falar é difícil. Ensaios sobre Comunicação com Não Programadores</a></li>
<li><a href="../pt486200/index.html">Dicas do Docker: limpe sua máquina contra o lixo</a></li>
<li><a href="../pt486202/index.html">Alpine coleta Docker constrói sob Python 50 vezes mais devagar e imagens 2 vezes mais pesadas</a></li>
<li><a href="../pt486204/index.html">Profissão: Administrador do Sistema</a></li>
<li><a href="../pt486206/index.html">Que tipos de fraude eu encontrei no freelancer e na terceirização</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>