<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèø üôáüèæ üëäüèº Su primera red neuronal en una unidad de procesamiento de gr√°ficos (GPU). Gu√≠a para principiantes üë©üèΩ‚Äçü§ù‚Äçüë®üèº üåà ‚öôÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, le dir√© c√≥mo configurar un entorno de aprendizaje autom√°tico en 30 minutos, crear una red neuronal para el reconocimiento de im√°gene...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Su primera red neuronal en una unidad de procesamiento de gr√°ficos (GPU). Gu√≠a para principiantes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/488564/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/sv/g2/wgsvg24lytktztdczee_4rteb28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este art√≠culo, le dir√© c√≥mo configurar un entorno de aprendizaje autom√°tico en 30 minutos, crear una red neuronal para el reconocimiento de im√°genes y luego ejecutar la misma red en una unidad de procesamiento de gr√°ficos (GPU). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, definamos qu√© es una red neuronal. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro caso, este es un modelo matem√°tico, as√≠ como su implementaci√≥n de software o hardware, construido sobre el principio de organizaci√≥n y funcionamiento de redes neuronales biol√≥gicas: redes de c√©lulas nerviosas de un organismo vivo. Este concepto surgi√≥ en el estudio de los procesos que ocurren en el cerebro y en un intento de simular estos procesos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las redes neuronales no est√°n programadas en el sentido habitual de la palabra, est√°n entrenadas. </font><font style="vertical-align: inherit;">La capacidad de aprendizaje es una de las principales ventajas de las redes neuronales sobre los algoritmos tradicionales. </font><font style="vertical-align: inherit;">T√©cnicamente, el entrenamiento consiste en encontrar los coeficientes de conexi√≥n entre las neuronas. </font><font style="vertical-align: inherit;">En el proceso de aprendizaje, la red neuronal puede identificar relaciones complejas entre entrada y salida, as√≠ como realizar generalizaciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el punto de vista del aprendizaje autom√°tico, una red neuronal es un caso especial de m√©todos de reconocimiento de patrones, an√°lisis discriminante, m√©todos de agrupamiento y otros m√©todos.</font></font><br>
 <br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, tratemos con el equipo. Necesitamos un servidor con el sistema operativo Linux instalado. El equipo para el funcionamiento de los sistemas de aprendizaje autom√°tico requiere un sistema suficientemente potente y, como consecuencia, costoso. Para aquellos que no tienen un buen autom√≥vil a mano, les recomiendo prestar atenci√≥n a la oferta de los proveedores de la nube. El servidor necesario se puede alquilar r√°pidamente y pagar solo por el tiempo de uso.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En proyectos en los que es necesario crear redes neuronales, utilizo los servidores de uno de los proveedores de la nube rusa. </font><font style="vertical-align: inherit;">La compa√±√≠a ofrece servidores en la nube de alquiler espec√≠ficamente para el aprendizaje autom√°tico con potentes unidades de procesamiento de gr√°ficos (GPU) Tesla V100 de NVIDIA. </font><font style="vertical-align: inherit;">En resumen: usar un servidor con una GPU puede ser docenas de veces m√°s eficiente (r√°pido) en comparaci√≥n con un servidor que es similar en costo y usa una CPU (un procesador central conocido) para los c√°lculos. </font><font style="vertical-align: inherit;">Esto se logra debido a los detalles de la arquitectura GPU, que maneja los c√°lculos m√°s r√°pido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para realizar los ejemplos que se describen a continuaci√≥n, compramos el siguiente servidor durante varios d√≠as:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSD de 150 GB</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM 32 GB</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Procesador Tesla V100 de 16 Gb con 4 n√∫cleos</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubuntu 18.04 fue instalado en la m√°quina.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Establecer el entorno</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora instale en el servidor todo lo que necesita para trabajar. </font><font style="vertical-align: inherit;">Dado que nuestro art√≠culo es principalmente para principiantes, hablar√© sobre algunos puntos que les ser√°n √∫tiles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mucho trabajo al configurar el entorno se realiza a trav√©s de la l√≠nea de comando. </font><font style="vertical-align: inherit;">La mayor√≠a de los usuarios usan Windows como un SO operativo. </font><font style="vertical-align: inherit;">La consola est√°ndar en este sistema operativo deja mucho que desear. </font><font style="vertical-align: inherit;">Por lo tanto, utilizaremos la herramienta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Cmder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conveniente </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Descargue la versi√≥n mini y ejecute Cmder.exe. </font><font style="vertical-align: inherit;">A continuaci√≥n, debe conectarse al servidor a trav√©s de SSH:</font></font><br>
<br>
<pre><code class="bash hljs">ssh root@server-ip-or-hostname</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En lugar de server-ip-or-hostname, especifique la direcci√≥n IP o el nombre DNS de su servidor. </font><font style="vertical-align: inherit;">Luego, ingrese la contrase√±a y luego de una conexi√≥n exitosa, deber√≠amos obtener algo como esto.</font></font><br>
<br>
<pre><code class="bash hljs">Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-74-generic x86_64)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El lenguaje principal para desarrollar modelos ML es Python. </font><font style="vertical-align: inherit;">Y la plataforma m√°s popular para usarlo en Linux es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anaconda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inst√°lalo en nuestro servidor. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos actualizando el administrador de paquetes local:</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get update</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instale curl (utilidad de l√≠nea de comando):</font></font><br>
<br>
<pre><code class="bash hljs">sudo apt-get install curl</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descargue la √∫ltima versi√≥n de Anaconda Distribution:</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">cd</span> /tmp<font></font>
curl ‚ÄìO https://repo.anaconda.com/archive/Anaconda3-2019.10-Linux-x86_64.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos la instalaci√≥n:</font></font><br>
<br>
<pre><code class="bash hljs">bash Anaconda3-2019.10-Linux-x86_64.sh</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante el proceso de instalaci√≥n, deber√° confirmar el acuerdo de licencia. </font><font style="vertical-align: inherit;">En una instalaci√≥n exitosa, deber√≠a ver esto:</font></font><br>
<br>
<pre><code class="bash hljs">Thank you <span class="hljs-keyword">for</span> installing Anaconda3!</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para desarrollar modelos de ML, ahora se crean muchos marcos, trabajamos con los m√°s populares: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyTorch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tensorflow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El uso del marco le permite aumentar la velocidad de desarrollo y utilizar herramientas preparadas para tareas est√°ndar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En este ejemplo, trabajaremos con PyTorch. </font><font style="vertical-align: inherit;">Instalarlo:</font></font><br>
<br>
<pre><code class="bash hljs">conda install pytorch torchvision cudatoolkit=10.1 -c pytorch</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora tenemos que lanzar Jupyter Notebook, una herramienta de desarrollo popular entre los especialistas de ML. </font><font style="vertical-align: inherit;">Le permite escribir c√≥digo e inmediatamente ver los resultados de su ejecuci√≥n. </font><font style="vertical-align: inherit;">Jupyter Notebook es parte de Anaconda y ya est√° instalado en nuestro servidor. </font><font style="vertical-align: inherit;">Necesita conectarse desde nuestro sistema de escritorio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, primero ejecutamos Jupyter en el servidor especificando el puerto 8080:</font></font><br>
<br>
<pre><code class="bash hljs">jupyter notebook --no-browser --port=8080 --allow-root</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego, abriendo otra pesta√±a en nuestra consola Cmder (el men√∫ superior es el cuadro de di√°logo Nueva consola), con√©ctese en el puerto 8080 al servidor a trav√©s de SSH:</font></font><br>
<br>
<pre><code class="plaintext hljs">ssh -L 8080:localhost:8080 root@server-ip-or-hostname</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando ingrese el primer comando, se nos ofrecer√°n enlaces para abrir Jupyter en nuestro navegador:</font></font><br>
<br>
<pre><code class="bash hljs">To access the notebook, open this file <span class="hljs-keyword">in</span> a browser:<font></font>
        file:///root/.<span class="hljs-built_in">local</span>/share/jupyter/runtime/nbserver-18788-open.html<font></font>
    Or copy and paste one of these URLs:<font></font>
        http://localhost:8080/?token=cca0bd0b30857821194b9018a5394a4ed2322236f116d311<font></font>
     or http://127.0.0.1:8080/?token=cca0bd0b30857821194b9018a5394a4ed2322236f116d311<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Use el enlace para localhost: 8080. </font><font style="vertical-align: inherit;">Copie la ruta completa y p√©guela en la barra de direcciones del navegador local de su PC. </font><font style="vertical-align: inherit;">Se abre el cuaderno Jupyter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creemos una nueva computadora port√°til: Nueva - Computadora port√°til - Python 3. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verifique el funcionamiento correcto de todos los componentes que instalamos. </font><font style="vertical-align: inherit;">Introducimos un ejemplo de c√≥digo PyTorch en Jupyter y comenzamos la ejecuci√≥n (bot√≥n Ejecutar):</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">import</span> torch<font></font>
x = torch.rand(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<font></font>
print(x)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El resultado deber√≠a ser algo como esto: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ps/o8/su/pso8sugii4txi_beqrbx13nsry8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
si tiene un resultado similar, ¬°entonces todos estamos configurados correctamente y podemos comenzar a desarrollar una red neuronal!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crea una red neuronal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Crearemos una red neuronal para el reconocimiento de im√°genes. </font><font style="vertical-align: inherit;">Tomamos esta </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gu√≠a como</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> base </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para capacitar a la red, utilizaremos el conjunto de datos CIFAR10 disponible al p√∫blico. </font><font style="vertical-align: inherit;">Tiene clases: "avi√≥n", "auto", "p√°jaro", "gato", "venado", "perro", "rana", "caballo", "barco", "cami√≥n". </font><font style="vertical-align: inherit;">Las im√°genes en CIFAR10 tienen un tama√±o de 3x32x32, es decir, im√°genes en color de 3 canales de 32x32 p√≠xeles.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/wg/sv/g2/wgsvg24lytktztdczee_4rteb28.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para el trabajo, utilizaremos el paquete PyTorch creado para trabajar con im√°genes: torchvision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tomaremos los siguientes pasos en orden:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargue y normalice los conjuntos de datos de entrenamiento y prueba</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definici√≥n de red neuronal</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red de formaci√≥n sobre datos de formaci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probar la red con datos de prueba</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repita el entrenamiento y las pruebas de GPU</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el c√≥digo a continuaci√≥n lo ejecutaremos en el Jupyter Notebook.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descargar y normalizar CIFAR10</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Copie y ejecute el siguiente c√≥digo en Jupyter:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torchvision
<span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<font></font>
<font></font>
transform = transforms.Compose(<font></font>
    [transforms.ToTensor(),<font></font>
     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<font></font>
<font></font>
trainset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">'./data'</span>, train=<span class="hljs-literal">True</span>,<font></font>
                                        download=<span class="hljs-literal">True</span>, transform=transform)<font></font>
trainloader = torch.utils.data.DataLoader(trainset, batch_size=<span class="hljs-number">4</span>,<font></font>
                                          shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)<font></font>
<font></font>
testset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">'./data'</span>, train=<span class="hljs-literal">False</span>,<font></font>
                                       download=<span class="hljs-literal">True</span>, transform=transform)<font></font>
testloader = torch.utils.data.DataLoader(testset, batch_size=<span class="hljs-number">4</span>,<font></font>
                                         shuffle=<span class="hljs-literal">False</span>, num_workers=<span class="hljs-number">2</span>)<font></font>
<font></font>
classes = (<span class="hljs-string">'plane'</span>, <span class="hljs-string">'car'</span>, <span class="hljs-string">'bird'</span>, <span class="hljs-string">'cat'</span>,
           <span class="hljs-string">'deer'</span>, <span class="hljs-string">'dog'</span>, <span class="hljs-string">'frog'</span>, <span class="hljs-string">'horse'</span>, <span class="hljs-string">'ship'</span>, <span class="hljs-string">'truck'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La respuesta deber√≠a ser as√≠:</font></font><br>
<br>
<pre><code class="python hljs">Downloading https://www.cs.toronto.edu/~kriz/cifar<span class="hljs-number">-10</span>-python.tar.gz to ./data/cifar<span class="hljs-number">-10</span>-python.tar.gz<font></font>
Extracting ./data/cifar<span class="hljs-number">-10</span>-python.tar.gz to ./data<font></font>
Files already downloaded <span class="hljs-keyword">and</span> verified</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Derivaremos varias im√°genes de entrenamiento para verificar:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<font></font>
<font></font>
<span class="hljs-comment"># functions to show an image</span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">imshow</span>(<span class="hljs-params">img</span>):</span>
    img = img / <span class="hljs-number">2</span> + <span class="hljs-number">0.5</span>     <span class="hljs-comment"># unnormalize</span><font></font>
    npimg = img.numpy()<font></font>
    plt.imshow(np.transpose(npimg, (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)))<font></font>
    plt.show()<font></font>
<font></font>
<span class="hljs-comment"># get some random training images</span><font></font>
dataiter = iter(trainloader)<font></font>
images, labels = dataiter.next()<font></font>
<font></font>
<span class="hljs-comment"># show images</span><font></font>
imshow(torchvision.utils.make_grid(images))<font></font>
<span class="hljs-comment"># print labels</span>
print(<span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))
</code></pre><br>
<img src="https://habrastorage.org/webt/yy/w4/xw/yyw4xwjhaa6kfy41fvnylvz6qdy.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definici√≥n de red neuronal</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinemos primero c√≥mo funciona una red neuronal para el reconocimiento de im√°genes. </font><font style="vertical-align: inherit;">Esta es una red de conexi√≥n directa simple. </font><font style="vertical-align: inherit;">Toma entrada, la pasa a trav√©s de varias capas una por una, y finalmente da la salida. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/t8/4m/yg/t84mygi1sjuzssoezguistupmeo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Creemos una red similar en nuestro entorno:</font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span>(<span class="hljs-params">nn.Module</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><font></font>
        super(Net, self).__init__()<font></font>
        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>)<font></font>
        self.pool = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<font></font>
        self.conv2 = nn.Conv2d(<span class="hljs-number">6</span>, <span class="hljs-number">16</span>, <span class="hljs-number">5</span>)<font></font>
        self.fc1 = nn.Linear(<span class="hljs-number">16</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>, <span class="hljs-number">120</span>)<font></font>
        self.fc2 = nn.Linear(<span class="hljs-number">120</span>, <span class="hljs-number">84</span>)<font></font>
        self.fc3 = nn.Linear(<span class="hljs-number">84</span>, <span class="hljs-number">10</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span><font></font>
        x = self.pool(F.relu(self.conv1(x)))<font></font>
        x = self.pool(F.relu(self.conv2(x)))<font></font>
        x = x.view(<span class="hljs-number">-1</span>, <span class="hljs-number">16</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>)<font></font>
        x = F.relu(self.fc1(x))<font></font>
        x = F.relu(self.fc2(x))<font></font>
        x = self.fc3(x)<font></font>
        <span class="hljs-keyword">return</span> x<font></font>
<font></font>
net = Net()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n definimos la funci√≥n de p√©rdida y el optimizador. </font></font><br>
<br>
<pre><code class="python hljs">
<span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<font></font>
<font></font>
criterion = nn.CrossEntropyLoss()<font></font>
optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red de formaci√≥n sobre datos de formaci√≥n.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comenzamos a entrenar nuestra red neuronal. </font><font style="vertical-align: inherit;">Le llamo la atenci√≥n sobre el hecho de que despu√©s de esto, mientras ejecuta este c√≥digo, tendr√° que esperar un tiempo hasta que se complete el trabajo. </font><font style="vertical-align: inherit;">Me llev√≥ 5 minutos. </font><font style="vertical-align: inherit;">La creaci√≥n de redes lleva tiempo.</font></font><br>
<br>
<pre><code class="python hljs"> <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># loop over the dataset multiple times</span><font></font>
<font></font>
    running_loss = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> enumerate(trainloader, <span class="hljs-number">0</span>):
        <span class="hljs-comment"># get the inputs; data is a list of [inputs, labels]</span><font></font>
        inputs, labels = data<font></font>
<font></font>
        <span class="hljs-comment"># zero the parameter gradients</span><font></font>
        optimizer.zero_grad()<font></font>
<font></font>
        <span class="hljs-comment"># forward + backward + optimize</span><font></font>
        outputs = net(inputs)<font></font>
        loss = criterion(outputs, labels)<font></font>
        loss.backward()<font></font>
        optimizer.step()<font></font>
<font></font>
        <span class="hljs-comment"># print statistics</span><font></font>
        running_loss += loss.item()<font></font>
        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2000</span> == <span class="hljs-number">1999</span>:    <span class="hljs-comment"># print every 2000 mini-batches</span>
            print(<span class="hljs-string">'[%d, %5d] loss: %.3f'</span> %<font></font>
                  (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<font></font>
            running_loss = <span class="hljs-number">0.0</span><font></font>
<font></font>
print(<span class="hljs-string">'Finished Training'</span>)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obtenemos el siguiente resultado: Guardamos </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sw/05/k2/sw05k2ewk-gu9fiyrv3xncxjaki.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nuestro modelo entrenado:</font></font><br>
<br>
<pre><code class="python hljs">PATH = <span class="hljs-string">'./cifar_net.pth'</span>
torch.save(net.state_dict(), PATH)</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probar la red con datos de prueba</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capacitamos a la red utilizando un conjunto de datos de capacitaci√≥n. </font><font style="vertical-align: inherit;">Pero debemos verificar si la red ha aprendido algo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Verificaremos esto prediciendo la etiqueta de clase que produce la red neuronal y verificando la verdad. </font><font style="vertical-align: inherit;">Si el pron√≥stico es correcto, agregamos la muestra a la lista de pron√≥sticos correctos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos a mostrar la imagen del conjunto de pruebas:</font></font><br>
<br>
<pre><code class="python hljs">dataiter = iter(testloader)<font></font>
images, labels = dataiter.next()<font></font>
<font></font>
<span class="hljs-comment"># print images</span><font></font>
imshow(torchvision.utils.make_grid(images))<font></font>
print(<span class="hljs-string">'GroundTruth: '</span>, <span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))</code></pre><br>
<img src="https://habrastorage.org/webt/hp/ph/zm/hpphzma6rus04gw-edxsowf1ifu.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora pida a la red neuronal que nos diga qu√© hay en estas im√°genes:</font></font><br>
<br>
<pre><code class="python hljs"><font></font>
net = Net()<font></font>
net.load_state_dict(torch.load(PATH))<font></font>
<font></font>
outputs = net(images)<font></font>
<font></font>
_, predicted = torch.max(outputs, <span class="hljs-number">1</span>)<font></font>
<font></font>
print(<span class="hljs-string">'Predicted: '</span>, <span class="hljs-string">' '</span>.join(<span class="hljs-string">'%5s'</span> % classes[predicted[j]]
                              <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>)))
</code></pre><br>
<img src="https://habrastorage.org/webt/j2/vp/uc/j2vpucdaps0fuci2yg38ip2fbdo.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los resultados parecen bastante buenos: la red identific√≥ correctamente tres de las cuatro im√°genes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos c√≥mo funciona la red en todo el conjunto de datos.</font></font><br>
<br>
<pre><code class="python hljs">
correct = <span class="hljs-number">0</span>
total = <span class="hljs-number">0</span>
<span class="hljs-keyword">with</span> torch.no_grad():
    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<font></font>
        images, labels = data<font></font>
        outputs = net(images)<font></font>
        _, predicted = torch.max(outputs.data, <span class="hljs-number">1</span>)<font></font>
        total += labels.size(<span class="hljs-number">0</span>)<font></font>
        correct += (predicted == labels).sum().item()<font></font>
<font></font>
print(<span class="hljs-string">'Accuracy of the network on the 10000 test images: %d %%'</span> % (
    <span class="hljs-number">100</span> * correct / total))</code></pre><br>
<img src="https://habrastorage.org/webt/fy/i4/cn/fyi4cnkjgimshkhhbsva4udixhw.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que la red lo sabe y funciona. </font><font style="vertical-align: inherit;">Si defini√≥ las clases al azar, la precisi√≥n ser√≠a del 10%. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos qu√© clases define mejor la red:</font></font><br>
<br>
<pre><code class="python hljs">class_correct = list(<span class="hljs-number">0.</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>))<font></font>
class_total = list(<span class="hljs-number">0.</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>))
<span class="hljs-keyword">with</span> torch.no_grad():
    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<font></font>
        images, labels = data<font></font>
        outputs = net(images)<font></font>
        _, predicted = torch.max(outputs, <span class="hljs-number">1</span>)<font></font>
        c = (predicted == labels).squeeze()<font></font>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">4</span>):<font></font>
            label = labels[i]<font></font>
            class_correct[label] += c[i].item()<font></font>
            class_total[label] += <span class="hljs-number">1</span><font></font>
<font></font>
<font></font>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">10</span>):<font></font>
    print(<span class="hljs-string">'Accuracy of %5s : %2d %%'</span> % (<font></font>
        classes[i], <span class="hljs-number">100</span> * class_correct[i] / class_total[i]))</code></pre><br>
<img src="https://habrastorage.org/webt/l9/s9/qu/l9s9quxd-lzx2kh7wphxe9-2qzs.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que la red determina mejor los autos y las naves: 71% de precisi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces la red est√° funcionando. </font><font style="vertical-align: inherit;">Ahora intentemos transferir su trabajo al procesador gr√°fico (GPU) y ver qu√© cambios.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entrenamiento de red neuronal GPU</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, explicar√© brevemente qu√© es CUDA. </font><font style="vertical-align: inherit;">CUDA (Compute Unified Device Architecture) es una plataforma de computaci√≥n paralela desarrollada por NVIDIA para computaci√≥n general en GPU. </font><font style="vertical-align: inherit;">Con CUDA, los desarrolladores pueden acelerar significativamente las aplicaciones inform√°ticas utilizando las capacidades de las GPU. </font><font style="vertical-align: inherit;">En nuestro servidor que compramos, esta plataforma ya est√° instalada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero definamos nuestra GPU como el primer dispositivo cuda visible.</font></font><br>
<br>
<pre><code class="python hljs">device = torch . device ( <span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> torch . cuda . is_available () <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span> )
<span class="hljs-comment"># Assuming that we are on a CUDA machine, this should print a CUDA device:</span>
<span class="hljs-keyword">print</span> ( device )</code></pre><br>
<img src="https://habrastorage.org/webt/n2/2k/bf/n22kbfvilr6kn30eel6dfhaose4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enviar la red a la GPU:</font></font><br>
 <br>
<pre><code class="python hljs">net.to(device)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n tendremos que enviar aportes y objetivos en cada paso y a la GPU:</font></font><br>
<br>
<pre><code class="python hljs">inputs, labels = data[<span class="hljs-number">0</span>].to(device), data[<span class="hljs-number">1</span>].to(device)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejecute el reciclaje de red que ya est√° en la GPU: </font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim<font></font>
<font></font>
criterion = nn.CrossEntropyLoss()<font></font>
optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)
<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(<span class="hljs-number">2</span>):  <span class="hljs-comment"># loop over the dataset multiple times</span><font></font>
<font></font>
    running_loss = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> enumerate(trainloader, <span class="hljs-number">0</span>):
        <span class="hljs-comment"># get the inputs; data is a list of [inputs, labels]</span>
    inputs, labels = data[<span class="hljs-number">0</span>].to(device), data[<span class="hljs-number">1</span>].to(device)<font></font>
<font></font>
        <span class="hljs-comment"># zero the parameter gradients</span><font></font>
        optimizer.zero_grad()<font></font>
<font></font>
        <span class="hljs-comment"># forward + backward + optimize</span><font></font>
        outputs = net(inputs)<font></font>
        loss = criterion(outputs, labels)<font></font>
        loss.backward()<font></font>
        optimizer.step()<font></font>
<font></font>
        <span class="hljs-comment"># print statistics</span><font></font>
        running_loss += loss.item()<font></font>
        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2000</span> == <span class="hljs-number">1999</span>:    <span class="hljs-comment"># print every 2000 mini-batches</span>
            print(<span class="hljs-string">'[%d, %5d] loss: %.3f'</span> %<font></font>
                  (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<font></font>
            running_loss = <span class="hljs-number">0.0</span><font></font>
<font></font>
print(<span class="hljs-string">'Finished Training'</span>)</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta vez, la capacitaci√≥n en red dur√≥ aproximadamente 3 minutos. </font><font style="vertical-align: inherit;">Recuerde que la misma etapa en un procesador normal dur√≥ 5 minutos. </font><font style="vertical-align: inherit;">La diferencia no es significativa, esto se debe a que nuestra red no es tan grande. </font><font style="vertical-align: inherit;">Cuando se utilizan matrices grandes para el entrenamiento, aumentar√° la diferencia entre la velocidad de la GPU y el procesador tradicional. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso parece ser todo. </font><font style="vertical-align: inherit;">Lo que logramos hacer:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examinamos qu√© es la GPU y elegimos el servidor en el que est√° instalado;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configuramos un entorno de software para crear una red neuronal;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creamos una red neuronal para el reconocimiento de im√°genes y la capacitamos;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repetimos el entrenamiento de la red usando la GPU y recibimos un aumento en la velocidad.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estar√© encantado de responder preguntas en los comentarios.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es488548/index.html">Experimento: c√≥mo aprender a crear textos populares en ingl√©s (y por qu√© los habristas de habla inglesa leen tan poco)</a></li>
<li><a href="../es488550/index.html">¬øQui√©n quiere hacer cooperativas con gigantes de TI?</a></li>
<li><a href="../es488552/index.html">Desarrolladores de Apple FAS y Control Parental</a></li>
<li><a href="../es488558/index.html">Garantizar una alta disponibilidad de aplicaciones con Kafka Streams</a></li>
<li><a href="../es488560/index.html">Alojamiento gratuito de bots de Telegram en Google Cloud Platform</a></li>
<li><a href="../es488566/index.html">C√≥mo un ingeniero de control de calidad ahorr√≥ un d√≠a entero al vincular AutoTests en Visual Studio y Test IT</a></li>
<li><a href="../es488568/index.html">¬øLas redes neuronales sue√±an con el dinero el√©ctrico?</a></li>
<li><a href="../es488570/index.html">C√≥mo el Servicio Secreto de EE. UU. Confundi√≥ el juego de rol cyberpunk con un libro de texto para hackers</a></li>
<li><a href="../es488572/index.html">Unity Analyzers ahora de c√≥digo abierto</a></li>
<li><a href="../es488574/index.html">Los estudiantes escriben el controlador Uart para STM32F411</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>