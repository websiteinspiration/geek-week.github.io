<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèæ üë®üèæ‚ÄçüöÄ üé≥ Install and configure the SDK for building LibreOffice extension ‚ôãÔ∏è üëã üì°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction
 During the development process of our DSS product, it was required to create an extension for LibreOffice in C ++. The choice of languag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Install and configure the SDK for building LibreOffice extension</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/crosstech/blog/499324/"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Introduction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
During the development process of our DSS product, it was required to create an extension for LibreOffice in C ++. </font><font style="vertical-align: inherit;">The choice of language was due to the presence of existing projects in C ++, but I did not want to create a ‚Äúzoo‚Äù in the projects. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We began to study </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">materials</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on this issue, articles, including on this </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resource</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It would seem that there is a lot of data, but in fact the information was either very scarce, or it was no longer relevant due to outdated versions of LO. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I had to study the issue on my own.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/fn/et/dn/fnetdnyb4rkf2ivr4eq0y2z-kla.png" alt="image"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDK assembly</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To build under Windows you will need</font></font></h3><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LibreOffice 6.2.4 / 6.2.5 + LibreOffice SDK 6.2.4 / 6.2.5 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LibreOffice</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &amp; </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) or higher.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU Zip Make CoreUtils Sed ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jdk ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft VS with installed compiler for C ++ + MSTools and Microsoft.NET</font></font></li>
</ul><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Main steps</font></font></h4> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Install LibreOffice and LibreOffice SDK, preferably in the "Without spaces" directory. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Example C: \ App \ Libreoffice6.2.4.2x64 and C: \ App \ Libreoffice6.2.4.2x64 \ sdk, respectively. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We open the console, go to the directory containing our downloaded SDK: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd C: \ App \ Libreoffice6.2.4.2x64 \ sdk </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Run setsdkenv_windows.bat </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
This script generates a batch file for your user on the system for the first time, asking you to register the paths to:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LibreOffice</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LibreOffice SDK;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNU utilities for building packages, C ++, C # and VB.NET compilers, and the Java SDK directory.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Specify the appropriate folders.</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Important</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! You must specify all the paths to the versions of the corresponding bit depths. ‚ÄúAutomatic deployment of UNO components (YES / NO)‚Äú will install the package immediately after assembly, I chose NO. It is also necessary to go along the path to the batch file, for example C: \ Users \ yurev.admin \ AppData \ Roaming \ libreoffice6.2_sdk and adjust the path to VCVARS32 with handles, I did this through a new variable.</font></font><br>
<br>
<pre><code class="bash hljs"><span class="hljs-built_in">set</span> OO_SDK_CPP_HOME=C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Tools\MSVC\14.20.27508\bin\HostX64\x64
<span class="hljs-built_in">set</span> OO_SDK_VCVARS_HOME=C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\VC\Auxiliary\Build
<span class="hljs-keyword">if</span> defined OO_SDK_VCVARS_HOME call <span class="hljs-string">"%OO_SDK_VCVARS_HOME%\VCVARS64.bat"</span> </code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
You need to choose a path for your bit depth. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After successfully setting the environment variables, we will receive the following message: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/fq/se/yq/fqseyqla8wjsipeqmk4kgcbjsqg.jpeg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
There should not be any comments - this will affect the assembly later. </font><font style="vertical-align: inherit;">The command line goes into Shell prepared for SDK mode. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
We also go to the directory with the GNU packages (C: \ Program Files (x86) \ GnuWin32 \ bin) and rename the link.exe linker so that it does not get confused with the Microsoft linker in the future, if necessary, we can always call it by a new name.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SDK compilation</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The next step is to compile the headers or (for Java) classes. </font><font style="vertical-align: inherit;">By itself, the SDK is a collection of components with the .idl extension, which are assembled into .udl blocks, which, in turn, are assembled into a registry with the .rdb extension. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In this form, of course, it is impossible to use it, but the goal of this approach is the ability to write your own components, which are then added to the general tree. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Take the project from the LibreOffice example. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Go to the C: \ App \ Libreoffice6.2.4.2x64 \ sdk \ examples \ cpp \ complextoolbarcontrols directory and execute make. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
If the data in the first step is entered correctly and the environment variables are set correctly, then we will see</font></font><br>
<br>
<pre><code class="bash hljs">C:\App\Libreoffice6.2.4.2x64\sdk\examples\cpp\complextoolbarcontrols&gt;make<font></font>
mkdir c:\libreoffice6.2_sdk\WINexample.out\slo\complextoolbarcontrols<font></font>
   c:\libreoffice6.2_sdk\WINexample.out\slo\complextoolbarcontrols  .<font></font>
make: [c:/libreoffice6.2_sdk/WINexample.out/slo/complextoolbarcontrols/MyProtocolHandler.obj]  1 ()<font></font>
cl -c -MD -Zm500 -Zc:wchar_t- -wd4251 -wd4275 -wd4290 -wd4675 -wd4786 -wd4800 -GR -EHa -I. -Ic:/libreoffice6.2_sdk/WINexample.out/inc-Ic:/libreoffice6.2_sdk/WINexample.out/inc/examples -I../../../include -Ic:/libreoffice6.2_sdk/WINexample.out/inc/complextoolbarcontrols -DWIN32 -DWNT -D_DLL -DCPPU_ENV=mscx -Foc:\libreoffice6.2_sdk\WINexample.out\slo\complextoolbarcontrols\MyProtocolHandler.obj MyProtocolHandler.cxx<font></font>
  Microsoft (R) C/C++  19.21.27702.2  x64<font></font>
(C)   (Microsoft Corporation).   .</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 and the assembly will go, as a result of the assembly we get:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">downloaded files in the C: \ libreoffice6.2_sdk \ WINexample.out \ inc directory, </font></font></li>
<li> manifest.xml  C:\libreoffice6.2_sdk\WINexample.out\misc\complextoolbarcontrols\complextoolbarcontrols\META-INF,</li>
<li>complextoolbarcontrols.uno.dll  C:\libreoffice6.2_sdk\WINexample.out\misc\complextoolbarcontrols\Windows, </li>
<li> ,   description.xml  C:\libreoffice6.2_sdk\WINexample.out\misc\complextoolbarcontrols,</li>
<li>  C:\libreoffice6.2_sdk\WINexample.out\slo\complextoolbarcontrols </li>
<li>    complextoolbarcontrols.oxt  C:\libreoffice6.2_sdk\WINexample.out\bin.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In essence, the Makefile does everything for us in which we correctly entered the environment variables. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cppmaker, based on the offapi.rdb and types.rdb registry files, downloads the dependencies needed to build cxx files. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The compiler collects these files into object files, hanging the linker from them from the LibreOffice directory collects the output dll, then the manifest.xml description.xml .components files are generated and all this is packaged together using zip into the .oxt archive. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The version with cigwin ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) had to be abandoned due to the impossibility of building due to a hanging console.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To build under Linux you will need:</font></font></h3><br>
<pre><code class="bash hljs">ibcurl4-openssl-dev zip git build-essential wget curl gstreamer1.0-libav libkrb5-dev nasm graphviz ccache libpython3-dev libreoffice-dev*</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
These packages do not take up much space, so we use the Docker image to build the extension. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The preparation process is almost similar to Window. </font><font style="vertical-align: inherit;">Instead of setsdkenv_windows.bat, run setsdkenv_unix from / usr / lib / libreoffice / sdk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
After that, by analogy with Windows, go to / usr / lib / libreoffice / sdk / examples / cpp / complextoolbarcontrols and run make. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As a result, upon completion of the assembly, we will get the finished extension that lies in the directory specified during configuration through setsdkenv_unix.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links that helped us</font></font></h4><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niocs.github.io/LOBook/extensions/part5.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a good tutorial on creating extensions;</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forum.openoffice.org/en/forum/viewtopic.php?f=44&amp;t=71155</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a forum with sensible tips;</font></font></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en499312/index.html">Powerhell for beginners</a></li>
<li><a href="../en499314/index.html">DIY computer in the desk</a></li>
<li><a href="../en499316/index.html">Efficient, reliable microservices</a></li>
<li><a href="../en499320/index.html">What is the geometry of the universe?</a></li>
<li><a href="../en499322/index.html">Windows Server or Linux distributions? Choosing a server OS</a></li>
<li><a href="../en499326/index.html">Sweet bitterness of the product: in what metrics to work?</a></li>
<li><a href="../en499328/index.html">Cylance vs Sality</a></li>
<li><a href="../en499330/index.html">Moving Online: The Experience of Online Strategic Planning</a></li>
<li><a href="../en499334/index.html">What is the result of email marketing: how to make a forecast</a></li>
<li><a href="../en499338/index.html">All interviews and hiring of employees are now deleted.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>