<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎀 🧖🏿 🔖 MotionLayout：アニメーションの方が優れ、コードが少ない 🖋️ 📛 👊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Googleは新しい便利なライブラリとAPIで私たちの生活を改善し続けています。その中には新しいMotionLayoutがありました。私たちのアプリケーションには豊富なアニメーションがあるため、私の同僚であるセドリックホルツは、新しいAPIを使用して、アプリケーションの最も重要なアニメーション（デー...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>MotionLayout：アニメーションの方が優れ、コードが少ない</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/458854/"><img src="https://habrastorage.org/webt/wk/q7/cq/wkq7cqwqisgnz3lof9qfobt5bte.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Googleは新しい便利なライブラリとAPIで私たちの生活を改善し続けています。</font><font style="vertical-align: inherit;">その中には新しいMotionLayoutがありました。</font><font style="vertical-align: inherit;">私たちのアプリケーションには豊富なアニメーションがあるため、私の同僚であるセドリックホルツは、新しいAPIを使用して、アプリケーションの最も重要なアニメーション（デートでの投票）をすぐに実装し、大量のコードを節約しました。</font><font style="vertical-align: inherit;">私は彼の記事の翻訳を共有します。</font></font></i>&nbsp;<br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google I / O 2019カンファレンスは最近終了し、愛するSDKの更新と最新の改善が発表されました。</font><font style="vertical-align: inherit;">個人的には、ConstraintLayoutの将来の機能性に関するNicholas RoadとJohn Hofordによるプレゼンテーションに特に興味がありました。</font><font style="vertical-align: inherit;">より具体的には、MotionLayoutの形での拡張について。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ベータ版のリリース後、このライブラリに基づいてデートアニメーションを実装したいと思いました。</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、用語を定義しましょう：</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">「MotionLayoutは、さまざまな状態間でレイアウトをアニメーション化できるConstraintLayoutです。」</font><font style="vertical-align: inherit;">-   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ドキュメント</font></font></a></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MotionLayoutの主要なアイデアを説明</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">する</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nicholas Roadの</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">一連の記事</font></a><font style="vertical-align: inherit;"> 
をまだ読んでいない場合</font><font style="vertical-align: inherit;">は、読むことを強くお勧めします。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それでは、導入が完了したので、取得したいものを見てみましょう。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wm/kb/qm/wmkbqmy_ulwafy_jvkvpadfafyu.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">カードスタック</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シフトした地図を表示します</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、MotionLayoutをレイアウトディレクトリに追加します。これには、これまでのところトップカードが1つだけ含まれています。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;androidx.constraintlayout.motion.widget.MotionLayout android:id=<span class="hljs-string">"@+id/motionLayout"</span>
&nbsp;&nbsp;&nbsp;&nbsp;xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
&nbsp;&nbsp;&nbsp;&nbsp;xmlns:app=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:layoutDescription=<span class="hljs-string">"@xml/scene_swipe"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:motionDebug=<span class="hljs-string">"SHOW_ALL"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;FrameLayout<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@+id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"0dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"0dp"</span> /&gt;<font></font>
<font></font>
&lt;/androidx.constraintlayout.motion.widget.MotionLayout&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この行に注意してください：app：motionDebug = "SHOW_ALL"。これにより、デバッグ情報、オブジェクトの軌跡、アニメーションの開始と終了の状態、および現在の進行状況を表示できます。この行はデバッグ時に非常に役立ちますが、製品に送信する前に削除することを忘れないでください。これについてのリマインダーはありません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ご覧のとおり、ここではビューに制限を設定していません。それらは、現在定義しているシーン（MotionScene）から取得されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
まず、初期状態の定義から始めましょう。1枚のカードが画面の中央にあり、インデントがあります。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;MotionScene xmlns:android=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
&nbsp;&nbsp;&nbsp;&nbsp;xmlns:app=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ConstraintSet android:id=<span class="hljs-string">"@+id/rest"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginBottom=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginEnd=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginStart=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginTop=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ConstraintSet&gt;<font></font>
<font></font>
&lt;/MotionScene&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
制約セット（ConstraintSet）パスなどを追加します。</font><font style="vertical-align: inherit;">それらは完全に左または右にシフトされたときの一番上のカードの状態を反映します。</font><font style="vertical-align: inherit;">地図が画面から消える前に停止して、決定を確認する美しいアニメーションを表示します。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;ConstraintSet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@+id/pass"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:deriveConstraintsFrom=<span class="hljs-string">"@+id/rest"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"0dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginBottom=<span class="hljs-string">"80dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginEnd=<span class="hljs-string">"200dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginStart=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginTop=<span class="hljs-string">"20dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintEnd_toEndOf=<span class="hljs-string">"parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintWidth_percent=<span class="hljs-string">"0.7"</span> /&gt;<font></font>
&lt;/ConstraintSet&gt;<font></font>
<font></font>
&lt;ConstraintSet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@+id/like"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:deriveConstraintsFrom=<span class="hljs-string">"@id/rest"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"0dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginBottom=<span class="hljs-string">"80dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginEnd=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginStart=<span class="hljs-string">"200dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginTop=<span class="hljs-string">"20dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintStart_toStartOf=<span class="hljs-string">"parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintWidth_percent=<span class="hljs-string">"0.7"</span> /&gt;<font></font>
&lt;/ConstraintSet&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
両方の制約セットを前のシーンに追加します。</font><font style="vertical-align: inherit;">それらはほとんど同じで、画面の両側でのみミラーリングされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、開始、いいね、合格の3つの制限があります。</font><font style="vertical-align: inherit;">これらの状態間の遷移を定義しましょう。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、シーンを左にスワイプするための1つのトランジションと、右にスワイプするためのもう1つのトランジションを追加します。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;Transition<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetEnd=<span class="hljs-string">"@+id/pass"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetStart=<span class="hljs-string">"@+id/rest"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:duration=<span class="hljs-string">"300"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;OnSwipe<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:dragDirection=<span class="hljs-string">"dragLeft"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:onTouchUp=<span class="hljs-string">"autoComplete"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:touchAnchorId=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:touchAnchorSide=<span class="hljs-string">"left"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:touchRegionId=<span class="hljs-string">"@id/topCard"</span> /&gt;<font></font>
&lt;/Transition&gt;<font></font>
<font></font>
&lt;Transition<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetEnd=<span class="hljs-string">"@+id/like"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetStart=<span class="hljs-string">"@+id/rest"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:duration=<span class="hljs-string">"300"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;OnSwipe<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:dragDirection=<span class="hljs-string">"dragRight"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:onTouchUp=<span class="hljs-string">"autoComplete"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:touchAnchorId=<span class="hljs-string">"@+id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:touchAnchorSide=<span class="hljs-string">"right"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:touchRegionId=<span class="hljs-string">"@id/topCard"</span> /&gt;<font></font>
&lt;/Transition&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、一番上のカードでは、スワイプアニメーションを左に、同じように設定します-右にスワイプするためのミラー。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのプロパティは、シーンとの相互作用を改善するのに役立ちます。</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">touchRegionId：マップの周囲にパディングを追加したため、タッチがMotionLayout全体ではなく、マップ自体の領域でのみ認識されるようにする必要があります。</font><font style="vertical-align: inherit;">これはtouchRegionIdを使用して行うことができます。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onTouchUp：カードをリリースした後、アニメーションはどうなりますか？</font><font style="vertical-align: inherit;">移動するか、初期状態に戻る必要があるため、autoCompleteが適用されます。</font></font><br>
</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
何が起きたのか見てみましょう：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zs/zq/ox/zszqoxe4dsdpphvu3fro0_3tjtk.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地図は自動的に画面から消えます</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、マップが画面を超えたときに起動されるアニメーションに取り組みます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションの最終状態ごとに、さらに2つのConstraintSetセットを追加します。マップは画面から左右に離れます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次の例では、like状態を作成する方法を示します。pass状態では、ミラーリングが繰り返されます。</font><font style="vertical-align: inherit;">実用的な例は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全に見ることができ</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;ConstraintSet android:id=<span class="hljs-string">"@+id/offScreenLike"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"0dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginBottom=<span class="hljs-string">"80dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginEnd=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginTop=<span class="hljs-string">"20dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintStart_toEndOf=<span class="hljs-string">"parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintWidth_percent=<span class="hljs-string">"0.7"</span> /&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&lt;/ConstraintSet&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ここで、前の例と同様に、スワイプ状態から最終状態への遷移を決定する必要があります。</font><font style="vertical-align: inherit;">トランジションは、スワイプのアニメーションの直後に自動的に機能するはずです。</font><font style="vertical-align: inherit;">これはautoTransitionを使用して実行できます。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;Transition<font></font>
    app:autoTransition=<span class="hljs-string">"animateToEnd"</span>
    app:constraintSetEnd=<span class="hljs-string">"@+id/offScreenLike"</span>
    app:constraintSetStart=<span class="hljs-string">"@+id/like"</span>
    app:duration=<span class="hljs-string">"150"</span> /&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、画面からスワイプできるスワイプカードが完成しました。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vt/ip/i0/vtipi0xzpmomh5mlkqpoytwedze.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ボトムマップのアニメーション</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、一番下のカードを作成して、デッキの無限の錯覚を作成します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初のマップと同様に、レイアウトにもう1つのマップを追加します。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;FrameLayout<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@+id/bottomCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"0dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"0dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;android:background=<span class="hljs-string">"@color/colorAccent"</span> /&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
XMLを変更して、アニメーションの各段階でこのマップに適用される制限を設定します。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;ConstraintSet android:id=<span class="hljs-string">"@id/rest"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- ... --&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint android:id=<span class="hljs-string">"@id/bottomCard"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Layout<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"match_parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginBottom=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginEnd=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginStart=<span class="hljs-string">"50dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_marginTop=<span class="hljs-string">"50dp"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Transform<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleX=<span class="hljs-string">"0.90"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleY=<span class="hljs-string">"0.90"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Constraint&gt;<font></font>
<font></font>
&lt;/ConstraintSet&gt;<font></font>
<font></font>
&lt;ConstraintSet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@+id/offScreenLike"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:deriveConstraintsFrom=<span class="hljs-string">"@id/like"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- ... --&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint android:id=<span class="hljs-string">"@id/bottomCard"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Transform<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleX=<span class="hljs-string">"1"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleY=<span class="hljs-string">"1"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Constraint&gt;<font></font>
<font></font>
&lt;/ConstraintSet&gt;</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、便利なConstraintSetプロパティを使用できます。&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
デフォルトでは、新しい各セットは親MotionLayoutから属性を取得します。ただし、deriveConstraintsFromフラグを使用すると、セットに別の親を設定できます。制約タグを使用して制約を設定した場合、親セットからすべての制約を再定義することに注意してください。これを回避</font><font style="vertical-align: inherit;">するに</font><font style="vertical-align: inherit;">は、</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">タグに</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定の属性</font><font style="vertical-align: inherit;">を設定して、</font><font style="vertical-align: inherit;">それらのみが置換されるようにします。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vz/ff/zb/vzffzb5u7rlwpayywz7zfm6gnyk.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
私たちの場合、これはパスセットでレイアウトタグを定義せず、親からコピーすることを意味します。ただし、Transformをオーバーライドするため、Transformタグで指定されたすべての属性を、独自の属性（この場合はスケールの変更）に置き換えます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これは、MotionLayoutを使用して新しい要素を追加し、それをシーンのアニメーションとシームレスに統合するのがいかに簡単かを示しています。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/_-/73/jp/_-73jp-vstz02uondgcnyzwcxqe.gif"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アニメーションを無限にする</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションが完了した後、一番上のカードはスワイプできません。これは、一番下のカードになったためです。</font><font style="vertical-align: inherit;">無限のアニメーションを取得するには、カードを交換する必要があります。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最初、私はこれを新しいトランジションで実行したかった：</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;Transition<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;app:autoTransition=<span class="hljs-string">"jumpToEnd"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetEnd=<span class="hljs-string">"@+id/rest"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetStart=<span class="hljs-string">"@+id/offScreenLike"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:duration=<span class="hljs-string">"0"</span> /&gt;</code></pre><br>
<img src="https://habrastorage.org/webt/jb/6h/lz/jb6hlzynphpyptximrzq1wgfqfw.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーション全体が正常に再生されます。</font><font style="vertical-align: inherit;">これで、無限にスワイプできるカードのスタックができました！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
少しスワイプして、何かに気づきました。</font><font style="vertical-align: inherit;">カードをタッチすると、デッキアニメーションの最後への移行が停止します。</font><font style="vertical-align: inherit;">アニメーションの継続時間はゼロですが、それでも停止します。これは悪いことです。&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yv/nq/mo/yvnqmowevaznpjimh5kbtiplwco.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MotionLayoutのアクティブなトランジションをプログラムで変更することで、たった1つの方法で勝つことができました。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、アニメーションの完了時にコールバックを設定します。</font><font style="vertical-align: inherit;">offScreenLikeとoffScreenPassが完了するとすぐに、遷移をリセットしてリセット状態に戻し、進行状況をゼロにします。</font></font><br>
<br>
<pre><code class="kotlin hljs">motionLayout.setTransitionListener(<span class="hljs-keyword">object</span> : TransitionAdapter() {<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onTransitionCompleted</span><span class="hljs-params">(motionLayout: <span class="hljs-type">MotionLayout</span>, currentId: <span class="hljs-type">Int</span>)</span></span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">when</span> (currentId) {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R.id.offScreenPass,<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R.id.offScreenLike -&gt; {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motionLayout.progress = <span class="hljs-number">0f</span><font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motionLayout.setTransition(R.id.rest, R.id.like)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;}<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
})</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スワイプすると、目的のトランジションに切り替えられます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/li/9b/yo/li9byopqw8itzxzsgj2wgwbufxm.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
見た目は同じですが、アニメーションは止まりません！</font><font style="vertical-align: inherit;">進め！</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">データバインディング</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
マップに表示するテストデータを作成します。</font><font style="vertical-align: inherit;">ここでは、各カードの背景色を変更することに限定します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
新しいデータのみを置き換えるsvayp-methodでViewModelを作成します。</font><font style="vertical-align: inherit;">この方法でアクティビティにバインドします。</font></font><br>
<br>
<pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> viewModel = ViewModelProviders<font></font>
    .of(<span class="hljs-keyword">this</span>)<font></font>
    .<span class="hljs-keyword">get</span>(SwipeRightViewModel::<span class="hljs-keyword">class</span>.java)<font></font>
<font></font>
viewModel<font></font>
    .modelStream<font></font>
    .observe(this, Observer {<font></font>
        bindCard(it)<font></font>
    })<font></font>
<font></font>
motionLayout.setTransitionListener(<span class="hljs-keyword">object</span> : TransitionAdapter() {<font></font>
<font></font>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">fun</span> onTransitionCompleted(motionLayout: MotionLayout, currentId: <span class="hljs-built_in">Int</span>) {
        <span class="hljs-keyword">when</span> (currentId) {<font></font>
            R.id.offScreenPass,<font></font>
            R.id.offScreenLike -&gt; {<font></font>
                motionLayout.progress = <span class="hljs-number">0f</span><font></font>
                motionLayout.setTransition(R.id.rest, R.id.like)<font></font>
                viewModel.swipe()<font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
})<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
スワイプアニメーションの完了についてViewModelに通知するために残り、現在表示されているデータを更新します。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vl/j6/ar/vlj6arofcxa3lc7ny2z-ww1yxxg.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ポップアップアイコン</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのビューを追加します。スワイプすると、画面のいずれかの側面に表示されます（下に表示されているのは1つだけで、もう1つは鏡像です）。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;ImageView<font></font>
    android:id=<span class="hljs-string">"@+id/likeIndicator"</span>
    android:layout_width=<span class="hljs-string">"0dp"</span>
    android:layout_height=<span class="hljs-string">"0dp"</span> /&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、マップについて、これらのビューでアニメーションの状態を設定する必要があります。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;ConstraintSet android:id=<span class="hljs-string">"@id/rest"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- ... --&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint android:id=<span class="hljs-string">"@+id/like"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Layout<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"40dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"40dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintBottom_toBottomOf=<span class="hljs-string">"parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintStart_toEndOf=<span class="hljs-string">"parent"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintTop_toTopOf=<span class="hljs-string">"parent"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Transform<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleX=<span class="hljs-string">"0.5"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleY=<span class="hljs-string">"0.5"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;PropertySet android:alpha=<span class="hljs-string">"0"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Constraint&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&lt;/ConstraintSet&gt;<font></font>
<font></font>
&lt;ConstraintSet<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;android:id=<span class="hljs-string">"@+id/like"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:deriveConstraintsFrom=<span class="hljs-string">"@id/rest"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- ... --&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Constraint android:id=<span class="hljs-string">"@+id/like"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Layout<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_width=<span class="hljs-string">"100dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:layout_height=<span class="hljs-string">"100dp"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintBottom_toBottomOf=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintEnd_toEndOf=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintStart_toStartOf=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:layout_constraintTop_toTopOf=<span class="hljs-string">"@id/topCard"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Transform<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleX=<span class="hljs-string">"1"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;android:scaleY=<span class="hljs-string">"1"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;PropertySet android:alpha=<span class="hljs-string">"1"</span> /&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Constraint&gt;<font></font>
<font></font>
&lt;/ConstraintSet&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションは親から継承されるため、画面を超えるアニメーションに制限を設定する必要はありません。</font><font style="vertical-align: inherit;">そして私たちの場合、これはスワイプの状態です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
それだけで十分です。</font><font style="vertical-align: inherit;">これで、コンポーネントをアニメーションチェーンに非常に簡単に追加できます。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/wg/4g/1g/wg4g1grirk3zwqrfzwyahfp8i3i.gif"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">プログラムでアニメーションを実行する</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ユーザーがスワイプするだけでなく、ボタンを使用して制御できるように、カードに2つのボタンを作成できます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
各ボタンは、スワイプと同じアニメーションを開始します。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常どおり、ボタンのクリックをサブスクライブし、MotionLayoutオブジェクトで直接アニメーションを開始します。</font></font><br>
<br>
<pre><code class="kotlin hljs">likeButton.setOnClickListener {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;motionLayout.transitionToState(R.id.like)<font></font>
}<font></font>
passButton.setOnClickListener {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;motionLayout.transitionToState(R.id.pass)<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アニメーションが連続して再生されるように、上部カードと下部カードの両方にボタンを追加する必要があります。</font><font style="vertical-align: inherit;">ただし、下部のマップの場合、クリックサブスクリプションは必要ありません。表示されないか、上部のマップがアニメーション化されており、中断したくないためです。</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ic/zj/_v/iczj_vz8nrpdzlxtmjsaqc3bmiu.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MotionLayoutが状態変化を処理する方法のもう1つの素晴らしい例です。</font><font style="vertical-align: inherit;">アニメーションを少し遅くしましょう</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d6/bk/ne/d6bkne2bvugopppwypug25l30m8.gif"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
。パスが次のように置換されるときにMotionLayoutが実行する遷移を見てください。</font><font style="vertical-align: inherit;">マジック！</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">曲線に沿ってマップをスワイプします</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
地図が直線ではなく曲線を描くように移動したい場合を考えてみます（正直に言うと、私はそれを試してみたかっただけです）。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次に、両方向の動きのKeyPositionを定義して、動きのパスが円弧で湾曲するようにする必要があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これをモーションシーンに追加します。</font></font><br>
<br>
<pre><code class="kotlin hljs">&lt;Transition<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetEnd=<span class="hljs-string">"@+id/like"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:constraintSetStart=<span class="hljs-string">"@+id/rest"</span>
&nbsp;&nbsp;&nbsp;&nbsp;app:duration=<span class="hljs-string">"300"</span>&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- ... --&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;KeyFrameSet&gt;<font></font>
<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;KeyPosition<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:drawPath=<span class="hljs-string">"path"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:framePosition=<span class="hljs-string">"50"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:keyPositionType=<span class="hljs-string">"pathRelative"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:motionTarget=<span class="hljs-string">"@id/topCard"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:percentX=<span class="hljs-string">"0.5"</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app:percentY=<span class="hljs-string">"-0.1"</span> /&gt;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/KeyFrameSet&gt;<font></font>
<font></font>
&lt;/Transition&gt;</code></pre><br>
<img src="https://habrastorage.org/webt/ij/z4/4m/ijz44micij7kdu81k4-tc-zggjc.gif"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これで、マップは非基本的なカーブしたパスに沿って移動します。</font><font style="vertical-align: inherit;">魔法のように！</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">結論</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これらのアニメーションを作成したときに取得したコードの量と、本番環境での類似のアニメーションの現在の実装を比較すると、結果は驚異的です。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MotionLayoutは、トランジションのキャンセル（たとえば、タッチしたとき）、アニメーションチェーンの作成、トランジション中のプロパティの変更など、気付かないうちに処理します。</font><font style="vertical-align: inherit;">このツールは基本的にすべてを変更し、UIロジックを大幅に簡素化します。&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
作業する価値のあることがいくつかあります（ほとんどの場合、RecyclerViewでアニメーションと双方向スクロールを無効にします）が、これは解決できると確信しています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ライブラリはまだベータ版ですが、すでに多くのエキサイティングな機会が開かれています。</font><font style="vertical-align: inherit;">MotionLayoutのリリースを楽しみにしています。これは、今後何度も私たちに役立つことでしょう。</font><font style="vertical-align: inherit;">完全に機能するアプリケーションは、この記事の</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リポジトリで</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">確認でき</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">ます</font></a><font style="vertical-align: inherit;">。</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS：そして、彼らは私に翻訳者として発言権を与えたので、私たちのAndroidチームには</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">開発者の</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ための場所があり</font><font style="vertical-align: inherit;">ます。</font><font style="vertical-align: inherit;">ご清聴ありがとうございました。&nbsp;</font></font></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja458842/index.html">忍耐と労働はテキスト全体を抽出します</a></li>
<li><a href="../ja458844/index.html">VeriSM™アプローチの適応によるサイロ破壊</a></li>
<li><a href="../ja458846/index.html">Unityを使用して別のプラットフォーマーを開発する方法。別のチュートリアル</a></li>
<li><a href="../ja458848/index.html">Rust 1.36.0リリース：将来の特性、割り当ての安定化、MaybeUninit <T></a></li>
<li><a href="../ja458850/index.html">安く効率的に英語を学びましょう。パート2</a></li>
<li><a href="../ja458856/index.html">安くて高価な単4電池</a></li>
<li><a href="../ja458860/index.html">PostgreSQLを最適化するためのLinuxカーネルパラメータの調整</a></li>
<li><a href="../ja458864/index.html">TamTamのボット開発者コンテスト</a></li>
<li><a href="../ja458866/index.html">World of Tanks Blitzでのチームバランサーの仕組み</a></li>
<li><a href="../ja458868/index.html">ビッグデータのノイズ。エントロピー分析</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>