<!doctype html>
<html class="no-js" lang="ar">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🔬 🎮 🏕️ تحديث عملية CI / CD: نشر الأخطبوط 🤽🏼 🔞 😪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="الجزء الثالث من المقالة حول تحديث عمليات CI / CD.  
 
 في هذه المرحلة ، لدينا (على الأقل يجب أن يكون لدينا) فهمًا لكيفية عمل CI ، وما لدينا عند المدخل...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>تحديث عملية CI / CD: نشر الأخطبوط</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/497112/"><img src="https://habrastorage.org/webt/ll/fr/wq/llfrwqyrix6tk6l50b5sk86rqtm.png" alt="صورة" align="left" width="300"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء الثالث من المقالة حول تحديث عمليات CI / CD.&nbsp; </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في هذه المرحلة ، لدينا (على الأقل يجب أن يكون لدينا) فهمًا لكيفية عمل CI ، وما لدينا عند المدخلات ، وكيفية الحصول على النتيجة منه ، وما يجب القيام به حتى يصبح ناتج البناء وحدة مشروع كاملة ويبدأ. وكذلك الأخطبوط (يفضل أن يكون LTS). في الجزء الأخير ، تم النظر في عملية إنشاء المدينة الجماعية: كل ما يحدث منذ اللحظة التي يدخل فيها الرمز إلى المستودع وحتى يمكن تفريغ الأرشيف الجاهز ، ومن الناحية النظرية ، يجب أن يعمل. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أذكر جدول المحتويات: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء 1: ما هو ، لماذا لا يبدو ، التخطيط ، القليل من الباش.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> أود أن أسمي هذا الجزء شبه التقني. </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء 2: teamcity. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الجزء 3: نشر الأخطبوط.</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الجزء الرابع: خلف الكواليس. </font><font style="vertical-align: inherit;">لحظات غير سارة ، خطط للمستقبل ، ربما أسئلة متكررة. </font><font style="vertical-align: inherit;">على الأرجح ، يمكن أن يطلق عليه أيضًا شبه تقني.</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الأخطبوط: عام</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عند الإدخال ، لدينا الكود ، في الإخراج ، والتركيبات ، كل شيء واضح هنا. </font><font style="vertical-align: inherit;">لكن النتيجة لكل وحدة تتكون من جزأين: حزمة أساسية (نتيجة البناء نفسه) ، وحزمة فردية (تكوينات ومكتبات فريدة). </font><font style="vertical-align: inherit;">لذا ، لكي تعمل وحدة معينة ، نحتاج إلى شيء مثل ما يلي:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مثيل في IIS له تجمّع خاص به و "يبدو" في جذر المستند. </font><font style="vertical-align: inherit;">يتم تخصيص تجمع منفصل لكل وحدة نمطية.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ملفات الحزمة الأساسية في جذر المستند.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ملفات حزمة فردية في جذر المستند.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">من المستحسن عمل نسخة احتياطية من المحتويات القديمة لجذر المستند أمام كل هذا. </font><font style="vertical-align: inherit;">نحن ، بالطبع ، واثقون من أنفسنا ، لكن الناس منقسمون إلى نوعين: أولئك الذين لا يقومون بالنسخ الاحتياطي ، والذين </font><font style="vertical-align: inherit;">يفعلون </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">بالفعل</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .&nbsp;</font></font></li>
<li>  ( )       ( ).    ,     ,   .</li>
<li>   ,    ,    .</li>
<li>   ,   .</li>
<li>    ()    .</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ليس بهذا القدر ، لكن ليس بما يكفي. </font><font style="vertical-align: inherit;">لا توجد مشاكل في الخطوة 1. </font><font style="vertical-align: inherit;">الأخطبوط لديه قالب نشر إلى IIS ، لديه كل ما تحتاجه. </font><font style="vertical-align: inherit;">في الخطوتين 2 و 3 سوف نسهب في مزيد من التفاصيل أدناه. </font><font style="vertical-align: inherit;">في الخطوة 4 ، يكون المتغير المطلوب كافياً ، والذي سنمرره من teamcity. </font><font style="vertical-align: inherit;">الخطوة 5 هي نص برمجي. </font><font style="vertical-align: inherit;">كما سيقوم بتدوير النسخ الاحتياطية. </font><font style="vertical-align: inherit;">لماذا نحتاج إلى تخزينها كلها ، يمكن إزالة القديمة منها. </font><font style="vertical-align: inherit;">الخطوة 6 هي أيضًا powerhell. </font><font style="vertical-align: inherit;">الخطوة 7 - نموذج Slack - إخطار مفصل. </font><font style="vertical-align: inherit;">الخطوة 8 - powerhell مرة أخرى. </font><font style="vertical-align: inherit;">يبدو وكأنه خطة ، لذلك سنقوم بتنفيذها.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المستأجرين</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
مزيد من التفاصيل حول الخطوتين 2 و 3. أفترض أن القارئ على دراية بنشر الأخطبوط. إن لم يكن - هناك مقالات رائعة (وفقط) موجودة على المحور يمكنهم إعطاء فهم أساسي. ها هم: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">واحد</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> و </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الثانية</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . لذلك ، لدينا علامات تبويب للمشاريع والبنية التحتية والمستأجرين والمكتبات والمهام والإعدادات الحالية. ضروري - المستأجرين. الترجمة الحرفية لكلمة المستأجر هي المستأجر. في هذا السياق ، على الأرجح أن يكون العميل ، العميل. يخبرنا Oktopus أن المستأجرين يسمحون لك بنشر مثيلات مختلفة من المشروع دفعة واحدة للعديد من العملاء (المستأجرين). هذه هي الصفحة مع قائمتهم.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/gf/u-/xr/gfu-xrcwm5ehwz023dggr3e-vhs.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في هذه الحالة ، يتم استخدام المستأجرين بشكل مختلف قليلاً. يمثل كل مستأجر عميل فردي. بالنسبة للمستأجر هناك فرصة لإضافة المشاريع التي سيتم إطلاقها عند نشرها. وبالتالي سيكون هناك مشروع أساسي ومشروع فردي. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك علامتان لكل مستأجر: TenantRole - شائع للجميع ، مما يشير إلى أن وحدة من نوع معين (أساسي) يتم نشرها لجميع المستأجرين مع هذه العلامة ، و ModName هي علامة تطابق اسم الوحدة (فردي).&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/k5/iu/0f/k5iu0fknzckzncis11o2y0xmkd4.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يتم استلام الأخطبوط الأخير من timcity كمعلمة ، وبالتالي تحديد الوحدة النمطية التي يتم </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نشرها</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> حاليًا ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">Deploy.Env و Deploy.2</font></a><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كما ترى من الشاشة ، عند نشر وحدة نمطية </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;">لمؤسسة</font></a><font style="vertical-align: inherit;"> معينة ، سيبدأ المشروع الأساسي أولاً ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">نشر .2 خطوة المدينة الجماعية</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ، ثم مشروع فردي (نشر </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الخطوات 3 ونشر 4 teamcity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">يمكن لكل مستأجر الوصول إلى متغيرات جميع المشاريع المضمنة فيه ، بالإضافة إلى متغيرات المستأجر نفسه (التي تم جمعها في مجموعة متغيرة ، وتحتوي على علامة ModName). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sk/zs/3c/skzs3cxhjryge9jcrvu8alp2skg.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;يتم اختيار المستأجر للنشر في الفريق على النحو التالي:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">متغير env.tenantRoleTag - يحتوي على TenantRole (اسم علامة المستأجر في الأخطبوط) ، وقيمته الفعلية ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">env.modName - قيمة علامة ModName في الأخطبوط.</font></font></li>
</ul><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المتغيرات</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
المتغيرات هي جزء مهم من المشروع ، ويجب أن يتم هيكلتها بشكل صحيح. </font><font style="vertical-align: inherit;">في هذا المشروع ، تنقسم متغيرات الأخطبوط إلى ثلاثة أنواع: شائعة لجميع المشاريع (التي تم جمعها في مجموعة المكتبة "البيئة") ، والفرد لكل مشروع (تم تكوينه مباشرة في المشروع) ، والمتغيرات مباشرة من المستأجرين (مجموعة مكتبة أيضًا). </font><font style="vertical-align: inherit;">في البيئة ، كما سبق ذكره ، كل شيء مشترك لجميع المشاريع ، على وجه الخصوص:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">المسارات الأساسية لجذر المستند (على سبيل المثال ، C: \ inetpub \) ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عنوان URL الأساسي (على سبيل المثال ، بالنسبة لجميع الوحدات ، النطاق العام هو organization.com) ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الوصول إلى قواعد البيانات (اللازمة لتنظيم النسخ الاحتياطية) ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">إلخ</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
زائد كبير هو أنه في الأخطبوط لكل بيئة قد تكون هناك قيمة متغيرة. يمكن أن يكون الانفصال أي شيء. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/59/qx/ag/59qxag_xyk4vlnmqwxgc9tphyuu.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
على سبيل المثال ، الخطوط 3 و 6 و 7 على الشاشة. السطر 3 حالة شائعة. كل ما يحتاج إلى نشره في بيئة الإنتاج يحصل هنا. يصف السطران 6 و 7 حالات محددة للغاية ، على سبيل المثال: بيئة الإنتاج مع دور "CompanyWebsite" (السطر 6) ، وبيئة الإنتاج بعلامة المستأجر "orgznizationX". هذا ضروري لتحديد الخوادم التي ستحصل عليها الحزمة ، لأنه بالنسبة للمؤسسة X ، على سبيل المثال ، يتم تخصيص خادم منفصل.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
متغيرات المشروع تشمل كل شيء آخر. </font><font style="vertical-align: inherit;">شيء غير شائع ويختلف باختلاف البيئات ، على سبيل المثال ، اسم المجال المؤهل بالكامل للوحدة النمطية. </font><font style="vertical-align: inherit;">بشكل عام ، يتم تصنيفها كـ # {Tenant.ModName}. # {BaseModuleDomain} ، ومع ذلك ، قد تكون مختلفة في بعض الحالات. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ne/19/cx/ne19cx7wbn5t0k8rctfcc53-ocq.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&nbsp;يتم عرض مثل هذه الحالة في الصورة.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">القنوات</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ما زال يستحق الحديث عن القنوات. </font><font style="vertical-align: inherit;">باختصار وبسرعة - تسمح لك القنوات بتعيين منطق النشر. </font><font style="vertical-align: inherit;">واضحة جدا، وهذا هو موضح في وثائق رسمية، ولا سيما </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هنا</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> و </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">هنا</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">على سبيل المثال ، يمكن أن يدخل إصدار به علامة مستقرة فقط إلى قناة الإنتاج ، إلخ. </font><font style="vertical-align: inherit;">هناك 4 قنوات في المشروع تتوافق مع البيئات (التطوير ، الاختبار ، المرحلة ، الإنتاج). </font><font style="vertical-align: inherit;">تقع الإصدارات وفقًا لعلامات الإصدار التجريبي. </font><font style="vertical-align: inherit;">يشار إلى ذلك في تنسيق teamcity رقم البناء ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Build.General</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> الإعدادات للجزء حول teamcity). </font><font style="vertical-align: inherit;">من teamcity ، يتم نقل القناة في الخطوة </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deploy.2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> إلى حقل وسيطات سطر الأوامر الإضافية (معلمة القناة).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">أنماط - رسم</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
إذا لم تكن قد قدرت بعد جميع مزايا استخدام القوالب أثناء قراءة مقال حول teamcity ، فقد حان الوقت. من المستحسن صياغة خطوات مخصصة شائعة بما يكفي ، لأنه إذا كانت هناك حاجة لإجراء تعديلات ، فسيتعين عليك تذكر الأماكن التي يتم فيها تطبيق هذه الخطوة ، والنقر على كل مكان مشابه وإجراء تعديلات عدة مرات مثل استخدامات هذه الخطوة. في هذا المشروع ، تم إنشاء النماذج للتحقق من صحة الموقع وإرسال قائمة بالنطاقات إلى فريق العمل. النظر بإيجاز في عملية إنشاء قالب. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هناك سكربت بوويرشيل الذي يجب تشغيله في كل مرة بعد نشر أي وحدة نمطية.</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$url</span> = <span class="hljs-string">"<span class="hljs-variable">$scheme</span>"</span> + <span class="hljs-string">"://"</span> + <span class="hljs-string">"<span class="hljs-variable">$domain</span>"</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"Requesting '<span class="hljs-variable">$url</span>'"</span>
[<span class="hljs-type">Net.ServicePointManager</span>]::SecurityProtocol = [<span class="hljs-type">Net.SecurityProtocolType</span>]::Tls12
<span class="hljs-variable">$request</span> = [<span class="hljs-type">System.Net.WebRequest</span>]::Create(<span class="hljs-variable">$url</span>)
<span class="hljs-variable">$request</span>.Timeout = <span class="hljs-variable">$timeout</span>
<span class="hljs-variable">$response</span> = <span class="hljs-variable">$request</span>.GetResponse()
<span class="hljs-variable">$response</span>.Close()
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
يقبل النص البرمجي مخطط الإدخال والنطاق والمهلة التي نعتقد بعدها أن الموقع لا يعمل. </font><font style="vertical-align: inherit;">يمكنك إنشاء قالب في المكتبة - قوالب الخطوة. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
أدخل اسمًا ، واختر شعارًا. </font><font style="vertical-align: inherit;">بعد ذلك ، قم بتكوين معلمات الإدخال وقيمها الافتراضية. </font><font style="vertical-align: inherit;">قد تكون القيمة الافتراضية أيضًا هي قيمة المتغير المحدد (قيمة المتغير # {HostName} هي القيمة الافتراضية لمعلمة الإدخال # {المجال}). </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sm/1b/hd/sm1bhd7tlanxkhokj5ykkwndnqy.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد ذلك ، نعدل النص قليلاً ونضيفه كخطوة للتنفيذ: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/an/ae/jo/anaejohklygki3oeyvzdf9wzwf8.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تم. </font><font style="vertical-align: inherit;">في المخرج ، نحصل على نموذج خطوة ممتعة للعمل معه ، وأيضًا ، في غياب عملنا ، سيكون الزملاء قادرين على معرفة القيم الميدانية دون قراءة النصوص الغامضة.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zn/wh/cb/znwhcbju96vpkpnojnkahezaink.png" alt="صورة"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الأخطبوط: تفاصيل العملية</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
تنقسم جميع المشاريع إلى مجموعات ، سيتم تنفيذ الوصف على سبيل المثال من مجموعة الوحدات النمطية. </font><font style="vertical-align: inherit;">يحتوي على المشاريع التالية:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">النواة؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">مشاريع الوحدة الفردية.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
لنبدأ بالمشروع الأساسي. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هنا صفحة النظرة العامة: </font></font><br>
<br>
<img src="https://habrastorage.org/webt/h1/ej/l8/h1ejl8qvrwpp86te_6pls3nkkwi.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هنا يمكنك أن ترى بوضوح إصدارات النواة التي وصلت إليها. </font><font style="vertical-align: inherit;">أعتذر عن الارتباك في أرقام الإصدار ، والآن ننتقل إلى الإصدار المرتبط بعلامة git ، وفي كل مكان باستثناء الإنتاج ، يتم استخدام الإصدار الجديد بالفعل. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
كما ترى ، لا توجد بيئات محددة لبعض المستأجرين. </font><font style="vertical-align: inherit;">إما أنها لم يتم إنشاؤها بعد أو لم يتم توقعها.&nbsp;</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عملية النشر الأساسية</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في مرحلة تسليم النواة ، يتم أيضًا تنفيذ جزء من عمليات الخدمة ، أي النسخ الاحتياطي لقاعدة البيانات (إذا لزم الأمر) ، والنسخ الاحتياطي للنسخة السابقة من الملفات ، وتناوب النسخ الاحتياطية ونشر النواة.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/mq/xe/jn/mqxejndhfnxbgb80o5bvfery-ls.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الخطوة 1: النسخ الاحتياطي لقاعدة البيانات. </font><font style="vertical-align: inherit;">إنه اختياري ، ويستند إلى قيمة المعلمة المتغيرة التي يتم تمريرها من teamcity في خطوة </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">النشر .2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> إلى حقل وسيطات سطر الأوامر الإضافية. </font><font style="vertical-align: inherit;">بشكل افتراضي ، يتم تعيين هذا المتغير على خطأ ، حيث يجب إجراء النسخ الاحتياطي لقاعدة البيانات فقط عند الطلب ، وليس باستمرار. </font><font style="vertical-align: inherit;">في مدينة الفريق ، يبدأ تغيير هذه المعلمة بهذا الشكل (تحتاج إلى النقر فوق علامة الحذف بجوار زر التشغيل): </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ru/48/s3/ru48s3ycp-wc53-ikai6vjwzqy0.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الأخطبوط ، يبدو كالتالي:&nbsp; </font></font><br>
<br>
<img src="https://habrastorage.org/webt/ec/ua/xo/ecuaxoycij2hzotqmux4sjjrcmw.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
بعد ذلك ، لا يوجد شيء غير عادي. </font><font style="vertical-align: inherit;">نسخة احتياطية من الملفات بتنسيق zip (حسب القالب) ، وتدوير النسخ الاحتياطي (سيكون النص البرمجي أقل قليلاً) ، ونشر kernel حسب القالب.&nbsp;</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ما يجب الانتباه إليه:&nbsp;</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتم تعيين جميع المعلمات الهامة بواسطة المتغيرات ، وهذا يسمح لك بتغيير قيمتها بسرعة في مكان واحد دون حفر عميقة في إعدادات العملية ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يطابق اسم تجمّع IIS اسم المثيل واسم مجال الخدمة (للراحة) ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في خطوة نشر IIS ، يتم تثبيت الدمج مع الروابط الموجودة ، بدلاً من استبدالها. </font><font style="vertical-align: inherit;">نظرًا لأنه بالإضافة إلى الخدمة ، لا يزال لدينا مجموعة من نطاقات العميل في كل حالة ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">فشل تنظيف جذر المستند (علامة الاختيار تطهير هذا الدليل قبل التثبيت). </font><font style="vertical-align: inherit;">الملفات الجديدة تحل محل الملفات القديمة أثناء النسخ. </font><font style="vertical-align: inherit;">يتم ذلك حتى لا "يتعطل" الموقع أثناء النشر. </font><font style="vertical-align: inherit;">التأخير في تحميل الصفحة أجمل بكثير من شاشة الموت.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
البرنامج النصي لتدوير النسخ الاحتياطي:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$days</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"DaysStoreBackups"</span>]
<span class="hljs-variable">$limit</span> = (<span class="hljs-built_in">Get-Date</span>).AddDays(-<span class="hljs-variable">$days</span>)
<span class="hljs-variable">$pathDb</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"DbBackupDir"</span>]
<span class="hljs-variable">$pathFiles</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"FilesBackupDir"</span>] + <span class="hljs-string">'\'</span> + <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"HostName"</span>]<font></font>
<font></font>
<span class="hljs-comment"># Delete files older than the $limit.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathDb</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> <span class="hljs-variable">$_</span>.CreationTime <span class="hljs-operator">-lt</span> <span class="hljs-variable">$limit</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span>
<span class="hljs-comment"># Delete any empty directories left behind after deleting the old files.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathDb</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.FullName <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer }) <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Recurse</span><font></font>
<font></font>
<span class="hljs-comment"># Delete files older than the $limit.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathFiles</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> <span class="hljs-variable">$_</span>.CreationTime <span class="hljs-operator">-lt</span> <span class="hljs-variable">$limit</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span>
<span class="hljs-comment"># Delete any empty directories left behind after deleting the old files.</span>
<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$pathFiles</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { <span class="hljs-variable">$_</span>.PSIsContainer <span class="hljs-operator">-and</span> (<span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$_</span>.FullName <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">Where-Object</span> { !<span class="hljs-variable">$_</span>.PSIsContainer }) <span class="hljs-operator">-eq</span> <span class="hljs-variable">$null</span> } | <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Recurse</span>
</code></pre><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">عملية نشر حزمة فردية</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في مرحلة تسليم حزمة الوحدة النمطية الفردية ، يتم نشر التكوينات والمكتبات الفريدة ، ويتم تحديد موقع الملفات و / أو إعادة تسميتها ، ويتم طلب الموقع (أولاً ، يتم تحميل المواقع على .net لأول مرة لفترة طويلة ، وتتيح لك هذه الخطوة تنفيذ هذا الإجراء فورًا ، وثانيًا ، تسمح لك بفهم ما إذا كانت هناك أية أخطاء عند تحميل الموقع). </font><font style="vertical-align: inherit;">يتم إرسال إشعار أيضًا إلى slack ، ويتم نقل قائمة فعلية بجميع المجالات التي تنتمي إلى هذه الوحدة إلى teamcity.&nbsp;</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zh/vk/pr/zhvkprmelbx8edaxft0imsokmja.png" alt="صورة"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
من المهم:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">في خطوة النشر ، لا يتم تنظيف جذر المستند (الحزمة الأساسية الجديدة موجودة بالفعل) ؛</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الخطوة 3 ، البرنامج النصي. </font><font style="vertical-align: inherit;">كان أعلى قليلاً في وصف القوالب. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
الخطوة 5. كما انه يرتبط مع </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deploy.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> خطوة </font><font style="vertical-align: inherit;">في teamcity. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
في الأخطبوط ، يبدو مثل هذا:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-variable">$baseDomain</span> = <span class="hljs-variable">$OctopusParameters</span>[<span class="hljs-string">"HostName"</span>]
<span class="hljs-variable">$domains</span> = (<span class="hljs-built_in">Get-WebBinding</span> <span class="hljs-variable">$baseDomain</span>).bindingInformation | %{ <span class="hljs-variable">$_</span>.Split(<span class="hljs-string">':'</span>)[<span class="hljs-number">2</span>] } | <span class="hljs-built_in">Sort-Object</span> | <span class="hljs-built_in">Get-Unique</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"##teamcity[setParameter name='AllInstanceDomains' value='<span class="hljs-variable">$domains</span>']"</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"##teamcity[setParameter name='ServiceDomain' value='<span class="hljs-variable">$baseDomain</span>']"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتيح لك </font><font style="vertical-align: inherit;">
بناء الجملة </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">## teamcity ...</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> تعيين معلمة البناء في teamcity. </font><font style="vertical-align: inherit;">في الواقع ، تبدو هذه الخطوة كما يلي:</font></font><br>
<br>
<pre><code class="powershell hljs"><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"All domains on instance %ServiceDomain% :"</span>
<span class="hljs-variable">$domains</span> = <span class="hljs-string">"%AllInstanceDomains%"</span>
<span class="hljs-variable">$domains</span> = <span class="hljs-variable">$</span>(<span class="hljs-variable">$domains</span>.Split(<span class="hljs-string">" "</span>) | <span class="hljs-built_in">ForEach-Object</span> {<span class="hljs-string">"http://<span class="hljs-variable">$_</span>"</span>} | <span class="hljs-built_in">Out-String</span>)
<span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$domains</span>
<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">"Service domain: http://%ServiceDomain%"</span>
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">الأخطبوط: النتائج</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
عملية البناء بأكملها هي كما يلي:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">يتم جمع الكود من فرع معين (المقابل للبيئة) ؛</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تعطى نتيجة التجميع (القطع الأثرية) للأخطبوط وتتكون من جزأين: النواة وحزمة وحدة فردية. </font><font style="vertical-align: inherit;">وهذا يسمح بالاستخدام الفعال لمساحة القرص ويوفر وقت تسليم التحديث بشكل عام.&nbsp;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تحتوي كل حزمة على إصدار يتكون من رقم وعلامة ما قبل الإصدار التي تحدد القناة والبيئة التي سيقع فيها هذا الإصدار.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">تقوم Octopus ، من خلال الإدخال ، بإنشاء إصدار وتسليم حزم إلى الخوادم المناسبة ، مسترشدة ببيانات المؤسسة (علامات المستأجر) ، والقنوات (علامة ما قبل الإصدار) وإرشادات إضافية (نسخة احتياطية اختيارية لقاعدة البيانات) ، كما تقوم بإجراء فحص أولي لأداء الوحدة.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
هذا نوع من ذلك القبيل. </font><font style="vertical-align: inherit;">على الأرجح ، سيكون هناك مقال آخر شبه تقني ، إذا جاز التعبير ، خلف الكواليس. </font><font style="vertical-align: inherit;">سيشمل كل ما لم يدخل هنا: بعض التفاصيل ، ما أصبح جديدًا في عملية العمل وما قد يتعين عليك مواجهته بالنسبة لأولئك الذين يقررون ذلك ، والتصحيحات والتحديثات على المشروع ، وربما أسئلة / إجابات متكررة. </font><font style="vertical-align: inherit;">شكرا للانتباه.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar497098/index.html">كيف صنعنا أول طيار آلي لحصاد مشترك في تحليلات الفيديو في العالم</a></li>
<li><a href="../ar497100/index.html">إطلاق كوكب المشتري في المدار LXD</a></li>
<li><a href="../ar497106/index.html">البرنامج التعليمي لمحاكاة الشبكات NS-3. الفصول 1.2</a></li>
<li><a href="../ar497108/index.html">Fighting Covid-2019: The Great Turn يأتي</a></li>
<li><a href="../ar497110/index.html">هل أحتاج إلى التمثيل الصوتي لمقاطع الفيديو حول الألعاب؟</a></li>
<li><a href="../ar497116/index.html">ستارسكي روبوتيكس الشاحنات غير المأهولة تنتهي</a></li>
<li><a href="../ar497118/index.html">[توقعات] هل ستنتهي جميع الشاحنات غير المأهولة أم ستارسكي روبوتكس فقط؟</a></li>
<li><a href="../ar497126/index.html">تقنيات تحديد النقاط المتراكمة وتحديد الأولويات</a></li>
<li><a href="../ar497132/index.html">#SaveFirst مبادرة لدعم المشاريع ذات الأهمية الاجتماعية</a></li>
<li><a href="../ar497136/index.html">"Save Concord" أو تقرير من اختبارات نظام الرادار الروسي للبحث عن أجسام غريبة على المدرج</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>