<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèº ü•† ‚¨úÔ∏è About storing JWT tokens in browsers üÜö ü•å ü§∞üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The JWT open standard officially appeared in 2015 ( rfc7519 ) promising interesting features and broad prospects. Proper storage of the Access token i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>About storing JWT tokens in browsers</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/502702/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/a6/oz/ut/a6ozutnu2esctapau7wo8-htm78.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The JWT open standard officially appeared in 2015 ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rfc7519</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) promising interesting features and broad prospects. </font><font style="vertical-align: inherit;">Proper storage of the Access token is vital for building an authorization and authentication system on the modern Web, where sites built using SPA technology are becoming more and more popular. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Incorrect storage of tokens leads to their theft and reuse by attackers.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So where to store?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Consider the main options for storing JWT Access token in a browser:</font></font><br>
<br>
<ol>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Local Storage / Session Storage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the method is not safe and is susceptible to attacks like XSS, especially if you connect scripts from third-party CDNs (adding the integrity attribute cannot guarantee 100% security), or you are not sure if the scripts you connect do not have the ability to "merge" data from storages to the side. </font><font style="vertical-align: inherit;">Moreover, if Local Storage is available between tabs, then Session Storage is available in only one tab and opening a site in a new tab will only cause a new round of access token / authorization.</font></font></li>
<li>               , ,   fetch      .         ‚Äì          .</li>
<li><b>Cookies</b>.      ¬´¬ª     cookie sessions.   Access   cookie   CSRF.       XSS .    CSRF    Cookie <b>SameSite </b>  <b>Strict</b>‚Äì       ,     ,     credentials,       CSRF . <br>
          ‚Äì Access     JS    <b>httpOnly</b>,  <b>Secure</b>      . <br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An important point is to set a cookie only for the domain / path api so that requests to public statics do not contain an overhead in the header.</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What is the result?</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cookies, when used correctly, are the appropriate and safest solution for storing the JWT Access token at the moment and must follow the following rules:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Be installed for the domain / path API to avoid overhead when requesting static files (public images / styles / js files).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secure</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> flag </font><font style="vertical-align: inherit;">(for transfer only via https).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Have the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">httpOnly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> flag </font><font style="vertical-align: inherit;">(for inability to access from JavaScript).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SameSite</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">must be </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strict</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to protect against CSRF attacks, prohibit the transfer of cookies if the transition to your API was not from the domain set in the cookie.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On the server side, it should also be configured:</font></font><br>
<br>
<ol>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Security-Policy</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - restrict trusted domains to prevent possible XSS attacks</font></font></li>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-Frame-Options</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> header </font><font style="vertical-align: inherit;">to protect against clickjacking attacks.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-XSS-Protection</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - force the built-in protection mechanism of the browser from XSS attacks.</font></font></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-Content-Type-Options</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - to protect against the substitution of MIME types.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compliance with these measures, coupled with frequent rotation of Access / Refresh tokens, should help ensure a high level of security on the site.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Limitations</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despite the fact that the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SameSite</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><b><font style="vertical-align: inherit;">is</font></b><font style="vertical-align: inherit;"> supported in many popular </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">browsers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , there are also browsers that do not support it or partially support it (hello IE and Safari for Mac). </font><font style="vertical-align: inherit;">For these cases, you need a fallback to CSRF tokens. </font><font style="vertical-align: inherit;">In this case, along with requests to the API, the CSRF token must also be transmitted. </font><font style="vertical-align: inherit;">The correct CSRF token must be generated by the server taking into account the </font><font style="vertical-align: inherit;">user's </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fingerprint</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in order to minimize the likelihood of its substitution.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en502682/index.html">Computer vision on Intel OWT WebRTC server with hardware acceleration</a></li>
<li><a href="../en502684/index.html">Why he: 5 questions for teachers at Ozon Go</a></li>
<li><a href="../en502686/index.html">RIT ++ 2020: consultations with Avito engineers at Zuma</a></li>
<li><a href="../en502696/index.html">How Internet Service Providers Avoid Global Blackout During Outbreaks</a></li>
<li><a href="../en502700/index.html">Stack Overflow creator: ‚ÄúDevelopers are the ones who write the script for the future‚Äù</a></li>
<li><a href="../en502704/index.html">How we retrained support to speak humanly, and what happened</a></li>
<li><a href="../en502706/index.html">The state of soft skills</a></li>
<li><a href="../en502712/index.html">How does an address led strip work?</a></li>
<li><a href="../en502714/index.html">Export OpenStreetMap data using visual editor on rete.js</a></li>
<li><a href="../en502716/index.html">Can't share your home computer? Make one out of two</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>