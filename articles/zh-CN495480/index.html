<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕝 ⚡️ 🕺🏻 使用SIP为C / C ++库创建Python绑定。第1部分 👨🏼‍🤝‍👨🏻 💑 ⚰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="有时，在使用Python处理项目时，希望使用不是用Python编写的库，而是使用C或C ++编写的库。原因可能有所不同：首先，Python是一种很棒的语言，但是在某些情况下它不够快。而且，如果您发现性能受到Python语言功能的限制，那么用另一种语言编写程序的一部分是有意义的（在本文中，我们将讨论C...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>使用SIP为C / C ++库创建Python绑定。第1部分</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495480/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时，在使用Python处理项目时，希望使用不是用Python编写的库，而是使用C或C ++编写的库。原因可能有所不同：首先，Python是一种很棒的语言，但是在某些情况下它不够快。而且，如果您发现性能受到Python语言功能的限制，那么用另一种语言编写程序的一部分是有意义的（在本文中，我们将讨论C和C ++），将程序的这一部分安排为一个库，进行Python绑定（Python绑定）并使用由此获得的模块作为普通的Python库。其次，当您知道有一个库可以解决所需的问题时，通常会发生这种情况，但是不幸的是，该库不是用Python编写的，而是用同一C或C ++编写的。在这种情况下，我们还可以在该库上进行Python绑定并使用它，而无需考虑该库最初不是用Python编写的。</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建Python绑定的工具有很多种，从较低级别的工具（例如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python / C API）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到较高级别的工具（如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SWIG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我的目标不是比较创建Python绑定的不同方法，但我想谈谈使用一种工具</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的基础知识</font><font style="vertical-align: inherit;">。最初，SIP旨在创建围绕Qt库</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PyQt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的绑定</font><font style="vertical-align: inherit;">，并且还用于开发其他大型Python库，例如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wxPython</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，gcc将用作C的编译器，而g ++将用作C ++编译器。</font><font style="vertical-align: inherit;">所有示例均在Arch Linux和Python 3.8下进行了测试。</font><font style="vertical-align: inherit;">为了不使示例复杂化，本文的范围不包括针对不同操作系统和使用不同编译器（例如Visual Studio）的编译主题。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
您可以从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">存储库</font></a><font style="vertical-align: inherit;">下载本文的所有示例</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
具有SIP源的存储库位于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.riverbankcomputing.com/hg/sip/</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Mercurial用作SIP的版本控制系统。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在C中对库进行绑定</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 用C语言编写一个库</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此示例位于</font><font style="vertical-align: inherit;">源代码</font><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">中，但是在本文中，我们将假定我们从头开始进行所有操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们从一个简单的例子开始。</font><font style="vertical-align: inherit;">首先，我们将创建一个简单的C库，然后将其从Python脚本运行。</font><font style="vertical-align: inherit;">让我们的库成为唯一的函数</font></font><br>
<br>
<pre><code class="plaintext hljs">int foo(char*);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
它将接受一个字符串，并返回其长度乘以2的长度</font><font style="vertical-align: inherit;">。例如，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
头文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能看起来像这样：</font></font><br>
<br>
<pre><code class="plaintext hljs">#ifndef FOO_LIB<font></font>
#define FOO_LIB<font></font>
<font></font>
int foo(char* str);<font></font>
<font></font>
#endif<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
并用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.cpp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行该文件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">#include &lt;string.h&gt;<font></font>
<font></font>
#include "foo.h"<font></font>
<font></font>
int foo(char* str) {<font></font>
	return strlen(str) * 2;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了测试库的功能，我们将编写一个简单的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">#include &lt;stdio.h&gt;<font></font>
<font></font>
#include "foo.h"<font></font>
<font></font>
int main(int argc, char* argv[]) {<font></font>
	char* str = "0123456789";<font></font>
	printf("%d\n", foo(str));<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了精确起见，创建一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Makefile</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">CC=gcc<font></font>
CFLAGS=-c<font></font>
DIR_OUT=bin<font></font>
<font></font>
all: main<font></font>
<font></font>
main: main.o libfoo.a<font></font>
	$(CC) $(DIR_OUT)/main.o -L$(DIR_OUT) -lfoo -o $(DIR_OUT)/main<font></font>
<font></font>
main.o: makedir main.c<font></font>
	$(CC) $(CFLAGS) main.c -o $(DIR_OUT)/main.o<font></font>
<font></font>
libfoo.a: makedir foo.c<font></font>
	$(CC) $(CFLAGS) foo.c -o $(DIR_OUT)/foo.o<font></font>
	ar rcs $(DIR_OUT)/libfoo.a $(DIR_OUT)/foo.o<font></font>
<font></font>
makedir:<font></font>
	mkdir -p $(DIR_OUT)<font></font>
<font></font>
clean:<font></font>
	rm -rf $(DIR_OUT)/*<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让库</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有源</font><font style="vertical-align: inherit;">都位于</font><font style="vertical-align: inherit;">源文件</font><font style="vertical-align: inherit;">夹中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的子</font><font style="vertical-align: inherit;">文件夹中：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
└──foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    └──Makefile</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们进入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">并使用以下命令编译源代码</font></font><br>
<br>
<pre><code class="bash hljs">make
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在编译过程中，将显示文本。</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p bin<font></font>
gcc -c main.c -o bin/main.o<font></font>
gcc -c foo.c -o bin/foo.o<font></font>
ar rcs bin/libfoo.a bin/foo.o<font></font>
gcc bin/main.o -Lbin -lfoo -o bin/main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译结果将放置在</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">夹</font><font style="vertical-align: inherit;">内的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">夹中</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
└──foo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──箱</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    │├──foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    │├──libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    │├──主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    │└──main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    ├──main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    └──Makefile</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们编译了一个用于静态链接的库，以及一个以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名的程序</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">编译后，您可以验证</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主程序</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否</font><font style="vertical-align: inherit;">启动。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们在foo库上进行Python绑定。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SIP基础</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，您需要安装SIP。</font><font style="vertical-align: inherit;">与使用pip的所有其他库一样，这是标准完成的操作：</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user sip
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
当然，如果您在虚拟环境中工作，则不应指定--user参数，该参数指示SIP库应安装在用户文件夹中，而不是全局安装在系统中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们需要怎么做才能从Python代码中调用foo库？至少需要创建两个文件：一个是TOML格式</font><font style="vertical-align: inherit;">的文件，并将其</font><font style="vertical-align: inherit;">命名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，另一个是扩展名为.sip的文件。让我们依次处理它们。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们需要就来源的结构达成共识。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">内部</font><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">，其中包含该库的源代码。编译后</font><font style="vertical-align: inherit;">，将</font><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中创建</font><i><font style="vertical-align: inherit;">bin</font></i><font style="vertical-align: inherit;">文件夹</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中将包含所有已编译的文件。</font><font style="vertical-align: inherit;">稍后，我们将为用户提供通过命令行指定库的头文件和目标文件的路径的功能。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SIP所需的文件将与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹位于同一文件夹中</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pyproject.toml</font></font></h4><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件</font><font style="vertical-align: inherit;">不是SIP开发人员的发明，而是Python项目描述格式，在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 517“源树的独立于构建系统的格式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 518“指定Python项目的最低构建系统要求”中描述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这是一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TOML文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以认为是ini格式的更高级版本，其中参数以“键=值”的形式存储，并且参数不仅可以位于[foo]之类的区域，在TOML术语中称为表，但以及[foo.bar.spam]形式的小节中。参数不仅可以包含字符串，还可以包含列表，数字和布尔值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该文件应该描述构建Python包所需的所有内容，而不必使用SIP。</font><font style="vertical-align: inherit;">但是，正如我们稍后看到的那样，在某些情况下，该文件不够用，此外，还需要创建一个小的Python脚本。</font><font style="vertical-align: inherit;">但是，让我们依次讨论所有内容。</font><font style="vertical-align: inherit;">可以</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">在SIP文档页面</font></a><font style="vertical-align: inherit;">上找到</font><i><font style="vertical-align: inherit;">pyproject.toml</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件</font><font style="vertical-align: inherit;">与SIP相关</font><font style="vertical-align: inherit;">的所有可能参数的完整说明</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
对于我们的示例，</font><font style="vertical-align: inherit;">在与</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">文件夹相同的级别上</font><i><font style="vertical-align: inherit;">创建pyproject.toml</font></i><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
├──富</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──箱</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││└──main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│└──Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
└──pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
的内容</font><font style="vertical-align: inherit;">如下：</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.1"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
include-dirs = ["foo"]<font></font>
library-dirs = ["foo/bin"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[build-system]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
部分</font><font style="vertical-align: inherit;">（TOML术语为“表”）是标准的，并在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 518中进行了</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它包含两个参数：</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">require-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成我们的软件包所需的软件包列表。</font><font style="vertical-align: inherit;">软件包依赖项描述格式在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 508 Python软件包的依赖项规范中进行了</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，我们只需要Sip软件包版本5.x。</font></font></li>
<li><i>build-backend</i> ,        .  ,          Python-,    .        ,   ,    SIP,     «sipbuild.api».</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
其他参数在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip。*]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节中介绍</font><font style="vertical-align: inherit;">。</font><i><font style="vertical-align: inherit;">[tool.sip.metadata]</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
部分</font><font style="vertical-align: inherit;">包含有关程序包的常规信息：要组装的程序包的名称（我们的程序包将称为</font><i><font style="vertical-align: inherit;">pyfoo</font></i><font style="vertical-align: inherit;">，但不要将此名称与模块的名称混淆，我们稍后将其导入Python中），程序包的版本号（在本例中为版本号“ 0.1”）和许可证（例如“ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">MIT</font></a><font style="vertical-align: inherit;"> ”）。</font><font style="vertical-align: inherit;">
从组装的角度来看，最重要的描述在[tool.sip.bindings中。</font><b><font style="vertical-align: inherit;">pyfoo</font></b><font style="vertical-align: inherit;"> ]。</font><font style="vertical-align: inherit;">
注意节标题中的软件包名称。</font><font style="vertical-align: inherit;">我们在本节中添加了两个参数：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">headers-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用foo库所需的头文件列表。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -为静态链接编译的目标文件列表。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是除附加到C编译器的头文件之外的其他头文件的路径，在这种情况下，是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的位置</font><font style="vertical-align: inherit;">。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是查找除C编译器附带的对象文件之外的其他目标文件的路径，在这种情况下，这</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是创建</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译的库文件</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">的文件夹</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们为SIP创建了第一个必需文件。</font><font style="vertical-align: inherit;">现在，我们继续创建下一个文件，该文件将描述未来的Python模块的内容。</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pyfoo.sip</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">相同的文件夹中</font><font style="vertical-align: inherit;">创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo_c_01 /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
├──富</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──箱</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││└──main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│└──Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
├──pyfoo.sip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
└──pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
扩展名为.sip的文件描述了源库的接口，该库将转换为Python中的模块。</font><font style="vertical-align: inherit;">该文件具有自己的格式，我们现在将考虑它，它类似于带有附加标记的C / C ++头文件，这应该有助于SIP创建Python模块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的示例中，此文件应称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为在此之前</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在</font><i><font style="vertical-align: inherit;">pyproject.toml</font></i><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">创建了[tool.sip.bindings。</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]。在一般情况下，可以有多个这样的分区，因此，必须有多个* .sip文件。但是，如果我们有多个sip文件，那么从SIP的角度来看这是一种特殊情况，因此在本文中我们将不予考虑。请注意，通常情况下，.sip文件的名称（以及相应的部分的名称）可能与包的名称不一致，该包的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[tool.sip.metadata]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">的</font><i><font style="vertical-align: inherit;">name</font></i><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
考虑以下</font><font style="vertical-align: inherit;">示例中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foo, language=<span class="hljs-string">"C"</span>)<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*)</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以字符“％”开头的行称为指令。他们应该告诉SIP如何正确组装和样式化Python模块。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文档页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上描述了指令的完整列表</font><font style="vertical-align: inherit;">。一些指令具有附加参数。可能不需要参数。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在此示例中，我们使用两个指令；在以下示例中，我们将了解其他一些指令。</font><i><font style="vertical-align: inherit;">pyfoo.sip</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
文件</font><font style="vertical-align: inherit;">以</font><i><font style="vertical-align: inherit;">％Module</font></i><font style="vertical-align: inherit;">指令</font><i><font style="vertical-align: inherit;">（名称= foo，语言=“ C”）</font></i><font style="vertical-align: inherit;">开头</font><font style="vertical-align: inherit;">。请注意，</font><font style="vertical-align: inherit;">我们指定的</font><font style="vertical-align: inherit;">第一个参数（</font><i><font style="vertical-align: inherit;">名称</font></i><font style="vertical-align: inherit;">）的值不带引号，而第二个参数的值（</font><i><font style="vertical-align: inherit;">语言</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）加上引号，例如C / C ++中的字符串。</font><font style="vertical-align: inherit;">如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％Module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令的文档中所述，这是该指令的要求</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％Module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令中，</font><font style="vertical-align: inherit;">仅需要</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">设置了将从中导入库函数的Python模块的名称。</font><font style="vertical-align: inherit;">在这种情况下，该模块称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将包含函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此在组装和安装后，我们将使用以下代码导入该模块：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们可以通过替换以下行来使该模块嵌套在另一个模块中：</font></font><br>
<br>
<pre><code class="cpp hljs">%Module(name=foo.bar, language=<span class="hljs-string">"C"</span>)<font></font>
...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
然后导入函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo将</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要如下所示：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> foo.bar <span class="hljs-keyword">import</span> foo
</code></pre><br><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">％Module</font></i><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">
的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">language</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">指示编写源库的语言。</font><font style="vertical-align: inherit;">此参数的值可以是“ C”或“ C ++”。</font><font style="vertical-align: inherit;">如果未指定此参数，则SIP将假定该库是用C ++编写的。</font><font style="vertical-align: inherit;">
现在来看</font><i><font style="vertical-align: inherit;">pyfoo.sip</font></i><font style="vertical-align: inherit;">文件的最后一行</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-keyword">char</span>*)</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是我们要放入Python模块中的库中函数接口的描述。</font><font style="vertical-align: inherit;">sip根据此声明创建一个Python函数。</font><font style="vertical-align: inherit;">我认为这里一切应该都清楚。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 我们收集并检查</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在一切准备就绪，可以为C库建立具有绑定的Python包了，首先，您需要构建库本身。</font><font style="vertical-align: inherit;">转到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01 / foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹，</font><font style="vertical-align: inherit;">并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始构建</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">$ make<font></font>
<font></font>
mkdir -p bin<font></font>
gcc -c main.c -o bin/main.o<font></font>
gcc -c foo.c -o bin/foo.o<font></font>
ar rcs bin/libfoo.a bin/foo.o<font></font>
gcc bin/main.o -Lbin -lfoo -o bin/main<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切顺利，则将在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">内</font><font style="vertical-align: inherit;">创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">，在其中，除其他文件外，还将有一个已编译的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libfoo.a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">让我提醒您，在这里，为了不偏离主要主题，我们仅在谈论使用gcc在Linux下进行构建。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
返回到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在是时候了解SIP团队了。</font><font style="vertical-align: inherit;">安装SIP之后，以下命令行命令将变为可用（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档页面</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">创建一个Python扩展对象文件。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">创建一个Python扩展对象文件并安装。</font></font></li>
<li><i>sip-sdist</i>.      .tar.gz,      pip.</li>
<li><i>sip-wheel</i>.     wheel (   .whl).</li>
<li><i>sip-module</i>.  ,      ,   SIP.  ,    ,    .         ,       standalone project,      ,     ,     ,    .</li>
<li><i>sip-distinfo</i>.     <i>.dist-info</i>,       wheel.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这些命令需要从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件所在的文件夹中运行</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，为了更好地理解SIP的操作，请运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（带有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--verbose</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项）</font><font style="vertical-align: inherit;">，以向控制台提供更详细的输出，并查看在构建过程中会发生什么。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build --verbose</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
将建立以下绑定：pyfoo。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成pyfoo绑定... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译'foo'模块... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
构建'foo'扩展名</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建build </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建build / temp.linux-x86_64-3.8</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =普通-O3-管道-fno-plt -march = x86-64 -mtune =普通-O3-管道-fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected =公用-I。 -I ../../ foo -I / usr / include / python3.8 -c sipfoocmodule.c -o build /temp.linux-x86_64-3.8/sipfoocmodule.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c：在func_foo函数中：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule .c：29：22：警告：隐式函数声明“ foo” [-Wimplicit-function-declaration] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 29 | sipRes = foo（a0）; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3-管道-fno-plt -march = x86-64 -mtune =通用-O3-管道-fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected =公用-I。 -I ../../ foo -I / usr / include / python3.8 -c array.c -o build / temp.linux-x86_64-3.8 / array.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I。 -I ../../ foo -I / usr / include / python3.8 -c bool.cpp -o build / temp.linux-x86_64-3.8 / bool.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3-管道-fno-plt -march = x86-64 -mtune =通用-O3-管道-fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected =公用-I。 -I ../../ foo -I / usr / include / python3.8 -c objmap.c -o build / temp.linux-x86_64-3.8 / objmap.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I。 -I ../../ foo -I / usr / include / python3.8 -c qtlib.c -o build / temp.linux-x86_64-3.8 / qtlib.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =普通-O3-管道-fno-plt -march = x86-64 -mtune =普通-O3-管道-fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected =公用-I。 -I ../../ foo -I / usr / include / python3.8 -c int_convertors.c -o build / temp.linux-x86_64-3.8 / int_convertors.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I。 -I ../../ foo -I / usr / include / python3.8 -c voidptr.c -o build / temp.linux-x86_64-3.8 / voidptr.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =普通-O3-管道-fno-plt -march = x86-64 -mtune =普通-O3-管道-fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected =公用-I。 -I ../../ foo -I / usr / include / python3.8 -c apiversions.c -o build / temp.linux-x86_64-3.8 / apiversions.o </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I。 -I ../../ foo -I / usr / include / python3.8 -c描述符.c -o build / temp.linux-x86_64-3.8 / descriptors.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gcc -pthread -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3-管道-fno-plt -march = x86-64 -mtune =通用-O3-管道-fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected =公用-I。 -I ../../ foo -I / usr / include / python3.8 -cthreads.c -o build / temp.linux-x86_64-3.8 / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
threads.o gcc -pthread -Wno-unused-result -Wsign -compare -DNDEBUG -g -fwrapv -O3 -Wall -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fno-semantic-interposition -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -march = x86-64 -mtune =通用-O3 -pipe -fno-plt -fPIC -DSIP_PROTECTED_IS_PUBLIC -Dprotected = public -I。 -I ../../ foo -I / usr / include / python3.8 -c siplib.c -o build / temp.linux-x86_64-3.8 / siplib.o</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：在函数“ slot_richcompare”中：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：9536：16：警告：在此函数中，“ st”可能无需初始化即可使用[-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9536 | slot = findSlotInClass（ctd，st）; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~~~~~~~~~~~~~~~~~~~~~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：10671：19：备注：“ st”在此处声明为</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10671 | sipPySlotType st; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
〜siplib.c：在函数“ parsePass2”中：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：5625：32：警告：在此函数中，可能没有初始化就使用“所有者” [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5625 | * owner = arg; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ~~~~~~~ ^〜</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
g ++ -pthread -shared -Wl，-O1，-sort-common，-按需，-z，relro，-z，现在-fno语义插入-Wl，-O1，-sort-common， -按需，-z，relro，-z现在构建/ temp.linux-x86_64-3.8 / sipfoocmodule.o build / temp.linux-x86_64-3.8 / array.o build / temp.linux-x86_64-3.8 /bool.o build / temp.linux-x86_64-3.8 / objmap.o build / temp.linux-x86_64-3.8 / qtlib.o build / temp.linux-x86_64-3.8 / int_convertors.o build / temp.linux-x86_64 -3.8 / voidptr.o build / temp.linux-x86_64-3.8 / apiversions.o build / temp.linux-x86_64-3.8 /描述符.o build / temp.linux-x86_64-3.8 / thread.o build / temp.linux -x86_64-3.8 / siplib.o -L ../../ foo / bin -L / usr / lib -lfoo -o / home / jenyay / projects / soft / sip-examples / pypy_c_01 / build / foo / foo。 cpython-38-x86_64-linux-gnu.so </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该项目已构建。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们不会深入研究SIP的工作，但是从输出中可以看出，一些源正在编译。</font><font style="vertical-align: inherit;">这些资源可以在此命令创建的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中看到</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
├──建筑</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│└──富</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──apiversions.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──array.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──array.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──bool.cpp</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──搭建</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││└──temp.linux-x86_64-3.8</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──apiversions.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──array.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──bool.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──descriptors.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──int_convertors.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──objmap.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──qtlib.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──sipfoocmodule.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──siplib.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──threads.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││└──voidptr.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──descriptors.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.cpython-38-x86_64-linux-gnu.so</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──int_convertors.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──objmap.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──qtlib.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──sipAPIfoo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──sipfoocmodule.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──sip.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──sipint.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──siplib.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──threads.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│└──voidptr.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
├──富</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──箱</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──foo.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──libfoo.a</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││├──主要</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
││└──main.o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──foo.h</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│├──main.c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
│└──Makefile</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
├──pyfoo.sip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
└──pyproject.toml</font></font><font></font>
</pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助源出现</font><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于好奇，让我们看一下</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipfoocmodule.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，因为它直接与</font><font style="vertical-align: inherit;">将要创建</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块</font><font style="vertical-align: inherit;">有关：</font></font><br>
<br>
<pre><code class="plaintext hljs">/*<font></font>
 * Module code.<font></font>
 *<font></font>
 * Generated by SIP 5.1.1<font></font>
 */<font></font>
<font></font>
#include "sipAPIfoo.h"<font></font>
<font></font>
/* Define the strings used by this module. */<font></font>
const char sipStrings_foo[] = {<font></font>
    'f', 'o', 'o', 0,<font></font>
};<font></font>
<font></font>
PyDoc_STRVAR(doc_foo, "foo(str) -&gt; int");<font></font>
<font></font>
static PyObject *func_foo(PyObject *sipSelf,PyObject *sipArgs)<font></font>
{<font></font>
    PyObject *sipParseErr = SIP_NULLPTR;<font></font>
<font></font>
    {<font></font>
        char* a0;<font></font>
<font></font>
        if (sipParseArgs(&amp;sipParseErr, sipArgs, "s", &amp;a0))<font></font>
        {<font></font>
            int sipRes;<font></font>
<font></font>
            sipRes = foo(a0);<font></font>
<font></font>
            return PyLong_FromLong(sipRes);<font></font>
        }<font></font>
    }<font></font>
<font></font>
    /* Raise an exception if the arguments couldn't be parsed. */<font></font>
    sipNoFunction(sipParseErr, sipName_foo, doc_foo);<font></font>
<font></font>
    return SIP_NULLPTR;<font></font>
}<font></font>
<font></font>
/* This defines this module. */<font></font>
sipExportedModuleDef sipModuleAPI_foo = {<font></font>
    0,<font></font>
    SIP_ABI_MINOR_VERSION,<font></font>
    sipNameNr_foo,<font></font>
    0,<font></font>
    sipStrings_foo,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    0,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    {SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR,<font></font>
            SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR, SIP_NULLPTR},<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR,<font></font>
    SIP_NULLPTR<font></font>
};<font></font>
<font></font>
/* The SIP API and the APIs of any imported modules. */<font></font>
const sipAPIDef *sipAPI_foo;<font></font>
<font></font>
/* The Python module initialisation function. */<font></font>
#if defined(SIP_STATIC_MODULE)<font></font>
PyObject *PyInit_foo(void)<font></font>
#else<font></font>
PyMODINIT_FUNC PyInit_foo(void)<font></font>
#endif<font></font>
{<font></font>
    static PyMethodDef sip_methods[] = {<font></font>
        {sipName_foo, func_foo, METH_VARARGS, doc_foo},<font></font>
        {SIP_NULLPTR, SIP_NULLPTR, 0, SIP_NULLPTR}<font></font>
    };<font></font>
<font></font>
    static PyModuleDef sip_module_def = {<font></font>
        PyModuleDef_HEAD_INIT,<font></font>
        "foo",<font></font>
        SIP_NULLPTR,<font></font>
        -1,<font></font>
        sip_methods,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR,<font></font>
        SIP_NULLPTR<font></font>
    };<font></font>
<font></font>
    PyObject *sipModule, *sipModuleDict;<font></font>
    /* Initialise the module and get it's dictionary. */<font></font>
    if ((sipModule = PyModule_Create(&amp;sip_module_def)) == SIP_NULLPTR)<font></font>
        return SIP_NULLPTR;<font></font>
<font></font>
    sipModuleDict = PyModule_GetDict(sipModule);<font></font>
<font></font>
    if ((sipAPI_foo = sip_init_library(sipModuleDict)) == SIP_NULLPTR)<font></font>
        return SIP_NULLPTR;<font></font>
<font></font>
    /* Export the module and publish it's API. */<font></font>
    if (sipExportModule(&amp;sipModuleAPI_foo, SIP_ABI_MAJOR_VERSION, SIP_ABI_MINOR_VERSION, 0) &lt; 0)<font></font>
    {<font></font>
        Py_DECREF(sipModule);<font></font>
        return SIP_NULLPTR;<font></font>
    }<font></font>
    /* Initialise the module now all its dependencies have been set up. */<font></font>
    if (sipInitModule(&amp;sipModuleAPI_foo,sipModuleDict) &lt; 0)<font></font>
    {<font></font>
        Py_DECREF(sipModule);<font></font>
        return SIP_NULLPTR;<font></font>
    }<font></font>
<font></font>
    return sipModule;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果您使用Python / C API，则会看到熟悉的功能。请特别注意</font><font style="vertical-align: inherit;">从第18行开始</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">func_foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译这些源代码后，将创建文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build / foo / foo.cpython-38-x86_64-linux-gnu.so</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含Python扩展名，仍然需要正确安装。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了编译扩展并立即安装，您可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">，但我们不会使用它，因为默认情况下，它会尝试将创建的Python扩展全局安装到系统中。该命令具有参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--target-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以使用它指定要安装扩展的路径，但是我们最好使用其他创建软件包的工具，然后可以使用pip进行安装。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用它非常简单：</font></font><br>
<br>
<pre><code class="bash hljs">$ sip-sdist<font></font>
<font></font>
The sdist has been built.<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，将创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.1.tar.gz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，可以使用以下命令进行安装：</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user pyfoo-0.1.tar.gz
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，将显示以下信息并安装该软件包：</font></font><br>
<br>
<pre><code class="plaintext hljs">Processing ./pyfoo-0.1.tar.gz<font></font>
  Installing build dependencies ... done<font></font>
  Getting requirements to build wheel ... done<font></font>
    Preparing wheel metadata ... done<font></font>
Building wheels for collected packages: pyfoo<font></font>
  Building wheel for pyfoo (PEP 517) ... done<font></font>
  Created wheel for pyfoo: filename=pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl size=337289 sha256=762fc578...<font></font>
  Stored in directory: /home/jenyay/.cache/pip/wheels/54/dc/d8/cc534fff...<font></font>
Successfully built pyfoo<font></font>
Installing collected packages: pyfoo<font></font>
  Attempting uninstall: pyfoo<font></font>
    Found existing installation: pyfoo 0.1<font></font>
    Uninstalling pyfoo-0.1:<font></font>
      Successfully uninstalled pyfoo-0.1<font></font>
Successfully installed pyfoo-0.1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
确保我们成功建立了Python绑定。</font><font style="vertical-align: inherit;">我们启动Python并尝试调用该函数。</font><font style="vertical-align: inherit;">让我提醒您，根据我们的设置，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件包</font><font style="vertical-align: inherit;">包含</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">模块</font><font style="vertical-align: inherit;">具有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">b'123456'</span>)
<span class="hljs-number">12</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
请注意，作为函数的参数，我们不仅传递字符串，而且传递字节字符串b'123456'- </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与C </font><font style="vertical-align: inherit;">的直接相似</font><font style="vertical-align: inherit;">。稍后，我们将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的转换添加</font><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，反之亦然。结果是预期的。让我提醒您，函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型的数组的两倍大小，该数组</font><font style="vertical-align: inherit;">作为参数传递给它。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们尝试将</font><font style="vertical-align: inherit;">常规的Python字符串而不是字节列表</font><font style="vertical-align: inherit;">传递给</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">'123456'</span>)<font></font>
<font></font>
Traceback (most recent call last):<font></font>
  File <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<font></font>
TypeError: foo(str): argument <span class="hljs-number">1</span> has unexpected type <span class="hljs-string">'str'</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建的绑定无法将字符串转换为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；我们将在下一部分中讨论如何教它如何执行此操作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恭喜，我们在用C编写的库上进行了第一个绑定。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
退出Python解释器并以wheel格式组装程序集。如您最可能知道的那样，wheel是一种相对较新的软件包格式，最近已经普遍使用。该格式在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEP 427“ Wheel Binary Package Format 1.0”中进行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了描述，但是对wheel格式功能的描述是值得单独撰写的大型文章的主题。对我们而言，重要的是，用户可以使用pip轻松安装轮式包装。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
wheel格式的软件包并不比sdist格式的软件包复杂。为此，请在文件所在的文件夹中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要执行命令</font></font><br>
<br>
<pre><code class="bash hljs">sip-wheel
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
运行此命令后，将显示构建过程，并且编译器可能会发出警告：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
$ sip-wheel </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将构建以下绑定：pyfoo。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
生成pyfoo绑定... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译'foo'模块... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c：在func_foo函数中：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sipfoocmodule.c：29:22：警告：foo函数的隐式函数声明[-Wimplicit-function-declaration] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 29 | sipRes = foo（a0）; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：在功能“slot_richcompare”：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：9536：16：警告： “ST”可以在没有初始化在此函数中使用[-Wmaybe-未初始化] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9536 | slot = findSlotInClass（ctd，st）; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ ~~~~~~~~~~~~~~~~~~~~~~~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：10671：19：备注：“ st”在这里声明</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
10671 | sipPySlotType st; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ^ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
〜siplib.c：在函数“ parsePass2”中：</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
siplib.c：5625：32：警告：在此函数中可能未经初始化就使用了“所有者” [-Wmaybe-uninitialized] </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5625 | * owner = arg; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 | ~~~~~~~ ^ ^ ~~ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
轮子已经</font><font style="vertical-align: inherit;">盖好</font><font style="vertical-align: inherit;">了。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
组装完成后（我们的小型项目会快速编译），一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或类似</font><font style="vertical-align: inherit;">名称的文件将出现在项目文件夹中</font><font style="vertical-align: inherit;">。生成文件的名称可能会因您的操作系统和Python版本而异。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们可以使用pip安装此软件包：</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.1-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">--upgrade </font><font style="vertical-align: inherit;">选项</font><i><font style="vertical-align: inherit;">，</font></i><font style="vertical-align: inherit;">以便pip替换之前安装的pyfoo模块。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此外，</font><font style="vertical-align: inherit;">可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块</font><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包</font><font style="vertical-align: inherit;">，如上所述。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 将转换规则添加到char *</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在上一节中，我们遇到了一个问题，即</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">只能接受一组字节，而不能接受字符串。现在，我们将修复此缺陷。为此，我们将使用另一个SIP工具- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。批注在.sip文件中使用，并应用于一些代码元素：函数，类，函数自变量，异常，变量等。批注写在正斜杠之间：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/批注/</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注释可以用作标志，可以处于已设置或未设置的状态，例如：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ ReleaseGIL /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者某些注释需要分配一些值，例如：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Encoding =“ UTF-8” /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果需要将多个注释应用于某个对象，则将它们用斜杠内的逗号分隔：/批注_1，批注_2 /。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在以下示例（位于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中）中</font><font style="vertical-align: inherit;">，添加文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释参数函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module(name=foo, language="C")<font></font>
<font></font>
int foo(char* /Encoding="UTF-8"/);<font></font>
</code></pre><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
注释</font><font style="vertical-align: inherit;">指示应以哪种编码方式编码要传递给函数的字符串。此注释的值可以是：ASCII，Latin-1，UTF-8或无。如果</font><font style="vertical-align: inherit;">未指定</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批注</font><font style="vertical-align: inherit;">或等于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该函数的参数将不进行任何编码，并按原样传递给该函数，但在这种情况下，Python代码中的参数必须为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bytes</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">，即如上例所示，它是字节数组。如果指定了编码，则此参数可以是字符串（</font><font style="vertical-align: inherit;">Python中的</font><font style="vertical-align: inherit;">类型为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">只能应用于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">const char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
让我们检查</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">模块中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数现在如何工作</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为此，与以前一样，您必须首先通过</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">文件夹内调用</font><i><font style="vertical-align: inherit;">make</font></i><font style="vertical-align: inherit;">命令来</font><font style="vertical-align: inherit;">编译</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">，然后从</font><i><font style="vertical-align: inherit;">pyfoo_c_02</font></i><font style="vertical-align: inherit;"> example文件夹中</font><font style="vertical-align: inherit;">调用该命令，例如</font><i><font style="vertical-align: inherit;">sip-wheel</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">将创建文件</font><i><font style="vertical-align: inherit;">pyfoo-0.2-cp38-cp38-manylinux1_x86_64.whl</font></i><font style="vertical-align: inherit;">或具有类似名称的文件，可以使用以下命令进行设置：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.2-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果一切顺利，请启动Python解释器，然后尝试</font><font style="vertical-align: inherit;">使用字符串参数</font><font style="vertical-align: inherit;">调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> foo <span class="hljs-keyword">import</span> foo<font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">b'qwerty'</span>)
<span class="hljs-number">12</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">'qwerty'</span>)
<span class="hljs-number">12</span><font></font>
<font></font>
<span class="hljs-meta">&gt;&gt;&gt; </span>foo(<span class="hljs-string">''</span>)
<span class="hljs-number">24</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们确保</font><font style="vertical-align: inherit;">仍然可以</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。之后，我们确保现在也可以将</font><font style="vertical-align: inherit;">字符串参数</font><font style="vertical-align: inherit;">传递给</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。请注意，</font><font style="vertical-align: inherit;">带有俄语字母的字符串参数</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">返回的值是仅包含拉丁字母的字符串的两倍。这发生，因为该函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不计算在字符字符串的长度（和双打它），但长度</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阵列</font><font style="vertical-align: inherit;">，并且由于以UTF-8编码俄语字母占据2个字节，所述的尺寸</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阵列</font><font style="vertical-align: inherit;">从转换后Python字符串的长度是原来的两倍。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
精细！我们用函数参数解决了问题</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是如果我们的库中有数十个或数百个这样的函数，您将必须为每个函数指定参数编码吗？通常，程序中使用的编码是相同的，并且没有不同功能表示不同编码的目的。在这种情况下，可以在SIP中指定默认编码，如果某些功能需要其他编码，则可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批注重新定义</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要默认设置功能参数的编码，请使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">。在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中的示例中显示了其用法</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了利用指令</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请更改文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，现在其内容如下：</font></font><br>
<br>
<pre><code class="plaintext hljs">%Module(name=foo, language="C")<font></font>
%DefaultEncoding "UTF-8"<font></font>
<font></font>
int foo(char*);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在，如果参数是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font><font style="vertical-align: inherit;">类型的函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">没有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">，则从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％DefaultEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令获取编码</font><font style="vertical-align: inherit;">，如果没有，则不执行转换，并且对于所有参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。</font><font style="vertical-align: inherit;">有必要传输的不是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而是</font><i><font style="vertical-align: inherit;">字节</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从一个示例</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><i><font style="vertical-align: inherit;">被</font></i><font style="vertical-align: inherit;">收集并以相同的方式验证为来自一个例子</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_02</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简要介绍project.py。</font><font style="vertical-align: inherit;">自动化组装</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
到目前为止，我们已经使用了两个实用程序文件来创建Python绑定</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo.sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。现在，我们将熟悉另一个这样的文件，该文件应该称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。使用此脚本，我们可以影响程序包的构建过程。让我们进行构建自动化。为了</font><font style="vertical-align: inherit;">从前面的部分中</font><font style="vertical-align: inherit;">收集示例</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_03</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您首先必须转到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">，使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处</font><i><font style="vertical-align: inherit;">进行</font></i><font style="vertical-align: inherit;">编译</font><font style="vertical-align: inherit;">，返回到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件所在的文件夹</font><i><font style="vertical-align: inherit;">，</font></i><font style="vertical-align: inherit;">然后才可以使用以下方法之一开始构建软件包</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip- *</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在我们的目标是确保在执行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">命令时</font></i><font style="vertical-align: inherit;">，首先启动</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-library的汇编</font><font style="vertical-align: inherit;">，然后再启动命令本身。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本节中创建的示例位于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源</font><font style="vertical-align: inherit;">文件夹中</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要更改构建过程，我们可以在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">声明一个类（文件名应该就是该类），该类派生自</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此类具有一些我们可以自行覆盖的方法。</font><font style="vertical-align: inherit;">当前，我们对以下方法感兴趣：</font></font><br>
<br>
<ul>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-build命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期间调用</font><font style="vertical-align: inherit;">。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-sdist命令时调用</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令时调用</font><font style="vertical-align: inherit;">。</font></font></li>
<li><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令时调用</font><font style="vertical-align: inherit;">。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也就是说，我们可以重新定义这些命令的行为。</font><font style="vertical-align: inherit;">严格来说，列出的方法在抽象类</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.AbstractProject</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中声明</font><font style="vertical-align: inherit;">，从中创建派生类</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建一个</font><font style="vertical-align: inherit;">具有以下内容</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> subprocess<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_build_foo</span>(<span class="hljs-params">self</span>):</span>
        cwd = os.path.abspath(<span class="hljs-string">'foo'</span>)<font></font>
        subprocess.run([<span class="hljs-string">'make'</span>], cwd=cwd, capture_output=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span><font></font>
        self._build_foo()<font></font>
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span><font></font>
        self._build_foo()<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们声明了</font><font style="vertical-align: inherit;">从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">派生的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><i><font style="vertical-align: inherit;">，</font></i><font style="vertical-align: inherit;">并在其中</font><i><font style="vertical-align: inherit;">定义了</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_sdist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。在所有这些方法中，在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_build_foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法之前，我们从基类中调用相同名称的方法</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">开始</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">文件夹中</font><font style="vertical-align: inherit;">执行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">
请注意，</font><i><font style="vertical-align: inherit;">build_sdist</font></i><font style="vertical-align: inherit;">和</font><i><font style="vertical-align: inherit;">build_wheel方法</font></i><font style="vertical-align: inherit;">应返回它们创建的文件的名称。这没有写在文档中，但是在SIP源中指出。</font><font style="vertical-align: inherit;">
现在我们不需要运行</font><i><font style="vertical-align: inherit;">make命令</font></i></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动构建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">，这将自动完成。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果现在在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_04</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中</font><font style="vertical-align: inherit;">运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">，</font><i><font style="vertical-align: inherit;">则会</font></i><font style="vertical-align: inherit;">根据您的操作系统和Python版本创建一个名为pyfoo-0.4-cp38-cp38-manylinux1_x86_64.whl的文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
可以使用以下命令安装此软件包：</font></font><br>
<br>
<pre><code class="bash hljs">pip install --user --upgrade pyfoo-0.4-cp38-cp38-manylinux1_x86_64.whl
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，您可以确保</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">模块</font><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">仍然有效。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 添加命令行选项以进行构建</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下示例位于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中</font><font style="vertical-align: inherit;">，并且该程序包的版本号为0.5（请参阅</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中的设置</font><font style="vertical-align: inherit;">）。本示例基于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">示例并进行</font></a><font style="vertical-align: inherit;">了一些更正。在此示例中，我们将重做我们的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，</font><font style="vertical-align: inherit;">并为构建添加新的命令行选项。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在我们的示例中，我们正在构建一个非常简单的库</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且在实际项目中，该库可能很大，因此将其包含在Python绑定项目的源代码中是没有意义的。让我提醒您，SIP最初是为诸如Qt之类的庞大库创建绑定的。当然，您可以说git的子模块可以帮助组织源代码，但这不是重点。假设该库可能不在具有绑定源的文件夹中。在这种情况下，就会出现一个问题，SIP收集器应在哪里查找库头文件和目标文件？在这种情况下，不同的用户可能有自己的放置库的方式。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要解决此问题，请在构建系统中添加两个新的命令行选项，您可以使用它们指定文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的路径</font><font style="vertical-align: inherit;">（参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo-include-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和库目标文件（参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo-library-dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。另外，我们将假设，如果未指定这些参数，则</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">仍与绑定源一起位于。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们需要再次创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，并在其中声明一个从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sipbuild.Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">派生的类</font><font style="vertical-align: inherit;">。让我们先看看</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件的新版本</font><font style="vertical-align: inherit;">，然后</font><font style="vertical-align: inherit;">看看</font><font style="vertical-align: inherit;">它是如何工作的。</font></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">import</span> os<font></font>
<font></font>
<span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Option, Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-string">"""        
       foo.
    """</span><font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_options</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-string">"""     . """</span><font></font>
<font></font>
        tools = [<span class="hljs-string">'build'</span>, <span class="hljs-string">'install'</span>, <span class="hljs-string">'sdist'</span>, <span class="hljs-string">'wheel'</span>]<font></font>
<font></font>
        <span class="hljs-comment">#   .</span><font></font>
        options = super().get_options()<font></font>
<font></font>
        <span class="hljs-comment">#   </span>
        inc_dir_option = Option(<span class="hljs-string">'foo_include_dir'</span>,<font></font>
                                help=<span class="hljs-string">"the directory containing foo.h"</span>,<font></font>
                                metavar=<span class="hljs-string">"DIR"</span>,<font></font>
                                default=os.path.abspath(<span class="hljs-string">'foo'</span>),<font></font>
                                tools=tools)<font></font>
        options.append(inc_dir_option)<font></font>
<font></font>
        lib_dir_option = Option(<span class="hljs-string">'foo_library_dir'</span>,<font></font>
                                help=<span class="hljs-string">"the directory containing the foo library"</span>,<font></font>
                                metavar=<span class="hljs-string">"DIR"</span>,<font></font>
                                default=os.path.abspath(<span class="hljs-string">'foo/bin'</span>),<font></font>
                                tools=tools)<font></font>
<font></font>
        options.append(lib_dir_option)<font></font>
<font></font>
        <span class="hljs-keyword">return</span> options<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_user_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        <span class="hljs-string">"""    . """</span><font></font>
<font></font>
        <span class="hljs-comment">#     </span><font></font>
        super().apply_user_defaults(tool)<font></font>
<font></font>
        <span class="hljs-comment">#  ,         </span><font></font>
        self.foo_include_dir = os.path.abspath(self.foo_include_dir)<font></font>
        self.foo_library_dir = os.path.abspath(self.foo_library_dir)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, tool</span>):</span>
        <span class="hljs-string">"""   . """</span><font></font>
<font></font>
        <span class="hljs-comment">#   pyfoo</span>
        <span class="hljs-comment"># (  pyproject.toml  [tool.sip.bindings.pyfoo])</span>
        foo_bindings = self.bindings[<span class="hljs-string">'pyfoo'</span>]<font></font>
<font></font>
        <span class="hljs-comment">#   include_dirs  </span>
        <span class="hljs-keyword">if</span> self.foo_include_dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            foo_bindings.include_dirs = [self.foo_include_dir]<font></font>
<font></font>
        <span class="hljs-comment">#   library_dirs  </span>
        <span class="hljs-keyword">if</span> self.foo_library_dir <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<font></font>
            foo_bindings.library_dirs = [self.foo_library_dir]<font></font>
<font></font>
        super().update(tool)<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们再次创建了</font><font style="vertical-align: inherit;">从</font><i><font style="vertical-align: inherit;">sipbuild.Project</font></i><font style="vertical-align: inherit;">派生</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">。在此示例中，禁用了</font><i><font style="vertical-align: inherit;">foo</font></i><font style="vertical-align: inherit;">库的自动汇编</font><font style="vertical-align: inherit;">，因为现在假定它可以在其他位置，并且在创建绑定时，头文件和目标文件应该已准备就绪。</font><font style="vertical-align: inherit;">
在</font><i><font style="vertical-align: inherit;">FooProject</font></i><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">中重新定义</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">三种方法：</font><i><font style="vertical-align: inherit;">get_options</font></i><font style="vertical-align: inherit;">，</font><i><font style="vertical-align: inherit;">apply_user_defaults</font></i><font style="vertical-align: inherit;">和</font><i><font style="vertical-align: inherit;">update</font></i><font style="vertical-align: inherit;">。仔细考虑它们。</font><font style="vertical-align: inherit;">
让我们从</font><i><font style="vertical-align: inherit;">get_options</font></i><font style="vertical-align: inherit;">方法开始</font><font style="vertical-align: inherit;">。此方法应返回</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">sipbuild.Option</font></a><font style="vertical-align: inherit;">类的实例列表。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。每个列表项都是一个命令行选项。在覆盖的方法内部，我们</font><font style="vertical-align: inherit;">通过调用相同名称的基类方法来</font><font style="vertical-align: inherit;">获取默认</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的列表（</font><i><font style="vertical-align: inherit;">options</font></i><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">），然后创建两个新选项（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并将其添加到列表中，然后从函数中返回此列表。</font><i><font style="vertical-align: inherit;">Option</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
类的构造函数</font><font style="vertical-align: inherit;">接受一个必需的参数（选项名称）和足够多的可选参数，这些可选参数描述此参数的值的类型，默认值，参数描述等。本示例对</font><i><font style="vertical-align: inherit;">Option</font></i><font style="vertical-align: inherit;">构造函数使用以下选项</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<ul>
<li><i>help</i>   ,   ,     <i>sip-wheel -h</i></li>
<li><i>metavar</i> —  ,    ,       .     <i>metavar</i>  «DIR»,   ,     — .</li>
<li><i>default</i> —     .    ,          ,   <i>foo</i>   ,      (    ).</li>
<li><i>tools</i> —  ,        .        <i>sip-build</i>, <i>sip-install</i>, <i>sip-sdist</i>  <i>sip-wheel</i>,  tools = ['build', 'install', 'sdist', 'wheel'].</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
以下重载的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">旨在设置用户可以通过命令行传递的参数值。所述</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">从基类创建一个</font><font style="vertical-align: inherit;">变量（类部件）</font><font style="vertical-align: inherit;">用于在所创建的每个命令行参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，因此，使用创建的变量，使得使用命令行参数创建的所有变量被创建并使用默认值初始化之前调用同一名称的基类的方法是很重要的。之后，在我们的示例中，将创建变量</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果用户尚未指定相应的命令行参数，则它们将根据</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的构造函数的</font><font style="vertical-align: inherit;">参数（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">采用默认值</font><font style="vertical-align: inherit;">。如果</font><font style="vertical-align: inherit;">未设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">，则根据期望参数值的类型，将其初始化为None或一个空列表或0。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法内部，</font><i><font style="vertical-align: inherit;">我们</font></i><font style="vertical-align: inherit;">确保变量</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的路径</font><font style="vertical-align: inherit;">始终是绝对的。这是必需的，因此它不依赖于程序集启动时工作文件夹的位置。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此类中的最后一个重载方法是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。当有必要将之前所做的更改应用于项目时，将调用此方法。例如，更改或添加</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中指定的参数</font><font style="vertical-align: inherit;">。在前面的示例中，我们</font><font style="vertical-align: inherit;">分别在</font><i><font style="vertical-align: inherit;">[tool.sip.bindings.pyfoo]</font></i><font style="vertical-align: inherit;">部分中</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">library-dirs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数设置头文件和目标文件的路径</font><font style="vertical-align: inherit;">。现在，我们将从</font><i><font style="vertical-align: inherit;">project.py</font></i><font style="vertical-align: inherit;">脚本中设置这些参数</font><font style="vertical-align: inherit;">，因此在</font><i><font style="vertical-align: inherit;">pyproject.toml</font></i><font style="vertical-align: inherit;">文件中，</font><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">删除这些参数：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.3"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在方法内部，</font><font style="vertical-align: inherit;">从字典</font><i><font style="vertical-align: inherit;">self.bindings</font></i><font style="vertical-align: inherit;">键控</font><i><font style="vertical-align: inherit;">pyfoo</font></i><font style="vertical-align: inherit;"> gat实例</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">sipbuild.Bindings </font></a></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font><font style="vertical-align: inherit;">。项名称对应于[tool.sip.bindings。</font><b><font style="vertical-align: inherit;">pyfoo</font></b><font style="vertical-align: inherit;">从] </font><i><font style="vertical-align: inherit;">pyproject.toml</font></i><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">，并将这样得到的类的实例描述了在本节中描述的设置。然后，为此类的成员</font><i><font style="vertical-align: inherit;">include_dirs</font></i><font style="vertical-align: inherit;">和</font><i><font style="vertical-align: inherit;">library_dirs</font></i><font style="vertical-align: inherit;">（成员名称与参数</font><i><font style="vertical-align: inherit;">include-dirs</font></i><font style="vertical-align: inherit;">和</font><i><font style="vertical-align: inherit;">library-dirs</font></i><font style="vertical-align: inherit;">对应，</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">用下划线代替的下划线）被分配了包含存储在成员</font><i><font style="vertical-align: inherit;">self.foo_include_dir</font></i><font style="vertical-align: inherit;">和</font><i><font style="vertical-align: inherit;">self.foo_library_dir</font></i><font style="vertical-align: inherit;">中的路径的列表。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在本示例中，出于准确性考虑，我们检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_include_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.foo_library_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">不等于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">None</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是在本示例中，由于创建的命令行参数具有默认值，因此始终满足此条件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我们准备了配置文件，以便在组装过程中可以指示头文件和目标文件的路径。让我们检查发生了什么。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，确保默认值有效。为此，请转到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05 / foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建库</font><font style="vertical-align: inherit;">，因为在此示例中我们禁用了自动库构建。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，转到文件夹</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">作为此命令的结果，将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建pyfoo-0.5-cp38-cp38-manylinux1_x86_64.whl文件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或具有类似名称的</font><i><font style="vertical-align: inherit;">文件</font></i><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
现在将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹移到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_05</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">夹</font><font style="vertical-align: inherit;">之外的某个位置，</font><i><font style="vertical-align: inherit;">然后</font></i><font style="vertical-align: inherit;">再次运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">结果，我们得到预期的错误，通知我们没有对象库文件：</font></font><br>
<br>
<pre><code class="plaintext hljs">usr/bin/ld:   -lfoo<font></font>
collect2: :  ld     1<font></font>
sip-wheel: Unable to compile the 'foo' module: command 'g++' failed with exit status 1<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，</font><font style="vertical-align: inherit;">使用新的命令行选项</font><font style="vertical-align: inherit;">运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br>
<br>
<pre><code class="bash hljs">sip-wheel --foo-include-dir <span class="hljs-string">".../foo"</span> --foo-library-dir <span class="hljs-string">".../foo/bin"</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
代替省略号，您需要指定将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">与组合库一起</font><font style="vertical-align: inherit;">移动到的文件夹的路径</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，程序集应成功创建.whl文件。</font><font style="vertical-align: inherit;">可以按照与前面各节相同的方式安装和测试创建的模块。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 从project.py检查调用方法的顺序</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将考虑的下一个示例非常简单；它将演示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的调用方法的顺序</font><font style="vertical-align: inherit;">，我们在上一节中对其进行了重载。为了了解何时可以初始化变量，这可能很有用。该示例位于</font><font style="vertical-align: inherit;">源存储库</font><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">中。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
此示例的本质是</font><font style="vertical-align: inherit;">重载我们之前</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">project.py</font></i><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FooProject</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类中</font><font style="vertical-align: inherit;">使用的所有方法，并向它们添加对</font><i><font style="vertical-align: inherit;">print</font></i><font style="vertical-align: inherit;">函数的调用</font><font style="vertical-align: inherit;">，这将显示其所在方法的名称：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<pre><code class="python hljs"><span class="hljs-keyword">from</span> sipbuild <span class="hljs-keyword">import</span> Project<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FooProject</span>(<span class="hljs-params">Project</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_options</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'get_options()'</span>)<font></font>
        options = super().get_options()<font></font>
        <span class="hljs-keyword">return</span> options<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_user_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'apply_user_defaults()'</span>)<font></font>
        super().apply_user_defaults(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_nonuser_defaults</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'apply_nonuser_defaults()'</span>)<font></font>
        super().apply_nonuser_defaults(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">self, tool</span>):</span>
        print(<span class="hljs-string">'update()'</span>)<font></font>
        super().update(tool)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'build()'</span>)<font></font>
        super().build()<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_sdist</span>(<span class="hljs-params">self, sdist_directory</span>):</span>
        print(<span class="hljs-string">'build_sdist()'</span>)
        <span class="hljs-keyword">return</span> super().build_sdist(sdist_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_wheel</span>(<span class="hljs-params">self, wheel_directory</span>):</span>
        print(<span class="hljs-string">'build_wheel()'</span>)
        <span class="hljs-keyword">return</span> super().build_wheel(wheel_directory)<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">install</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'install()'</span>)<font></font>
        super().install()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
细心的读者应该注意，除了以前使用的方法之外，在此示例中</font><font style="vertical-align: inherit;">，我们还没有讨论</font><font style="vertical-align: inherit;">过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults（）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。此方法建议为无法通过命令行参数更改的所有变量设置默认值。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><i><font style="vertical-align: inherit;">，</font></i><font style="vertical-align: inherit;">返回该库的显式路径：</font></font><br>
<br>
<pre><code class="plaintext hljs">[build-system]<font></font>
requires = ["sip &gt;=5, &lt;6"]<font></font>
build-backend = "sipbuild.api"<font></font>
<font></font>
[tool.sip.metadata]<font></font>
name = "pyfoo"<font></font>
version = "0.4"<font></font>
license = "MIT"<font></font>
<font></font>
[tool.sip.bindings.pyfoo]<font></font>
headers = ["foo.h"]<font></font>
libraries = ["foo"]<font></font>
include-dirs = ["foo"]<font></font>
library-dirs = ["foo/bin"]<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了使项目成功</font><font style="vertical-align: inherit;">构建</font><font style="vertical-align: inherit;">，您需要进入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处构建库</font><font style="vertical-align: inherit;">。之后，返回到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyfoo_c_06</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹</font><font style="vertical-align: inherit;">并运行例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sip-wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">。结果，如果放弃编译器警告，将显示以下文本：</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options（）</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults（）</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options（）</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options（）</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults（）</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options（）</font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">update（）</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
将创建以下绑定：pyfoo。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel（）</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
生成pyfoo绑定... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
编译'foo'模块... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
轮子已经构建。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
显示从我们</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件输出的粗线</font><font style="vertical-align: inherit;">。因此，我们看到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><i><font style="vertical-align: inherit;">已被</font></i><font style="vertical-align: inherit;">调用多次，如果要初始化从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">派生的类中的任何成员变量，则必须考虑这一点</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get_options</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">不是最佳选择。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这也是有用的记得</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><i><font style="vertical-align: inherit;">被</font></i><font style="vertical-align: inherit;">调用之前</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，即在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_user_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中</font><i><font style="vertical-align: inherit;">，</font></i><font style="vertical-align: inherit;">已经可以使用其值在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apply_nonuser_defaults</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中设置的变量</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
之后，将调用</font><i><font style="vertical-align: inherit;">update</font></i><font style="vertical-align: inherit;">方法</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，最后是直接负责组装的方法，在我们的例子中是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">build_wheel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结语至第一部分</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文中，我们开始研究SIP工具，该工具旨在为用C或C ++编写的库创建Python绑定。在本文的第一部分中，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们以为</font><font style="vertical-align: inherit;">用C编写的非常简单的库创建Python绑定的示例为例，研究了使用SIP的基础知识。</font><font style="vertical-align: inherit;">我们确定了创建与SIP一起使用所需的文件。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pyproject.toml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">包含有关软件包的信息（名称，版本号，许可证以及头文件和目标文件的路径）。使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，</font><font style="vertical-align: inherit;">您可以影响Python包的构建过程，例如，开始构建C库或让用户指定库的头文件和目标文件的位置。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在</font><i><font style="vertical-align: inherit;">* .sip</font></i><font style="vertical-align: inherit;">文件中</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述Python模块的接口，其中列出了模块中将包含的功能和类。</font><font style="vertical-align: inherit;">指令和注释用于</font><font style="vertical-align: inherit;">描述</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* .sip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中的接口</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在本文的第二部分中，我们将在用C ++编写的面向对象的库上创建绑定，并通过其示例，我们将研究对描述C ++类的接口有用的技术，同时我们还将为我们处理新的指令和注释。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
未完待续。</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 参考文献</font></font></h2><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文示例</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP主页</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP文档</font></font></a></li>
</ul></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN495468/index.html">价签识别算法，即使在数据收集终端上也可以使用</a></li>
<li><a href="../zh-CN495472/index.html">转向素食主义者并不能阻止人们感染像COVID-19这样的疾病</a></li>
<li><a href="../zh-CN495474/index.html">DataGrip 2020.1：启动配置，导出到Excel，在编辑器中显示结果等</a></li>
<li><a href="../zh-CN495476/index.html">为什么Atari DeepMind AI成功令人失望</a></li>
<li><a href="../zh-CN495478/index.html">大小数据测试仪：趋势，理论，我的故事</a></li>
<li><a href="../zh-CN495484/index.html">Unix管道的实现方式</a></li>
<li><a href="../zh-CN495486/index.html">机密数据的新威胁：Acronis全球调查结果</a></li>
<li><a href="../zh-CN495490/index.html">DUMP 2020会议的测试和质量检查部分，今年会有什么期望？剧透：一对止痛药和樱桃</a></li>
<li><a href="../zh-CN495492/index.html">虚幻引擎4 iOS游戏发行功能</a></li>
<li><a href="../zh-CN495494/index.html">使用一组自定义的计划规则创建另一个kube-scheduler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>