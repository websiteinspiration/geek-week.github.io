<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ—¯ï¸ ğŸ§›ğŸ½ Modules ES6 dans le navigateur: sont-ils prÃªts ou non? ğŸ‘¨ğŸ½â€ğŸ¨ ğŸ›€ğŸ¾ ğŸ‘©ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avez-vous entendu parler de l'utilisation des modules ES6 dans un navigateur? En fait, ce sont des modules ES6 ordinaires. Ils s'appliquent uniquement...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Modules ES6 dans le navigateur: sont-ils prÃªts ou non?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/492510/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avez-vous entendu parler de l'utilisation des modules ES6 dans un navigateur? </font><font style="vertical-align: inherit;">En fait, ce sont des modules ES6 ordinaires. </font><font style="vertical-align: inherit;">Ils s'appliquent uniquement au code destinÃ© aux navigateurs.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yl/q1/wl/ylq1wlx8jeaaomnc9kwintirrma.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si quelqu'un ne sait pas - c'est Ã  quoi cela ressemble. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a une page </font></font><code>index.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"index.mjs"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">&lt;!--     "module" --&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un fichier </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reprÃ©sentant un module connectÃ© Ã  la page:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { doSomething } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils.mjs'</span>;<font></font>
<font></font>
doSomething(<span class="hljs-string">'Make me a sandwich'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module, Ã  son tour, importe la fonction </font></font><code>doSomething</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du module </font></font><code>utils.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> doSomething = <span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'No.'</span>);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modules ES6 existent depuis de nombreuses annÃ©es. </font><font style="vertical-align: inherit;">Et peut-Ãªtre que vous songez Ã  les essayer. </font><font style="vertical-align: inherit;">Je les ai utilisÃ©s pendant environ un mois dans mon propre projet. </font><font style="vertical-align: inherit;">En mÃªme temps, je suis arrivÃ© Ã  la conclusion que ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suspence!</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã€ propos de la prise en charge du navigateur pour les modules</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de parler de ce que je comprends, je suggÃ¨re de jeter un oeil Ã  la prise en charge du navigateur pour les modules. </font><font style="vertical-align: inherit;">J'Ã©cris ce matÃ©riel dÃ©but 2020, donc le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niveau de support des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modules est assez impressionnant Ã  90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/484/cfd/9e6/484cfd9e669b731f483cfdd99a638777.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge des modules avec navigateurs selon caniuse.com,</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
je suis assez content de ces 90% (je ne prends pas en compte les besoins de 10% des utilisateurs), mÃªme si vous voudrez peut-Ãªtre Ãªtre plus responsable. </font><font style="vertical-align: inherit;">Mais, mÃªme en considÃ©rant cela, si votre projet n'est pas conÃ§u pour IE, UC ou Opera Mini, ce niveau de support signifie que prÃ¨s de 100% de votre public cible pourra travailler avec votre projet sans problÃ¨me. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certes, la prise en charge du navigateur pour les modules n'est qu'un dÃ©but. </font><font style="vertical-align: inherit;">Ici, je veux trouver la rÃ©ponse Ã  trois questions qui se sont posÃ©es au tout dÃ©but de mon parcours vers les modules:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation de modules dans les navigateurs prÃ©sente-t-elle des avantages?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et les inconvÃ©nients?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis sÃ»r que j'avais une troisiÃ¨me question, mais maintenant je ne m'en souviens plus.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons Ã§a ...</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quels sont les avantages d'utiliser des modules dans les navigateurs?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est du pur JavaScript! </font><font style="vertical-align: inherit;">Pas de pipeline de projet d'assemblage, pas de fichier de configuration Webpack de 400 lignes, pas de Babel, pas de plugins et de presets, et pas de modules supplÃ©mentaires de 45 npm. </font><font style="vertical-align: inherit;">Seulement vous et votre code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque chose de rafraÃ®chissant Ã  Ã©crire du code qui sera exÃ©cutÃ© dans le navigateur exactement sous la forme dans laquelle il a Ã©tÃ© crÃ©Ã©. </font><font style="vertical-align: inherit;">Cela peut nÃ©cessiter un peu plus d'efforts, mais le rÃ©sultat est trÃ¨s agrÃ©able. </font><font style="vertical-align: inherit;">Voici comment conduire une voiture avec une transmission manuelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc. </font><font style="vertical-align: inherit;">Les avantages des modules ES6 sont le JavaScript pur, c'est le manque d'assemblage, de configuration du projet et le rejet des dÃ©pendances devenues inutiles. </font><font style="vertical-align: inherit;">Quoi d'autre? </font><font style="vertical-align: inherit;">Y a-t-il autre chose? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Non, rien de plus.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quels sont les inconvÃ©nients de l'utilisation de modules dans les navigateurs?</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â–Comparaison des modules et des bundlers</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous pensez Ã  utiliser des modules ES6 dans un navigateur, vous devez rÃ©ellement choisir entre utiliser des modules et des bundlers comme Webpack, Parcel ou Rollup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez (probablement) utiliser les deux, mais en rÃ©alitÃ©, si vous prÃ©voyez d'exÃ©cuter le code via le bundler, il n'y a aucune raison d'utiliser la conception </font></font><code>&lt;script type="module"&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour charger les fichiers du bundle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, en supposant que quelqu'un envisage la possibilitÃ© d'utiliser des modules ES6 au lieu d'un bundler, voici ce qu'il devra abandonner:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minification du code fini.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FonctionnalitÃ©s JavaScript de pointe.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntaxe diffÃ©rente de la syntaxe JavaScript (React, TypeScript, etc.).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules NPM.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en cache</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinez plus en dÃ©tail les trois premiers paragraphes de cette liste.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â– Taille du fichier</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La taille de mon projet, qui utilise des modules, est de 34 Ko. Comme je n'utilise pas l'Ã©tape de construction du projet, le code transmis sur le rÃ©seau contient des noms de variables trÃ¨s longs; il contient de nombreux commentaires. De plus, il reprÃ©sente tout un tas de petits fichiers, ce qui n'est pas trÃ¨s bon en termes de compression de donnÃ©es. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si je mettais tout cela dans un paquet en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parcel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la taille de ce qui </font><font style="vertical-align: inherit;">se </font><font style="vertical-align: inherit;">passerait serait de 18 Ko. Ma calculatrice Casual Casio signale que c'est Â«environ la moitiÃ©Â» du code de projet dans lequel le bundler n'est pas utilisÃ©. Cela est dÃ» en partie au fait que Parcel minimise les fichiers, mais aussi parce que les matÃ©riaux avec cette approche sont mieux compressÃ©s Ã  l'aide de gzip.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La compression des donnÃ©es attire notre attention sur un autre problÃ¨me: la faÃ§on dont les fichiers sont organisÃ©s (dans le sens de la commoditÃ© du dÃ©veloppement) est directement transfÃ©rÃ©e Ã  la faÃ§on dont les fichiers sont transfÃ©rÃ©s sur le rÃ©seau. Et la faÃ§on dont les fichiers sont organisÃ©s pendant le dÃ©veloppement ne correspond pas nÃ©cessairement Ã  la faÃ§on dont vous souhaitez les voir sur le site. Par exemple, 150 modules (fichiers) peuvent avoir du sens lorsque vous travaillez sur un projet. Et les mÃªmes matÃ©riaux transfÃ©rÃ©s au navigateur peuvent Ãªtre justifiÃ©s pour s'organiser en 12 paquets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais expliquer cette idÃ©e. Je ne dis pas que l'utilisation de modules signifie que les fichiers ne peuvent pas Ãªtre regroupÃ©s et minifiÃ©s (le fait que cela ne puisse pas Ãªtre fait est une illusion). Je veux juste dire que cela n'a aucun sens de faire les deux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, voici une observation amusante. </font><font style="vertical-align: inherit;">Dans mon application, jusqu'Ã  ce que j'Ã©crive cette section, des modules Ã©taient utilisÃ©s (je souligne!). </font><font style="vertical-align: inherit;">J'ai installÃ© Parcel pour calculer la taille d'assemblage correcte. </font><font style="vertical-align: inherit;">Et maintenant, je ne vois aucune raison de revenir aux modules normaux. </font><font style="vertical-align: inherit;">Eh bien, n'est-ce pas intÃ©ressant!</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â–Vie sans transpilation</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au fil des ans, j'ai l'habitude d'utiliser les derniÃ¨res constructions de syntaxe JavaScript et le merveilleux outil Babel, qui les transforme en code que tous les navigateurs comprennent. Je m'y suis tellement habituÃ© que j'ai rarement au moins pensÃ© Ã  la prise en charge du navigateur (bien sÃ»r, Ã  l'exception de DOM et CSS). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand j'ai essayÃ© pour la premiÃ¨re fois </font></font><code>type=Â«moduleÂ»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, j'allais tout faire moi-mÃªme. Mon objectif Ã©tait de nouveaux navigateurs, donc j'ai pensÃ© que je pouvais utiliser du JavaScript moderne, auquel je suis habituÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais la rÃ©alitÃ© n'Ã©tait pas si rose. Essayez de rÃ©pondre aux questions suivantes rapidement et sans chercher nulle part. Est-ce que Edge prend en charge</font></font><code>flatMap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Safari prend-il en charge l'attribution destructive (objets et tableaux)? Chrome prend-il en charge les virgules aprÃ¨s les derniers arguments de la fonction? Firefox prend-il en charge l'exponentiation? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, j'ai dÃ» chercher des rÃ©ponses Ã  ces questions, effectuer des tests inter-navigateurs. Mais j'ai utilisÃ© tout cela pendant des siÃ¨cles. Dans toute application suffisamment grande, cela entraÃ®nerait trÃ¨s probablement des erreurs de production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie Ã©galement que je ne serai pas en mesure d'utiliser l'innovation JavaScript la plus remarquable depuis l'avÃ¨nement de la mÃ©thode de tableau </font></font><code>slice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opÃ©rateur de sÃ©quence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dit </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">facultatif</font></a><font style="vertical-align: inherit;"> . J'ai utilisÃ© des designs magiques comme</font></font><code>prop?.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">environ un mois (Ã  partir du moment oÃ¹ l'outil Create React App a commencÃ© Ã  les prendre en charge sans aucun paramÃ¨tre supplÃ©mentaire). </font><font style="vertical-align: inherit;">Mais c'est dÃ©jÃ  gÃªnant pour moi de travailler sans eux.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">â– Mise en cache des charges</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise en cache Ã©tait pour moi la plus grande pierre d'achoppement. En fait, le fait que la solution au problÃ¨me de mise en cache se soit avÃ©rÃ©e assez intÃ©ressante s'est avÃ©rÃ© Ãªtre la principale raison pour laquelle j'ai dÃ©cidÃ© d'Ã©crire ce matÃ©riel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous en Ãªtes sÃ»r, vous savez, lorsque les matÃ©riaux sont traitÃ©s Ã  l'aide d'un bundler, chacun des fichiers rÃ©sultants obtient un nom unique - en quelque sorte </font></font><code>index.38fd9e.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le contenu d'un fichier portant ce nom ne change jamais (jamais). Par consÃ©quent, il peut Ãªtre mis en cache par le navigateur pour une durÃ©e illimitÃ©e. Si un tel fichier est tÃ©lÃ©chargÃ© une fois, vous n'aurez pas Ã  le tÃ©lÃ©charger Ã  nouveau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est un systÃ¨me incroyable - Ã  moins que vous n'essayiez de trouver la rÃ©ponse Ã  la question de savoir comment vider le cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modules sont chargÃ©s en utilisant une conception comme</font></font><code>&lt;script type="module" src="index.mjs"&gt;&lt;/script&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le hachage du nom de fichier n'est pas utilisÃ©. </font><font style="vertical-align: inherit;">Comment, dans cette situation, est-il censÃ© informer le navigateur de l'endroit oÃ¹ le tÃ©lÃ©charger </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ã  partir du cache ou du rÃ©seau? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter qu'il est presque possible de rendre le cache acceptable, mais cela prendra un certain effort. </font><font style="vertical-align: inherit;">Voici ce dont vous avez besoin pour cela:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez dÃ©finir le titre de toutes les rÃ©ponses </font></font><code>cache-control</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur une valeur </font></font><code>no-cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Incroyablement, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas de cache</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne signifie pas Â«ne pas mettre en cacheÂ». </font><font style="vertical-align: inherit;">Cela signifie que le fichier doit Ãªtre mis en cache, mais le fichier ne doit pas Ãªtre Â«utilisÃ© pour satisfaire une demande ultÃ©rieure sans vÃ©rification rÃ©ussie sur le serveur sourceÂ».</font></font></li>
<li>    ETag.    â€”  ()   , ,   ,    .  , <code>38fd9e</code>      .</li>
<li>   CDN-  ,   .     ETag       .     .   CDN-   .       (     ETag)      . (, ,     Firebase).</li>
<li>  -,    ,  Â«  Â»  .        ,     ,  ,  ,    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par consÃ©quent, lorsqu'un visiteur revisite le site, le navigateur dit: Â«Je dois tÃ©lÃ©charger le fichier </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je vois que ce fichier existe dÃ©jÃ  dans mon cache, son ETag l'est </font></font><code>38fd9e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je vais demander ce fichier au serveur, mais je lui dirai de me l'envoyer uniquement si son ETag ne l'est pas </font></font><code>38fd9e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. " Le technicien interceptera cette demande, ignorera ETag et la renverra </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de son cache (ce fichier est entrÃ© dans le cache lors du dernier chargement de la page). L'agent de service redirige ensuite la demande vers le serveur. Le serveur renverra soit un message indiquant que le fichier n'a pas changÃ©, soit un fichier qui sera stockÃ© dans le cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ã€ mon avis, tout cela est trÃ¨s gÃªnant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, si vous Ãªtes intÃ©ressÃ©, le code du technicien de service:</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">'fetch'</span>, e =&gt; {<font></font>
&nbsp;&nbsp;e.respondWith(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//       </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> cacheResponse = <span class="hljs-keyword">await</span> caches.match(e.request);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//   (),   </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// (ETag-    )</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch(e.request).then(<span class="hljs-function"><span class="hljs-params">fetchResponse</span> =&gt;</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caches<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.open(CACHE_NAME)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> cache.put(e.request, fetchResponse));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (cacheResponse) <span class="hljs-keyword">return</span> cacheResponse;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> fetch(e.request);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;})()<font></font>
&nbsp;&nbsp;);<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'Ã©tais paresseux, donc je n'ai pas Ã©tudiÃ© et n'ai pas utilisÃ© la derniÃ¨re propriÃ©tÃ© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FetchEvent.navigationPreload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le fait est qu'Ã  ce moment-lÃ , j'ai passÃ© plus de temps Ã  mettre en cache qu'Ã  Ã©crire une application (pour votre information, j'ai passÃ© 10 et 11 heures sur ces questions, respectivement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, je tiens Ã  noter que la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proposition de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â«carte d'importationÂ» vise Ã  rÃ©soudre certains des problÃ¨mes dÃ©crits ci-dessus. Il vous permet d'organiser quelque chose comme le mappage </font></font><code>index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur </font></font><code>index.38fd9e.mj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s. Mais pour gÃ©nÃ©rer un hachage, de toute faÃ§on, vous avez besoin d'une sorte de pipeline d'assemblage, les cartes d'importation devront Ãªtre incorporÃ©es dans le fichier HTML. Cela signifie qu'un bundler est nÃ©cessaire ici ... En fait, dans cette situation, les modules ne sont plus nÃ©cessaires dans le navigateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En consÃ©quence, bien qu'il soit intÃ©ressant de comprendre tout cela, cela peut Ãªtre comparÃ© Ã  la faÃ§on dont j'ai conduit partout sur un monocycle pendant une annÃ©e entiÃ¨re. </font><font style="vertical-align: inherit;">Je ne ferai plus Ã§a.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais probablement tout le monde n'utilise pas de bundlers?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai Ã©crit ce matÃ©riel en supposant que tout le monde Ã©crit du code dans des modules, en utilisant des constructions </font></font><code>import/export</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis en collectant le code dans des bundles de production en utilisant Webpack, Grunt, Gulp ou quelque chose comme Ã§a. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y a-t-il des dÃ©veloppeurs qui n'utilisent pas de bundles? </font><font style="vertical-align: inherit;">Y a-t-il quelqu'un qui place son code JavaScript dans plusieurs fichiers et l'envoie en production sans regroupement? </font><font style="vertical-align: inherit;">Peut-Ãªtre que l'une de ces personnes est toi? </font><font style="vertical-align: inherit;">Si oui, je voudrais tout savoir sur ta vie.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'efforce de prendre toutes les dÃ©cisions sÃ©rieuses, telles que le choix entre les modules et les bundlers, sur la base des grands principes d'un dÃ©veloppement efficace. C'est la productivitÃ© et la qualitÃ©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, l'utilisation de modules dans les navigateurs ne contribue ni Ã  l'un ni Ã  l'autre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si demain je commence Ã  travailler sur un nouveau projet, alors dans ma tÃªte je n'aurai pas de question sur l'opportunitÃ© d'exÃ©cuter la bonne vieille application create-react. Tous les paramÃ¨tres initiaux prendront environ trente secondes, et bien que la taille initiale du projet de 40 Ko soit un peu grande, pour la plupart des sites, cela ne jouera aucun rÃ´le.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici une situation diffÃ©rente. Supposons que je devrais rassembler un peu de HTML / CSS et JavaScript pour une sorte d'expÃ©rience, et une telle expÃ©rience serait un projet qui inclurait un peu plus de fichiers que Â«quelques-unsÂ». Si, en travaillant sur ce projet, je n'avais pas prÃ©vu de passer du temps Ã  configurer le systÃ¨me pour le construire, alors j'utiliserais probablement les modules dans le navigateur. Et puis - si je ne me souciais pas de la performance de ce projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je serais intÃ©ressÃ© de savoir comment Webpack et ses outils associÃ©s fonctionnent avec les modules ES6 dans un navigateur. Je pense qu'Ã  l'avenir, lorsque la proposition de Â«cartes d'importationÂ» recevra un soutien suffisant, les bundlers les utiliseront probablement comme un mÃ©canisme pour rÃ©sumer les hachages disgracieux qui sont utilisÃ©s aujourd'hui.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avez-vous utilisÃ© des modules ES6 dans votre navigateur?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492500/index.html">Garage scientifique en russe. ExpÃ©rience de traduction d'un spectacle amÃ©ricain</a></li>
<li><a href="../fr492502/index.html">MIP * = RE: preuve historique du domaine de l'informatique qui a provoquÃ© l'effet domino en physique et en mathÃ©matiques</a></li>
<li><a href="../fr492504/index.html">Que se passe-t-il lorsqu'un module JS est importÃ© deux fois?</a></li>
<li><a href="../fr492506/index.html">3 faÃ§ons de rendre de grandes listes en angulaire</a></li>
<li><a href="../fr492508/index.html">RÃ©servez Kubernetes pour DevOps</a></li>
<li><a href="../fr492512/index.html">CSS: aventures au pays de la transluciditÃ©</a></li>
<li><a href="../fr492514/index.html">Comment Ã©tablir un flux de documents Ã©lectroniques juridiquement significatif des contreparties en Russie et au Kazakhstan?</a></li>
<li><a href="../fr492518/index.html">L'Ã©pidÃ©mie de virus nÃ©cessite un travail Ã  distance, ce qui signifie la signature numÃ©rique des documents</a></li>
<li><a href="../fr492520/index.html">ModÃ©lisation 3D paramÃ©trÃ©e de la cuvette de roulement dans nanoCAD Plus 20</a></li>
<li><a href="../fr492522/index.html">Communication d'Ã©quipe Ã  distance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>