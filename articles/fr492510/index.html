<!doctype html>
<html class="no-js" lang="fr">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍🤝‍👨🏻 🗯️ 🧛🏽 Modules ES6 dans le navigateur: sont-ils prêts ou non? 👨🏽‍🎨 🛀🏾 👩🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avez-vous entendu parler de l'utilisation des modules ES6 dans un navigateur? En fait, ce sont des modules ES6 ordinaires. Ils s'appliquent uniquement...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Modules ES6 dans le navigateur: sont-ils prêts ou non?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/492510/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avez-vous entendu parler de l'utilisation des modules ES6 dans un navigateur? </font><font style="vertical-align: inherit;">En fait, ce sont des modules ES6 ordinaires. </font><font style="vertical-align: inherit;">Ils s'appliquent uniquement au code destiné aux navigateurs.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yl/q1/wl/ylq1wlx8jeaaomnc9kwintirrma.jpeg"></a><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si quelqu'un ne sait pas - c'est à quoi cela ressemble. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a une page </font></font><code>index.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><font></font>
&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"index.mjs"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">&lt;!--     "module" --&gt;</span>
&nbsp;&nbsp;<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il existe un fichier </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">représentant un module connecté à la page:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">import</span> { doSomething } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils.mjs'</span>;<font></font>
<font></font>
doSomething(<span class="hljs-string">'Make me a sandwich'</span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce module, à son tour, importe la fonction </font></font><code>doSomething</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du module </font></font><code>utils.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<br>
<pre><code class="javascript hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> doSomething = <span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
&nbsp;&nbsp;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'No.'</span>);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modules ES6 existent depuis de nombreuses années. </font><font style="vertical-align: inherit;">Et peut-être que vous songez à les essayer. </font><font style="vertical-align: inherit;">Je les ai utilisés pendant environ un mois dans mon propre projet. </font><font style="vertical-align: inherit;">En même temps, je suis arrivé à la conclusion que ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Suspence!</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">À propos de la prise en charge du navigateur pour les modules</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant de parler de ce que je comprends, je suggère de jeter un oeil à la prise en charge du navigateur pour les modules. </font><font style="vertical-align: inherit;">J'écris ce matériel début 2020, donc le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">niveau de support des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modules est assez impressionnant à 90%.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/484/cfd/9e6/484cfd9e669b731f483cfdd99a638777.png"></div><br>
<i><font color="#999999"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge des modules avec navigateurs selon caniuse.com,</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
je suis assez content de ces 90% (je ne prends pas en compte les besoins de 10% des utilisateurs), même si vous voudrez peut-être être plus responsable. </font><font style="vertical-align: inherit;">Mais, même en considérant cela, si votre projet n'est pas conçu pour IE, UC ou Opera Mini, ce niveau de support signifie que près de 100% de votre public cible pourra travailler avec votre projet sans problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certes, la prise en charge du navigateur pour les modules n'est qu'un début. </font><font style="vertical-align: inherit;">Ici, je veux trouver la réponse à trois questions qui se sont posées au tout début de mon parcours vers les modules:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation de modules dans les navigateurs présente-t-elle des avantages?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et les inconvénients?</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis sûr que j'avais une troisième question, mais maintenant je ne m'en souviens plus.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons ça ...</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quels sont les avantages d'utiliser des modules dans les navigateurs?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est du pur JavaScript! </font><font style="vertical-align: inherit;">Pas de pipeline de projet d'assemblage, pas de fichier de configuration Webpack de 400 lignes, pas de Babel, pas de plugins et de presets, et pas de modules supplémentaires de 45 npm. </font><font style="vertical-align: inherit;">Seulement vous et votre code. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a quelque chose de rafraîchissant à écrire du code qui sera exécuté dans le navigateur exactement sous la forme dans laquelle il a été créé. </font><font style="vertical-align: inherit;">Cela peut nécessiter un peu plus d'efforts, mais le résultat est très agréable. </font><font style="vertical-align: inherit;">Voici comment conduire une voiture avec une transmission manuelle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc. </font><font style="vertical-align: inherit;">Les avantages des modules ES6 sont le JavaScript pur, c'est le manque d'assemblage, de configuration du projet et le rejet des dépendances devenues inutiles. </font><font style="vertical-align: inherit;">Quoi d'autre? </font><font style="vertical-align: inherit;">Y a-t-il autre chose? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Non, rien de plus.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quels sont les inconvénients de l'utilisation de modules dans les navigateurs?</font></font></font></h2><br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Comparaison des modules et des bundlers</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque vous pensez à utiliser des modules ES6 dans un navigateur, vous devez réellement choisir entre utiliser des modules et des bundlers comme Webpack, Parcel ou Rollup. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez (probablement) utiliser les deux, mais en réalité, si vous prévoyez d'exécuter le code via le bundler, il n'y a aucune raison d'utiliser la conception </font></font><code>&lt;script type="module"&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour charger les fichiers du bundle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, en supposant que quelqu'un envisage la possibilité d'utiliser des modules ES6 au lieu d'un bundler, voici ce qu'il devra abandonner:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minification du code fini.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctionnalités JavaScript de pointe.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Syntaxe différente de la syntaxe JavaScript (React, TypeScript, etc.).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules NPM.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mise en cache</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Examinez plus en détail les trois premiers paragraphes de cette liste.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Taille du fichier</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La taille de mon projet, qui utilise des modules, est de 34 Ko. Comme je n'utilise pas l'étape de construction du projet, le code transmis sur le réseau contient des noms de variables très longs; il contient de nombreux commentaires. De plus, il représente tout un tas de petits fichiers, ce qui n'est pas très bon en termes de compression de données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si je mettais tout cela dans un paquet en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parcel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , la taille de ce qui </font><font style="vertical-align: inherit;">se </font><font style="vertical-align: inherit;">passerait serait de 18 Ko. Ma calculatrice Casual Casio signale que c'est «environ la moitié» du code de projet dans lequel le bundler n'est pas utilisé. Cela est dû en partie au fait que Parcel minimise les fichiers, mais aussi parce que les matériaux avec cette approche sont mieux compressés à l'aide de gzip.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La compression des données attire notre attention sur un autre problème: la façon dont les fichiers sont organisés (dans le sens de la commodité du développement) est directement transférée à la façon dont les fichiers sont transférés sur le réseau. Et la façon dont les fichiers sont organisés pendant le développement ne correspond pas nécessairement à la façon dont vous souhaitez les voir sur le site. Par exemple, 150 modules (fichiers) peuvent avoir du sens lorsque vous travaillez sur un projet. Et les mêmes matériaux transférés au navigateur peuvent être justifiés pour s'organiser en 12 paquets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je vais expliquer cette idée. Je ne dis pas que l'utilisation de modules signifie que les fichiers ne peuvent pas être regroupés et minifiés (le fait que cela ne puisse pas être fait est une illusion). Je veux juste dire que cela n'a aucun sens de faire les deux.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, voici une observation amusante. </font><font style="vertical-align: inherit;">Dans mon application, jusqu'à ce que j'écrive cette section, des modules étaient utilisés (je souligne!). </font><font style="vertical-align: inherit;">J'ai installé Parcel pour calculer la taille d'assemblage correcte. </font><font style="vertical-align: inherit;">Et maintenant, je ne vois aucune raison de revenir aux modules normaux. </font><font style="vertical-align: inherit;">Eh bien, n'est-ce pas intéressant!</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍Vie sans transpilation</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au fil des ans, j'ai l'habitude d'utiliser les dernières constructions de syntaxe JavaScript et le merveilleux outil Babel, qui les transforme en code que tous les navigateurs comprennent. Je m'y suis tellement habitué que j'ai rarement au moins pensé à la prise en charge du navigateur (bien sûr, à l'exception de DOM et CSS). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quand j'ai essayé pour la première fois </font></font><code>type=«module»</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, j'allais tout faire moi-même. Mon objectif était de nouveaux navigateurs, donc j'ai pensé que je pouvais utiliser du JavaScript moderne, auquel je suis habitué. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais la réalité n'était pas si rose. Essayez de répondre aux questions suivantes rapidement et sans chercher nulle part. Est-ce que Edge prend en charge</font></font><code>flatMap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Safari prend-il en charge l'attribution destructive (objets et tableaux)? Chrome prend-il en charge les virgules après les derniers arguments de la fonction? Firefox prend-il en charge l'exponentiation? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, j'ai dû chercher des réponses à ces questions, effectuer des tests inter-navigateurs. Mais j'ai utilisé tout cela pendant des siècles. Dans toute application suffisamment grande, cela entraînerait très probablement des erreurs de production. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cela signifie également que je ne serai pas en mesure d'utiliser l'innovation JavaScript la plus remarquable depuis l'avènement de la méthode de tableau </font></font><code>slice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opérateur de séquence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dit </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">facultatif</font></a><font style="vertical-align: inherit;"> . J'ai utilisé des designs magiques comme</font></font><code>prop?.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">environ un mois (à partir du moment où l'outil Create React App a commencé à les prendre en charge sans aucun paramètre supplémentaire). </font><font style="vertical-align: inherit;">Mais c'est déjà gênant pour moi de travailler sans eux.</font></font><br>
<br>
<h3><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">▍ Mise en cache des charges</font></font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise en cache était pour moi la plus grande pierre d'achoppement. En fait, le fait que la solution au problème de mise en cache se soit avérée assez intéressante s'est avéré être la principale raison pour laquelle j'ai décidé d'écrire ce matériel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous en êtes sûr, vous savez, lorsque les matériaux sont traités à l'aide d'un bundler, chacun des fichiers résultants obtient un nom unique - en quelque sorte </font></font><code>index.38fd9e.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le contenu d'un fichier portant ce nom ne change jamais (jamais). Par conséquent, il peut être mis en cache par le navigateur pour une durée illimitée. Si un tel fichier est téléchargé une fois, vous n'aurez pas à le télécharger à nouveau. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est un système incroyable - à moins que vous n'essayiez de trouver la réponse à la question de savoir comment vider le cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les modules sont chargés en utilisant une conception comme</font></font><code>&lt;script type="module" src="index.mjs"&gt;&lt;/script&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le hachage du nom de fichier n'est pas utilisé. </font><font style="vertical-align: inherit;">Comment, dans cette situation, est-il censé informer le navigateur de l'endroit où le télécharger </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- à partir du cache ou du réseau? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il convient de noter qu'il est presque possible de rendre le cache acceptable, mais cela prendra un certain effort. </font><font style="vertical-align: inherit;">Voici ce dont vous avez besoin pour cela:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devez définir le titre de toutes les réponses </font></font><code>cache-control</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur une valeur </font></font><code>no-cache</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Incroyablement, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas de cache</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne signifie pas «ne pas mettre en cache». </font><font style="vertical-align: inherit;">Cela signifie que le fichier doit être mis en cache, mais le fichier ne doit pas être «utilisé pour satisfaire une demande ultérieure sans vérification réussie sur le serveur source».</font></font></li>
<li>    ETag.    —  ()   , ,   ,    .  , <code>38fd9e</code>      .</li>
<li>   CDN-  ,   .     ETag       .     .   CDN-   .       (     ETag)      . (, ,     Firebase).</li>
<li>  -,    ,  «  »  .        ,     ,  ,  ,    .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par conséquent, lorsqu'un visiteur revisite le site, le navigateur dit: «Je dois télécharger le fichier </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je vois que ce fichier existe déjà dans mon cache, son ETag l'est </font></font><code>38fd9e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Je vais demander ce fichier au serveur, mais je lui dirai de me l'envoyer uniquement si son ETag ne l'est pas </font></font><code>38fd9e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. " Le technicien interceptera cette demande, ignorera ETag et la renverra </font></font><code>index.mjs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de son cache (ce fichier est entré dans le cache lors du dernier chargement de la page). L'agent de service redirige ensuite la demande vers le serveur. Le serveur renverra soit un message indiquant que le fichier n'a pas changé, soit un fichier qui sera stocké dans le cache. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À mon avis, tout cela est très gênant. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, si vous êtes intéressé, le code du technicien de service:</font></font><br>
<br>
<pre><code class="javascript hljs">self.addEventListener(<span class="hljs-string">'fetch'</span>, e =&gt; {<font></font>
&nbsp;&nbsp;e.respondWith(<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//       </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">const</span> cacheResponse = <span class="hljs-keyword">await</span> caches.match(e.request);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//   (),   </span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">// (ETag-    )</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch(e.request).then(<span class="hljs-function"><span class="hljs-params">fetchResponse</span> =&gt;</span> {<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caches<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.open(CACHE_NAME)<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.then(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> cache.put(e.request, fetchResponse));<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span> (cacheResponse) <span class="hljs-keyword">return</span> cacheResponse;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span> fetch(e.request);<font></font>
&nbsp;&nbsp;&nbsp;&nbsp;})()<font></font>
&nbsp;&nbsp;);<font></font>
});<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'étais paresseux, donc je n'ai pas étudié et n'ai pas utilisé la dernière propriété </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FetchEvent.navigationPreload</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le fait est qu'à ce moment-là, j'ai passé plus de temps à mettre en cache qu'à écrire une application (pour votre information, j'ai passé 10 et 11 heures sur ces questions, respectivement). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, je tiens à noter que la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proposition de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> «carte d'importation» vise à résoudre certains des problèmes décrits ci-dessus. Il vous permet d'organiser quelque chose comme le mappage </font></font><code>index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur </font></font><code>index.38fd9e.mj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s. Mais pour générer un hachage, de toute façon, vous avez besoin d'une sorte de pipeline d'assemblage, les cartes d'importation devront être incorporées dans le fichier HTML. Cela signifie qu'un bundler est nécessaire ici ... En fait, dans cette situation, les modules ne sont plus nécessaires dans le navigateur.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En conséquence, bien qu'il soit intéressant de comprendre tout cela, cela peut être comparé à la façon dont j'ai conduit partout sur un monocycle pendant une année entière. </font><font style="vertical-align: inherit;">Je ne ferai plus ça.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais probablement tout le monde n'utilise pas de bundlers?</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai écrit ce matériel en supposant que tout le monde écrit du code dans des modules, en utilisant des constructions </font></font><code>import/export</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>require</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis en collectant le code dans des bundles de production en utilisant Webpack, Grunt, Gulp ou quelque chose comme ça. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y a-t-il des développeurs qui n'utilisent pas de bundles? </font><font style="vertical-align: inherit;">Y a-t-il quelqu'un qui place son code JavaScript dans plusieurs fichiers et l'envoie en production sans regroupement? </font><font style="vertical-align: inherit;">Peut-être que l'une de ces personnes est toi? </font><font style="vertical-align: inherit;">Si oui, je voudrais tout savoir sur ta vie.</font></font><br>
<br>
<h2><font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sommaire</font></font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je m'efforce de prendre toutes les décisions sérieuses, telles que le choix entre les modules et les bundlers, sur la base des grands principes d'un développement efficace. C'est la productivité et la qualité. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Malheureusement, l'utilisation de modules dans les navigateurs ne contribue ni à l'un ni à l'autre. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si demain je commence à travailler sur un nouveau projet, alors dans ma tête je n'aurai pas de question sur l'opportunité d'exécuter la bonne vieille application create-react. Tous les paramètres initiaux prendront environ trente secondes, et bien que la taille initiale du projet de 40 Ko soit un peu grande, pour la plupart des sites, cela ne jouera aucun rôle.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et voici une situation différente. Supposons que je devrais rassembler un peu de HTML / CSS et JavaScript pour une sorte d'expérience, et une telle expérience serait un projet qui inclurait un peu plus de fichiers que «quelques-uns». Si, en travaillant sur ce projet, je n'avais pas prévu de passer du temps à configurer le système pour le construire, alors j'utiliserais probablement les modules dans le navigateur. Et puis - si je ne me souciais pas de la performance de ce projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je serais intéressé de savoir comment Webpack et ses outils associés fonctionnent avec les modules ES6 dans un navigateur. Je pense qu'à l'avenir, lorsque la proposition de «cartes d'importation» recevra un soutien suffisant, les bundlers les utiliseront probablement comme un mécanisme pour résumer les hachages disgracieux qui sont utilisés aujourd'hui.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers lecteurs! </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avez-vous utilisé des modules ES6 dans votre navigateur?</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr492500/index.html">Garage scientifique en russe. Expérience de traduction d'un spectacle américain</a></li>
<li><a href="../fr492502/index.html">MIP * = RE: preuve historique du domaine de l'informatique qui a provoqué l'effet domino en physique et en mathématiques</a></li>
<li><a href="../fr492504/index.html">Que se passe-t-il lorsqu'un module JS est importé deux fois?</a></li>
<li><a href="../fr492506/index.html">3 façons de rendre de grandes listes en angulaire</a></li>
<li><a href="../fr492508/index.html">Réservez Kubernetes pour DevOps</a></li>
<li><a href="../fr492512/index.html">CSS: aventures au pays de la translucidité</a></li>
<li><a href="../fr492514/index.html">Comment établir un flux de documents électroniques juridiquement significatif des contreparties en Russie et au Kazakhstan?</a></li>
<li><a href="../fr492518/index.html">L'épidémie de virus nécessite un travail à distance, ce qui signifie la signature numérique des documents</a></li>
<li><a href="../fr492520/index.html">Modélisation 3D paramétrée de la cuvette de roulement dans nanoCAD Plus 20</a></li>
<li><a href="../fr492522/index.html">Communication d'équipe à distance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>