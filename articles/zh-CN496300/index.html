<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¶ğŸ½ ğŸ‘©ğŸ¾â€ğŸ’¼ ğŸ§‘ğŸ¿ å¯åŠ¨ASP.NET Coreä¸­çš„å¼‚æ­¥ä»£ç ï¼šé¿å¼€GetAwaiterï¼ˆï¼‰çš„4ç§æ–¹æ³•ã€‚ ğŸ›… ğŸ’ªğŸ¾ ğŸ‘¨ğŸ¼â€ğŸ’»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è‡ªä»Cï¼ƒ5.0ä¸­å¼•å…¥async / awaitæœºåˆ¶ä»¥æ¥ï¼Œæ‰€æœ‰æ–‡ç« å’Œæ–‡æ¡£ä¸­éƒ½ä¸æ–­æ•™å¯¼æˆ‘ä»¬åœ¨åŒæ­¥ä¸­ä½¿ç”¨å¼‚æ­¥ä»£ç éå¸¸ç³Ÿç³•ã€‚ä»–ä»¬å‘¼ååƒGetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰é‚£æ ·çš„ææƒ§ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒMicrosoftç¨‹åºå‘˜æœ¬èº«å¹¶ä¸è½»è§†æ­¤è®¾è®¡ã€‚
 
 
 
 å·¥ä½œä»»åŠ¡çš„èƒŒæ™¯
 æˆ‘ä»¬ç°åœ¨æ­£åœ¨ä»ä¼ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>å¯åŠ¨ASP.NET Coreä¸­çš„å¼‚æ­¥ä»£ç ï¼šé¿å¼€GetAwaiterï¼ˆï¼‰çš„4ç§æ–¹æ³•ã€‚</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dodopizzadev/blog/496300/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‡ªä»Cï¼ƒ5.0ä¸­å¼•å…¥async / awaitæœºåˆ¶ä»¥æ¥ï¼Œæ‰€æœ‰æ–‡ç« å’Œæ–‡æ¡£ä¸­éƒ½ä¸æ–­æ•™å¯¼æˆ‘ä»¬åœ¨åŒæ­¥ä¸­ä½¿ç”¨å¼‚æ­¥ä»£ç éå¸¸ç³Ÿç³•ã€‚</font><font style="vertical-align: inherit;">ä»–ä»¬å‘¼ååƒGetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰é‚£æ ·çš„ææƒ§ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒMicrosoftç¨‹åºå‘˜æœ¬èº«å¹¶ä¸è½»è§†æ­¤è®¾è®¡ã€‚</font></font><br>
<br>
<img src="https://habrastorage.org/webt/yl/m9/nb/ylm9nbu--2sz9pzjxu-tgx8k5t4.png"><br>
 <a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å·¥ä½œä»»åŠ¡çš„èƒŒæ™¯</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç°åœ¨æ­£åœ¨ä»ä¼ ç»Ÿèº«ä»½éªŒè¯è¿‡æ¸¡åˆ°OAuth 2.0ï¼ŒOAuth 2.0å·²ç»æˆä¸ºæˆ‘ä»¬è¡Œä¸šçš„æ ‡å‡†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„æœåŠ¡å·²ç»æˆä¸ºä¸æ–°ç³»ç»Ÿé›†æˆä»¥åŠå‘JWTèº«ä»½éªŒè¯è¿‡æ¸¡çš„è¯•éªŒã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨é›†æˆè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å®éªŒï¼Œè€ƒè™‘äº†å„ç§é€‰é¡¹ï¼Œå¦‚ä½•å‡è½»ä»¤ç‰Œæä¾›è€…ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸ºIdentityServerï¼‰çš„è´Ÿæ‹…ï¼Œå¹¶ç¡®ä¿æ•´ä¸ªç³»ç»Ÿçš„æ›´é«˜å¯é æ€§ã€‚</font><font style="vertical-align: inherit;">å°†åŸºäºJWTçš„éªŒè¯è¿æ¥åˆ°ASP.NET Coreéå¸¸ç®€å•ï¼Œå¹¶ä¸”ä¸ä»¤ç‰Œæä¾›ç¨‹åºçš„ç‰¹å®šå®ç°æ— å…³ï¼š</font></font><br>
<br>
<pre><code class="cs hljs">services<font></font>
      .AddAuthentication()<font></font>
      .AddJwtBearer(); <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯è¿™ä¸¤è¡ŒèƒŒåéšè—ç€ä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">åœ¨ä»–ä»¬çš„å¹•åï¼Œåˆ›å»ºäº†ä¸€ä¸ªJWTBearerHandlerï¼Œå®ƒå·²ç»å¤„ç†äº†æ¥è‡ªAPIå®¢æˆ·ç«¯çš„JWTã€‚</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/fs/sx/ce/fssxce2duwjnem0_zgekkezhglm.jpeg" width="550"></div><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯·æ±‚</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
æ—¶</font><i><font style="vertical-align: inherit;">å®¢æˆ·ç«¯ï¼ŒAPIå’Œä»¤ç‰Œæä¾›è€…ä¹‹é—´</font></i><font style="vertical-align: inherit;">çš„äº¤äº’JWTBearerHandlerä»å®¢æˆ·ç«¯æ”¶åˆ°ä»¤ç‰Œæ—¶ï¼Œå®ƒä¸ä¼šå°†ä»¤ç‰Œå‘é€ç»™æä¾›è€…è¿›è¡ŒéªŒè¯ï¼Œç›¸åï¼Œå®ƒè¯·æ±‚Signing Key providerï¼ˆç­¾åå¯†é’¥æä¾›è€…ï¼‰-ç­¾åä»¤ç‰Œçš„å¯†é’¥çš„å…¬å…±éƒ¨åˆ†ã€‚æ ¹æ®æ­¤å¯†é’¥ï¼ŒéªŒè¯ä»¤ç‰Œæ˜¯å¦ç”±æ­£ç¡®çš„æä¾›è€…ç­¾åã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨JWTBearerHandlerä¸­æ”¾ç½®HttpClientï¼Œå®ƒé€šè¿‡ç½‘ç»œä¸æä¾›ç¨‹åºè¿›è¡Œäº¤äº’ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å‡è®¾æä¾›è€…çš„ç­¾åå¯†é’¥ä¸æ‰“ç®—ç»å¸¸æ›´æ”¹ï¼Œé‚£ä¹ˆåœ¨å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œç¼“å­˜è‡ªå·±å¹¶æ‘†è„±æŒç»­çš„ç½‘ç»œè¯·æ±‚æ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸€æ¬¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è·å¾—äº†ç”¨äºç­¾åå¯†é’¥çš„ä»£ç ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AuthenticationBuilder <span class="hljs-title">AddJwtAuthentication</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> AuthenticationBuilder builder, AuthJwtOptions options</span>)</span><font></font>
{<font></font>
    <span class="hljs-keyword">var</span> signingKeys = <span class="hljs-keyword">new</span> List&lt;SecurityKey&gt;();<font></font>
<font></font>
    <span class="hljs-keyword">var</span> jwtBearerOptions = <span class="hljs-keyword">new</span> JwtBearerOptions {Authority = options?.Authority};<font></font>
    <font></font>
    <span class="hljs-keyword">new</span> JwtBearerPostConfigureOptions().PostConfigure(<span class="hljs-keyword">string</span>.Empty, jwtBearerOptions);
    <span class="hljs-keyword">try</span><font></font>
    {<font></font>
        <span class="hljs-keyword">var</span> config = jwtBearerOptions.ConfigurationManager<font></font>
            .GetConfigurationAsync(<span class="hljs-keyword">new</span> CancellationTokenSource(options?.AuthorityTimeoutInMs ?? <span class="hljs-number">5000</span>).Token)<font></font>
            .GetAwaiter().GetResult();<font></font>
        <span class="hljs-keyword">var</span> providerSigningKeys = config.SigningKeys;<font></font>
        signingKeys.AddRange(providerSigningKeys);<font></font>
    }<font></font>
    <span class="hljs-keyword">catch</span> (Exception)<font></font>
    {<font></font>
        <span class="hljs-comment">// ignored</span><font></font>
    }<font></font>
<font></font>
    builder<font></font>
        .AddJwtBearer(options =&gt;<font></font>
        {<font></font>
            options.TokenValidationParameters = <span class="hljs-keyword">new</span> TokenValidationParameters<font></font>
            {<font></font>
                <span class="hljs-comment">// ...</span><font></font>
                IssuerSigningKeys = signingKeys,<font></font>
                <span class="hljs-comment">// ...</span><font></font>
            };<font></font>
        });<font></font>
    <span class="hljs-keyword">return</span> builder;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ç¬¬12è¡Œä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†.GetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å› ä¸ºAuthenticationBuilderæ˜¯åœ¨Startupç±»çš„å…¬å…±void ConfigureServicesï¼ˆIServiceCollectionæœåŠ¡ï¼‰{...}å†…é…ç½®çš„ï¼Œå¹¶ä¸”æ­¤æ–¹æ³•æ²¡æœ‰å¼‚æ­¥ç‰ˆæœ¬ã€‚</font><font style="vertical-align: inherit;">éº»çƒ¦ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»Cï¼ƒ7.1å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¼‚æ­¥çš„Mainï¼ˆï¼‰ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯Asp.NET Coreä¸­çš„å¼‚æ­¥å¯åŠ¨é…ç½®æ–¹æ³•å°šæœªäº¤ä»˜ã€‚</font><font style="vertical-align: inherit;">ä»ç¾å­¦ä¸Šè®²ï¼Œæˆ‘å¾ˆè®¨åŒå†™GetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰ï¼ˆè¢«æ•™æˆ‘ä¸è¦è¿™æ ·åšï¼ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä¸Šç½‘å¯»æ‰¾å…¶ä»–äººå¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘è¢«GetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰å›°æ‰°ï¼Œä½†Microsoftå´æ²¡æœ‰</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘é¦–å…ˆæ‰¾åˆ°äº†ä¸€ä¸ªé€‰é¡¹ï¼ŒMicrosoftç¨‹åºå‘˜åœ¨ç±»ä¼¼çš„ä»»åŠ¡ä¸­ä½¿ç”¨äº†è¯¥é€‰é¡¹æ¥</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»Azure KeyVaultä¸­è·å–ç§˜å¯†</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å¦‚æœæ‚¨ç»è¿‡å‡ å±‚æŠ½è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†çœ‹åˆ°ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Load</span>(<span class="hljs-params"></span>)</span> =&gt; LoadAsync().ConfigureAwait(<span class="hljs-literal">false</span>).GetAwaiter().GetResult();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å†æ¬¡é—®å¥½ï¼ŒGetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰ï¼</font><font style="vertical-align: inherit;">è¿˜æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆå—ï¼Ÿ</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç»è¿‡çŸ­æš‚çš„è°·æ­Œæœç´¢åï¼Œæˆ‘å‘ç°äº†</font><font style="vertical-align: inherit;">å®‰å¾·é²Â·æ´›å…‹</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼ˆ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Andrew Lockï¼‰</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">æ’°å†™</font></a><font style="vertical-align: inherit;">çš„</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ä¸€ç³»åˆ—ç²¾å½©æ–‡ç« </font></a><font style="vertical-align: inherit;">ï¼Œä¸€å¹´å‰</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ï¼Œ</font></a><font style="vertical-align: inherit;">å®‰å¾·é²Â·æ´›å…‹</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ï¼ˆ</font></a><font style="vertical-align: inherit;"> Andrew Lockï¼‰æ›¾æƒ³åˆ°ä¸æˆ‘åŒä¸€ä¸ªé—®é¢˜ã€‚</font><font style="vertical-align: inherit;">å³ä½¿å‡ºäºç›¸åŒçš„åŸå› -ä»ç¾å­¦ä¸Šè®²ï¼Œä»–ä¹Ÿä¸å–œæ¬¢åŒæ­¥è°ƒç”¨å¼‚æ­¥ä»£ç ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€šå¸¸ï¼Œæˆ‘å»ºè®®æ‰€æœ‰å¯¹æ­¤ä¸»é¢˜æ„Ÿå…´è¶£çš„äººé˜…è¯»å®‰å¾·é²æ’°å†™çš„äº”ç¯‡æ–‡ç« çš„æ•´ä¸ªç³»åˆ—ã€‚</font><font style="vertical-align: inherit;">ä»–åœ¨é‚£é‡Œè¯¦ç»†åˆ†æäº†å“ªäº›å·¥ä½œä»»åŠ¡å¯¼è‡´äº†æ­¤é—®é¢˜ï¼Œç„¶åè€ƒè™‘äº†å‡ ç§é”™è¯¯çš„æ–¹æ³•ï¼Œç„¶åä»…æè¿°äº†è§£å†³æ–¹æ¡ˆã€‚</font><font style="vertical-align: inherit;">åœ¨æˆ‘çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†å°è¯•ç®€è¦ä»‹ç»ä»–çš„ç ”ç©¶ï¼Œå°†é‡ç‚¹æ›´å¤šåœ°æ”¾åœ¨è§£å†³æ–¹æ¡ˆä¸Šã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼‚æ­¥ä»»åŠ¡åœ¨å¯åŠ¨WebæœåŠ¡ä¸­çš„ä½œç”¨</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
é€€åä¸€æ­¥æŸ¥çœ‹æ•´ä¸ªå›¾ç‰‡ã€‚</font><font style="vertical-align: inherit;">æ— è®ºé‡‡ç”¨å“ªç§æ¡†æ¶ï¼Œæˆ‘éƒ½æƒ³è§£å†³ä»€ä¹ˆæ¦‚å¿µæ€§é—®é¢˜ï¼Ÿ</font></font><br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é—®é¢˜ï¼š</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å¿…è¦å¯åŠ¨WebæœåŠ¡ï¼Œä»¥ä¾¿å®ƒå¤„ç†å…¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ç»„ï¼ˆç›¸å¯¹ï¼‰å†—é•¿çš„æ“ä½œï¼Œæ²¡æœ‰è¿™äº›æ“ä½œï¼ŒæœåŠ¡å°†æ— æ³•å“åº”å®¢æˆ·ç«¯ï¼Œå¦åˆ™å…¶ç­”æ¡ˆå°†æ˜¯ä¸æ­£ç¡®çš„ã€‚</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤ç±»æ“ä½œçš„ç¤ºä¾‹ï¼š</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éªŒè¯å¼ºç±»å‹çš„é…ç½®ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¡«å……ç¼“å­˜ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸æ•°æ®åº“æˆ–å…¶ä»–æœåŠ¡çš„åˆæ­¥è¿æ¥ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JITå’Œç¨‹åºé›†åŠ è½½ï¼ˆæœåŠ¡é¢„çƒ­ï¼‰ã€‚</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®åº“è¿ç§»ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯å®‰å¾·é²Â·æ´›å…‹ï¼ˆAndrew Lockï¼‰çš„ä¾‹å­ä¹‹ä¸€ï¼Œä½†ä»–æœ¬äººä¹Ÿæ‰¿è®¤ï¼Œæ¯•ç«Ÿï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¯åŠ¨æœåŠ¡æ—¶</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ“ä½œæ˜¯</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">ä¸å¯å–çš„</font></a><font style="vertical-align: inherit;">ã€‚</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘æƒ³æ‰¾åˆ°ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè¯¥è§£å†³æ–¹æ¡ˆå…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä»¥è‡ªç„¶çš„æ–¹å¼æ‰§è¡Œä»»æ„å¼‚æ­¥ä»»åŠ¡ï¼Œè€Œæ— éœ€GetAwaiterï¼ˆï¼‰ã€‚GetResultï¼ˆï¼‰ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™äº›ä»»åŠ¡å¿…é¡»åœ¨åº”ç”¨ç¨‹åºå¼€å§‹æ¥å—è¯·æ±‚ä¹‹å‰å®Œæˆï¼Œä½†æ˜¯å¯¹äºå®ƒä»¬çš„å·¥ä½œï¼Œä»–ä»¬å¯èƒ½éœ€è¦é…ç½®å’Œæ³¨å†Œåº”ç”¨ç¨‹åºçš„æœåŠ¡ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œå¿…é¡»åœ¨DIé…ç½®ä¹‹åæ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™ä¸ªæƒ³æ³•å¯ä»¥ç”¨å›¾è¡¨çš„å½¢å¼è¡¨ç¤ºï¼š</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/eh/ym/ncehymvjo0cm3yz5p3uq-uycvpq.jpeg"></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³æ–¹æ¡ˆ1ï¼šå¯èƒ½ä¼šä½¿ç»§æ‰¿äººæ„Ÿåˆ°å›°æƒ‘çš„å¯è¡Œè§£å†³æ–¹æ¡ˆ</font></font></h2><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lockæä¾›</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
çš„ç¬¬ä¸€ä¸ªå·¥ä½œè§£å†³æ–¹æ¡ˆ</font><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><font></font>
{<font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><font></font>
   {<font></font>
       IWebHost webHost = CreateWebHostBuilder(args).Build();<font></font>
<font></font>
       <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> scope = webHost.Services.CreateScope())<font></font>
       {<font></font>
           <span class="hljs-comment">//   </span>
           <span class="hljs-keyword">var</span> myService = scope.ServiceProvider.GetRequiredService&lt;MyService&gt;();<font></font>
<font></font>
           <span class="hljs-keyword">await</span> myService.DoAsyncJob();<font></font>
       }<font></font>
<font></font>
       <span class="hljs-keyword">await</span> webHost.RunAsync();<font></font>
   }<font></font>
<font></font>
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IWebHostBuilder <span class="hljs-title">CreateWebHostBuilder</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span> =&gt;<font></font>
       WebHost.CreateDefaultBuilder(args)<font></font>
           .UseStartup&lt;Startup&gt;();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cï¼ƒ7.1ä¸­å¼‚æ­¥Mainï¼ˆï¼‰çš„å‡ºç°ä½¿è¿™ç§æ–¹æ³•æˆä¸ºå¯èƒ½ã€‚</font><font style="vertical-align: inherit;">å”¯ä¸€çš„è´Ÿé¢å½±å“æ˜¯æˆ‘ä»¬å°†é…ç½®éƒ¨åˆ†ä»Startup.csè½¬ç§»åˆ°Program.csã€‚</font><font style="vertical-align: inherit;">è¿™ç§é’ˆå¯¹ASP.NETæ¡†æ¶çš„éæ ‡å‡†è§£å†³æ–¹æ¡ˆå¯èƒ½ä¼šä½¿ç»§æ‰¿æˆ‘ä»¬ä»£ç çš„äººæ„Ÿåˆ°å›°æƒ‘ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³æ–¹æ¡ˆ2ï¼šåœ¨DIä¸­åµŒå…¥å¼‚æ­¥æ“ä½œ</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å› æ­¤ï¼Œå®‰å¾·é²æå‡ºäº†è¯¥è§£å†³æ–¹æ¡ˆçš„æ”¹è¿›ç‰ˆæœ¬ã€‚</font><font style="vertical-align: inherit;">å£°æ˜äº†å¼‚æ­¥ä»»åŠ¡çš„æ¥å£ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IStartupTask</span><font></font>
{<font></font>
    <span class="hljs-function">Task <span class="hljs-title">ExecuteAsync</span>(<span class="hljs-params">CancellationToken cancellationToken = <span class="hljs-keyword">default</span></span>)</span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»¥åŠåœ¨DIä¸­æ³¨å†Œè¿™äº›ä»»åŠ¡çš„æ‰©å±•æ–¹æ³•ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ServiceCollectionExtensions</span><font></font>
{<font></font>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IServiceCollection AddStartupTask&lt;T&gt;(<span class="hljs-keyword">this</span> IServiceCollection services)
        <span class="hljs-keyword">where</span> T : <span class="hljs-keyword">class</span>, <span class="hljs-title">IStartupTask</span><font></font>
        =&gt; services.AddTransient&lt;IStartupTask, T&gt;();<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æ¥ä¸‹æ¥ï¼Œå£°æ˜äº†å¦ä¸€ä¸ªæ‰©å±•æ–¹æ³•ï¼Œå·²ç»ç”¨äºIWebHostï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StartupTaskWebHostExtensions</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">RunWithTasksAsync</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IWebHost webHost, CancellationToken cancellationToken = <span class="hljs-keyword">default</span></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">//      DI</span>
        <span class="hljs-keyword">var</span> startupTasks = webHost.Services.GetServices&lt;IStartupTask&gt;();<font></font>
<font></font>
        <span class="hljs-comment">//   </span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> startupTask <span class="hljs-keyword">in</span> startupTasks)<font></font>
        {<font></font>
            <span class="hljs-keyword">await</span> startupTask.ExecuteAsync(cancellationToken);<font></font>
        }<font></font>
<font></font>
        <span class="hljs-comment">//    </span>
        <span class="hljs-keyword">await</span> webHost.RunAsync(cancellationToken);<font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨Program.csä¸­ï¼Œæˆ‘ä»¬ä»…æ›´æ”¹ä¸€è¡Œã€‚</font><font style="vertical-align: inherit;">ä»£æ›¿ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">await</span> CreateWebHostBuilder(args).Build().Run();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘ä»¬ç§°ä¹‹ä¸ºï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">await</span> CreateWebHostBuilder(args).Build().RunWithTasksAsync();</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è®¤ä¸ºï¼Œä¸€ç§å¾ˆæ£’çš„æ–¹æ³•å¯ä»¥ä½¿å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶é•¿æ—¶é—´æ“ä½œçš„å·¥ä½œå°½å¯èƒ½é€æ˜ã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³æ–¹æ¡ˆï¼ƒ3ï¼šå¯¹äºé‚£äº›åˆ‡æ¢åˆ°ASP.NET Core 3.xçš„ç”¨æˆ·</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ASP.NET Core 3.xï¼Œåˆ™è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†å†æ¬¡å‚è€ƒ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrew Lockçš„æ–‡ç« </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯ASP.NET Core 2.xçš„WebHostå¯åŠ¨ä»£ç ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WebHost</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">StartAsync</span>(<span class="hljs-params">CancellationToken cancellationToken = <span class="hljs-keyword">default</span></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">// ... initial setup</span>
        <span class="hljs-keyword">await</span> Server.StartAsync(hostingApp, cancellationToken).ConfigureAwait(<span class="hljs-literal">false</span>);<font></font>
<font></font>
        <span class="hljs-comment">// Fire IApplicationLifetime.Started</span><font></font>
        _applicationLifetime?.NotifyStarted();<font></font>
<font></font>
        <span class="hljs-comment">// Fire IHostedService.Start</span>
        <span class="hljs-keyword">await</span> _hostedServiceExecutor.StartAsync(cancellationToken).ConfigureAwait(<span class="hljs-literal">false</span>);<font></font>
<font></font>
        <span class="hljs-comment">// ...remaining setup</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è¿™æ˜¯</font><font style="vertical-align: inherit;">ASP.NET Core 3.0ä¸­</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„ç›¸åŒæ–¹æ³•</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WebHost</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">StartAsync</span>(<span class="hljs-params">CancellationToken cancellationToken = <span class="hljs-keyword">default</span></span>)</span><font></font>
    {<font></font>
        <span class="hljs-comment">// ... initial setup</span><font></font>
<font></font>
        <span class="hljs-comment">// Fire IHostedService.Start</span>
        <span class="hljs-keyword">await</span> _hostedServiceExecutor.StartAsync(cancellationToken).ConfigureAwait(<span class="hljs-literal">false</span>);<font></font>
<font></font>
        <span class="hljs-comment">// ... more setup</span>
        <span class="hljs-keyword">await</span> Server.StartAsync(hostingApp, cancellationToken).ConfigureAwait(<span class="hljs-literal">false</span>);<font></font>
<font></font>
        <span class="hljs-comment">// Fire IApplicationLifetime.Started</span><font></font>
        _applicationLifetime?.NotifyStarted();<font></font>
<font></font>
        <span class="hljs-comment">// ...remaining setup</span><font></font>
    }<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨ASP.NET Core 3.xä¸­ï¼Œé¦–å…ˆå¯åŠ¨HostedServicesï¼Œç„¶åæ‰å¯åŠ¨ä¸»WebHostï¼Œä¸ä¹‹ç›¸åã€‚</font><font style="vertical-align: inherit;">è¿™ç»™äº†æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå¯ä»¥åœ¨IHostedServiceæ¥å£çš„StartAsyncï¼ˆCancellationTokenï¼‰æ–¹æ³•å†…éƒ¨è°ƒç”¨æ‰€æœ‰å¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”æ— éœ€åˆ›å»ºå•ç‹¬çš„æ¥å£å’Œæ‰©å±•æ–¹æ³•å³å¯è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³æ–¹æ¡ˆ4ï¼šå¥åº·æ£€æŸ¥å’ŒKubernetesçš„æ•…äº‹</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä¸€ä¸ªäººå¯ä»¥å¯¹æ­¤å¹³é™ä¸‹æ¥ï¼Œä½†æ˜¯æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œçªç„¶é—´å®ƒåœ¨å½“å‰ç°å®ä¸­å˜å¾—å¾ˆé‡è¦ã€‚è¿™æ˜¯ä½¿ç”¨å¥åº·æ£€æŸ¥ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åŸºæœ¬æ€æƒ³æ˜¯å°½æ—©å¯åŠ¨KestrelæœåŠ¡å™¨ï¼Œä»¥é€šçŸ¥è´Ÿè½½å¹³è¡¡å™¨è¯¥æœåŠ¡å·²å‡†å¤‡å¥½æ¥å—è¯·æ±‚ã€‚ä½†æ˜¯åŒæ—¶ï¼Œæ‰€æœ‰éå¥åº·æ£€æŸ¥è¯·æ±‚éƒ½å°†è¿”å›503ï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰ã€‚ Microsoftç½‘ç«™ä¸Šæœ‰ä¸€ç¯‡ç›¸å½“</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¿æ³›çš„æ–‡ç« </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">å†…å®¹æ¶‰åŠå¦‚ä½•åœ¨ASP.NET Coreä¸­ä½¿ç”¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚æˆ‘æƒ³è€ƒè™‘è¿™ç§æ–¹æ³•ï¼Œä½†æ²¡æœ‰é€‚ç”¨äºæˆ‘ä»¬ä»»åŠ¡çš„ç‰¹æ®Šç»†èŠ‚ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å®‰å¾·é²Â·æ´›å…‹ï¼ˆAndrew Lockï¼‰</font><font style="vertical-align: inherit;">å¯¹æ­¤æ–¹æ³•</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦æœ‰å•ç‹¬çš„æ–‡ç« </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å®ƒçš„ä¸»è¦ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å…ç½‘ç»œè¶…æ—¶ã€‚</font></font><br>
<blockquote> ,          ,    ,     .  Kestrel   ,       ,       Â«   Â».</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
åœ¨æ­¤ï¼Œæˆ‘å°†ä¸ä¸ºå¥åº·æ£€æŸ¥æ–¹æ³•æä¾›å®Œæ•´çš„Andrew Lockè§£å†³æ–¹æ¡ˆã€‚å®ƒéå¸¸åºå¤§ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨å°†éœ€è¦å¯åŠ¨WebæœåŠ¡ï¼Œè€Œä¸å¿…ç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥ç«¯ç‚¹åº”äº†è§£è¿™äº›æ“ä½œçš„çŠ¶æ€ï¼Œåœ¨æ‰§è¡Œè¿™äº›æ“ä½œæ—¶å‘å‡º503ï¼Œåœ¨å®ƒä»¬å®Œæˆæ—¶å‘å‡º200ã€‚</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
è€å®è¯´ï¼Œå½“æˆ‘ç ”ç©¶æ­¤é€‰é¡¹æ—¶ï¼Œæˆ‘æœ‰ä¸€å®šçš„æ€€ç–‘æ€åº¦ã€‚ä¸ä»¥å‰çš„æ–¹æ³•ç›¸æ¯”ï¼Œæ•´ä¸ªè§£å†³æ–¹æ¡ˆçœ‹èµ·æ¥å¾ˆéº»çƒ¦ã€‚å¦‚æœæˆ‘ä»¬è¿›è¡Œç±»æ¯”ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯å¦‚ä½•å†æ¬¡å°†</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAPæ–¹æ³•</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸äº‹ä»¶è®¢é˜…ä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å·²ç»ç†Ÿæ‚‰çš„å¼‚æ­¥/ç­‰å¾…ã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä½†æ˜¯éšåï¼ŒKuberneteså¼€å§‹å‘æŒ¥ä½œç”¨ã€‚</font><font style="vertical-align: inherit;">ä»–æœ‰è‡ªå·±çš„å‡†å¤‡è°ƒæŸ¥æ¦‚å¿µã€‚</font><font style="vertical-align: inherit;">æˆ‘å°†åœ¨æˆ‘çš„å…è´¹æ¼”è®²ä¸­å¼•ç”¨â€œå®è·µä¸­çš„Kubernetesâ€ä¸€ä¹¦ï¼š</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å§‹ç»ˆç¡®å®šå‡†å¤‡æƒ…å†µæ¢é’ˆã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦‚æœæ‚¨æ²¡æœ‰å‡†å¤‡æƒ…å†µè°ƒæŸ¥ï¼Œé‚£ä¹ˆæ‚¨çš„Podå‡ ä¹ä¼šç«‹å³æˆä¸ºæœåŠ¡çš„ç«¯ç‚¹ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºèŠ±è´¹å¤ªå¤šæ—¶é—´å‡†å¤‡æ¥å—ä¼ å…¥è¯·æ±‚ï¼Œåˆ™å®¢æˆ·ç«¯å¯¹æœåŠ¡çš„è¯·æ±‚ä¹Ÿå°†å¯åŠ¨å°šæœªå‡†å¤‡å¥½æ¥å—ä¼ å…¥è¿æ¥çš„Podã€‚</font><font style="vertical-align: inherit;">ç»“æœï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°â€œè¿æ¥è¢«æ‹’ç»â€é”™è¯¯ã€‚</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
æˆ‘è¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„å®éªŒï¼šæˆ‘åœ¨HostedServiceä¸­åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰é•¿æ—¶é—´å¼‚æ­¥ä»»åŠ¡çš„ASP.NET Core 3æœåŠ¡ï¼š</font></font><br>
<br>
<pre><code class="cs hljs"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LongTaskHostedService</span> : <span class="hljs-title">IHostedService</span><font></font>
{<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">StartAsync</span>(<span class="hljs-params">CancellationToken cancellationToken</span>)</span><font></font>
    {<font></font>
            Console.WriteLine(<span class="hljs-string">"Long task started..."</span>);
            <span class="hljs-keyword">await</span> Task.Delay(<span class="hljs-number">5000</span>, cancellationToken);<font></font>
            Console.WriteLine(<span class="hljs-string">"Long task finished."</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Task <span class="hljs-title">StopAsync</span>(<span class="hljs-params">CancellationToken cancellationToken</span>)</span><font></font>
    {...}<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å½“æˆ‘ä½¿ç”¨minikubeå¯åŠ¨æ­¤æœåŠ¡ï¼Œç„¶ååœ¨å»¶è¿Ÿçš„5ç§’é’Ÿå†…å°†å…¶æ•°ç›®å¢åŠ åˆ°2ä»¥ä¸‹æ—¶ï¼Œæˆ‘çš„ç¬¬äºŒä¸ªè¯·æ±‚å¹¶æ²¡æœ‰äº§ç”Ÿæœ‰ç”¨çš„ä¿¡æ¯ï¼Œè€Œæ˜¯â€œè¿æ¥è¢«æ‹’ç»â€ã€‚</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kubernetes 1.16 UPD</font></font></b><div class="spoiler_text">    , ,   Kubernetes 1.16  startup probe (   ).     ,     readiness probe.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>.      .<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‘ç°</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ä»æ‰€æœ‰è¿™äº›ç ”ç©¶ä¸­å¯ä»¥å¾—å‡ºä»€ä¹ˆç»“è®ºï¼Ÿ</font><font style="vertical-align: inherit;">ä¹Ÿè®¸æ¯ä¸ªäººéƒ½åº”è¯¥ä¸ºè‡ªå·±çš„é¡¹ç›®å†³å®šå“ªç§è§£å†³æ–¹æ¡ˆæœ€åˆé€‚ã€‚</font><font style="vertical-align: inherit;">å¦‚æœå‡å®šå¼‚æ­¥æ“ä½œä¸ä¼šèŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å…·æœ‰æŸç§é‡è¯•ç­–ç•¥ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ‰€æœ‰æ–¹æ³•ï¼Œä»ASP.NET Core 3.xä¸­çš„GetAwaiterï¼ˆï¼‰.GetResultï¼ˆï¼‰å¼€å§‹ï¼Œä»¥IHostedServiceç»“æŸã€‚</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨ä½¿ç”¨Kuberneteså¹¶ä¸”æ‚¨çš„å¼‚æ­¥æ“ä½œå¯ä»¥æ‰§è¡Œå¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆæ‚¨å°±ä¸èƒ½æ²¡æœ‰è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼ˆä¹Ÿç§°ä¸ºå°±ç»ª/å¯åŠ¨æ¢é’ˆï¼‰ã€‚</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN496260/index.html">åœ¨å®¶å·¥ä½œçš„ç½‘ç»œå®‰å…¨æç¤º</a></li>
<li><a href="../zh-CN496262/index.html">è·å–CVE ID</a></li>
<li><a href="../zh-CN496266/index.html">å† çŠ¶ç—…æ¯’ï¼šæˆ‘ä»¬éƒ½ä¼šæ­»å—ï¼Ÿ</a></li>
<li><a href="../zh-CN496268/index.html">2020å¹´é¢å‘ä¼ä¸šå®¢æˆ·çš„åä¸ºä¼ä¸šç½‘ç»œäº§å“å’Œè§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN496272/index.html">å·®å¼‚æ€§éšç§ï¼šæ¯”è¾ƒåº“</a></li>
<li><a href="../zh-CN496302/index.html">å¦‚ä½•ä¸åœ¨é»‘å®¢ä¸åœ¨æ—¶å°†å…¬å¸äº¤ç»™é»‘å®¢ã€‚SOCä¸“å®¶æç¤º</a></li>
<li><a href="../zh-CN496304/index.html">åœ¨åˆ¶ä½œæ¸¸æˆæ—¶å¦‚ä½•ç»§ç»­å­¦ä¹ UE4</a></li>
<li><a href="../zh-CN496308/index.html">åˆ›å»ºæ— ç¼å™ªå£°å›¾</a></li>
<li><a href="../zh-CN499818/index.html">ä¹Œå…¹åˆ«å…‹ç”µæŠ¥è¥é”€</a></li>
<li><a href="../zh-CN499820/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©Kotlinä½œä¸ºæˆ‘ä»¬çš„ç›®æ ‡è¯­è¨€ä¹‹ä¸€ã€‚ç¬¬2éƒ¨åˆ†ï¼šKotlinå¤šå¹³å°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>