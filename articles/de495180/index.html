<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç∫ üïû üÜé Wir pumpen Ikea: Wie man aus leichter Musik Big Brother macht ü§© üë®üèæ‚Äçüîß üé¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einf√ºhrung
 Ikea ist ein merkw√ºrdiger Laden. Selbst wenn Sie mit der Absicht dazu gekommen sind, eine bestimmte Sache zu kaufen und sich nicht vom Res...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Wir pumpen Ikea: Wie man aus leichter Musik Big Brother macht</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/495180/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/1c/b3/g-1cb35ov13g0bc7demuvnxiqla.gif"></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einf√ºhrung</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ikea ist ein merkw√ºrdiger Laden. Selbst wenn Sie mit der Absicht dazu gekommen sind, eine bestimmte Sache zu kaufen und sich nicht vom Rest des M√ºlls ablenken zu lassen, werden Sie dreimal mehr als n√∂tig kaufen. F√ºr uns Hacker zeigt sich dieser Effekt besonders in der Ikea-Abteilung mit Stromkabeln oder Batterien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr mich ist der letzte Fall eines solchen Wahnsinns in den Niederlanden aufgetreten. Ich war auf einer geplanten Reise und hatte vor, nur ein paar Wochen auf dem Land zu verbringen. Dies war jedoch Anfang 2020 und die Katastrophe mit COVID-19 ... Ich musste mich viel l√§nger von meinem Labor fernhalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und als ich die elektronische Produktlinie von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Frekevens</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bei Ikea sah </font><font style="vertical-align: inherit;">, konnte ich nicht anders und kaufte alles.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr diejenigen, die es nicht wissen: Die Ikea Frekvens-Linie sollte ein modernes Analogon zum HiFi-Set der alten Schule und zum sechseckigen Musikset werden, das sich in den H√§usern der H√§lfte der Teenager der 90er Jahre zu befinden scheint. In diesem Fall besteht die Reihe der miteinander verbundenen Ger√§te aus einem Bluetooth-Lautsprecher f√ºr die Tonausgabe und einem LED-Projektor (erg√§nzt durch verschiedene D√ºsen), die im Takt der Musik flackern, sowie einer LED-W√ºrfelanzeige, die Animationen anzeigen kann, die sich auch zur Musik bewegen. Ikea r√ºhmt sich, dass diese Linie in Zusammenarbeit mit Teenage Engineering entwickelt wurde, das f√ºr seine Pocket Operator-Serie tragbarer ‚ÄûSpielzeug‚Äú -Synthesizer bekannt ist.</font></font><br>
<a name="habracut"></a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4d/8b4/e60/f4d8b4e60e7812b5b979850a18d3926c.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im </font><font style="vertical-align: inherit;">Ikea- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Werbevideo gezeigt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sollte der fertige Kauf von Dutzenden von Ger√§ten wie ein unertr√§glicher flackernder Karneval aussehen, den mein innerer 15-j√§hriger Teenager gerne in seinem Zimmer arrangieren w√ºrde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das LED-W√ºrfel-Display hat mich besonders interessiert: Es ist ein hochwertiges integriertes Ger√§t, das am Netz arbeitet. Auf der Vorderseite befindet sich eine Matrix aus 16 Zeilen und 16 Spalten mit sehr hellen wei√üen LEDs, dh insgesamt 256 LEDs. Die in das Ger√§t eingebauten Animationen waren ziemlich einfach, aber sie f√ºhrten mich zu der Idee, dass Eisen tats√§chlich jede LED einzeln steuern kann. Aus diesem Grund war die kleine Schachtel jedoch ziemlich teuer: Meine Tasche war um etwa 40 Euro leer. F√ºr diesen Betrag erhalten Sie eine Box mit LEDs und einem Stromkabel. Da davon ausgegangen wird, dass Sie dieses Produkt zusammen mit anderen Frekvens-Produkten kaufen m√ºssen, erhalten Sie auch zus√§tzliche Verbindungselemente: ein Verl√§ngerungskabel f√ºr die durchgehende Stromversorgung vom Stromnetz zu anderen Boxen,sowie einen Satz Schrauben und Kunststoffkissen, mit denen Sie das Geh√§use mechanisch aneinander befestigen k√∂nnen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sobald ich nach Hause kam, schloss ich das Ger√§t an und ... um ehrlich zu sein, war ich ein wenig entt√§uscht von dem, was sie mit dem B√ºgeleisen gemacht haben. </font><font style="vertical-align: inherit;">Das Ger√§t verf√ºgte √ºber mehrere Animationen, die durch Dr√ºcken einer Taste auf der R√ºckseite des Geh√§uses ausgew√§hlt werden konnten. </font><font style="vertical-align: inherit;">Im Geh√§use ist ein kleines Mikrofon installiert. Jedes Mal, wenn Rauschen erkannt wird, √§ndert sich der Rahmen der Animation. </font><font style="vertical-align: inherit;">Animationen sind nicht sehr interessant: Sie bestehen nur aus vier bis f√ºnf Bildern, und die Bilder selbst sind nur schwarz und wei√ü ohne Graustufen. </font><font style="vertical-align: inherit;">Wenn Sie neugierig sind, habe ich ein kurzes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Video</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit allen Animationen aufgenommen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Offensichtlich passte das nicht zu mir. </font><font style="vertical-align: inherit;">Lassen Sie uns das Ger√§t hacken - lassen Sie uns sehen, wie es funktioniert und ob es m√∂glich ist, sein Verhalten etwas interessanter zu gestalten.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autopsie</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Zerlegen von Frekvens reichen ein Schraubendreher f√ºr einen kreuzf√∂rmigen Schlitz und m√∂glicherweise ein Messer aus. </font><font style="vertical-align: inherit;">Sie ben√∂tigen auch einen soliden Anteil an Ausdauer, da das Ger√§t nicht leicht zu zerlegen ist: Das Design ist kompliziert und einige Elemente sind mit Silikon gef√ºllt, wahrscheinlich um Vibrationen zu beseitigen und die Herstellung zu vereinfachen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71d/6e9/925/71d6e9925d31cbce7d1da4cf492948de.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Demontage des Frekvens-Geh√§uses beginnt von hinten. </font><font style="vertical-align: inherit;">Das Geh√§use hat an allen Seiten Schraubenl√∂cher, mit Ausnahme der Vorderseite; </font><font style="vertical-align: inherit;">Dank der Schrauben und Abdeckungen aus dem Ger√§tekit kann es an andere Frekvens-Ger√§te angeschlossen werden. </font><font style="vertical-align: inherit;">Die hinteren L√∂cher f√ºr die Schrauben sind jedoch etwas tiefer und darunter befinden sich Schrauben, die das Geh√§use sichern.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebf/2c5/8e2/ebf2c58e270c942b8e360a744f0ff6ea.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die hintere Abdeckung entfernt haben, sehen wir, dass alle Schraubenl√∂cher Gewindeeins√§tze haben, in die die Schrauben eingeschraubt werden k√∂nnen. </font><font style="vertical-align: inherit;">Beeindruckend! </font><font style="vertical-align: inherit;">Dies sollte den L√∂chern einen ausreichenden Sicherheitsspielraum bieten. </font><font style="vertical-align: inherit;">Es ist m√∂glich, dass dies die Herstellung oder Demontage erheblich erschwert. </font><font style="vertical-align: inherit;">Letzteres wird durch die Tatsache erschwert, dass wir zuerst die Tropfen der geh√§rteten Silikonverbindung schneiden m√ºssen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ca/78c/bf2/4ca78cbf2e1f533658a361fd998a933a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Eins√§tze werden tats√§chlich mit anderen Kunststoffeins√§tzen befestigt; </font><font style="vertical-align: inherit;">Sie m√ºssen zuerst entfernt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe keine weiteren Fotos vom Demontageprozess, aber nach dieser Phase sehen Sie vier Schrauben, die gel√∂st werden m√ºssen, und dann wird der Prozess wie zuvor fortgesetzt. </font><font style="vertical-align: inherit;">Verstehen Sie, welches Kunststoffobjekt den Rest zusammenh√§lt, schneiden Sie die Silikonverbindung ab und entfernen Sie die Kunststoffbefestigungen. </font><font style="vertical-align: inherit;">Fahren Sie fort, bis Sie die Leiterplatte herausziehen k√∂nnen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e40/8c0/346/e408c0346ddbea872aa6100a7c37c303.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist es: die R√ºckseite der Leiterplatte. Wie sich herausstellte, besteht es aus zwei Leiterplatten: Die wei√üe hat zwei Seiten - auf der R√ºckseite befinden sich alle LED-Treiber (und eine weitere Leiterplatte ist daran angebracht) und auf der Vorderseite die LEDs selbst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die wei√üe Leiterplatte ist recht gut gestaltet: Anstelle einer LED-Matrix gibt es 16 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">SCT2024-</font></a><font style="vertical-align: inherit;"> LED-Treiber</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arbeiten mit Gleichstrom. Diese LED-Treiber haben 16 Kan√§le, dh jede LED wird direkt gesteuert. LED-Treiber k√∂nnen die LEDs nur vollst√§ndig ein- oder ausschalten. Die Treiber selbst haben keine native Graustufenunterst√ºtzung. Tats√§chlich f√ºhren sie eine Registerverschiebung unter Verwendung stromgesteuerter Ausg√§nge durch, und sie schalten alle nacheinander; Die gr√ºne PCB-Verbindungsschnittstelle besteht aus dem Synchronisationsbus und den Daten, einer Snap-Enable-Leitung, einer Ausgangs-, Masse- und Power-Enable-Leitung.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dieser gr√ºnen Tafel befindet sich das winzige Gehirn des Ger√§ts: ein Mikrocontroller, dessen Artikel bei Google nicht zu finden ist, und ein Operationsverst√§rker f√ºr das Mikrofon. </font><font style="vertical-align: inherit;">Interessanterweise gibt es Hinweise darauf, dass das Ger√§t mehr Funktionen haben sollte: Es gibt vermutlich Platz f√ºr das I2C EEPROM 24Cxx und einen Hinweis darauf, dass sich im urspr√ºnglichen Projekt ein IR-Empf√§nger auf der Vorderseite befand. </font><font style="vertical-align: inherit;">Vielleicht wurde angenommen, dass das Ger√§t mit einer Fernbedienung geliefert wird, mit der Sie Ihre eigenen Muster erstellen k√∂nnen? </font><font style="vertical-align: inherit;">Dies k√∂nnte erkl√§ren, dass die vorhandenen Animationen so langweilig aussehen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40f/a7a/1d9/40fa7a1d95a60af223eb12a5f5db7ba6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Vorderseite der wei√üen Tafel befinden sich alle LEDs. </font><font style="vertical-align: inherit;">Ein winziges flaches Mikrofon ist ebenfalls daran angel√∂tet. </font><font style="vertical-align: inherit;">Zuerst dachte ich, dass es auf die gr√ºne Tafel gel√∂tet ist und durch das Loch in der wei√üen Tafel herausragt, aber tats√§chlich ist es nur flach.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bb/613/620/2bb6136207e5ce1cf78895a6827a8dfd.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alle anderen elektronischen Ger√§te befinden sich auf der R√ºckseite der Platine. </font><font style="vertical-align: inherit;">Dort reicht es nicht aus: Nur ein Netzteil der Marke Ikea mit 4 V. Unter dem Netzteil befindet sich eine kleine Leiterplatte, auf der sich zwei Tastschalter f√ºr Tasten auf der R√ºckseite des Geh√§uses befinden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir also das Design ‚Äûoptimieren‚Äú m√∂chten, haben wir eine offensichtliche Schw√§che: Es ist besser, eine kleine Green Card durch einen Prozessor durch etwas St√§rkeres zu ersetzen.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir modifizieren Eisen</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich dachte, es k√∂nnte m√∂glich sein, das Ger√§t durch eine ESP-Cam zu ersetzen. Dies ist eine sehr g√ºnstige Karte (ca. 10 Euro) mit einem ESP32-WLAN / BT-Chip, mehreren Megabyte PSRAM und einem Kameramodul. Ich interessiere mich nicht sehr f√ºr Unterhaltungsmusik, ich wollte, dass das Ger√§t auf etwas Visuelles reagiert. Da im Frontend bereits ein Loch f√ºr den Empf√§nger vorhanden war, dachte ich, ich k√∂nnte es unter der Kamera verwenden. Ich muss auch ein Loch in die wei√üe Tafel bohren, wo sich das Mikrofon befindet. Gl√ºcklicherweise wird neben diesen jetzt unbrauchbaren Mikrofonspuren nur eine Spur der LED zerst√∂rt. Ich bohrte ein Loch und restaurierte die Strecke. Ich setzte die Platine vor√ºbergehend wieder ein und schaltete den W√ºrfel ein. Ich stellte sicher, dass alle LEDs noch funktionieren.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed1/c45/456/ed1c454569bc1fa6734a8c16bdfed1ae.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt hatte ich ein Board mit einem Bohrloch und konnte nur die ESP-Cam verbinden und mechanisch verbinden. Die Designer gaben freundlicherweise den Zweck aller Pads auf dem Siebdruck der gr√ºnen Tafel an, so dass ich fast nichts erraten musste. Da das Netzteil nur 4 V liefert, habe ich es direkt an den 3,3 V-Eingang des ESP-CAM-Chips angeschlossen. Ich musste dies tun, weil der Chip beim Anschlie√üen an den Vin 5V-Pin nicht starten wollte ... H√∂chstwahrscheinlich hat der LDO-Regler einen leicht hohen Spannungsabfall. Ich denke jetzt, dass es sich gelohnt hat, die Diode in Reihe mit einer 4-V-Quelle zu schalten, um 3,3-3,4 V zu erhalten, aber meine L√∂sung hat funktioniert. ESP32 ist ziemlich unpr√§tenti√∂s.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/021/93d/abe/02193dabe8880ceeea91807ec0a16d2f.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem ich alle Stecker gel√∂tet hatte, musste ich mich sowieso um die Mechanik k√ºmmern. </font><font style="vertical-align: inherit;">Es war ein ‚Äûschnelles und schmutziges‚Äú Projekt, und ich hatte bereits zuvor die ESP-Cam-Anschl√ºsse gel√∂tet. Um die Kamera auf das Loch auszurichten, konnte man mehrere Dichtungen und viel Epoxidharz verwenden.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e62/f14/364/e62f143645504bfd1636cab8fdb3cdf8.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dieser Operation blieb das letzte Problem bestehen: Die LEDs neben der Kamera leuchteten in ihrem Rahmenfenster und verursachten alle m√∂glichen seltsamen Artefakte. </font><font style="vertical-align: inherit;">Um sie zu beseitigen, habe ich zun√§chst eine kleine L√ºnette aus einem Aluminiumband geschnitten, um die Kamera vor direktem Licht zu sch√ºtzen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa7/1a8/1bb/fa71a81bb0a3131132885840f8186e85.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Schritt war das Auftragen von Acrylfarbe. </font><font style="vertical-align: inherit;">Dies ist ein Kunststoffeinsatz, auf dem sich alle Diffusoren befinden, durch den die LEDs leuchten. </font><font style="vertical-align: inherit;">Ich habe das Loch, in dem sich das Mikrofon befand, bereits vergr√∂√üert, um ein breiteres Rahmenfenster f√ºr die Kamera zu schaffen. Dies f√ºhrte jedoch zu einem weiteren Problem: Das Loch war zu auff√§llig und es fiel zu viel diffuses Licht auf die Kamera. </font><font style="vertical-align: inherit;">Ein Fleck schwarzer Acrylfarbe war in beiden Punkten ziemlich gut; </font><font style="vertical-align: inherit;">Die Kamera erhielt immer noch viel Licht von den LEDs, aber jetzt wurde sie nicht vollst√§ndig √ºberflutet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit ist die Gehirntransplantation abgeschlossen und der K√∂rper ist bereit f√ºr die Montage. </font><font style="vertical-align: inherit;">Sie k√∂nnen die Software starten.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fahren wir mit der Software fort. Zun√§chst m√ºssen wir die Kontrolle √ºber die LED-Treiber erlangen. Dies ist nicht schwierig: Die Treibersignale stimmen fast direkt mit der SPI-Peripherieschnittstelle des ESP32-Chips √ºberein: Das CLK-Pad auf der Karte ist mit der SPI-Peripherie-CLK-Schnittstelle verbunden, das DA-Pad auf der Karte ist mit dem MOSI des SPI-Signals verbunden. Auf diese Weise k√∂nnen Sie 256 Bit mit einer Kette von LED-Treibern synchronisieren: Jedes synchronisierte Bit steuert das Ein- oder Ausschalten der entsprechenden LED. Dar√ºber hinaus gibt es einen LAK-Eingang. Wenn das Signal niedrig ist, beh√§lt die LED ihren vorherigen Wert bei, unabh√§ngig davon, was in die Schieberegister √ºbertragen wurde. Wenn das Signal hoch ist, wechseln alle gleichzeitig zu den Werten, die sich derzeit im Schieberegister befinden. Schlie√ülich gibt es einen EN-Eingang, der alle LEDs ein- oder ausschaltet.Ich habe es nicht an GPIO angeschlossen und nur die LEDs programmgesteuert eingeschaltet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So kann ich jetzt einzelne LEDs ein- und ausschalten und ein Schwarzwei√ü-Display erhalten. Ich brauche jedoch noch etwas anderes. Bei ausreichender Rechenleistung sollte das Display auch Graustufen anzeigen k√∂nnen - dazu m√ºssen Sie die LEDs nur schneller ein- und ausschalten, als das Auge sieht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dies mit einer einzelnen LED zu implementieren, verwende ich normalerweise PWM, aber im Fall von 256 LEDs nimmt dies einen erheblichen Teil des ESP32-Prozessors ein. Also entschied ich mich stattdessen f√ºr die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin√§re Codemodulation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (auch Bitwinkelmodulation genannt). Dies ist eine Technik, mit der Sie Graustufen mit weniger CPU-Leistung erzielen k√∂nnen. Ich habe es bereits erfolgreich in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anderen Projekten verwendet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , daher war ich mir sicher, dass es funktionieren w√ºrde.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e99/009/265/e990092656bfd3db2032718f55e7e086.jpg"></div></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und es hat funktioniert. Ich habe auch eine Nachschlagetabelle hinzugef√ºgt, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um die CIE-Helligkeit in PWM umzuwandeln</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , da das Auge im Wesentlichen nicht linear auf die Helligkeit der LEDs reagiert. Nachschlagetabelle behebt dieses Problem. Am Ende gelang es mir, eine ausreichende Anzahl von Graustufen und eine lineare Skalierung der optischen Helligkeit gem√§√ü dem von mir festgelegten Pixelwert zu erreichen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Implementierung des Kameraprojekts war nicht schwierig: Es gibt eine ESP-IDF-Komponente, die dem Projekt hinzugef√ºgt werden kann. Er k√ºmmert sich um das Einrichten der Kamera und den Datenaustausch mit ihr. Sie m√ºssen nur die gew√ºnschten Parameter angeben und dann die Bitmap anfordern, die die Kamera sieht. Das einzige, was ich in der Standardeinstellung nicht verwenden konnte, war, dass die automatische Ausrichtung und die automatische Belichtung standardm√§√üig aktiviert waren. Dies beeintr√§chtigte meine Steuerung der LEDs erheblich: Je nachdem, in welchem ‚Äã‚ÄãTeil der Bin√§rcode-Modulationssequenz das Bild erstellt wurde, Die Kamera erh√∂hte oder verringerte die Ausrichtung und Belichtung eher zuf√§llig. Ich habe das Problem behoben, indem ich die Kamera auf manuelle Ausrichtung und Verschlusszeit umgestellt habe. Der Code selbst untersucht das Bild und bestimmt, ob diese Parameter kompensiert werden m√ºssen.Dank dieser manuellen Verarbeitung konnte ich auch Pixel ausschlie√üen, die direkt auf die LEDs blickten, um sie vollst√§ndig aus der Gleichung zu entfernen. Dies trug auch sehr dazu bei, ein stabiles Bild zu erhalten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt habe ich eine Kamera und eine 16x16 Leinwand in Graut√∂nen. Was soll ich mit ihnen machen? Ich hatte eine Idee: Zur Zeit der ersten Macintosh-Computer gab es eine beliebte Erweiterung, die der Men√ºleiste nur ein paar Comic-Augen hinzuf√ºgte. Diese Augen folgten einfach dem Cursor. (Eine Variation dieses Themas f√ºr Linux / Unix namens "xeyes" existiert noch.) Was ist, wenn ich versuche, es im wirklichen Leben zu wiederholen?</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d1/c9e/0a1/6d1c9e0a114c84f246c051c4358cdcc7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr den Anfang brauchte ich ein paar Bilder der Augen. Ich dachte nicht, dass ich etwas Wertvolles zeichnen k√∂nnte, also beschloss ich stattdessen, meine eigenen Augen als Grundbilder zu verwenden; Sehen Sie sich ein kurzes Video an, in dem ich in alle Richtungen schaue und blinzele. Es ist zu bedenken, dass ich aufgrund der aktuellen Situation nur sehr wenige professionelle Werkzeuge hatte: Ich liege auf dem Boden, um die Beleuchtung der Deckenleuchtstofflampen zu maximieren und ein lesbares Bild zu erhalten. Das gesamte Video wurde auf dem Smartphone aufgenommen, das ich in meinen H√§nden halte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die anf√§nglichen Daten ziemlich schlampig waren, musste ich hart an der Nachbearbeitung arbeiten. Ich begann damit, ein Fragment auszuschneiden, das ungef√§hr um mein rechtes Auge lag. Dann habe ich jedes Bild des Videos in ein Bild konvertiert und alle redundanten Bilder gel√∂scht. Am Ende hatte ich eine gute Auswahl an Bildern von mir, die in verschiedene Richtungen blickten, sowie ein paar Bilder mit einem Blinzeln. Da ich jedoch ein Mobiltelefon f√ºr die Aufnahme verwendet habe, stellte sich heraus, dass das Video etwas wackelig war und die Bilder √ºbersprungen wurden. Um dies zu beheben, habe ich eine Reihe von Bildern durch das </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">Hugin</font></a><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildkleberprogramm geleitet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die normalerweise f√ºr Panoramen und HDR-Bilder verwendet wird; Am Ausgang bekam ich Bilder, die idealerweise auf diesem Teil meines Gesichts zentriert waren. Jetzt konnte ich nur noch markieren, in welche Richtung ich schaute und ob ich blinzelte. Dazu habe ich zuerst alle Bilder in Graustufen konvertiert und sie dann auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gimp</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hochgeladen </font><font style="vertical-align: inherit;">. In jedem Bild habe ich einen roten Punkt verwendet, um die Position der Pupillenmitte anzuzeigen, sowie einen roten Punkt in der linken oder rechten Ecke, um anzuzeigen, ob ich blinke, und wenn ich blinke, ist mein Auge halb offen oder geschlossen.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb6/112/a73/bb6112a73c7b9fbdb619afaff1b971c9.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem jedes Bild auf diese Weise markiert wurde, war es sehr einfach, ein Skript zu schreiben, um den Standort der Pupille sowie den Blinkzustand zu ermitteln. Das Skript skalierte die Bilder auch auf 16 x 16 und speicherte sie als bin√§re Rohdaten, die zum Schreiben in die Firmware des ESP-CAM-Moduls bereit waren. Am Ende bekam ich eine Reihe von Bildern und einen Index dar√ºber, wo sich die Pupille befindet und in welchem ‚Äã‚ÄãZustand das Auge blinkt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die ESP-Cam verf√ºgt √ºber eine recht einfach zu verwendende Kamerabibliothekskomponente f√ºr die ESP-IDF, sodass das Abrufen von Bildern einfach war. Ich habe das Aufnehmen von 120x160-Bildern in Graustufen eingerichtet, da diese am einfachsten zu verarbeiten sind und ich nicht viel Aufl√∂sung ben√∂tigte, da das Endergebnis auf einem 16x16-Bildschirm angezeigt werden sollte. Ich hatte jedoch immer noch ein Hardwareproblem: Die Kamera befindet sich immer noch zu nahe an den LEDs.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb1/d78/621/cb1d786213e7450791968f0e7da4d6c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuerst habe ich versucht, es durch Kalibrierung zu l√∂sen: Wenn das Ger√§t startet, werden zwei Bilder aufgenommen: eines mit einer LED in der N√§he des Kameraobjektivs und eines nur mit einer LED, die sich weit von der Kamera entfernt befindet. Wenn Sie ein Bild von einem anderen subtrahieren, k√∂nnen Sie verstehen, welche Pixel von LEDs betroffen sind. Diese Pixel werden in der Maske gespeichert. In der Maske markierte Pixel werden anschlie√üend ignoriert. Das Bild oben zeigt zwei Aufnahmen und eine Maske.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einem saubereren Bild k√∂nnte ich zur Bewegungserkennung √ºbergehen. Ich habe es implementiert, indem ich ein Bild von der Kamera abgerufen und das vorherige Bild davon subtrahiert habe. Dann konnte ich die Bewegungsmenge berechnen, indem ich alle resultierenden Pixel addierte. Ferner war es m√∂glich, den Ort der Bewegungskonzentration zu berechnen, indem der Durchschnitt der Koordinaten aller Pixel genommen wurde, gewichtet mit der Differenz der Bilder in diesem Pixel. Am Ende wird die Filtermagie ausgef√ºhrt, damit das Ger√§t nicht wie ein Jack Russell Terrier mit ADHS herumgerissen aussieht: Um seine Aufmerksamkeit zu erregen, m√ºssen sich Objekte entweder gleichm√§√üiger oder weit genug bewegen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gab nur ein Problem: Wenn es sehr dunkel war, arbeitete der Bewegungserkennungsalgorithmus manchmal an der Reflexion von LEDs an gl√§nzenden Objekten im Raum: Wenn das Auge blinzelte, achten Sie auf seine eigene Reflexion. </font><font style="vertical-align: inherit;">Dies ist nicht ganz das, was ich wollte, also habe ich dieses Problem umgangen, indem ich den Bewegungserkennungsalgorithmus beim √Ñndern des Bildes auf den LEDs ‚Äûblind‚Äú gemacht habe. </font><font style="vertical-align: inherit;">Also habe ich dieses Verhalten gestoppt. </font><font style="vertical-align: inherit;">Dar√ºber hinaus ist es auch etwas realistischer: Wenn Sie blinken, k√∂nnen Sie nicht sehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Firmware verf√ºgt √ºber mehrere Debugging-Modi, die den gesamten Prozess demonstrieren. </font><font style="vertical-align: inherit;">Hier ist ein kurzes Video, das dies veranschaulicht:</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bR-CpMdz02I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt habe ich also ein Ger√§t, das mir folgt ... nicht wirklich n√ºtzlich, da stimme ich zu. </font><font style="vertical-align: inherit;">Aber es war interessant f√ºr mich, es zu erstellen, und wenn ich jemals etwas N√ºtzlicheres finde, das auf einem 16x16-LED-Bildschirm implementiert werden kann, kann ich es tun, weil ich bereits einen Steuercode habe. </font><font style="vertical-align: inherit;">Apropos Code: Sie k√∂nnen mein Rohergebnis </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kostenlos herunterladen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Hoffe es hat euch gefallen und passt auf euch auf.</font></font><br>
<br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UCPUPO21Cwk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de495168/index.html">Eine alternative Form des tern√§ren Python-Operators</a></li>
<li><a href="../de495170/index.html">Was vor√ºbergehend aus unserem Leben verschwand und auf dessen R√ºckkehr es sich nicht lohnt zu warten - eine Diskussion</a></li>
<li><a href="../de495174/index.html">Professionell freiberuflich t√§tig</a></li>
<li><a href="../de495176/index.html">Serialisierung von Objekten in Kotlin ein f√ºr alle Mal korrigieren</a></li>
<li><a href="../de495178/index.html">Es ist Zeit f√ºr kostenlose Websites</a></li>
<li><a href="../de495184/index.html">Die Schwierigkeiten der Importsubstitution: Ein Tool f√ºr staatliche Unternehmen wird aus dem Register der inl√§ndischen Software entfernt</a></li>
<li><a href="../de495188/index.html">Schwierigkeiten beim Unterrichten von Fremdsprachen (ich w√ºrde es auch den Studenten empfehlen)</a></li>
<li><a href="../de495192/index.html">Das perfekte Startskript f√ºr den Minecraft-Server</a></li>
<li><a href="../de495194/index.html">STM-32 Minimum Audio Board</a></li>
<li><a href="../de495196/index.html">Wenn der IB einen ‚ÄûDarwin Award‚Äú oder 7 Geschichten √ºber Dummheit, M√ºll, Leichtgl√§ubigkeit und ihre Folgen h√§tte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>