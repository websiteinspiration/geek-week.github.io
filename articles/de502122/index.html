<!doctype html>
<html class="no-js" lang="de">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌍 🌵 📣 Thanos - Skalierbarer Prometheus 🚶🏽 🧜🏼 🚘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Übersetzung des Artikels wurde speziell für Studenten des Kurses "DevOps Practices and Tools" erstellt .
 
 
 
  (Fabian Reinartz) — , Go . Promet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Thanos - Skalierbarer Prometheus</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/502122/"><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Übersetzung des Artikels wurde speziell für Studenten des Kurses </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"DevOps Practices and Tools" erstellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i></b><br>
<br>
<img src="https://habrastorage.org/webt/hn/yb/6z/hnyb6zs1kjgdaigpvcdypntr4yo.png"><br>
<hr><br>
<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  (Fabian Reinartz)</a> —   ,  Go     .    Prometheus   Kubernetes SIG instrumentation.     production-  SoundCloud      CoreOS.      Google.<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  (Bartek Plotka)</a> —    Improbable.       .      Intel,    Mesos  production- SRE    Improbable.    .   : Golang, open source  .</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie sich unser Flaggschiff-Produkt SpatialOS ansehen, können Sie davon ausgehen, dass Improbable eine hochdynamische globale Cloud-Infrastruktur mit Dutzenden von Kubernetes-Clustern benötigt. Wir waren einer der ersten, die das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prometheus-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Überwachungssystem verwendeten </font><font style="vertical-align: inherit;">. Prometheus kann Millionen von Metriken in Echtzeit verfolgen und verfügt über eine leistungsstarke Abfragesprache, um die erforderlichen Informationen abzurufen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Einfachheit und Zuverlässigkeit Prometheus ist einer seiner Hauptvorteile. Nachdem wir jedoch eine bestimmte Skala überschritten hatten, stießen wir auf mehrere Nachteile. Um diese Probleme zu lösen, haben wir </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Thanos</font></a><font style="vertical-align: inherit;"> entwickelt</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ein Open-Source-Projekt von Improbable, mit dem vorhandene Prometheus-Cluster nahtlos in ein einziges Überwachungssystem mit einem unbegrenzten Repository historischer Daten umgewandelt werden können. </font><font style="vertical-align: inherit;">Thanos ist </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf Github erhältlich </font><font style="vertical-align: inherit;">.</font></font><a name="habracut"></a><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bleiben Sie mit den neuesten Nachrichten von Improbable auf dem Laufenden.</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unsere Ziele mit Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ab einem bestimmten Ausmaß treten Probleme auf, die über die Fähigkeiten des Vanille-Prometheus hinausgehen. </font><font style="vertical-align: inherit;">Wie können Petabytes historischer Daten zuverlässig und wirtschaftlich gespeichert werden? </font><font style="vertical-align: inherit;">Kann dies unbeschadet der Antwortzeit auf die Anfrage erfolgen? </font><font style="vertical-align: inherit;">Ist es möglich, mit einer einzigen API-Anfrage auf alle Metriken zuzugreifen, die sich auf verschiedenen Prometheus-Servern befinden? </font><font style="vertical-align: inherit;">Ist es möglich, die mit Prometheus HA gesammelten replizierten Daten irgendwie zu kombinieren? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um diese Probleme zu beheben, haben wir Thanos erstellt. </font><font style="vertical-align: inherit;">In den folgenden Abschnitten wird beschrieben, wie wir diese Probleme angegangen sind, und die von uns verfolgten Ziele erläutert.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abfragen von Daten aus mehreren Prometheus-Instanzen (globale Abfrage)</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus bietet einen funktionalen Ansatz für das Splittern. Selbst ein Prometheus-Server bietet eine ausreichende Skalierbarkeit, um Benutzer in fast allen Anwendungsfällen von den Schwierigkeiten des horizontalen Shardings zu befreien. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obwohl dies ein hervorragendes Bereitstellungsmodell ist, ist es häufig erforderlich, über eine einzige API- oder UI-globale Ansicht auf Daten auf verschiedenen Prometheus-Servern zuzugreifen. Natürlich ist es möglich, mehrere Anforderungen in einem Grafana-Bedienfeld anzuzeigen, aber jede Anforderung kann nur auf einem Prometheus-Server ausgeführt werden. Andererseits können Sie mit Thanos Daten von mehreren Prometheus-Servern abfragen und aggregieren, da alle von einem Endpunkt aus zugänglich sind. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zuvor hatten wir unsere Prometheus-Instanzen auf mehreren Ebenen organisiert, um einen globalen Überblick über Improbable zu erhalten</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hierarchische Föderation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies bedeutete, einen Prometheus-Metaserver zu erstellen, der einen Teil der Metriken von jedem Blattserver sammelt. Dies </font></font><br>
<br>
<img src="https://habrastorage.org/webt/pv/0j/w3/pv0jw3yhsdl31rqexmamjdx4tiy.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
erwies sich als problematisch, komplizierte die Konfiguration, fügte einen zusätzlichen potenziellen Fehlerpunkt hinzu und wandte komplexe Regeln an, um dem Verbundendpunkt genau die richtigen Daten bereitzustellen. Darüber hinaus können Sie mit einem solchen Verbund keine echte globale Ansicht erhalten, da nicht alle Daten über eine API-Anforderung zugänglich sind.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eng damit verbunden ist die einmalige Darstellung der auf den Prometheus-Hochverfügbarkeitsservern (HA) gesammelten Daten. Das Prometheus HA-Modell sammelt unabhängig voneinander zweimal Daten, was so einfach ist, dass es nicht einfacher sein könnte. Die Verwendung einer kombinierten und deduplizierten Darstellung beider Threads wäre jedoch viel praktischer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich werden hochverfügbare Prometheus-Server benötigt. Bei Improbable nehmen wir es wirklich ernst, Daten jede Minute zu überwachen, aber eine Instanz von Prometheus pro Cluster zu haben, ist eine einzige Fehlerquelle. Jeder Konfigurationsfehler oder Hardwarefehler kann möglicherweise zum Verlust wichtiger Daten führen. Selbst einfache Bereitstellungen können zu geringfügigen Störungen bei der Erfassung von Metriken führen, da der Neustart erheblich länger als das Scraping-Intervall sein kann.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuverlässige Speicherung historischer Daten</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Günstige, schnelle und langfristige Speicherung von Metriken ist unser Traum (von den meisten Prometheus-Benutzern geteilt). </font><font style="vertical-align: inherit;">In Improbable mussten wir die Speicherdauer für die Metriken auf neun Tage festlegen (für Prometheus 1.8). </font><font style="vertical-align: inherit;">Dies fügt offensichtliche Einschränkungen hinzu, wie weit wir zurückblicken können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus 2.0 ist in dieser Hinsicht besser, da die Anzahl der Zeitreihen die Gesamtserverleistung nicht mehr beeinflusst (siehe </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KubeCon-Keynote zu Prometheus 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Prometheus speichert jedoch Daten auf einem lokalen Laufwerk. </font><font style="vertical-align: inherit;">Obwohl eine hocheffiziente Datenkomprimierung die Verwendung lokaler SSDs erheblich reduzieren kann, ist die Menge der gespeicherten Verlaufsdaten letztendlich immer noch begrenzt.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Improbable legen wir auch Wert auf Zuverlässigkeit, Einfachheit und Kosten. </font><font style="vertical-align: inherit;">Große lokale Laufwerke sind schwieriger zu bedienen und zu sichern. </font><font style="vertical-align: inherit;">Sie sind teurer und erfordern mehr Backup-Tools, was zu unnötiger Komplexität führt.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Downsampling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als wir anfingen, mit historischen Daten zu arbeiten, stellten wir fest, dass es bei O-big grundlegende Schwierigkeiten gibt, die Abfragen immer langsamer machen, wenn wir über Wochen, Monate und Jahre mit Daten arbeiten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eine Standardlösung für dieses Problem ist das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Downsampling</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - das Downsampling des Signals. </font><font style="vertical-align: inherit;">Durch Downsampling können wir auf einen größeren Zeitbereich „verkleinern“ und die gleiche Anzahl von Samples beibehalten, wodurch wir die Reaktionsfähigkeit von Anforderungen beibehalten können. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Downsampling alter Daten ist eine unvermeidliche Voraussetzung für eine Langzeitspeicherlösung und geht über Vanilla Prometheus hinaus.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zusätzliche Ziele</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eines der ersten Ziele des Thanos-Projekts war die nahtlose Integration in vorhandene Prometheus-Installationen. </font><font style="vertical-align: inherit;">Das zweite Ziel war eine einfache Bedienung mit einer minimalen Eintrittsbarriere. </font><font style="vertical-align: inherit;">Abhängigkeiten sollten sowohl für kleine als auch für große Benutzer leicht zu erfüllen sein, was auch niedrige Grundkosten impliziert.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos Architektur</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem unsere Ziele im vorherigen Abschnitt aufgeführt wurden, arbeiten wir daran und sehen, wie Thanos diese Probleme löst.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globale Sicht</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um eine globale Übersicht über vorhandene Instanzen von Prometheus zu erhalten, müssen wir allen Servern einen einzelnen Anforderungseinstiegspunkt zuordnen. Genau das leistet die Thanos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sidecar-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Komponente </font><font style="vertical-align: inherit;">. Es wird neben jedem Prometheus-Server bereitgestellt und fungiert als Proxy, der lokale Prometheus-Daten über die gRPC-Schnittstelle des Stores bereitstellt und es Ihnen ermöglicht, Zeitreihendaten nach Bezeichnung und Zeitbereich auszuwählen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der anderen Seite gibt es eine zustandslose, horizontal skalierbare Querier-Komponente, die etwas mehr kann als nur auf PromQL-Anfragen über die Standard-Prometheus-HTTP-API zu antworten. Komponenten Querier, Sidecar und andere Thanos kommunizieren über </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">das Klatschprotokoll</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<img src="https://habrastorage.org/webt/1p/zn/ts/1pzntsrxrwhxxvdou57tpxhypwm.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Abfrager stellt nach Erhalt der Anforderung eine Verbindung zum entsprechenden Store-API-Server, dh zu unserem Sidecar, her und empfängt Zeitreihendaten von den entsprechenden Prometheus-Servern.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Danach werden die Antworten kombiniert und eine PromQL-Abfrage durchgeführt. </font><font style="vertical-align: inherit;">Querier kann sowohl disjunkte Daten als auch doppelte Daten von Prometheus HA-Servern kombinieren.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies löst den Großteil unseres Rätsels - die Kombination von Daten von isolierten Prometheus-Servern in einer einzigen Ansicht. </font><font style="vertical-align: inherit;">Tatsächlich kann Thanos nur für diese Gelegenheit verwendet werden. </font><font style="vertical-align: inherit;">Bestehende Prometheus-Server müssen keine Änderungen vornehmen!</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unbegrenzte Haltbarkeit!</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Früher oder später möchten wir jedoch Daten speichern, die über die normale Speicherzeit von Prometheus hinausgehen. Um historische Daten zu speichern, haben wir die Objektspeicherung ausgewählt. Es ist in jeder Cloud sowie in lokalen Rechenzentren weit verbreitet und sehr wirtschaftlich. Darüber hinaus kann über die bekannte S3-API auf nahezu jeden Objektspeicher zugegriffen werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prometheus schreibt ungefähr alle zwei Stunden Daten aus dem RAM auf die Festplatte. Der Block gespeicherter Daten enthält alle Daten für einen festgelegten Zeitraum und ist unveränderlich. Dies ist sehr praktisch, da Thanos Sidecar einfach den Prometheus-Datenkatalog einsehen und diese, sobald neue Blöcke angezeigt werden, in die Objektspeicher-Buckets laden kann.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/ss/l6/lh/ssl6lhmk5kyfwe0luqcsbpe8z9w.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durch das Herunterladen in den Objektspeicher unmittelbar nach dem Schreiben auf eine Festplatte können Sie auch die Einfachheit eines „Scraper“ (Prometheus und Thanos Sidecar) beibehalten. Dies vereinfacht den Support, die Kosten und das Systemdesign. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen, ist das Sichern von Daten sehr einfach. Aber was ist mit der Abfrage von Daten im Objektspeicher? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Thanos Store-Komponente fungiert als Proxy zum Abrufen von Daten aus dem Objektspeicher. Wie Thanos Sidecar nimmt es am Klatschcluster teil und implementiert die Store-API. Daher kann der vorhandene Querier es als Sidecar als weitere Quelle für Zeitreihendaten betrachten - es ist keine spezielle Konfiguration erforderlich.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/vq/n_/pl/vqn_pl2z-oq1-m1yiix-y-tgvwc.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zeitreihendatenblöcke bestehen aus mehreren großen Dateien. Das Herunterladen bei Bedarf wäre ziemlich ineffizient, und das lokale Caching erforderte großen Speicher und Speicherplatz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Stattdessen weiß Store Gateway, wie mit dem Prometheus-Speicherformat umgegangen wird. Dank des cleveren Abfrageplaners und des Zwischenspeicherns nur der erforderlichen Indexteile der Blöcke konnten komplexe Abfragen auf die minimale Anzahl von HTTP-Anforderungen an Objektspeicherdateien reduziert werden. Somit ist es möglich, die Anzahl von Anforderungen um vier bis sechs Größenordnungen zu reduzieren und Antwortzeiten zu erzielen, die im Allgemeinen schwer von Datenanforderungen auf einer lokalen SSD zu unterscheiden sind.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/qx/c-/hv/qxc-hvkg1llfi9oaoee6uxtla9c.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie im obigen Diagramm gezeigt, reduziert Thanos Querier die Kosten einer einzelnen Datenanforderung im Objektspeicher erheblich, indem das Prometheus-Speicherformat verwendet und zugehörige Daten nebeneinander platziert werden. </font><font style="vertical-align: inherit;">Mit diesem Ansatz können wir viele einzelne Abfragen zu einer minimalen Anzahl von Massenoperationen kombinieren.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verdichtung und Downsampling</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem der neue Zeitreihendatenblock erfolgreich in den Objektspeicher geladen wurde, betrachten wir ihn als "historische" Daten, die sofort über das Store Gateway verfügbar werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach einer Weile sammeln sich jedoch Blöcke aus einer Quelle (Prometheus mit Beiwagen) an und nutzen nicht mehr das volle Indexierungspotential. Um dieses Problem zu lösen, haben wir eine weitere Komponente namens Compactor eingeführt. Es wendet einfach den lokalen Prometheus-Komprimierungsmechanismus auf historische Daten im Objektspeicher an und kann als einfacher periodischer Stapeljob ausgeführt werden.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/lp/wt/sy/lpwtsym1qftrslmkks3fre9q2o8.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dank der effizienten Komprimierung verursacht eine Abfrage im Repository über einen längeren Zeitraum keine Probleme hinsichtlich der Datengröße. Die potenziellen Kosten für das Entpacken und Durchlaufen einer Milliarde Werte durch einen Abfrageprozessor führen jedoch zwangsläufig zu einer starken Verlängerung der Ausführungszeit für Abfragen. Andererseits gibt es, da es Hunderte von Datenpunkten pro Pixel des Bildschirms gibt, unmöglich, die Daten in voller Auflösung zu visualisieren. Downsampling ist also nicht nur möglich, sondern führt auch nicht zu einem spürbaren Genauigkeitsverlust.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/xm/ju/gh/xmjughzg4svkzo0behzid9tt02s.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für das Downsampling von Daten aggregiert Compactor kontinuierlich Daten mit einer Auflösung von fünf Minuten und einer Stunde. Für jedes Rohfragment, das mit TSDB XOR-Komprimierung codiert wurde, werden verschiedene Arten von aggregierten Daten gespeichert, z. B. min, max oder sum für einen Block. Dadurch kann Querier automatisch das Aggregat auswählen, das für diese PromQL-Abfrage geeignet ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um Daten mit reduzierter Genauigkeit zu verwenden, benötigt der Benutzer keine spezielle Konfiguration. Der Querier wechselt automatisch zwischen verschiedenen Auflösungen und Rohdaten, wenn der Benutzer ein- und auszoomt. Falls gewünscht, kann der Benutzer dies direkt über den Parameter "step" in der Anforderung steuern.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da die Kosten für die Speicherung von einem GB gering sind, speichert Thanos standardmäßig die Originaldaten, Daten mit einer Auflösung von fünf Minuten und einer Stunde. </font><font style="vertical-align: inherit;">Die Originaldaten müssen nicht gelöscht werden.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufnahmeregeln</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auch mit Thanos sind Aufzeichnungsregeln ein wesentlicher Bestandteil des Überwachungsstapels. </font><font style="vertical-align: inherit;">Sie reduzieren die Komplexität, Latenz und Kosten von Anfragen. </font><font style="vertical-align: inherit;">Sie sind auch praktisch für Benutzer, um aggregierte Metrikdaten zu erhalten. </font><font style="vertical-align: inherit;">Thanos basiert auf Vanille-Instanzen von Prometheus, daher ist es durchaus akzeptabel, Aufzeichnungsregeln und Warnregeln auf einem vorhandenen Prometheus-Server zu speichern. </font><font style="vertical-align: inherit;">In einigen Fällen reicht dies jedoch möglicherweise nicht aus:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globale Warnungen und Regeln (z. B. Warnungen, wenn ein Dienst auf mehr als zwei der drei Cluster ausfällt).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regel für Daten außerhalb des lokalen Speichers.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Wunsch, alle Regeln und Wachsamkeit an einem Ort zu halten.</font></font></li>
</ul><br>
<img src="https://habrastorage.org/webt/wu/da/bf/wudabfepzgopbamehs1hqzx5s7o.jpeg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In all diesen Fällen enthält Thanos eine separate Komponente namens Ruler, die Regeln und Warnungen über Thanos-Abfragen berechnet. </font><font style="vertical-align: inherit;">Durch die Bereitstellung der bekannten StoreAPI kann der Abfrageknoten auf frisch berechnete Metriken zugreifen. </font><font style="vertical-align: inherit;">Später werden sie auch im Objektspeicher gespeichert und über das Store Gateway verfügbar gemacht.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Kraft von Thanos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Thanos ist flexibel genug, um an Ihre Anforderungen angepasst zu werden. </font><font style="vertical-align: inherit;">Dies ist besonders nützlich, wenn Sie von einem einfachen Prometheus migrieren. </font><font style="vertical-align: inherit;">Lassen Sie uns einen kurzen Blick darauf werfen, was wir über die Komponenten von Thanos gelernt haben. </font><font style="vertical-align: inherit;">So übertragen Sie Ihren Vanille-Prometheus in die Welt des „unbegrenzten Metrikspeichers“:</font></font><br>
<br>
<img src="https://habrastorage.org/webt/d-/y0/cn/d-y0cnjpddmhvlfbw-8c7fvqt7o.jpeg"><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fügen Sie Thanos Sidecar zu Ihren Prometheus-Servern hinzu - zum Beispiel den angrenzenden Container im Kubernetes-Pod.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweitern Sie mehrere Thanos Querier-Replikate, um Daten anzuzeigen. </font><font style="vertical-align: inherit;">An diesem Punkt ist es einfach, Klatsch und Tratsch zwischen Scraper und Querier einzurichten. </font><font style="vertical-align: inherit;">Verwenden Sie die Metrik 'thanos_cluster_members', um Komponenteninteraktionen zu testen.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nur diese beiden Schritte reichen aus, um eine globale Ansicht und eine nahtlose Datendeduplizierung von potenziellen Prometheus HA-Replikaten bereitzustellen! </font><font style="vertical-align: inherit;">Verbinden Sie einfach Ihre Dashboards mit dem Querier-HTTP-Endpunkt oder verwenden Sie die Thanos-Benutzeroberfläche direkt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie jedoch Metriken und Langzeitspeicher sichern müssen, müssen Sie drei weitere Schritte ausführen:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie einen AWS S3- oder GCS-Bucket. </font><font style="vertical-align: inherit;">Konfigurieren Sie Sidecar so, dass Daten in diese Buckets kopiert werden. </font><font style="vertical-align: inherit;">Jetzt können Sie die lokale Datenspeicherung minimieren.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweitern Sie das Store Gateway und verbinden Sie es mit einem vorhandenen Klatschcluster. </font><font style="vertical-align: inherit;">Jetzt können Sie Datenanfragen in Backups senden!</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie Compactor bereit, um die Abfrageleistung über lange Zeiträume mithilfe von Komprimierung und Downsampling zu verbessern.</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie mehr wissen wollen, können Sie bei uns sehen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiele für die manifest Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beginnen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In nur fünf Schritten haben wir Prometheus zu einem zuverlässigen Überwachungssystem mit globaler Sicht, unbegrenzter Speicherzeit und potenziell hoher Verfügbarkeit von Metriken gemacht.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pull Anfrage: Wir brauchen dich!</font></font></h3><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> war von Anfang an ein Open Source Projekt. </font><font style="vertical-align: inherit;">Die nahtlose Integration mit Prometheus und die Möglichkeit, nur einen Teil von Thanos zu verwenden, machen es zu einer hervorragenden Wahl für die Skalierung eines Überwachungssystems ohne zusätzlichen Aufwand. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir freuen uns immer über GitHub Pull Request und Issues. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zögern</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie </font><font style="vertical-align: inherit;">nicht, uns über Github Issues oder Slack </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Improbable-eng #thanos zu kontaktieren,</font></a><font style="vertical-align: inherit;"> wenn Sie Fragen oder Feedback haben oder Ihre Erfahrungen teilen möchten! </font><font style="vertical-align: inherit;">Wenn Ihnen unsere Arbeit bei Improbable gefällt, können Sie sich gerne an uns wenden - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir haben immer freie Stellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !</font></font><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfahren Sie mehr über den Kurs.</font></font><br>
</a><br>
<hr></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de502104/index.html">Der Sekretär Roboter, Bot Informant, Bot Therapeut und andere Projekte des Online Hackathons VirusHack</a></li>
<li><a href="../de502114/index.html">Spiel der Motivationen. Teil 1</a></li>
<li><a href="../de502116/index.html">Übersicht über die Funktionen von PVS-Studio Version 7.07</a></li>
<li><a href="../de502118/index.html">Design auf Systemebene. Teil 3: Verknüpfung von System Composer und der MathWorks Toolchain</a></li>
<li><a href="../de502120/index.html">Fernüberwachung und Diagnose von Produktionsanlagen</a></li>
<li><a href="../de502124/index.html">2019 Venture-Ergebnisse für die Ukraine</a></li>
<li><a href="../de502126/index.html">So verbessern Sie Ihren Lebenslauf für Englischprogrammierer</a></li>
<li><a href="../de502132/index.html">So übertragen Sie den OpenVZ 6-Container ohne Kopfschmerzen auf den KVM-Server</a></li>
<li><a href="../de502134/index.html">Genug, um Angst vor subjektiv schönen Entscheidungen im Code zu haben - Sie sind keine Roboter</a></li>
<li><a href="../de502136/index.html">Datenkomprimierung in Apache Ignite. Sberbank Erfahrung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>