<!doctype html>
<html class="no-js" lang="es">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöó üò¥ ‚úåüèæ Compresi√≥n de datos en Apache Ignite. Experiencia Sberbank üå™Ô∏è üåª üë°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando se trabaja con grandes vol√∫menes de datos, a veces el problema del espacio insuficiente en el disco puede agravarse. Una forma de resolver este...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Compresi√≥n de datos en Apache Ignite. Experiencia Sberbank</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/502136/"><img src="https://habrastorage.org/webt/cl/nj/sz/clnjsz90dmzkkj3wr4vuusu_-nu.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se trabaja con grandes vol√∫menes de datos, a veces el problema del espacio insuficiente en el disco puede agravarse. </font><font style="vertical-align: inherit;">Una forma de resolver este problema es la compresi√≥n, debido a que, en el mismo equipo, puede permitirse aumentar los vol√∫menes de almacenamiento. </font><font style="vertical-align: inherit;">En este art√≠culo, veremos c√≥mo funciona la compresi√≥n de datos en Apache Ignite. </font><font style="vertical-align: inherit;">Este art√≠culo describir√° solo los m√©todos de compresi√≥n de disco implementados dentro del producto. </font><font style="vertical-align: inherit;">Otros m√©todos de compresi√≥n de datos (a trav√©s de la red, en la memoria), tanto implementados como no, permanecer√°n fuera del alcance. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, cuando el modo de persistencia est√° activado, como resultado del cambio de datos en cach√©s, Ignite comienza a escribir en el disco:</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contenido de cach√©</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escribir registro anticipado (en lo sucesivo, WAL)</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un mecanismo llamado compactaci√≥n WAL ha existido durante mucho tiempo para comprimir los WAL. </font><font style="vertical-align: inherit;">El recientemente lanzado Apache Ignite 2.8 introdujo dos mecanismos m√°s para comprimir datos en el disco: compresi√≥n de p√°gina de disco para comprimir el contenido de cach√©s y compresi√≥n de instant√°nea de p√°gina WAL para comprimir algunos registros WAL. </font><font style="vertical-align: inherit;">M√°s informaci√≥n sobre todos estos tres mecanismos a continuaci√≥n.</font></font><a name="habracut"></a><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compresi√≥n de p√°gina de disco</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo funciona</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para empezar, nos detendremos brevemente en c√≥mo Ignite almacena los datos. Para el almacenamiento, se utiliza la memoria de p√°gina. El tama√±o de la p√°gina se establece al comienzo del nodo y no se puede cambiar en etapas posteriores, tambi√©n el tama√±o de la p√°gina debe ser una potencia de dos y un m√∫ltiplo del tama√±o del bloque del sistema de archivos. Las p√°ginas se cargan en la RAM desde el disco seg√∫n sea necesario, el tama√±o de los datos en el disco puede exceder la cantidad de RAM asignada. Si no hay suficiente espacio en la RAM para cargar p√°ginas desde el disco, las p√°ginas viejas no utilizadas se ver√°n obligadas a salir de la RAM.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los datos se almacenan en el disco de la siguiente forma: se crea un archivo separado para cada partici√≥n de cada grupo de cach√©, en este archivo, en orden ascendente de √≠ndice, las p√°ginas van una tras otra. El identificador de p√°gina completo contiene el identificador de grupo de cach√©, el n√∫mero de partici√≥n y el √≠ndice de p√°gina en el archivo. Por lo tanto, mediante el identificador de p√°gina completa, podemos identificar de manera √∫nica el archivo y el desplazamiento en el archivo para cada p√°gina. Puede leer m√°s sobre la memoria de la p√°gina en un art√≠culo en Apache Ignite Wiki: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite Persistent Store, bajo el cap√≥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El mecanismo de compresi√≥n de la p√°gina del disco, como su nombre indica, funciona a nivel de p√°gina. </font><font style="vertical-align: inherit;">Cuando se activa este mecanismo, el trabajo con datos en RAM se realiza tal cual, sin ninguna compresi√≥n, pero al momento de guardar las p√°ginas de la RAM en el disco, se comprimen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero comprimir cada p√°gina individualmente no es una soluci√≥n al problema, debe reducir de alguna manera el tama√±o de los archivos de datos resultantes. </font><font style="vertical-align: inherit;">Si el tama√±o de la p√°gina deja de fijarse, ya no podemos escribir p√°ginas en un archivo una por una, ya que esto puede dar lugar a una serie de problemas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No podemos usar el √≠ndice de p√°gina para calcular el desplazamiento en el que se encuentra en el archivo.</font></font></li>
<li> ,    ,          .    ,     .    ,         .</li>
<li>           ,      ,        ,      .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para no resolver estos problemas a su propio nivel, la compresi√≥n de p√°ginas de disco en Apache Ignite utiliza un mecanismo de sistema de archivos llamado archivos dispersos. Un archivo disperso es un archivo en el que algunas regiones llenas de ceros se pueden marcar como "agujeros". En este caso, no se asignar√°n bloques del sistema de archivos para almacenar estos agujeros, como resultado de lo cual se ahorrar√° espacio en disco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es l√≥gico que para liberar el bloque del sistema de archivos, el tama√±o del agujero debe ser mayor o igual que el bloque del sistema de archivos, lo que impone una restricci√≥n adicional en el tama√±o de p√°gina de Apache Ignite: para que la compresi√≥n tenga al menos alg√∫n efecto, el tama√±o de la p√°gina debe ser estrictamente mayor que el tama√±o del bloque del sistema de archivos . Si el tama√±o de la p√°gina es igual al tama√±o del bloque, entonces nunca podremos liberar un solo bloque, ya que para liberar un solo bloque necesitamos una p√°gina comprimida para ocupar 0 bytes. Si el tama√±o de la p√°gina es igual al tama√±o de 2 o 4 bloques, ya podemos liberar al menos un bloque si nuestra p√°gina est√° comprimida al menos al 50% o 75%, respectivamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, la descripci√≥n final del mecanismo: al escribir una p√°gina en el disco, se intenta comprimir la p√°gina. Si el tama√±o de la p√°gina comprimida permite liberar uno o m√°s bloques del sistema de archivos, entonces la p√°gina se escribe en forma comprimida, se perfora un "agujero" en lugar de los bloques liberados (se realiza una llamada al sistema </font></font><code>fallocate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con el indicador de "agujero perforado"). Si el tama√±o de la p√°gina comprimida no permite liberar bloques, la p√°gina se guarda como est√°, en forma no comprimida. Todos los desplazamientos de p√°gina se consideran, as√≠ como sin compresi√≥n, multiplicando el √≠ndice de p√°gina por el tama√±o de p√°gina. No se requiere reubicaci√≥n de p√°ginas. Los desplazamientos de p√°gina, as√≠ como sin compresi√≥n, caen en los l√≠mites de los bloques del sistema de archivos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/-l/0f/3x/-l0f3xzxozvrxefbiauxdivslv0.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la implementaci√≥n actual, Ignite solo puede trabajar con archivos dispersos en el sistema operativo Linux, por lo que la compresi√≥n de la p√°gina del disco solo se puede habilitar cuando se usa Ignite en este sistema operativo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algoritmos de compresi√≥n que se pueden usar para la compresi√≥n de p√°ginas de disco: ZSTD, LZ4, Snappy. </font><font style="vertical-align: inherit;">Adem√°s, hay un modo operativo (SKIP_GARBAGE), en el que solo se elimina un lugar no utilizado en la p√°gina sin aplicar compresi√≥n a los datos restantes, lo que permite reducir la carga en la CPU en comparaci√≥n con los algoritmos enumerados anteriormente.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impacto en el rendimiento </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desafortunadamente, en realidad no med√≠ el rendimiento en stands reales, ya que no planeamos usar este mecanismo en la producci√≥n, pero en teor√≠a podemos especular d√≥nde perderemos y d√≥nde ganaremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para hacer esto, debemos recordar c√≥mo leer y escribir p√°ginas al acceder a ellas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se realiza una operaci√≥n de lectura, primero se busca en la RAM, si la b√∫squeda falla, la p√°gina se carga en la RAM desde el disco con la misma secuencia que lee.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se realiza una operaci√≥n de escritura, la p√°gina en la RAM se marca como sucia, mientras que el almacenamiento f√≠sico de la p√°gina en el disco inmediatamente en la secuencia que realiza la grabaci√≥n no se produce. </font><font style="vertical-align: inherit;">Todas las p√°ginas sucias se guardan en el disco m√°s adelante en el proceso del punto de control en secuencias separadas.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, el efecto sobre las operaciones de lectura:</font></font><br>
<br>
<ul>
<li> (disk IO),        .</li>
<li> (CPU),           sparse .       IO       sparse  (    sparse  ,  ,  ).</li>
<li> (CPU),     .</li>
<li>    .</li>
<li>    (    ):</li>
<li> (disk IO),        .</li>
<li> (CPU,  disk IO),     sparse .</li>
<li> (CPU),     .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© escala pesar√° m√°s? </font><font style="vertical-align: inherit;">Todo depende mucho del entorno, pero me inclino a creer que la compresi√≥n de la p√°gina del disco tiene m√°s probabilidades de degradar el rendimiento en la mayor√≠a de los sistemas. </font><font style="vertical-align: inherit;">Adem√°s, las pruebas en otros DBMS que utilizan un enfoque similar con archivos dispersos muestran una ca√≠da en el rendimiento cuando se habilita la compresi√≥n.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo habilitar y configurar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se mencion√≥ anteriormente, la versi√≥n m√≠nima de Apache Ignite que admite la compresi√≥n de p√°ginas del disco: 2.8 y solo es compatible con el sistema operativo Linux. </font><font style="vertical-align: inherit;">El encendido y la configuraci√≥n se realizan de la siguiente manera:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ruta de clase debe tener un m√≥dulo de encendido por compresi√≥n. </font><font style="vertical-align: inherit;">Por defecto, se encuentra en la distribuci√≥n Apache Ignite en el directorio libs / opcional y no est√° incluido en la ruta de clase. </font><font style="vertical-align: inherit;">Simplemente puede mover el directorio un nivel hacia arriba a libs y luego, cuando se inicie a trav√©s de ignite.sh, se activar√° autom√°ticamente.</font></font></li>
<li>Persistence    (  <code>DataRegionConfiguration.setPersistenceEnabled(true))</code>.</li>
<li>         (    <code>DataStorageConfiguration.setPageSize()</code> ).</li>
<li>  ,            ()   ( <code>CacheConfiguration.setDiskPageCompression() , CacheConfiguration.setDiskPageCompressionLevel()</code>).</li>
</ul><br>
<h3>WAL compaction</h3><br>
<h4>  </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© es WAL y por qu√© es necesario? Muy brevemente: este es un diario en el que caen todos los eventos que cambian como resultado del repositorio de la p√°gina. Es necesario principalmente por la posibilidad de recuperaci√≥n en caso de una ca√≠da. Antes de transferir el control a un usuario, cualquier operaci√≥n debe primero escribir el evento en el WAL, de modo que en caso de una ca√≠da, pueda reproducir el registro y restaurar todas las operaciones para las cuales el usuario recibi√≥ una respuesta exitosa, incluso si estas operaciones no tuvieron tiempo de reflejarse en el almacenamiento de la p√°gina en el disco (arriba ya se ha descrito que la escritura real en el almac√©n de p√°ginas se realiza en un proceso llamado punto de control con cierto retraso en subprocesos separados).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las entradas en el WAL se dividen en l√≥gicas y f√≠sicas. Los l√≥gicos son claves y valores en s√≠ mismos. F√≠sico: refleja los cambios de p√°gina en la tienda de p√°ginas. Si los registros l√≥gicos pueden ser √∫tiles para otros casos, los registros f√≠sicos son necesarios solo para la recuperaci√≥n en caso de una ca√≠da y los registros son necesarios solo desde el momento del √∫ltimo punto de control exitoso. Aqu√≠ no entraremos en detalles y explicaremos por qu√© esto funciona de esta manera, pero cualquier persona interesada puede consultar el art√≠culo ya mencionado en Apache Ignite Wiki: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ignite Persistent Store, bajo el cap√≥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un registro l√≥gico a menudo representa varios registros f√≠sicos. Es decir, por ejemplo, una operaci√≥n de colocaci√≥n de cach√© afecta a varias p√°ginas en la memoria de la p√°gina (una p√°gina con los datos en s√≠, p√°ginas con √≠ndices, p√°ginas con listas libres). En algunas pruebas sint√©ticas, result√≥ que los registros f√≠sicos ocupaban hasta el 90% del archivo WAL. Adem√°s, necesitan un tiempo muy corto (por defecto, el intervalo entre puntos de control es de 3 minutos). Ser√≠a l√≥gico deshacerse de estos datos despu√©s de perder su relevancia. Esto es exactamente lo que realiza el mecanismo de compactaci√≥n WAL, elimina los registros f√≠sicos y comprime los registros l√≥gicos restantes con zip, mientras que el tama√±o del archivo disminuye de manera muy significativa (a veces decenas de veces).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√≠sicamente, un WAL consta de varios segmentos (predeterminado 10) de un tama√±o fijo (predeterminado 64 MB), que se sobrescriben en un c√≠rculo. </font><font style="vertical-align: inherit;">Tan pronto como se llena el segmento actual, el siguiente segmento se asigna al actual, y el segmento lleno se copia al archivo en una secuencia separada. </font><font style="vertical-align: inherit;">La compactaci√≥n WAL ya funciona con segmentos de archivo. </font><font style="vertical-align: inherit;">Adem√°s, en una secuencia separada, supervisa la ejecuci√≥n del punto de control e inicia la compresi√≥n por segmentos de archivo, para los cuales ya no se necesitan registros f√≠sicos.</font></font><br>
<br>
<img src="https://habrastorage.org/webt/zk/95/jo/zk95jo7dnthiox2sv0ezywhrj2a.png"><br>
 <br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impacto en el rendimiento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que la compactaci√≥n WAL funciona como un hilo separado, no deber√≠a haber una influencia directa en las operaciones realizadas. </font><font style="vertical-align: inherit;">Pero todav√≠a proporciona una carga de fondo adicional en la CPU (compresi√≥n) y el disco (leyendo cada segmento WAL del archivo y escribiendo segmentos comprimidos), por lo que si el sistema se ejecuta al l√≠mite, tambi√©n conducir√° a una degradaci√≥n del rendimiento.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo habilitar y configurar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Puede habilitar la compactaci√≥n WAL utilizando la propiedad </font></font><code>WalCompactionEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font><code>DataStorageConfiguration (DataStorageConfiguration.setWalCompactionEnabled(true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Adem√°s, utilizando el m√©todo DataStorageConfiguration.setWalCompactionLevel (), puede establecer la relaci√≥n de compresi√≥n si no est√° satisfecho con el valor predeterminado (BEST_SPEED).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compresi√≥n de instant√°nea de p√°gina WAL</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo funciona</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ya hemos descubierto que en WAL, las entradas se dividen en l√≥gicas y f√≠sicas. Para cada cambio de cada p√°gina en la memoria de la p√°gina, se genera un registro WAL f√≠sico. Los registros f√≠sicos, a su vez, tambi√©n se dividen en 2 subespecies: registro de instant√°nea de p√°gina y registro delta. Cada vez que cambiamos algo en una p√°gina y lo cambiamos de un estado limpio a uno sucio, se guarda una copia completa de esta p√°gina en el WAL (registro de instant√°nea de la p√°gina). Incluso si cambiamos solo un byte en el WAL, se guardar√° un registro con un tama√±o ligeramente mayor que el tama√±o de la p√°gina. Si cambiamos algo en una p√°gina que ya est√° sucia, se forma un registro delta en el WAL, que refleja solo los cambios en comparaci√≥n con el estado anterior de la p√°gina, pero no toda la p√°gina. Dado que el restablecimiento del estado de las p√°ginas de sucio a limpio se realiza durante el proceso del punto de control,inmediatamente despu√©s del inicio del punto de control, casi todos los registros f√≠sicos consistir√°n solo en instant√°neas de p√°ginas (dado que todas las p√°ginas inmediatamente despu√©s del inicio del punto de control est√°n en blanco), luego, a medida que se acerca al siguiente punto de control, la proporci√≥n de registro delta comienza a crecer y se restablece nuevamente al comienzo del siguiente punto de control. Las mediciones en algunas pruebas sint√©ticas mostraron que la proporci√≥n de instant√°neas de p√°gina en el volumen total de registros f√≠sicos alcanza el 90%.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La idea detr√°s de la compresi√≥n de instant√°neas de p√°gina WAL es comprimir instant√°neas de p√°gina utilizando una herramienta de compresi√≥n de p√°gina est√°ndar (ver compresi√≥n de p√°gina de disco). Al mismo tiempo, en WAL, los registros se guardan secuencialmente en modo de solo agregado y no es necesario vincular los registros a los l√≠mites de los bloques del sistema de archivos, por lo tanto, aqu√≠, a diferencia del mecanismo de compresi√≥n de la p√°gina del disco, no necesitamos archivos dispersos, por lo que este mecanismo funcionar√° no solo en el sistema operativo Linux Adem√°s, ya no nos importa cu√°nto pudimos comprimir la p√°gina. Incluso si liberamos 1 byte, esto ya es un resultado positivo y podemos guardar datos comprimidos en el WAL, a diferencia de la compresi√≥n de la p√°gina del disco, donde guardamos una p√°gina comprimida solo si se libera m√°s de 1 bloque del sistema de archivos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las p√°ginas son datos bien comprimibles, su participaci√≥n en el volumen WAL total es muy alta, por lo que sin cambiar el formato del archivo WAL, podemos obtener una reducci√≥n significativa en su tama√±o. </font><font style="vertical-align: inherit;">La compresi√≥n de registros l√≥gicos, entre otras cosas, requerir√≠a un cambio de formato y p√©rdida de compatibilidad, por ejemplo, para consumidores externos que podr√≠an estar interesados ‚Äã‚Äãen registros l√≥gicos, sin reducir significativamente el tama√±o del archivo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cuanto a la compresi√≥n de la p√°gina del disco para la compresi√≥n de la instant√°nea de la p√°gina WAL, se pueden utilizar los algoritmos de compresi√≥n ZSTD, LZ4, Snappy, as√≠ como el modo SKIP_GARBAGE.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Impacto en el rendimiento</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No es dif√≠cil notar que la inclusi√≥n directa de la compresi√≥n de instant√°neas de p√°gina WAL afecta solo a las secuencias que escriben datos en la memoria de la p√°gina, es decir, aquellas secuencias que cambian los datos en las cach√©s. La lectura de los registros f√≠sicos de WAL ocurre solo una vez, en el momento de elevar el nodo despu√©s de la ca√≠da (y solo en el caso de una ca√≠da durante el punto de control). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto afecta los flujos de datos de la siguiente manera: obtenemos un efecto negativo (CPU) debido a la necesidad de comprimir la p√°gina cada vez antes de escribir en el disco y un efecto positivo (disco IO) al reducir la cantidad de datos que se escriben. En consecuencia, todo es simple aqu√≠, si el rendimiento del sistema se basa en la CPU, tenemos una peque√±a degradaci√≥n, si en la E / S del disco, obtenemos un aumento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Indirectamente, la reducci√≥n del tama√±o de los WAL tambi√©n afecta (positivamente) los flujos que dejan caer segmentos WAL en el archivo y los flujos de compactaci√≥n WAL. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pruebas de rendimiento real en nuestro entorno con datos sint√©ticos mostraron un peque√±o aumento (el rendimiento aument√≥ en un 10% -15%, la latencia disminuy√≥ en un 10% -15%).</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥mo habilitar y configurar</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La versi√≥n m√≠nima de Apache Ignite es 2.8. </font><font style="vertical-align: inherit;">El encendido y la configuraci√≥n se realizan de la siguiente manera:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La ruta de clase debe tener un m√≥dulo de encendido por compresi√≥n. </font><font style="vertical-align: inherit;">Por defecto, se encuentra en la distribuci√≥n Apache Ignite en el directorio libs / opcional y no est√° incluido en la ruta de clase. </font><font style="vertical-align: inherit;">Simplemente puede mover el directorio un nivel hacia arriba a libs y luego, cuando se inicie a trav√©s de ignite.sh, se activar√° autom√°ticamente.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La persistencia debe estar habilitada (habilitada a trav√©s de </font></font><code>DataRegionConfiguration.setPersistenceEnabled(true)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font></li>
<li>        <code>DataStorageConfiguration.setWalPageCompression()</code>,     ( DISABLED).</li>
<li>        <code>DataStorageConfiguration.setWalPageCompression()</code>,         javadoc  .</li>
</ul><br>
<h3></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los mecanismos de compresi√≥n de datos discutidos en Apache Ignite pueden usarse independientemente uno del otro, pero cualquier combinaci√≥n de ellos tambi√©n es v√°lida. </font><font style="vertical-align: inherit;">La comprensi√≥n de los principios de su trabajo determinar√° c√≥mo se ajustan a sus tareas en su entorno y qu√© tendr√° que sacrificar cuando las use. </font><font style="vertical-align: inherit;">La compresi√≥n de p√°gina de disco est√° dise√±ada para comprimir el almacenamiento principal y puede proporcionar una compresi√≥n media. </font><font style="vertical-align: inherit;">La compresi√≥n de instant√°neas de la p√°gina WAL proporcionar√° un grado medio de compresi√≥n de los archivos ya WAL, mientras que es probable que incluso mejore el rendimiento. </font><font style="vertical-align: inherit;">La compactaci√≥n WAL no afectar√° positivamente el rendimiento, pero minimizar√° el tama√±o de los archivos WAL al eliminar registros f√≠sicos.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es502122/index.html">Thanos - Prometeo escalable</a></li>
<li><a href="../es502124/index.html">Resultados de riesgo de 2019 para Ucrania</a></li>
<li><a href="../es502126/index.html">C√≥mo mejorar tu curr√≠culum de programador de ingl√©s</a></li>
<li><a href="../es502132/index.html">C√≥mo transferir el contenedor OpenVZ 6 al servidor KVM sin dolor de cabeza</a></li>
<li><a href="../es502134/index.html">Lo suficiente como para temer las decisiones subjetivamente hermosas en el c√≥digo: no son robots</a></li>
<li><a href="../es502146/index.html">Mesa redonda en l√≠nea "Quiero gamedev"</a></li>
<li><a href="../es502148/index.html">Uso de componentes de terceros en el almacenamiento usando Qsan como ejemplo</a></li>
<li><a href="../es502150/index.html">Escalando una red de alta carga con Nutanix: caracter√≠sticas y desaf√≠os con un caso personal</a></li>
<li><a href="../es502154/index.html">Escribir autotests de manera efectiva - Pruebas subcut√°neas</a></li>
<li><a href="../es502156/index.html">Caso Rambler v. NGINX: Mesa de Riesgos Criminales de Digitalizaci√≥n 16 de mayo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>