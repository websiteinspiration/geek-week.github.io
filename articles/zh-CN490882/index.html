<!doctype html>
<html class="no-js" lang="zh-CN">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗿 🧒 🐤 修复Docker下的问题。看来，GIT与它有什么关系？ 🛄 ⛵️ 💣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windows下的Docker是一个持续的冒险。然后，他需要更新操作系统，否则未安装最新版本，然后他忘记了如何连接到网络。一般来说，每天都会有来自他的新闻。 “设置并忘记”与Windows的Docker桌面无关。特别是在未完全按照开发人员的建议使用时。并且由于某些原因，他们不赞成将外部窗口作为本地连...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>修复Docker下的问题。看来，GIT与它有什么关系？</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/490882/"><img src="https://habrastorage.org/webt/gg/h6/mi/ggh6mikfd0je9-8pcmxwrzgsxzm.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Windows下的Docker是一个持续的冒险。然后，他需要更新操作系统，否则未安装最新版本，然后他忘记了如何连接到网络。一般来说，每天都会有来自他的新闻。 “设置并忘记”与Windows的Docker桌面无关。特别是在未完全按照开发人员的建议使用时。并且由于某些原因，他们不赞成将外部窗口作为本地连接到网络驱动器。并且他们不同意访问也位于主机上的网络文件夹。他们写道，从安全角度来看，这是恐怖的，他们需要各种密钥，例如：</font><font style="vertical-align: inherit;">
使</font><b><font style="vertical-align: inherit;">mount</font></b><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">在容器中</font><font style="vertical-align: inherit;">工作</font><font style="vertical-align: inherit;">，等等。</font></font><br>
<br>
<code> cap_add:<br>
 - SYS_ADMIN<br>
 - DAC_READ_SEARCH</code><br>
<br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通常，当容器再次上传到客户的服务器后，这些服务不再能看到网络驱动器时，我并不感到特别惊讶。这已经发生，甚至为支持小组编写了分步说明，说明了在docker网络设置中断时如何以及如何重启。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，我打开说明并采取行动。重新启动容器没有帮助。我通过docker-compose重新启动并重新构建了基础架构-并没有帮助。我将Docker设置重置为出厂设置，还原了虚拟机的设置，重新加载了映像，并通过docker-compose运行-再次，一切都和以前一样-它看不到网络。更准确地说，尽管从容器到SMB服务器的ping操作是正常的，但它不会连接到网络设备。最后一点是重启服务器并重新安装Docker，而我跳过了，因为我真的不想重启服务器。在此指令结束。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好的，我要搬到我的家用计算机上，这里也有适用于Windows的Docker，但版本稍新。我检查一下。相同的鸡蛋：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/8w/wx/iz/8wwxiz22uw0uvoqxymmglbwek_g.png" alt="没有连接，但请稍等！"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
是的好吧，真的，我认为Docker通过某种安全性汇总了此更新，现在我的脚本因此无法启动？最后检查是从计算机上完全删除Docker，然后重新安装。这应该比重置为出厂设置要凉。我正在做上一步的整个列表，除了此以外，我还重新启动了汽车，以至于完全具有讽刺意味。我从头开始安装Docker，上传图片，启动docker-compose-eprst！所有服务都没有看到网络球，而是在加载时继续写“ mount error（22）：Invalid parameter”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我尝试从命令行逐行运行脚本：我连接到容器，依次运行命令，看到一切都可以正常工作需要：</font></font><br>
<br>
<pre><code class="bash hljs">mkdir -p <span class="hljs-variable">$SMB_MOUNT_POINT</span>
mount -t cifs <span class="hljs-variable">$SMB_SHARE</span> <span class="hljs-variable">$SMB_MOUNT_POINT</span> -o user=<span class="hljs-variable">$SMB_USER</span>,password=<span class="hljs-variable">$SMB_PASSWORD</span>,vers=2.0<font></font>
ls <span class="hljs-variable">$SMB_MOUNT_POINT</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
也就是说，这是什么，在容器启动时带有一些将参数传递给脚本的废话？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们正在寻找更多的想法。 docker重新启动的所有选项都很浅，在父映像中有可能更改的选项。我的映像基于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openjdk：8-jdk-alpine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建</font><font style="vertical-align: inherit;">，未指定特定版本，因此任何安全性改进都可能破坏我的脚本。也许他们在OpenJDK或Alpine的子公司中进行了更改？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我检查了项目日志，尝试选择较旧的openjdk：8-jdk-alpine-3.8，openjdk：8-jdk-alpine-3.7等。 -每次我重建容器时，都要检查-一切都和以前一样。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该死的！</font><font style="vertical-align: inherit;">也许我仍然更改了装配体中的某些内容？</font><font style="vertical-align: inherit;">一个月前从GIT'a版本的项目中卸载，收集-同样的故障。</font><font style="vertical-align: inherit;">三个月前-问题仍然存在。</font><font style="vertical-align: inherit;">为何如此？</font><font style="vertical-align: inherit;">发生了什么变化？</font><font style="vertical-align: inherit;">当前保证docker配置可以正常工作，映像配置也没有更改，项目源相同（GIT保存所有内容）。</font><font style="vertical-align: inherit;">没有奇迹-您仍然需要了解这些变化在何处出现。</font><font style="vertical-align: inherit;">在产品中，我手动启动了对球的连接命令-因此，直到重新启动服务才能正常工作并进入睡眠状态。</font><font style="vertical-align: inherit;">早上比晚上更明智。</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有连接，但请稍等！</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
第二天早上，这个想法就来了-可能是时候找出答案了，脚本执行时到底不喜欢什么。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
消息“安装错误（22）：无效的参数”不是很有用。</font><font style="vertical-align: inherit;">我发现bash有一个魔术键，在执行脚本时它会显示调试信息。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在sh中开始调试：</font></font><br>
 <br>
<pre><code class="bash hljs">/ <span class="hljs-comment"># sh -x /entry-point.sh</span>
<span class="hljs-string">' echo '</span>Mount //&lt;private_ip&gt;/Exchange/Pipeline to /pipeline<font></font>
Mount //&lt;private_ip&gt;/Exchange/Pipeline to /pipeline<font></font>
<span class="hljs-string">' mkdir -p '</span>/pipeline
<span class="hljs-string">' mount -t cifs //&lt;private_ip&gt;/Exchange/Pipeline /pipeline -o '</span>user=&lt;private_user&gt;,password=&lt;private_password&gt;,vers=2.0<font></font>
mount error(22): Invalid argument<font></font>
Refer to the mount.cifs(8) manual page (e.g. man mount.cifs)<font></font>
mount: mounting //&lt;private_ip&gt;/Exchange/Pipeline on /pipeline failed: Invalid argument<font></font>
<span class="hljs-string">' ls '</span>/pipeline<font></font>
+ <span class="hljs-built_in">exec</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在这里出现了一些奇怪的时刻-该行以引号开头，然后在引号结尾...引号来自哪里？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
想法-使用真实的bash进行发布是否可以提供更多信息？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在BASH容器中安装：</font></font><br>
<br>
<pre><code class="bash hljs">apk add bash</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我开始调试：</font></font><br>
<br>
<pre><code class="bash hljs">/ <span class="hljs-comment"># bash -x /entry-point.sh</span>
<span class="hljs-string">' echo '</span>Mount //&lt;private_ip&gt;/Exchange/Pipeline to /pipeline<font></font>
Mount //&lt;private_ip&gt;/Exchange/Pipeline to /pipeline<font></font>
+ mkdir -p $<span class="hljs-string">'/pipeline\r'</span>
+ mount -t cifs //&lt;private_ip&gt;/Exchange/Pipeline /pipeline -o $<span class="hljs-string">'user=&lt;private_user&gt;,password=&lt;private_password&gt;,vers=2.0\r'</span><font></font>
mount error(22): Invalid argument<font></font>
Refer to the mount.cifs(8) manual page (e.g. man mount.cifs)<font></font>
mount: mounting //&lt;private_ip&gt;/Exchange/Pipeline on /pipeline failed: Invalid argument<font></font>
+ ls $<span class="hljs-string">'/pipeline\r'</span>
+ <span class="hljs-built_in">exec</span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该死的，好像该行以加号开头-很好，但是出现了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ r</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$'...'</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将Midnight Commander设置为试验设备</font></font><code>apk add mc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并打开脚本进行编辑，然后：</font></font><br>
<br>
<img src="https://habrastorage.org/webt/m2/y4/ey/m2y4eytxufjj-crsnwrijqsgiw0.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oppa！</font><font style="vertical-align: inherit;">每行末尾的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^M</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。好吧，好吧，看一下本地项目-行尾如何？ CRLF。但是，我们在Windows下工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将此特定的CRLF文件更改为LF（记事本++！），收集项目-Bingo！它可以正常工作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为什么以前还可以，但是现在一切都飞起来了？我看一下提交-没有变化。然后我记得</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GIT可以即时编辑换行</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本文件。</font><font style="vertical-align: inherit;">前几天，我连接了一个新的存储库，并可能从那里上传了所有文件，并转换为CRLF。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果，我们将</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.gitattributes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件添加到项目中</font><font style="vertical-align: inherit;">，表明在单独的文件中，必须像UNIX中一样保存行尾字符：</font></font><br>
<br>
<pre><code class="plaintext hljs"># Set the default behavior, in case people don't have core.autocrlf set.<font></font>
* text=auto<font></font>
<font></font>
# Declare files that will always have LF line endings on checkout.<font></font>
*.sh text eol=lf<font></font>
</code></pre><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">道德-有时，罪魁祸首甚至没有落入最初的犯罪嫌疑人圈子。</font></font></blockquote><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压力</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在更新到适用于Windows 2.2.0.3的最新版本的Docker桌面后，一切都停止了工作。</font><font style="vertical-align: inherit;">这次，我立即进入了容器，并开始调试。</font><font style="vertical-align: inherit;">事实证明，用于访问主机的10.0.75.1 IP地址停止工作，现在已从系统中删除DockerNat，并且DockerDesktopVM虚拟机甚至没有外部网络适配器，即 </font><font style="vertical-align: inherit;">与之通信不是通过标准网络，而是有所不同。</font><font style="vertical-align: inherit;">要访问主机，必须使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">host.docker.internal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">其他开发人员和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DockerNAT已从Docker Desktop 2.2.0.0中删除，因为不支持使用IP地址从主机到容器进行通信。</font><font style="vertical-align: inherit;">要从容器与主机进行通信，必须使用特殊的DNS名称host.docker.internal。</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
好的，我修复了测试环境的配置，拾取了数据库，从容器ping到host.docker.internal通过，但未连接网络驱动器。我尝试从外壳程序手动运行mount，然后得到熟悉的错误“ mount error（22）：Invalid arguments”。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我依次删除了参数-我只运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ mount -t cifs //host.docker.internal/playground / pipeline”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -似乎可以正常运行，但已被root用户</font><font style="vertical-align: inherit;">删除</font><font style="vertical-align: inherit;">。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
添加用户：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mount -t cifs //host.docker.internal/playground/pipeline -o user = smbuser-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求输入密码并连接！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
完整版也可以使用：</font></font><br>
<br>
<pre><code class="bash hljs">mount -t cifs //host.docker.internal/playground /pipeline -o user=smbuser,password=smbpassword</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
但是“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mount -t cifs //host.docker.internal/playground/pipeline -o user = smbuser，密码= smbpassword，vers = 2.0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”不会耕作。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我将最后一个参数更改为vers = 2.1-干杯，它起作用了！</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
似乎最新版本的Docker自己实现了带有二十一点的SMB服务器，但没有2.0支持。</font><font style="vertical-align: inherit;">当然，胡说八道与其他新闻相比。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有的善良，力量和毅力！</font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文的插图取自</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog.eduonix.com/software-development/learn-debug-docker-containers</font></font></a></i></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN490856/index.html">汽车地牢大师</a></li>
<li><a href="../zh-CN490862/index.html">LetsEncrypt计划由于软件错误而吊销其证书</a></li>
<li><a href="../zh-CN490872/index.html">三重奏-人的异步编程</a></li>
<li><a href="../zh-CN490874/index.html">故意实施远程工作：如何在不雇用任何人的情况下使结果翻倍</a></li>
<li><a href="../zh-CN490876/index.html">我们为什么要筋疲力尽？</a></li>
<li><a href="../zh-CN490884/index.html">DEFCON会议27.您的车是我的车。第1部分</a></li>
<li><a href="../zh-CN490888/index.html">为梦幻般的女人选择礼物</a></li>
<li><a href="../zh-CN490890/index.html">Heroku和React：部署您的第一个应用程序</a></li>
<li><a href="../zh-CN490892/index.html">如何从YML文件免费为Yandex和Google生成密钥和广告</a></li>
<li><a href="../zh-CN490894/index.html">关于网站架构的微妙想法</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>