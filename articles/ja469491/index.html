<!doctype html>
<html class="no-js" lang="ja">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📚 👦 🚣🏻 JavaアプリケーションからのAsteriskサーバーとの相互作用 ☔️ 🤵🏽 🎟️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Asterisk Managment Interface（AMI）を介してJavaアプリケーションからAsteriskサーバーと対話する
 この分野の研究を始めたばかりの場合、このサーバーとのやり取りは、かつて私が思っていたように、やや混乱しているように見えるかもしれません。
 
 フォーラムで回答...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>JavaアプリケーションからのAsteriskサーバーとの相互作用</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469491/"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asterisk Managment Interface（AMI）を介してJavaアプリケーションからAsteriskサーバーと対話する</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
この分野の研究を始めたばかりの場合、このサーバーとのやり取りは、かつて私が思っていたように、やや混乱しているように見えるかもしれません。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
フォーラムで回答の質問のスタイルで必要な情報を探さないようにするために、JavaからAsteriskサーバーを操作するための小さなチュートリアルを同封しています。</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要：コードを作成する段階に達したら、アクセス可能なAsteriskサーバーがすでに動作していると思います。</font></font></b><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）作業を便利にするために何を選択しますか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
間違いなく-アスタリスク管理インターフェース（AMI）：このインターフェースには、電話をかけたり、サーバーからリアルタイムでイベントをリッスンしたり、必要に応じて通話ステータスを受信したり、中断したりできる一連の機能があります。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）接続するライブラリは何ですか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
これです：</font></font><br>
<br>
<pre><code class="java hljs">&lt;dependency&gt;<font></font>
            &lt;groupId&gt;org.asteriskjava&lt;/groupId&gt;<font></font>
            &lt;artifactId&gt;asterisk-java&lt;/artifactId&gt;<font></font>
            &lt;version&gt;<span class="hljs-number">2.0</span><span class="hljs-number">.4</span>&lt;/version&gt;<font></font>
&lt;/dependency&gt;<font></font>
</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）サーバーで表示する必要のある構成は何ですか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
extensions.conf-diaplanを記述する構成。</font><font style="vertical-align: inherit;">あなたは常に彼に連絡します。</font><font style="vertical-align: inherit;">より理解しやすい言語の場合、特定の番号に電話がかかってきたときにサーバーが実行する処理のスクリプトが含まれています。</font><font style="vertical-align: inherit;">最初に、特定のコンテキストがダイアプランで検索されます—角かっこで囲まれ、連絡先のこのコンテキストのタグの下で番号が検索されます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
manager.conf-Asteriskサーバー</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
の</font><font style="vertical-align: inherit;">ユーザーとパスワードを含む構成</font><font style="vertical-align: inherit;">この構成の内容は、おおよそ次のようになります。</font></font><br>
<br>
<pre><code class="xml hljs">[user_name]<font></font>
    secret = password<font></font>
    read = all<font></font>
    write = all<font></font>
    deny=0.0.0.0/0.0.0.0<font></font>
    permit=0.0.0.0/255.255.255.0<font></font>
</code></pre><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_name-ユーザー名</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">シークレット-パスワード</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deny-このユーザーの下でアクセスを拒否されたIPアドレス</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit-アクセスを許可する。</font><font style="vertical-align: inherit;">アスターはあなたの要求をはじくことができるので、許可を得て連絡先のIPを必ず指定してください。</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sip.conf-すべてのトランクがここに登録されています。</font><font style="vertical-align: inherit;">トランクは、クライアントと呼ばれる電話です。</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4）どこからコードを書き始めますか？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2つのオプションがあります。Asteriskサーバーで何らかのアクションを実行するか、サーバーでイベントをリッスンする必要があります。</font><font style="vertical-align: inherit;">私たちのシーケンスには両方が含まれています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アクションプランについて説明します。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">サーバーへの接続を開きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作業のシナリオについて説明します。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">イベントを聞きます。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接続を閉じます。</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
したがって、DefaultAsteriskServerオブジェクトの作成中に接続が初期化されます。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">import</span> org.asteriskjava.live.AsteriskServer;
<span class="hljs-keyword">import</span> org.asteriskjava.live.DefaultAsteriskServer;
</code></pre><br>
<pre><code class="java hljs">AsteriskServer asteriskServer = <span class="hljs-keyword">new</span> DefaultAsteriskServer(HOSTNAME, USERNAME, PASSWORD);<font></font>
asteriskServer.initialize();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接続を開いたら、ユーザーを呼び出す必要があります。</font><font style="vertical-align: inherit;">これをアクションシナリオと呼びます。</font><font style="vertical-align: inherit;">シナリオの説明は別のクラスになります。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">/**
 *   
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScenarioCall</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OriginateAction</span> </span>{<font></font>
<font></font>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(ScenarioCall.class);<font></font>
<font></font>
    <span class="hljs-keyword">private</span> String TRUNK;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String PHONE_FOR_RINGING;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String EXTEN_FOR_APP;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String CONTEXT_FOR_APP;<font></font>
    <font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ScenarioCall</span><span class="hljs-params">(String trunk, String phoneForRinging, String extension, String context)</span> </span>{
        <span class="hljs-keyword">this</span>.TRUNK = trunk;
        <span class="hljs-keyword">this</span>.PHONE_FOR_RINGING = phoneForRinging;
        <span class="hljs-keyword">this</span>.EXTEN_FOR_APP = extension;
        <span class="hljs-keyword">this</span>.CONTEXT_FOR_APP = context;
        <span class="hljs-keyword">this</span>.init();<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     *         OriginateAction
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// </span>
        String callId = ValidValues.getValidCallId(<span class="hljs-keyword">this</span>.PHONE_FOR_RINGING);
        <span class="hljs-comment">//   </span>
        String channelAsterisk = ValidValues.getValidChannel(<span class="hljs-keyword">this</span>.TRUNK, <span class="hljs-keyword">this</span>.PHONE_FOR_RINGING);
        <span class="hljs-keyword">this</span>.setContext(CONTEXT_FOR_APP);
        <span class="hljs-keyword">this</span>.setExten(EXTEN_FOR_APP);
        <span class="hljs-keyword">this</span>.setPriority(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">this</span>.setAsync(<span class="hljs-keyword">true</span>);
        <span class="hljs-keyword">this</span>.setCallerId(callId);
        <span class="hljs-keyword">this</span>.setChannel(channelAsterisk);<font></font>
        log.info(<span class="hljs-string">"Create Scenario Call: phone '{}',chanel '{}',context '{}',extension '{}'"</span>,<font></font>
            callId,<font></font>
            channelAsterisk,<font></font>
            CONTEXT_FOR_APP,<font></font>
            EXTEN_FOR_APP);<font></font>
    }<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このシナリオでは何を理解する必要がありますか？</font><font style="vertical-align: inherit;">最初に、トランク接続が作成されます。</font><font style="vertical-align: inherit;">トランクは、加入者に発信する番号です。</font><font style="vertical-align: inherit;">その後、トランクとサブスクライバーの間に接続が作成されます。その後、サブスクライバーと必要な他のユーザーとの接続があります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
その順です。</font></font><br>
<br>
<pre><code class="plaintext hljs">this.setContext(CONTEXT_FOR_APP) </code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信された値：（extensions.confから）サブスクライバーを関連付ける電話番号を探すコンテキスト。</font></font><br>
<br>
<pre><code class="plaintext hljs">this.setExten(EXTEN_FOR_APP) </code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 送信される値：サブスクライバーに連絡した後に実行されるスクリプト（extensions.confから）。</font></font><br>
<br>
<pre><code class="plaintext hljs">this.setCallerId(callId) </code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 送信された値：サブスクライバーの数</font></font><br>
<br>
<pre><code class="plaintext hljs">this.setChannel(channelAsterisk) </code></pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">送信される値：確立された通信チャネル。通常は、trunk_name / phone_userのようになります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
trunk_nameはどこにありますか？</font><font style="vertical-align: inherit;">アスタリスクサーバーにsip.conf設定があります-すべてのトランクがそこに登録されています。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通話を作成します。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (asteriskServer .getManagerConnection().getState().equals(ManagerConnectionState.CONNECTED)<font></font>
                    || asteriskServer .getManagerConnection().getState().equals(ManagerConnectionState.CONNECTING)<font></font>
                    || asteriskServer .getManagerConnection().getState().equals(ManagerConnectionState.INITIAL)) {<font></font>
                    <span class="hljs-keyword">try</span> {<font></font>
						ScenarioCall scenarioCall = <span class="hljs-keyword">new</span> ScenarioCall(trank, phone, extension, context);<font></font>
                        CallBack callBackForScenarioCall = <span class="hljs-keyword">new</span> CallBack();<font></font>
                        asteriskServer.originateAsync(scenarioCall, callBackForScenarioCall);<font></font>
                    } <span class="hljs-keyword">catch</span> (ManagerCommunicationException e) {
                        <span class="hljs-comment">//   , StateConnection     RECONNECTING,     </span><font></font>
                    }<font></font>
                }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通話を作成しましたが、動的に追跡する方法は？</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
このために2つの処理が行われます。originateAsyncメソッドでは、CallBackクラスのインスタンスが転送さ</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
れ、リスナーがサーバーでハングします。これにより、発生したすべてのものがマージされます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CallBackクラスは、ユーザーがすでに話しかけたときに通話の終了を通知せず、ユーザーが他のどこかに転送できることを通知しないため、リスナーが必要です。</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-comment">/**
 *        asteriskConnection.originateAsync 
 *  CallBack -     ,     
 *  originateAsync. CallBack      ,
 *       ,     onNoAnswer , 
 *     onBusy,     ,  onFailure,  .
 *        . ,     
 *      (      ,    )
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallBack</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OriginateCallback</span> </span>{<font></font>
    <font></font>
    <span class="hljs-comment">/**
     *     PRERING,       
     * OriginateCallback -   
     */</span>
    <span class="hljs-keyword">private</span> ChannelState resultCall = ChannelState.PRERING;<font></font>
<font></font>
    <span class="hljs-comment">/**
     *    ,   .        
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onDialing</span><span class="hljs-params">(AsteriskChannel asteriskChannel)</span> </span>{
        <span class="hljs-comment">//   ,  resultCall, </span>
        <span class="hljs-comment">//   asteriskChannel    null, </span>
        <span class="hljs-comment">//    resultCall  </span>
       <span class="hljs-comment">//  </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     *   .     
     *      6 - setStatus
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(AsteriskChannel asteriskChannel)</span> </span>{
        <span class="hljs-comment">//   , asteriskChannel   null,</span>
        <span class="hljs-comment">// asteriskChannel.getState()      ChannelState.UP</span>
       <span class="hljs-comment">//  </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     *      ,   
     *      7 - setStatus ()
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNoAnswer</span><span class="hljs-params">(AsteriskChannel asteriskChannel)</span> </span>{
        <span class="hljs-comment">//   , </span>
        <span class="hljs-comment">//   asteriskChannel    null, </span>
        <span class="hljs-comment">//    resultCall  </span>
       <span class="hljs-comment">//  </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     *  
     *      7 - setStatus ()
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onBusy</span><span class="hljs-params">(AsteriskChannel asteriskChannel)</span> </span>{
        <span class="hljs-comment">//   , </span>
        <span class="hljs-comment">//   asteriskChannel    null,</span>
        <span class="hljs-comment">//    resultCall  </span>
       <span class="hljs-comment">//  </span><font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     *     
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(LiveException e)</span> </span>{
        <span class="hljs-comment">//     , </span>
        <span class="hljs-comment">//     , </span>
        <span class="hljs-comment">// onFailure     </span><font></font>
<font></font>
    }<font></font>
<font></font>
}</code></pre><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">リスナーをアスタリスクにぶら下げる方法は？</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
これを行うには、実装クラスAsteriskServerListener、PropertyChangeListenerを作成します。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AsteriskConnectionクラスのインスタンスを介して作成された接続に対して、以下を実装します。</font></font><br>
<br>
<pre><code class="java hljs"> <span class="hljs-keyword">this</span>.asteriskConnection.addAsteriskServerListener(<span class="hljs-keyword">this</span>.callBackEventListener);</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
this.callBackEventListener-リスナークラスのインスタンス。</font></font><br>
<br>
<pre><code class="java hljs">**<font></font>
 *    Asterisk<font></font>
 *  PropertyChangeListener    ,     .<font></font>
 *  AsteriskServerListener   ,     AsteriskConnection.<font></font>
 */<font></font>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallBackEventListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AsteriskServerListener</span>, <span class="hljs-title">PropertyChangeListener</span> </span>{<font></font>
<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNewAsteriskChannel</span><span class="hljs-params">(AsteriskChannel channel)</span> </span>{<font></font>
        channel.addPropertyChangeListener(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNewMeetMeUser</span><span class="hljs-params">(MeetMeUser user)</span> </span>{<font></font>
        user.addPropertyChangeListener(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNewQueueEntry</span><span class="hljs-params">(AsteriskQueueEntry user)</span> </span>{<font></font>
        user.addPropertyChangeListener(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onNewAgent</span><span class="hljs-params">(AsteriskAgent asteriskAgent)</span> </span>{<font></font>
        asteriskAgent.addPropertyChangeListener(<span class="hljs-keyword">this</span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-comment">/**
     *    .   {<span class="hljs-doctag">@link</span> PropertyChangeEvent}
     *    ,
     *        ,
     *        CallBack
     *
     * <span class="hljs-doctag">@param</span> propertyChangeEvent     
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">propertyChange</span><span class="hljs-params">(PropertyChangeEvent propertyChangeEvent)</span> </span>{<font></font>
        findEventEndCall(propertyChangeEvent);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">findEventEndCall</span><span class="hljs-params">(PropertyChangeEvent event)</span> </span>{
        <span class="hljs-keyword">if</span> (event.getSource() <span class="hljs-keyword">instanceof</span> AsteriskChannel) {<font></font>
            AsteriskChannel callBackChannel = (AsteriskChannel) event.getSource();<font></font>
            String callId = getStringWithOnlyDigits(callBackChannel.getCallerId().toString());<font></font>
            callId = ValidValues.getValidCallId(callId);<font></font>
            <span class="hljs-keyword">if</span> (callBackChannel.getState().toString().equals(<span class="hljs-string">"HUNGUP"</span>)<font></font>
                &amp;&amp; event.getOldValue().toString().contains(<span class="hljs-string">"RINGING"</span>)) {
                <span class="hljs-comment">//     </span>
                callBackChannel.removePropertyChangeListener(<span class="hljs-keyword">this</span>);
               <span class="hljs-comment">//    </span><font></font>
<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (callBackChannel.getState().toString().equals(<span class="hljs-string">"HUNGUP"</span>)<font></font>
                &amp;&amp; event.getOldValue().toString().contains(<span class="hljs-string">"UP"</span>)) {
                <span class="hljs-comment">//    </span>
                callBackChannel.removePropertyChangeListener(<span class="hljs-keyword">this</span>);
                <span class="hljs-comment">//    </span><font></font>
<font></font>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (callBackChannel.getState().toString().equals(<span class="hljs-string">"HUNGUP"</span>)) {
                <span class="hljs-comment">//     </span>
                callBackChannel.removePropertyChangeListener(<span class="hljs-keyword">this</span>);
                <span class="hljs-comment">//    </span><font></font>
            }<font></font>
        }<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getStringWithOnlyDigits</span><span class="hljs-params">(String strForParse)</span> </span>{<font></font>
        String result = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (strForParse != <span class="hljs-keyword">null</span> &amp;&amp; !strForParse.isEmpty()) {<font></font>
            CharMatcher ASCII_DIGITS = CharMatcher.anyOf(<span class="hljs-string">"&lt;&gt;"</span>).precomputed();<font></font>
            result = ASCII_DIGITS.removeFrom(strForParse.replaceAll(<span class="hljs-string">"[^0-9?!]"</span>, <span class="hljs-string">""</span>));<font></font>
        }<font></font>
        <span class="hljs-keyword">return</span> result;<font></font>
    }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
初めに、誓約することをお勧めします。propertyChangeに何が起こり、PropertyChangeEventを見ると、サーバーで発生するすべてのヒープの地獄になります。情報はまったくフィルタリングされません。したがって、結論は、リスナーをできるだけハングさせないことです。私が見つけた限りでは、それはOriginateCallbackクラスでも行うことができるので、すべての呼び出しではありません。これは役に立たない。届くPropertyChangeEventオブジェクトを確認し、そこにあるフィールドのタイプと必要なフィールドを確認します。次へ-情報処理の世界へようこそ。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
データ検証について少し。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OriginateAction.setChannelで-trunk_name / phone_user </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
phone_userが渡されます-ロシアの場合、国際番号にプラスが付いている場合は8桁から始めます。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OriginateAction.setCallerId-クライアントの電話番号が送信され、</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次にCallBackEventListenerでcallBackChannel.getCallerId（）になります。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
次のようになります：</font></font><br>
<br>
<pre><code class="java hljs">String callId = getStringWithOnlyDigits(callBackChannel.getCallerId().toString());
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最後に、忘れないでください。</font></font><br>
<br>
<pre><code class="java hljs">   <font></font>
asteriskServer.shutdown();<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
呼び出しを中断する必要がある場合は</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
、既存の通信チャネルへ</font><font style="vertical-align: inherit;">のCallBackEventListenerクラスで</font><font style="vertical-align: inherit;">、次を実行します。</font></font><br>
<br>
<pre><code class="java hljs">callBackChannel.hangup();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
そのような単純なチュートリアルが判明しました。</font><font style="vertical-align: inherit;">もちろん、一見、それは非常に単純ですが、私を信じてください。情報を見つけ、すべての方法を延期し、作業を終えるには、多くの時間と神経が必要です。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
アスタリスクサーバーで頑張ってください！</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">参考資料</font></a></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1）</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;">アスタリスク-Java </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">チュートリアル</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2）</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ja&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">アスタリスク管理インターフェース（AMI）</font></font></a></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ja469471/index.html">ソートについて語る「5セント」</a></li>
<li><a href="../ja469475/index.html">最新のWebを形作った迷惑なプラグイン、Flashの盛衰</a></li>
<li><a href="../ja469477/index.html">AppleがiPadとPCの比較をやめるべき時</a></li>
<li><a href="../ja469479/index.html">量子確率はどこから来るのですか</a></li>
<li><a href="../ja469487/index.html">GNU / Linuxでのトップの構成</a></li>
<li><a href="../ja469493/index.html">C ++を再び素晴らしいものに！..トゥーラ</a></li>
<li><a href="../ja469495/index.html">WEBテクノロジーを使用してACSを構築するための新しいアプローチ</a></li>
<li><a href="../ja469497/index.html">Tilemapシステムを使用してアイソメ2Dレベルを作成する</a></li>
<li><a href="../ja469499/index.html">ParallelsがAppleでサインインを征服した方法</a></li>
<li><a href="../ja469503/index.html">サイバーセキュリティ：私たちは2019年にリークから加入者データを保護します</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>