<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-13"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-13');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìö üåô üï≥Ô∏è Sectigo's AddTrust root certificate expired on May 30, 2020, which caused problems in OpenSSL 1.0.x and GnuTLS clients üê± üèÇüèª ü§µüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Sectigo Certification Authority (Comodo) warned users in advance of the expiration of the AddTrust root certificate , which was used for cross-sig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://geek-week.github.io/index.html"></a>
    <div class="page-header-text">Get best of the week</div>
  </header>
  <section class="page js-page"><h1>Sectigo's AddTrust root certificate expired on May 30, 2020, which caused problems in OpenSSL 1.0.x and GnuTLS clients</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/504784/"><img src="https://habrastorage.org/webt/51/ho/h3/51hoh3ysljid2g1ipicbdxa4tey.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The Sectigo Certification Authority (Comodo) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warned</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> users </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;">in advance</font></a><font style="vertical-align: inherit;"> of the expiration of the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AddTrust root certificate</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which was used for cross-signing, to ensure compatibility with legacy devices that do not have a new USERTrust root certificate in storage. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AddTrust expired on May 20, 2020 at 10:48:38 UTC. </font><font style="vertical-align: inherit;">Unfortunately, problems arose not only in outdated browsers, but also in non-browser clients based on OpenSSL 1.0.x, LibreSSL and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GnuTLS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">For example, in Roku set-top boxes (see the </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">answer in tech support</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dated 05/30/2020), </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heroku</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , in Fortinet, Chargify applications, on the .NET Core 2.0 platform under Linux and </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">many others</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
It was assumed that the problem would affect only legacy systems (Android 2.3, Windows XP, Mac OS X 10.11, iOS 9, etc.), as modern browsers can use the second USERTRust root certificate, as shown in the diagram. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/sz/d6/a_/szd6a_yqycmxj1p1qzoyt27p1rc.png"><br>
<i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certificate Chain</font></font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
But on May 30, 2020, in fact, crashes began in hundreds of web services that used the free OpenSSL 1.0.x and GnuTLS libraries. </font><font style="vertical-align: inherit;">A secure connection has ceased to be established with a certificate obsolescence error. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The corresponding ticket</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the OpenSSL bug tracker (username and password: guest) was closed on February 25, 2020 only for version OpenSSL 1.1.0.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Why an error occurs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
When a client connects, the TLS server sends it its certificate. </font><font style="vertical-align: inherit;">The client must build a chain of certificates from the server certificate to the root certificate that the client trusts. </font><font style="vertical-align: inherit;">To help the client build this chain, the server sends an additional one or more intermediate certificates along with its own. </font></font><br>
<br>
<img src="https://habrastorage.org/webt/tl/gi/_s/tlgi_sx2-vmibmkqwwdtpzlmp9q.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For example, a website sends the following two certificates:</font></font><br>
<br>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subject = * .habr.com</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Publisher = Sectigo ECC Domain Validation Secure Server CA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Start of action = Saturday, May 30, 2020 </font><font style="vertical-align: inherit;">3:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Expiration Date = Friday, December 3, 2021 </font><font style="vertical-align: inherit;">2:59:59</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Subject = Sectigo ECC Domain Validation Secure Server CA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Publisher = USERTrust ECC Certification Authority</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Start of action = Friday, November 2, 2018 </font><font style="vertical-align: inherit;">3:00:00</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
End of action = Wednesday, January 1, 2031 </font><font style="vertical-align: inherit;">2:59:59</font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
The first certificate belongs to the server and is issued by the Sectigo certificate authority. The second is issued by the USERTrust ECC certification authority and is the root certificate. These two certificates form a complete chain to a trusted root. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
However, the USERTrust certification authority is a relatively new root. It was created in 2010, and it took many years for all clients to trust it. Last year, there were reports that individual customers do not trust this root. Therefore, some servers send an additional USERTrust ECC Certification Authority intermediate certificate issued by AddTrust External CA Root to the client. This certificate was generated in 2000, and it was his certificate that expired on May 30, 2020.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For competent certificate validators, including modern browsers, this did not cause problems, because they themselves can build a chain of trust before USERTrust, but there was a problem with clients who use OpenSSL 1.0.x or GnuTLS. </font><font style="vertical-align: inherit;">Even if these clients trust the USERTrust root certification authority and want to build a chain to it, they still end up with a chain to AddTrust External CA Root, which causes certificate verification to fail. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sectigo has provided an alternative cross-signed intermediate certificate </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA Certificate Services</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which will be valid until 2028.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checking Your Services</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Server handler and client application operators are encouraged to check their certificate chain for an outdated AddTrust root certificate. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essentially, you just need to remove AddTrust External CA Root from the trust chain. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
For server operators there is a service </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What's My Chain Cert?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which performs this check and helps generate a new trust chain with all the necessary intermediate certificates. It is not necessary to include a root certificate in this chain, since all clients already have it in the store. In addition, including it in the chain is simply inefficient due to the increase in the size of the SSL handshake.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Client application operators are advised to upgrade to the latest TLS library. </font><font style="vertical-align: inherit;">If this is not possible, you must remove the AddTrust External CA Root certificate from your storage. </font><font style="vertical-align: inherit;">If it is not in the repository, then the correct chain of trust is built for the new root certificate USERTrust RSA Certification Authority, so that the TLS check passes correctly. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To remove AddTrust External CA Root you need </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to do the following</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edit </font></font><code>/etc/ca-certificates.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and comment</font></font><code>mozilla/AddTrust_External_Root.crt</code><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run </font></font><code>update-ca-certificates</code></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
To fix the problem, Fedora and RHEL </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">suggest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adding the AddTrust certificate to the blacklist:</font></font><br>
<br>
<pre><code class="plaintext hljs"> trust dump --filter "pkcs11:id=%AD%BD%98%7A%34%B4%26%F7%FA%C4%26%54%EF%03%BD%E0%24%CB%54%1A;type=cert" \<font></font>
&gt; /etc/pki/ca-trust/source/blacklist/addtrust-external-root.p11-kit<font></font>
update-ca-trust extract</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
But this method does not work for GnuTLS.</font></font><br>
<br>
<blockquote><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See also:</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
‚Äú </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The problem with Sectigo certificates after May 30, 2020 and the method of solution</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù on the Habr corporate blog</font></font></blockquote><br>
<br>
<hr><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u="><img src="https://habrastorage.org/webt/9q/wb/zs/9qwbzsfapeaakd_obyftagefhny.jpeg"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PKI solutions for your enterprise. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contact us +7 (499) 678 2210, sales-ru@globalsign.com.</font></font></div>
      
    </div>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../en504770/index.html">Linux Gaming Distributions</a></li>
<li><a href="../en504772/index.html">Digital events in Moscow from June 1 to 7</a></li>
<li><a href="../en504774/index.html">Survey of IT executives about changing needs for IT services</a></li>
<li><a href="../en504776/index.html">Writing a game engine in your first year: easy! (Almost)</a></li>
<li><a href="../en504780/index.html">NSA, Ghidra and Unicorns</a></li>
<li><a href="../en504786/index.html">Everything you need to know about caching</a></li>
<li><a href="../en504790/index.html">A selection of articles on machine learning: cases, guides and studies for May 2020</a></li>
<li><a href="../en504792/index.html">Duty boarding house. How NSPK saved its duty room from a coronavirus</a></li>
<li><a href="../en504796/index.html">Udalenka is cool. Maybe stay forever?</a></li>
<li><a href="../en504798/index.html">Artificial Intelligence Watch Complaints</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter63335242 = new Ya.Metrika({
                  id:63335242,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/63335242" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-13', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Geek Week | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2020</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=i62cJ2037o_BACd40gCrIso3niu0Sjx2sDFYJkeYdRk&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>